<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 15814:614dbfb6656ff30abd75db9ea2e35815e8682079</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 614dbfb6656ff30abd75db9ea2e35815e8682079" />
<meta property="og:url" content="/comm-central/rev/614dbfb6656ff30abd75db9ea2e35815e8682079" />
<meta property="og:description" content="Bug 801553 - Replace mdb_err by nsresult. r=standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 614dbfb6656ff30abd75db9ea2e35815e8682079 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/614dbfb6656ff30abd75db9ea2e35815e8682079">shortlog</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/614dbfb6656ff30abd75db9ea2e35815e8682079">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079">files</a> |
changeset |
<a href="/comm-central/raw-rev/614dbfb6656ff30abd75db9ea2e35815e8682079">raw</a>  | <a href="/comm-central/archive/614dbfb6656ff30abd75db9ea2e35815e8682079.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=801553">Bug 801553</a> - Replace mdb_err by nsresult. r=standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#67;&#121;&#107;&#101;&#115;&#105;&#111;&#112;&#107;&#97;&#32;&#60;&#99;&#121;&#107;&#101;&#115;&#105;&#111;&#112;&#107;&#97;&#46;&#98;&#109;&#111;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 27 Feb 2014 11:27:59 -0500</td></tr>

<tr>
 <td>changeset 15814</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/614dbfb6656ff30abd75db9ea2e35815e8682079">614dbfb6656ff30abd75db9ea2e35815e8682079</a></td>
</tr>



<tr>
<td>parent 15813</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4c39c2e048bf1067f4daa100e84d7c66254921ba">4c39c2e048bf1067f4daa100e84d7c66254921ba</a>
</td>
</tr>

<tr>
<td>child 15815</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8ea88aad10455b618047a80d2b560c2f494dc378">8ea88aad10455b618047a80d2b560c2f494dc378</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=614dbfb6656ff30abd75db9ea2e35815e8682079">9903</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 27 Feb 2014 16:27:57 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@614dbfb6656f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=614dbfb6656ff30abd75db9ea2e35815e8682079">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=614dbfb6656ff30abd75db9ea2e35815e8682079&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=614dbfb6656ff30abd75db9ea2e35815e8682079&newProject=comm-central&newRevision=4c39c2e048bf1067f4daa100e84d7c66254921ba&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=614dbfb6656ff30abd75db9ea2e35815e8682079&newProject=comm-central&newRevision=4c39c2e048bf1067f4daa100e84d7c66254921ba&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=614dbfb6656ff30abd75db9ea2e35815e8682079&newProject=comm-central&newRevision=4c39c2e048bf1067f4daa100e84d7c66254921ba&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28standard8%29&revcount=50">standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=801553">801553</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=801553">Bug 801553</a> - Replace mdb_err by nsresult. r=standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/public/mdb.h">db/mork/public/mdb.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/public/mdb.h">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/public/mdb.h">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/public/mdb.h">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/public/mdb.h">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/public/mdb.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.cpp">db/mork/src/morkCellObject.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.h">db/mork/src/morkCellObject.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.h">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.h">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.h">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.h">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkCellObject.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.cpp">db/mork/src/morkFactory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.h">db/mork/src/morkFactory.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.h">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.h">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.h">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.h">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFactory.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFile.cpp">db/mork/src/morkFile.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFile.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFile.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFile.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFile.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkFile.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.cpp">db/mork/src/morkHandle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.h">db/mork/src/morkHandle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.h">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.h">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.h">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.h">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkHandle.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.cpp">db/mork/src/morkNode.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.h">db/mork/src/morkNode.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.h">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.h">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.h">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.h">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkNode.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.cpp">db/mork/src/morkPortTableCursor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.h">db/mork/src/morkPortTableCursor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.h">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.h">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.h">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.h">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkPortTableCursor.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowCellCursor.cpp">db/mork/src/morkRowCellCursor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowCellCursor.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowCellCursor.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowCellCursor.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowCellCursor.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowCellCursor.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowObject.cpp">db/mork/src/morkRowObject.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowObject.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowObject.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowObject.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowObject.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkRowObject.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.cpp">db/mork/src/morkStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.h">db/mork/src/morkStore.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.h">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.h">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.h">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.h">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkStore.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTable.cpp">db/mork/src/morkTable.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTable.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTable.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTable.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTable.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTable.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTableRowCursor.cpp">db/mork/src/morkTableRowCursor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTableRowCursor.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTableRowCursor.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTableRowCursor.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTableRowCursor.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkTableRowCursor.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkThumb.cpp">db/mork/src/morkThumb.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkThumb.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkThumb.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkThumb.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkThumb.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkThumb.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkZone.cpp">db/mork/src/morkZone.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkZone.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkZone.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkZone.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkZone.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/morkZone.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/orkinHeap.cpp">db/mork/src/orkinHeap.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/orkinHeap.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/orkinHeap.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/orkinHeap.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/orkinHeap.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/db/mork/src/orkinHeap.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/addrbook/src/nsAddrDatabase.cpp">mailnews/addrbook/src/nsAddrDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/addrbook/src/nsAddrDatabase.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/addrbook/src/nsAddrDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/addrbook/src/nsAddrDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/addrbook/src/nsAddrDatabase.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/addrbook/src/nsAddrDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/base/src/nsMsgFolderCache.cpp">mailnews/base/src/nsMsgFolderCache.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/base/src/nsMsgFolderCache.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/base/src/nsMsgFolderCache.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/base/src/nsMsgFolderCache.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/base/src/nsMsgFolderCache.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/base/src/nsMsgFolderCache.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">mailnews/db/msgdb/src/nsDBFolderInfo.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">mailnews/db/msgdb/src/nsImapMailDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsImapMailDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMailDatabase.cpp">mailnews/db/msgdb/src/nsMailDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMailDatabase.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMailDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMailDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMailDatabase.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMailDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/614dbfb6656ff30abd75db9ea2e35815e8682079/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/db/mork/public/mdb.h</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/db/mork/public/mdb.h</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -75,19 +75,16 @@ typedef mdb_u2 mork_uses;    // 2-byte s</span>
<a href="#l1.4"></a><span id="l1.4"> typedef mdb_u2 mork_refs;    // 2-byte actual reference count</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> #define mdbId_kNone ((mdb_id) -1) /* never a valid Mork object ID */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> typedef mdb_u4 mdb_percent; // 0..100, with values &gt;100 same as 100</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> typedef mdb_u1 mdb_priority; // 0..9, for a total of ten different values</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-// temporary substitute for NS_RESULT, for mdb.h standalone compilation:</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-typedef nsresult mdb_err;   // equivalent to NS_RESULT</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-</span>
<a href="#l1.15"></a><span id="l1.15"> // sequence position is signed; negative is useful to mean &quot;before first&quot;:</span>
<a href="#l1.16"></a><span id="l1.16"> typedef mdb_i4 mdb_pos; // signed zero-based ordinal collection position</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> #define mdbPos_kBeforeFirst ((mdb_pos) -1) /* any negative is before zero */</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> // order is also signed, so we can use three states for comparison order:</span>
<a href="#l1.21"></a><span id="l1.21"> typedef mdb_i4 mdb_order; // neg:lessthan, zero:equalto, pos:greaterthan </span>
<a href="#l1.22"></a><span id="l1.22"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/db/mork/src/morkCellObject.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/db/mork/src/morkCellObject.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -211,17 +211,17 @@ morkCellObject::AcquireCellHandle(morkEn</span>
<a href="#l2.4"></a><span id="l2.4">   nsIMdbCell* outCell = this;</span>
<a href="#l2.5"></a><span id="l2.5">   NS_ADDREF(outCell);</span>
<a href="#l2.6"></a><span id="l2.6">   return outCell;</span>
<a href="#l2.7"></a><span id="l2.7"> }</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> morkEnv*</span>
<a href="#l2.11"></a><span id="l2.11"> morkCellObject::CanUseCell(nsIMdbEnv* mev, mork_bool inMutable,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  mdb_err* outErr, morkCell** outCell) </span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                           nsresult* outErr, morkCell** outCell)</span>
<a href="#l2.14"></a><span id="l2.14"> {</span>
<a href="#l2.15"></a><span id="l2.15">   morkEnv* outEnv = 0;</span>
<a href="#l2.16"></a><span id="l2.16">   morkCell* cell = 0;</span>
<a href="#l2.17"></a><span id="l2.17">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l2.18"></a><span id="l2.18">   if ( ev )</span>
<a href="#l2.19"></a><span id="l2.19">   {</span>
<a href="#l2.20"></a><span id="l2.20">     if ( IsCellObject() )</span>
<a href="#l2.21"></a><span id="l2.21">     {</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -295,17 +295,17 @@ NS_IMETHODIMP morkCellObject::GetBlobFil</span>
<a href="#l2.23"></a><span id="l2.23"> {</span>
<a href="#l2.24"></a><span id="l2.24">   NS_ASSERTION(false, &quot;not implemented&quot;);</span>
<a href="#l2.25"></a><span id="l2.25">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l2.26"></a><span id="l2.26"> }  // size of blob </span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28"> NS_IMETHODIMP morkCellObject::SetYarn(nsIMdbEnv* mev, </span>
<a href="#l2.29"></a><span id="l2.29">   const mdbYarn* inYarn)</span>
<a href="#l2.30"></a><span id="l2.30"> {</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l2.33"></a><span id="l2.33">   morkCell* cell = 0;</span>
<a href="#l2.34"></a><span id="l2.34">   morkEnv* ev = this-&gt;CanUseCell(mev, /*inMutable*/ morkBool_kTrue,</span>
<a href="#l2.35"></a><span id="l2.35">     &amp;outErr, &amp;cell);</span>
<a href="#l2.36"></a><span id="l2.36">   if ( ev )</span>
<a href="#l2.37"></a><span id="l2.37">   {</span>
<a href="#l2.38"></a><span id="l2.38">     morkRow* row = mCellObject_Row;</span>
<a href="#l2.39"></a><span id="l2.39">     if ( row )</span>
<a href="#l2.40"></a><span id="l2.40">     {</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineat">@@ -325,17 +325,17 @@ NS_IMETHODIMP morkCellObject::SetYarn(ns</span>
<a href="#l2.42"></a><span id="l2.42">     </span>
<a href="#l2.43"></a><span id="l2.43">   return outErr;</span>
<a href="#l2.44"></a><span id="l2.44"> }   // reads from yarn slots</span>
<a href="#l2.45"></a><span id="l2.45"> // make this text object contain content from the yarn's buffer</span>
<a href="#l2.46"></a><span id="l2.46"> </span>
<a href="#l2.47"></a><span id="l2.47"> NS_IMETHODIMP morkCellObject::GetYarn(nsIMdbEnv* mev, </span>
<a href="#l2.48"></a><span id="l2.48">   mdbYarn* outYarn)</span>
<a href="#l2.49"></a><span id="l2.49"> {</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l2.52"></a><span id="l2.52">   morkCell* cell = 0;</span>
<a href="#l2.53"></a><span id="l2.53">   morkEnv* ev = this-&gt;CanUseCell(mev, /*inMutable*/ morkBool_kTrue,</span>
<a href="#l2.54"></a><span id="l2.54">     &amp;outErr, &amp;cell);</span>
<a href="#l2.55"></a><span id="l2.55">   if ( ev )</span>
<a href="#l2.56"></a><span id="l2.56">   {</span>
<a href="#l2.57"></a><span id="l2.57">     morkAtom* atom = cell-&gt;GetAtom();</span>
<a href="#l2.58"></a><span id="l2.58">     atom-&gt;GetYarn(outYarn);</span>
<a href="#l2.59"></a><span id="l2.59">     outErr = ev-&gt;AsErr();</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineat">@@ -343,17 +343,17 @@ NS_IMETHODIMP morkCellObject::GetYarn(ns</span>
<a href="#l2.61"></a><span id="l2.61">     </span>
<a href="#l2.62"></a><span id="l2.62">   return outErr;</span>
<a href="#l2.63"></a><span id="l2.63"> }  // writes some yarn slots </span>
<a href="#l2.64"></a><span id="l2.64"> // copy content into the yarn buffer, and update mYarn_Fill and mYarn_Form</span>
<a href="#l2.65"></a><span id="l2.65"> </span>
<a href="#l2.66"></a><span id="l2.66"> NS_IMETHODIMP morkCellObject::AliasYarn(nsIMdbEnv* mev, </span>
<a href="#l2.67"></a><span id="l2.67">   mdbYarn* outYarn)</span>
<a href="#l2.68"></a><span id="l2.68"> {</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l2.71"></a><span id="l2.71">   morkCell* cell = 0;</span>
<a href="#l2.72"></a><span id="l2.72">   morkEnv* ev = this-&gt;CanUseCell(mev, /*inMutable*/ morkBool_kTrue,</span>
<a href="#l2.73"></a><span id="l2.73">     &amp;outErr, &amp;cell);</span>
<a href="#l2.74"></a><span id="l2.74">   if ( ev )</span>
<a href="#l2.75"></a><span id="l2.75">   {</span>
<a href="#l2.76"></a><span id="l2.76">     morkAtom* atom = cell-&gt;GetAtom();</span>
<a href="#l2.77"></a><span id="l2.77">     atom-&gt;AliasYarn(outYarn);</span>
<a href="#l2.78"></a><span id="l2.78">     outErr = ev-&gt;AsErr();</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineat">@@ -373,17 +373,17 @@ NS_IMETHODIMP morkCellObject::SetColumn(</span>
<a href="#l2.80"></a><span id="l2.80"> {</span>
<a href="#l2.81"></a><span id="l2.81">   NS_ASSERTION(false, &quot;not implemented&quot;);</span>
<a href="#l2.82"></a><span id="l2.82">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l2.83"></a><span id="l2.83">   // remember row-&gt;MaybeDirtySpaceStoreAndRow();</span>
<a href="#l2.84"></a><span id="l2.84"> } </span>
<a href="#l2.85"></a><span id="l2.85"> </span>
<a href="#l2.86"></a><span id="l2.86"> NS_IMETHODIMP morkCellObject::GetColumn(nsIMdbEnv* mev, mdb_column* outColumn)</span>
<a href="#l2.87"></a><span id="l2.87"> {</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l2.90"></a><span id="l2.90">   mdb_column col = 0;</span>
<a href="#l2.91"></a><span id="l2.91">   morkCell* cell = 0;</span>
<a href="#l2.92"></a><span id="l2.92">   morkEnv* ev = this-&gt;CanUseCell(mev, /*inMutable*/ morkBool_kTrue,</span>
<a href="#l2.93"></a><span id="l2.93">     &amp;outErr, &amp;cell);</span>
<a href="#l2.94"></a><span id="l2.94">   if ( ev )</span>
<a href="#l2.95"></a><span id="l2.95">   {</span>
<a href="#l2.96"></a><span id="l2.96">     col = mCellObject_Col;</span>
<a href="#l2.97"></a><span id="l2.97">     outErr = ev-&gt;AsErr();</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineat">@@ -405,17 +405,17 @@ NS_IMETHODIMP morkCellObject::GetCellInf</span>
<a href="#l2.99"></a><span id="l2.99">   NS_ASSERTION(false, &quot;not implemented&quot;);</span>
<a href="#l2.100"></a><span id="l2.100">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l2.101"></a><span id="l2.101"> }</span>
<a href="#l2.102"></a><span id="l2.102"> </span>
<a href="#l2.103"></a><span id="l2.103"> </span>
<a href="#l2.104"></a><span id="l2.104"> NS_IMETHODIMP morkCellObject::GetRow(nsIMdbEnv* mev, // parent row for this cell</span>
<a href="#l2.105"></a><span id="l2.105">   nsIMdbRow** acqRow)</span>
<a href="#l2.106"></a><span id="l2.106"> {</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l2.109"></a><span id="l2.109">   nsIMdbRow* outRow = 0;</span>
<a href="#l2.110"></a><span id="l2.110">   morkCell* cell = 0;</span>
<a href="#l2.111"></a><span id="l2.111">   morkEnv* ev = this-&gt;CanUseCell(mev, /*inMutable*/ morkBool_kTrue,</span>
<a href="#l2.112"></a><span id="l2.112">     &amp;outErr, &amp;cell);</span>
<a href="#l2.113"></a><span id="l2.113">   if ( ev )</span>
<a href="#l2.114"></a><span id="l2.114">   {</span>
<a href="#l2.115"></a><span id="l2.115">     outRow = mCellObject_RowObject-&gt;AcquireRowHandle(ev);</span>
<a href="#l2.116"></a><span id="l2.116">     </span>
<a href="#l2.117"></a><span id="l2.117" class="difflineat">@@ -424,17 +424,17 @@ NS_IMETHODIMP morkCellObject::GetRow(nsI</span>
<a href="#l2.118"></a><span id="l2.118">   if ( acqRow )</span>
<a href="#l2.119"></a><span id="l2.119">     *acqRow = outRow;</span>
<a href="#l2.120"></a><span id="l2.120">   return outErr;</span>
<a href="#l2.121"></a><span id="l2.121"> }</span>
<a href="#l2.122"></a><span id="l2.122"> </span>
<a href="#l2.123"></a><span id="l2.123"> NS_IMETHODIMP morkCellObject::GetPort(nsIMdbEnv* mev, // port containing cell</span>
<a href="#l2.124"></a><span id="l2.124">   nsIMdbPort** acqPort)</span>
<a href="#l2.125"></a><span id="l2.125"> {</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l2.128"></a><span id="l2.128">   nsIMdbPort* outPort = 0;</span>
<a href="#l2.129"></a><span id="l2.129">   morkCell* cell = 0;</span>
<a href="#l2.130"></a><span id="l2.130">   morkEnv* ev = this-&gt;CanUseCell(mev, /*inMutable*/ morkBool_kTrue,</span>
<a href="#l2.131"></a><span id="l2.131">     &amp;outErr, &amp;cell);</span>
<a href="#l2.132"></a><span id="l2.132">   if ( ev )</span>
<a href="#l2.133"></a><span id="l2.133">   {</span>
<a href="#l2.134"></a><span id="l2.134">     if ( mCellObject_Row )</span>
<a href="#l2.135"></a><span id="l2.135">     {</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineat">@@ -454,17 +454,17 @@ NS_IMETHODIMP morkCellObject::GetPort(ns</span>
<a href="#l2.137"></a><span id="l2.137"> // } ----- end attribute methods -----</span>
<a href="#l2.138"></a><span id="l2.138"> </span>
<a href="#l2.139"></a><span id="l2.139"> // { ----- begin children methods -----</span>
<a href="#l2.140"></a><span id="l2.140"> NS_IMETHODIMP morkCellObject::HasAnyChild( // does cell have a child instead of text?</span>
<a href="#l2.141"></a><span id="l2.141">   nsIMdbEnv* mev,</span>
<a href="#l2.142"></a><span id="l2.142">   mdbOid* outOid,  // out id of row or table (or unbound if no child)</span>
<a href="#l2.143"></a><span id="l2.143">   mdb_bool* outIsRow) // nonzero if child is a row (rather than a table)</span>
<a href="#l2.144"></a><span id="l2.144"> {</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l2.147"></a><span id="l2.147">   mdb_bool isRow = morkBool_kFalse;</span>
<a href="#l2.148"></a><span id="l2.148">   outOid-&gt;mOid_Scope = 0;</span>
<a href="#l2.149"></a><span id="l2.149">   outOid-&gt;mOid_Id = morkId_kMinusOne;</span>
<a href="#l2.150"></a><span id="l2.150">   morkCell* cell = 0;</span>
<a href="#l2.151"></a><span id="l2.151">   morkEnv* ev = this-&gt;CanUseCell(mev, /*inMutable*/ morkBool_kTrue,</span>
<a href="#l2.152"></a><span id="l2.152">     &amp;outErr, &amp;cell);</span>
<a href="#l2.153"></a><span id="l2.153">   if ( ev )</span>
<a href="#l2.154"></a><span id="l2.154">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/db/mork/src/morkCellObject.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/db/mork/src/morkCellObject.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -139,17 +139,17 @@ private: // copying is not allowed</span>
<a href="#l3.4"></a><span id="l3.4"> public: // dynamic type identification</span>
<a href="#l3.5"></a><span id="l3.5">   mork_bool IsCellObject() const</span>
<a href="#l3.6"></a><span id="l3.6">   { return IsNode() &amp;&amp; mNode_Derived == morkDerived_kCellObject; }</span>
<a href="#l3.7"></a><span id="l3.7"> // } ===== end morkNode methods =====</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> public: // other cell node methods</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   morkEnv*  CanUseCell(nsIMdbEnv* mev, mork_bool inMutable,</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    mdb_err* outErr, morkCell** outCell) ;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                       nsresult* outErr, morkCell** outCell);</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15">   mork_bool ResyncWithRow(morkEnv* ev); // return ev-&gt;Good()</span>
<a href="#l3.16"></a><span id="l3.16">   morkAtom* GetCellAtom(morkEnv* ev) const;</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18">   static void MissingRowColumnError(morkEnv* ev);</span>
<a href="#l3.19"></a><span id="l3.19">   static void NilRowError(morkEnv* ev);</span>
<a href="#l3.20"></a><span id="l3.20">   static void NilCellError(morkEnv* ev);</span>
<a href="#l3.21"></a><span id="l3.21">   static void NilRowObjectError(morkEnv* ev);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/db/mork/src/morkFactory.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/db/mork/src/morkFactory.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -135,17 +135,17 @@ morkFactory::CloseFactory(morkEnv* ev) /</span>
<a href="#l4.4"></a><span id="l4.4">   }</span>
<a href="#l4.5"></a><span id="l4.5">   else</span>
<a href="#l4.6"></a><span id="l4.6">     ev-&gt;NilPointerError();</span>
<a href="#l4.7"></a><span id="l4.7"> }</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> // } ===== end morkNode methods =====</span>
<a href="#l4.10"></a><span id="l4.10"> // ````` ````` ````` ````` ````` </span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-morkEnv* morkFactory::GetInternalFactoryEnv(mdb_err* outErr)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+morkEnv* morkFactory::GetInternalFactoryEnv(nsresult* outErr)</span>
<a href="#l4.14"></a><span id="l4.14"> {</span>
<a href="#l4.15"></a><span id="l4.15">   morkEnv* outEnv = 0;</span>
<a href="#l4.16"></a><span id="l4.16">   if (IsNode() &amp;&amp; IsOpenNode() &amp;&amp; IsFactory() )</span>
<a href="#l4.17"></a><span id="l4.17">   {</span>
<a href="#l4.18"></a><span id="l4.18">     morkEnv* fenv = &amp;mFactory_Env;</span>
<a href="#l4.19"></a><span id="l4.19">     if ( fenv &amp;&amp; fenv-&gt;IsNode() &amp;&amp; fenv-&gt;IsOpenNode() &amp;&amp; fenv-&gt;IsEnv() )</span>
<a href="#l4.20"></a><span id="l4.20">     {</span>
<a href="#l4.21"></a><span id="l4.21">       fenv-&gt;ClearMorkErrorsAndWarnings(); // drop any earlier errors</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -174,17 +174,17 @@ morkFactory::OpenOldFile(nsIMdbEnv* mev,</span>
<a href="#l4.23"></a><span id="l4.23">   mork_bool inFrozen, nsIMdbFile** acqFile)</span>
<a href="#l4.24"></a><span id="l4.24">   // Choose some subclass of nsIMdbFile to instantiate, in order to read</span>
<a href="#l4.25"></a><span id="l4.25">   // (and write if not frozen) the file known by inFilePath.  The file</span>
<a href="#l4.26"></a><span id="l4.26">   // returned should be open and ready for use, and presumably positioned</span>
<a href="#l4.27"></a><span id="l4.27">   // at the first byte position of the file.  The exact manner in which</span>
<a href="#l4.28"></a><span id="l4.28">   // files must be opened is considered a subclass specific detail, and</span>
<a href="#l4.29"></a><span id="l4.29">   // other portions or Mork source code don't want to know how it's done.</span>
<a href="#l4.30"></a><span id="l4.30"> {</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.33"></a><span id="l4.33">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.34"></a><span id="l4.34">   morkFile* file = nullptr;</span>
<a href="#l4.35"></a><span id="l4.35">   if ( ev )</span>
<a href="#l4.36"></a><span id="l4.36">   {</span>
<a href="#l4.37"></a><span id="l4.37">     if ( !ioHeap )</span>
<a href="#l4.38"></a><span id="l4.38">       ioHeap = &amp;mFactory_Heap;</span>
<a href="#l4.39"></a><span id="l4.39">       </span>
<a href="#l4.40"></a><span id="l4.40">     file = morkFile::OpenOldFile(ev, ioHeap, inFilePath, inFrozen);</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineat">@@ -203,17 +203,17 @@ morkFactory::CreateNewFile(nsIMdbEnv* me</span>
<a href="#l4.42"></a><span id="l4.42">   const char* inFilePath, nsIMdbFile** acqFile)</span>
<a href="#l4.43"></a><span id="l4.43">   // Choose some subclass of nsIMdbFile to instantiate, in order to read</span>
<a href="#l4.44"></a><span id="l4.44">   // (and write if not frozen) the file known by inFilePath.  The file</span>
<a href="#l4.45"></a><span id="l4.45">   // returned should be created and ready for use, and presumably positioned</span>
<a href="#l4.46"></a><span id="l4.46">   // at the first byte position of the file.  The exact manner in which</span>
<a href="#l4.47"></a><span id="l4.47">   // files must be opened is considered a subclass specific detail, and</span>
<a href="#l4.48"></a><span id="l4.48">   // other portions or Mork source code don't want to know how it's done.</span>
<a href="#l4.49"></a><span id="l4.49"> {</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.52"></a><span id="l4.52">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.53"></a><span id="l4.53">   morkFile* file = nullptr;</span>
<a href="#l4.54"></a><span id="l4.54">   if ( ev )</span>
<a href="#l4.55"></a><span id="l4.55">   {</span>
<a href="#l4.56"></a><span id="l4.56">     if ( !ioHeap )</span>
<a href="#l4.57"></a><span id="l4.57">       ioHeap = &amp;mFactory_Heap;</span>
<a href="#l4.58"></a><span id="l4.58">       </span>
<a href="#l4.59"></a><span id="l4.59">     file = morkFile::CreateNewFile(ev, ioHeap, inFilePath);</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineat">@@ -229,17 +229,17 @@ morkFactory::CreateNewFile(nsIMdbEnv* me</span>
<a href="#l4.61"></a><span id="l4.61"> }</span>
<a href="#l4.62"></a><span id="l4.62"> // } ----- end file methods -----</span>
<a href="#l4.63"></a><span id="l4.63"> </span>
<a href="#l4.64"></a><span id="l4.64"> // { ----- begin env methods -----</span>
<a href="#l4.65"></a><span id="l4.65"> NS_IMETHODIMP</span>
<a href="#l4.66"></a><span id="l4.66"> morkFactory::MakeEnv(nsIMdbHeap* ioHeap, nsIMdbEnv** acqEnv)</span>
<a href="#l4.67"></a><span id="l4.67"> // ioHeap can be nil, causing a MakeHeap() style heap instance to be used</span>
<a href="#l4.68"></a><span id="l4.68"> {</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.71"></a><span id="l4.71">   nsIMdbEnv* outEnv = 0;</span>
<a href="#l4.72"></a><span id="l4.72">   mork_bool ownsHeap = (ioHeap == 0);</span>
<a href="#l4.73"></a><span id="l4.73">   if ( !ioHeap )</span>
<a href="#l4.74"></a><span id="l4.74">     ioHeap = new orkinHeap();</span>
<a href="#l4.75"></a><span id="l4.75"> </span>
<a href="#l4.76"></a><span id="l4.76">   if ( acqEnv &amp;&amp; ioHeap )</span>
<a href="#l4.77"></a><span id="l4.77">   {</span>
<a href="#l4.78"></a><span id="l4.78">     morkEnv* fenv = this-&gt;GetInternalFactoryEnv(&amp;outErr);</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineat">@@ -268,17 +268,17 @@ morkFactory::MakeEnv(nsIMdbHeap* ioHeap,</span>
<a href="#l4.80"></a><span id="l4.80">   return outErr;</span>
<a href="#l4.81"></a><span id="l4.81"> }</span>
<a href="#l4.82"></a><span id="l4.82"> // } ----- end env methods -----</span>
<a href="#l4.83"></a><span id="l4.83"> </span>
<a href="#l4.84"></a><span id="l4.84"> // { ----- begin heap methods -----</span>
<a href="#l4.85"></a><span id="l4.85"> NS_IMETHODIMP</span>
<a href="#l4.86"></a><span id="l4.86"> morkFactory::MakeHeap(nsIMdbEnv* mev, nsIMdbHeap** acqHeap)</span>
<a href="#l4.87"></a><span id="l4.87"> {</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.90"></a><span id="l4.90">   nsIMdbHeap* outHeap = 0;</span>
<a href="#l4.91"></a><span id="l4.91">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.92"></a><span id="l4.92">   if ( ev )</span>
<a href="#l4.93"></a><span id="l4.93">   {</span>
<a href="#l4.94"></a><span id="l4.94">     outHeap = new orkinHeap();</span>
<a href="#l4.95"></a><span id="l4.95">     if ( !outHeap )</span>
<a href="#l4.96"></a><span id="l4.96">       ev-&gt;OutOfMemoryError();</span>
<a href="#l4.97"></a><span id="l4.97">   }</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineat">@@ -305,17 +305,17 @@ NS_IMETHODIMP</span>
<a href="#l4.99"></a><span id="l4.99"> morkFactory::CanOpenFilePort(</span>
<a href="#l4.100"></a><span id="l4.100">   nsIMdbEnv* mev, // context</span>
<a href="#l4.101"></a><span id="l4.101">   // const char* inFilePath, // the file to investigate</span>
<a href="#l4.102"></a><span id="l4.102">   // const mdbYarn* inFirst512Bytes,</span>
<a href="#l4.103"></a><span id="l4.103">   nsIMdbFile* ioFile, // db abstract file interface</span>
<a href="#l4.104"></a><span id="l4.104">   mdb_bool* outCanOpen, // whether OpenFilePort() might succeed</span>
<a href="#l4.105"></a><span id="l4.105">   mdbYarn* outFormatVersion)</span>
<a href="#l4.106"></a><span id="l4.106"> {</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.109"></a><span id="l4.109">   if ( outFormatVersion )</span>
<a href="#l4.110"></a><span id="l4.110">   {</span>
<a href="#l4.111"></a><span id="l4.111">     outFormatVersion-&gt;mYarn_Fill = 0;</span>
<a href="#l4.112"></a><span id="l4.112">   }</span>
<a href="#l4.113"></a><span id="l4.113">   mdb_bool canOpenAsPort = morkBool_kFalse;</span>
<a href="#l4.114"></a><span id="l4.114">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.115"></a><span id="l4.115">   if ( ev )</span>
<a href="#l4.116"></a><span id="l4.116">   {</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineat">@@ -341,17 +341,17 @@ morkFactory::OpenFilePort(</span>
<a href="#l4.118"></a><span id="l4.118">   nsIMdbHeap* ioHeap, // can be nil to cause ev's heap attribute to be used</span>
<a href="#l4.119"></a><span id="l4.119">   // const char* inFilePath, // the file to open for readonly import</span>
<a href="#l4.120"></a><span id="l4.120">   nsIMdbFile* ioFile, // db abstract file interface</span>
<a href="#l4.121"></a><span id="l4.121">   const mdbOpenPolicy* inOpenPolicy, // runtime policies for using db</span>
<a href="#l4.122"></a><span id="l4.122">   nsIMdbThumb** acqThumb)</span>
<a href="#l4.123"></a><span id="l4.123"> {</span>
<a href="#l4.124"></a><span id="l4.124">   NS_ASSERTION(false, &quot;this doesn't look implemented&quot;);</span>
<a href="#l4.125"></a><span id="l4.125">   MORK_USED_1(ioHeap);</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.128"></a><span id="l4.128">   nsIMdbThumb* outThumb = 0;</span>
<a href="#l4.129"></a><span id="l4.129">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.130"></a><span id="l4.130">    if ( ev )</span>
<a href="#l4.131"></a><span id="l4.131">   {</span>
<a href="#l4.132"></a><span id="l4.132">     if ( ioFile &amp;&amp; inOpenPolicy &amp;&amp; acqThumb )</span>
<a href="#l4.133"></a><span id="l4.133">     {</span>
<a href="#l4.134"></a><span id="l4.134">     }</span>
<a href="#l4.135"></a><span id="l4.135">     else</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineat">@@ -367,17 +367,17 @@ morkFactory::OpenFilePort(</span>
<a href="#l4.137"></a><span id="l4.137"> // then call nsIMdbFactory::ThumbToOpenPort() to get the port instance.</span>
<a href="#l4.138"></a><span id="l4.138"> </span>
<a href="#l4.139"></a><span id="l4.139"> NS_IMETHODIMP</span>
<a href="#l4.140"></a><span id="l4.140"> morkFactory::ThumbToOpenPort( // redeeming a completed thumb from OpenFilePort()</span>
<a href="#l4.141"></a><span id="l4.141">   nsIMdbEnv* mev, // context</span>
<a href="#l4.142"></a><span id="l4.142">   nsIMdbThumb* ioThumb, // thumb from OpenFilePort() with done status</span>
<a href="#l4.143"></a><span id="l4.143">   nsIMdbPort** acqPort)</span>
<a href="#l4.144"></a><span id="l4.144"> {</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.147"></a><span id="l4.147">   nsIMdbPort* outPort = 0;</span>
<a href="#l4.148"></a><span id="l4.148">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.149"></a><span id="l4.149">   if ( ev )</span>
<a href="#l4.150"></a><span id="l4.150">   {</span>
<a href="#l4.151"></a><span id="l4.151">     if ( ioThumb &amp;&amp; acqPort )</span>
<a href="#l4.152"></a><span id="l4.152">     {</span>
<a href="#l4.153"></a><span id="l4.153">       morkThumb* thumb = (morkThumb*) ioThumb;</span>
<a href="#l4.154"></a><span id="l4.154">       morkStore* store = thumb-&gt;ThumbToOpenStore(ev);</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineat">@@ -452,17 +452,17 @@ morkFactory::CanOpenFileStore(</span>
<a href="#l4.156"></a><span id="l4.156">   mdbYarn* outFormatVersion)</span>
<a href="#l4.157"></a><span id="l4.157"> {</span>
<a href="#l4.158"></a><span id="l4.158">   mdb_bool canOpenAsStore = morkBool_kFalse;</span>
<a href="#l4.159"></a><span id="l4.159">   mdb_bool canOpenAsPort = morkBool_kFalse;</span>
<a href="#l4.160"></a><span id="l4.160">   if ( outFormatVersion )</span>
<a href="#l4.161"></a><span id="l4.161">   {</span>
<a href="#l4.162"></a><span id="l4.162">     outFormatVersion-&gt;mYarn_Fill = 0;</span>
<a href="#l4.163"></a><span id="l4.163">   }</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.166"></a><span id="l4.166">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.167"></a><span id="l4.167">   if ( ev )</span>
<a href="#l4.168"></a><span id="l4.168">   {</span>
<a href="#l4.169"></a><span id="l4.169">     if ( ioFile &amp;&amp; outCanOpenAsStore )</span>
<a href="#l4.170"></a><span id="l4.170">     {</span>
<a href="#l4.171"></a><span id="l4.171">       // right now always say true; later we should look for magic patterns</span>
<a href="#l4.172"></a><span id="l4.172">       canOpenAsStore = this-&gt;CanOpenMorkTextFile(ev, ioFile);</span>
<a href="#l4.173"></a><span id="l4.173">       canOpenAsPort = canOpenAsStore;</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineat">@@ -485,17 +485,17 @@ NS_IMETHODIMP</span>
<a href="#l4.175"></a><span id="l4.175"> morkFactory::OpenFileStore( // open an existing database</span>
<a href="#l4.176"></a><span id="l4.176">   nsIMdbEnv* mev, // context</span>
<a href="#l4.177"></a><span id="l4.177">   nsIMdbHeap* ioHeap, // can be nil to cause ev's heap attribute to be used</span>
<a href="#l4.178"></a><span id="l4.178">   // const char* inFilePath, // the file to open for general db usage</span>
<a href="#l4.179"></a><span id="l4.179">   nsIMdbFile* ioFile, // db abstract file interface</span>
<a href="#l4.180"></a><span id="l4.180">   const mdbOpenPolicy* inOpenPolicy, // runtime policies for using db</span>
<a href="#l4.181"></a><span id="l4.181">   nsIMdbThumb** acqThumb)</span>
<a href="#l4.182"></a><span id="l4.182"> {</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.185"></a><span id="l4.185">   nsIMdbThumb* outThumb = 0;</span>
<a href="#l4.186"></a><span id="l4.186">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.187"></a><span id="l4.187">   if ( ev )</span>
<a href="#l4.188"></a><span id="l4.188">   {</span>
<a href="#l4.189"></a><span id="l4.189">     if ( !ioHeap ) // need to use heap from env?</span>
<a href="#l4.190"></a><span id="l4.190">       ioHeap = ev-&gt;mEnv_Heap;</span>
<a href="#l4.191"></a><span id="l4.191">     </span>
<a href="#l4.192"></a><span id="l4.192">     if ( ioFile &amp;&amp; inOpenPolicy &amp;&amp; acqThumb )</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineat">@@ -531,17 +531,17 @@ morkFactory::OpenFileStore( // open an e</span>
<a href="#l4.194"></a><span id="l4.194"> // then call nsIMdbFactory::ThumbToOpenStore() to get the store instance.</span>
<a href="#l4.195"></a><span id="l4.195">   </span>
<a href="#l4.196"></a><span id="l4.196"> NS_IMETHODIMP</span>
<a href="#l4.197"></a><span id="l4.197"> morkFactory::ThumbToOpenStore( // redeem completed thumb from OpenFileStore()</span>
<a href="#l4.198"></a><span id="l4.198">   nsIMdbEnv* mev, // context</span>
<a href="#l4.199"></a><span id="l4.199">   nsIMdbThumb* ioThumb, // thumb from OpenFileStore() with done status</span>
<a href="#l4.200"></a><span id="l4.200">   nsIMdbStore** acqStore)</span>
<a href="#l4.201"></a><span id="l4.201"> {</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.204"></a><span id="l4.204">   nsIMdbStore* outStore = 0;</span>
<a href="#l4.205"></a><span id="l4.205">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.206"></a><span id="l4.206">   if ( ev )</span>
<a href="#l4.207"></a><span id="l4.207">   {</span>
<a href="#l4.208"></a><span id="l4.208">     if ( ioThumb &amp;&amp; acqStore )</span>
<a href="#l4.209"></a><span id="l4.209">     {</span>
<a href="#l4.210"></a><span id="l4.210">       morkThumb* thumb = (morkThumb*) ioThumb;</span>
<a href="#l4.211"></a><span id="l4.211">       morkStore* store = thumb-&gt;ThumbToOpenStore(ev);</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineat">@@ -569,17 +569,17 @@ NS_IMETHODIMP</span>
<a href="#l4.213"></a><span id="l4.213"> morkFactory::CreateNewFileStore( // create a new db with minimal content</span>
<a href="#l4.214"></a><span id="l4.214">   nsIMdbEnv* mev, // context</span>
<a href="#l4.215"></a><span id="l4.215">   nsIMdbHeap* ioHeap, // can be nil to cause ev's heap attribute to be used</span>
<a href="#l4.216"></a><span id="l4.216">   // const char* inFilePath, // name of file which should not yet exist</span>
<a href="#l4.217"></a><span id="l4.217">   nsIMdbFile* ioFile, // db abstract file interface</span>
<a href="#l4.218"></a><span id="l4.218">   const mdbOpenPolicy* inOpenPolicy, // runtime policies for using db</span>
<a href="#l4.219"></a><span id="l4.219">   nsIMdbStore** acqStore)</span>
<a href="#l4.220"></a><span id="l4.220"> {</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l4.223"></a><span id="l4.223">   nsIMdbStore* outStore = 0;</span>
<a href="#l4.224"></a><span id="l4.224">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l4.225"></a><span id="l4.225">   if ( ev )</span>
<a href="#l4.226"></a><span id="l4.226">   {</span>
<a href="#l4.227"></a><span id="l4.227">     if ( !ioHeap ) // need to use heap from env?</span>
<a href="#l4.228"></a><span id="l4.228">       ioHeap = ev-&gt;mEnv_Heap;</span>
<a href="#l4.229"></a><span id="l4.229">     </span>
<a href="#l4.230"></a><span id="l4.230">     if ( ioFile &amp;&amp; inOpenPolicy &amp;&amp; acqStore &amp;&amp; ioHeap )</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/db/mork/src/morkFactory.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/db/mork/src/morkFactory.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -180,17 +180,17 @@ private: // copying is not allowed</span>
<a href="#l5.4"></a><span id="l5.4"> public: // dynamic type identification</span>
<a href="#l5.5"></a><span id="l5.5">   mork_bool IsFactory() const</span>
<a href="#l5.6"></a><span id="l5.6">   { return IsNode() &amp;&amp; mNode_Derived == morkDerived_kFactory; }</span>
<a href="#l5.7"></a><span id="l5.7"> // } ===== end morkNode methods =====</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> public: // other factory methods</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">   void NonFactoryTypeError(morkEnv* ev);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  morkEnv* GetInternalFactoryEnv(mdb_err* outErr);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  morkEnv* GetInternalFactoryEnv(nsresult* outErr);</span>
<a href="#l5.14"></a><span id="l5.14">   mork_bool CanOpenMorkTextFile(morkEnv* ev, nsIMdbFile* ioFile);</span>
<a href="#l5.15"></a><span id="l5.15">   </span>
<a href="#l5.16"></a><span id="l5.16"> public: // typesafe refcounting inlines calling inherited morkNode methods</span>
<a href="#l5.17"></a><span id="l5.17">   static void SlotWeakFactory(morkFactory* me,</span>
<a href="#l5.18"></a><span id="l5.18">     morkEnv* ev, morkFactory** ioSlot)</span>
<a href="#l5.19"></a><span id="l5.19">   { morkNode::SlotWeakNode((morkNode*) me, ev, (morkNode**) ioSlot); }</span>
<a href="#l5.20"></a><span id="l5.20">   </span>
<a href="#l5.21"></a><span id="l5.21">   static void SlotStrongFactory(morkFactory* me,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/db/mork/src/morkFile.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/db/mork/src/morkFile.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -255,17 +255,17 @@ morkFile::WriteNewlines(morkEnv* ev, mor</span>
<a href="#l6.4"></a><span id="l6.4">     inNewlines -= quantum;</span>
<a href="#l6.5"></a><span id="l6.5">   }</span>
<a href="#l6.6"></a><span id="l6.6">   return outSize;</span>
<a href="#l6.7"></a><span id="l6.7"> }</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> NS_IMETHODIMP</span>
<a href="#l6.10"></a><span id="l6.10"> morkFile::Eof(nsIMdbEnv* mev, mdb_pos* outPos)</span>
<a href="#l6.11"></a><span id="l6.11"> {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l6.14"></a><span id="l6.14">   mdb_pos pos = -1;</span>
<a href="#l6.15"></a><span id="l6.15">   morkEnv *ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l6.16"></a><span id="l6.16">   pos = Length(ev);</span>
<a href="#l6.17"></a><span id="l6.17">   outErr = ev-&gt;AsErr();</span>
<a href="#l6.18"></a><span id="l6.18">   if ( outPos )</span>
<a href="#l6.19"></a><span id="l6.19">     *outPos = pos;</span>
<a href="#l6.20"></a><span id="l6.20">   return outErr;</span>
<a href="#l6.21"></a><span id="l6.21"> }</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -285,17 +285,17 @@ morkFile::Get(nsIMdbEnv* mev, void* outB</span>
<a href="#l6.23"></a><span id="l6.23">   }</span>
<a href="#l6.24"></a><span id="l6.24">   return rv;</span>
<a href="#l6.25"></a><span id="l6.25"> }</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27"> NS_IMETHODIMP</span>
<a href="#l6.28"></a><span id="l6.28"> morkFile::Put(nsIMdbEnv* mev, const void* inBuf, mdb_size inSize,</span>
<a href="#l6.29"></a><span id="l6.29">   mdb_pos inPos, mdb_size* outActualSize)</span>
<a href="#l6.30"></a><span id="l6.30"> {</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l6.33"></a><span id="l6.33">   *outActualSize = 0;</span>
<a href="#l6.34"></a><span id="l6.34">   morkEnv *ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l6.35"></a><span id="l6.35">   if ( ev )</span>
<a href="#l6.36"></a><span id="l6.36">   {</span>
<a href="#l6.37"></a><span id="l6.37">     mdb_pos outPos;</span>
<a href="#l6.38"></a><span id="l6.38"> </span>
<a href="#l6.39"></a><span id="l6.39">     Seek(mev, inPos, &amp;outPos);</span>
<a href="#l6.40"></a><span id="l6.40">     if ( ev-&gt;Good() )</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineat">@@ -304,17 +304,17 @@ morkFile::Put(nsIMdbEnv* mev, const void</span>
<a href="#l6.42"></a><span id="l6.42">   }</span>
<a href="#l6.43"></a><span id="l6.43">   return outErr;</span>
<a href="#l6.44"></a><span id="l6.44"> }</span>
<a href="#l6.45"></a><span id="l6.45"> </span>
<a href="#l6.46"></a><span id="l6.46"> // { ----- begin path methods -----</span>
<a href="#l6.47"></a><span id="l6.47"> NS_IMETHODIMP</span>
<a href="#l6.48"></a><span id="l6.48"> morkFile::Path(nsIMdbEnv* mev, mdbYarn* outFilePath)</span>
<a href="#l6.49"></a><span id="l6.49"> {</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l6.52"></a><span id="l6.52">   if ( outFilePath )</span>
<a href="#l6.53"></a><span id="l6.53">     outFilePath-&gt;mYarn_Fill = 0;</span>
<a href="#l6.54"></a><span id="l6.54">   morkEnv *ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l6.55"></a><span id="l6.55">   if ( ev )</span>
<a href="#l6.56"></a><span id="l6.56">   {</span>
<a href="#l6.57"></a><span id="l6.57">     ev-&gt;StringToYarn(GetFileNameString(), outFilePath);</span>
<a href="#l6.58"></a><span id="l6.58">     outErr = ev-&gt;AsErr();</span>
<a href="#l6.59"></a><span id="l6.59">   }</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineat">@@ -324,17 +324,17 @@ morkFile::Path(nsIMdbEnv* mev, mdbYarn* </span>
<a href="#l6.61"></a><span id="l6.61"> // } ----- end path methods -----</span>
<a href="#l6.62"></a><span id="l6.62">   </span>
<a href="#l6.63"></a><span id="l6.63"> // { ----- begin replacement methods -----</span>
<a href="#l6.64"></a><span id="l6.64"> </span>
<a href="#l6.65"></a><span id="l6.65"> </span>
<a href="#l6.66"></a><span id="l6.66"> NS_IMETHODIMP</span>
<a href="#l6.67"></a><span id="l6.67"> morkFile::Thief(nsIMdbEnv* mev, nsIMdbFile** acqThief)</span>
<a href="#l6.68"></a><span id="l6.68"> {</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l6.71"></a><span id="l6.71">   nsIMdbFile* outThief = 0;</span>
<a href="#l6.72"></a><span id="l6.72">   morkEnv *ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l6.73"></a><span id="l6.73">   if ( ev )</span>
<a href="#l6.74"></a><span id="l6.74">   {</span>
<a href="#l6.75"></a><span id="l6.75">     outThief = GetThief();</span>
<a href="#l6.76"></a><span id="l6.76">     NS_IF_ADDREF(outThief);</span>
<a href="#l6.77"></a><span id="l6.77">     outErr = ev-&gt;AsErr();</span>
<a href="#l6.78"></a><span id="l6.78">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/db/mork/src/morkHandle.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/db/mork/src/morkHandle.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -197,17 +197,17 @@ morkObject* morkHandle::GetGoodHandleObj</span>
<a href="#l7.4"></a><span id="l7.4">   </span>
<a href="#l7.5"></a><span id="l7.5">   MORK_ASSERT(outObject || inClosedOkay);</span>
<a href="#l7.6"></a><span id="l7.6">   return outObject;</span>
<a href="#l7.7"></a><span id="l7.7"> }</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10"> morkEnv*</span>
<a href="#l7.11"></a><span id="l7.11"> morkHandle::CanUseHandle(nsIMdbEnv* mev, mork_bool inMutable,</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  mork_bool inClosedOkay, mdb_err* outErr) const</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+                         mork_bool inClosedOkay, nsresult* outErr) const</span>
<a href="#l7.14"></a><span id="l7.14"> {</span>
<a href="#l7.15"></a><span id="l7.15">   morkEnv* outEnv = 0;</span>
<a href="#l7.16"></a><span id="l7.16">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l7.17"></a><span id="l7.17">   if ( ev )</span>
<a href="#l7.18"></a><span id="l7.18">   {</span>
<a href="#l7.19"></a><span id="l7.19">     morkObject* obj = this-&gt;GetGoodHandleObject(ev, inMutable,</span>
<a href="#l7.20"></a><span id="l7.20">       /*magic*/ 0, inClosedOkay);</span>
<a href="#l7.21"></a><span id="l7.21">     if ( obj )</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -218,20 +218,20 @@ morkHandle::CanUseHandle(nsIMdbEnv* mev,</span>
<a href="#l7.23"></a><span id="l7.23">   }</span>
<a href="#l7.24"></a><span id="l7.24">   MORK_ASSERT(outEnv || inClosedOkay);</span>
<a href="#l7.25"></a><span id="l7.25">   return outEnv;</span>
<a href="#l7.26"></a><span id="l7.26"> }</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28"> // { ===== begin nsIMdbObject methods =====</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30"> // { ----- begin attribute methods -----</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.33"></a><span id="l7.33"> morkHandle::Handle_IsFrozenMdbObject(nsIMdbEnv* mev, mdb_bool* outIsReadonly)</span>
<a href="#l7.34"></a><span id="l7.34"> {</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.37"></a><span id="l7.37">   mdb_bool readOnly = mdbBool_kTrue;</span>
<a href="#l7.38"></a><span id="l7.38">   </span>
<a href="#l7.39"></a><span id="l7.39">   morkEnv* ev = CanUseHandle(mev, /*inMutable*/ morkBool_kFalse,</span>
<a href="#l7.40"></a><span id="l7.40">     /*inClosedOkay*/ morkBool_kTrue, &amp;outErr);</span>
<a href="#l7.41"></a><span id="l7.41">   if ( ev )</span>
<a href="#l7.42"></a><span id="l7.42">   {</span>
<a href="#l7.43"></a><span id="l7.43">     readOnly = mHandle_Object-&gt;IsFrozen();</span>
<a href="#l7.44"></a><span id="l7.44">     </span>
<a href="#l7.45"></a><span id="l7.45" class="difflineat">@@ -242,20 +242,20 @@ morkHandle::Handle_IsFrozenMdbObject(nsI</span>
<a href="#l7.46"></a><span id="l7.46">     *outIsReadonly = readOnly;</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48">   return outErr;</span>
<a href="#l7.49"></a><span id="l7.49"> }</span>
<a href="#l7.50"></a><span id="l7.50"> // same as nsIMdbPort::GetIsPortReadonly() when this object is inside a port.</span>
<a href="#l7.51"></a><span id="l7.51"> // } ----- end attribute methods -----</span>
<a href="#l7.52"></a><span id="l7.52"> </span>
<a href="#l7.53"></a><span id="l7.53"> // { ----- begin factory methods -----</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.56"></a><span id="l7.56"> morkHandle::Handle_GetMdbFactory(nsIMdbEnv* mev, nsIMdbFactory** acqFactory)</span>
<a href="#l7.57"></a><span id="l7.57"> {</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.60"></a><span id="l7.60">   nsIMdbFactory* handle = 0;</span>
<a href="#l7.61"></a><span id="l7.61">   </span>
<a href="#l7.62"></a><span id="l7.62">   morkEnv* ev = CanUseHandle(mev, /*inMutable*/ morkBool_kFalse,</span>
<a href="#l7.63"></a><span id="l7.63">     /*inClosedOkay*/ morkBool_kTrue, &amp;outErr);</span>
<a href="#l7.64"></a><span id="l7.64">   if ( ev )</span>
<a href="#l7.65"></a><span id="l7.65">   {</span>
<a href="#l7.66"></a><span id="l7.66">     morkFactory* factory = ev-&gt;mEnv_Factory;</span>
<a href="#l7.67"></a><span id="l7.67">     if ( factory )</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineat">@@ -273,42 +273,42 @@ morkHandle::Handle_GetMdbFactory(nsIMdbE</span>
<a href="#l7.69"></a><span id="l7.69">   if ( acqFactory )</span>
<a href="#l7.70"></a><span id="l7.70">     *acqFactory = handle;</span>
<a href="#l7.71"></a><span id="l7.71"> </span>
<a href="#l7.72"></a><span id="l7.72">   return outErr;</span>
<a href="#l7.73"></a><span id="l7.73"> } </span>
<a href="#l7.74"></a><span id="l7.74"> // } ----- end factory methods -----</span>
<a href="#l7.75"></a><span id="l7.75"> </span>
<a href="#l7.76"></a><span id="l7.76"> // { ----- begin ref counting for well-behaved cyclic graphs -----</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.79"></a><span id="l7.79"> morkHandle::Handle_GetWeakRefCount(nsIMdbEnv* mev, // weak refs</span>
<a href="#l7.80"></a><span id="l7.80">   mdb_count* outCount)</span>
<a href="#l7.81"></a><span id="l7.81"> {</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.84"></a><span id="l7.84">   mdb_count count = 0;</span>
<a href="#l7.85"></a><span id="l7.85">   </span>
<a href="#l7.86"></a><span id="l7.86">   morkEnv* ev = CanUseHandle(mev, /*inMutable*/ morkBool_kFalse,</span>
<a href="#l7.87"></a><span id="l7.87">     /*inClosedOkay*/ morkBool_kTrue, &amp;outErr);</span>
<a href="#l7.88"></a><span id="l7.88">   if ( ev )</span>
<a href="#l7.89"></a><span id="l7.89">   {</span>
<a href="#l7.90"></a><span id="l7.90">     count = this-&gt;WeakRefsOnly();</span>
<a href="#l7.91"></a><span id="l7.91">     </span>
<a href="#l7.92"></a><span id="l7.92">     outErr = ev-&gt;AsErr();</span>
<a href="#l7.93"></a><span id="l7.93">   }</span>
<a href="#l7.94"></a><span id="l7.94">   MORK_ASSERT(outCount);</span>
<a href="#l7.95"></a><span id="l7.95">   if ( outCount )</span>
<a href="#l7.96"></a><span id="l7.96">     *outCount = count;</span>
<a href="#l7.97"></a><span id="l7.97">     </span>
<a href="#l7.98"></a><span id="l7.98">   return outErr;</span>
<a href="#l7.99"></a><span id="l7.99"> }  </span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.102"></a><span id="l7.102"> morkHandle::Handle_GetStrongRefCount(nsIMdbEnv* mev, // strong refs</span>
<a href="#l7.103"></a><span id="l7.103">   mdb_count* outCount)</span>
<a href="#l7.104"></a><span id="l7.104"> {</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.107"></a><span id="l7.107">   mdb_count count = 0;</span>
<a href="#l7.108"></a><span id="l7.108">   </span>
<a href="#l7.109"></a><span id="l7.109">   morkEnv* ev = CanUseHandle(mev, /*inMutable*/ morkBool_kFalse,</span>
<a href="#l7.110"></a><span id="l7.110">     /*inClosedOkay*/ morkBool_kTrue, &amp;outErr);</span>
<a href="#l7.111"></a><span id="l7.111">   if ( ev )</span>
<a href="#l7.112"></a><span id="l7.112">   {</span>
<a href="#l7.113"></a><span id="l7.113">     count = this-&gt;StrongRefsOnly();</span>
<a href="#l7.114"></a><span id="l7.114">     </span>
<a href="#l7.115"></a><span id="l7.115" class="difflineat">@@ -316,86 +316,86 @@ morkHandle::Handle_GetStrongRefCount(nsI</span>
<a href="#l7.116"></a><span id="l7.116">   }</span>
<a href="#l7.117"></a><span id="l7.117">   MORK_ASSERT(outCount);</span>
<a href="#l7.118"></a><span id="l7.118">   if ( outCount )</span>
<a href="#l7.119"></a><span id="l7.119">     *outCount = count;</span>
<a href="#l7.120"></a><span id="l7.120">     </span>
<a href="#l7.121"></a><span id="l7.121">   return outErr;</span>
<a href="#l7.122"></a><span id="l7.122"> }</span>
<a href="#l7.123"></a><span id="l7.123"> </span>
<a href="#l7.124"></a><span id="l7.124" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.126"></a><span id="l7.126"> morkHandle::Handle_AddWeakRef(nsIMdbEnv* mev)</span>
<a href="#l7.127"></a><span id="l7.127"> {</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineminus">-  </span>
<a href="#l7.130"></a><span id="l7.130" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineplus">+</span>
<a href="#l7.132"></a><span id="l7.132">   morkEnv* ev = CanUseHandle(mev, /*inMutable*/ morkBool_kFalse,</span>
<a href="#l7.133"></a><span id="l7.133">     /*inClosedOkay*/ morkBool_kTrue, &amp;outErr);</span>
<a href="#l7.134"></a><span id="l7.134">   if ( ev )</span>
<a href="#l7.135"></a><span id="l7.135">   {</span>
<a href="#l7.136"></a><span id="l7.136">     this-&gt;AddWeakRef(ev);</span>
<a href="#l7.137"></a><span id="l7.137">     outErr = ev-&gt;AsErr();</span>
<a href="#l7.138"></a><span id="l7.138">   }</span>
<a href="#l7.139"></a><span id="l7.139">     </span>
<a href="#l7.140"></a><span id="l7.140">   return outErr;</span>
<a href="#l7.141"></a><span id="l7.141"> }</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.144"></a><span id="l7.144"> morkHandle::Handle_AddStrongRef(nsIMdbEnv* mev)</span>
<a href="#l7.145"></a><span id="l7.145"> {</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineminus">-  </span>
<a href="#l7.148"></a><span id="l7.148" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineplus">+</span>
<a href="#l7.150"></a><span id="l7.150">   morkEnv* ev = CanUseHandle(mev, /*inMutable*/ morkBool_kFalse,</span>
<a href="#l7.151"></a><span id="l7.151">     /*inClosedOkay*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l7.152"></a><span id="l7.152">   if ( ev )</span>
<a href="#l7.153"></a><span id="l7.153">   {</span>
<a href="#l7.154"></a><span id="l7.154">     this-&gt;AddStrongRef(ev);</span>
<a href="#l7.155"></a><span id="l7.155">     outErr = ev-&gt;AsErr();</span>
<a href="#l7.156"></a><span id="l7.156">   }</span>
<a href="#l7.157"></a><span id="l7.157">     </span>
<a href="#l7.158"></a><span id="l7.158">   return outErr;</span>
<a href="#l7.159"></a><span id="l7.159"> }</span>
<a href="#l7.160"></a><span id="l7.160"> </span>
<a href="#l7.161"></a><span id="l7.161" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.163"></a><span id="l7.163"> morkHandle::Handle_CutWeakRef(nsIMdbEnv* mev)</span>
<a href="#l7.164"></a><span id="l7.164"> {</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineminus">-  </span>
<a href="#l7.167"></a><span id="l7.167" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineplus">+</span>
<a href="#l7.169"></a><span id="l7.169">   morkEnv* ev = CanUseHandle(mev, /*inMutable*/ morkBool_kFalse,</span>
<a href="#l7.170"></a><span id="l7.170">     /*inClosedOkay*/ morkBool_kTrue, &amp;outErr);</span>
<a href="#l7.171"></a><span id="l7.171">   if ( ev )</span>
<a href="#l7.172"></a><span id="l7.172">   {</span>
<a href="#l7.173"></a><span id="l7.173">     this-&gt;CutWeakRef(ev);</span>
<a href="#l7.174"></a><span id="l7.174">     outErr = ev-&gt;AsErr();</span>
<a href="#l7.175"></a><span id="l7.175">   }</span>
<a href="#l7.176"></a><span id="l7.176">     </span>
<a href="#l7.177"></a><span id="l7.177">   return outErr;</span>
<a href="#l7.178"></a><span id="l7.178"> }</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.181"></a><span id="l7.181"> morkHandle::Handle_CutStrongRef(nsIMdbEnv* mev)</span>
<a href="#l7.182"></a><span id="l7.182"> {</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.185"></a><span id="l7.185">   morkEnv* ev = CanUseHandle(mev, /*inMutable*/ morkBool_kFalse,</span>
<a href="#l7.186"></a><span id="l7.186">     /*inClosedOkay*/ morkBool_kTrue, &amp;outErr);</span>
<a href="#l7.187"></a><span id="l7.187">   if ( ev )</span>
<a href="#l7.188"></a><span id="l7.188">   {</span>
<a href="#l7.189"></a><span id="l7.189">     this-&gt;CutStrongRef(ev);</span>
<a href="#l7.190"></a><span id="l7.190">     outErr = ev-&gt;AsErr();</span>
<a href="#l7.191"></a><span id="l7.191">   }</span>
<a href="#l7.192"></a><span id="l7.192">   return outErr;</span>
<a href="#l7.193"></a><span id="l7.193"> }</span>
<a href="#l7.194"></a><span id="l7.194"> </span>
<a href="#l7.195"></a><span id="l7.195" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.196"></a><span id="l7.196" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.197"></a><span id="l7.197"> morkHandle::Handle_CloseMdbObject(nsIMdbEnv* mev)</span>
<a href="#l7.198"></a><span id="l7.198"> // called at strong refs zero</span>
<a href="#l7.199"></a><span id="l7.199"> {</span>
<a href="#l7.200"></a><span id="l7.200">   // if only one ref, Handle_CutStrongRef will clean up better.</span>
<a href="#l7.201"></a><span id="l7.201">   if (mNode_Uses == 1)</span>
<a href="#l7.202"></a><span id="l7.202">     return Handle_CutStrongRef(mev);</span>
<a href="#l7.203"></a><span id="l7.203"> </span>
<a href="#l7.204"></a><span id="l7.204" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.205"></a><span id="l7.205" class="difflineminus">-  </span>
<a href="#l7.206"></a><span id="l7.206" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.207"></a><span id="l7.207" class="difflineplus">+</span>
<a href="#l7.208"></a><span id="l7.208">   if ( this-&gt;IsNode() &amp;&amp; this-&gt;IsOpenNode() )</span>
<a href="#l7.209"></a><span id="l7.209">   {</span>
<a href="#l7.210"></a><span id="l7.210">     morkEnv* ev = CanUseHandle(mev, /*inMutable*/ morkBool_kFalse,</span>
<a href="#l7.211"></a><span id="l7.211">     /*inClosedOkay*/ morkBool_kTrue, &amp;outErr);</span>
<a href="#l7.212"></a><span id="l7.212">     if ( ev )</span>
<a href="#l7.213"></a><span id="l7.213">     {</span>
<a href="#l7.214"></a><span id="l7.214">       morkObject* object = mHandle_Object;</span>
<a href="#l7.215"></a><span id="l7.215">       if ( object &amp;&amp; object-&gt;IsNode() &amp;&amp; object-&gt;IsOpenNode() )</span>
<a href="#l7.216"></a><span id="l7.216" class="difflineat">@@ -403,22 +403,22 @@ morkHandle::Handle_CloseMdbObject(nsIMdb</span>
<a href="#l7.217"></a><span id="l7.217">         </span>
<a href="#l7.218"></a><span id="l7.218">       this-&gt;CloseMorkNode(ev);</span>
<a href="#l7.219"></a><span id="l7.219">       outErr = ev-&gt;AsErr();</span>
<a href="#l7.220"></a><span id="l7.220">     }</span>
<a href="#l7.221"></a><span id="l7.221">   }</span>
<a href="#l7.222"></a><span id="l7.222">   return outErr;</span>
<a href="#l7.223"></a><span id="l7.223"> }</span>
<a href="#l7.224"></a><span id="l7.224"> </span>
<a href="#l7.225"></a><span id="l7.225" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l7.226"></a><span id="l7.226" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l7.227"></a><span id="l7.227"> morkHandle::Handle_IsOpenMdbObject(nsIMdbEnv* mev, mdb_bool* outOpen)</span>
<a href="#l7.228"></a><span id="l7.228"> {</span>
<a href="#l7.229"></a><span id="l7.229">   MORK_USED_1(mev);</span>
<a href="#l7.230"></a><span id="l7.230" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l7.231"></a><span id="l7.231" class="difflineminus">-  </span>
<a href="#l7.232"></a><span id="l7.232" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l7.233"></a><span id="l7.233" class="difflineplus">+</span>
<a href="#l7.234"></a><span id="l7.234">   MORK_ASSERT(outOpen);</span>
<a href="#l7.235"></a><span id="l7.235">   if ( outOpen )</span>
<a href="#l7.236"></a><span id="l7.236">     *outOpen = this-&gt;IsOpenNode();</span>
<a href="#l7.237"></a><span id="l7.237">       </span>
<a href="#l7.238"></a><span id="l7.238">   return outErr;</span>
<a href="#l7.239"></a><span id="l7.239"> }</span>
<a href="#l7.240"></a><span id="l7.240"> // } ----- end ref counting -----</span>
<a href="#l7.241"></a><span id="l7.241"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/db/mork/src/morkHandle.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/db/mork/src/morkHandle.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -105,33 +105,33 @@ public: // other handle methods</span>
<a href="#l8.4"></a><span id="l8.4">   void NonOpenObjectError(morkEnv* ev) const;</span>
<a href="#l8.5"></a><span id="l8.5">   </span>
<a href="#l8.6"></a><span id="l8.6">   morkObject* GetGoodHandleObject(morkEnv* ev,</span>
<a href="#l8.7"></a><span id="l8.7">     mork_bool inMutable, mork_magic inMagicType, mork_bool inClosedOkay) const;</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> public: // interface supporting mdbObject methods</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">   morkEnv* CanUseHandle(nsIMdbEnv* mev, mork_bool inMutable,</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    mork_bool inClosedOkay, mdb_err* outErr) const;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                        mork_bool inClosedOkay, nsresult* outErr) const;</span>
<a href="#l8.14"></a><span id="l8.14">     </span>
<a href="#l8.15"></a><span id="l8.15">   // { ----- begin mdbObject style methods -----</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-  mdb_err Handle_IsFrozenMdbObject(nsIMdbEnv* ev, mdb_bool* outIsReadonly);</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+  nsresult Handle_IsFrozenMdbObject(nsIMdbEnv* ev, mdb_bool* outIsReadonly);</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-  mdb_err Handle_GetMdbFactory(nsIMdbEnv* ev, nsIMdbFactory** acqFactory); </span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-  mdb_err Handle_GetWeakRefCount(nsIMdbEnv* ev,  mdb_count* outCount);  </span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-  mdb_err Handle_GetStrongRefCount(nsIMdbEnv* ev, mdb_count* outCount);</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+  nsresult Handle_GetMdbFactory(nsIMdbEnv* ev, nsIMdbFactory** acqFactory);</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+  nsresult Handle_GetWeakRefCount(nsIMdbEnv* ev,  mdb_count* outCount);</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+  nsresult Handle_GetStrongRefCount(nsIMdbEnv* ev, mdb_count* outCount);</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-  mdb_err Handle_AddWeakRef(nsIMdbEnv* ev);</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-  mdb_err Handle_AddStrongRef(nsIMdbEnv* ev);</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+  nsresult Handle_AddWeakRef(nsIMdbEnv* ev);</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+  nsresult Handle_AddStrongRef(nsIMdbEnv* ev);</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  mdb_err Handle_CutWeakRef(nsIMdbEnv* ev);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-  mdb_err Handle_CutStrongRef(nsIMdbEnv* ev);</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-  </span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-  mdb_err Handle_CloseMdbObject(nsIMdbEnv* ev);</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-  mdb_err Handle_IsOpenMdbObject(nsIMdbEnv* ev, mdb_bool* outOpen);</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+  nsresult Handle_CutWeakRef(nsIMdbEnv* ev);</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+  nsresult Handle_CutStrongRef(nsIMdbEnv* ev);</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  nsresult Handle_CloseMdbObject(nsIMdbEnv* ev);</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+  nsresult Handle_IsOpenMdbObject(nsIMdbEnv* ev, mdb_bool* outOpen);</span>
<a href="#l8.41"></a><span id="l8.41">   // } ----- end mdbObject style methods -----</span>
<a href="#l8.42"></a><span id="l8.42"> </span>
<a href="#l8.43"></a><span id="l8.43"> public: // typesafe refcounting inlines calling inherited morkNode methods</span>
<a href="#l8.44"></a><span id="l8.44">   static void SlotWeakHandle(morkHandle* me,</span>
<a href="#l8.45"></a><span id="l8.45">     morkEnv* ev, morkHandle** ioSlot)</span>
<a href="#l8.46"></a><span id="l8.46">   { morkNode::SlotWeakNode((morkNode*) me, ev, (morkNode**) ioSlot); }</span>
<a href="#l8.47"></a><span id="l8.47">   </span>
<a href="#l8.48"></a><span id="l8.48">   static void SlotStrongHandle(morkHandle* me,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/db/mork/src/morkNode.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/db/mork/src/morkNode.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -203,25 +203,25 @@ morkNode::CloseMorkNode(morkEnv* ev) // </span>
<a href="#l9.4"></a><span id="l9.4">   }</span>
<a href="#l9.5"></a><span id="l9.5"> }</span>
<a href="#l9.6"></a><span id="l9.6"> NS_IMETHODIMP</span>
<a href="#l9.7"></a><span id="l9.7"> morkNode::CloseMdbObject(nsIMdbEnv* mev)</span>
<a href="#l9.8"></a><span id="l9.8"> {</span>
<a href="#l9.9"></a><span id="l9.9">   return morkNode::CloseMdbObject((morkEnv *) mev);</span>
<a href="#l9.10"></a><span id="l9.10"> }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-mdb_err morkNode::CloseMdbObject(morkEnv *ev)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+nsresult morkNode::CloseMdbObject(morkEnv *ev)</span>
<a href="#l9.14"></a><span id="l9.14"> {</span>
<a href="#l9.15"></a><span id="l9.15">   // if only one ref, Handle_CutStrongRef will clean up better.</span>
<a href="#l9.16"></a><span id="l9.16">   if (mNode_Uses == 1)</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-    // XXX Casting mork_uses to mdb_err</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-    return static_cast&lt;mdb_err&gt;(CutStrongRef(ev));</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+    // XXX Casting mork_uses to nsresult</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+    return static_cast&lt;nsresult&gt;(CutStrongRef(ev));</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-  </span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+</span>
<a href="#l9.26"></a><span id="l9.26">   if ( IsNode() &amp;&amp; IsOpenNode() )</span>
<a href="#l9.27"></a><span id="l9.27">   {</span>
<a href="#l9.28"></a><span id="l9.28">     if ( ev )</span>
<a href="#l9.29"></a><span id="l9.29">     {</span>
<a href="#l9.30"></a><span id="l9.30">       CloseMorkNode(ev);</span>
<a href="#l9.31"></a><span id="l9.31">       outErr = ev-&gt;AsErr();</span>
<a href="#l9.32"></a><span id="l9.32">     }</span>
<a href="#l9.33"></a><span id="l9.33">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/db/mork/src/morkNode.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/db/mork/src/morkNode.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -178,17 +178,17 @@ public: // morkNode virtual methods</span>
<a href="#l10.4"></a><span id="l10.4">   // CloseMorkNode() should call a static close method specific to an object.</span>
<a href="#l10.5"></a><span id="l10.5">   // Each such static close method should either call inherited static close</span>
<a href="#l10.6"></a><span id="l10.6">   // methods, or else perform the consolidated effect of calling them, where</span>
<a href="#l10.7"></a><span id="l10.7">   // subclasses should closely track any changes in base classes with care.</span>
<a href="#l10.8"></a><span id="l10.8">   </span>
<a href="#l10.9"></a><span id="l10.9"> public: // morkNode construction</span>
<a href="#l10.10"></a><span id="l10.10">   morkNode(morkEnv* ev, const morkUsage&amp; inUsage, nsIMdbHeap* ioHeap);</span>
<a href="#l10.11"></a><span id="l10.11">   void CloseNode(morkEnv* ev); // called by CloseMorkNode();</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  mdb_err CloseMdbObject(morkEnv *ev);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  nsresult CloseMdbObject(morkEnv *ev);</span>
<a href="#l10.14"></a><span id="l10.14">   NS_IMETHOD CloseMdbObject(nsIMdbEnv *ev);</span>
<a href="#l10.15"></a><span id="l10.15"> private: // copying is not allowed</span>
<a href="#l10.16"></a><span id="l10.16">   morkNode(const morkNode&amp; other);</span>
<a href="#l10.17"></a><span id="l10.17">   morkNode&amp; operator=(const morkNode&amp; other);</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19"> public: // dynamic type identification</span>
<a href="#l10.20"></a><span id="l10.20">   mork_bool IsNode() const</span>
<a href="#l10.21"></a><span id="l10.21">   { return mNode_Base == morkBase_kNode; }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/db/mork/src/morkPortTableCursor.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/db/mork/src/morkPortTableCursor.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -84,18 +84,18 @@ morkPortTableCursor::morkPortTableCursor</span>
<a href="#l11.4"></a><span id="l11.4">     else</span>
<a href="#l11.5"></a><span id="l11.5">       ev-&gt;NilPointerError();</span>
<a href="#l11.6"></a><span id="l11.6">   }</span>
<a href="#l11.7"></a><span id="l11.7"> }</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> NS_IMPL_ISUPPORTS_INHERITED1(morkPortTableCursor, morkCursor, nsIMdbPortTableCursor)</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11"> morkEnv*</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-morkPortTableCursor::CanUsePortTableCursor(nsIMdbEnv* mev,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  mork_bool inMutable, mdb_err* outErr) const</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+morkPortTableCursor::CanUsePortTableCursor(nsIMdbEnv* mev, mork_bool inMutable,</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+                                           nsresult* outErr) const</span>
<a href="#l11.16"></a><span id="l11.16"> {</span>
<a href="#l11.17"></a><span id="l11.17">   morkEnv* outEnv = 0;</span>
<a href="#l11.18"></a><span id="l11.18">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l11.19"></a><span id="l11.19">   if ( ev )</span>
<a href="#l11.20"></a><span id="l11.20">   {</span>
<a href="#l11.21"></a><span id="l11.21">     if ( IsPortTableCursor() )</span>
<a href="#l11.22"></a><span id="l11.22">       outEnv = ev;</span>
<a href="#l11.23"></a><span id="l11.23">     else</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineat">@@ -321,17 +321,17 @@ morkPortTableCursor::SetPort(nsIMdbEnv* </span>
<a href="#l11.25"></a><span id="l11.25"> {</span>
<a href="#l11.26"></a><span id="l11.26">   NS_ASSERTION(false,&quot;not implemented&quot;);</span>
<a href="#l11.27"></a><span id="l11.27">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l11.28"></a><span id="l11.28"> }</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30"> NS_IMETHODIMP</span>
<a href="#l11.31"></a><span id="l11.31"> morkPortTableCursor::GetPort(nsIMdbEnv* mev, nsIMdbPort** acqPort)</span>
<a href="#l11.32"></a><span id="l11.32"> {</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l11.35"></a><span id="l11.35">   nsIMdbPort* outPort = 0;</span>
<a href="#l11.36"></a><span id="l11.36">   morkEnv* ev =</span>
<a href="#l11.37"></a><span id="l11.37">     this-&gt;CanUsePortTableCursor(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l11.38"></a><span id="l11.38">   if ( ev )</span>
<a href="#l11.39"></a><span id="l11.39">   {</span>
<a href="#l11.40"></a><span id="l11.40">     if ( mPortTableCursor_Store )</span>
<a href="#l11.41"></a><span id="l11.41">       outPort = mPortTableCursor_Store-&gt;AcquireStoreHandle(ev);</span>
<a href="#l11.42"></a><span id="l11.42">     outErr = ev-&gt;AsErr();</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineat">@@ -340,33 +340,33 @@ morkPortTableCursor::GetPort(nsIMdbEnv* </span>
<a href="#l11.44"></a><span id="l11.44">     *acqPort = outPort;</span>
<a href="#l11.45"></a><span id="l11.45">   return outErr;</span>
<a href="#l11.46"></a><span id="l11.46"> }</span>
<a href="#l11.47"></a><span id="l11.47"> </span>
<a href="#l11.48"></a><span id="l11.48"> NS_IMETHODIMP</span>
<a href="#l11.49"></a><span id="l11.49"> morkPortTableCursor::SetRowScope(nsIMdbEnv* mev, // sets pos to -1</span>
<a href="#l11.50"></a><span id="l11.50">   mdb_scope inRowScope)</span>
<a href="#l11.51"></a><span id="l11.51"> {</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l11.54"></a><span id="l11.54">   morkEnv* ev =</span>
<a href="#l11.55"></a><span id="l11.55">     this-&gt;CanUsePortTableCursor(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l11.56"></a><span id="l11.56">   if ( ev )</span>
<a href="#l11.57"></a><span id="l11.57">   {</span>
<a href="#l11.58"></a><span id="l11.58">     mCursor_Pos = -1;</span>
<a href="#l11.59"></a><span id="l11.59">     </span>
<a href="#l11.60"></a><span id="l11.60">     SetRowScope(ev, inRowScope);</span>
<a href="#l11.61"></a><span id="l11.61">     outErr = ev-&gt;AsErr();</span>
<a href="#l11.62"></a><span id="l11.62">   }</span>
<a href="#l11.63"></a><span id="l11.63">   return outErr;</span>
<a href="#l11.64"></a><span id="l11.64"> }</span>
<a href="#l11.65"></a><span id="l11.65"> </span>
<a href="#l11.66"></a><span id="l11.66"> NS_IMETHODIMP</span>
<a href="#l11.67"></a><span id="l11.67"> morkPortTableCursor::GetRowScope(nsIMdbEnv* mev, mdb_scope* outRowScope)</span>
<a href="#l11.68"></a><span id="l11.68"> {</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l11.71"></a><span id="l11.71">   mdb_scope rowScope = 0;</span>
<a href="#l11.72"></a><span id="l11.72">   morkEnv* ev =</span>
<a href="#l11.73"></a><span id="l11.73">     this-&gt;CanUsePortTableCursor(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l11.74"></a><span id="l11.74">   if ( ev )</span>
<a href="#l11.75"></a><span id="l11.75">   {</span>
<a href="#l11.76"></a><span id="l11.76">     rowScope = mPortTableCursor_RowScope;</span>
<a href="#l11.77"></a><span id="l11.77">     outErr = ev-&gt;AsErr();</span>
<a href="#l11.78"></a><span id="l11.78">   }</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineat">@@ -374,34 +374,34 @@ morkPortTableCursor::GetRowScope(nsIMdbE</span>
<a href="#l11.80"></a><span id="l11.80">   return outErr;</span>
<a href="#l11.81"></a><span id="l11.81"> }</span>
<a href="#l11.82"></a><span id="l11.82"> // setting row scope to zero iterates over all row scopes in port</span>
<a href="#l11.83"></a><span id="l11.83">   </span>
<a href="#l11.84"></a><span id="l11.84"> NS_IMETHODIMP</span>
<a href="#l11.85"></a><span id="l11.85"> morkPortTableCursor::SetTableKind(nsIMdbEnv* mev, // sets pos to -1</span>
<a href="#l11.86"></a><span id="l11.86">   mdb_kind inTableKind)</span>
<a href="#l11.87"></a><span id="l11.87"> {</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l11.90"></a><span id="l11.90">   morkEnv* ev =</span>
<a href="#l11.91"></a><span id="l11.91">     this-&gt;CanUsePortTableCursor(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l11.92"></a><span id="l11.92">   if ( ev )</span>
<a href="#l11.93"></a><span id="l11.93">   {</span>
<a href="#l11.94"></a><span id="l11.94">     mCursor_Pos = -1;</span>
<a href="#l11.95"></a><span id="l11.95">     </span>
<a href="#l11.96"></a><span id="l11.96">     SetTableKind(ev, inTableKind);</span>
<a href="#l11.97"></a><span id="l11.97">     outErr = ev-&gt;AsErr();</span>
<a href="#l11.98"></a><span id="l11.98">   }</span>
<a href="#l11.99"></a><span id="l11.99">   return outErr;</span>
<a href="#l11.100"></a><span id="l11.100"> }</span>
<a href="#l11.101"></a><span id="l11.101"> </span>
<a href="#l11.102"></a><span id="l11.102"> NS_IMETHODIMP</span>
<a href="#l11.103"></a><span id="l11.103"> morkPortTableCursor::GetTableKind(nsIMdbEnv* mev, mdb_kind* outTableKind)</span>
<a href="#l11.104"></a><span id="l11.104"> // setting table kind to zero iterates over all table kinds in row scope</span>
<a href="#l11.105"></a><span id="l11.105"> {</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l11.108"></a><span id="l11.108">   mdb_kind tableKind = 0;</span>
<a href="#l11.109"></a><span id="l11.109">   morkEnv* ev =</span>
<a href="#l11.110"></a><span id="l11.110">     this-&gt;CanUsePortTableCursor(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l11.111"></a><span id="l11.111">   if ( ev )</span>
<a href="#l11.112"></a><span id="l11.112">   {</span>
<a href="#l11.113"></a><span id="l11.113">     tableKind = mPortTableCursor_TableKind;</span>
<a href="#l11.114"></a><span id="l11.114">     outErr = ev-&gt;AsErr();</span>
<a href="#l11.115"></a><span id="l11.115">   }</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineat">@@ -411,17 +411,17 @@ morkPortTableCursor::GetTableKind(nsIMdb</span>
<a href="#l11.117"></a><span id="l11.117"> // } ----- end attribute methods -----</span>
<a href="#l11.118"></a><span id="l11.118"> </span>
<a href="#l11.119"></a><span id="l11.119"> // { ----- begin table iteration methods -----</span>
<a href="#l11.120"></a><span id="l11.120"> NS_IMETHODIMP</span>
<a href="#l11.121"></a><span id="l11.121"> morkPortTableCursor::NextTable( // get table at next position in the db</span>
<a href="#l11.122"></a><span id="l11.122">   nsIMdbEnv* mev, // context</span>
<a href="#l11.123"></a><span id="l11.123">   nsIMdbTable** acqTable)</span>
<a href="#l11.124"></a><span id="l11.124"> {</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l11.127"></a><span id="l11.127">   nsIMdbTable* outTable = 0;</span>
<a href="#l11.128"></a><span id="l11.128">   morkEnv* ev =</span>
<a href="#l11.129"></a><span id="l11.129">     CanUsePortTableCursor(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l11.130"></a><span id="l11.130">   if ( ev )</span>
<a href="#l11.131"></a><span id="l11.131">   {</span>
<a href="#l11.132"></a><span id="l11.132">     morkTable* table = NextTable(ev);</span>
<a href="#l11.133"></a><span id="l11.133">     if ( table &amp;&amp; ev-&gt;Good() )</span>
<a href="#l11.134"></a><span id="l11.134">       outTable = table-&gt;AcquireTableHandle(ev);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/db/mork/src/morkPortTableCursor.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/db/mork/src/morkPortTableCursor.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -109,20 +109,20 @@ protected: // utilities</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5">   void init_space_tables_map(morkEnv* ev);</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> public: // other cursor methods</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9">   static void NilCursorStoreError(morkEnv* ev);</span>
<a href="#l12.10"></a><span id="l12.10">   static void NonPortTableCursorTypeError(morkEnv* ev);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">- morkEnv* CanUsePortTableCursor(nsIMdbEnv* mev,</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-  mork_bool inMutable, mdb_err* outErr) const;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+ morkEnv* CanUsePortTableCursor(nsIMdbEnv* mev, mork_bool inMutable,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+                                nsresult* outErr) const;</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-  </span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+</span>
<a href="#l12.19"></a><span id="l12.19">   morkRowSpace* NextSpace(morkEnv* ev);</span>
<a href="#l12.20"></a><span id="l12.20">   morkTable* NextTable(morkEnv* ev);</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22">   mork_bool SetRowScope(morkEnv* ev, mork_scope inRowScope);</span>
<a href="#l12.23"></a><span id="l12.23">   mork_bool SetTableKind(morkEnv* ev, mork_kind inTableKind);</span>
<a href="#l12.24"></a><span id="l12.24"> </span>
<a href="#l12.25"></a><span id="l12.25"> public: // typesafe refcounting inlines calling inherited morkNode methods</span>
<a href="#l12.26"></a><span id="l12.26">   static void SlotWeakPortTableCursor(morkPortTableCursor* me,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/db/mork/src/morkRowCellCursor.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/db/mork/src/morkRowCellCursor.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -137,17 +137,17 @@ morkRowCellCursor::NonRowCellCursorTypeE</span>
<a href="#l13.4"></a><span id="l13.4"> }</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> //3456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789</span>
<a href="#l13.8"></a><span id="l13.8"> // { ----- begin attribute methods -----</span>
<a href="#l13.9"></a><span id="l13.9"> NS_IMETHODIMP</span>
<a href="#l13.10"></a><span id="l13.10"> morkRowCellCursor::SetRow(nsIMdbEnv* mev, nsIMdbRow* ioRow)</span>
<a href="#l13.11"></a><span id="l13.11"> {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l13.14"></a><span id="l13.14">   morkRow* row = 0;</span>
<a href="#l13.15"></a><span id="l13.15">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l13.16"></a><span id="l13.16">   if ( ev )</span>
<a href="#l13.17"></a><span id="l13.17">   {</span>
<a href="#l13.18"></a><span id="l13.18">     row = (morkRow *) ioRow;</span>
<a href="#l13.19"></a><span id="l13.19">     morkStore* store = row-&gt;GetRowSpaceStore(ev);</span>
<a href="#l13.20"></a><span id="l13.20">     if ( store )</span>
<a href="#l13.21"></a><span id="l13.21">     {</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -166,17 +166,17 @@ morkRowCellCursor::SetRow(nsIMdbEnv* mev</span>
<a href="#l13.23"></a><span id="l13.23">     outErr = ev-&gt;AsErr();</span>
<a href="#l13.24"></a><span id="l13.24">   }</span>
<a href="#l13.25"></a><span id="l13.25">   return outErr;</span>
<a href="#l13.26"></a><span id="l13.26"> }</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28"> NS_IMETHODIMP</span>
<a href="#l13.29"></a><span id="l13.29"> morkRowCellCursor::GetRow(nsIMdbEnv* mev, nsIMdbRow** acqRow)</span>
<a href="#l13.30"></a><span id="l13.30"> {</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l13.33"></a><span id="l13.33">   nsIMdbRow* outRow = 0;</span>
<a href="#l13.34"></a><span id="l13.34">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l13.35"></a><span id="l13.35">   if ( ev )</span>
<a href="#l13.36"></a><span id="l13.36">   {</span>
<a href="#l13.37"></a><span id="l13.37">     morkRowObject* rowObj = mRowCellCursor_RowObject;</span>
<a href="#l13.38"></a><span id="l13.38">     if ( rowObj )</span>
<a href="#l13.39"></a><span id="l13.39">       outRow = rowObj-&gt;AcquireRowHandle(ev);</span>
<a href="#l13.40"></a><span id="l13.40"> </span>
<a href="#l13.41"></a><span id="l13.41" class="difflineat">@@ -191,17 +191,17 @@ morkRowCellCursor::GetRow(nsIMdbEnv* mev</span>
<a href="#l13.42"></a><span id="l13.42"> // { ----- begin cell creation methods -----</span>
<a href="#l13.43"></a><span id="l13.43"> NS_IMETHODIMP</span>
<a href="#l13.44"></a><span id="l13.44"> morkRowCellCursor::MakeCell( // get cell at current pos in the row</span>
<a href="#l13.45"></a><span id="l13.45">   nsIMdbEnv* mev, // context</span>
<a href="#l13.46"></a><span id="l13.46">   mdb_column* outColumn, // column for this particular cell</span>
<a href="#l13.47"></a><span id="l13.47">   mdb_pos* outPos, // position of cell in row sequence</span>
<a href="#l13.48"></a><span id="l13.48">   nsIMdbCell** acqCell)</span>
<a href="#l13.49"></a><span id="l13.49"> {</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l13.52"></a><span id="l13.52">   nsIMdbCell* outCell = 0;</span>
<a href="#l13.53"></a><span id="l13.53">   mdb_pos pos = 0;</span>
<a href="#l13.54"></a><span id="l13.54">   mdb_column col = 0;</span>
<a href="#l13.55"></a><span id="l13.55">   morkRow* row = 0;</span>
<a href="#l13.56"></a><span id="l13.56">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l13.57"></a><span id="l13.57">   if ( ev )</span>
<a href="#l13.58"></a><span id="l13.58">   {</span>
<a href="#l13.59"></a><span id="l13.59">     pos = mCursor_Pos;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/db/mork/src/morkRowObject.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/db/mork/src/morkRowObject.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -88,44 +88,44 @@ morkRowObject::morkRowObject(morkEnv* ev</span>
<a href="#l14.4"></a><span id="l14.4"> NS_IMPL_ISUPPORTS_INHERITED1(morkRowObject, morkObject, nsIMdbRow)</span>
<a href="#l14.5"></a><span id="l14.5"> // { ===== begin nsIMdbCollection methods =====</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> // { ----- begin attribute methods -----</span>
<a href="#l14.8"></a><span id="l14.8"> NS_IMETHODIMP</span>
<a href="#l14.9"></a><span id="l14.9"> morkRowObject::GetSeed(nsIMdbEnv* mev,</span>
<a href="#l14.10"></a><span id="l14.10">   mdb_seed* outSeed)</span>
<a href="#l14.11"></a><span id="l14.11"> {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.14"></a><span id="l14.14">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.15"></a><span id="l14.15">   if ( ev )</span>
<a href="#l14.16"></a><span id="l14.16">   {</span>
<a href="#l14.17"></a><span id="l14.17">     *outSeed = (mdb_seed) mRowObject_Row-&gt;mRow_Seed;</span>
<a href="#l14.18"></a><span id="l14.18">     outErr = ev-&gt;AsErr();</span>
<a href="#l14.19"></a><span id="l14.19">   }</span>
<a href="#l14.20"></a><span id="l14.20">   return outErr;</span>
<a href="#l14.21"></a><span id="l14.21"> }</span>
<a href="#l14.22"></a><span id="l14.22"> NS_IMETHODIMP</span>
<a href="#l14.23"></a><span id="l14.23"> morkRowObject::GetCount(nsIMdbEnv* mev,</span>
<a href="#l14.24"></a><span id="l14.24">   mdb_count* outCount)</span>
<a href="#l14.25"></a><span id="l14.25"> {</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.28"></a><span id="l14.28">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.29"></a><span id="l14.29">   if ( ev )</span>
<a href="#l14.30"></a><span id="l14.30">   {</span>
<a href="#l14.31"></a><span id="l14.31">     *outCount = (mdb_count) mRowObject_Row-&gt;mRow_Length;</span>
<a href="#l14.32"></a><span id="l14.32">     outErr = ev-&gt;AsErr();</span>
<a href="#l14.33"></a><span id="l14.33">   }</span>
<a href="#l14.34"></a><span id="l14.34">   return outErr;</span>
<a href="#l14.35"></a><span id="l14.35"> }</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37"> NS_IMETHODIMP</span>
<a href="#l14.38"></a><span id="l14.38"> morkRowObject::GetPort(nsIMdbEnv* mev,</span>
<a href="#l14.39"></a><span id="l14.39">   nsIMdbPort** acqPort)</span>
<a href="#l14.40"></a><span id="l14.40"> {</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.43"></a><span id="l14.43">   nsIMdbPort* outPort = 0;</span>
<a href="#l14.44"></a><span id="l14.44">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.45"></a><span id="l14.45">   if ( ev )</span>
<a href="#l14.46"></a><span id="l14.46">   {</span>
<a href="#l14.47"></a><span id="l14.47">     morkRowSpace* rowSpace = mRowObject_Row-&gt;mRow_Space;</span>
<a href="#l14.48"></a><span id="l14.48">     if ( rowSpace &amp;&amp; rowSpace-&gt;mSpace_Store )</span>
<a href="#l14.49"></a><span id="l14.49">     {</span>
<a href="#l14.50"></a><span id="l14.50">       morkStore* store = mRowObject_Row-&gt;GetRowSpaceStore(ev);</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineat">@@ -192,17 +192,17 @@ morkRowObject::DropActivity( // tell col</span>
<a href="#l14.52"></a><span id="l14.52"> </span>
<a href="#l14.53"></a><span id="l14.53"> // { ----- begin cursor methods -----</span>
<a href="#l14.54"></a><span id="l14.54"> NS_IMETHODIMP</span>
<a href="#l14.55"></a><span id="l14.55"> morkRowObject::GetRowCellCursor( // make a cursor starting iteration at inCellPos</span>
<a href="#l14.56"></a><span id="l14.56">   nsIMdbEnv* mev, // context</span>
<a href="#l14.57"></a><span id="l14.57">   mdb_pos inPos, // zero-based ordinal position of cell in row</span>
<a href="#l14.58"></a><span id="l14.58">   nsIMdbRowCellCursor** acqCursor)</span>
<a href="#l14.59"></a><span id="l14.59"> {</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.62"></a><span id="l14.62">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.63"></a><span id="l14.63">   nsIMdbRowCellCursor* outCursor = 0;</span>
<a href="#l14.64"></a><span id="l14.64">   if ( ev )</span>
<a href="#l14.65"></a><span id="l14.65">   {</span>
<a href="#l14.66"></a><span id="l14.66">     morkRowCellCursor* cursor = mRowObject_Row-&gt;NewRowCellCursor(ev, inPos);</span>
<a href="#l14.67"></a><span id="l14.67">     if ( cursor )</span>
<a href="#l14.68"></a><span id="l14.68">     {</span>
<a href="#l14.69"></a><span id="l14.69">       if ( ev-&gt;Good() )</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineat">@@ -222,48 +222,48 @@ morkRowObject::GetRowCellCursor( // make</span>
<a href="#l14.71"></a><span id="l14.71"> </span>
<a href="#l14.72"></a><span id="l14.72"> // { ----- begin column methods -----</span>
<a href="#l14.73"></a><span id="l14.73"> NS_IMETHODIMP</span>
<a href="#l14.74"></a><span id="l14.74"> morkRowObject::AddColumn( // make sure a particular column is inside row</span>
<a href="#l14.75"></a><span id="l14.75">   nsIMdbEnv* mev, // context</span>
<a href="#l14.76"></a><span id="l14.76">   mdb_column inColumn, // column to add</span>
<a href="#l14.77"></a><span id="l14.77">   const mdbYarn* inYarn)</span>
<a href="#l14.78"></a><span id="l14.78"> {</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-  mdb_err outErr = NS_ERROR_FAILURE;</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+  nsresult outErr = NS_ERROR_FAILURE;</span>
<a href="#l14.81"></a><span id="l14.81">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.82"></a><span id="l14.82">   if ( ev )</span>
<a href="#l14.83"></a><span id="l14.83">   {</span>
<a href="#l14.84"></a><span id="l14.84">     if ( mRowObject_Store &amp;&amp; mRowObject_Row)</span>
<a href="#l14.85"></a><span id="l14.85">       mRowObject_Row-&gt;AddColumn(ev, inColumn, inYarn, mRowObject_Store);</span>
<a href="#l14.86"></a><span id="l14.86">       </span>
<a href="#l14.87"></a><span id="l14.87">     outErr = ev-&gt;AsErr();</span>
<a href="#l14.88"></a><span id="l14.88">   }</span>
<a href="#l14.89"></a><span id="l14.89">   return outErr;</span>
<a href="#l14.90"></a><span id="l14.90"> }</span>
<a href="#l14.91"></a><span id="l14.91"> </span>
<a href="#l14.92"></a><span id="l14.92"> NS_IMETHODIMP</span>
<a href="#l14.93"></a><span id="l14.93"> morkRowObject::CutColumn( // make sure a column is absent from the row</span>
<a href="#l14.94"></a><span id="l14.94">   nsIMdbEnv* mev, // context</span>
<a href="#l14.95"></a><span id="l14.95">   mdb_column inColumn)</span>
<a href="#l14.96"></a><span id="l14.96"> {</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-  mdb_err outErr = NS_ERROR_FAILURE;</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+  nsresult outErr = NS_ERROR_FAILURE;</span>
<a href="#l14.99"></a><span id="l14.99">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.100"></a><span id="l14.100">   if ( ev )</span>
<a href="#l14.101"></a><span id="l14.101">   {</span>
<a href="#l14.102"></a><span id="l14.102">     mRowObject_Row-&gt;CutColumn(ev, inColumn);</span>
<a href="#l14.103"></a><span id="l14.103">     outErr = ev-&gt;AsErr();</span>
<a href="#l14.104"></a><span id="l14.104">   }</span>
<a href="#l14.105"></a><span id="l14.105">   return outErr;</span>
<a href="#l14.106"></a><span id="l14.106"> }</span>
<a href="#l14.107"></a><span id="l14.107"> </span>
<a href="#l14.108"></a><span id="l14.108"> NS_IMETHODIMP</span>
<a href="#l14.109"></a><span id="l14.109"> morkRowObject::CutAllColumns( // remove all columns from the row</span>
<a href="#l14.110"></a><span id="l14.110">   nsIMdbEnv* mev)</span>
<a href="#l14.111"></a><span id="l14.111"> {</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.114"></a><span id="l14.114">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.115"></a><span id="l14.115">   if ( ev )</span>
<a href="#l14.116"></a><span id="l14.116">   {</span>
<a href="#l14.117"></a><span id="l14.117">     mRowObject_Row-&gt;CutAllColumns(ev);</span>
<a href="#l14.118"></a><span id="l14.118">     outErr = ev-&gt;AsErr();</span>
<a href="#l14.119"></a><span id="l14.119">   }</span>
<a href="#l14.120"></a><span id="l14.120">   return outErr;</span>
<a href="#l14.121"></a><span id="l14.121"> }</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineat">@@ -271,17 +271,17 @@ morkRowObject::CutAllColumns( // remove </span>
<a href="#l14.123"></a><span id="l14.123"> </span>
<a href="#l14.124"></a><span id="l14.124"> // { ----- begin cell methods -----</span>
<a href="#l14.125"></a><span id="l14.125"> NS_IMETHODIMP</span>
<a href="#l14.126"></a><span id="l14.126"> morkRowObject::NewCell( // get cell for specified column, or add new one</span>
<a href="#l14.127"></a><span id="l14.127">   nsIMdbEnv* mev, // context</span>
<a href="#l14.128"></a><span id="l14.128">   mdb_column inColumn, // column to add</span>
<a href="#l14.129"></a><span id="l14.129">   nsIMdbCell** acqCell)</span>
<a href="#l14.130"></a><span id="l14.130"> {</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.133"></a><span id="l14.133">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.134"></a><span id="l14.134">   if ( ev )</span>
<a href="#l14.135"></a><span id="l14.135">   {</span>
<a href="#l14.136"></a><span id="l14.136">     GetCell(mev, inColumn, acqCell);</span>
<a href="#l14.137"></a><span id="l14.137">     if ( !*acqCell )</span>
<a href="#l14.138"></a><span id="l14.138">     {</span>
<a href="#l14.139"></a><span id="l14.139">       if ( mRowObject_Store )</span>
<a href="#l14.140"></a><span id="l14.140">       {</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineat">@@ -302,17 +302,17 @@ morkRowObject::NewCell( // get cell for </span>
<a href="#l14.142"></a><span id="l14.142">   return outErr;</span>
<a href="#l14.143"></a><span id="l14.143"> }</span>
<a href="#l14.144"></a><span id="l14.144">   </span>
<a href="#l14.145"></a><span id="l14.145"> NS_IMETHODIMP</span>
<a href="#l14.146"></a><span id="l14.146"> morkRowObject::AddCell( // copy a cell from another row to this row</span>
<a href="#l14.147"></a><span id="l14.147">   nsIMdbEnv* mev, // context</span>
<a href="#l14.148"></a><span id="l14.148">   const nsIMdbCell* inCell)</span>
<a href="#l14.149"></a><span id="l14.149"> {</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.152"></a><span id="l14.152">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.153"></a><span id="l14.153">   if ( ev )</span>
<a href="#l14.154"></a><span id="l14.154">   {</span>
<a href="#l14.155"></a><span id="l14.155">     morkCell* cell = 0;</span>
<a href="#l14.156"></a><span id="l14.156">     morkCellObject* cellObj = (morkCellObject*) inCell;</span>
<a href="#l14.157"></a><span id="l14.157">     if ( cellObj-&gt;CanUseCell(mev, morkBool_kFalse, &amp;outErr, &amp;cell) )</span>
<a href="#l14.158"></a><span id="l14.158">     {</span>
<a href="#l14.159"></a><span id="l14.159"> </span>
<a href="#l14.160"></a><span id="l14.160" class="difflineat">@@ -349,17 +349,17 @@ morkRowObject::AddCell( // copy a cell f</span>
<a href="#l14.161"></a><span id="l14.161"> }</span>
<a href="#l14.162"></a><span id="l14.162">   </span>
<a href="#l14.163"></a><span id="l14.163"> NS_IMETHODIMP</span>
<a href="#l14.164"></a><span id="l14.164"> morkRowObject::GetCell( // find a cell in this row</span>
<a href="#l14.165"></a><span id="l14.165">   nsIMdbEnv* mev, // context</span>
<a href="#l14.166"></a><span id="l14.166">   mdb_column inColumn, // column to find</span>
<a href="#l14.167"></a><span id="l14.167">   nsIMdbCell** acqCell)</span>
<a href="#l14.168"></a><span id="l14.168"> {</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.171"></a><span id="l14.171">   nsIMdbCell* outCell = 0;</span>
<a href="#l14.172"></a><span id="l14.172">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.173"></a><span id="l14.173"> </span>
<a href="#l14.174"></a><span id="l14.174">   if ( ev )</span>
<a href="#l14.175"></a><span id="l14.175">   {</span>
<a href="#l14.176"></a><span id="l14.176">     if ( inColumn )</span>
<a href="#l14.177"></a><span id="l14.177">     {</span>
<a href="#l14.178"></a><span id="l14.178">       mork_pos pos = 0;</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineat">@@ -378,34 +378,34 @@ morkRowObject::GetCell( // find a cell i</span>
<a href="#l14.180"></a><span id="l14.180">     *acqCell = outCell;</span>
<a href="#l14.181"></a><span id="l14.181">   return outErr;</span>
<a href="#l14.182"></a><span id="l14.182"> }</span>
<a href="#l14.183"></a><span id="l14.183">   </span>
<a href="#l14.184"></a><span id="l14.184"> NS_IMETHODIMP</span>
<a href="#l14.185"></a><span id="l14.185"> morkRowObject::EmptyAllCells( // make all cells in row empty of content</span>
<a href="#l14.186"></a><span id="l14.186">   nsIMdbEnv* mev)</span>
<a href="#l14.187"></a><span id="l14.187"> {</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.190"></a><span id="l14.190">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.191"></a><span id="l14.191">   if ( ev )</span>
<a href="#l14.192"></a><span id="l14.192">   {</span>
<a href="#l14.193"></a><span id="l14.193">     EmptyAllCells(ev);</span>
<a href="#l14.194"></a><span id="l14.194">     outErr = ev-&gt;AsErr();</span>
<a href="#l14.195"></a><span id="l14.195">   }</span>
<a href="#l14.196"></a><span id="l14.196">   return outErr;</span>
<a href="#l14.197"></a><span id="l14.197"> }</span>
<a href="#l14.198"></a><span id="l14.198"> // } ----- end cell methods -----</span>
<a href="#l14.199"></a><span id="l14.199"> </span>
<a href="#l14.200"></a><span id="l14.200"> // { ----- begin row methods -----</span>
<a href="#l14.201"></a><span id="l14.201"> NS_IMETHODIMP</span>
<a href="#l14.202"></a><span id="l14.202"> morkRowObject::AddRow( // add all cells in another row to this one</span>
<a href="#l14.203"></a><span id="l14.203">   nsIMdbEnv* mev, // context</span>
<a href="#l14.204"></a><span id="l14.204">   nsIMdbRow* ioSourceRow)</span>
<a href="#l14.205"></a><span id="l14.205"> {</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.208"></a><span id="l14.208">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.209"></a><span id="l14.209">   if ( ev )</span>
<a href="#l14.210"></a><span id="l14.210">   {</span>
<a href="#l14.211"></a><span id="l14.211">     morkRow* unsafeSource = (morkRow*) ioSourceRow; // unsafe cast</span>
<a href="#l14.212"></a><span id="l14.212"> //    if ( unsafeSource-&gt;CanUseRow(mev, morkBool_kFalse, &amp;outErr, &amp;source) )</span>
<a href="#l14.213"></a><span id="l14.213">     {</span>
<a href="#l14.214"></a><span id="l14.214">       mRowObject_Row-&gt;AddRow(ev, unsafeSource);</span>
<a href="#l14.215"></a><span id="l14.215">     }</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineat">@@ -414,17 +414,17 @@ morkRowObject::AddRow( // add all cells </span>
<a href="#l14.217"></a><span id="l14.217">   return outErr;</span>
<a href="#l14.218"></a><span id="l14.218"> }</span>
<a href="#l14.219"></a><span id="l14.219">   </span>
<a href="#l14.220"></a><span id="l14.220"> NS_IMETHODIMP</span>
<a href="#l14.221"></a><span id="l14.221"> morkRowObject::SetRow( // make exact duplicate of another row</span>
<a href="#l14.222"></a><span id="l14.222">   nsIMdbEnv* mev, // context</span>
<a href="#l14.223"></a><span id="l14.223">   nsIMdbRow* ioSourceRow)</span>
<a href="#l14.224"></a><span id="l14.224"> {</span>
<a href="#l14.225"></a><span id="l14.225" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.226"></a><span id="l14.226" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.227"></a><span id="l14.227">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.228"></a><span id="l14.228">   if ( ev )</span>
<a href="#l14.229"></a><span id="l14.229">   {</span>
<a href="#l14.230"></a><span id="l14.230">     morkRowObject *sourceObject = (morkRowObject *) ioSourceRow; // unsafe cast</span>
<a href="#l14.231"></a><span id="l14.231">     morkRow* unsafeSource = sourceObject-&gt;mRowObject_Row;</span>
<a href="#l14.232"></a><span id="l14.232"> //    if ( unsafeSource-&gt;CanUseRow(mev, morkBool_kFalse, &amp;outErr, &amp;source) )</span>
<a href="#l14.233"></a><span id="l14.233">     {</span>
<a href="#l14.234"></a><span id="l14.234">       mRowObject_Row-&gt;SetRow(ev, unsafeSource);</span>
<a href="#l14.235"></a><span id="l14.235" class="difflineat">@@ -437,17 +437,17 @@ morkRowObject::SetRow( // make exact dup</span>
<a href="#l14.236"></a><span id="l14.236"> </span>
<a href="#l14.237"></a><span id="l14.237"> // { ----- begin blob methods -----</span>
<a href="#l14.238"></a><span id="l14.238"> NS_IMETHODIMP</span>
<a href="#l14.239"></a><span id="l14.239"> morkRowObject::SetCellYarn( // synonym for AddColumn()</span>
<a href="#l14.240"></a><span id="l14.240">   nsIMdbEnv* mev, // context</span>
<a href="#l14.241"></a><span id="l14.241">   mdb_column inColumn, // column to add</span>
<a href="#l14.242"></a><span id="l14.242">   const mdbYarn* inYarn)</span>
<a href="#l14.243"></a><span id="l14.243"> {</span>
<a href="#l14.244"></a><span id="l14.244" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.246"></a><span id="l14.246">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.247"></a><span id="l14.247">   if ( ev )</span>
<a href="#l14.248"></a><span id="l14.248">   {</span>
<a href="#l14.249"></a><span id="l14.249">     if ( mRowObject_Store )</span>
<a href="#l14.250"></a><span id="l14.250">       AddColumn(ev, inColumn, inYarn);</span>
<a href="#l14.251"></a><span id="l14.251">       </span>
<a href="#l14.252"></a><span id="l14.252">     outErr = ev-&gt;AsErr();</span>
<a href="#l14.253"></a><span id="l14.253">   }</span>
<a href="#l14.254"></a><span id="l14.254" class="difflineat">@@ -455,17 +455,17 @@ morkRowObject::SetCellYarn( // synonym f</span>
<a href="#l14.255"></a><span id="l14.255"> }</span>
<a href="#l14.256"></a><span id="l14.256"> NS_IMETHODIMP</span>
<a href="#l14.257"></a><span id="l14.257"> morkRowObject::GetCellYarn(</span>
<a href="#l14.258"></a><span id="l14.258">   nsIMdbEnv* mev, // context</span>
<a href="#l14.259"></a><span id="l14.259">   mdb_column inColumn, // column to read </span>
<a href="#l14.260"></a><span id="l14.260">   mdbYarn* outYarn)  // writes some yarn slots </span>
<a href="#l14.261"></a><span id="l14.261"> // copy content into the yarn buffer, and update mYarn_Fill and mYarn_Form</span>
<a href="#l14.262"></a><span id="l14.262"> {</span>
<a href="#l14.263"></a><span id="l14.263" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.264"></a><span id="l14.264" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.265"></a><span id="l14.265">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.266"></a><span id="l14.266">   if ( ev )</span>
<a href="#l14.267"></a><span id="l14.267">   {</span>
<a href="#l14.268"></a><span id="l14.268">     if ( mRowObject_Store &amp;&amp; mRowObject_Row)</span>
<a href="#l14.269"></a><span id="l14.269">     {</span>
<a href="#l14.270"></a><span id="l14.270">       morkAtom* atom = mRowObject_Row-&gt;GetColumnAtom(ev, inColumn);</span>
<a href="#l14.271"></a><span id="l14.271">       atom-&gt;GetYarn(outYarn);</span>
<a href="#l14.272"></a><span id="l14.272">       // note nil atom works and sets yarn correctly</span>
<a href="#l14.273"></a><span id="l14.273" class="difflineat">@@ -477,17 +477,17 @@ morkRowObject::GetCellYarn(</span>
<a href="#l14.274"></a><span id="l14.274"> }</span>
<a href="#l14.275"></a><span id="l14.275"> </span>
<a href="#l14.276"></a><span id="l14.276"> NS_IMETHODIMP</span>
<a href="#l14.277"></a><span id="l14.277"> morkRowObject::AliasCellYarn(</span>
<a href="#l14.278"></a><span id="l14.278">   nsIMdbEnv* mev, // context</span>
<a href="#l14.279"></a><span id="l14.279">     mdb_column inColumn, // column to alias</span>
<a href="#l14.280"></a><span id="l14.280">     mdbYarn* outYarn) // writes ALL yarn slots</span>
<a href="#l14.281"></a><span id="l14.281"> {</span>
<a href="#l14.282"></a><span id="l14.282" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.283"></a><span id="l14.283" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.284"></a><span id="l14.284">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.285"></a><span id="l14.285">   if ( ev )</span>
<a href="#l14.286"></a><span id="l14.286">   {</span>
<a href="#l14.287"></a><span id="l14.287">     if ( mRowObject_Store &amp;&amp; mRowObject_Row)</span>
<a href="#l14.288"></a><span id="l14.288">     {</span>
<a href="#l14.289"></a><span id="l14.289">       morkAtom* atom = mRowObject_Row-&gt;GetColumnAtom(ev, inColumn);</span>
<a href="#l14.290"></a><span id="l14.290">       atom-&gt;AliasYarn(outYarn);</span>
<a href="#l14.291"></a><span id="l14.291">       // note nil atom works and sets yarn correctly</span>
<a href="#l14.292"></a><span id="l14.292" class="difflineat">@@ -509,17 +509,17 @@ morkRowObject::NextCellYarn(nsIMdbEnv* m</span>
<a href="#l14.293"></a><span id="l14.293"> // value to say 'no previous column', which causes the first column to be</span>
<a href="#l14.294"></a><span id="l14.294"> // read.  Then the value returned in ioColumn is perfect for the next call</span>
<a href="#l14.295"></a><span id="l14.295"> // to NextCellYarn(), since it will then be the previous column accessed.</span>
<a href="#l14.296"></a><span id="l14.296"> // Callers need only examine the column token returned to see which cell</span>
<a href="#l14.297"></a><span id="l14.297"> // in the row is being read into the yarn.  When no more columns remain,</span>
<a href="#l14.298"></a><span id="l14.298"> // and the iteration has ended, ioColumn will return a zero token again.</span>
<a href="#l14.299"></a><span id="l14.299"> // So iterating over cells starts and ends with a zero column token.</span>
<a href="#l14.300"></a><span id="l14.300"> {</span>
<a href="#l14.301"></a><span id="l14.301" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.302"></a><span id="l14.302" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.303"></a><span id="l14.303">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.304"></a><span id="l14.304">   if ( ev )</span>
<a href="#l14.305"></a><span id="l14.305">   {</span>
<a href="#l14.306"></a><span id="l14.306">     if ( mRowObject_Store &amp;&amp; mRowObject_Row)</span>
<a href="#l14.307"></a><span id="l14.307">       mRowObject_Row-&gt;NextColumn(ev, ioColumn, outYarn);</span>
<a href="#l14.308"></a><span id="l14.308">       </span>
<a href="#l14.309"></a><span id="l14.309">     outErr = ev-&gt;AsErr();</span>
<a href="#l14.310"></a><span id="l14.310">   }</span>
<a href="#l14.311"></a><span id="l14.311" class="difflineat">@@ -533,17 +533,17 @@ morkRowObject::SeekCellYarn( // resemble</span>
<a href="#l14.312"></a><span id="l14.312">   mdb_column* outColumn, // column for this particular cell</span>
<a href="#l14.313"></a><span id="l14.313">   mdbYarn* outYarn) // writes some yarn slots</span>
<a href="#l14.314"></a><span id="l14.314"> // copy content into the yarn buffer, and update mYarn_Fill and mYarn_Form</span>
<a href="#l14.315"></a><span id="l14.315"> // Callers can pass nil for outYarn to indicate no interest in content, so</span>
<a href="#l14.316"></a><span id="l14.316"> // only the outColumn value is returned.  NOTE to subclasses: you must be</span>
<a href="#l14.317"></a><span id="l14.317"> // able to ignore outYarn when the pointer is nil; please do not crash.</span>
<a href="#l14.318"></a><span id="l14.318"> </span>
<a href="#l14.319"></a><span id="l14.319"> {</span>
<a href="#l14.320"></a><span id="l14.320" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l14.321"></a><span id="l14.321" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l14.322"></a><span id="l14.322">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l14.323"></a><span id="l14.323">   if ( ev )</span>
<a href="#l14.324"></a><span id="l14.324">   {</span>
<a href="#l14.325"></a><span id="l14.325">     if ( mRowObject_Store &amp;&amp; mRowObject_Row)</span>
<a href="#l14.326"></a><span id="l14.326">       mRowObject_Row-&gt;SeekColumn(ev, inPos, outColumn, outYarn);</span>
<a href="#l14.327"></a><span id="l14.327">       </span>
<a href="#l14.328"></a><span id="l14.328">     outErr = ev-&gt;AsErr();</span>
<a href="#l14.329"></a><span id="l14.329">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/db/mork/src/morkStore.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/db/mork/src/morkStore.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1353,32 +1353,32 @@ morkStore::IsOpenMdbObject(nsIMdbEnv* me</span>
<a href="#l15.4"></a><span id="l15.4"> // } ===== end nsIMdbObject methods =====</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6"> // { ===== begin nsIMdbPort methods =====</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> // { ----- begin attribute methods -----</span>
<a href="#l15.9"></a><span id="l15.9"> NS_IMETHODIMP</span>
<a href="#l15.10"></a><span id="l15.10"> morkStore::GetIsPortReadonly(nsIMdbEnv* mev, mdb_bool* outBool)</span>
<a href="#l15.11"></a><span id="l15.11"> {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.14"></a><span id="l15.14">   mdb_bool isReadOnly = morkBool_kFalse;</span>
<a href="#l15.15"></a><span id="l15.15">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.16"></a><span id="l15.16">   if ( ev )</span>
<a href="#l15.17"></a><span id="l15.17">   {</span>
<a href="#l15.18"></a><span id="l15.18">     ev-&gt;StubMethodOnlyError();</span>
<a href="#l15.19"></a><span id="l15.19">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.20"></a><span id="l15.20">   }</span>
<a href="#l15.21"></a><span id="l15.21">   if ( outBool )</span>
<a href="#l15.22"></a><span id="l15.22">     *outBool = isReadOnly;</span>
<a href="#l15.23"></a><span id="l15.23">   return outErr;</span>
<a href="#l15.24"></a><span id="l15.24"> }</span>
<a href="#l15.25"></a><span id="l15.25"> </span>
<a href="#l15.26"></a><span id="l15.26"> morkEnv*</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-morkStore::CanUseStore(nsIMdbEnv* mev,</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-  mork_bool inMutable, mdb_err* outErr) const</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+morkStore::CanUseStore(nsIMdbEnv* mev, mork_bool inMutable,</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+                       nsresult* outErr) const</span>
<a href="#l15.31"></a><span id="l15.31"> {</span>
<a href="#l15.32"></a><span id="l15.32">   morkEnv* outEnv = 0;</span>
<a href="#l15.33"></a><span id="l15.33">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l15.34"></a><span id="l15.34">   if ( ev )</span>
<a href="#l15.35"></a><span id="l15.35">   {</span>
<a href="#l15.36"></a><span id="l15.36">     if (IsStore())</span>
<a href="#l15.37"></a><span id="l15.37">       outEnv = ev;</span>
<a href="#l15.38"></a><span id="l15.38">     else</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineat">@@ -1396,17 +1396,17 @@ morkStore::GetIsStore(nsIMdbEnv* mev, md</span>
<a href="#l15.40"></a><span id="l15.40">  if ( outBool )</span>
<a href="#l15.41"></a><span id="l15.41">     *outBool = morkBool_kTrue;</span>
<a href="#l15.42"></a><span id="l15.42">   return NS_OK;</span>
<a href="#l15.43"></a><span id="l15.43"> }</span>
<a href="#l15.44"></a><span id="l15.44"> </span>
<a href="#l15.45"></a><span id="l15.45"> NS_IMETHODIMP</span>
<a href="#l15.46"></a><span id="l15.46"> morkStore::GetIsStoreAndDirty(nsIMdbEnv* mev, mdb_bool* outBool)</span>
<a href="#l15.47"></a><span id="l15.47"> {</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.50"></a><span id="l15.50">   mdb_bool isStoreAndDirty = morkBool_kFalse;</span>
<a href="#l15.51"></a><span id="l15.51">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.52"></a><span id="l15.52">   if ( ev )</span>
<a href="#l15.53"></a><span id="l15.53">   {</span>
<a href="#l15.54"></a><span id="l15.54">     ev-&gt;StubMethodOnlyError();</span>
<a href="#l15.55"></a><span id="l15.55">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.56"></a><span id="l15.56">   }</span>
<a href="#l15.57"></a><span id="l15.57">   if ( outBool )</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineat">@@ -1414,49 +1414,49 @@ morkStore::GetIsStoreAndDirty(nsIMdbEnv*</span>
<a href="#l15.59"></a><span id="l15.59">   return outErr;</span>
<a href="#l15.60"></a><span id="l15.60"> }</span>
<a href="#l15.61"></a><span id="l15.61"> </span>
<a href="#l15.62"></a><span id="l15.62"> NS_IMETHODIMP</span>
<a href="#l15.63"></a><span id="l15.63"> morkStore::GetUsagePolicy(nsIMdbEnv* mev, </span>
<a href="#l15.64"></a><span id="l15.64">   mdbUsagePolicy* ioUsagePolicy)</span>
<a href="#l15.65"></a><span id="l15.65"> {</span>
<a href="#l15.66"></a><span id="l15.66">   MORK_USED_1(ioUsagePolicy);</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.69"></a><span id="l15.69">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.70"></a><span id="l15.70">   if ( ev )</span>
<a href="#l15.71"></a><span id="l15.71">   {</span>
<a href="#l15.72"></a><span id="l15.72">     ev-&gt;StubMethodOnlyError();</span>
<a href="#l15.73"></a><span id="l15.73">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.74"></a><span id="l15.74">   }</span>
<a href="#l15.75"></a><span id="l15.75">   return outErr;</span>
<a href="#l15.76"></a><span id="l15.76"> }</span>
<a href="#l15.77"></a><span id="l15.77"> </span>
<a href="#l15.78"></a><span id="l15.78"> NS_IMETHODIMP</span>
<a href="#l15.79"></a><span id="l15.79"> morkStore::SetUsagePolicy(nsIMdbEnv* mev, </span>
<a href="#l15.80"></a><span id="l15.80">   const mdbUsagePolicy* inUsagePolicy)</span>
<a href="#l15.81"></a><span id="l15.81"> {</span>
<a href="#l15.82"></a><span id="l15.82">   MORK_USED_1(inUsagePolicy);</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.85"></a><span id="l15.85">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.86"></a><span id="l15.86">   if ( ev )</span>
<a href="#l15.87"></a><span id="l15.87">   {</span>
<a href="#l15.88"></a><span id="l15.88">     // ev-&gt;StubMethodOnlyError(); // okay to do nothing?</span>
<a href="#l15.89"></a><span id="l15.89">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.90"></a><span id="l15.90">   }</span>
<a href="#l15.91"></a><span id="l15.91">   return outErr;</span>
<a href="#l15.92"></a><span id="l15.92"> }</span>
<a href="#l15.93"></a><span id="l15.93"> // } ----- end attribute methods -----</span>
<a href="#l15.94"></a><span id="l15.94"> </span>
<a href="#l15.95"></a><span id="l15.95"> // { ----- begin memory policy methods -----  </span>
<a href="#l15.96"></a><span id="l15.96"> NS_IMETHODIMP</span>
<a href="#l15.97"></a><span id="l15.97"> morkStore::IdleMemoryPurge( // do memory management already scheduled</span>
<a href="#l15.98"></a><span id="l15.98">   nsIMdbEnv* mev, // context</span>
<a href="#l15.99"></a><span id="l15.99">   mdb_size* outEstimatedBytesFreed) // approximate bytes actually freed</span>
<a href="#l15.100"></a><span id="l15.100"> {</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.103"></a><span id="l15.103">   mdb_size estimatedBytesFreed = 0;</span>
<a href="#l15.104"></a><span id="l15.104">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.105"></a><span id="l15.105">   if ( ev )</span>
<a href="#l15.106"></a><span id="l15.106">   {</span>
<a href="#l15.107"></a><span id="l15.107">     // ev-&gt;StubMethodOnlyError(); // okay to do nothing?</span>
<a href="#l15.108"></a><span id="l15.108">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.109"></a><span id="l15.109">   }</span>
<a href="#l15.110"></a><span id="l15.110">   if ( outEstimatedBytesFreed )</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineat">@@ -1466,17 +1466,17 @@ morkStore::IdleMemoryPurge( // do memory</span>
<a href="#l15.112"></a><span id="l15.112"> </span>
<a href="#l15.113"></a><span id="l15.113"> NS_IMETHODIMP</span>
<a href="#l15.114"></a><span id="l15.114"> morkStore::SessionMemoryPurge( // request specific footprint decrease</span>
<a href="#l15.115"></a><span id="l15.115">   nsIMdbEnv* mev, // context</span>
<a href="#l15.116"></a><span id="l15.116">   mdb_size inDesiredBytesFreed, // approximate number of bytes wanted</span>
<a href="#l15.117"></a><span id="l15.117">   mdb_size* outEstimatedBytesFreed) // approximate bytes actually freed</span>
<a href="#l15.118"></a><span id="l15.118"> {</span>
<a href="#l15.119"></a><span id="l15.119">   MORK_USED_1(inDesiredBytesFreed);</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.122"></a><span id="l15.122">   mdb_size estimate = 0;</span>
<a href="#l15.123"></a><span id="l15.123">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.124"></a><span id="l15.124">   if ( ev )</span>
<a href="#l15.125"></a><span id="l15.125">   {</span>
<a href="#l15.126"></a><span id="l15.126">     // ev-&gt;StubMethodOnlyError(); // okay to do nothing?</span>
<a href="#l15.127"></a><span id="l15.127">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.128"></a><span id="l15.128">   }</span>
<a href="#l15.129"></a><span id="l15.129">   if ( outEstimatedBytesFreed )</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineat">@@ -1484,17 +1484,17 @@ morkStore::SessionMemoryPurge( // reques</span>
<a href="#l15.131"></a><span id="l15.131">   return outErr;</span>
<a href="#l15.132"></a><span id="l15.132"> }</span>
<a href="#l15.133"></a><span id="l15.133"> </span>
<a href="#l15.134"></a><span id="l15.134"> NS_IMETHODIMP</span>
<a href="#l15.135"></a><span id="l15.135"> morkStore::PanicMemoryPurge( // desperately free all possible memory</span>
<a href="#l15.136"></a><span id="l15.136">   nsIMdbEnv* mev, // context</span>
<a href="#l15.137"></a><span id="l15.137">   mdb_size* outEstimatedBytesFreed) // approximate bytes actually freed</span>
<a href="#l15.138"></a><span id="l15.138"> {</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.141"></a><span id="l15.141">   mdb_size estimate = 0;</span>
<a href="#l15.142"></a><span id="l15.142">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.143"></a><span id="l15.143">   if ( ev )</span>
<a href="#l15.144"></a><span id="l15.144">   {</span>
<a href="#l15.145"></a><span id="l15.145">     // ev-&gt;StubMethodOnlyError(); // okay to do nothing?</span>
<a href="#l15.146"></a><span id="l15.146">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.147"></a><span id="l15.147">   }</span>
<a href="#l15.148"></a><span id="l15.148">   if ( outEstimatedBytesFreed )</span>
<a href="#l15.149"></a><span id="l15.149" class="difflineat">@@ -1505,17 +1505,17 @@ morkStore::PanicMemoryPurge( // desperat</span>
<a href="#l15.150"></a><span id="l15.150"> </span>
<a href="#l15.151"></a><span id="l15.151"> // { ----- begin filepath methods -----</span>
<a href="#l15.152"></a><span id="l15.152"> NS_IMETHODIMP</span>
<a href="#l15.153"></a><span id="l15.153"> morkStore::GetPortFilePath(</span>
<a href="#l15.154"></a><span id="l15.154">   nsIMdbEnv* mev, // context</span>
<a href="#l15.155"></a><span id="l15.155">   mdbYarn* outFilePath, // name of file holding port content</span>
<a href="#l15.156"></a><span id="l15.156">   mdbYarn* outFormatVersion) // file format description</span>
<a href="#l15.157"></a><span id="l15.157"> {</span>
<a href="#l15.158"></a><span id="l15.158" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.159"></a><span id="l15.159" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.160"></a><span id="l15.160">   if ( outFormatVersion )</span>
<a href="#l15.161"></a><span id="l15.161">     outFormatVersion-&gt;mYarn_Fill = 0;</span>
<a href="#l15.162"></a><span id="l15.162">   if ( outFilePath )</span>
<a href="#l15.163"></a><span id="l15.163">     outFilePath-&gt;mYarn_Fill = 0;</span>
<a href="#l15.164"></a><span id="l15.164">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.165"></a><span id="l15.165">   if ( ev )</span>
<a href="#l15.166"></a><span id="l15.166">   {</span>
<a href="#l15.167"></a><span id="l15.167">     if ( mStore_File )</span>
<a href="#l15.168"></a><span id="l15.168" class="difflineat">@@ -1528,17 +1528,17 @@ morkStore::GetPortFilePath(</span>
<a href="#l15.169"></a><span id="l15.169">   return outErr;</span>
<a href="#l15.170"></a><span id="l15.170"> }</span>
<a href="#l15.171"></a><span id="l15.171"> </span>
<a href="#l15.172"></a><span id="l15.172"> NS_IMETHODIMP</span>
<a href="#l15.173"></a><span id="l15.173"> morkStore::GetPortFile(</span>
<a href="#l15.174"></a><span id="l15.174">   nsIMdbEnv* mev, // context</span>
<a href="#l15.175"></a><span id="l15.175">   nsIMdbFile** acqFile) // acquire file used by port or store</span>
<a href="#l15.176"></a><span id="l15.176"> {</span>
<a href="#l15.177"></a><span id="l15.177" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.178"></a><span id="l15.178" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.179"></a><span id="l15.179">   if ( acqFile )</span>
<a href="#l15.180"></a><span id="l15.180">     *acqFile = 0;</span>
<a href="#l15.181"></a><span id="l15.181"> </span>
<a href="#l15.182"></a><span id="l15.182">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.183"></a><span id="l15.183">   if ( ev )</span>
<a href="#l15.184"></a><span id="l15.184">   {</span>
<a href="#l15.185"></a><span id="l15.185">     </span>
<a href="#l15.186"></a><span id="l15.186">     if ( mStore_File )</span>
<a href="#l15.187"></a><span id="l15.187" class="difflineat">@@ -1560,17 +1560,17 @@ morkStore::GetPortFile(</span>
<a href="#l15.188"></a><span id="l15.188"> // } ----- end filepath methods -----</span>
<a href="#l15.189"></a><span id="l15.189"> </span>
<a href="#l15.190"></a><span id="l15.190"> // { ----- begin export methods -----</span>
<a href="#l15.191"></a><span id="l15.191"> NS_IMETHODIMP</span>
<a href="#l15.192"></a><span id="l15.192"> morkStore::BestExportFormat( // determine preferred export format</span>
<a href="#l15.193"></a><span id="l15.193">   nsIMdbEnv* mev, // context</span>
<a href="#l15.194"></a><span id="l15.194">   mdbYarn* outFormatVersion) // file format description</span>
<a href="#l15.195"></a><span id="l15.195"> {</span>
<a href="#l15.196"></a><span id="l15.196" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.197"></a><span id="l15.197" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.198"></a><span id="l15.198">   if ( outFormatVersion )</span>
<a href="#l15.199"></a><span id="l15.199">     outFormatVersion-&gt;mYarn_Fill = 0;</span>
<a href="#l15.200"></a><span id="l15.200">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.201"></a><span id="l15.201">   if ( ev )</span>
<a href="#l15.202"></a><span id="l15.202">   {</span>
<a href="#l15.203"></a><span id="l15.203">     ev-&gt;StubMethodOnlyError();</span>
<a href="#l15.204"></a><span id="l15.204">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.205"></a><span id="l15.205">   }</span>
<a href="#l15.206"></a><span id="l15.206" class="difflineat">@@ -1580,17 +1580,17 @@ morkStore::BestExportFormat( // determin</span>
<a href="#l15.207"></a><span id="l15.207"> NS_IMETHODIMP</span>
<a href="#l15.208"></a><span id="l15.208"> morkStore::CanExportToFormat( // can export content in given specific format?</span>
<a href="#l15.209"></a><span id="l15.209">   nsIMdbEnv* mev, // context</span>
<a href="#l15.210"></a><span id="l15.210">   const char* inFormatVersion, // file format description</span>
<a href="#l15.211"></a><span id="l15.211">   mdb_bool* outCanExport) // whether ExportSource() might succeed</span>
<a href="#l15.212"></a><span id="l15.212"> {</span>
<a href="#l15.213"></a><span id="l15.213">   MORK_USED_1(inFormatVersion);</span>
<a href="#l15.214"></a><span id="l15.214">   mdb_bool canExport = morkBool_kFalse;</span>
<a href="#l15.215"></a><span id="l15.215" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.216"></a><span id="l15.216" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.217"></a><span id="l15.217">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.218"></a><span id="l15.218">   if ( ev )</span>
<a href="#l15.219"></a><span id="l15.219">   {</span>
<a href="#l15.220"></a><span id="l15.220">     ev-&gt;StubMethodOnlyError();</span>
<a href="#l15.221"></a><span id="l15.221">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.222"></a><span id="l15.222">   }</span>
<a href="#l15.223"></a><span id="l15.223">   if ( outCanExport )</span>
<a href="#l15.224"></a><span id="l15.224">     *outCanExport = canExport;</span>
<a href="#l15.225"></a><span id="l15.225" class="difflineat">@@ -1602,17 +1602,17 @@ morkStore::ExportToFormat( // export con</span>
<a href="#l15.226"></a><span id="l15.226">   nsIMdbEnv* mev, // context</span>
<a href="#l15.227"></a><span id="l15.227">   // const char* inFilePath, // the file to receive exported content</span>
<a href="#l15.228"></a><span id="l15.228">   nsIMdbFile* ioFile, // destination abstract file interface</span>
<a href="#l15.229"></a><span id="l15.229">   const char* inFormatVersion, // file format description</span>
<a href="#l15.230"></a><span id="l15.230">   nsIMdbThumb** acqThumb) // acquire thumb for incremental export</span>
<a href="#l15.231"></a><span id="l15.231"> // Call nsIMdbThumb::DoMore() until done, or until the thumb is broken, and</span>
<a href="#l15.232"></a><span id="l15.232"> // then the export will be finished.</span>
<a href="#l15.233"></a><span id="l15.233"> {</span>
<a href="#l15.234"></a><span id="l15.234" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.235"></a><span id="l15.235" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.236"></a><span id="l15.236">   nsIMdbThumb* outThumb = 0;</span>
<a href="#l15.237"></a><span id="l15.237">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.238"></a><span id="l15.238">   if ( ev )</span>
<a href="#l15.239"></a><span id="l15.239">   {</span>
<a href="#l15.240"></a><span id="l15.240">     if ( ioFile &amp;&amp; inFormatVersion &amp;&amp; acqThumb )</span>
<a href="#l15.241"></a><span id="l15.241">     {</span>
<a href="#l15.242"></a><span id="l15.242">       ev-&gt;StubMethodOnlyError();</span>
<a href="#l15.243"></a><span id="l15.243">     }</span>
<a href="#l15.244"></a><span id="l15.244" class="difflineat">@@ -1630,17 +1630,17 @@ morkStore::ExportToFormat( // export con</span>
<a href="#l15.245"></a><span id="l15.245"> </span>
<a href="#l15.246"></a><span id="l15.246"> // { ----- begin token methods -----</span>
<a href="#l15.247"></a><span id="l15.247"> NS_IMETHODIMP</span>
<a href="#l15.248"></a><span id="l15.248"> morkStore::TokenToString( // return a string name for an integer token</span>
<a href="#l15.249"></a><span id="l15.249">   nsIMdbEnv* mev, // context</span>
<a href="#l15.250"></a><span id="l15.250">   mdb_token inToken, // token for inTokenName inside this port</span>
<a href="#l15.251"></a><span id="l15.251">   mdbYarn* outTokenName) // the type of table to access</span>
<a href="#l15.252"></a><span id="l15.252"> {</span>
<a href="#l15.253"></a><span id="l15.253" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.254"></a><span id="l15.254" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.255"></a><span id="l15.255">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.256"></a><span id="l15.256">   if ( ev )</span>
<a href="#l15.257"></a><span id="l15.257">   {</span>
<a href="#l15.258"></a><span id="l15.258">     TokenToString(ev, inToken, outTokenName);</span>
<a href="#l15.259"></a><span id="l15.259">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.260"></a><span id="l15.260">   }</span>
<a href="#l15.261"></a><span id="l15.261">   return outErr;</span>
<a href="#l15.262"></a><span id="l15.262"> }</span>
<a href="#l15.263"></a><span id="l15.263" class="difflineat">@@ -1650,17 +1650,17 @@ morkStore::StringToToken( // return an i</span>
<a href="#l15.264"></a><span id="l15.264">   nsIMdbEnv* mev, // context</span>
<a href="#l15.265"></a><span id="l15.265">   const char* inTokenName, // Latin1 string to tokenize if possible</span>
<a href="#l15.266"></a><span id="l15.266">   mdb_token* outToken) // token for inTokenName inside this port</span>
<a href="#l15.267"></a><span id="l15.267">   // String token zero is never used and never supported. If the port</span>
<a href="#l15.268"></a><span id="l15.268">   // is a mutable store, then StringToToken() to create a new</span>
<a href="#l15.269"></a><span id="l15.269">   // association of inTokenName with a new integer token if possible.</span>
<a href="#l15.270"></a><span id="l15.270">   // But a readonly port will return zero for an unknown scope name.</span>
<a href="#l15.271"></a><span id="l15.271"> {</span>
<a href="#l15.272"></a><span id="l15.272" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.273"></a><span id="l15.273" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.274"></a><span id="l15.274">   mdb_token token = 0;</span>
<a href="#l15.275"></a><span id="l15.275">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.276"></a><span id="l15.276">   if ( ev )</span>
<a href="#l15.277"></a><span id="l15.277">   {</span>
<a href="#l15.278"></a><span id="l15.278">     token = StringToToken(ev, inTokenName);</span>
<a href="#l15.279"></a><span id="l15.279">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.280"></a><span id="l15.280">   }</span>
<a href="#l15.281"></a><span id="l15.281">   if ( outToken )</span>
<a href="#l15.282"></a><span id="l15.282" class="difflineat">@@ -1673,17 +1673,17 @@ NS_IMETHODIMP</span>
<a href="#l15.283"></a><span id="l15.283"> morkStore::QueryToken( // like StringToToken(), but without adding</span>
<a href="#l15.284"></a><span id="l15.284">   nsIMdbEnv* mev, // context</span>
<a href="#l15.285"></a><span id="l15.285">   const char* inTokenName, // Latin1 string to tokenize if possible</span>
<a href="#l15.286"></a><span id="l15.286">   mdb_token* outToken) // token for inTokenName inside this port</span>
<a href="#l15.287"></a><span id="l15.287">   // QueryToken() will return a string token if one already exists,</span>
<a href="#l15.288"></a><span id="l15.288">   // but unlike StringToToken(), will not assign a new token if not</span>
<a href="#l15.289"></a><span id="l15.289">   // already in use.</span>
<a href="#l15.290"></a><span id="l15.290"> {</span>
<a href="#l15.291"></a><span id="l15.291" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.292"></a><span id="l15.292" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.293"></a><span id="l15.293">   mdb_token token = 0;</span>
<a href="#l15.294"></a><span id="l15.294">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.295"></a><span id="l15.295">   if ( ev )</span>
<a href="#l15.296"></a><span id="l15.296">   {</span>
<a href="#l15.297"></a><span id="l15.297">     token = QueryToken(ev, inTokenName);</span>
<a href="#l15.298"></a><span id="l15.298">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.299"></a><span id="l15.299">   }</span>
<a href="#l15.300"></a><span id="l15.300">   if ( outToken )</span>
<a href="#l15.301"></a><span id="l15.301" class="difflineat">@@ -1696,17 +1696,17 @@ morkStore::QueryToken( // like StringToT</span>
<a href="#l15.302"></a><span id="l15.302"> </span>
<a href="#l15.303"></a><span id="l15.303"> // { ----- begin row methods -----  </span>
<a href="#l15.304"></a><span id="l15.304"> NS_IMETHODIMP</span>
<a href="#l15.305"></a><span id="l15.305"> morkStore::HasRow( // contains a row with the specified oid?</span>
<a href="#l15.306"></a><span id="l15.306">   nsIMdbEnv* mev, // context</span>
<a href="#l15.307"></a><span id="l15.307">   const mdbOid* inOid,  // hypothetical row oid</span>
<a href="#l15.308"></a><span id="l15.308">   mdb_bool* outHasRow) // whether GetRow() might succeed</span>
<a href="#l15.309"></a><span id="l15.309"> {</span>
<a href="#l15.310"></a><span id="l15.310" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.311"></a><span id="l15.311" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.312"></a><span id="l15.312">   mdb_bool hasRow = morkBool_kFalse;</span>
<a href="#l15.313"></a><span id="l15.313">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.314"></a><span id="l15.314">   if ( ev )</span>
<a href="#l15.315"></a><span id="l15.315">   {</span>
<a href="#l15.316"></a><span id="l15.316">     morkRow* row = GetRow(ev, inOid);</span>
<a href="#l15.317"></a><span id="l15.317">     if ( row )</span>
<a href="#l15.318"></a><span id="l15.318">       hasRow = morkBool_kTrue;</span>
<a href="#l15.319"></a><span id="l15.319">       </span>
<a href="#l15.320"></a><span id="l15.320" class="difflineat">@@ -1718,17 +1718,17 @@ morkStore::HasRow( // contains a row wit</span>
<a href="#l15.321"></a><span id="l15.321"> }</span>
<a href="#l15.322"></a><span id="l15.322">   </span>
<a href="#l15.323"></a><span id="l15.323"> NS_IMETHODIMP</span>
<a href="#l15.324"></a><span id="l15.324"> morkStore::GetRow( // access one row with specific oid</span>
<a href="#l15.325"></a><span id="l15.325">   nsIMdbEnv* mev, // context</span>
<a href="#l15.326"></a><span id="l15.326">   const mdbOid* inOid,  // hypothetical row oid</span>
<a href="#l15.327"></a><span id="l15.327">   nsIMdbRow** acqRow) // acquire specific row (or null)</span>
<a href="#l15.328"></a><span id="l15.328"> {</span>
<a href="#l15.329"></a><span id="l15.329" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.330"></a><span id="l15.330" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.331"></a><span id="l15.331">   nsIMdbRow* outRow = 0;</span>
<a href="#l15.332"></a><span id="l15.332">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.333"></a><span id="l15.333">   if ( ev )</span>
<a href="#l15.334"></a><span id="l15.334">   {</span>
<a href="#l15.335"></a><span id="l15.335">     morkRow* row = GetRow(ev, inOid);</span>
<a href="#l15.336"></a><span id="l15.336">     if ( row &amp;&amp; ev-&gt;Good() )</span>
<a href="#l15.337"></a><span id="l15.337">       outRow = row-&gt;AcquireRowHandle(ev, this);</span>
<a href="#l15.338"></a><span id="l15.338">       </span>
<a href="#l15.339"></a><span id="l15.339" class="difflineat">@@ -1740,17 +1740,17 @@ morkStore::GetRow( // access one row wit</span>
<a href="#l15.340"></a><span id="l15.340"> }</span>
<a href="#l15.341"></a><span id="l15.341"> </span>
<a href="#l15.342"></a><span id="l15.342"> NS_IMETHODIMP</span>
<a href="#l15.343"></a><span id="l15.343"> morkStore::GetRowRefCount( // get number of tables that contain a row </span>
<a href="#l15.344"></a><span id="l15.344">   nsIMdbEnv* mev, // context</span>
<a href="#l15.345"></a><span id="l15.345">   const mdbOid* inOid,  // hypothetical row oid</span>
<a href="#l15.346"></a><span id="l15.346">   mdb_count* outRefCount) // number of tables containing inRowKey </span>
<a href="#l15.347"></a><span id="l15.347"> {</span>
<a href="#l15.348"></a><span id="l15.348" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.349"></a><span id="l15.349" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.350"></a><span id="l15.350">   mdb_count count = 0;</span>
<a href="#l15.351"></a><span id="l15.351">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.352"></a><span id="l15.352">   if ( ev )</span>
<a href="#l15.353"></a><span id="l15.353">   {</span>
<a href="#l15.354"></a><span id="l15.354">     morkRow* row = GetRow(ev, inOid);</span>
<a href="#l15.355"></a><span id="l15.355">     if ( row &amp;&amp; ev-&gt;Good() )</span>
<a href="#l15.356"></a><span id="l15.356">       count = row-&gt;mRow_GcUses;</span>
<a href="#l15.357"></a><span id="l15.357">       </span>
<a href="#l15.358"></a><span id="l15.358" class="difflineat">@@ -1795,17 +1795,17 @@ morkStore::FindRow(nsIMdbEnv* mev, // se</span>
<a href="#l15.359"></a><span id="l15.359">   // even though some duplicate row might still live within the rowspace.)</span>
<a href="#l15.360"></a><span id="l15.360">   //</span>
<a href="#l15.361"></a><span id="l15.361">   // In other words, the FindRow() implementation is allowed to assume simple</span>
<a href="#l15.362"></a><span id="l15.362">   // hash tables mapping unqiue column keys to associated row values will be</span>
<a href="#l15.363"></a><span id="l15.363">   // sufficient, where any duplication is not recorded because only one copy</span>
<a href="#l15.364"></a><span id="l15.364">   // of a given key need be remembered.  Implementors are not required to sort</span>
<a href="#l15.365"></a><span id="l15.365">   // all rows by the specified column.</span>
<a href="#l15.366"></a><span id="l15.366"> {</span>
<a href="#l15.367"></a><span id="l15.367" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.368"></a><span id="l15.368" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.369"></a><span id="l15.369">   nsIMdbRow* outRow = 0;</span>
<a href="#l15.370"></a><span id="l15.370">   mdbOid rowOid;</span>
<a href="#l15.371"></a><span id="l15.371">   rowOid.mOid_Scope = 0;</span>
<a href="#l15.372"></a><span id="l15.372">   rowOid.mOid_Id = (mdb_id) -1;</span>
<a href="#l15.373"></a><span id="l15.373">   </span>
<a href="#l15.374"></a><span id="l15.374">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.375"></a><span id="l15.375">   if ( ev )</span>
<a href="#l15.376"></a><span id="l15.376">   {</span>
<a href="#l15.377"></a><span id="l15.377" class="difflineat">@@ -1830,17 +1830,17 @@ morkStore::FindRow(nsIMdbEnv* mev, // se</span>
<a href="#l15.378"></a><span id="l15.378"> </span>
<a href="#l15.379"></a><span id="l15.379"> // { ----- begin table methods -----  </span>
<a href="#l15.380"></a><span id="l15.380"> NS_IMETHODIMP</span>
<a href="#l15.381"></a><span id="l15.381"> morkStore::HasTable( // supports a table with the specified oid?</span>
<a href="#l15.382"></a><span id="l15.382">   nsIMdbEnv* mev, // context</span>
<a href="#l15.383"></a><span id="l15.383">   const mdbOid* inOid,  // hypothetical table oid</span>
<a href="#l15.384"></a><span id="l15.384">   mdb_bool* outHasTable) // whether GetTable() might succeed</span>
<a href="#l15.385"></a><span id="l15.385"> {</span>
<a href="#l15.386"></a><span id="l15.386" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.387"></a><span id="l15.387" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.388"></a><span id="l15.388">   mork_bool hasTable = morkBool_kFalse;</span>
<a href="#l15.389"></a><span id="l15.389">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.390"></a><span id="l15.390">   if ( ev )</span>
<a href="#l15.391"></a><span id="l15.391">   {</span>
<a href="#l15.392"></a><span id="l15.392">     morkTable* table = GetTable(ev, inOid);</span>
<a href="#l15.393"></a><span id="l15.393">     if ( table )</span>
<a href="#l15.394"></a><span id="l15.394">       hasTable = morkBool_kTrue;</span>
<a href="#l15.395"></a><span id="l15.395">     </span>
<a href="#l15.396"></a><span id="l15.396" class="difflineat">@@ -1852,17 +1852,17 @@ morkStore::HasTable( // supports a table</span>
<a href="#l15.397"></a><span id="l15.397"> }</span>
<a href="#l15.398"></a><span id="l15.398">   </span>
<a href="#l15.399"></a><span id="l15.399"> NS_IMETHODIMP</span>
<a href="#l15.400"></a><span id="l15.400"> morkStore::GetTable( // access one table with specific oid</span>
<a href="#l15.401"></a><span id="l15.401">   nsIMdbEnv* mev, // context</span>
<a href="#l15.402"></a><span id="l15.402">   const mdbOid* inOid,  // hypothetical table oid</span>
<a href="#l15.403"></a><span id="l15.403">   nsIMdbTable** acqTable) // acquire specific table (or null)</span>
<a href="#l15.404"></a><span id="l15.404"> {</span>
<a href="#l15.405"></a><span id="l15.405" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.406"></a><span id="l15.406" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.407"></a><span id="l15.407">   nsIMdbTable* outTable = 0;</span>
<a href="#l15.408"></a><span id="l15.408">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.409"></a><span id="l15.409">   if ( ev )</span>
<a href="#l15.410"></a><span id="l15.410">   {</span>
<a href="#l15.411"></a><span id="l15.411">     morkTable* table = GetTable(ev, inOid);</span>
<a href="#l15.412"></a><span id="l15.412">     if ( table &amp;&amp; ev-&gt;Good() )</span>
<a href="#l15.413"></a><span id="l15.413">       outTable = table-&gt;AcquireTableHandle(ev);</span>
<a href="#l15.414"></a><span id="l15.414">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.415"></a><span id="l15.415" class="difflineat">@@ -1875,17 +1875,17 @@ morkStore::GetTable( // access one table</span>
<a href="#l15.416"></a><span id="l15.416"> NS_IMETHODIMP</span>
<a href="#l15.417"></a><span id="l15.417"> morkStore::HasTableKind( // supports a table of the specified type?</span>
<a href="#l15.418"></a><span id="l15.418">   nsIMdbEnv* mev, // context</span>
<a href="#l15.419"></a><span id="l15.419">   mdb_scope inRowScope, // rid scope for row ids</span>
<a href="#l15.420"></a><span id="l15.420">   mdb_kind inTableKind, // the type of table to access</span>
<a href="#l15.421"></a><span id="l15.421">   mdb_count* outTableCount, // current number of such tables</span>
<a href="#l15.422"></a><span id="l15.422">   mdb_bool* outSupportsTable) // whether GetTableKind() might succeed</span>
<a href="#l15.423"></a><span id="l15.423"> {</span>
<a href="#l15.424"></a><span id="l15.424" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.425"></a><span id="l15.425" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.426"></a><span id="l15.426">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.427"></a><span id="l15.427">   if ( ev )</span>
<a href="#l15.428"></a><span id="l15.428">   {</span>
<a href="#l15.429"></a><span id="l15.429">     *outSupportsTable = HasTableKind(ev, inRowScope,</span>
<a href="#l15.430"></a><span id="l15.430">         inTableKind, outTableCount);</span>
<a href="#l15.431"></a><span id="l15.431">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.432"></a><span id="l15.432">   }</span>
<a href="#l15.433"></a><span id="l15.433">   return outErr;</span>
<a href="#l15.434"></a><span id="l15.434" class="difflineat">@@ -1895,17 +1895,17 @@ NS_IMETHODIMP</span>
<a href="#l15.435"></a><span id="l15.435"> morkStore::GetTableKind( // access one (random) table of specific type</span>
<a href="#l15.436"></a><span id="l15.436">   nsIMdbEnv* mev, // context</span>
<a href="#l15.437"></a><span id="l15.437">   mdb_scope inRowScope,      // row scope for row ids</span>
<a href="#l15.438"></a><span id="l15.438">   mdb_kind inTableKind,      // the type of table to access</span>
<a href="#l15.439"></a><span id="l15.439">   mdb_count* outTableCount, // current number of such tables</span>
<a href="#l15.440"></a><span id="l15.440">   mdb_bool* outMustBeUnique, // whether port can hold only one of these</span>
<a href="#l15.441"></a><span id="l15.441">   nsIMdbTable** acqTable)      // acquire scoped collection of rows</span>
<a href="#l15.442"></a><span id="l15.442"> {</span>
<a href="#l15.443"></a><span id="l15.443" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.444"></a><span id="l15.444" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.445"></a><span id="l15.445">   nsIMdbTable* outTable = 0;</span>
<a href="#l15.446"></a><span id="l15.446">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.447"></a><span id="l15.447">   if ( ev )</span>
<a href="#l15.448"></a><span id="l15.448">   {</span>
<a href="#l15.449"></a><span id="l15.449">     morkTable* table = GetTableKind(ev, inRowScope,</span>
<a href="#l15.450"></a><span id="l15.450">         inTableKind, outTableCount, outMustBeUnique);</span>
<a href="#l15.451"></a><span id="l15.451">     if ( table &amp;&amp; ev-&gt;Good() )</span>
<a href="#l15.452"></a><span id="l15.452">       outTable = table-&gt;AcquireTableHandle(ev);</span>
<a href="#l15.453"></a><span id="l15.453" class="difflineat">@@ -1918,17 +1918,17 @@ morkStore::GetTableKind( // access one (</span>
<a href="#l15.454"></a><span id="l15.454">   </span>
<a href="#l15.455"></a><span id="l15.455"> NS_IMETHODIMP</span>
<a href="#l15.456"></a><span id="l15.456"> morkStore::GetPortTableCursor( // get cursor for all tables of specific type</span>
<a href="#l15.457"></a><span id="l15.457">   nsIMdbEnv* mev, // context</span>
<a href="#l15.458"></a><span id="l15.458">   mdb_scope inRowScope, // row scope for row ids</span>
<a href="#l15.459"></a><span id="l15.459">   mdb_kind inTableKind, // the type of table to access</span>
<a href="#l15.460"></a><span id="l15.460">   nsIMdbPortTableCursor** acqCursor) // all such tables in the port</span>
<a href="#l15.461"></a><span id="l15.461"> {</span>
<a href="#l15.462"></a><span id="l15.462" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.463"></a><span id="l15.463" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.464"></a><span id="l15.464">   nsIMdbPortTableCursor* outCursor = 0;</span>
<a href="#l15.465"></a><span id="l15.465">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.466"></a><span id="l15.466">   if ( ev )</span>
<a href="#l15.467"></a><span id="l15.467">   {</span>
<a href="#l15.468"></a><span id="l15.468">     morkPortTableCursor* cursor =</span>
<a href="#l15.469"></a><span id="l15.469">       GetPortTableCursor(ev, inRowScope,</span>
<a href="#l15.470"></a><span id="l15.470">         inTableKind);</span>
<a href="#l15.471"></a><span id="l15.471">     if ( cursor &amp;&amp; ev-&gt;Good() )</span>
<a href="#l15.472"></a><span id="l15.472" class="difflineat">@@ -1948,17 +1948,17 @@ NS_IMETHODIMP</span>
<a href="#l15.473"></a><span id="l15.473"> morkStore::ShouldCompress( // store wastes at least inPercentWaste?</span>
<a href="#l15.474"></a><span id="l15.474">   nsIMdbEnv* mev, // context</span>
<a href="#l15.475"></a><span id="l15.475">   mdb_percent inPercentWaste, // 0..100 percent file size waste threshold</span>
<a href="#l15.476"></a><span id="l15.476">   mdb_percent* outActualWaste, // 0..100 percent of file actually wasted</span>
<a href="#l15.477"></a><span id="l15.477">   mdb_bool* outShould) // true when about inPercentWaste% is wasted</span>
<a href="#l15.478"></a><span id="l15.478"> {</span>
<a href="#l15.479"></a><span id="l15.479">   mdb_percent actualWaste = 0;</span>
<a href="#l15.480"></a><span id="l15.480">   mdb_bool shouldCompress = morkBool_kFalse;</span>
<a href="#l15.481"></a><span id="l15.481" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.482"></a><span id="l15.482" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.483"></a><span id="l15.483">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.484"></a><span id="l15.484">   if ( ev )</span>
<a href="#l15.485"></a><span id="l15.485">   {</span>
<a href="#l15.486"></a><span id="l15.486">     actualWaste = PercentOfStoreWasted(ev);</span>
<a href="#l15.487"></a><span id="l15.487">     if ( inPercentWaste &gt; 100 )</span>
<a href="#l15.488"></a><span id="l15.488">       inPercentWaste = 100;</span>
<a href="#l15.489"></a><span id="l15.489">     shouldCompress = ( actualWaste &gt;= inPercentWaste );</span>
<a href="#l15.490"></a><span id="l15.490">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.491"></a><span id="l15.491" class="difflineat">@@ -1977,17 +1977,17 @@ NS_IMETHODIMP</span>
<a href="#l15.492"></a><span id="l15.492"> morkStore::NewTable( // make one new table of specific type</span>
<a href="#l15.493"></a><span id="l15.493">   nsIMdbEnv* mev, // context</span>
<a href="#l15.494"></a><span id="l15.494">   mdb_scope inRowScope,    // row scope for row ids</span>
<a href="#l15.495"></a><span id="l15.495">   mdb_kind inTableKind,    // the type of table to access</span>
<a href="#l15.496"></a><span id="l15.496">   mdb_bool inMustBeUnique, // whether store can hold only one of these</span>
<a href="#l15.497"></a><span id="l15.497">   const mdbOid* inOptionalMetaRowOid, // can be nil to avoid specifying </span>
<a href="#l15.498"></a><span id="l15.498">   nsIMdbTable** acqTable)     // acquire scoped collection of rows</span>
<a href="#l15.499"></a><span id="l15.499"> {</span>
<a href="#l15.500"></a><span id="l15.500" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.501"></a><span id="l15.501" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.502"></a><span id="l15.502">   nsIMdbTable* outTable = 0;</span>
<a href="#l15.503"></a><span id="l15.503">   morkEnv* ev = this-&gt;CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.504"></a><span id="l15.504">   if ( ev )</span>
<a href="#l15.505"></a><span id="l15.505">   {</span>
<a href="#l15.506"></a><span id="l15.506">     morkTable* table = NewTable(ev, inRowScope,</span>
<a href="#l15.507"></a><span id="l15.507">         inTableKind, inMustBeUnique, inOptionalMetaRowOid);</span>
<a href="#l15.508"></a><span id="l15.508">     if ( table &amp;&amp; ev-&gt;Good() )</span>
<a href="#l15.509"></a><span id="l15.509">       outTable = table-&gt;AcquireTableHandle(ev);</span>
<a href="#l15.510"></a><span id="l15.510" class="difflineat">@@ -2002,17 +2002,17 @@ NS_IMETHODIMP</span>
<a href="#l15.511"></a><span id="l15.511"> morkStore::NewTableWithOid( // make one new table of specific type</span>
<a href="#l15.512"></a><span id="l15.512">   nsIMdbEnv* mev, // context</span>
<a href="#l15.513"></a><span id="l15.513">   const mdbOid* inOid,   // caller assigned oid</span>
<a href="#l15.514"></a><span id="l15.514">   mdb_kind inTableKind,    // the type of table to access</span>
<a href="#l15.515"></a><span id="l15.515">   mdb_bool inMustBeUnique, // whether store can hold only one of these</span>
<a href="#l15.516"></a><span id="l15.516">   const mdbOid* inOptionalMetaRowOid, // can be nil to avoid specifying </span>
<a href="#l15.517"></a><span id="l15.517">   nsIMdbTable** acqTable)     // acquire scoped collection of rows</span>
<a href="#l15.518"></a><span id="l15.518"> {</span>
<a href="#l15.519"></a><span id="l15.519" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.520"></a><span id="l15.520" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.521"></a><span id="l15.521">   nsIMdbTable* outTable = 0;</span>
<a href="#l15.522"></a><span id="l15.522">   morkEnv* ev = CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.523"></a><span id="l15.523">   if ( ev )</span>
<a href="#l15.524"></a><span id="l15.524">   {</span>
<a href="#l15.525"></a><span id="l15.525">     morkTable* table = OidToTable(ev, inOid,</span>
<a href="#l15.526"></a><span id="l15.526">       inOptionalMetaRowOid);</span>
<a href="#l15.527"></a><span id="l15.527">     if ( table &amp;&amp; ev-&gt;Good() )</span>
<a href="#l15.528"></a><span id="l15.528">     {</span>
<a href="#l15.529"></a><span id="l15.529" class="difflineat">@@ -2062,17 +2062,17 @@ morkStore::SetStoreAssignedIds(nsIMdbEnv</span>
<a href="#l15.530"></a><span id="l15.530"> // } ----- end row scope methods -----</span>
<a href="#l15.531"></a><span id="l15.531"> </span>
<a href="#l15.532"></a><span id="l15.532"> // { ----- begin row methods -----</span>
<a href="#l15.533"></a><span id="l15.533"> NS_IMETHODIMP</span>
<a href="#l15.534"></a><span id="l15.534"> morkStore::NewRowWithOid(nsIMdbEnv* mev, // new row w/ caller assigned oid</span>
<a href="#l15.535"></a><span id="l15.535">   const mdbOid* inOid,   // caller assigned oid</span>
<a href="#l15.536"></a><span id="l15.536">   nsIMdbRow** acqRow) // create new row</span>
<a href="#l15.537"></a><span id="l15.537"> {</span>
<a href="#l15.538"></a><span id="l15.538" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.539"></a><span id="l15.539" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.540"></a><span id="l15.540">   nsIMdbRow* outRow = 0;</span>
<a href="#l15.541"></a><span id="l15.541">   morkEnv* ev = CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.542"></a><span id="l15.542">   if ( ev )</span>
<a href="#l15.543"></a><span id="l15.543">   {</span>
<a href="#l15.544"></a><span id="l15.544">     morkRow* row = NewRowWithOid(ev, inOid);</span>
<a href="#l15.545"></a><span id="l15.545">     if ( row &amp;&amp; ev-&gt;Good() )</span>
<a href="#l15.546"></a><span id="l15.546">       outRow = row-&gt;AcquireRowHandle(ev, this);</span>
<a href="#l15.547"></a><span id="l15.547">       </span>
<a href="#l15.548"></a><span id="l15.548" class="difflineat">@@ -2085,17 +2085,17 @@ morkStore::NewRowWithOid(nsIMdbEnv* mev,</span>
<a href="#l15.549"></a><span id="l15.549"> </span>
<a href="#l15.550"></a><span id="l15.550"> NS_IMETHODIMP</span>
<a href="#l15.551"></a><span id="l15.551"> morkStore::NewRow(nsIMdbEnv* mev, // new row with db assigned oid</span>
<a href="#l15.552"></a><span id="l15.552">   mdb_scope inRowScope,   // row scope for row ids</span>
<a href="#l15.553"></a><span id="l15.553">   nsIMdbRow** acqRow) // create new row</span>
<a href="#l15.554"></a><span id="l15.554"> // Note this row must be added to some table or cell child before the</span>
<a href="#l15.555"></a><span id="l15.555"> // store is closed in order to make this row persist across sesssions.</span>
<a href="#l15.556"></a><span id="l15.556"> {</span>
<a href="#l15.557"></a><span id="l15.557" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.558"></a><span id="l15.558" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.559"></a><span id="l15.559">   nsIMdbRow* outRow = 0;</span>
<a href="#l15.560"></a><span id="l15.560">   morkEnv* ev = CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.561"></a><span id="l15.561">   if ( ev )</span>
<a href="#l15.562"></a><span id="l15.562">   {</span>
<a href="#l15.563"></a><span id="l15.563">     morkRow* row = NewRow(ev, inRowScope);</span>
<a href="#l15.564"></a><span id="l15.564">     if ( row &amp;&amp; ev-&gt;Good() )</span>
<a href="#l15.565"></a><span id="l15.565">       outRow = row-&gt;AcquireRowHandle(ev, this);</span>
<a href="#l15.566"></a><span id="l15.566">       </span>
<a href="#l15.567"></a><span id="l15.567" class="difflineat">@@ -2137,33 +2137,33 @@ morkStore::ImportFile( // import content</span>
<a href="#l15.568"></a><span id="l15.568"> // { ----- begin hinting methods -----</span>
<a href="#l15.569"></a><span id="l15.569"> NS_IMETHODIMP</span>
<a href="#l15.570"></a><span id="l15.570"> morkStore::ShareAtomColumnsHint( // advise re shared col content atomizing</span>
<a href="#l15.571"></a><span id="l15.571">   nsIMdbEnv* mev, // context</span>
<a href="#l15.572"></a><span id="l15.572">   mdb_scope inScopeHint, // zero, or suggested shared namespace</span>
<a href="#l15.573"></a><span id="l15.573">   const mdbColumnSet* inColumnSet) // cols desired tokenized together</span>
<a href="#l15.574"></a><span id="l15.574"> {</span>
<a href="#l15.575"></a><span id="l15.575">   MORK_USED_2(inColumnSet,inScopeHint);</span>
<a href="#l15.576"></a><span id="l15.576" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.577"></a><span id="l15.577" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.578"></a><span id="l15.578">   morkEnv* ev = CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.579"></a><span id="l15.579">   if ( ev )</span>
<a href="#l15.580"></a><span id="l15.580">   {</span>
<a href="#l15.581"></a><span id="l15.581">     // ev-&gt;StubMethodOnlyError(); // okay to do nothing for a hint method</span>
<a href="#l15.582"></a><span id="l15.582">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.583"></a><span id="l15.583">   }</span>
<a href="#l15.584"></a><span id="l15.584">   return outErr;</span>
<a href="#l15.585"></a><span id="l15.585"> }</span>
<a href="#l15.586"></a><span id="l15.586"> </span>
<a href="#l15.587"></a><span id="l15.587"> NS_IMETHODIMP</span>
<a href="#l15.588"></a><span id="l15.588"> morkStore::AvoidAtomColumnsHint( // advise col w/ poor atomizing prospects</span>
<a href="#l15.589"></a><span id="l15.589">   nsIMdbEnv* mev, // context</span>
<a href="#l15.590"></a><span id="l15.590">   const mdbColumnSet* inColumnSet) // cols with poor atomizing prospects</span>
<a href="#l15.591"></a><span id="l15.591"> {</span>
<a href="#l15.592"></a><span id="l15.592">   MORK_USED_1(inColumnSet);</span>
<a href="#l15.593"></a><span id="l15.593" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l15.594"></a><span id="l15.594" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l15.595"></a><span id="l15.595">   morkEnv* ev = CanUseStore(mev, /*inMutable*/ morkBool_kFalse, &amp;outErr);</span>
<a href="#l15.596"></a><span id="l15.596">   if ( ev )</span>
<a href="#l15.597"></a><span id="l15.597">   {</span>
<a href="#l15.598"></a><span id="l15.598">     // ev-&gt;StubMethodOnlyError(); // okay to do nothing for a hint method</span>
<a href="#l15.599"></a><span id="l15.599">     outErr = ev-&gt;AsErr();</span>
<a href="#l15.600"></a><span id="l15.600">   }</span>
<a href="#l15.601"></a><span id="l15.601">   return outErr;</span>
<a href="#l15.602"></a><span id="l15.602"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/db/mork/src/morkStore.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/db/mork/src/morkStore.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -621,17 +621,18 @@ public: // morkStore construction &amp; dest</span>
<a href="#l16.4"></a><span id="l16.4">      );</span>
<a href="#l16.5"></a><span id="l16.5">   void CloseStore(morkEnv* ev); // called by CloseMorkNode();</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7"> private: // copying is not allowed</span>
<a href="#l16.8"></a><span id="l16.8">   morkStore(const morkStore&amp; other);</span>
<a href="#l16.9"></a><span id="l16.9">   morkStore&amp; operator=(const morkStore&amp; other);</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11"> public: // dynamic type identification</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  morkEnv*  CanUseStore(nsIMdbEnv* mev, mork_bool inMutable, mdb_err* outErr) const;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  morkEnv* CanUseStore(nsIMdbEnv* mev, mork_bool inMutable,</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+                       nsresult* outErr) const;</span>
<a href="#l16.15"></a><span id="l16.15">    mork_bool IsStore() const</span>
<a href="#l16.16"></a><span id="l16.16">   { return IsNode() &amp;&amp; mNode_Derived == morkDerived_kStore; }</span>
<a href="#l16.17"></a><span id="l16.17"> // } ===== end morkNode methods =====</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19"> public: // typing</span>
<a href="#l16.20"></a><span id="l16.20">   static void NonStoreTypeError(morkEnv* ev);</span>
<a href="#l16.21"></a><span id="l16.21">   static void NilStoreFileError(morkEnv* ev);</span>
<a href="#l16.22"></a><span id="l16.22">   static void CannotAutoAssignAtomIdentityError(morkEnv* ev);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/db/mork/src/morkTable.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/db/mork/src/morkTable.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -171,17 +171,17 @@ morkTable::CloseTable(morkEnv* ev) /*i*/</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5"> // { ===== begin nsIMdbCollection methods =====</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7"> // { ----- begin attribute methods -----</span>
<a href="#l17.8"></a><span id="l17.8"> NS_IMETHODIMP</span>
<a href="#l17.9"></a><span id="l17.9"> morkTable::GetSeed(nsIMdbEnv* mev,</span>
<a href="#l17.10"></a><span id="l17.10">   mdb_seed* outSeed)    // member change count</span>
<a href="#l17.11"></a><span id="l17.11"> {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.14"></a><span id="l17.14">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.15"></a><span id="l17.15">   if ( ev )</span>
<a href="#l17.16"></a><span id="l17.16">   {</span>
<a href="#l17.17"></a><span id="l17.17">     *outSeed = mTable_RowArray.mArray_Seed;</span>
<a href="#l17.18"></a><span id="l17.18">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.19"></a><span id="l17.19">   }</span>
<a href="#l17.20"></a><span id="l17.20">   return outErr;</span>
<a href="#l17.21"></a><span id="l17.21"> }</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -254,33 +254,33 @@ morkTable::DropActivity( // tell collect</span>
<a href="#l17.23"></a><span id="l17.23"> </span>
<a href="#l17.24"></a><span id="l17.24"> // { ===== begin nsIMdbTable methods =====</span>
<a href="#l17.25"></a><span id="l17.25"> </span>
<a href="#l17.26"></a><span id="l17.26"> // { ----- begin attribute methods -----</span>
<a href="#l17.27"></a><span id="l17.27"> </span>
<a href="#l17.28"></a><span id="l17.28"> NS_IMETHODIMP</span>
<a href="#l17.29"></a><span id="l17.29"> morkTable::SetTablePriority(nsIMdbEnv* mev, mdb_priority inPrio)</span>
<a href="#l17.30"></a><span id="l17.30"> {</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.33"></a><span id="l17.33">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.34"></a><span id="l17.34">   if ( ev )</span>
<a href="#l17.35"></a><span id="l17.35">   {</span>
<a href="#l17.36"></a><span id="l17.36">     if ( inPrio &gt; morkPriority_kMax )</span>
<a href="#l17.37"></a><span id="l17.37">       inPrio = morkPriority_kMax;</span>
<a href="#l17.38"></a><span id="l17.38">       </span>
<a href="#l17.39"></a><span id="l17.39">     mTable_Priority = inPrio;</span>
<a href="#l17.40"></a><span id="l17.40">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.41"></a><span id="l17.41">   }</span>
<a href="#l17.42"></a><span id="l17.42">   return outErr;</span>
<a href="#l17.43"></a><span id="l17.43"> }</span>
<a href="#l17.44"></a><span id="l17.44"> </span>
<a href="#l17.45"></a><span id="l17.45"> NS_IMETHODIMP</span>
<a href="#l17.46"></a><span id="l17.46"> morkTable::GetTablePriority(nsIMdbEnv* mev, mdb_priority* outPrio)</span>
<a href="#l17.47"></a><span id="l17.47"> {</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.50"></a><span id="l17.50">   mork_priority prio = 0;</span>
<a href="#l17.51"></a><span id="l17.51">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.52"></a><span id="l17.52">   if ( ev )</span>
<a href="#l17.53"></a><span id="l17.53">   {</span>
<a href="#l17.54"></a><span id="l17.54">     prio = mTable_Priority;</span>
<a href="#l17.55"></a><span id="l17.55">     if ( prio &gt; morkPriority_kMax )</span>
<a href="#l17.56"></a><span id="l17.56">     {</span>
<a href="#l17.57"></a><span id="l17.57">       prio = morkPriority_kMax;</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineat">@@ -300,17 +300,17 @@ morkTable:: GetTableBeVerbose(nsIMdbEnv*</span>
<a href="#l17.59"></a><span id="l17.59">   NS_ENSURE_ARG_POINTER(outBeVerbose);</span>
<a href="#l17.60"></a><span id="l17.60">   *outBeVerbose = IsTableVerbose();</span>
<a href="#l17.61"></a><span id="l17.61">   return NS_OK;</span>
<a href="#l17.62"></a><span id="l17.62"> }</span>
<a href="#l17.63"></a><span id="l17.63"> </span>
<a href="#l17.64"></a><span id="l17.64"> NS_IMETHODIMP</span>
<a href="#l17.65"></a><span id="l17.65"> morkTable::SetTableBeVerbose(nsIMdbEnv* mev, mdb_bool inBeVerbose)</span>
<a href="#l17.66"></a><span id="l17.66"> {</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.69"></a><span id="l17.69">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.70"></a><span id="l17.70">   if ( ev )</span>
<a href="#l17.71"></a><span id="l17.71">   {</span>
<a href="#l17.72"></a><span id="l17.72">     if ( inBeVerbose )</span>
<a href="#l17.73"></a><span id="l17.73">       SetTableVerbose();</span>
<a href="#l17.74"></a><span id="l17.74">     else</span>
<a href="#l17.75"></a><span id="l17.75">       ClearTableVerbose();</span>
<a href="#l17.76"></a><span id="l17.76">    </span>
<a href="#l17.77"></a><span id="l17.77" class="difflineat">@@ -333,17 +333,17 @@ morkTable::GetTableKind(nsIMdbEnv* mev, </span>
<a href="#l17.78"></a><span id="l17.78">   NS_ENSURE_ARG_POINTER(outTableKind);</span>
<a href="#l17.79"></a><span id="l17.79">   *outTableKind = mTable_Kind;</span>
<a href="#l17.80"></a><span id="l17.80">   return NS_OK;</span>
<a href="#l17.81"></a><span id="l17.81"> }</span>
<a href="#l17.82"></a><span id="l17.82"> </span>
<a href="#l17.83"></a><span id="l17.83"> NS_IMETHODIMP</span>
<a href="#l17.84"></a><span id="l17.84"> morkTable::GetRowScope(nsIMdbEnv* mev, mdb_scope* outRowScope)</span>
<a href="#l17.85"></a><span id="l17.85"> {</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.88"></a><span id="l17.88">   mdb_scope rowScope = 0;</span>
<a href="#l17.89"></a><span id="l17.89">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.90"></a><span id="l17.90">   if ( ev )</span>
<a href="#l17.91"></a><span id="l17.91">   {</span>
<a href="#l17.92"></a><span id="l17.92">     if ( mTable_RowSpace )</span>
<a href="#l17.93"></a><span id="l17.93">       rowScope = mTable_RowSpace-&gt;SpaceScope();</span>
<a href="#l17.94"></a><span id="l17.94">     else</span>
<a href="#l17.95"></a><span id="l17.95">       NilRowSpaceError(ev);</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineat">@@ -378,17 +378,17 @@ morkTable::GetMetaRow( nsIMdbEnv* mev,</span>
<a href="#l17.97"></a><span id="l17.97">   // manually allocate any row IDs from that special meta scope namespace).</span>
<a href="#l17.98"></a><span id="l17.98">   // The meta row oid can be specified either when the table is created, or</span>
<a href="#l17.99"></a><span id="l17.99">   // else the first time that GetMetaRow() is called, by passing a non-nil</span>
<a href="#l17.100"></a><span id="l17.100">   // pointer to an oid for parameter inOptionalMetaRowOid.  The meta row's</span>
<a href="#l17.101"></a><span id="l17.101">   // actual oid is returned in outOid (if this is a non-nil pointer), and</span>
<a href="#l17.102"></a><span id="l17.102">   // it will be different from inOptionalMetaRowOid when the meta row was</span>
<a href="#l17.103"></a><span id="l17.103">   // already given a different oid earlier.</span>
<a href="#l17.104"></a><span id="l17.104"> {</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.107"></a><span id="l17.107">   nsIMdbRow* outRow = 0;</span>
<a href="#l17.108"></a><span id="l17.108">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.109"></a><span id="l17.109">   if ( ev )</span>
<a href="#l17.110"></a><span id="l17.110">   {</span>
<a href="#l17.111"></a><span id="l17.111">     morkRow* row = GetMetaRow(ev, inOptionalMetaRowOid);</span>
<a href="#l17.112"></a><span id="l17.112">     if ( row &amp;&amp; ev-&gt;Good() )</span>
<a href="#l17.113"></a><span id="l17.113">     {</span>
<a href="#l17.114"></a><span id="l17.114">       if ( outOid )</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineat">@@ -413,17 +413,17 @@ morkTable::GetMetaRow( nsIMdbEnv* mev,</span>
<a href="#l17.116"></a><span id="l17.116"> </span>
<a href="#l17.117"></a><span id="l17.117"> // { ----- begin cursor methods -----</span>
<a href="#l17.118"></a><span id="l17.118"> NS_IMETHODIMP</span>
<a href="#l17.119"></a><span id="l17.119"> morkTable::GetTableRowCursor( // make a cursor, starting iteration at inRowPos</span>
<a href="#l17.120"></a><span id="l17.120">   nsIMdbEnv* mev, // context</span>
<a href="#l17.121"></a><span id="l17.121">   mdb_pos inRowPos, // zero-based ordinal position of row in table</span>
<a href="#l17.122"></a><span id="l17.122">   nsIMdbTableRowCursor** acqCursor) // acquire new cursor instance</span>
<a href="#l17.123"></a><span id="l17.123"> {</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.126"></a><span id="l17.126">   nsIMdbTableRowCursor* outCursor = 0;</span>
<a href="#l17.127"></a><span id="l17.127">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.128"></a><span id="l17.128">   if ( ev )</span>
<a href="#l17.129"></a><span id="l17.129">   {</span>
<a href="#l17.130"></a><span id="l17.130">     morkTableRowCursor* cursor = NewTableRowCursor(ev, inRowPos);</span>
<a href="#l17.131"></a><span id="l17.131">     if ( cursor )</span>
<a href="#l17.132"></a><span id="l17.132">     {</span>
<a href="#l17.133"></a><span id="l17.133">       if ( ev-&gt;Good() )</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineat">@@ -444,17 +444,17 @@ morkTable::GetTableRowCursor( // make a </span>
<a href="#l17.135"></a><span id="l17.135"> </span>
<a href="#l17.136"></a><span id="l17.136"> // { ----- begin row position methods -----</span>
<a href="#l17.137"></a><span id="l17.137"> NS_IMETHODIMP</span>
<a href="#l17.138"></a><span id="l17.138"> morkTable::PosToOid( // get row member for a table position</span>
<a href="#l17.139"></a><span id="l17.139">   nsIMdbEnv* mev, // context</span>
<a href="#l17.140"></a><span id="l17.140">   mdb_pos inRowPos, // zero-based ordinal position of row in table</span>
<a href="#l17.141"></a><span id="l17.141">   mdbOid* outOid) // row oid at the specified position</span>
<a href="#l17.142"></a><span id="l17.142"> {</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.145"></a><span id="l17.145">   mdbOid roid;</span>
<a href="#l17.146"></a><span id="l17.146">   roid.mOid_Scope = 0;</span>
<a href="#l17.147"></a><span id="l17.147">   roid.mOid_Id = (mork_id) -1;</span>
<a href="#l17.148"></a><span id="l17.148">   </span>
<a href="#l17.149"></a><span id="l17.149">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.150"></a><span id="l17.150">   if ( ev )</span>
<a href="#l17.151"></a><span id="l17.151">   {</span>
<a href="#l17.152"></a><span id="l17.152">     morkRow* row = SafeRowAt(ev, inRowPos);</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineat">@@ -469,17 +469,17 @@ morkTable::PosToOid( // get row member f</span>
<a href="#l17.154"></a><span id="l17.154"> }</span>
<a href="#l17.155"></a><span id="l17.155"> </span>
<a href="#l17.156"></a><span id="l17.156"> NS_IMETHODIMP</span>
<a href="#l17.157"></a><span id="l17.157"> morkTable::OidToPos( // test for the table position of a row member</span>
<a href="#l17.158"></a><span id="l17.158">   nsIMdbEnv* mev, // context</span>
<a href="#l17.159"></a><span id="l17.159">   const mdbOid* inOid, // row to find in table</span>
<a href="#l17.160"></a><span id="l17.160">   mdb_pos* outPos) // zero-based ordinal position of row in table</span>
<a href="#l17.161"></a><span id="l17.161"> {</span>
<a href="#l17.162"></a><span id="l17.162" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.164"></a><span id="l17.164">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.165"></a><span id="l17.165">   if ( ev )</span>
<a href="#l17.166"></a><span id="l17.166">   {</span>
<a href="#l17.167"></a><span id="l17.167">     mork_pos pos = ArrayHasOid(ev, inOid);</span>
<a href="#l17.168"></a><span id="l17.168">     if ( outPos )</span>
<a href="#l17.169"></a><span id="l17.169">       *outPos = pos;</span>
<a href="#l17.170"></a><span id="l17.170">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.171"></a><span id="l17.171">   }</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineat">@@ -487,17 +487,17 @@ morkTable::OidToPos( // test for the tab</span>
<a href="#l17.173"></a><span id="l17.173"> }</span>
<a href="#l17.174"></a><span id="l17.174"> </span>
<a href="#l17.175"></a><span id="l17.175"> NS_IMETHODIMP</span>
<a href="#l17.176"></a><span id="l17.176"> morkTable::PosToRow( // get row member for a table position</span>
<a href="#l17.177"></a><span id="l17.177">   nsIMdbEnv* mev, // context</span>
<a href="#l17.178"></a><span id="l17.178">   mdb_pos inRowPos, // zero-based ordinal position of row in table</span>
<a href="#l17.179"></a><span id="l17.179">   nsIMdbRow** acqRow) // acquire row at table position inRowPos</span>
<a href="#l17.180"></a><span id="l17.180"> {</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.183"></a><span id="l17.183">   nsIMdbRow* outRow = 0;</span>
<a href="#l17.184"></a><span id="l17.184">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.185"></a><span id="l17.185">   if ( ev )</span>
<a href="#l17.186"></a><span id="l17.186">   {</span>
<a href="#l17.187"></a><span id="l17.187">     morkRow* row = SafeRowAt(ev, inRowPos);</span>
<a href="#l17.188"></a><span id="l17.188">     if ( row &amp;&amp; mTable_Store )</span>
<a href="#l17.189"></a><span id="l17.189">       outRow = row-&gt;AcquireRowHandle(ev, mTable_Store);</span>
<a href="#l17.190"></a><span id="l17.190">       </span>
<a href="#l17.191"></a><span id="l17.191" class="difflineat">@@ -509,17 +509,17 @@ morkTable::PosToRow( // get row member f</span>
<a href="#l17.192"></a><span id="l17.192"> }</span>
<a href="#l17.193"></a><span id="l17.193"> </span>
<a href="#l17.194"></a><span id="l17.194"> NS_IMETHODIMP</span>
<a href="#l17.195"></a><span id="l17.195"> morkTable::RowToPos( // test for the table position of a row member</span>
<a href="#l17.196"></a><span id="l17.196">   nsIMdbEnv* mev, // context</span>
<a href="#l17.197"></a><span id="l17.197">   nsIMdbRow* ioRow, // row to find in table</span>
<a href="#l17.198"></a><span id="l17.198">   mdb_pos* outPos) // zero-based ordinal position of row in table</span>
<a href="#l17.199"></a><span id="l17.199"> {</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.202"></a><span id="l17.202">   mork_pos pos = -1;</span>
<a href="#l17.203"></a><span id="l17.203">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.204"></a><span id="l17.204">   if ( ev )</span>
<a href="#l17.205"></a><span id="l17.205">   {</span>
<a href="#l17.206"></a><span id="l17.206">     morkRowObject* row = (morkRowObject*) ioRow;</span>
<a href="#l17.207"></a><span id="l17.207">     pos = ArrayHasOid(ev, &amp;row-&gt;mRowObject_Row-&gt;mRow_Oid);</span>
<a href="#l17.208"></a><span id="l17.208">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.209"></a><span id="l17.209">   }</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineat">@@ -542,33 +542,33 @@ morkTable::AddOid( // make sure the row </span>
<a href="#l17.211"></a><span id="l17.211"> }</span>
<a href="#l17.212"></a><span id="l17.212"> </span>
<a href="#l17.213"></a><span id="l17.213"> NS_IMETHODIMP</span>
<a href="#l17.214"></a><span id="l17.214"> morkTable::HasOid( // test for the table position of a row member</span>
<a href="#l17.215"></a><span id="l17.215">   nsIMdbEnv* mev, // context</span>
<a href="#l17.216"></a><span id="l17.216">   const mdbOid* inOid, // row to find in table</span>
<a href="#l17.217"></a><span id="l17.217">   mdb_bool* outHasOid) // whether inOid is a member row</span>
<a href="#l17.218"></a><span id="l17.218"> {</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.221"></a><span id="l17.221">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.222"></a><span id="l17.222">   if ( ev )</span>
<a href="#l17.223"></a><span id="l17.223">   {</span>
<a href="#l17.224"></a><span id="l17.224">     if ( outHasOid )</span>
<a href="#l17.225"></a><span id="l17.225">       *outHasOid = MapHasOid(ev, inOid);</span>
<a href="#l17.226"></a><span id="l17.226">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.227"></a><span id="l17.227">   }</span>
<a href="#l17.228"></a><span id="l17.228">   return outErr;</span>
<a href="#l17.229"></a><span id="l17.229"> }</span>
<a href="#l17.230"></a><span id="l17.230"> </span>
<a href="#l17.231"></a><span id="l17.231"> NS_IMETHODIMP</span>
<a href="#l17.232"></a><span id="l17.232"> morkTable::CutOid( // make sure the row with inOid is not a member </span>
<a href="#l17.233"></a><span id="l17.233">   nsIMdbEnv* mev, // context</span>
<a href="#l17.234"></a><span id="l17.234">   const mdbOid* inOid) // row to remove from table</span>
<a href="#l17.235"></a><span id="l17.235"> {</span>
<a href="#l17.236"></a><span id="l17.236" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.237"></a><span id="l17.237" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.238"></a><span id="l17.238">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.239"></a><span id="l17.239">   if ( ev )</span>
<a href="#l17.240"></a><span id="l17.240">   {</span>
<a href="#l17.241"></a><span id="l17.241">     if ( inOid &amp;&amp; mTable_Store )</span>
<a href="#l17.242"></a><span id="l17.242">     {</span>
<a href="#l17.243"></a><span id="l17.243">       morkRow* row = mTable_Store-&gt;GetRow(ev, inOid);</span>
<a href="#l17.244"></a><span id="l17.244">       if ( row )</span>
<a href="#l17.245"></a><span id="l17.245">         CutRow(ev, row);</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineat">@@ -584,17 +584,17 @@ morkTable::CutOid( // make sure the row </span>
<a href="#l17.247"></a><span id="l17.247"> </span>
<a href="#l17.248"></a><span id="l17.248"> // { ----- begin row set methods -----</span>
<a href="#l17.249"></a><span id="l17.249"> NS_IMETHODIMP</span>
<a href="#l17.250"></a><span id="l17.250"> morkTable::NewRow( // create a new row instance in table</span>
<a href="#l17.251"></a><span id="l17.251">   nsIMdbEnv* mev, // context</span>
<a href="#l17.252"></a><span id="l17.252">   mdbOid* ioOid, // please use zero (unbound) rowId for db-assigned IDs</span>
<a href="#l17.253"></a><span id="l17.253">   nsIMdbRow** acqRow) // create new row</span>
<a href="#l17.254"></a><span id="l17.254"> {</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.257"></a><span id="l17.257">   nsIMdbRow* outRow = 0;</span>
<a href="#l17.258"></a><span id="l17.258">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.259"></a><span id="l17.259">   if ( ev )</span>
<a href="#l17.260"></a><span id="l17.260">   {</span>
<a href="#l17.261"></a><span id="l17.261">     if ( ioOid &amp;&amp; mTable_Store )</span>
<a href="#l17.262"></a><span id="l17.262">     {</span>
<a href="#l17.263"></a><span id="l17.263">       morkRow* row = 0;</span>
<a href="#l17.264"></a><span id="l17.264">       if ( ioOid-&gt;mOid_Id == morkRow_kMinusOneRid )</span>
<a href="#l17.265"></a><span id="l17.265" class="difflineat">@@ -615,17 +615,17 @@ morkTable::NewRow( // create a new row i</span>
<a href="#l17.266"></a><span id="l17.266">   return outErr;</span>
<a href="#l17.267"></a><span id="l17.267"> }</span>
<a href="#l17.268"></a><span id="l17.268"> </span>
<a href="#l17.269"></a><span id="l17.269"> NS_IMETHODIMP</span>
<a href="#l17.270"></a><span id="l17.270"> morkTable::AddRow( // make sure the row with inOid is a table member </span>
<a href="#l17.271"></a><span id="l17.271">   nsIMdbEnv* mev, // context</span>
<a href="#l17.272"></a><span id="l17.272">   nsIMdbRow* ioRow) // row to ensure membership in table</span>
<a href="#l17.273"></a><span id="l17.273"> {</span>
<a href="#l17.274"></a><span id="l17.274" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.275"></a><span id="l17.275" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.276"></a><span id="l17.276">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.277"></a><span id="l17.277">   if ( ev )</span>
<a href="#l17.278"></a><span id="l17.278">   {</span>
<a href="#l17.279"></a><span id="l17.279">     morkRowObject *rowObj = (morkRowObject *) ioRow;</span>
<a href="#l17.280"></a><span id="l17.280">     morkRow* row = rowObj-&gt;mRowObject_Row;</span>
<a href="#l17.281"></a><span id="l17.281">     AddRow(ev, row);</span>
<a href="#l17.282"></a><span id="l17.282">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.283"></a><span id="l17.283">   }</span>
<a href="#l17.284"></a><span id="l17.284" class="difflineat">@@ -633,17 +633,17 @@ morkTable::AddRow( // make sure the row </span>
<a href="#l17.285"></a><span id="l17.285"> }</span>
<a href="#l17.286"></a><span id="l17.286"> </span>
<a href="#l17.287"></a><span id="l17.287"> NS_IMETHODIMP</span>
<a href="#l17.288"></a><span id="l17.288"> morkTable::HasRow( // test for the table position of a row member</span>
<a href="#l17.289"></a><span id="l17.289">   nsIMdbEnv* mev, // context</span>
<a href="#l17.290"></a><span id="l17.290">   nsIMdbRow* ioRow, // row to find in table</span>
<a href="#l17.291"></a><span id="l17.291">   mdb_bool* outBool) // zero-based ordinal position of row in table</span>
<a href="#l17.292"></a><span id="l17.292"> {</span>
<a href="#l17.293"></a><span id="l17.293" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.294"></a><span id="l17.294" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.295"></a><span id="l17.295">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.296"></a><span id="l17.296">   if ( ev )</span>
<a href="#l17.297"></a><span id="l17.297">   {</span>
<a href="#l17.298"></a><span id="l17.298">     morkRowObject *rowObj = (morkRowObject *) ioRow;</span>
<a href="#l17.299"></a><span id="l17.299">     morkRow* row = rowObj-&gt;mRowObject_Row;</span>
<a href="#l17.300"></a><span id="l17.300">     if ( outBool )</span>
<a href="#l17.301"></a><span id="l17.301">       *outBool = MapHasOid(ev, &amp;row-&gt;mRow_Oid);</span>
<a href="#l17.302"></a><span id="l17.302">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.303"></a><span id="l17.303" class="difflineat">@@ -652,33 +652,33 @@ morkTable::HasRow( // test for the table</span>
<a href="#l17.304"></a><span id="l17.304"> }</span>
<a href="#l17.305"></a><span id="l17.305"> </span>
<a href="#l17.306"></a><span id="l17.306"> </span>
<a href="#l17.307"></a><span id="l17.307"> NS_IMETHODIMP</span>
<a href="#l17.308"></a><span id="l17.308"> morkTable::CutRow( // make sure the row with inOid is not a member </span>
<a href="#l17.309"></a><span id="l17.309">   nsIMdbEnv* mev, // context</span>
<a href="#l17.310"></a><span id="l17.310">   nsIMdbRow* ioRow) // row to remove from table</span>
<a href="#l17.311"></a><span id="l17.311"> {</span>
<a href="#l17.312"></a><span id="l17.312" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.313"></a><span id="l17.313" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.314"></a><span id="l17.314">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.315"></a><span id="l17.315">   if ( ev )</span>
<a href="#l17.316"></a><span id="l17.316">   {</span>
<a href="#l17.317"></a><span id="l17.317">     morkRowObject *rowObj = (morkRowObject *) ioRow;</span>
<a href="#l17.318"></a><span id="l17.318">     morkRow* row = rowObj-&gt;mRowObject_Row;</span>
<a href="#l17.319"></a><span id="l17.319">     CutRow(ev, row);</span>
<a href="#l17.320"></a><span id="l17.320">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.321"></a><span id="l17.321">   }</span>
<a href="#l17.322"></a><span id="l17.322">   return outErr;</span>
<a href="#l17.323"></a><span id="l17.323"> }</span>
<a href="#l17.324"></a><span id="l17.324"> </span>
<a href="#l17.325"></a><span id="l17.325"> NS_IMETHODIMP</span>
<a href="#l17.326"></a><span id="l17.326"> morkTable::CutAllRows( // remove all rows from the table </span>
<a href="#l17.327"></a><span id="l17.327">   nsIMdbEnv* mev) // context</span>
<a href="#l17.328"></a><span id="l17.328"> {</span>
<a href="#l17.329"></a><span id="l17.329" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.330"></a><span id="l17.330" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.331"></a><span id="l17.331">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.332"></a><span id="l17.332">   if ( ev )</span>
<a href="#l17.333"></a><span id="l17.333">   {</span>
<a href="#l17.334"></a><span id="l17.334">     CutAllRows(ev);</span>
<a href="#l17.335"></a><span id="l17.335">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.336"></a><span id="l17.336">   }</span>
<a href="#l17.337"></a><span id="l17.337">   return outErr;</span>
<a href="#l17.338"></a><span id="l17.338"> }</span>
<a href="#l17.339"></a><span id="l17.339" class="difflineat">@@ -832,17 +832,17 @@ morkTable::SetSearchSorting( // use this</span>
<a href="#l17.340"></a><span id="l17.340"> NS_IMETHODIMP</span>
<a href="#l17.341"></a><span id="l17.341"> morkTable::MoveOid( // change position of row in unsorted table</span>
<a href="#l17.342"></a><span id="l17.342">   nsIMdbEnv* mev, // context</span>
<a href="#l17.343"></a><span id="l17.343">   const mdbOid* inOid,  // row oid to find in table</span>
<a href="#l17.344"></a><span id="l17.344">   mdb_pos inHintFromPos, // suggested hint regarding start position</span>
<a href="#l17.345"></a><span id="l17.345">   mdb_pos inToPos,       // desired new position for row inOid</span>
<a href="#l17.346"></a><span id="l17.346">   mdb_pos* outActualPos) // actual new position of row in table</span>
<a href="#l17.347"></a><span id="l17.347"> {</span>
<a href="#l17.348"></a><span id="l17.348" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.349"></a><span id="l17.349" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.350"></a><span id="l17.350">   mdb_pos actualPos = -1; // meaning it was never found in table</span>
<a href="#l17.351"></a><span id="l17.351">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.352"></a><span id="l17.352">   if ( ev )</span>
<a href="#l17.353"></a><span id="l17.353">   {</span>
<a href="#l17.354"></a><span id="l17.354">     if ( inOid &amp;&amp; mTable_Store )</span>
<a href="#l17.355"></a><span id="l17.355">     {</span>
<a href="#l17.356"></a><span id="l17.356">       morkRow* row = mTable_Store-&gt;GetRow(ev, inOid);</span>
<a href="#l17.357"></a><span id="l17.357">       if ( row )</span>
<a href="#l17.358"></a><span id="l17.358" class="difflineat">@@ -862,17 +862,17 @@ NS_IMETHODIMP</span>
<a href="#l17.359"></a><span id="l17.359"> morkTable::MoveRow( // change position of row in unsorted table</span>
<a href="#l17.360"></a><span id="l17.360">   nsIMdbEnv* mev, // context</span>
<a href="#l17.361"></a><span id="l17.361">   nsIMdbRow* ioRow,  // row oid to find in table</span>
<a href="#l17.362"></a><span id="l17.362">   mdb_pos inHintFromPos, // suggested hint regarding start position</span>
<a href="#l17.363"></a><span id="l17.363">   mdb_pos inToPos,       // desired new position for row ioRow</span>
<a href="#l17.364"></a><span id="l17.364">   mdb_pos* outActualPos) // actual new position of row in table</span>
<a href="#l17.365"></a><span id="l17.365"> {</span>
<a href="#l17.366"></a><span id="l17.366">   mdb_pos actualPos = -1; // meaning it was never found in table</span>
<a href="#l17.367"></a><span id="l17.367" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l17.368"></a><span id="l17.368" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l17.369"></a><span id="l17.369">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l17.370"></a><span id="l17.370">   if ( ev )</span>
<a href="#l17.371"></a><span id="l17.371">   {</span>
<a href="#l17.372"></a><span id="l17.372">     morkRowObject *rowObj = (morkRowObject *) ioRow;</span>
<a href="#l17.373"></a><span id="l17.373">     morkRow* row = rowObj-&gt;mRowObject_Row;</span>
<a href="#l17.374"></a><span id="l17.374">     actualPos = MoveRow(ev, row, inHintFromPos, inToPos);</span>
<a href="#l17.375"></a><span id="l17.375">     outErr = ev-&gt;AsErr();</span>
<a href="#l17.376"></a><span id="l17.376">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/db/mork/src/morkTableRowCursor.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/db/mork/src/morkTableRowCursor.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -103,78 +103,78 @@ morkTableRowCursor::CloseTableRowCursor(</span>
<a href="#l18.4"></a><span id="l18.4">   }</span>
<a href="#l18.5"></a><span id="l18.5">   else</span>
<a href="#l18.6"></a><span id="l18.6">     ev-&gt;NilPointerError();</span>
<a href="#l18.7"></a><span id="l18.7"> }</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> // } ===== end morkNode methods =====</span>
<a href="#l18.10"></a><span id="l18.10"> // ````` ````` ````` ````` ````` </span>
<a href="#l18.11"></a><span id="l18.11"> // { ----- begin attribute methods -----</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l18.14"></a><span id="l18.14"> morkTableRowCursor::GetCount(nsIMdbEnv* mev, mdb_count* outCount)</span>
<a href="#l18.15"></a><span id="l18.15"> {</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l18.18"></a><span id="l18.18">   mdb_count count = 0;</span>
<a href="#l18.19"></a><span id="l18.19">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l18.20"></a><span id="l18.20">   if ( ev )</span>
<a href="#l18.21"></a><span id="l18.21">   {</span>
<a href="#l18.22"></a><span id="l18.22">     count = GetMemberCount(ev);</span>
<a href="#l18.23"></a><span id="l18.23">     outErr = ev-&gt;AsErr();</span>
<a href="#l18.24"></a><span id="l18.24">   }</span>
<a href="#l18.25"></a><span id="l18.25">   if ( outCount )</span>
<a href="#l18.26"></a><span id="l18.26">     *outCount = count;</span>
<a href="#l18.27"></a><span id="l18.27">   return outErr;</span>
<a href="#l18.28"></a><span id="l18.28"> }</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l18.32"></a><span id="l18.32"> morkTableRowCursor::GetSeed(nsIMdbEnv* mev, mdb_seed* outSeed)</span>
<a href="#l18.33"></a><span id="l18.33"> {</span>
<a href="#l18.34"></a><span id="l18.34">   NS_ASSERTION(false, &quot;not implemented&quot;);</span>
<a href="#l18.35"></a><span id="l18.35">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l18.36"></a><span id="l18.36"> }</span>
<a href="#l18.37"></a><span id="l18.37"> </span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l18.40"></a><span id="l18.40"> morkTableRowCursor::SetPos(nsIMdbEnv* mev, mdb_pos inPos)</span>
<a href="#l18.41"></a><span id="l18.41"> {</span>
<a href="#l18.42"></a><span id="l18.42">   mCursor_Pos = inPos;</span>
<a href="#l18.43"></a><span id="l18.43">   return NS_OK;</span>
<a href="#l18.44"></a><span id="l18.44"> }</span>
<a href="#l18.45"></a><span id="l18.45"> </span>
<a href="#l18.46"></a><span id="l18.46" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l18.48"></a><span id="l18.48"> morkTableRowCursor::GetPos(nsIMdbEnv* mev, mdb_pos* outPos)</span>
<a href="#l18.49"></a><span id="l18.49"> {</span>
<a href="#l18.50"></a><span id="l18.50">   *outPos = mCursor_Pos;</span>
<a href="#l18.51"></a><span id="l18.51">   return NS_OK;</span>
<a href="#l18.52"></a><span id="l18.52"> }</span>
<a href="#l18.53"></a><span id="l18.53"> </span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l18.56"></a><span id="l18.56"> morkTableRowCursor::SetDoFailOnSeedOutOfSync(nsIMdbEnv* mev, mdb_bool inFail)</span>
<a href="#l18.57"></a><span id="l18.57"> {</span>
<a href="#l18.58"></a><span id="l18.58">   mCursor_DoFailOnSeedOutOfSync = inFail;</span>
<a href="#l18.59"></a><span id="l18.59">   return NS_OK;</span>
<a href="#l18.60"></a><span id="l18.60"> }</span>
<a href="#l18.61"></a><span id="l18.61"> </span>
<a href="#l18.62"></a><span id="l18.62" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l18.64"></a><span id="l18.64"> morkTableRowCursor::GetDoFailOnSeedOutOfSync(nsIMdbEnv* mev, mdb_bool* outFail)</span>
<a href="#l18.65"></a><span id="l18.65"> {</span>
<a href="#l18.66"></a><span id="l18.66">   NS_ENSURE_ARG_POINTER(outFail);</span>
<a href="#l18.67"></a><span id="l18.67">   *outFail = mCursor_DoFailOnSeedOutOfSync;</span>
<a href="#l18.68"></a><span id="l18.68">   return NS_OK;</span>
<a href="#l18.69"></a><span id="l18.69"> }</span>
<a href="#l18.70"></a><span id="l18.70"> // } ----- end attribute methods -----</span>
<a href="#l18.71"></a><span id="l18.71"> </span>
<a href="#l18.72"></a><span id="l18.72"> </span>
<a href="#l18.73"></a><span id="l18.73"> // { ===== begin nsIMdbTableRowCursor methods =====</span>
<a href="#l18.74"></a><span id="l18.74"> </span>
<a href="#l18.75"></a><span id="l18.75"> // { ----- begin attribute methods -----</span>
<a href="#l18.76"></a><span id="l18.76"> </span>
<a href="#l18.77"></a><span id="l18.77"> NS_IMETHODIMP</span>
<a href="#l18.78"></a><span id="l18.78"> morkTableRowCursor::GetTable(nsIMdbEnv* mev, nsIMdbTable** acqTable)</span>
<a href="#l18.79"></a><span id="l18.79"> {</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l18.82"></a><span id="l18.82">   nsIMdbTable* outTable = 0;</span>
<a href="#l18.83"></a><span id="l18.83">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l18.84"></a><span id="l18.84">   if ( ev )</span>
<a href="#l18.85"></a><span id="l18.85">   {</span>
<a href="#l18.86"></a><span id="l18.86">     if ( mTableRowCursor_Table )</span>
<a href="#l18.87"></a><span id="l18.87">       outTable = mTableRowCursor_Table-&gt;AcquireTableHandle(ev);</span>
<a href="#l18.88"></a><span id="l18.88">     </span>
<a href="#l18.89"></a><span id="l18.89">     outErr = ev-&gt;AsErr();</span>
<a href="#l18.90"></a><span id="l18.90" class="difflineat">@@ -187,17 +187,17 @@ morkTableRowCursor::GetTable(nsIMdbEnv* </span>
<a href="#l18.91"></a><span id="l18.91"> </span>
<a href="#l18.92"></a><span id="l18.92"> // { ----- begin oid iteration methods -----</span>
<a href="#l18.93"></a><span id="l18.93"> NS_IMETHODIMP</span>
<a href="#l18.94"></a><span id="l18.94"> morkTableRowCursor::NextRowOid( // get row id of next row in the table</span>
<a href="#l18.95"></a><span id="l18.95">   nsIMdbEnv* mev, // context</span>
<a href="#l18.96"></a><span id="l18.96">   mdbOid* outOid, // out row oid</span>
<a href="#l18.97"></a><span id="l18.97">   mdb_pos* outRowPos)</span>
<a href="#l18.98"></a><span id="l18.98"> {</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l18.101"></a><span id="l18.101">   mork_pos pos = -1;</span>
<a href="#l18.102"></a><span id="l18.102">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l18.103"></a><span id="l18.103">   if ( ev )</span>
<a href="#l18.104"></a><span id="l18.104">   {</span>
<a href="#l18.105"></a><span id="l18.105">     if ( outOid )</span>
<a href="#l18.106"></a><span id="l18.106">     {</span>
<a href="#l18.107"></a><span id="l18.107">       pos = NextRowOid(ev, outOid);</span>
<a href="#l18.108"></a><span id="l18.108">     }</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineat">@@ -211,17 +211,17 @@ morkTableRowCursor::NextRowOid( // get r</span>
<a href="#l18.110"></a><span id="l18.110"> }</span>
<a href="#l18.111"></a><span id="l18.111"> </span>
<a href="#l18.112"></a><span id="l18.112"> NS_IMETHODIMP</span>
<a href="#l18.113"></a><span id="l18.113"> morkTableRowCursor::PrevRowOid( // get row id of previous row in the table</span>
<a href="#l18.114"></a><span id="l18.114">   nsIMdbEnv* mev, // context</span>
<a href="#l18.115"></a><span id="l18.115">   mdbOid* outOid, // out row oid</span>
<a href="#l18.116"></a><span id="l18.116">   mdb_pos* outRowPos)</span>
<a href="#l18.117"></a><span id="l18.117"> {</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l18.119"></a><span id="l18.119" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l18.120"></a><span id="l18.120">   mork_pos pos = -1;</span>
<a href="#l18.121"></a><span id="l18.121">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l18.122"></a><span id="l18.122">   if ( ev )</span>
<a href="#l18.123"></a><span id="l18.123">   {</span>
<a href="#l18.124"></a><span id="l18.124">     if ( outOid )</span>
<a href="#l18.125"></a><span id="l18.125">     {</span>
<a href="#l18.126"></a><span id="l18.126">       pos = PrevRowOid(ev, outOid);</span>
<a href="#l18.127"></a><span id="l18.127">     }</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineat">@@ -237,17 +237,17 @@ morkTableRowCursor::PrevRowOid( // get r</span>
<a href="#l18.129"></a><span id="l18.129"> </span>
<a href="#l18.130"></a><span id="l18.130"> // { ----- begin row iteration methods -----</span>
<a href="#l18.131"></a><span id="l18.131"> NS_IMETHODIMP</span>
<a href="#l18.132"></a><span id="l18.132"> morkTableRowCursor::NextRow( // get row cells from table for cells already in row</span>
<a href="#l18.133"></a><span id="l18.133">   nsIMdbEnv* mev, // context</span>
<a href="#l18.134"></a><span id="l18.134">   nsIMdbRow** acqRow, // acquire next row in table</span>
<a href="#l18.135"></a><span id="l18.135">   mdb_pos* outRowPos)</span>
<a href="#l18.136"></a><span id="l18.136"> {</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l18.139"></a><span id="l18.139">   nsIMdbRow* outRow = 0;</span>
<a href="#l18.140"></a><span id="l18.140">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l18.141"></a><span id="l18.141">   if ( ev )</span>
<a href="#l18.142"></a><span id="l18.142">   {</span>
<a href="#l18.143"></a><span id="l18.143">       </span>
<a href="#l18.144"></a><span id="l18.144">     mdbOid oid; // place to put oid we intend to ignore</span>
<a href="#l18.145"></a><span id="l18.145">     morkRow* row = NextRow(ev, &amp;oid, outRowPos);</span>
<a href="#l18.146"></a><span id="l18.146">     if ( row )</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineat">@@ -264,17 +264,17 @@ morkTableRowCursor::NextRow( // get row </span>
<a href="#l18.148"></a><span id="l18.148"> }</span>
<a href="#l18.149"></a><span id="l18.149"> </span>
<a href="#l18.150"></a><span id="l18.150"> NS_IMETHODIMP</span>
<a href="#l18.151"></a><span id="l18.151"> morkTableRowCursor::PrevRow( // get row cells from table for cells already in row</span>
<a href="#l18.152"></a><span id="l18.152">   nsIMdbEnv* mev, // context</span>
<a href="#l18.153"></a><span id="l18.153">   nsIMdbRow** acqRow, // acquire previous row in table</span>
<a href="#l18.154"></a><span id="l18.154">   mdb_pos* outRowPos)</span>
<a href="#l18.155"></a><span id="l18.155"> {</span>
<a href="#l18.156"></a><span id="l18.156" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l18.158"></a><span id="l18.158">   nsIMdbRow* outRow = 0;</span>
<a href="#l18.159"></a><span id="l18.159">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l18.160"></a><span id="l18.160">   if ( ev )</span>
<a href="#l18.161"></a><span id="l18.161">   {</span>
<a href="#l18.162"></a><span id="l18.162">       </span>
<a href="#l18.163"></a><span id="l18.163">     mdbOid oid; // place to put oid we intend to ignore</span>
<a href="#l18.164"></a><span id="l18.164">     morkRow* row = PrevRow(ev, &amp;oid, outRowPos);</span>
<a href="#l18.165"></a><span id="l18.165">     if ( row )</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineat">@@ -293,17 +293,17 @@ morkTableRowCursor::PrevRow( // get row </span>
<a href="#l18.167"></a><span id="l18.167"> // } ----- end row iteration methods -----</span>
<a href="#l18.168"></a><span id="l18.168"> </span>
<a href="#l18.169"></a><span id="l18.169"> </span>
<a href="#l18.170"></a><span id="l18.170"> // { ----- begin duplicate row removal methods -----</span>
<a href="#l18.171"></a><span id="l18.171"> NS_IMETHODIMP</span>
<a href="#l18.172"></a><span id="l18.172"> morkTableRowCursor::CanHaveDupRowMembers(nsIMdbEnv* mev, // cursor might hold dups?</span>
<a href="#l18.173"></a><span id="l18.173">   mdb_bool* outCanHaveDups)</span>
<a href="#l18.174"></a><span id="l18.174"> {</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l18.176"></a><span id="l18.176" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l18.177"></a><span id="l18.177">   mdb_bool canHaveDups = mdbBool_kFalse;</span>
<a href="#l18.178"></a><span id="l18.178">   </span>
<a href="#l18.179"></a><span id="l18.179">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l18.180"></a><span id="l18.180">   if ( ev )</span>
<a href="#l18.181"></a><span id="l18.181">   {</span>
<a href="#l18.182"></a><span id="l18.182">     canHaveDups = CanHaveDupRowMembers(ev);</span>
<a href="#l18.183"></a><span id="l18.183">     outErr = ev-&gt;AsErr();</span>
<a href="#l18.184"></a><span id="l18.184">   }</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineat">@@ -333,17 +333,17 @@ morkTableRowCursor::MakeUniqueCursor( //</span>
<a href="#l18.186"></a><span id="l18.186">   // impact if a collection holds tens of thousands of rows or more, when</span>
<a href="#l18.187"></a><span id="l18.187">   // the original cursor with dups simply referenced rows indirectly by row</span>
<a href="#l18.188"></a><span id="l18.188">   // position ranges, without using an explicit row set representation.</span>
<a href="#l18.189"></a><span id="l18.189">   // Callers are encouraged to use nsIMdbCursor::GetCount() to determine</span>
<a href="#l18.190"></a><span id="l18.190">   // whether the row collection is very large (tens of thousands), and to</span>
<a href="#l18.191"></a><span id="l18.191">   // delay calling MakeUniqueCursor() when possible, until a user interface</span>
<a href="#l18.192"></a><span id="l18.192">   // element actually demands the creation of an explicit set representation.</span>
<a href="#l18.193"></a><span id="l18.193"> {</span>
<a href="#l18.194"></a><span id="l18.194" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l18.195"></a><span id="l18.195" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l18.196"></a><span id="l18.196">   nsIMdbTableRowCursor* outCursor = 0;</span>
<a href="#l18.197"></a><span id="l18.197">   </span>
<a href="#l18.198"></a><span id="l18.198">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l18.199"></a><span id="l18.199">   if ( ev )</span>
<a href="#l18.200"></a><span id="l18.200">   {</span>
<a href="#l18.201"></a><span id="l18.201">     AddRef();</span>
<a href="#l18.202"></a><span id="l18.202">     outCursor = this;</span>
<a href="#l18.203"></a><span id="l18.203">       </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/db/mork/src/morkThumb.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/db/mork/src/morkThumb.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -131,44 +131,44 @@ morkThumb::CloseThumb(morkEnv* ev) // ca</span>
<a href="#l19.4"></a><span id="l19.4"> // } ===== end morkNode methods =====</span>
<a href="#l19.5"></a><span id="l19.5"> // ````` ````` ````` ````` ````` </span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> // { ===== begin nsIMdbThumb methods =====</span>
<a href="#l19.8"></a><span id="l19.8"> NS_IMETHODIMP</span>
<a href="#l19.9"></a><span id="l19.9"> morkThumb::GetProgress(nsIMdbEnv* mev, mdb_count* outTotal,</span>
<a href="#l19.10"></a><span id="l19.10">   mdb_count* outCurrent, mdb_bool* outDone, mdb_bool* outBroken)</span>
<a href="#l19.11"></a><span id="l19.11"> {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l19.14"></a><span id="l19.14">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l19.15"></a><span id="l19.15">   if ( ev )</span>
<a href="#l19.16"></a><span id="l19.16">   {</span>
<a href="#l19.17"></a><span id="l19.17">     GetProgress(ev, outTotal, outCurrent, outDone, outBroken);</span>
<a href="#l19.18"></a><span id="l19.18">     outErr = ev-&gt;AsErr();</span>
<a href="#l19.19"></a><span id="l19.19">   }</span>
<a href="#l19.20"></a><span id="l19.20">   return outErr;</span>
<a href="#l19.21"></a><span id="l19.21"> }</span>
<a href="#l19.22"></a><span id="l19.22"> </span>
<a href="#l19.23"></a><span id="l19.23"> NS_IMETHODIMP</span>
<a href="#l19.24"></a><span id="l19.24"> morkThumb::DoMore(nsIMdbEnv* mev, mdb_count* outTotal,</span>
<a href="#l19.25"></a><span id="l19.25">   mdb_count* outCurrent, mdb_bool* outDone, mdb_bool* outBroken)</span>
<a href="#l19.26"></a><span id="l19.26"> {</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l19.29"></a><span id="l19.29">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l19.30"></a><span id="l19.30">   if ( ev )</span>
<a href="#l19.31"></a><span id="l19.31">   {</span>
<a href="#l19.32"></a><span id="l19.32">     DoMore(ev, outTotal, outCurrent, outDone, outBroken);</span>
<a href="#l19.33"></a><span id="l19.33">     outErr = ev-&gt;AsErr();</span>
<a href="#l19.34"></a><span id="l19.34">   }</span>
<a href="#l19.35"></a><span id="l19.35">   return outErr;</span>
<a href="#l19.36"></a><span id="l19.36"> }</span>
<a href="#l19.37"></a><span id="l19.37"> </span>
<a href="#l19.38"></a><span id="l19.38"> NS_IMETHODIMP</span>
<a href="#l19.39"></a><span id="l19.39"> morkThumb::CancelAndBreakThumb(nsIMdbEnv* mev)</span>
<a href="#l19.40"></a><span id="l19.40"> {</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l19.43"></a><span id="l19.43">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l19.44"></a><span id="l19.44">   if ( ev )</span>
<a href="#l19.45"></a><span id="l19.45">   {</span>
<a href="#l19.46"></a><span id="l19.46">     mThumb_Done = morkBool_kTrue;</span>
<a href="#l19.47"></a><span id="l19.47">     mThumb_Broken = morkBool_kTrue;</span>
<a href="#l19.48"></a><span id="l19.48">     CloseMorkNode(ev); // should I close this here?</span>
<a href="#l19.49"></a><span id="l19.49">     outErr = ev-&gt;AsErr();</span>
<a href="#l19.50"></a><span id="l19.50">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/db/mork/src/morkZone.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/db/mork/src/morkZone.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -480,54 +480,53 @@ void* morkZone::ZoneGrowRun(morkEnv* ev,</span>
<a href="#l20.4"></a><span id="l20.4">   mZone_Heap-&gt;Free(ev-&gt;AsMdbEnv(), ioRunBlock);</span>
<a href="#l20.5"></a><span id="l20.5">   return outBlock;</span>
<a href="#l20.6"></a><span id="l20.6"> #endif /*morkZone_CONFIG_ARENA*/</span>
<a href="#l20.7"></a><span id="l20.7"> }</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> //3456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11"> // { ===== begin nsIMdbHeap methods =====</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l20.14"></a><span id="l20.14"> morkZone::Alloc(nsIMdbEnv* mev, // allocate a piece of memory</span>
<a href="#l20.15"></a><span id="l20.15">   mdb_size inSize,   // requested size of new memory block </span>
<a href="#l20.16"></a><span id="l20.16">   void** outBlock)  // memory block of inSize bytes, or nil</span>
<a href="#l20.17"></a><span id="l20.17"> {</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l20.20"></a><span id="l20.20">   void* block = 0;</span>
<a href="#l20.21"></a><span id="l20.21">   morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l20.22"></a><span id="l20.22">   if ( ev )</span>
<a href="#l20.23"></a><span id="l20.23">   {</span>
<a href="#l20.24"></a><span id="l20.24">     block = this-&gt;ZoneNewRun(ev, inSize);</span>
<a href="#l20.25"></a><span id="l20.25">     outErr = ev-&gt;AsErr();</span>
<a href="#l20.26"></a><span id="l20.26">   }</span>
<a href="#l20.27"></a><span id="l20.27">   else</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineminus">-    // XXX 1 is not a valid mdb_err (= nsresult)</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineminus">-    outErr = static_cast&lt;mdb_err&gt;(1);</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-    </span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+    outErr = morkEnv_kOutOfMemoryError;</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+</span>
<a href="#l20.33"></a><span id="l20.33">   if ( outBlock )</span>
<a href="#l20.34"></a><span id="l20.34">     *outBlock = block;</span>
<a href="#l20.35"></a><span id="l20.35">     </span>
<a href="#l20.36"></a><span id="l20.36">   return outErr;</span>
<a href="#l20.37"></a><span id="l20.37"> }</span>
<a href="#l20.38"></a><span id="l20.38">   </span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l20.41"></a><span id="l20.41"> morkZone::Free(nsIMdbEnv* mev, // free block allocated earlier by Alloc()</span>
<a href="#l20.42"></a><span id="l20.42">   void* inBlock)</span>
<a href="#l20.43"></a><span id="l20.43"> {</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l20.46"></a><span id="l20.46">   if ( inBlock )</span>
<a href="#l20.47"></a><span id="l20.47">   {</span>
<a href="#l20.48"></a><span id="l20.48">     morkEnv* ev = morkEnv::FromMdbEnv(mev);</span>
<a href="#l20.49"></a><span id="l20.49">     if ( ev )</span>
<a href="#l20.50"></a><span id="l20.50">     {</span>
<a href="#l20.51"></a><span id="l20.51">       this-&gt;ZoneZapRun(ev, inBlock);</span>
<a href="#l20.52"></a><span id="l20.52">       outErr = ev-&gt;AsErr();</span>
<a href="#l20.53"></a><span id="l20.53">     }</span>
<a href="#l20.54"></a><span id="l20.54">     else</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">-      // XXX 1 is not a valid mdb_err (= nsresult)</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineminus">-      outErr = static_cast&lt;mdb_err&gt;(1);</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineplus">+      // XXX 1 is not a valid nsresult</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+      outErr = static_cast&lt;nsresult&gt;(1);</span>
<a href="#l20.59"></a><span id="l20.59">   }</span>
<a href="#l20.60"></a><span id="l20.60">     </span>
<a href="#l20.61"></a><span id="l20.61">   return outErr;</span>
<a href="#l20.62"></a><span id="l20.62"> }</span>
<a href="#l20.63"></a><span id="l20.63"> </span>
<a href="#l20.64"></a><span id="l20.64"> // } ===== end nsIMdbHeap methods =====</span>
<a href="#l20.65"></a><span id="l20.65"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/db/mork/src/orkinHeap.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/db/mork/src/orkinHeap.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -35,37 +35,37 @@ orkinHeap::orkinHeap() // does nothing</span>
<a href="#l21.4"></a><span id="l21.4"> orkinHeap::~orkinHeap() // does nothing</span>
<a href="#l21.5"></a><span id="l21.5"> {</span>
<a href="#l21.6"></a><span id="l21.6"> }</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> MOZ_DEFINE_MALLOC_SIZE_OF_ON_ALLOC(MorkSizeOfOnAlloc)</span>
<a href="#l21.9"></a><span id="l21.9"> MOZ_DEFINE_MALLOC_SIZE_OF_ON_FREE(MorkSizeOfOnFree)</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11"> // { ===== begin nsIMdbHeap methods =====</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l21.14"></a><span id="l21.14"> orkinHeap::Alloc(nsIMdbEnv* mev, // allocate a piece of memory</span>
<a href="#l21.15"></a><span id="l21.15">   mdb_size inSize,  // requested size of new memory block</span>
<a href="#l21.16"></a><span id="l21.16">   void** outBlock)  // memory block of inSize bytes, or nil</span>
<a href="#l21.17"></a><span id="l21.17"> {</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19">   MORK_USED_1(mev);</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineminus">-  mdb_err outErr = NS_OK;</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+  nsresult outErr = NS_OK;</span>
<a href="#l21.22"></a><span id="l21.22">   void* block = malloc(inSize);</span>
<a href="#l21.23"></a><span id="l21.23">   if ( !block )</span>
<a href="#l21.24"></a><span id="l21.24">     outErr = morkEnv_kOutOfMemoryError;</span>
<a href="#l21.25"></a><span id="l21.25">   else</span>
<a href="#l21.26"></a><span id="l21.26">     mUsedSize += MorkSizeOfOnAlloc(block);</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28">   MORK_ASSERT(outBlock);</span>
<a href="#l21.29"></a><span id="l21.29">   if ( outBlock )</span>
<a href="#l21.30"></a><span id="l21.30">     *outBlock = block;</span>
<a href="#l21.31"></a><span id="l21.31">   return outErr;</span>
<a href="#l21.32"></a><span id="l21.32"> }</span>
<a href="#l21.33"></a><span id="l21.33"> </span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-/*virtual*/ mdb_err</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+/*virtual*/ nsresult</span>
<a href="#l21.36"></a><span id="l21.36"> orkinHeap::Free(nsIMdbEnv* mev, // free block allocated earlier by Alloc()</span>
<a href="#l21.37"></a><span id="l21.37">   void* inBlock)</span>
<a href="#l21.38"></a><span id="l21.38"> {</span>
<a href="#l21.39"></a><span id="l21.39">   MORK_USED_1(mev);</span>
<a href="#l21.40"></a><span id="l21.40">   MORK_ASSERT(inBlock);</span>
<a href="#l21.41"></a><span id="l21.41">   if ( inBlock )</span>
<a href="#l21.42"></a><span id="l21.42">   {</span>
<a href="#l21.43"></a><span id="l21.43">     mUsedSize -= MorkSizeOfOnFree(inBlock);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -704,17 +704,17 @@ nsresult nsAddrDatabase::AddRowToDeleted</span>
<a href="#l22.4"></a><span id="l22.4">     rv = InitDeletedCardsTable(true);</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l22.7"></a><span id="l22.7">     // lets first purge old records if there are more than PURGE_CUTOFF_COUNT records</span>
<a href="#l22.8"></a><span id="l22.8">     PurgeDeletedCardTable();</span>
<a href="#l22.9"></a><span id="l22.9">     nsCOMPtr&lt;nsIMdbRow&gt; cardRow;</span>
<a href="#l22.10"></a><span id="l22.10">     rv = GetNewRow(getter_AddRefs(cardRow));</span>
<a href="#l22.11"></a><span id="l22.11">     if (NS_SUCCEEDED(rv) &amp;&amp; cardRow) {</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-      mdb_err merror = m_mdbDeletedCardsTable-&gt;AddRow(m_mdbEnv, cardRow);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+      nsresult merror = m_mdbDeletedCardsTable-&gt;AddRow(m_mdbEnv, cardRow);</span>
<a href="#l22.14"></a><span id="l22.14">       NS_ENSURE_SUCCESS(merror, NS_ERROR_FAILURE);</span>
<a href="#l22.15"></a><span id="l22.15">       nsString unicodeStr;</span>
<a href="#l22.16"></a><span id="l22.16">       card-&gt;GetFirstName(unicodeStr);</span>
<a href="#l22.17"></a><span id="l22.17">       AddFirstName(cardRow, NS_ConvertUTF16toUTF8(unicodeStr).get());</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19">       card-&gt;GetLastName(unicodeStr);</span>
<a href="#l22.20"></a><span id="l22.20">       AddLastName(cardRow, NS_ConvertUTF16toUTF8(unicodeStr).get());</span>
<a href="#l22.21"></a><span id="l22.21"> </span>
<a href="#l22.22"></a><span id="l22.22" class="difflineat">@@ -750,17 +750,17 @@ nsresult nsAddrDatabase::AddRowToDeleted</span>
<a href="#l22.23"></a><span id="l22.23">   return rv;</span>
<a href="#l22.24"></a><span id="l22.24"> }</span>
<a href="#l22.25"></a><span id="l22.25"> </span>
<a href="#l22.26"></a><span id="l22.26"> nsresult nsAddrDatabase::DeleteRowFromDeletedCardsTable(nsIMdbRow *pCardRow)</span>
<a href="#l22.27"></a><span id="l22.27"> {</span>
<a href="#l22.28"></a><span id="l22.28">   if (!m_mdbEnv)</span>
<a href="#l22.29"></a><span id="l22.29">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l22.30"></a><span id="l22.30"> </span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-  mdb_err merror = NS_OK;</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+  nsresult merror = NS_OK;</span>
<a href="#l22.33"></a><span id="l22.33">   if (m_mdbDeletedCardsTable) {</span>
<a href="#l22.34"></a><span id="l22.34">     pCardRow-&gt;CutAllColumns(m_mdbEnv);</span>
<a href="#l22.35"></a><span id="l22.35">     merror = m_mdbDeletedCardsTable-&gt;CutRow(m_mdbEnv, pCardRow);</span>
<a href="#l22.36"></a><span id="l22.36">   }</span>
<a href="#l22.37"></a><span id="l22.37">   return merror;</span>
<a href="#l22.38"></a><span id="l22.38"> }</span>
<a href="#l22.39"></a><span id="l22.39"> </span>
<a href="#l22.40"></a><span id="l22.40"> </span>
<a href="#l22.41"></a><span id="l22.41" class="difflineat">@@ -902,17 +902,17 @@ nsresult nsAddrDatabase::CheckAndUpdateR</span>
<a href="#l22.42"></a><span id="l22.42">   if (!m_mdbEnv)</span>
<a href="#l22.43"></a><span id="l22.43">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l22.44"></a><span id="l22.44"> </span>
<a href="#l22.45"></a><span id="l22.45">   nsresult err = NS_OK;</span>
<a href="#l22.46"></a><span id="l22.46">   nsIMdbTableRowCursor* rowCursor = nullptr;</span>
<a href="#l22.47"></a><span id="l22.47">   nsIMdbRow* findRow = nullptr;</span>
<a href="#l22.48"></a><span id="l22.48">   mdb_pos    rowPos = 0;</span>
<a href="#l22.49"></a><span id="l22.49"> </span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-  mdb_err merror = m_mdbPabTable-&gt;GetTableRowCursor(m_mdbEnv, -1, &amp;rowCursor);</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineplus">+  nsresult merror = m_mdbPabTable-&gt;GetTableRowCursor(m_mdbEnv, -1, &amp;rowCursor);</span>
<a href="#l22.52"></a><span id="l22.52"> </span>
<a href="#l22.53"></a><span id="l22.53">   NS_ENSURE_TRUE(NS_SUCCEEDED(merror) &amp;&amp; rowCursor, NS_ERROR_FAILURE);</span>
<a href="#l22.54"></a><span id="l22.54"> </span>
<a href="#l22.55"></a><span id="l22.55">   nsCOMPtr &lt;nsIMdbRow&gt; pDataRow;</span>
<a href="#l22.56"></a><span id="l22.56">   err = GetDataRow(getter_AddRefs(pDataRow));</span>
<a href="#l22.57"></a><span id="l22.57">   if (NS_FAILED(err))</span>
<a href="#l22.58"></a><span id="l22.58">     InitLastRecorKey();</span>
<a href="#l22.59"></a><span id="l22.59"> </span>
<a href="#l22.60"></a><span id="l22.60" class="difflineat">@@ -945,17 +945,17 @@ nsresult nsAddrDatabase::UpdateLowercase</span>
<a href="#l22.61"></a><span id="l22.61">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l22.62"></a><span id="l22.62"> </span>
<a href="#l22.63"></a><span id="l22.63">   nsresult err = NS_OK;</span>
<a href="#l22.64"></a><span id="l22.64">   nsIMdbTableRowCursor* rowCursor = nullptr;</span>
<a href="#l22.65"></a><span id="l22.65">   nsIMdbRow* findRow = nullptr;</span>
<a href="#l22.66"></a><span id="l22.66">   mdb_pos    rowPos = 0;</span>
<a href="#l22.67"></a><span id="l22.67">   bool commitRequired = false;</span>
<a href="#l22.68"></a><span id="l22.68"> </span>
<a href="#l22.69"></a><span id="l22.69" class="difflineminus">-  mdb_err merror = m_mdbPabTable-&gt;GetTableRowCursor(m_mdbEnv, -1, &amp;rowCursor);</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineplus">+  nsresult merror = m_mdbPabTable-&gt;GetTableRowCursor(m_mdbEnv, -1, &amp;rowCursor);</span>
<a href="#l22.71"></a><span id="l22.71"> </span>
<a href="#l22.72"></a><span id="l22.72">   NS_ENSURE_TRUE(NS_SUCCEEDED(merror) &amp;&amp; rowCursor, NS_ERROR_FAILURE);</span>
<a href="#l22.73"></a><span id="l22.73"> </span>
<a href="#l22.74"></a><span id="l22.74">   do</span>
<a href="#l22.75"></a><span id="l22.75">   { // Add lowercase primary+secondary email to each card and mailing list row.</span>
<a href="#l22.76"></a><span id="l22.76">     merror = rowCursor-&gt;NextRow(m_mdbEnv, &amp;findRow, &amp;rowPos);</span>
<a href="#l22.77"></a><span id="l22.77">     if (NS_SUCCEEDED(merror) &amp;&amp; findRow)</span>
<a href="#l22.78"></a><span id="l22.78">     {</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineat">@@ -1253,17 +1253,17 @@ NS_IMETHODIMP nsAddrDatabase::CreateNewC</span>
<a href="#l22.80"></a><span id="l22.80">     aNewCard-&gt;SetLocalId(id);</span>
<a href="#l22.81"></a><span id="l22.81"> </span>
<a href="#l22.82"></a><span id="l22.82">     nsCOMPtr&lt;nsIAbDirectory&gt; abDir = do_QueryReferent(m_dbDirectory);</span>
<a href="#l22.83"></a><span id="l22.83">     if (abDir)</span>
<a href="#l22.84"></a><span id="l22.84">       abDir-&gt;GetUuid(id);</span>
<a href="#l22.85"></a><span id="l22.85"> </span>
<a href="#l22.86"></a><span id="l22.86">     aNewCard-&gt;SetDirectoryId(id);</span>
<a href="#l22.87"></a><span id="l22.87"> </span>
<a href="#l22.88"></a><span id="l22.88" class="difflineminus">-    mdb_err merror = m_mdbPabTable-&gt;AddRow(m_mdbEnv, cardRow);</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineplus">+    nsresult merror = m_mdbPabTable-&gt;AddRow(m_mdbEnv, cardRow);</span>
<a href="#l22.90"></a><span id="l22.90">     NS_ENSURE_SUCCESS(merror, NS_ERROR_FAILURE);</span>
<a href="#l22.91"></a><span id="l22.91">   }</span>
<a href="#l22.92"></a><span id="l22.92">   else</span>
<a href="#l22.93"></a><span id="l22.93">     return rv;</span>
<a href="#l22.94"></a><span id="l22.94"> </span>
<a href="#l22.95"></a><span id="l22.95">   //  do notification</span>
<a href="#l22.96"></a><span id="l22.96">   if (aNotify)</span>
<a href="#l22.97"></a><span id="l22.97">   {</span>
<a href="#l22.98"></a><span id="l22.98" class="difflineat">@@ -1550,17 +1550,17 @@ NS_IMETHODIMP nsAddrDatabase::CreateMail</span>
<a href="#l22.99"></a><span id="l22.99"> </span>
<a href="#l22.100"></a><span id="l22.100">     nsIMdbRow *listRow;</span>
<a href="#l22.101"></a><span id="l22.101">     nsresult err = GetNewListRow(&amp;listRow);</span>
<a href="#l22.102"></a><span id="l22.102"> </span>
<a href="#l22.103"></a><span id="l22.103">     if (NS_SUCCEEDED(err) &amp;&amp; listRow)</span>
<a href="#l22.104"></a><span id="l22.104">     {</span>
<a href="#l22.105"></a><span id="l22.105">         AddListAttributeColumnsToRow(aNewList, listRow, aParent);</span>
<a href="#l22.106"></a><span id="l22.106">         AddRecordKeyColumnToRow(listRow);</span>
<a href="#l22.107"></a><span id="l22.107" class="difflineminus">-        mdb_err merror = m_mdbPabTable-&gt;AddRow(m_mdbEnv, listRow);</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineplus">+        nsresult merror = m_mdbPabTable-&gt;AddRow(m_mdbEnv, listRow);</span>
<a href="#l22.109"></a><span id="l22.109">         NS_ENSURE_SUCCESS(merror, NS_ERROR_FAILURE);</span>
<a href="#l22.110"></a><span id="l22.110"> </span>
<a href="#l22.111"></a><span id="l22.111">         nsCOMPtr&lt;nsIAbCard&gt; listCard;</span>
<a href="#l22.112"></a><span id="l22.112">         CreateABListCard(listRow, getter_AddRefs(listCard));</span>
<a href="#l22.113"></a><span id="l22.113">         NotifyCardEntryChange(AB_NotifyInserted, listCard, aParent);</span>
<a href="#l22.114"></a><span id="l22.114"> </span>
<a href="#l22.115"></a><span id="l22.115">         NS_RELEASE(listRow);</span>
<a href="#l22.116"></a><span id="l22.116">         return NS_OK;</span>
<a href="#l22.117"></a><span id="l22.117" class="difflineat">@@ -1578,17 +1578,17 @@ void nsAddrDatabase::DeleteCardFromAllMa</span>
<a href="#l22.118"></a><span id="l22.118">     m_mdbPabTable-&gt;GetTableRowCursor(m_mdbEnv, -1, getter_AddRefs(rowCursor));</span>
<a href="#l22.119"></a><span id="l22.119"> </span>
<a href="#l22.120"></a><span id="l22.120">     if (rowCursor)</span>
<a href="#l22.121"></a><span id="l22.121">     {</span>
<a href="#l22.122"></a><span id="l22.122">         nsCOMPtr &lt;nsIMdbRow&gt; pListRow;</span>
<a href="#l22.123"></a><span id="l22.123">         mdb_pos rowPos;</span>
<a href="#l22.124"></a><span id="l22.124">         do</span>
<a href="#l22.125"></a><span id="l22.125">         {</span>
<a href="#l22.126"></a><span id="l22.126" class="difflineminus">-            mdb_err err = rowCursor-&gt;NextRow(m_mdbEnv, getter_AddRefs(pListRow), &amp;rowPos);</span>
<a href="#l22.127"></a><span id="l22.127" class="difflineplus">+            nsresult err = rowCursor-&gt;NextRow(m_mdbEnv, getter_AddRefs(pListRow), &amp;rowPos);</span>
<a href="#l22.128"></a><span id="l22.128"> </span>
<a href="#l22.129"></a><span id="l22.129">             if (NS_SUCCEEDED(err) &amp;&amp; pListRow)</span>
<a href="#l22.130"></a><span id="l22.130">             {</span>
<a href="#l22.131"></a><span id="l22.131">                 mdbOid rowOid;</span>
<a href="#l22.132"></a><span id="l22.132"> </span>
<a href="#l22.133"></a><span id="l22.133">                 if (NS_SUCCEEDED(pListRow-&gt;GetOid(m_mdbEnv, &amp;rowOid)))</span>
<a href="#l22.134"></a><span id="l22.134">                 {</span>
<a href="#l22.135"></a><span id="l22.135">                     if (IsListRowScopeToken(rowOid.mOid_Scope))</span>
<a href="#l22.136"></a><span id="l22.136" class="difflineat">@@ -2044,17 +2044,17 @@ NS_IMETHODIMP nsAddrDatabase::EditMailLi</span>
<a href="#l22.137"></a><span id="l22.137">   return NS_OK;</span>
<a href="#l22.138"></a><span id="l22.138"> }</span>
<a href="#l22.139"></a><span id="l22.139"> </span>
<a href="#l22.140"></a><span id="l22.140"> NS_IMETHODIMP nsAddrDatabase::ContainsMailList(nsIAbDirectory *mailList, bool *hasList)</span>
<a href="#l22.141"></a><span id="l22.141"> {</span>
<a href="#l22.142"></a><span id="l22.142">     if (!mailList || !m_mdbPabTable || !m_mdbEnv)</span>
<a href="#l22.143"></a><span id="l22.143">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l22.144"></a><span id="l22.144"> </span>
<a href="#l22.145"></a><span id="l22.145" class="difflineminus">-    mdb_err err = NS_OK;</span>
<a href="#l22.146"></a><span id="l22.146" class="difflineplus">+    nsresult err = NS_OK;</span>
<a href="#l22.147"></a><span id="l22.147">     mdb_bool hasOid;</span>
<a href="#l22.148"></a><span id="l22.148">     mdbOid rowOid;</span>
<a href="#l22.149"></a><span id="l22.149"> </span>
<a href="#l22.150"></a><span id="l22.150">     rowOid.mOid_Scope = m_ListRowScopeToken;</span>
<a href="#l22.151"></a><span id="l22.151"> </span>
<a href="#l22.152"></a><span id="l22.152">     nsCOMPtr&lt;nsIAbMDBDirectory&gt; dbmailList(do_QueryInterface(mailList,&amp;err));</span>
<a href="#l22.153"></a><span id="l22.153">     NS_ENSURE_SUCCESS(err, err);</span>
<a href="#l22.154"></a><span id="l22.154">     dbmailList-&gt;GetDbRowID((uint32_t*)&amp;rowOid.mOid_Id);</span>
<a href="#l22.155"></a><span id="l22.155" class="difflineat">@@ -2166,46 +2166,46 @@ void nsAddrDatabase::GetIntYarn(uint32_t</span>
<a href="#l22.156"></a><span id="l22.156"> nsresult nsAddrDatabase::AddCharStringColumn(nsIMdbRow* cardRow, mdb_column inColumn, const char* str)</span>
<a href="#l22.157"></a><span id="l22.157"> {</span>
<a href="#l22.158"></a><span id="l22.158">   if (!m_mdbEnv)</span>
<a href="#l22.159"></a><span id="l22.159">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l22.160"></a><span id="l22.160"> </span>
<a href="#l22.161"></a><span id="l22.161">   struct mdbYarn yarn;</span>
<a href="#l22.162"></a><span id="l22.162"> </span>
<a href="#l22.163"></a><span id="l22.163">   GetCharStringYarn((char *) str, &amp;yarn);</span>
<a href="#l22.164"></a><span id="l22.164" class="difflineminus">-  mdb_err err = cardRow-&gt;AddColumn(m_mdbEnv,  inColumn, &amp;yarn);</span>
<a href="#l22.165"></a><span id="l22.165" class="difflineplus">+  nsresult err = cardRow-&gt;AddColumn(m_mdbEnv, inColumn, &amp;yarn);</span>
<a href="#l22.166"></a><span id="l22.166"> </span>
<a href="#l22.167"></a><span id="l22.167">   return (NS_SUCCEEDED(err)) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l22.168"></a><span id="l22.168"> }</span>
<a href="#l22.169"></a><span id="l22.169"> </span>
<a href="#l22.170"></a><span id="l22.170"> nsresult nsAddrDatabase::AddStringColumn(nsIMdbRow* aCardRow, mdb_column aInColumn, const nsAString &amp; aStr)</span>
<a href="#l22.171"></a><span id="l22.171"> {</span>
<a href="#l22.172"></a><span id="l22.172">   if (!m_mdbEnv)</span>
<a href="#l22.173"></a><span id="l22.173">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l22.174"></a><span id="l22.174"> </span>
<a href="#l22.175"></a><span id="l22.175">   struct mdbYarn yarn;</span>
<a href="#l22.176"></a><span id="l22.176"> </span>
<a href="#l22.177"></a><span id="l22.177">   GetStringYarn(aStr, &amp;yarn);</span>
<a href="#l22.178"></a><span id="l22.178" class="difflineminus">-  mdb_err err = aCardRow-&gt;AddColumn(m_mdbEnv, aInColumn, &amp;yarn);</span>
<a href="#l22.179"></a><span id="l22.179" class="difflineplus">+  nsresult err = aCardRow-&gt;AddColumn(m_mdbEnv, aInColumn, &amp;yarn);</span>
<a href="#l22.180"></a><span id="l22.180"> </span>
<a href="#l22.181"></a><span id="l22.181">   return (NS_SUCCEEDED(err)) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l22.182"></a><span id="l22.182"> }</span>
<a href="#l22.183"></a><span id="l22.183"> </span>
<a href="#l22.184"></a><span id="l22.184"> nsresult nsAddrDatabase::AddIntColumn(nsIMdbRow* cardRow, mdb_column inColumn, uint32_t nValue)</span>
<a href="#l22.185"></a><span id="l22.185"> {</span>
<a href="#l22.186"></a><span id="l22.186">   if (!m_mdbEnv)</span>
<a href="#l22.187"></a><span id="l22.187">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l22.188"></a><span id="l22.188"> </span>
<a href="#l22.189"></a><span id="l22.189">   struct mdbYarn yarn;</span>
<a href="#l22.190"></a><span id="l22.190">   char    yarnBuf[100];</span>
<a href="#l22.191"></a><span id="l22.191"> </span>
<a href="#l22.192"></a><span id="l22.192">   yarn.mYarn_Buf = (void *) yarnBuf;</span>
<a href="#l22.193"></a><span id="l22.193">   yarn.mYarn_Size = sizeof(yarnBuf);</span>
<a href="#l22.194"></a><span id="l22.194">   GetIntYarn(nValue, &amp;yarn);</span>
<a href="#l22.195"></a><span id="l22.195" class="difflineminus">-  mdb_err err = cardRow-&gt;AddColumn(m_mdbEnv,  inColumn, &amp;yarn);</span>
<a href="#l22.196"></a><span id="l22.196" class="difflineplus">+  nsresult err = cardRow-&gt;AddColumn(m_mdbEnv, inColumn, &amp;yarn);</span>
<a href="#l22.197"></a><span id="l22.197"> </span>
<a href="#l22.198"></a><span id="l22.198">   return (NS_SUCCEEDED(err)) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l22.199"></a><span id="l22.199"> }</span>
<a href="#l22.200"></a><span id="l22.200"> </span>
<a href="#l22.201"></a><span id="l22.201"> nsresult nsAddrDatabase::AddBoolColumn(nsIMdbRow* cardRow, mdb_column inColumn, bool bValue)</span>
<a href="#l22.202"></a><span id="l22.202"> {</span>
<a href="#l22.203"></a><span id="l22.203">   if (!m_mdbEnv)</span>
<a href="#l22.204"></a><span id="l22.204">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l22.205"></a><span id="l22.205" class="difflineat">@@ -2213,17 +2213,17 @@ nsresult nsAddrDatabase::AddBoolColumn(n</span>
<a href="#l22.206"></a><span id="l22.206">   struct mdbYarn yarn;</span>
<a href="#l22.207"></a><span id="l22.207">   char    yarnBuf[100];</span>
<a href="#l22.208"></a><span id="l22.208"> </span>
<a href="#l22.209"></a><span id="l22.209">   yarn.mYarn_Buf = (void *) yarnBuf;</span>
<a href="#l22.210"></a><span id="l22.210">   yarn.mYarn_Size = sizeof(yarnBuf);</span>
<a href="#l22.211"></a><span id="l22.211"> </span>
<a href="#l22.212"></a><span id="l22.212">   GetIntYarn(bValue ? 1 : 0, &amp;yarn);</span>
<a href="#l22.213"></a><span id="l22.213"> </span>
<a href="#l22.214"></a><span id="l22.214" class="difflineminus">-  mdb_err err = cardRow-&gt;AddColumn(m_mdbEnv, inColumn, &amp;yarn);</span>
<a href="#l22.215"></a><span id="l22.215" class="difflineplus">+  nsresult err = cardRow-&gt;AddColumn(m_mdbEnv, inColumn, &amp;yarn);</span>
<a href="#l22.216"></a><span id="l22.216"> </span>
<a href="#l22.217"></a><span id="l22.217">   return (NS_SUCCEEDED(err)) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l22.218"></a><span id="l22.218"> }</span>
<a href="#l22.219"></a><span id="l22.219"> </span>
<a href="#l22.220"></a><span id="l22.220"> nsresult nsAddrDatabase::GetStringColumn(nsIMdbRow *cardRow, mdb_token outToken, nsString&amp; str)</span>
<a href="#l22.221"></a><span id="l22.221"> {</span>
<a href="#l22.222"></a><span id="l22.222">   nsresult    err = NS_ERROR_NULL_POINTER;</span>
<a href="#l22.223"></a><span id="l22.223">   nsIMdbCell    *cardCell;</span>
<a href="#l22.224"></a><span id="l22.224" class="difflineat">@@ -3186,17 +3186,17 @@ NS_IMETHODIMP nsAddrDatabase::FindMailLi</span>
<a href="#l22.225"></a><span id="l22.225">                                     m_LowerListNameColumnToken, false,</span>
<a href="#l22.226"></a><span id="l22.226">                                     false, getter_AddRefs(listRow), nullptr);</span>
<a href="#l22.227"></a><span id="l22.227">   *exist = (NS_SUCCEEDED(rv) &amp;&amp; listRow);</span>
<a href="#l22.228"></a><span id="l22.228">   return rv;</span>
<a href="#l22.229"></a><span id="l22.229"> }</span>
<a href="#l22.230"></a><span id="l22.230"> </span>
<a href="#l22.231"></a><span id="l22.231"> NS_IMETHODIMP nsAddrDatabase::GetCardCount(uint32_t *count)</span>
<a href="#l22.232"></a><span id="l22.232"> {</span>
<a href="#l22.233"></a><span id="l22.233" class="difflineminus">-    mdb_err rv;</span>
<a href="#l22.234"></a><span id="l22.234" class="difflineplus">+    nsresult rv;</span>
<a href="#l22.235"></a><span id="l22.235">     mdb_count c;</span>
<a href="#l22.236"></a><span id="l22.236">     rv = m_mdbPabTable-&gt;GetCount(m_mdbEnv, &amp;c);</span>
<a href="#l22.237"></a><span id="l22.237">     if (NS_SUCCEEDED(rv))</span>
<a href="#l22.238"></a><span id="l22.238">         *count = c - 1;  // Don't count LastRecordKey</span>
<a href="#l22.239"></a><span id="l22.239"> </span>
<a href="#l22.240"></a><span id="l22.240">     return rv;</span>
<a href="#l22.241"></a><span id="l22.241"> }</span>
<a href="#l22.242"></a><span id="l22.242"> </span>
<a href="#l22.243"></a><span id="l22.243" class="difflineat">@@ -3343,13 +3343,13 @@ nsAddrDatabase::GetRowForCharColumn(cons</span>
<a href="#l22.244"></a><span id="l22.244">   return NS_ERROR_FAILURE;</span>
<a href="#l22.245"></a><span id="l22.245"> }</span>
<a href="#l22.246"></a><span id="l22.246"> </span>
<a href="#l22.247"></a><span id="l22.247"> nsresult nsAddrDatabase::DeleteRow(nsIMdbTable* dbTable, nsIMdbRow* dbRow)</span>
<a href="#l22.248"></a><span id="l22.248"> {</span>
<a href="#l22.249"></a><span id="l22.249">   if (!m_mdbEnv)</span>
<a href="#l22.250"></a><span id="l22.250">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l22.251"></a><span id="l22.251"> </span>
<a href="#l22.252"></a><span id="l22.252" class="difflineminus">-  mdb_err err = dbRow-&gt;CutAllColumns(m_mdbEnv);</span>
<a href="#l22.253"></a><span id="l22.253" class="difflineplus">+  nsresult err = dbRow-&gt;CutAllColumns(m_mdbEnv);</span>
<a href="#l22.254"></a><span id="l22.254">   err = dbTable-&gt;CutRow(m_mdbEnv, dbRow);</span>
<a href="#l22.255"></a><span id="l22.255"> </span>
<a href="#l22.256"></a><span id="l22.256">   return (NS_SUCCEEDED(err)) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l22.257"></a><span id="l22.257"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -76,19 +76,19 @@ nsresult nsMsgFolderCache::InitMDBInfo()</span>
<a href="#l23.4"></a><span id="l23.4"> // set up empty tables, dbFolderInfo, etc.</span>
<a href="#l23.5"></a><span id="l23.5"> nsresult nsMsgFolderCache::InitNewDB()</span>
<a href="#l23.6"></a><span id="l23.6"> {</span>
<a href="#l23.7"></a><span id="l23.7">   nsresult err = InitMDBInfo();</span>
<a href="#l23.8"></a><span id="l23.8">   if (NS_SUCCEEDED(err))</span>
<a href="#l23.9"></a><span id="l23.9">   {</span>
<a href="#l23.10"></a><span id="l23.10">     nsIMdbStore *store = GetStore();</span>
<a href="#l23.11"></a><span id="l23.11">     // create the unique table for the dbFolderInfo.</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    mdb_err mdberr;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+    nsresult mdberr;</span>
<a href="#l23.14"></a><span id="l23.14">     // TODO: this error assignment is suspicious and never checked.</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-    mdberr = (nsresult) store-&gt;NewTable(GetEnv(), m_folderRowScopeToken,</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+    mdberr = store-&gt;NewTable(GetEnv(), m_folderRowScopeToken,</span>
<a href="#l23.17"></a><span id="l23.17">     m_folderTableKindToken, false, nullptr, &amp;m_mdbAllFoldersTable);</span>
<a href="#l23.18"></a><span id="l23.18">   }</span>
<a href="#l23.19"></a><span id="l23.19">   return err;</span>
<a href="#l23.20"></a><span id="l23.20"> }</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22"> nsresult nsMsgFolderCache::InitExistingDB()</span>
<a href="#l23.23"></a><span id="l23.23"> {</span>
<a href="#l23.24"></a><span id="l23.24">   nsresult err = InitMDBInfo();</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineat">@@ -264,17 +264,17 @@ NS_IMETHODIMP nsMsgFolderCache::GetCache</span>
<a href="#l23.26"></a><span id="l23.26">   if (*result)</span>
<a href="#l23.27"></a><span id="l23.27">     return NS_OK;</span>
<a href="#l23.28"></a><span id="l23.28">   else if (createIfMissing)</span>
<a href="#l23.29"></a><span id="l23.29">   {</span>
<a href="#l23.30"></a><span id="l23.30">     nsIMdbRow* hdrRow;</span>
<a href="#l23.31"></a><span id="l23.31"> </span>
<a href="#l23.32"></a><span id="l23.32">     if (GetStore())</span>
<a href="#l23.33"></a><span id="l23.33">     {</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineminus">-      mdb_err err = GetStore()-&gt;NewRow(GetEnv(), m_folderRowScopeToken,   // row scope for row ids</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+      nsresult err = GetStore()-&gt;NewRow(GetEnv(), m_folderRowScopeToken, // row scope for row ids</span>
<a href="#l23.36"></a><span id="l23.36">         &amp;hdrRow);</span>
<a href="#l23.37"></a><span id="l23.37">       if (NS_SUCCEEDED(err) &amp;&amp; hdrRow)</span>
<a href="#l23.38"></a><span id="l23.38">       {</span>
<a href="#l23.39"></a><span id="l23.39">         m_mdbAllFoldersTable-&gt;AddRow(GetEnv(), hdrRow);</span>
<a href="#l23.40"></a><span id="l23.40">         nsresult ret = AddCacheElement(pathKey, hdrRow, result);</span>
<a href="#l23.41"></a><span id="l23.41">         if (*result)</span>
<a href="#l23.42"></a><span id="l23.42">           (*result)-&gt;SetStringProperty(&quot;key&quot;, pathKey);</span>
<a href="#l23.43"></a><span id="l23.43">         hdrRow-&gt;Release();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -205,17 +205,17 @@ nsDBFolderInfo::nsDBFolderInfo(nsMsgData</span>
<a href="#l24.4"></a><span id="l24.4">         }</span>
<a href="#l24.5"></a><span id="l24.5">       }</span>
<a href="#l24.6"></a><span id="l24.6">     }</span>
<a href="#l24.7"></a><span id="l24.7">   }</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9">   m_mdb = mdb;</span>
<a href="#l24.10"></a><span id="l24.10">   if (mdb)</span>
<a href="#l24.11"></a><span id="l24.11">   {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    mdb_err err;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    nsresult err;</span>
<a href="#l24.14"></a><span id="l24.14"> </span>
<a href="#l24.15"></a><span id="l24.15">     //		mdb-&gt;AddRef();</span>
<a href="#l24.16"></a><span id="l24.16">     err = m_mdb-&gt;GetStore()-&gt;StringToToken(mdb-&gt;GetEnv(), kDBFolderInfoScope, &amp;m_rowScopeToken);</span>
<a href="#l24.17"></a><span id="l24.17">     if (NS_SUCCEEDED(err))</span>
<a href="#l24.18"></a><span id="l24.18">     {</span>
<a href="#l24.19"></a><span id="l24.19">       err = m_mdb-&gt;GetStore()-&gt;StringToToken(mdb-&gt;GetEnv(), kDBFolderInfoTableKind, &amp;m_tableKindToken);</span>
<a href="#l24.20"></a><span id="l24.20">       if (NS_SUCCEEDED(err))</span>
<a href="#l24.21"></a><span id="l24.21">       {</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -256,28 +256,28 @@ void nsDBFolderInfo::ReleaseExternalRefe</span>
<a href="#l24.23"></a><span id="l24.23"> // this routine sets up a new db to know about the dbFolderInfo stuff...</span>
<a href="#l24.24"></a><span id="l24.24"> nsresult nsDBFolderInfo::AddToNewMDB()</span>
<a href="#l24.25"></a><span id="l24.25"> {</span>
<a href="#l24.26"></a><span id="l24.26">   nsresult ret = NS_OK;</span>
<a href="#l24.27"></a><span id="l24.27">   if (m_mdb &amp;&amp; m_mdb-&gt;GetStore())</span>
<a href="#l24.28"></a><span id="l24.28">   {</span>
<a href="#l24.29"></a><span id="l24.29">     nsIMdbStore *store = m_mdb-&gt;GetStore();</span>
<a href="#l24.30"></a><span id="l24.30">     // create the unique table for the dbFolderInfo.</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-    mdb_err err = store-&gt;NewTable(m_mdb-&gt;GetEnv(), m_rowScopeToken,</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+    nsresult err = store-&gt;NewTable(m_mdb-&gt;GetEnv(), m_rowScopeToken,</span>
<a href="#l24.33"></a><span id="l24.33">       m_tableKindToken, true, nullptr, &amp;m_mdbTable);</span>
<a href="#l24.34"></a><span id="l24.34"> </span>
<a href="#l24.35"></a><span id="l24.35">     // create the singleton row for the dbFolderInfo.</span>
<a href="#l24.36"></a><span id="l24.36">     err  = store-&gt;NewRowWithOid(m_mdb-&gt;GetEnv(),</span>
<a href="#l24.37"></a><span id="l24.37">       &amp;gDBFolderInfoOID, &amp;m_mdbRow);</span>
<a href="#l24.38"></a><span id="l24.38"> </span>
<a href="#l24.39"></a><span id="l24.39">     // add the row to the singleton table.</span>
<a href="#l24.40"></a><span id="l24.40">     if (m_mdbRow &amp;&amp; NS_SUCCEEDED(err))</span>
<a href="#l24.41"></a><span id="l24.41">       err = m_mdbTable-&gt;AddRow(m_mdb-&gt;GetEnv(), m_mdbRow);</span>
<a href="#l24.42"></a><span id="l24.42"> </span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-    ret = err;	// what are we going to do about mdb_err's?</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+    ret = err;	// what are we going to do about nsresult's?</span>
<a href="#l24.45"></a><span id="l24.45">   }</span>
<a href="#l24.46"></a><span id="l24.46">   return ret;</span>
<a href="#l24.47"></a><span id="l24.47"> }</span>
<a href="#l24.48"></a><span id="l24.48"> </span>
<a href="#l24.49"></a><span id="l24.49"> nsresult nsDBFolderInfo::InitFromExistingDB()</span>
<a href="#l24.50"></a><span id="l24.50"> {</span>
<a href="#l24.51"></a><span id="l24.51">   nsresult ret = NS_OK;</span>
<a href="#l24.52"></a><span id="l24.52">   if (m_mdb &amp;&amp; m_mdb-&gt;GetStore())</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineat">@@ -925,17 +925,17 @@ NS_IMETHODIMP nsDBFolderInfo::GetTransfe</span>
<a href="#l24.54"></a><span id="l24.54">   char columnName[100];</span>
<a href="#l24.55"></a><span id="l24.55">   mdbYarn cellName = { columnName, 0, sizeof(columnName), 0, 0, nullptr };</span>
<a href="#l24.56"></a><span id="l24.56"> </span>
<a href="#l24.57"></a><span id="l24.57">   NS_ASSERTION(m_mdbRow, &quot;null row in getTransferInfo&quot;);</span>
<a href="#l24.58"></a><span id="l24.58">   m_mdbRow-&gt;GetCount(m_mdb-&gt;GetEnv(), &amp;numCells);</span>
<a href="#l24.59"></a><span id="l24.59">   // iterate over the cells in the dbfolderinfo remembering attribute names and values.</span>
<a href="#l24.60"></a><span id="l24.60">   for (mdb_count cellIndex = 0; cellIndex &lt; numCells; cellIndex++)</span>
<a href="#l24.61"></a><span id="l24.61">   {</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineminus">-    mdb_err err = m_mdbRow-&gt;SeekCellYarn(m_mdb-&gt;GetEnv(), cellIndex, &amp;cellColumn, nullptr);</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineplus">+    nsresult err = m_mdbRow-&gt;SeekCellYarn(m_mdb-&gt;GetEnv(), cellIndex, &amp;cellColumn, nullptr);</span>
<a href="#l24.64"></a><span id="l24.64">     if (NS_SUCCEEDED(err))</span>
<a href="#l24.65"></a><span id="l24.65">     {</span>
<a href="#l24.66"></a><span id="l24.66">       err = m_mdbRow-&gt;AliasCellYarn(m_mdb-&gt;GetEnv(), cellColumn, &amp;cellYarn);</span>
<a href="#l24.67"></a><span id="l24.67">       if (NS_SUCCEEDED(err))</span>
<a href="#l24.68"></a><span id="l24.68">       {</span>
<a href="#l24.69"></a><span id="l24.69">         m_mdb-&gt;GetStore()-&gt;TokenToString(m_mdb-&gt;GetEnv(), cellColumn, &amp;cellName);</span>
<a href="#l24.70"></a><span id="l24.70">         newInfo-&gt;m_values.AppendElement(Substring((const char *)cellYarn.mYarn_Buf,</span>
<a href="#l24.71"></a><span id="l24.71">                                         (const char *) cellYarn.mYarn_Buf + cellYarn.mYarn_Fill));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsImapMailDatabase.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsImapMailDatabase.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -138,17 +138,17 @@ NS_IMETHODIMP nsImapMailDatabase::Update</span>
<a href="#l25.4"></a><span id="l25.4">       pendingRow-&gt;GetCount(GetEnv(), &amp;numCells);</span>
<a href="#l25.5"></a><span id="l25.5">       aNewHdr-&gt;GetFlags(&amp;existingFlags);</span>
<a href="#l25.6"></a><span id="l25.6">       // iterate over the cells in the pending hdr setting properties on the aNewHdr.</span>
<a href="#l25.7"></a><span id="l25.7">       // we skip cell 0, which is the messageId;</span>
<a href="#l25.8"></a><span id="l25.8">       nsMsgHdr* msgHdr = static_cast&lt;nsMsgHdr*&gt;(aNewHdr);      // closed system, cast ok</span>
<a href="#l25.9"></a><span id="l25.9">       nsIMdbRow *row = msgHdr-&gt;GetMDBRow();</span>
<a href="#l25.10"></a><span id="l25.10">       for (mdb_count cellIndex = 1; cellIndex &lt; numCells; cellIndex++)</span>
<a href="#l25.11"></a><span id="l25.11">       {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        mdb_err err = pendingRow-&gt;SeekCellYarn(GetEnv(), cellIndex, &amp;cellColumn, nullptr);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+        nsresult err = pendingRow-&gt;SeekCellYarn(GetEnv(), cellIndex, &amp;cellColumn, nullptr);</span>
<a href="#l25.14"></a><span id="l25.14">         if (NS_SUCCEEDED(err))</span>
<a href="#l25.15"></a><span id="l25.15">         {</span>
<a href="#l25.16"></a><span id="l25.16">           err = pendingRow-&gt;AliasCellYarn(GetEnv(), cellColumn, &amp;cellYarn);</span>
<a href="#l25.17"></a><span id="l25.17">           if (NS_SUCCEEDED(err))</span>
<a href="#l25.18"></a><span id="l25.18">           {</span>
<a href="#l25.19"></a><span id="l25.19">             if (row)</span>
<a href="#l25.20"></a><span id="l25.20">               row-&gt;AddColumn(GetEnv(), cellColumn, &amp;cellYarn);</span>
<a href="#l25.21"></a><span id="l25.21">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMailDatabase.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMailDatabase.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -140,18 +140,18 @@ NS_IMETHODIMP  nsMailDatabase::RemoveOff</span>
<a href="#l26.4"></a><span id="l26.4">   row-&gt;CutAllColumns(GetEnv());</span>
<a href="#l26.5"></a><span id="l26.5">   return rv;</span>
<a href="#l26.6"></a><span id="l26.6"> }</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> NS_IMETHODIMP nsMailDatabase::GetOfflineOpForKey(nsMsgKey msgKey, bool create, nsIMsgOfflineImapOperation **offlineOp)</span>
<a href="#l26.9"></a><span id="l26.9"> {</span>
<a href="#l26.10"></a><span id="l26.10">   mdb_bool	hasOid;</span>
<a href="#l26.11"></a><span id="l26.11">   mdbOid		rowObjectId;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  mdb_err   err;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  </span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+  nsresult err;</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+</span>
<a href="#l26.16"></a><span id="l26.16">   if (!IMAPOffline)</span>
<a href="#l26.17"></a><span id="l26.17">     IMAPOffline = PR_NewLogModule(&quot;IMAPOFFLINE&quot;);</span>
<a href="#l26.18"></a><span id="l26.18">   nsresult rv = GetAllOfflineOpsTable();</span>
<a href="#l26.19"></a><span id="l26.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.20"></a><span id="l26.20">   </span>
<a href="#l26.21"></a><span id="l26.21">   if (!offlineOp || !m_mdbAllOfflineOpsTable)</span>
<a href="#l26.22"></a><span id="l26.22">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l26.23"></a><span id="l26.23">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1621,17 +1621,17 @@ nsresult nsMsgDatabase::InitNewDB()</span>
<a href="#l27.4"></a><span id="l27.4">     if (dbFolderInfo)</span>
<a href="#l27.5"></a><span id="l27.5">     {</span>
<a href="#l27.6"></a><span id="l27.6">       NS_ADDREF(dbFolderInfo);</span>
<a href="#l27.7"></a><span id="l27.7">       err = dbFolderInfo-&gt;AddToNewMDB();</span>
<a href="#l27.8"></a><span id="l27.8">       dbFolderInfo-&gt;SetVersion(GetCurVersion());</span>
<a href="#l27.9"></a><span id="l27.9">       dbFolderInfo-&gt;SetBooleanProperty(kFixedBadRefThreadingProp, true);</span>
<a href="#l27.10"></a><span id="l27.10">       nsIMdbStore *store = GetStore();</span>
<a href="#l27.11"></a><span id="l27.11">       // create the unique table for the dbFolderInfo.</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-      mdb_err mdberr;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+      nsresult mdberr;</span>
<a href="#l27.14"></a><span id="l27.14">       struct mdbOid allMsgHdrsTableOID;</span>
<a href="#l27.15"></a><span id="l27.15">       struct mdbOid allThreadsTableOID;</span>
<a href="#l27.16"></a><span id="l27.16">       if (!store)</span>
<a href="#l27.17"></a><span id="l27.17">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19">       allMsgHdrsTableOID.mOid_Scope = m_hdrRowScopeToken;</span>
<a href="#l27.20"></a><span id="l27.20">       allMsgHdrsTableOID.mOid_Id = kAllMsgHdrsTableKey;</span>
<a href="#l27.21"></a><span id="l27.21">       allThreadsTableOID.mOid_Scope = m_threadRowScopeToken;</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -1705,29 +1705,29 @@ nsresult nsMsgDatabase::InitExistingDB()</span>
<a href="#l27.23"></a><span id="l27.23">     NS_ENSURE_SUCCESS(err, err);</span>
<a href="#l27.24"></a><span id="l27.24">     // create new all msg hdrs table, if it doesn't exist.</span>
<a href="#l27.25"></a><span id="l27.25">     if (NS_SUCCEEDED(err) &amp;&amp; !m_mdbAllMsgHeadersTable)</span>
<a href="#l27.26"></a><span id="l27.26">     {</span>
<a href="#l27.27"></a><span id="l27.27">       struct mdbOid allMsgHdrsTableOID;</span>
<a href="#l27.28"></a><span id="l27.28">       allMsgHdrsTableOID.mOid_Scope = m_hdrRowScopeToken;</span>
<a href="#l27.29"></a><span id="l27.29">       allMsgHdrsTableOID.mOid_Id = kAllMsgHdrsTableKey;</span>
<a href="#l27.30"></a><span id="l27.30"> </span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-      mdb_err mdberr  = GetStore()-&gt;NewTableWithOid(GetEnv(), &amp;allMsgHdrsTableOID, m_hdrTableKindToken,</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+      nsresult mdberr = GetStore()-&gt;NewTableWithOid(GetEnv(), &amp;allMsgHdrsTableOID, m_hdrTableKindToken,</span>
<a href="#l27.33"></a><span id="l27.33">         false, nullptr, &amp;m_mdbAllMsgHeadersTable);</span>
<a href="#l27.34"></a><span id="l27.34">       if (NS_FAILED(mdberr) || !m_mdbAllMsgHeadersTable)</span>
<a href="#l27.35"></a><span id="l27.35">         err = NS_ERROR_FAILURE;</span>
<a href="#l27.36"></a><span id="l27.36">     }</span>
<a href="#l27.37"></a><span id="l27.37">     struct mdbOid allThreadsTableOID;</span>
<a href="#l27.38"></a><span id="l27.38">     allThreadsTableOID.mOid_Scope = m_threadRowScopeToken;</span>
<a href="#l27.39"></a><span id="l27.39">     allThreadsTableOID.mOid_Id = kAllThreadsTableKey;</span>
<a href="#l27.40"></a><span id="l27.40">     err = GetStore()-&gt;GetTable(GetEnv(), &amp;gAllThreadsTableOID, &amp;m_mdbAllThreadsTable);</span>
<a href="#l27.41"></a><span id="l27.41">     if (!m_mdbAllThreadsTable)</span>
<a href="#l27.42"></a><span id="l27.42">     {</span>
<a href="#l27.43"></a><span id="l27.43"> </span>
<a href="#l27.44"></a><span id="l27.44" class="difflineminus">-      mdb_err mdberr  = GetStore()-&gt;NewTableWithOid(GetEnv(), &amp;allThreadsTableOID, m_allThreadsTableKindToken,</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineplus">+      nsresult mdberr = GetStore()-&gt;NewTableWithOid(GetEnv(), &amp;allThreadsTableOID, m_allThreadsTableKindToken,</span>
<a href="#l27.46"></a><span id="l27.46">         false, nullptr, &amp;m_mdbAllThreadsTable);</span>
<a href="#l27.47"></a><span id="l27.47">       if (NS_FAILED(mdberr) || !m_mdbAllThreadsTable)</span>
<a href="#l27.48"></a><span id="l27.48">         err = NS_ERROR_FAILURE;</span>
<a href="#l27.49"></a><span id="l27.49">     }</span>
<a href="#l27.50"></a><span id="l27.50">   }</span>
<a href="#l27.51"></a><span id="l27.51">   if (NS_SUCCEEDED(err) &amp;&amp; m_dbFolderInfo)</span>
<a href="#l27.52"></a><span id="l27.52">   {</span>
<a href="#l27.53"></a><span id="l27.53">     bool fixedBadRefThreading;</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineat">@@ -4289,17 +4289,17 @@ nsresult nsMsgDatabase::CreateNewThread(</span>
<a href="#l27.55"></a><span id="l27.55">   if (!pnewThread || !m_mdbStore)</span>
<a href="#l27.56"></a><span id="l27.56">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l27.57"></a><span id="l27.57"> </span>
<a href="#l27.58"></a><span id="l27.58">   threadTableOID.mOid_Scope = m_hdrRowScopeToken;</span>
<a href="#l27.59"></a><span id="l27.59">   threadTableOID.mOid_Id = threadId;</span>
<a href="#l27.60"></a><span id="l27.60"> </span>
<a href="#l27.61"></a><span id="l27.61">   // Under some circumstances, mork seems to reuse an old table when we create one.</span>
<a href="#l27.62"></a><span id="l27.62">   // Prevent problems from that by finding any old table first, and deleting its rows.</span>
<a href="#l27.63"></a><span id="l27.63" class="difflineminus">-  mdb_err res = GetStore()-&gt;GetTable(GetEnv(), &amp;threadTableOID, getter_AddRefs(threadTable));</span>
<a href="#l27.64"></a><span id="l27.64" class="difflineplus">+  nsresult res = GetStore()-&gt;GetTable(GetEnv(), &amp;threadTableOID, getter_AddRefs(threadTable));</span>
<a href="#l27.65"></a><span id="l27.65">   if (NS_SUCCEEDED(res) &amp;&amp; threadTable)</span>
<a href="#l27.66"></a><span id="l27.66">     threadTable-&gt;CutAllRows(GetEnv());</span>
<a href="#l27.67"></a><span id="l27.67"> </span>
<a href="#l27.68"></a><span id="l27.68">   err  = GetStore()-&gt;NewTableWithOid(GetEnv(), &amp;threadTableOID, m_threadTableKindToken,</span>
<a href="#l27.69"></a><span id="l27.69">     false, nullptr, getter_AddRefs(threadTable));</span>
<a href="#l27.70"></a><span id="l27.70">   if (NS_FAILED(err))</span>
<a href="#l27.71"></a><span id="l27.71">     return err;</span>
<a href="#l27.72"></a><span id="l27.72"> </span>
<a href="#l27.73"></a><span id="l27.73" class="difflineat">@@ -4388,17 +4388,17 @@ nsIMsgThread *  nsMsgDatabase::GetThread</span>
<a href="#l27.74"></a><span id="l27.74">   subjectYarn.mYarn_Fill = PL_strlen(subject.get());</span>
<a href="#l27.75"></a><span id="l27.75">   subjectYarn.mYarn_Form = 0;</span>
<a href="#l27.76"></a><span id="l27.76">   subjectYarn.mYarn_Size = subjectYarn.mYarn_Fill;</span>
<a href="#l27.77"></a><span id="l27.77"> </span>
<a href="#l27.78"></a><span id="l27.78">   nsCOMPtr &lt;nsIMdbRow&gt;  threadRow;</span>
<a href="#l27.79"></a><span id="l27.79">   mdbOid    outRowId;</span>
<a href="#l27.80"></a><span id="l27.80">   if (m_mdbStore)</span>
<a href="#l27.81"></a><span id="l27.81">   {</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineminus">-    mdb_err result = m_mdbStore-&gt;FindRow(GetEnv(), m_threadRowScopeToken,</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineplus">+    nsresult result = m_mdbStore-&gt;FindRow(GetEnv(), m_threadRowScopeToken,</span>
<a href="#l27.84"></a><span id="l27.84">       m_threadSubjectColumnToken, &amp;subjectYarn,  &amp;outRowId, getter_AddRefs(threadRow));</span>
<a href="#l27.85"></a><span id="l27.85">     if (NS_SUCCEEDED(result) &amp;&amp; threadRow)</span>
<a href="#l27.86"></a><span id="l27.86">     {</span>
<a href="#l27.87"></a><span id="l27.87">       //Get key from row</span>
<a href="#l27.88"></a><span id="l27.88">       mdbOid outOid;</span>
<a href="#l27.89"></a><span id="l27.89">       nsMsgKey key = 0;</span>
<a href="#l27.90"></a><span id="l27.90">       if (NS_SUCCEEDED(threadRow-&gt;GetOid(GetEnv(), &amp;outOid)))</span>
<a href="#l27.91"></a><span id="l27.91">         key = outOid.mOid_Id;</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineat">@@ -4587,17 +4587,17 @@ NS_IMETHODIMP nsMsgDatabase::GetMsgHdrFo</span>
<a href="#l27.93"></a><span id="l27.93"> </span>
<a href="#l27.94"></a><span id="l27.94">   messageIdYarn.mYarn_Buf = (void *) aMsgID;</span>
<a href="#l27.95"></a><span id="l27.95">   messageIdYarn.mYarn_Fill = PL_strlen(aMsgID);</span>
<a href="#l27.96"></a><span id="l27.96">   messageIdYarn.mYarn_Form = 0;</span>
<a href="#l27.97"></a><span id="l27.97">   messageIdYarn.mYarn_Size = messageIdYarn.mYarn_Fill;</span>
<a href="#l27.98"></a><span id="l27.98"> </span>
<a href="#l27.99"></a><span id="l27.99">   nsIMdbRow *hdrRow;</span>
<a href="#l27.100"></a><span id="l27.100">   mdbOid outRowId;</span>
<a href="#l27.101"></a><span id="l27.101" class="difflineminus">-  mdb_err result;</span>
<a href="#l27.102"></a><span id="l27.102" class="difflineplus">+  nsresult result;</span>
<a href="#l27.103"></a><span id="l27.103">   if (m_mdbStore)</span>
<a href="#l27.104"></a><span id="l27.104">     result = m_mdbStore-&gt;FindRow(GetEnv(), m_hdrRowScopeToken,</span>
<a href="#l27.105"></a><span id="l27.105">       m_messageIdColumnToken, &amp;messageIdYarn,  &amp;outRowId,</span>
<a href="#l27.106"></a><span id="l27.106">       &amp;hdrRow);</span>
<a href="#l27.107"></a><span id="l27.107">   else</span>
<a href="#l27.108"></a><span id="l27.108">     return NS_ERROR_FAILURE;</span>
<a href="#l27.109"></a><span id="l27.109">   if (NS_SUCCEEDED(result) &amp;&amp; hdrRow)</span>
<a href="#l27.110"></a><span id="l27.110">   {</span>
<a href="#l27.111"></a><span id="l27.111" class="difflineat">@@ -4625,17 +4625,17 @@ NS_IMETHODIMP nsMsgDatabase::GetMsgHdrFo</span>
<a href="#l27.112"></a><span id="l27.112">   mdbYarn gMailMessageIdYarn;</span>
<a href="#l27.113"></a><span id="l27.113">   gMailMessageIdYarn.mYarn_Buf = (void *) aGMMsgId;</span>
<a href="#l27.114"></a><span id="l27.114">   gMailMessageIdYarn.mYarn_Fill = strlen(aGMMsgId);</span>
<a href="#l27.115"></a><span id="l27.115">   gMailMessageIdYarn.mYarn_Form = 0;</span>
<a href="#l27.116"></a><span id="l27.116">   gMailMessageIdYarn.mYarn_Size = gMailMessageIdYarn.mYarn_Fill;</span>
<a href="#l27.117"></a><span id="l27.117"> </span>
<a href="#l27.118"></a><span id="l27.118">   nsIMdbRow *hdrRow;</span>
<a href="#l27.119"></a><span id="l27.119">   mdbOid outRowId;</span>
<a href="#l27.120"></a><span id="l27.120" class="difflineminus">-  mdb_err result;</span>
<a href="#l27.121"></a><span id="l27.121" class="difflineplus">+  nsresult result;</span>
<a href="#l27.122"></a><span id="l27.122">   mdb_token property_token;</span>
<a href="#l27.123"></a><span id="l27.123">   NS_ENSURE_TRUE(m_mdbStore, NS_ERROR_NULL_POINTER);</span>
<a href="#l27.124"></a><span id="l27.124">   result = m_mdbStore-&gt;StringToToken(GetEnv(), &quot;X-GM-MSGID&quot;,</span>
<a href="#l27.125"></a><span id="l27.125">     &amp;property_token);</span>
<a href="#l27.126"></a><span id="l27.126">   NS_ENSURE_SUCCESS(result, result);</span>
<a href="#l27.127"></a><span id="l27.127">   result = m_mdbStore-&gt;FindRow(GetEnv(), m_hdrRowScopeToken,</span>
<a href="#l27.128"></a><span id="l27.128">     property_token, &amp;gMailMessageIdYarn, &amp;outRowId, &amp;hdrRow);</span>
<a href="#l27.129"></a><span id="l27.129">   if (NS_SUCCEEDED(result) &amp;&amp; hdrRow)</span>
<a href="#l27.130"></a><span id="l27.130" class="difflineat">@@ -4663,17 +4663,17 @@ nsIMsgDBHdr *nsMsgDatabase::GetMsgHdrFor</span>
<a href="#l27.131"></a><span id="l27.131"> </span>
<a href="#l27.132"></a><span id="l27.132">   subjectYarn.mYarn_Buf = (void*)subject.get();</span>
<a href="#l27.133"></a><span id="l27.133">   subjectYarn.mYarn_Fill = PL_strlen(subject.get());</span>
<a href="#l27.134"></a><span id="l27.134">   subjectYarn.mYarn_Form = 0;</span>
<a href="#l27.135"></a><span id="l27.135">   subjectYarn.mYarn_Size = subjectYarn.mYarn_Fill;</span>
<a href="#l27.136"></a><span id="l27.136"> </span>
<a href="#l27.137"></a><span id="l27.137">   nsIMdbRow *hdrRow;</span>
<a href="#l27.138"></a><span id="l27.138">   mdbOid outRowId;</span>
<a href="#l27.139"></a><span id="l27.139" class="difflineminus">-  mdb_err result = GetStore()-&gt;FindRow(GetEnv(), m_hdrRowScopeToken,</span>
<a href="#l27.140"></a><span id="l27.140" class="difflineplus">+  nsresult result = GetStore()-&gt;FindRow(GetEnv(), m_hdrRowScopeToken,</span>
<a href="#l27.141"></a><span id="l27.141">     m_subjectColumnToken, &amp;subjectYarn,  &amp;outRowId,</span>
<a href="#l27.142"></a><span id="l27.142">     &amp;hdrRow);</span>
<a href="#l27.143"></a><span id="l27.143">   if (NS_SUCCEEDED(result) &amp;&amp; hdrRow)</span>
<a href="#l27.144"></a><span id="l27.144">   {</span>
<a href="#l27.145"></a><span id="l27.145">     //Get key from row</span>
<a href="#l27.146"></a><span id="l27.146">     mdbOid outOid;</span>
<a href="#l27.147"></a><span id="l27.147">     nsMsgKey key = 0;</span>
<a href="#l27.148"></a><span id="l27.148">     if (NS_SUCCEEDED(hdrRow-&gt;GetOid(GetEnv(), &amp;outOid)))</span>
<a href="#l27.149"></a><span id="l27.149" class="difflineat">@@ -4738,18 +4738,18 @@ nsIMsgThread *  nsMsgDatabase::GetThread</span>
<a href="#l27.150"></a><span id="l27.150">   }</span>
<a href="#l27.151"></a><span id="l27.151">   if (m_mdbStore)</span>
<a href="#l27.152"></a><span id="l27.152">   {</span>
<a href="#l27.153"></a><span id="l27.153">     mdbOid tableId;</span>
<a href="#l27.154"></a><span id="l27.154">     tableId.mOid_Id = threadId;</span>
<a href="#l27.155"></a><span id="l27.155">     tableId.mOid_Scope = m_hdrRowScopeToken;</span>
<a href="#l27.156"></a><span id="l27.156"> </span>
<a href="#l27.157"></a><span id="l27.157">     nsCOMPtr&lt;nsIMdbTable&gt; threadTable;</span>
<a href="#l27.158"></a><span id="l27.158" class="difflineminus">-    mdb_err res = m_mdbStore-&gt;GetTable(GetEnv(), &amp;tableId,</span>
<a href="#l27.159"></a><span id="l27.159" class="difflineminus">-                                       getter_AddRefs(threadTable));</span>
<a href="#l27.160"></a><span id="l27.160" class="difflineplus">+    nsresult res = m_mdbStore-&gt;GetTable(GetEnv(), &amp;tableId,</span>
<a href="#l27.161"></a><span id="l27.161" class="difflineplus">+                                        getter_AddRefs(threadTable));</span>
<a href="#l27.162"></a><span id="l27.162"> </span>
<a href="#l27.163"></a><span id="l27.163">     if (NS_SUCCEEDED(res) &amp;&amp; threadTable)</span>
<a href="#l27.164"></a><span id="l27.164">     {</span>
<a href="#l27.165"></a><span id="l27.165">       retThread = new nsMsgThread(this, threadTable);</span>
<a href="#l27.166"></a><span id="l27.166">       if (retThread)</span>
<a href="#l27.167"></a><span id="l27.167">       {</span>
<a href="#l27.168"></a><span id="l27.168">         NS_ADDREF(retThread);</span>
<a href="#l27.169"></a><span id="l27.169">         m_cachedThread = retThread;</span>
<a href="#l27.170"></a><span id="l27.170" class="difflineat">@@ -5695,17 +5695,17 @@ nsMsgDatabase::GetNewList(uint32_t *aCou</span>
<a href="#l27.171"></a><span id="l27.171">     return NS_OK;</span>
<a href="#l27.172"></a><span id="l27.172"> }</span>
<a href="#l27.173"></a><span id="l27.173"> </span>
<a href="#l27.174"></a><span id="l27.174"> nsresult nsMsgDatabase::GetSearchResultsTable(const char *searchFolderUri, bool createIfMissing, nsIMdbTable **table)</span>
<a href="#l27.175"></a><span id="l27.175"> {</span>
<a href="#l27.176"></a><span id="l27.176">   mdb_kind kindToken;</span>
<a href="#l27.177"></a><span id="l27.177">   mdb_count numTables;</span>
<a href="#l27.178"></a><span id="l27.178">   mdb_bool mustBeUnique;</span>
<a href="#l27.179"></a><span id="l27.179" class="difflineminus">-  mdb_err err = m_mdbStore-&gt;StringToToken(GetEnv(), searchFolderUri, &amp;kindToken);</span>
<a href="#l27.180"></a><span id="l27.180" class="difflineplus">+  nsresult err = m_mdbStore-&gt;StringToToken(GetEnv(), searchFolderUri, &amp;kindToken);</span>
<a href="#l27.181"></a><span id="l27.181">   err = m_mdbStore-&gt;GetTableKind(GetEnv(), m_hdrRowScopeToken,  kindToken,</span>
<a href="#l27.182"></a><span id="l27.182">                                   &amp;numTables, &amp;mustBeUnique, table);</span>
<a href="#l27.183"></a><span id="l27.183">   if ((!*table || NS_FAILED(err)) &amp;&amp; createIfMissing)</span>
<a href="#l27.184"></a><span id="l27.184">     err = m_mdbStore-&gt;NewTable(GetEnv(), m_hdrRowScopeToken, kindToken, true, nullptr, table);</span>
<a href="#l27.185"></a><span id="l27.185"> </span>
<a href="#l27.186"></a><span id="l27.186">   return *table ? err : NS_ERROR_FAILURE;</span>
<a href="#l27.187"></a><span id="l27.187"> }</span>
<a href="#l27.188"></a><span id="l27.188"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

