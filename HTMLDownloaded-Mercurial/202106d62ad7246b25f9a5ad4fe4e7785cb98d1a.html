<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 23100:202106d62ad7246b25f9a5ad4fe4e7785cb98d1a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 202106d62ad7246b25f9a5ad4fe4e7785cb98d1a" />
<meta property="og:url" content="/comm-central/rev/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a" />
<meta property="og:description" content="Bug 1294027 - use mail sender's address for SMTP MAIL FROM. r=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 202106d62ad7246b25f9a5ad4fe4e7785cb98d1a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a">shortlog</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a">files</a> |
changeset |
<a href="/comm-central/raw-rev/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a">raw</a>  | <a href="/comm-central/archive/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1294027">Bug 1294027</a> - use mail sender's address for SMTP MAIL FROM. r=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#114;&#101;&#110;&#101;&#32;&#60;&#106;&#117;&#115;&#116;&#64;&#97;&#98;&#115;&#111;&#114;&#98;&#46;&#105;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 18 Jan 2018 14:11:02 +0100</td></tr>

<tr>
 <td>changeset 23100</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a">202106d62ad7246b25f9a5ad4fe4e7785cb98d1a</a></td>
</tr>



<tr>
<td>parent 23099</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e0a83f533ebaf778e284026bafba23ddd2554eee">e0a83f533ebaf778e284026bafba23ddd2554eee</a>
</td>
</tr>

<tr>
<td>child 23101</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f1f49dd06edb2a788d9688d7b429ab5d31d7bbf7">f1f49dd06edb2a788d9688d7b429ab5d31d7bbf7</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=202106d62ad7246b25f9a5ad4fe4e7785cb98d1a">13979</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 18 Jan 2018 22:12:32 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@3d52812591b8 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3d52812591b80b0555fa6d6f36209d4d3b138f52">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3d52812591b80b0555fa6d6f36209d4d3b138f52&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3d52812591b80b0555fa6d6f36209d4d3b138f52&newProject=comm-central&newRevision=e0a83f533ebaf778e284026bafba23ddd2554eee&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3d52812591b80b0555fa6d6f36209d4d3b138f52&newProject=comm-central&newRevision=e0a83f533ebaf778e284026bafba23ddd2554eee&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3d52812591b80b0555fa6d6f36209d4d3b138f52&newProject=comm-central&newRevision=e0a83f533ebaf778e284026bafba23ddd2554eee&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1294027">1294027</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1294027">Bug 1294027</a> - use mail sender's address for SMTP MAIL FROM. r=jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpService.idl">mailnews/compose/public/nsISmtpService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpService.idl">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpService.idl">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpService.idl">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpService.idl">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpUrl.idl">mailnews/compose/public/nsISmtpUrl.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpUrl.idl">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpUrl.idl">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpUrl.idl">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpUrl.idl">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/public/nsISmtpUrl.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.cpp">mailnews/compose/src/nsComposeStrings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.cpp">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.cpp">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.cpp">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.cpp">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.h">mailnews/compose/src/nsComposeStrings.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.h">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.h">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.h">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.h">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsComposeStrings.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpService.cpp">mailnews/compose/src/nsSmtpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpService.cpp">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpService.cpp">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpService.cpp">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpService.cpp">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.cpp">mailnews/compose/src/nsSmtpUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.cpp">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.cpp">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.cpp">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.cpp">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.h">mailnews/compose/src/nsSmtpUrl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.h">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.h">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.h">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.h">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/compose/src/nsSmtpUrl.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mailnews.js">mailnews/mailnews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mailnews.js">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mailnews.js">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mailnews.js">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mailnews.js">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mailnews.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mapi/mapihook/src/msgMapiMain.cpp">mailnews/mapi/mapihook/src/msgMapiMain.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mapi/mapihook/src/msgMapiMain.cpp">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mapi/mapihook/src/msgMapiMain.cpp">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mapi/mapihook/src/msgMapiMain.cpp">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mapi/mapihook/src/msgMapiMain.cpp">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/mailnews/mapi/mapihook/src/msgMapiMain.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/202106d62ad7246b25f9a5ad4fe4e7785cb98d1a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -33,17 +33,19 @@ smtpServerError=An error occurred while </span>
<a href="#l1.4"></a><span id="l1.4"> unableToSendLater=Sorry, we were unable to save your message for sending later.</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> ## LOCALIZATION NOTE (communicationsError): argument %d is the error code</span>
<a href="#l1.7"></a><span id="l1.7"> communicationsError=A communications error occurred: %d.  Please try again.</span>
<a href="#l1.8"></a><span id="l1.8"> dontShowAlert=THIS IS JUST A PLACEHOLDER.  YOU SHOULD NEVER SEE THIS STRING.</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> ## LOCALIZATION NOTE (tcpReadError): argument %s is the network error</span>
<a href="#l1.11"></a><span id="l1.11"> tcpReadError=A network error occurred while receiving data.  (Network Error: %s)  Try connecting again.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-couldNotGetUsersMailAddress=An error occurred while sending mail:  the return mail address was invalid.  Please verify that your email address is correct in your account settings and try again.</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+couldNotGetUsersMailAddress2=An error occurred while sending mail: the sender's address (From:) was invalid. Please verify that this email address is correct and try again.</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+couldNotGetSendersIdentity=An error occurred while sending mail: the sender identity was invalid. Please verify the configuration of your identity and try again.</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+</span>
<a href="#l1.16"></a><span id="l1.16"> mimeMpartAttachmentError=Attachment error.</span>
<a href="#l1.17"></a><span id="l1.17"> failedCopyOperation=The message was sent successfully, but could not be copied to your Sent folder.</span>
<a href="#l1.18"></a><span id="l1.18"> nntpNoCrossPosting=You can only send a message to one news server at a time.</span>
<a href="#l1.19"></a><span id="l1.19"> msgCancelling=Cancellingâ€¦</span>
<a href="#l1.20"></a><span id="l1.20"> sendFailedButNntpOk=Your message has been posted to the newsgroup but has not been sent to the other recipient.</span>
<a href="#l1.21"></a><span id="l1.21"> errorReadingFile=Error reading file.</span>
<a href="#l1.22"></a><span id="l1.22"> followupToSenderMessage=The author of this message has requested that responses be sent only to the author. If you also want to reply to the newsgroup, add a new row to the addressing area, choose Newsgroup from the recipients list, and enter the name of the newsgroup.</span>
<a href="#l1.23"></a><span id="l1.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/compose/public/nsISmtpService.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/compose/public/nsISmtpService.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -29,16 +29,17 @@ interface nsISmtpService : nsISupports {</span>
<a href="#l2.4"></a><span id="l2.4">    * @note The file to send must be in the format specified by RFC 2822 for</span>
<a href="#l2.5"></a><span id="l2.5">    *       sending data. This includes having the correct CRLF line endings</span>
<a href="#l2.6"></a><span id="l2.6">    *       throughout the file, and the &lt;CRLF&gt;.&lt;CRLF&gt; at the end of the file.</span>
<a href="#l2.7"></a><span id="l2.7">    *       sendMailMessage does no processing/additions on the file.</span>
<a href="#l2.8"></a><span id="l2.8">    *</span>
<a href="#l2.9"></a><span id="l2.9">    * @param aFilePath               The file to send.</span>
<a href="#l2.10"></a><span id="l2.10">    * @param aRecipients             A comma delimited list of recipients.</span>
<a href="#l2.11"></a><span id="l2.11">    * @param aSenderIdentity         The identity of the sender.</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+   * @param aSender                 The senders email address.</span>
<a href="#l2.13"></a><span id="l2.13">    * @param aPassword               Pass this in to prevent a dialog if the</span>
<a href="#l2.14"></a><span id="l2.14">    *                                password is needed for secure transmission.</span>
<a href="#l2.15"></a><span id="l2.15">    * @param aUrlListener            A listener to listen to the URL being run,</span>
<a href="#l2.16"></a><span id="l2.16">    *                                this parameter may be null.</span>
<a href="#l2.17"></a><span id="l2.17">    * @param aStatusListener         A feedback listener for slightly different</span>
<a href="#l2.18"></a><span id="l2.18">    *                                feedback on the message send status. This</span>
<a href="#l2.19"></a><span id="l2.19">    *                                parameter may be null.</span>
<a href="#l2.20"></a><span id="l2.20">    * @param aNotificationCallbacks  More notification callbacks</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -49,16 +50,17 @@ interface nsISmtpService : nsISupports {</span>
<a href="#l2.22"></a><span id="l2.22">    *                                netlib service manager to interrupt the url</span>
<a href="#l2.23"></a><span id="l2.23">    *                                you are given back. This parameter may be</span>
<a href="#l2.24"></a><span id="l2.24">    *                                null.</span>
<a href="#l2.25"></a><span id="l2.25">    * @param aRequest                Provides a handle to the running request.</span>
<a href="#l2.26"></a><span id="l2.26">    *                                This parameter may be null.</span>
<a href="#l2.27"></a><span id="l2.27">    */</span>
<a href="#l2.28"></a><span id="l2.28">   void sendMailMessage(in nsIFile aFilePath, in string aRecipients,</span>
<a href="#l2.29"></a><span id="l2.29">                        in nsIMsgIdentity aSenderIdentity,</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+                       in string aSender,</span>
<a href="#l2.31"></a><span id="l2.31">                        in AString aPassword,</span>
<a href="#l2.32"></a><span id="l2.32">                        in nsIUrlListener aUrlListener,</span>
<a href="#l2.33"></a><span id="l2.33">                        in nsIMsgStatusFeedback aStatusListener,</span>
<a href="#l2.34"></a><span id="l2.34">                        in nsIInterfaceRequestor aNotificationCallbacks,</span>
<a href="#l2.35"></a><span id="l2.35">                        in boolean aRequestDSN,</span>
<a href="#l2.36"></a><span id="l2.36">                        out nsIURI aURL,</span>
<a href="#l2.37"></a><span id="l2.37">                        out nsIRequest aRequest);</span>
<a href="#l2.38"></a><span id="l2.38"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/compose/public/nsISmtpUrl.idl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/compose/public/nsISmtpUrl.idl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -37,16 +37,21 @@ interface nsISmtpUrl : nsISupports {</span>
<a href="#l3.4"></a><span id="l3.4">   attribute boolean requestDSN;</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">   /**</span>
<a href="#l3.7"></a><span id="l3.7">    * The envid which is used in the DSN.</span>
<a href="#l3.8"></a><span id="l3.8">    */</span>
<a href="#l3.9"></a><span id="l3.9">   attribute ACString dsnEnvid;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   /**</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+   * The sender of this mail (can be different from identity).</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+   */</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  attribute string sender;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+  /**</span>
<a href="#l3.17"></a><span id="l3.17">    * SMTP Url instance specific getters and setters</span>
<a href="#l3.18"></a><span id="l3.18">    * Information the protocol needs to know in order to run the url.</span>
<a href="#l3.19"></a><span id="l3.19">    * These are NOT event sinks which are things the caller needs to know.</span>
<a href="#l3.20"></a><span id="l3.20">    */</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22">   /**</span>
<a href="#l3.23"></a><span id="l3.23">    * By default the url is really a bring up the compose window mailto url.</span>
<a href="#l3.24"></a><span id="l3.24">    * You need to call this function if you want to force the message to be</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/compose/src/nsComposeStrings.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/compose/src/nsComposeStrings.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -47,17 +47,19 @@ const char* errorStringNameForErrorCode(</span>
<a href="#l4.4"></a><span id="l4.4">       return &quot;unableToSendLater&quot;;</span>
<a href="#l4.5"></a><span id="l4.5">     case NS_ERROR_COMMUNICATIONS_ERROR:</span>
<a href="#l4.6"></a><span id="l4.6">       return &quot;communicationsError&quot;;</span>
<a href="#l4.7"></a><span id="l4.7">     case NS_ERROR_BUT_DONT_SHOW_ALERT:</span>
<a href="#l4.8"></a><span id="l4.8">       return &quot;dontShowAlert&quot;;</span>
<a href="#l4.9"></a><span id="l4.9">     case NS_ERROR_TCP_READ_ERROR:</span>
<a href="#l4.10"></a><span id="l4.10">       return &quot;tcpReadError&quot;;</span>
<a href="#l4.11"></a><span id="l4.11">     case NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS:</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      return &quot;couldNotGetUsersMailAddress&quot;;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      return &quot;couldNotGetUsersMailAddress2&quot;;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+    case NS_ERROR_COULD_NOT_GET_SENDERS_IDENTITY:</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+      return &quot;couldNotGetSendersIdentity&quot;;</span>
<a href="#l4.16"></a><span id="l4.16">     case NS_ERROR_MIME_MPART_ATTACHMENT_ERROR:</span>
<a href="#l4.17"></a><span id="l4.17">       return &quot;mimeMpartAttachmentError&quot;;</span>
<a href="#l4.18"></a><span id="l4.18">     case NS_MSG_FAILED_COPY_OPERATION:</span>
<a href="#l4.19"></a><span id="l4.19">       return &quot;failedCopyOperation&quot;;</span>
<a href="#l4.20"></a><span id="l4.20">     case NS_ERROR_NNTP_NO_CROSS_POSTING:</span>
<a href="#l4.21"></a><span id="l4.21">       return &quot;nntpNoCrossPosting&quot;;</span>
<a href="#l4.22"></a><span id="l4.22">     case NS_MSG_CANCELLING:</span>
<a href="#l4.23"></a><span id="l4.23">       return &quot;msgCancelling&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/compose/src/nsComposeStrings.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/compose/src/nsComposeStrings.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -27,16 +27,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #define NS_ERROR_QUEUED_DELIVERY_FAILED             NS_MSG_GENERATE_FAILURE(12519)</span>
<a href="#l5.5"></a><span id="l5.5"> #define NS_ERROR_SEND_FAILED                        NS_MSG_GENERATE_FAILURE(12520)</span>
<a href="#l5.6"></a><span id="l5.6"> #define NS_ERROR_SMTP_SERVER_ERROR                  NS_MSG_GENERATE_FAILURE(12524)</span>
<a href="#l5.7"></a><span id="l5.7"> #define NS_MSG_UNABLE_TO_SEND_LATER                 NS_MSG_GENERATE_FAILURE(12525)</span>
<a href="#l5.8"></a><span id="l5.8"> #define NS_ERROR_COMMUNICATIONS_ERROR               NS_MSG_GENERATE_FAILURE(12526)</span>
<a href="#l5.9"></a><span id="l5.9"> #define NS_ERROR_BUT_DONT_SHOW_ALERT                NS_MSG_GENERATE_FAILURE(12527)</span>
<a href="#l5.10"></a><span id="l5.10"> #define NS_ERROR_TCP_READ_ERROR                     NS_MSG_GENERATE_FAILURE(12528)</span>
<a href="#l5.11"></a><span id="l5.11"> #define NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS   NS_MSG_GENERATE_FAILURE(12529)</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+#define NS_ERROR_COULD_NOT_GET_SENDERS_IDENTITY     NS_MSG_GENERATE_FAILURE(12530)</span>
<a href="#l5.13"></a><span id="l5.13"> #define NS_ERROR_MIME_MPART_ATTACHMENT_ERROR        NS_MSG_GENERATE_FAILURE(12531)</span>
<a href="#l5.14"></a><span id="l5.14"> #define NS_MSG_FAILED_COPY_OPERATION                NS_MSG_GENERATE_FAILURE(12532)</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> /* 12554 is taken by NS_ERROR_NNTP_NO_CROSS_POSTING.  use 12555 as the next one */</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> #define NS_MSG_CANCELLING                           NS_MSG_GENERATE_SUCCESS(12555)</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> // For message sending report</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -3405,17 +3405,17 @@ nsMsgComposeAndSend::DeliverFileAsMail()</span>
<a href="#l6.4"></a><span id="l6.4">     mComposeBundle-&gt;GetStringFromName(&quot;sendingMessage&quot;, msg);</span>
<a href="#l6.5"></a><span id="l6.5">     SetStatusMessage(msg);</span>
<a href="#l6.6"></a><span id="l6.6">     nsCOMPtr&lt;nsIMsgStatusFeedback&gt; msgStatus (do_QueryInterface(mSendProgress));</span>
<a href="#l6.7"></a><span id="l6.7">     // if the sendProgress isn't set, let's use the member variable.</span>
<a href="#l6.8"></a><span id="l6.8">     if (!msgStatus)</span>
<a href="#l6.9"></a><span id="l6.9">       msgStatus = do_QueryInterface(mStatusFeedback);</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">     nsCOMPtr&lt;nsIURI&gt; runningUrl;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    rv = smtpService-&gt;SendMailMessage(mTempFile, buf, mUserIdentity,</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    rv = smtpService-&gt;SendMailMessage(mTempFile, buf, mUserIdentity, mCompFields-&gt;GetFrom(),</span>
<a href="#l6.14"></a><span id="l6.14">                                       mSmtpPassword, deliveryListener, msgStatus,</span>
<a href="#l6.15"></a><span id="l6.15">                                       callbacks, mCompFields-&gt;GetDSN(),</span>
<a href="#l6.16"></a><span id="l6.16">                                       getter_AddRefs(runningUrl),</span>
<a href="#l6.17"></a><span id="l6.17">                                       getter_AddRefs(mRunningRequest));</span>
<a href="#l6.18"></a><span id="l6.18">     // set envid on the returned URL</span>
<a href="#l6.19"></a><span id="l6.19">     if (NS_SUCCEEDED(rv))</span>
<a href="#l6.20"></a><span id="l6.20">     {</span>
<a href="#l6.21"></a><span id="l6.21">       nsCOMPtr&lt;nsISmtpUrl&gt; smtpUrl(do_QueryInterface(runningUrl, &amp;rv));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -717,48 +717,63 @@ nsresult nsSmtpProtocol::SendHeloRespons</span>
<a href="#l7.4"></a><span id="l7.4">   // check if we're just verifying the ability to logon</span>
<a href="#l7.5"></a><span id="l7.5">   nsCOMPtr&lt;nsISmtpUrl&gt; smtpUrl = do_QueryInterface(m_runningURL, &amp;rv);</span>
<a href="#l7.6"></a><span id="l7.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.7"></a><span id="l7.7">   bool verifyingLogon = false;</span>
<a href="#l7.8"></a><span id="l7.8">   smtpUrl-&gt;GetVerifyLogon(&amp;verifyingLogon);</span>
<a href="#l7.9"></a><span id="l7.9">   if (verifyingLogon)</span>
<a href="#l7.10"></a><span id="l7.10">     return SendQuit();</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  // extract the email address from the identity</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-  nsCString emailAddress;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-  nsCOMPtr &lt;nsIMsgIdentity&gt; senderIdentity;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-  rv = m_runningURL-&gt;GetSenderIdentity(getter_AddRefs(senderIdentity));</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-  if (NS_FAILED(rv) || !senderIdentity)</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+  nsCOMPtr&lt;nsIPrefService&gt; prefs = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+  nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch;</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+  rv = prefs-&gt;GetBranch(nullptr, getter_AddRefs(prefBranch));</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+  bool useSenderForSmtpMailFrom = false;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+  prefBranch-&gt;GetBoolPref(&quot;mail.smtp.useSenderForSmtpMailFrom&quot;, &amp;useSenderForSmtpMailFrom);</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+  nsCString fullAddress;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+  if (useSenderForSmtpMailFrom)</span>
<a href="#l7.28"></a><span id="l7.28">   {</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-    m_urlErrorState = NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-    return(NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  }</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-  senderIdentity-&gt;GetEmail(emailAddress);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+    // Extract the email address from the mail headers.</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+    nsCString from;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+    m_runningURL-&gt;GetSender(getter_Copies(from));</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-  if (emailAddress.IsEmpty())</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-  {</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-    m_urlErrorState = NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS;</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-    return(NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS);</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+    ExtractEmail(EncodedHeader(from), fullAddress);</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+    if (fullAddress.IsEmpty()) {</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+      m_urlErrorState = NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS;</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+      return(NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS);</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+    }</span>
<a href="#l7.46"></a><span id="l7.46">   }</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+  else</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+  {</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+    // Extract the email address from the identity.</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+    nsCString emailAddress;</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+    nsCOMPtr &lt;nsIMsgIdentity&gt; senderIdentity;</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+    rv = m_runningURL-&gt;GetSenderIdentity(getter_AddRefs(senderIdentity));</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+    if (NS_FAILED(rv) || !senderIdentity)</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+    {</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+      m_urlErrorState = NS_ERROR_COULD_NOT_GET_SENDERS_IDENTITY;</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+      return(NS_ERROR_COULD_NOT_GET_SENDERS_IDENTITY);</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+    }</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+    senderIdentity-&gt;GetEmail(emailAddress);</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+    if (emailAddress.IsEmpty())</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+    {</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+      m_urlErrorState = NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS;</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+      return(NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS);</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+    }</span>
<a href="#l7.64"></a><span id="l7.64"> </span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-  nsCString fullAddress;</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-  // Quote the email address before passing it to the SMTP server.</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-  MakeMimeAddress(EmptyCString(), emailAddress, fullAddress);</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+    // Quote the email address before passing it to the SMTP server.</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+    MakeMimeAddress(EmptyCString(), emailAddress, fullAddress);</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+  }</span>
<a href="#l7.72"></a><span id="l7.72">   buffer = &quot;MAIL FROM:&lt;&quot;;</span>
<a href="#l7.73"></a><span id="l7.73">   buffer += fullAddress;</span>
<a href="#l7.74"></a><span id="l7.74">   buffer += &quot;&gt;&quot;;</span>
<a href="#l7.75"></a><span id="l7.75"> </span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-  nsCOMPtr&lt;nsIPrefService&gt; prefs = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch;</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineminus">-  rv = prefs-&gt;GetBranch(nullptr, getter_AddRefs(prefBranch));</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-</span>
<a href="#l7.83"></a><span id="l7.83">   if (TestFlag(SMTP_EHLO_DSN_ENABLED))</span>
<a href="#l7.84"></a><span id="l7.84">   {</span>
<a href="#l7.85"></a><span id="l7.85">     bool requestDSN = false;</span>
<a href="#l7.86"></a><span id="l7.86">     rv = m_runningURL-&gt;GetRequestDSN(&amp;requestDSN);</span>
<a href="#l7.87"></a><span id="l7.87"> </span>
<a href="#l7.88"></a><span id="l7.88">     if (requestDSN)</span>
<a href="#l7.89"></a><span id="l7.89">     {</span>
<a href="#l7.90"></a><span id="l7.90">       bool requestRetFull = false;</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineat">@@ -766,19 +781,25 @@ nsresult nsSmtpProtocol::SendHeloRespons</span>
<a href="#l7.92"></a><span id="l7.92"> </span>
<a href="#l7.93"></a><span id="l7.93">       buffer += requestRetFull ? &quot; RET=FULL&quot; : &quot; RET=HDRS&quot;;</span>
<a href="#l7.94"></a><span id="l7.94"> </span>
<a href="#l7.95"></a><span id="l7.95">       nsCString dsnEnvid;</span>
<a href="#l7.96"></a><span id="l7.96"> </span>
<a href="#l7.97"></a><span id="l7.97">       // get the envid from the smtpUrl</span>
<a href="#l7.98"></a><span id="l7.98">       rv = m_runningURL-&gt;GetDsnEnvid(dsnEnvid);</span>
<a href="#l7.99"></a><span id="l7.99"> </span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-      if (dsnEnvid.IsEmpty())</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+      if (dsnEnvid.IsEmpty()) {</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+          nsCOMPtr &lt;nsIMsgIdentity&gt; senderIdentity;</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+          rv = m_runningURL-&gt;GetSenderIdentity(getter_AddRefs(senderIdentity));</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+          if (NS_FAILED(rv) || !senderIdentity) {</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+              m_urlErrorState = NS_ERROR_COULD_NOT_GET_SENDERS_IDENTITY;</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+              return(NS_ERROR_COULD_NOT_GET_SENDERS_IDENTITY);</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+          }</span>
<a href="#l7.108"></a><span id="l7.108">           dsnEnvid.Adopt(msg_generate_message_id(senderIdentity));</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineminus">-</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+      }</span>
<a href="#l7.111"></a><span id="l7.111">       buffer += &quot; ENVID=&quot;;</span>
<a href="#l7.112"></a><span id="l7.112">       buffer += dsnEnvid;</span>
<a href="#l7.113"></a><span id="l7.113">     }</span>
<a href="#l7.114"></a><span id="l7.114">   }</span>
<a href="#l7.115"></a><span id="l7.115"> </span>
<a href="#l7.116"></a><span id="l7.116">   if (TestFlag(SMTP_EHLO_8BIT_ENABLED))</span>
<a href="#l7.117"></a><span id="l7.117">   {</span>
<a href="#l7.118"></a><span id="l7.118">     bool strictlyMime = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -50,16 +50,17 @@ static NS_DEFINE_CID(kCSmtpUrlCID, NS_SM</span>
<a href="#l8.4"></a><span id="l8.4"> static NS_DEFINE_CID(kCMailtoUrlCID, NS_MAILTOURL_CID);</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> // foward declarations...</span>
<a href="#l8.7"></a><span id="l8.7"> nsresult</span>
<a href="#l8.8"></a><span id="l8.8"> NS_MsgBuildSmtpUrl(nsIFile * aFilePath,</span>
<a href="#l8.9"></a><span id="l8.9">                    nsISmtpServer *aServer,</span>
<a href="#l8.10"></a><span id="l8.10">                    const char* aRecipients,</span>
<a href="#l8.11"></a><span id="l8.11">                    nsIMsgIdentity * aSenderIdentity,</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+                   const char * aSender,</span>
<a href="#l8.13"></a><span id="l8.13">                    nsIUrlListener * aUrlListener,</span>
<a href="#l8.14"></a><span id="l8.14">                    nsIMsgStatusFeedback *aStatusFeedback,</span>
<a href="#l8.15"></a><span id="l8.15">                    nsIInterfaceRequestor* aNotificationCallbacks,</span>
<a href="#l8.16"></a><span id="l8.16">                    nsIURI ** aUrl,</span>
<a href="#l8.17"></a><span id="l8.17">                    bool aRequestDSN);</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19"> nsresult NS_MsgLoadSmtpUrl(nsIURI * aUrl, nsISupports * aConsumer, nsIRequest ** aRequest);</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -75,16 +76,17 @@ nsSmtpService::~nsSmtpService()</span>
<a href="#l8.22"></a><span id="l8.22"> }</span>
<a href="#l8.23"></a><span id="l8.23"> </span>
<a href="#l8.24"></a><span id="l8.24"> NS_IMPL_ISUPPORTS(nsSmtpService, nsISmtpService, nsIProtocolHandler)</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27"> NS_IMETHODIMP nsSmtpService::SendMailMessage(nsIFile * aFilePath,</span>
<a href="#l8.28"></a><span id="l8.28">                                         const char * aRecipients,</span>
<a href="#l8.29"></a><span id="l8.29">                                         nsIMsgIdentity * aSenderIdentity,</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+                                        const char * aSender,</span>
<a href="#l8.31"></a><span id="l8.31">                                         const nsAString &amp; aPassword,</span>
<a href="#l8.32"></a><span id="l8.32">                                         nsIUrlListener * aUrlListener,</span>
<a href="#l8.33"></a><span id="l8.33">                                         nsIMsgStatusFeedback *aStatusFeedback,</span>
<a href="#l8.34"></a><span id="l8.34">                                         nsIInterfaceRequestor* aNotificationCallbacks,</span>
<a href="#l8.35"></a><span id="l8.35">                                         bool aRequestDSN,</span>
<a href="#l8.36"></a><span id="l8.36">                                         nsIURI ** aURL,</span>
<a href="#l8.37"></a><span id="l8.37">                                         nsIRequest ** aRequest)</span>
<a href="#l8.38"></a><span id="l8.38"> {</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineat">@@ -95,17 +97,17 @@ NS_IMETHODIMP nsSmtpService::SendMailMes</span>
<a href="#l8.40"></a><span id="l8.40">   rv = GetServerByIdentity(aSenderIdentity, getter_AddRefs(smtpServer));</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42">   if (NS_SUCCEEDED(rv) &amp;&amp; smtpServer)</span>
<a href="#l8.43"></a><span id="l8.43">   {</span>
<a href="#l8.44"></a><span id="l8.44">     if (!aPassword.IsEmpty())</span>
<a href="#l8.45"></a><span id="l8.45">       smtpServer-&gt;SetPassword(aPassword);</span>
<a href="#l8.46"></a><span id="l8.46"> </span>
<a href="#l8.47"></a><span id="l8.47">     // this ref counts urlToRun</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-    rv = NS_MsgBuildSmtpUrl(aFilePath, smtpServer, aRecipients, aSenderIdentity,</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+    rv = NS_MsgBuildSmtpUrl(aFilePath, smtpServer, aRecipients, aSenderIdentity, aSender,</span>
<a href="#l8.50"></a><span id="l8.50">                             aUrlListener, aStatusFeedback,</span>
<a href="#l8.51"></a><span id="l8.51">                             aNotificationCallbacks, &amp;urlToRun, aRequestDSN);</span>
<a href="#l8.52"></a><span id="l8.52">     if (NS_SUCCEEDED(rv) &amp;&amp; urlToRun)	</span>
<a href="#l8.53"></a><span id="l8.53">       rv = NS_MsgLoadSmtpUrl(urlToRun, nullptr, aRequest);</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55">     if (aURL) // does the caller want a handle on the url?</span>
<a href="#l8.56"></a><span id="l8.56">       *aURL = urlToRun; // transfer our ref count to the caller....</span>
<a href="#l8.57"></a><span id="l8.57">     else</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineat">@@ -118,16 +120,17 @@ NS_IMETHODIMP nsSmtpService::SendMailMes</span>
<a href="#l8.59"></a><span id="l8.59"> </span>
<a href="#l8.60"></a><span id="l8.60"> // The following are two convience functions I'm using to help expedite building and running a mail to url...</span>
<a href="#l8.61"></a><span id="l8.61"> </span>
<a href="#l8.62"></a><span id="l8.62"> // short cut function for creating a mailto url...</span>
<a href="#l8.63"></a><span id="l8.63"> nsresult NS_MsgBuildSmtpUrl(nsIFile * aFilePath,</span>
<a href="#l8.64"></a><span id="l8.64">                             nsISmtpServer *aSmtpServer,</span>
<a href="#l8.65"></a><span id="l8.65">                             const char * aRecipients,</span>
<a href="#l8.66"></a><span id="l8.66">                             nsIMsgIdentity * aSenderIdentity,</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+                            const char * aSender,</span>
<a href="#l8.68"></a><span id="l8.68">                             nsIUrlListener * aUrlListener,</span>
<a href="#l8.69"></a><span id="l8.69">                             nsIMsgStatusFeedback *aStatusFeedback,</span>
<a href="#l8.70"></a><span id="l8.70">                             nsIInterfaceRequestor* aNotificationCallbacks,</span>
<a href="#l8.71"></a><span id="l8.71">                             nsIURI ** aUrl,</span>
<a href="#l8.72"></a><span id="l8.72">                             bool aRequestDSN)</span>
<a href="#l8.73"></a><span id="l8.73"> {</span>
<a href="#l8.74"></a><span id="l8.74">   // mscott: this function is a convience hack until netlib actually dispatches</span>
<a href="#l8.75"></a><span id="l8.75">   // smtp urls. in addition until we have a session to get a password, host and</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineat">@@ -171,16 +174,17 @@ nsresult NS_MsgBuildSmtpUrl(nsIFile * aF</span>
<a href="#l8.77"></a><span id="l8.77">   }</span>
<a href="#l8.78"></a><span id="l8.78"> </span>
<a href="#l8.79"></a><span id="l8.79">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; url(do_QueryInterface(smtpUrl, &amp;rv));</span>
<a href="#l8.80"></a><span id="l8.80">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.81"></a><span id="l8.81"> </span>
<a href="#l8.82"></a><span id="l8.82">   rv = url-&gt;SetSpec(urlSpec);</span>
<a href="#l8.83"></a><span id="l8.83">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.84"></a><span id="l8.84"> </span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+  smtpUrl-&gt;SetSender(aSender);</span>
<a href="#l8.86"></a><span id="l8.86">   smtpUrl-&gt;SetRecipients(aRecipients);</span>
<a href="#l8.87"></a><span id="l8.87">   smtpUrl-&gt;SetRequestDSN(aRequestDSN);</span>
<a href="#l8.88"></a><span id="l8.88">   smtpUrl-&gt;SetPostMessageFile(aFilePath);</span>
<a href="#l8.89"></a><span id="l8.89">   smtpUrl-&gt;SetSenderIdentity(aSenderIdentity);</span>
<a href="#l8.90"></a><span id="l8.90">   if (aNotificationCallbacks)</span>
<a href="#l8.91"></a><span id="l8.91">     smtpUrl-&gt;SetNotificationCallbacks(aNotificationCallbacks);</span>
<a href="#l8.92"></a><span id="l8.92">   smtpUrl-&gt;SetSmtpServer(aSmtpServer);</span>
<a href="#l8.93"></a><span id="l8.93"> </span>
<a href="#l8.94"></a><span id="l8.94" class="difflineat">@@ -235,17 +239,17 @@ NS_IMETHODIMP nsSmtpService::VerifyLogon</span>
<a href="#l8.95"></a><span id="l8.95">                                          nsIURI **aURL)</span>
<a href="#l8.96"></a><span id="l8.96"> {</span>
<a href="#l8.97"></a><span id="l8.97">   NS_ENSURE_ARG_POINTER(aServer);</span>
<a href="#l8.98"></a><span id="l8.98">   nsCString popHost;</span>
<a href="#l8.99"></a><span id="l8.99">   nsCString popUser;</span>
<a href="#l8.100"></a><span id="l8.100">   nsCOMPtr &lt;nsIURI&gt; urlToRun;</span>
<a href="#l8.101"></a><span id="l8.101"> </span>
<a href="#l8.102"></a><span id="l8.102">   nsresult rv = NS_MsgBuildSmtpUrl(nullptr, aServer,</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineminus">-                          nullptr, nullptr, aUrlListener, nullptr,</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+                          nullptr, nullptr, nullptr, aUrlListener, nullptr,</span>
<a href="#l8.105"></a><span id="l8.105">                           nullptr , getter_AddRefs(urlToRun), false);</span>
<a href="#l8.106"></a><span id="l8.106">   if (NS_SUCCEEDED(rv) &amp;&amp; urlToRun)</span>
<a href="#l8.107"></a><span id="l8.107">   {</span>
<a href="#l8.108"></a><span id="l8.108">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; url(do_QueryInterface(urlToRun, &amp;rv));</span>
<a href="#l8.109"></a><span id="l8.109">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.110"></a><span id="l8.110">     url-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l8.111"></a><span id="l8.111">     rv = NS_MsgLoadSmtpUrl(urlToRun, nullptr, nullptr /* aRequest */);</span>
<a href="#l8.112"></a><span id="l8.112">     if (aURL)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -705,16 +705,33 @@ NS_IMETHODIMP</span>
<a href="#l9.4"></a><span id="l9.4"> nsSmtpUrl::GetRecipients(char ** aRecipientsList)</span>
<a href="#l9.5"></a><span id="l9.5"> {</span>
<a href="#l9.6"></a><span id="l9.6">   NS_ENSURE_ARG_POINTER(aRecipientsList);</span>
<a href="#l9.7"></a><span id="l9.7">   if (aRecipientsList)</span>
<a href="#l9.8"></a><span id="l9.8">     *aRecipientsList = ToNewCString(m_toPart);</span>
<a href="#l9.9"></a><span id="l9.9">   return NS_OK;</span>
<a href="#l9.10"></a><span id="l9.10"> }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+nsSmtpUrl::SetSender(const char * aSender)</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+{</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+  NS_ENSURE_ARG(aSender);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+  MsgUnescapeString(nsDependentCString(aSender), 0, m_fromPart);</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+  return NS_OK;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+}</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+nsSmtpUrl::GetSender(char ** aSender)</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+{</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aSender);</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+  if (aSender)</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+    *aSender = ToNewCString(m_fromPart);</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  return NS_OK;</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+}</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+</span>
<a href="#l9.29"></a><span id="l9.29"> NS_IMPL_GETSET(nsSmtpUrl, PostMessage, bool, m_isPostMessage)</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31"> NS_IMPL_GETSET(nsSmtpUrl, VerifyLogon, bool, m_verifyLogon)</span>
<a href="#l9.32"></a><span id="l9.32"> </span>
<a href="#l9.33"></a><span id="l9.33"> // the message can be stored in a file....allow accessors for getting and setting</span>
<a href="#l9.34"></a><span id="l9.34"> // the file name to post...</span>
<a href="#l9.35"></a><span id="l9.35"> NS_IMETHODIMP nsSmtpUrl::SetPostMessageFile(nsIFile * aFile)</span>
<a href="#l9.36"></a><span id="l9.36"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpUrl.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpUrl.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -110,16 +110,17 @@ public:</span>
<a href="#l10.4"></a><span id="l10.4">   nsSmtpUrl();</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> protected:</span>
<a href="#l10.7"></a><span id="l10.7">   virtual ~nsSmtpUrl();</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">   // data retrieved from parsing the url: (Note the url could be a post from</span>
<a href="#l10.10"></a><span id="l10.10">   // file or it could be in the url)</span>
<a href="#l10.11"></a><span id="l10.11">   nsCString m_toPart;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+  nsCString m_fromPart;</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14">   bool m_isPostMessage;</span>
<a href="#l10.15"></a><span id="l10.15">   bool m_requestDSN;</span>
<a href="#l10.16"></a><span id="l10.16">   nsCString m_dsnEnvid;</span>
<a href="#l10.17"></a><span id="l10.17">   bool m_verifyLogon;</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19">   // Smtp specific event sinks</span>
<a href="#l10.20"></a><span id="l10.20">   nsCOMPtr&lt;nsIFile&gt; m_fileName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -849,19 +849,21 @@ nsresult nsMsgMdnGenerator::OutputAllHea</span>
<a href="#l11.4"></a><span id="l11.4"> nsresult nsMsgMdnGenerator::SendMdnMsg()</span>
<a href="#l11.5"></a><span id="l11.5"> {</span>
<a href="#l11.6"></a><span id="l11.6">     DEBUG_MDN(&quot;nsMsgMdnGenerator::SendMdnMsg&quot;);</span>
<a href="#l11.7"></a><span id="l11.7">     nsresult rv;</span>
<a href="#l11.8"></a><span id="l11.8">     nsCOMPtr&lt;nsISmtpService&gt; smtpService = do_GetService(NS_SMTPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l11.9"></a><span id="l11.9">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">     nsCOMPtr&lt;nsIRequest&gt; aRequest;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    smtpService-&gt;SendMailMessage(m_file, m_dntRrt.get(), m_identity,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-                                     EmptyString(), this, nullptr, nullptr, false, nullptr,</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-                                     getter_AddRefs(aRequest));</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+    nsCString identEmail;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+    m_identity-&gt;GetEmail(identEmail);</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+    smtpService-&gt;SendMailMessage(m_file, m_dntRrt.get(), m_identity, identEmail.get(),</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+                                 EmptyString(), this, nullptr, nullptr, false,</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+                                 nullptr, getter_AddRefs(aRequest));</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">     return NS_OK;</span>
<a href="#l11.22"></a><span id="l11.22"> }</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24"> nsresult nsMsgMdnGenerator::WriteString( const char *str )</span>
<a href="#l11.25"></a><span id="l11.25"> {</span>
<a href="#l11.26"></a><span id="l11.26">   NS_ENSURE_ARG (str);</span>
<a href="#l11.27"></a><span id="l11.27">   uint32_t len = strlen(str);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/mailnews.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/mailnews.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -577,16 +577,21 @@ pref(&quot;mail.autoComplete.highlightNonMatc</span>
<a href="#l12.4"></a><span id="l12.4"> // if true, we'll use the password from an incoming server with</span>
<a href="#l12.5"></a><span id="l12.5"> // matching username and domain</span>
<a href="#l12.6"></a><span id="l12.6"> pref(&quot;mail.smtp.useMatchingDomainServer&quot;, false);</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> // if true, we'll use the password from an incoming server with</span>
<a href="#l12.9"></a><span id="l12.9"> // matching username and host name</span>
<a href="#l12.10"></a><span id="l12.10"> pref(&quot;mail.smtp.useMatchingHostNameServer&quot;, false);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+// if true, we'll use the email sender's address for the smtp</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+// MAIL FROM, which might become the return-path. If false</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+// we use the identity email address, which is the old behaviour</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+pref(&quot;mail.smtp.useSenderForSmtpMailFrom&quot;, true);</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+</span>
<a href="#l12.17"></a><span id="l12.17"> pref(&quot;mail.smtpserver.default.authMethod&quot;, 3); // cleartext password. @see nsIMsgIncomingServer.authMethod.</span>
<a href="#l12.18"></a><span id="l12.18"> pref(&quot;mail.smtpserver.default.try_ssl&quot;, 0); // @see nsISmtpServer.socketType</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20"> // For the next 3 prefs, see &lt;http://www.bucksch.org/1/projects/mozilla/16507&gt;</span>
<a href="#l12.21"></a><span id="l12.21"> pref(&quot;mail.display_glyph&quot;, true);   // TXT-&gt;HTML :-) etc. in viewer</span>
<a href="#l12.22"></a><span id="l12.22"> pref(&quot;mail.display_struct&quot;, true);  // TXT-&gt;HTML *bold* etc. in viewer; ditto</span>
<a href="#l12.23"></a><span id="l12.23"> pref(&quot;mail.send_struct&quot;, false);   // HTML-&gt;HTML *bold* etc. during Send; ditto</span>
<a href="#l12.24"></a><span id="l12.24"> // display time and date in message pane using senders timezone</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiMain.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiMain.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -220,17 +220,21 @@ HRESULT nsMAPIConfiguration::GetMAPIErro</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5">   // if failure return the related MAPI failure code</span>
<a href="#l13.6"></a><span id="l13.6">   switch (res)</span>
<a href="#l13.7"></a><span id="l13.7">   {</span>
<a href="#l13.8"></a><span id="l13.8">     case NS_MSG_NO_RECIPIENTS :</span>
<a href="#l13.9"></a><span id="l13.9">       hr = MAPI_E_BAD_RECIPTYPE;</span>
<a href="#l13.10"></a><span id="l13.10">       break;</span>
<a href="#l13.11"></a><span id="l13.11">     case NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS :</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-      hr = MAPI_E_INVALID_RECIPS;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    case NS_ERROR_COULD_NOT_GET_SENDERS_IDENTITY :</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+      // Something went wrong with the sender. There's no error we can map to</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+      // so we use a general error, see:</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+      // https://msdn.microsoft.com/en-us/library/hh802867(v=vs.85).aspx</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+      hr = MAPI_E_FAILURE;</span>
<a href="#l13.18"></a><span id="l13.18">       break;</span>
<a href="#l13.19"></a><span id="l13.19">     case NS_ERROR_SMTP_AUTH_FAILURE :</span>
<a href="#l13.20"></a><span id="l13.20">     case NS_ERROR_SMTP_AUTH_GSSAPI :</span>
<a href="#l13.21"></a><span id="l13.21">     case NS_ERROR_SMTP_AUTH_MECH_NOT_SUPPORTED :</span>
<a href="#l13.22"></a><span id="l13.22">     case NS_ERROR_SMTP_AUTH_NOT_SUPPORTED :</span>
<a href="#l13.23"></a><span id="l13.23">     case NS_ERROR_SMTP_AUTH_CHANGE_ENCRYPT_TO_PLAIN_NO_SSL :</span>
<a href="#l13.24"></a><span id="l13.24">     case NS_ERROR_SMTP_AUTH_CHANGE_ENCRYPT_TO_PLAIN_SSL :</span>
<a href="#l13.25"></a><span id="l13.25">     case NS_ERROR_SMTP_AUTH_CHANGE_PLAIN_TO_ENCRYPT :</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -33,17 +33,18 @@ smtpServerError=An error occurred while </span>
<a href="#l14.4"></a><span id="l14.4"> unableToSendLater=Sorry, we were unable to save your message for sending later.</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> ## LOCALIZATION NOTE (communicationsError): argument %d is the error code</span>
<a href="#l14.7"></a><span id="l14.7"> communicationsError=A communications error occurred: %d.  Please try again.</span>
<a href="#l14.8"></a><span id="l14.8"> dontShowAlert=THIS IS JUST A PLACEHOLDER.  YOU SHOULD NEVER SEE THIS STRING.</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> ## LOCALIZATION NOTE (tcpReadError): argument %s is the network error</span>
<a href="#l14.11"></a><span id="l14.11"> tcpReadError=A network error occurred while receiving data.  (Network Error: %s)  Try connecting again.</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-couldNotGetUsersMailAddress=An error occurred while sending mail:  the return mail address was invalid.  Please verify that your email address is correct in your Mail preferences and try again.</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+couldNotGetUsersMailAddress2=An error occurred while sending mail: the sender's address (From:) was invalid. Please verify that this email address is correct and try again.</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+couldNotGetSendersIdentity=An error occurred while sending mail: the sender identity was invalid. Please verify the configuration of your identity and try again.</span>
<a href="#l14.15"></a><span id="l14.15"> mimeMpartAttachmentError=Attachment error.</span>
<a href="#l14.16"></a><span id="l14.16"> failedCopyOperation=The message was sent successfully, but could not be copied to your Sent folder.</span>
<a href="#l14.17"></a><span id="l14.17"> nntpNoCrossPosting=You can only send a message to one news server at a time.</span>
<a href="#l14.18"></a><span id="l14.18"> msgCancelling=Cancellingâ€¦</span>
<a href="#l14.19"></a><span id="l14.19"> sendFailedButNntpOk=Your message has been posted to the newsgroup but has not been sent to the other recipient.</span>
<a href="#l14.20"></a><span id="l14.20"> errorReadingFile=Error reading file.</span>
<a href="#l14.21"></a><span id="l14.21"> followupToSenderMessage=The author of this message has requested that responses be sent only to the author. If you also want to reply to the newsgroup, add a new row to the addressing area, choose Newsgroup from the recipients list, and enter the name of the newsgroup.</span>
<a href="#l14.22"></a><span id="l14.22"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

