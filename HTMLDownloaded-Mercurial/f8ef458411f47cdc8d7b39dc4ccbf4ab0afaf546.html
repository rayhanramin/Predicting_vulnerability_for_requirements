<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25522:f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546" />
<meta property="og:url" content="/comm-central/rev/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546" />
<meta property="og:description" content="Bug 1499617 follow-up - Folder tab (3-pane) WebExtensions API improvements; r=Fallen" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546">shortlog</a> |
<a href="/comm-central/log/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546">files</a> |
changeset |
<a href="/comm-central/raw-rev/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546">raw</a>  | <a href="/comm-central/archive/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1499617">Bug 1499617</a> follow-up - Folder tab (3-pane) WebExtensions API improvements; r=Fallen
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 07 Jan 2019 21:54:53 +1300</td></tr>

<tr>
 <td>changeset 25522</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546">f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546</a></td>
</tr>



<tr>
<td>parent 25521</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f2f995d7cf9ae66566e1876d71fb9c69111794ad">f2f995d7cf9ae66566e1876d71fb9c69111794ad</a>
</td>
</tr>

<tr>
<td>child 25523</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b5994bd3ba7619d27bbae69c8243911afb2e1583">b5994bd3ba7619d27bbae69c8243911afb2e1583</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546">15315</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Mon, 07 Jan 2019 08:57:41 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@b5994bd3ba76 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b5994bd3ba7619d27bbae69c8243911afb2e1583">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b5994bd3ba7619d27bbae69c8243911afb2e1583&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b5994bd3ba7619d27bbae69c8243911afb2e1583&newProject=comm-central&newRevision=f2f995d7cf9ae66566e1876d71fb9c69111794ad&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b5994bd3ba7619d27bbae69c8243911afb2e1583&newProject=comm-central&newRevision=f2f995d7cf9ae66566e1876d71fb9c69111794ad&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b5994bd3ba7619d27bbae69c8243911afb2e1583&newProject=comm-central&newRevision=f2f995d7cf9ae66566e1876d71fb9c69111794ad&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Fallen%29&revcount=50">Fallen</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1499617">1499617</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1499617">Bug 1499617</a> follow-up - Folder tab (3-pane) WebExtensions API improvements; r=Fallen</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mail.js">mail/components/extensions/parent/ext-mail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mail.js">file</a> |
<a href="/comm-central/annotate/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mail.js">annotate</a> |
<a href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mail.js">diff</a> |
<a href="/comm-central/comparison/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mail.js">comparison</a> |
<a href="/comm-central/log/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mailTabs.js">mail/components/extensions/parent/ext-mailTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mailTabs.js">file</a> |
<a href="/comm-central/annotate/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mailTabs.js">annotate</a> |
<a href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mailTabs.js">diff</a> |
<a href="/comm-central/comparison/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mailTabs.js">comparison</a> |
<a href="/comm-central/log/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/parent/ext-mailTabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/mailTabs.json">mail/components/extensions/schemas/mailTabs.json</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/mailTabs.json">file</a> |
<a href="/comm-central/annotate/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/mailTabs.json">annotate</a> |
<a href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/mailTabs.json">diff</a> |
<a href="/comm-central/comparison/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/mailTabs.json">comparison</a> |
<a href="/comm-central/log/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/mailTabs.json">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/tabs.json">mail/components/extensions/schemas/tabs.json</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/tabs.json">file</a> |
<a href="/comm-central/annotate/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/tabs.json">annotate</a> |
<a href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/tabs.json">diff</a> |
<a href="/comm-central/comparison/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/tabs.json">comparison</a> |
<a href="/comm-central/log/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/schemas/tabs.json">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_mailTabs.js">mail/components/extensions/test/browser/browser_ext_mailTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_mailTabs.js">file</a> |
<a href="/comm-central/annotate/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_mailTabs.js">annotate</a> |
<a href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_mailTabs.js">diff</a> |
<a href="/comm-central/comparison/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_mailTabs.js">comparison</a> |
<a href="/comm-central/log/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_mailTabs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_menus.js">mail/components/extensions/test/browser/browser_ext_menus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_menus.js">file</a> |
<a href="/comm-central/annotate/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_menus.js">annotate</a> |
<a href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_menus.js">diff</a> |
<a href="/comm-central/comparison/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_menus.js">comparison</a> |
<a href="/comm-central/log/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_menus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_quickFilter.js">mail/components/extensions/test/browser/browser_ext_quickFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_quickFilter.js">file</a> |
<a href="/comm-central/annotate/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_quickFilter.js">annotate</a> |
<a href="/comm-central/diff/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_quickFilter.js">diff</a> |
<a href="/comm-central/comparison/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_quickFilter.js">comparison</a> |
<a href="/comm-central/log/f8ef458411f47cdc8d7b39dc4ccbf4ab0afaf546/mail/components/extensions/test/browser/browser_ext_quickFilter.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-mail.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-mail.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -510,30 +510,30 @@ class Tab extends TabBase {</span>
<a href="#l1.4"></a><span id="l1.4">     if (nativeTab.localName == &quot;tab&quot;) {</span>
<a href="#l1.5"></a><span id="l1.5">       let tabmail = nativeTab.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l1.6"></a><span id="l1.6">       nativeTab = tabmail._getTabContextForTabbyThing(nativeTab)[1];</span>
<a href="#l1.7"></a><span id="l1.7">     }</span>
<a href="#l1.8"></a><span id="l1.8">     super(extension, nativeTab, id);</span>
<a href="#l1.9"></a><span id="l1.9">   }</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">   /** Returns true if this tab is a 3-pane tab. */</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  get isMail3Pane() {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  get mailTab() {</span>
<a href="#l1.14"></a><span id="l1.14">     return this.nativeTab.mode.type == &quot;folder&quot;;</span>
<a href="#l1.15"></a><span id="l1.15">   }</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17">   /** Overrides the matches function to enable querying for 3-pane tabs. */</span>
<a href="#l1.18"></a><span id="l1.18">   matches(queryInfo, context) {</span>
<a href="#l1.19"></a><span id="l1.19">     let result = super.matches(queryInfo, context);</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-    return result &amp;&amp; (!queryInfo.isMail3Pane || this.isMail3Pane);</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+    return result &amp;&amp; (!queryInfo.mailTab || this.mailTab);</span>
<a href="#l1.22"></a><span id="l1.22">   }</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-  /** Adds the isMail3Pane property and removes some useless properties from a tab object. */</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+  /** Adds the mailTab property and removes some useless properties from a tab object. */</span>
<a href="#l1.26"></a><span id="l1.26">   convert(fallback) {</span>
<a href="#l1.27"></a><span id="l1.27">     let result = super.convert(fallback);</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-    result.isMail3Pane = this.isMail3Pane;</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+    result.mailTab = this.mailTab;</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31">     // These properties are not useful to Thunderbird extensions and are not returned.</span>
<a href="#l1.32"></a><span id="l1.32">     for (let key of [</span>
<a href="#l1.33"></a><span id="l1.33">       &quot;attention&quot;,</span>
<a href="#l1.34"></a><span id="l1.34">       &quot;audible&quot;,</span>
<a href="#l1.35"></a><span id="l1.35">       &quot;discarded&quot;,</span>
<a href="#l1.36"></a><span id="l1.36">       &quot;hidden&quot;,</span>
<a href="#l1.37"></a><span id="l1.37">       &quot;incognito&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-mailTabs.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-mailTabs.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -5,17 +5,21 @@</span>
<a href="#l2.4"></a><span id="l2.4"> ChromeUtils.defineModuleGetter(this, &quot;Services&quot;, &quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.5"></a><span id="l2.5"> ChromeUtils.defineModuleGetter(this, &quot;MailServices&quot;, &quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l2.6"></a><span id="l2.6"> ChromeUtils.defineModuleGetter(this, &quot;QuickFilterManager&quot;,</span>
<a href="#l2.7"></a><span id="l2.7">                                &quot;resource:///modules/QuickFilterManager.jsm&quot;);</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> const LAYOUTS = [&quot;standard&quot;, &quot;wide&quot;, &quot;vertical&quot;];</span>
<a href="#l2.10"></a><span id="l2.10"> // From nsIMsgDBView.idl</span>
<a href="#l2.11"></a><span id="l2.11"> const SORT_TYPE_MAP = new Map(</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  Object.keys(Ci.nsMsgViewSortType).map(key =&gt; [Ci.nsMsgViewSortType[key], key])</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  Object.keys(Ci.nsMsgViewSortType).map(key =&gt; {</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    // Change &quot;byFoo&quot; to &quot;foo&quot;.</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+    let shortKey = key[2].toLowerCase() + key.substring(3);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+    return [Ci.nsMsgViewSortType[key], shortKey];</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+  })</span>
<a href="#l2.18"></a><span id="l2.18"> );</span>
<a href="#l2.19"></a><span id="l2.19"> const SORT_ORDER_MAP = new Map(</span>
<a href="#l2.20"></a><span id="l2.20">   Object.keys(Ci.nsMsgViewSortOrder).map(key =&gt; [Ci.nsMsgViewSortOrder[key], key])</span>
<a href="#l2.21"></a><span id="l2.21"> );</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23"> /**</span>
<a href="#l2.24"></a><span id="l2.24">  * Converts a mail tab to a simle object for use in messages.</span>
<a href="#l2.25"></a><span id="l2.25">  * @return {Object}</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineat">@@ -132,45 +136,39 @@ this.mailTabs = class extends ExtensionA</span>
<a href="#l2.27"></a><span id="l2.27">       let tab;</span>
<a href="#l2.28"></a><span id="l2.28">       if (tabId) {</span>
<a href="#l2.29"></a><span id="l2.29">         tab = tabManager.get(tabId);</span>
<a href="#l2.30"></a><span id="l2.30">       } else {</span>
<a href="#l2.31"></a><span id="l2.31">         tab = tabManager.wrapTab(tabTracker.activeTab);</span>
<a href="#l2.32"></a><span id="l2.32">         tabId = tab.id;</span>
<a href="#l2.33"></a><span id="l2.33">       }</span>
<a href="#l2.34"></a><span id="l2.34"> </span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-      if (tab &amp;&amp; tab.isMail3Pane) {</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+      if (tab &amp;&amp; tab.mailTab) {</span>
<a href="#l2.37"></a><span id="l2.37">         return tab;</span>
<a href="#l2.38"></a><span id="l2.38">       }</span>
<a href="#l2.39"></a><span id="l2.39">       throw new ExtensionError(`Invalid mail tab ID: ${tabId}`);</span>
<a href="#l2.40"></a><span id="l2.40">     }</span>
<a href="#l2.41"></a><span id="l2.41"> </span>
<a href="#l2.42"></a><span id="l2.42">     return {</span>
<a href="#l2.43"></a><span id="l2.43">       mailTabs: {</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-        async getAll() {</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+        async query({ active, currentWindow, lastFocusedWindow, windowId }) {</span>
<a href="#l2.46"></a><span id="l2.46">           return Array.from(tabManager.query({</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+            active,</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+            currentWindow,</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+            lastFocusedWindow,</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+            mailTab: true,</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+            windowId,</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+</span>
<a href="#l2.53"></a><span id="l2.53">             // All of these are needed for tabManager to return every tab we want.</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-            &quot;currentWindow&quot;: null,</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-            &quot;index&quot;: null,</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-            &quot;isMail3Pane&quot;: true,</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-            &quot;lastFocusedWindow&quot;: null,</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-            &quot;screen&quot;: null,</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-            &quot;windowId&quot;: null,</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-            &quot;windowType&quot;: null,</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+            index: null,</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+            screen: null,</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+            windowType: null,</span>
<a href="#l2.64"></a><span id="l2.64">           }, context), (tab) =&gt; convertMailTab(tab, context));</span>
<a href="#l2.65"></a><span id="l2.65">         },</span>
<a href="#l2.66"></a><span id="l2.66"> </span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-        async getCurrent() {</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-          let tab = tabManager.wrapTab(tabTracker.activeTab);</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-          if (!tab || !tab.isMail3Pane) {</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-            return null;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-          }</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-          return convertMailTab(tab, context);</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-        },</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-</span>
<a href="#l2.75"></a><span id="l2.75">         async update(tabId, args) {</span>
<a href="#l2.76"></a><span id="l2.76">           let tab = getTabOrActive(tabId);</span>
<a href="#l2.77"></a><span id="l2.77">           let window = tab.window;</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79">           let {</span>
<a href="#l2.80"></a><span id="l2.80">             displayedFolder,</span>
<a href="#l2.81"></a><span id="l2.81">             layout,</span>
<a href="#l2.82"></a><span id="l2.82">             folderPaneVisible,</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineat">@@ -192,20 +190,24 @@ this.mailTabs = class extends ExtensionA</span>
<a href="#l2.84"></a><span id="l2.84">                   `&quot;${displayedFolder.accountId}&quot; not found.`</span>
<a href="#l2.85"></a><span id="l2.85">                 );</span>
<a href="#l2.86"></a><span id="l2.86">               }</span>
<a href="#l2.87"></a><span id="l2.87">             } else {</span>
<a href="#l2.88"></a><span id="l2.88">               tab.nativeTab.folderDisplay.showFolderUri(uri);</span>
<a href="#l2.89"></a><span id="l2.89">             }</span>
<a href="#l2.90"></a><span id="l2.90">           }</span>
<a href="#l2.91"></a><span id="l2.91"> </span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-          if (sortType &amp;&amp; sortType in Ci.nsMsgViewSortType &amp;&amp;</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-              sortOrder &amp;&amp; sortOrder in Ci.nsMsgViewSortOrder) {</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-            tab.nativeTab.folderDisplay.view.sort(Ci.nsMsgViewSortType[sortType],</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">-                                                  Ci.nsMsgViewSortOrder[sortOrder]);</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+          if (sortType) {</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+            // Change &quot;foo&quot; to &quot;byFoo&quot;.</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+            sortType = &quot;by&quot; + sortType[0].toUpperCase() + sortType.substring(1);</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+            if (sortType in Ci.nsMsgViewSortType &amp;&amp;</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+                sortOrder &amp;&amp; sortOrder in Ci.nsMsgViewSortOrder) {</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+              tab.nativeTab.folderDisplay.view.sort(Ci.nsMsgViewSortType[sortType],</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+                                                    Ci.nsMsgViewSortOrder[sortOrder]);</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+            }</span>
<a href="#l2.104"></a><span id="l2.104">           }</span>
<a href="#l2.105"></a><span id="l2.105"> </span>
<a href="#l2.106"></a><span id="l2.106">           // Layout applies to all folder tabs.</span>
<a href="#l2.107"></a><span id="l2.107">           if (layout) {</span>
<a href="#l2.108"></a><span id="l2.108">             Services.prefs.setIntPref(&quot;mail.pane_config.dynamic&quot;, LAYOUTS.indexOf(layout));</span>
<a href="#l2.109"></a><span id="l2.109">           }</span>
<a href="#l2.110"></a><span id="l2.110"> </span>
<a href="#l2.111"></a><span id="l2.111">           if (typeof folderPaneVisible == &quot;boolean&quot;) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/extensions/schemas/mailTabs.json</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/extensions/schemas/mailTabs.json</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,30 +1,11 @@</span>
<a href="#l3.4"></a><span id="l3.4"> [</span>
<a href="#l3.5"></a><span id="l3.5">   {</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineminus">-    &quot;namespace&quot;: &quot;manifest&quot;,</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineminus">-    &quot;types&quot;: [</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">-      {</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">-        &quot;$extend&quot;: &quot;OptionalPermission&quot;,</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-        &quot;choices&quot;: [</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">-          {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-            &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-            &quot;enum&quot;: [</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-              &quot;mailTabs&quot;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-            ]</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-          }</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-        ]</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-      }</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-    ]</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-  },</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-  {</span>
<a href="#l3.22"></a><span id="l3.22">     &quot;namespace&quot;: &quot;mailTabs&quot;,</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-    &quot;permissions&quot;: [</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-      &quot;mailTabs&quot;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-    ],</span>
<a href="#l3.26"></a><span id="l3.26">     &quot;types&quot;: [</span>
<a href="#l3.27"></a><span id="l3.27">       {</span>
<a href="#l3.28"></a><span id="l3.28">         &quot;id&quot;: &quot;QuickFilterTagsDetail&quot;,</span>
<a href="#l3.29"></a><span id="l3.29">         &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l3.30"></a><span id="l3.30">         &quot;properties&quot;: {</span>
<a href="#l3.31"></a><span id="l3.31">           &quot;tags&quot;: {</span>
<a href="#l3.32"></a><span id="l3.32">             &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l3.33"></a><span id="l3.33">             &quot;description&quot;: &quot;Object keys are tags to filter on, values are &lt;code&gt;true&lt;/code&gt; if the message must have the tag, or &lt;code&gt;false&lt;/code&gt; if it must not have the tag. For a list of available tags, call the :ref:`messages.listTags` method.&quot;,</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineat">@@ -72,39 +53,60 @@</span>
<a href="#l3.35"></a><span id="l3.35">             &quot;description&quot;: &quot;Shows messages where &lt;var&gt;text&lt;/var&gt; matches the message body.&quot;,</span>
<a href="#l3.36"></a><span id="l3.36">             &quot;optional&quot;: true</span>
<a href="#l3.37"></a><span id="l3.37">           }</span>
<a href="#l3.38"></a><span id="l3.38">         }</span>
<a href="#l3.39"></a><span id="l3.39">       }</span>
<a href="#l3.40"></a><span id="l3.40">     ],</span>
<a href="#l3.41"></a><span id="l3.41">     &quot;functions&quot;: [</span>
<a href="#l3.42"></a><span id="l3.42">       {</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-        &quot;name&quot;: &quot;getAll&quot;,</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+        &quot;name&quot;: &quot;query&quot;,</span>
<a href="#l3.45"></a><span id="l3.45">         &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-        &quot;description&quot;: &quot;Returns an array of all mail tabs in all windows.&quot;,</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+        &quot;description&quot;: &quot;Gets all mail tabs that have the specified properties, or all tabs if no properties are specified.&quot;,</span>
<a href="#l3.48"></a><span id="l3.48">         &quot;async&quot;: true,</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-        &quot;parameters&quot;: []</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-      },</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-      {</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-        &quot;name&quot;: &quot;getCurrent&quot;,</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-        &quot;description&quot;: &quot;Returns the current mail tab in the most recent window, or throws an exception if the current tab is not a mail tab.&quot;,</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-        &quot;async&quot;: true,</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-        &quot;parameters&quot;: []</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+          {</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+            &quot;name&quot;: &quot;queryInfo&quot;,</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+              &quot;active&quot;: {</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tabs are active in their windows.&quot;</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+              },</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+              &quot;currentWindow&quot;: {</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tabs are in the current window.&quot;</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+              },</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+              &quot;lastFocusedWindow&quot;: {</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tabs are in the last focused window.&quot;</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+              },</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+              &quot;windowId&quot;: {</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+                &quot;minimum&quot;: -2,</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+                &quot;description&quot;: &quot;The ID of the parent window, or $(ref:windows.WINDOW_ID_CURRENT) for the $(topic:current-window)[current window].&quot;</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+              }</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+            }</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+          }</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+        ]</span>
<a href="#l3.86"></a><span id="l3.86">       },</span>
<a href="#l3.87"></a><span id="l3.87">       {</span>
<a href="#l3.88"></a><span id="l3.88">         &quot;name&quot;: &quot;update&quot;,</span>
<a href="#l3.89"></a><span id="l3.89">         &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l3.90"></a><span id="l3.90">         &quot;description&quot;: &quot;Modifies the properties of a mail tab. Properties that are not specified in &lt;var&gt;updateProperties&lt;/var&gt; are not modified.&quot;,</span>
<a href="#l3.91"></a><span id="l3.91">         &quot;async&quot;: true,</span>
<a href="#l3.92"></a><span id="l3.92">         &quot;parameters&quot;: [</span>
<a href="#l3.93"></a><span id="l3.93">           {</span>
<a href="#l3.94"></a><span id="l3.94">             &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l3.95"></a><span id="l3.95">             &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineminus">-            &quot;description&quot;: &quot;Defaults to the selected tab of the current window.&quot;,</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+            &quot;description&quot;: &quot;Defaults to the active tab of the current window.&quot;,</span>
<a href="#l3.98"></a><span id="l3.98">             &quot;optional&quot;: true,</span>
<a href="#l3.99"></a><span id="l3.99">             &quot;minimum&quot;: 1</span>
<a href="#l3.100"></a><span id="l3.100">           },</span>
<a href="#l3.101"></a><span id="l3.101">           {</span>
<a href="#l3.102"></a><span id="l3.102">             &quot;name&quot;: &quot;updateProperties&quot;,</span>
<a href="#l3.103"></a><span id="l3.103">             &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l3.104"></a><span id="l3.104">             &quot;properties&quot;: {</span>
<a href="#l3.105"></a><span id="l3.105">               &quot;displayedFolder&quot;: {</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineat">@@ -124,36 +126,36 @@</span>
<a href="#l3.107"></a><span id="l3.107">                   }</span>
<a href="#l3.108"></a><span id="l3.108">                 }</span>
<a href="#l3.109"></a><span id="l3.109">               },</span>
<a href="#l3.110"></a><span id="l3.110">               &quot;sortType&quot;: {</span>
<a href="#l3.111"></a><span id="l3.111">                 &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l3.112"></a><span id="l3.112">                 &quot;description&quot;: &quot;Sorts the list of messages. &lt;var&gt;sortOrder&lt;/var&gt; must also be given.&quot;,</span>
<a href="#l3.113"></a><span id="l3.113">                 &quot;optional&quot;: true,</span>
<a href="#l3.114"></a><span id="l3.114">                 &quot;enum&quot;: [</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-                  &quot;byNone&quot;,</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-                  &quot;byDate&quot;,</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-                  &quot;bySubject&quot;,</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineminus">-                  &quot;byAuthor&quot;,</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineminus">-                  &quot;byId&quot;,</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineminus">-                  &quot;byThread&quot;,</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineminus">-                  &quot;byPriority&quot;,</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineminus">-                  &quot;byStatus&quot;,</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-                  &quot;bySize&quot;,</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-                  &quot;byFlagged&quot;,</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineminus">-                  &quot;byUnread&quot;,</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-                  &quot;byRecipient&quot;,</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineminus">-                  &quot;byLocation&quot;,</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-                  &quot;byTags&quot;,</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineminus">-                  &quot;byJunkStatus&quot;,</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineminus">-                  &quot;byAttachments&quot;,</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineminus">-                  &quot;byAccount&quot;,</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineminus">-                  &quot;byCustom&quot;,</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineminus">-                  &quot;byReceived&quot;,</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineminus">-                  &quot;byCorrespondent&quot;</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+                  &quot;none&quot;,</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+                  &quot;date&quot;,</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+                  &quot;subject&quot;,</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+                  &quot;author&quot;,</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+                  &quot;id&quot;,</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+                  &quot;thread&quot;,</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+                  &quot;priority&quot;,</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+                  &quot;status&quot;,</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+                  &quot;size&quot;,</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+                  &quot;flagged&quot;,</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+                  &quot;unread&quot;,</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+                  &quot;recipient&quot;,</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+                  &quot;location&quot;,</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+                  &quot;tags&quot;,</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+                  &quot;junkStatus&quot;,</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+                  &quot;attachments&quot;,</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+                  &quot;account&quot;,</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+                  &quot;custom&quot;,</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+                  &quot;received&quot;,</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+                  &quot;correspondent&quot;</span>
<a href="#l3.155"></a><span id="l3.155">                 ]</span>
<a href="#l3.156"></a><span id="l3.156">               },</span>
<a href="#l3.157"></a><span id="l3.157">               &quot;sortOrder&quot;: {</span>
<a href="#l3.158"></a><span id="l3.158">                 &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l3.159"></a><span id="l3.159">                 &quot;description&quot;: &quot;Sorts the list of messages. &lt;var&gt;sortType&lt;/var&gt; must also be given.&quot;,</span>
<a href="#l3.160"></a><span id="l3.160">                 &quot;optional&quot;: true,</span>
<a href="#l3.161"></a><span id="l3.161">                 &quot;enum&quot;: [</span>
<a href="#l3.162"></a><span id="l3.162">                   &quot;none&quot;,</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineat">@@ -189,32 +191,32 @@</span>
<a href="#l3.164"></a><span id="l3.164">         &quot;name&quot;: &quot;getSelectedMessages&quot;,</span>
<a href="#l3.165"></a><span id="l3.165">         &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l3.166"></a><span id="l3.166">         &quot;description&quot;: &quot;Lists the selected messages in the current folder. A messages permission is required to do this.&quot;,</span>
<a href="#l3.167"></a><span id="l3.167">         &quot;async&quot;: true,</span>
<a href="#l3.168"></a><span id="l3.168">         &quot;parameters&quot;: [</span>
<a href="#l3.169"></a><span id="l3.169">           {</span>
<a href="#l3.170"></a><span id="l3.170">             &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l3.171"></a><span id="l3.171">             &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineminus">-            &quot;description&quot;: &quot;Defaults to the selected tab of the current window.&quot;,</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+            &quot;description&quot;: &quot;Defaults to the active tab of the current window.&quot;,</span>
<a href="#l3.174"></a><span id="l3.174">             &quot;optional&quot;: true,</span>
<a href="#l3.175"></a><span id="l3.175">             &quot;minimum&quot;: 1</span>
<a href="#l3.176"></a><span id="l3.176">           }</span>
<a href="#l3.177"></a><span id="l3.177">         ]</span>
<a href="#l3.178"></a><span id="l3.178">       },</span>
<a href="#l3.179"></a><span id="l3.179">       {</span>
<a href="#l3.180"></a><span id="l3.180">         &quot;name&quot;: &quot;setQuickFilter&quot;,</span>
<a href="#l3.181"></a><span id="l3.181">         &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l3.182"></a><span id="l3.182">         &quot;description&quot;: &quot;Sets the Quick Filter user interface based on the options specified.&quot;,</span>
<a href="#l3.183"></a><span id="l3.183">         &quot;async&quot;: true,</span>
<a href="#l3.184"></a><span id="l3.184">         &quot;parameters&quot;: [</span>
<a href="#l3.185"></a><span id="l3.185">           {</span>
<a href="#l3.186"></a><span id="l3.186">             &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l3.187"></a><span id="l3.187">             &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineminus">-            &quot;description&quot;: &quot;Defaults to the selected tab of the current window.&quot;,</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineplus">+            &quot;description&quot;: &quot;Defaults to the active tab of the current window.&quot;,</span>
<a href="#l3.190"></a><span id="l3.190">             &quot;optional&quot;: true,</span>
<a href="#l3.191"></a><span id="l3.191">             &quot;minimum&quot;: 1</span>
<a href="#l3.192"></a><span id="l3.192">           },</span>
<a href="#l3.193"></a><span id="l3.193">           {</span>
<a href="#l3.194"></a><span id="l3.194">             &quot;name&quot;: &quot;properties&quot;,</span>
<a href="#l3.195"></a><span id="l3.195">             &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l3.196"></a><span id="l3.196">             &quot;properties&quot;: {</span>
<a href="#l3.197"></a><span id="l3.197">               &quot;show&quot;: {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/extensions/schemas/tabs.json</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/extensions/schemas/tabs.json</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -34,17 +34,17 @@</span>
<a href="#l4.4"></a><span id="l4.4">           &quot;highlighted&quot;: {&quot;type&quot;: &quot;boolean&quot;, &quot;description&quot;: &quot;Whether the tab is highlighted. Works as an alias of active&quot;},</span>
<a href="#l4.5"></a><span id="l4.5">           &quot;active&quot;: {&quot;type&quot;: &quot;boolean&quot;, &quot;description&quot;: &quot;Whether the tab is active in its window. (Does not necessarily mean the window is focused.)&quot;},</span>
<a href="#l4.6"></a><span id="l4.6">           &quot;url&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;optional&quot;: true, &quot;permissions&quot;: [&quot;tabs&quot;], &quot;description&quot;: &quot;The URL the tab is displaying. This property is only present if the extension's manifest includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission.&quot;},</span>
<a href="#l4.7"></a><span id="l4.7">           &quot;title&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;optional&quot;: true, &quot;permissions&quot;: [&quot;tabs&quot;], &quot;description&quot;: &quot;The title of the tab. This property is only present if the extension's manifest includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission.&quot;},</span>
<a href="#l4.8"></a><span id="l4.8">           &quot;favIconUrl&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;optional&quot;: true, &quot;permissions&quot;: [&quot;tabs&quot;], &quot;description&quot;: &quot;The URL of the tab's favicon. This property is only present if the extension's manifest includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission. It may also be an empty string if the tab is loading.&quot;},</span>
<a href="#l4.9"></a><span id="l4.9">           &quot;status&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;optional&quot;: true, &quot;description&quot;: &quot;Either &lt;em&gt;loading&lt;/em&gt; or &lt;em&gt;complete&lt;/em&gt;.&quot;},</span>
<a href="#l4.10"></a><span id="l4.10">           &quot;width&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;optional&quot;: true, &quot;description&quot;: &quot;The width of the tab in pixels.&quot;},</span>
<a href="#l4.11"></a><span id="l4.11">           &quot;height&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;optional&quot;: true, &quot;description&quot;: &quot;The height of the tab in pixels.&quot;},</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-          &quot;isMail3Pane&quot;: {&quot;type&quot;: &quot;boolean&quot;, &quot;optional&quot;: true, &quot;description&quot;: &quot;Whether the tab is a 3-pane tab.&quot;}</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+          &quot;mailTab&quot;: {&quot;type&quot;: &quot;boolean&quot;, &quot;optional&quot;: true, &quot;description&quot;: &quot;Whether the tab is a 3-pane tab.&quot;}</span>
<a href="#l4.14"></a><span id="l4.14">         }</span>
<a href="#l4.15"></a><span id="l4.15">       },</span>
<a href="#l4.16"></a><span id="l4.16">       {</span>
<a href="#l4.17"></a><span id="l4.17">         &quot;id&quot;: &quot;TabStatus&quot;,</span>
<a href="#l4.18"></a><span id="l4.18">         &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l4.19"></a><span id="l4.19">         &quot;enum&quot;: [&quot;loading&quot;, &quot;complete&quot;],</span>
<a href="#l4.20"></a><span id="l4.20">         &quot;description&quot;: &quot;Whether the tabs have completed loading.&quot;</span>
<a href="#l4.21"></a><span id="l4.21">       },</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -222,17 +222,17 @@</span>
<a href="#l4.23"></a><span id="l4.23">         &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l4.24"></a><span id="l4.24">         &quot;description&quot;: &quot;Gets all tabs that have the specified properties, or all tabs if no properties are specified.&quot;,</span>
<a href="#l4.25"></a><span id="l4.25">         &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l4.26"></a><span id="l4.26">         &quot;parameters&quot;: [</span>
<a href="#l4.27"></a><span id="l4.27">           {</span>
<a href="#l4.28"></a><span id="l4.28">             &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l4.29"></a><span id="l4.29">             &quot;name&quot;: &quot;queryInfo&quot;,</span>
<a href="#l4.30"></a><span id="l4.30">             &quot;properties&quot;: {</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-              &quot;isMail3Pane&quot;: {</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+              &quot;mailTab&quot;: {</span>
<a href="#l4.33"></a><span id="l4.33">                 &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l4.34"></a><span id="l4.34">                 &quot;optional&quot;: true,</span>
<a href="#l4.35"></a><span id="l4.35">                 &quot;description&quot;: &quot;Whether the tab is a Thunderbird 3-pane tab.&quot;</span>
<a href="#l4.36"></a><span id="l4.36">               },</span>
<a href="#l4.37"></a><span id="l4.37">               &quot;active&quot;: {</span>
<a href="#l4.38"></a><span id="l4.38">                 &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l4.39"></a><span id="l4.39">                 &quot;optional&quot;: true,</span>
<a href="#l4.40"></a><span id="l4.40">                 &quot;description&quot;: &quot;Whether the tabs are active in their windows.&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/extensions/test/browser/browser_ext_mailTabs.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/extensions/test/browser/browser_ext_mailTabs.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -53,17 +53,17 @@ add_task(async function test_update() {</span>
<a href="#l5.4"></a><span id="l5.4">           assertDeepEqual(expected[key], actual[key]);</span>
<a href="#l5.5"></a><span id="l5.5">           continue;</span>
<a href="#l5.6"></a><span id="l5.6">         }</span>
<a href="#l5.7"></a><span id="l5.7">         browser.test.assertEq(expected[key], actual[key]);</span>
<a href="#l5.8"></a><span id="l5.8">       }</span>
<a href="#l5.9"></a><span id="l5.9">     }</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">     async function checkCurrent(expected) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-      let current = await browser.mailTabs.getCurrent();</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+      let [current] = await browser.mailTabs.query({ active: true, currentWindow: true });</span>
<a href="#l5.14"></a><span id="l5.14">       assertDeepEqual(expected, current);</span>
<a href="#l5.15"></a><span id="l5.15">     }</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17">     let [accountId] = await awaitMessage();</span>
<a href="#l5.18"></a><span id="l5.18">     let { folders } = await browser.accounts.get(accountId);</span>
<a href="#l5.19"></a><span id="l5.19">     let state = {</span>
<a href="#l5.20"></a><span id="l5.20">       sortType: null,</span>
<a href="#l5.21"></a><span id="l5.21">       sortOrder: null,</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -75,33 +75,33 @@ add_task(async function test_update() {</span>
<a href="#l5.23"></a><span id="l5.23">         name: &quot;Local Folders&quot;,</span>
<a href="#l5.24"></a><span id="l5.24">         path: &quot;/&quot;,</span>
<a href="#l5.25"></a><span id="l5.25">       },</span>
<a href="#l5.26"></a><span id="l5.26">     };</span>
<a href="#l5.27"></a><span id="l5.27">     await checkCurrent(state);</span>
<a href="#l5.28"></a><span id="l5.28">     await awaitMessage(&quot;checkRealLayout&quot;, state);</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30">     browser.mailTabs.update({ displayedFolder: folders[0] });</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    state.sortType = &quot;byDate&quot;;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+    state.sortType = &quot;date&quot;;</span>
<a href="#l5.33"></a><span id="l5.33">     state.sortOrder = &quot;ascending&quot;;</span>
<a href="#l5.34"></a><span id="l5.34">     state.folderPaneVisible = true;</span>
<a href="#l5.35"></a><span id="l5.35">     state.messagePaneVisible = true;</span>
<a href="#l5.36"></a><span id="l5.36">     state.displayedFolder = folders[0];</span>
<a href="#l5.37"></a><span id="l5.37">     await checkCurrent(state);</span>
<a href="#l5.38"></a><span id="l5.38">     await awaitMessage(&quot;checkRealLayout&quot;, state);</span>
<a href="#l5.39"></a><span id="l5.39">     await awaitMessage(&quot;checkRealSort&quot;, state);</span>
<a href="#l5.40"></a><span id="l5.40"> </span>
<a href="#l5.41"></a><span id="l5.41">     state.sortOrder = &quot;descending&quot;;</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-    for (let value of [&quot;byDate&quot;, &quot;bySubject&quot;, &quot;byAuthor&quot;]) {</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+    for (let value of [&quot;date&quot;, &quot;subject&quot;, &quot;author&quot;]) {</span>
<a href="#l5.44"></a><span id="l5.44">       await browser.mailTabs.update({ sortType: value, sortOrder: &quot;descending&quot; });</span>
<a href="#l5.45"></a><span id="l5.45">       state.sortType = value;</span>
<a href="#l5.46"></a><span id="l5.46">       await awaitMessage(&quot;checkRealSort&quot;, state);</span>
<a href="#l5.47"></a><span id="l5.47">     }</span>
<a href="#l5.48"></a><span id="l5.48">     state.sortOrder = &quot;ascending&quot;;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-    for (let value of [&quot;byAuthor&quot;, &quot;bySubject&quot;, &quot;byDate&quot;]) {</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+    for (let value of [&quot;author&quot;, &quot;subject&quot;, &quot;date&quot;]) {</span>
<a href="#l5.51"></a><span id="l5.51">       await browser.mailTabs.update({ sortType: value, sortOrder: &quot;ascending&quot; });</span>
<a href="#l5.52"></a><span id="l5.52">       state.sortType = value;</span>
<a href="#l5.53"></a><span id="l5.53">       await awaitMessage(&quot;checkRealSort&quot;, state);</span>
<a href="#l5.54"></a><span id="l5.54">     }</span>
<a href="#l5.55"></a><span id="l5.55"> </span>
<a href="#l5.56"></a><span id="l5.56">     for (let key of [&quot;folderPaneVisible&quot;, &quot;messagePaneVisible&quot;]) {</span>
<a href="#l5.57"></a><span id="l5.57">       for (let value of [false, true]) {</span>
<a href="#l5.58"></a><span id="l5.58">         await browser.mailTabs.update({ [key]: value });</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineat">@@ -120,33 +120,34 @@ add_task(async function test_update() {</span>
<a href="#l5.60"></a><span id="l5.60">     let selectedMessages = await browser.mailTabs.getSelectedMessages();</span>
<a href="#l5.61"></a><span id="l5.61">     browser.test.assertEq(0, selectedMessages.length);</span>
<a href="#l5.62"></a><span id="l5.62"> </span>
<a href="#l5.63"></a><span id="l5.63">     browser.test.notifyPass(&quot;mailTabs&quot;);</span>
<a href="#l5.64"></a><span id="l5.64">   }</span>
<a href="#l5.65"></a><span id="l5.65"> </span>
<a href="#l5.66"></a><span id="l5.66">   let extension = ExtensionTestUtils.loadExtension({</span>
<a href="#l5.67"></a><span id="l5.67">     background,</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-    manifest: { permissions: [&quot;accountsRead&quot;, &quot;mailTabs&quot;, &quot;messagesRead&quot;] },</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+    manifest: { permissions: [&quot;accountsRead&quot;, &quot;messagesRead&quot;] },</span>
<a href="#l5.70"></a><span id="l5.70">   });</span>
<a href="#l5.71"></a><span id="l5.71"> </span>
<a href="#l5.72"></a><span id="l5.72">   extension.onMessage(&quot;checkRealLayout&quot;, (expected) =&gt; {</span>
<a href="#l5.73"></a><span id="l5.73">     let intValue = [&quot;standard&quot;, &quot;wide&quot;, &quot;vertical&quot;].indexOf(expected.layout);</span>
<a href="#l5.74"></a><span id="l5.74">     is(Services.prefs.getIntPref(&quot;mail.pane_config.dynamic&quot;), intValue);</span>
<a href="#l5.75"></a><span id="l5.75">     if (typeof expected.messagePaneVisible == &quot;boolean&quot;) {</span>
<a href="#l5.76"></a><span id="l5.76">       is(document.getElementById(&quot;messagepaneboxwrapper&quot;).collapsed, !expected.messagePaneVisible);</span>
<a href="#l5.77"></a><span id="l5.77">     }</span>
<a href="#l5.78"></a><span id="l5.78">     if (typeof expected.folderPaneVisible == &quot;boolean&quot;) {</span>
<a href="#l5.79"></a><span id="l5.79">       is(document.getElementById(&quot;folderPaneBox&quot;).collapsed, !expected.folderPaneVisible);</span>
<a href="#l5.80"></a><span id="l5.80">     }</span>
<a href="#l5.81"></a><span id="l5.81">     extension.sendMessage();</span>
<a href="#l5.82"></a><span id="l5.82">   });</span>
<a href="#l5.83"></a><span id="l5.83"> </span>
<a href="#l5.84"></a><span id="l5.84">   extension.onMessage(&quot;checkRealSort&quot;, (expected) =&gt; {</span>
<a href="#l5.85"></a><span id="l5.85">     for (let [columnId, sortType] of window.gFolderDisplay.COLUMNS_MAP) {</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+      sortType = sortType[2].toLowerCase() + sortType.substring(3);</span>
<a href="#l5.87"></a><span id="l5.87">       if (sortType == expected.sortType) {</span>
<a href="#l5.88"></a><span id="l5.88">         let column = document.getElementById(columnId);</span>
<a href="#l5.89"></a><span id="l5.89">         is(column.getAttribute(&quot;sortDirection&quot;), expected.sortOrder);</span>
<a href="#l5.90"></a><span id="l5.90">         extension.sendMessage();</span>
<a href="#l5.91"></a><span id="l5.91">         return;</span>
<a href="#l5.92"></a><span id="l5.92">       }</span>
<a href="#l5.93"></a><span id="l5.93">     }</span>
<a href="#l5.94"></a><span id="l5.94">     throw new Error(&quot;This test should never get here.&quot;);</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineat">@@ -168,17 +169,17 @@ add_task(async function test_events() {</span>
<a href="#l5.96"></a><span id="l5.96">           browser.test.onMessage.removeListener(listener);</span>
<a href="#l5.97"></a><span id="l5.97">           resolve(args);</span>
<a href="#l5.98"></a><span id="l5.98">         });</span>
<a href="#l5.99"></a><span id="l5.99">       });</span>
<a href="#l5.100"></a><span id="l5.100">     }</span>
<a href="#l5.101"></a><span id="l5.101"> </span>
<a href="#l5.102"></a><span id="l5.102">     let [accountId] = await awaitMessage();</span>
<a href="#l5.103"></a><span id="l5.103"> </span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-    let current = await browser.mailTabs.getCurrent();</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+    let [current] = await browser.mailTabs.query({ active: true, currentWindow: true });</span>
<a href="#l5.106"></a><span id="l5.106">     browser.test.assertEq(accountId, current.displayedFolder.accountId);</span>
<a href="#l5.107"></a><span id="l5.107">     browser.test.assertEq(&quot;/&quot;, current.displayedFolder.path);</span>
<a href="#l5.108"></a><span id="l5.108"> </span>
<a href="#l5.109"></a><span id="l5.109">     async function selectFolder(newFolderPath) {</span>
<a href="#l5.110"></a><span id="l5.110">       return new Promise(resolve =&gt; {</span>
<a href="#l5.111"></a><span id="l5.111">         browser.mailTabs.onDisplayedFolderChanged.addListener(function listener(tabId, folder) {</span>
<a href="#l5.112"></a><span id="l5.112">           browser.mailTabs.onDisplayedFolderChanged.removeListener(listener);</span>
<a href="#l5.113"></a><span id="l5.113">           browser.test.assertEq(current.id, tabId);</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineat">@@ -235,17 +236,17 @@ add_task(async function test_events() {</span>
<a href="#l5.115"></a><span id="l5.115">   let folderMap = new Map([</span>
<a href="#l5.116"></a><span id="l5.116">     [&quot;/&quot;, rootFolder],</span>
<a href="#l5.117"></a><span id="l5.117">     [&quot;/Trash&quot;, subFolders[0]],</span>
<a href="#l5.118"></a><span id="l5.118">     [&quot;/Unsent Messages&quot;, subFolders[1]],</span>
<a href="#l5.119"></a><span id="l5.119">   ]);</span>
<a href="#l5.120"></a><span id="l5.120"> </span>
<a href="#l5.121"></a><span id="l5.121">   let extension = ExtensionTestUtils.loadExtension({</span>
<a href="#l5.122"></a><span id="l5.122">     background,</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-    manifest: { permissions: [&quot;accountsRead&quot;, &quot;mailTabs&quot;, &quot;messagesRead&quot;] },</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineplus">+    manifest: { permissions: [&quot;accountsRead&quot;, &quot;messagesRead&quot;] },</span>
<a href="#l5.125"></a><span id="l5.125">   });</span>
<a href="#l5.126"></a><span id="l5.126"> </span>
<a href="#l5.127"></a><span id="l5.127">   extension.onMessage(&quot;selectFolder&quot;, (newFolderPath) =&gt; {</span>
<a href="#l5.128"></a><span id="l5.128">     window.gFolderTreeView.selectFolder(folderMap.get(newFolderPath));</span>
<a href="#l5.129"></a><span id="l5.129">   });</span>
<a href="#l5.130"></a><span id="l5.130"> </span>
<a href="#l5.131"></a><span id="l5.131">   extension.onMessage(&quot;selectMessage&quot;, (newMessages) =&gt; {</span>
<a href="#l5.132"></a><span id="l5.132">     let allMessages = [...window.gFolderDisplay.displayedFolder.messages];</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineat">@@ -272,18 +273,18 @@ add_task(async function test_background_</span>
<a href="#l5.134"></a><span id="l5.134">           browser.test.sendMessage(messageToSend, ...sendArgs);</span>
<a href="#l5.135"></a><span id="l5.135">         }</span>
<a href="#l5.136"></a><span id="l5.136">       });</span>
<a href="#l5.137"></a><span id="l5.137">     }</span>
<a href="#l5.138"></a><span id="l5.138"> </span>
<a href="#l5.139"></a><span id="l5.139">     let [accountId] = await awaitMessage();</span>
<a href="#l5.140"></a><span id="l5.140">     let { folders } = await browser.accounts.get(accountId);</span>
<a href="#l5.141"></a><span id="l5.141">     let allTabs = await browser.tabs.query({});</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-    let queryTabs = await browser.tabs.query({ isMail3Pane: true });</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-    let allMailTabs = await browser.mailTabs.getAll();</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+    let queryTabs = await browser.tabs.query({ mailTab: true });</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+    let allMailTabs = await browser.mailTabs.query({});</span>
<a href="#l5.146"></a><span id="l5.146"> </span>
<a href="#l5.147"></a><span id="l5.147">     browser.test.assertEq(4, allTabs.length);</span>
<a href="#l5.148"></a><span id="l5.148">     browser.test.assertEq(2, queryTabs.length);</span>
<a href="#l5.149"></a><span id="l5.149">     browser.test.assertEq(2, allMailTabs.length);</span>
<a href="#l5.150"></a><span id="l5.150"> </span>
<a href="#l5.151"></a><span id="l5.151">     browser.test.assertEq(accountId, allMailTabs[0].displayedFolder.accountId);</span>
<a href="#l5.152"></a><span id="l5.152">     browser.test.assertEq(&quot;/&quot;, allMailTabs[0].displayedFolder.path);</span>
<a href="#l5.153"></a><span id="l5.153"> </span>
<a href="#l5.154"></a><span id="l5.154" class="difflineat">@@ -306,17 +307,17 @@ add_task(async function test_background_</span>
<a href="#l5.155"></a><span id="l5.155"> </span>
<a href="#l5.156"></a><span id="l5.156">     // Should be in the same state, since we're updating a background tab.</span>
<a href="#l5.157"></a><span id="l5.157">     await awaitMessage(&quot;checkRealLayout&quot;, {</span>
<a href="#l5.158"></a><span id="l5.158">       messagePaneVisible: true,</span>
<a href="#l5.159"></a><span id="l5.159">       folderPaneVisible: true,</span>
<a href="#l5.160"></a><span id="l5.160">       displayedFolder: &quot;/Trash&quot;,</span>
<a href="#l5.161"></a><span id="l5.161">     });</span>
<a href="#l5.162"></a><span id="l5.162"> </span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-    allMailTabs = await browser.mailTabs.getAll();</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+    allMailTabs = await browser.mailTabs.query({});</span>
<a href="#l5.165"></a><span id="l5.165">     browser.test.assertEq(2, allMailTabs.length);</span>
<a href="#l5.166"></a><span id="l5.166"> </span>
<a href="#l5.167"></a><span id="l5.167">     browser.test.assertEq(accountId, allMailTabs[0].displayedFolder.accountId);</span>
<a href="#l5.168"></a><span id="l5.168">     browser.test.assertEq(&quot;/Unsent Messages&quot;, allMailTabs[0].displayedFolder.path);</span>
<a href="#l5.169"></a><span id="l5.169"> </span>
<a href="#l5.170"></a><span id="l5.170">     browser.test.assertEq(accountId, allMailTabs[1].displayedFolder.accountId);</span>
<a href="#l5.171"></a><span id="l5.171">     browser.test.assertEq(&quot;/Trash&quot;, allMailTabs[1].displayedFolder.path);</span>
<a href="#l5.172"></a><span id="l5.172">     browser.test.assertTrue(allMailTabs[1].active);</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineat">@@ -351,17 +352,17 @@ add_task(async function test_background_</span>
<a href="#l5.174"></a><span id="l5.174">       displayedFolder: &quot;/Trash&quot;,</span>
<a href="#l5.175"></a><span id="l5.175">     });</span>
<a href="#l5.176"></a><span id="l5.176"> </span>
<a href="#l5.177"></a><span id="l5.177">     browser.test.notifyPass(&quot;mailTabs&quot;);</span>
<a href="#l5.178"></a><span id="l5.178">   }</span>
<a href="#l5.179"></a><span id="l5.179"> </span>
<a href="#l5.180"></a><span id="l5.180">   let extension = ExtensionTestUtils.loadExtension({</span>
<a href="#l5.181"></a><span id="l5.181">     background,</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineminus">-    manifest: { permissions: [&quot;accountsRead&quot;, &quot;mailTabs&quot;, &quot;tabs&quot;] },</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineplus">+    manifest: { permissions: [&quot;accountsRead&quot;] },</span>
<a href="#l5.184"></a><span id="l5.184">   });</span>
<a href="#l5.185"></a><span id="l5.185"> </span>
<a href="#l5.186"></a><span id="l5.186">   extension.onMessage(&quot;checkRealLayout&quot;, async (expected) =&gt; {</span>
<a href="#l5.187"></a><span id="l5.187">     is(document.getElementById(&quot;messagepaneboxwrapper&quot;).collapsed, !expected.messagePaneVisible);</span>
<a href="#l5.188"></a><span id="l5.188">     is(document.getElementById(&quot;folderPaneBox&quot;).collapsed, !expected.folderPaneVisible);</span>
<a href="#l5.189"></a><span id="l5.189">     is(window.gFolderTreeView.getSelectedFolders()[0].URI,</span>
<a href="#l5.190"></a><span id="l5.190">        account.incomingServer.serverURI + expected.displayedFolder);</span>
<a href="#l5.191"></a><span id="l5.191">     extension.sendMessage();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/extensions/test/browser/browser_ext_menus.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/extensions/test/browser/browser_ext_menus.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -111,30 +111,30 @@ add_task(async function test_thread_pane</span>
<a href="#l6.4"></a><span id="l6.4">   is(event.displayedFolder.path, &quot;/Trash&quot;);</span>
<a href="#l6.5"></a><span id="l6.5">   is(event.selectedMessages.cursor, null);</span>
<a href="#l6.6"></a><span id="l6.6">   ok(!event.selectedFolder);</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   await extension.unload();</span>
<a href="#l6.9"></a><span id="l6.9"> });</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11"> add_task(async function test_tab() {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  async function checkTabEvent(index, active, isMail3Pane) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  async function checkTabEvent(index, active, mailTab) {</span>
<a href="#l6.14"></a><span id="l6.14">     EventUtils.synthesizeMouseAtCenter(tabs[index], {type: &quot;contextmenu&quot;}, window);</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16">     await BrowserTestUtils.waitForEvent(menu, &quot;popupshown&quot;);</span>
<a href="#l6.17"></a><span id="l6.17">     ok(menu.querySelector(&quot;#test1_mochi_test-menuitem-_tab&quot;));</span>
<a href="#l6.18"></a><span id="l6.18">     menu.hidePopup();</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">     let [event, tab] = await checkEvent(extension, [&quot;tab&quot;], [&quot;tab&quot;]);</span>
<a href="#l6.21"></a><span id="l6.21">     ok(!event.selectedFolder);</span>
<a href="#l6.22"></a><span id="l6.22">     ok(!event.displayedFolder);</span>
<a href="#l6.23"></a><span id="l6.23">     ok(!event.selectedMessages);</span>
<a href="#l6.24"></a><span id="l6.24">     is(tab.active, active);</span>
<a href="#l6.25"></a><span id="l6.25">     is(tab.index, index);</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-    is(tab.isMail3Pane, isMail3Pane);</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+    is(tab.mailTab, mailTab);</span>
<a href="#l6.28"></a><span id="l6.28">   }</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30">   let extension = createExtension();</span>
<a href="#l6.31"></a><span id="l6.31">   await extension.startup();</span>
<a href="#l6.32"></a><span id="l6.32"> </span>
<a href="#l6.33"></a><span id="l6.33">   let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l6.34"></a><span id="l6.34">   window.openContentTab(&quot;about:config&quot;);</span>
<a href="#l6.35"></a><span id="l6.35">   window.openContentTab(&quot;about:mozilla&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/extensions/test/browser/browser_ext_quickFilter.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/extensions/test/browser/browser_ext_quickFilter.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -55,17 +55,16 @@ add_task(async () =&gt; {</span>
<a href="#l7.4"></a><span id="l7.4">     browser.mailTabs.setQuickFilter({ tags: { mode: &quot;all&quot;, tags: { &quot;$label1&quot;: true, &quot;$label2&quot;: false } } });</span>
<a href="#l7.5"></a><span id="l7.5">     await awaitMessage(&quot;checkVisible&quot;, 0, 6);</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">     browser.test.notifyPass(&quot;quickFilter&quot;);</span>
<a href="#l7.8"></a><span id="l7.8">   }</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">   let extension = ExtensionTestUtils.loadExtension({</span>
<a href="#l7.11"></a><span id="l7.11">     background,</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    manifest: { permissions: [&quot;mailTabs&quot;] },</span>
<a href="#l7.13"></a><span id="l7.13">   });</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15">   extension.onMessage(&quot;checkVisible&quot;, async (...expected) =&gt; {</span>
<a href="#l7.16"></a><span id="l7.16">     // eslint-disable-next-line mozilla/no-arbitrary-setTimeout</span>
<a href="#l7.17"></a><span id="l7.17">     await new Promise(r =&gt; setTimeout(r, 500));</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">     let actual = [];</span>
<a href="#l7.20"></a><span id="l7.20">     let dbView = window.gFolderDisplay.view.dbView;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

