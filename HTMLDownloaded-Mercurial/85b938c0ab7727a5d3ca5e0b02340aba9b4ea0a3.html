<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 560:85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3" />
<meta property="og:url" content="/comm-central/rev/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3" />
<meta property="og:description" content="Bug 402365 - &quot;[Trunk] Tabs break calendar mode view&quot; [r=philor,berend]" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3">shortlog</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3">files</a> |
changeset |
<a href="/comm-central/raw-rev/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3">raw</a>  | <a href="/comm-central/archive/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=402365">Bug 402365</a> - &quot;[Trunk] Tabs break calendar mode view&quot; [r=philor,berend]
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#65;&#110;&#100;&#114;&#101;&#119;&#32;&#83;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#32;&#60;&#98;&#117;&#103;&#109;&#97;&#105;&#108;&#64;&#97;&#115;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 09 Oct 2008 10:11:34 +0100</td></tr>

<tr>
 <td>changeset 560</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3">85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3</a></td>
</tr>



<tr>
<td>parent 559</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f794c3766d9b42f34c6c214bad0efc039d5a4e5e">f794c3766d9b42f34c6c214bad0efc039d5a4e5e</a>
</td>
</tr>

<tr>
<td>child 561</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0337948019136d5bd8a291c965b9aeb8aca79b12">0337948019136d5bd8a291c965b9aeb8aca79b12</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3">496</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 09 Oct 2008 09:12:13 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@85b938c0ab77 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3&newProject=comm-central&newRevision=85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3&newProject=comm-central&newRevision=85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3&newProject=comm-central&newRevision=85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28philor%29&revcount=50">philor</a>, <a href="/comm-central/log?rev=reviewer%28berend%29&revcount=50">berend</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=402365">402365</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=402365">Bug 402365</a> - &quot;[Trunk] Tabs break calendar mode view&quot; [r=philor,berend]</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.js">calendar/base/content/calendar-task-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.js">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.js">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.js">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.js">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.xul">calendar/base/content/calendar-task-view.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.xul">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.xul">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.xul">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.xul">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/base/content/calendar-task-view.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.js">calendar/lightning/content/customize-toolbar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.js">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.js">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.js">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.js">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.xul">calendar/lightning/content/customize-toolbar.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.xul">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.xul">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.xul">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.xul">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/customize-toolbar.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-migration.xul">calendar/lightning/content/lightning-migration.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-migration.xul">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-migration.xul">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-migration.xul">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-migration.xul">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-migration.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-scripts.inc">calendar/lightning/content/lightning-scripts.inc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-scripts.inc">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-scripts.inc">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-scripts.inc">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-scripts.inc">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-scripts.inc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-standalone.xul">calendar/lightning/content/lightning-standalone.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-standalone.xul">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-standalone.xul">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-standalone.xul">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-standalone.xul">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-standalone.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-today-pane.js">calendar/lightning/content/lightning-today-pane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-today-pane.js">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-today-pane.js">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-today-pane.js">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-today-pane.js">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/lightning-today-pane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.xul">calendar/lightning/content/messenger-overlay-sidebar.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.xul">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.xul">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.xul">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.xul">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-sidebar.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.js">calendar/lightning/content/messenger-overlay-toolbar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.js">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.js">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.js">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.js">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.xul">calendar/lightning/content/messenger-overlay-toolbar.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.xul">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.xul">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.xul">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.xul">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/content/messenger-overlay-toolbar.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/jar.mn">calendar/lightning/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/jar.mn">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/jar.mn">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/jar.mn">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/jar.mn">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/pinstripe/lightning.css">calendar/lightning/themes/pinstripe/lightning.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/pinstripe/lightning.css">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/pinstripe/lightning.css">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/pinstripe/lightning.css">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/pinstripe/lightning.css">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/pinstripe/lightning.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/winstripe/lightning.css">calendar/lightning/themes/winstripe/lightning.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/winstripe/lightning.css">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/winstripe/lightning.css">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/winstripe/lightning.css">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/winstripe/lightning.css">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/calendar/lightning/themes/winstripe/lightning.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/messenger.xul">mail/base/content/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/messenger.xul">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/messenger.xul">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/messenger.xul">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/messenger.xul">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/tabmail.xml">mail/base/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/base/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/pinstripe/mail/tabmailBindings.xml">mail/themes/pinstripe/mail/tabmailBindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/pinstripe/mail/tabmailBindings.xml">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/pinstripe/mail/tabmailBindings.xml">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/pinstripe/mail/tabmailBindings.xml">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/pinstripe/mail/tabmailBindings.xml">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/pinstripe/mail/tabmailBindings.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/qute/mail/tabmailBindings.xml">mail/themes/qute/mail/tabmailBindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/qute/mail/tabmailBindings.xml">file</a> |
<a href="/comm-central/annotate/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/qute/mail/tabmailBindings.xml">annotate</a> |
<a href="/comm-central/diff/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/qute/mail/tabmailBindings.xml">diff</a> |
<a href="/comm-central/comparison/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/qute/mail/tabmailBindings.xml">comparison</a> |
<a href="/comm-central/log/85b938c0ab7727a5d3ca5e0b02340aba9b4ea0a3/mail/themes/qute/mail/tabmailBindings.xml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -2322,17 +2322,17 @@</span>
<a href="#l1.4"></a><span id="l1.4">           self.adjustWeekdayLength();</span>
<a href="#l1.5"></a><span id="l1.5">         ]]&gt;&lt;/body&gt;</span>
<a href="#l1.6"></a><span id="l1.6">       &lt;/method&gt;</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">       &lt;field name=&quot;mScrollHandler&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.9"></a><span id="l1.9">       &lt;method name=&quot;onScroll&quot;&gt;</span>
<a href="#l1.10"></a><span id="l1.10">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.11"></a><span id="l1.11">           // workaround: deck changes shouldn't provoke onScroll events...</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-          var displayDeck = document.getElementById(&quot;displayDeck&quot;);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+          var displayDeck = document.getElementById(&quot;calendarDisplayDeck&quot;);</span>
<a href="#l1.14"></a><span id="l1.14">           if (displayDeck &amp;&amp; displayDeck.selectedPanel.id != &quot;calendar-view-box&quot;) {</span>
<a href="#l1.15"></a><span id="l1.15">             return;</span>
<a href="#l1.16"></a><span id="l1.16">           }</span>
<a href="#l1.17"></a><span id="l1.17">           var panel = this.parentNode.parentNode.parentNode;</span>
<a href="#l1.18"></a><span id="l1.18">           var deck = panel.parentNode;</span>
<a href="#l1.19"></a><span id="l1.19">           if (panel.id != deck.selectedPanel.id) {</span>
<a href="#l1.20"></a><span id="l1.20">             return;</span>
<a href="#l1.21"></a><span id="l1.21">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-task-view.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-view.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -258,27 +258,29 @@ function sendMailToOrganizer() {</span>
<a href="#l2.4"></a><span id="l2.4">     }</span>
<a href="#l2.5"></a><span id="l2.5"> }</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> function taskViewObserveDisplayDeckChange(event) {</span>
<a href="#l2.8"></a><span id="l2.8">     var deck = event.target;</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">     // Bug 309505: The 'select' event also fires when we change the selected</span>
<a href="#l2.11"></a><span id="l2.11">     // panel of calendar-view-box.  Workaround with this check.</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    if (deck.id != &quot;displayDeck&quot;) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    if (deck.id != &quot;calendarDisplayDeck&quot;) {</span>
<a href="#l2.14"></a><span id="l2.14">         return;</span>
<a href="#l2.15"></a><span id="l2.15">     }</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17">     var id = null;</span>
<a href="#l2.18"></a><span id="l2.18">     try {</span>
<a href="#l2.19"></a><span id="l2.19">       id = deck.selectedPanel.id</span>
<a href="#l2.20"></a><span id="l2.20">     }</span>
<a href="#l2.21"></a><span id="l2.21">     catch (e) {}</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">     // In case we find that the task view has been made visible, we refresh the view.</span>
<a href="#l2.24"></a><span id="l2.24">     if (id == &quot;calendar-task-box&quot;) {</span>
<a href="#l2.25"></a><span id="l2.25">         taskViewUpdate(</span>
<a href="#l2.26"></a><span id="l2.26">             document.getElementById(&quot;task-tree-filtergroup&quot;).value || &quot;all&quot;);</span>
<a href="#l2.27"></a><span id="l2.27">     }</span>
<a href="#l2.28"></a><span id="l2.28"> }</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-document.getElementById(&quot;displayDeck&quot;).</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+document.addEventListener(&quot;load&quot;, function () {</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  document.getElementById(&quot;calendarDisplayDeck&quot;).</span>
<a href="#l2.33"></a><span id="l2.33">     addEventListener(&quot;select&quot;, taskViewObserveDisplayDeckChange, true);</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+  }, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-task-view.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-view.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -48,17 +48,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> &lt;overlay xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l3.6"></a><span id="l3.6">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/calendar-task-tree.js&quot;/&gt;</span>
<a href="#l3.7"></a><span id="l3.7">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/calendar-task-view.js&quot;/&gt;</span>
<a href="#l3.8"></a><span id="l3.8">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/calendar-dialog-utils.js&quot;/&gt;</span>
<a href="#l3.9"></a><span id="l3.9">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/calApplicationUtils.js&quot;/&gt;</span>
<a href="#l3.10"></a><span id="l3.10">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  &lt;vbox id=&quot;displayDeck&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  &lt;vbox id=&quot;calendarDisplayDeck&quot;&gt;</span>
<a href="#l3.14"></a><span id="l3.14">     &lt;vbox id=&quot;calendar-task-box&quot; flex=&quot;1&quot;</span>
<a href="#l3.15"></a><span id="l3.15">           onselect=&quot;taskDetailsView.onSelect(event);&quot;&gt;</span>
<a href="#l3.16"></a><span id="l3.16">       &lt;textbox id=&quot;view-task-edit-field&quot;</span>
<a href="#l3.17"></a><span id="l3.17">                class=&quot;task-edit-field&quot;</span>
<a href="#l3.18"></a><span id="l3.18">                onfocus=&quot;taskEdit.onFocus(event)&quot;</span>
<a href="#l3.19"></a><span id="l3.19">                onblur=&quot;taskEdit.onBlur(event)&quot;</span>
<a href="#l3.20"></a><span id="l3.20">                onkeypress=&quot;taskEdit.onKeyPress(event)&quot;/&gt;</span>
<a href="#l3.21"></a><span id="l3.21">       &lt;vbox flex=&quot;1&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/lightning/content/customize-toolbar.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/lightning/content/customize-toolbar.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,362 +0,0 @@</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineminus">-/* -*- Mode: javascript; tab-width: 20; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">- *</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">- *</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">- * License.</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">- *</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">- * The Original Code is Mozilla Communicator client code, released</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">- * March 31, 1998.</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">- *</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">- * David Hyatt.</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">- *</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">- *   David Hyatt (hyatt@apple.com)</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">- *   Blake Ross (blaker@netscape.com)</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">- *   Joe Hewitt (hewitt@netscape.com)</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">- *   Michael Buettner &lt;michael.buettner@sun.com&gt;</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">- *</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">- *</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-/**</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">- * Global variables in addition to those specified in</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">- * mail/base/content/customizeToolbar.js</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">- */</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-var gPreviousLocation = null;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-var gRepositionOnce = false;</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-var gIsMainApplicationContext = (window.arguments[3] != null);</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-/**</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">- * Since we want to 'inherit' several global functions</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">- * we retrieve the current values in order to call them</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">- * from their overriden version.</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">- */</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-var gOnLoad = onLoad;</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-var gInitDialog = initDialog;</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-var gOnCancel = onCancel;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-/**</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">- * initDialog() gets called from the load handler and</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">- * is responsible for initializing global variables, etc.</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">- */</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-initDialog = function() {</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-    // Don't do any extra processing in case we're not</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-    // customizing one of the main application toolbars.</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-    // The customize toolbar dialog contains special features</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-    // that don't apply in that case (location drop down, etc.).</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-    if (gIsMainApplicationContext) {</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-        // remember initial toolbar location and set the</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-        // menulist accordingly. this applies to the mode toolbar only.</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-        gPreviousLocation = gToolbox.getAttribute(&quot;location&quot;);</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-        document.getElementById(&quot;location-list&quot;).value = gPreviousLocation;</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-        // set the toolbar selection according to the current mode.</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-        // this list allows to hop from one toolbar to another without</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-        // leaving the customize dialog. if this feature is to be used outside</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-        // of mail/news main application window, we detect this case and disable</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-        // all relevant controls and stuff.</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-        var selectorList = document.getElementById(&quot;selector-list&quot;);</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-        selectorList.value = window.arguments[3];</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-        if (selectorList.selectedItem.value != window.arguments[3]) {</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-            document.getElementById(&quot;selector-container&quot;).collapsed = true;</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-        }</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-    }</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-    // now call the original initDialog() function</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-    gInitDialog();</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-}</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineminus">-/**</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">- * onCancel() is called if the customize toolbar dialog has been canceled.</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">- * we're returning to the previous state and discarding any changes made</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">- * to the current toolbar. please note that this applies to the current toolbar</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">- * only. in case we've been switched from one to another, only the changes</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">- * made to the most recent toolbar will be discarded.</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">- */</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-onCancel = function() {</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-    // Don't do any extra processing in case we're not</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-    // customizing one of the main application toolbars.</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-    // The customize toolbar dialog contains special features</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-    // that don't apply in that case (location drop down, etc.).</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-    if (gIsMainApplicationContext) {</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-        updateToolbarLocation(gPreviousLocation);</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-    }</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-    gOnCancel();</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-}</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-/**</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">- * repositionDialog() to find a good position for the customize dialog.</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineminus">- * it is called during initialization and subsequently if any option has been</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineminus">- * altered that causes the toolbar to change size or location. we need to</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineminus">- * override this function to add the ability to set the position *above*</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineminus">- * the toolbar in question, since this is necessary for the mode toolbar</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineminus">- * which is set at the lower left of the application window by default.</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">- */</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-_repositionDialog = function() {</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">- </span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-  // Christian said it's better to not make the dialog jump...</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-  if (gRepositionOnce)</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-    return;</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-  gRepositionOnce = true;</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-    </span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-  // Position the dialog touching the bottom of the toolbox and centered with </span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-  // it. We must resize the window smaller first so that it is positioned properly. </span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-  var screenX = gToolbox.boxObject.screenX + ((gToolbox.boxObject.width - kWindowWidth) / 2);</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-  var screenY = gToolbox.boxObject.screenY + gToolbox.boxObject.height;</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-  var newHeight = kWindowHeight;</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-  if (newHeight &gt;= screen.availHeight - screenY - kVSizeSlop) {</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-    // the customize window doesn't fit below the toolbar. first try if there's</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-    // enough space at the top of the toolbar. if neither works, shrink the height.</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-    if(gToolbox.boxObject.screenY - newHeight - kVSizeSlop &lt; 0) {</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineminus">-      newHeight = screen.availHeight - screenY - kVSizeSlop;</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-    } else {</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-      screenY = gToolbox.boxObject.screenY - newHeight;</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-    }</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-  }</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineminus">-  </span>
<a href="#l4.147"></a><span id="l4.147" class="difflineminus">-  if(screenX &lt; 0) {</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineminus">-    screenX = 0;</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineminus">-  }</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineminus">-  </span>
<a href="#l4.151"></a><span id="l4.151" class="difflineminus">-  window.resizeTo(kWindowWidth, newHeight);</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineminus">-  window.moveTo(screenX, screenY);</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-}</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineminus">-/**</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">- * onLoad() is called by the load event handler. we need to override</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">- * this function to initialize the newly introduced controls.</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineminus">- */</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineminus">-onLoad = function() {</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineminus">-</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineminus">-    // remove the box containing all the relevant controls from</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineminus">-    // the dom tree, we bring a new one to the table. this is necessary</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineminus">-    // since those controls don't specify id's, so we need to override</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-    // all of them.</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-    var mainbox = document.getElementById(&quot;main-box&quot;);</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-    var controlbox = document.getElementById(&quot;control-box&quot;);</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-    mainbox.removeChild(controlbox.nextSibling);</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineminus">-</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineminus">-    // Don't do any extra processing in case we're not</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineminus">-    // customizing one of the main application toolbars.</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineminus">-    // The customize toolbar dialog contains special features</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineminus">-    // that don't apply in that case (location drop down, etc.).</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineminus">-    if (gIsMainApplicationContext) {</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineminus">-</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineminus">-        document.getElementById(&quot;selector-container&quot;)</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineminus">-            .removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineminus">-</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineminus">-        // show the location option (place toolbar at top or bottom)</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineminus">-        // if this feature has been requested.</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineminus">-        updateLocationVisibility(window.arguments[3] == 'mode');</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineminus">-    }</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineminus">-</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineminus">-    // now call the default implementation of the load handler, since</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineminus">-    // this retrieves the toolbox element from the arguments.</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineminus">-    gOnLoad();</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineminus">-}</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineminus">-</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineminus">-/**</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineminus">- * updateToolbarLocation() is called to handle a new location for</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineminus">- * the toolbar (top or bottom). basically, we just set the appropriate</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineminus">- * attribute on all customizable toolbars and rely on them intercepting</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineminus">- * this modification and act accordingly.</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineminus">- */</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineminus">-_updateToolbarLocation = function(aLocation) {</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineminus">-</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineminus">-  // since the current toolbar will change its location in</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineminus">-  // the dom tree (most probably), we need to unwrap the toolbar items</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineminus">-  // and reset anything that could get in the way.</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineminus">-  removeToolboxListeners();</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineminus">-  unwrapToolbarItems(false);</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineminus">-</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-  var toolboxId = gToolbox.id;</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-  // set the new location on the toolbox...</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-  setAttribute(gToolbox, &quot;location&quot;, aLocation);</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-  gToolboxDocument.persist(gToolbox.id, &quot;location&quot;);</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-  </span>
<a href="#l4.208"></a><span id="l4.208" class="difflineminus">-  // ...and each customizable toolbar</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineminus">-  for (var i = 0; i &lt; gToolbox.childNodes.length; ++i) {</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineminus">-    var toolbar = getToolbarAt(i);</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-    if (isCustomizableToolbar(toolbar)) {</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineminus">-      setAttribute(toolbar, &quot;location&quot;, aLocation);</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineminus">-      gToolboxDocument.persist(toolbar.id, &quot;location&quot;);</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineminus">-    }</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineminus">-  }</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineminus">-</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineminus">-  gToolbox = gToolboxDocument.getElementById(toolboxId);</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineminus">-  gToolboxDocument = gToolbox.ownerDocument;</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineminus">-  </span>
<a href="#l4.220"></a><span id="l4.220" class="difflineminus">-  gToolbox.addEventListener(&quot;draggesture&quot;, onToolbarDragGesture, false);</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineminus">-  gToolbox.addEventListener(&quot;dragover&quot;, onToolbarDragOver, false);</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineminus">-  gToolbox.addEventListener(&quot;dragexit&quot;, onToolbarDragExit, false);</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineminus">-  gToolbox.addEventListener(&quot;dragdrop&quot;, onToolbarDragDrop, false);</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineminus">-</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineminus">-  // Now re-wrap the items on the toolbar, but don't clobber previousset.</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineminus">-  wrapToolbarItems(false);</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineminus">-}</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineminus">-</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineminus">-/**</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineminus">- * Handler that takes care of a new toolbar being selected for customization.</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineminus">- */</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineminus">-_updateToolbarSelection = function(aSelection) {</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineminus">-</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-  var callback = window.arguments[2];</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-  if(callback) {</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineminus">-</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineminus">-    // first of all, we need to remove our listeners and unwrap</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineminus">-    // the toolbar items. this is important to do first, before calling</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-    // the outside world, since they possibly want to change those items...</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineminus">-    removeToolboxListeners();</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineminus">-    unwrapToolbarItems(true);</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineminus">-    </span>
<a href="#l4.243"></a><span id="l4.243" class="difflineminus">-    // persist the current set of buttons in all</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineminus">-    // customizable toolbars to localstore.    </span>
<a href="#l4.245"></a><span id="l4.245" class="difflineminus">-    persistCurrentSets();</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineminus">-</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineminus">-    // execute the supplied callback function. we expect to receive</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineminus">-    // the toolbox we're supposed to customize as a result.</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineminus">-    var toolbox = callback(aSelection);</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineminus">-</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineminus">-    // store some internal states in the window arguments</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineminus">-    // since we're going to call initDialog() again...</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineminus">-    window.arguments[0] = toolbox;</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineminus">-    window.arguments[3] = aSelection;</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineminus">-</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineminus">-    // show or hide the location menu dependend</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineminus">-    // on the toolbar we're switching to.</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineminus">-    updateLocationVisibility(aSelection == 'mode');</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineminus">-</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-    // nothing has changed so far...</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-    gToolboxChanged = false;</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-    // now just call the default load handler in order to</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-    // initialize the dialog for a fresh start.</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-    gOnLoad();</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-  }</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-}</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineminus">-/**</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineminus">- * Show or hide the location selection, this option shouldn't be always visible</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">- */</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineminus">-_updateLocationVisibility = function(aShow) {</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineminus">-  var controls = document.getElementsByAttribute(&quot;location-option&quot;, &quot;true&quot;);</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineminus">-  for (var i=0;i&lt;controls.length;i++) {</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineminus">-    if (aShow) {</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineminus">-      controls[i].removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineminus">-    } else {</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineminus">-      controls[i].setAttribute(&quot;collapsed&quot;,&quot;true&quot;);</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineminus">-    }  </span>
<a href="#l4.281"></a><span id="l4.281" class="difflineminus">-  }</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineminus">-}</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineminus">-</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineminus">-/**</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineminus">- * Builds the palette of draggable items that are not yet in a toolbar.</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineminus">- */</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineminus">-_buildPalette = function() {</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineminus">-</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineminus">-  // Empty the palette first.</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineminus">-  var paletteBox = document.getElementById(&quot;palette-box&quot;);</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineminus">-  while (paletteBox.lastChild)</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineminus">-    paletteBox.removeChild(paletteBox.lastChild);</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineminus">-</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineminus">-  var currentRow = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineminus">-                                            &quot;hbox&quot;);</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineminus">-  currentRow.setAttribute(&quot;class&quot;, &quot;paletteRow&quot;);</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineminus">-</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineminus">-  // Add the toolbar separator item.</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineminus">-  var templateNode = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineminus">-                                              &quot;toolbarseparator&quot;);</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineminus">-  templateNode.id = &quot;separator&quot;;</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineminus">-  wrapPaletteItem(templateNode, currentRow, null);</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineminus">-</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineminus">-  // Add the toolbar spring item.</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineminus">-  templateNode = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-                                              &quot;toolbarspring&quot;);</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineminus">-  templateNode.id = &quot;spring&quot;;</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-  templateNode.flex = 1;</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-  wrapPaletteItem(templateNode, currentRow, null);</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-  // Add the toolbar spacer item.</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-  templateNode = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-                                              &quot;toolbarspacer&quot;);</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-  templateNode.id = &quot;spacer&quot;;</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-  templateNode.flex = 1;</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-  wrapPaletteItem(templateNode, currentRow, null);</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-  var rowSlot = 3;</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineminus">-</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineminus">-  var currentItems = getCurrentItemIds();</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineminus">-  templateNode = gToolbox.palette.firstChild;</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineminus">-  while (templateNode) {</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineminus">-    // Check if the item is already in a toolbar before adding it to the palette.</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineminus">-    if (!(templateNode.id in currentItems)) {</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineminus">-</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineminus">-      var nodeMode = templateNode.getAttribute('mode');</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineminus">-      if (!nodeMode)</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineminus">-        nodeMode = 'mail';</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineminus">-</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineminus">-      if (nodeMode == window.arguments[3]) {</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineminus">-</span>
<a href="#l4.332"></a><span id="l4.332" class="difflineminus">-        var paletteItem = templateNode.cloneNode(true);</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineminus">-</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineminus">-        if (rowSlot == kRowMax) {</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineminus">-          // Append the old row.</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineminus">-          paletteBox.appendChild(currentRow);</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineminus">-</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineminus">-          // Make a new row.</span>
<a href="#l4.339"></a><span id="l4.339" class="difflineminus">-          currentRow = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l4.340"></a><span id="l4.340" class="difflineminus">-                                                &quot;hbox&quot;);</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineminus">-          currentRow.setAttribute(&quot;class&quot;, &quot;paletteRow&quot;);</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineminus">-          rowSlot = 0;</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineminus">-        }</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineminus">-</span>
<a href="#l4.345"></a><span id="l4.345" class="difflineminus">-        ++rowSlot;</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineminus">-        wrapPaletteItem(paletteItem, currentRow, null);</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineminus">-      }</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineminus">-    }</span>
<a href="#l4.349"></a><span id="l4.349" class="difflineminus">-    </span>
<a href="#l4.350"></a><span id="l4.350" class="difflineminus">-    templateNode = templateNode.nextSibling;</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineminus">-  }</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineminus">-</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineminus">-  if (currentRow) { </span>
<a href="#l4.354"></a><span id="l4.354" class="difflineminus">-    fillRowWithFlex(currentRow);</span>
<a href="#l4.355"></a><span id="l4.355" class="difflineminus">-    paletteBox.appendChild(currentRow);</span>
<a href="#l4.356"></a><span id="l4.356" class="difflineminus">-  }</span>
<a href="#l4.357"></a><span id="l4.357" class="difflineminus">-}</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineminus">-</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineminus">-if (gIsMainApplicationContext) {</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineminus">-    repositionDialog = _repositionDialog;</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineminus">-    updateToolbarLocation = _updateToolbarLocation;</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineminus">-    updateToolbarSelection = _updateToolbarSelection;</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineminus">-    updateLocationVisibility = _updateLocationVisibility;</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineminus">-    buildPalette = _buildPalette;</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/lightning/content/customize-toolbar.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/lightning/content/customize-toolbar.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,102 +0,0 @@</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineminus">-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">-   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">-   -</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">-   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">-   - the License. You may obtain a copy of the License at</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">-   - http://www.mozilla.org/MPL/</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-   -</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-   - for the specific language governing rights and limitations under the</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-   - License.</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-   -</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-   - The Original Code is Mozilla Communicator client code, released</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-   - March 31, 1998.</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-   -</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-   - The Initial Developer of the Original Code is</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-   - Netscape Communications Corporation.</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-   - Portions created by the Initial Developer are Copyright (C) 1998-1999</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-   - the Initial Developer. All Rights Reserved.</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-   -</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-   - Contributor(s):</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-   -   David Hyatt (hyatt@apple.com)</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-   -   Blake Ross (blaker@netscape.com)</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-   -   Michael Buettner &lt;michael.buettner@sun.com&gt;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-   -   Berend Cornelius &lt;berend.cornelius@sun.com&gt;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-   -</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-   - and other provisions required by the LGPL or the GPL. If you do not delete</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-   -</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-&lt;!DOCTYPE dialog [</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-  &lt;!ENTITY % customizeToolbarDTD SYSTEM &quot;chrome://global/locale/customizeToolbar.dtd&quot;&gt;</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-  %customizeToolbarDTD;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-  &lt;!ENTITY % lightningDTD SYSTEM &quot;chrome://lightning/locale/lightning.dtd&quot;&gt;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-  %lightningDTD;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-]&gt;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://lightning/skin/lightning.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-&lt;overlay xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-          src=&quot;chrome://lightning/content/customize-toolbar.js&quot;/&gt;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-  &lt;vbox id=&quot;main-box&quot; flex=&quot;1&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-    &lt;box id=&quot;selector-container&quot; orient=&quot;vertical&quot; insertbefore=&quot;instructions&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-      &lt;box align=&quot;center&quot; orient=&quot;horizontal&quot;&gt;</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-        &lt;label value=&quot;&amp;customize.toolbar.selector.label;&quot; control=&quot;selector-list&quot;/&gt;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-        &lt;menulist id=&quot;selector-list&quot;</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-                  value=&quot;mode&quot;</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-                  oncommand=&quot;updateToolbarSelection(this.value);&quot;&gt;</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-          &lt;menupopup&gt;</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-            &lt;menuitem value=&quot;mode&quot; label=&quot;&amp;customize.toolbar.selector.mode;&quot;/&gt;</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-            &lt;menuitem value=&quot;mail&quot; label=&quot;&amp;customize.toolbar.selector.mail;&quot;/&gt;</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-            &lt;menuitem value=&quot;calendar&quot; label=&quot;&amp;customize.toolbar.selector.calendar;&quot;/&gt;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-            &lt;menuitem value=&quot;task&quot; label=&quot;&amp;customize.toolbar.selector.task;&quot;/&gt;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-          &lt;/menupopup&gt;</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-        &lt;/menulist&gt;</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-      &lt;/box&gt;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-      &lt;separator class=&quot;groove&quot;/&gt;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-    &lt;/box&gt;</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-    &lt;box id=&quot;control-box&quot; align=&quot;center&quot; insertafter=&quot;palette-box&quot;&gt;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-      &lt;label value=&quot;&amp;customize.toolbar.location.label;&quot; control=&quot;location-list&quot;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-             location-option=&quot;true&quot;</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-             collapsed=&quot;true&quot;/&gt;</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-      &lt;menulist id=&quot;location-list&quot;</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-                value=&quot;top&quot;</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-                location-option=&quot;true&quot;</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-                collapsed=&quot;true&quot;</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-                oncommand=&quot;updateToolbarLocation(this.value);&quot;&gt;</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-        &lt;menupopup&gt;</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-          &lt;menuitem value=&quot;top&quot; label=&quot;&amp;customize.toolbar.location.top;&quot;/&gt;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-          &lt;menuitem value=&quot;bottom&quot; label=&quot;&amp;customize.toolbar.location.bottom;&quot;/&gt;</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-        &lt;/menupopup&gt;</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-      &lt;/menulist&gt;</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-      &lt;label value=&quot;&amp;show.label;&quot; control=&quot;modelist&quot;/&gt;</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-      &lt;menulist id=&quot;modelist&quot; value=&quot;icons&quot; oncommand=&quot;updateToolbarMode(this.value);&quot;&gt;</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-        &lt;menupopup&gt;</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-          &lt;menuitem value=&quot;full&quot; label=&quot;&amp;iconsAndText.label;&quot;/&gt;</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-          &lt;menuitem value=&quot;icons&quot; label=&quot;&amp;icons.label;&quot;/&gt;</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-          &lt;menuitem value=&quot;text&quot; label=&quot;&amp;text.label;&quot;/&gt;</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-        &lt;/menupopup&gt;</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-      &lt;/menulist&gt;</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-      &lt;checkbox id=&quot;smallicons&quot; oncommand=&quot;updateIconSize(this.checked);&quot; label=&quot;&amp;useSmallIcons.label;&quot;/&gt;</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-      &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-      &lt;button label=&quot;&amp;restoreDefaultSet.label;&quot; oncommand=&quot;restoreDefaultSet();&quot;/&gt;</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-    &lt;/box&gt;</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-  &lt;/vbox&gt;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-&lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/lightning/content/lightning-migration.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-migration.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -64,11 +64,11 @@</span>
<a href="#l6.4"></a><span id="l6.4">             if (!cals.length) {</span>
<a href="#l6.5"></a><span id="l6.5">                 // There are no calendars, so we are running for the first time</span>
<a href="#l6.6"></a><span id="l6.6">                 gDataMigrator.checkAndMigrate();</span>
<a href="#l6.7"></a><span id="l6.7">             }</span>
<a href="#l6.8"></a><span id="l6.8">         }</span>
<a href="#l6.9"></a><span id="l6.9">         document.addEventListener(&quot;load&quot;, checkOld, true);</span>
<a href="#l6.10"></a><span id="l6.10">     ]]&gt;&lt;/script&gt;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    &lt;deck id=&quot;displayDeck&quot;/&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    &lt;deck id=&quot;calendarDisplayDeck&quot;/&gt;</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/lightning/content/lightning-scripts.inc</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-scripts.inc</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -41,17 +41,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> # the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.5"></a><span id="l7.5"> #</span>
<a href="#l7.6"></a><span id="l7.6"> # ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://lightning/content/lightning-utils.js&quot;/&gt;</span>
<a href="#l7.9"></a><span id="l7.9"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://lightning/content/messenger-overlay-sidebar.js&quot;/&gt;</span>
<a href="#l7.10"></a><span id="l7.10"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://lightning/content/messenger-overlay-toolbar.js&quot;/&gt;</span>
<a href="#l7.11"></a><span id="l7.11"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://lightning/content/lightning-common-sets.js&quot;/&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-&lt;script type=&quot;application/javascript&quot; src=&quot;chrome://lightning/content/lightning-today-pane.js&quot;/&gt;</span>
<a href="#l7.13"></a><span id="l7.13"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/calendar-invitations-manager.js&quot;/&gt;</span>
<a href="#l7.14"></a><span id="l7.14"> &lt;script type=&quot;application/javascript&quot;&gt;</span>
<a href="#l7.15"></a><span id="l7.15">     var calendarmenulabel = &quot;&amp;lightning.calendar.label;&quot;;</span>
<a href="#l7.16"></a><span id="l7.16">     var calendarmenuaccesskey = &quot;&amp;lightning.calendar.accesskey;&quot;;</span>
<a href="#l7.17"></a><span id="l7.17">     var messagemenulabel = &quot;&amp;msgMenu.label;&quot;;</span>
<a href="#l7.18"></a><span id="l7.18">     var messagemenuaccesskey = &quot;&amp;msgMenu.accesskey;&quot;;</span>
<a href="#l7.19"></a><span id="l7.19">     var tasksmenulabel = &quot;&amp;lightning.tasks.label;&quot;;</span>
<a href="#l7.20"></a><span id="l7.20">     var tasksmenuaccesskey = &quot;&amp;lightning.tasks.accesskey;&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/lightning/content/lightning-standalone.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-standalone.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -43,16 +43,16 @@</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> &lt;?xml-stylesheet href=&quot;chrome://calendar/content/calendar-multiday-view.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l8.6"></a><span id="l8.6"> &lt;?xml-stylesheet href=&quot;chrome://calendar/skin/widgets/minimonth.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> &lt;window</span>
<a href="#l8.9"></a><span id="l8.9">   id=&quot;lightning&quot;</span>
<a href="#l8.10"></a><span id="l8.10">   xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l8.11"></a><span id="l8.11">   &lt;!-- messenger-overlay-sidebar expects to overlay a vbox named &quot;folderPaneBox&quot; and a </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-     - deck named &quot;displayDeck&quot;.  So we oblige.</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+     - deck named &quot;calendarDisplayDeck&quot;.  So we oblige.</span>
<a href="#l8.14"></a><span id="l8.14">     --&gt;</span>
<a href="#l8.15"></a><span id="l8.15">   &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l8.16"></a><span id="l8.16">     &lt;vbox id=&quot;folderPaneBox&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l8.17"></a><span id="l8.17">     &lt;splitter /&gt;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-    &lt;deck id=&quot;displayDeck&quot; flex=&quot;4&quot;/&gt;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+    &lt;deck id=&quot;calendarDisplayDeck&quot; flex=&quot;4&quot;/&gt;</span>
<a href="#l8.20"></a><span id="l8.20">   &lt;/hbox&gt;</span>
<a href="#l8.21"></a><span id="l8.21"> &lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/lightning/content/lightning-today-pane.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-today-pane.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,86 +0,0 @@</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">- *</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">- *</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">- * License.</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">- *</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-    - The Original Code is Sun Microsystems code.</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">- *</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">- * The Initial Developer of the Original Code is Sun Microsystems.</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">- *</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">- * Contributor(s):</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">- *   Berend Cornelius &lt;berend.cornelius@sun.com&gt;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">- *</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">- *</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-var ltnTodaypaneButton = &quot;mail-show-todaypane-button&quot;;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-function ltnAddButtonToSetString(toolbarSetString) {</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-    // by default the todaypane-button is to be placed before the first</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineminus">-    // separator of the toolbar</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-    var separatorindex = toolbarSetString.indexOf(&quot;separator&quot;);</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-    if (separatorindex &gt; -1) {</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-        var firstSubString = toolbarSetString.substring(0, separatorindex);</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">-        var secondSubString = toolbarSetString.substring(separatorindex);</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-        toolbarSetString = firstSubString + ltnTodaypaneButton + &quot;,&quot; + secondSubString;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-    } else {</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-        // in case there is no separator within the toolbar we append the</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-        // todaypane-button</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-        toolbarSetString += &quot;,&quot; + ltnTodaypaneButton;</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-    }</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-    return toolbarSetString;</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-}</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineminus">-</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-/**  ltnInitTodayPane()</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineminus">-*    initializes TodayPane for Lightning and adds a toolbarbutton to mail-toolbar once</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-*/</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineminus">-function ltnInitTodayPane() {</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-    // add toolbar-button to mail-toolbar</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-    var mailToolbar = getMailBar();</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-    var addToolbarbutton = false;</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">-    var defaultSetString = mailToolbar.getAttribute(&quot;defaultset&quot;);</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-    if (defaultSetString.indexOf(ltnTodaypaneButton) == -1) {</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineminus">-        defaultSetString = ltnAddButtonToSetString(defaultSetString);</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-        mailToolbar.setAttribute(&quot;defaultset&quot;, defaultSetString);</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-    }</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-    // add the toolbarbutton to the toolbarpalette on first startup</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-    var todaypanebox = document.getElementById(&quot;today-pane-panel&quot;);</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-    if (todaypanebox.hasAttribute(&quot;addtoolbarbutton&quot;)) {</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-        addToolbarbutton = (todaypanebox.getAttribute(&quot;addtoolbarbutton&quot;) == &quot;true&quot;);</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-    }</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineminus">-    if (addToolbarbutton) {</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">-        var currentSetString = mailToolbar.getAttribute(&quot;currentset&quot;);</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineminus">-        if (currentSetString.indexOf(ltnTodaypaneButton) == -1) {</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineminus">-            if (currentSetString.length == 0) {</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-                mailToolbar.currentSet = mailToolbar.getAttribute(&quot;defaultset&quot;);</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-            } else {</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-                mailToolbar.currentSet = ltnAddButtonToSetString(currentSetString);</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-            }</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-            mailToolbar.setAttribute(&quot;currentset&quot;, mailToolbar.currentSet);</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-            document.persist(mailToolbar.id, &quot;currentset&quot;);</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">-        }</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-        todaypanebox.setAttribute(&quot;addtoolbarbutton&quot;, &quot;false&quot;);</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">-    }</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineminus">-}</span>
<a href="#l9.90"></a><span id="l9.90">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -69,138 +69,72 @@ function nextMonth(dt)</span>
<a href="#l10.4"></a><span id="l10.4">     return d;</span>
<a href="#l10.5"></a><span id="l10.5"> }</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> var gMiniMonthLoading = false;</span>
<a href="#l10.8"></a><span id="l10.8"> function ltnMinimonthPick(minimonth) {</span>
<a href="#l10.9"></a><span id="l10.9">     if (gMiniMonthLoading || gCurrentMode != &quot;calendar&quot;) {</span>
<a href="#l10.10"></a><span id="l10.10">         return;</span>
<a href="#l10.11"></a><span id="l10.11">     }</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    if (document.getElementById(&quot;displayDeck&quot;).selectedPanel !=</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    if (document.getElementById(&quot;calendarDisplayDeck&quot;).selectedPanel !=</span>
<a href="#l10.14"></a><span id="l10.14">         document.getElementById(&quot;calendar-view-box&quot;)) {</span>
<a href="#l10.15"></a><span id="l10.15">         ltnShowCalendarView(gLastShownCalendarView);</span>
<a href="#l10.16"></a><span id="l10.16">     }</span>
<a href="#l10.17"></a><span id="l10.17">     var jsDate = minimonth.value;</span>
<a href="#l10.18"></a><span id="l10.18">     document.getElementById(&quot;ltnDateTextPicker&quot;).value = jsDate;</span>
<a href="#l10.19"></a><span id="l10.19">     var cdt = jsDateToDateTime(jsDate, currentView().timezone);</span>
<a href="#l10.20"></a><span id="l10.20">     cdt.isDate = true;</span>
<a href="#l10.21"></a><span id="l10.21">     currentView().goToDay(cdt);</span>
<a href="#l10.22"></a><span id="l10.22"> }</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-function ltnOnLoad(event) {</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">-    // take the existing folderPaneBox (that's what thunderbird displays</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-    // at the left side of the application window) and stuff that inside</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-    // of the deck we're introducing with the contentPanel. this essentially</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">-    // rearranges the DOM tree and allows us to switch between content that</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-    // lives inside of the left pane.</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-    var folderPaneBox = document.getElementById(&quot;folderPaneBox&quot;);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-    var contentPanel = document.getElementById(&quot;contentPanel&quot;);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-    contentPanel.insertBefore(folderPaneBox, contentPanel.firstChild);</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-    // we're taking care of the mode toolbar (that's the small toolbar on</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-    // the lower left with the 'mail', 'calendar', 'task' buttons on it).</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-    // since we want to have this particular toolbar displayed at the</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-    // top or bottom inside the folderPaneBox (basically on top or bottom</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-    // of the window) we need to go to great length in order to get this</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-    // damned thing working. i decided to dynamically place the toolbox</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">-    // inside the DOM tree, that appears to be the most clean solution to</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-    // the problem. unfortunately, it didn't work out that easy. as soon</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-    // as we call insertBefore() to place the node somewhere different, the</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-    // constructor of the appropriate binding gets called again. this has</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-    // the nasty side-effect that the toolbar get a bit confused, since it</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-    // thinks it is customized, which just isn't the case. that's why we need</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-    // to carry some internal toolbar properties over. and that's what those</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-    // functions retrieveToolbarProperties() and restoreToolbarProperties()</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-    // are all about.</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-    var retrieveToolbarProperties = function(toolbox)</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-    {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-      var toolbars = {};</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-      var toolbar = toolbox.firstChild;</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-      while (toolbar) {</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-        if (toolbar.localName == &quot;toolbar&quot;) {</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-          if (toolbar.getAttribute(&quot;customizable&quot;) == &quot;true&quot;) {</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-            if (!toolbar.hasAttribute(&quot;customindex&quot;)) {</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-              var propertybag = {};</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-              propertybag.firstPermanentChild = toolbar.firstPermanentChild;</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-              propertybag.lastPermanentChild = toolbar.lastPermanentChild;</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">-              toolbars[toolbar.id] = propertybag;</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-            }</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineminus">-          }</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-        }</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-        toolbar = toolbar.nextSibling;</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+var calendarTabType = {</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+  name: &quot;calendar&quot;,</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+  panelId: &quot;calendarTabPanel&quot;,</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+  modes: {</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+    calendar: {</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+      type: &quot;calendar&quot;,</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+      maxTabs: 1,</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+      openTab: function(aTab, aTitle) {</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+        aTab.title = aTitle;</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+        ltnSwitch2Calendar();</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+      },</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+      showTab: function(aTab) {</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+        ltnSwitch2Calendar();</span>
<a href="#l10.78"></a><span id="l10.78">       }</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-      return toolbars;</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-    }</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+    },</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+    tasks: {</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+      type: &quot;tasks&quot;,</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+      maxTabs: 1,</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+      openTab: function(aTab, aTitle) {</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+        aTab.title = aTitle;</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+        ltnSwitch2Task();</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+      },</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+      showTab: function(aTab) {</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+        ltnSwitch2Task();</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+      }</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+    },</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+  },</span>
<a href="#l10.94"></a><span id="l10.94"> </span>
<a href="#l10.95"></a><span id="l10.95" class="difflineminus">-    var restoreToolbarProperties = function(toolbox,toolbars)</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-    {</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineminus">-      var toolbar = toolbox.firstChild;</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineminus">-      while (toolbar) {</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-        if (toolbar.localName == &quot;toolbar&quot;) {</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineminus">-          if (toolbar.getAttribute(&quot;customizable&quot;) == &quot;true&quot;) {</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineminus">-            if (!toolbar.hasAttribute(&quot;customindex&quot;)) {</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineminus">-              var propertybag = toolbars[toolbar.id];</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineminus">-              toolbar.firstPermanentChild = propertybag.firstPermanentChild;</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-              toolbar.lastPermanentChild = propertybag.lastPermanentChild;</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-            }</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-          }</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-        }</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineminus">-        toolbar = toolbar.nextSibling;</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-      }</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineminus">-    }</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+  /* because calendar does some direct menu manipulation, we need to change</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+   *  to the mail mode to clean up after those hacks.</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+   */</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+  saveTabState: function(aTab) {</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+    ltnSwitch2Mail();</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineplus">+  },</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+  closeTab: function(aTab) {</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+    ltnSwitch2Mail();</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+  },</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineplus">+};</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+window.addEventListener(&quot;load&quot;, function(e) { </span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+  document.getElementById('tabmail').registerTabType(calendarTabType); }, false);</span>
<a href="#l10.123"></a><span id="l10.123"> </span>
<a href="#l10.124"></a><span id="l10.124" class="difflineminus">-    // DOMAttrModified handler that listens on the toolbox element</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineminus">-    var onModified = function(aEvent) {</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineminus">-      if(aEvent.attrName == &quot;location&quot;) {</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineminus">-        var modeToolbox = document.getElementById(&quot;mode-toolbox&quot;);</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineminus">-        modeToolbox.removeEventListener(&quot;DOMAttrModified&quot;, onModified, false);</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineminus">-        var onLocationHandler = function() {</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineminus">-          var contentPanel = document.getElementById(&quot;contentPanel&quot;);</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-          var palette = modeToolbox.palette;</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineminus">-          var bag = retrieveToolbarProperties(modeToolbox);</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineminus">-          if(aEvent.newValue == &quot;top&quot; &amp;&amp; !aEvent.prevValue || aEvent.prevValue == &quot;bottom&quot;) {</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineminus">-            // place the mode toolbox at the top of the left pane</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineminus">-            modeToolbox = contentPanel.parentNode.insertBefore(modeToolbox, contentPanel);</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineminus">-          } else if(aEvent.newValue == &quot;bottom&quot; &amp;&amp; aEvent.prevValue == &quot;top&quot;) {</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineminus">-            // place the mode toolbox at the bottom of the left pane</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineminus">-            modeToolbox = contentPanel.parentNode.appendChild(modeToolbox);</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineminus">-          }</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineminus">-          restoreToolbarProperties(modeToolbox,bag);</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineminus">-          modeToolbox.addEventListener(&quot;DOMAttrModified&quot;, onModified, false);</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineminus">-          modeToolbox.palette = palette;</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineminus">-        }</span>
<a href="#l10.144"></a><span id="l10.144"> </span>
<a href="#l10.145"></a><span id="l10.145" class="difflineminus">-        setTimeout(onLocationHandler,1);</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineminus">-      }</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineminus">-    }</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineminus">-</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineminus">-    // install the handler that listens for modified 'location' attribute</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineminus">-    // on the toolbox. the value is changed by the toolbar customize dialog.</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineminus">-    var modeToolbox = document.getElementById(&quot;mode-toolbox&quot;);</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineminus">-    if(modeToolbox.getAttribute(&quot;location&quot;) != &quot;bottom&quot;) {</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineminus">-      var palette = modeToolbox.palette;</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineminus">-      var bag = retrieveToolbarProperties(modeToolbox);</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineminus">-      modeToolbox = contentPanel.parentNode.insertBefore(modeToolbox, contentPanel);</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineminus">-      modeToolbox.palette = palette;</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineminus">-      restoreToolbarProperties(modeToolbox,bag);</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineminus">-    }</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineminus">-    modeToolbox.addEventListener(&quot;DOMAttrModified&quot;, onModified, false);</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineminus">-</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineminus">-    // To make sure the folder pane doesn't disappear without any possibility</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineminus">-    // to get it back, we need to reveal it when the mode box is collapsed.</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineminus">-    function modeBoxAttrModified(event) {</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineminus">-        if (event.attrName == &quot;collapsed&quot;) {</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineminus">-            document.getElementById(&quot;folderPaneBox&quot;)</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineminus">-                    .removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineminus">-        }</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineminus">-    }</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineminus">-</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineminus">-    document.getElementById(&quot;ltnModeBox&quot;).addEventListener(&quot;DOMAttrModified&quot;,</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineminus">-                                                           modeBoxAttrModified,</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineminus">-                                                           true);</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineplus">+function ltnOnLoad(event) {</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineplus">+    document.getElementById(&quot;calendarDisplayDeck&quot;).</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineplus">+      addEventListener(&quot;select&quot;, LtnObserveDisplayDeckChange, true);</span>
<a href="#l10.176"></a><span id="l10.176"> </span>
<a href="#l10.177"></a><span id="l10.177">     // Take care of common initialization</span>
<a href="#l10.178"></a><span id="l10.178">     commonInitCalendar();</span>
<a href="#l10.179"></a><span id="l10.179"> </span>
<a href="#l10.180"></a><span id="l10.180">     // nuke the onload, or we get called every time there's</span>
<a href="#l10.181"></a><span id="l10.181">     // any load that occurs</span>
<a href="#l10.182"></a><span id="l10.182">     document.removeEventListener(&quot;load&quot;, ltnOnLoad, true);</span>
<a href="#l10.183"></a><span id="l10.183"> </span>
<a href="#l10.184"></a><span id="l10.184" class="difflineat">@@ -209,20 +143,27 @@ function ltnOnLoad(event) {</span>
<a href="#l10.185"></a><span id="l10.185"> </span>
<a href="#l10.186"></a><span id="l10.186">     // Add an unload function to the window so we don't leak any listeners</span>
<a href="#l10.187"></a><span id="l10.187">     window.addEventListener(&quot;unload&quot;, ltnFinish, false);</span>
<a href="#l10.188"></a><span id="l10.188"> </span>
<a href="#l10.189"></a><span id="l10.189">     // Set up invitations manager</span>
<a href="#l10.190"></a><span id="l10.190">     scheduleInvitationsUpdate(FIRST_DELAY_STARTUP);</span>
<a href="#l10.191"></a><span id="l10.191">     getCalendarManager().addObserver(gInvitationsCalendarManagerObserver);</span>
<a href="#l10.192"></a><span id="l10.192"> </span>
<a href="#l10.193"></a><span id="l10.193" class="difflineplus">+    // set up the calendar toolbox</span>
<a href="#l10.194"></a><span id="l10.194" class="difflineplus">+    var toolbox = document.getElementById(&quot;calendar-toolbox&quot;);</span>
<a href="#l10.195"></a><span id="l10.195" class="difflineplus">+    toolbox.customizeDone = function(aEvent) { MailToolboxCustomizeDone(aEvent, &quot;CustomizeMailToolbar&quot;); };</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineplus">+</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineplus">+    var toolbarset = document.getElementById('calendar-custom-toolbars');</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineplus">+    toolbox.toolbarset = toolbarset;</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineplus">+</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineplus">+</span>
<a href="#l10.201"></a><span id="l10.201">     var filter = document.getElementById(&quot;task-tree-filtergroup&quot;);</span>
<a href="#l10.202"></a><span id="l10.202">     filter.value = filter.value || &quot;all&quot;;</span>
<a href="#l10.203"></a><span id="l10.203">     document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineminus">-    ltnInitTodayPane();</span>
<a href="#l10.205"></a><span id="l10.205"> }</span>
<a href="#l10.206"></a><span id="l10.206"> </span>
<a href="#l10.207"></a><span id="l10.207"> /* Called at midnight to tell us to redraw date-specific widgets.  Do NOT call</span>
<a href="#l10.208"></a><span id="l10.208">  * this for normal refresh, since it also calls scheduleMidnightRefresh.</span>
<a href="#l10.209"></a><span id="l10.209">  */</span>
<a href="#l10.210"></a><span id="l10.210"> function refreshUIBits() {</span>
<a href="#l10.211"></a><span id="l10.211">     try {</span>
<a href="#l10.212"></a><span id="l10.212">         getMinimonth().refreshDisplay();</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineat">@@ -332,17 +273,17 @@ function ltnShowCalendarView(type)</span>
<a href="#l10.214"></a><span id="l10.214">  * - ltnSwitch2Calendar()</span>
<a href="#l10.215"></a><span id="l10.215">  * - ltnSwitch2Task()</span>
<a href="#l10.216"></a><span id="l10.216">  */</span>
<a href="#l10.217"></a><span id="l10.217"> function LtnObserveDisplayDeckChange(event) {</span>
<a href="#l10.218"></a><span id="l10.218">     var deck = event.target;</span>
<a href="#l10.219"></a><span id="l10.219"> </span>
<a href="#l10.220"></a><span id="l10.220">     // Bug 309505: The 'select' event also fires when we change the selected</span>
<a href="#l10.221"></a><span id="l10.221">     // panel of calendar-view-box.  Workaround with this check.</span>
<a href="#l10.222"></a><span id="l10.222" class="difflineminus">-    if (deck.id != &quot;displayDeck&quot;) {</span>
<a href="#l10.223"></a><span id="l10.223" class="difflineplus">+    if (deck.id != &quot;calendarDisplayDeck&quot;) {</span>
<a href="#l10.224"></a><span id="l10.224">         return;</span>
<a href="#l10.225"></a><span id="l10.225">     }</span>
<a href="#l10.226"></a><span id="l10.226"> </span>
<a href="#l10.227"></a><span id="l10.227">     var id = null;</span>
<a href="#l10.228"></a><span id="l10.228">     try { id = deck.selectedPanel.id } catch (e) { }</span>
<a href="#l10.229"></a><span id="l10.229"> </span>
<a href="#l10.230"></a><span id="l10.230">     // Switch back to mail mode in case we find that this</span>
<a href="#l10.231"></a><span id="l10.231">     // notification has been fired but we're still in calendar or task mode.</span>
<a href="#l10.232"></a><span id="l10.232" class="difflineat">@@ -375,24 +316,16 @@ function findMailSearchBox() {</span>
<a href="#l10.233"></a><span id="l10.233">         return tb2Box;</span>
<a href="#l10.234"></a><span id="l10.234">     }</span>
<a href="#l10.235"></a><span id="l10.235"> </span>
<a href="#l10.236"></a><span id="l10.236">     // In later versions, it's possible that a user removed the search box from</span>
<a href="#l10.237"></a><span id="l10.237">     // the toolbar.</span>
<a href="#l10.238"></a><span id="l10.238">     return null;</span>
<a href="#l10.239"></a><span id="l10.239"> }</span>
<a href="#l10.240"></a><span id="l10.240"> </span>
<a href="#l10.241"></a><span id="l10.241" class="difflineminus">-var gSelectFolder = SelectFolder;</span>
<a href="#l10.242"></a><span id="l10.242" class="difflineminus">-var gSelectMessage = SelectMessage;</span>
<a href="#l10.243"></a><span id="l10.243" class="difflineminus">-</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineminus">-SelectFolder = function(folderUri) {</span>
<a href="#l10.245"></a><span id="l10.245" class="difflineminus">-    document.getElementById(&quot;switch2mail&quot;).doCommand();</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineminus">-    gSelectFolder(folderUri);</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineminus">-}</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineminus">-</span>
<a href="#l10.249"></a><span id="l10.249"> var calendarpopuplist = new Array();</span>
<a href="#l10.250"></a><span id="l10.250"> var taskpopuplist = new Array();</span>
<a href="#l10.251"></a><span id="l10.251"> var mailpopuplist = new Array();</span>
<a href="#l10.252"></a><span id="l10.252"> var menulist = new Array();</span>
<a href="#l10.253"></a><span id="l10.253"> #ifdef XP_MACOSX</span>
<a href="#l10.254"></a><span id="l10.254">     var quitMenu = null;</span>
<a href="#l10.255"></a><span id="l10.255">     var prefMenu = null;</span>
<a href="#l10.256"></a><span id="l10.256"> #endif</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineat">@@ -403,19 +336,17 @@ function ltnInitializeMenus(){</span>
<a href="#l10.258"></a><span id="l10.258">     prefMenu = document.getElementById(&quot;menu_preferences&quot;);</span>
<a href="#l10.259"></a><span id="l10.259">     prefMenu.setAttribute(&quot;mode&quot;, &quot;system&quot;);</span>
<a href="#l10.260"></a><span id="l10.260">     quitMenu = document.getElementById(&quot;menu_FileQuitItem&quot;);</span>
<a href="#l10.261"></a><span id="l10.261">     quitMenu.setAttribute(&quot;mode&quot;, &quot;system&quot;);</span>
<a href="#l10.262"></a><span id="l10.262"> #endif</span>
<a href="#l10.263"></a><span id="l10.263">     copyPopupMenus();</span>
<a href="#l10.264"></a><span id="l10.264">     ltnRemoveMailOnlyItems(calendarpopuplist, &quot;calendar&quot;);</span>
<a href="#l10.265"></a><span id="l10.265">     ltnRemoveMailOnlyItems(taskpopuplist, &quot;task&quot;);</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineminus">-    var modeToolbar = document.getElementById(&quot;mode-toolbar&quot;);</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineminus">-    var visible = !modeToolbar.hasAttribute(&quot;collapsed&quot;);</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineminus">-    document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;checked&quot;, visible);</span>
<a href="#l10.269"></a><span id="l10.269" class="difflineplus">+    document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;checked&quot;, true);</span>
<a href="#l10.270"></a><span id="l10.270">     document.getElementById(&quot;calendar-toolbar&quot;).setAttribute(&quot;collapsed&quot;, gCurrentMode!=&quot;calendar&quot;);</span>
<a href="#l10.271"></a><span id="l10.271">     document.getElementById(&quot;task-toolbar&quot;).setAttribute(&quot;collapsed&quot;, gCurrentMode!=&quot;task&quot;);</span>
<a href="#l10.272"></a><span id="l10.272"> }</span>
<a href="#l10.273"></a><span id="l10.273"> </span>
<a href="#l10.274"></a><span id="l10.274"> function getMenuElementById(aElementId, aMenuPopup) {</span>
<a href="#l10.275"></a><span id="l10.275">         var element = null;</span>
<a href="#l10.276"></a><span id="l10.276">         var elements = aMenuPopup.getElementsByAttribute(&quot;id&quot;, aElementId);</span>
<a href="#l10.277"></a><span id="l10.277">         if (elements.length &gt; 0) {</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineat">@@ -735,24 +666,16 @@ function openInvitationsDialog() {</span>
<a href="#l10.279"></a><span id="l10.279">     gInvitationsCalendarManagerObserver.mCount = 0;</span>
<a href="#l10.280"></a><span id="l10.280">     getInvitationsManager().openInvitationsDialog(</span>
<a href="#l10.281"></a><span id="l10.281">         gInvitationsOperationListener,</span>
<a href="#l10.282"></a><span id="l10.282">         function oiD_callback() {</span>
<a href="#l10.283"></a><span id="l10.283">             scheduleInvitationsUpdate(FIRST_DELAY_RESCHEDULE);</span>
<a href="#l10.284"></a><span id="l10.284">         });</span>
<a href="#l10.285"></a><span id="l10.285"> }</span>
<a href="#l10.286"></a><span id="l10.286"> </span>
<a href="#l10.287"></a><span id="l10.287" class="difflineminus">-SelectMessage = function(messageUri) {</span>
<a href="#l10.288"></a><span id="l10.288" class="difflineminus">-    document.getElementById(&quot;switch2mail&quot;).doCommand();</span>
<a href="#l10.289"></a><span id="l10.289" class="difflineminus">-    gSelectMessage(messageUri);</span>
<a href="#l10.290"></a><span id="l10.290" class="difflineminus">-}</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineminus">-</span>
<a href="#l10.292"></a><span id="l10.292" class="difflineminus">-document.getElementById(&quot;displayDeck&quot;).</span>
<a href="#l10.293"></a><span id="l10.293" class="difflineminus">-    addEventListener(&quot;select&quot;, LtnObserveDisplayDeckChange, true);</span>
<a href="#l10.294"></a><span id="l10.294" class="difflineminus">-</span>
<a href="#l10.295"></a><span id="l10.295"> document.addEventListener(&quot;load&quot;, ltnOnLoad, true);</span>
<a href="#l10.296"></a><span id="l10.296"> </span>
<a href="#l10.297"></a><span id="l10.297"> /**</span>
<a href="#l10.298"></a><span id="l10.298">  * Sets up the message pane context menu. Even though the actual context menu</span>
<a href="#l10.299"></a><span id="l10.299">  * is in messenger-overlay-toolbar.xul, this needs to be in a file that</span>
<a href="#l10.300"></a><span id="l10.300">  * directly overlays messenger.xul or the functions will not be defined.</span>
<a href="#l10.301"></a><span id="l10.301">  */</span>
<a href="#l10.302"></a><span id="l10.302"> function calSetupMsgPaneContext() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.xul</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.xul</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -349,53 +349,51 @@</span>
<a href="#l11.4"></a><span id="l11.4">    &lt;menuitem id=&quot;ltnTaskToolbar&quot;</span>
<a href="#l11.5"></a><span id="l11.5">              type=&quot;checkbox&quot;</span>
<a href="#l11.6"></a><span id="l11.6">              label=&quot;&amp;task.toolbar.label;&quot;</span>
<a href="#l11.7"></a><span id="l11.7">              accesskey=&quot;&amp;task.toolbar.accesskey;&quot;</span>
<a href="#l11.8"></a><span id="l11.8">              mode=&quot;task&quot;</span>
<a href="#l11.9"></a><span id="l11.9">              command=&quot;cmd_toggleTaskToolbar&quot;</span>
<a href="#l11.10"></a><span id="l11.10">              observes=&quot;cmd_toggleTaskToolbar&quot;</span>
<a href="#l11.11"></a><span id="l11.11">              position=&quot;2&quot;/&gt;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-   &lt;menuitem id=&quot;ltnModeToolbar&quot;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-             type=&quot;checkbox&quot;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-             label=&quot;&amp;mode.toolbar.label;&quot;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-             accesskey=&quot;&amp;mode.toolbar.accesskey;&quot;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-             observes=&quot;modeBroadcaster&quot;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-             command=&quot;cmd_toggleModeToolbar&quot;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-             position=&quot;3&quot;/&gt;</span>
<a href="#l11.19"></a><span id="l11.19">   &lt;/menupopup&gt;</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21"> &lt;window id=&quot;messengerWindow&quot;&gt;</span>
<a href="#l11.22"></a><span id="l11.22"> </span>
<a href="#l11.23"></a><span id="l11.23">   &lt;broadcasterset id=&quot;calendar_broadcasters&quot;&gt;</span>
<a href="#l11.24"></a><span id="l11.24">     &lt;broadcaster id=&quot;filterBroadcaster&quot; value=&quot;all&quot;/&gt;</span>
<a href="#l11.25"></a><span id="l11.25">   &lt;/broadcasterset&gt;</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27">   &lt;!-- Be sure to keep these sets, since they will be overlayed by</span>
<a href="#l11.28"></a><span id="l11.28">        calendar/base/content/calendar-common-sets.xul --&gt;</span>
<a href="#l11.29"></a><span id="l11.29">   &lt;commandset id=&quot;calendar_commands&quot;&gt;</span>
<a href="#l11.30"></a><span id="l11.30">     &lt;command id=&quot;agenda_delete_event_command&quot; oncommand=&quot;agendaListbox.deleteSelectedItem(false);&quot;/&gt;</span>
<a href="#l11.31"></a><span id="l11.31">     &lt;command id=&quot;agenda_edit_event_command&quot; oncommand=&quot;agendaListbox.editSelectedItem(event);&quot;/&gt;</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-    &lt;command id=&quot;switch2mail&quot; checked=&quot;true&quot; oncommand=&quot;ltnSwitch2Mail()&quot;/&gt;</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-    &lt;command id=&quot;switch2calendar&quot; oncommand=&quot;ltnSwitch2Calendar()&quot;/&gt;</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-    &lt;command id=&quot;switch2task&quot; oncommand=&quot;ltnSwitch2Task()&quot;/&gt;</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-    &lt;command id=&quot;cmd_toggleTodayPane&quot; oncommand=&quot;toggleTodayPaneinMailMode()&quot;/&gt;</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-    &lt;command id=&quot;cmd_toggleModeToolbar&quot; oncommand=&quot;toggleToolbar('cmd_toggleModeToolbar', 'mode-toolbar')&quot;/&gt;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+    &lt;command id=&quot;switch2mail&quot; checked=&quot;true&quot;</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+      oncommand=&quot;document.getElementById('tabmail').selectTabByMode('folder')&quot;/&gt;</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+    &lt;command id=&quot;switch2calendar&quot;</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+      oncommand=&quot;document.getElementById('tabmail').openTab('calendar', document.getElementById('calendar-tab-button').getAttribute('tooltiptext'))&quot;/&gt;</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+    &lt;command id=&quot;switch2task&quot;</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+      oncommand=&quot;document.getElementById('tabmail').openTab('tasks', document.getElementById('task-tab-button').getAttribute('tooltiptext'))&quot;/&gt;</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+    &lt;command id=&quot;new_calendar_tab&quot;</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+      oncommand=&quot;document.getElementById('tabmail').openTab('calendar', document.getElementById('calendar-tab-button').getAttribute('tooltiptext'))&quot;/&gt;</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+    &lt;command id=&quot;new_task_tab&quot;</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+      oncommand=&quot;document.getElementById('tabmail').openTab('tasks', document.getElementById('task-tab-button').getAttribute('tooltiptext'))&quot;/&gt;</span>
<a href="#l11.47"></a><span id="l11.47">     &lt;command id=&quot;cmd_toggleCalendarToolbar&quot; oncommand=&quot;toggleControlinMode('cmd_toggleCalendarToolbar', 'calendar-toolbar')&quot;/&gt;</span>
<a href="#l11.48"></a><span id="l11.48">     &lt;command id=&quot;cmd_toggleTaskToolbar&quot; oncommand=&quot;toggleControlinMode('cmd_toggleTaskToolbar', 'task-toolbar')&quot;/&gt;</span>
<a href="#l11.49"></a><span id="l11.49">     &lt;command id=&quot;calendar-delete-command&quot; oncommand=&quot;ltnDeleteSelectedItem()&quot; disabledwhennoeventsselected=&quot;true&quot;/&gt;</span>
<a href="#l11.50"></a><span id="l11.50">     &lt;command id=&quot;calendar_new_todo_command&quot; oncommand=&quot;createTodoWithDialog(getSelectedCalendar());&quot;/&gt;</span>
<a href="#l11.51"></a><span id="l11.51"> </span>
<a href="#l11.52"></a><span id="l11.52">     &lt;command id=&quot;lightning_delete_item_command&quot; oncommand=&quot;goDoCommand('lightning_delete_item_command');&quot;/&gt;</span>
<a href="#l11.53"></a><span id="l11.53">     &lt;command id=&quot;lightning_modify_item_command&quot; oncommand=&quot;goDoCommand('lightning_modify_item_command');&quot;/&gt;</span>
<a href="#l11.54"></a><span id="l11.54">   &lt;/commandset&gt;</span>
<a href="#l11.55"></a><span id="l11.55"> </span>
<a href="#l11.56"></a><span id="l11.56">   &lt;keyset id=&quot;calendar-keys&quot;&gt;</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-    &lt;key id=&quot;openLightningKey&quot; modifiers=&quot;accel&quot; key=&quot;3&quot; observes=&quot;switch2calendar&quot;/&gt;</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-    &lt;key id=&quot;openTasksKey&quot; modifiers=&quot;accel&quot; key=&quot;4&quot; command=&quot;switch2task&quot;/&gt;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+    &lt;key id=&quot;openLightningKey&quot; modifiers=&quot;accel&quot; key=&quot;3&quot; observes=&quot;new_calendar_tab&quot;/&gt;</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+    &lt;key id=&quot;openTasksKey&quot; modifiers=&quot;accel&quot; key=&quot;4&quot; command=&quot;new_task_tab&quot;/&gt;</span>
<a href="#l11.61"></a><span id="l11.61">     &lt;key id=&quot;todaypanekey&quot; command=&quot;calendar_toggle_todaypane_command&quot; keycode=&quot;VK_F11&quot;/&gt;</span>
<a href="#l11.62"></a><span id="l11.62">     &lt;key id=&quot;calendar-new-event-key&quot; key=&quot;&amp;lightning.keys.event.new;&quot; modifiers=&quot;accel&quot; command=&quot;calendar_new_event_command&quot;/&gt;</span>
<a href="#l11.63"></a><span id="l11.63">     &lt;key id=&quot;calendar-new-todo-key&quot; key=&quot;&amp;lightning.keys.todo.new;&quot; modifiers=&quot;accel&quot; command=&quot;calendar_new_todo_command&quot;/&gt;</span>
<a href="#l11.64"></a><span id="l11.64">   &lt;/keyset&gt;</span>
<a href="#l11.65"></a><span id="l11.65"> </span>
<a href="#l11.66"></a><span id="l11.66">   &lt;popupset id=&quot;calendar-popupset&quot;&gt;</span>
<a href="#l11.67"></a><span id="l11.67">     &lt;menupopup id=&quot;calendar-GoPopupMenu&quot;&gt;</span>
<a href="#l11.68"></a><span id="l11.68">        &lt;menuitem id=&quot;ltnGoToToday&quot;</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineat">@@ -468,26 +466,30 @@</span>
<a href="#l11.70"></a><span id="l11.70">                  accesskey=&quot;&amp;calendar.properties.accesskey;&quot;</span>
<a href="#l11.71"></a><span id="l11.71">                  command=&quot;calendar_edit_calendar_command&quot;</span>
<a href="#l11.72"></a><span id="l11.72">                  observes=&quot;calendar_edit_calendar_command&quot;/&gt;</span>
<a href="#l11.73"></a><span id="l11.73">     &lt;/menupopup&gt;</span>
<a href="#l11.74"></a><span id="l11.74">   &lt;/popupset&gt;</span>
<a href="#l11.75"></a><span id="l11.75"> </span>
<a href="#l11.76"></a><span id="l11.76"> &lt;/window&gt;</span>
<a href="#l11.77"></a><span id="l11.77"> </span>
<a href="#l11.78"></a><span id="l11.78" class="difflineminus">-&lt;hbox id=&quot;messengerBox&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineminus">-</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineminus">-  &lt;!-- this will replace 'folderPaneBox' --&gt;</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineminus">-  &lt;vbox id=&quot;ltnModeBox&quot; insertbefore=&quot;folderPaneBox&quot; persist=&quot;collapsed width&quot;&gt;</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineminus">-</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineminus">-    &lt;deck id=&quot;contentPanel&quot; flex=&quot;1&quot; minwidth=&quot;100&quot; width=&quot;200&quot; persist=&quot;collapsed width&quot;&gt;</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineminus">-</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+&lt;box id=&quot;tabmail-buttons&quot;&gt;</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+  &lt;toolbarbutton id=&quot;calendar-tab-button&quot; command=&quot;new_calendar_tab&quot;</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+    tooltiptext=&quot;&amp;lightning.toolbar.calendar.label;&quot;/&gt;</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+  &lt;toolbarbutton id=&quot;task-tab-button&quot; command=&quot;new_task_tab&quot;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+    tooltiptext=&quot;&amp;lightning.toolbar.task.label;&quot;/&gt;</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+&lt;/box&gt;</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+&lt;tabpanels id=&quot;tabpanelcontainer&quot;&gt;</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+  &lt;vbox id=&quot;calendarTabPanel&quot; orientation=&quot;vertical&quot;&gt;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+    &lt;toolbox id=&quot;calendar-toolbox&quot; class=&quot;toolbox-top&quot;/&gt;</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+    &lt;box id=&quot;calendarContent&quot; orientation=&quot;horizontal&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l11.95"></a><span id="l11.95">       &lt;vbox id=&quot;ltnSidebar&quot;</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineminus">-            height=&quot;350&quot;</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineminus">-            persist=&quot;height&quot;</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineplus">+            minwidth=&quot;100&quot;</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+            width=&quot;200&quot;</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+            persist=&quot;collapsed width&quot;</span>
<a href="#l11.101"></a><span id="l11.101">             ondraggesture=&quot;nsDragAndDrop.startDrag(event, calendarViewDNDObserver);&quot;</span>
<a href="#l11.102"></a><span id="l11.102">             ondragover=&quot;nsDragAndDrop.dragOver(event, calendarViewDNDObserver);&quot;</span>
<a href="#l11.103"></a><span id="l11.103">             ondragdrop=&quot;nsDragAndDrop.drop(event, calendarViewDNDObserver);&quot;&gt;</span>
<a href="#l11.104"></a><span id="l11.104">         &lt;modevbox id=&quot;minimonth-pane&quot; mode=&quot;calendar,task&quot; broadcaster=&quot;modeBroadcaster&quot; refcontrol=&quot;calendar_toggle_minimonthpane_command&quot;&gt;</span>
<a href="#l11.105"></a><span id="l11.105">           &lt;vbox align=&quot;center&quot;&gt;</span>
<a href="#l11.106"></a><span id="l11.106">             &lt;hbox id=&quot;ltnMinimonthBox&quot;&gt;</span>
<a href="#l11.107"></a><span id="l11.107">               &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.108"></a><span id="l11.108">               &lt;minimonth id=&quot;ltnMinimonth&quot; onchange=&quot;ltnMinimonthPick(this);&quot; flex=&quot;2&quot;/&gt;</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineat">@@ -526,87 +528,35 @@</span>
<a href="#l11.110"></a><span id="l11.110">           &lt;modevbox id=&quot;calendar-list-pane&quot; flex=&quot;1&quot; mode=&quot;calendar,task&quot; broadcaster=&quot;modeBroadcaster&quot;</span>
<a href="#l11.111"></a><span id="l11.111">                     refcontrol=&quot;calendar_toggle_calendarlist_command&quot;&gt;</span>
<a href="#l11.112"></a><span id="l11.112">             &lt;treenode-checkbox id=&quot;calendar-list-header&quot;</span>
<a href="#l11.113"></a><span id="l11.113">                              checked=&quot;true&quot;</span>
<a href="#l11.114"></a><span id="l11.114">                              class=&quot;treenode-checkbox&quot;</span>
<a href="#l11.115"></a><span id="l11.115">                              label=&quot;&amp;calendar.list.header.label;&quot;/&gt;</span>
<a href="#l11.116"></a><span id="l11.116">             &lt;modevbox id=&quot;calendar-listtree-pane&quot; flex=&quot;1&quot; mode=&quot;calendar,task&quot; broadcaster=&quot;modeBroadcaster&quot;</span>
<a href="#l11.117"></a><span id="l11.117">                       refcontrol=&quot;calendar-list-header&quot;&gt;</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineminus">-              &lt;!-- This will be overlayed by calendar-calendars-list.xul --&gt;</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineplus">+              </span>
<a href="#l11.120"></a><span id="l11.120">               &lt;tree id=&quot;calendar-list-tree-widget&quot;  class=&quot;task-tree-subpane&quot;</span>
<a href="#l11.121"></a><span id="l11.121">                 flex=&quot;1&quot;/&gt;</span>
<a href="#l11.122"></a><span id="l11.122">             &lt;/modevbox&gt;</span>
<a href="#l11.123"></a><span id="l11.123">         &lt;/modevbox&gt;</span>
<a href="#l11.124"></a><span id="l11.124">         &lt;/vbox&gt;</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineminus">-    &lt;/deck&gt;</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineminus">-</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineminus">-    &lt;popup id=&quot;mode-toolbar-context-menu&quot;&gt;</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineminus">-      &lt;menuitem id=&quot;customize-mode-toolbar&quot;</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineminus">-                label=&quot;&amp;customizeToolbar.label;&quot;</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineminus">-                accesskey=&quot;&amp;customizeToolbar.accesskey;&quot;</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineminus">-                oncommand=&quot;CustomizeApplicationToolbar('mode-toolbox');&quot;/&gt;</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineminus">-    &lt;/popup&gt;</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineminus">-</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineminus">-    &lt;modehbox id=&quot;invitations-pane&quot; mode=&quot;mail,calendar,task&quot; </span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+        &lt;modehbox id=&quot;invitations-pane&quot; mode=&quot;calendar,task&quot;</span>
<a href="#l11.137"></a><span id="l11.137">               broadcaster=&quot;modeBroadcaster&quot; refcontrol=&quot;calendar_toggle_invitations_command&quot;&gt;</span>
<a href="#l11.138"></a><span id="l11.138">       &lt;label id=&quot;invitations&quot;</span>
<a href="#l11.139"></a><span id="l11.139">              class=&quot;text-link calendar-invitations-sidebar-label&quot;</span>
<a href="#l11.140"></a><span id="l11.140">              value=&quot;&amp;lightning.sidebar.invitations.label;&quot;</span>
<a href="#l11.141"></a><span id="l11.141">              onclick=&quot;openInvitationsDialog();&quot;/&gt;</span>
<a href="#l11.142"></a><span id="l11.142">       &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.143"></a><span id="l11.143">     &lt;/modehbox&gt;</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+  &lt;/vbox&gt;</span>
<a href="#l11.145"></a><span id="l11.145"> </span>
<a href="#l11.146"></a><span id="l11.146" class="difflineminus">-    &lt;toolbox id=&quot;mode-toolbox&quot; location=&quot;bottom&quot; mode=&quot;full&quot;&gt;</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineminus">-      &lt;toolbarpalette id=&quot;mode-toolbox-palette&quot;&gt;</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineminus">-        &lt;toolbarbutton class=&quot;toolbarbutton-2&quot;</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineminus">-                       mode=&quot;mode&quot;</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineminus">-                       id=&quot;mail-switch-button&quot;</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineminus">-                       label=&quot;&amp;lightning.toolbar.mail.label;&quot;</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineminus">-                       command=&quot;switch2mail&quot;</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineminus">-                       ondraggesture=&quot;nsDragAndDrop.startDrag(event, calendarMailButtonDNDObserver);&quot;</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineminus">-                       ondragover=&quot;nsDragAndDrop.dragOver(event, calendarMailButtonDNDObserver);&quot;</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineminus">-                       ondragdrop=&quot;nsDragAndDrop.drop(event, calendarMailButtonDNDObserver);&quot;/&gt;</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineminus">-        &lt;toolbarbutton class=&quot;toolbarbutton-2&quot;</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineminus">-                       mode=&quot;mode&quot;</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineminus">-                       id=&quot;calendar-switch-button&quot;</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineminus">-                       label=&quot;&amp;lightning.toolbar.calendar.label;&quot;</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineminus">-                       command=&quot;switch2calendar&quot;</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineminus">-                       ondraggesture=&quot;nsDragAndDrop.startDrag(event, calendarCalendarButtonDNDObserver);&quot;</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineminus">-                       ondragover=&quot;nsDragAndDrop.dragOver(event, calendarCalendarButtonDNDObserver);&quot;</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineminus">-                       ondragdrop=&quot;nsDragAndDrop.drop(event, calendarCalendarButtonDNDObserver);&quot;/&gt;</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineminus">-        &lt;toolbarbutton class=&quot;toolbarbutton-2&quot;</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineminus">-                       mode=&quot;mode&quot;</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineminus">-                       id=&quot;task-switch-button&quot;</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineminus">-                       label=&quot;&amp;lightning.toolbar.task.label;&quot;</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineminus">-                       command=&quot;switch2task&quot;</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineminus">-                       ondraggesture=&quot;nsDragAndDrop.startDrag(event, calendarTaskButtonDNDObserver);&quot;</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineminus">-                       ondragover=&quot;nsDragAndDrop.dragOver(event, calendarTaskButtonDNDObserver);&quot;</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineminus">-                       ondragdrop=&quot;nsDragAndDrop.drop(event, calendarTaskButtonDNDObserver);&quot;/&gt;</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineminus">-      &lt;/toolbarpalette&gt;</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineminus">-      &lt;toolbar id=&quot;mode-toolbar&quot;</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineminus">-               class=&quot;chromeclass-toolbar&quot;</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineminus">-               customizable=&quot;true&quot;</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineminus">-               defaultset=&quot;mail-switch-button,calendar-switch-button,task-switch-button,spring&quot;</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineminus">-               context=&quot;mode-toolbar-context-menu&quot;</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineminus">-               persist=&quot;collapsed&quot;/&gt;</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineminus">-      &lt;toolbarset id=&quot;custom-toolbars&quot;/&gt;</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineminus">-    &lt;/toolbox&gt;</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineminus">-</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineminus">-  &lt;/vbox&gt;</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineminus">-  &lt;splitter id=&quot;today-splitter&quot; collapse=&quot;after&quot; resizebefore=&quot;closest&quot; state=&quot;collapsed&quot;&gt;</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineminus">-      &lt;grippy/&gt;</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineminus">-  &lt;/splitter&gt;</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineminus">-  &lt;modevbox id=&quot;today-pane-panel&quot;</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineminus">-            addtoolbarbutton=&quot;true&quot;</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineminus">-            persist=&quot;width addtoolbarbutton&quot;/&gt;</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineminus">-&lt;/hbox&gt;</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineminus">-</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineminus">-&lt;deck id=&quot;displayDeck&quot;&gt;</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineplus">+      &lt;splitter id=&quot;calsidebar_splitter&quot; collapse=&quot;before&quot; persist=&quot;state&quot;/&gt;</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineplus">+      </span>
<a href="#l11.194"></a><span id="l11.194" class="difflineplus">+      &lt;deck id=&quot;calendarDisplayDeck&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l11.195"></a><span id="l11.195">   &lt;vbox id=&quot;calendar-view-box&quot; context=&quot;calendar-view-context-menu&quot;&gt;</span>
<a href="#l11.196"></a><span id="l11.196">     &lt;deck flex=&quot;1&quot;</span>
<a href="#l11.197"></a><span id="l11.197">           id=&quot;view-deck&quot;</span>
<a href="#l11.198"></a><span id="l11.198">           persist=&quot;selectedIndex&quot;</span>
<a href="#l11.199"></a><span id="l11.199">           ondraggesture=&quot;nsDragAndDrop.startDrag(event, calendarViewDNDObserver);&quot;</span>
<a href="#l11.200"></a><span id="l11.200">           ondragover=&quot;nsDragAndDrop.dragOver(event, calendarViewDNDObserver);&quot;</span>
<a href="#l11.201"></a><span id="l11.201">           ondragdrop=&quot;nsDragAndDrop.drop(event, calendarViewDNDObserver);&quot;&gt;</span>
<a href="#l11.202"></a><span id="l11.202">       &lt;calendar-decorated-day-view id=&quot;day-view&quot; flex=&quot;1&quot;</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineat">@@ -618,12 +568,21 @@</span>
<a href="#l11.204"></a><span id="l11.204">       &lt;calendar-decorated-multiweek-view id=&quot;multiweek-view&quot; flex=&quot;1&quot;</span>
<a href="#l11.205"></a><span id="l11.205">                                          context=&quot;calendar-view-context-menu&quot;</span>
<a href="#l11.206"></a><span id="l11.206">                                          item-context=&quot;calendar-item-context-menu&quot;/&gt;</span>
<a href="#l11.207"></a><span id="l11.207">       &lt;calendar-decorated-month-view id=&quot;month-view&quot; flex=&quot;1&quot;</span>
<a href="#l11.208"></a><span id="l11.208">                                          context=&quot;calendar-view-context-menu&quot;</span>
<a href="#l11.209"></a><span id="l11.209">                                          item-context=&quot;calendar-item-context-menu&quot;/&gt;</span>
<a href="#l11.210"></a><span id="l11.210">     &lt;/deck&gt;</span>
<a href="#l11.211"></a><span id="l11.211">   &lt;/vbox&gt;</span>
<a href="#l11.212"></a><span id="l11.212" class="difflineminus">-&lt;/deck&gt;</span>
<a href="#l11.213"></a><span id="l11.213" class="difflineplus">+      &lt;/deck&gt;</span>
<a href="#l11.214"></a><span id="l11.214"> </span>
<a href="#l11.215"></a><span id="l11.215" class="difflineminus">-&lt;vbox id=&quot;messagepanebox&quot;/&gt;</span>
<a href="#l11.216"></a><span id="l11.216" class="difflineplus">+      &lt;splitter id=&quot;today-splitter&quot; collapse=&quot;after&quot; resizebefore=&quot;closest&quot; state=&quot;collapsed&quot;&gt;</span>
<a href="#l11.217"></a><span id="l11.217" class="difflineplus">+          &lt;grippy/&gt;</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineplus">+      &lt;/splitter&gt;</span>
<a href="#l11.219"></a><span id="l11.219" class="difflineplus">+      &lt;modevbox id=&quot;today-pane-panel&quot;</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineplus">+                addtoolbarbutton=&quot;true&quot;</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineplus">+                persist=&quot;width addtoolbarbutton&quot;/&gt;</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineplus">+    &lt;/box&gt;</span>
<a href="#l11.223"></a><span id="l11.223" class="difflineplus">+  &lt;/vbox&gt;</span>
<a href="#l11.224"></a><span id="l11.224" class="difflineplus">+&lt;/tabpanels&gt;</span>
<a href="#l11.225"></a><span id="l11.225" class="difflineplus">+</span>
<a href="#l11.226"></a><span id="l11.226"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-toolbar.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-toolbar.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -46,242 +46,129 @@ var gCustomizeId;</span>
<a href="#l12.4"></a><span id="l12.4">  *  - 'mode'</span>
<a href="#l12.5"></a><span id="l12.5">  *  - 'mail'</span>
<a href="#l12.6"></a><span id="l12.6">  *  - 'calendar'</span>
<a href="#l12.7"></a><span id="l12.7">  *  - 'task'</span>
<a href="#l12.8"></a><span id="l12.8">  */</span>
<a href="#l12.9"></a><span id="l12.9"> var gCurrentMode = 'mail';</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> /**</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">- * Helper function to get the view deck in a neutral way, regardless of whether</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">- * we're in Thunderbird or SeaMonkey</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">- */</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-function getMailBar() {</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-  return document.getElementById(&quot;mail-bar2&quot;) ||</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-         document.getElementById(&quot;msgToolbar&quot;);</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-}</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-/**</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">- * Ensure that switching to the messenger window also switches to mail mode.</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">- * We probably should also catch this from other windows (compose, addressbook),</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">- * but for now we'll keep it here. This function overrides the toMessengerWindow</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">- * function in /mail/base/content/mailCore.js.</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">- */</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-var toMessengerWindow = function ltnToMessengerWindow() {</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-    var wm = Components.classes['@mozilla.org/appshell/window-mediator;1']</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-             .getService(Components.interfaces.nsIWindowMediator);</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-    var topWindow = wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-    if (topWindow) {</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-        var tomail = topWindow.document.getElementById(&quot;switch2mail&quot;);</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-        tomail.doCommand();</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-        topWindow.focus();</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-    } else {</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-        window.open(&quot;chrome://messenger/content/messenger.xul&quot;,</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-                    &quot;_blank&quot;,</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-                    &quot;chrome,extrachrome,menubar,resizable,scrollbars,status,toolbar&quot;);</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-    }</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-};</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-/**</span>
<a href="#l12.44"></a><span id="l12.44">  * ltnSwitch2Mail() switches to the mail mode</span>
<a href="#l12.45"></a><span id="l12.45">  */</span>
<a href="#l12.46"></a><span id="l12.46"> </span>
<a href="#l12.47"></a><span id="l12.47"> function ltnSwitch2Mail() {</span>
<a href="#l12.48"></a><span id="l12.48">   if (gCurrentMode != 'mail') {</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-</span>
<a href="#l12.50"></a><span id="l12.50">     var switch2mail = document.getElementById(&quot;switch2mail&quot;);</span>
<a href="#l12.51"></a><span id="l12.51">     var switch2calendar = document.getElementById(&quot;switch2calendar&quot;);</span>
<a href="#l12.52"></a><span id="l12.52">     var switch2task = document.getElementById(&quot;switch2task&quot;);</span>
<a href="#l12.53"></a><span id="l12.53">     switch2mail.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l12.54"></a><span id="l12.54">     switch2calendar.removeAttribute(&quot;checked&quot;);</span>
<a href="#l12.55"></a><span id="l12.55">     switch2task.removeAttribute(&quot;checked&quot;);</span>
<a href="#l12.56"></a><span id="l12.56"> </span>
<a href="#l12.57"></a><span id="l12.57">     gCurrentMode = 'mail';</span>
<a href="#l12.58"></a><span id="l12.58">     swapPopupMenus();</span>
<a href="#l12.59"></a><span id="l12.59">     document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l12.60"></a><span id="l12.60"> </span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-    var mailToolbarMenuItem = document.getElementById(&quot;menu_showMessengerToolbar&quot;);</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-    if (mailToolbarMenuItem) {</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineminus">-        if (mailToolbarMenuItem.getAttribute(&quot;checked&quot;) == &quot;true&quot;) {</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-            getMailBar().removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-        }</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-    } else {</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-        // Bug 440700: Corresponding toolbar menu entry is currently not</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-        // accessible in Thunderbird Trunk -&gt; always restore the toolbar</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-        getMailBar().removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-    }</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-    var calendarToolbar = document.getElementById(&quot;calendar-toolbar&quot;);</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-    calendarToolbar.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-    var calendarToolbar = document.getElementById(&quot;task-toolbar&quot;);</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-    calendarToolbar.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-    // the content panel should display the folder tree</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-    var contentDeck = document.getElementById(&quot;contentPanel&quot;);</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-    contentDeck.selectedPanel = document.getElementById(&quot;folderPaneBox&quot;);</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-    // display the mail panel on the display deck</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-    var viewBox = document.getElementById(&quot;calendar-view-box&quot;);</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-    collapseElement(viewBox);</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-    // tell thunderbird that it needs to refresh the mail list.</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-    // basically, we fake a selection change by directly calling</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-    // the appropriate handler while clearing out some internal</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineminus">-    // variables in order to force a refresh of the mail views.</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineminus">-    gMsgFolderSelected = null;</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-    msgWindow.openFolder = null;</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-    ShowThreadPane();</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-    FolderPaneSelectionChange();</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-    document.commandDispatcher.updateCommands('mail-toolbar');</span>
<a href="#l12.96"></a><span id="l12.96">     document.commandDispatcher.updateCommands('calendar_commands');</span>
<a href="#l12.97"></a><span id="l12.97"> </span>
<a href="#l12.98"></a><span id="l12.98">     // Disable the rotate view menuitem</span>
<a href="#l12.99"></a><span id="l12.99">     document.getElementById(&quot;calendar_toggle_orientation_command&quot;)</span>
<a href="#l12.100"></a><span id="l12.100">             .setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l12.101"></a><span id="l12.101">     window.setCursor(&quot;auto&quot;);</span>
<a href="#l12.102"></a><span id="l12.102">   }</span>
<a href="#l12.103"></a><span id="l12.103"> }</span>
<a href="#l12.104"></a><span id="l12.104"> </span>
<a href="#l12.105"></a><span id="l12.105"> /**</span>
<a href="#l12.106"></a><span id="l12.106">  * ltnSwitch2Calendar() switches to the calendar mode</span>
<a href="#l12.107"></a><span id="l12.107">  */</span>
<a href="#l12.108"></a><span id="l12.108"> </span>
<a href="#l12.109"></a><span id="l12.109"> function ltnSwitch2Calendar() {</span>
<a href="#l12.110"></a><span id="l12.110">   if (gCurrentMode != 'calendar') {</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineminus">-</span>
<a href="#l12.112"></a><span id="l12.112">     var switch2mail = document.getElementById(&quot;switch2mail&quot;);</span>
<a href="#l12.113"></a><span id="l12.113">     var switch2calendar = document.getElementById(&quot;switch2calendar&quot;);</span>
<a href="#l12.114"></a><span id="l12.114">     var switch2task = document.getElementById(&quot;switch2task&quot;);</span>
<a href="#l12.115"></a><span id="l12.115">     switch2mail.removeAttribute(&quot;checked&quot;);</span>
<a href="#l12.116"></a><span id="l12.116">     switch2calendar.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l12.117"></a><span id="l12.117">     switch2task.removeAttribute(&quot;checked&quot;);</span>
<a href="#l12.118"></a><span id="l12.118"> </span>
<a href="#l12.119"></a><span id="l12.119">     gCurrentMode = 'calendar';    </span>
<a href="#l12.120"></a><span id="l12.120">     swapPopupMenus();</span>
<a href="#l12.121"></a><span id="l12.121">     document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);    </span>
<a href="#l12.122"></a><span id="l12.122"> </span>
<a href="#l12.123"></a><span id="l12.123" class="difflineminus">-    var mailToolbar = getMailBar();</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineminus">-    mailToolbar.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineminus">-</span>
<a href="#l12.126"></a><span id="l12.126">     toggleControlDisplay(&quot;cmd_toggleCalendarToolbar&quot;, &quot;calendar-toolbar&quot;, &quot;calendar&quot;);</span>
<a href="#l12.127"></a><span id="l12.127">     toggleControlDisplay(&quot;cmd_toggleTaskToolbar&quot;, &quot;task-toolbar&quot;, &quot;task&quot;);</span>
<a href="#l12.128"></a><span id="l12.128">     var taskToolbar = document.getElementById(&quot;task-toolbar&quot;);</span>
<a href="#l12.129"></a><span id="l12.129">     taskToolbar.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l12.130"></a><span id="l12.130"> </span>
<a href="#l12.131"></a><span id="l12.131" class="difflineminus">-</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineminus">-    // the content deck should display the calendar panel</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineminus">-    var contentDeck = document.getElementById(&quot;contentPanel&quot;);</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineminus">-    contentDeck.selectedPanel = document.getElementById(&quot;ltnSidebar&quot;);</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineminus">-</span>
<a href="#l12.136"></a><span id="l12.136">     // display the calendar panel on the display deck</span>
<a href="#l12.137"></a><span id="l12.137">     var viewBox = document.getElementById(&quot;calendar-view-box&quot;);</span>
<a href="#l12.138"></a><span id="l12.138">     uncollapseElement(viewBox);</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineminus">-    var deck = document.getElementById(&quot;displayDeck&quot;);</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineplus">+    var deck = document.getElementById(&quot;calendarDisplayDeck&quot;);</span>
<a href="#l12.141"></a><span id="l12.141">     deck.selectedPanel = viewBox;</span>
<a href="#l12.142"></a><span id="l12.142"> </span>
<a href="#l12.143"></a><span id="l12.143">     // show the last displayed type of calendar view</span>
<a href="#l12.144"></a><span id="l12.144">     showCalendarView(gLastShownCalendarView);</span>
<a href="#l12.145"></a><span id="l12.145"> </span>
<a href="#l12.146"></a><span id="l12.146" class="difflineminus">-    document.commandDispatcher.updateCommands('mail-toolbar');</span>
<a href="#l12.147"></a><span id="l12.147">     document.commandDispatcher.updateCommands('calendar_commands');</span>
<a href="#l12.148"></a><span id="l12.148"> </span>
<a href="#l12.149"></a><span id="l12.149">     window.setCursor(&quot;auto&quot;);</span>
<a href="#l12.150"></a><span id="l12.150">   }</span>
<a href="#l12.151"></a><span id="l12.151"> }</span>
<a href="#l12.152"></a><span id="l12.152"> </span>
<a href="#l12.153"></a><span id="l12.153"> /**</span>
<a href="#l12.154"></a><span id="l12.154">  * ltnSwitch2Task() switches to the task mode</span>
<a href="#l12.155"></a><span id="l12.155">  */</span>
<a href="#l12.156"></a><span id="l12.156"> </span>
<a href="#l12.157"></a><span id="l12.157"> function ltnSwitch2Task() {</span>
<a href="#l12.158"></a><span id="l12.158">   if (gCurrentMode != 'task') {</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineminus">-</span>
<a href="#l12.160"></a><span id="l12.160">     var switch2mail = document.getElementById(&quot;switch2mail&quot;);</span>
<a href="#l12.161"></a><span id="l12.161">     var switch2calendar = document.getElementById(&quot;switch2calendar&quot;);</span>
<a href="#l12.162"></a><span id="l12.162">     var switch2task = document.getElementById(&quot;switch2task&quot;);</span>
<a href="#l12.163"></a><span id="l12.163">     switch2mail.removeAttribute(&quot;checked&quot;);</span>
<a href="#l12.164"></a><span id="l12.164">     switch2calendar.removeAttribute(&quot;checked&quot;);</span>
<a href="#l12.165"></a><span id="l12.165">     switch2task.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineplus">+</span>
<a href="#l12.167"></a><span id="l12.167">     toggleControlDisplay(&quot;cmd_toggleCalendarToolbar&quot;, &quot;calendar-toolbar&quot;, &quot;calendar&quot;);</span>
<a href="#l12.168"></a><span id="l12.168">     toggleControlDisplay(&quot;cmd_toggleTaskToolbar&quot;, &quot;task-toolbar&quot;, &quot;task&quot;);</span>
<a href="#l12.169"></a><span id="l12.169">     gCurrentMode = 'task';</span>
<a href="#l12.170"></a><span id="l12.170">     swapPopupMenus();</span>
<a href="#l12.171"></a><span id="l12.171">     document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);    </span>
<a href="#l12.172"></a><span id="l12.172" class="difflineminus">-    var mailToolbar = getMailBar();</span>
<a href="#l12.173"></a><span id="l12.173">     var calendarToolbar = document.getElementById(&quot;calendar-toolbar&quot;);</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineminus">-    mailToolbar.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l12.175"></a><span id="l12.175">     calendarToolbar.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l12.176"></a><span id="l12.176"> </span>
<a href="#l12.177"></a><span id="l12.177" class="difflineminus">-    // the content deck should display the calendar panel</span>
<a href="#l12.178"></a><span id="l12.178" class="difflineminus">-    var contentDeck = document.getElementById(&quot;contentPanel&quot;);</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineminus">-    contentDeck.selectedPanel = document.getElementById(&quot;ltnSidebar&quot;);</span>
<a href="#l12.180"></a><span id="l12.180" class="difflineminus">-</span>
<a href="#l12.181"></a><span id="l12.181">     // display the task panel on the display deck</span>
<a href="#l12.182"></a><span id="l12.182">     var taskBox = document.getElementById(&quot;calendar-task-box&quot;);</span>
<a href="#l12.183"></a><span id="l12.183">     uncollapseElement(taskBox);</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineminus">-    var deck = document.getElementById(&quot;displayDeck&quot;);</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineplus">+    var deck = document.getElementById(&quot;calendarDisplayDeck&quot;);</span>
<a href="#l12.186"></a><span id="l12.186">     deck.selectedPanel = taskBox;</span>
<a href="#l12.187"></a><span id="l12.187"> </span>
<a href="#l12.188"></a><span id="l12.188" class="difflineminus">-    // change title to &quot;Tasks&quot;</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineminus">-    document.title = ltnGetString(&quot;lightning&quot;, &quot;taskModeApplicationTitle&quot;) + &quot; - &quot; + </span>
<a href="#l12.190"></a><span id="l12.190" class="difflineminus">-                     calGetString(&quot;brand&quot;, &quot;brandShortName&quot;, null, &quot;branding&quot;);</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineminus">-</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineminus">-    document.commandDispatcher.updateCommands('mail-toolbar');</span>
<a href="#l12.193"></a><span id="l12.193">     document.commandDispatcher.updateCommands('calendar_commands');</span>
<a href="#l12.194"></a><span id="l12.194"> </span>
<a href="#l12.195"></a><span id="l12.195">     window.setCursor(&quot;auto&quot;);</span>
<a href="#l12.196"></a><span id="l12.196">   }</span>
<a href="#l12.197"></a><span id="l12.197"> }</span>
<a href="#l12.198"></a><span id="l12.198"> </span>
<a href="#l12.199"></a><span id="l12.199"> /**</span>
<a href="#l12.200"></a><span id="l12.200">  * CustomizeApplicationToolbar() is called to customize one of the toolbars.</span>
<a href="#l12.201"></a><span id="l12.201">  * the appropriate identifier is passed as argument to the function.</span>
<a href="#l12.202"></a><span id="l12.202">  */</span>
<a href="#l12.203"></a><span id="l12.203"> </span>
<a href="#l12.204"></a><span id="l12.204"> // this shadows CustomizeMailToolbar from mail/base/content/mailCore.js</span>
<a href="#l12.205"></a><span id="l12.205"> // but adds the specific bits and pieces for lightning.</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineminus">-function CustomizeApplicationToolbar(id) {</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineplus">+function CustomizeCalendarToolbar(id) {</span>
<a href="#l12.208"></a><span id="l12.208">   // the following code operates different whether</span>
<a href="#l12.209"></a><span id="l12.209">   // or not we're actually customizing the mode toolbar or</span>
<a href="#l12.210"></a><span id="l12.210">   // any other toolbar.</span>
<a href="#l12.211"></a><span id="l12.211">   gCustomizeId = id;</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineminus">-  var isModeToolbox = (id == 'mode-toolbox');</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineminus">-  var modeName = isModeToolbox ? 'mode' : gCurrentMode;</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineplus">+  var modeName = gCurrentMode;</span>
<a href="#l12.215"></a><span id="l12.215"> </span>
<a href="#l12.216"></a><span id="l12.216">   // retrieve the toolbars from the tree</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineminus">-  var mailbar = getMailBar();</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineminus">-  var menubar = document.getElementById('mail-menubar');</span>
<a href="#l12.219"></a><span id="l12.219" class="difflineplus">+  var calendarbox = document.getElementById('calendar-toolbox');</span>
<a href="#l12.220"></a><span id="l12.220">   var calendarbar = document.getElementById('calendar-toolbar');</span>
<a href="#l12.221"></a><span id="l12.221">   var taskbar = document.getElementById('task-toolbar');</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineminus">-  var mailbox = document.getElementById(&quot;mail-toolbox&quot;);</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineminus">-  var modebar = document.getElementById('mode-toolbar');</span>
<a href="#l12.224"></a><span id="l12.224" class="difflineminus">-  var modebox = document.getElementById('mode-toolbox');</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineminus">-</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineminus">-  // install the callback that handles what needs to be</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineminus">-  // done after a toolbar has been customized.</span>
<a href="#l12.228"></a><span id="l12.228" class="difflineminus">-  if (modebox) {</span>
<a href="#l12.229"></a><span id="l12.229" class="difflineminus">-    mailbox.customizeDone = ModeToolboxCustomizeDone;</span>
<a href="#l12.230"></a><span id="l12.230" class="difflineminus">-    modebox.customizeDone = ModeToolboxCustomizeDone;</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineminus">-</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineminus">-    // disable elements on the toolbars</span>
<a href="#l12.233"></a><span id="l12.233" class="difflineminus">-    if (isModeToolbox) {</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineminus">-      EnableDisableHierarchy(menubar, true);</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineminus">-      EnableDisableHierarchy(mailbar, true);</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineminus">-      EnableDisableHierarchy(calendarbar, true);</span>
<a href="#l12.237"></a><span id="l12.237" class="difflineminus">-      EnableDisableHierarchy(taskbar, true);</span>
<a href="#l12.238"></a><span id="l12.238" class="difflineminus">-    } else {</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineminus">-      EnableDisableHierarchy(modebar, true);</span>
<a href="#l12.240"></a><span id="l12.240" class="difflineminus">-    }</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineminus">-  } else {</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineminus">-    modeName = null;</span>
<a href="#l12.243"></a><span id="l12.243" class="difflineminus">-  }</span>
<a href="#l12.244"></a><span id="l12.244"> </span>
<a href="#l12.245"></a><span id="l12.245">   var customizePopup = document.getElementById(&quot;CustomizeMailToolbar&quot;);</span>
<a href="#l12.246"></a><span id="l12.246">   customizePopup.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l12.247"></a><span id="l12.247"> </span>
<a href="#l12.248"></a><span id="l12.248">   var wintype = document.documentElement.getAttribute(&quot;windowtype&quot;);</span>
<a href="#l12.249"></a><span id="l12.249">   wintype = wintype.replace(/:/g, &quot;&quot;);</span>
<a href="#l12.250"></a><span id="l12.250"> </span>
<a href="#l12.251"></a><span id="l12.251">   // lightning install a new dropdown list in the customize dialog</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineat">@@ -291,25 +178,22 @@ function CustomizeApplicationToolbar(id)</span>
<a href="#l12.253"></a><span id="l12.253">   // &quot;calendar&quot; or &quot;task&quot;.</span>
<a href="#l12.254"></a><span id="l12.254">   var onModeSwitch = function switchHandler(aMode) {</span>
<a href="#l12.255"></a><span id="l12.255"> </span>
<a href="#l12.256"></a><span id="l12.256">     // assume that we're switching to the mode toolbar</span>
<a href="#l12.257"></a><span id="l12.257">     var toolbox = 'mode-toolbox';</span>
<a href="#l12.258"></a><span id="l12.258"> </span>
<a href="#l12.259"></a><span id="l12.259">     // check which toolbar is to be customized next</span>
<a href="#l12.260"></a><span id="l12.260">     // and possibly switch the the appropriate mode.</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineminus">-    if(aMode == 'mail') {</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineminus">-      ltnSwitch2Mail();</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineminus">-      toolbox = 'mail-toolbox';</span>
<a href="#l12.264"></a><span id="l12.264" class="difflineminus">-    } else if(aMode == 'calendar') {</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineplus">+    if (aMode == 'calendar') {</span>
<a href="#l12.266"></a><span id="l12.266">       ltnSwitch2Calendar();</span>
<a href="#l12.267"></a><span id="l12.267" class="difflineminus">-      toolbox = 'mail-toolbox';</span>
<a href="#l12.268"></a><span id="l12.268" class="difflineplus">+      toolbox = 'calendar-toolbox';</span>
<a href="#l12.269"></a><span id="l12.269">     } else if(aMode == 'task') {</span>
<a href="#l12.270"></a><span id="l12.270">       ltnSwitch2Task();</span>
<a href="#l12.271"></a><span id="l12.271" class="difflineminus">-      toolbox = 'mail-toolbox';</span>
<a href="#l12.272"></a><span id="l12.272" class="difflineplus">+      toolbox = 'calendar-toolbox';</span>
<a href="#l12.273"></a><span id="l12.273">     }</span>
<a href="#l12.274"></a><span id="l12.274"> </span>
<a href="#l12.275"></a><span id="l12.275">     // enable/disable all toolbar to reflect the new state</span>
<a href="#l12.276"></a><span id="l12.276">     var isMode = (aMode == 'mode');</span>
<a href="#l12.277"></a><span id="l12.277">     EnableDisableHierarchy(modebar, !isMode);</span>
<a href="#l12.278"></a><span id="l12.278">     EnableDisableHierarchy(menubar, isMode);</span>
<a href="#l12.279"></a><span id="l12.279">     EnableDisableHierarchy(mailbar, isMode);</span>
<a href="#l12.280"></a><span id="l12.280">     EnableDisableHierarchy(calendarbar, isMode);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-toolbar.xul</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-toolbar.xul</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -93,42 +93,48 @@</span>
<a href="#l13.4"></a><span id="l13.4">         &lt;menuitem id=&quot;threadPaneContext-calendar-convert-task-menuitem&quot;</span>
<a href="#l13.5"></a><span id="l13.5">                   label=&quot;&amp;calendar.context.convertmenu.task.label;&quot;</span>
<a href="#l13.6"></a><span id="l13.6">                   accesskey=&quot;&amp;calendar.context.convertmenu.task.accesskey;&quot;</span>
<a href="#l13.7"></a><span id="l13.7">                   oncommand=&quot;calendarTaskButtonDNDObserver.onDropMessage(messenger.msgHdrFromURI(GetFirstSelectedMessage()))&quot;/&gt;</span>
<a href="#l13.8"></a><span id="l13.8">       &lt;/menupopup&gt;</span>
<a href="#l13.9"></a><span id="l13.9">     &lt;/menu&gt;</span>
<a href="#l13.10"></a><span id="l13.10">   &lt;/popup&gt;</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  &lt;menuitem id=&quot;menu_customizeToolbar&quot;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  &lt;window id=&quot;messengerWindow&quot;&gt;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+    &lt;popup id=&quot;calendar-toolbar-context-menu&quot;</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+           onpopupshowing=&quot;onViewToolbarsPopupShowing(event, 'calendar-toolbox');&quot;&gt;</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+      &lt;menuitem id=&quot;CustomizeCalendarToolbar&quot;</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+                oncommand=&quot;CustomizeMailToolbar('calendar-toolbox', 'CustomizeMailToolbar');&quot;</span>
<a href="#l13.18"></a><span id="l13.18">             label=&quot;&amp;customizeToolbar.label;&quot;</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-            accesskey=&quot;&amp;customizeToolbar.accesskey;&quot;</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-            oncommand=&quot;CustomizeApplicationToolbar('mail-toolbox');&quot;/&gt;</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+                accesskey=&quot;&amp;customizeToolbar.accesskey;&quot;/&gt;</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+    &lt;/popup&gt;</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+  &lt;/window&gt;</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-  &lt;toolbarpalette id=&quot;MailToolbarPalette&quot;&gt;</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-&lt;!-- All toolbar buttons that messenger-overlay-toolbar.xul wishes to include</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+  &lt;toolbox id=&quot;calendar-toolbox&quot;&gt;</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+    &lt;toolbarpalette id=&quot;CalendarToolbarPalette&quot;&gt;</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+  &lt;!-- All toolbar buttons that messenger-overlay-toolbar.xul wishes to include</span>
<a href="#l13.30"></a><span id="l13.30">      *must* go either into the calendar-toolbar.inc file (all toolbar buttons</span>
<a href="#l13.31"></a><span id="l13.31">      shared with Sunbird) or lightning-toolbar.inc file (toolbar buttons</span>
<a href="#l13.32"></a><span id="l13.32">      relevant only for Lightning). --&gt;</span>
<a href="#l13.33"></a><span id="l13.33"> #include ../../base/content/calendar-toolbar.inc</span>
<a href="#l13.34"></a><span id="l13.34"> #include lightning-toolbar.inc</span>
<a href="#l13.35"></a><span id="l13.35">   &lt;/toolbarpalette&gt;</span>
<a href="#l13.36"></a><span id="l13.36">   </span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-  &lt;toolbox id=&quot;mail-toolbox&quot;&gt;</span>
<a href="#l13.38"></a><span id="l13.38">     &lt;toolbar id=&quot;calendar-toolbar&quot;</span>
<a href="#l13.39"></a><span id="l13.39">              class=&quot;chromeclass-toolbar&quot;</span>
<a href="#l13.40"></a><span id="l13.40">              customizable=&quot;true&quot;</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-             context=&quot;toolbar-context-menu&quot;</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+             context=&quot;calendar-toolbar-context-menu&quot;</span>
<a href="#l13.43"></a><span id="l13.43">              collapsed=&quot;true&quot;</span>
<a href="#l13.44"></a><span id="l13.44">              collapsedinMode=&quot;false&quot;</span>
<a href="#l13.45"></a><span id="l13.45">              defaultset=&quot;calendar-new-event-button,calendar-new-task-button,calendar-show-todaypane-button,separator,calendar-go-to-today-button,separator,calendar-day-view-button,calendar-week-view-button,calendar-multiweek-view-button,calendar-month-view-button,separator,calendar-unifinder-button,separator,calendar-delete-button,calendar-print-button,separator,calendar-remote-reload-button,spring&quot;</span>
<a href="#l13.46"></a><span id="l13.46">              persist=&quot;collapsedinMode&quot;/&gt;</span>
<a href="#l13.47"></a><span id="l13.47">     &lt;toolbar id=&quot;task-toolbar&quot;</span>
<a href="#l13.48"></a><span id="l13.48">              class=&quot;chromeclass-toolbar&quot;</span>
<a href="#l13.49"></a><span id="l13.49">              customizable=&quot;true&quot;</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-             context=&quot;toolbar-context-menu&quot;</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+             context=&quot;calendar-toolbar-context-menu&quot;</span>
<a href="#l13.52"></a><span id="l13.52">              collapsed=&quot;true&quot;</span>
<a href="#l13.53"></a><span id="l13.53">              collapsedinMode=&quot;false&quot;</span>
<a href="#l13.54"></a><span id="l13.54">              defaultset=&quot;task-new-event-button,task-new-task-button,task-button-address,task-show-todaypane-button,separator,task-category-button,task-progress-button,task-priority-button,separator,task-delete-button,task-print-button,separator,task-remote-reload-button,spring&quot;</span>
<a href="#l13.55"></a><span id="l13.55">              persist=&quot;collapsedinMode&quot;/&gt;</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+    &lt;toolbarset id=&quot;calendar-custom-toolbars&quot;/&gt;</span>
<a href="#l13.57"></a><span id="l13.57">   &lt;/toolbox&gt;</span>
<a href="#l13.58"></a><span id="l13.58"> </span>
<a href="#l13.59"></a><span id="l13.59"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/lightning/jar.mn</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/lightning/jar.mn</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -11,37 +11,33 @@ lightning.jar:</span>
<a href="#l14.4"></a><span id="l14.4"> % overlay chrome://lightning/content/messenger-overlay-sidebar.xul chrome://lightning/content/imip-bar-overlay.xul</span>
<a href="#l14.5"></a><span id="l14.5"> % overlay chrome://messenger/content/preferences/preferences.xul chrome://lightning/content/messenger-overlay-preferences.xul</span>
<a href="#l14.6"></a><span id="l14.6"> % overlay chrome://messenger/content/preferences/preferences.xul chrome://calendar/content/preferences/alarms.xul</span>
<a href="#l14.7"></a><span id="l14.7"> % overlay chrome://messenger/content/preferences/preferences.xul chrome://calendar/content/preferences/categories.xul</span>
<a href="#l14.8"></a><span id="l14.8"> % overlay chrome://messenger/content/preferences/preferences.xul chrome://calendar/content/preferences/general.xul</span>
<a href="#l14.9"></a><span id="l14.9"> % overlay chrome://messenger/content/preferences/preferences.xul chrome://calendar/content/preferences/timezones.xul</span>
<a href="#l14.10"></a><span id="l14.10"> % overlay chrome://messenger/content/preferences/preferences.xul chrome://calendar/content/preferences/views.xul</span>
<a href="#l14.11"></a><span id="l14.11"> % overlay chrome://messenger/content/mailWindowOverlay.xul chrome://lightning/content/messenger-overlay-toolbar.xul</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-% overlay chrome://global/content/customizeToolbar.xul chrome://lightning/content/customize-toolbar.xul</span>
<a href="#l14.13"></a><span id="l14.13"> % overlay chrome://lightning/content/messenger-overlay-sidebar.xul chrome://calendar/content/calendar-unifinder.xul</span>
<a href="#l14.14"></a><span id="l14.14"> % overlay chrome://lightning/content/messenger-overlay-sidebar.xul chrome://calendar/content/calendar-unifinder-todo.xul</span>
<a href="#l14.15"></a><span id="l14.15"> % overlay chrome://lightning/content/messenger-overlay-sidebar.xul chrome://calendar/content/calendar-task-view.xul</span>
<a href="#l14.16"></a><span id="l14.16"> % overlay chrome://lightning/content/messenger-overlay-sidebar.xul chrome://calendar/content/today-pane.xul</span>
<a href="#l14.17"></a><span id="l14.17"> % overlay chrome://lightning/content/lightning-standalone.xul chrome://lightning/content/messenger-overlay-sidebar.xul</span>
<a href="#l14.18"></a><span id="l14.18"> % overlay chrome://global/content/customizeToolbar.xul chrome://lightning/content/toolkit-overlay-custombar.xul</span>
<a href="#l14.19"></a><span id="l14.19"> % overlay chrome://calendar/content/calendarCreation.xul chrome://lightning/content/lightning-calendar-creation.xul</span>
<a href="#l14.20"></a><span id="l14.20"> % overlay chrome://calendar/content/calendar-properties-dialog.xul chrome://lightning/content/lightning-calendar-properties.xul</span>
<a href="#l14.21"></a><span id="l14.21"> % skin lightning classic/1.0 %skin/classic/lightning/</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-  content/lightning/customize-toolbar.js                (content/customize-toolbar.js)</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-  content/lightning/customize-toolbar.xul               (content/customize-toolbar.xul)</span>
<a href="#l14.24"></a><span id="l14.24">   content/lightning/imip-bar.js                         (content/imip-bar.js)</span>
<a href="#l14.25"></a><span id="l14.25">   content/lightning/imip-bar-overlay.xul                (content/imip-bar-overlay.xul)</span>
<a href="#l14.26"></a><span id="l14.26">   content/lightning/lightning-common-sets.js (content/lightning-common-sets.js)</span>
<a href="#l14.27"></a><span id="l14.27">   content/lightning/lightning-migration.xul             (content/lightning-migration.xul)</span>
<a href="#l14.28"></a><span id="l14.28">   content/lightning/lightning-standalone.xul		(content/lightning-standalone.xul)</span>
<a href="#l14.29"></a><span id="l14.29">   content/lightning/lightning-utils.js			(content/lightning-utils.js) </span>
<a href="#l14.30"></a><span id="l14.30">   content/lightning/lightning-widgets.css		(content/lightning-widgets.css)</span>
<a href="#l14.31"></a><span id="l14.31">   content/lightning/lightning-widgets.xml		(content/lightning-widgets.xml)</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-  content/lightning/lightning-today-pane.js		(content/lightning-today-pane.js)</span>
<a href="#l14.33"></a><span id="l14.33">   content/lightning/messenger-overlay-sidebar.css	(content/messenger-overlay-sidebar.css)</span>
<a href="#l14.34"></a><span id="l14.34">   content/lightning/messenger-overlay-accountCentral.xul (content/messenger-overlay-accountCentral.xul)</span>
<a href="#l14.35"></a><span id="l14.35">   content/lightning/messenger-overlay-messageWindow.xul (content/messenger-overlay-messageWindow.xul)</span>
<a href="#l14.36"></a><span id="l14.36"> * content/lightning/messenger-overlay-sidebar.js	(content/messenger-overlay-sidebar.js)</span>
<a href="#l14.37"></a><span id="l14.37"> * content/lightning/messenger-overlay-sidebar.xul	(content/messenger-overlay-sidebar.xul)</span>
<a href="#l14.38"></a><span id="l14.38">   content/lightning/messenger-overlay-preferences.js    (content/messenger-overlay-preferences.js)</span>
<a href="#l14.39"></a><span id="l14.39">   content/lightning/messenger-overlay-preferences.xul	(content/messenger-overlay-preferences.xul)</span>
<a href="#l14.40"></a><span id="l14.40">   content/lightning/messenger-overlay-toolbar.js        (content/messenger-overlay-toolbar.js)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/lightning/themes/pinstripe/lightning.css</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/lightning/themes/pinstripe/lightning.css</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -50,118 +50,66 @@ radio[pane=paneLightning] {</span>
<a href="#l15.4"></a><span id="l15.4"> }</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6"> /* iMIP notification bar */</span>
<a href="#l15.7"></a><span id="l15.7"> #imip-bar &gt; image {</span>
<a href="#l15.8"></a><span id="l15.8">     list-style-image: url(&quot;chrome://calendar/skin/cal-icon32.png&quot;);</span>
<a href="#l15.9"></a><span id="l15.9">     -moz-margin-end: 8px;</span>
<a href="#l15.10"></a><span id="l15.10"> }</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-/* ::::: mode toolbar buttons ::::: */</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-#mode-toolbar {</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-  padding: 5px 2px;</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-  border-top: 1px solid ThreeDShadow !important;</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-}</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-#mode-toolbar[location=&quot;top&quot;] {</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-  border-top: 0 !important;</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-}</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-.toolbarbutton-2 {</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-  -moz-box-orient: vertical;</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-  min-width: 0px;</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-  list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-}</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-toolbar[mode=&quot;full&quot;] .toolbarbutton-2 {</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-  min-width: 55px;</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-}</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-.toolbarbutton-2[type=&quot;menu&quot;] {</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-  -moz-binding: url(&quot;chrome://global/content/bindings/toolbarbutton.xml#menu-vertical&quot;);</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-}</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-#mail-switch-button {</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-  -moz-image-region: rect(0px 25px 25px 0px);</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-}</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-#mail-switch-button:hover:active {</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-  -moz-image-region: rect(25px 25px 50px 0px);</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-}</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-#mail-switch-button[disabled] {</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-  -moz-image-region: rect(50px 25px 75px 0px);</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-}</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+/* ::::: tabs ::::: */</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-#calendar-switch-button {</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-  -moz-image-region: rect(0px 50px 25px 25px);</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-}</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-#calendar-switch-button:hover:active {</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineminus">-  -moz-image-region: rect(25px 50px 50px 25px);</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineminus">-}</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-#calendar-switch-button[disabled] {</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-  -moz-image-region: rect(50px 50px 75px 25px);</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-}</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-#task-switch-button {</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-  -moz-image-region: rect(0px 75px 25px 50px);</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-}</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-#task-switch-button:hover:active {</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-  -moz-image-region: rect(25px 75px 50px 50px);</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-}</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-#task-switch-button[disabled] {</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-  -moz-image-region: rect(50px 75px 75px 50px);</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-}</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-/* ::::: small mode toolbar buttons ::::: */</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] .toolbarbutton-2 {</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineminus">- list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineminus">-}</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #mail-switch-button {</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineminus">-  -moz-image-region: rect(0px 91px 16px 75px);</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineminus">-}</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineminus">-</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #mail-switch-button:hover:active {</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineminus">-  -moz-image-region: rect(16px 91px 32px 75px);</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineminus">-}</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineminus">-</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #mail-switch-button[disabled] {</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-  -moz-image-region: rect(32px 91px 48px 75px);</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-}</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #calendar-switch-button {</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+/* ::: new tab buttons ::: */</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+#calendar-tab-button {</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineplus">+  list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l15.94"></a><span id="l15.94">   -moz-image-region: rect(0px 107px 16px 91px);</span>
<a href="#l15.95"></a><span id="l15.95"> }</span>
<a href="#l15.96"></a><span id="l15.96"> </span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #calendar-switch-button:hover:active {</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineplus">+#calendar-tab-button:hover:active {</span>
<a href="#l15.99"></a><span id="l15.99">   -moz-image-region: rect(16px 107px 32px 91px);</span>
<a href="#l15.100"></a><span id="l15.100"> }</span>
<a href="#l15.101"></a><span id="l15.101"> </span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #calendar-switch-button[disabled] {</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineplus">+#calendar-tab-button[disabled] {</span>
<a href="#l15.104"></a><span id="l15.104">   -moz-image-region: rect(32px 107px 48px 91px);</span>
<a href="#l15.105"></a><span id="l15.105"> }</span>
<a href="#l15.106"></a><span id="l15.106"> </span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #task-switch-button {</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineplus">+#task-tab-button {</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineplus">+ list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l15.110"></a><span id="l15.110">   -moz-image-region: rect(0px 123px 16px 107px);</span>
<a href="#l15.111"></a><span id="l15.111"> }</span>
<a href="#l15.112"></a><span id="l15.112"> </span>
<a href="#l15.113"></a><span id="l15.113" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #task-switch-button:hover:active {</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineplus">+#task-tab-button:hover:active {</span>
<a href="#l15.115"></a><span id="l15.115">   -moz-image-region: rect(16px 123px 32px 107px);</span>
<a href="#l15.116"></a><span id="l15.116"> }</span>
<a href="#l15.117"></a><span id="l15.117"> </span>
<a href="#l15.118"></a><span id="l15.118" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #task-switch-button[disabled] {</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineplus">+#task-tab-button[disabled] {</span>
<a href="#l15.120"></a><span id="l15.120">   -moz-image-region: rect(32px 123px 48px 107px);</span>
<a href="#l15.121"></a><span id="l15.121"> }</span>
<a href="#l15.122"></a><span id="l15.122"> </span>
<a href="#l15.123"></a><span id="l15.123" class="difflineminus">-/* Lightining sidebar background in calendar and task mode */</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+/* ::: tab icons ::: */</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineplus">+.tabmail-tab[type=&quot;calendar&quot;] .tab-icon-image {</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineplus">+  list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineplus">+  -moz-image-region: rect(0px 107px 16px 91px);</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineplus">+}</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineplus">+</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineplus">+.tabmail-tab[type=&quot;calendar&quot;][selected=&quot;true&quot;] .tab-icon-image {</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineplus">+  -moz-image-region: rect(16px 107px 32px 91px);</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineplus">+}</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineplus">+</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineplus">+.tabmail-tab[type=&quot;tasks&quot;] .tab-icon-image {</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineplus">+  list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineplus">+  -moz-image-region: rect(0px 123px 16px 107px);</span>
<a href="#l15.137"></a><span id="l15.137" class="difflineplus">+}</span>
<a href="#l15.138"></a><span id="l15.138" class="difflineplus">+</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineplus">+.tabmail-tab[type=&quot;tasks&quot;][selected=&quot;true&quot;] .tab-icon-image {</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineplus">+  -moz-image-region: rect(16px 123px 32px 107px);</span>
<a href="#l15.141"></a><span id="l15.141" class="difflineplus">+}</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineplus">+</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineplus">+</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineplus">+/* Lightning sidebar background in calendar and task mode */</span>
<a href="#l15.145"></a><span id="l15.145"> #ltnSidebar {</span>
<a href="#l15.146"></a><span id="l15.146">   background-color: -moz-field;  </span>
<a href="#l15.147"></a><span id="l15.147"> }</span>
<a href="#l15.148"></a><span id="l15.148"> </span>
<a href="#l15.149"></a><span id="l15.149"> #invitations-pane {</span>
<a href="#l15.150"></a><span id="l15.150">   border-top: 1px solid ThreeDShadow !important;</span>
<a href="#l15.151"></a><span id="l15.151">   background-color: -moz-dialog;  </span>
<a href="#l15.152"></a><span id="l15.152"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/lightning/themes/winstripe/lightning.css</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/lightning/themes/winstripe/lightning.css</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -50,118 +50,66 @@ radio[pane=paneLightning] {</span>
<a href="#l16.4"></a><span id="l16.4"> }</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> /* iMIP notification bar */</span>
<a href="#l16.7"></a><span id="l16.7"> #imip-bar &gt; image {</span>
<a href="#l16.8"></a><span id="l16.8">     list-style-image: url(&quot;chrome://calendar/skin/cal-icon32.png&quot;);</span>
<a href="#l16.9"></a><span id="l16.9">     -moz-image-region: rect(0px, 32px, 32px, 0px);</span>
<a href="#l16.10"></a><span id="l16.10"> }</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-/* ::::: mode toolbar buttons ::::: */</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-#mode-toolbar {</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-  padding: 5px 2px;</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-  border-top: 1px solid ThreeDShadow !important;</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-}</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">-#mode-toolbar[location=&quot;top&quot;] {</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">-  border-top: 0 !important;</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-}</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-.toolbarbutton-2 {</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-  -moz-box-orient: vertical;</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">-  min-width: 0px;</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-  list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-}</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-toolbar[mode=&quot;full&quot;] .toolbarbutton-2 {</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-  min-width: 55px;</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-}</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-.toolbarbutton-2[type=&quot;menu&quot;] {</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-  -moz-binding: url(&quot;chrome://global/content/bindings/toolbarbutton.xml#menu-vertical&quot;);</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-}</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-#mail-switch-button {</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-  -moz-image-region: rect(0px 25px 25px 0px);</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-}</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineminus">-</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineminus">-#mail-switch-button:hover:active {</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineminus">-  -moz-image-region: rect(25px 25px 50px 0px);</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-}</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-#mail-switch-button[disabled] {</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineminus">-  -moz-image-region: rect(50px 25px 75px 0px);</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-}</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+/* ::::: tabs ::::: */</span>
<a href="#l16.48"></a><span id="l16.48"> </span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-#calendar-switch-button {</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-  -moz-image-region: rect(0px 50px 25px 25px);</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-}</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineminus">-#calendar-switch-button:hover:active {</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-  -moz-image-region: rect(25px 50px 50px 25px);</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineminus">-}</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineminus">-</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-#calendar-switch-button[disabled] {</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineminus">-  -moz-image-region: rect(50px 50px 75px 25px);</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineminus">-}</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineminus">-</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-#task-switch-button {</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineminus">-  -moz-image-region: rect(0px 75px 25px 50px);</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineminus">-}</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineminus">-#task-switch-button:hover:active {</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-  -moz-image-region: rect(25px 75px 50px 50px);</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineminus">-}</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineminus">-#task-switch-button[disabled] {</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineminus">-  -moz-image-region: rect(50px 75px 75px 50px);</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineminus">-}</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineminus">-</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-/* ::::: small mode toolbar buttons ::::: */</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] .toolbarbutton-2 {</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineminus">- list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineminus">-}</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineminus">-</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #mail-switch-button {</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineminus">-  -moz-image-region: rect(0px 91px 16px 75px);</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineminus">-}</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineminus">-</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #mail-switch-button:hover:active {</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineminus">-  -moz-image-region: rect(16px 91px 32px 75px);</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineminus">-}</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineminus">-</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #mail-switch-button[disabled] {</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineminus">-  -moz-image-region: rect(32px 91px 48px 75px);</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineminus">-}</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineminus">-</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #calendar-switch-button {</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+/* ::: new tab buttons ::: */</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineplus">+#calendar-tab-button {</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+  list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l16.94"></a><span id="l16.94">   -moz-image-region: rect(0px 107px 16px 91px);</span>
<a href="#l16.95"></a><span id="l16.95"> }</span>
<a href="#l16.96"></a><span id="l16.96"> </span>
<a href="#l16.97"></a><span id="l16.97" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #calendar-switch-button:hover:active {</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+#calendar-tab-button:hover:active {</span>
<a href="#l16.99"></a><span id="l16.99">   -moz-image-region: rect(16px 107px 32px 91px);</span>
<a href="#l16.100"></a><span id="l16.100"> }</span>
<a href="#l16.101"></a><span id="l16.101"> </span>
<a href="#l16.102"></a><span id="l16.102" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #calendar-switch-button[disabled] {</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+#calendar-tab-button[disabled] {</span>
<a href="#l16.104"></a><span id="l16.104">   -moz-image-region: rect(32px 107px 48px 91px);</span>
<a href="#l16.105"></a><span id="l16.105"> }</span>
<a href="#l16.106"></a><span id="l16.106"> </span>
<a href="#l16.107"></a><span id="l16.107" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #task-switch-button {</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineplus">+#task-tab-button {</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineplus">+ list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l16.110"></a><span id="l16.110">   -moz-image-region: rect(0px 123px 16px 107px);</span>
<a href="#l16.111"></a><span id="l16.111"> }</span>
<a href="#l16.112"></a><span id="l16.112"> </span>
<a href="#l16.113"></a><span id="l16.113" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #task-switch-button:hover:active {</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineplus">+#task-tab-button:hover:active {</span>
<a href="#l16.115"></a><span id="l16.115">   -moz-image-region: rect(16px 123px 32px 107px);</span>
<a href="#l16.116"></a><span id="l16.116"> }</span>
<a href="#l16.117"></a><span id="l16.117"> </span>
<a href="#l16.118"></a><span id="l16.118" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] #task-switch-button[disabled] {</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineplus">+#task-tab-button[disabled] {</span>
<a href="#l16.120"></a><span id="l16.120">   -moz-image-region: rect(32px 123px 48px 107px);</span>
<a href="#l16.121"></a><span id="l16.121"> }</span>
<a href="#l16.122"></a><span id="l16.122"> </span>
<a href="#l16.123"></a><span id="l16.123" class="difflineminus">-/* Lightining sidebar background in calendar and task mode */</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineplus">+/* ::: tab icons ::: */</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineplus">+.tabmail-tab[type=&quot;calendar&quot;] .tab-icon-image {</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineplus">+  list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineplus">+  -moz-image-region: rect(0px 107px 16px 91px);</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineplus">+}</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineplus">+</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineplus">+.tabmail-tab[type=&quot;calendar&quot;][selected=&quot;true&quot;] .tab-icon-image {</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineplus">+  -moz-image-region: rect(16px 107px 32px 91px);</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineplus">+}</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineplus">+</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineplus">+.tabmail-tab[type=&quot;tasks&quot;] .tab-icon-image {</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineplus">+  list-style-image: url(&quot;chrome://calendar/skin/mode-switch-icons.png&quot;);</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineplus">+  -moz-image-region: rect(0px 123px 16px 107px);</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineplus">+}</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineplus">+</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineplus">+.tabmail-tab[type=&quot;tasks&quot;][selected=&quot;true&quot;] .tab-icon-image {</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineplus">+  -moz-image-region: rect(16px 123px 32px 107px);</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineplus">+}</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineplus">+</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineplus">+</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineplus">+/* Lightning sidebar background in calendar and task mode */</span>
<a href="#l16.145"></a><span id="l16.145"> #ltnSidebar {</span>
<a href="#l16.146"></a><span id="l16.146">   background-color: -moz-field;  </span>
<a href="#l16.147"></a><span id="l16.147"> }</span>
<a href="#l16.148"></a><span id="l16.148"> </span>
<a href="#l16.149"></a><span id="l16.149"> #invitations-pane {</span>
<a href="#l16.150"></a><span id="l16.150">   border-top: 1px solid ThreeDShadow !important;</span>
<a href="#l16.151"></a><span id="l16.151">   background-color: -moz-dialog;  </span>
<a href="#l16.152"></a><span id="l16.152"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -25,16 +25,17 @@</span>
<a href="#l17.4"></a><span id="l17.4"> #   slucy@objectivesw.co.uk</span>
<a href="#l17.5"></a><span id="l17.5"> #   Hkan Waara &lt;hwaara@chello.se&gt;</span>
<a href="#l17.6"></a><span id="l17.6"> #   Jan Varga &lt;varga@nixcorp.com&gt;</span>
<a href="#l17.7"></a><span id="l17.7"> #   Seth Spitzer &lt;sspitzer@netscape.com&gt;</span>
<a href="#l17.8"></a><span id="l17.8"> #   David Bienvenu &lt;bienvenu@nventure.com&gt;</span>
<a href="#l17.9"></a><span id="l17.9"> #   Karsten Dsterloh &lt;mnyromyr@tprac.de&gt;</span>
<a href="#l17.10"></a><span id="l17.10"> #   Christopher Thomas &lt;cst@yecc.com&gt;</span>
<a href="#l17.11"></a><span id="l17.11"> #   Jeremy Morton &lt;bugzilla@game-point.net&gt;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+#   Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l17.13"></a><span id="l17.13"> #</span>
<a href="#l17.14"></a><span id="l17.14"> # Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l17.15"></a><span id="l17.15"> # either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l17.16"></a><span id="l17.16"> # the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l17.17"></a><span id="l17.17"> # in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l17.18"></a><span id="l17.18"> # of those above. If you wish to allow use of your version of this file only</span>
<a href="#l17.19"></a><span id="l17.19"> # under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l17.20"></a><span id="l17.20"> # use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineat">@@ -1289,114 +1290,16 @@ function MsgOpenNewWindowForFolder(uri, </span>
<a href="#l17.22"></a><span id="l17.22">     // highlighted. GetSelectedFolderURI() will return the message that is</span>
<a href="#l17.23"></a><span id="l17.23">     // highlighted.</span>
<a href="#l17.24"></a><span id="l17.24">     uriToOpen = GetSelectedFolderURI();</span>
<a href="#l17.25"></a><span id="l17.25"> </span>
<a href="#l17.26"></a><span id="l17.26">   if (uriToOpen)</span>
<a href="#l17.27"></a><span id="l17.27">     window.openDialog(&quot;chrome://messenger/content/&quot;, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;, uriToOpen, keyToSelect);</span>
<a href="#l17.28"></a><span id="l17.28"> }</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-/** </span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-  *saveMailTabInfo - a private helper routine shared by message and folder tab owners to save</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-  *                                 the local state of a mail tab</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">-  * @param aMailTabOwner</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-  */</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-function saveMailTabInfo(aMailTabOwner)</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-{</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-  if (aMailTabOwner)</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-  {</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-    aMailTabOwner.messenger = messenger;</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-    aMailTabOwner.dbView = gDBView;</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-    aMailTabOwner.searchSession = gSearchSession;</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-    var indices = GetSelectedIndices(gDBView);</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-    if (indices)</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-    {</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-      aMailTabOwner.selectedKeys = new Array(indices.length);</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-      aMailTabOwner.selectedFolders = new Array(indices.length);</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-    }</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-    if (gDBView.currentlyDisplayedMessage != -1)</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-    {</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-      try // there may not be a selected message.</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-      {</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineminus">-          var curMsgHdr = gDBView.hdrForFirstSelectedMessage;</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineminus">-          aMailTabOwner.selectedMsgId = curMsgHdr.messageId;</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-          aMailTabOwner.msgSelectedFolder = curMsgHdr.folder;</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-      }</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineminus">-      catch (ex) {aMailTabOwner.msgSelectedFolder = gMsgFolderSelected};</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-    }</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineminus">-    else</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-    {</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineminus">-      aMailTabOwner.selectedMsgId = null;</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineminus">-      aMailTabOwner.msgSelectedFolder = null;</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineminus">-    }</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-    if (indices)</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-    {</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-      for (var i = 0; i &lt; indices.length; i++)</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineminus">-      {</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-        aMailTabOwner.selectedKeys[i] = gDBView.getKeyAt(i);</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineminus">-        aMailTabOwner.selectedFolders[i] = gDBView.getFolderForViewIndex(i);</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-      }</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineminus">-    }</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineminus">-  }</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineminus">-}</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineminus">-/**</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineminus">-  * setMailTabState - a private helper routine shared by message and folder tab owners for setting up various</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineminus">-                                     global variables based on the current tab.</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineminus">-  * @param aMailTabOwner </span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-  */</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineminus">-function setMailTabState(aMailTabOwner)</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineminus">-{</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineminus">-  messenger = aMailTabOwner.messenger;</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineminus">-  gDBView = aMailTabOwner.dbView;</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineminus">-  gSearchSession = aMailTabOwner.searchSession;</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineminus">-  if (gDBView)</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-  {</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-    var folderTree = GetFolderTree();</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineminus">-    var row = EnsureFolderIndex(folderTree.builderView, gDBView.msgFolder);</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineminus">-    </span>
<a href="#l17.89"></a><span id="l17.89" class="difflineminus">-    var folderTreeBoxObj = folderTree.treeBoxObject;</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineminus">-    var folderTreeSelection = folderTreeBoxObj.view.selection;</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineminus">-    // make sure that row.value is valid so that it doesn't mess up</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineminus">-    // the call to ensureRowIsVisible().</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineminus">-    if((row &gt;= 0) &amp;&amp; !folderTreeSelection.isSelected(row))</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineminus">-    {</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineminus">-      gMsgFolderSelected = gDBView.msgFolder;</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineminus">-      folderTreeSelection.selectEventsSuppressed = true;</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineminus">-      folderTreeSelection.select(row);</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineminus">-      folderTreeBoxObj.ensureRowIsVisible(row);</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineminus">-      folderTreeSelection.selectEventsSuppressed = false;</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineminus">-    }</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineminus">-    // this sets the thread pane tree's view to the gDBView view.</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineminus">-    UpdateSortIndicators(gDBView.sortType, gDBView.sortOrder);</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineminus">-    RerootThreadPane();</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-    // we need to restore the selection to what it was when we switched away from this tab.</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-    // we need to remember the selected keys, instead of the selected indices, since the view</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineminus">-    // might have changed. But maybe the selectedIndices adjust as items are added/removed from</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineminus">-    // the (hidden) view.</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineminus">-    ClearThreadPaneSelection(); </span>
<a href="#l17.109"></a><span id="l17.109" class="difflineminus">-    try</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineminus">-    {</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineminus">-      if (aMailTabOwner.selectedMsgId &amp;&amp; aMailTabOwner.msgSelectedFolder)</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineminus">-      {</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineminus">-        var msgDB = aMailTabOwner.msgSelectedFolder.getMsgDatabase(msgWindow);</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineminus">-        var msgHdr = msgDB.getMsgHdrForMessageID(aMailTabOwner.selectedMsgId);</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineminus">-        setTimeout(gDBView.selectFolderMsgByKey, 0, aMailTabOwner.msgSelectedFolder, msgHdr.messageKey);</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineminus">-      }</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineminus">-    }</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineminus">-    catch (ex) {dump(ex);}</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineminus">-  }</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineminus">-  else</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineminus">-  {</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineminus">-    var tree = GetThreadTree();</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineminus">-    tree.boxObject.QueryInterface(Components.interfaces.nsITreeBoxObject).view = null;</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineminus">-    ClearMessagePane();</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineminus">-  }</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineminus">-}</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineminus">-</span>
<a href="#l17.128"></a><span id="l17.128"> function CreateToolbarTooltip(document, event)</span>
<a href="#l17.129"></a><span id="l17.129"> {</span>
<a href="#l17.130"></a><span id="l17.130">   event.stopPropagation();</span>
<a href="#l17.131"></a><span id="l17.131">   var tn = document.tooltipNode;</span>
<a href="#l17.132"></a><span id="l17.132">   if (tn.localName != &quot;tab&quot;)</span>
<a href="#l17.133"></a><span id="l17.133">     return false; // Not a tab, so cancel the tooltip</span>
<a href="#l17.134"></a><span id="l17.134">   if (&quot;mOverCloseButton&quot; in tn &amp;&amp; tn.mOverCloseButton) {</span>
<a href="#l17.135"></a><span id="l17.135">      event.target.setAttribute(&quot;label&quot;, tn.getAttribute(&quot;closetabtext&quot;));</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineat">@@ -1431,146 +1334,216 @@ function DisplayFolderAndThreadPane(show</span>
<a href="#l17.137"></a><span id="l17.137">     document.getElementById(&quot;folder-location-container&quot;).collapsed = collapse;</span>
<a href="#l17.138"></a><span id="l17.138">   } catch (ex) {}</span>
<a href="#l17.139"></a><span id="l17.139">   try {</span>
<a href="#l17.140"></a><span id="l17.140">     document.getElementById(&quot;mailviews-container&quot;).collapsed = collapse;</span>
<a href="#l17.141"></a><span id="l17.141">   } catch (ex) {}</span>
<a href="#l17.142"></a><span id="l17.142"> }</span>
<a href="#l17.143"></a><span id="l17.143"> </span>
<a href="#l17.144"></a><span id="l17.144"> /**</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineminus">-  * openFolderTab - a private helper method used by folder and message tab owners.</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineminus">-  * @param aMailTabOwner</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineplus">+ * mailTabType provides both &quot;folder&quot; and &quot;message&quot; tab modes.  Under the</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineplus">+ *  previous TabOwner framework, their logic was separated into two 'classes'</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineplus">+ *  which called common helper methods and had similar boilerplate logic.</span>
<a href="#l17.150"></a><span id="l17.150">   */</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineminus">-function openFolderTab(aMailTabOwner)</span>
<a href="#l17.152"></a><span id="l17.152" class="difflineminus">-{</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineplus">+let mailTabType = {</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineplus">+  name: &quot;mail&quot;,</span>
<a href="#l17.155"></a><span id="l17.155" class="difflineplus">+  panelId: &quot;mailContent&quot;,</span>
<a href="#l17.156"></a><span id="l17.156" class="difflineplus">+  modes: {</span>
<a href="#l17.157"></a><span id="l17.157" class="difflineplus">+    folder: {</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineplus">+      isDefault: true,</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineplus">+      type: &quot;folder&quot;,</span>
<a href="#l17.160"></a><span id="l17.160" class="difflineplus">+      openTab: function(aTab, aFolderUri) {</span>
<a href="#l17.161"></a><span id="l17.161" class="difflineplus">+        aTab.uriToOpen = aFolderUri;</span>
<a href="#l17.162"></a><span id="l17.162" class="difflineplus">+</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineplus">+        this.openTab(aTab); // call superclass logic</span>
<a href="#l17.164"></a><span id="l17.164" class="difflineplus">+      },</span>
<a href="#l17.165"></a><span id="l17.165" class="difflineplus">+      showTab: function(aTab) {</span>
<a href="#l17.166"></a><span id="l17.166" class="difflineplus">+        this.folderAndThreadPaneVisible = true;</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineplus">+        ClearMessagePane();</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineplus">+</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineplus">+        this.showTab(aTab);</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineplus">+      },</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineplus">+      onTitleChanged: function(aTab, aTabNode) {</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineplus">+        aTab.title = gMsgFolderSelected.prettyName;</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineplus">+        // the user may have changed folders, triggering our onTitleChanged callback.</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineplus">+        // update the appropriate attributes on the tab.</span>
<a href="#l17.175"></a><span id="l17.175" class="difflineplus">+        aTabNode.setAttribute('SpecialFolder', getSpecialFolderString(gMsgFolderSelected));</span>
<a href="#l17.176"></a><span id="l17.176" class="difflineplus">+        aTabNode.setAttribute('ServerType', gMsgFolderSelected.server.type);</span>
<a href="#l17.177"></a><span id="l17.177" class="difflineplus">+      }</span>
<a href="#l17.178"></a><span id="l17.178" class="difflineplus">+    },</span>
<a href="#l17.179"></a><span id="l17.179" class="difflineplus">+    message: {</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineplus">+      type: &quot;message&quot;,</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineplus">+      openTab: function(aTab, aFolderUri, aMsgHdr) {</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineplus">+        aTab.uriToOpen = aFolderUri;</span>
<a href="#l17.183"></a><span id="l17.183" class="difflineplus">+        aTab.hdr = aMsgHdr;</span>
<a href="#l17.184"></a><span id="l17.184" class="difflineplus">+</span>
<a href="#l17.185"></a><span id="l17.185" class="difflineplus">+        aTab.title = aTab.hdr.mime2DecodedSubject;</span>
<a href="#l17.186"></a><span id="l17.186" class="difflineplus">+</span>
<a href="#l17.187"></a><span id="l17.187" class="difflineplus">+        this.openTab(aTab); // call superclass logic</span>
<a href="#l17.188"></a><span id="l17.188" class="difflineplus">+</span>
<a href="#l17.189"></a><span id="l17.189" class="difflineplus">+        gCurrentlyDisplayedMessage = nsMsgViewIndex_None;</span>
<a href="#l17.190"></a><span id="l17.190">   ClearThreadPaneSelection(); </span>
<a href="#l17.191"></a><span id="l17.191" class="difflineplus">+        setTimeout(gDBView.selectFolderMsgByKey, 0, aTab.hdr.folder,</span>
<a href="#l17.192"></a><span id="l17.192" class="difflineplus">+                   aTab.hdr.messageKey);</span>
<a href="#l17.193"></a><span id="l17.193" class="difflineplus">+</span>
<a href="#l17.194"></a><span id="l17.194" class="difflineplus">+        // let's try hiding the thread pane and folder pane</span>
<a href="#l17.195"></a><span id="l17.195" class="difflineplus">+        this.folderAndThreadPaneVisible = false;</span>
<a href="#l17.196"></a><span id="l17.196" class="difflineplus">+      },</span>
<a href="#l17.197"></a><span id="l17.197" class="difflineplus">+      showTab: function(aTab) {</span>
<a href="#l17.198"></a><span id="l17.198" class="difflineplus">+        this.folderAndThreadPaneVisible = false;</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineplus">+        // ClearMessagePane();</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineplus">+</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineplus">+        this.showTab(aTab);</span>
<a href="#l17.202"></a><span id="l17.202" class="difflineplus">+      }</span>
<a href="#l17.203"></a><span id="l17.203" class="difflineplus">+    }</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineplus">+  },</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineplus">+  /**</span>
<a href="#l17.206"></a><span id="l17.206" class="difflineplus">+   * Create the new tab's state, which engenders some side effects.  Part of our</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineplus">+   *  contract is that we leave the tab in the selected state.</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineplus">+   */</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineplus">+  openTab: function(aTab) {</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineplus">+    ClearThreadPaneSelection();</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineplus">+</span>
<a href="#l17.212"></a><span id="l17.212" class="difflineplus">+    // each tab gets its own messenger instance; I assume this is so each one</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineplus">+    //  gets its own undo/redo stack?</span>
<a href="#l17.214"></a><span id="l17.214">   messenger = Components.classes[&quot;@mozilla.org/messenger;1&quot;]</span>
<a href="#l17.215"></a><span id="l17.215">                         .createInstance(Components.interfaces.nsIMessenger);</span>
<a href="#l17.216"></a><span id="l17.216">   messenger.setWindow(window, msgWindow);</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineminus">-  aMailTabOwner.msgSelectedFolder = gMsgFolderSelected;</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineplus">+    aTab.messenger = messenger;</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineplus">+</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineplus">+    aTab.msgSelectedFolder = gMsgFolderSelected;</span>
<a href="#l17.221"></a><span id="l17.221" class="difflineplus">+</span>
<a href="#l17.222"></a><span id="l17.222">   // clear selection, because context clicking on a folder and opening in a new</span>
<a href="#l17.223"></a><span id="l17.223">   // tab needs to have SelectFolder think the selection has changed.</span>
<a href="#l17.224"></a><span id="l17.224">   // We also need to clear these globals to subvert the code that prevents</span>
<a href="#l17.225"></a><span id="l17.225">   // folder loads when things haven't changed.</span>
<a href="#l17.226"></a><span id="l17.226">   GetFolderTree().view.selection.clearSelection();</span>
<a href="#l17.227"></a><span id="l17.227">   GetFolderTree().view.selection.currentIndex = -1;</span>
<a href="#l17.228"></a><span id="l17.228">   gMsgFolderSelected = null;</span>
<a href="#l17.229"></a><span id="l17.229">   msgWindow.openFolder = null;</span>
<a href="#l17.230"></a><span id="l17.230" class="difflineplus">+</span>
<a href="#l17.231"></a><span id="l17.231">   // clear thread pane selection - otherwise, the tree tries to impose </span>
<a href="#l17.232"></a><span id="l17.232">   // the current selection on the new view.</span>
<a href="#l17.233"></a><span id="l17.233">   gDBView = null; // clear gDBView so we won't try to close it.</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineminus">-  SelectFolder(aMailTabOwner.uriToOpen);</span>
<a href="#l17.235"></a><span id="l17.235" class="difflineminus">-  aMailTabOwner.dbView = gDBView;</span>
<a href="#l17.236"></a><span id="l17.236" class="difflineminus">-}</span>
<a href="#l17.237"></a><span id="l17.237" class="difflineminus">-</span>
<a href="#l17.238"></a><span id="l17.238" class="difflineminus">-function folderTabOwner()</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineminus">-{</span>
<a href="#l17.240"></a><span id="l17.240" class="difflineminus">-  saveMailTabInfo(this);</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineminus">-}</span>
<a href="#l17.242"></a><span id="l17.242" class="difflineminus">-</span>
<a href="#l17.243"></a><span id="l17.243" class="difflineminus">-folderTabOwner.prototype =</span>
<a href="#l17.244"></a><span id="l17.244" class="difflineminus">-{</span>
<a href="#l17.245"></a><span id="l17.245" class="difflineminus">-  open : function ()</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineminus">-  {</span>
<a href="#l17.247"></a><span id="l17.247" class="difflineminus">-    openFolderTab(this);</span>
<a href="#l17.248"></a><span id="l17.248" class="difflineplus">+    SelectFolder(aTab.uriToOpen);</span>
<a href="#l17.249"></a><span id="l17.249" class="difflineplus">+    aTab.dbView = gDBView;</span>
<a href="#l17.250"></a><span id="l17.250">   },</span>
<a href="#l17.251"></a><span id="l17.251">   </span>
<a href="#l17.252"></a><span id="l17.252" class="difflineminus">-  close : function () </span>
<a href="#l17.253"></a><span id="l17.253" class="difflineminus">-  {</span>
<a href="#l17.254"></a><span id="l17.254" class="difflineminus">-    if (this.dbView)</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineminus">-      this.dbView.close();</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineminus">-    if (this.messenger)</span>
<a href="#l17.257"></a><span id="l17.257" class="difflineminus">-      this.messenger.setWindow(null, null);</span>
<a href="#l17.258"></a><span id="l17.258" class="difflineplus">+  closeTab: function(aTab) {</span>
<a href="#l17.259"></a><span id="l17.259" class="difflineplus">+    if (aTab.dbView)</span>
<a href="#l17.260"></a><span id="l17.260" class="difflineplus">+      aTab.dbView.close();</span>
<a href="#l17.261"></a><span id="l17.261" class="difflineplus">+    if (aTab.messenger)</span>
<a href="#l17.262"></a><span id="l17.262" class="difflineplus">+      aTab.messenger.setWindow(null, null);</span>
<a href="#l17.263"></a><span id="l17.263">   },</span>
<a href="#l17.264"></a><span id="l17.264"> </span>
<a href="#l17.265"></a><span id="l17.265" class="difflineminus">-  saveCurrentInfo : function()</span>
<a href="#l17.266"></a><span id="l17.266" class="difflineplus">+  saveTabState: function(aTab) {</span>
<a href="#l17.267"></a><span id="l17.267" class="difflineplus">+    aTab.messenger = messenger;</span>
<a href="#l17.268"></a><span id="l17.268" class="difflineplus">+    aTab.dbView = gDBView;</span>
<a href="#l17.269"></a><span id="l17.269" class="difflineplus">+    aTab.searchSession = gSearchSession;</span>
<a href="#l17.270"></a><span id="l17.270" class="difflineplus">+</span>
<a href="#l17.271"></a><span id="l17.271" class="difflineplus">+    if (gDBView.currentlyDisplayedMessage != nsMsgViewIndex_None)</span>
<a href="#l17.272"></a><span id="l17.272">   {</span>
<a href="#l17.273"></a><span id="l17.273" class="difflineminus">-    saveMailTabInfo(this);</span>
<a href="#l17.274"></a><span id="l17.274" class="difflineminus">-  },</span>
<a href="#l17.275"></a><span id="l17.275" class="difflineminus">-</span>
<a href="#l17.276"></a><span id="l17.276" class="difflineminus">-  onSelect : function(aPreviousTabOwner)</span>
<a href="#l17.277"></a><span id="l17.277" class="difflineplus">+      try // there may not be a selected message.</span>
<a href="#l17.278"></a><span id="l17.278" class="difflineplus">+    {</span>
<a href="#l17.279"></a><span id="l17.279" class="difflineplus">+        var curMsgHdr = gDBView.hdrForFirstSelectedMessage;</span>
<a href="#l17.280"></a><span id="l17.280" class="difflineplus">+        aTab.selectedMsgId = curMsgHdr.messageId;</span>
<a href="#l17.281"></a><span id="l17.281" class="difflineplus">+        aTab.msgSelectedFolder = curMsgHdr.folder;</span>
<a href="#l17.282"></a><span id="l17.282" class="difflineplus">+    }</span>
<a href="#l17.283"></a><span id="l17.283" class="difflineplus">+      catch (ex)</span>
<a href="#l17.284"></a><span id="l17.284">   {</span>
<a href="#l17.285"></a><span id="l17.285" class="difflineminus">-    if (aPreviousTabOwner.type != this.type)</span>
<a href="#l17.286"></a><span id="l17.286" class="difflineminus">-    {</span>
<a href="#l17.287"></a><span id="l17.287" class="difflineminus">-      ClearMessagePane();</span>
<a href="#l17.288"></a><span id="l17.288" class="difflineminus">-      DisplayFolderAndThreadPane(true);</span>
<a href="#l17.289"></a><span id="l17.289" class="difflineplus">+        aTab.msgSelectedFolder = gMsgFolderSelected</span>
<a href="#l17.290"></a><span id="l17.290" class="difflineplus">+      }</span>
<a href="#l17.291"></a><span id="l17.291" class="difflineplus">+    }</span>
<a href="#l17.292"></a><span id="l17.292" class="difflineplus">+    else</span>
<a href="#l17.293"></a><span id="l17.293" class="difflineplus">+  {</span>
<a href="#l17.294"></a><span id="l17.294" class="difflineplus">+      aTab.selectedMsgId = null;</span>
<a href="#l17.295"></a><span id="l17.295" class="difflineplus">+      aTab.msgSelectedFolder = null;</span>
<a href="#l17.296"></a><span id="l17.296" class="difflineplus">+    }</span>
<a href="#l17.297"></a><span id="l17.297" class="difflineplus">+  },</span>
<a href="#l17.298"></a><span id="l17.298" class="difflineplus">+</span>
<a href="#l17.299"></a><span id="l17.299" class="difflineplus">+  _folderAndThreadPaneVisible: true,</span>
<a href="#l17.300"></a><span id="l17.300" class="difflineplus">+  get folderAndThreadPaneVisible() { return this._folderAndThreadPaneVisible; },</span>
<a href="#l17.301"></a><span id="l17.301" class="difflineplus">+  set folderAndThreadPaneVisible(aDesiredVisible) {</span>
<a href="#l17.302"></a><span id="l17.302" class="difflineplus">+    if (aDesiredVisible != this._folderAndThreadPaneVisible) {</span>
<a href="#l17.303"></a><span id="l17.303" class="difflineplus">+      DisplayFolderAndThreadPane(aDesiredVisible);</span>
<a href="#l17.304"></a><span id="l17.304" class="difflineplus">+      this._folderAndThreadPaneVisible = aDesiredVisible;</span>
<a href="#l17.305"></a><span id="l17.305">     }</span>
<a href="#l17.306"></a><span id="l17.306" class="difflineminus">-    setMailTabState(this);</span>
<a href="#l17.307"></a><span id="l17.307">   },</span>
<a href="#l17.308"></a><span id="l17.308"> </span>
<a href="#l17.309"></a><span id="l17.309" class="difflineminus">-  onTitleChanged: function(aTab)</span>
<a href="#l17.310"></a><span id="l17.310" class="difflineplus">+  showTab: function(aTab) {</span>
<a href="#l17.311"></a><span id="l17.311" class="difflineplus">+    // restore globals</span>
<a href="#l17.312"></a><span id="l17.312" class="difflineplus">+    messenger = aTab.messenger;</span>
<a href="#l17.313"></a><span id="l17.313" class="difflineplus">+    gDBView = aTab.dbView;</span>
<a href="#l17.314"></a><span id="l17.314" class="difflineplus">+    gSearchSession = aTab.searchSession;</span>
<a href="#l17.315"></a><span id="l17.315" class="difflineplus">+</span>
<a href="#l17.316"></a><span id="l17.316" class="difflineplus">+    // restore view state if we had one</span>
<a href="#l17.317"></a><span id="l17.317" class="difflineplus">+    if (gDBView)</span>
<a href="#l17.318"></a><span id="l17.318">   {</span>
<a href="#l17.319"></a><span id="l17.319" class="difflineminus">-    // the user may have changed folders, triggering our onTitleChanged callback.</span>
<a href="#l17.320"></a><span id="l17.320" class="difflineminus">-    // update the appropriate attributes on the tab.</span>
<a href="#l17.321"></a><span id="l17.321" class="difflineminus">-    aTab.setAttribute('SpecialFolder', getSpecialFolderString(gMsgFolderSelected));</span>
<a href="#l17.322"></a><span id="l17.322" class="difflineminus">-    aTab.setAttribute('ServerType', gMsgFolderSelected.server.type);</span>
<a href="#l17.323"></a><span id="l17.323" class="difflineminus">-    return;</span>
<a href="#l17.324"></a><span id="l17.324" class="difflineminus">-  },</span>
<a href="#l17.325"></a><span id="l17.325" class="difflineminus">-</span>
<a href="#l17.326"></a><span id="l17.326" class="difflineminus">-  get title()</span>
<a href="#l17.327"></a><span id="l17.327" class="difflineplus">+      var folderTree = GetFolderTree();</span>
<a href="#l17.328"></a><span id="l17.328" class="difflineplus">+      var row = EnsureFolderIndex(folderTree.builderView, gDBView.msgFolder);</span>
<a href="#l17.329"></a><span id="l17.329" class="difflineplus">+</span>
<a href="#l17.330"></a><span id="l17.330" class="difflineplus">+      var folderTreeBoxObj = folderTree.treeBoxObject;</span>
<a href="#l17.331"></a><span id="l17.331" class="difflineplus">+      var folderTreeSelection = folderTreeBoxObj.view.selection;</span>
<a href="#l17.332"></a><span id="l17.332" class="difflineplus">+      // make sure that row.value is valid so that it doesn't mess up</span>
<a href="#l17.333"></a><span id="l17.333" class="difflineplus">+      // the call to ensureRowIsVisible().</span>
<a href="#l17.334"></a><span id="l17.334" class="difflineplus">+      if ((row &gt;= 0) &amp;&amp; !folderTreeSelection.isSelected(row))</span>
<a href="#l17.335"></a><span id="l17.335" class="difflineplus">+    {</span>
<a href="#l17.336"></a><span id="l17.336" class="difflineplus">+        gMsgFolderSelected = gDBView.msgFolder;</span>
<a href="#l17.337"></a><span id="l17.337" class="difflineplus">+        folderTreeSelection.selectEventsSuppressed = true;</span>
<a href="#l17.338"></a><span id="l17.338" class="difflineplus">+        folderTreeSelection.select(row);</span>
<a href="#l17.339"></a><span id="l17.339" class="difflineplus">+        folderTreeBoxObj.ensureRowIsVisible(row);</span>
<a href="#l17.340"></a><span id="l17.340" class="difflineplus">+        folderTreeSelection.selectEventsSuppressed = false;</span>
<a href="#l17.341"></a><span id="l17.341" class="difflineplus">+    }</span>
<a href="#l17.342"></a><span id="l17.342" class="difflineplus">+      // this sets the thread pane tree's view to the gDBView view.</span>
<a href="#l17.343"></a><span id="l17.343" class="difflineplus">+      UpdateSortIndicators(gDBView.sortType, gDBView.sortOrder);</span>
<a href="#l17.344"></a><span id="l17.344" class="difflineplus">+      RerootThreadPane();</span>
<a href="#l17.345"></a><span id="l17.345" class="difflineplus">+      // we need to restore the selection to what it was when we switched away</span>
<a href="#l17.346"></a><span id="l17.346" class="difflineplus">+      // from this tab. we need to remember the selected keys, instead of the</span>
<a href="#l17.347"></a><span id="l17.347" class="difflineplus">+      // selected indices, since the view might have changed. But maybe the</span>
<a href="#l17.348"></a><span id="l17.348" class="difflineplus">+      // selectedIndices adjust as items are added/removed from the (hidden)</span>
<a href="#l17.349"></a><span id="l17.349" class="difflineplus">+      // view.</span>
<a href="#l17.350"></a><span id="l17.350" class="difflineplus">+      try</span>
<a href="#l17.351"></a><span id="l17.351" class="difflineplus">+  {</span>
<a href="#l17.352"></a><span id="l17.352" class="difflineplus">+        if (aTab.selectedMsgId &amp;&amp; aTab.msgSelectedFolder)</span>
<a href="#l17.353"></a><span id="l17.353">   {</span>
<a href="#l17.354"></a><span id="l17.354" class="difflineminus">-    // this only works if we are the owner of the current tab...</span>
<a href="#l17.355"></a><span id="l17.355" class="difflineminus">-    return gMsgFolderSelected.prettyName;</span>
<a href="#l17.356"></a><span id="l17.356" class="difflineminus">-  },</span>
<a href="#l17.357"></a><span id="l17.357" class="difflineminus">-</span>
<a href="#l17.358"></a><span id="l17.358" class="difflineminus">-  type : &quot;folder&quot;,</span>
<a href="#l17.359"></a><span id="l17.359" class="difflineplus">+          // we clear the selection in order to generate an event when we</span>
<a href="#l17.360"></a><span id="l17.360" class="difflineplus">+          //  re-select our message.</span>
<a href="#l17.361"></a><span id="l17.361" class="difflineplus">+          ClearThreadPaneSelection();</span>
<a href="#l17.362"></a><span id="l17.362" class="difflineplus">+</span>
<a href="#l17.363"></a><span id="l17.363" class="difflineplus">+          var msgDB = aTab.msgSelectedFolder.getMsgDatabase(msgWindow);</span>
<a href="#l17.364"></a><span id="l17.364" class="difflineplus">+          var msgHdr = msgDB.getMsgHdrForMessageID(aTab.selectedMsgId);</span>
<a href="#l17.365"></a><span id="l17.365" class="difflineplus">+          setTimeout(gDBView.selectFolderMsgByKey, 0, aTab.msgSelectedFolder,</span>
<a href="#l17.366"></a><span id="l17.366" class="difflineplus">+                     msgHdr.messageKey);</span>
<a href="#l17.367"></a><span id="l17.367" class="difflineplus">+        }</span>
<a href="#l17.368"></a><span id="l17.368" class="difflineplus">+        // (we do not clear the selection if there was more than one message</span>
<a href="#l17.369"></a><span id="l17.369" class="difflineplus">+        //  displayed.  this leaves our selection intact. there was originally</span>
<a href="#l17.370"></a><span id="l17.370" class="difflineplus">+        //  some claim that the selection might lose synchronization with the</span>
<a href="#l17.371"></a><span id="l17.371" class="difflineplus">+        //  view, but this is unsubstantiated.  said comment came from the</span>
<a href="#l17.372"></a><span id="l17.372" class="difflineplus">+        //  original code that stored information on the selected rows, but</span>
<a href="#l17.373"></a><span id="l17.373" class="difflineplus">+        //  then failed to do anything with it, probably because there is no</span>
<a href="#l17.374"></a><span id="l17.374" class="difflineplus">+        //  existing API call that accomplishes it.)</span>
<a href="#l17.375"></a><span id="l17.375" class="difflineplus">+      }</span>
<a href="#l17.376"></a><span id="l17.376" class="difflineplus">+      catch (ex) {dump(ex);}</span>
<a href="#l17.377"></a><span id="l17.377" class="difflineplus">+    }</span>
<a href="#l17.378"></a><span id="l17.378" class="difflineplus">+    // make sure the folder tree knows that we don't have a view</span>
<a href="#l17.379"></a><span id="l17.379" class="difflineplus">+    else</span>
<a href="#l17.380"></a><span id="l17.380" class="difflineplus">+    {</span>
<a href="#l17.381"></a><span id="l17.381" class="difflineplus">+      var tree = GetThreadTree();</span>
<a href="#l17.382"></a><span id="l17.382" class="difflineplus">+      tree.boxObject.QueryInterface(Ci.nsITreeBoxObject).view = null;</span>
<a href="#l17.383"></a><span id="l17.383" class="difflineplus">+      ClearMessagePane();</span>
<a href="#l17.384"></a><span id="l17.384" class="difflineplus">+    }</span>
<a href="#l17.385"></a><span id="l17.385" class="difflineplus">+  }</span>
<a href="#l17.386"></a><span id="l17.386"> };</span>
<a href="#l17.387"></a><span id="l17.387" class="difflineminus">-</span>
<a href="#l17.388"></a><span id="l17.388" class="difflineminus">-function messageTabOwner()</span>
<a href="#l17.389"></a><span id="l17.389" class="difflineminus">-{</span>
<a href="#l17.390"></a><span id="l17.390" class="difflineminus">-  saveMailTabInfo(this);</span>
<a href="#l17.391"></a><span id="l17.391" class="difflineminus">-}</span>
<a href="#l17.392"></a><span id="l17.392" class="difflineminus">-</span>
<a href="#l17.393"></a><span id="l17.393" class="difflineminus">-messageTabOwner.prototype =</span>
<a href="#l17.394"></a><span id="l17.394" class="difflineminus">-{</span>
<a href="#l17.395"></a><span id="l17.395" class="difflineminus">-  open : function ()</span>
<a href="#l17.396"></a><span id="l17.396" class="difflineminus">-  {</span>
<a href="#l17.397"></a><span id="l17.397" class="difflineminus">-    openFolderTab(this);</span>
<a href="#l17.398"></a><span id="l17.398" class="difflineminus">-    gCurrentlyDisplayedMessage = -1;</span>
<a href="#l17.399"></a><span id="l17.399" class="difflineminus">-    ClearThreadPaneSelection();</span>
<a href="#l17.400"></a><span id="l17.400" class="difflineminus">-    setTimeout(gDBView.selectFolderMsgByKey, 0, this.hdr.folder, this.hdr.messageKey);</span>
<a href="#l17.401"></a><span id="l17.401" class="difflineminus">-    // let's try hiding the thread pane and folder pane</span>
<a href="#l17.402"></a><span id="l17.402" class="difflineminus">-    DisplayFolderAndThreadPane(false);</span>
<a href="#l17.403"></a><span id="l17.403" class="difflineminus">-  },</span>
<a href="#l17.404"></a><span id="l17.404" class="difflineminus">-</span>
<a href="#l17.405"></a><span id="l17.405" class="difflineminus">-  close : function () </span>
<a href="#l17.406"></a><span id="l17.406" class="difflineminus">-  {</span>
<a href="#l17.407"></a><span id="l17.407" class="difflineminus">-    if (this.dbView)</span>
<a href="#l17.408"></a><span id="l17.408" class="difflineminus">-      this.dbView.close();</span>
<a href="#l17.409"></a><span id="l17.409" class="difflineminus">-    if (this.messenger)</span>
<a href="#l17.410"></a><span id="l17.410" class="difflineminus">-      this.messenger.setWindow(null, null);</span>
<a href="#l17.411"></a><span id="l17.411" class="difflineminus">-  },</span>
<a href="#l17.412"></a><span id="l17.412" class="difflineminus">-</span>
<a href="#l17.413"></a><span id="l17.413" class="difflineminus">-  saveCurrentInfo : function()</span>
<a href="#l17.414"></a><span id="l17.414" class="difflineminus">-  {</span>
<a href="#l17.415"></a><span id="l17.415" class="difflineminus">-    saveMailTabInfo(this);</span>
<a href="#l17.416"></a><span id="l17.416" class="difflineminus">-  },</span>
<a href="#l17.417"></a><span id="l17.417" class="difflineminus">-</span>
<a href="#l17.418"></a><span id="l17.418" class="difflineminus">-  onSelect : function(aPreviousTabOwner)</span>
<a href="#l17.419"></a><span id="l17.419" class="difflineminus">-  {</span>
<a href="#l17.420"></a><span id="l17.420" class="difflineminus">-    if (aPreviousTabOwner.type != this.type)</span>
<a href="#l17.421"></a><span id="l17.421" class="difflineminus">-    {</span>
<a href="#l17.422"></a><span id="l17.422" class="difflineminus">-      ClearMessagePane();</span>
<a href="#l17.423"></a><span id="l17.423" class="difflineminus">-      DisplayFolderAndThreadPane(false);</span>
<a href="#l17.424"></a><span id="l17.424" class="difflineplus">+window.addEventListener(&quot;load&quot;, function(e) {</span>
<a href="#l17.425"></a><span id="l17.425" class="difflineplus">+    let tabmail = document.getElementById('tabmail');</span>
<a href="#l17.426"></a><span id="l17.426" class="difflineplus">+    if (tabmail) {</span>
<a href="#l17.427"></a><span id="l17.427" class="difflineplus">+      tabmail.registerTabType(mailTabType);</span>
<a href="#l17.428"></a><span id="l17.428" class="difflineplus">+      tabmail.openFirstTab();</span>
<a href="#l17.429"></a><span id="l17.429">     }</span>
<a href="#l17.430"></a><span id="l17.430" class="difflineminus">-    setMailTabState(this);</span>
<a href="#l17.431"></a><span id="l17.431" class="difflineminus">-  },</span>
<a href="#l17.432"></a><span id="l17.432" class="difflineminus">-</span>
<a href="#l17.433"></a><span id="l17.433" class="difflineminus">-  onTitleChanged: function(aTab)</span>
<a href="#l17.434"></a><span id="l17.434" class="difflineminus">-  {</span>
<a href="#l17.435"></a><span id="l17.435" class="difflineminus">-    return;</span>
<a href="#l17.436"></a><span id="l17.436" class="difflineminus">-  },</span>
<a href="#l17.437"></a><span id="l17.437" class="difflineminus">-</span>
<a href="#l17.438"></a><span id="l17.438" class="difflineminus">-  get title()</span>
<a href="#l17.439"></a><span id="l17.439" class="difflineminus">-  {</span>
<a href="#l17.440"></a><span id="l17.440" class="difflineminus">-    return this.hdr.mime2DecodedSubject;</span>
<a href="#l17.441"></a><span id="l17.441" class="difflineminus">-  },</span>
<a href="#l17.442"></a><span id="l17.442" class="difflineminus">-</span>
<a href="#l17.443"></a><span id="l17.443" class="difflineminus">-  type : &quot;message&quot;,</span>
<a href="#l17.444"></a><span id="l17.444" class="difflineminus">-};</span>
<a href="#l17.445"></a><span id="l17.445" class="difflineplus">+  }, false);</span>
<a href="#l17.446"></a><span id="l17.446"> </span>
<a href="#l17.447"></a><span id="l17.447"> function MsgOpenNewTabForFolder(uri, key)</span>
<a href="#l17.448"></a><span id="l17.448"> {</span>
<a href="#l17.449"></a><span id="l17.449">   var uriToOpen = uri;</span>
<a href="#l17.450"></a><span id="l17.450">   var keyToSelect = key;</span>
<a href="#l17.451"></a><span id="l17.451">   </span>
<a href="#l17.452"></a><span id="l17.452">   if (!uriToOpen)</span>
<a href="#l17.453"></a><span id="l17.453">     // use GetSelectedFolderURI() to find out which message to open instead of</span>
<a href="#l17.454"></a><span id="l17.454" class="difflineat">@@ -1579,19 +1552,17 @@ function MsgOpenNewTabForFolder(uri, key</span>
<a href="#l17.455"></a><span id="l17.455">     // highlighted. GetSelectedFolderURI() will return the message that is</span>
<a href="#l17.456"></a><span id="l17.456">     // highlighted.</span>
<a href="#l17.457"></a><span id="l17.457">     uriToOpen = GetSelectedFolderURI();</span>
<a href="#l17.458"></a><span id="l17.458">   </span>
<a href="#l17.459"></a><span id="l17.459">   // set up the first tab, which was previously invisible.</span>
<a href="#l17.460"></a><span id="l17.460">   // This assumes the first tab is always a 3-pane ui, which</span>
<a href="#l17.461"></a><span id="l17.461">   // may not be right, especially if we have the ability</span>
<a href="#l17.462"></a><span id="l17.462">   // to persist your tab setup.</span>
<a href="#l17.463"></a><span id="l17.463" class="difflineminus">-  var newTab = new folderTabOwner();</span>
<a href="#l17.464"></a><span id="l17.464" class="difflineminus">-  newTab.uriToOpen = uriToOpen;</span>
<a href="#l17.465"></a><span id="l17.465" class="difflineminus">-  document.getElementById('tabmail').addTab(newTab);</span>
<a href="#l17.466"></a><span id="l17.466" class="difflineplus">+  document.getElementById('tabmail').openTab(&quot;folder&quot;, uriToOpen);</span>
<a href="#l17.467"></a><span id="l17.467"> }</span>
<a href="#l17.468"></a><span id="l17.468"> </span>
<a href="#l17.469"></a><span id="l17.469"> function MsgOpenNewTabForMessage(messageKey, folderUri)</span>
<a href="#l17.470"></a><span id="l17.470"> {</span>
<a href="#l17.471"></a><span id="l17.471">   if (!messageKey)</span>
<a href="#l17.472"></a><span id="l17.472">     messageKey = gDBView.keyForFirstSelectedMessage;</span>
<a href="#l17.473"></a><span id="l17.473"> </span>
<a href="#l17.474"></a><span id="l17.474">   var hdr = gDBView.hdrForFirstSelectedMessage;</span>
<a href="#l17.475"></a><span id="l17.475" class="difflineat">@@ -1600,20 +1571,17 @@ function MsgOpenNewTabForMessage(message</span>
<a href="#l17.476"></a><span id="l17.476">     // in its real folder, which is needed if the msg wouldn't be in a new</span>
<a href="#l17.477"></a><span id="l17.477">     // view with the same terms - e.g., it's read and the view is unread only.</span>
<a href="#l17.478"></a><span id="l17.478">     // If we cloned the view, we wouldn't have to do this.</span>
<a href="#l17.479"></a><span id="l17.479">     folderUri = hdr.folder.URI;</span>
<a href="#l17.480"></a><span id="l17.480">   </span>
<a href="#l17.481"></a><span id="l17.481">   // fix it so we won't try to load the previously loaded message.</span>
<a href="#l17.482"></a><span id="l17.482">   hdr.folder.lastMessageLoaded = nsMsgKey_None;</span>
<a href="#l17.483"></a><span id="l17.483">   </span>
<a href="#l17.484"></a><span id="l17.484" class="difflineminus">-  tab = new messageTabOwner();</span>
<a href="#l17.485"></a><span id="l17.485" class="difflineminus">-  tab.uriToOpen = folderUri;</span>
<a href="#l17.486"></a><span id="l17.486" class="difflineminus">-  tab.hdr = hdr;</span>
<a href="#l17.487"></a><span id="l17.487" class="difflineminus">-  document.getElementById('tabmail').addTab(tab);</span>
<a href="#l17.488"></a><span id="l17.488" class="difflineplus">+  document.getElementById('tabmail').openTab(&quot;message&quot;, folderUri, hdr);</span>
<a href="#l17.489"></a><span id="l17.489"> }</span>
<a href="#l17.490"></a><span id="l17.490"> </span>
<a href="#l17.491"></a><span id="l17.491"> // passing in the view, so this will work for search and the thread pane</span>
<a href="#l17.492"></a><span id="l17.492"> function MsgOpenSelectedMessages()</span>
<a href="#l17.493"></a><span id="l17.493"> {</span>
<a href="#l17.494"></a><span id="l17.494">   var dbView = GetDBView();</span>
<a href="#l17.495"></a><span id="l17.495"> </span>
<a href="#l17.496"></a><span id="l17.496">   var indices = GetSelectedIndices(dbView);</span>
<a href="#l17.497"></a><span id="l17.497" class="difflineat">@@ -2314,17 +2282,17 @@ function SendUnsentMessages()</span>
<a href="#l17.498"></a><span id="l17.498"> function CoalesceGetMsgsForPop3ServersByDestFolder(currentServer, pop3DownloadServersArray, localFoldersToDownloadTo)</span>
<a href="#l17.499"></a><span id="l17.499"> {</span>
<a href="#l17.500"></a><span id="l17.500">   var outNumFolders = new Object();</span>
<a href="#l17.501"></a><span id="l17.501">   var inboxFolder = currentServer.rootMsgFolder.getFolderWithFlags(0x1000); </span>
<a href="#l17.502"></a><span id="l17.502">   // coalesce the servers that download into the same folder...</span>
<a href="#l17.503"></a><span id="l17.503">   var index = localFoldersToDownloadTo.GetIndexOf(inboxFolder);</span>
<a href="#l17.504"></a><span id="l17.504">   if (index == -1)</span>
<a href="#l17.505"></a><span id="l17.505">   {</span>
<a href="#l17.506"></a><span id="l17.506" class="difflineminus">-    if(inboxFolder) </span>
<a href="#l17.507"></a><span id="l17.507" class="difflineplus">+    if (inboxFolder)</span>
<a href="#l17.508"></a><span id="l17.508">     {</span>
<a href="#l17.509"></a><span id="l17.509">       inboxFolder.biffState =  Components.interfaces.nsIMsgFolder.nsMsgBiffState_NoMail;</span>
<a href="#l17.510"></a><span id="l17.510">       inboxFolder.clearNewMessages();</span>
<a href="#l17.511"></a><span id="l17.511">     }</span>
<a href="#l17.512"></a><span id="l17.512">     localFoldersToDownloadTo.AppendElement(inboxFolder);</span>
<a href="#l17.513"></a><span id="l17.513">     index = pop3DownloadServersArray.length</span>
<a href="#l17.514"></a><span id="l17.514">     pop3DownloadServersArray[index] = Components.classes[&quot;@mozilla.org/supports-array;1&quot;].createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l17.515"></a><span id="l17.515">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/base/content/messenger.xul</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/base/content/messenger.xul</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -168,17 +168,19 @@</span>
<a href="#l18.4"></a><span id="l18.4"> &lt;popup id=&quot;messageIdContext&quot;/&gt;</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6"> &lt;tooltip id=&quot;folderpopup&quot; class=&quot;folderSummaryPopup&quot;/&gt;</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8"> &lt;popup id=&quot;messagePaneContext&quot;/&gt;</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">   &lt;toolbox id=&quot;mail-toolbox&quot; class=&quot;toolbox-top&quot;&gt;</span>
<a href="#l18.11"></a><span id="l18.11">   &lt;/toolbox&gt;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  &lt;tabmail id=&quot;tabmail&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  &lt;tabmail id=&quot;tabmail&quot; flex=&quot;1&quot; panelcontainer=&quot;tabpanelcontainer&quot;&gt;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+  &lt;box id=&quot;tabmail-buttons&quot; orientation=&quot;horizontal&quot;/&gt;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+  &lt;tabpanels id=&quot;tabpanelcontainer&quot; flex=&quot;1&quot; class=&quot;plain&quot; selectedIndex=&quot;0&quot;&gt;</span>
<a href="#l18.16"></a><span id="l18.16">     &lt;box id=&quot;mailContent&quot; orient=&quot;vertical&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l18.17"></a><span id="l18.17">     &lt;box id=&quot;messengerBox&quot; orient=&quot;horizontal&quot; flex=&quot;1&quot; minheight=&quot;100&quot; height=&quot;100&quot; persist=&quot;height&quot;&gt;</span>
<a href="#l18.18"></a><span id="l18.18">     &lt;vbox id=&quot;folderPaneBox&quot; minwidth=&quot;100&quot; width=&quot;200&quot; persist=&quot;collapsed width&quot;&gt;</span>
<a href="#l18.19"></a><span id="l18.19">       &lt;label id=&quot;folderColumnLabel&quot; hidden=&quot;true&quot; value=&quot;&amp;folderColumn.label;&quot;/&gt;</span>
<a href="#l18.20"></a><span id="l18.20">       &lt;sidebarheader id=&quot;folderPaneHeader&quot; align=&quot;center&quot;&gt;</span>
<a href="#l18.21"></a><span id="l18.21">         &lt;label id=&quot;folderpane-title&quot;/&gt;</span>
<a href="#l18.22"></a><span id="l18.22">         &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l18.23"></a><span id="l18.23">         &lt;toolbarbutton id=&quot;folderview-cycler-left&quot;  class=&quot;folderview-cycler&quot;</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineat">@@ -426,17 +428,17 @@</span>
<a href="#l18.25"></a><span id="l18.25">           &lt;splitter id=&quot;attachment-splitter&quot; collapse=&quot;after&quot; resizebefore=&quot;closest&quot; resizeafter=&quot;closest&quot; collapsed=&quot;true&quot;/&gt;</span>
<a href="#l18.26"></a><span id="l18.26">           &lt;hbox id=&quot;attachmentView&quot;/&gt;</span>
<a href="#l18.27"></a><span id="l18.27">           &lt;findbar id=&quot;FindToolbar&quot; browserid=&quot;messagepane&quot;/&gt;</span>
<a href="#l18.28"></a><span id="l18.28">         &lt;/vbox&gt;</span>
<a href="#l18.29"></a><span id="l18.29">       &lt;/box&gt;</span>
<a href="#l18.30"></a><span id="l18.30">     &lt;/vbox&gt;</span>
<a href="#l18.31"></a><span id="l18.31">   &lt;/box&gt;</span>
<a href="#l18.32"></a><span id="l18.32">   &lt;/box&gt; &lt;!-- end of mailContent --&gt;</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+  &lt;/tabpanels&gt;</span>
<a href="#l18.35"></a><span id="l18.35">     &lt;/tabmail&gt;</span>
<a href="#l18.36"></a><span id="l18.36"> #ifdef TOOLBAR_CUSTOMIZATION_SHEET</span>
<a href="#l18.37"></a><span id="l18.37">   &lt;panel id=&quot;customizeToolbarSheetPopup&quot; noautohide=&quot;true&quot;&gt;</span>
<a href="#l18.38"></a><span id="l18.38">     &lt;iframe id=&quot;customizeToolbarSheetIFrame&quot;</span>
<a href="#l18.39"></a><span id="l18.39">             style=&quot;&amp;dialog.style;&quot;</span>
<a href="#l18.40"></a><span id="l18.40">             hidden=&quot;true&quot;/&gt;</span>
<a href="#l18.41"></a><span id="l18.41">   &lt;/panel&gt;</span>
<a href="#l18.42"></a><span id="l18.42"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -16,16 +16,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> #</span>
<a href="#l19.5"></a><span id="l19.5"> # The Initial Developer of the Original Code is</span>
<a href="#l19.6"></a><span id="l19.6"> #   David Bienvenu &lt;bienvenu@nventure.com&gt;.</span>
<a href="#l19.7"></a><span id="l19.7"> # Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l19.8"></a><span id="l19.8"> # the Initial Developer. All Rights Reserved.</span>
<a href="#l19.9"></a><span id="l19.9"> #</span>
<a href="#l19.10"></a><span id="l19.10"> # Contributor(s):</span>
<a href="#l19.11"></a><span id="l19.11"> #  Scott MacGregor &lt;mscott@mozilla.org&gt;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+#  Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l19.13"></a><span id="l19.13"> #</span>
<a href="#l19.14"></a><span id="l19.14"> # Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l19.15"></a><span id="l19.15"> # either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l19.16"></a><span id="l19.16"> # the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l19.17"></a><span id="l19.17"> # in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l19.18"></a><span id="l19.18"> # of those above. If you wish to allow use of your version of this file only</span>
<a href="#l19.19"></a><span id="l19.19"> # under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l19.20"></a><span id="l19.20"> # use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineat">@@ -45,196 +46,483 @@</span>
<a href="#l19.22"></a><span id="l19.22">  %globalDTD;</span>
<a href="#l19.23"></a><span id="l19.23"> ]&gt;</span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25"> &lt;bindings id=&quot;tabmailBindings&quot;</span>
<a href="#l19.26"></a><span id="l19.26">    xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l19.27"></a><span id="l19.27">    xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l19.28"></a><span id="l19.28">    xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l19.29"></a><span id="l19.29"> </span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+  &lt;!-- Thunderbird's tab UI mechanism.</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+    -</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+    - We expect to be instantiated with the following children:</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+    - * One &quot;tabpanels&quot; child element whose id must be placed in the</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+    -   &quot;panelcontainer&quot; attribute on the element we are being bound to. We do</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+    -   this because it is important to allow overlays to contribute panels.</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+    -   When we attempted to have the immediate children of the bound element</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+    -   be propagated through use of the &quot;children&quot; tag, we found that children</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+    -   contributed by overlays did not propagate.</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+    - * Any children you want added to the right side of the tab bar.  This is</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+    -   primarily intended to allow for &quot;open a BLANK tab&quot; buttons, namely</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineplus">+    -   calendar and tasks.  For reasons similar to the tabpanels case, we</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+    -   expect the instantiating element to provide a child hbox for overlays</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+    -   to contribute buttons to.</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+    -</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+    - From a javascript perspective, there are three types of code that we</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+    -  expect to interact with:</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+    - 1) Code that wants to open new tabs.</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+    - 2) Code that wants to contribute one or more varieties of tabs.</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+    - 3) Code that wants to monitor to know when the active tab changes.</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+    -</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+    - Consumer code should use the following methods:</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineplus">+    - * openTab(aTabModeName, arguments...): Open a tab of the given &quot;mode&quot;,</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+    -   passing the provided arguments.  The tab type author should tell you</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineplus">+    -   the modes they implement and the required/optional arguments.</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineplus">+    - * setTabTitle([aOptionalTabNode]): Tells us that the title of the current</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+    -   tab (if no argument is provided) or provided tab needs to be updated.</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineplus">+    -   This will result in a call to the tab mode's logic to update the title.</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineplus">+    -   In the event this is not for the current tab, the caller is responsible</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineplus">+    -   for ensuring that the underlying tab mode is capable of providing a tab</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineplus">+    -   title when it is in the background.  (The is currently not the case for</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineplus">+    -   &quot;folder&quot; and &quot;mail&quot; modes because of their implementation.)</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineplus">+    - * removeCurrentTab(): Close the current tab.</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineplus">+    - * removeTabByNode(aTabElement): Close the tab whose tabmail-tab bound</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineplus">+    -   element is passed in.</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineplus">+    - Changing the currently displayed tab is accomplished by changing</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineplus">+    -  tabmail.tabContainer's selectedIndex or selectedItem property.</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineplus">+    -</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineplus">+    - Tab contributing code should define a tab type object and register it</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineplus">+    -  with us by calling registerTabType.  Each tab type can provide multiple</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineplus">+    -  tab modes.  The rationale behind this organization is that Thunderbird</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineplus">+    -  historically/currently uses a single 3-pane view to display both</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineplus">+    -  three-pane folder browsing and single message browsing across multiple</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineplus">+    -  tabs.  Each tab type has the ability to use a single tab panel for all</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineplus">+    -  of its display needs.  So Thunderbird's &quot;mail&quot; tab type covers both the</span>
<a href="#l19.75"></a><span id="l19.75" class="difflineplus">+    -  &quot;folder&quot; (3-pane folder-based browsing)  and &quot;message&quot; (just a single</span>
<a href="#l19.76"></a><span id="l19.76" class="difflineplus">+    -  message) tab modes.  Likewise, calendar/lightning currently displays both</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineplus">+    -  its calendar and tasks in the same panel.  A tab type can also create a</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineplus">+    -  new tabpanel for each tab as it is created.  In that case, the tab type </span>
<a href="#l19.79"></a><span id="l19.79" class="difflineplus">+    -  should probably only have a single mode unless there are a number of</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineplus">+    -  similar modes that can gain from code sharing.</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineplus">+    - The tab type definition should include the following attributes:</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineplus">+    - * name: The name of the tab-type, mainly to aid in debugging.</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineplus">+    - * panelId or perTabPanel: If using a single tab panel, the id of the</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineplus">+    -     panel must be provided in panelId.  If using one tab panel per tab,</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineplus">+    -     perTabPanel should be the XUL element name that should be created for</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineplus">+    -     each tab.  If a reason arises, in the future we might support</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineplus">+    -     this being a helper function to create and return the element.</span>
<a href="#l19.88"></a><span id="l19.88" class="difflineplus">+    - * modes: An object whose attributes are mode names (which are</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineplus">+    -     automatically propagated to a 'name' attribute for debugging) and</span>
<a href="#l19.90"></a><span id="l19.90" class="difflineplus">+    -     values are objects with the following attributes...</span>
<a href="#l19.91"></a><span id="l19.91" class="difflineplus">+    - * any of the openTab/closeTab/saveTabState/showTab/onTitleChanged</span>
<a href="#l19.92"></a><span id="l19.92" class="difflineplus">+    -     functions as described on the mode definitions.  These will only be</span>
<a href="#l19.93"></a><span id="l19.93" class="difflineplus">+    -     called if the mode does not provide the functions.  Note that because</span>
<a href="#l19.94"></a><span id="l19.94" class="difflineplus">+    -     the 'this' variable passed to the functions will always reference the</span>
<a href="#l19.95"></a><span id="l19.95" class="difflineplus">+    -     tab type definition (rather than the mode definition), the mode</span>
<a href="#l19.96"></a><span id="l19.96" class="difflineplus">+    -     functions can defer to the tab type functions by calling </span>
<a href="#l19.97"></a><span id="l19.97" class="difflineplus">+    -     this.functionName().  (This should prove convenient.)</span>
<a href="#l19.98"></a><span id="l19.98" class="difflineplus">+    - Mode definition attributes:</span>
<a href="#l19.99"></a><span id="l19.99" class="difflineplus">+    - * type: The &quot;type&quot; attribute to set on the displayed tab for CSS purposes.</span>
<a href="#l19.100"></a><span id="l19.100" class="difflineplus">+    -     Generally, this would be the same as the mode name, but you can do as</span>
<a href="#l19.101"></a><span id="l19.101" class="difflineplus">+    -     you please.</span>
<a href="#l19.102"></a><span id="l19.102" class="difflineplus">+    - * isDefault: This should only be present and should be true for the tab</span>
<a href="#l19.103"></a><span id="l19.103" class="difflineplus">+    -     mode that is the tab displayed automatically on startup.</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineplus">+    - * maxTabs: The maximum number of this mode that can be opened at a time.</span>
<a href="#l19.105"></a><span id="l19.105" class="difflineplus">+    -     If this limit is reached, any additional calls to openTab for this</span>
<a href="#l19.106"></a><span id="l19.106" class="difflineplus">+    -     mode will simply result in the first existing tab of this mode being</span>
<a href="#l19.107"></a><span id="l19.107" class="difflineplus">+    -     displayed.</span>
<a href="#l19.108"></a><span id="l19.108" class="difflineplus">+    - * openTab(aTab, arguments...): Called when a tab of the given mode is</span>
<a href="#l19.109"></a><span id="l19.109" class="difflineplus">+    -     in the process of being opened.  aTab will have its &quot;mode&quot; attribute</span>
<a href="#l19.110"></a><span id="l19.110" class="difflineplus">+    -     set to the mode definition of the tab mode being opened.  You should</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineplus">+    -     set the &quot;title&quot; attribute on it, and may set any other attributes</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineplus">+    -     you wish for your own use in subsequent functions.  Note that 'this'</span>
<a href="#l19.113"></a><span id="l19.113" class="difflineplus">+    -     points to the tab type definition, not the mode definition as you</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineplus">+    -     might expect.  This allows you to place common logic code on the</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineplus">+    -     tab type for use by multiple modes and to defer to it.  Any arguments</span>
<a href="#l19.116"></a><span id="l19.116" class="difflineplus">+    -     provided to the caller of tabmail.openTab will be passed to your</span>
<a href="#l19.117"></a><span id="l19.117" class="difflineplus">+    -     function as well.</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineplus">+    - * closeTab(aTab): Called when aTab is being closed.  The tab need not be</span>
<a href="#l19.119"></a><span id="l19.119" class="difflineplus">+    -     currently displayed.  You are responsible for properly cleaning up</span>
<a href="#l19.120"></a><span id="l19.120" class="difflineplus">+    -     any state you preserved in aTab.</span>
<a href="#l19.121"></a><span id="l19.121" class="difflineplus">+    - * saveTabState(aTab): Called when aTab is being switched away from so that</span>
<a href="#l19.122"></a><span id="l19.122" class="difflineplus">+    -     you can preserve its state on aTab.  This is primarily for single</span>
<a href="#l19.123"></a><span id="l19.123" class="difflineplus">+    -     tab panel implementations; you may not have much state to save if your</span>
<a href="#l19.124"></a><span id="l19.124" class="difflineplus">+    -     tab has its own tab panel.</span>
<a href="#l19.125"></a><span id="l19.125" class="difflineplus">+    - * showTab(aTab): Called when aTab is being displayed and you should</span>
<a href="#l19.126"></a><span id="l19.126" class="difflineplus">+    -     restore its state (if required).</span>
<a href="#l19.127"></a><span id="l19.127" class="difflineplus">+    - * onTitleChanged(aTab): Called when someone calls tabmail.setTabTitle() to</span>
<a href="#l19.128"></a><span id="l19.128" class="difflineplus">+    -     hint that the tab's title needs to be updated.  This function should</span>
<a href="#l19.129"></a><span id="l19.129" class="difflineplus">+    -     update aTab.title if it can.</span>
<a href="#l19.130"></a><span id="l19.130" class="difflineplus">+    -</span>
<a href="#l19.131"></a><span id="l19.131" class="difflineplus">+    - Tab monitoring code is expected to be used for widgets on the screen</span>
<a href="#l19.132"></a><span id="l19.132" class="difflineplus">+    -  outside of the tab box that need to update themselves as the active tab</span>
<a href="#l19.133"></a><span id="l19.133" class="difflineplus">+    -  changes.  This is primarily intended to be used for the ThunderBar; if</span>
<a href="#l19.134"></a><span id="l19.134" class="difflineplus">+    -  you are not the ThunderBar and this sounds appealing to you, please</span>
<a href="#l19.135"></a><span id="l19.135" class="difflineplus">+    -  solicit discussion on your needs on the mozilla.dev.apps.thunderbird</span>
<a href="#l19.136"></a><span id="l19.136" class="difflineplus">+    -  newsgroup.</span>
<a href="#l19.137"></a><span id="l19.137" class="difflineplus">+    - Tab monitoring code (un)registers itself via (un)registerTabMonitor.</span>
<a href="#l19.138"></a><span id="l19.138" class="difflineplus">+    -  The following functions should be provided on the monitor object:</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineplus">+    - * onTabTitleChanged(aTab): Called when the tab's title changes.</span>
<a href="#l19.140"></a><span id="l19.140" class="difflineplus">+    - * onTabSwitched(aTab, aOldTab): Called when a new tab is made active.  If</span>
<a href="#l19.141"></a><span id="l19.141" class="difflineplus">+    -     this is the first tab ever, aOldTab will be null, otherwise aOldTab</span>
<a href="#l19.142"></a><span id="l19.142" class="difflineplus">+    -     will be the previously active tab.</span>
<a href="#l19.143"></a><span id="l19.143" class="difflineplus">+    --&gt;</span>
<a href="#l19.144"></a><span id="l19.144">   &lt;binding id=&quot;tabmail&quot;&gt;</span>
<a href="#l19.145"></a><span id="l19.145">     &lt;resources&gt;</span>
<a href="#l19.146"></a><span id="l19.146">       &lt;stylesheet src=&quot;chrome://messenger/skin/tabmail.css&quot;/&gt;</span>
<a href="#l19.147"></a><span id="l19.147">     &lt;/resources&gt;</span>
<a href="#l19.148"></a><span id="l19.148">     &lt;content&gt;</span>
<a href="#l19.149"></a><span id="l19.149">       &lt;xul:tabbox anonid=&quot;tabbox&quot; flex=&quot;1&quot; eventnode=&quot;document&quot; xbl:inherits=&quot;handleCtrlPageUpDown&quot;</span>
<a href="#l19.150"></a><span id="l19.150" class="difflineminus">-                  onselect=&quot;if (!('updateCurrentMailTab' in this.parentNode) || event.target.localName != 'tabs')</span>
<a href="#l19.151"></a><span id="l19.151" class="difflineminus">-                            return; this.parentNode.updateCurrentMailTab();&quot;&gt;</span>
<a href="#l19.152"></a><span id="l19.152" class="difflineplus">+                  onselect=&quot;if (!('updateCurrentTab' in this.parentNode) || event.target.localName != 'tabs')</span>
<a href="#l19.153"></a><span id="l19.153" class="difflineplus">+                            return; this.parentNode.updateCurrentTab();&quot;&gt;</span>
<a href="#l19.154"></a><span id="l19.154">         &lt;xul:hbox class=&quot;tab-drop-indicator-bar&quot;&gt;</span>
<a href="#l19.155"></a><span id="l19.155">           &lt;xul:hbox class=&quot;tab-drop-indicator&quot; mousethrough=&quot;always&quot;/&gt;</span>
<a href="#l19.156"></a><span id="l19.156">         &lt;/xul:hbox&gt;</span>
<a href="#l19.157"></a><span id="l19.157" class="difflineminus">-        &lt;xul:hbox class=&quot;tabmail-strip&quot; collapsed=&quot;true&quot; tooltip=&quot;_child&quot; context=&quot;_child&quot;</span>
<a href="#l19.158"></a><span id="l19.158" class="difflineplus">+        &lt;xul:hbox class=&quot;tabmail-strip&quot; collapsed=&quot;false&quot; tooltip=&quot;_child&quot; context=&quot;_child&quot;</span>
<a href="#l19.159"></a><span id="l19.159">                   anonid=&quot;strip&quot;</span>
<a href="#l19.160"></a><span id="l19.160">                   ondraggesture=&quot;nsDragAndDrop.startDrag(event, this.parentNode.parentNode); event.stopPropagation();&quot;</span>
<a href="#l19.161"></a><span id="l19.161">                   ondragover=&quot;nsDragAndDrop.dragOver(event, this.parentNode.parentNode); event.stopPropagation();&quot;</span>
<a href="#l19.162"></a><span id="l19.162">                   ondragdrop=&quot;nsDragAndDrop.drop(event, this.parentNode.parentNode); event.stopPropagation();&quot;</span>
<a href="#l19.163"></a><span id="l19.163">                   ondragexit=&quot;nsDragAndDrop.dragExit(event, this.parentNode.parentNode); event.stopPropagation();&quot;&gt;</span>
<a href="#l19.164"></a><span id="l19.164">           &lt;xul:tooltip onpopupshowing=&quot;return CreateToolbarTooltip(document, event);&quot;/&gt;</span>
<a href="#l19.165"></a><span id="l19.165">           &lt;xul:menupopup anonid=&quot;tabContextMenu&quot;&gt;</span>
<a href="#l19.166"></a><span id="l19.166">             &lt;xul:menuitem label=&quot;&amp;closeTabCmd.label;&quot; accesskey=&quot;&amp;closeTabCmd.accesskey;&quot;</span>
<a href="#l19.167"></a><span id="l19.167">                           oncommand=&quot;var tabmail = this.parentNode.parentNode.parentNode.parentNode;</span>
<a href="#l19.168"></a><span id="l19.168" class="difflineminus">-                                     tabmail.removeTab(document.popupNode);&quot;/&gt;</span>
<a href="#l19.169"></a><span id="l19.169" class="difflineplus">+                                     tabmail.removeTabByNode(document.popupNode);&quot;/&gt;</span>
<a href="#l19.170"></a><span id="l19.170">           &lt;/xul:menupopup&gt;</span>
<a href="#l19.171"></a><span id="l19.171">           &lt;xul:tabs class=&quot;tabmail-tabs&quot; flex=&quot;1&quot;</span>
<a href="#l19.172"></a><span id="l19.172">                     anonid=&quot;tabcontainer&quot;</span>
<a href="#l19.173"></a><span id="l19.173">                     setfocus=&quot;false&quot;</span>
<a href="#l19.174"></a><span id="l19.174">                     onclick=&quot;this.parentNode.parentNode.parentNode.onTabClick(event);&quot;&gt;</span>
<a href="#l19.175"></a><span id="l19.175">             &lt;xul:tab selected=&quot;true&quot; validate=&quot;never&quot; type=&quot;folder&quot;</span>
<a href="#l19.176"></a><span id="l19.176">                      maxwidth=&quot;250&quot; width=&quot;0&quot; minwidth=&quot;100&quot; flex=&quot;100&quot;</span>
<a href="#l19.177"></a><span id="l19.177" class="difflineminus">-                     class=&quot;tabmail-tab tabmail-tab&quot; crop=&quot;end&quot;/&gt;</span>
<a href="#l19.178"></a><span id="l19.178" class="difflineplus">+                     class=&quot;tabmail-tab&quot; crop=&quot;end&quot;/&gt;</span>
<a href="#l19.179"></a><span id="l19.179" class="difflineplus">+            &lt;children/&gt;</span>
<a href="#l19.180"></a><span id="l19.180">           &lt;/xul:tabs&gt;</span>
<a href="#l19.181"></a><span id="l19.181">         &lt;/xul:hbox&gt;</span>
<a href="#l19.182"></a><span id="l19.182" class="difflineminus">-        &lt;xul:tabpanels flex=&quot;1&quot; class=&quot;plain&quot; selectedIndex=&quot;0&quot; anonid=&quot;panelcontainer&quot;&gt;</span>
<a href="#l19.183"></a><span id="l19.183" class="difflineminus">-          &lt;children/&gt;</span>
<a href="#l19.184"></a><span id="l19.184" class="difflineminus">-        &lt;/xul:tabpanels&gt;</span>
<a href="#l19.185"></a><span id="l19.185" class="difflineplus">+        &lt;!-- Remember, user of this binding, you need to provide tabpanels!  --&gt;</span>
<a href="#l19.186"></a><span id="l19.186" class="difflineplus">+        &lt;children includes=&quot;tabpanels&quot;/&gt;</span>
<a href="#l19.187"></a><span id="l19.187">       &lt;/xul:tabbox&gt;</span>
<a href="#l19.188"></a><span id="l19.188">     &lt;/content&gt;</span>
<a href="#l19.189"></a><span id="l19.189"> </span>
<a href="#l19.190"></a><span id="l19.190">     &lt;implementation&gt;</span>
<a href="#l19.191"></a><span id="l19.191" class="difflineminus">-      &lt;field name=&quot;currentTabOwner&quot;&gt;</span>
<a href="#l19.192"></a><span id="l19.192" class="difflineminus">-        0;</span>
<a href="#l19.193"></a><span id="l19.193" class="difflineplus">+      &lt;field name=&quot;currentTabInfo&quot;&gt;</span>
<a href="#l19.194"></a><span id="l19.194" class="difflineplus">+        null</span>
<a href="#l19.195"></a><span id="l19.195" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l19.196"></a><span id="l19.196" class="difflineplus">+      &lt;field name=&quot;tabTypes&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l19.197"></a><span id="l19.197" class="difflineplus">+        new Object()</span>
<a href="#l19.198"></a><span id="l19.198">       &lt;/field&gt;</span>
<a href="#l19.199"></a><span id="l19.199" class="difflineminus">-      &lt;field name=&quot;tabOwners&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l19.200"></a><span id="l19.200" class="difflineminus">-        new Array();</span>
<a href="#l19.201"></a><span id="l19.201" class="difflineplus">+      &lt;field name=&quot;tabModes&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l19.202"></a><span id="l19.202" class="difflineplus">+        new Object()</span>
<a href="#l19.203"></a><span id="l19.203" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l19.204"></a><span id="l19.204" class="difflineplus">+      &lt;field name=&quot;defaultTabMode&quot;&gt;</span>
<a href="#l19.205"></a><span id="l19.205" class="difflineplus">+        null</span>
<a href="#l19.206"></a><span id="l19.206" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l19.207"></a><span id="l19.207" class="difflineplus">+      &lt;field name=&quot;tabInfo&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l19.208"></a><span id="l19.208" class="difflineplus">+        new Array()</span>
<a href="#l19.209"></a><span id="l19.209">       &lt;/field&gt;</span>
<a href="#l19.210"></a><span id="l19.210">       &lt;field name=&quot;tabStrip&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l19.211"></a><span id="l19.211">         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;strip&quot;);</span>
<a href="#l19.212"></a><span id="l19.212">       &lt;/field&gt;</span>
<a href="#l19.213"></a><span id="l19.213">       &lt;field name=&quot;tabContainer&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l19.214"></a><span id="l19.214">         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;tabcontainer&quot;);</span>
<a href="#l19.215"></a><span id="l19.215">       &lt;/field&gt;</span>
<a href="#l19.216"></a><span id="l19.216" class="difflineminus">-      &lt;method name=&quot;addTab&quot;&gt;</span>
<a href="#l19.217"></a><span id="l19.217" class="difflineminus">-        &lt;parameter name=&quot;aTabOwner&quot;/&gt;</span>
<a href="#l19.218"></a><span id="l19.218" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l19.219"></a><span id="l19.219" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l19.220"></a><span id="l19.220" class="difflineminus">-            var t = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l19.221"></a><span id="l19.221" class="difflineplus">+      &lt;field name=&quot;panelContainer&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l19.222"></a><span id="l19.222" class="difflineplus">+        document.getElementById(this.getAttribute(&quot;panelcontainer&quot;));</span>
<a href="#l19.223"></a><span id="l19.223" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l19.224"></a><span id="l19.224" class="difflineplus">+      &lt;field name=&quot;tabMonitors&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l19.225"></a><span id="l19.225" class="difflineplus">+        new Array()</span>
<a href="#l19.226"></a><span id="l19.226" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l19.227"></a><span id="l19.227" class="difflineplus">+      &lt;method name=&quot;registerTabType&quot;&gt;</span>
<a href="#l19.228"></a><span id="l19.228" class="difflineplus">+        &lt;parameter name=&quot;aTabType&quot;/&gt;</span>
<a href="#l19.229"></a><span id="l19.229" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.230"></a><span id="l19.230" class="difflineplus">+          if (aTabType.name in this.tabTypes)</span>
<a href="#l19.231"></a><span id="l19.231" class="difflineplus">+            return;</span>
<a href="#l19.232"></a><span id="l19.232" class="difflineplus">+        </span>
<a href="#l19.233"></a><span id="l19.233" class="difflineplus">+          this.tabTypes[aTabType.name] = aTabType;</span>
<a href="#l19.234"></a><span id="l19.234" class="difflineplus">+          for (let [modeName, modeDetails] in Iterator(aTabType.modes)) {</span>
<a href="#l19.235"></a><span id="l19.235" class="difflineplus">+            modeDetails.name = modeName;</span>
<a href="#l19.236"></a><span id="l19.236" class="difflineplus">+            modeDetails.tabType = aTabType;</span>
<a href="#l19.237"></a><span id="l19.237" class="difflineplus">+            modeDetails.tabs = [];</span>
<a href="#l19.238"></a><span id="l19.238" class="difflineplus">+            this.tabModes[modeName] = modeDetails;</span>
<a href="#l19.239"></a><span id="l19.239" class="difflineplus">+            if (modeDetails.isDefault)</span>
<a href="#l19.240"></a><span id="l19.240" class="difflineplus">+              this.defaultTabMode = modeDetails;</span>
<a href="#l19.241"></a><span id="l19.241" class="difflineplus">+          }</span>
<a href="#l19.242"></a><span id="l19.242" class="difflineplus">+          </span>
<a href="#l19.243"></a><span id="l19.243" class="difflineplus">+          aTabType.panel = document.getElementById(aTabType.panelId);</span>
<a href="#l19.244"></a><span id="l19.244" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l19.245"></a><span id="l19.245" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l19.246"></a><span id="l19.246" class="difflineplus">+      &lt;method name=&quot;registerTabMonitor&quot;&gt;</span>
<a href="#l19.247"></a><span id="l19.247" class="difflineplus">+        &lt;parameter name=&quot;aTabMonitor&quot;/&gt;</span>
<a href="#l19.248"></a><span id="l19.248" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.249"></a><span id="l19.249" class="difflineplus">+          if (this.tabMonitors.indexOf(aTabMonitor) == -1)</span>
<a href="#l19.250"></a><span id="l19.250" class="difflineplus">+            this.tabMonitors.push(aTabMonitor);</span>
<a href="#l19.251"></a><span id="l19.251" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l19.252"></a><span id="l19.252" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l19.253"></a><span id="l19.253" class="difflineplus">+      &lt;method name=&quot;unregisterTabMonitor&quot;&gt;</span>
<a href="#l19.254"></a><span id="l19.254" class="difflineplus">+        &lt;parameter name=&quot;aTabMonitor&quot;/&gt;</span>
<a href="#l19.255"></a><span id="l19.255" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.256"></a><span id="l19.256" class="difflineplus">+          if (this.tabMonitors.indexOf(aTabMonitor) &gt;= 0)</span>
<a href="#l19.257"></a><span id="l19.257" class="difflineplus">+            this.tabMonitors.splice(this.tabMonitors.indexOf(aTabMonitor), 1);</span>
<a href="#l19.258"></a><span id="l19.258" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l19.259"></a><span id="l19.259" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l19.260"></a><span id="l19.260" class="difflineplus">+      &lt;method name=&quot;openFirstTab&quot;&gt;</span>
<a href="#l19.261"></a><span id="l19.261" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.262"></a><span id="l19.262" class="difflineplus">+          // From the moment of creation, our XBL binding already has a visible</span>
<a href="#l19.263"></a><span id="l19.263" class="difflineplus">+          //  tab.  We need to create a tab information structure for this tab.</span>
<a href="#l19.264"></a><span id="l19.264" class="difflineplus">+          //  In the process we also generate a synthetic tab title changed</span>
<a href="#l19.265"></a><span id="l19.265" class="difflineplus">+          //  event to ensure we have an accurate title.  We assume the tab</span>
<a href="#l19.266"></a><span id="l19.266" class="difflineplus">+          //  contents will set themselves up correctly.</span>
<a href="#l19.267"></a><span id="l19.267" class="difflineplus">+          if (this.tabInfo.length == 0) {</span>
<a href="#l19.268"></a><span id="l19.268" class="difflineplus">+            let firstTab = {mode: this.defaultTabMode, canClose: false};</span>
<a href="#l19.269"></a><span id="l19.269" class="difflineplus">+            let firstTabNode = this.tabContainer.firstChild;</span>
<a href="#l19.270"></a><span id="l19.270" class="difflineplus">+            firstTab.mode.tabs.push(firstTab);</span>
<a href="#l19.271"></a><span id="l19.271" class="difflineplus">+           </span>
<a href="#l19.272"></a><span id="l19.272" class="difflineplus">+            this.tabInfo[0] = this.currentTabInfo = firstTab;</span>
<a href="#l19.273"></a><span id="l19.273" class="difflineplus">+            this.setTabTitle(firstTabNode);</span>
<a href="#l19.274"></a><span id="l19.274" class="difflineplus">+</span>
<a href="#l19.275"></a><span id="l19.275" class="difflineplus">+            if (this.tabMonitors.length) {</span>
<a href="#l19.276"></a><span id="l19.276" class="difflineplus">+              for each (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l19.277"></a><span id="l19.277" class="difflineplus">+                tabMonitor.onTabSwitched(tab, null);</span>
<a href="#l19.278"></a><span id="l19.278" class="difflineplus">+            }</span>
<a href="#l19.279"></a><span id="l19.279" class="difflineplus">+          }</span>
<a href="#l19.280"></a><span id="l19.280" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l19.281"></a><span id="l19.281" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l19.282"></a><span id="l19.282" class="difflineplus">+      &lt;method name=&quot;openTab&quot;&gt;</span>
<a href="#l19.283"></a><span id="l19.283" class="difflineplus">+        &lt;parameter name=&quot;aTabModeName&quot;/&gt;</span>
<a href="#l19.284"></a><span id="l19.284" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.285"></a><span id="l19.285" class="difflineplus">+          let tabMode = this.tabModes[aTabModeName];</span>
<a href="#l19.286"></a><span id="l19.286" class="difflineplus">+          // if we are already at our limit for this mode, show an existing one</span>
<a href="#l19.287"></a><span id="l19.287" class="difflineplus">+          if (tabMode.tabs.length == tabMode.maxTabs) {</span>
<a href="#l19.288"></a><span id="l19.288" class="difflineplus">+            let desiredTab = tabMode.tabs[0];</span>
<a href="#l19.289"></a><span id="l19.289" class="difflineplus">+            this.tabContainer.selectedIndex = this.tabInfo.indexOf(desiredTab);</span>
<a href="#l19.290"></a><span id="l19.290" class="difflineplus">+            return;</span>
<a href="#l19.291"></a><span id="l19.291" class="difflineplus">+          }</span>
<a href="#l19.292"></a><span id="l19.292" class="difflineplus">+          </span>
<a href="#l19.293"></a><span id="l19.293" class="difflineplus">+          // we need to save the state before it gets corrupted</span>
<a href="#l19.294"></a><span id="l19.294" class="difflineplus">+          this.saveCurrentTabState();</span>
<a href="#l19.295"></a><span id="l19.295" class="difflineplus">+</span>
<a href="#l19.296"></a><span id="l19.296" class="difflineplus">+          let tab = {mode: tabMode, canClose: true};</span>
<a href="#l19.297"></a><span id="l19.297" class="difflineplus">+          tabMode.tabs.push(tab);</span>
<a href="#l19.298"></a><span id="l19.298" class="difflineplus">+</span>
<a href="#l19.299"></a><span id="l19.299" class="difflineplus">+          var t = document.createElementNS(</span>
<a href="#l19.300"></a><span id="l19.300" class="difflineplus">+            &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l19.301"></a><span id="l19.301">                                              &quot;tab&quot;);</span>
<a href="#l19.302"></a><span id="l19.302">             t.setAttribute(&quot;crop&quot;, &quot;end&quot;);</span>
<a href="#l19.303"></a><span id="l19.303" class="difflineminus">-            t.maxWidth = 250;</span>
<a href="#l19.304"></a><span id="l19.304" class="difflineminus">-            //    t.minWidth = this.tabContainer.mTabMinWidth;</span>
<a href="#l19.305"></a><span id="l19.305" class="difflineplus">+          t.maxWidth = this.tabContainer.mTabMaxWidth;</span>
<a href="#l19.306"></a><span id="l19.306" class="difflineplus">+          t.minWidth = this.tabContainer.mTabMinWidth;</span>
<a href="#l19.307"></a><span id="l19.307">             t.width = 0;</span>
<a href="#l19.308"></a><span id="l19.308">             t.setAttribute(&quot;flex&quot;, &quot;100&quot;);</span>
<a href="#l19.309"></a><span id="l19.309">             t.setAttribute(&quot;validate&quot;, &quot;never&quot;);</span>
<a href="#l19.310"></a><span id="l19.310" class="difflineminus">-            t.className = &quot;tabmail-tab tabmail-tab&quot;;</span>
<a href="#l19.311"></a><span id="l19.311" class="difflineminus">-            if (!this.tabOwners.length)</span>
<a href="#l19.312"></a><span id="l19.312" class="difflineminus">-            {</span>
<a href="#l19.313"></a><span id="l19.313" class="difflineminus">-              // set up the first tab, which was previously invisible.</span>
<a href="#l19.314"></a><span id="l19.314" class="difflineminus">-              this.tabOwners[0] = new folderTabOwner();</span>
<a href="#l19.315"></a><span id="l19.315" class="difflineminus">-              this.setTabTitle(this.tabContainer.firstChild);</span>
<a href="#l19.316"></a><span id="l19.316" class="difflineminus">-            }</span>
<a href="#l19.317"></a><span id="l19.317" class="difflineplus">+          t.className = &quot;tabmail-tab&quot;;</span>
<a href="#l19.318"></a><span id="l19.318">             this.tabContainer.appendChild(t);</span>
<a href="#l19.319"></a><span id="l19.319">             if (this.tabStrip.collapsed)</span>
<a href="#l19.320"></a><span id="l19.320">             {</span>
<a href="#l19.321"></a><span id="l19.321">               this.tabStrip.collapsed = false;</span>
<a href="#l19.322"></a><span id="l19.322">               this.tabStrip.setAttribute(&quot;closebuttons&quot;, &quot;alltabs&quot;);</span>
<a href="#l19.323"></a><span id="l19.323">             }</span>
<a href="#l19.324"></a><span id="l19.324" class="difflineminus">-            this.saveCurrentTabInfo(); // save off the state of the old tab</span>
<a href="#l19.325"></a><span id="l19.325" class="difflineplus">+          </span>
<a href="#l19.326"></a><span id="l19.326" class="difflineplus">+          let oldTab = this.currentTabInfo;</span>
<a href="#l19.327"></a><span id="l19.327"> </span>
<a href="#l19.328"></a><span id="l19.328">             // the order of the following statements is important</span>
<a href="#l19.329"></a><span id="l19.329" class="difflineminus">-            this.currentTabOwner = aTabOwner;</span>
<a href="#l19.330"></a><span id="l19.330" class="difflineminus">-            this.tabOwners[this.tabContainer.childNodes.length - 1] = aTabOwner;</span>
<a href="#l19.331"></a><span id="l19.331" class="difflineminus">-            this.tabContainer.selectedIndex = this.tabContainer.childNodes.length - 1; // this has a side effect of calling updateCurrentMailTab</span>
<a href="#l19.332"></a><span id="l19.332" class="difflineminus">-            this.setTabTitle(t);</span>
<a href="#l19.333"></a><span id="l19.333" class="difflineplus">+          this.currentTabInfo = tab;</span>
<a href="#l19.334"></a><span id="l19.334" class="difflineplus">+          this.tabInfo[this.tabContainer.childNodes.length - 1] = tab;</span>
<a href="#l19.335"></a><span id="l19.335" class="difflineplus">+          // this has a side effect of calling updateCurrentTab, but our</span>
<a href="#l19.336"></a><span id="l19.336" class="difflineplus">+          //  setting currentTabInfo above will cause it to take no action.</span>
<a href="#l19.337"></a><span id="l19.337" class="difflineplus">+          this.tabContainer.selectedIndex =</span>
<a href="#l19.338"></a><span id="l19.338" class="difflineplus">+            this.tabContainer.childNodes.length - 1;</span>
<a href="#l19.339"></a><span id="l19.339" class="difflineplus">+</span>
<a href="#l19.340"></a><span id="l19.340" class="difflineplus">+          // make sure we are on the right panel</span>
<a href="#l19.341"></a><span id="l19.341" class="difflineplus">+          if (tab.mode.tabType.perTabPanel) {</span>
<a href="#l19.342"></a><span id="l19.342" class="difflineplus">+            // should we create the element for them, or will they do it?</span>
<a href="#l19.343"></a><span id="l19.343" class="difflineplus">+            if (typeof(tab.mode.tabType.perTabPanel) == &quot;string&quot;) {</span>
<a href="#l19.344"></a><span id="l19.344" class="difflineplus">+              tab.panel = document.createElementNS(</span>
<a href="#l19.345"></a><span id="l19.345" class="difflineplus">+                &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l19.346"></a><span id="l19.346" class="difflineplus">+                tab.mode.tabType.perTabPanel);</span>
<a href="#l19.347"></a><span id="l19.347" class="difflineplus">+            }</span>
<a href="#l19.348"></a><span id="l19.348" class="difflineplus">+            else {</span>
<a href="#l19.349"></a><span id="l19.349" class="difflineplus">+              tab.panel = tab.mode.tabType.perTabPanel(tab);</span>
<a href="#l19.350"></a><span id="l19.350" class="difflineplus">+            }</span>
<a href="#l19.351"></a><span id="l19.351" class="difflineplus">+            this.panelContainer.appendChild(tab.panel);</span>
<a href="#l19.352"></a><span id="l19.352" class="difflineplus">+            this.panelContainer.selectedPanel = tab.panel;</span>
<a href="#l19.353"></a><span id="l19.353" class="difflineplus">+          }</span>
<a href="#l19.354"></a><span id="l19.354" class="difflineplus">+          else</span>
<a href="#l19.355"></a><span id="l19.355" class="difflineplus">+            this.panelContainer.selectedPanel = tab.mode.tabType.panel;</span>
<a href="#l19.356"></a><span id="l19.356" class="difflineplus">+            </span>
<a href="#l19.357"></a><span id="l19.357" class="difflineplus">+          let tabOpenFunc = tab.mode.openTab || tab.mode.tabType.openTab;</span>
<a href="#l19.358"></a><span id="l19.358" class="difflineplus">+          let args = [tab].concat(Array.prototype.slice.call(arguments, 1));</span>
<a href="#l19.359"></a><span id="l19.359" class="difflineplus">+          tabOpenFunc.apply(tab.mode.tabType, args);</span>
<a href="#l19.360"></a><span id="l19.360" class="difflineplus">+          </span>
<a href="#l19.361"></a><span id="l19.361" class="difflineplus">+          if (this.tabMonitors.length) {</span>
<a href="#l19.362"></a><span id="l19.362" class="difflineplus">+            for each (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l19.363"></a><span id="l19.363" class="difflineplus">+              tabMonitor.onTabSwitched(tab, oldTab);</span>
<a href="#l19.364"></a><span id="l19.364" class="difflineplus">+          }</span>
<a href="#l19.365"></a><span id="l19.365" class="difflineplus">+          </span>
<a href="#l19.366"></a><span id="l19.366" class="difflineplus">+          t.setAttribute(&quot;label&quot;, tab.title);</span>
<a href="#l19.367"></a><span id="l19.367" class="difflineplus">+          </span>
<a href="#l19.368"></a><span id="l19.368" class="difflineplus">+          let docTitle = tab.title;</span>
<a href="#l19.369"></a><span id="l19.369" class="difflineplus">+#ifndef XP_MACOSX</span>
<a href="#l19.370"></a><span id="l19.370" class="difflineplus">+          docTitle += &quot; - &quot; + gBrandBundle.getString(&quot;brandFullName&quot;);</span>
<a href="#l19.371"></a><span id="l19.371" class="difflineplus">+#endif</span>
<a href="#l19.372"></a><span id="l19.372" class="difflineplus">+          document.title = docTitle;</span>
<a href="#l19.373"></a><span id="l19.373" class="difflineplus">+          </span>
<a href="#l19.374"></a><span id="l19.374">             // for styling purposes, apply the type to the tab...</span>
<a href="#l19.375"></a><span id="l19.375" class="difflineminus">-            t.setAttribute('type', aTabOwner.type);</span>
<a href="#l19.376"></a><span id="l19.376" class="difflineminus">-            this.currentTabOwner.open();</span>
<a href="#l19.377"></a><span id="l19.377" class="difflineminus">-          ]]&gt;</span>
<a href="#l19.378"></a><span id="l19.378" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l19.379"></a><span id="l19.379" class="difflineplus">+          t.setAttribute('type', tab.mode.type);</span>
<a href="#l19.380"></a><span id="l19.380" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l19.381"></a><span id="l19.381" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l19.382"></a><span id="l19.382" class="difflineplus">+      &lt;method name=&quot;selectTabByMode&quot;&gt;</span>
<a href="#l19.383"></a><span id="l19.383" class="difflineplus">+        &lt;parameter name=&quot;aTabModeName&quot;/&gt;</span>
<a href="#l19.384"></a><span id="l19.384" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.385"></a><span id="l19.385" class="difflineplus">+          let tabMode = this.tabModes[aTabModeName];</span>
<a href="#l19.386"></a><span id="l19.386" class="difflineplus">+          if (tabMode.tabs.length) {</span>
<a href="#l19.387"></a><span id="l19.387" class="difflineplus">+            let desiredTab = tabMode.tabs[0];</span>
<a href="#l19.388"></a><span id="l19.388" class="difflineplus">+            this.tabContainer.selectedIndex = this.tabInfo.indexOf(desiredTab);</span>
<a href="#l19.389"></a><span id="l19.389" class="difflineplus">+          }</span>
<a href="#l19.390"></a><span id="l19.390" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l19.391"></a><span id="l19.391">       &lt;/method&gt;</span>
<a href="#l19.392"></a><span id="l19.392">       &lt;method name=&quot;closeTabs&quot;&gt;</span>
<a href="#l19.393"></a><span id="l19.393">         &lt;body&gt;</span>
<a href="#l19.394"></a><span id="l19.394">           &lt;![CDATA[</span>
<a href="#l19.395"></a><span id="l19.395" class="difflineminus">-            for (var i = 0; i &lt; this.tabOwners.length; i++)</span>
<a href="#l19.396"></a><span id="l19.396" class="difflineminus">-              this.tabOwners[i].close();</span>
<a href="#l19.397"></a><span id="l19.397" class="difflineplus">+            for (var i = 0; i &lt; this.tabInfo.length; i++) {</span>
<a href="#l19.398"></a><span id="l19.398" class="difflineplus">+              let tab = this.tabInfo[i];</span>
<a href="#l19.399"></a><span id="l19.399" class="difflineplus">+              </span>
<a href="#l19.400"></a><span id="l19.400" class="difflineplus">+              let tabCloseFunc = tab.mode.closeTab || tab.mode.tabType.closeTab;</span>
<a href="#l19.401"></a><span id="l19.401" class="difflineplus">+              tabCloseFunc.call(tab.mode.tabType, tab);</span>
<a href="#l19.402"></a><span id="l19.402" class="difflineplus">+            }</span>
<a href="#l19.403"></a><span id="l19.403">           ]]&gt;</span>
<a href="#l19.404"></a><span id="l19.404">         &lt;/body&gt;</span>
<a href="#l19.405"></a><span id="l19.405">       &lt;/method&gt;</span>
<a href="#l19.406"></a><span id="l19.406" class="difflineminus">-      &lt;method name=&quot;removeTab&quot;&gt;</span>
<a href="#l19.407"></a><span id="l19.407" class="difflineminus">-        &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l19.408"></a><span id="l19.408" class="difflineplus">+      &lt;method name=&quot;removeTabByNode&quot;&gt;</span>
<a href="#l19.409"></a><span id="l19.409" class="difflineplus">+        &lt;parameter name=&quot;aTabNode&quot;/&gt;</span>
<a href="#l19.410"></a><span id="l19.410">         &lt;body&gt;</span>
<a href="#l19.411"></a><span id="l19.411">           &lt;![CDATA[</span>
<a href="#l19.412"></a><span id="l19.412" class="difflineminus">-            var numTabs = this.tabContainer.childNodes.length;</span>
<a href="#l19.413"></a><span id="l19.413" class="difflineminus">-            if (numTabs &lt; 3)</span>
<a href="#l19.414"></a><span id="l19.414" class="difflineminus">-            {</span>
<a href="#l19.415"></a><span id="l19.415" class="difflineminus">-              // hide the tab bar</span>
<a href="#l19.416"></a><span id="l19.416" class="difflineminus">-              this.tabStrip.collapsed = true;</span>
<a href="#l19.417"></a><span id="l19.417" class="difflineminus">-              if (numTabs == 1) // can this happen?</span>
<a href="#l19.418"></a><span id="l19.418" class="difflineminus">-                return;</span>
<a href="#l19.419"></a><span id="l19.419" class="difflineminus">-            }</span>
<a href="#l19.420"></a><span id="l19.420" class="difflineminus">-            var i;</span>
<a href="#l19.421"></a><span id="l19.421">             // Find and locate the tab in our list.</span>
<a href="#l19.422"></a><span id="l19.422" class="difflineminus">-            for (i = 0; i &lt; numTabs; i++)</span>
<a href="#l19.423"></a><span id="l19.423" class="difflineminus">-              if (this.tabContainer.childNodes[i] == aTab)</span>
<a href="#l19.424"></a><span id="l19.424" class="difflineplus">+            let iTab, numTabs = this.tabContainer.childNodes.length;</span>
<a href="#l19.425"></a><span id="l19.425" class="difflineplus">+            for (iTab = 0; iTab &lt; numTabs; iTab++)</span>
<a href="#l19.426"></a><span id="l19.426" class="difflineplus">+              if (this.tabContainer.childNodes[iTab] == aTabNode)</span>
<a href="#l19.427"></a><span id="l19.427">                 break;</span>
<a href="#l19.428"></a><span id="l19.428" class="difflineminus">-            var tabOwner = this.tabOwners[i];</span>
<a href="#l19.429"></a><span id="l19.429" class="difflineminus">-            tabOwner.close(); // inform the owner the tab is being closed</span>
<a href="#l19.430"></a><span id="l19.430" class="difflineminus">-            this.tabOwners.splice(i, 1);</span>
<a href="#l19.431"></a><span id="l19.431" class="difflineminus">-            this.tabContainer.removeChild(aTab);</span>
<a href="#l19.432"></a><span id="l19.432" class="difflineplus">+            let tab = this.tabInfo[iTab];</span>
<a href="#l19.433"></a><span id="l19.433" class="difflineplus">+</span>
<a href="#l19.434"></a><span id="l19.434" class="difflineplus">+            if (!tab.canClose)</span>
<a href="#l19.435"></a><span id="l19.435" class="difflineplus">+              return;</span>
<a href="#l19.436"></a><span id="l19.436" class="difflineplus">+            </span>
<a href="#l19.437"></a><span id="l19.437" class="difflineplus">+            let closeFunc = tab.mode.closeTab || tab.mode.tabType.closeTab;</span>
<a href="#l19.438"></a><span id="l19.438" class="difflineplus">+            closeFunc.call(tab.mode.tabType, tab);</span>
<a href="#l19.439"></a><span id="l19.439" class="difflineplus">+             </span>
<a href="#l19.440"></a><span id="l19.440" class="difflineplus">+            this.tabInfo.splice(iTab, 1);</span>
<a href="#l19.441"></a><span id="l19.441" class="difflineplus">+            tab.mode.tabs.splice(tab.mode.tabs.indexOf(tab), 1);</span>
<a href="#l19.442"></a><span id="l19.442" class="difflineplus">+            this.tabContainer.removeChild(aTabNode);</span>
<a href="#l19.443"></a><span id="l19.443">             if (this.tabContainer.selectedIndex == -1)</span>
<a href="#l19.444"></a><span id="l19.444" class="difflineminus">-              this.tabContainer.selectedIndex = (i == --numTabs) ? i - 1 : i;</span>
<a href="#l19.445"></a><span id="l19.445" class="difflineminus">-            if (this.currentTabOwner == tabOwner)</span>
<a href="#l19.446"></a><span id="l19.446" class="difflineminus">-              this.updateCurrentMailTab();</span>
<a href="#l19.447"></a><span id="l19.447" class="difflineminus">-          ]]&gt;</span>
<a href="#l19.448"></a><span id="l19.448" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l19.449"></a><span id="l19.449" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l19.450"></a><span id="l19.450" class="difflineminus">-      &lt;!--  UpdateCurrentMailTab - called in response to changing the current tab --&gt;</span>
<a href="#l19.451"></a><span id="l19.451" class="difflineminus">-      &lt;method name=&quot;updateCurrentMailTab&quot;&gt;</span>
<a href="#l19.452"></a><span id="l19.452" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l19.453"></a><span id="l19.453" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l19.454"></a><span id="l19.454" class="difflineminus">-            if (this.currentTabOwner != this.tabOwners[this.tabContainer.selectedIndex])</span>
<a href="#l19.455"></a><span id="l19.455" class="difflineminus">-            {</span>
<a href="#l19.456"></a><span id="l19.456" class="difflineminus">-              this.saveCurrentTabInfo(); // save the old tab state before we change the current tab</span>
<a href="#l19.457"></a><span id="l19.457" class="difflineminus">-              // if this isn't set, then this is the first time we've switched tabs, so the</span>
<a href="#l19.458"></a><span id="l19.458" class="difflineminus">-              // old tab must be the 0th tab.</span>
<a href="#l19.459"></a><span id="l19.459" class="difflineminus">-              // the tab owner is responsible for actually setting up the UI for the tab.</span>
<a href="#l19.460"></a><span id="l19.460" class="difflineminus">-              var oldTabOwner = this.currentTabOwner;</span>
<a href="#l19.461"></a><span id="l19.461" class="difflineminus">-              this.currentTabOwner = this.tabOwners[this.tabContainer.selectedIndex];</span>
<a href="#l19.462"></a><span id="l19.462" class="difflineminus">-              this.currentTabOwner.onSelect(oldTabOwner);</span>
<a href="#l19.463"></a><span id="l19.463" class="difflineplus">+              this.tabContainer.selectedIndex = (iTab == --numTabs) ?</span>
<a href="#l19.464"></a><span id="l19.464" class="difflineplus">+                iTab - 1 : iTab;</span>
<a href="#l19.465"></a><span id="l19.465" class="difflineplus">+            if (this.currentTabInfo == tab)</span>
<a href="#l19.466"></a><span id="l19.466" class="difflineplus">+              this.updateCurrentTab();</span>
<a href="#l19.467"></a><span id="l19.467" class="difflineplus">+              </span>
<a href="#l19.468"></a><span id="l19.468" class="difflineplus">+            if (tab.panel) {</span>
<a href="#l19.469"></a><span id="l19.469" class="difflineplus">+              this.panelContainer.removeChild(tab.panel);</span>
<a href="#l19.470"></a><span id="l19.470" class="difflineplus">+              delete tab.panel;</span>
<a href="#l19.471"></a><span id="l19.471">             }</span>
<a href="#l19.472"></a><span id="l19.472">           ]]&gt;</span>
<a href="#l19.473"></a><span id="l19.473">         &lt;/body&gt;</span>
<a href="#l19.474"></a><span id="l19.474">       &lt;/method&gt;</span>
<a href="#l19.475"></a><span id="l19.475" class="difflineminus">-      &lt;method name=&quot;saveCurrentTabInfo&quot;&gt;</span>
<a href="#l19.476"></a><span id="l19.476" class="difflineplus">+      &lt;method name=&quot;removeCurrentTab&quot;&gt;</span>
<a href="#l19.477"></a><span id="l19.477" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.478"></a><span id="l19.478" class="difflineplus">+          this.removeTabByNode(</span>
<a href="#l19.479"></a><span id="l19.479" class="difflineplus">+            this.tabContainer.childNodes[this.tabContainer.selectedIndex]);</span>
<a href="#l19.480"></a><span id="l19.480" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l19.481"></a><span id="l19.481" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l19.482"></a><span id="l19.482" class="difflineplus">+      &lt;!--  UpdateCurrentTab - called in response to changing the current tab --&gt;</span>
<a href="#l19.483"></a><span id="l19.483" class="difflineplus">+      &lt;method name=&quot;updateCurrentTab&quot;&gt;</span>
<a href="#l19.484"></a><span id="l19.484">         &lt;body&gt;</span>
<a href="#l19.485"></a><span id="l19.485">           &lt;![CDATA[</span>
<a href="#l19.486"></a><span id="l19.486" class="difflineminus">-            if (!this.currentTabOwner)</span>
<a href="#l19.487"></a><span id="l19.487" class="difflineminus">-              this.currentTabOwner = this.tabOwners[0];</span>
<a href="#l19.488"></a><span id="l19.488" class="difflineminus">-            this.currentTabOwner.saveCurrentInfo();</span>
<a href="#l19.489"></a><span id="l19.489" class="difflineplus">+            if (this.currentTabInfo != this.tabInfo[this.tabContainer.selectedIndex])</span>
<a href="#l19.490"></a><span id="l19.490" class="difflineplus">+            {</span>
<a href="#l19.491"></a><span id="l19.491" class="difflineplus">+              if (this.currentTabInfo)</span>
<a href="#l19.492"></a><span id="l19.492" class="difflineplus">+                this.saveCurrentTabState();</span>
<a href="#l19.493"></a><span id="l19.493" class="difflineplus">+              </span>
<a href="#l19.494"></a><span id="l19.494" class="difflineplus">+              let oldTab = this.currentTabInfo;</span>
<a href="#l19.495"></a><span id="l19.495" class="difflineplus">+              let tab = this.currentTabInfo =</span>
<a href="#l19.496"></a><span id="l19.496" class="difflineplus">+                this.tabInfo[this.tabContainer.selectedIndex];</span>
<a href="#l19.497"></a><span id="l19.497" class="difflineplus">+</span>
<a href="#l19.498"></a><span id="l19.498" class="difflineplus">+              this.panelContainer.selectedPanel = tab.panel ||</span>
<a href="#l19.499"></a><span id="l19.499" class="difflineplus">+                                                  tab.mode.tabType.panel;</span>
<a href="#l19.500"></a><span id="l19.500" class="difflineplus">+</span>
<a href="#l19.501"></a><span id="l19.501" class="difflineplus">+              let showTabFunc = tab.mode.showTab || tab.mode.tabType.showTab;</span>
<a href="#l19.502"></a><span id="l19.502" class="difflineplus">+              showTabFunc.call(tab.mode.tabType, tab);</span>
<a href="#l19.503"></a><span id="l19.503" class="difflineplus">+</span>
<a href="#l19.504"></a><span id="l19.504" class="difflineplus">+              if (this.tabMonitors.length) {</span>
<a href="#l19.505"></a><span id="l19.505" class="difflineplus">+                for each (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l19.506"></a><span id="l19.506" class="difflineplus">+                  tabMonitor.onTabSwitched(tab, oldTab);</span>
<a href="#l19.507"></a><span id="l19.507" class="difflineplus">+              }</span>
<a href="#l19.508"></a><span id="l19.508" class="difflineplus">+</span>
<a href="#l19.509"></a><span id="l19.509" class="difflineplus">+</span>
<a href="#l19.510"></a><span id="l19.510" class="difflineplus">+              let docTitle = tab.title;</span>
<a href="#l19.511"></a><span id="l19.511" class="difflineplus">+#ifndef XP_MACOSX</span>
<a href="#l19.512"></a><span id="l19.512" class="difflineplus">+              docTitle += &quot; - &quot; + gBrandBundle.getString(&quot;brandFullName&quot;);</span>
<a href="#l19.513"></a><span id="l19.513" class="difflineplus">+#endif</span>
<a href="#l19.514"></a><span id="l19.514" class="difflineplus">+              document.title = docTitle;</span>
<a href="#l19.515"></a><span id="l19.515" class="difflineplus">+            }</span>
<a href="#l19.516"></a><span id="l19.516" class="difflineplus">+          ]]&gt;</span>
<a href="#l19.517"></a><span id="l19.517" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l19.518"></a><span id="l19.518" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l19.519"></a><span id="l19.519" class="difflineplus">+      &lt;method name=&quot;saveCurrentTabState&quot;&gt;</span>
<a href="#l19.520"></a><span id="l19.520" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l19.521"></a><span id="l19.521" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l19.522"></a><span id="l19.522" class="difflineplus">+            if (!this.currentTabInfo)</span>
<a href="#l19.523"></a><span id="l19.523" class="difflineplus">+              this.currentTabInfo = this.tabInfo[0];</span>
<a href="#l19.524"></a><span id="l19.524" class="difflineplus">+            let tab = this.currentTabInfo;</span>
<a href="#l19.525"></a><span id="l19.525" class="difflineplus">+            </span>
<a href="#l19.526"></a><span id="l19.526" class="difflineplus">+            // save the old tab state before we change the current tab</span>
<a href="#l19.527"></a><span id="l19.527" class="difflineplus">+            let saveTabFunc = tab.mode.saveTabState ||</span>
<a href="#l19.528"></a><span id="l19.528" class="difflineplus">+                              tab.mode.tabType.saveTabState;</span>
<a href="#l19.529"></a><span id="l19.529" class="difflineplus">+            saveTabFunc.call(tab.mode.tabType, tab);</span>
<a href="#l19.530"></a><span id="l19.530">           ]]&gt;</span>
<a href="#l19.531"></a><span id="l19.531">         &lt;/body&gt;</span>
<a href="#l19.532"></a><span id="l19.532">       &lt;/method&gt;</span>
<a href="#l19.533"></a><span id="l19.533">       &lt;method name=&quot;onTabClick&quot;&gt;</span>
<a href="#l19.534"></a><span id="l19.534">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l19.535"></a><span id="l19.535">         &lt;body&gt;</span>
<a href="#l19.536"></a><span id="l19.536">           &lt;![CDATA[</span>
<a href="#l19.537"></a><span id="l19.537">             // a middle mouse button click on a tab is a short cut for closing a tab</span>
<a href="#l19.538"></a><span id="l19.538">             if (event.button != 1 || event.target.localName != 'tab')</span>
<a href="#l19.539"></a><span id="l19.539">               return;</span>
<a href="#l19.540"></a><span id="l19.540" class="difflineminus">-            this.removeTab(event.target);</span>
<a href="#l19.541"></a><span id="l19.541" class="difflineplus">+            this.removeTabByNode(event.target);</span>
<a href="#l19.542"></a><span id="l19.542">             event.stopPropagation();</span>
<a href="#l19.543"></a><span id="l19.543">           ]]&gt;</span>
<a href="#l19.544"></a><span id="l19.544">         &lt;/body&gt;</span>
<a href="#l19.545"></a><span id="l19.545">       &lt;/method&gt;</span>
<a href="#l19.546"></a><span id="l19.546">       &lt;method name=&quot;setTabTitle&quot;&gt;</span>
<a href="#l19.547"></a><span id="l19.547" class="difflineminus">-        &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l19.548"></a><span id="l19.548" class="difflineplus">+        &lt;parameter name=&quot;aTabNode&quot;/&gt;</span>
<a href="#l19.549"></a><span id="l19.549">         &lt;body&gt;</span>
<a href="#l19.550"></a><span id="l19.550">           &lt;![CDATA[</span>
<a href="#l19.551"></a><span id="l19.551" class="difflineminus">-            if (!aTab)</span>
<a href="#l19.552"></a><span id="l19.552" class="difflineminus">-              aTab = this.tabContainer.childNodes[this.tabContainer.selectedIndex];</span>
<a href="#l19.553"></a><span id="l19.553" class="difflineplus">+            if (!aTabNode)</span>
<a href="#l19.554"></a><span id="l19.554" class="difflineplus">+              aTabNode =</span>
<a href="#l19.555"></a><span id="l19.555" class="difflineplus">+                this.tabContainer.childNodes[this.tabContainer.selectedIndex];</span>
<a href="#l19.556"></a><span id="l19.556" class="difflineplus">+                </span>
<a href="#l19.557"></a><span id="l19.557">             // get the owner for the tab...</span>
<a href="#l19.558"></a><span id="l19.558">             var i;</span>
<a href="#l19.559"></a><span id="l19.559">             var numTabs = this.tabContainer.childNodes.length;</span>
<a href="#l19.560"></a><span id="l19.560">             for (i = 0; i &lt; numTabs; i++)</span>
<a href="#l19.561"></a><span id="l19.561" class="difflineminus">-              if (this.tabContainer.childNodes[i] == aTab)</span>
<a href="#l19.562"></a><span id="l19.562" class="difflineplus">+              if (this.tabContainer.childNodes[i] == aTabNode)</span>
<a href="#l19.563"></a><span id="l19.563">                 break;</span>
<a href="#l19.564"></a><span id="l19.564">             // on startup, we may not have a tab...</span>
<a href="#l19.565"></a><span id="l19.565" class="difflineminus">-            if (this.tabOwners[i])</span>
<a href="#l19.566"></a><span id="l19.566" class="difflineplus">+            let tab = this.tabInfo[i];</span>
<a href="#l19.567"></a><span id="l19.567" class="difflineplus">+            if (tab)</span>
<a href="#l19.568"></a><span id="l19.568">             {</span>
<a href="#l19.569"></a><span id="l19.569" class="difflineminus">-              aTab.setAttribute(&quot;label&quot;, this.tabOwners[i].title);</span>
<a href="#l19.570"></a><span id="l19.570" class="difflineminus">-              this.tabOwners[i].onTitleChanged(aTab);</span>
<a href="#l19.571"></a><span id="l19.571" class="difflineplus">+              let titleChangeFunc = tab.mode.onTitleChanged ||</span>
<a href="#l19.572"></a><span id="l19.572" class="difflineplus">+                                    tab.mode.tabType.onTitleChanged;</span>
<a href="#l19.573"></a><span id="l19.573" class="difflineplus">+              if (titleChangeFunc)</span>
<a href="#l19.574"></a><span id="l19.574" class="difflineplus">+                titleChangeFunc.call(tab.mode.tabType, tab, aTabNode);</span>
<a href="#l19.575"></a><span id="l19.575" class="difflineplus">+</span>
<a href="#l19.576"></a><span id="l19.576" class="difflineplus">+              if (this.tabMonitors.length) {</span>
<a href="#l19.577"></a><span id="l19.577" class="difflineplus">+                for each (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l19.578"></a><span id="l19.578" class="difflineplus">+                  tabMonitor.onTabTitleChanged(tab);</span>
<a href="#l19.579"></a><span id="l19.579" class="difflineplus">+              }</span>
<a href="#l19.580"></a><span id="l19.580" class="difflineplus">+                                    </span>
<a href="#l19.581"></a><span id="l19.581" class="difflineplus">+              aTabNode.setAttribute(&quot;label&quot;, tab.title);</span>
<a href="#l19.582"></a><span id="l19.582">             }</span>
<a href="#l19.583"></a><span id="l19.583">           ]]&gt;</span>
<a href="#l19.584"></a><span id="l19.584">         &lt;/body&gt;</span>
<a href="#l19.585"></a><span id="l19.585">       &lt;/method&gt;</span>
<a href="#l19.586"></a><span id="l19.586">     &lt;/implementation&gt;</span>
<a href="#l19.587"></a><span id="l19.587">   &lt;/binding&gt;</span>
<a href="#l19.588"></a><span id="l19.588">   </span>
<a href="#l19.589"></a><span id="l19.589">  &lt;binding id=&quot;tabmail-tab&quot; display=&quot;xul:box&quot;</span>
<a href="#l19.590"></a><span id="l19.590" class="difflineat">@@ -358,16 +646,17 @@</span>
<a href="#l19.591"></a><span id="l19.591"> </span>
<a href="#l19.592"></a><span id="l19.592">   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l19.593"></a><span id="l19.593">            extends=&quot;chrome://global/content/bindings/tabbox.xml#tabs&quot;&gt;</span>
<a href="#l19.594"></a><span id="l19.594">     &lt;content&gt;</span>
<a href="#l19.595"></a><span id="l19.595">       &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot; class=&quot;tabmail-arrowscrollbox&quot; flex=&quot;1&quot;</span>
<a href="#l19.596"></a><span id="l19.596">                           xbl:inherits=&quot;smoothscroll&quot; orient=&quot;horizontal&quot; style=&quot;min-width: 1px;&quot;&gt;</span>
<a href="#l19.597"></a><span id="l19.597">         &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l19.598"></a><span id="l19.598">       &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l19.599"></a><span id="l19.599" class="difflineplus">+      &lt;children/&gt;</span>
<a href="#l19.600"></a><span id="l19.600">       &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; class=&quot;tabs-alltabs-stack&quot;&gt;</span>
<a href="#l19.601"></a><span id="l19.601">         &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box&quot; anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l19.602"></a><span id="l19.602">         &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot; </span>
<a href="#l19.603"></a><span id="l19.603">                   anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l19.604"></a><span id="l19.604">         &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot; type=&quot;menu&quot;</span>
<a href="#l19.605"></a><span id="l19.605">                            anonid=&quot;alltabs-button&quot;</span>
<a href="#l19.606"></a><span id="l19.606">                            tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l19.607"></a><span id="l19.607">           &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l19.608"></a><span id="l19.608" class="difflineat">@@ -896,17 +1185,17 @@</span>
<a href="#l19.609"></a><span id="l19.609">              * on an in-tab close button is when the tab was opened with a</span>
<a href="#l19.610"></a><span id="l19.610">              * double click on the tabbar. (bug 378344)</span>
<a href="#l19.611"></a><span id="l19.611">              * In both cases, it is most likely that the close button area has</span>
<a href="#l19.612"></a><span id="l19.612">              * been accidentally clicked, therefore we do not close the tab.</span>
<a href="#l19.613"></a><span id="l19.613">              */</span>
<a href="#l19.614"></a><span id="l19.614">             if (event.detail &gt; 1)</span>
<a href="#l19.615"></a><span id="l19.615">               return;</span>
<a href="#l19.616"></a><span id="l19.616"> </span>
<a href="#l19.617"></a><span id="l19.617" class="difflineminus">-            tabbedBrowser.removeTab(bindingParent);</span>
<a href="#l19.618"></a><span id="l19.618" class="difflineplus">+            tabbedBrowser.removeTabByNode(bindingParent);</span>
<a href="#l19.619"></a><span id="l19.619">             tabbedBrowser._blockDblClick = true;</span>
<a href="#l19.620"></a><span id="l19.620"> </span>
<a href="#l19.621"></a><span id="l19.621">             /* XXXmano hack (see bug 343628):</span>
<a href="#l19.622"></a><span id="l19.622">              * Since we're removing the event target, if the user</span>
<a href="#l19.623"></a><span id="l19.623">              * double-clicks this button, the dblclick event will be dispatched</span>
<a href="#l19.624"></a><span id="l19.624">              * with the tabbar as its event target (and explicit/originalTarget),</span>
<a href="#l19.625"></a><span id="l19.625">              * which treats that as a mouse gesture for opening a new tab.</span>
<a href="#l19.626"></a><span id="l19.626">              * In this context, we're manually blocking the dblclick event</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/tabmailBindings.xml</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/tabmailBindings.xml</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -72,18 +72,19 @@</span>
<a href="#l20.4"></a><span id="l20.4">           &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l20.5"></a><span id="l20.5">         &lt;/xul:vbox&gt;</span>
<a href="#l20.6"></a><span id="l20.6">         &lt;xul:vbox&gt;</span>
<a href="#l20.7"></a><span id="l20.7">           &lt;xul:hbox&gt;</span>
<a href="#l20.8"></a><span id="l20.8">             &lt;xul:stack&gt;</span>
<a href="#l20.9"></a><span id="l20.9">               &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l20.10"></a><span id="l20.10">             &lt;/xul:stack&gt;</span>
<a href="#l20.11"></a><span id="l20.11">             &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot; orient=&quot;horizontal&quot; flex=&quot;1&quot; style=&quot;min-width: 1px;&quot; class=&quot;tabmail-arrowscrollbox&quot;&gt;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-              &lt;children/&gt;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l20.14"></a><span id="l20.14">             &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+            &lt;children/&gt;</span>
<a href="#l20.16"></a><span id="l20.16">             &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot;&gt;</span>
<a href="#l20.17"></a><span id="l20.17">               &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box&quot; </span>
<a href="#l20.18"></a><span id="l20.18">                         anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l20.19"></a><span id="l20.19">               &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot; </span>
<a href="#l20.20"></a><span id="l20.20">                         anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l20.21"></a><span id="l20.21">               &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot;</span>
<a href="#l20.22"></a><span id="l20.22">                                  type=&quot;menu&quot;</span>
<a href="#l20.23"></a><span id="l20.23">                                  anonid=&quot;alltabs-button&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/themes/qute/mail/tabmailBindings.xml</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/themes/qute/mail/tabmailBindings.xml</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -77,18 +77,19 @@</span>
<a href="#l21.4"></a><span id="l21.4">               &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l21.5"></a><span id="l21.5">             &lt;/xul:stack&gt;</span>
<a href="#l21.6"></a><span id="l21.6">             &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot;</span>
<a href="#l21.7"></a><span id="l21.7">                                 orient=&quot;horizontal&quot;</span>
<a href="#l21.8"></a><span id="l21.8">                                 flex=&quot;1&quot;</span>
<a href="#l21.9"></a><span id="l21.9">                                 style=&quot;min-width: 1px;&quot;</span>
<a href="#l21.10"></a><span id="l21.10">                                 chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l21.11"></a><span id="l21.11">                                 class=&quot;tabmail-arrowscrollbox&quot;&gt;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-              &lt;children/&gt;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l21.14"></a><span id="l21.14">             &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+            &lt;children/&gt;</span>
<a href="#l21.16"></a><span id="l21.16">             &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l21.17"></a><span id="l21.17">               &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l21.18"></a><span id="l21.18">                         class=&quot;tabs-alltabs-box&quot;</span>
<a href="#l21.19"></a><span id="l21.19">                         anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l21.20"></a><span id="l21.20">               &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot;</span>
<a href="#l21.21"></a><span id="l21.21">                         anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l21.22"></a><span id="l21.22">               &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot; type=&quot;menu&quot;</span>
<a href="#l21.23"></a><span id="l21.23">                                  anonid=&quot;alltabs-button&quot;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

