<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22050:93d7402586ec2b1f30de938083d5cdb10d0b3741</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 93d7402586ec2b1f30de938083d5cdb10d0b3741" />
<meta property="og:url" content="/comm-central/rev/93d7402586ec2b1f30de938083d5cdb10d0b3741" />
<meta property="og:description" content="Bug 1334834 - remove use of nsIAtom from mailnews/nsIFolder*.idl. r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 93d7402586ec2b1f30de938083d5cdb10d0b3741 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/93d7402586ec2b1f30de938083d5cdb10d0b3741">shortlog</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/93d7402586ec2b1f30de938083d5cdb10d0b3741">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741">files</a> |
changeset |
<a href="/comm-central/raw-rev/93d7402586ec2b1f30de938083d5cdb10d0b3741">raw</a>  | <a href="/comm-central/archive/93d7402586ec2b1f30de938083d5cdb10d0b3741.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1334834">Bug 1334834</a> - remove use of nsIAtom from mailnews/nsIFolder*.idl. r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 26 Aug 2017 12:18:00 +0200</td></tr>

<tr>
 <td>changeset 22050</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/93d7402586ec2b1f30de938083d5cdb10d0b3741">93d7402586ec2b1f30de938083d5cdb10d0b3741</a></td>
</tr>



<tr>
<td>parent 22049</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/902ced95970415d12786f23af1292c5fd3800971">902ced95970415d12786f23af1292c5fd3800971</a>
</td>
</tr>

<tr>
<td>child 22051</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9df74592471ab94f262e59b2de5394202b4e74d4">9df74592471ab94f262e59b2de5394202b4e74d4</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=93d7402586ec2b1f30de938083d5cdb10d0b3741">13459</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 27 Aug 2017 12:01:21 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6d35f2d9bf66 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6d35f2d9bf66d6a7a8c5ec862424911199d3774f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6d35f2d9bf66d6a7a8c5ec862424911199d3774f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6d35f2d9bf66d6a7a8c5ec862424911199d3774f&newProject=comm-central&newRevision=93d7402586ec2b1f30de938083d5cdb10d0b3741&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6d35f2d9bf66d6a7a8c5ec862424911199d3774f&newProject=comm-central&newRevision=93d7402586ec2b1f30de938083d5cdb10d0b3741&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6d35f2d9bf66d6a7a8c5ec862424911199d3774f&newProject=comm-central&newRevision=93d7402586ec2b1f30de938083d5cdb10d0b3741&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1334834">1334834</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1334834">Bug 1334834</a> - remove use of nsIAtom from mailnews/nsIFolder*.idl. r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/addrbook/src/nsAbView.h">mailnews/addrbook/src/nsAbView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/addrbook/src/nsAbView.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/addrbook/src/nsAbView.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/addrbook/src/nsAbView.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/addrbook/src/nsAbView.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/addrbook/src/nsAbView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIFolderListener.idl">mailnews/base/public/nsIFolderListener.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIFolderListener.idl">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIFolderListener.idl">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIFolderListener.idl">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIFolderListener.idl">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIFolderListener.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgAccountManager.idl">mailnews/base/public/nsIMsgAccountManager.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgAccountManager.idl">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgAccountManager.idl">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgAccountManager.idl">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgAccountManager.idl">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgAccountManager.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgFolder.idl">mailnews/base/public/nsIMsgFolder.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgFolder.idl">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgFolder.idl">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgFolder.idl">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgFolder.idl">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/public/nsIMsgFolder.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.h">mailnews/base/src/nsMessenger.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessenger.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.h">mailnews/base/src/nsMessengerOSXIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.mm">mailnews/base/src/nsMessengerOSXIntegration.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.mm">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.mm">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.mm">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.mm">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerOSXIntegration.mm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.cpp">mailnews/base/src/nsMessengerUnixIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.h">mailnews/base/src/nsMessengerUnixIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerUnixIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.h">mailnews/base/src/nsMessengerWinIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMessengerWinIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.h">mailnews/base/src/nsMsgAccountManager.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManager.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.cpp">mailnews/base/src/nsMsgAccountManagerDS.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.h">mailnews/base/src/nsMsgAccountManagerDS.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgAccountManagerDS.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgDBView.h">mailnews/base/src/nsMsgDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgDBView.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgDBView.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgDBView.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgDBView.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgDBView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.h">mailnews/base/src/nsMsgFolderDataSource.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgFolderDataSource.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgMailSession.cpp">mailnews/base/src/nsMsgMailSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgMailSession.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgMailSession.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgMailSession.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgMailSession.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgMailSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.cpp">mailnews/base/src/nsMsgStatusFeedback.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.h">mailnews/base/src/nsMsgStatusFeedback.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgStatusFeedback.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgWindow.h">mailnews/base/src/nsMsgWindow.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgWindow.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgWindow.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgWindow.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgWindow.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsMsgWindow.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.cpp">mailnews/base/src/nsStatusBarBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.h">mailnews/base/src/nsStatusBarBiffManager.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/src/nsStatusBarBiffManager.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/moz.build">mailnews/base/util/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/moz.build">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/moz.build">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/moz.build">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/moz.build">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.h">mailnews/base/util/nsMsgDBFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolder.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolderAtomList.h">mailnews/base/util/nsMsgDBFolderAtomList.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolderAtomList.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolderAtomList.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgDBFolderAtomList.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.cpp">mailnews/compose/src/nsMsgSendLater.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.h">mailnews/compose/src/nsMsgSendLater.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/compose/src/nsMsgSendLater.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalUndoTxn.cpp">mailnews/local/src/nsLocalUndoTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalUndoTxn.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalUndoTxn.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalUndoTxn.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalUndoTxn.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsLocalUndoTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsPop3IncomingServer.cpp">mailnews/local/src/nsPop3IncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsPop3IncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsPop3IncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsPop3IncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsPop3IncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/local/src/nsPop3IncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.h">mailnews/news/src/nsNntpIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.h">file</a> |
<a href="/comm-central/annotate/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.h">comparison</a> |
<a href="/comm-central/log/93d7402586ec2b1f30de938083d5cdb10d0b3741/mailnews/news/src/nsNntpIncomingServer.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbView.h</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbView.h</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -9,17 +9,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #include &quot;nsISupports.h&quot;</span>
<a href="#l1.5"></a><span id="l1.5"> #include &quot;nsString.h&quot;</span>
<a href="#l1.6"></a><span id="l1.6"> #include &quot;nsIAbView.h&quot;</span>
<a href="#l1.7"></a><span id="l1.7"> #include &quot;nsITreeView.h&quot;</span>
<a href="#l1.8"></a><span id="l1.8"> #include &quot;nsITreeBoxObject.h&quot;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsITreeSelection.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> #include &quot;nsTArray.h&quot;</span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-#include &quot;nsIAtom.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13"> #include &quot;nsICollation.h&quot;</span>
<a href="#l1.14"></a><span id="l1.14"> #include &quot;nsIAbListener.h&quot;</span>
<a href="#l1.15"></a><span id="l1.15"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l1.16"></a><span id="l1.16"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l1.17"></a><span id="l1.17"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l1.18"></a><span id="l1.18"> #include &quot;nsMemory.h&quot;</span>
<a href="#l1.19"></a><span id="l1.19"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l1.20"></a><span id="l1.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/public/nsIFolderListener.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/public/nsIFolderListener.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l2.5"></a><span id="l2.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.7"></a><span id="l2.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineminus">-#include &quot;nsIAtom.idl&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12"> interface nsIMsgFolder;</span>
<a href="#l2.13"></a><span id="l2.13"> interface nsIMsgDBHdr;</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15"> typedef unsigned long folderListenerNotifyFlagValue;</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17"> [scriptable, uuid(f60ee1a2-6d81-422c-958f-d408b1b2daa7)]</span>
<a href="#l2.18"></a><span id="l2.18"> interface nsIFolderListener : nsISupports {</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineat">@@ -18,46 +17,46 @@ interface nsIFolderListener : nsISupport</span>
<a href="#l2.20"></a><span id="l2.20">                    in nsISupports aItem);</span>
<a href="#l2.21"></a><span id="l2.21">   </span>
<a href="#l2.22"></a><span id="l2.22">   const folderListenerNotifyFlagValue removed = 0x2;</span>
<a href="#l2.23"></a><span id="l2.23">   void OnItemRemoved(in nsIMsgFolder aParentItem,</span>
<a href="#l2.24"></a><span id="l2.24">                      in nsISupports aItem);</span>
<a href="#l2.25"></a><span id="l2.25">   </span>
<a href="#l2.26"></a><span id="l2.26">   const folderListenerNotifyFlagValue propertyChanged = 0x4;</span>
<a href="#l2.27"></a><span id="l2.27">   void OnItemPropertyChanged(in nsIMsgFolder aItem,</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-                             in nsIAtom aProperty,</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+                             in ACString aProperty,</span>
<a href="#l2.30"></a><span id="l2.30">                              in string aOldValue,</span>
<a href="#l2.31"></a><span id="l2.31">                              in string aNewValue);</span>
<a href="#l2.32"></a><span id="l2.32">   </span>
<a href="#l2.33"></a><span id="l2.33">   const folderListenerNotifyFlagValue intPropertyChanged = 0x8;</span>
<a href="#l2.34"></a><span id="l2.34">   // While this property handles long long (64bit wide) values,</span>
<a href="#l2.35"></a><span id="l2.35">   // the Javascript engine will only pass values up to 2^53 to the consumers.</span>
<a href="#l2.36"></a><span id="l2.36">   void OnItemIntPropertyChanged(in nsIMsgFolder aItem,</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-                                in nsIAtom aProperty,</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+                                in ACString aProperty,</span>
<a href="#l2.39"></a><span id="l2.39">                                 in long long aOldValue,</span>
<a href="#l2.40"></a><span id="l2.40">                                 in long long aNewValue);</span>
<a href="#l2.41"></a><span id="l2.41">   </span>
<a href="#l2.42"></a><span id="l2.42">   const folderListenerNotifyFlagValue boolPropertyChanged = 0x10;</span>
<a href="#l2.43"></a><span id="l2.43">   void OnItemBoolPropertyChanged(in nsIMsgFolder aItem,</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-                                 in nsIAtom aProperty,</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+                                 in ACString aProperty,</span>
<a href="#l2.46"></a><span id="l2.46">                                  in boolean aOldValue,</span>
<a href="#l2.47"></a><span id="l2.47">                                  in boolean aNewValue);</span>
<a href="#l2.48"></a><span id="l2.48">   </span>
<a href="#l2.49"></a><span id="l2.49">   const folderListenerNotifyFlagValue unicharPropertyChanged = 0x20;</span>
<a href="#l2.50"></a><span id="l2.50">   void OnItemUnicharPropertyChanged(in nsIMsgFolder aItem,</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-                                    in nsIAtom aProperty,</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+                                    in ACString aProperty,</span>
<a href="#l2.53"></a><span id="l2.53">                                     in wstring aOldValue,</span>
<a href="#l2.54"></a><span id="l2.54">                                     in wstring aNewValue);</span>
<a href="#l2.55"></a><span id="l2.55">   </span>
<a href="#l2.56"></a><span id="l2.56">   const folderListenerNotifyFlagValue propertyFlagChanged = 0x40;</span>
<a href="#l2.57"></a><span id="l2.57">   void OnItemPropertyFlagChanged(in nsIMsgDBHdr aItem,</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-                                 in nsIAtom aProperty,</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+                                 in ACString aProperty,</span>
<a href="#l2.60"></a><span id="l2.60">                                  in unsigned long aOldFlag,</span>
<a href="#l2.61"></a><span id="l2.61">                                  in unsigned long aNewFlag);</span>
<a href="#l2.62"></a><span id="l2.62"> </span>
<a href="#l2.63"></a><span id="l2.63">   const folderListenerNotifyFlagValue event = 0x80;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-  void OnItemEvent(in nsIMsgFolder aItem, in nsIAtom aEvent);</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+  void OnItemEvent(in nsIMsgFolder aItem, in ACString aEvent);</span>
<a href="#l2.66"></a><span id="l2.66">   </span>
<a href="#l2.67"></a><span id="l2.67">   const folderListenerNotifyFlagValue all = 0xFFFFFFFF; </span>
<a href="#l2.68"></a><span id="l2.68"> </span>
<a href="#l2.69"></a><span id="l2.69">   //  void OnFolderLoaded(in nsIMsgFolder aFolder);</span>
<a href="#l2.70"></a><span id="l2.70">   //  void OnDeleteOrMoveMessagesCompleted(in nsIMsgFolder aFolder);</span>
<a href="#l2.71"></a><span id="l2.71"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgAccountManager.idl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgAccountManager.idl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -191,17 +191,18 @@ interface nsIMsgAccountManager : nsISupp</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">   void addRootFolderListener(in nsIFolderListener listener);</span>
<a href="#l3.6"></a><span id="l3.6">   void removeRootFolderListener(in nsIFolderListener listener);</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">   // these are going away in favor of add/removeRootFolderListener</span>
<a href="#l3.9"></a><span id="l3.9">   void addIncomingServerListener(in nsIIncomingServerListener serverListener);</span>
<a href="#l3.10"></a><span id="l3.10">   void removeIncomingServerListener(in nsIIncomingServerListener serverListener);</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  // these are going away in favor of nsIMsgFolder::NotifyEvent(in nsIAtom event);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  // these are going away in favor of nsIMsgFolder::NotifyEvent(in ACString event);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  // XXX what does this mean? There is no such function yet.</span>
<a href="#l3.15"></a><span id="l3.15">   void notifyServerLoaded(in nsIMsgIncomingServer server);</span>
<a href="#l3.16"></a><span id="l3.16">   void notifyServerUnloaded(in nsIMsgIncomingServer server);</span>
<a href="#l3.17"></a><span id="l3.17">   void notifyServerChanged(in nsIMsgIncomingServer server);</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">   // force account info out to prefs file</span>
<a href="#l3.20"></a><span id="l3.20">   void saveAccountInfo();</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22">   ACString getChromePackageName(in ACString aExtensionName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -669,37 +669,37 @@ interface nsIMsgFolder : nsISupports {</span>
<a href="#l4.4"></a><span id="l4.4">    * @param escapedSubFolderName  The name of the sub folder to find.</span>
<a href="#l4.5"></a><span id="l4.5">    * @note                        Even if the folder doesn't currently exist,</span>
<a href="#l4.6"></a><span id="l4.6">    *                              a nsIMsgFolder may be returned.</span>
<a href="#l4.7"></a><span id="l4.7">    */</span>
<a href="#l4.8"></a><span id="l4.8">   nsIMsgFolder findSubFolder(in ACString escapedSubFolderName);</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">   void AddFolderListener(in nsIFolderListener listener);</span>
<a href="#l4.11"></a><span id="l4.11">   void RemoveFolderListener(in nsIFolderListener listener);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  void NotifyPropertyChanged(in nsIAtom property,</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  void NotifyPropertyChanged(in ACString property,</span>
<a href="#l4.14"></a><span id="l4.14">                              in ACString oldValue,</span>
<a href="#l4.15"></a><span id="l4.15">                              in ACString newValue);</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-  void NotifyIntPropertyChanged(in nsIAtom property,</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+  void NotifyIntPropertyChanged(in ACString property,</span>
<a href="#l4.18"></a><span id="l4.18">                                 in long long oldValue,</span>
<a href="#l4.19"></a><span id="l4.19">                                 in long long newValue);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-  void NotifyBoolPropertyChanged(in nsIAtom property,</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+  void NotifyBoolPropertyChanged(in ACString property,</span>
<a href="#l4.22"></a><span id="l4.22">                                  in boolean oldValue,</span>
<a href="#l4.23"></a><span id="l4.23">                                  in boolean newValue);</span>
<a href="#l4.24"></a><span id="l4.24">   void NotifyPropertyFlagChanged(in nsIMsgDBHdr item,</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-                                 in nsIAtom property,</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+                                 in ACString property,</span>
<a href="#l4.27"></a><span id="l4.27">                                  in unsigned long oldValue,</span>
<a href="#l4.28"></a><span id="l4.28">                                  in unsigned long newValue);</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-  void NotifyUnicharPropertyChanged(in nsIAtom property,</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+  void NotifyUnicharPropertyChanged(in ACString property,</span>
<a href="#l4.31"></a><span id="l4.31">                                     in AString oldValue,</span>
<a href="#l4.32"></a><span id="l4.32">                                     in AString newValue);</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34">   void NotifyItemAdded(in nsISupports item);</span>
<a href="#l4.35"></a><span id="l4.35">   void NotifyItemRemoved(in nsISupports item);</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-  void NotifyFolderEvent(in nsIAtom event);</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+  void NotifyFolderEvent(in ACString event);</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40">   //  void NotifyFolderLoaded();</span>
<a href="#l4.41"></a><span id="l4.41">   //  void NotifyDeleteOrMoveMessagesCompleted(in nsIMsgFolder folder);</span>
<a href="#l4.42"></a><span id="l4.42"> </span>
<a href="#l4.43"></a><span id="l4.43">   // Gets all descendants, not just first level children.</span>
<a href="#l4.44"></a><span id="l4.44">   readonly attribute nsIArray descendants;</span>
<a href="#l4.45"></a><span id="l4.45">   /*</span>
<a href="#l4.46"></a><span id="l4.46">    * Lists all the folders that are subfolders of the current folder,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -2283,48 +2283,48 @@ NS_IMETHODIMP nsMessenger::OnItemRemoved</span>
<a href="#l5.4"></a><span id="l5.4">         if (mCurHistoryPos &gt;= (int32_t)uriPos)</span>
<a href="#l5.5"></a><span id="l5.5">           mCurHistoryPos -= 2;</span>
<a href="#l5.6"></a><span id="l5.6">       }</span>
<a href="#l5.7"></a><span id="l5.7">     }</span>
<a href="#l5.8"></a><span id="l5.8">   }</span>
<a href="#l5.9"></a><span id="l5.9">   return NS_OK;</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-/* void OnItemPropertyChanged (in nsIMsgFolder item, in nsIAtom property, in string oldValue, in string newValue); */</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-NS_IMETHODIMP nsMessenger::OnItemPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char *oldValue, const char *newValue)</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+/* void OnItemPropertyChanged (in nsIMsgFolder item, in ACString property, in string oldValue, in string newValue); */</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+NS_IMETHODIMP nsMessenger::OnItemPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char *oldValue, const char *newValue)</span>
<a href="#l5.16"></a><span id="l5.16"> {</span>
<a href="#l5.17"></a><span id="l5.17">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.18"></a><span id="l5.18"> }</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-/* void OnItemIntPropertyChanged (in nsIMsgFolder item, in nsIAtom property, in long long oldValue, in long long newValue); */</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-NS_IMETHODIMP nsMessenger::OnItemIntPropertyChanged(nsIMsgFolder *item, nsIAtom *property, int64_t oldValue, int64_t newValue)</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+/* void OnItemIntPropertyChanged (in nsIMsgFolder item, in ACString property, in long long oldValue, in long long newValue); */</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+NS_IMETHODIMP nsMessenger::OnItemIntPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, int64_t oldValue, int64_t newValue)</span>
<a href="#l5.24"></a><span id="l5.24"> {</span>
<a href="#l5.25"></a><span id="l5.25">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.26"></a><span id="l5.26"> }</span>
<a href="#l5.27"></a><span id="l5.27"> </span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-/* void OnItemBoolPropertyChanged (in nsIMsgFolder item, in nsIAtom property, in boolean oldValue, in boolean newValue); */</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-NS_IMETHODIMP nsMessenger::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+/* void OnItemBoolPropertyChanged (in nsIMsgFolder item, in ACString property, in boolean oldValue, in boolean newValue); */</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+NS_IMETHODIMP nsMessenger::OnItemBoolPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, bool oldValue, bool newValue)</span>
<a href="#l5.32"></a><span id="l5.32"> {</span>
<a href="#l5.33"></a><span id="l5.33">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.34"></a><span id="l5.34"> }</span>
<a href="#l5.35"></a><span id="l5.35"> </span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-/* void OnItemUnicharPropertyChanged (in nsIMsgFolder item, in nsIAtom property, in wstring oldValue, in wstring newValue); */</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-NS_IMETHODIMP nsMessenger::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+/* void OnItemUnicharPropertyChanged (in nsIMsgFolder item, in ACString property, in wstring oldValue, in wstring newValue); */</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+NS_IMETHODIMP nsMessenger::OnItemUnicharPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l5.40"></a><span id="l5.40"> {</span>
<a href="#l5.41"></a><span id="l5.41">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.42"></a><span id="l5.42"> }</span>
<a href="#l5.43"></a><span id="l5.43"> </span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-/* void OnItemPropertyFlagChanged (in nsIMsgDBHdr item, in nsIAtom property, in unsigned long oldFlag, in unsigned long newFlag); */</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-NS_IMETHODIMP nsMessenger::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+/* void OnItemPropertyFlagChanged (in nsIMsgDBHdr item, in ACString property, in unsigned long oldFlag, in unsigned long newFlag); */</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+NS_IMETHODIMP nsMessenger::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, const nsACString &amp;property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l5.48"></a><span id="l5.48"> {</span>
<a href="#l5.49"></a><span id="l5.49">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.50"></a><span id="l5.50"> }</span>
<a href="#l5.51"></a><span id="l5.51"> </span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-/* void OnItemEvent (in nsIMsgFolder item, in nsIAtom event); */</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-NS_IMETHODIMP nsMessenger::OnItemEvent(nsIMsgFolder *item, nsIAtom *event)</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+/* void OnItemEvent (in nsIMsgFolder item, in string event); */</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+NS_IMETHODIMP nsMessenger::OnItemEvent(nsIMsgFolder *item, const nsACString &amp;event)</span>
<a href="#l5.56"></a><span id="l5.56"> {</span>
<a href="#l5.57"></a><span id="l5.57">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.58"></a><span id="l5.58"> }</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l5.61"></a><span id="l5.61"> // Detach/Delete Attachments</span>
<a href="#l5.62"></a><span id="l5.62"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l5.63"></a><span id="l5.63"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -7,16 +7,17 @@</span>
<a href="#l6.4"></a><span id="l6.4"> #define __nsMsgAppCore_h</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;nscore.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;nsIMessenger.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsITransactionManager.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;nsIFile.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+#include &quot;nsString.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l6.14"></a><span id="l6.14"> #include &quot;nsIFile.h&quot;</span>
<a href="#l6.15"></a><span id="l6.15"> #include &quot;nsIFilePicker.h&quot;</span>
<a href="#l6.16"></a><span id="l6.16"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l6.17"></a><span id="l6.17"> #include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l6.18"></a><span id="l6.18"> #include &quot;nsTArray.h&quot;</span>
<a href="#l6.19"></a><span id="l6.19"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l6.20"></a><span id="l6.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -3,17 +3,16 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.5"></a><span id="l7.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> #ifndef __nsMessengerOSXIntegration_h</span>
<a href="#l7.8"></a><span id="l7.8"> #define __nsMessengerOSXIntegration_h</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10"> #include &quot;nsIMessengerOSIntegration.h&quot;</span>
<a href="#l7.11"></a><span id="l7.11"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-#include &quot;nsIAtom.h&quot;</span>
<a href="#l7.13"></a><span id="l7.13"> #include &quot;nsITimer.h&quot;</span>
<a href="#l7.14"></a><span id="l7.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l7.15"></a><span id="l7.15"> #include &quot;nsString.h&quot;</span>
<a href="#l7.16"></a><span id="l7.16"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l7.17"></a><span id="l7.17"> #include &quot;nsIAlertsService.h&quot;</span>
<a href="#l7.18"></a><span id="l7.18"> #include &quot;mozINewMailListener.h&quot;</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> #define NS_MESSENGEROSXINTEGRATION_CID \</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -35,18 +34,16 @@ public:</span>
<a href="#l7.22"></a><span id="l7.22">   NS_DECL_NSIMESSENGEROSINTEGRATION</span>
<a href="#l7.23"></a><span id="l7.23">   NS_DECL_NSIFOLDERLISTENER</span>
<a href="#l7.24"></a><span id="l7.24">   NS_DECL_NSIOBSERVER</span>
<a href="#l7.25"></a><span id="l7.25">   NS_DECL_MOZINEWMAILLISTENER</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27"> private:</span>
<a href="#l7.28"></a><span id="l7.28">   virtual ~nsMessengerOSXIntegration();</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-  nsCOMPtr&lt;nsIAtom&gt; mBiffStateAtom;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  nsCOMPtr&lt;nsIAtom&gt; mNewMailReceivedAtom;</span>
<a href="#l7.32"></a><span id="l7.32">   nsresult ShowAlertMessage(const nsAString&amp; aAlertTitle, const nsAString&amp; aAlertText, const nsACString&amp; aFolderURI);</span>
<a href="#l7.33"></a><span id="l7.33">   nsresult OnAlertFinished();</span>
<a href="#l7.34"></a><span id="l7.34">   nsresult OnAlertClicked(const char16_t * aAlertCookie);</span>
<a href="#l7.35"></a><span id="l7.35"> #ifdef MOZ_SUITE</span>
<a href="#l7.36"></a><span id="l7.36">   nsresult OnAlertClickedSimple();</span>
<a href="#l7.37"></a><span id="l7.37"> #endif</span>
<a href="#l7.38"></a><span id="l7.38">   nsresult GetStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l7.39"></a><span id="l7.39">   void FillToolTipInfo(nsIMsgFolder *aFolder, int32_t aNewCount);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -7,19 +7,20 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l8.5"></a><span id="l8.5"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l8.6"></a><span id="l8.6"> #include &quot;nsMessengerOSXIntegration.h&quot;</span>
<a href="#l8.7"></a><span id="l8.7"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l8.8"></a><span id="l8.8"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l8.9"></a><span id="l8.9"> #include &quot;nsIMsgIdentity.h&quot;</span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l8.11"></a><span id="l8.11"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+#include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l8.15"></a><span id="l8.15"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-#include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l8.17"></a><span id="l8.17"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l8.18"></a><span id="l8.18"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l8.19"></a><span id="l8.19"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l8.20"></a><span id="l8.20"> #include &quot;nsIWindowMediator.h&quot;</span>
<a href="#l8.21"></a><span id="l8.21"> #include &quot;nsIDOMChromeWindow.h&quot;</span>
<a href="#l8.22"></a><span id="l8.22"> #include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l8.23"></a><span id="l8.23"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l8.24"></a><span id="l8.24"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineat">@@ -154,18 +155,16 @@ static void openMailWindow(const nsCStri</span>
<a href="#l8.26"></a><span id="l8.26">     if (messengerWindowService)</span>
<a href="#l8.27"></a><span id="l8.27">       messengerWindowService-&gt;OpenMessengerWindowWithUri(</span>
<a href="#l8.28"></a><span id="l8.28">                                 &quot;mail:3pane&quot;, aUri.get(), nsMsgKey_None);</span>
<a href="#l8.29"></a><span id="l8.29">   }</span>
<a href="#l8.30"></a><span id="l8.30"> }</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32"> nsMessengerOSXIntegration::nsMessengerOSXIntegration()</span>
<a href="#l8.33"></a><span id="l8.33"> {</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-  mBiffStateAtom = MsgGetAtom(&quot;BiffState&quot;);</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-  mNewMailReceivedAtom = MsgGetAtom(&quot;NewMailReceived&quot;);</span>
<a href="#l8.36"></a><span id="l8.36">   mUnreadTotal = 0;</span>
<a href="#l8.37"></a><span id="l8.37">   mUnreadChat = 0;</span>
<a href="#l8.38"></a><span id="l8.38"> }</span>
<a href="#l8.39"></a><span id="l8.39"> </span>
<a href="#l8.40"></a><span id="l8.40"> nsMessengerOSXIntegration::~nsMessengerOSXIntegration()</span>
<a href="#l8.41"></a><span id="l8.41"> {</span>
<a href="#l8.42"></a><span id="l8.42">   RestoreDockIcon();</span>
<a href="#l8.43"></a><span id="l8.43"> }</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineat">@@ -187,23 +186,23 @@ nsMessengerOSXIntegration::Init()</span>
<a href="#l8.45"></a><span id="l8.45"> {</span>
<a href="#l8.46"></a><span id="l8.46">   nsresult rv;</span>
<a href="#l8.47"></a><span id="l8.47">   nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l8.48"></a><span id="l8.48">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.49"></a><span id="l8.49">   return observerService-&gt;AddObserver(this, &quot;mail-startup-done&quot;, false);</span>
<a href="#l8.50"></a><span id="l8.50"> }</span>
<a href="#l8.51"></a><span id="l8.51"> </span>
<a href="#l8.52"></a><span id="l8.52"> NS_IMETHODIMP</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-nsMessengerOSXIntegration::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+nsMessengerOSXIntegration::OnItemPropertyChanged(nsIMsgFolder *, const nsACString &amp;, char const *, char const *)</span>
<a href="#l8.55"></a><span id="l8.55"> {</span>
<a href="#l8.56"></a><span id="l8.56">   return NS_OK;</span>
<a href="#l8.57"></a><span id="l8.57"> }</span>
<a href="#l8.58"></a><span id="l8.58"> </span>
<a href="#l8.59"></a><span id="l8.59"> NS_IMETHODIMP</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-nsMessengerOSXIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const char16_t *, const char16_t *)</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+nsMessengerOSXIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, const nsACString &amp;, const char16_t *, const char16_t *)</span>
<a href="#l8.62"></a><span id="l8.62"> {</span>
<a href="#l8.63"></a><span id="l8.63">   return NS_OK;</span>
<a href="#l8.64"></a><span id="l8.64"> }</span>
<a href="#l8.65"></a><span id="l8.65"> </span>
<a href="#l8.66"></a><span id="l8.66"> NS_IMETHODIMP</span>
<a href="#l8.67"></a><span id="l8.67"> nsMessengerOSXIntegration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l8.68"></a><span id="l8.68"> {</span>
<a href="#l8.69"></a><span id="l8.69">   return NS_OK;</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineat">@@ -405,17 +404,17 @@ nsMessengerOSXIntegration::ShowAlertMess</span>
<a href="#l8.71"></a><span id="l8.71">   if (NS_FAILED(rv))</span>
<a href="#l8.72"></a><span id="l8.72">     OnAlertFinished();</span>
<a href="#l8.73"></a><span id="l8.73"> </span>
<a href="#l8.74"></a><span id="l8.74">   return rv;</span>
<a href="#l8.75"></a><span id="l8.75"> }</span>
<a href="#l8.76"></a><span id="l8.76"> </span>
<a href="#l8.77"></a><span id="l8.77"> NS_IMETHODIMP</span>
<a href="#l8.78"></a><span id="l8.78"> nsMessengerOSXIntegration::OnItemIntPropertyChanged(nsIMsgFolder *aFolder,</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-                                                    nsIAtom *aProperty,</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+                                                    const nsACString &amp;aProperty,</span>
<a href="#l8.81"></a><span id="l8.81">                                                     int64_t aOldValue,</span>
<a href="#l8.82"></a><span id="l8.82">                                                     int64_t aNewValue)</span>
<a href="#l8.83"></a><span id="l8.83"> {</span>
<a href="#l8.84"></a><span id="l8.84">   // if we got new mail show an alert</span>
<a href="#l8.85"></a><span id="l8.85">   if (aNewValue == nsIMsgFolder::nsMsgBiffState_NewMail)</span>
<a href="#l8.86"></a><span id="l8.86">   {</span>
<a href="#l8.87"></a><span id="l8.87">     bool performingBiff = false;</span>
<a href="#l8.88"></a><span id="l8.88">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineat">@@ -433,17 +432,17 @@ nsMessengerOSXIntegration::OnItemIntProp</span>
<a href="#l8.90"></a><span id="l8.90">                                            getter_AddRefs(childFolder));</span>
<a href="#l8.91"></a><span id="l8.91">     if (NS_FAILED(rv) || !childFolder)</span>
<a href="#l8.92"></a><span id="l8.92">       return NS_ERROR_FAILURE;</span>
<a href="#l8.93"></a><span id="l8.93"> </span>
<a href="#l8.94"></a><span id="l8.94">     int32_t numNewMessages = 0;</span>
<a href="#l8.95"></a><span id="l8.95">     childFolder-&gt;GetNumNewMessages(true, &amp;numNewMessages);</span>
<a href="#l8.96"></a><span id="l8.96">     FillToolTipInfo(childFolder, numNewMessages);</span>
<a href="#l8.97"></a><span id="l8.97">   }</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineminus">-  else if (mNewMailReceivedAtom == aProperty)</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineplus">+  else if (aProperty.Equals(kNewMailReceived))</span>
<a href="#l8.100"></a><span id="l8.100">   {</span>
<a href="#l8.101"></a><span id="l8.101">     FillToolTipInfo(aFolder, aNewValue);</span>
<a href="#l8.102"></a><span id="l8.102">   }</span>
<a href="#l8.103"></a><span id="l8.103">   return NS_OK;</span>
<a href="#l8.104"></a><span id="l8.104"> }</span>
<a href="#l8.105"></a><span id="l8.105"> </span>
<a href="#l8.106"></a><span id="l8.106"> nsresult</span>
<a href="#l8.107"></a><span id="l8.107"> nsMessengerOSXIntegration::OnAlertClicked(const char16_t* aAlertCookie)</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineat">@@ -560,38 +559,38 @@ nsMessengerOSXIntegration::BadgeDockIcon</span>
<a href="#l8.109"></a><span id="l8.109">   id tile = [[NSApplication sharedApplication] dockTile];</span>
<a href="#l8.110"></a><span id="l8.110">   [tile setBadgeLabel:[NSString stringWithFormat:@&quot;%S&quot;, (const unichar*)badgeString.get()]];</span>
<a href="#l8.111"></a><span id="l8.111">   return NS_OK;</span>
<a href="#l8.112"></a><span id="l8.112"> </span>
<a href="#l8.113"></a><span id="l8.113">   NS_OBJC_END_TRY_ABORT_BLOCK_NSRESULT;</span>
<a href="#l8.114"></a><span id="l8.114"> }</span>
<a href="#l8.115"></a><span id="l8.115"> </span>
<a href="#l8.116"></a><span id="l8.116"> NS_IMETHODIMP</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-nsMessengerOSXIntegration::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+nsMessengerOSXIntegration::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, const nsACString &amp;property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l8.119"></a><span id="l8.119"> {</span>
<a href="#l8.120"></a><span id="l8.120">   return NS_OK;</span>
<a href="#l8.121"></a><span id="l8.121"> }</span>
<a href="#l8.122"></a><span id="l8.122"> </span>
<a href="#l8.123"></a><span id="l8.123"> NS_IMETHODIMP</span>
<a href="#l8.124"></a><span id="l8.124"> nsMessengerOSXIntegration::OnItemAdded(nsIMsgFolder *, nsISupports *)</span>
<a href="#l8.125"></a><span id="l8.125"> {</span>
<a href="#l8.126"></a><span id="l8.126">   return NS_OK;</span>
<a href="#l8.127"></a><span id="l8.127"> }</span>
<a href="#l8.128"></a><span id="l8.128"> </span>
<a href="#l8.129"></a><span id="l8.129"> NS_IMETHODIMP</span>
<a href="#l8.130"></a><span id="l8.130"> nsMessengerOSXIntegration::OnItemBoolPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineminus">-                                                         nsIAtom *aProperty,</span>
<a href="#l8.132"></a><span id="l8.132" class="difflineminus">-                                                         bool aOldValue,</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineminus">-                                                         bool aNewValue)</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineplus">+                                                     const nsACString &amp;aProperty,</span>
<a href="#l8.135"></a><span id="l8.135" class="difflineplus">+                                                     bool aOldValue,</span>
<a href="#l8.136"></a><span id="l8.136" class="difflineplus">+                                                     bool aNewValue)</span>
<a href="#l8.137"></a><span id="l8.137"> {</span>
<a href="#l8.138"></a><span id="l8.138">   return NS_OK;</span>
<a href="#l8.139"></a><span id="l8.139"> }</span>
<a href="#l8.140"></a><span id="l8.140"> </span>
<a href="#l8.141"></a><span id="l8.141"> NS_IMETHODIMP</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineminus">-nsMessengerOSXIntegration::OnItemEvent(nsIMsgFolder *, nsIAtom *)</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineplus">+nsMessengerOSXIntegration::OnItemEvent(nsIMsgFolder *, const nsACString &amp;)</span>
<a href="#l8.144"></a><span id="l8.144"> {</span>
<a href="#l8.145"></a><span id="l8.145">   return NS_OK;</span>
<a href="#l8.146"></a><span id="l8.146"> }</span>
<a href="#l8.147"></a><span id="l8.147"> </span>
<a href="#l8.148"></a><span id="l8.148"> nsresult</span>
<a href="#l8.149"></a><span id="l8.149"> nsMessengerOSXIntegration::GetNewMailAuthors(nsIMsgFolder* aFolder,</span>
<a href="#l8.150"></a><span id="l8.150">                                              nsString&amp; aAuthors,</span>
<a href="#l8.151"></a><span id="l8.151">                                              int32_t aNewCount,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -38,16 +38,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> #include &quot;prmem.h&quot;</span>
<a href="#l9.5"></a><span id="l9.5"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l9.6"></a><span id="l9.6"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l9.7"></a><span id="l9.7"> #include &quot;nsIWeakReferenceUtils.h&quot;</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l9.10"></a><span id="l9.10"> #include &quot;nsToolkitCompsCID.h&quot;</span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13"> #include &quot;msgCore.h&quot;</span>
<a href="#l9.14"></a><span id="l9.14"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l9.15"></a><span id="l9.15"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l9.16"></a><span id="l9.16"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l9.17"></a><span id="l9.17"> #include &quot;nsMemory.h&quot;</span>
<a href="#l9.18"></a><span id="l9.18"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l9.19"></a><span id="l9.19"> #include &quot;mozilla/mailnews/MimeHeaderParser.h&quot;</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21" class="difflineat">@@ -100,18 +101,16 @@ static void openMailWindow(const nsACStr</span>
<a href="#l9.22"></a><span id="l9.22">     if (messengerWindowService)</span>
<a href="#l9.23"></a><span id="l9.23">       messengerWindowService-&gt;OpenMessengerWindowWithUri(</span>
<a href="#l9.24"></a><span id="l9.24">                                 &quot;mail:3pane&quot;, nsCString(aFolderUri).get(), nsMsgKey_None);</span>
<a href="#l9.25"></a><span id="l9.25">   }</span>
<a href="#l9.26"></a><span id="l9.26"> }</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28"> nsMessengerUnixIntegration::nsMessengerUnixIntegration()</span>
<a href="#l9.29"></a><span id="l9.29"> {</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-  mBiffStateAtom = MsgGetAtom(&quot;BiffState&quot;);</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-  mNewMailReceivedAtom = MsgGetAtom(&quot;NewMailReceived&quot;);</span>
<a href="#l9.32"></a><span id="l9.32">   mAlertInProgress = false;</span>
<a href="#l9.33"></a><span id="l9.33">   mFoldersWithNewMail = do_CreateInstance(NS_ARRAY_CONTRACTID);</span>
<a href="#l9.34"></a><span id="l9.34"> }</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36"> NS_IMPL_ISUPPORTS(nsMessengerUnixIntegration, nsIFolderListener, nsIObserver,</span>
<a href="#l9.37"></a><span id="l9.37">                    nsIMessengerOSIntegration, nsIUrlListener)</span>
<a href="#l9.38"></a><span id="l9.38"> </span>
<a href="#l9.39"></a><span id="l9.39"> nsresult</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineat">@@ -120,23 +119,23 @@ nsMessengerUnixIntegration::Init()</span>
<a href="#l9.41"></a><span id="l9.41">   nsresult rv;</span>
<a href="#l9.42"></a><span id="l9.42"> </span>
<a href="#l9.43"></a><span id="l9.43">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l9.44"></a><span id="l9.44">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l9.45"></a><span id="l9.45">   return mailSession-&gt;AddFolderListener(this, nsIFolderListener::intPropertyChanged);</span>
<a href="#l9.46"></a><span id="l9.46"> }</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48"> NS_IMETHODIMP</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-nsMessengerUnixIntegration::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+nsMessengerUnixIntegration::OnItemPropertyChanged(nsIMsgFolder *, const nsACString &amp;, char const *, char const *)</span>
<a href="#l9.51"></a><span id="l9.51"> {</span>
<a href="#l9.52"></a><span id="l9.52">   return NS_OK;</span>
<a href="#l9.53"></a><span id="l9.53"> }</span>
<a href="#l9.54"></a><span id="l9.54"> </span>
<a href="#l9.55"></a><span id="l9.55"> NS_IMETHODIMP</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-nsMessengerUnixIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const char16_t *, const char16_t *)</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+nsMessengerUnixIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, const nsACString &amp;, const char16_t *, const char16_t *)</span>
<a href="#l9.58"></a><span id="l9.58"> {</span>
<a href="#l9.59"></a><span id="l9.59">   return NS_OK;</span>
<a href="#l9.60"></a><span id="l9.60"> }</span>
<a href="#l9.61"></a><span id="l9.61"> </span>
<a href="#l9.62"></a><span id="l9.62"> NS_IMETHODIMP</span>
<a href="#l9.63"></a><span id="l9.63"> nsMessengerUnixIntegration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l9.64"></a><span id="l9.64"> {</span>
<a href="#l9.65"></a><span id="l9.65">   return NS_OK;</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineat">@@ -639,48 +638,48 @@ nsresult nsMessengerUnixIntegration::Get</span>
<a href="#l9.67"></a><span id="l9.67">     }  // if we have more potential folders to enumerate</span>
<a href="#l9.68"></a><span id="l9.68">   }</span>
<a href="#l9.69"></a><span id="l9.69"> </span>
<a href="#l9.70"></a><span id="l9.70">   // If we got here, then something when pretty wrong.</span>
<a href="#l9.71"></a><span id="l9.71">   return NS_ERROR_FAILURE;</span>
<a href="#l9.72"></a><span id="l9.72"> }</span>
<a href="#l9.73"></a><span id="l9.73"> </span>
<a href="#l9.74"></a><span id="l9.74"> NS_IMETHODIMP</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-nsMessengerUnixIntegration::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+nsMessengerUnixIntegration::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, const nsACString &amp;property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l9.77"></a><span id="l9.77"> {</span>
<a href="#l9.78"></a><span id="l9.78">   return NS_OK;</span>
<a href="#l9.79"></a><span id="l9.79"> }</span>
<a href="#l9.80"></a><span id="l9.80"> </span>
<a href="#l9.81"></a><span id="l9.81"> NS_IMETHODIMP</span>
<a href="#l9.82"></a><span id="l9.82"> nsMessengerUnixIntegration::OnItemAdded(nsIMsgFolder *, nsISupports *)</span>
<a href="#l9.83"></a><span id="l9.83"> {</span>
<a href="#l9.84"></a><span id="l9.84">   return NS_OK;</span>
<a href="#l9.85"></a><span id="l9.85"> }</span>
<a href="#l9.86"></a><span id="l9.86"> </span>
<a href="#l9.87"></a><span id="l9.87"> NS_IMETHODIMP</span>
<a href="#l9.88"></a><span id="l9.88"> nsMessengerUnixIntegration::OnItemBoolPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineminus">-                                                         nsIAtom *aProperty,</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineminus">-                                                         bool aOldValue,</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineminus">-                                                         bool aNewValue)</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+                                                      const nsACString &amp;aProperty,</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+                                                      bool aOldValue,</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+                                                      bool aNewValue)</span>
<a href="#l9.95"></a><span id="l9.95"> {</span>
<a href="#l9.96"></a><span id="l9.96">   return NS_OK;</span>
<a href="#l9.97"></a><span id="l9.97"> }</span>
<a href="#l9.98"></a><span id="l9.98"> </span>
<a href="#l9.99"></a><span id="l9.99"> NS_IMETHODIMP</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineminus">-nsMessengerUnixIntegration::OnItemEvent(nsIMsgFolder *, nsIAtom *)</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineplus">+nsMessengerUnixIntegration::OnItemEvent(nsIMsgFolder *, const nsACString &amp;)</span>
<a href="#l9.102"></a><span id="l9.102"> {</span>
<a href="#l9.103"></a><span id="l9.103">   return NS_OK;</span>
<a href="#l9.104"></a><span id="l9.104"> }</span>
<a href="#l9.105"></a><span id="l9.105"> </span>
<a href="#l9.106"></a><span id="l9.106"> NS_IMETHODIMP</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineminus">-nsMessengerUnixIntegration::OnItemIntPropertyChanged(nsIMsgFolder *aItem, nsIAtom *aProperty, int64_t aOldValue, int64_t aNewValue)</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+nsMessengerUnixIntegration::OnItemIntPropertyChanged(nsIMsgFolder *aItem, const nsACString &amp;aProperty, int64_t aOldValue, int64_t aNewValue)</span>
<a href="#l9.109"></a><span id="l9.109"> {</span>
<a href="#l9.110"></a><span id="l9.110">   nsCString atomName;</span>
<a href="#l9.111"></a><span id="l9.111">   // if we got new mail show an icon in the system tray</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineminus">-  if (mBiffStateAtom == aProperty &amp;&amp; mFoldersWithNewMail)</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineplus">+  if (aProperty.Equals(kBiffState) &amp;&amp; mFoldersWithNewMail)</span>
<a href="#l9.114"></a><span id="l9.114">   {</span>
<a href="#l9.115"></a><span id="l9.115">     nsCOMPtr&lt;nsIWeakReference&gt; weakFolder = do_GetWeakReference(aItem);</span>
<a href="#l9.116"></a><span id="l9.116">     uint32_t indexInNewArray;</span>
<a href="#l9.117"></a><span id="l9.117">     nsresult rv = mFoldersWithNewMail-&gt;IndexOf(0, weakFolder, &amp;indexInNewArray);</span>
<a href="#l9.118"></a><span id="l9.118">     bool folderFound = NS_SUCCEEDED(rv);</span>
<a href="#l9.119"></a><span id="l9.119"> </span>
<a href="#l9.120"></a><span id="l9.120">     if (aNewValue == nsIMsgFolder::nsMsgBiffState_NewMail)</span>
<a href="#l9.121"></a><span id="l9.121">     {</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineat">@@ -701,17 +700,17 @@ nsMessengerUnixIntegration::OnItemIntPro</span>
<a href="#l9.123"></a><span id="l9.123">     }</span>
<a href="#l9.124"></a><span id="l9.124">     else if (aNewValue == nsIMsgFolder::nsMsgBiffState_NoMail)</span>
<a href="#l9.125"></a><span id="l9.125">     {</span>
<a href="#l9.126"></a><span id="l9.126">       if (folderFound) {</span>
<a href="#l9.127"></a><span id="l9.127">         mFoldersWithNewMail-&gt;RemoveElementAt(indexInNewArray);</span>
<a href="#l9.128"></a><span id="l9.128">       }</span>
<a href="#l9.129"></a><span id="l9.129">     }</span>
<a href="#l9.130"></a><span id="l9.130">   } // if the biff property changed</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">-  else if (mNewMailReceivedAtom == aProperty)</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+  else if (aProperty.Equals(kNewMailReceived))</span>
<a href="#l9.133"></a><span id="l9.133">   {</span>
<a href="#l9.134"></a><span id="l9.134">     FillToolTipInfo();</span>
<a href="#l9.135"></a><span id="l9.135">   }</span>
<a href="#l9.136"></a><span id="l9.136"> </span>
<a href="#l9.137"></a><span id="l9.137">   return NS_OK;</span>
<a href="#l9.138"></a><span id="l9.138"> }</span>
<a href="#l9.139"></a><span id="l9.139"> </span>
<a href="#l9.140"></a><span id="l9.140"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -7,17 +7,16 @@</span>
<a href="#l10.4"></a><span id="l10.4"> #define __nsMessengerUnixIntegration_h</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> #include &quot;nsIMessengerOSIntegration.h&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsIUrlListener.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-#include &quot;nsIAtom.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> #include &quot;nsDataHashtable.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsTArray.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> #define NS_MESSENGERUNIXINTEGRATION_CID \</span>
<a href="#l10.17"></a><span id="l10.17">   {0xf62f3d3a, 0x1dd1, 0x11b2, \</span>
<a href="#l10.18"></a><span id="l10.18">     {0xa5, 0x16, 0xef, 0xad, 0xb1, 0x31, 0x61, 0x5c}}</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> class nsIStringBundle;</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -48,16 +47,14 @@ private:</span>
<a href="#l10.22"></a><span id="l10.22">   nsresult GetMRUTimestampForFolder(nsIMsgFolder *aFolder, uint32_t *aLastMRUTime);</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24">   bool BuildNotificationBody(nsIMsgDBHdr *aHdr, nsIStringBundle *Bundle, nsString &amp;aBody);</span>
<a href="#l10.25"></a><span id="l10.25">   bool BuildNotificationTitle(nsIMsgFolder *aFolder, nsIStringBundle *aBundle, nsString &amp;aTitle);</span>
<a href="#l10.26"></a><span id="l10.26">   nsresult ShowNewAlertNotification(bool aUserInitiated);</span>
<a href="#l10.27"></a><span id="l10.27">   nsresult PutMRUTimestampForFolder(nsIMsgFolder *aFolder, uint32_t aLastMRUTime);</span>
<a href="#l10.28"></a><span id="l10.28"> </span>
<a href="#l10.29"></a><span id="l10.29">   nsCOMPtr&lt;nsIMutableArray&gt; mFoldersWithNewMail;  // keep track of all the root folders with pending new mail</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-  nsCOMPtr&lt;nsIAtom&gt; mBiffStateAtom;</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  nsCOMPtr&lt;nsIAtom&gt; mNewMailReceivedAtom;</span>
<a href="#l10.32"></a><span id="l10.32">   bool mAlertInProgress;</span>
<a href="#l10.33"></a><span id="l10.33">   nsDataHashtable&lt;nsCStringHashKey, uint32_t&gt; mLastMRUTimes; // We keep track of the last time we did a new mail notification for each account</span>
<a href="#l10.34"></a><span id="l10.34">   nsTArray&lt;nsCString&gt; mFetchingURIs;</span>
<a href="#l10.35"></a><span id="l10.35"> };</span>
<a href="#l10.36"></a><span id="l10.36"> </span>
<a href="#l10.37"></a><span id="l10.37"> #endif // __nsMessengerUnixIntegration_h</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -8,16 +8,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> #include &quot;nsMessengerWinIntegration.h&quot;</span>
<a href="#l11.6"></a><span id="l11.6"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l11.7"></a><span id="l11.7"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nsIMsgIdentity.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l11.16"></a><span id="l11.16"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l11.17"></a><span id="l11.17"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l11.18"></a><span id="l11.18"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l11.19"></a><span id="l11.19"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l11.20"></a><span id="l11.20"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -234,22 +235,18 @@ static nsresult Create()</span>
<a href="#l11.22"></a><span id="l11.22">                                               0 ),        // create struct</span>
<a href="#l11.23"></a><span id="l11.23">                   NS_ERROR_FAILURE );</span>
<a href="#l11.24"></a><span id="l11.24">   return NS_OK;</span>
<a href="#l11.25"></a><span id="l11.25"> }</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28"> nsMessengerWinIntegration::nsMessengerWinIntegration()</span>
<a href="#l11.29"></a><span id="l11.29"> {</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-  mDefaultServerAtom = MsgGetAtom(&quot;DefaultServer&quot;);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  mTotalUnreadMessagesAtom = MsgGetAtom(&quot;TotalUnreadMessages&quot;);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-</span>
<a href="#l11.33"></a><span id="l11.33">   mUnreadTimerActive = false;</span>
<a href="#l11.34"></a><span id="l11.34"> </span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-  mBiffStateAtom = MsgGetAtom(&quot;BiffState&quot;);</span>
<a href="#l11.36"></a><span id="l11.36">   mBiffIconVisible = false;</span>
<a href="#l11.37"></a><span id="l11.37">   mSuppressBiffIcon = false;</span>
<a href="#l11.38"></a><span id="l11.38">   mAlertInProgress = false;</span>
<a href="#l11.39"></a><span id="l11.39">   mBiffIconInitialized = false;</span>
<a href="#l11.40"></a><span id="l11.40">   mFoldersWithNewMail = do_CreateInstance(NS_ARRAY_CONTRACTID);</span>
<a href="#l11.41"></a><span id="l11.41"> }</span>
<a href="#l11.42"></a><span id="l11.42"> </span>
<a href="#l11.43"></a><span id="l11.43"> nsMessengerWinIntegration::~nsMessengerWinIntegration()</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineat">@@ -362,23 +359,23 @@ nsMessengerWinIntegration::Init()</span>
<a href="#l11.45"></a><span id="l11.45"> </span>
<a href="#l11.46"></a><span id="l11.46">   rv = ResetCurrent();</span>
<a href="#l11.47"></a><span id="l11.47">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l11.48"></a><span id="l11.48"> </span>
<a href="#l11.49"></a><span id="l11.49">   return NS_OK;</span>
<a href="#l11.50"></a><span id="l11.50"> }</span>
<a href="#l11.51"></a><span id="l11.51"> </span>
<a href="#l11.52"></a><span id="l11.52"> NS_IMETHODIMP</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-nsMessengerWinIntegration::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+nsMessengerWinIntegration::OnItemPropertyChanged(nsIMsgFolder *, const nsACString &amp;, char const *, char const *)</span>
<a href="#l11.55"></a><span id="l11.55"> {</span>
<a href="#l11.56"></a><span id="l11.56">   return NS_OK;</span>
<a href="#l11.57"></a><span id="l11.57"> }</span>
<a href="#l11.58"></a><span id="l11.58"> </span>
<a href="#l11.59"></a><span id="l11.59"> NS_IMETHODIMP</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-nsMessengerWinIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const char16_t *, const char16_t *)</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+nsMessengerWinIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, const nsACString &amp;, const char16_t *, const char16_t *)</span>
<a href="#l11.62"></a><span id="l11.62"> {</span>
<a href="#l11.63"></a><span id="l11.63">   return NS_OK;</span>
<a href="#l11.64"></a><span id="l11.64"> }</span>
<a href="#l11.65"></a><span id="l11.65"> </span>
<a href="#l11.66"></a><span id="l11.66"> NS_IMETHODIMP</span>
<a href="#l11.67"></a><span id="l11.67"> nsMessengerWinIntegration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l11.68"></a><span id="l11.68"> {</span>
<a href="#l11.69"></a><span id="l11.69">   return NS_OK;</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineat">@@ -790,34 +787,34 @@ void nsMessengerWinIntegration::DestroyB</span>
<a href="#l11.71"></a><span id="l11.71"> }</span>
<a href="#l11.72"></a><span id="l11.72"> </span>
<a href="#l11.73"></a><span id="l11.73"> void nsMessengerWinIntegration::GenericShellNotify(DWORD aMessage)</span>
<a href="#l11.74"></a><span id="l11.74"> {</span>
<a href="#l11.75"></a><span id="l11.75">   ::Shell_NotifyIconW( aMessage, &amp;sBiffIconData );</span>
<a href="#l11.76"></a><span id="l11.76"> }</span>
<a href="#l11.77"></a><span id="l11.77"> </span>
<a href="#l11.78"></a><span id="l11.78"> NS_IMETHODIMP</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineminus">-nsMessengerWinIntegration::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineplus">+nsMessengerWinIntegration::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, const nsACString &amp;property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l11.81"></a><span id="l11.81"> {</span>
<a href="#l11.82"></a><span id="l11.82">   return NS_OK;</span>
<a href="#l11.83"></a><span id="l11.83"> }</span>
<a href="#l11.84"></a><span id="l11.84"> </span>
<a href="#l11.85"></a><span id="l11.85"> NS_IMETHODIMP</span>
<a href="#l11.86"></a><span id="l11.86"> nsMessengerWinIntegration::OnItemAdded(nsIMsgFolder *, nsISupports *)</span>
<a href="#l11.87"></a><span id="l11.87"> {</span>
<a href="#l11.88"></a><span id="l11.88">   return NS_OK;</span>
<a href="#l11.89"></a><span id="l11.89"> }</span>
<a href="#l11.90"></a><span id="l11.90"> </span>
<a href="#l11.91"></a><span id="l11.91"> NS_IMETHODIMP</span>
<a href="#l11.92"></a><span id="l11.92"> nsMessengerWinIntegration::OnItemBoolPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineminus">-                                                         nsIAtom *aProperty,</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+                                                         const nsACString &amp;aProperty,</span>
<a href="#l11.95"></a><span id="l11.95">                                                          bool aOldValue,</span>
<a href="#l11.96"></a><span id="l11.96">                                                          bool aNewValue)</span>
<a href="#l11.97"></a><span id="l11.97"> {</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineminus">-  if (aProperty == mDefaultServerAtom) {</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+  if (aProperty.Equals(kDefaultServer)) {</span>
<a href="#l11.100"></a><span id="l11.100">     nsresult rv;</span>
<a href="#l11.101"></a><span id="l11.101"> </span>
<a href="#l11.102"></a><span id="l11.102">     // this property changes multiple times</span>
<a href="#l11.103"></a><span id="l11.103">     // on account deletion or when the user changes their</span>
<a href="#l11.104"></a><span id="l11.104">     // default account.  ResetCurrent() will set</span>
<a href="#l11.105"></a><span id="l11.105">     // mInboxURI to null, so we use that</span>
<a href="#l11.106"></a><span id="l11.106">     // to prevent us from attempting to remove</span>
<a href="#l11.107"></a><span id="l11.107">     // something from the registry that has already been removed</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineat">@@ -832,26 +829,26 @@ nsMessengerWinIntegration::OnItemBoolPro</span>
<a href="#l11.109"></a><span id="l11.109"> </span>
<a href="#l11.110"></a><span id="l11.110">     rv = UpdateUnreadCount();</span>
<a href="#l11.111"></a><span id="l11.111">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l11.112"></a><span id="l11.112">   }</span>
<a href="#l11.113"></a><span id="l11.113">   return NS_OK;</span>
<a href="#l11.114"></a><span id="l11.114"> }</span>
<a href="#l11.115"></a><span id="l11.115"> </span>
<a href="#l11.116"></a><span id="l11.116"> NS_IMETHODIMP</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineminus">-nsMessengerWinIntegration::OnItemEvent(nsIMsgFolder *, nsIAtom *)</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+nsMessengerWinIntegration::OnItemEvent(nsIMsgFolder *, const nsACString &amp;)</span>
<a href="#l11.119"></a><span id="l11.119"> {</span>
<a href="#l11.120"></a><span id="l11.120">   return NS_OK;</span>
<a href="#l11.121"></a><span id="l11.121"> }</span>
<a href="#l11.122"></a><span id="l11.122"> </span>
<a href="#l11.123"></a><span id="l11.123"> NS_IMETHODIMP</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineminus">-nsMessengerWinIntegration::OnItemIntPropertyChanged(nsIMsgFolder *aItem, nsIAtom *aProperty, int64_t aOldValue, int64_t aNewValue)</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineplus">+nsMessengerWinIntegration::OnItemIntPropertyChanged(nsIMsgFolder *aItem, const nsACString &amp;aProperty, int64_t aOldValue, int64_t aNewValue)</span>
<a href="#l11.126"></a><span id="l11.126"> {</span>
<a href="#l11.127"></a><span id="l11.127">   // if we got new mail show a icon in the system tray</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineminus">-  if (mBiffStateAtom == aProperty &amp;&amp; mFoldersWithNewMail)</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineplus">+  if (aProperty.Equals(kBiffState) &amp;&amp; mFoldersWithNewMail)</span>
<a href="#l11.130"></a><span id="l11.130">   {</span>
<a href="#l11.131"></a><span id="l11.131">     nsCOMPtr&lt;nsIWeakReference&gt; weakFolder = do_GetWeakReference(aItem);</span>
<a href="#l11.132"></a><span id="l11.132">     uint32_t indexInNewArray;</span>
<a href="#l11.133"></a><span id="l11.133">     nsresult rv = mFoldersWithNewMail-&gt;IndexOf(0, weakFolder, &amp;indexInNewArray);</span>
<a href="#l11.134"></a><span id="l11.134">     bool folderFound = NS_SUCCEEDED(rv);</span>
<a href="#l11.135"></a><span id="l11.135"> </span>
<a href="#l11.136"></a><span id="l11.136">     if (!mBiffIconInitialized)</span>
<a href="#l11.137"></a><span id="l11.137">       InitializeBiffStatusIcon();</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineat">@@ -891,17 +888,17 @@ nsMessengerWinIntegration::OnItemIntProp</span>
<a href="#l11.139"></a><span id="l11.139">       if (mBiffIconVisible)</span>
<a href="#l11.140"></a><span id="l11.140">       {</span>
<a href="#l11.141"></a><span id="l11.141">         mBiffIconVisible = false;</span>
<a href="#l11.142"></a><span id="l11.142">         GenericShellNotify(NIM_DELETE);</span>
<a href="#l11.143"></a><span id="l11.143">       }</span>
<a href="#l11.144"></a><span id="l11.144">     }</span>
<a href="#l11.145"></a><span id="l11.145">   } // if the biff property changed</span>
<a href="#l11.146"></a><span id="l11.146"> </span>
<a href="#l11.147"></a><span id="l11.147" class="difflineminus">-  if (aProperty == mTotalUnreadMessagesAtom) {</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineplus">+  if (aProperty.Equals(kTotalUnreadMessages)) {</span>
<a href="#l11.149"></a><span id="l11.149">     nsCString itemURI;</span>
<a href="#l11.150"></a><span id="l11.150">     nsresult rv;</span>
<a href="#l11.151"></a><span id="l11.151">     rv = aItem-&gt;GetURI(itemURI);</span>
<a href="#l11.152"></a><span id="l11.152">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l11.153"></a><span id="l11.153"> </span>
<a href="#l11.154"></a><span id="l11.154">     if (mInboxURI.Equals(itemURI))</span>
<a href="#l11.155"></a><span id="l11.155">       mCurrentUnreadCount = aNewValue;</span>
<a href="#l11.156"></a><span id="l11.156"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -8,17 +8,16 @@</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> #include &lt;windows.h&gt;</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> // shellapi.h is needed to build with WIN32_LEAN_AND_MEAN</span>
<a href="#l12.8"></a><span id="l12.8"> #include &lt;shellapi.h&gt;</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10"> #include &quot;nsIMessengerOSIntegration.h&quot;</span>
<a href="#l12.11"></a><span id="l12.11"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-#include &quot;nsIAtom.h&quot;</span>
<a href="#l12.13"></a><span id="l12.13"> #include &quot;nsITimer.h&quot;</span>
<a href="#l12.14"></a><span id="l12.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l12.15"></a><span id="l12.15"> #include &quot;nsString.h&quot;</span>
<a href="#l12.16"></a><span id="l12.16"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l12.17"></a><span id="l12.17"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19"> #define NS_MESSENGERWININTEGRATION_CID \</span>
<a href="#l12.20"></a><span id="l12.20">   {0xf62f3d3a, 0x1dd1, 0x11b2, \</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -56,17 +55,16 @@ private:</span>
<a href="#l12.22"></a><span id="l12.22">   void FillToolTipInfo();</span>
<a href="#l12.23"></a><span id="l12.23">   void GenericShellNotify(DWORD aMessage);</span>
<a href="#l12.24"></a><span id="l12.24">   void DestroyBiffIcon();</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26">   nsresult GetFirstFolderWithNewMail(nsACString&amp; aFolderURI);</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">   nsresult GetStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l12.29"></a><span id="l12.29">   nsCOMPtr&lt;nsIMutableArray&gt; mFoldersWithNewMail;  // keep track of all the root folders with pending new mail</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-  nsCOMPtr&lt;nsIAtom&gt; mBiffStateAtom;</span>
<a href="#l12.31"></a><span id="l12.31">   uint32_t mCurrentBiffState;</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33">   bool mBiffIconVisible;</span>
<a href="#l12.34"></a><span id="l12.34">   bool mBiffIconInitialized;</span>
<a href="#l12.35"></a><span id="l12.35">   bool mSuppressBiffIcon;</span>
<a href="#l12.36"></a><span id="l12.36">   bool mAlertInProgress;</span>
<a href="#l12.37"></a><span id="l12.37">   </span>
<a href="#l12.38"></a><span id="l12.38">   // &quot;might&quot; because we don't know until we check </span>
<a href="#l12.39"></a><span id="l12.39" class="difflineat">@@ -80,18 +78,16 @@ private:</span>
<a href="#l12.40"></a><span id="l12.40">   nsresult RemoveCurrentFromRegistry();</span>
<a href="#l12.41"></a><span id="l12.41">   nsresult UpdateRegistryWithCurrent();</span>
<a href="#l12.42"></a><span id="l12.42">   nsresult SetupInbox();</span>
<a href="#l12.43"></a><span id="l12.43"> </span>
<a href="#l12.44"></a><span id="l12.44">   nsresult SetupUnreadCountUpdateTimer();</span>
<a href="#l12.45"></a><span id="l12.45">   static void OnUnreadCountUpdateTimer(nsITimer *timer, void *osIntegration);</span>
<a href="#l12.46"></a><span id="l12.46">   nsresult UpdateUnreadCount();</span>
<a href="#l12.47"></a><span id="l12.47"> </span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-  nsCOMPtr &lt;nsIAtom&gt; mDefaultServerAtom;</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-  nsCOMPtr &lt;nsIAtom&gt; mTotalUnreadMessagesAtom;</span>
<a href="#l12.50"></a><span id="l12.50">   nsCOMPtr &lt;nsITimer&gt; mUnreadCountUpdateTimer;</span>
<a href="#l12.51"></a><span id="l12.51"> </span>
<a href="#l12.52"></a><span id="l12.52">   nsCString mInboxURI;</span>
<a href="#l12.53"></a><span id="l12.53">   nsCString mEmail;</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55">   nsString  mAppName;</span>
<a href="#l12.56"></a><span id="l12.56">   nsString  mEmailPrefix;</span>
<a href="#l12.57"></a><span id="l12.57"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -21,16 +21,17 @@</span>
<a href="#l13.4"></a><span id="l13.4"> #include &quot;prthread.h&quot;</span>
<a href="#l13.5"></a><span id="l13.5"> #include &quot;plstr.h&quot;</span>
<a href="#l13.6"></a><span id="l13.6"> #include &quot;nsString.h&quot;</span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> #include &quot;nscore.h&quot;</span>
<a href="#l13.9"></a><span id="l13.9"> #include &quot;prprf.h&quot;</span>
<a href="#l13.10"></a><span id="l13.10"> #include &quot;nsIMsgFolderCache.h&quot;</span>
<a href="#l13.11"></a><span id="l13.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13"> #include &quot;nsIFile.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14"> #include &quot;nsIURL.h&quot;</span>
<a href="#l13.15"></a><span id="l13.15"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l13.17"></a><span id="l13.17"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l13.18"></a><span id="l13.18"> #include &quot;nsISmtpService.h&quot;</span>
<a href="#l13.19"></a><span id="l13.19"> #include &quot;nsIMsgBiffManager.h&quot;</span>
<a href="#l13.20"></a><span id="l13.20"> #include &quot;nsIMsgPurgeService.h&quot;</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineat">@@ -818,28 +819,28 @@ nsMsgAccountManager::notifyDefaultServer</span>
<a href="#l13.22"></a><span id="l13.22">   nsCOMPtr&lt;nsIMsgFolder&gt; rootFolder;</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24">   // first tell old server it's no longer the default</span>
<a href="#l13.25"></a><span id="l13.25">   if (aOldAccount) {</span>
<a href="#l13.26"></a><span id="l13.26">     rv = aOldAccount-&gt;GetIncomingServer(getter_AddRefs(server));</span>
<a href="#l13.27"></a><span id="l13.27">     if (NS_SUCCEEDED(rv) &amp;&amp; server) {</span>
<a href="#l13.28"></a><span id="l13.28">       rv = server-&gt;GetRootFolder(getter_AddRefs(rootFolder));</span>
<a href="#l13.29"></a><span id="l13.29">       if (NS_SUCCEEDED(rv) &amp;&amp; rootFolder)</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-        rootFolder-&gt;NotifyBoolPropertyChanged(kDefaultServerAtom,</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+        rootFolder-&gt;NotifyBoolPropertyChanged(kDefaultServer,</span>
<a href="#l13.32"></a><span id="l13.32">                                               true, false);</span>
<a href="#l13.33"></a><span id="l13.33">     }</span>
<a href="#l13.34"></a><span id="l13.34">   }</span>
<a href="#l13.35"></a><span id="l13.35"> </span>
<a href="#l13.36"></a><span id="l13.36">     // now tell new server it is.</span>
<a href="#l13.37"></a><span id="l13.37">   if (aNewAccount) {</span>
<a href="#l13.38"></a><span id="l13.38">     rv = aNewAccount-&gt;GetIncomingServer(getter_AddRefs(server));</span>
<a href="#l13.39"></a><span id="l13.39">     if (NS_SUCCEEDED(rv) &amp;&amp; server) {</span>
<a href="#l13.40"></a><span id="l13.40">       rv = server-&gt;GetRootFolder(getter_AddRefs(rootFolder));</span>
<a href="#l13.41"></a><span id="l13.41">       if (NS_SUCCEEDED(rv) &amp;&amp; rootFolder)</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-        rootFolder-&gt;NotifyBoolPropertyChanged(kDefaultServerAtom,</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+        rootFolder-&gt;NotifyBoolPropertyChanged(kDefaultServer,</span>
<a href="#l13.44"></a><span id="l13.44">                                               false, true);</span>
<a href="#l13.45"></a><span id="l13.45">     }</span>
<a href="#l13.46"></a><span id="l13.46">   }</span>
<a href="#l13.47"></a><span id="l13.47"> </span>
<a href="#l13.48"></a><span id="l13.48">   if (aOldAccount &amp;&amp; aNewAccount)  //only notify if the user goes and changes default account</span>
<a href="#l13.49"></a><span id="l13.49">   {</span>
<a href="#l13.50"></a><span id="l13.50">     nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l13.51"></a><span id="l13.51">       mozilla::services::GetObserverService();</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineat">@@ -1038,19 +1039,16 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l13.53"></a><span id="l13.53">     mailSession-&gt;AddFolderListener(this, nsIFolderListener::added |</span>
<a href="#l13.54"></a><span id="l13.54">                                          nsIFolderListener::removed |</span>
<a href="#l13.55"></a><span id="l13.55">                                          nsIFolderListener::intPropertyChanged);</span>
<a href="#l13.56"></a><span id="l13.56">   // If we have code trying to do things after we've unloaded accounts,</span>
<a href="#l13.57"></a><span id="l13.57">   // ignore it.</span>
<a href="#l13.58"></a><span id="l13.58">   if (m_shutdownInProgress || m_haveShutdown)</span>
<a href="#l13.59"></a><span id="l13.59">     return NS_ERROR_FAILURE;</span>
<a href="#l13.60"></a><span id="l13.60"> </span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-  kDefaultServerAtom = MsgGetAtom(&quot;DefaultServer&quot;);</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-  mFolderFlagAtom = MsgGetAtom(&quot;FolderFlag&quot;);</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-</span>
<a href="#l13.64"></a><span id="l13.64">   //Ensure biff service has started</span>
<a href="#l13.65"></a><span id="l13.65">   nsCOMPtr&lt;nsIMsgBiffManager&gt; biffService =</span>
<a href="#l13.66"></a><span id="l13.66">            do_GetService(NS_MSGBIFFMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l13.67"></a><span id="l13.67"> </span>
<a href="#l13.68"></a><span id="l13.68">   if (NS_SUCCEEDED(rv))</span>
<a href="#l13.69"></a><span id="l13.69">     biffService-&gt;Init();</span>
<a href="#l13.70"></a><span id="l13.70"> </span>
<a href="#l13.71"></a><span id="l13.71">   //Ensure purge service has started</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineat">@@ -1502,19 +1500,16 @@ nsMsgAccountManager::SetSpecialFolders()</span>
<a href="#l13.73"></a><span id="l13.73">   // set the JUNK folder flag on the spam folders, right?</span>
<a href="#l13.74"></a><span id="l13.74">   return NS_OK;</span>
<a href="#l13.75"></a><span id="l13.75"> }</span>
<a href="#l13.76"></a><span id="l13.76"> </span>
<a href="#l13.77"></a><span id="l13.77"> NS_IMETHODIMP</span>
<a href="#l13.78"></a><span id="l13.78"> nsMsgAccountManager::UnloadAccounts()</span>
<a href="#l13.79"></a><span id="l13.79"> {</span>
<a href="#l13.80"></a><span id="l13.80">   // release the default account</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-  kDefaultServerAtom = nullptr;</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-  mFolderFlagAtom = nullptr;</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineminus">-</span>
<a href="#l13.84"></a><span id="l13.84">   m_defaultAccount=nullptr;</span>
<a href="#l13.85"></a><span id="l13.85">   for (auto iter = m_incomingServers.Iter(); !iter.Done(); iter.Next()) {</span>
<a href="#l13.86"></a><span id="l13.86">     nsCOMPtr&lt;nsIMsgIncomingServer&gt;&amp; server = iter.Data();</span>
<a href="#l13.87"></a><span id="l13.87">     if (!server)</span>
<a href="#l13.88"></a><span id="l13.88">       continue;</span>
<a href="#l13.89"></a><span id="l13.89">     nsresult rv;</span>
<a href="#l13.90"></a><span id="l13.90">     NotifyServerUnloaded(server);</span>
<a href="#l13.91"></a><span id="l13.91"> </span>
<a href="#l13.92"></a><span id="l13.92" class="difflineat">@@ -3483,28 +3478,28 @@ NS_IMETHODIMP nsMsgAccountManager::OnIte</span>
<a href="#l13.93"></a><span id="l13.93">         }</span>
<a href="#l13.94"></a><span id="l13.94">       }</span>
<a href="#l13.95"></a><span id="l13.95">     }</span>
<a href="#l13.96"></a><span id="l13.96">   }</span>
<a href="#l13.97"></a><span id="l13.97"> </span>
<a href="#l13.98"></a><span id="l13.98">   return rv;</span>
<a href="#l13.99"></a><span id="l13.99"> }</span>
<a href="#l13.100"></a><span id="l13.100"> </span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-NS_IMETHODIMP nsMsgAccountManager::OnItemPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char *oldValue, const char *newValue)</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+NS_IMETHODIMP nsMsgAccountManager::OnItemPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char *oldValue, const char *newValue)</span>
<a href="#l13.103"></a><span id="l13.103"> {</span>
<a href="#l13.104"></a><span id="l13.104">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.105"></a><span id="l13.105"> }</span>
<a href="#l13.106"></a><span id="l13.106"> </span>
<a href="#l13.107"></a><span id="l13.107"> NS_IMETHODIMP</span>
<a href="#l13.108"></a><span id="l13.108"> nsMsgAccountManager::OnItemIntPropertyChanged(nsIMsgFolder *aFolder,</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-                                              nsIAtom *aProperty,</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+                                              const nsACString &amp;aProperty,</span>
<a href="#l13.111"></a><span id="l13.111">                                               int64_t oldValue,</span>
<a href="#l13.112"></a><span id="l13.112">                                               int64_t newValue)</span>
<a href="#l13.113"></a><span id="l13.113"> {</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-  if (aProperty == mFolderFlagAtom)</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+  if (aProperty.Equals(kFolderFlag))</span>
<a href="#l13.116"></a><span id="l13.116">   {</span>
<a href="#l13.117"></a><span id="l13.117">     uint32_t smartFlagsChanged = (oldValue ^ newValue) &amp;</span>
<a href="#l13.118"></a><span id="l13.118">       (nsMsgFolderFlags::SpecialUse &amp; ~nsMsgFolderFlags::Queue);</span>
<a href="#l13.119"></a><span id="l13.119">     if (smartFlagsChanged)</span>
<a href="#l13.120"></a><span id="l13.120">     {</span>
<a href="#l13.121"></a><span id="l13.121">       if (smartFlagsChanged &amp; newValue)</span>
<a href="#l13.122"></a><span id="l13.122">       {</span>
<a href="#l13.123"></a><span id="l13.123">         // if the smart folder flag was set, calling OnItemAdded will</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineat">@@ -3588,33 +3583,33 @@ nsMsgAccountManager::RemoveFolderFromSma</span>
<a href="#l13.125"></a><span id="l13.125">           dbFolderInfo-&gt;SetCharProperty(kSearchFolderUriProp, searchURI);</span>
<a href="#l13.126"></a><span id="l13.126">         }</span>
<a href="#l13.127"></a><span id="l13.127">       }</span>
<a href="#l13.128"></a><span id="l13.128">     }</span>
<a href="#l13.129"></a><span id="l13.129">   }</span>
<a href="#l13.130"></a><span id="l13.130">   return NS_OK;</span>
<a href="#l13.131"></a><span id="l13.131"> }</span>
<a href="#l13.132"></a><span id="l13.132"> </span>
<a href="#l13.133"></a><span id="l13.133" class="difflineminus">-NS_IMETHODIMP nsMsgAccountManager::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineplus">+NS_IMETHODIMP nsMsgAccountManager::OnItemBoolPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, bool oldValue, bool newValue)</span>
<a href="#l13.135"></a><span id="l13.135"> {</span>
<a href="#l13.136"></a><span id="l13.136">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.137"></a><span id="l13.137"> }</span>
<a href="#l13.138"></a><span id="l13.138"> </span>
<a href="#l13.139"></a><span id="l13.139" class="difflineminus">-NS_IMETHODIMP nsMsgAccountManager::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineplus">+NS_IMETHODIMP nsMsgAccountManager::OnItemUnicharPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l13.141"></a><span id="l13.141"> {</span>
<a href="#l13.142"></a><span id="l13.142">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.143"></a><span id="l13.143"> }</span>
<a href="#l13.144"></a><span id="l13.144"> </span>
<a href="#l13.145"></a><span id="l13.145"> </span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-NS_IMETHODIMP nsMsgAccountManager::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+NS_IMETHODIMP nsMsgAccountManager::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, const nsACString &amp;property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l13.148"></a><span id="l13.148"> {</span>
<a href="#l13.149"></a><span id="l13.149">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.150"></a><span id="l13.150"> }</span>
<a href="#l13.151"></a><span id="l13.151"> </span>
<a href="#l13.152"></a><span id="l13.152" class="difflineminus">-NS_IMETHODIMP nsMsgAccountManager::OnItemEvent(nsIMsgFolder *aFolder, nsIAtom *aEvent)</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineplus">+NS_IMETHODIMP nsMsgAccountManager::OnItemEvent(nsIMsgFolder *aFolder, const nsACString &amp;aEvent)</span>
<a href="#l13.154"></a><span id="l13.154"> {</span>
<a href="#l13.155"></a><span id="l13.155">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.156"></a><span id="l13.156"> }</span>
<a href="#l13.157"></a><span id="l13.157"> </span>
<a href="#l13.158"></a><span id="l13.158"> NS_IMETHODIMP</span>
<a href="#l13.159"></a><span id="l13.159"> nsMsgAccountManager::FolderUriForPath(nsIFile *aLocalPath,</span>
<a href="#l13.160"></a><span id="l13.160">                                                nsACString &amp;aMailboxUri)</span>
<a href="#l13.161"></a><span id="l13.161"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -85,18 +85,16 @@ public:</span>
<a href="#l14.4"></a><span id="l14.4">   nsresult Shutdown();</span>
<a href="#l14.5"></a><span id="l14.5">   void LogoutOfServer(nsIMsgIncomingServer *aServer);</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> private:</span>
<a href="#l14.8"></a><span id="l14.8">   virtual ~nsMsgAccountManager();</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">   bool m_accountsLoaded;</span>
<a href="#l14.11"></a><span id="l14.11">   nsCOMPtr &lt;nsIMsgFolderCache&gt; m_msgFolderCache;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  nsCOMPtr&lt;nsIAtom&gt; kDefaultServerAtom;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-  nsCOMPtr&lt;nsIAtom&gt; mFolderFlagAtom;</span>
<a href="#l14.14"></a><span id="l14.14">   nsTArray&lt;nsCOMPtr&lt;nsIMsgAccount&gt; &gt; m_accounts;</span>
<a href="#l14.15"></a><span id="l14.15">   nsInterfaceHashtable&lt;nsCStringHashKey, nsIMsgIdentity&gt; m_identities;</span>
<a href="#l14.16"></a><span id="l14.16">   nsInterfaceHashtable&lt;nsCStringHashKey, nsIMsgIncomingServer&gt; m_incomingServers;</span>
<a href="#l14.17"></a><span id="l14.17">   nsCOMPtr&lt;nsIMsgAccount&gt; m_defaultAccount;</span>
<a href="#l14.18"></a><span id="l14.18">   nsCOMArray&lt;nsIIncomingServerListener&gt; m_incomingServerListeners;</span>
<a href="#l14.19"></a><span id="l14.19">   nsTObserverArray&lt;RefPtr&lt;VirtualFolderChangeListener&gt; &gt; m_virtualFolderListeners;</span>
<a href="#l14.20"></a><span id="l14.20">   nsCOMPtr&lt;nsIMsgFolder&gt; m_folderDoingEmptyTrash;</span>
<a href="#l14.21"></a><span id="l14.21">   nsCOMPtr&lt;nsIMsgFolder&gt; m_folderDoingCleanupInbox;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -10,16 +10,17 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsMsgAccountManagerDS.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;rdf.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;nsIRDFDataSource.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l15.14"></a><span id="l15.14"> </span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineat">@@ -78,18 +79,16 @@ nsIRDFResource* nsMsgAccountManagerDataS</span>
<a href="#l15.22"></a><span id="l15.22"> nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleDiskSpace=nullptr;</span>
<a href="#l15.23"></a><span id="l15.23"> nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleAddressing=nullptr;</span>
<a href="#l15.24"></a><span id="l15.24"> nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleSMTP=nullptr;</span>
<a href="#l15.25"></a><span id="l15.25"> nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleJunk=nullptr;</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27"> // common literals</span>
<a href="#l15.28"></a><span id="l15.28"> nsIRDFLiteral* nsMsgAccountManagerDataSource::kTrueLiteral = nullptr;</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-nsIAtom* nsMsgAccountManagerDataSource::kDefaultServerAtom = nullptr;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-</span>
<a href="#l15.32"></a><span id="l15.32"> nsrefcnt nsMsgAccountManagerDataSource::gAccountManagerResourceRefCnt = 0;</span>
<a href="#l15.33"></a><span id="l15.33"> </span>
<a href="#l15.34"></a><span id="l15.34"> // shared arc lists</span>
<a href="#l15.35"></a><span id="l15.35"> nsCOMPtr&lt;nsIMutableArray&gt; nsMsgAccountManagerDataSource::mAccountArcsOut;</span>
<a href="#l15.36"></a><span id="l15.36"> nsCOMPtr&lt;nsIMutableArray&gt; nsMsgAccountManagerDataSource::mAccountRootArcsOut;</span>
<a href="#l15.37"></a><span id="l15.37"> </span>
<a href="#l15.38"></a><span id="l15.38"> </span>
<a href="#l15.39"></a><span id="l15.39"> // RDF to match</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineat">@@ -155,18 +154,16 @@ nsMsgAccountManagerDataSource::nsMsgAcco</span>
<a href="#l15.41"></a><span id="l15.41">                                  &amp;kNC_AccountRoot);</span>
<a href="#l15.42"></a><span id="l15.42"> </span>
<a href="#l15.43"></a><span id="l15.43">     getRDFService()-&gt;GetLiteral(u&quot;true&quot;,</span>
<a href="#l15.44"></a><span id="l15.44">                                 &amp;kTrueLiteral);</span>
<a href="#l15.45"></a><span id="l15.45"> </span>
<a href="#l15.46"></a><span id="l15.46">     // eventually these need to exist in some kind of array</span>
<a href="#l15.47"></a><span id="l15.47">     // that's easily extensible</span>
<a href="#l15.48"></a><span id="l15.48">     getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SETTINGS), &amp;kNC_Settings);</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-    kDefaultServerAtom = MsgNewAtom(&quot;DefaultServer&quot;).take();</span>
<a href="#l15.51"></a><span id="l15.51">   }</span>
<a href="#l15.52"></a><span id="l15.52"> }</span>
<a href="#l15.53"></a><span id="l15.53"> </span>
<a href="#l15.54"></a><span id="l15.54"> nsMsgAccountManagerDataSource::~nsMsgAccountManagerDataSource()</span>
<a href="#l15.55"></a><span id="l15.55"> {</span>
<a href="#l15.56"></a><span id="l15.56">   nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager);</span>
<a href="#l15.57"></a><span id="l15.57">   if (am)</span>
<a href="#l15.58"></a><span id="l15.58">     am-&gt;RemoveIncomingServerListener(this);</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineat">@@ -198,18 +195,16 @@ nsMsgAccountManagerDataSource::~nsMsgAcc</span>
<a href="#l15.60"></a><span id="l15.60">     NS_IF_RELEASE(kTrueLiteral);</span>
<a href="#l15.61"></a><span id="l15.61"> </span>
<a href="#l15.62"></a><span id="l15.62">     NS_IF_RELEASE(kNC_AccountRoot);</span>
<a href="#l15.63"></a><span id="l15.63"> </span>
<a href="#l15.64"></a><span id="l15.64">     // eventually these need to exist in some kind of array</span>
<a href="#l15.65"></a><span id="l15.65">     // that's easily extensible</span>
<a href="#l15.66"></a><span id="l15.66">     NS_IF_RELEASE(kNC_Settings);</span>
<a href="#l15.67"></a><span id="l15.67"> </span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-    NS_IF_RELEASE(kDefaultServerAtom);</span>
<a href="#l15.70"></a><span id="l15.70">     mAccountArcsOut = nullptr;</span>
<a href="#l15.71"></a><span id="l15.71">     mAccountRootArcsOut = nullptr;</span>
<a href="#l15.72"></a><span id="l15.72">   }</span>
<a href="#l15.73"></a><span id="l15.73"> </span>
<a href="#l15.74"></a><span id="l15.74"> }</span>
<a href="#l15.75"></a><span id="l15.75"> </span>
<a href="#l15.76"></a><span id="l15.76"> NS_IMPL_ADDREF_INHERITED(nsMsgAccountManagerDataSource, nsMsgRDFDataSource)</span>
<a href="#l15.77"></a><span id="l15.77"> NS_IMPL_RELEASE_INHERITED(nsMsgAccountManagerDataSource, nsMsgRDFDataSource)</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineat">@@ -1107,67 +1102,67 @@ nsMsgAccountManagerDataSource::OnServerU</span>
<a href="#l15.79"></a><span id="l15.79"> </span>
<a href="#l15.80"></a><span id="l15.80"> NS_IMETHODIMP</span>
<a href="#l15.81"></a><span id="l15.81"> nsMsgAccountManagerDataSource::OnServerChanged(nsIMsgIncomingServer *server)</span>
<a href="#l15.82"></a><span id="l15.82"> {</span>
<a href="#l15.83"></a><span id="l15.83">   return NS_OK;</span>
<a href="#l15.84"></a><span id="l15.84"> }</span>
<a href="#l15.85"></a><span id="l15.85"> </span>
<a href="#l15.86"></a><span id="l15.86"> nsresult</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+nsMsgAccountManagerDataSource::OnItemPropertyChanged(nsIMsgFolder *, const nsACString &amp;, char const *, char const *)</span>
<a href="#l15.89"></a><span id="l15.89"> {</span>
<a href="#l15.90"></a><span id="l15.90">   return NS_OK;</span>
<a href="#l15.91"></a><span id="l15.91"> }</span>
<a href="#l15.92"></a><span id="l15.92"> </span>
<a href="#l15.93"></a><span id="l15.93"> nsresult</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const char16_t *, const char16_t *)</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineplus">+nsMsgAccountManagerDataSource::OnItemUnicharPropertyChanged(nsIMsgFolder *, const nsACString &amp;, const char16_t *, const char16_t *)</span>
<a href="#l15.96"></a><span id="l15.96"> {</span>
<a href="#l15.97"></a><span id="l15.97">   return NS_OK;</span>
<a href="#l15.98"></a><span id="l15.98"> }</span>
<a href="#l15.99"></a><span id="l15.99"> </span>
<a href="#l15.100"></a><span id="l15.100"> nsresult</span>
<a href="#l15.101"></a><span id="l15.101"> nsMsgAccountManagerDataSource::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l15.102"></a><span id="l15.102"> {</span>
<a href="#l15.103"></a><span id="l15.103">   return NS_OK;</span>
<a href="#l15.104"></a><span id="l15.104"> }</span>
<a href="#l15.105"></a><span id="l15.105"> </span>
<a href="#l15.106"></a><span id="l15.106"> nsresult</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemPropertyFlagChanged(nsIMsgDBHdr *, nsIAtom *, uint32_t, uint32_t)</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineplus">+nsMsgAccountManagerDataSource::OnItemPropertyFlagChanged(nsIMsgDBHdr *, const nsACString &amp;, uint32_t, uint32_t)</span>
<a href="#l15.109"></a><span id="l15.109"> {</span>
<a href="#l15.110"></a><span id="l15.110">   return NS_OK;</span>
<a href="#l15.111"></a><span id="l15.111"> }</span>
<a href="#l15.112"></a><span id="l15.112"> </span>
<a href="#l15.113"></a><span id="l15.113"> nsresult</span>
<a href="#l15.114"></a><span id="l15.114"> nsMsgAccountManagerDataSource::OnItemAdded(nsIMsgFolder *, nsISupports *)</span>
<a href="#l15.115"></a><span id="l15.115"> {</span>
<a href="#l15.116"></a><span id="l15.116">   return NS_OK;</span>
<a href="#l15.117"></a><span id="l15.117"> }</span>
<a href="#l15.118"></a><span id="l15.118"> </span>
<a href="#l15.119"></a><span id="l15.119"> </span>
<a href="#l15.120"></a><span id="l15.120"> nsresult</span>
<a href="#l15.121"></a><span id="l15.121"> nsMsgAccountManagerDataSource::OnItemBoolPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineminus">-                                                         nsIAtom *aProperty,</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+                                                         const nsACString &amp;aProperty,</span>
<a href="#l15.124"></a><span id="l15.124">                                                          bool aOldValue,</span>
<a href="#l15.125"></a><span id="l15.125">                                                          bool aNewValue)</span>
<a href="#l15.126"></a><span id="l15.126"> {</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineminus">-  if (aProperty == kDefaultServerAtom) {</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineplus">+  if (aProperty.Equals(kDefaultServer)) {</span>
<a href="#l15.129"></a><span id="l15.129">     nsCOMPtr&lt;nsIRDFResource&gt; resource(do_QueryInterface(aItem));</span>
<a href="#l15.130"></a><span id="l15.130">     NotifyObservers(resource, kNC_IsDefaultServer, kTrueLiteral, nullptr, aNewValue, false);</span>
<a href="#l15.131"></a><span id="l15.131">   }</span>
<a href="#l15.132"></a><span id="l15.132">   return NS_OK;</span>
<a href="#l15.133"></a><span id="l15.133"> }</span>
<a href="#l15.134"></a><span id="l15.134"> </span>
<a href="#l15.135"></a><span id="l15.135"> nsresult</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemEvent(nsIMsgFolder *, nsIAtom *)</span>
<a href="#l15.137"></a><span id="l15.137" class="difflineplus">+nsMsgAccountManagerDataSource::OnItemEvent(nsIMsgFolder *, const nsACString &amp;)</span>
<a href="#l15.138"></a><span id="l15.138"> {</span>
<a href="#l15.139"></a><span id="l15.139">   return NS_OK;</span>
<a href="#l15.140"></a><span id="l15.140"> }</span>
<a href="#l15.141"></a><span id="l15.141"> </span>
<a href="#l15.142"></a><span id="l15.142"> nsresult</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemIntPropertyChanged(nsIMsgFolder *, nsIAtom *, int64_t, int64_t)</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineplus">+nsMsgAccountManagerDataSource::OnItemIntPropertyChanged(nsIMsgFolder *, const nsACString &amp;, int64_t, int64_t)</span>
<a href="#l15.145"></a><span id="l15.145"> {</span>
<a href="#l15.146"></a><span id="l15.146">   return NS_OK;</span>
<a href="#l15.147"></a><span id="l15.147"> }</span>
<a href="#l15.148"></a><span id="l15.148"> </span>
<a href="#l15.149"></a><span id="l15.149"> NS_IMETHODIMP</span>
<a href="#l15.150"></a><span id="l15.150"> nsMsgAccountManagerDataSource::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *aData)</span>
<a href="#l15.151"></a><span id="l15.151"> {</span>
<a href="#l15.152"></a><span id="l15.152">   nsMsgRDFDataSource::Observe(aSubject, aTopic, aData);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManagerDS.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -117,18 +117,16 @@ protected:</span>
<a href="#l16.4"></a><span id="l16.4">   static nsIRDFResource* kNC_PageTitleSynchronization;</span>
<a href="#l16.5"></a><span id="l16.5">   static nsIRDFResource* kNC_PageTitleDiskSpace;</span>
<a href="#l16.6"></a><span id="l16.6">   static nsIRDFResource* kNC_PageTitleAddressing;</span>
<a href="#l16.7"></a><span id="l16.7">   static nsIRDFResource* kNC_PageTitleSMTP;</span>
<a href="#l16.8"></a><span id="l16.8">   static nsIRDFResource* kNC_PageTitleJunk;</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10">   static nsIRDFLiteral* kTrueLiteral;</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  static nsIAtom* kDefaultServerAtom;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-</span>
<a href="#l16.14"></a><span id="l16.14">   static nsrefcnt gAccountManagerResourceRefCnt;</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16">   static nsresult getAccountArcs(nsIMutableArray **aResult);</span>
<a href="#l16.17"></a><span id="l16.17">   static nsresult getAccountRootArcs(nsIMutableArray **aResult);</span>
<a href="#l16.18"></a><span id="l16.18">   </span>
<a href="#l16.19"></a><span id="l16.19"> private:</span>
<a href="#l16.20"></a><span id="l16.20">   nsresult serverHasIdentities(nsIMsgIncomingServer *aServer, bool *aResult);</span>
<a href="#l16.21"></a><span id="l16.21">   nsresult getStringBundle();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -122,19 +122,16 @@ protected:</span>
<a href="#l17.4"></a><span id="l17.4">   static nsrefcnt gInstanceCount;</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6">   static char16_t* kHighestPriorityString;</span>
<a href="#l17.7"></a><span id="l17.7">   static char16_t* kHighPriorityString;</span>
<a href="#l17.8"></a><span id="l17.8">   static char16_t* kLowestPriorityString;</span>
<a href="#l17.9"></a><span id="l17.9">   static char16_t* kLowPriorityString;</span>
<a href="#l17.10"></a><span id="l17.10">   static char16_t* kNormalPriorityString;</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  static nsIAtom* kJunkMsgAtom;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-  static nsIAtom* kNotJunkMsgAtom;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-</span>
<a href="#l17.15"></a><span id="l17.15">   static char16_t* kReadString;</span>
<a href="#l17.16"></a><span id="l17.16">   static char16_t* kRepliedString;</span>
<a href="#l17.17"></a><span id="l17.17">   static char16_t* kForwardedString;</span>
<a href="#l17.18"></a><span id="l17.18">   static char16_t* kNewString;</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">   nsCOMPtr&lt;nsITreeBoxObject&gt; mTree;</span>
<a href="#l17.21"></a><span id="l17.21">   nsCOMPtr&lt;nsITreeSelection&gt; mTreeSelection;</span>
<a href="#l17.22"></a><span id="l17.22">   uint32_t mNumSelectedRows; // we cache this to determine when to push command status notifications.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -23,16 +23,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l18.6"></a><span id="l18.6"> #include &quot;nsIMsgCopyService.h&quot;</span>
<a href="#l18.7"></a><span id="l18.7"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l18.8"></a><span id="l18.8"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l18.9"></a><span id="l18.9"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l18.10"></a><span id="l18.10"> #include &quot;nsTraceRefcnt.h&quot;</span>
<a href="#l18.11"></a><span id="l18.11"> #include &quot;nsIMsgFolder.h&quot; // TO include biffState enum. Change to bool later...</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l18.13"></a><span id="l18.13"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l18.14"></a><span id="l18.14"> #include &quot;nsIPop3IncomingServer.h&quot;</span>
<a href="#l18.15"></a><span id="l18.15"> #include &quot;nsINntpIncomingServer.h&quot;</span>
<a href="#l18.16"></a><span id="l18.16"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l18.17"></a><span id="l18.17"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l18.18"></a><span id="l18.18"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l18.19"></a><span id="l18.19"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l18.20"></a><span id="l18.20"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineat">@@ -97,30 +98,16 @@ nsIRDFResource* nsMsgFolderDataSource::k</span>
<a href="#l18.22"></a><span id="l18.22"> nsIRDFResource* nsMsgFolderDataSource::kNC_MarkAllMessagesRead= nullptr;</span>
<a href="#l18.23"></a><span id="l18.23"> nsIRDFResource* nsMsgFolderDataSource::kNC_Compact= nullptr;</span>
<a href="#l18.24"></a><span id="l18.24"> nsIRDFResource* nsMsgFolderDataSource::kNC_CompactAll= nullptr;</span>
<a href="#l18.25"></a><span id="l18.25"> nsIRDFResource* nsMsgFolderDataSource::kNC_Rename= nullptr;</span>
<a href="#l18.26"></a><span id="l18.26"> nsIRDFResource* nsMsgFolderDataSource::kNC_EmptyTrash= nullptr;</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28"> nsrefcnt nsMsgFolderDataSource::gFolderResourceRefCnt = 0;</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kBiffStateAtom = nullptr;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kSortOrderAtom = nullptr;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kNewMessagesAtom = nullptr;</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kTotalMessagesAtom = nullptr;</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kTotalUnreadMessagesAtom = nullptr;</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kFolderSizeAtom = nullptr;</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kNameAtom = nullptr;</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kSynchronizeAtom = nullptr;</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kOpenAtom = nullptr;</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kIsDeferredAtom = nullptr;</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kIsSecureAtom = nullptr;</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kCanFileMessagesAtom = nullptr;</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-nsIAtom * nsMsgFolderDataSource::kInVFEditSearchScopeAtom = nullptr;</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineminus">-</span>
<a href="#l18.44"></a><span id="l18.44"> static const uint32_t kDisplayBlankCount = 0xFFFFFFFE;</span>
<a href="#l18.45"></a><span id="l18.45"> static const uint32_t kDisplayQuestionCount = 0xFFFFFFFF;</span>
<a href="#l18.46"></a><span id="l18.46"> static const int64_t kDisplayBlankCount64 = -2;</span>
<a href="#l18.47"></a><span id="l18.47"> static const int64_t kDisplayQuestionCount64 = -1;</span>
<a href="#l18.48"></a><span id="l18.48"> </span>
<a href="#l18.49"></a><span id="l18.49"> nsMsgFolderDataSource::nsMsgFolderDataSource()</span>
<a href="#l18.50"></a><span id="l18.50"> {</span>
<a href="#l18.51"></a><span id="l18.51">   // one-time initialization here</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineat">@@ -179,30 +166,16 @@ nsMsgFolderDataSource::nsMsgFolderDataSo</span>
<a href="#l18.53"></a><span id="l18.53">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COPYFOLDER), &amp;kNC_CopyFolder);</span>
<a href="#l18.54"></a><span id="l18.54">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_MOVEFOLDER), &amp;kNC_MoveFolder);</span>
<a href="#l18.55"></a><span id="l18.55">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_MARKALLMESSAGESREAD),</span>
<a href="#l18.56"></a><span id="l18.56">                              &amp;kNC_MarkAllMessagesRead);</span>
<a href="#l18.57"></a><span id="l18.57">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COMPACT), &amp;kNC_Compact);</span>
<a href="#l18.58"></a><span id="l18.58">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COMPACTALL), &amp;kNC_CompactAll);</span>
<a href="#l18.59"></a><span id="l18.59">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_RENAME), &amp;kNC_Rename);</span>
<a href="#l18.60"></a><span id="l18.60">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_EMPTYTRASH), &amp;kNC_EmptyTrash);</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineminus">-</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineminus">-    kTotalMessagesAtom           = MsgNewAtom(&quot;TotalMessages&quot;).take();</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-    kTotalUnreadMessagesAtom     = MsgNewAtom(&quot;TotalUnreadMessages&quot;).take();</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-    kFolderSizeAtom              = MsgNewAtom(&quot;FolderSize&quot;).take();</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-    kBiffStateAtom               = MsgNewAtom(&quot;BiffState&quot;).take();</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-    kSortOrderAtom               = MsgNewAtom(&quot;SortOrder&quot;).take();</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-    kNewMessagesAtom             = MsgNewAtom(&quot;NewMessages&quot;).take();</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineminus">-    kNameAtom                    = MsgNewAtom(&quot;Name&quot;).take();</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-    kSynchronizeAtom             = MsgNewAtom(&quot;Synchronize&quot;).take();</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineminus">-    kOpenAtom                    = MsgNewAtom(&quot;open&quot;).take();</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineminus">-    kIsDeferredAtom              = MsgNewAtom(&quot;isDeferred&quot;).take();</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineminus">-    kIsSecureAtom                = MsgNewAtom(&quot;isSecure&quot;).take();</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineminus">-    kCanFileMessagesAtom         = MsgNewAtom(&quot;canFileMessages&quot;).take();</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineminus">-    kInVFEditSearchScopeAtom     = MsgNewAtom(&quot;inVFEditSearchScope&quot;).take();</span>
<a href="#l18.75"></a><span id="l18.75">   }</span>
<a href="#l18.76"></a><span id="l18.76"> </span>
<a href="#l18.77"></a><span id="l18.77">   CreateLiterals(rdf);</span>
<a href="#l18.78"></a><span id="l18.78">   CreateArcsOutEnumerator();</span>
<a href="#l18.79"></a><span id="l18.79"> }</span>
<a href="#l18.80"></a><span id="l18.80"> </span>
<a href="#l18.81"></a><span id="l18.81"> nsMsgFolderDataSource::~nsMsgFolderDataSource (void)</span>
<a href="#l18.82"></a><span id="l18.82"> {</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineat">@@ -257,30 +230,16 @@ nsMsgFolderDataSource::~nsMsgFolderDataS</span>
<a href="#l18.84"></a><span id="l18.84">     NS_RELEASE2(kNC_MarkAllMessagesRead, refcnt);</span>
<a href="#l18.85"></a><span id="l18.85">     NS_RELEASE2(kNC_Compact, refcnt);</span>
<a href="#l18.86"></a><span id="l18.86">     NS_RELEASE2(kNC_CompactAll, refcnt);</span>
<a href="#l18.87"></a><span id="l18.87">     NS_RELEASE2(kNC_Rename, refcnt);</span>
<a href="#l18.88"></a><span id="l18.88">     NS_RELEASE2(kNC_EmptyTrash, refcnt);</span>
<a href="#l18.89"></a><span id="l18.89">     NS_RELEASE2(kNC_UnreadFolders, refcnt);</span>
<a href="#l18.90"></a><span id="l18.90">     NS_RELEASE2(kNC_FavoriteFolders, refcnt);</span>
<a href="#l18.91"></a><span id="l18.91">     NS_RELEASE2(kNC_RecentFolders, refcnt);</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineminus">-</span>
<a href="#l18.93"></a><span id="l18.93" class="difflineminus">-    NS_RELEASE(kTotalMessagesAtom);</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineminus">-    NS_RELEASE(kTotalUnreadMessagesAtom);</span>
<a href="#l18.95"></a><span id="l18.95" class="difflineminus">-    NS_RELEASE(kFolderSizeAtom);</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineminus">-    NS_RELEASE(kBiffStateAtom);</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineminus">-    NS_RELEASE(kSortOrderAtom);</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineminus">-    NS_RELEASE(kNewMessagesAtom);</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineminus">-    NS_RELEASE(kNameAtom);</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineminus">-    NS_RELEASE(kSynchronizeAtom);</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineminus">-    NS_RELEASE(kOpenAtom);</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineminus">-    NS_RELEASE(kIsDeferredAtom);</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineminus">-    NS_RELEASE(kIsSecureAtom);</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineminus">-    NS_RELEASE(kCanFileMessagesAtom);</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineminus">-    NS_RELEASE(kInVFEditSearchScopeAtom);</span>
<a href="#l18.106"></a><span id="l18.106">   }</span>
<a href="#l18.107"></a><span id="l18.107"> }</span>
<a href="#l18.108"></a><span id="l18.108"> </span>
<a href="#l18.109"></a><span id="l18.109"> nsresult nsMsgFolderDataSource::CreateLiterals(nsIRDFService *rdf)</span>
<a href="#l18.110"></a><span id="l18.110"> {</span>
<a href="#l18.111"></a><span id="l18.111">   createNode(u&quot;true&quot;,</span>
<a href="#l18.112"></a><span id="l18.112">     getter_AddRefs(kTrueLiteral), rdf);</span>
<a href="#l18.113"></a><span id="l18.113">   createNode(u&quot;false&quot;,</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineat">@@ -807,110 +766,110 @@ nsresult nsMsgFolderDataSource::OnItemAd</span>
<a href="#l18.115"></a><span id="l18.115">     if (parentResource) // RDF is not happy about a null parent resource.</span>
<a href="#l18.116"></a><span id="l18.116">       NotifyObservers(parentResource, kNC_Child, itemNode, nullptr, added, false);</span>
<a href="#l18.117"></a><span id="l18.117">   }</span>
<a href="#l18.118"></a><span id="l18.118">   return NS_OK;</span>
<a href="#l18.119"></a><span id="l18.119"> }</span>
<a href="#l18.120"></a><span id="l18.120"> </span>
<a href="#l18.121"></a><span id="l18.121"> NS_IMETHODIMP</span>
<a href="#l18.122"></a><span id="l18.122"> nsMsgFolderDataSource::OnItemPropertyChanged(nsIMsgFolder *resource,</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineminus">-                                             nsIAtom *property,</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineplus">+                                             const nsACString &amp;property,</span>
<a href="#l18.125"></a><span id="l18.125">                                              const char *oldValue,</span>
<a href="#l18.126"></a><span id="l18.126">                                              const char *newValue)</span>
<a href="#l18.127"></a><span id="l18.127"> </span>
<a href="#l18.128"></a><span id="l18.128"> {</span>
<a href="#l18.129"></a><span id="l18.129">   return NS_OK;</span>
<a href="#l18.130"></a><span id="l18.130"> }</span>
<a href="#l18.131"></a><span id="l18.131"> </span>
<a href="#l18.132"></a><span id="l18.132"> NS_IMETHODIMP</span>
<a href="#l18.133"></a><span id="l18.133"> nsMsgFolderDataSource::OnItemIntPropertyChanged(nsIMsgFolder *folder,</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineminus">-                                                nsIAtom *property,</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineplus">+                                                const nsACString &amp;property,</span>
<a href="#l18.136"></a><span id="l18.136">                                                 int64_t oldValue,</span>
<a href="#l18.137"></a><span id="l18.137">                                                 int64_t newValue)</span>
<a href="#l18.138"></a><span id="l18.138"> {</span>
<a href="#l18.139"></a><span id="l18.139">   nsCOMPtr&lt;nsIRDFResource&gt; resource(do_QueryInterface(folder));</span>
<a href="#l18.140"></a><span id="l18.140" class="difflineminus">-  if (kTotalMessagesAtom == property)</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineplus">+  if (property.Equals(kTotalMessages))</span>
<a href="#l18.142"></a><span id="l18.142">     OnTotalMessagePropertyChanged(resource, oldValue, newValue);</span>
<a href="#l18.143"></a><span id="l18.143" class="difflineminus">-  else if (kTotalUnreadMessagesAtom == property)</span>
<a href="#l18.144"></a><span id="l18.144" class="difflineplus">+  else if (property.Equals(kTotalUnreadMessages))</span>
<a href="#l18.145"></a><span id="l18.145">     OnUnreadMessagePropertyChanged(resource, oldValue, newValue);</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineminus">-  else if (kFolderSizeAtom == property)</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineplus">+  else if (property.Equals(kFolderSize))</span>
<a href="#l18.148"></a><span id="l18.148">     OnFolderSizePropertyChanged(resource, oldValue, newValue);</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineminus">-  else if (kSortOrderAtom == property)</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineplus">+  else if (property.Equals(kSortOrder))</span>
<a href="#l18.151"></a><span id="l18.151">     OnFolderSortOrderPropertyChanged(resource, oldValue, newValue);</span>
<a href="#l18.152"></a><span id="l18.152" class="difflineminus">-  else if (kBiffStateAtom == property) {</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineplus">+  else if (property.Equals(kBiffState)) {</span>
<a href="#l18.154"></a><span id="l18.154">     // be careful about skipping if oldValue == newValue</span>
<a href="#l18.155"></a><span id="l18.155">     // see the comment in nsMsgFolder::SetBiffState() about filters</span>
<a href="#l18.156"></a><span id="l18.156"> </span>
<a href="#l18.157"></a><span id="l18.157">     nsCOMPtr&lt;nsIRDFNode&gt; biffNode;</span>
<a href="#l18.158"></a><span id="l18.158">     nsresult rv = createBiffStateNodeFromFlag(newValue, getter_AddRefs(biffNode));</span>
<a href="#l18.159"></a><span id="l18.159">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l18.160"></a><span id="l18.160"> </span>
<a href="#l18.161"></a><span id="l18.161">     NotifyPropertyChanged(resource, kNC_BiffState, biffNode);</span>
<a href="#l18.162"></a><span id="l18.162">   }</span>
<a href="#l18.163"></a><span id="l18.163">   return NS_OK;</span>
<a href="#l18.164"></a><span id="l18.164"> }</span>
<a href="#l18.165"></a><span id="l18.165"> </span>
<a href="#l18.166"></a><span id="l18.166"> NS_IMETHODIMP</span>
<a href="#l18.167"></a><span id="l18.167"> nsMsgFolderDataSource::OnItemUnicharPropertyChanged(nsIMsgFolder *folder,</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineminus">-                                                    nsIAtom *property,</span>
<a href="#l18.169"></a><span id="l18.169" class="difflineplus">+                                                    const nsACString &amp;property,</span>
<a href="#l18.170"></a><span id="l18.170">                                                     const char16_t *oldValue,</span>
<a href="#l18.171"></a><span id="l18.171">                                                     const char16_t *newValue)</span>
<a href="#l18.172"></a><span id="l18.172"> {</span>
<a href="#l18.173"></a><span id="l18.173">   nsCOMPtr&lt;nsIRDFResource&gt; resource(do_QueryInterface(folder));</span>
<a href="#l18.174"></a><span id="l18.174" class="difflineminus">-  if (kNameAtom == property)</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineplus">+  if (property.Equals(kName))</span>
<a href="#l18.176"></a><span id="l18.176">   {</span>
<a href="#l18.177"></a><span id="l18.177">     int32_t numUnread;</span>
<a href="#l18.178"></a><span id="l18.178">     folder-&gt;GetNumUnread(false, &amp;numUnread);</span>
<a href="#l18.179"></a><span id="l18.179">     NotifyFolderTreeNameChanged(folder, resource, numUnread);</span>
<a href="#l18.180"></a><span id="l18.180">     NotifyFolderTreeSimpleNameChanged(folder, resource);</span>
<a href="#l18.181"></a><span id="l18.181">     NotifyFolderNameChanged(folder, resource);</span>
<a href="#l18.182"></a><span id="l18.182">   }</span>
<a href="#l18.183"></a><span id="l18.183">   return NS_OK;</span>
<a href="#l18.184"></a><span id="l18.184"> }</span>
<a href="#l18.185"></a><span id="l18.185"> </span>
<a href="#l18.186"></a><span id="l18.186"> NS_IMETHODIMP</span>
<a href="#l18.187"></a><span id="l18.187"> nsMsgFolderDataSource::OnItemBoolPropertyChanged(nsIMsgFolder *folder,</span>
<a href="#l18.188"></a><span id="l18.188" class="difflineminus">-                                                 nsIAtom *property,</span>
<a href="#l18.189"></a><span id="l18.189" class="difflineplus">+                                                 const nsACString &amp;property,</span>
<a href="#l18.190"></a><span id="l18.190">                                                  bool oldValue,</span>
<a href="#l18.191"></a><span id="l18.191">                                                  bool newValue)</span>
<a href="#l18.192"></a><span id="l18.192"> {</span>
<a href="#l18.193"></a><span id="l18.193">   nsCOMPtr&lt;nsIRDFResource&gt; resource(do_QueryInterface(folder));</span>
<a href="#l18.194"></a><span id="l18.194">   if (newValue != oldValue) {</span>
<a href="#l18.195"></a><span id="l18.195">     nsIRDFNode* literalNode = newValue?kTrueLiteral:kFalseLiteral;</span>
<a href="#l18.196"></a><span id="l18.196">     nsIRDFNode* oldLiteralNode = oldValue?kTrueLiteral:kFalseLiteral;</span>
<a href="#l18.197"></a><span id="l18.197" class="difflineminus">-    if (kNewMessagesAtom == property)</span>
<a href="#l18.198"></a><span id="l18.198" class="difflineplus">+    if (property.Equals(kNewMessages))</span>
<a href="#l18.199"></a><span id="l18.199">       NotifyPropertyChanged(resource, kNC_NewMessages, literalNode);</span>
<a href="#l18.200"></a><span id="l18.200" class="difflineminus">-    else if (kSynchronizeAtom == property)</span>
<a href="#l18.201"></a><span id="l18.201" class="difflineplus">+    else if (property.Equals(kSynchronize))</span>
<a href="#l18.202"></a><span id="l18.202">       NotifyPropertyChanged(resource, kNC_Synchronize, literalNode);</span>
<a href="#l18.203"></a><span id="l18.203" class="difflineminus">-    else if (kOpenAtom == property)</span>
<a href="#l18.204"></a><span id="l18.204" class="difflineplus">+    else if (property.Equals(kOpen))</span>
<a href="#l18.205"></a><span id="l18.205">       NotifyPropertyChanged(resource, kNC_Open, literalNode);</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineminus">-    else if (kIsDeferredAtom == property)</span>
<a href="#l18.207"></a><span id="l18.207" class="difflineplus">+    else if (property.Equals(kIsDeferred))</span>
<a href="#l18.208"></a><span id="l18.208">       NotifyPropertyChanged(resource, kNC_IsDeferred, literalNode, oldLiteralNode);</span>
<a href="#l18.209"></a><span id="l18.209" class="difflineminus">-    else if (kIsSecureAtom == property)</span>
<a href="#l18.210"></a><span id="l18.210" class="difflineplus">+    else if (property.Equals(kIsSecure))</span>
<a href="#l18.211"></a><span id="l18.211">       NotifyPropertyChanged(resource, kNC_IsSecure, literalNode, oldLiteralNode);</span>
<a href="#l18.212"></a><span id="l18.212" class="difflineminus">-    else if (kCanFileMessagesAtom == property)</span>
<a href="#l18.213"></a><span id="l18.213" class="difflineplus">+    else if (property.Equals(kCanFileMessages))</span>
<a href="#l18.214"></a><span id="l18.214">       NotifyPropertyChanged(resource, kNC_CanFileMessages, literalNode, oldLiteralNode);</span>
<a href="#l18.215"></a><span id="l18.215" class="difflineminus">-    else if (kInVFEditSearchScopeAtom == property)</span>
<a href="#l18.216"></a><span id="l18.216" class="difflineplus">+    else if (property.Equals(kInVFEditSearchScope))</span>
<a href="#l18.217"></a><span id="l18.217">       NotifyPropertyChanged(resource, kNC_InVFEditSearchScope, literalNode);</span>
<a href="#l18.218"></a><span id="l18.218">   }</span>
<a href="#l18.219"></a><span id="l18.219"> </span>
<a href="#l18.220"></a><span id="l18.220">   return NS_OK;</span>
<a href="#l18.221"></a><span id="l18.221"> }</span>
<a href="#l18.222"></a><span id="l18.222"> </span>
<a href="#l18.223"></a><span id="l18.223"> NS_IMETHODIMP</span>
<a href="#l18.224"></a><span id="l18.224"> nsMsgFolderDataSource::OnItemPropertyFlagChanged(nsIMsgDBHdr *item,</span>
<a href="#l18.225"></a><span id="l18.225" class="difflineminus">-                                                 nsIAtom *property,</span>
<a href="#l18.226"></a><span id="l18.226" class="difflineplus">+                                                 const nsACString &amp;property,</span>
<a href="#l18.227"></a><span id="l18.227">                                                  uint32_t oldFlag,</span>
<a href="#l18.228"></a><span id="l18.228">                                                  uint32_t newFlag)</span>
<a href="#l18.229"></a><span id="l18.229"> {</span>
<a href="#l18.230"></a><span id="l18.230">   return NS_OK;</span>
<a href="#l18.231"></a><span id="l18.231"> }</span>
<a href="#l18.232"></a><span id="l18.232"> </span>
<a href="#l18.233"></a><span id="l18.233"> NS_IMETHODIMP</span>
<a href="#l18.234"></a><span id="l18.234" class="difflineminus">-nsMsgFolderDataSource::OnItemEvent(nsIMsgFolder *aFolder, nsIAtom *aEvent)</span>
<a href="#l18.235"></a><span id="l18.235" class="difflineplus">+nsMsgFolderDataSource::OnItemEvent(nsIMsgFolder *aFolder, const nsACString &amp;aEvent)</span>
<a href="#l18.236"></a><span id="l18.236"> {</span>
<a href="#l18.237"></a><span id="l18.237">   return NS_OK;</span>
<a href="#l18.238"></a><span id="l18.238"> }</span>
<a href="#l18.239"></a><span id="l18.239"> </span>
<a href="#l18.240"></a><span id="l18.240"> </span>
<a href="#l18.241"></a><span id="l18.241"> nsresult nsMsgFolderDataSource::createFolderNode(nsIMsgFolder* folder,</span>
<a href="#l18.242"></a><span id="l18.242">                                                  nsIRDFResource* property,</span>
<a href="#l18.243"></a><span id="l18.243">                                                  nsIRDFNode** target)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.h</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.h</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -8,16 +8,18 @@</span>
<a href="#l19.4"></a><span id="l19.4"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l19.7"></a><span id="l19.7"> #include &quot;nsMsgRDFDataSource.h&quot;</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9"> #include &quot;nsITransactionManager.h&quot;</span>
<a href="#l19.10"></a><span id="l19.10"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l19.11"></a><span id="l19.11"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+#include &quot;nsString.h&quot;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+</span>
<a href="#l19.14"></a><span id="l19.14"> #if 0</span>
<a href="#l19.15"></a><span id="l19.15"> // Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l19.16"></a><span id="l19.16"> // classes.</span>
<a href="#l19.17"></a><span id="l19.17"> #if defined(__GNUC__)</span>
<a href="#l19.18"></a><span id="l19.18"> #pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l19.19"></a><span id="l19.19"> #elif defined(_MSC_VER)</span>
<a href="#l19.20"></a><span id="l19.20"> #pragma warning (disable : 4996)</span>
<a href="#l19.21"></a><span id="l19.21"> #endif</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -255,32 +257,18 @@ protected:</span>
<a href="#l19.23"></a><span id="l19.23">   static nsIRDFResource* kNC_CompactAll;</span>
<a href="#l19.24"></a><span id="l19.24">   static nsIRDFResource* kNC_Rename;</span>
<a href="#l19.25"></a><span id="l19.25">   static nsIRDFResource* kNC_EmptyTrash;</span>
<a href="#l19.26"></a><span id="l19.26">   static nsIRDFResource* kNC_DownloadFlagged;</span>
<a href="#l19.27"></a><span id="l19.27">   //Cached literals</span>
<a href="#l19.28"></a><span id="l19.28">   nsCOMPtr&lt;nsIRDFNode&gt; kTrueLiteral;</span>
<a href="#l19.29"></a><span id="l19.29">   nsCOMPtr&lt;nsIRDFNode&gt; kFalseLiteral;</span>
<a href="#l19.30"></a><span id="l19.30"> </span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-  // property atoms</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-  static nsIAtom* kTotalMessagesAtom;</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">-  static nsIAtom* kTotalUnreadMessagesAtom;</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-  static nsIAtom* kFolderSizeAtom;</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">-  static nsIAtom* kBiffStateAtom;</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineminus">-  static nsIAtom* kSortOrderAtom;</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">-  static nsIAtom* kNewMessagesAtom;</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">-  static nsIAtom* kNameAtom;</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">-  static nsIAtom* kSynchronizeAtom;</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">-  static nsIAtom* kOpenAtom;</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-  static nsIAtom* kIsDeferredAtom;</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-  static nsIAtom* kIsSecureAtom;</span>
<a href="#l19.43"></a><span id="l19.43">   static nsrefcnt gFolderResourceRefCnt;</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineminus">-  static nsIAtom* kCanFileMessagesAtom;</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineminus">-  static nsIAtom* kInVFEditSearchScopeAtom;</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-  </span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+</span>
<a href="#l19.48"></a><span id="l19.48">   nsCOMArray&lt;nsIRDFResource&gt; kFolderArcsOutArray;</span>
<a href="#l19.49"></a><span id="l19.49"> </span>
<a href="#l19.50"></a><span id="l19.50"> };</span>
<a href="#l19.51"></a><span id="l19.51"> </span>
<a href="#l19.52"></a><span id="l19.52"> </span>
<a href="#l19.53"></a><span id="l19.53"> class nsMsgFlatFolderDataSource : public nsMsgFolderDataSource</span>
<a href="#l19.54"></a><span id="l19.54"> {</span>
<a href="#l19.55"></a><span id="l19.55"> public:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -91,61 +91,61 @@ NS_IMETHODIMP nsMsgMailSession::RemoveFo</span>
<a href="#l20.4"></a><span id="l20.4">     const folderListener &amp;fL = iter.GetNext();                         \</span>
<a href="#l20.5"></a><span id="l20.5">     if (fL.mNotifyFlags &amp; nsIFolderListener::propertyflag_)            \</span>
<a href="#l20.6"></a><span id="l20.6">       fL.mListener-&gt;propertyfunc_ params_;                             \</span>
<a href="#l20.7"></a><span id="l20.7">   }                                                                    \</span>
<a href="#l20.8"></a><span id="l20.8">   PR_END_MACRO</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10"> NS_IMETHODIMP</span>
<a href="#l20.11"></a><span id="l20.11"> nsMsgMailSession::OnItemPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-                                        nsIAtom *aProperty,</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+                                        const nsACString &amp;aProperty,</span>
<a href="#l20.14"></a><span id="l20.14">                                         const char* aOldValue,</span>
<a href="#l20.15"></a><span id="l20.15">                                         const char* aNewValue)</span>
<a href="#l20.16"></a><span id="l20.16"> {</span>
<a href="#l20.17"></a><span id="l20.17">   NOTIFY_FOLDER_LISTENERS(propertyChanged, OnItemPropertyChanged,</span>
<a href="#l20.18"></a><span id="l20.18">                           (aItem, aProperty, aOldValue, aNewValue));</span>
<a href="#l20.19"></a><span id="l20.19">   return NS_OK;</span>
<a href="#l20.20"></a><span id="l20.20"> }</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22"> NS_IMETHODIMP</span>
<a href="#l20.23"></a><span id="l20.23"> nsMsgMailSession::OnItemUnicharPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-                                               nsIAtom *aProperty,</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+                                               const nsACString &amp;aProperty,</span>
<a href="#l20.26"></a><span id="l20.26">                                                const char16_t* aOldValue,</span>
<a href="#l20.27"></a><span id="l20.27">                                                const char16_t* aNewValue)</span>
<a href="#l20.28"></a><span id="l20.28"> {</span>
<a href="#l20.29"></a><span id="l20.29">   NOTIFY_FOLDER_LISTENERS(unicharPropertyChanged, OnItemUnicharPropertyChanged,</span>
<a href="#l20.30"></a><span id="l20.30">                           (aItem, aProperty, aOldValue, aNewValue));</span>
<a href="#l20.31"></a><span id="l20.31">   return NS_OK;</span>
<a href="#l20.32"></a><span id="l20.32"> }</span>
<a href="#l20.33"></a><span id="l20.33"> </span>
<a href="#l20.34"></a><span id="l20.34"> NS_IMETHODIMP</span>
<a href="#l20.35"></a><span id="l20.35"> nsMsgMailSession::OnItemIntPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-                                           nsIAtom *aProperty,</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineplus">+                                           const nsACString &amp;aProperty,</span>
<a href="#l20.38"></a><span id="l20.38">                                            int64_t aOldValue,</span>
<a href="#l20.39"></a><span id="l20.39">                                            int64_t aNewValue)</span>
<a href="#l20.40"></a><span id="l20.40"> {</span>
<a href="#l20.41"></a><span id="l20.41">   NOTIFY_FOLDER_LISTENERS(intPropertyChanged, OnItemIntPropertyChanged,</span>
<a href="#l20.42"></a><span id="l20.42">                           (aItem, aProperty, aOldValue, aNewValue));</span>
<a href="#l20.43"></a><span id="l20.43">   return NS_OK;</span>
<a href="#l20.44"></a><span id="l20.44"> }</span>
<a href="#l20.45"></a><span id="l20.45"> </span>
<a href="#l20.46"></a><span id="l20.46"> NS_IMETHODIMP</span>
<a href="#l20.47"></a><span id="l20.47"> nsMsgMailSession::OnItemBoolPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineminus">-                                            nsIAtom *aProperty,</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+                                            const nsACString &amp;aProperty,</span>
<a href="#l20.50"></a><span id="l20.50">                                             bool aOldValue,</span>
<a href="#l20.51"></a><span id="l20.51">                                             bool aNewValue)</span>
<a href="#l20.52"></a><span id="l20.52"> {</span>
<a href="#l20.53"></a><span id="l20.53">   NOTIFY_FOLDER_LISTENERS(boolPropertyChanged, OnItemBoolPropertyChanged,</span>
<a href="#l20.54"></a><span id="l20.54">                           (aItem, aProperty, aOldValue, aNewValue));</span>
<a href="#l20.55"></a><span id="l20.55">   return NS_OK;</span>
<a href="#l20.56"></a><span id="l20.56"> }</span>
<a href="#l20.57"></a><span id="l20.57"> </span>
<a href="#l20.58"></a><span id="l20.58"> NS_IMETHODIMP</span>
<a href="#l20.59"></a><span id="l20.59"> nsMsgMailSession::OnItemPropertyFlagChanged(nsIMsgDBHdr *aItem,</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-                                            nsIAtom *aProperty,</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+                                            const nsACString &amp;aProperty,</span>
<a href="#l20.62"></a><span id="l20.62">                                             uint32_t aOldValue,</span>
<a href="#l20.63"></a><span id="l20.63">                                             uint32_t aNewValue)</span>
<a href="#l20.64"></a><span id="l20.64"> {</span>
<a href="#l20.65"></a><span id="l20.65">   NOTIFY_FOLDER_LISTENERS(propertyFlagChanged, OnItemPropertyFlagChanged,</span>
<a href="#l20.66"></a><span id="l20.66">                           (aItem, aProperty, aOldValue, aNewValue));</span>
<a href="#l20.67"></a><span id="l20.67">   return NS_OK;</span>
<a href="#l20.68"></a><span id="l20.68"> }</span>
<a href="#l20.69"></a><span id="l20.69"> </span>
<a href="#l20.70"></a><span id="l20.70" class="difflineat">@@ -159,17 +159,17 @@ NS_IMETHODIMP nsMsgMailSession::OnItemAd</span>
<a href="#l20.71"></a><span id="l20.71"> NS_IMETHODIMP nsMsgMailSession::OnItemRemoved(nsIMsgFolder *aParentItem,</span>
<a href="#l20.72"></a><span id="l20.72">                                               nsISupports *aItem)</span>
<a href="#l20.73"></a><span id="l20.73"> {</span>
<a href="#l20.74"></a><span id="l20.74">   NOTIFY_FOLDER_LISTENERS(removed, OnItemRemoved, (aParentItem, aItem));</span>
<a href="#l20.75"></a><span id="l20.75">   return NS_OK;</span>
<a href="#l20.76"></a><span id="l20.76"> }</span>
<a href="#l20.77"></a><span id="l20.77"> </span>
<a href="#l20.78"></a><span id="l20.78"> NS_IMETHODIMP nsMsgMailSession::OnItemEvent(nsIMsgFolder *aFolder,</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineminus">-                                            nsIAtom *aEvent)</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineplus">+                                            const nsACString &amp;aEvent)</span>
<a href="#l20.81"></a><span id="l20.81"> {</span>
<a href="#l20.82"></a><span id="l20.82">   NOTIFY_FOLDER_LISTENERS(event, OnItemEvent, (aFolder, aEvent));</span>
<a href="#l20.83"></a><span id="l20.83">   return NS_OK;</span>
<a href="#l20.84"></a><span id="l20.84"> }</span>
<a href="#l20.85"></a><span id="l20.85"> </span>
<a href="#l20.86"></a><span id="l20.86"> NS_IMETHODIMP</span>
<a href="#l20.87"></a><span id="l20.87"> nsMsgMailSession::AddUserFeedbackListener(nsIMsgUserFeedbackListener *aListener)</span>
<a href="#l20.88"></a><span id="l20.88"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -15,34 +15,33 @@</span>
<a href="#l21.4"></a><span id="l21.4"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l21.5"></a><span id="l21.5"> #include &quot;prinrval.h&quot;</span>
<a href="#l21.6"></a><span id="l21.6"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l21.7"></a><span id="l21.7"> #include &quot;nsIMimeMiscStatus.h&quot;</span>
<a href="#l21.8"></a><span id="l21.8"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l21.9"></a><span id="l21.9"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l21.10"></a><span id="l21.10"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l21.11"></a><span id="l21.11"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l21.13"></a><span id="l21.13"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l21.14"></a><span id="l21.14"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l21.15"></a><span id="l21.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17"> #define MSGFEEDBACK_TIMER_INTERVAL 500</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19"> nsMsgStatusFeedback::nsMsgStatusFeedback() :</span>
<a href="#l21.20"></a><span id="l21.20">   m_lastPercent(0),</span>
<a href="#l21.21"></a><span id="l21.21">   m_lastProgressTime(0)</span>
<a href="#l21.22"></a><span id="l21.22"> {</span>
<a href="#l21.23"></a><span id="l21.23">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l21.24"></a><span id="l21.24">     mozilla::services::GetStringBundleService();</span>
<a href="#l21.25"></a><span id="l21.25"> </span>
<a href="#l21.26"></a><span id="l21.26">   if (bundleService)</span>
<a href="#l21.27"></a><span id="l21.27">     bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l21.28"></a><span id="l21.28">                                 getter_AddRefs(mBundle));</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-  m_msgLoadedAtom = MsgGetAtom(&quot;msgLoaded&quot;);</span>
<a href="#l21.31"></a><span id="l21.31"> }</span>
<a href="#l21.32"></a><span id="l21.32"> </span>
<a href="#l21.33"></a><span id="l21.33"> nsMsgStatusFeedback::~nsMsgStatusFeedback()</span>
<a href="#l21.34"></a><span id="l21.34"> {</span>
<a href="#l21.35"></a><span id="l21.35">   mBundle = nullptr;</span>
<a href="#l21.36"></a><span id="l21.36"> }</span>
<a href="#l21.37"></a><span id="l21.37"> </span>
<a href="#l21.38"></a><span id="l21.38"> NS_IMPL_ISUPPORTS(nsMsgStatusFeedback, nsIMsgStatusFeedback,</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineat">@@ -128,17 +127,17 @@ nsMsgStatusFeedback::OnStateChange(nsIWe</span>
<a href="#l21.40"></a><span id="l21.40">             nsCOMPtr &lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l21.41"></a><span id="l21.41">             mailnewsUrl-&gt;GetFolder(getter_AddRefs(msgFolder));</span>
<a href="#l21.42"></a><span id="l21.42">             nsCOMPtr &lt;nsIMsgMessageUrl&gt; msgUrl = do_QueryInterface(mailnewsUrl);</span>
<a href="#l21.43"></a><span id="l21.43">             if (msgUrl)</span>
<a href="#l21.44"></a><span id="l21.44">             {</span>
<a href="#l21.45"></a><span id="l21.45">               // not sending this notification is not a fatal error...</span>
<a href="#l21.46"></a><span id="l21.46">               (void) msgUrl-&gt;GetMessageHeader(getter_AddRefs(msgHdr));</span>
<a href="#l21.47"></a><span id="l21.47">               if (msgFolder &amp;&amp; msgHdr)</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-                msgFolder-&gt;NotifyPropertyFlagChanged(msgHdr, m_msgLoadedAtom, 0, 1);</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+                msgFolder-&gt;NotifyPropertyFlagChanged(msgHdr, kMsgLoaded, 0, 1);</span>
<a href="#l21.50"></a><span id="l21.50">             }</span>
<a href="#l21.51"></a><span id="l21.51">           }</span>
<a href="#l21.52"></a><span id="l21.52">         }</span>
<a href="#l21.53"></a><span id="l21.53">       }</span>
<a href="#l21.54"></a><span id="l21.54">       StopMeteors();</span>
<a href="#l21.55"></a><span id="l21.55">       nsString documentDone;</span>
<a href="#l21.56"></a><span id="l21.56">       rv = mBundle-&gt;GetStringFromName(&quot;documentDone&quot;, documentDone);</span>
<a href="#l21.57"></a><span id="l21.57">       if (NS_SUCCEEDED(rv))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/src/nsMsgStatusFeedback.h</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgStatusFeedback.h</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -9,17 +9,16 @@</span>
<a href="#l22.4"></a><span id="l22.4"> #include &quot;nsIWebProgressListener.h&quot;</span>
<a href="#l22.5"></a><span id="l22.5"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l22.6"></a><span id="l22.6"> #include &quot;nsITimer.h&quot;</span>
<a href="#l22.7"></a><span id="l22.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l22.8"></a><span id="l22.8"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l22.9"></a><span id="l22.9"> #include &quot;nsIProgressEventSink.h&quot;</span>
<a href="#l22.10"></a><span id="l22.10"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l22.11"></a><span id="l22.11"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-#include &quot;nsIAtom.h&quot;</span>
<a href="#l22.13"></a><span id="l22.13"> </span>
<a href="#l22.14"></a><span id="l22.14"> class nsMsgStatusFeedback : public nsIMsgStatusFeedback,</span>
<a href="#l22.15"></a><span id="l22.15">                             public nsIProgressEventSink,</span>
<a href="#l22.16"></a><span id="l22.16">                             public nsIWebProgressListener,</span>
<a href="#l22.17"></a><span id="l22.17">                             public nsSupportsWeakReference</span>
<a href="#l22.18"></a><span id="l22.18"> {</span>
<a href="#l22.19"></a><span id="l22.19"> public:</span>
<a href="#l22.20"></a><span id="l22.20">   nsMsgStatusFeedback();</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineat">@@ -39,12 +38,11 @@ protected:</span>
<a href="#l22.22"></a><span id="l22.22">   void BeginObserving();</span>
<a href="#l22.23"></a><span id="l22.23">   void EndObserving();</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25">   // the JS status feedback implementation object...eventually this object</span>
<a href="#l22.26"></a><span id="l22.26">   // will replace this very C++ class you are looking at.</span>
<a href="#l22.27"></a><span id="l22.27">   nsWeakPtr mJSStatusFeedbackWeak;</span>
<a href="#l22.28"></a><span id="l22.28"> </span>
<a href="#l22.29"></a><span id="l22.29">   nsCOMPtr&lt;nsIStringBundle&gt; mBundle;</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">-  nsCOMPtr &lt;nsIAtom&gt; m_msgLoadedAtom;</span>
<a href="#l22.31"></a><span id="l22.31"> };</span>
<a href="#l22.32"></a><span id="l22.32"> </span>
<a href="#l22.33"></a><span id="l22.33"> #endif // _nsMsgStatusFeedback_h</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/src/nsMsgWindow.h</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgWindow.h</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -5,22 +5,22 @@</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5"> #ifndef _nsMsgWindow_h</span>
<a href="#l23.6"></a><span id="l23.6"> #define _nsMsgWindow_h</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l23.9"></a><span id="l23.9"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l23.10"></a><span id="l23.10"> #include &quot;nsITransactionManager.h&quot;</span>
<a href="#l23.11"></a><span id="l23.11"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l23.13"></a><span id="l23.13"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l23.14"></a><span id="l23.14"> #include &quot;nsIURIContentListener.h&quot;</span>
<a href="#l23.15"></a><span id="l23.15"> #include &quot;nsIMimeMiscStatus.h&quot;</span>
<a href="#l23.16"></a><span id="l23.16"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l23.17"></a><span id="l23.17"> #include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l23.19"></a><span id="l23.19"> </span>
<a href="#l23.20"></a><span id="l23.20"> class nsMsgWindow : public nsIMsgWindow,</span>
<a href="#l23.21"></a><span id="l23.21">                     public nsIURIContentListener,</span>
<a href="#l23.22"></a><span id="l23.22">                     public nsIMsgWindowTest,</span>
<a href="#l23.23"></a><span id="l23.23">                     public nsSupportsWeakReference</span>
<a href="#l23.24"></a><span id="l23.24"> {</span>
<a href="#l23.25"></a><span id="l23.25"> </span>
<a href="#l23.26"></a><span id="l23.26"> public:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -8,40 +8,38 @@</span>
<a href="#l24.4"></a><span id="l24.4"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l24.5"></a><span id="l24.5"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l24.6"></a><span id="l24.6"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l24.7"></a><span id="l24.7"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l24.8"></a><span id="l24.8"> #include &quot;nsIWindowMediator.h&quot;</span>
<a href="#l24.9"></a><span id="l24.9"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l24.10"></a><span id="l24.10"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l24.11"></a><span id="l24.11"> #include &quot;nsIMsgFolder.h&quot; // TO include biffState enum. Change to bool later...</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l24.13"></a><span id="l24.13"> #include &quot;nsIFileChannel.h&quot;</span>
<a href="#l24.14"></a><span id="l24.14"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l24.15"></a><span id="l24.15"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l24.16"></a><span id="l24.16"> #include &quot;nsIURL.h&quot;</span>
<a href="#l24.17"></a><span id="l24.17"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l24.18"></a><span id="l24.18"> #include &quot;nsIFileURL.h&quot;</span>
<a href="#l24.19"></a><span id="l24.19"> #include &quot;nsIFile.h&quot;</span>
<a href="#l24.20"></a><span id="l24.20"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l24.21"></a><span id="l24.21"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23"> // QueryInterface, AddRef, and Release</span>
<a href="#l24.24"></a><span id="l24.24"> //</span>
<a href="#l24.25"></a><span id="l24.25"> NS_IMPL_ISUPPORTS(nsStatusBarBiffManager, nsIStatusBarBiffManager, nsIFolderListener, nsIObserver)</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-nsIAtom * nsStatusBarBiffManager::kBiffStateAtom = nullptr;</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-</span>
<a href="#l24.29"></a><span id="l24.29"> nsStatusBarBiffManager::nsStatusBarBiffManager()</span>
<a href="#l24.30"></a><span id="l24.30"> : mInitialized(false), mCurrentBiffState(nsIMsgFolder::nsMsgBiffState_Unknown)</span>
<a href="#l24.31"></a><span id="l24.31"> {</span>
<a href="#l24.32"></a><span id="l24.32"> }</span>
<a href="#l24.33"></a><span id="l24.33"> </span>
<a href="#l24.34"></a><span id="l24.34"> nsStatusBarBiffManager::~nsStatusBarBiffManager()</span>
<a href="#l24.35"></a><span id="l24.35"> {</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-    NS_IF_RELEASE(kBiffStateAtom);</span>
<a href="#l24.37"></a><span id="l24.37"> }</span>
<a href="#l24.38"></a><span id="l24.38"> </span>
<a href="#l24.39"></a><span id="l24.39"> #define NEW_MAIL_PREF_BRANCH             &quot;mail.biff.&quot;</span>
<a href="#l24.40"></a><span id="l24.40"> #define CHAT_PREF_BRANCH                 &quot;mail.chat.&quot;</span>
<a href="#l24.41"></a><span id="l24.41"> #define FEED_PREF_BRANCH                 &quot;mail.feed.&quot;</span>
<a href="#l24.42"></a><span id="l24.42"> #define PREF_PLAY_SOUND                  &quot;play_sound&quot;</span>
<a href="#l24.43"></a><span id="l24.43"> #define PREF_SOUND_URL                   &quot;play_sound.url&quot;</span>
<a href="#l24.44"></a><span id="l24.44"> #define PREF_SOUND_TYPE                  &quot;play_sound.type&quot;</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineat">@@ -52,18 +50,16 @@ nsStatusBarBiffManager::~nsStatusBarBiff</span>
<a href="#l24.46"></a><span id="l24.46"> </span>
<a href="#l24.47"></a><span id="l24.47"> nsresult nsStatusBarBiffManager::Init()</span>
<a href="#l24.48"></a><span id="l24.48"> {</span>
<a href="#l24.49"></a><span id="l24.49">   if (mInitialized)</span>
<a href="#l24.50"></a><span id="l24.50">     return NS_ERROR_ALREADY_INITIALIZED;</span>
<a href="#l24.51"></a><span id="l24.51"> </span>
<a href="#l24.52"></a><span id="l24.52">   nsresult rv;</span>
<a href="#l24.53"></a><span id="l24.53"> </span>
<a href="#l24.54"></a><span id="l24.54" class="difflineminus">-  kBiffStateAtom = MsgNewAtom(&quot;BiffState&quot;).take();</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-</span>
<a href="#l24.56"></a><span id="l24.56">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = </span>
<a href="#l24.57"></a><span id="l24.57">     do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv); </span>
<a href="#l24.58"></a><span id="l24.58">   if(NS_SUCCEEDED(rv))</span>
<a href="#l24.59"></a><span id="l24.59">     mailSession-&gt;AddFolderListener(this, nsIFolderListener::intPropertyChanged);</span>
<a href="#l24.60"></a><span id="l24.60"> </span>
<a href="#l24.61"></a><span id="l24.61">   nsCOMPtr&lt;nsIPrefBranch&gt; pref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l24.62"></a><span id="l24.62">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.63"></a><span id="l24.63"> </span>
<a href="#l24.64"></a><span id="l24.64" class="difflineat">@@ -168,25 +164,25 @@ nsStatusBarBiffManager::OnItemAdded(nsIM</span>
<a href="#l24.65"></a><span id="l24.65"> </span>
<a href="#l24.66"></a><span id="l24.66"> NS_IMETHODIMP </span>
<a href="#l24.67"></a><span id="l24.67"> nsStatusBarBiffManager::OnItemRemoved(nsIMsgFolder *parentItem, nsISupports *item)</span>
<a href="#l24.68"></a><span id="l24.68"> {</span>
<a href="#l24.69"></a><span id="l24.69">   return NS_OK;</span>
<a href="#l24.70"></a><span id="l24.70"> }</span>
<a href="#l24.71"></a><span id="l24.71"> </span>
<a href="#l24.72"></a><span id="l24.72"> NS_IMETHODIMP </span>
<a href="#l24.73"></a><span id="l24.73" class="difflineminus">-nsStatusBarBiffManager::OnItemPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char *oldValue, const char *newValue)</span>
<a href="#l24.74"></a><span id="l24.74" class="difflineplus">+nsStatusBarBiffManager::OnItemPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char *oldValue, const char *newValue)</span>
<a href="#l24.75"></a><span id="l24.75"> {</span>
<a href="#l24.76"></a><span id="l24.76">   return NS_OK;</span>
<a href="#l24.77"></a><span id="l24.77"> }</span>
<a href="#l24.78"></a><span id="l24.78"> </span>
<a href="#l24.79"></a><span id="l24.79"> NS_IMETHODIMP</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineminus">-nsStatusBarBiffManager::OnItemIntPropertyChanged(nsIMsgFolder *item, nsIAtom *property, int64_t oldValue, int64_t newValue)</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineplus">+nsStatusBarBiffManager::OnItemIntPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, int64_t oldValue, int64_t newValue)</span>
<a href="#l24.82"></a><span id="l24.82"> {</span>
<a href="#l24.83"></a><span id="l24.83" class="difflineminus">-  if (kBiffStateAtom == property &amp;&amp; mCurrentBiffState != newValue) {</span>
<a href="#l24.84"></a><span id="l24.84" class="difflineplus">+  if (property.Equals(kBiffState) &amp;&amp; mCurrentBiffState != newValue) {</span>
<a href="#l24.85"></a><span id="l24.85">     // if we got new mail, attempt to play a sound.</span>
<a href="#l24.86"></a><span id="l24.86">     // if we fail along the way, don't return.</span>
<a href="#l24.87"></a><span id="l24.87">     // we still need to update the UI.    </span>
<a href="#l24.88"></a><span id="l24.88">     if (newValue == nsIMsgFolder::nsMsgBiffState_NewMail) {</span>
<a href="#l24.89"></a><span id="l24.89">       // Get the folder's server type.</span>
<a href="#l24.90"></a><span id="l24.90">       nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l24.91"></a><span id="l24.91">       nsresult rv = item-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l24.92"></a><span id="l24.92">       if (NS_SUCCEEDED(rv) &amp;&amp; server)</span>
<a href="#l24.93"></a><span id="l24.93" class="difflineat">@@ -203,35 +199,35 @@ nsStatusBarBiffManager::OnItemIntPropert</span>
<a href="#l24.94"></a><span id="l24.94">       </span>
<a href="#l24.95"></a><span id="l24.95">     if (observerService)</span>
<a href="#l24.96"></a><span id="l24.96">       observerService-&gt;NotifyObservers(static_cast&lt;nsIStatusBarBiffManager*&gt;(this), &quot;mail:biff-state-changed&quot;, nullptr);</span>
<a href="#l24.97"></a><span id="l24.97">   }</span>
<a href="#l24.98"></a><span id="l24.98">   return NS_OK;</span>
<a href="#l24.99"></a><span id="l24.99"> }</span>
<a href="#l24.100"></a><span id="l24.100"> </span>
<a href="#l24.101"></a><span id="l24.101"> NS_IMETHODIMP </span>
<a href="#l24.102"></a><span id="l24.102" class="difflineminus">-nsStatusBarBiffManager::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l24.103"></a><span id="l24.103" class="difflineplus">+nsStatusBarBiffManager::OnItemBoolPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, bool oldValue, bool newValue)</span>
<a href="#l24.104"></a><span id="l24.104"> {</span>
<a href="#l24.105"></a><span id="l24.105">   return NS_OK;</span>
<a href="#l24.106"></a><span id="l24.106"> }</span>
<a href="#l24.107"></a><span id="l24.107"> </span>
<a href="#l24.108"></a><span id="l24.108"> NS_IMETHODIMP </span>
<a href="#l24.109"></a><span id="l24.109" class="difflineminus">-nsStatusBarBiffManager::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l24.110"></a><span id="l24.110" class="difflineplus">+nsStatusBarBiffManager::OnItemUnicharPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l24.111"></a><span id="l24.111"> {</span>
<a href="#l24.112"></a><span id="l24.112">   return NS_OK;</span>
<a href="#l24.113"></a><span id="l24.113"> }</span>
<a href="#l24.114"></a><span id="l24.114"> </span>
<a href="#l24.115"></a><span id="l24.115"> NS_IMETHODIMP </span>
<a href="#l24.116"></a><span id="l24.116" class="difflineminus">-nsStatusBarBiffManager::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l24.117"></a><span id="l24.117" class="difflineplus">+nsStatusBarBiffManager::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, const nsACString &amp;property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l24.118"></a><span id="l24.118"> {</span>
<a href="#l24.119"></a><span id="l24.119">   return NS_OK;</span>
<a href="#l24.120"></a><span id="l24.120"> }</span>
<a href="#l24.121"></a><span id="l24.121"> </span>
<a href="#l24.122"></a><span id="l24.122"> NS_IMETHODIMP </span>
<a href="#l24.123"></a><span id="l24.123" class="difflineminus">-nsStatusBarBiffManager::OnItemEvent(nsIMsgFolder *item, nsIAtom *event)</span>
<a href="#l24.124"></a><span id="l24.124" class="difflineplus">+nsStatusBarBiffManager::OnItemEvent(nsIMsgFolder *item, const nsACString &amp;event)</span>
<a href="#l24.125"></a><span id="l24.125"> {</span>
<a href="#l24.126"></a><span id="l24.126">   return NS_OK;</span>
<a href="#l24.127"></a><span id="l24.127"> }</span>
<a href="#l24.128"></a><span id="l24.128"> </span>
<a href="#l24.129"></a><span id="l24.129"> // nsIObserver implementation</span>
<a href="#l24.130"></a><span id="l24.130"> NS_IMETHODIMP</span>
<a href="#l24.131"></a><span id="l24.131"> nsStatusBarBiffManager::Observe(nsISupports *aSubject,</span>
<a href="#l24.132"></a><span id="l24.132">                                 const char *aTopic,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/base/src/nsStatusBarBiffManager.h</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/base/src/nsStatusBarBiffManager.h</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -28,17 +28,14 @@ public:</span>
<a href="#l25.4"></a><span id="l25.4"> private:</span>
<a href="#l25.5"></a><span id="l25.5">   virtual ~nsStatusBarBiffManager();</span>
<a href="#l25.6"></a><span id="l25.6"> </span>
<a href="#l25.7"></a><span id="l25.7">   bool     mInitialized;</span>
<a href="#l25.8"></a><span id="l25.8">   int32_t  mCurrentBiffState;</span>
<a href="#l25.9"></a><span id="l25.9">   nsCString mServerType;</span>
<a href="#l25.10"></a><span id="l25.10">   nsCOMPtr&lt;nsISound&gt; mSound;</span>
<a href="#l25.11"></a><span id="l25.11">   nsresult PlayBiffSound(const char *aPrefBranch);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-protected:</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-  static nsIAtom* kBiffStateAtom;</span>
<a href="#l25.15"></a><span id="l25.15"> };</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17"> </span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19"> #endif // nsStatusBarBiffManager_h__</span>
<a href="#l25.20"></a><span id="l25.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/base/util/moz.build</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/base/util/moz.build</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -3,17 +3,16 @@</span>
<a href="#l26.4"></a><span id="l26.4"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l26.5"></a><span id="l26.5"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l26.6"></a><span id="l26.6"> </span>
<a href="#l26.7"></a><span id="l26.7"> EXPORTS += [</span>
<a href="#l26.8"></a><span id="l26.8">     'nsImapMoveCoalescer.h',</span>
<a href="#l26.9"></a><span id="l26.9">     'nsMsgCompressIStream.h',</span>
<a href="#l26.10"></a><span id="l26.10">     'nsMsgCompressOStream.h',</span>
<a href="#l26.11"></a><span id="l26.11">     'nsMsgDBFolder.h',</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-    'nsMsgDBFolderAtomList.h',</span>
<a href="#l26.13"></a><span id="l26.13">     'nsMsgI18N.h',</span>
<a href="#l26.14"></a><span id="l26.14">     'nsMsgIdentity.h',</span>
<a href="#l26.15"></a><span id="l26.15">     'nsMsgIncomingServer.h',</span>
<a href="#l26.16"></a><span id="l26.16">     'nsMsgKeyArray.h',</span>
<a href="#l26.17"></a><span id="l26.17">     'nsMsgKeySet.h',</span>
<a href="#l26.18"></a><span id="l26.18">     'nsMsgLineBuffer.h',</span>
<a href="#l26.19"></a><span id="l26.19">     'nsMsgMailNewsUrl.h',</span>
<a href="#l26.20"></a><span id="l26.20">     'nsMsgProtocol.h',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -95,26 +95,59 @@ nsString nsMsgDBFolder::kLocalizedTempla</span>
<a href="#l27.4"></a><span id="l27.4"> nsString nsMsgDBFolder::kLocalizedUnsentName;</span>
<a href="#l27.5"></a><span id="l27.5"> nsString nsMsgDBFolder::kLocalizedJunkName;</span>
<a href="#l27.6"></a><span id="l27.6"> nsString nsMsgDBFolder::kLocalizedArchivesName;</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> nsString nsMsgDBFolder::kLocalizedBrandShortName;</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10"> nsrefcnt nsMsgDBFolder::mInstanceCount=0;</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-NS_IMPL_ISUPPORTS_INHERITED(nsMsgDBFolder, nsRDFResource, </span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+// We define strings for folder properties and events.</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+// Properties:</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kBiffState, &quot;BiffState&quot;);</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kCanFileMessages, &quot;CanFileMessages&quot;);</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kDefaultServer, &quot;DefaultServer&quot;);</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kFlagged, &quot;Flagged&quot;);</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kFolderFlag, &quot;FolderFlag&quot;);</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kFolderSize, &quot;FolderSize&quot;);</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kInVFEditSearchScope, &quot;inVFEditSearchScope&quot;);</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kIsDeferred, &quot;isDeferred&quot;);</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kIsSecure, &quot;isSecure&quot;);</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kJunkStatusChanged, &quot;JunkStatusChanged&quot;);</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kKeywords, &quot;Keywords&quot;);</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kMRMTimeChanged, &quot;MRMTimeChanged&quot;);</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kMsgLoaded, &quot;msgLoaded&quot;);</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kName, &quot;Name&quot;);</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kNewMailReceived, &quot;NewMailReceived&quot;);</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kNewMessages, &quot;NewMessages&quot;);</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kOpen, &quot;open&quot;);</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kSortOrder, &quot;SortOrder&quot;);</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kStatus, &quot;Status&quot;);</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kSynchronize, &quot;Synchronize&quot;);</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kTotalMessages, &quot;TotalMessages&quot;);</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kTotalUnreadMessages, &quot;TotalUnreadMessages&quot;);</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineplus">+</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineplus">+// Events:</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kAboutToCompact, &quot;AboutToCompact&quot;);</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kCompactCompleted, &quot;CompactCompleted&quot;);</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kDeleteOrMoveMsgCompleted, &quot;DeleteOrMoveMsgCompleted&quot;);</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kDeleteOrMoveMsgFailed, &quot;DeleteOrMoveMsgFailed&quot;);</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kFiltersApplied, &quot;FiltersApplied&quot;);</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kFolderCreateCompleted, &quot;FolderCreateCompleted&quot;);</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kFolderCreateFailed, &quot;FolderCreateFailed&quot;);</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kFolderLoaded, &quot;FolderLoaded&quot;);</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kNumNewBiffMessages, &quot;NumNewBiffMessages&quot;);</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineplus">+NS_NAMED_LITERAL_CSTRING(kRenameCompleted, &quot;RenameCompleted&quot;);</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineplus">+</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineplus">+NS_IMPL_ISUPPORTS_INHERITED(nsMsgDBFolder, nsRDFResource,</span>
<a href="#l27.51"></a><span id="l27.51">                              nsISupportsWeakReference, nsIMsgFolder,</span>
<a href="#l27.52"></a><span id="l27.52">                              nsIDBChangeListener, nsIUrlListener,</span>
<a href="#l27.53"></a><span id="l27.53">                              nsIJunkMailClassificationListener,</span>
<a href="#l27.54"></a><span id="l27.54">                              nsIMsgTraitClassificationListener)</span>
<a href="#l27.55"></a><span id="l27.55"> </span>
<a href="#l27.56"></a><span id="l27.56" class="difflineminus">-#define MSGDBFOLDER_ATOM(name_, value_) nsIAtom* nsMsgDBFolder::name_ = nullptr;</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineminus">-#include &quot;nsMsgDBFolderAtomList.h&quot;</span>
<a href="#l27.58"></a><span id="l27.58" class="difflineminus">-#undef MSGDBFOLDER_ATOM</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineminus">-</span>
<a href="#l27.60"></a><span id="l27.60"> nsMsgDBFolder::nsMsgDBFolder(void)</span>
<a href="#l27.61"></a><span id="l27.61"> : mAddListener(true),</span>
<a href="#l27.62"></a><span id="l27.62">   mNewMessages(false),</span>
<a href="#l27.63"></a><span id="l27.63">   mGettingNewMessages(false),</span>
<a href="#l27.64"></a><span id="l27.64">   mLastMessageLoaded(nsMsgKey_None),</span>
<a href="#l27.65"></a><span id="l27.65">   mFlags(0),</span>
<a href="#l27.66"></a><span id="l27.66">   mNumUnreadMessages(-1),</span>
<a href="#l27.67"></a><span id="l27.67">   mNumTotalMessages(-1),</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineat">@@ -127,19 +160,16 @@ nsMsgDBFolder::nsMsgDBFolder(void)</span>
<a href="#l27.69"></a><span id="l27.69">   mFolderSize(kSizeUnknown),</span>
<a href="#l27.70"></a><span id="l27.70">   mNumNewBiffMessages(0),</span>
<a href="#l27.71"></a><span id="l27.71">   mHaveParsedURI(false),</span>
<a href="#l27.72"></a><span id="l27.72">   mIsServerIsValid(false),</span>
<a href="#l27.73"></a><span id="l27.73">   mIsServer(false),</span>
<a href="#l27.74"></a><span id="l27.74">   mInVFEditSearchScope (false)</span>
<a href="#l27.75"></a><span id="l27.75"> {</span>
<a href="#l27.76"></a><span id="l27.76">   if (mInstanceCount++ &lt;=0) {</span>
<a href="#l27.77"></a><span id="l27.77" class="difflineminus">-#define MSGDBFOLDER_ATOM(name_, value_) name_ = MsgNewAtom(value_).take();</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineminus">-#include &quot;nsMsgDBFolderAtomList.h&quot;</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineminus">-#undef MSGDBFOLDER_ATOM</span>
<a href="#l27.80"></a><span id="l27.80">     initializeStrings();</span>
<a href="#l27.81"></a><span id="l27.81">     createCollationKeyGenerator();</span>
<a href="#l27.82"></a><span id="l27.82">     gtimeOfLastPurgeCheck = 0;</span>
<a href="#l27.83"></a><span id="l27.83">   }</span>
<a href="#l27.84"></a><span id="l27.84"> </span>
<a href="#l27.85"></a><span id="l27.85">   mProcessingFlag[0].bit = nsMsgProcessingFlags::ClassifyJunk;</span>
<a href="#l27.86"></a><span id="l27.86">   mProcessingFlag[1].bit = nsMsgProcessingFlags::ClassifyTraits;</span>
<a href="#l27.87"></a><span id="l27.87">   mProcessingFlag[2].bit = nsMsgProcessingFlags::TraitsDone;</span>
<a href="#l27.88"></a><span id="l27.88" class="difflineat">@@ -152,20 +182,16 @@ nsMsgDBFolder::nsMsgDBFolder(void)</span>
<a href="#l27.89"></a><span id="l27.89"> </span>
<a href="#l27.90"></a><span id="l27.90"> nsMsgDBFolder::~nsMsgDBFolder(void)</span>
<a href="#l27.91"></a><span id="l27.91"> {</span>
<a href="#l27.92"></a><span id="l27.92">   for (uint32_t i = 0; i &lt; nsMsgProcessingFlags::NumberOfFlags; i++)</span>
<a href="#l27.93"></a><span id="l27.93">     delete mProcessingFlag[i].keys;</span>
<a href="#l27.94"></a><span id="l27.94"> </span>
<a href="#l27.95"></a><span id="l27.95">   if (--mInstanceCount == 0) {</span>
<a href="#l27.96"></a><span id="l27.96">     NS_IF_RELEASE(gCollationKeyGenerator);</span>
<a href="#l27.97"></a><span id="l27.97" class="difflineminus">-</span>
<a href="#l27.98"></a><span id="l27.98" class="difflineminus">-#define MSGDBFOLDER_ATOM(name_, value_) NS_RELEASE(name_);</span>
<a href="#l27.99"></a><span id="l27.99" class="difflineminus">-#include &quot;nsMsgDBFolderAtomList.h&quot;</span>
<a href="#l27.100"></a><span id="l27.100" class="difflineminus">-#undef MSGDBFOLDER_ATOM</span>
<a href="#l27.101"></a><span id="l27.101">   }</span>
<a href="#l27.102"></a><span id="l27.102">   //shutdown but don't shutdown children.</span>
<a href="#l27.103"></a><span id="l27.103">   Shutdown(false);</span>
<a href="#l27.104"></a><span id="l27.104"> }</span>
<a href="#l27.105"></a><span id="l27.105"> </span>
<a href="#l27.106"></a><span id="l27.106"> NS_IMETHODIMP nsMsgDBFolder::Shutdown(bool shutdownChildren)</span>
<a href="#l27.107"></a><span id="l27.107"> {</span>
<a href="#l27.108"></a><span id="l27.108">   if(mDatabase)</span>
<a href="#l27.109"></a><span id="l27.109" class="difflineat">@@ -455,17 +481,17 @@ NS_IMETHODIMP nsMsgDBFolder::SetHasNewMe</span>
<a href="#l27.110"></a><span id="l27.110">     // Only change mru time if we're going from doesn't have new to has new.</span>
<a href="#l27.111"></a><span id="l27.111">     // technically, we should probably update mru time for every new message</span>
<a href="#l27.112"></a><span id="l27.112">     // but we would pay a performance penalty for that. If the user</span>
<a href="#l27.113"></a><span id="l27.113">     // opens the folder, the mrutime will get updated anyway.</span>
<a href="#l27.114"></a><span id="l27.114">     if (curNewMessages)</span>
<a href="#l27.115"></a><span id="l27.115">       SetMRUTime();</span>
<a href="#l27.116"></a><span id="l27.116">     bool oldNewMessages = mNewMessages;</span>
<a href="#l27.117"></a><span id="l27.117">     mNewMessages = curNewMessages;</span>
<a href="#l27.118"></a><span id="l27.118" class="difflineminus">-    NotifyBoolPropertyChanged(kNewMessagesAtom, oldNewMessages, curNewMessages);</span>
<a href="#l27.119"></a><span id="l27.119" class="difflineplus">+    NotifyBoolPropertyChanged(kNewMessages, oldNewMessages, curNewMessages);</span>
<a href="#l27.120"></a><span id="l27.120">   }</span>
<a href="#l27.121"></a><span id="l27.121"> </span>
<a href="#l27.122"></a><span id="l27.122">   return NS_OK;</span>
<a href="#l27.123"></a><span id="l27.123"> }</span>
<a href="#l27.124"></a><span id="l27.124"> </span>
<a href="#l27.125"></a><span id="l27.125"> NS_IMETHODIMP nsMsgDBFolder::GetHasFolderOrSubfolderNewMessages(bool *aResult)</span>
<a href="#l27.126"></a><span id="l27.126"> {</span>
<a href="#l27.127"></a><span id="l27.127">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l27.128"></a><span id="l27.128" class="difflineat">@@ -684,24 +710,24 @@ nsresult nsMsgDBFolder::ReadDBFolderInfo</span>
<a href="#l27.129"></a><span id="l27.129"> </span>
<a href="#l27.130"></a><span id="l27.130"> nsresult nsMsgDBFolder::SendFlagNotifications(nsIMsgDBHdr *item, uint32_t oldFlags, uint32_t newFlags)</span>
<a href="#l27.131"></a><span id="l27.131"> {</span>
<a href="#l27.132"></a><span id="l27.132">   nsresult rv = NS_OK;</span>
<a href="#l27.133"></a><span id="l27.133">   uint32_t changedFlags = oldFlags ^ newFlags;</span>
<a href="#l27.134"></a><span id="l27.134">   if((changedFlags &amp; nsMsgMessageFlags::Read)  &amp;&amp; (changedFlags &amp; nsMsgMessageFlags::New))</span>
<a href="#l27.135"></a><span id="l27.135">   {</span>
<a href="#l27.136"></a><span id="l27.136">     //..so..if the msg is read in the folder and the folder has new msgs clear the account level and status bar biffs.</span>
<a href="#l27.137"></a><span id="l27.137" class="difflineminus">-    rv = NotifyPropertyFlagChanged(item, kStatusAtom, oldFlags, newFlags);</span>
<a href="#l27.138"></a><span id="l27.138" class="difflineplus">+    rv = NotifyPropertyFlagChanged(item, kStatus, oldFlags, newFlags);</span>
<a href="#l27.139"></a><span id="l27.139">     rv = SetBiffState(nsMsgBiffState_NoMail);</span>
<a href="#l27.140"></a><span id="l27.140">   }</span>
<a href="#l27.141"></a><span id="l27.141">   else if(changedFlags &amp; (nsMsgMessageFlags::Read | nsMsgMessageFlags::Replied | nsMsgMessageFlags::Forwarded</span>
<a href="#l27.142"></a><span id="l27.142">     | nsMsgMessageFlags::IMAPDeleted | nsMsgMessageFlags::New | nsMsgMessageFlags::Offline))</span>
<a href="#l27.143"></a><span id="l27.143" class="difflineminus">-    rv = NotifyPropertyFlagChanged(item, kStatusAtom, oldFlags, newFlags);</span>
<a href="#l27.144"></a><span id="l27.144" class="difflineplus">+    rv = NotifyPropertyFlagChanged(item, kStatus, oldFlags, newFlags);</span>
<a href="#l27.145"></a><span id="l27.145">   else if((changedFlags &amp; nsMsgMessageFlags::Marked))</span>
<a href="#l27.146"></a><span id="l27.146" class="difflineminus">-    rv = NotifyPropertyFlagChanged(item, kFlaggedAtom, oldFlags, newFlags);</span>
<a href="#l27.147"></a><span id="l27.147" class="difflineplus">+    rv = NotifyPropertyFlagChanged(item, kFlagged, oldFlags, newFlags);</span>
<a href="#l27.148"></a><span id="l27.148">   return rv;</span>
<a href="#l27.149"></a><span id="l27.149"> }</span>
<a href="#l27.150"></a><span id="l27.150"> </span>
<a href="#l27.151"></a><span id="l27.151"> NS_IMETHODIMP nsMsgDBFolder::DownloadMessagesForOffline(nsIArray *messages, nsIMsgWindow *)</span>
<a href="#l27.152"></a><span id="l27.152"> {</span>
<a href="#l27.153"></a><span id="l27.153">   NS_ASSERTION(false, &quot;imap and news need to override this&quot;);</span>
<a href="#l27.154"></a><span id="l27.154">   return NS_OK;</span>
<a href="#l27.155"></a><span id="l27.155"> }</span>
<a href="#l27.156"></a><span id="l27.156" class="difflineat">@@ -978,17 +1004,17 @@ nsMsgDBFolder::OnReadChanged(nsIDBChange</span>
<a href="#l27.157"></a><span id="l27.157"> {</span>
<a href="#l27.158"></a><span id="l27.158">   /* do nothing.  if you care about this, override it.  see nsNewsFolder.cpp */</span>
<a href="#l27.159"></a><span id="l27.159">   return NS_OK;</span>
<a href="#l27.160"></a><span id="l27.160"> }</span>
<a href="#l27.161"></a><span id="l27.161"> </span>
<a href="#l27.162"></a><span id="l27.162"> NS_IMETHODIMP</span>
<a href="#l27.163"></a><span id="l27.163"> nsMsgDBFolder::OnJunkScoreChanged(nsIDBChangeListener * aInstigator)</span>
<a href="#l27.164"></a><span id="l27.164"> {</span>
<a href="#l27.165"></a><span id="l27.165" class="difflineminus">-  NotifyFolderEvent(mJunkStatusChangedAtom);</span>
<a href="#l27.166"></a><span id="l27.166" class="difflineplus">+  NotifyFolderEvent(kJunkStatusChanged);</span>
<a href="#l27.167"></a><span id="l27.167">   return NS_OK;</span>
<a href="#l27.168"></a><span id="l27.168"> }</span>
<a href="#l27.169"></a><span id="l27.169"> </span>
<a href="#l27.170"></a><span id="l27.170"> NS_IMETHODIMP</span>
<a href="#l27.171"></a><span id="l27.171"> nsMsgDBFolder::OnHdrPropertyChanged(nsIMsgDBHdr *aHdrToChange, bool aPreChange, uint32_t *aStatus, </span>
<a href="#l27.172"></a><span id="l27.172">                                    nsIDBChangeListener *aInstigator)</span>
<a href="#l27.173"></a><span id="l27.173"> {</span>
<a href="#l27.174"></a><span id="l27.174">   /* do nothing.  if you care about this, override it.*/</span>
<a href="#l27.175"></a><span id="l27.175" class="difflineat">@@ -1497,17 +1523,17 @@ NS_IMETHODIMP</span>
<a href="#l27.176"></a><span id="l27.176"> nsMsgDBFolder::OnStopRunningUrl(nsIURI *aUrl, nsresult aExitCode)</span>
<a href="#l27.177"></a><span id="l27.177"> {</span>
<a href="#l27.178"></a><span id="l27.178">   NS_ENSURE_ARG_POINTER(aUrl);</span>
<a href="#l27.179"></a><span id="l27.179">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailUrl = do_QueryInterface(aUrl);</span>
<a href="#l27.180"></a><span id="l27.180">   if (mailUrl)</span>
<a href="#l27.181"></a><span id="l27.181">   {</span>
<a href="#l27.182"></a><span id="l27.182">     bool updatingFolder = false;</span>
<a href="#l27.183"></a><span id="l27.183">     if (NS_SUCCEEDED(mailUrl-&gt;GetUpdatingFolder(&amp;updatingFolder)) &amp;&amp; updatingFolder)</span>
<a href="#l27.184"></a><span id="l27.184" class="difflineminus">-      NotifyFolderEvent(mFolderLoadedAtom);</span>
<a href="#l27.185"></a><span id="l27.185" class="difflineplus">+      NotifyFolderEvent(kFolderLoaded);</span>
<a href="#l27.186"></a><span id="l27.186"> </span>
<a href="#l27.187"></a><span id="l27.187">     // be sure to remove ourselves as a url listener</span>
<a href="#l27.188"></a><span id="l27.188">     mailUrl-&gt;UnRegisterListener(this);</span>
<a href="#l27.189"></a><span id="l27.189">   }</span>
<a href="#l27.190"></a><span id="l27.190">   return NS_OK;</span>
<a href="#l27.191"></a><span id="l27.191"> }</span>
<a href="#l27.192"></a><span id="l27.192"> </span>
<a href="#l27.193"></a><span id="l27.193"> NS_IMETHODIMP</span>
<a href="#l27.194"></a><span id="l27.194" class="difflineat">@@ -1944,18 +1970,17 @@ nsresult nsMsgDBFolder::HandleAutoCompac</span>
<a href="#l27.195"></a><span id="l27.195">               branch-&gt;SetBoolPref(PREF_MAIL_PURGE_ASK, false);</span>
<a href="#l27.196"></a><span id="l27.196">           }</span>
<a href="#l27.197"></a><span id="l27.197">         }</span>
<a href="#l27.198"></a><span id="l27.198">         else</span>
<a href="#l27.199"></a><span id="l27.199">           okToCompact = aWindow || !askBeforePurge;</span>
<a href="#l27.200"></a><span id="l27.200"> </span>
<a href="#l27.201"></a><span id="l27.201">         if (okToCompact)</span>
<a href="#l27.202"></a><span id="l27.202">         {</span>
<a href="#l27.203"></a><span id="l27.203" class="difflineminus">-          nsCOMPtr &lt;nsIAtom&gt; aboutToCompactAtom = MsgGetAtom(&quot;AboutToCompact&quot;);</span>
<a href="#l27.204"></a><span id="l27.204" class="difflineminus">-          NotifyFolderEvent(aboutToCompactAtom);</span>
<a href="#l27.205"></a><span id="l27.205" class="difflineplus">+          NotifyFolderEvent(kAboutToCompact);</span>
<a href="#l27.206"></a><span id="l27.206"> </span>
<a href="#l27.207"></a><span id="l27.207">          if (localExpungedBytes &gt; 0)</span>
<a href="#l27.208"></a><span id="l27.208">          {</span>
<a href="#l27.209"></a><span id="l27.209">             nsCOMPtr&lt;nsIMsgFolderCompactor&gt; folderCompactor =</span>
<a href="#l27.210"></a><span id="l27.210">               do_CreateInstance(NS_MSGLOCALFOLDERCOMPACTOR_CONTRACTID, &amp;rv);</span>
<a href="#l27.211"></a><span id="l27.211">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.212"></a><span id="l27.212"> </span>
<a href="#l27.213"></a><span id="l27.213">             if (offlineExpungedBytes &gt; 0)</span>
<a href="#l27.214"></a><span id="l27.214" class="difflineat">@@ -3430,17 +3455,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetName(nsA</span>
<a href="#l27.215"></a><span id="l27.215"> </span>
<a href="#l27.216"></a><span id="l27.216"> NS_IMETHODIMP nsMsgDBFolder::SetName(const nsAString&amp; name)</span>
<a href="#l27.217"></a><span id="l27.217"> {</span>
<a href="#l27.218"></a><span id="l27.218">   // override the URI-generated name</span>
<a href="#l27.219"></a><span id="l27.219">   if (!mName.Equals(name))</span>
<a href="#l27.220"></a><span id="l27.220">   {</span>
<a href="#l27.221"></a><span id="l27.221">     mName = name;</span>
<a href="#l27.222"></a><span id="l27.222">     // old/new value doesn't matter here</span>
<a href="#l27.223"></a><span id="l27.223" class="difflineminus">-    NotifyUnicharPropertyChanged(kNameAtom, name, name);</span>
<a href="#l27.224"></a><span id="l27.224" class="difflineplus">+    NotifyUnicharPropertyChanged(kName, name, name);</span>
<a href="#l27.225"></a><span id="l27.225">   }</span>
<a href="#l27.226"></a><span id="l27.226">   return NS_OK;</span>
<a href="#l27.227"></a><span id="l27.227"> }</span>
<a href="#l27.228"></a><span id="l27.228"> </span>
<a href="#l27.229"></a><span id="l27.229"> //For default, just return name</span>
<a href="#l27.230"></a><span id="l27.230"> NS_IMETHODIMP nsMsgDBFolder::GetAbbreviatedName(nsAString&amp; aAbbreviatedName)</span>
<a href="#l27.231"></a><span id="l27.231"> {</span>
<a href="#l27.232"></a><span id="l27.232">   return GetName(aAbbreviatedName);</span>
<a href="#l27.233"></a><span id="l27.233" class="difflineat">@@ -3981,17 +4006,16 @@ nsresult nsMsgDBFolder::GetBackupSummary</span>
<a href="#l27.234"></a><span id="l27.234"> </span>
<a href="#l27.235"></a><span id="l27.235">   backupDBFile.swap(*aBackupFile);</span>
<a href="#l27.236"></a><span id="l27.236">   return NS_OK;</span>
<a href="#l27.237"></a><span id="l27.237"> }</span>
<a href="#l27.238"></a><span id="l27.238"> </span>
<a href="#l27.239"></a><span id="l27.239"> NS_IMETHODIMP nsMsgDBFolder::Rename(const nsAString&amp; aNewName, nsIMsgWindow *msgWindow)</span>
<a href="#l27.240"></a><span id="l27.240"> {</span>
<a href="#l27.241"></a><span id="l27.241">   nsCOMPtr&lt;nsIFile&gt; oldPathFile;</span>
<a href="#l27.242"></a><span id="l27.242" class="difflineminus">-  nsCOMPtr&lt;nsIAtom&gt; folderRenameAtom;</span>
<a href="#l27.243"></a><span id="l27.243">   nsresult rv = GetFilePath(getter_AddRefs(oldPathFile));</span>
<a href="#l27.244"></a><span id="l27.244">   if (NS_FAILED(rv))</span>
<a href="#l27.245"></a><span id="l27.245">     return rv;</span>
<a href="#l27.246"></a><span id="l27.246">   nsCOMPtr&lt;nsIMsgFolder&gt; parentFolder;</span>
<a href="#l27.247"></a><span id="l27.247">   rv = GetParent(getter_AddRefs(parentFolder));</span>
<a href="#l27.248"></a><span id="l27.248">   if (!parentFolder)</span>
<a href="#l27.249"></a><span id="l27.249">     return NS_ERROR_FAILURE;</span>
<a href="#l27.250"></a><span id="l27.250">   nsCOMPtr&lt;nsISupports&gt; parentSupport = do_QueryInterface(parentFolder);</span>
<a href="#l27.251"></a><span id="l27.251" class="difflineat">@@ -4071,18 +4095,17 @@ NS_IMETHODIMP nsMsgDBFolder::Rename(cons</span>
<a href="#l27.252"></a><span id="l27.252">         newFolder-&gt;RenameSubFolders(msgWindow, this);</span>
<a href="#l27.253"></a><span id="l27.253"> </span>
<a href="#l27.254"></a><span id="l27.254">       if (parentFolder)</span>
<a href="#l27.255"></a><span id="l27.255">       {</span>
<a href="#l27.256"></a><span id="l27.256">         SetParent(nullptr);</span>
<a href="#l27.257"></a><span id="l27.257">         parentFolder-&gt;PropagateDelete(this, false, msgWindow);</span>
<a href="#l27.258"></a><span id="l27.258">         parentFolder-&gt;NotifyItemAdded(newFolder);</span>
<a href="#l27.259"></a><span id="l27.259">       }</span>
<a href="#l27.260"></a><span id="l27.260" class="difflineminus">-      folderRenameAtom = MsgGetAtom(&quot;RenameCompleted&quot;);</span>
<a href="#l27.261"></a><span id="l27.261" class="difflineminus">-      newFolder-&gt;NotifyFolderEvent(folderRenameAtom);</span>
<a href="#l27.262"></a><span id="l27.262" class="difflineplus">+      newFolder-&gt;NotifyFolderEvent(kRenameCompleted);</span>
<a href="#l27.263"></a><span id="l27.263">     }</span>
<a href="#l27.264"></a><span id="l27.264">   }</span>
<a href="#l27.265"></a><span id="l27.265">   return rv;</span>
<a href="#l27.266"></a><span id="l27.266"> }</span>
<a href="#l27.267"></a><span id="l27.267"> </span>
<a href="#l27.268"></a><span id="l27.268"> NS_IMETHODIMP nsMsgDBFolder::RenameSubFolders(nsIMsgWindow *msgWindow, nsIMsgFolder *oldFolder)</span>
<a href="#l27.269"></a><span id="l27.269"> {</span>
<a href="#l27.270"></a><span id="l27.270">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l27.271"></a><span id="l27.271" class="difflineat">@@ -4156,20 +4179,20 @@ NS_IMETHODIMP nsMsgDBFolder::UpdateSumma</span>
<a href="#l27.272"></a><span id="l27.272">   </span>
<a href="#l27.273"></a><span id="l27.273">   if (NS_SUCCEEDED(rv))</span>
<a href="#l27.274"></a><span id="l27.274">   {</span>
<a href="#l27.275"></a><span id="l27.275">     int32_t newUnreadMessages = mNumUnreadMessages + mNumPendingUnreadMessages;</span>
<a href="#l27.276"></a><span id="l27.276">     int32_t newTotalMessages = mNumTotalMessages + mNumPendingTotalMessages;</span>
<a href="#l27.277"></a><span id="l27.277"> </span>
<a href="#l27.278"></a><span id="l27.278">     //Need to notify listeners that total count changed.</span>
<a href="#l27.279"></a><span id="l27.279">     if(oldTotalMessages != newTotalMessages)</span>
<a href="#l27.280"></a><span id="l27.280" class="difflineminus">-      NotifyIntPropertyChanged(kTotalMessagesAtom, oldTotalMessages, newTotalMessages);</span>
<a href="#l27.281"></a><span id="l27.281" class="difflineplus">+      NotifyIntPropertyChanged(kTotalMessages, oldTotalMessages, newTotalMessages);</span>
<a href="#l27.282"></a><span id="l27.282"> </span>
<a href="#l27.283"></a><span id="l27.283">     if(oldUnreadMessages != newUnreadMessages)</span>
<a href="#l27.284"></a><span id="l27.284" class="difflineminus">-      NotifyIntPropertyChanged(kTotalUnreadMessagesAtom, oldUnreadMessages, newUnreadMessages);</span>
<a href="#l27.285"></a><span id="l27.285" class="difflineplus">+      NotifyIntPropertyChanged(kTotalUnreadMessages, oldUnreadMessages, newUnreadMessages);</span>
<a href="#l27.286"></a><span id="l27.286"> </span>
<a href="#l27.287"></a><span id="l27.287">     FlushToFolderCache();</span>
<a href="#l27.288"></a><span id="l27.288">   }</span>
<a href="#l27.289"></a><span id="l27.289">   return rv;</span>
<a href="#l27.290"></a><span id="l27.290"> }</span>
<a href="#l27.291"></a><span id="l27.291"> </span>
<a href="#l27.292"></a><span id="l27.292"> NS_IMETHODIMP nsMsgDBFolder::SummaryChanged()</span>
<a href="#l27.293"></a><span id="l27.293"> {</span>
<a href="#l27.294"></a><span id="l27.294" class="difflineat">@@ -4261,17 +4284,17 @@ NS_IMETHODIMP nsMsgDBFolder::ChangeNumPe</span>
<a href="#l27.295"></a><span id="l27.295">     NS_ASSERTION(newUnreadMessages &gt;= 0, &quot;shouldn't have negative unread message count&quot;);</span>
<a href="#l27.296"></a><span id="l27.296">     if (newUnreadMessages &gt;= 0)</span>
<a href="#l27.297"></a><span id="l27.297">     {</span>
<a href="#l27.298"></a><span id="l27.298">       nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l27.299"></a><span id="l27.299">       nsCOMPtr&lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l27.300"></a><span id="l27.300">       nsresult rv = GetDBFolderInfoAndDB(getter_AddRefs(folderInfo), getter_AddRefs(db));</span>
<a href="#l27.301"></a><span id="l27.301">       if (NS_SUCCEEDED(rv) &amp;&amp; folderInfo)</span>
<a href="#l27.302"></a><span id="l27.302">         folderInfo-&gt;SetImapUnreadPendingMessages(mNumPendingUnreadMessages);</span>
<a href="#l27.303"></a><span id="l27.303" class="difflineminus">-      NotifyIntPropertyChanged(kTotalUnreadMessagesAtom, oldUnreadMessages, newUnreadMessages);</span>
<a href="#l27.304"></a><span id="l27.304" class="difflineplus">+      NotifyIntPropertyChanged(kTotalUnreadMessages, oldUnreadMessages, newUnreadMessages);</span>
<a href="#l27.305"></a><span id="l27.305">     }</span>
<a href="#l27.306"></a><span id="l27.306">   }</span>
<a href="#l27.307"></a><span id="l27.307">   return NS_OK;</span>
<a href="#l27.308"></a><span id="l27.308"> }</span>
<a href="#l27.309"></a><span id="l27.309"> </span>
<a href="#l27.310"></a><span id="l27.310"> NS_IMETHODIMP nsMsgDBFolder::ChangeNumPendingTotalMessages(int32_t delta)</span>
<a href="#l27.311"></a><span id="l27.311"> {</span>
<a href="#l27.312"></a><span id="l27.312">   if (delta)</span>
<a href="#l27.313"></a><span id="l27.313" class="difflineat">@@ -4280,17 +4303,17 @@ NS_IMETHODIMP nsMsgDBFolder::ChangeNumPe</span>
<a href="#l27.314"></a><span id="l27.314">     mNumPendingTotalMessages += delta;</span>
<a href="#l27.315"></a><span id="l27.315">     int32_t newTotalMessages = mNumTotalMessages + mNumPendingTotalMessages;</span>
<a href="#l27.316"></a><span id="l27.316"> </span>
<a href="#l27.317"></a><span id="l27.317">     nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l27.318"></a><span id="l27.318">     nsCOMPtr&lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l27.319"></a><span id="l27.319">     nsresult rv = GetDBFolderInfoAndDB(getter_AddRefs(folderInfo), getter_AddRefs(db));</span>
<a href="#l27.320"></a><span id="l27.320">     if (NS_SUCCEEDED(rv) &amp;&amp; folderInfo)</span>
<a href="#l27.321"></a><span id="l27.321">       folderInfo-&gt;SetImapTotalPendingMessages(mNumPendingTotalMessages);</span>
<a href="#l27.322"></a><span id="l27.322" class="difflineminus">-    NotifyIntPropertyChanged(kTotalMessagesAtom, oldTotalMessages, newTotalMessages);</span>
<a href="#l27.323"></a><span id="l27.323" class="difflineplus">+    NotifyIntPropertyChanged(kTotalMessages, oldTotalMessages, newTotalMessages);</span>
<a href="#l27.324"></a><span id="l27.324">   }</span>
<a href="#l27.325"></a><span id="l27.325">   return NS_OK;</span>
<a href="#l27.326"></a><span id="l27.326"> }</span>
<a href="#l27.327"></a><span id="l27.327"> </span>
<a href="#l27.328"></a><span id="l27.328"> NS_IMETHODIMP nsMsgDBFolder::SetFlag(uint32_t flag)</span>
<a href="#l27.329"></a><span id="l27.329"> {</span>
<a href="#l27.330"></a><span id="l27.330">   // If calling this function causes us to open the db (i.e., it was not</span>
<a href="#l27.331"></a><span id="l27.331">   // open before), we're going to close the db before returning.</span>
<a href="#l27.332"></a><span id="l27.332" class="difflineat">@@ -4360,29 +4383,29 @@ NS_IMETHODIMP nsMsgDBFolder::OnFlagChang</span>
<a href="#l27.333"></a><span id="l27.333">      rv = GetName(name);</span>
<a href="#l27.334"></a><span id="l27.334">      NS_ASSERTION(Compare(name, kLocalizedTrashName) || (mFlags &amp; nsMsgFolderFlags::Trash), &quot;lost trash flag&quot;);</span>
<a href="#l27.335"></a><span id="l27.335"> #endif</span>
<a href="#l27.336"></a><span id="l27.336">     folderInfo-&gt;SetFlags((int32_t) mFlags);</span>
<a href="#l27.337"></a><span id="l27.337">     if (db)</span>
<a href="#l27.338"></a><span id="l27.338">       db-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l27.339"></a><span id="l27.339"> </span>
<a href="#l27.340"></a><span id="l27.340">     if (mFlags &amp; flag)</span>
<a href="#l27.341"></a><span id="l27.341" class="difflineminus">-      NotifyIntPropertyChanged(mFolderFlagAtom, mFlags &amp; ~flag, mFlags);</span>
<a href="#l27.342"></a><span id="l27.342" class="difflineplus">+      NotifyIntPropertyChanged(kFolderFlag, mFlags &amp; ~flag, mFlags);</span>
<a href="#l27.343"></a><span id="l27.343">     else</span>
<a href="#l27.344"></a><span id="l27.344" class="difflineminus">-      NotifyIntPropertyChanged(mFolderFlagAtom, mFlags | flag, mFlags);</span>
<a href="#l27.345"></a><span id="l27.345" class="difflineplus">+      NotifyIntPropertyChanged(kFolderFlag, mFlags | flag, mFlags);</span>
<a href="#l27.346"></a><span id="l27.346"> </span>
<a href="#l27.347"></a><span id="l27.347">     if (flag &amp; nsMsgFolderFlags::Offline)</span>
<a href="#l27.348"></a><span id="l27.348">     {</span>
<a href="#l27.349"></a><span id="l27.349">       bool newValue = mFlags &amp; nsMsgFolderFlags::Offline;</span>
<a href="#l27.350"></a><span id="l27.350" class="difflineminus">-      rv = NotifyBoolPropertyChanged(kSynchronizeAtom, !newValue, !!newValue);</span>
<a href="#l27.351"></a><span id="l27.351" class="difflineplus">+      rv = NotifyBoolPropertyChanged(kSynchronize, !newValue, !!newValue);</span>
<a href="#l27.352"></a><span id="l27.352">     }</span>
<a href="#l27.353"></a><span id="l27.353">     else if (flag &amp; nsMsgFolderFlags::Elided)</span>
<a href="#l27.354"></a><span id="l27.354">     {</span>
<a href="#l27.355"></a><span id="l27.355">       bool newValue = mFlags &amp; nsMsgFolderFlags::Elided;</span>
<a href="#l27.356"></a><span id="l27.356" class="difflineminus">-      rv = NotifyBoolPropertyChanged(kOpenAtom, !!newValue, !newValue);</span>
<a href="#l27.357"></a><span id="l27.357" class="difflineplus">+      rv = NotifyBoolPropertyChanged(kOpen, !!newValue, !newValue);</span>
<a href="#l27.358"></a><span id="l27.358">     }</span>
<a href="#l27.359"></a><span id="l27.359">   }</span>
<a href="#l27.360"></a><span id="l27.360">   return rv;</span>
<a href="#l27.361"></a><span id="l27.361"> }</span>
<a href="#l27.362"></a><span id="l27.362"> </span>
<a href="#l27.363"></a><span id="l27.363"> NS_IMETHODIMP nsMsgDBFolder::SetFlags(uint32_t aFlags)</span>
<a href="#l27.364"></a><span id="l27.364"> {</span>
<a href="#l27.365"></a><span id="l27.365">   if (mFlags != aFlags)</span>
<a href="#l27.366"></a><span id="l27.366" class="difflineat">@@ -4528,17 +4551,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetSizeOnDi</span>
<a href="#l27.367"></a><span id="l27.367"> {</span>
<a href="#l27.368"></a><span id="l27.368">   NS_ENSURE_ARG_POINTER(size);</span>
<a href="#l27.369"></a><span id="l27.369">   *size = kSizeUnknown;</span>
<a href="#l27.370"></a><span id="l27.370">   return NS_OK;</span>
<a href="#l27.371"></a><span id="l27.371"> }</span>
<a href="#l27.372"></a><span id="l27.372"> </span>
<a href="#l27.373"></a><span id="l27.373"> NS_IMETHODIMP nsMsgDBFolder::SetSizeOnDisk(int64_t aSizeOnDisk)</span>
<a href="#l27.374"></a><span id="l27.374"> {</span>
<a href="#l27.375"></a><span id="l27.375" class="difflineminus">-  NotifyIntPropertyChanged(kFolderSizeAtom, mFolderSize, aSizeOnDisk);</span>
<a href="#l27.376"></a><span id="l27.376" class="difflineplus">+  NotifyIntPropertyChanged(kFolderSize, mFolderSize, aSizeOnDisk);</span>
<a href="#l27.377"></a><span id="l27.377">   mFolderSize = aSizeOnDisk;</span>
<a href="#l27.378"></a><span id="l27.378">   return NS_OK;</span>
<a href="#l27.379"></a><span id="l27.379"> }</span>
<a href="#l27.380"></a><span id="l27.380"> </span>
<a href="#l27.381"></a><span id="l27.381"> NS_IMETHODIMP nsMsgDBFolder::GetUsername(nsACString&amp; userName)</span>
<a href="#l27.382"></a><span id="l27.382"> {</span>
<a href="#l27.383"></a><span id="l27.383">   nsresult rv;</span>
<a href="#l27.384"></a><span id="l27.384">   nsCOMPtr &lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l27.385"></a><span id="l27.385" class="difflineat">@@ -4585,24 +4608,24 @@ NS_IMETHODIMP nsMsgDBFolder::SetBiffStat</span>
<a href="#l27.386"></a><span id="l27.386">       nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l27.387"></a><span id="l27.387">       rv = GetRootFolder(getter_AddRefs(folder));</span>
<a href="#l27.388"></a><span id="l27.388">       if (NS_SUCCEEDED(rv) &amp;&amp; folder)</span>
<a href="#l27.389"></a><span id="l27.389">         return folder-&gt;SetBiffState(aBiffState);</span>
<a href="#l27.390"></a><span id="l27.390">     }</span>
<a href="#l27.391"></a><span id="l27.391">     if (server)</span>
<a href="#l27.392"></a><span id="l27.392">       server-&gt;SetBiffState(aBiffState);</span>
<a href="#l27.393"></a><span id="l27.393"> </span>
<a href="#l27.394"></a><span id="l27.394" class="difflineminus">-    NotifyIntPropertyChanged(kBiffStateAtom, oldBiffState, aBiffState);</span>
<a href="#l27.395"></a><span id="l27.395" class="difflineplus">+    NotifyIntPropertyChanged(kBiffState, oldBiffState, aBiffState);</span>
<a href="#l27.396"></a><span id="l27.396">   }</span>
<a href="#l27.397"></a><span id="l27.397">   else if (aBiffState == oldBiffState &amp;&amp; aBiffState == nsMsgBiffState_NewMail)</span>
<a href="#l27.398"></a><span id="l27.398">   {</span>
<a href="#l27.399"></a><span id="l27.399">     // The folder has been updated, so update the MRUTime</span>
<a href="#l27.400"></a><span id="l27.400">     SetMRUTime();</span>
<a href="#l27.401"></a><span id="l27.401">     // biff is already set, but notify that there is additional new mail for the folder</span>
<a href="#l27.402"></a><span id="l27.402" class="difflineminus">-    NotifyIntPropertyChanged(kNewMailReceivedAtom, 0, mNumNewBiffMessages);</span>
<a href="#l27.403"></a><span id="l27.403" class="difflineplus">+    NotifyIntPropertyChanged(kNewMailReceived, 0, mNumNewBiffMessages);</span>
<a href="#l27.404"></a><span id="l27.404">   }</span>
<a href="#l27.405"></a><span id="l27.405">   else if (aBiffState == nsMsgBiffState_NoMail)</span>
<a href="#l27.406"></a><span id="l27.406">   {</span>
<a href="#l27.407"></a><span id="l27.407">     // even if the old biff state equals the new biff state, it is still possible that we've never</span>
<a href="#l27.408"></a><span id="l27.408">     // cleared the number of new messages for this particular folder. This happens when the new mail state</span>
<a href="#l27.409"></a><span id="l27.409">     // got cleared by viewing a new message in folder that is different from this one. Biff state is stored per server</span>
<a href="#l27.410"></a><span id="l27.410">     //  the num. of new messages is per folder.</span>
<a href="#l27.411"></a><span id="l27.411">     SetNumNewMessages(0);</span>
<a href="#l27.412"></a><span id="l27.412" class="difflineat">@@ -4637,17 +4660,17 @@ NS_IMETHODIMP nsMsgDBFolder::SetNumNewMe</span>
<a href="#l27.413"></a><span id="l27.413">   {</span>
<a href="#l27.414"></a><span id="l27.414">     int32_t oldNumMessages = mNumNewBiffMessages;</span>
<a href="#l27.415"></a><span id="l27.415">     mNumNewBiffMessages = aNumNewMessages;</span>
<a href="#l27.416"></a><span id="l27.416"> </span>
<a href="#l27.417"></a><span id="l27.417">     nsAutoCString oldNumMessagesStr;</span>
<a href="#l27.418"></a><span id="l27.418">     oldNumMessagesStr.AppendInt(oldNumMessages);</span>
<a href="#l27.419"></a><span id="l27.419">     nsAutoCString newNumMessagesStr;</span>
<a href="#l27.420"></a><span id="l27.420">     newNumMessagesStr.AppendInt(aNumNewMessages);</span>
<a href="#l27.421"></a><span id="l27.421" class="difflineminus">-    NotifyPropertyChanged(kNumNewBiffMessagesAtom, oldNumMessagesStr, newNumMessagesStr);</span>
<a href="#l27.422"></a><span id="l27.422" class="difflineplus">+    NotifyPropertyChanged(kNumNewBiffMessages, oldNumMessagesStr, newNumMessagesStr);</span>
<a href="#l27.423"></a><span id="l27.423">   }</span>
<a href="#l27.424"></a><span id="l27.424">   return NS_OK;</span>
<a href="#l27.425"></a><span id="l27.425"> }</span>
<a href="#l27.426"></a><span id="l27.426"> </span>
<a href="#l27.427"></a><span id="l27.427"> NS_IMETHODIMP nsMsgDBFolder::GetRootFolder(nsIMsgFolder * *aRootFolder)</span>
<a href="#l27.428"></a><span id="l27.428"> {</span>
<a href="#l27.429"></a><span id="l27.429">   NS_ENSURE_ARG_POINTER(aRootFolder);</span>
<a href="#l27.430"></a><span id="l27.430">   nsresult rv;</span>
<a href="#l27.431"></a><span id="l27.431" class="difflineat">@@ -4886,17 +4909,17 @@ NS_IMETHODIMP nsMsgDBFolder::CopyDataToO</span>
<a href="#l27.432"></a><span id="l27.432"> }</span>
<a href="#l27.433"></a><span id="l27.433"> </span>
<a href="#l27.434"></a><span id="l27.434"> NS_IMETHODIMP nsMsgDBFolder::CopyDataDone()</span>
<a href="#l27.435"></a><span id="l27.435"> {</span>
<a href="#l27.436"></a><span id="l27.436">   return NS_OK;</span>
<a href="#l27.437"></a><span id="l27.437"> }</span>
<a href="#l27.438"></a><span id="l27.438"> </span>
<a href="#l27.439"></a><span id="l27.439"> NS_IMETHODIMP</span>
<a href="#l27.440"></a><span id="l27.440" class="difflineminus">-nsMsgDBFolder::NotifyPropertyChanged(nsIAtom *aProperty,</span>
<a href="#l27.441"></a><span id="l27.441" class="difflineplus">+nsMsgDBFolder::NotifyPropertyChanged(const nsACString &amp;aProperty,</span>
<a href="#l27.442"></a><span id="l27.442">                                      const nsACString&amp; aOldValue,</span>
<a href="#l27.443"></a><span id="l27.443">                                      const nsACString&amp; aNewValue)</span>
<a href="#l27.444"></a><span id="l27.444"> {</span>
<a href="#l27.445"></a><span id="l27.445">   NS_OBSERVER_ARRAY_NOTIFY_OBSERVERS(mListeners, nsIFolderListener,</span>
<a href="#l27.446"></a><span id="l27.446">                                      OnItemPropertyChanged,</span>
<a href="#l27.447"></a><span id="l27.447">                                      (this, aProperty,</span>
<a href="#l27.448"></a><span id="l27.448">                                       nsCString(aOldValue).get(),</span>
<a href="#l27.449"></a><span id="l27.449">                                       nsCString(aNewValue).get()));</span>
<a href="#l27.450"></a><span id="l27.450" class="difflineat">@@ -4907,17 +4930,17 @@ nsMsgDBFolder::NotifyPropertyChanged(nsI</span>
<a href="#l27.451"></a><span id="l27.451">            do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l27.452"></a><span id="l27.452">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.453"></a><span id="l27.453">   return folderListenerManager-&gt;OnItemPropertyChanged(this, aProperty,</span>
<a href="#l27.454"></a><span id="l27.454">                                                       nsCString(aOldValue).get(),</span>
<a href="#l27.455"></a><span id="l27.455">                                                       nsCString(aNewValue).get());</span>
<a href="#l27.456"></a><span id="l27.456"> }</span>
<a href="#l27.457"></a><span id="l27.457"> </span>
<a href="#l27.458"></a><span id="l27.458"> NS_IMETHODIMP</span>
<a href="#l27.459"></a><span id="l27.459" class="difflineminus">-nsMsgDBFolder::NotifyUnicharPropertyChanged(nsIAtom *aProperty,</span>
<a href="#l27.460"></a><span id="l27.460" class="difflineplus">+nsMsgDBFolder::NotifyUnicharPropertyChanged(const nsACString &amp;aProperty,</span>
<a href="#l27.461"></a><span id="l27.461">                                           const nsAString&amp; aOldValue,</span>
<a href="#l27.462"></a><span id="l27.462">                                           const nsAString&amp; aNewValue)</span>
<a href="#l27.463"></a><span id="l27.463"> {</span>
<a href="#l27.464"></a><span id="l27.464">   NS_OBSERVER_ARRAY_NOTIFY_OBSERVERS(mListeners, nsIFolderListener,</span>
<a href="#l27.465"></a><span id="l27.465">                                      OnItemUnicharPropertyChanged,</span>
<a href="#l27.466"></a><span id="l27.466">                                      (this, aProperty,</span>
<a href="#l27.467"></a><span id="l27.467">                                       nsString(aOldValue).get(),</span>
<a href="#l27.468"></a><span id="l27.468">                                       nsString(aNewValue).get()));</span>
<a href="#l27.469"></a><span id="l27.469" class="difflineat">@@ -4929,57 +4952,57 @@ nsMsgDBFolder::NotifyUnicharPropertyChan</span>
<a href="#l27.470"></a><span id="l27.470">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.471"></a><span id="l27.471">   return folderListenerManager-&gt;OnItemUnicharPropertyChanged(this,</span>
<a href="#l27.472"></a><span id="l27.472">                                                  aProperty,</span>
<a href="#l27.473"></a><span id="l27.473">                                                  nsString(aOldValue).get(),</span>
<a href="#l27.474"></a><span id="l27.474">                                                  nsString(aNewValue).get());</span>
<a href="#l27.475"></a><span id="l27.475"> }</span>
<a href="#l27.476"></a><span id="l27.476"> </span>
<a href="#l27.477"></a><span id="l27.477"> NS_IMETHODIMP</span>
<a href="#l27.478"></a><span id="l27.478" class="difflineminus">-nsMsgDBFolder::NotifyIntPropertyChanged(nsIAtom *aProperty, int64_t aOldValue,</span>
<a href="#l27.479"></a><span id="l27.479" class="difflineplus">+nsMsgDBFolder::NotifyIntPropertyChanged(const nsACString &amp;aProperty, int64_t aOldValue,</span>
<a href="#l27.480"></a><span id="l27.480">                                         int64_t aNewValue)</span>
<a href="#l27.481"></a><span id="l27.481"> {</span>
<a href="#l27.482"></a><span id="l27.482">   // Don't send off count notifications if they are turned off.</span>
<a href="#l27.483"></a><span id="l27.483">   if (!mNotifyCountChanges &amp;&amp;</span>
<a href="#l27.484"></a><span id="l27.484" class="difflineminus">-      ((aProperty == kTotalMessagesAtom) ||</span>
<a href="#l27.485"></a><span id="l27.485" class="difflineminus">-       (aProperty == kTotalUnreadMessagesAtom)))</span>
<a href="#l27.486"></a><span id="l27.486" class="difflineplus">+      (aProperty.Equals(kTotalMessages)  ||</span>
<a href="#l27.487"></a><span id="l27.487" class="difflineplus">+       aProperty.Equals(kTotalUnreadMessages)))</span>
<a href="#l27.488"></a><span id="l27.488">     return NS_OK;</span>
<a href="#l27.489"></a><span id="l27.489"> </span>
<a href="#l27.490"></a><span id="l27.490">   NS_OBSERVER_ARRAY_NOTIFY_OBSERVERS(mListeners, nsIFolderListener,</span>
<a href="#l27.491"></a><span id="l27.491">                                      OnItemIntPropertyChanged,</span>
<a href="#l27.492"></a><span id="l27.492">                                      (this, aProperty, aOldValue, aNewValue));</span>
<a href="#l27.493"></a><span id="l27.493"> </span>
<a href="#l27.494"></a><span id="l27.494">   // Notify listeners who listen to every folder</span>
<a href="#l27.495"></a><span id="l27.495">   nsresult rv;</span>
<a href="#l27.496"></a><span id="l27.496">   nsCOMPtr&lt;nsIFolderListener&gt; folderListenerManager =</span>
<a href="#l27.497"></a><span id="l27.497">            do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l27.498"></a><span id="l27.498">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.499"></a><span id="l27.499">   return folderListenerManager-&gt;OnItemIntPropertyChanged(this, aProperty,</span>
<a href="#l27.500"></a><span id="l27.500">                                                          aOldValue, aNewValue);</span>
<a href="#l27.501"></a><span id="l27.501"> }</span>
<a href="#l27.502"></a><span id="l27.502"> </span>
<a href="#l27.503"></a><span id="l27.503"> NS_IMETHODIMP</span>
<a href="#l27.504"></a><span id="l27.504" class="difflineminus">-nsMsgDBFolder::NotifyBoolPropertyChanged(nsIAtom* aProperty,</span>
<a href="#l27.505"></a><span id="l27.505" class="difflineplus">+nsMsgDBFolder::NotifyBoolPropertyChanged(const nsACString &amp;aProperty,</span>
<a href="#l27.506"></a><span id="l27.506">                                          bool aOldValue, bool aNewValue)</span>
<a href="#l27.507"></a><span id="l27.507"> {</span>
<a href="#l27.508"></a><span id="l27.508">   NS_OBSERVER_ARRAY_NOTIFY_OBSERVERS(mListeners, nsIFolderListener,</span>
<a href="#l27.509"></a><span id="l27.509">                                      OnItemBoolPropertyChanged,</span>
<a href="#l27.510"></a><span id="l27.510">                                      (this, aProperty, aOldValue, aNewValue));</span>
<a href="#l27.511"></a><span id="l27.511"> </span>
<a href="#l27.512"></a><span id="l27.512">   // Notify listeners who listen to every folder</span>
<a href="#l27.513"></a><span id="l27.513">   nsresult rv;</span>
<a href="#l27.514"></a><span id="l27.514">   nsCOMPtr&lt;nsIFolderListener&gt; folderListenerManager =</span>
<a href="#l27.515"></a><span id="l27.515">            do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l27.516"></a><span id="l27.516">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.517"></a><span id="l27.517">   return folderListenerManager-&gt;OnItemBoolPropertyChanged(this, aProperty,</span>
<a href="#l27.518"></a><span id="l27.518">                                                           aOldValue, aNewValue);</span>
<a href="#l27.519"></a><span id="l27.519"> }</span>
<a href="#l27.520"></a><span id="l27.520"> </span>
<a href="#l27.521"></a><span id="l27.521"> NS_IMETHODIMP</span>
<a href="#l27.522"></a><span id="l27.522" class="difflineminus">-nsMsgDBFolder::NotifyPropertyFlagChanged(nsIMsgDBHdr *aItem, nsIAtom *aProperty,</span>
<a href="#l27.523"></a><span id="l27.523" class="difflineplus">+nsMsgDBFolder::NotifyPropertyFlagChanged(nsIMsgDBHdr *aItem, const nsACString &amp;aProperty,</span>
<a href="#l27.524"></a><span id="l27.524">                                          uint32_t aOldValue, uint32_t aNewValue)</span>
<a href="#l27.525"></a><span id="l27.525"> {</span>
<a href="#l27.526"></a><span id="l27.526">   NS_OBSERVER_ARRAY_NOTIFY_OBSERVERS(mListeners, nsIFolderListener,</span>
<a href="#l27.527"></a><span id="l27.527">                                      OnItemPropertyFlagChanged,</span>
<a href="#l27.528"></a><span id="l27.528">                                      (aItem, aProperty, aOldValue, aNewValue));</span>
<a href="#l27.529"></a><span id="l27.529"> </span>
<a href="#l27.530"></a><span id="l27.530">   // Notify listeners who listen to every folder</span>
<a href="#l27.531"></a><span id="l27.531">   nsresult rv;</span>
<a href="#l27.532"></a><span id="l27.532" class="difflineat">@@ -5018,17 +5041,17 @@ nsresult nsMsgDBFolder::NotifyItemRemove</span>
<a href="#l27.533"></a><span id="l27.533">   // Notify listeners who listen to every folder</span>
<a href="#l27.534"></a><span id="l27.534">   nsresult rv;</span>
<a href="#l27.535"></a><span id="l27.535">   nsCOMPtr&lt;nsIFolderListener&gt; folderListenerManager =</span>
<a href="#l27.536"></a><span id="l27.536">            do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l27.537"></a><span id="l27.537">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.538"></a><span id="l27.538">   return folderListenerManager-&gt;OnItemRemoved(this, aItem);</span>
<a href="#l27.539"></a><span id="l27.539"> }</span>
<a href="#l27.540"></a><span id="l27.540"> </span>
<a href="#l27.541"></a><span id="l27.541" class="difflineminus">-nsresult nsMsgDBFolder::NotifyFolderEvent(nsIAtom* aEvent)</span>
<a href="#l27.542"></a><span id="l27.542" class="difflineplus">+nsresult nsMsgDBFolder::NotifyFolderEvent(const nsACString &amp;aEvent)</span>
<a href="#l27.543"></a><span id="l27.543"> {</span>
<a href="#l27.544"></a><span id="l27.544">   NS_OBSERVER_ARRAY_NOTIFY_OBSERVERS(mListeners, nsIFolderListener,</span>
<a href="#l27.545"></a><span id="l27.545">                                      OnItemEvent,</span>
<a href="#l27.546"></a><span id="l27.546">                                      (this, aEvent));</span>
<a href="#l27.547"></a><span id="l27.547"> </span>
<a href="#l27.548"></a><span id="l27.548">   //Notify listeners who listen to every folder</span>
<a href="#l27.549"></a><span id="l27.549">   nsresult rv;</span>
<a href="#l27.550"></a><span id="l27.550">   nsCOMPtr&lt;nsIFolderListener&gt; folderListenerManager =</span>
<a href="#l27.551"></a><span id="l27.551" class="difflineat">@@ -5403,17 +5426,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetInVFEdit</span>
<a href="#l27.552"></a><span id="l27.552">   *aInVFEditSearchScope = mInVFEditSearchScope;</span>
<a href="#l27.553"></a><span id="l27.553">   return NS_OK;</span>
<a href="#l27.554"></a><span id="l27.554"> }</span>
<a href="#l27.555"></a><span id="l27.555"> </span>
<a href="#l27.556"></a><span id="l27.556"> NS_IMETHODIMP nsMsgDBFolder::SetInVFEditSearchScope (bool aInVFEditSearchScope, bool aSetOnSubFolders)</span>
<a href="#l27.557"></a><span id="l27.557"> {</span>
<a href="#l27.558"></a><span id="l27.558">   bool oldInVFEditSearchScope = mInVFEditSearchScope;</span>
<a href="#l27.559"></a><span id="l27.559">   mInVFEditSearchScope = aInVFEditSearchScope;</span>
<a href="#l27.560"></a><span id="l27.560" class="difflineminus">-  NotifyBoolPropertyChanged(kInVFEditSearchScopeAtom, oldInVFEditSearchScope, mInVFEditSearchScope);</span>
<a href="#l27.561"></a><span id="l27.561" class="difflineplus">+  NotifyBoolPropertyChanged(kInVFEditSearchScope, oldInVFEditSearchScope, mInVFEditSearchScope);</span>
<a href="#l27.562"></a><span id="l27.562">   return NS_OK;</span>
<a href="#l27.563"></a><span id="l27.563"> }</span>
<a href="#l27.564"></a><span id="l27.564"> </span>
<a href="#l27.565"></a><span id="l27.565"> NS_IMETHODIMP nsMsgDBFolder::FetchMsgPreviewText(nsMsgKey *aKeysToFetch, uint32_t aNumKeys,</span>
<a href="#l27.566"></a><span id="l27.566">                                                  bool aLocalOnly, nsIUrlListener *aUrlListener,</span>
<a href="#l27.567"></a><span id="l27.567">                                                  bool *aAsyncResults)</span>
<a href="#l27.568"></a><span id="l27.568"> {</span>
<a href="#l27.569"></a><span id="l27.569">   NS_ENSURE_ARG_POINTER(aKeysToFetch);</span>
<a href="#l27.570"></a><span id="l27.570" class="difflineat">@@ -5748,18 +5771,17 @@ void nsMsgDBFolder::UpdateTimestamps(boo</span>
<a href="#l27.571"></a><span id="l27.571">     SetMRUTime();</span>
<a href="#l27.572"></a><span id="l27.572">     if (allowUndo) // This is a proxy for a user-initiated act.</span>
<a href="#l27.573"></a><span id="l27.573">     {</span>
<a href="#l27.574"></a><span id="l27.574">       bool isArchive;</span>
<a href="#l27.575"></a><span id="l27.575">       IsSpecialFolder(nsMsgFolderFlags::Archive, true, &amp;isArchive);</span>
<a href="#l27.576"></a><span id="l27.576">       if (!isArchive)</span>
<a href="#l27.577"></a><span id="l27.577">       {</span>
<a href="#l27.578"></a><span id="l27.578">         SetMRMTime();</span>
<a href="#l27.579"></a><span id="l27.579" class="difflineminus">-        nsCOMPtr&lt;nsIAtom&gt; MRMTimeChangedAtom = MsgGetAtom(&quot;MRMTimeChanged&quot;);</span>
<a href="#l27.580"></a><span id="l27.580" class="difflineminus">-        NotifyFolderEvent(MRMTimeChangedAtom);</span>
<a href="#l27.581"></a><span id="l27.581" class="difflineplus">+        NotifyFolderEvent(kMRMTimeChanged);</span>
<a href="#l27.582"></a><span id="l27.582">       }</span>
<a href="#l27.583"></a><span id="l27.583">     }</span>
<a href="#l27.584"></a><span id="l27.584">   }</span>
<a href="#l27.585"></a><span id="l27.585"> }</span>
<a href="#l27.586"></a><span id="l27.586"> </span>
<a href="#l27.587"></a><span id="l27.587"> void nsMsgDBFolder::SetMRUTime()</span>
<a href="#l27.588"></a><span id="l27.588"> {</span>
<a href="#l27.589"></a><span id="l27.589">   uint32_t seconds;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.h</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.h</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -9,33 +9,70 @@</span>
<a href="#l28.4"></a><span id="l28.4"> #include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l28.5"></a><span id="l28.5"> #include &quot;msgCore.h&quot;</span>
<a href="#l28.6"></a><span id="l28.6"> #include &quot;nsIMsgFolder.h&quot; </span>
<a href="#l28.7"></a><span id="l28.7"> #include &quot;nsRDFResource.h&quot;</span>
<a href="#l28.8"></a><span id="l28.8"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l28.9"></a><span id="l28.9"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l28.10"></a><span id="l28.10"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l28.11"></a><span id="l28.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-#include &quot;nsStaticAtom.h&quot;</span>
<a href="#l28.13"></a><span id="l28.13"> #include &quot;nsIDBChangeListener.h&quot;</span>
<a href="#l28.14"></a><span id="l28.14"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l28.15"></a><span id="l28.15"> #include &quot;nsIURL.h&quot;</span>
<a href="#l28.16"></a><span id="l28.16"> #include &quot;nsIFile.h&quot;</span>
<a href="#l28.17"></a><span id="l28.17"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l28.18"></a><span id="l28.18"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l28.19"></a><span id="l28.19"> #include &quot;nsIUrlListener.h&quot;</span>
<a href="#l28.20"></a><span id="l28.20"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l28.21"></a><span id="l28.21"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l28.22"></a><span id="l28.22"> #include &quot;nsITransport.h&quot;</span>
<a href="#l28.23"></a><span id="l28.23"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l28.24"></a><span id="l28.24"> #include &quot;nsTObserverArray.h&quot;</span>
<a href="#l28.25"></a><span id="l28.25"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l28.26"></a><span id="l28.26"> #include &quot;nsMsgKeySet.h&quot;</span>
<a href="#l28.27"></a><span id="l28.27"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l28.28"></a><span id="l28.28"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineplus">+</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineplus">+// We declare strings for folder properties and events.</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+// Properties:</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+extern const nsLiteralCString kBiffState;</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+extern const nsLiteralCString kCanFileMessages;</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineplus">+extern const nsLiteralCString kDefaultServer;</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineplus">+extern const nsLiteralCString kFlagged;</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineplus">+extern const nsLiteralCString kFolderFlag;</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+extern const nsLiteralCString kFolderSize;</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+extern const nsLiteralCString kInVFEditSearchScope;</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineplus">+extern const nsLiteralCString kIsDeferred;</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineplus">+extern const nsLiteralCString kIsSecure;</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineplus">+extern const nsLiteralCString kJunkStatusChanged;</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineplus">+extern const nsLiteralCString kKeywords;</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineplus">+extern const nsLiteralCString kMRMTimeChanged;</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineplus">+extern const nsLiteralCString kMsgLoaded;</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineplus">+extern const nsLiteralCString kName;</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineplus">+extern const nsLiteralCString kNewMailReceived;</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineplus">+extern const nsLiteralCString kNewMessages;</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineplus">+extern const nsLiteralCString kOpen;</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineplus">+extern const nsLiteralCString kSortOrder;</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineplus">+extern const nsLiteralCString kStatus;</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineplus">+extern const nsLiteralCString kSynchronize;</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+extern const nsLiteralCString kTotalMessages;</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineplus">+extern const nsLiteralCString kTotalUnreadMessages;</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineplus">+</span>
<a href="#l28.55"></a><span id="l28.55" class="difflineplus">+// Events:</span>
<a href="#l28.56"></a><span id="l28.56" class="difflineplus">+extern const nsLiteralCString kAboutToCompact;</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineplus">+extern const nsLiteralCString kCompactCompleted;</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineplus">+extern const nsLiteralCString kDeleteOrMoveMsgCompleted;</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineplus">+extern const nsLiteralCString kDeleteOrMoveMsgFailed;</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineplus">+extern const nsLiteralCString kFiltersApplied;</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineplus">+extern const nsLiteralCString kFolderCreateCompleted;</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineplus">+extern const nsLiteralCString kFolderCreateFailed;</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineplus">+extern const nsLiteralCString kFolderLoaded;</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineplus">+extern const nsLiteralCString kNumNewBiffMessages;</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineplus">+extern const nsLiteralCString kRenameCompleted;</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineplus">+</span>
<a href="#l28.67"></a><span id="l28.67"> class nsIMsgFolderCacheElement;</span>
<a href="#l28.68"></a><span id="l28.68"> class nsICollation;</span>
<a href="#l28.69"></a><span id="l28.69"> class nsMsgKeySetU;</span>
<a href="#l28.70"></a><span id="l28.70"> </span>
<a href="#l28.71"></a><span id="l28.71">  /* </span>
<a href="#l28.72"></a><span id="l28.72">   * nsMsgDBFolder</span>
<a href="#l28.73"></a><span id="l28.73">   * class derived from nsMsgFolder for those folders that use an nsIMsgDatabase</span>
<a href="#l28.74"></a><span id="l28.74">   */ </span>
<a href="#l28.75"></a><span id="l28.75" class="difflineat">@@ -66,34 +103,34 @@ public:</span>
<a href="#l28.76"></a><span id="l28.76">   // nsRDFResource overrides</span>
<a href="#l28.77"></a><span id="l28.77">   NS_IMETHOD Init(const char* aURI) override;</span>
<a href="#l28.78"></a><span id="l28.78"> </span>
<a href="#l28.79"></a><span id="l28.79">   nsresult CreateDirectoryForFolder(nsIFile **result);</span>
<a href="#l28.80"></a><span id="l28.80">   nsresult CreateBackupDirectory(nsIFile **result);</span>
<a href="#l28.81"></a><span id="l28.81">   nsresult GetBackupSummaryFile(nsIFile **result, const nsACString&amp; newName);</span>
<a href="#l28.82"></a><span id="l28.82">   nsresult GetMsgPreviewTextFromStream(nsIMsgDBHdr *msgHdr, nsIInputStream *stream);</span>
<a href="#l28.83"></a><span id="l28.83">   nsresult HandleAutoCompactEvent(nsIMsgWindow *aMsgWindow);</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineplus">+</span>
<a href="#l28.85"></a><span id="l28.85"> protected:</span>
<a href="#l28.86"></a><span id="l28.86">   virtual ~nsMsgDBFolder();</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineminus">-  </span>
<a href="#l28.88"></a><span id="l28.88" class="difflineplus">+</span>
<a href="#l28.89"></a><span id="l28.89">   virtual nsresult CreateBaseMessageURI(const nsACString&amp; aURI);</span>
<a href="#l28.90"></a><span id="l28.90"> </span>
<a href="#l28.91"></a><span id="l28.91">   void compressQuotesInMsgSnippet(const nsString&amp; aMessageText, nsAString&amp; aCompressedQuotesStr);</span>
<a href="#l28.92"></a><span id="l28.92">   void decodeMsgSnippet(const nsACString&amp; aEncodingType, bool aIsComplete, nsCString&amp; aMsgSnippet);</span>
<a href="#l28.93"></a><span id="l28.93"> </span>
<a href="#l28.94"></a><span id="l28.94">   // helper routine to parse the URI and update member variables</span>
<a href="#l28.95"></a><span id="l28.95">   nsresult parseURI(bool needServer=false);</span>
<a href="#l28.96"></a><span id="l28.96">   nsresult GetBaseStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l28.97"></a><span id="l28.97">   nsresult GetStringFromBundle(const char* msgName, nsString&amp; aResult);</span>
<a href="#l28.98"></a><span id="l28.98">   nsresult ThrowConfirmationPrompt(nsIMsgWindow *msgWindow, const nsAString&amp; confirmString, bool *confirmed);</span>
<a href="#l28.99"></a><span id="l28.99">   nsresult GetWarnFilterChanged(bool *aVal);</span>
<a href="#l28.100"></a><span id="l28.100">   nsresult SetWarnFilterChanged(bool aVal);</span>
<a href="#l28.101"></a><span id="l28.101">   nsresult CreateCollationKey(const nsString &amp;aSource,  uint8_t **aKey, uint32_t *aLength);</span>
<a href="#l28.102"></a><span id="l28.102"> </span>
<a href="#l28.103"></a><span id="l28.103" class="difflineminus">-protected:</span>
<a href="#l28.104"></a><span id="l28.104">   // all children will override this to create the right class of object.</span>
<a href="#l28.105"></a><span id="l28.105">   virtual nsresult CreateChildFromURI(const nsCString &amp;uri, nsIMsgFolder **folder) = 0;</span>
<a href="#l28.106"></a><span id="l28.106">   virtual nsresult ReadDBFolderInfo(bool force);</span>
<a href="#l28.107"></a><span id="l28.107">   virtual nsresult FlushToFolderCache();</span>
<a href="#l28.108"></a><span id="l28.108">   virtual nsresult GetDatabase() = 0;</span>
<a href="#l28.109"></a><span id="l28.109">   virtual nsresult SendFlagNotifications(nsIMsgDBHdr *item, uint32_t oldFlags, uint32_t newFlags);</span>
<a href="#l28.110"></a><span id="l28.110">   nsresult CheckWithNewMessagesStatus(bool messageAdded);</span>
<a href="#l28.111"></a><span id="l28.111">   void     UpdateNewMessages();</span>
<a href="#l28.112"></a><span id="l28.112" class="difflineat">@@ -147,17 +184,16 @@ protected:</span>
<a href="#l28.113"></a><span id="l28.113"> </span>
<a href="#l28.114"></a><span id="l28.114">   /**</span>
<a href="#l28.115"></a><span id="l28.115">    * Produce an array of messages ordered like the input keys.</span>
<a href="#l28.116"></a><span id="l28.116">    */</span>
<a href="#l28.117"></a><span id="l28.117">   nsresult MessagesInKeyOrder(nsTArray&lt;nsMsgKey&gt; &amp;aKeyArray,</span>
<a href="#l28.118"></a><span id="l28.118">                               nsIMsgFolder *srcFolder,</span>
<a href="#l28.119"></a><span id="l28.119">                               nsIMutableArray* messages);</span>
<a href="#l28.120"></a><span id="l28.120"> </span>
<a href="#l28.121"></a><span id="l28.121" class="difflineminus">-protected:</span>
<a href="#l28.122"></a><span id="l28.122">   nsCOMPtr&lt;nsIMsgDatabase&gt; mDatabase;</span>
<a href="#l28.123"></a><span id="l28.123">   nsCOMPtr&lt;nsIMsgDatabase&gt; mBackupDatabase;</span>
<a href="#l28.124"></a><span id="l28.124">   nsCString mCharset;</span>
<a href="#l28.125"></a><span id="l28.125">   bool mCharsetOverride;</span>
<a href="#l28.126"></a><span id="l28.126">   bool mAddListener;</span>
<a href="#l28.127"></a><span id="l28.127">   bool mNewMessages;</span>
<a href="#l28.128"></a><span id="l28.128">   bool mGettingNewMessages;</span>
<a href="#l28.129"></a><span id="l28.129">   nsMsgKey mLastMessageLoaded;</span>
<a href="#l28.130"></a><span id="l28.130" class="difflineat">@@ -167,17 +203,16 @@ protected:</span>
<a href="#l28.131"></a><span id="l28.131">   int32_t m_bytesAddedToLocalMsg;</span>
<a href="#l28.132"></a><span id="l28.132">   // this is currently used when we do a save as of an imap or news message..</span>
<a href="#l28.133"></a><span id="l28.133">   nsCOMPtr&lt;nsIOutputStream&gt; m_tempMessageStream;</span>
<a href="#l28.134"></a><span id="l28.134"> </span>
<a href="#l28.135"></a><span id="l28.135">   nsCOMPtr &lt;nsIMsgRetentionSettings&gt; m_retentionSettings;</span>
<a href="#l28.136"></a><span id="l28.136">   nsCOMPtr &lt;nsIMsgDownloadSettings&gt; m_downloadSettings;</span>
<a href="#l28.137"></a><span id="l28.137">   static NS_MSG_BASE_STATIC_MEMBER_(nsrefcnt) mInstanceCount;</span>
<a href="#l28.138"></a><span id="l28.138"> </span>
<a href="#l28.139"></a><span id="l28.139" class="difflineminus">-protected:</span>
<a href="#l28.140"></a><span id="l28.140">   uint32_t mFlags;</span>
<a href="#l28.141"></a><span id="l28.141">   nsWeakPtr mParent;     //This won't be refcounted for ownership reasons.</span>
<a href="#l28.142"></a><span id="l28.142">   int32_t mNumUnreadMessages;        /* count of unread messages (-1 means unknown; -2 means unknown but we already tried to find out.) */</span>
<a href="#l28.143"></a><span id="l28.143">   int32_t mNumTotalMessages;         /* count of existing messages. */</span>
<a href="#l28.144"></a><span id="l28.144">   bool mNotifyCountChanges;</span>
<a href="#l28.145"></a><span id="l28.145">   int64_t mExpungedBytes;</span>
<a href="#l28.146"></a><span id="l28.146">   nsCOMArray&lt;nsIMsgFolder&gt; mSubFolders;</span>
<a href="#l28.147"></a><span id="l28.147">   // This can't be refcounted due to ownsership issues</span>
<a href="#l28.148"></a><span id="l28.148" class="difflineat">@@ -232,23 +267,20 @@ protected:</span>
<a href="#l28.149"></a><span id="l28.149">   static NS_MSG_BASE_STATIC_MEMBER_(nsString) kLocalizedSentName;</span>
<a href="#l28.150"></a><span id="l28.150">   static NS_MSG_BASE_STATIC_MEMBER_(nsString) kLocalizedDraftsName;</span>
<a href="#l28.151"></a><span id="l28.151">   static NS_MSG_BASE_STATIC_MEMBER_(nsString) kLocalizedTemplatesName;</span>
<a href="#l28.152"></a><span id="l28.152">   static NS_MSG_BASE_STATIC_MEMBER_(nsString) kLocalizedUnsentName;</span>
<a href="#l28.153"></a><span id="l28.153">   static NS_MSG_BASE_STATIC_MEMBER_(nsString) kLocalizedJunkName;</span>
<a href="#l28.154"></a><span id="l28.154">   static NS_MSG_BASE_STATIC_MEMBER_(nsString) kLocalizedArchivesName;</span>
<a href="#l28.155"></a><span id="l28.155"> </span>
<a href="#l28.156"></a><span id="l28.156">   static NS_MSG_BASE_STATIC_MEMBER_(nsString) kLocalizedBrandShortName;</span>
<a href="#l28.157"></a><span id="l28.157" class="difflineminus">-  </span>
<a href="#l28.158"></a><span id="l28.158" class="difflineminus">-#define MSGDBFOLDER_ATOM(name_, value) static NS_MSG_BASE_STATIC_MEMBER_(nsIAtom*) name_;</span>
<a href="#l28.159"></a><span id="l28.159" class="difflineminus">-#include &quot;nsMsgDBFolderAtomList.h&quot;</span>
<a href="#l28.160"></a><span id="l28.160" class="difflineminus">-#undef MSGDBFOLDER_ATOM</span>
<a href="#l28.161"></a><span id="l28.161"> </span>
<a href="#l28.162"></a><span id="l28.162">   static NS_MSG_BASE_STATIC_MEMBER_(nsICollation*) gCollationKeyGenerator;</span>
<a href="#l28.163"></a><span id="l28.163"> </span>
<a href="#l28.164"></a><span id="l28.164" class="difflineplus">+</span>
<a href="#l28.165"></a><span id="l28.165">   // store of keys that have a processing flag set</span>
<a href="#l28.166"></a><span id="l28.166">   struct</span>
<a href="#l28.167"></a><span id="l28.167">   {</span>
<a href="#l28.168"></a><span id="l28.168">     uint32_t bit;</span>
<a href="#l28.169"></a><span id="l28.169">     nsMsgKeySetU* keys;</span>
<a href="#l28.170"></a><span id="l28.170">   } mProcessingFlag[nsMsgProcessingFlags::NumberOfFlags];</span>
<a href="#l28.171"></a><span id="l28.171"> </span>
<a href="#l28.172"></a><span id="l28.172">   // list of nsIMsgDBHdrs for messages to process post-bayes</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1">deleted file mode 100644</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolderAtomList.h</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineplus">+++ /dev/null</span>
<a href="#l29.4"></a><span id="l29.4" class="difflineat">@@ -1,26 +0,0 @@</span>
<a href="#l29.5"></a><span id="l29.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l29.6"></a><span id="l29.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l29.7"></a><span id="l29.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l29.8"></a><span id="l29.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l29.9"></a><span id="l29.9" class="difflineminus">-</span>
<a href="#l29.10"></a><span id="l29.10" class="difflineminus">-MSGDBFOLDER_ATOM(kTotalUnreadMessagesAtom, &quot;TotalUnreadMessages&quot;)</span>
<a href="#l29.11"></a><span id="l29.11" class="difflineminus">-MSGDBFOLDER_ATOM(kBiffStateAtom, &quot;BiffState&quot;)</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-MSGDBFOLDER_ATOM(kNewMailReceivedAtom, &quot;NewMailReceived&quot;)</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-MSGDBFOLDER_ATOM(kNewMessagesAtom, &quot;NewMessages&quot;)</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-MSGDBFOLDER_ATOM(kInVFEditSearchScopeAtom, &quot;inVFEditSearchScope&quot;)</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-MSGDBFOLDER_ATOM(kNumNewBiffMessagesAtom, &quot;NumNewBiffMessages&quot;)</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-MSGDBFOLDER_ATOM(kTotalMessagesAtom, &quot;TotalMessages&quot;)</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">-MSGDBFOLDER_ATOM(kFolderSizeAtom, &quot;FolderSize&quot;)</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">-MSGDBFOLDER_ATOM(kStatusAtom, &quot;Status&quot;)</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineminus">-MSGDBFOLDER_ATOM(kFlaggedAtom, &quot;Flagged&quot;)</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineminus">-MSGDBFOLDER_ATOM(kNameAtom, &quot;Name&quot;)</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineminus">-MSGDBFOLDER_ATOM(kSynchronizeAtom, &quot;Synchronize&quot;)</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineminus">-MSGDBFOLDER_ATOM(kOpenAtom, &quot;open&quot;)</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineminus">-MSGDBFOLDER_ATOM(kIsDeferred, &quot;isDeferred&quot;)</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineminus">-MSGDBFOLDER_ATOM(kKeywords, &quot;Keywords&quot;)</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineminus">-MSGDBFOLDER_ATOM(mFolderLoadedAtom, &quot;FolderLoaded&quot;)</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineminus">-MSGDBFOLDER_ATOM(mDeleteOrMoveMsgCompletedAtom, &quot;DeleteOrMoveMsgCompleted&quot;)</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">-MSGDBFOLDER_ATOM(mDeleteOrMoveMsgFailedAtom, &quot;DeleteOrMoveMsgFailed&quot;)</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineminus">-MSGDBFOLDER_ATOM(mJunkStatusChangedAtom, &quot;JunkStatusChanged&quot;)</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">-MSGDBFOLDER_ATOM(mFiltersAppliedAtom, &quot;FiltersApplied&quot;)</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineminus">-MSGDBFOLDER_ATOM(mFolderFlagAtom, &quot;FolderFlag&quot;)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -13,16 +13,17 @@</span>
<a href="#l30.4"></a><span id="l30.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l30.5"></a><span id="l30.5"> #include &quot;nsString.h&quot;</span>
<a href="#l30.6"></a><span id="l30.6"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> #include &quot;nsIMsgBiffManager.h&quot;</span>
<a href="#l30.9"></a><span id="l30.9"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l30.10"></a><span id="l30.10"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l30.11"></a><span id="l30.11"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l30.13"></a><span id="l30.13"> #include &quot;nsIMsgFolderCache.h&quot;</span>
<a href="#l30.14"></a><span id="l30.14"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l30.15"></a><span id="l30.15"> #include &quot;nsIMsgFolderCacheElement.h&quot;</span>
<a href="#l30.16"></a><span id="l30.16"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l30.17"></a><span id="l30.17"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l30.18"></a><span id="l30.18"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l30.19"></a><span id="l30.19"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l30.20"></a><span id="l30.20"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineat">@@ -1766,18 +1767,17 @@ NS_IMETHODIMP nsMsgIncomingServer::SetSo</span>
<a href="#l30.22"></a><span id="l30.22">   nsresult rv = mPrefBranch-&gt;SetIntPref(&quot;socketType&quot;, aSocketType);</span>
<a href="#l30.23"></a><span id="l30.23">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.24"></a><span id="l30.24"> </span>
<a href="#l30.25"></a><span id="l30.25">   bool isSecureOld = (socketType == nsMsgSocketType::alwaysSTARTTLS ||</span>
<a href="#l30.26"></a><span id="l30.26">                         socketType == nsMsgSocketType::SSL);</span>
<a href="#l30.27"></a><span id="l30.27">   bool isSecureNew = (aSocketType == nsMsgSocketType::alwaysSTARTTLS ||</span>
<a href="#l30.28"></a><span id="l30.28">                         aSocketType == nsMsgSocketType::SSL);</span>
<a href="#l30.29"></a><span id="l30.29">   if ((isSecureOld != isSecureNew) &amp;&amp; m_rootFolder) {</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-    nsCOMPtr &lt;nsIAtom&gt; isSecureAtom = MsgGetAtom(&quot;isSecure&quot;);</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-    m_rootFolder-&gt;NotifyBoolPropertyChanged(isSecureAtom,</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+    m_rootFolder-&gt;NotifyBoolPropertyChanged(kIsSecure,</span>
<a href="#l30.33"></a><span id="l30.33">                                             isSecureOld, isSecureNew);</span>
<a href="#l30.34"></a><span id="l30.34">   }</span>
<a href="#l30.35"></a><span id="l30.35">   return NS_OK;</span>
<a href="#l30.36"></a><span id="l30.36"> }</span>
<a href="#l30.37"></a><span id="l30.37"> </span>
<a href="#l30.38"></a><span id="l30.38"> // Check if the password is available and return a boolean indicating whether</span>
<a href="#l30.39"></a><span id="l30.39"> // it is being authenticated or not.</span>
<a href="#l30.40"></a><span id="l30.40"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -10,17 +10,16 @@</span>
<a href="#l31.4"></a><span id="l31.4"> #include &quot;nsString.h&quot;</span>
<a href="#l31.5"></a><span id="l31.5"> #include &quot;msgCore.h&quot;</span>
<a href="#l31.6"></a><span id="l31.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l31.7"></a><span id="l31.7"> #include &quot;MailNewsTypes2.h&quot;</span>
<a href="#l31.8"></a><span id="l31.8"> #include &quot;nsTArray.h&quot;</span>
<a href="#l31.9"></a><span id="l31.9"> #include &quot;nsInterfaceRequestorAgg.h&quot;</span>
<a href="#l31.10"></a><span id="l31.10"> #include &quot;nsILoadGroup.h&quot;</span>
<a href="#l31.11"></a><span id="l31.11"> #include &quot;nsIArray.h&quot;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-#include &quot;nsIAtom.h&quot;</span>
<a href="#l31.13"></a><span id="l31.13"> #include &quot;nsINetUtil.h&quot;</span>
<a href="#l31.14"></a><span id="l31.14"> #include &quot;nsIRequest.h&quot;</span>
<a href="#l31.15"></a><span id="l31.15"> #include &quot;nsILoadInfo.h&quot;</span>
<a href="#l31.16"></a><span id="l31.16"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l31.17"></a><span id="l31.17"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l31.18"></a><span id="l31.18"> #include &quot;nsIFile.h&quot;</span>
<a href="#l31.19"></a><span id="l31.19"> </span>
<a href="#l31.20"></a><span id="l31.20"> class nsIChannel;</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineat">@@ -340,20 +339,16 @@ ConvertBufToPlainText(nsString &amp;aConBuf,</span>
<a href="#l31.22"></a><span id="l31.22"> #define MsgReplaceSubstring(str, what, replacement) \</span>
<a href="#l31.23"></a><span id="l31.23">         (str).ReplaceSubstring(what, replacement)</span>
<a href="#l31.24"></a><span id="l31.24"> #define MsgIsUTF8(str) \</span>
<a href="#l31.25"></a><span id="l31.25">         IsUTF8(str)</span>
<a href="#l31.26"></a><span id="l31.26"> #define MsgNewInterfaceRequestorAggregation(aFirst, aSecond, aResult) \</span>
<a href="#l31.27"></a><span id="l31.27">         NS_NewInterfaceRequestorAggregation(aFirst, aSecond, aResult)</span>
<a href="#l31.28"></a><span id="l31.28"> #define MsgNewNotificationCallbacksAggregation(aCallbacks, aLoadGroup, aResult) \</span>
<a href="#l31.29"></a><span id="l31.29">         NS_NewNotificationCallbacksAggregation(aCallbacks, aLoadGroup, aResult)</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">-#define MsgGetAtom(aString) \</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-        NS_Atomize(aString)</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineminus">-#define MsgNewAtom(aString) \</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineminus">-        NS_Atomize(aString)</span>
<a href="#l31.34"></a><span id="l31.34"> #define MsgReplaceChar(aString, aNeedle, aReplacement) \</span>
<a href="#l31.35"></a><span id="l31.35">         (aString).ReplaceChar(aNeedle, aReplacement)</span>
<a href="#l31.36"></a><span id="l31.36"> #define MsgFind(str, what, ignore_case, offset) \</span>
<a href="#l31.37"></a><span id="l31.37">         (str).Find(what, ignore_case, offset)</span>
<a href="#l31.38"></a><span id="l31.38"> #define MsgCountChar(aString, aChar) \</span>
<a href="#l31.39"></a><span id="l31.39">         (aString).CountChar(aChar)</span>
<a href="#l31.40"></a><span id="l31.40"> </span>
<a href="#l31.41"></a><span id="l31.41"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -1469,55 +1469,55 @@ nsMsgSendLater::OnItemAdded(nsIMsgFolder</span>
<a href="#l32.4"></a><span id="l32.4"> </span>
<a href="#l32.5"></a><span id="l32.5"> NS_IMETHODIMP</span>
<a href="#l32.6"></a><span id="l32.6"> nsMsgSendLater::OnItemRemoved(nsIMsgFolder *aParentItem, nsISupports *aItem)</span>
<a href="#l32.7"></a><span id="l32.7"> {</span>
<a href="#l32.8"></a><span id="l32.8">   return NS_OK;</span>
<a href="#l32.9"></a><span id="l32.9"> }</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11"> NS_IMETHODIMP</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-nsMsgSendLater::OnItemPropertyChanged(nsIMsgFolder *aItem, nsIAtom *aProperty,</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+nsMsgSendLater::OnItemPropertyChanged(nsIMsgFolder *aItem, const nsACString &amp;aProperty,</span>
<a href="#l32.14"></a><span id="l32.14">                                       const char* aOldValue,</span>
<a href="#l32.15"></a><span id="l32.15">                                       const char* aNewValue)</span>
<a href="#l32.16"></a><span id="l32.16"> {</span>
<a href="#l32.17"></a><span id="l32.17">   return NS_OK;</span>
<a href="#l32.18"></a><span id="l32.18"> }</span>
<a href="#l32.19"></a><span id="l32.19"> </span>
<a href="#l32.20"></a><span id="l32.20"> NS_IMETHODIMP</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineminus">-nsMsgSendLater::OnItemIntPropertyChanged(nsIMsgFolder *aItem, nsIAtom *aProperty,</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineplus">+nsMsgSendLater::OnItemIntPropertyChanged(nsIMsgFolder *aItem, const nsACString &amp;aProperty,</span>
<a href="#l32.23"></a><span id="l32.23">                                          int64_t aOldValue, int64_t aNewValue)</span>
<a href="#l32.24"></a><span id="l32.24"> {</span>
<a href="#l32.25"></a><span id="l32.25">   return NS_OK;</span>
<a href="#l32.26"></a><span id="l32.26"> }</span>
<a href="#l32.27"></a><span id="l32.27"> </span>
<a href="#l32.28"></a><span id="l32.28"> NS_IMETHODIMP</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineminus">-nsMsgSendLater::OnItemBoolPropertyChanged(nsIMsgFolder *aItem, nsIAtom *aProperty,</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+nsMsgSendLater::OnItemBoolPropertyChanged(nsIMsgFolder *aItem, const nsACString &amp;aProperty,</span>
<a href="#l32.31"></a><span id="l32.31">                                           bool aOldValue, bool aNewValue)</span>
<a href="#l32.32"></a><span id="l32.32"> {</span>
<a href="#l32.33"></a><span id="l32.33">   return NS_OK;</span>
<a href="#l32.34"></a><span id="l32.34"> }</span>
<a href="#l32.35"></a><span id="l32.35"> </span>
<a href="#l32.36"></a><span id="l32.36"> NS_IMETHODIMP</span>
<a href="#l32.37"></a><span id="l32.37"> nsMsgSendLater::OnItemUnicharPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineminus">-                                             nsIAtom *aProperty,</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+                                             const nsACString &amp;aProperty,</span>
<a href="#l32.40"></a><span id="l32.40">                                              const char16_t* aOldValue,</span>
<a href="#l32.41"></a><span id="l32.41">                                              const char16_t* aNewValue)</span>
<a href="#l32.42"></a><span id="l32.42"> {</span>
<a href="#l32.43"></a><span id="l32.43">   return NS_OK;</span>
<a href="#l32.44"></a><span id="l32.44"> }</span>
<a href="#l32.45"></a><span id="l32.45"> </span>
<a href="#l32.46"></a><span id="l32.46"> NS_IMETHODIMP</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineminus">-nsMsgSendLater::OnItemPropertyFlagChanged(nsIMsgDBHdr *aItem, nsIAtom *aProperty,</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineplus">+nsMsgSendLater::OnItemPropertyFlagChanged(nsIMsgDBHdr *aItem, const nsACString &amp;aProperty,</span>
<a href="#l32.49"></a><span id="l32.49">                                           uint32_t aOldValue, uint32_t aNewValue)</span>
<a href="#l32.50"></a><span id="l32.50"> {</span>
<a href="#l32.51"></a><span id="l32.51">   return NS_OK;</span>
<a href="#l32.52"></a><span id="l32.52"> }</span>
<a href="#l32.53"></a><span id="l32.53"> </span>
<a href="#l32.54"></a><span id="l32.54"> NS_IMETHODIMP</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineminus">-nsMsgSendLater::OnItemEvent(nsIMsgFolder* aItem, nsIAtom *aEvent)</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineplus">+nsMsgSendLater::OnItemEvent(nsIMsgFolder* aItem, const nsACString &amp;aEvent)</span>
<a href="#l32.57"></a><span id="l32.57"> {</span>
<a href="#l32.58"></a><span id="l32.58">   return NS_OK;</span>
<a href="#l32.59"></a><span id="l32.59"> }</span>
<a href="#l32.60"></a><span id="l32.60"> </span>
<a href="#l32.61"></a><span id="l32.61"> NS_IMETHODIMP</span>
<a href="#l32.62"></a><span id="l32.62"> nsMsgSendLater::GetNeedsToRunTask(bool *aResult)</span>
<a href="#l32.63"></a><span id="l32.63"> {</span>
<a href="#l32.64"></a><span id="l32.64">   NS_ENSURE_ARG_POINTER(aResult);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.h</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.h</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -10,16 +10,17 @@</span>
<a href="#l33.4"></a><span id="l33.4"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l33.5"></a><span id="l33.5"> #include &quot;nsIMsgSendListener.h&quot;</span>
<a href="#l33.6"></a><span id="l33.6"> #include &quot;nsIMsgSendLaterListener.h&quot;</span>
<a href="#l33.7"></a><span id="l33.7"> #include &quot;nsIMsgSendLater.h&quot;</span>
<a href="#l33.8"></a><span id="l33.8"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l33.9"></a><span id="l33.9"> #include &quot;nsTObserverArray.h&quot;</span>
<a href="#l33.10"></a><span id="l33.10"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l33.11"></a><span id="l33.11"> #include &quot;nsITimer.h&quot;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l33.13"></a><span id="l33.13"> #include &quot;nsIMsgShutdown.h&quot;</span>
<a href="#l33.14"></a><span id="l33.14"> </span>
<a href="#l33.15"></a><span id="l33.15"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l33.16"></a><span id="l33.16"> // This is the listener class for the send operation. We have to create this class </span>
<a href="#l33.17"></a><span id="l33.17"> // to listen for message send completion and eventually notify the caller</span>
<a href="#l33.18"></a><span id="l33.18"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l33.19"></a><span id="l33.19"> class nsMsgSendLater;</span>
<a href="#l33.20"></a><span id="l33.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -1372,19 +1372,17 @@ NS_IMETHODIMP nsImapIncomingServer::Onli</span>
<a href="#l34.4"></a><span id="l34.4">         nsCOMPtr &lt;nsIMsgFolder&gt; newFolder;</span>
<a href="#l34.5"></a><span id="l34.5">         nsString unicodeNewName;</span>
<a href="#l34.6"></a><span id="l34.6">         // tmpNewName is imap mod utf7. It needs to be convert to utf8.</span>
<a href="#l34.7"></a><span id="l34.7">         CopyMUTF7toUTF16(tmpNewName, unicodeNewName);</span>
<a href="#l34.8"></a><span id="l34.8">         CopyUTF16toUTF8(unicodeNewName, tmpNewName);</span>
<a href="#l34.9"></a><span id="l34.9">         rv = GetFolder(tmpNewName, getter_AddRefs(newFolder));</span>
<a href="#l34.10"></a><span id="l34.10">         if (NS_SUCCEEDED(rv))</span>
<a href="#l34.11"></a><span id="l34.11">         {</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-          nsCOMPtr &lt;nsIAtom&gt; folderRenameAtom;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-          folderRenameAtom = MsgGetAtom(&quot;RenameCompleted&quot;);</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-          newFolder-&gt;NotifyFolderEvent(folderRenameAtom);</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+          newFolder-&gt;NotifyFolderEvent(kRenameCompleted);</span>
<a href="#l34.16"></a><span id="l34.16">         }</span>
<a href="#l34.17"></a><span id="l34.17">       }</span>
<a href="#l34.18"></a><span id="l34.18">     }</span>
<a href="#l34.19"></a><span id="l34.19">   }</span>
<a href="#l34.20"></a><span id="l34.20">   return rv;</span>
<a href="#l34.21"></a><span id="l34.21"> }</span>
<a href="#l34.22"></a><span id="l34.22"> </span>
<a href="#l34.23"></a><span id="l34.23"> NS_IMETHODIMP  nsImapIncomingServer::FolderIsNoSelect(const nsACString&amp; aFolderName, bool *result)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -822,23 +822,23 @@ NS_IMETHODIMP nsImapMailFolder::UpdateFo</span>
<a href="#l35.4"></a><span id="l35.4">     {</span>
<a href="#l35.5"></a><span id="l35.5">       if (aMsgWindow)</span>
<a href="#l35.6"></a><span id="l35.6">         AutoCompact(aMsgWindow);</span>
<a href="#l35.7"></a><span id="l35.7">     }</span>
<a href="#l35.8"></a><span id="l35.8"> </span>
<a href="#l35.9"></a><span id="l35.9">     if (rv == NS_MSG_ERROR_OFFLINE || rv == NS_BINDING_ABORTED)</span>
<a href="#l35.10"></a><span id="l35.10">     {</span>
<a href="#l35.11"></a><span id="l35.11">       rv = NS_OK;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-      NotifyFolderEvent(mFolderLoadedAtom);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+      NotifyFolderEvent(kFolderLoaded);</span>
<a href="#l35.14"></a><span id="l35.14">     }</span>
<a href="#l35.15"></a><span id="l35.15">   }</span>
<a href="#l35.16"></a><span id="l35.16">   else if (NS_SUCCEEDED(rv))  // tell the front end that the folder is loaded if we're not going to</span>
<a href="#l35.17"></a><span id="l35.17">   {                           // actually run a url.</span>
<a href="#l35.18"></a><span id="l35.18">     if (!m_updatingFolder)    // if we're already running an update url, we'll let that one send the folder loaded</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineminus">-      NotifyFolderEvent(mFolderLoadedAtom);</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+      NotifyFolderEvent(kFolderLoaded);</span>
<a href="#l35.21"></a><span id="l35.21">   }</span>
<a href="#l35.22"></a><span id="l35.22">   return rv;</span>
<a href="#l35.23"></a><span id="l35.23"> }</span>
<a href="#l35.24"></a><span id="l35.24"> </span>
<a href="#l35.25"></a><span id="l35.25"> NS_IMETHODIMP nsImapMailFolder::GetMessages(nsISimpleEnumerator* *result)</span>
<a href="#l35.26"></a><span id="l35.26"> {</span>
<a href="#l35.27"></a><span id="l35.27">   NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l35.28"></a><span id="l35.28">   if (!mDatabase)</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineat">@@ -1002,30 +1002,27 @@ NS_IMETHODIMP nsImapMailFolder::CreateCl</span>
<a href="#l35.30"></a><span id="l35.30">     unusedDB-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l35.31"></a><span id="l35.31">     unusedDB-&gt;Close(true);</span>
<a href="#l35.32"></a><span id="l35.32">     // don't want to hold onto this newly created db.</span>
<a href="#l35.33"></a><span id="l35.33">     child-&gt;SetMsgDatabase(nullptr);</span>
<a href="#l35.34"></a><span id="l35.34">   }</span>
<a href="#l35.35"></a><span id="l35.35"> </span>
<a href="#l35.36"></a><span id="l35.36">   if (!suppressNotification)</span>
<a href="#l35.37"></a><span id="l35.37">   {</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineminus">-    nsCOMPtr &lt;nsIAtom&gt; folderCreateAtom;</span>
<a href="#l35.39"></a><span id="l35.39">     if(NS_SUCCEEDED(rv) &amp;&amp; child)</span>
<a href="#l35.40"></a><span id="l35.40">     {</span>
<a href="#l35.41"></a><span id="l35.41">       NotifyItemAdded(child);</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineminus">-      folderCreateAtom = MsgGetAtom(&quot;FolderCreateCompleted&quot;);</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineminus">-      child-&gt;NotifyFolderEvent(folderCreateAtom);</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineplus">+      child-&gt;NotifyFolderEvent(kFolderCreateCompleted);</span>
<a href="#l35.45"></a><span id="l35.45">       nsCOMPtr&lt;nsIMsgFolderNotificationService&gt; notifier(do_GetService(NS_MSGNOTIFICATIONSERVICE_CONTRACTID));</span>
<a href="#l35.46"></a><span id="l35.46">       if (notifier)</span>
<a href="#l35.47"></a><span id="l35.47">         notifier-&gt;NotifyFolderAdded(child);</span>
<a href="#l35.48"></a><span id="l35.48">     }</span>
<a href="#l35.49"></a><span id="l35.49">     else</span>
<a href="#l35.50"></a><span id="l35.50">     {</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineminus">-      folderCreateAtom = MsgGetAtom(&quot;FolderCreateFailed&quot;);</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineminus">-      NotifyFolderEvent(folderCreateAtom);</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineplus">+      NotifyFolderEvent(kFolderCreateFailed);</span>
<a href="#l35.54"></a><span id="l35.54">     }</span>
<a href="#l35.55"></a><span id="l35.55">   }</span>
<a href="#l35.56"></a><span id="l35.56">   return rv;</span>
<a href="#l35.57"></a><span id="l35.57"> }</span>
<a href="#l35.58"></a><span id="l35.58"> </span>
<a href="#l35.59"></a><span id="l35.59"> NS_IMETHODIMP nsImapMailFolder::List()</span>
<a href="#l35.60"></a><span id="l35.60"> {</span>
<a href="#l35.61"></a><span id="l35.61">   nsresult rv;</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineat">@@ -2298,17 +2295,17 @@ NS_IMETHODIMP nsImapMailFolder::DeleteMe</span>
<a href="#l35.63"></a><span id="l35.63">             nsCOMPtr&lt;nsIMsgFolderNotificationService&gt; notifier(do_GetService(NS_MSGNOTIFICATIONSERVICE_CONTRACTID));</span>
<a href="#l35.64"></a><span id="l35.64">             if (notifier)</span>
<a href="#l35.65"></a><span id="l35.65">               notifier-&gt;NotifyMsgsDeleted(messages);</span>
<a href="#l35.66"></a><span id="l35.66">           }</span>
<a href="#l35.67"></a><span id="l35.67">           DeleteStoreMessages(messages);</span>
<a href="#l35.68"></a><span id="l35.68">           database-&gt;DeleteMessages(srcKeyArray.Length(), srcKeyArray.Elements(), nullptr);</span>
<a href="#l35.69"></a><span id="l35.69">           EnableNotifications(allMessageCountNotifications, true);</span>
<a href="#l35.70"></a><span id="l35.70">         }</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineminus">-        NotifyFolderEvent(mDeleteOrMoveMsgCompletedAtom);</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineplus">+        NotifyFolderEvent(kDeleteOrMoveMsgCompleted);</span>
<a href="#l35.73"></a><span id="l35.73">       }</span>
<a href="#l35.74"></a><span id="l35.74">     }</span>
<a href="#l35.75"></a><span id="l35.75">     return rv;</span>
<a href="#l35.76"></a><span id="l35.76">   }</span>
<a href="#l35.77"></a><span id="l35.77"> </span>
<a href="#l35.78"></a><span id="l35.78">   // have to move the messages to the trash</span>
<a href="#l35.79"></a><span id="l35.79">   if(trashFolder)</span>
<a href="#l35.80"></a><span id="l35.80">   {</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineat">@@ -3148,17 +3145,17 @@ nsresult nsImapMailFolder::NormalEndHead</span>
<a href="#l35.82"></a><span id="l35.82">           !m_filterListRequiresBody)</span>
<a href="#l35.83"></a><span id="l35.83">       {</span>
<a href="#l35.84"></a><span id="l35.84">         if (m_filterList)</span>
<a href="#l35.85"></a><span id="l35.85">         {</span>
<a href="#l35.86"></a><span id="l35.86">           GetMoveCoalescer();  // not sure why we're doing this here.</span>
<a href="#l35.87"></a><span id="l35.87">           m_filterList-&gt;ApplyFiltersToHdr(nsMsgFilterType::InboxRule, newMsgHdr,</span>
<a href="#l35.88"></a><span id="l35.88">                                           this, mDatabase, headers, headersSize,</span>
<a href="#l35.89"></a><span id="l35.89">                                           this, msgWindow);</span>
<a href="#l35.90"></a><span id="l35.90" class="difflineminus">-          NotifyFolderEvent(mFiltersAppliedAtom);</span>
<a href="#l35.91"></a><span id="l35.91" class="difflineplus">+          NotifyFolderEvent(kFiltersApplied);</span>
<a href="#l35.92"></a><span id="l35.92">         }</span>
<a href="#l35.93"></a><span id="l35.93">       }</span>
<a href="#l35.94"></a><span id="l35.94">     }</span>
<a href="#l35.95"></a><span id="l35.95">   }</span>
<a href="#l35.96"></a><span id="l35.96">   // here we need to tweak flags from uid state..</span>
<a href="#l35.97"></a><span id="l35.97">   if (mDatabase &amp;&amp; (!m_msgMovedByFilter || ShowDeletedMessages()))</span>
<a href="#l35.98"></a><span id="l35.98">   {</span>
<a href="#l35.99"></a><span id="l35.99">     nsCOMPtr&lt;nsIMsgFolderNotificationService&gt; notifier(do_GetService(NS_MSGNOTIFICATIONSERVICE_CONTRACTID));</span>
<a href="#l35.100"></a><span id="l35.100" class="difflineat">@@ -4677,17 +4674,17 @@ nsImapMailFolder::NormalEndMsgWriteStrea</span>
<a href="#l35.101"></a><span id="l35.101">         nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgUrl;</span>
<a href="#l35.102"></a><span id="l35.102">         msgUrl = do_QueryInterface(imapUrl, &amp;rv);</span>
<a href="#l35.103"></a><span id="l35.103">         if (msgUrl &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l35.104"></a><span id="l35.104">           msgUrl-&gt;GetMsgWindow(getter_AddRefs(msgWindow));</span>
<a href="#l35.105"></a><span id="l35.105">       }</span>
<a href="#l35.106"></a><span id="l35.106">       m_filterList-&gt;ApplyFiltersToHdr(nsMsgFilterType::InboxRule, newMsgHdr,</span>
<a href="#l35.107"></a><span id="l35.107">                                       this, mDatabase, nullptr, 0, this,</span>
<a href="#l35.108"></a><span id="l35.108">                                       msgWindow);</span>
<a href="#l35.109"></a><span id="l35.109" class="difflineminus">-      NotifyFolderEvent(mFiltersAppliedAtom);</span>
<a href="#l35.110"></a><span id="l35.110" class="difflineplus">+      NotifyFolderEvent(kFiltersApplied);</span>
<a href="#l35.111"></a><span id="l35.111">     }</span>
<a href="#l35.112"></a><span id="l35.112">     // Process filter plugins and other items normally done at the end of</span>
<a href="#l35.113"></a><span id="l35.113">     // HeaderFetchCompleted.</span>
<a href="#l35.114"></a><span id="l35.114">     bool pendingMoves = m_moveCoalescer &amp;&amp; m_moveCoalescer-&gt;HasPendingMoves();</span>
<a href="#l35.115"></a><span id="l35.115">     PlaybackCoalescedOperations();</span>
<a href="#l35.116"></a><span id="l35.116"> </span>
<a href="#l35.117"></a><span id="l35.117">     bool filtersRun;</span>
<a href="#l35.118"></a><span id="l35.118">     CallFilterPlugins(nullptr, &amp;filtersRun);</span>
<a href="#l35.119"></a><span id="l35.119" class="difflineat">@@ -4754,17 +4751,17 @@ nsImapMailFolder::OnlineCopyCompleted(ns</span>
<a href="#l35.120"></a><span id="l35.120">                                       true);</span>
<a href="#l35.121"></a><span id="l35.121">   }</span>
<a href="#l35.122"></a><span id="l35.122">   /* unhandled copystate */</span>
<a href="#l35.123"></a><span id="l35.123">   if (m_copyState) // whoops, this is the wrong folder - should use the source folder</span>
<a href="#l35.124"></a><span id="l35.124">   {</span>
<a href="#l35.125"></a><span id="l35.125">     nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder;</span>
<a href="#l35.126"></a><span id="l35.126">     srcFolder = do_QueryInterface(m_copyState-&gt;m_srcSupport, &amp;rv);</span>
<a href="#l35.127"></a><span id="l35.127">     if (srcFolder)</span>
<a href="#l35.128"></a><span id="l35.128" class="difflineminus">-      srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgCompletedAtom);</span>
<a href="#l35.129"></a><span id="l35.129" class="difflineplus">+      srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgCompleted);</span>
<a href="#l35.130"></a><span id="l35.130">   }</span>
<a href="#l35.131"></a><span id="l35.131">   else</span>
<a href="#l35.132"></a><span id="l35.132">     rv = NS_ERROR_FAILURE;</span>
<a href="#l35.133"></a><span id="l35.133"> </span>
<a href="#l35.134"></a><span id="l35.134">   return rv;</span>
<a href="#l35.135"></a><span id="l35.135"> }</span>
<a href="#l35.136"></a><span id="l35.136"> </span>
<a href="#l35.137"></a><span id="l35.137"> NS_IMETHODIMP</span>
<a href="#l35.138"></a><span id="l35.138" class="difflineat">@@ -4872,17 +4869,17 @@ nsresult nsImapMailFolder::SyncFlags(nsI</span>
<a href="#l35.139"></a><span id="l35.139">         HandleCustomFlags(uidOfMessage, dbHdr, supportedUserFlags, keywords);</span>
<a href="#l35.140"></a><span id="l35.140"> </span>
<a href="#l35.141"></a><span id="l35.141">     NotifyMessageFlagsFromHdr(dbHdr, uidOfMessage, flags);</span>
<a href="#l35.142"></a><span id="l35.142">   }</span>
<a href="#l35.143"></a><span id="l35.143">   if (!partialUIDFetch &amp;&amp; newFolderSize != mFolderSize)</span>
<a href="#l35.144"></a><span id="l35.144">   {</span>
<a href="#l35.145"></a><span id="l35.145">     int64_t oldFolderSize = mFolderSize;</span>
<a href="#l35.146"></a><span id="l35.146">     mFolderSize = newFolderSize;</span>
<a href="#l35.147"></a><span id="l35.147" class="difflineminus">-    NotifyIntPropertyChanged(kFolderSizeAtom, oldFolderSize, mFolderSize);</span>
<a href="#l35.148"></a><span id="l35.148" class="difflineplus">+    NotifyIntPropertyChanged(kFolderSize, oldFolderSize, mFolderSize);</span>
<a href="#l35.149"></a><span id="l35.149">   }</span>
<a href="#l35.150"></a><span id="l35.150"> </span>
<a href="#l35.151"></a><span id="l35.151">   return NS_OK;</span>
<a href="#l35.152"></a><span id="l35.152"> }</span>
<a href="#l35.153"></a><span id="l35.153"> </span>
<a href="#l35.154"></a><span id="l35.154"> // helper routine to sync the flags on a given header</span>
<a href="#l35.155"></a><span id="l35.155"> nsresult</span>
<a href="#l35.156"></a><span id="l35.156"> nsImapMailFolder::NotifyMessageFlagsFromHdr(nsIMsgDBHdr *dbHdr,</span>
<a href="#l35.157"></a><span id="l35.157" class="difflineat">@@ -5296,17 +5293,17 @@ nsImapMailFolder::OnStopRunningUrl(nsIUR</span>
<a href="#l35.158"></a><span id="l35.158">                   srcDB-&gt;DeleteMessages(srcKeyArray.Length(), srcKeyArray.Elements(), nullptr);</span>
<a href="#l35.159"></a><span id="l35.159">                 }</span>
<a href="#l35.160"></a><span id="l35.160">                 else</span>
<a href="#l35.161"></a><span id="l35.161">                   MarkMessagesImapDeleted(&amp;srcKeyArray, true, srcDB);</span>
<a href="#l35.162"></a><span id="l35.162">               }</span>
<a href="#l35.163"></a><span id="l35.163">               srcFolder-&gt;EnableNotifications(allMessageCountNotifications, true);</span>
<a href="#l35.164"></a><span id="l35.164">               // even if we're showing deleted messages,</span>
<a href="#l35.165"></a><span id="l35.165">               // we still need to notify FE so it will show the imap deleted flag</span>
<a href="#l35.166"></a><span id="l35.166" class="difflineminus">-              srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgCompletedAtom);</span>
<a href="#l35.167"></a><span id="l35.167" class="difflineplus">+              srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgCompleted);</span>
<a href="#l35.168"></a><span id="l35.168">               // is there a way to see that we think we have new msgs?</span>
<a href="#l35.169"></a><span id="l35.169">               nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l35.170"></a><span id="l35.170">               if (NS_SUCCEEDED(rv))</span>
<a href="#l35.171"></a><span id="l35.171">               {</span>
<a href="#l35.172"></a><span id="l35.172">                 bool showPreviewText;</span>
<a href="#l35.173"></a><span id="l35.173">                 prefBranch-&gt;GetBoolPref(&quot;mail.biff.alert.show_preview&quot;, &amp;showPreviewText);</span>
<a href="#l35.174"></a><span id="l35.174">                 // if we're showing preview text, update ourselves if we got a new unread</span>
<a href="#l35.175"></a><span id="l35.175">                 // message copied so that we can download the new headers and have a chance</span>
<a href="#l35.176"></a><span id="l35.176" class="difflineat">@@ -5314,17 +5311,17 @@ nsImapMailFolder::OnStopRunningUrl(nsIUR</span>
<a href="#l35.177"></a><span id="l35.177">                 if (!folderOpen &amp;&amp; showPreviewText &amp;&amp; m_copyState-&gt;m_unreadCount &gt; 0</span>
<a href="#l35.178"></a><span id="l35.178">                     &amp;&amp; ! (mFlags &amp; (nsMsgFolderFlags::Trash | nsMsgFolderFlags::Junk)))</span>
<a href="#l35.179"></a><span id="l35.179">                   UpdateFolder(msgWindow);</span>
<a href="#l35.180"></a><span id="l35.180">               }</span>
<a href="#l35.181"></a><span id="l35.181">             }</span>
<a href="#l35.182"></a><span id="l35.182">             else</span>
<a href="#l35.183"></a><span id="l35.183">             {</span>
<a href="#l35.184"></a><span id="l35.184">               srcFolder-&gt;EnableNotifications(allMessageCountNotifications, true);</span>
<a href="#l35.185"></a><span id="l35.185" class="difflineminus">-              srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l35.186"></a><span id="l35.186" class="difflineplus">+              srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgFailed);</span>
<a href="#l35.187"></a><span id="l35.187">             }</span>
<a href="#l35.188"></a><span id="l35.188"> </span>
<a href="#l35.189"></a><span id="l35.189">           }</span>
<a href="#l35.190"></a><span id="l35.190">           if (m_copyState-&gt;m_msgWindow &amp;&amp;</span>
<a href="#l35.191"></a><span id="l35.191">               m_copyState-&gt;m_undoMsgTxn &amp;&amp;  // may be null from filters</span>
<a href="#l35.192"></a><span id="l35.192">               NS_SUCCEEDED(aExitCode))      //we should do this only if move/copy succeeds</span>
<a href="#l35.193"></a><span id="l35.193">           {</span>
<a href="#l35.194"></a><span id="l35.194">             nsCOMPtr&lt;nsITransactionManager&gt; txnMgr;</span>
<a href="#l35.195"></a><span id="l35.195" class="difflineat">@@ -5481,19 +5478,17 @@ nsImapMailFolder::OnStopRunningUrl(nsIUR</span>
<a href="#l35.196"></a><span id="l35.196">               copyService-&gt;NotifyCompletion(m_copyState-&gt;m_srcSupport, destFolder, aExitCode);</span>
<a href="#l35.197"></a><span id="l35.197">           }</span>
<a href="#l35.198"></a><span id="l35.198">           m_copyState = nullptr;</span>
<a href="#l35.199"></a><span id="l35.199">         }</span>
<a href="#l35.200"></a><span id="l35.200">         break;</span>
<a href="#l35.201"></a><span id="l35.201">       case nsIImapUrl::nsImapRenameFolder:</span>
<a href="#l35.202"></a><span id="l35.202">         if (NS_FAILED(aExitCode))</span>
<a href="#l35.203"></a><span id="l35.203">         {</span>
<a href="#l35.204"></a><span id="l35.204" class="difflineminus">-          nsCOMPtr &lt;nsIAtom&gt; folderRenameAtom;</span>
<a href="#l35.205"></a><span id="l35.205" class="difflineminus">-          folderRenameAtom = MsgGetAtom(&quot;RenameCompleted&quot;);</span>
<a href="#l35.206"></a><span id="l35.206" class="difflineminus">-          NotifyFolderEvent(folderRenameAtom);</span>
<a href="#l35.207"></a><span id="l35.207" class="difflineplus">+          NotifyFolderEvent(kRenameCompleted);</span>
<a href="#l35.208"></a><span id="l35.208">         }</span>
<a href="#l35.209"></a><span id="l35.209">         break;</span>
<a href="#l35.210"></a><span id="l35.210">       case nsIImapUrl::nsImapDeleteAllMsgs:</span>
<a href="#l35.211"></a><span id="l35.211">           if (NS_SUCCEEDED(aExitCode))</span>
<a href="#l35.212"></a><span id="l35.212">           {</span>
<a href="#l35.213"></a><span id="l35.213">             if (folderOpen)</span>
<a href="#l35.214"></a><span id="l35.214">               UpdateFolder(msgWindow);</span>
<a href="#l35.215"></a><span id="l35.215">             else</span>
<a href="#l35.216"></a><span id="l35.216" class="difflineat">@@ -5527,19 +5522,17 @@ nsImapMailFolder::OnStopRunningUrl(nsIUR</span>
<a href="#l35.217"></a><span id="l35.217">       case nsIImapUrl::nsImapRefreshFolderUrls:</span>
<a href="#l35.218"></a><span id="l35.218">         // we finished getting an admin url for the folder.</span>
<a href="#l35.219"></a><span id="l35.219">           if (!m_adminUrl.IsEmpty())</span>
<a href="#l35.220"></a><span id="l35.220">             FolderPrivileges(msgWindow);</span>
<a href="#l35.221"></a><span id="l35.221">           break;</span>
<a href="#l35.222"></a><span id="l35.222">       case nsIImapUrl::nsImapCreateFolder:</span>
<a href="#l35.223"></a><span id="l35.223">         if (NS_FAILED(aExitCode))  //if success notification already done</span>
<a href="#l35.224"></a><span id="l35.224">         {</span>
<a href="#l35.225"></a><span id="l35.225" class="difflineminus">-          nsCOMPtr &lt;nsIAtom&gt; folderCreateAtom;</span>
<a href="#l35.226"></a><span id="l35.226" class="difflineminus">-          folderCreateAtom = MsgGetAtom(&quot;FolderCreateFailed&quot;);</span>
<a href="#l35.227"></a><span id="l35.227" class="difflineminus">-          NotifyFolderEvent(folderCreateAtom);</span>
<a href="#l35.228"></a><span id="l35.228" class="difflineplus">+          NotifyFolderEvent(kFolderCreateFailed);</span>
<a href="#l35.229"></a><span id="l35.229">         }</span>
<a href="#l35.230"></a><span id="l35.230">         break;</span>
<a href="#l35.231"></a><span id="l35.231">       case nsIImapUrl::nsImapSubscribe:</span>
<a href="#l35.232"></a><span id="l35.232">         if (NS_SUCCEEDED(aExitCode) &amp;&amp; msgWindow)</span>
<a href="#l35.233"></a><span id="l35.233">         {</span>
<a href="#l35.234"></a><span id="l35.234">           nsCString canonicalFolderName;</span>
<a href="#l35.235"></a><span id="l35.235">           imapUrl-&gt;CreateCanonicalSourceFolderPathString(getter_Copies(canonicalFolderName));</span>
<a href="#l35.236"></a><span id="l35.236">           nsCOMPtr &lt;nsIMsgFolder&gt; rootFolder;</span>
<a href="#l35.237"></a><span id="l35.237" class="difflineat">@@ -6812,17 +6805,17 @@ nsImapMailFolder::CopyNextStreamMessage(</span>
<a href="#l35.238"></a><span id="l35.238">       if (NS_SUCCEEDED(rv) &amp;&amp; srcFolder)</span>
<a href="#l35.239"></a><span id="l35.239">       {</span>
<a href="#l35.240"></a><span id="l35.240">         srcFolder-&gt;DeleteMessages(mailCopyState-&gt;m_messages, nullptr,</span>
<a href="#l35.241"></a><span id="l35.241">           true, true, nullptr, false);</span>
<a href="#l35.242"></a><span id="l35.242">         // we want to send this notification after the source messages have</span>
<a href="#l35.243"></a><span id="l35.243">         // been deleted.</span>
<a href="#l35.244"></a><span id="l35.244">         nsCOMPtr&lt;nsIMsgLocalMailFolder&gt; popFolder(do_QueryInterface(srcFolder));</span>
<a href="#l35.245"></a><span id="l35.245">         if (popFolder)   //needed if move pop-&gt;imap to notify FE</span>
<a href="#l35.246"></a><span id="l35.246" class="difflineminus">-          srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgCompletedAtom);</span>
<a href="#l35.247"></a><span id="l35.247" class="difflineplus">+          srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgCompleted);</span>
<a href="#l35.248"></a><span id="l35.248">       }</span>
<a href="#l35.249"></a><span id="l35.249">     }</span>
<a href="#l35.250"></a><span id="l35.250">   }</span>
<a href="#l35.251"></a><span id="l35.251">   if (NS_FAILED(rv))</span>
<a href="#l35.252"></a><span id="l35.252">     (void) OnCopyCompleted(mailCopyState-&gt;m_srcSupport, rv);</span>
<a href="#l35.253"></a><span id="l35.253"> </span>
<a href="#l35.254"></a><span id="l35.254">   return rv;</span>
<a href="#l35.255"></a><span id="l35.255"> }</span>
<a href="#l35.256"></a><span id="l35.256" class="difflineat">@@ -7423,18 +7416,18 @@ nsresult nsImapMailFolder::CopyMessagesO</span>
<a href="#l35.257"></a><span id="l35.257">     srcFolder-&gt;EnableNotifications(nsIMsgFolder::allMessageCountNotifications, true);</span>
<a href="#l35.258"></a><span id="l35.258">   }</span>
<a href="#l35.259"></a><span id="l35.259"> </span>
<a href="#l35.260"></a><span id="l35.260">   nsCOMPtr&lt;nsISupports&gt; srcSupport = do_QueryInterface(srcFolder);</span>
<a href="#l35.261"></a><span id="l35.261">   OnCopyCompleted(srcSupport, rv);</span>
<a href="#l35.262"></a><span id="l35.262"> </span>
<a href="#l35.263"></a><span id="l35.263">   if (isMove)</span>
<a href="#l35.264"></a><span id="l35.264">     srcFolder-&gt;NotifyFolderEvent(NS_SUCCEEDED(rv) ?</span>
<a href="#l35.265"></a><span id="l35.265" class="difflineminus">-                                 mDeleteOrMoveMsgCompletedAtom :</span>
<a href="#l35.266"></a><span id="l35.266" class="difflineminus">-                                 mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l35.267"></a><span id="l35.267" class="difflineplus">+                                 kDeleteOrMoveMsgCompleted :</span>
<a href="#l35.268"></a><span id="l35.268" class="difflineplus">+                                 kDeleteOrMoveMsgFailed);</span>
<a href="#l35.269"></a><span id="l35.269">   return rv;</span>
<a href="#l35.270"></a><span id="l35.270"> }</span>
<a href="#l35.271"></a><span id="l35.271"> </span>
<a href="#l35.272"></a><span id="l35.272"> void nsImapMailFolder::SetPendingAttributes(nsIArray* messages, bool aIsMove)</span>
<a href="#l35.273"></a><span id="l35.273"> {</span>
<a href="#l35.274"></a><span id="l35.274"> </span>
<a href="#l35.275"></a><span id="l35.275">   GetDatabase();</span>
<a href="#l35.276"></a><span id="l35.276">   if (!mDatabase)</span>
<a href="#l35.277"></a><span id="l35.277" class="difflineat">@@ -7709,17 +7702,17 @@ nsImapMailFolder::CopyMessages(nsIMsgFol</span>
<a href="#l35.278"></a><span id="l35.278">   </span>
<a href="#l35.279"></a><span id="l35.279"> done:</span>
<a href="#l35.280"></a><span id="l35.280">   if (NS_FAILED(rv))</span>
<a href="#l35.281"></a><span id="l35.281">   {</span>
<a href="#l35.282"></a><span id="l35.282">     (void) OnCopyCompleted(srcSupport, rv);</span>
<a href="#l35.283"></a><span id="l35.283">     if (isMove)</span>
<a href="#l35.284"></a><span id="l35.284">     {</span>
<a href="#l35.285"></a><span id="l35.285">       srcFolder-&gt;EnableNotifications(allMessageCountNotifications, true);  //enable message count notification</span>
<a href="#l35.286"></a><span id="l35.286" class="difflineminus">-      NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l35.287"></a><span id="l35.287" class="difflineplus">+      NotifyFolderEvent(kDeleteOrMoveMsgFailed);</span>
<a href="#l35.288"></a><span id="l35.288">     }</span>
<a href="#l35.289"></a><span id="l35.289">   }</span>
<a href="#l35.290"></a><span id="l35.290">   return rv;</span>
<a href="#l35.291"></a><span id="l35.291"> }</span>
<a href="#l35.292"></a><span id="l35.292"> </span>
<a href="#l35.293"></a><span id="l35.293"> class nsImapFolderCopyState final : public nsIUrlListener, public nsIMsgCopyServiceListener</span>
<a href="#l35.294"></a><span id="l35.294"> {</span>
<a href="#l35.295"></a><span id="l35.295"> public:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -427,30 +427,30 @@ nsMsgLocalMailFolder::UpdateFolder(nsIMs</span>
<a href="#l36.4"></a><span id="l36.4">   if (!mDatabase)</span>
<a href="#l36.5"></a><span id="l36.5">   {</span>
<a href="#l36.6"></a><span id="l36.6">     // return of NS_ERROR_NOT_INITIALIZED means running parsing URL</span>
<a href="#l36.7"></a><span id="l36.7">     // We don't need the return value, and assigning it to mDatabase which</span>
<a href="#l36.8"></a><span id="l36.8">     // is already set internally leaks.</span>
<a href="#l36.9"></a><span id="l36.9">     nsCOMPtr&lt;nsIMsgDatabase&gt; returnedDb;</span>
<a href="#l36.10"></a><span id="l36.10">     rv = GetDatabaseWithReparse(this, aWindow, getter_AddRefs(returnedDb));</span>
<a href="#l36.11"></a><span id="l36.11">     if (NS_SUCCEEDED(rv))</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-      NotifyFolderEvent(mFolderLoadedAtom);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+      NotifyFolderEvent(kFolderLoaded);</span>
<a href="#l36.14"></a><span id="l36.14">   }</span>
<a href="#l36.15"></a><span id="l36.15">   else</span>
<a href="#l36.16"></a><span id="l36.16">   {</span>
<a href="#l36.17"></a><span id="l36.17">     bool valid;</span>
<a href="#l36.18"></a><span id="l36.18">     rv = mDatabase-&gt;GetSummaryValid(&amp;valid);</span>
<a href="#l36.19"></a><span id="l36.19">     // don't notify folder loaded or try compaction if db isn't valid</span>
<a href="#l36.20"></a><span id="l36.20">     // (we're probably reparsing or copying msgs to it)</span>
<a href="#l36.21"></a><span id="l36.21">     if (NS_SUCCEEDED(rv) &amp;&amp; valid)</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineminus">-      NotifyFolderEvent(mFolderLoadedAtom);</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineplus">+      NotifyFolderEvent(kFolderLoaded);</span>
<a href="#l36.24"></a><span id="l36.24">     else if (mCopyState)</span>
<a href="#l36.25"></a><span id="l36.25">       mCopyState-&gt;m_notifyFolderLoaded = true; //defer folder loaded notification</span>
<a href="#l36.26"></a><span id="l36.26">     else if (!m_parsingFolder)// if the db was already open, it's probably OK to load it if not parsing</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineminus">-      NotifyFolderEvent(mFolderLoadedAtom);</span>
<a href="#l36.28"></a><span id="l36.28" class="difflineplus">+      NotifyFolderEvent(kFolderLoaded);</span>
<a href="#l36.29"></a><span id="l36.29">   }</span>
<a href="#l36.30"></a><span id="l36.30">   bool filtersRun;</span>
<a href="#l36.31"></a><span id="l36.31">   bool hasNewMessages;</span>
<a href="#l36.32"></a><span id="l36.32">   GetHasNewMessages(&amp;hasNewMessages);</span>
<a href="#l36.33"></a><span id="l36.33">   if (mDatabase)</span>
<a href="#l36.34"></a><span id="l36.34">     ApplyRetentionSettings();</span>
<a href="#l36.35"></a><span id="l36.35">   // if we have new messages, try the filter plugins.</span>
<a href="#l36.36"></a><span id="l36.36">   if (NS_SUCCEEDED(rv) &amp;&amp; hasNewMessages)</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineat">@@ -941,18 +941,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::Rena</span>
<a href="#l36.38"></a><span id="l36.38">       newFolder-&gt;SetFlags(mFlags);</span>
<a href="#l36.39"></a><span id="l36.39">       if (parentFolder)</span>
<a href="#l36.40"></a><span id="l36.40">       {</span>
<a href="#l36.41"></a><span id="l36.41">         SetParent(nullptr);</span>
<a href="#l36.42"></a><span id="l36.42">         parentFolder-&gt;PropagateDelete(this, false, msgWindow);</span>
<a href="#l36.43"></a><span id="l36.43">         parentFolder-&gt;NotifyItemAdded(newFolder);</span>
<a href="#l36.44"></a><span id="l36.44">       }</span>
<a href="#l36.45"></a><span id="l36.45">       SetFilePath(nullptr); // forget our path, since this folder object renamed itself</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineminus">-      nsCOMPtr&lt;nsIAtom&gt; folderRenameAtom = MsgGetAtom(&quot;RenameCompleted&quot;);</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-      newFolder-&gt;NotifyFolderEvent(folderRenameAtom);</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineplus">+      newFolder-&gt;NotifyFolderEvent(kRenameCompleted);</span>
<a href="#l36.49"></a><span id="l36.49"> </span>
<a href="#l36.50"></a><span id="l36.50">       nsCOMPtr&lt;nsIMsgFolderNotificationService&gt; notifier(do_GetService(NS_MSGNOTIFICATIONSERVICE_CONTRACTID));</span>
<a href="#l36.51"></a><span id="l36.51">       if (notifier)</span>
<a href="#l36.52"></a><span id="l36.52">         notifier-&gt;NotifyFolderRenamed(this, newFolder);</span>
<a href="#l36.53"></a><span id="l36.53">     }</span>
<a href="#l36.54"></a><span id="l36.54">   return rv;</span>
<a href="#l36.55"></a><span id="l36.55"> }</span>
<a href="#l36.56"></a><span id="l36.56"> </span>
<a href="#l36.57"></a><span id="l36.57" class="difflineat">@@ -1111,17 +1110,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::GetD</span>
<a href="#l36.58"></a><span id="l36.58"> }</span>
<a href="#l36.59"></a><span id="l36.59"> </span>
<a href="#l36.60"></a><span id="l36.60"> NS_IMETHODIMP nsMsgLocalMailFolder::RefreshSizeOnDisk()</span>
<a href="#l36.61"></a><span id="l36.61"> {</span>
<a href="#l36.62"></a><span id="l36.62">   int64_t oldFolderSize = mFolderSize;</span>
<a href="#l36.63"></a><span id="l36.63">   // we set this to unknown to force it to get recalculated from disk</span>
<a href="#l36.64"></a><span id="l36.64">   mFolderSize = kSizeUnknown;</span>
<a href="#l36.65"></a><span id="l36.65">   if (NS_SUCCEEDED(GetSizeOnDisk(&amp;mFolderSize)))</span>
<a href="#l36.66"></a><span id="l36.66" class="difflineminus">-    NotifyIntPropertyChanged(kFolderSizeAtom, oldFolderSize, mFolderSize);</span>
<a href="#l36.67"></a><span id="l36.67" class="difflineplus">+    NotifyIntPropertyChanged(kFolderSize, oldFolderSize, mFolderSize);</span>
<a href="#l36.68"></a><span id="l36.68">   return NS_OK;</span>
<a href="#l36.69"></a><span id="l36.69"> }</span>
<a href="#l36.70"></a><span id="l36.70"> </span>
<a href="#l36.71"></a><span id="l36.71"> NS_IMETHODIMP nsMsgLocalMailFolder::GetSizeOnDisk(int64_t *aSize)</span>
<a href="#l36.72"></a><span id="l36.72"> {</span>
<a href="#l36.73"></a><span id="l36.73">   NS_ENSURE_ARG_POINTER(aSize);</span>
<a href="#l36.74"></a><span id="l36.74"> </span>
<a href="#l36.75"></a><span id="l36.75">   bool isServer = false;</span>
<a href="#l36.76"></a><span id="l36.76" class="difflineat">@@ -1233,17 +1232,17 @@ nsMsgLocalMailFolder::DeleteMessages(nsI</span>
<a href="#l36.77"></a><span id="l36.77">       else if (rv == NS_MSG_FOLDER_BUSY)</span>
<a href="#l36.78"></a><span id="l36.78">         ThrowAlertMsg(&quot;deletingMsgsFailed&quot;, msgWindow);</span>
<a href="#l36.79"></a><span id="l36.79"> </span>
<a href="#l36.80"></a><span id="l36.80">       // we are the source folder here for a move or shift delete</span>
<a href="#l36.81"></a><span id="l36.81">       //enable notifications because that will close the file stream</span>
<a href="#l36.82"></a><span id="l36.82">       // we've been caching, mark the db as valid, and commit it.</span>
<a href="#l36.83"></a><span id="l36.83">       EnableNotifications(allMessageCountNotifications, true);</span>
<a href="#l36.84"></a><span id="l36.84">       if (!isMove)</span>
<a href="#l36.85"></a><span id="l36.85" class="difflineminus">-        NotifyFolderEvent(NS_SUCCEEDED(rv) ? mDeleteOrMoveMsgCompletedAtom : mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l36.86"></a><span id="l36.86" class="difflineplus">+        NotifyFolderEvent(NS_SUCCEEDED(rv) ? kDeleteOrMoveMsgCompleted : kDeleteOrMoveMsgFailed);</span>
<a href="#l36.87"></a><span id="l36.87">       if (msgWindow &amp;&amp; !isMove)</span>
<a href="#l36.88"></a><span id="l36.88">         AutoCompact(msgWindow);</span>
<a href="#l36.89"></a><span id="l36.89">     }</span>
<a href="#l36.90"></a><span id="l36.90">   }</span>
<a href="#l36.91"></a><span id="l36.91"> </span>
<a href="#l36.92"></a><span id="l36.92">   if (msgWindow &amp;&amp; !isMove &amp;&amp; (deleteStorage || isTrashFolder)) {</span>
<a href="#l36.93"></a><span id="l36.93">     // Clear undo and redo stack.</span>
<a href="#l36.94"></a><span id="l36.94">     nsCOMPtr&lt;nsITransactionManager&gt; txnMgr;</span>
<a href="#l36.95"></a><span id="l36.95" class="difflineat">@@ -1448,17 +1447,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::OnAn</span>
<a href="#l36.96"></a><span id="l36.96">     mCopyState-&gt;m_destDB = nullptr;</span>
<a href="#l36.97"></a><span id="l36.97">   return nsMsgDBFolder::OnAnnouncerGoingAway(instigator);</span>
<a href="#l36.98"></a><span id="l36.98"> }</span>
<a href="#l36.99"></a><span id="l36.99"> </span>
<a href="#l36.100"></a><span id="l36.100"> NS_IMETHODIMP</span>
<a href="#l36.101"></a><span id="l36.101"> nsMsgLocalMailFolder::OnCopyCompleted(nsISupports *srcSupport, bool moveCopySucceeded)</span>
<a href="#l36.102"></a><span id="l36.102"> {</span>
<a href="#l36.103"></a><span id="l36.103">   if (mCopyState &amp;&amp; mCopyState-&gt;m_notifyFolderLoaded)</span>
<a href="#l36.104"></a><span id="l36.104" class="difflineminus">-    NotifyFolderEvent(mFolderLoadedAtom);</span>
<a href="#l36.105"></a><span id="l36.105" class="difflineplus">+    NotifyFolderEvent(kFolderLoaded);</span>
<a href="#l36.106"></a><span id="l36.106"> </span>
<a href="#l36.107"></a><span id="l36.107">   (void) RefreshSizeOnDisk();</span>
<a href="#l36.108"></a><span id="l36.108">   // we are the destination folder for a move/copy</span>
<a href="#l36.109"></a><span id="l36.109">   bool haveSemaphore;</span>
<a href="#l36.110"></a><span id="l36.110">   nsresult rv = TestSemaphore(static_cast&lt;nsIMsgLocalMailFolder*&gt;(this), &amp;haveSemaphore);</span>
<a href="#l36.111"></a><span id="l36.111">   if (NS_SUCCEEDED(rv) &amp;&amp; haveSemaphore)</span>
<a href="#l36.112"></a><span id="l36.112">     ReleaseSemaphore(static_cast&lt;nsIMsgLocalMailFolder*&gt;(this));</span>
<a href="#l36.113"></a><span id="l36.113"> </span>
<a href="#l36.114"></a><span id="l36.114" class="difflineat">@@ -1489,17 +1488,17 @@ bool nsMsgLocalMailFolder::CheckIfSpaceF</span>
<a href="#l36.115"></a><span id="l36.115">                                                  bool isMove,</span>
<a href="#l36.116"></a><span id="l36.116">                                                  int64_t totalMsgSize)</span>
<a href="#l36.117"></a><span id="l36.117"> {</span>
<a href="#l36.118"></a><span id="l36.118">   bool spaceNotAvailable = true;</span>
<a href="#l36.119"></a><span id="l36.119">   nsresult rv = WarnIfLocalFileTooBig(msgWindow, totalMsgSize, &amp;spaceNotAvailable);</span>
<a href="#l36.120"></a><span id="l36.120">   if (NS_FAILED(rv) || spaceNotAvailable)</span>
<a href="#l36.121"></a><span id="l36.121">   {</span>
<a href="#l36.122"></a><span id="l36.122">     if (isMove &amp;&amp; srcFolder)</span>
<a href="#l36.123"></a><span id="l36.123" class="difflineminus">-      srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l36.124"></a><span id="l36.124" class="difflineplus">+      srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgFailed);</span>
<a href="#l36.125"></a><span id="l36.125">     OnCopyCompleted(srcSupports, false);</span>
<a href="#l36.126"></a><span id="l36.126">     return false;</span>
<a href="#l36.127"></a><span id="l36.127">   }</span>
<a href="#l36.128"></a><span id="l36.128">   return true;</span>
<a href="#l36.129"></a><span id="l36.129"> }</span>
<a href="#l36.130"></a><span id="l36.130"> </span>
<a href="#l36.131"></a><span id="l36.131"> NS_IMETHODIMP</span>
<a href="#l36.132"></a><span id="l36.132"> nsMsgLocalMailFolder::CopyMessages(nsIMsgFolder* srcFolder, nsIArray*</span>
<a href="#l36.133"></a><span id="l36.133" class="difflineat">@@ -1510,17 +1509,17 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l36.134"></a><span id="l36.134"> {</span>
<a href="#l36.135"></a><span id="l36.135">   nsCOMPtr&lt;nsISupports&gt; srcSupport = do_QueryInterface(srcFolder);</span>
<a href="#l36.136"></a><span id="l36.136">   bool isServer;</span>
<a href="#l36.137"></a><span id="l36.137">   nsresult rv = GetIsServer(&amp;isServer);</span>
<a href="#l36.138"></a><span id="l36.138">   if (NS_SUCCEEDED(rv) &amp;&amp; isServer)</span>
<a href="#l36.139"></a><span id="l36.139">   {</span>
<a href="#l36.140"></a><span id="l36.140">     NS_ERROR(&quot;Destination is the root folder. Cannot move/copy here&quot;);</span>
<a href="#l36.141"></a><span id="l36.141">     if (isMove)</span>
<a href="#l36.142"></a><span id="l36.142" class="difflineminus">-      srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l36.143"></a><span id="l36.143" class="difflineplus">+      srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgFailed);</span>
<a href="#l36.144"></a><span id="l36.144">     return OnCopyCompleted(srcSupport, false);</span>
<a href="#l36.145"></a><span id="l36.145">   }</span>
<a href="#l36.146"></a><span id="l36.146"> </span>
<a href="#l36.147"></a><span id="l36.147">   UpdateTimestamps(allowUndo);</span>
<a href="#l36.148"></a><span id="l36.148">   nsCString protocolType;</span>
<a href="#l36.149"></a><span id="l36.149">   rv = srcFolder-&gt;GetURI(protocolType);</span>
<a href="#l36.150"></a><span id="l36.150">   protocolType.SetLength(protocolType.FindChar(':'));</span>
<a href="#l36.151"></a><span id="l36.151"> </span>
<a href="#l36.152"></a><span id="l36.152" class="difflineat">@@ -1547,17 +1546,17 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l36.153"></a><span id="l36.153">       if (needOfflineBody)</span>
<a href="#l36.154"></a><span id="l36.154">       {</span>
<a href="#l36.155"></a><span id="l36.155">         bool hasMsgOffline = false;</span>
<a href="#l36.156"></a><span id="l36.156">         message-&gt;GetMessageKey(&amp;key);</span>
<a href="#l36.157"></a><span id="l36.157">         srcFolder-&gt;HasMsgOffline(key, &amp;hasMsgOffline);</span>
<a href="#l36.158"></a><span id="l36.158">         if (!hasMsgOffline)</span>
<a href="#l36.159"></a><span id="l36.159">         {</span>
<a href="#l36.160"></a><span id="l36.160">           if (isMove)</span>
<a href="#l36.161"></a><span id="l36.161" class="difflineminus">-            srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l36.162"></a><span id="l36.162" class="difflineplus">+            srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgFailed);</span>
<a href="#l36.163"></a><span id="l36.163">           ThrowAlertMsg(&quot;cantMoveMsgWOBodyOffline&quot;, msgWindow);</span>
<a href="#l36.164"></a><span id="l36.164">           return OnCopyCompleted(srcSupport, false);</span>
<a href="#l36.165"></a><span id="l36.165">         }</span>
<a href="#l36.166"></a><span id="l36.166">       }</span>
<a href="#l36.167"></a><span id="l36.167">     }</span>
<a href="#l36.168"></a><span id="l36.168">   }</span>
<a href="#l36.169"></a><span id="l36.169"> </span>
<a href="#l36.170"></a><span id="l36.170">   if (!CheckIfSpaceForCopy(msgWindow, srcFolder, srcSupport, isMove,</span>
<a href="#l36.171"></a><span id="l36.171" class="difflineat">@@ -1580,18 +1579,18 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l36.172"></a><span id="l36.172">     if (msgWindow &amp;&amp; undoTxn)</span>
<a href="#l36.173"></a><span id="l36.173">     {</span>
<a href="#l36.174"></a><span id="l36.174">       nsCOMPtr&lt;nsITransactionManager&gt; txnMgr;</span>
<a href="#l36.175"></a><span id="l36.175">       msgWindow-&gt;GetTransactionManager(getter_AddRefs(txnMgr));</span>
<a href="#l36.176"></a><span id="l36.176">       if (txnMgr)</span>
<a href="#l36.177"></a><span id="l36.177">         txnMgr-&gt;DoTransaction(undoTxn);</span>
<a href="#l36.178"></a><span id="l36.178">     }</span>
<a href="#l36.179"></a><span id="l36.179">     if (isMove)</span>
<a href="#l36.180"></a><span id="l36.180" class="difflineminus">-      srcFolder-&gt;NotifyFolderEvent(NS_SUCCEEDED(rv) ? mDeleteOrMoveMsgCompletedAtom :</span>
<a href="#l36.181"></a><span id="l36.181" class="difflineminus">-                                                      mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l36.182"></a><span id="l36.182" class="difflineplus">+      srcFolder-&gt;NotifyFolderEvent(NS_SUCCEEDED(rv) ? kDeleteOrMoveMsgCompleted :</span>
<a href="#l36.183"></a><span id="l36.183" class="difflineplus">+                                                      kDeleteOrMoveMsgFailed);</span>
<a href="#l36.184"></a><span id="l36.184"> </span>
<a href="#l36.185"></a><span id="l36.185">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l36.186"></a><span id="l36.186">       // If the store did the copy, like maildir, we need to mark messages on the server.</span>
<a href="#l36.187"></a><span id="l36.187">       // Otherwise that's done in EndMove().</span>
<a href="#l36.188"></a><span id="l36.188">       nsCOMPtr &lt;nsIMsgLocalMailFolder&gt; localDstFolder;</span>
<a href="#l36.189"></a><span id="l36.189">       QueryInterface(NS_GET_IID(nsIMsgLocalMailFolder), getter_AddRefs(localDstFolder));</span>
<a href="#l36.190"></a><span id="l36.190">       if (localDstFolder)</span>
<a href="#l36.191"></a><span id="l36.191">       {</span>
<a href="#l36.192"></a><span id="l36.192" class="difflineat">@@ -1707,17 +1706,17 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l36.193"></a><span id="l36.193">         (void) OnCopyCompleted(srcSupport, false);</span>
<a href="#l36.194"></a><span id="l36.194">       }</span>
<a href="#l36.195"></a><span id="l36.195">     }</span>
<a href="#l36.196"></a><span id="l36.196">   }</span>
<a href="#l36.197"></a><span id="l36.197">   // if this failed immediately, need to turn back on notifications and inform FE.</span>
<a href="#l36.198"></a><span id="l36.198">   if (NS_FAILED(rv))</span>
<a href="#l36.199"></a><span id="l36.199">   {</span>
<a href="#l36.200"></a><span id="l36.200">     if (isMove)</span>
<a href="#l36.201"></a><span id="l36.201" class="difflineminus">-      srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l36.202"></a><span id="l36.202" class="difflineplus">+      srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgFailed);</span>
<a href="#l36.203"></a><span id="l36.203">     EnableNotifications(allMessageCountNotifications, true);</span>
<a href="#l36.204"></a><span id="l36.204">   }</span>
<a href="#l36.205"></a><span id="l36.205">   return rv;</span>
<a href="#l36.206"></a><span id="l36.206"> }</span>
<a href="#l36.207"></a><span id="l36.207"> // for srcFolder that are on different server than the dstFolder.</span>
<a href="#l36.208"></a><span id="l36.208"> // &quot;this&quot; is the parent of the new dest folder.</span>
<a href="#l36.209"></a><span id="l36.209"> nsresult</span>
<a href="#l36.210"></a><span id="l36.210"> nsMsgLocalMailFolder::CopyFolderAcrossServer(nsIMsgFolder* srcFolder, nsIMsgWindow *msgWindow,</span>
<a href="#l36.211"></a><span id="l36.211" class="difflineat">@@ -2564,18 +2563,18 @@ NS_IMETHODIMP nsMsgLocalMailFolder::EndC</span>
<a href="#l36.212"></a><span id="l36.212">         }</span>
<a href="#l36.213"></a><span id="l36.213"> </span>
<a href="#l36.214"></a><span id="l36.214">         // enable the dest folder</span>
<a href="#l36.215"></a><span id="l36.215">         EnableNotifications(allMessageCountNotifications, true);</span>
<a href="#l36.216"></a><span id="l36.216">         if (srcFolder &amp;&amp; !mCopyState-&gt;m_isFolder)</span>
<a href="#l36.217"></a><span id="l36.217">         {</span>
<a href="#l36.218"></a><span id="l36.218">           // I'm not too sure of the proper location of this event. It seems to need to be</span>
<a href="#l36.219"></a><span id="l36.219">           // after the EnableNotifications, or the folder counts can be incorrect</span>
<a href="#l36.220"></a><span id="l36.220" class="difflineminus">-          // during the mDeleteOrMoveMsgCompletedAtom call.</span>
<a href="#l36.221"></a><span id="l36.221" class="difflineminus">-          srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgCompletedAtom);</span>
<a href="#l36.222"></a><span id="l36.222" class="difflineplus">+          // during the kDeleteOrMoveMsgCompleted call.</span>
<a href="#l36.223"></a><span id="l36.223" class="difflineplus">+          srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgCompleted);</span>
<a href="#l36.224"></a><span id="l36.224">         }</span>
<a href="#l36.225"></a><span id="l36.225">         (void) OnCopyCompleted(mCopyState-&gt;m_srcSupport, true);</span>
<a href="#l36.226"></a><span id="l36.226">       }</span>
<a href="#l36.227"></a><span id="l36.227">     }</span>
<a href="#l36.228"></a><span id="l36.228">     // Send the itemAdded notification in case we didn't send the itemMoveCopyCompleted notification earlier.</span>
<a href="#l36.229"></a><span id="l36.229">     // Posting news messages involves this, yet doesn't have the newHdr initialized, so don't send any</span>
<a href="#l36.230"></a><span id="l36.230">     // notifications in that case.</span>
<a href="#l36.231"></a><span id="l36.231">     if (!numHdrs &amp;&amp; newHdr)</span>
<a href="#l36.232"></a><span id="l36.232" class="difflineat">@@ -2621,17 +2620,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::EndM</span>
<a href="#l36.233"></a><span id="l36.233">   if (!mCopyState)</span>
<a href="#l36.234"></a><span id="l36.234">     return NS_OK;</span>
<a href="#l36.235"></a><span id="l36.235"> </span>
<a href="#l36.236"></a><span id="l36.236">   if (!moveSucceeded || mCopyState-&gt;m_writeFailed)</span>
<a href="#l36.237"></a><span id="l36.237">   {</span>
<a href="#l36.238"></a><span id="l36.238">     //Notify that a completion finished.</span>
<a href="#l36.239"></a><span id="l36.239">     nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder = do_QueryInterface(mCopyState-&gt;m_srcSupport, &amp;rv);</span>
<a href="#l36.240"></a><span id="l36.240">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.241"></a><span id="l36.241" class="difflineminus">-    srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l36.242"></a><span id="l36.242" class="difflineplus">+    srcFolder-&gt;NotifyFolderEvent(kDeleteOrMoveMsgFailed);</span>
<a href="#l36.243"></a><span id="l36.243"> </span>
<a href="#l36.244"></a><span id="l36.244">     /* passing true because the messages that have been successfully copied have their corressponding</span>
<a href="#l36.245"></a><span id="l36.245">                hdrs in place. The message that has failed has been truncated so the msf file and berkeley mailbox</span>
<a href="#l36.246"></a><span id="l36.246">                are in sync*/</span>
<a href="#l36.247"></a><span id="l36.247"> </span>
<a href="#l36.248"></a><span id="l36.248">     (void) OnCopyCompleted(mCopyState-&gt;m_srcSupport, true);</span>
<a href="#l36.249"></a><span id="l36.249">     // enable the dest folder</span>
<a href="#l36.250"></a><span id="l36.250">     EnableNotifications(allMessageCountNotifications, true);</span>
<a href="#l36.251"></a><span id="l36.251" class="difflineat">@@ -2660,18 +2659,18 @@ NS_IMETHODIMP nsMsgLocalMailFolder::EndM</span>
<a href="#l36.252"></a><span id="l36.252">     // lets delete these all at once - much faster that way</span>
<a href="#l36.253"></a><span id="l36.253">     rv = srcFolder-&gt;DeleteMessages(mCopyState-&gt;m_messages, mCopyState-&gt;m_msgWindow, true, true, nullptr, mCopyState-&gt;m_allowUndo);</span>
<a href="#l36.254"></a><span id="l36.254">     AutoCompact(mCopyState-&gt;m_msgWindow);</span>
<a href="#l36.255"></a><span id="l36.255"> </span>
<a href="#l36.256"></a><span id="l36.256">     // enable the dest folder</span>
<a href="#l36.257"></a><span id="l36.257">     EnableNotifications(allMessageCountNotifications, true);</span>
<a href="#l36.258"></a><span id="l36.258">     // I'm not too sure of the proper location of this event. It seems to need to be</span>
<a href="#l36.259"></a><span id="l36.259">     // after the EnableNotifications, or the folder counts can be incorrect</span>
<a href="#l36.260"></a><span id="l36.260" class="difflineminus">-    // during the mDeleteOrMoveMsgCompletedAtom call.</span>
<a href="#l36.261"></a><span id="l36.261" class="difflineminus">-    srcFolder-&gt;NotifyFolderEvent(NS_SUCCEEDED(rv) ? mDeleteOrMoveMsgCompletedAtom : mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l36.262"></a><span id="l36.262" class="difflineplus">+    // during the kDeleteOrMoveMsgCompleted call.</span>
<a href="#l36.263"></a><span id="l36.263" class="difflineplus">+    srcFolder-&gt;NotifyFolderEvent(NS_SUCCEEDED(rv) ? kDeleteOrMoveMsgCompleted : kDeleteOrMoveMsgFailed);</span>
<a href="#l36.264"></a><span id="l36.264"> </span>
<a href="#l36.265"></a><span id="l36.265">     if (NS_SUCCEEDED(rv) &amp;&amp; mCopyState-&gt;m_msgWindow &amp;&amp; mCopyState-&gt;m_undoMsgTxn)</span>
<a href="#l36.266"></a><span id="l36.266">     {</span>
<a href="#l36.267"></a><span id="l36.267">       nsCOMPtr&lt;nsITransactionManager&gt; txnMgr;</span>
<a href="#l36.268"></a><span id="l36.268">       mCopyState-&gt;m_msgWindow-&gt;GetTransactionManager(getter_AddRefs(txnMgr));</span>
<a href="#l36.269"></a><span id="l36.269">       if (txnMgr)</span>
<a href="#l36.270"></a><span id="l36.270">         txnMgr-&gt;DoTransaction(mCopyState-&gt;m_undoMsgTxn);</span>
<a href="#l36.271"></a><span id="l36.271">     }</span>
<a href="#l36.272"></a><span id="l36.272" class="difflineat">@@ -3093,17 +3092,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::Down</span>
<a href="#l36.273"></a><span id="l36.273"> </span>
<a href="#l36.274"></a><span id="l36.274">   nsCOMPtr&lt;nsILocalMailIncomingServer&gt; localMailServer = do_QueryInterface(server, &amp;rv);</span>
<a href="#l36.275"></a><span id="l36.275">   NS_ENSURE_SUCCESS(rv, NS_MSG_INVALID_OR_MISSING_SERVER);</span>
<a href="#l36.276"></a><span id="l36.276">   return localMailServer-&gt;GetNewMail(aWindow, this, this, nullptr);</span>
<a href="#l36.277"></a><span id="l36.277"> }</span>
<a href="#l36.278"></a><span id="l36.278"> </span>
<a href="#l36.279"></a><span id="l36.279"> NS_IMETHODIMP nsMsgLocalMailFolder::NotifyDelete()</span>
<a href="#l36.280"></a><span id="l36.280"> {</span>
<a href="#l36.281"></a><span id="l36.281" class="difflineminus">-  NotifyFolderEvent(mDeleteOrMoveMsgCompletedAtom);</span>
<a href="#l36.282"></a><span id="l36.282" class="difflineplus">+  NotifyFolderEvent(kDeleteOrMoveMsgCompleted);</span>
<a href="#l36.283"></a><span id="l36.283">   return NS_OK;</span>
<a href="#l36.284"></a><span id="l36.284"> }</span>
<a href="#l36.285"></a><span id="l36.285"> </span>
<a href="#l36.286"></a><span id="l36.286"> // TODO:  once we move certain code into the IncomingServer (search for TODO)</span>
<a href="#l36.287"></a><span id="l36.287"> // this method will go away.</span>
<a href="#l36.288"></a><span id="l36.288"> // sometimes this gets called when we don't have the server yet, so</span>
<a href="#l36.289"></a><span id="l36.289"> // that's why we're not calling GetServer()</span>
<a href="#l36.290"></a><span id="l36.290"> NS_IMETHODIMP</span>
<a href="#l36.291"></a><span id="l36.291" class="difflineat">@@ -3437,19 +3436,17 @@ NS_IMETHODIMP</span>
<a href="#l36.292"></a><span id="l36.292"> nsMsgLocalMailFolder::NotifyCompactCompleted()</span>
<a href="#l36.293"></a><span id="l36.293"> {</span>
<a href="#l36.294"></a><span id="l36.294">   mExpungedBytes = 0;</span>
<a href="#l36.295"></a><span id="l36.295">   m_newMsgs.Clear(); // if compacted, m_newMsgs probably aren't valid.</span>
<a href="#l36.296"></a><span id="l36.296">   // if compacted, processing flags probably also aren't valid.</span>
<a href="#l36.297"></a><span id="l36.297">   ClearProcessingFlags();</span>
<a href="#l36.298"></a><span id="l36.298">   (void) RefreshSizeOnDisk();</span>
<a href="#l36.299"></a><span id="l36.299">   (void) CloseDBIfFolderNotOpen();</span>
<a href="#l36.300"></a><span id="l36.300" class="difflineminus">-  nsCOMPtr &lt;nsIAtom&gt; compactCompletedAtom;</span>
<a href="#l36.301"></a><span id="l36.301" class="difflineminus">-  compactCompletedAtom = MsgGetAtom(&quot;CompactCompleted&quot;);</span>
<a href="#l36.302"></a><span id="l36.302" class="difflineminus">-  NotifyFolderEvent(compactCompletedAtom);</span>
<a href="#l36.303"></a><span id="l36.303" class="difflineplus">+  NotifyFolderEvent(kCompactCompleted);</span>
<a href="#l36.304"></a><span id="l36.304">   return NS_OK;</span>
<a href="#l36.305"></a><span id="l36.305"> }</span>
<a href="#l36.306"></a><span id="l36.306"> </span>
<a href="#l36.307"></a><span id="l36.307"> NS_IMETHODIMP nsMsgLocalMailFolder::Shutdown(bool shutdownChildren)</span>
<a href="#l36.308"></a><span id="l36.308"> {</span>
<a href="#l36.309"></a><span id="l36.309">   mInitialized = false;</span>
<a href="#l36.310"></a><span id="l36.310">   return nsMsgDBFolder::Shutdown(shutdownChildren);</span>
<a href="#l36.311"></a><span id="l36.311"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -14,16 +14,17 @@</span>
<a href="#l37.4"></a><span id="l37.4"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l37.5"></a><span id="l37.5"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l37.6"></a><span id="l37.6"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l37.7"></a><span id="l37.7"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l37.8"></a><span id="l37.8"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l37.9"></a><span id="l37.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l37.10"></a><span id="l37.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l37.11"></a><span id="l37.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l37.13"></a><span id="l37.13"> </span>
<a href="#l37.14"></a><span id="l37.14"> NS_IMPL_ISUPPORTS_INHERITED(nsLocalMoveCopyMsgTxn, nsMsgTxn, nsIFolderListener)</span>
<a href="#l37.15"></a><span id="l37.15"> </span>
<a href="#l37.16"></a><span id="l37.16"> nsLocalMoveCopyMsgTxn::nsLocalMoveCopyMsgTxn()  : m_srcIsImap4(false),</span>
<a href="#l37.17"></a><span id="l37.17">   m_canUndelete(false)</span>
<a href="#l37.18"></a><span id="l37.18"> {</span>
<a href="#l37.19"></a><span id="l37.19"> }</span>
<a href="#l37.20"></a><span id="l37.20"> </span>
<a href="#l37.21"></a><span id="l37.21" class="difflineat">@@ -463,42 +464,42 @@ NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnI</span>
<a href="#l37.22"></a><span id="l37.22">   return NS_OK;</span>
<a href="#l37.23"></a><span id="l37.23"> }</span>
<a href="#l37.24"></a><span id="l37.24"> </span>
<a href="#l37.25"></a><span id="l37.25"> NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemRemoved(nsIMsgFolder *parentItem, nsISupports *item)</span>
<a href="#l37.26"></a><span id="l37.26"> {</span>
<a href="#l37.27"></a><span id="l37.27">   return NS_OK;</span>
<a href="#l37.28"></a><span id="l37.28"> }</span>
<a href="#l37.29"></a><span id="l37.29"> </span>
<a href="#l37.30"></a><span id="l37.30" class="difflineminus">-NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char *oldValue, const char *newValue)</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineplus">+NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char *oldValue, const char *newValue)</span>
<a href="#l37.32"></a><span id="l37.32"> {</span>
<a href="#l37.33"></a><span id="l37.33">   return NS_OK;</span>
<a href="#l37.34"></a><span id="l37.34"> }</span>
<a href="#l37.35"></a><span id="l37.35"> </span>
<a href="#l37.36"></a><span id="l37.36" class="difflineminus">-NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemIntPropertyChanged(nsIMsgFolder *item, nsIAtom *property, int64_t oldValue, int64_t newValue)</span>
<a href="#l37.37"></a><span id="l37.37" class="difflineplus">+NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemIntPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, int64_t oldValue, int64_t newValue)</span>
<a href="#l37.38"></a><span id="l37.38"> {</span>
<a href="#l37.39"></a><span id="l37.39">   return NS_OK;</span>
<a href="#l37.40"></a><span id="l37.40"> }</span>
<a href="#l37.41"></a><span id="l37.41"> </span>
<a href="#l37.42"></a><span id="l37.42" class="difflineminus">-NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l37.43"></a><span id="l37.43" class="difflineplus">+NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemBoolPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, bool oldValue, bool newValue)</span>
<a href="#l37.44"></a><span id="l37.44"> {</span>
<a href="#l37.45"></a><span id="l37.45">   return NS_OK;</span>
<a href="#l37.46"></a><span id="l37.46"> }</span>
<a href="#l37.47"></a><span id="l37.47"> </span>
<a href="#l37.48"></a><span id="l37.48" class="difflineminus">-NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l37.49"></a><span id="l37.49" class="difflineplus">+NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemUnicharPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l37.50"></a><span id="l37.50"> {</span>
<a href="#l37.51"></a><span id="l37.51">   return NS_OK;</span>
<a href="#l37.52"></a><span id="l37.52"> }</span>
<a href="#l37.53"></a><span id="l37.53"> </span>
<a href="#l37.54"></a><span id="l37.54" class="difflineminus">-NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l37.55"></a><span id="l37.55" class="difflineplus">+NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, const nsACString &amp;property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l37.56"></a><span id="l37.56"> {</span>
<a href="#l37.57"></a><span id="l37.57">   return NS_OK;</span>
<a href="#l37.58"></a><span id="l37.58"> }</span>
<a href="#l37.59"></a><span id="l37.59"> </span>
<a href="#l37.60"></a><span id="l37.60" class="difflineminus">-NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemEvent(nsIMsgFolder *aItem, nsIAtom *aEvent)</span>
<a href="#l37.61"></a><span id="l37.61" class="difflineplus">+NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemEvent(nsIMsgFolder *aItem, const nsACString &amp;aEvent)</span>
<a href="#l37.62"></a><span id="l37.62"> {</span>
<a href="#l37.63"></a><span id="l37.63">   return NS_OK;</span>
<a href="#l37.64"></a><span id="l37.64"> }</span>
<a href="#l37.65"></a><span id="l37.65"> </span>
<a href="#l37.66"></a><span id="l37.66"> NS_IMPL_ISUPPORTS(nsLocalUndoFolderListener, nsIFolderListener)</span>
<a href="#l37.67"></a><span id="l37.67"> </span>
<a href="#l37.68"></a><span id="l37.68"> nsLocalUndoFolderListener::nsLocalUndoFolderListener(nsLocalMoveCopyMsgTxn *aTxn, nsIMsgFolder *aFolder)</span>
<a href="#l37.69"></a><span id="l37.69"> {</span>
<a href="#l37.70"></a><span id="l37.70" class="difflineat">@@ -515,44 +516,42 @@ NS_IMETHODIMP nsLocalUndoFolderListener:</span>
<a href="#l37.71"></a><span id="l37.71">     return NS_OK;</span>
<a href="#l37.72"></a><span id="l37.72"> }</span>
<a href="#l37.73"></a><span id="l37.73"> </span>
<a href="#l37.74"></a><span id="l37.74"> NS_IMETHODIMP nsLocalUndoFolderListener::OnItemRemoved(nsIMsgFolder *parentItem, nsISupports *item)</span>
<a href="#l37.75"></a><span id="l37.75"> {</span>
<a href="#l37.76"></a><span id="l37.76">     return NS_OK;</span>
<a href="#l37.77"></a><span id="l37.77"> }</span>
<a href="#l37.78"></a><span id="l37.78"> </span>
<a href="#l37.79"></a><span id="l37.79" class="difflineminus">-NS_IMETHODIMP nsLocalUndoFolderListener::OnItemPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char *oldValue, const char *newValue)</span>
<a href="#l37.80"></a><span id="l37.80" class="difflineplus">+NS_IMETHODIMP nsLocalUndoFolderListener::OnItemPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char *oldValue, const char *newValue)</span>
<a href="#l37.81"></a><span id="l37.81"> {</span>
<a href="#l37.82"></a><span id="l37.82">     return NS_OK;</span>
<a href="#l37.83"></a><span id="l37.83"> }</span>
<a href="#l37.84"></a><span id="l37.84"> </span>
<a href="#l37.85"></a><span id="l37.85" class="difflineminus">-NS_IMETHODIMP nsLocalUndoFolderListener::OnItemIntPropertyChanged(nsIMsgFolder *item, nsIAtom *property, int64_t oldValue, int64_t newValue)</span>
<a href="#l37.86"></a><span id="l37.86" class="difflineplus">+NS_IMETHODIMP nsLocalUndoFolderListener::OnItemIntPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, int64_t oldValue, int64_t newValue)</span>
<a href="#l37.87"></a><span id="l37.87"> {</span>
<a href="#l37.88"></a><span id="l37.88">     return NS_OK;</span>
<a href="#l37.89"></a><span id="l37.89"> }</span>
<a href="#l37.90"></a><span id="l37.90"> </span>
<a href="#l37.91"></a><span id="l37.91" class="difflineminus">-NS_IMETHODIMP nsLocalUndoFolderListener::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l37.92"></a><span id="l37.92" class="difflineplus">+NS_IMETHODIMP nsLocalUndoFolderListener::OnItemBoolPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, bool oldValue, bool newValue)</span>
<a href="#l37.93"></a><span id="l37.93"> {</span>
<a href="#l37.94"></a><span id="l37.94">     return NS_OK;</span>
<a href="#l37.95"></a><span id="l37.95"> }</span>
<a href="#l37.96"></a><span id="l37.96"> </span>
<a href="#l37.97"></a><span id="l37.97" class="difflineminus">-NS_IMETHODIMP nsLocalUndoFolderListener::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l37.98"></a><span id="l37.98" class="difflineplus">+NS_IMETHODIMP nsLocalUndoFolderListener::OnItemUnicharPropertyChanged(nsIMsgFolder *item, const nsACString &amp;property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l37.99"></a><span id="l37.99"> {</span>
<a href="#l37.100"></a><span id="l37.100">     return NS_OK;</span>
<a href="#l37.101"></a><span id="l37.101"> }</span>
<a href="#l37.102"></a><span id="l37.102"> </span>
<a href="#l37.103"></a><span id="l37.103" class="difflineminus">-NS_IMETHODIMP nsLocalUndoFolderListener::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l37.104"></a><span id="l37.104" class="difflineplus">+NS_IMETHODIMP nsLocalUndoFolderListener::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, const nsACString &amp;property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l37.105"></a><span id="l37.105"> {</span>
<a href="#l37.106"></a><span id="l37.106">     return NS_OK;</span>
<a href="#l37.107"></a><span id="l37.107"> }</span>
<a href="#l37.108"></a><span id="l37.108"> </span>
<a href="#l37.109"></a><span id="l37.109" class="difflineminus">-NS_IMETHODIMP nsLocalUndoFolderListener::OnItemEvent(nsIMsgFolder *aItem, nsIAtom *aEvent)</span>
<a href="#l37.110"></a><span id="l37.110" class="difflineplus">+NS_IMETHODIMP nsLocalUndoFolderListener::OnItemEvent(nsIMsgFolder *aItem, const nsACString &amp;aEvent)</span>
<a href="#l37.111"></a><span id="l37.111"> {</span>
<a href="#l37.112"></a><span id="l37.112">   if (mTxn &amp;&amp; mFolder &amp;&amp; aItem == mFolder) {</span>
<a href="#l37.113"></a><span id="l37.113" class="difflineminus">-      bool isEqual = false;</span>
<a href="#l37.114"></a><span id="l37.114" class="difflineminus">-      aEvent-&gt;ScriptableEquals(NS_LITERAL_STRING(&quot;FolderLoaded&quot;), &amp;isEqual);</span>
<a href="#l37.115"></a><span id="l37.115" class="difflineminus">-      if (isEqual)</span>
<a href="#l37.116"></a><span id="l37.116" class="difflineplus">+      if (aEvent.Equals(kFolderLoaded))</span>
<a href="#l37.117"></a><span id="l37.117">         return mTxn-&gt;UndoTransactionInternal();</span>
<a href="#l37.118"></a><span id="l37.118">   }</span>
<a href="#l37.119"></a><span id="l37.119"> </span>
<a href="#l37.120"></a><span id="l37.120">   return NS_ERROR_FAILURE;</span>
<a href="#l37.121"></a><span id="l37.121"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/local/src/nsPop3IncomingServer.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3IncomingServer.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -19,16 +19,17 @@</span>
<a href="#l38.4"></a><span id="l38.4"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l38.5"></a><span id="l38.5"> #include &quot;nsMsgKeyArray.h&quot;</span>
<a href="#l38.6"></a><span id="l38.6"> #include &quot;nsIMsgLocalMailFolder.h&quot;</span>
<a href="#l38.7"></a><span id="l38.7"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l38.8"></a><span id="l38.8"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l38.9"></a><span id="l38.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l38.10"></a><span id="l38.10"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l38.11"></a><span id="l38.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l38.13"></a><span id="l38.13"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l38.14"></a><span id="l38.14"> #include &quot;mozilla/Likely.h&quot;</span>
<a href="#l38.15"></a><span id="l38.15"> </span>
<a href="#l38.16"></a><span id="l38.16"> static NS_DEFINE_CID(kCPop3ServiceCID, NS_POP3SERVICE_CID);</span>
<a href="#l38.17"></a><span id="l38.17"> </span>
<a href="#l38.18"></a><span id="l38.18"> class nsPop3GetMailChainer final : public nsIUrlListener</span>
<a href="#l38.19"></a><span id="l38.19"> {</span>
<a href="#l38.20"></a><span id="l38.20"> public:</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineat">@@ -222,21 +223,19 @@ NS_IMETHODIMP nsPop3IncomingServer::SetD</span>
<a href="#l38.22"></a><span id="l38.22">     // use GetRootFolder, because that returns the real</span>
<a href="#l38.23"></a><span id="l38.23">     // root, not the deferred to root.</span>
<a href="#l38.24"></a><span id="l38.24">     rv = GetRootFolder(getter_AddRefs(rootFolder));</span>
<a href="#l38.25"></a><span id="l38.25">     if (rootFolder)</span>
<a href="#l38.26"></a><span id="l38.26">     {</span>
<a href="#l38.27"></a><span id="l38.27">       // if isDeferred state has changed, send notification</span>
<a href="#l38.28"></a><span id="l38.28">       if (aAccountKey.IsEmpty() != deferredToAccount.IsEmpty())</span>
<a href="#l38.29"></a><span id="l38.29">       {</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineminus">-        nsCOMPtr &lt;nsIAtom&gt; deferAtom = MsgGetAtom(&quot;isDeferred&quot;);</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-        nsCOMPtr &lt;nsIAtom&gt; canFileAtom = MsgGetAtom(&quot;CanFileMessages&quot;);</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineminus">-        folderListenerManager-&gt;OnItemBoolPropertyChanged(rootFolder, deferAtom,</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineplus">+        folderListenerManager-&gt;OnItemBoolPropertyChanged(rootFolder, kIsDeferred,</span>
<a href="#l38.34"></a><span id="l38.34">                   !deferredToAccount.IsEmpty(), deferredToAccount.IsEmpty());</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">-        folderListenerManager-&gt;OnItemBoolPropertyChanged(rootFolder, canFileAtom,</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineplus">+        folderListenerManager-&gt;OnItemBoolPropertyChanged(rootFolder, kCanFileMessages,</span>
<a href="#l38.37"></a><span id="l38.37">                   deferredToAccount.IsEmpty(), !deferredToAccount.IsEmpty());</span>
<a href="#l38.38"></a><span id="l38.38"> </span>
<a href="#l38.39"></a><span id="l38.39">         // this hack causes the account manager ds to send notifications to the</span>
<a href="#l38.40"></a><span id="l38.40">         // xul content builder that make the changed acct appear or disappear</span>
<a href="#l38.41"></a><span id="l38.41">         // from the folder pane and related menus.</span>
<a href="#l38.42"></a><span id="l38.42">         nsCOMPtr&lt;nsIMsgAccountManager&gt; acctMgr =</span>
<a href="#l38.43"></a><span id="l38.43">                             do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID);</span>
<a href="#l38.44"></a><span id="l38.44">         if (acctMgr)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -331,17 +331,17 @@ nsMsgNewsFolder::UpdateFolder(nsIMsgWind</span>
<a href="#l39.4"></a><span id="l39.4">       // a folder loaded notification to the front end.</span>
<a href="#l39.5"></a><span id="l39.5">       rv = GetNewMessages(aWindow, nullptr);</span>
<a href="#l39.6"></a><span id="l39.6">     }</span>
<a href="#l39.7"></a><span id="l39.7">     if (rv != NS_MSG_ERROR_OFFLINE)</span>
<a href="#l39.8"></a><span id="l39.8">       return rv;</span>
<a href="#l39.9"></a><span id="l39.9">   }</span>
<a href="#l39.10"></a><span id="l39.10">   // We're not getting messages because either get_messages_on_select is</span>
<a href="#l39.11"></a><span id="l39.11">   // false or we're offline. Send an immediate folder loaded notification.</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-  NotifyFolderEvent(mFolderLoadedAtom);</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+  NotifyFolderEvent(kFolderLoaded);</span>
<a href="#l39.14"></a><span id="l39.14">   (void) RefreshSizeOnDisk();</span>
<a href="#l39.15"></a><span id="l39.15">   return NS_OK;</span>
<a href="#l39.16"></a><span id="l39.16"> }</span>
<a href="#l39.17"></a><span id="l39.17"> </span>
<a href="#l39.18"></a><span id="l39.18"> NS_IMETHODIMP</span>
<a href="#l39.19"></a><span id="l39.19"> nsMsgNewsFolder::GetCanSubscribe(bool *aResult)</span>
<a href="#l39.20"></a><span id="l39.20"> {</span>
<a href="#l39.21"></a><span id="l39.21">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineat">@@ -743,17 +743,17 @@ NS_IMETHODIMP nsMsgNewsFolder::GetDeleta</span>
<a href="#l39.23"></a><span id="l39.23"> }</span>
<a href="#l39.24"></a><span id="l39.24"> </span>
<a href="#l39.25"></a><span id="l39.25"> NS_IMETHODIMP nsMsgNewsFolder::RefreshSizeOnDisk()</span>
<a href="#l39.26"></a><span id="l39.26"> {</span>
<a href="#l39.27"></a><span id="l39.27">   uint64_t oldFolderSize = mFolderSize;</span>
<a href="#l39.28"></a><span id="l39.28">   // We set size to unknown to force it to get recalculated from disk.</span>
<a href="#l39.29"></a><span id="l39.29">   mFolderSize = kSizeUnknown;</span>
<a href="#l39.30"></a><span id="l39.30">   if (NS_SUCCEEDED(GetSizeOnDisk(&amp;mFolderSize)))</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-    NotifyIntPropertyChanged(kFolderSizeAtom, oldFolderSize, mFolderSize);</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+    NotifyIntPropertyChanged(kFolderSize, oldFolderSize, mFolderSize);</span>
<a href="#l39.33"></a><span id="l39.33">   return NS_OK;</span>
<a href="#l39.34"></a><span id="l39.34"> }</span>
<a href="#l39.35"></a><span id="l39.35"> </span>
<a href="#l39.36"></a><span id="l39.36"> NS_IMETHODIMP nsMsgNewsFolder::GetSizeOnDisk(int64_t *size)</span>
<a href="#l39.37"></a><span id="l39.37"> {</span>
<a href="#l39.38"></a><span id="l39.38">   NS_ENSURE_ARG_POINTER(size);</span>
<a href="#l39.39"></a><span id="l39.39"> </span>
<a href="#l39.40"></a><span id="l39.40">   bool isServer = false;</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineat">@@ -825,18 +825,18 @@ nsMsgNewsFolder::DeleteMessages(nsIArray</span>
<a href="#l39.42"></a><span id="l39.42">       nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr = do_QueryElementAt(messages, i, &amp;rv);</span>
<a href="#l39.43"></a><span id="l39.43">       if (msgHdr)</span>
<a href="#l39.44"></a><span id="l39.44">         rv = mDatabase-&gt;DeleteHeader(msgHdr, nullptr, true, true);</span>
<a href="#l39.45"></a><span id="l39.45">     }</span>
<a href="#l39.46"></a><span id="l39.46">     EnableNotifications(allMessageCountNotifications, true);</span>
<a href="#l39.47"></a><span id="l39.47">   }</span>
<a href="#l39.48"></a><span id="l39.48">  </span>
<a href="#l39.49"></a><span id="l39.49">   if (!isMove) </span>
<a href="#l39.50"></a><span id="l39.50" class="difflineminus">-    NotifyFolderEvent(NS_SUCCEEDED(rv) ? mDeleteOrMoveMsgCompletedAtom :</span>
<a href="#l39.51"></a><span id="l39.51" class="difflineminus">-      mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l39.52"></a><span id="l39.52" class="difflineplus">+    NotifyFolderEvent(NS_SUCCEEDED(rv) ? kDeleteOrMoveMsgCompleted :</span>
<a href="#l39.53"></a><span id="l39.53" class="difflineplus">+      kDeleteOrMoveMsgFailed);</span>
<a href="#l39.54"></a><span id="l39.54"> </span>
<a href="#l39.55"></a><span id="l39.55">   (void) RefreshSizeOnDisk();</span>
<a href="#l39.56"></a><span id="l39.56"> </span>
<a href="#l39.57"></a><span id="l39.57">   return NS_OK;</span>
<a href="#l39.58"></a><span id="l39.58"> }</span>
<a href="#l39.59"></a><span id="l39.59"> </span>
<a href="#l39.60"></a><span id="l39.60"> NS_IMETHODIMP nsMsgNewsFolder::CancelMessage(nsIMsgDBHdr *msgHdr,</span>
<a href="#l39.61"></a><span id="l39.61">                                              nsIMsgWindow *aMsgWindow)</span>
<a href="#l39.62"></a><span id="l39.62" class="difflineat">@@ -1560,23 +1560,23 @@ NS_IMETHODIMP nsMsgNewsFolder::RemoveMes</span>
<a href="#l39.63"></a><span id="l39.63">     notifier-&gt;NotifyMsgsDeleted(msgHdrs);</span>
<a href="#l39.64"></a><span id="l39.64">   }</span>
<a href="#l39.65"></a><span id="l39.65"> </span>
<a href="#l39.66"></a><span id="l39.66">   return mDatabase-&gt;DeleteMessages(aMsgKeys.Length(), aMsgKeys.Elements(), nullptr);</span>
<a href="#l39.67"></a><span id="l39.67"> }</span>
<a href="#l39.68"></a><span id="l39.68"> </span>
<a href="#l39.69"></a><span id="l39.69"> NS_IMETHODIMP nsMsgNewsFolder::CancelComplete()</span>
<a href="#l39.70"></a><span id="l39.70"> {</span>
<a href="#l39.71"></a><span id="l39.71" class="difflineminus">-  NotifyFolderEvent(mDeleteOrMoveMsgCompletedAtom);</span>
<a href="#l39.72"></a><span id="l39.72" class="difflineplus">+  NotifyFolderEvent(kDeleteOrMoveMsgCompleted);</span>
<a href="#l39.73"></a><span id="l39.73">   return NS_OK;</span>
<a href="#l39.74"></a><span id="l39.74"> }</span>
<a href="#l39.75"></a><span id="l39.75"> </span>
<a href="#l39.76"></a><span id="l39.76"> NS_IMETHODIMP nsMsgNewsFolder::CancelFailed()</span>
<a href="#l39.77"></a><span id="l39.77"> {</span>
<a href="#l39.78"></a><span id="l39.78" class="difflineminus">-  NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l39.79"></a><span id="l39.79" class="difflineplus">+  NotifyFolderEvent(kDeleteOrMoveMsgFailed);</span>
<a href="#l39.80"></a><span id="l39.80">   return NS_OK;</span>
<a href="#l39.81"></a><span id="l39.81"> }</span>
<a href="#l39.82"></a><span id="l39.82"> </span>
<a href="#l39.83"></a><span id="l39.83"> NS_IMETHODIMP nsMsgNewsFolder::GetSaveArticleOffline(bool *aBool)</span>
<a href="#l39.84"></a><span id="l39.84"> {</span>
<a href="#l39.85"></a><span id="l39.85">   NS_ENSURE_ARG(aBool);</span>
<a href="#l39.86"></a><span id="l39.86">   *aBool = m_downloadMessageForOfflineUse;</span>
<a href="#l39.87"></a><span id="l39.87">   return NS_OK;</span>
<a href="#l39.88"></a><span id="l39.88" class="difflineat">@@ -1747,22 +1747,19 @@ NS_IMETHODIMP nsMsgNewsFolder::GetMessag</span>
<a href="#l39.89"></a><span id="l39.89">   rv = hdr-&gt;GetMessageId(getter_Copies(id));</span>
<a href="#l39.90"></a><span id="l39.90">   result.Assign(id);</span>
<a href="#l39.91"></a><span id="l39.91">   return rv;</span>
<a href="#l39.92"></a><span id="l39.92"> }</span>
<a href="#l39.93"></a><span id="l39.93"> </span>
<a href="#l39.94"></a><span id="l39.94"> NS_IMETHODIMP nsMsgNewsFolder::SetSortOrder(int32_t order)</span>
<a href="#l39.95"></a><span id="l39.95"> {</span>
<a href="#l39.96"></a><span id="l39.96">   int32_t oldOrder = mSortOrder;</span>
<a href="#l39.97"></a><span id="l39.97" class="difflineminus">-  </span>
<a href="#l39.98"></a><span id="l39.98" class="difflineminus">-  mSortOrder = order;</span>
<a href="#l39.99"></a><span id="l39.99" class="difflineminus">-  nsCOMPtr&lt;nsIAtom&gt; sortOrderAtom = MsgGetAtom(&quot;SortOrder&quot;);</span>
<a href="#l39.100"></a><span id="l39.100" class="difflineminus">-  // What to do if the atom can't be allocated?</span>
<a href="#l39.101"></a><span id="l39.101" class="difflineminus">-  NotifyIntPropertyChanged(sortOrderAtom, oldOrder, order);</span>
<a href="#l39.102"></a><span id="l39.102" class="difflineminus">-  </span>
<a href="#l39.103"></a><span id="l39.103" class="difflineplus">+</span>
<a href="#l39.104"></a><span id="l39.104" class="difflineplus">+  NotifyIntPropertyChanged(kSortOrder, oldOrder, order);</span>
<a href="#l39.105"></a><span id="l39.105" class="difflineplus">+</span>
<a href="#l39.106"></a><span id="l39.106">   return NS_OK;</span>
<a href="#l39.107"></a><span id="l39.107"> }</span>
<a href="#l39.108"></a><span id="l39.108"> </span>
<a href="#l39.109"></a><span id="l39.109"> NS_IMETHODIMP nsMsgNewsFolder::GetSortOrder(int32_t *order)</span>
<a href="#l39.110"></a><span id="l39.110"> {</span>
<a href="#l39.111"></a><span id="l39.111">   NS_ENSURE_ARG_POINTER(order);</span>
<a href="#l39.112"></a><span id="l39.112">   *order = mSortOrder;</span>
<a href="#l39.113"></a><span id="l39.113">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -100,20 +100,16 @@ nsNntpIncomingServer::nsNntpIncomingServ</span>
<a href="#l40.4"></a><span id="l40.4">   mVersion = INVALID_VERSION;</span>
<a href="#l40.5"></a><span id="l40.5"> </span>
<a href="#l40.6"></a><span id="l40.6">   mLastGroupDate = 0;</span>
<a href="#l40.7"></a><span id="l40.7">   mUniqueId = 0;</span>
<a href="#l40.8"></a><span id="l40.8">   mHasSeenBeginGroups = false;</span>
<a href="#l40.9"></a><span id="l40.9">   mPostingAllowed = false;</span>
<a href="#l40.10"></a><span id="l40.10">   mLastUpdatedTime = 0;</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  // these atoms are used for subscribe search</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-  mSubscribedAtom = MsgGetAtom(&quot;subscribed&quot;);</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">-  mNntpAtom = MsgGetAtom(&quot;nntp&quot;);</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineminus">-</span>
<a href="#l40.16"></a><span id="l40.16">   // we have server wide and per group filters</span>
<a href="#l40.17"></a><span id="l40.17">   m_canHaveFilters = true;</span>
<a href="#l40.18"></a><span id="l40.18"> </span>
<a href="#l40.19"></a><span id="l40.19">   SetupNewsrcSaveTimer();</span>
<a href="#l40.20"></a><span id="l40.20"> }</span>
<a href="#l40.21"></a><span id="l40.21"> </span>
<a href="#l40.22"></a><span id="l40.22"> nsNntpIncomingServer::~nsNntpIncomingServer()</span>
<a href="#l40.23"></a><span id="l40.23"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.h</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.h</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -17,17 +17,16 @@</span>
<a href="#l41.4"></a><span id="l41.4"> #include &quot;prprf.h&quot;</span>
<a href="#l41.5"></a><span id="l41.5"> </span>
<a href="#l41.6"></a><span id="l41.6"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l41.7"></a><span id="l41.7"> #include &quot;nsISubscribableServer.h&quot;</span>
<a href="#l41.8"></a><span id="l41.8"> #include &quot;nsITimer.h&quot;</span>
<a href="#l41.9"></a><span id="l41.9"> #include &quot;nsIFile.h&quot;</span>
<a href="#l41.10"></a><span id="l41.10"> #include &quot;nsITreeView.h&quot;</span>
<a href="#l41.11"></a><span id="l41.11"> #include &quot;nsITreeSelection.h&quot;</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-#include &quot;nsIAtom.h&quot;</span>
<a href="#l41.13"></a><span id="l41.13"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l41.14"></a><span id="l41.14"> </span>
<a href="#l41.15"></a><span id="l41.15"> #include &quot;nsNntpMockChannel.h&quot;</span>
<a href="#l41.16"></a><span id="l41.16"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l41.17"></a><span id="l41.17"> </span>
<a href="#l41.18"></a><span id="l41.18"> class nsINntpUrl;</span>
<a href="#l41.19"></a><span id="l41.19"> class nsIMsgMailNewsUrl;</span>
<a href="#l41.20"></a><span id="l41.20"> </span>
<a href="#l41.21"></a><span id="l41.21" class="difflineat">@@ -101,18 +100,16 @@ private:</span>
<a href="#l41.22"></a><span id="l41.22">     nsTArray&lt;nsCString&gt; mGroupsOnServer;</span>
<a href="#l41.23"></a><span id="l41.23">     nsTArray&lt;nsCString&gt; mSubscribeSearchResult;</span>
<a href="#l41.24"></a><span id="l41.24">     bool mSearchResultSortDescending;</span>
<a href="#l41.25"></a><span id="l41.25">     // the list of of subscribed newsgroups within a given</span>
<a href="#l41.26"></a><span id="l41.26">     // subscribed dialog session.  </span>
<a href="#l41.27"></a><span id="l41.27">     // we need to keep track of them so we know what to show as &quot;checked&quot;</span>
<a href="#l41.28"></a><span id="l41.28">     // in the search view</span>
<a href="#l41.29"></a><span id="l41.29">     nsTArray&lt;nsCString&gt; mTempSubscribed;</span>
<a href="#l41.30"></a><span id="l41.30" class="difflineminus">-    nsCOMPtr&lt;nsIAtom&gt; mSubscribedAtom;</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-    nsCOMPtr&lt;nsIAtom&gt; mNntpAtom;</span>
<a href="#l41.32"></a><span id="l41.32"> </span>
<a href="#l41.33"></a><span id="l41.33">     nsCOMPtr&lt;nsITreeBoxObject&gt; mTree;</span>
<a href="#l41.34"></a><span id="l41.34">     nsCOMPtr&lt;nsITreeSelection&gt; mTreeSelection;</span>
<a href="#l41.35"></a><span id="l41.35"> </span>
<a href="#l41.36"></a><span id="l41.36">     bool     mHasSeenBeginGroups;</span>
<a href="#l41.37"></a><span id="l41.37">     bool     mGetOnlyNew;</span>
<a href="#l41.38"></a><span id="l41.38">     nsresult WriteHostInfoFile();</span>
<a href="#l41.39"></a><span id="l41.39">     nsresult LoadHostInfoFile();</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

