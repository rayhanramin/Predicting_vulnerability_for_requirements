<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29622:299e88e21913bdcf79169bd0d84197ce32b1df07</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 299e88e21913bdcf79169bd0d84197ce32b1df07" />
<meta property="og:url" content="/comm-central/rev/299e88e21913bdcf79169bd0d84197ce32b1df07" />
<meta property="og:description" content="Bug 1639430 - Use ICAL.js to parse and encode vCard; remove old vCard components. r=mkmelin DONTBUILD" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 299e88e21913bdcf79169bd0d84197ce32b1df07 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/299e88e21913bdcf79169bd0d84197ce32b1df07">shortlog</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/299e88e21913bdcf79169bd0d84197ce32b1df07">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07">files</a> |
changeset |
<a href="/comm-central/raw-rev/299e88e21913bdcf79169bd0d84197ce32b1df07">raw</a>  | <a href="/comm-central/archive/299e88e21913bdcf79169bd0d84197ce32b1df07.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1639430">Bug 1639430</a> - Use ICAL.js to parse and encode vCard; remove old vCard components. r=mkmelin DONTBUILD
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 15 May 2020 14:51:12 +1200</td></tr>

<tr>
 <td>changeset 29622</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/299e88e21913bdcf79169bd0d84197ce32b1df07">299e88e21913bdcf79169bd0d84197ce32b1df07</a></td>
</tr>



<tr>
<td>parent 29621</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/450c5f1fed903d2a49004cf0eaa8c492fa8da362">450c5f1fed903d2a49004cf0eaa8c492fa8da362</a>
</td>
</tr>

<tr>
<td>child 29623</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f577795ca28c305465e95ceb4e0eb04d9bb54568">f577795ca28c305465e95ceb4e0eb04d9bb54568</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=299e88e21913bdcf79169bd0d84197ce32b1df07">17461</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Wed, 20 May 2020 10:05:44 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@299e88e21913 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=299e88e21913bdcf79169bd0d84197ce32b1df07">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=299e88e21913bdcf79169bd0d84197ce32b1df07&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=299e88e21913bdcf79169bd0d84197ce32b1df07&newProject=comm-central&newRevision=450c5f1fed903d2a49004cf0eaa8c492fa8da362&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=299e88e21913bdcf79169bd0d84197ce32b1df07&newProject=comm-central&newRevision=450c5f1fed903d2a49004cf0eaa8c492fa8da362&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=299e88e21913bdcf79169bd0d84197ce32b1df07&newProject=comm-central&newRevision=450c5f1fed903d2a49004cf0eaa8c492fa8da362&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1639430">1639430</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1639430">Bug 1639430</a> - Use ICAL.js to parse and encode vCard; remove old vCard components. r=mkmelin DONTBUILD</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/AddrBookCard.jsm">mailnews/addrbook/jsaddrbook/AddrBookCard.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/AddrBookCard.jsm">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/AddrBookCard.jsm">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/AddrBookCard.jsm">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/AddrBookCard.jsm">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/AddrBookCard.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/VCardUtils.jsm">mailnews/addrbook/jsaddrbook/VCardUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/VCardUtils.jsm">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/VCardUtils.jsm">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/VCardUtils.jsm">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/VCardUtils.jsm">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/VCardUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/components.conf">mailnews/addrbook/jsaddrbook/components.conf</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/components.conf">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/components.conf">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/components.conf">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/components.conf">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/jsaddrbook/components.conf">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/public/nsIMsgVCardService.idl">mailnews/addrbook/public/nsIMsgVCardService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/public/nsIMsgVCardService.idl">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/public/nsIMsgVCardService.idl">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/public/nsIMsgVCardService.idl">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/public/nsIMsgVCardService.idl">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/public/nsIMsgVCardService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/moz.build">mailnews/addrbook/src/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/moz.build">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/moz.build">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/moz.build">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/moz.build">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbCardProperty.cpp">mailnews/addrbook/src/nsAbCardProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbCardProperty.cpp">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbCardProperty.cpp">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbCardProperty.cpp">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbCardProperty.cpp">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbCardProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbContentHandler.cpp">mailnews/addrbook/src/nsAbContentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbContentHandler.cpp">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbContentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbContentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbContentHandler.cpp">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsAbContentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsMsgVCardService.cpp">mailnews/addrbook/src/nsMsgVCardService.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsMsgVCardService.cpp">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsMsgVCardService.cpp">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsMsgVCardService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsMsgVCardService.h">mailnews/addrbook/src/nsMsgVCardService.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsMsgVCardService.h">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsMsgVCardService.h">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsMsgVCardService.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCard.cpp">mailnews/addrbook/src/nsVCard.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCard.cpp">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCard.cpp">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCard.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCard.h">mailnews/addrbook/src/nsVCard.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCard.h">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCard.h">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCard.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCardObj.cpp">mailnews/addrbook/src/nsVCardObj.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCardObj.cpp">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCardObj.cpp">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCardObj.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCardObj.h">mailnews/addrbook/src/nsVCardObj.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCardObj.h">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCardObj.h">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/src/nsVCardObj.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/data/export.vcf">mailnews/addrbook/test/unit/data/export.vcf</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/data/export.vcf">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/data/export.vcf">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/data/export.vcf">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/data/export.vcf">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/data/export.vcf">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_bug387403.js">mailnews/addrbook/test/unit/test_bug387403.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_bug387403.js">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_bug387403.js">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_bug387403.js">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_bug387403.js">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_bug387403.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_export.js">mailnews/addrbook/test/unit/test_export.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_export.js">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_export.js">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_export.js">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_export.js">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_export.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_nsIAbCard.js">mailnews/addrbook/test/unit/test_nsIAbCard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_nsIAbCard.js">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_nsIAbCard.js">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_nsIAbCard.js">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_nsIAbCard.js">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/addrbook/test/unit/test_nsIAbCard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/build/nsMailModule.cpp">mailnews/build/nsMailModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/build/nsMailModule.cpp">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/build/nsMailModule.cpp">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/build/nsMailModule.cpp">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/build/nsMailModule.cpp">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/build/nsMailModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/moz.build">mailnews/mime/cthandlers/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/moz.build">file</a> |
<a href="/comm-central/annotate/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/moz.build">annotate</a> |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/moz.build">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/moz.build">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">mailnews/mime/cthandlers/vcard/mimevcrd.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/mimevcrd.h">mailnews/mime/cthandlers/vcard/mimevcrd.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/mimevcrd.h">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/mimevcrd.h">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/mimevcrd.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/moz.build">mailnews/mime/cthandlers/vcard/moz.build</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/moz.build">diff</a> |
<a href="/comm-central/comparison/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/moz.build">comparison</a> |
<a href="/comm-central/log/299e88e21913bdcf79169bd0d84197ce32b1df07/mailnews/mime/cthandlers/vcard/moz.build">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/jsaddrbook/AddrBookCard.jsm</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/jsaddrbook/AddrBookCard.jsm</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -222,16 +222,17 @@ AddrBookCard.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">     }</span>
<a href="#l1.5"></a><span id="l1.5">     return false;</span>
<a href="#l1.6"></a><span id="l1.6">   },</span>
<a href="#l1.7"></a><span id="l1.7">   translateTo(type) {</span>
<a href="#l1.8"></a><span id="l1.8">     // Get nsAbCardProperty to do the work, the code is in C++ anyway.</span>
<a href="#l1.9"></a><span id="l1.9">     let cardCopy = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;].createInstance(</span>
<a href="#l1.10"></a><span id="l1.10">       Ci.nsIAbCard</span>
<a href="#l1.11"></a><span id="l1.11">     );</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    cardCopy.UID = this.UID;</span>
<a href="#l1.13"></a><span id="l1.13">     cardCopy.copy(this);</span>
<a href="#l1.14"></a><span id="l1.14">     return cardCopy.translateTo(type);</span>
<a href="#l1.15"></a><span id="l1.15">   },</span>
<a href="#l1.16"></a><span id="l1.16">   generatePhoneticName(lastNameFirst) {</span>
<a href="#l1.17"></a><span id="l1.17">     if (lastNameFirst) {</span>
<a href="#l1.18"></a><span id="l1.18">       return `${this.lastName}, ${this.firstName}`;</span>
<a href="#l1.19"></a><span id="l1.19">     }</span>
<a href="#l1.20"></a><span id="l1.20">     return `${this.firstName} ${this.lastName}`;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/jsaddrbook/VCardUtils.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/jsaddrbook/VCardUtils.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6">  * file, you can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8" class="difflineminus">-const EXPORTED_SYMBOLS = [&quot;VCardUtils&quot;];</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+const EXPORTED_SYMBOLS = [&quot;VCardService&quot;, &quot;VCardMimeConverter&quot;, &quot;VCardUtils&quot;];</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> const { ICAL } = ChromeUtils.import(&quot;resource:///modules/calendar/Ical.jsm&quot;);</span>
<a href="#l2.12"></a><span id="l2.12"> </span>
<a href="#l2.13"></a><span id="l2.13"> /**</span>
<a href="#l2.14"></a><span id="l2.14">  * Utilities for working with vCard data. This file uses ICAL.js as parser and</span>
<a href="#l2.15"></a><span id="l2.15">  * formatter to avoid reinventing the wheel.</span>
<a href="#l2.16"></a><span id="l2.16">  * @see RFC 6350.</span>
<a href="#l2.17"></a><span id="l2.17">  */</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineat">@@ -131,16 +131,83 @@ var VCardUtils = {</span>
<a href="#l2.19"></a><span id="l2.19">       delete telProps[0][1].type;</span>
<a href="#l2.20"></a><span id="l2.20">     }</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22">     vProps.push([&quot;uid&quot;, {}, &quot;text&quot;, abCard.UID]);</span>
<a href="#l2.23"></a><span id="l2.23">     return ICAL.stringify([&quot;vcard&quot;, vProps]);</span>
<a href="#l2.24"></a><span id="l2.24">   },</span>
<a href="#l2.25"></a><span id="l2.25"> };</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+function VCardService() {}</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+VCardService.prototype = {</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+  QueryInterface: ChromeUtils.generateQI([Ci.nsIMsgVCardService]),</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+  classID: Components.ID(&quot;{e2e0f615-bc5a-4441-a16b-a26e75949376}&quot;),</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  escapedVCardToAbCard(vCard) {</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+    return VCardUtils.vCardToAbCard(decodeURIComponent(vCard));</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+  },</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+  abCardToEscapedVCard(abCard) {</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+    return encodeURIComponent(VCardUtils.abCardToVCard(abCard));</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+  },</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+};</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+function VCardMimeConverter() {}</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+VCardMimeConverter.prototype = {</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+  QueryInterface: ChromeUtils.generateQI([Ci.nsISimpleMimeConverter]),</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+  classID: Components.ID(&quot;{dafab386-bd4c-4238-bb48-228fbc98ba29}&quot;),</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+  uri: null,</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+  convertToHTML(contentType, data) {</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+    function escapeHTML(template, ...parts) {</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+      let arr = [];</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+      for (let i = 0; i &lt; parts.length; i++) {</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+        arr.push(template[i]);</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+        arr.push(</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+          parts[i]</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+            .replace(/&amp;/g, &quot;&amp;amp;&quot;)</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+            .replace(/&quot;/g, &quot;&amp;quot;&quot;)</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+            .replace(/&lt;/g, &quot;&amp;lt;&quot;)</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+            .replace(/&gt;/g, &quot;&amp;gt;&quot;)</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+        );</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+      }</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+      arr.push(template[template.length - 1]);</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+      return arr.join(&quot;&quot;);</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+    }</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+    let abCard = VCardUtils.vCardToAbCard(data);</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+    let escapedVCard = encodeURIComponent(data);</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+    let propertiesTable = `&lt;table class=&quot;moz-vcard-properties-table&quot;&gt;`;</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+    propertiesTable += escapeHTML`&lt;tr&gt;&lt;td class=&quot;moz-vcard-title-property&quot;&gt;${abCard.displayName}`;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+    if (abCard.primaryEmail) {</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+      propertiesTable += escapeHTML`&amp;nbsp;&amp;lt;&lt;a href=&quot;mailto:${abCard.primaryEmail}&quot; private&gt;${abCard.primaryEmail}&lt;/a&gt;&amp;gt;`;</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+    }</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+    propertiesTable += `&lt;/td&gt;&lt;/tr&gt;`;</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+    for (let propName of [&quot;JobTitle&quot;, &quot;Department&quot;, &quot;Company&quot;]) {</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+      let propValue = abCard.getProperty(propName, &quot;&quot;);</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+      if (propValue) {</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+        propertiesTable += escapeHTML`&lt;tr&gt;&lt;td class=&quot;moz-vcard-property&quot;&gt;${propValue}&lt;/td&gt;&lt;/tr&gt;`;</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+      }</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+    }</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+    propertiesTable += `&lt;/table&gt;`;</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+    return `&lt;html&gt;</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+      &lt;body&gt;</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+        &lt;table class=&quot;moz-vcard-table&quot;&gt;</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+          &lt;tr&gt;</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+            &lt;td valign=&quot;top&quot;&gt;&lt;a class=&quot;moz-vcard-badge&quot; href=&quot;addbook:add?action=add?vcard=${escapedVCard}&quot;&gt;&lt;/a&gt;&lt;/td&gt;</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+            &lt;td&gt;</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+              ${propertiesTable}</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+            &lt;/td&gt;</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+          &lt;/tr&gt;</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+        &lt;/table&gt;</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+      &lt;/body&gt;</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+    &lt;/html&gt;`;</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+  },</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+};</span>
<a href="#l2.94"></a><span id="l2.94"> </span>
<a href="#l2.95"></a><span id="l2.95"> /** Helper functions for propertyMap. */</span>
<a href="#l2.96"></a><span id="l2.96"> </span>
<a href="#l2.97"></a><span id="l2.97"> function singleTextProperty(</span>
<a href="#l2.98"></a><span id="l2.98">   abPropName,</span>
<a href="#l2.99"></a><span id="l2.99">   vPropName,</span>
<a href="#l2.100"></a><span id="l2.100">   vPropParams = {},</span>
<a href="#l2.101"></a><span id="l2.101">   vPropType = &quot;text&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/jsaddrbook/components.conf</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/jsaddrbook/components.conf</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -9,10 +9,21 @@ Classes = [</span>
<a href="#l3.4"></a><span id="l3.4">         'contract_ids': ['@mozilla.org/addressbook/jsaddrbookcard;1'],</span>
<a href="#l3.5"></a><span id="l3.5">         'jsm': 'resource:///modules/AddrBookCard.jsm',</span>
<a href="#l3.6"></a><span id="l3.6">         'constructor': 'AddrBookCard',</span>
<a href="#l3.7"></a><span id="l3.7">     }, {</span>
<a href="#l3.8"></a><span id="l3.8">         'cid': '{224d3ef9-d81c-4d94-8826-a79a5835af93}',</span>
<a href="#l3.9"></a><span id="l3.9">         'contract_ids': ['@mozilla.org/abmanager;1'],</span>
<a href="#l3.10"></a><span id="l3.10">         'jsm': 'resource:///modules/AddrBookManager.jsm',</span>
<a href="#l3.11"></a><span id="l3.11">         'constructor': 'AddrBookManager',</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    }, {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+        'cid': '{e2e0f615-bc5a-4441-a16b-a26e75949376}',</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+        'contract_ids': ['@mozilla.org/addressbook/msgvcardservice;1'],</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+        'jsm': 'resource:///modules/VCardUtils.jsm',</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+        'constructor': 'VCardService',</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+    }, {</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+        'cid': '{dafab386-bd4c-4238-bb48-228fbc98ba29}',</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+        'contract_ids': ['@mozilla.org/mimecth;1?type=text/x-vcard'],</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+        'jsm': 'resource:///modules/VCardUtils.jsm',</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+        'constructor': 'VCardMimeConverter',</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+        'categories': {'simple-mime-converters': 'text/x-vcard'},</span>
<a href="#l3.23"></a><span id="l3.23">     },</span>
<a href="#l3.24"></a><span id="l3.24"> ]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/public/nsIMsgVCardService.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsIMsgVCardService.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -2,39 +2,27 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> interface nsIAbCard;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-%{C++</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-#include &quot;nsVCardObj.h&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-%}</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-[ptr] native VObject_ptr(VObject);</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-[ptr] native VObjectIterator_ptr(VObjectIterator);</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-[ptr] native const_char_ptr(const char);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-[scriptable, builtinclass, uuid(8b6ae917-676d-4f1f-bbad-2ecc9be0d9b1)]</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+[scriptable, uuid(8b6ae917-676d-4f1f-bbad-2ecc9be0d9b1)]</span>
<a href="#l4.22"></a><span id="l4.22"> interface nsIMsgVCardService : nsISupports {</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-  [noscript, notxpcom] void cleanVObject(in VObject_ptr o);</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-  [noscript, notxpcom] VObject_ptr nextVObjectInList(in VObject_ptr o);</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-  [noscript, notxpcom] VObject_ptr parse_MIME(in string input, in unsigned long len);</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-  [noscript, notxpcom] charPtr fakeCString(in VObject_ptr o);</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-  [noscript, notxpcom] VObject_ptr isAPropertyOf(in VObject_ptr o, in string id);</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-  [noscript, notxpcom] charPtr writeMemoryVObjects(in string s, out long len, in VObject_ptr list, in boolean expandSpaces);</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-  [noscript, notxpcom] VObject_ptr nextVObject(in VObjectIterator_ptr i);</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-  [noscript, notxpcom] void initPropIterator(in VObjectIterator_ptr i, in VObject_ptr o);</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-  [noscript, notxpcom] long moreIteration(in VObjectIterator_ptr i);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-  [noscript, notxpcom] const_char_ptr vObjectName(in VObject_ptr o);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-  [noscript, notxpcom] charPtr vObjectAnyValue(in VObject_ptr o);</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35">   /**</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-   * Translates an escaped vcard string into a nsIAbCard.</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+   * Translates an URL-encoded vCard string into a nsIAbCard.</span>
<a href="#l4.38"></a><span id="l4.38">    *</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-   * @param  escapedVCardStr  The string containing the vcard.</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-   *</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-   * @return A card containing the translated vcard data.</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+   * @param escapedVCardStr - The string containing the vCard data.</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+   * @return - A card containing the translated vCard data.</span>
<a href="#l4.44"></a><span id="l4.44">    */</span>
<a href="#l4.45"></a><span id="l4.45">   nsIAbCard escapedVCardToAbCard(in string escapedVCardStr);</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+  /**</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+   * Translates a nsIAbCard into an URL-encoded vCard.</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+   *</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+   * @param abCard - A card to be translated.</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+   * @return - The string containing the vCard data.</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+   */</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+  ACString abCardToEscapedVCard(in nsIAbCard abCard);</span>
<a href="#l4.54"></a><span id="l4.54"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/src/moz.build</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/src/moz.build</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l5.4"></a><span id="l5.4"> # vim: set filetype=python:</span>
<a href="#l5.5"></a><span id="l5.5"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.6"></a><span id="l5.6"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.7"></a><span id="l5.7"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> EXPORTS += [</span>
<a href="#l5.10"></a><span id="l5.10">     'nsAbDirProperty.h',</span>
<a href="#l5.11"></a><span id="l5.11">     'nsDirPrefs.h',</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    'nsVCardObj.h',</span>
<a href="#l5.13"></a><span id="l5.13"> ]</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> SOURCES += [</span>
<a href="#l5.16"></a><span id="l5.16">     'nsAbAddressCollector.cpp',</span>
<a href="#l5.17"></a><span id="l5.17">     'nsAbBooleanExpression.cpp',</span>
<a href="#l5.18"></a><span id="l5.18">     'nsAbBoolExprToLDAPFilter.cpp',</span>
<a href="#l5.19"></a><span id="l5.19">     'nsAbCardProperty.cpp',</span>
<a href="#l5.20"></a><span id="l5.20">     'nsAbContentHandler.cpp',</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -24,19 +23,16 @@ SOURCES += [</span>
<a href="#l5.22"></a><span id="l5.22">     'nsAbLDAPReplicationData.cpp',</span>
<a href="#l5.23"></a><span id="l5.23">     'nsAbLDAPReplicationQuery.cpp',</span>
<a href="#l5.24"></a><span id="l5.24">     'nsAbLDAPReplicationService.cpp',</span>
<a href="#l5.25"></a><span id="l5.25">     'nsAbLDIFService.cpp',</span>
<a href="#l5.26"></a><span id="l5.26">     'nsAbQueryStringToExpression.cpp',</span>
<a href="#l5.27"></a><span id="l5.27">     'nsAddbookProtocolHandler.cpp',</span>
<a href="#l5.28"></a><span id="l5.28">     'nsAddbookUrl.cpp',</span>
<a href="#l5.29"></a><span id="l5.29">     'nsAddrDatabase.cpp',</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-    'nsMsgVCardService.cpp',</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    'nsVCard.cpp',</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-    'nsVCardObj.cpp',</span>
<a href="#l5.33"></a><span id="l5.33"> ]</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35"> if CONFIG['OS_ARCH'] == 'WINNT' and CONFIG['MOZ_MAPI_SUPPORT']:</span>
<a href="#l5.36"></a><span id="l5.36">     SOURCES += [</span>
<a href="#l5.37"></a><span id="l5.37">         'nsAbOutlookDirectory.cpp',</span>
<a href="#l5.38"></a><span id="l5.38">         'nsAbOutlookInterface.cpp',</span>
<a href="#l5.39"></a><span id="l5.39">         'nsAbWinHelper.cpp',</span>
<a href="#l5.40"></a><span id="l5.40">         'nsMapiAddressBook.cpp',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -10,23 +10,22 @@</span>
<a href="#l6.4"></a><span id="l6.4"> #include &quot;plbase64.h&quot;</span>
<a href="#l6.5"></a><span id="l6.5"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;plstr.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsINetUtil.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> #include &quot;nsMemory.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-#include &quot;nsVCardObj.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l6.14"></a><span id="l6.14"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l6.15"></a><span id="l6.15"> #include &quot;mozITXTToHTMLConv.h&quot;</span>
<a href="#l6.16"></a><span id="l6.16"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l6.17"></a><span id="l6.17"> #include &quot;nsIUUIDGenerator.h&quot;</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+#include &quot;nsIMsgVCardService.h&quot;</span>
<a href="#l6.20"></a><span id="l6.20"> #include &quot;nsVariant.h&quot;</span>
<a href="#l6.21"></a><span id="l6.21"> #include &quot;nsIProperty.h&quot;</span>
<a href="#l6.22"></a><span id="l6.22"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l6.23"></a><span id="l6.23"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l6.24"></a><span id="l6.24"> #include &quot;prmem.h&quot;</span>
<a href="#l6.25"></a><span id="l6.25"> #include &quot;mozilla/ArrayUtils.h&quot;</span>
<a href="#l6.26"></a><span id="l6.26"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l6.27"></a><span id="l6.27"> using namespace mozilla;</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineat">@@ -502,215 +501,39 @@ NS_IMETHODIMP nsAbCardProperty::Equals(n</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l6.31"></a><span id="l6.31"> // The following methods are other views of a card</span>
<a href="#l6.32"></a><span id="l6.32"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l6.33"></a><span id="l6.33"> </span>
<a href="#l6.34"></a><span id="l6.34"> // XXX: Use the category manager instead of this file to implement these</span>
<a href="#l6.35"></a><span id="l6.35"> NS_IMETHODIMP nsAbCardProperty::TranslateTo(const nsACString &amp;type,</span>
<a href="#l6.36"></a><span id="l6.36">                                             nsACString &amp;result) {</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-  if (type.EqualsLiteral(&quot;base64xml&quot;))</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+  if (type.EqualsLiteral(&quot;base64xml&quot;)) {</span>
<a href="#l6.39"></a><span id="l6.39">     return ConvertToBase64EncodedXML(result);</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-  else if (type.EqualsLiteral(&quot;xml&quot;)) {</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+  } else if (type.EqualsLiteral(&quot;xml&quot;)) {</span>
<a href="#l6.42"></a><span id="l6.42">     nsString utf16String;</span>
<a href="#l6.43"></a><span id="l6.43">     nsresult rv = ConvertToXMLPrintData(utf16String);</span>
<a href="#l6.44"></a><span id="l6.44">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.45"></a><span id="l6.45">     result = NS_ConvertUTF16toUTF8(utf16String);</span>
<a href="#l6.46"></a><span id="l6.46">     return NS_OK;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-  } else if (type.EqualsLiteral(&quot;vcard&quot;))</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+  } else if (type.EqualsLiteral(&quot;vcard&quot;)) {</span>
<a href="#l6.49"></a><span id="l6.49">     return ConvertToEscapedVCard(result);</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+  }</span>
<a href="#l6.51"></a><span id="l6.51"> </span>
<a href="#l6.52"></a><span id="l6.52">   return NS_ERROR_ILLEGAL_VALUE;</span>
<a href="#l6.53"></a><span id="l6.53"> }</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-//</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-static VObject *myAddPropValue(VObject *o, const char *propName,</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-                               const char16_t *propValue, bool *aCardHasData) {</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-  if (aCardHasData) *aCardHasData = true;</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-  return addPropValue(o, propName, NS_ConvertUTF16toUTF8(propValue).get());</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-}</span>
<a href="#l6.60"></a><span id="l6.60"> </span>
<a href="#l6.61"></a><span id="l6.61"> nsresult nsAbCardProperty::ConvertToEscapedVCard(nsACString &amp;aResult) {</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-  nsString str;</span>
<a href="#l6.63"></a><span id="l6.63">   nsresult rv;</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-  bool vCardHasData = false;</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-  VObject *vObj = newVObject(VCCardProp);</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-  VObject *t;</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-  // [comment from 4.x]</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-  // Big flame coming....so Vobject is not designed at all to work with  an</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-  // array of attribute values. It wants you to have all of the attributes</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-  // easily available. You cannot add one attribute at a time as you find them</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-  // to the vobject. Why? Because it creates a property for a particular type</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-  // like phone number and then that property has multiple values. This</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-  // implementation is not pretty. I can hear my algos prof yelling from</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-  // here.....I have to do a linear search through my attributes array for EACH</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-  // vcard property we want to set. *sigh* One day I will have time to come back</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">-  // to this function and remedy this O(m*n) function where n = # attribute</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-  // values and m = # of vcard properties....</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-  (void)GetDisplayName(str);</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-  if (!str.IsEmpty()) {</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-    // Full name is a field with the same name.</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-    t = isAPropertyOf(vObj, VCFullNameProp);</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-    if (!t) t = addProp(vObj, VCFullNameProp);</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-    myAddPropValue(t, VCFullNameProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-  }</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-  (void)GetLastName(str);</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineminus">-  if (!str.IsEmpty()) {</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineminus">-    t = isAPropertyOf(vObj, VCNameProp);</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineminus">-    if (!t) t = addProp(vObj, VCNameProp);</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineminus">-    myAddPropValue(t, VCFamilyNameProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-  }</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-  (void)GetFirstName(str);</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineminus">-  if (!str.IsEmpty()) {</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineminus">-    t = isAPropertyOf(vObj, VCNameProp);</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineminus">-    if (!t) t = addProp(vObj, VCNameProp);</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineminus">-    myAddPropValue(t, VCGivenNameProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineminus">-  }</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineminus">-</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-  rv = GetPropertyAsAString(kCompanyProperty, str);</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineminus">-    t = isAPropertyOf(vObj, VCOrgProp);</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineminus">-    if (!t) t = addProp(vObj, VCOrgProp);</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineminus">-    myAddPropValue(t, VCOrgNameProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineminus">-  }</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineminus">-</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-  rv = GetPropertyAsAString(kDepartmentProperty, str);</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-    t = isAPropertyOf(vObj, VCOrgProp);</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineminus">-    if (!t) t = addProp(vObj, VCOrgProp);</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineminus">-    myAddPropValue(t, VCOrgUnitProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineminus">-  }</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineminus">-</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineminus">-  rv = GetPropertyAsAString(kWorkAddress2Property, str);</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineminus">-    t = isAPropertyOf(vObj, VCAdrProp);</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineminus">-    if (!t) t = addProp(vObj, VCAdrProp);</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineminus">-    myAddPropValue(t, VCPostalBoxProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineminus">-  }</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineminus">-</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineminus">-  rv = GetPropertyAsAString(kWorkAddressProperty, str);</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineminus">-    t = isAPropertyOf(vObj, VCAdrProp);</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineminus">-    if (!t) t = addProp(vObj, VCAdrProp);</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineminus">-    myAddPropValue(t, VCStreetAddressProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineminus">-  }</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineminus">-</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineminus">-  rv = GetPropertyAsAString(kWorkCityProperty, str);</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineminus">-    t = isAPropertyOf(vObj, VCAdrProp);</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineminus">-    if (!t) t = addProp(vObj, VCAdrProp);</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineminus">-    myAddPropValue(t, VCCityProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineminus">-  }</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineminus">-</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineminus">-  rv = GetPropertyAsAString(kWorkStateProperty, str);</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineminus">-    t = isAPropertyOf(vObj, VCAdrProp);</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineminus">-    if (!t) t = addProp(vObj, VCAdrProp);</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineminus">-    myAddPropValue(t, VCRegionProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineminus">-  }</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineminus">-</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineminus">-  rv = GetPropertyAsAString(kWorkZipCodeProperty, str);</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineminus">-    t = isAPropertyOf(vObj, VCAdrProp);</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineminus">-    if (!t) t = addProp(vObj, VCAdrProp);</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineminus">-    myAddPropValue(t, VCPostalCodeProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.149"></a><span id="l6.149" class="difflineminus">-  }</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineplus">+  nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService =</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineplus">+      do_GetService(NS_MSGVCARDSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.153"></a><span id="l6.153"> </span>
<a href="#l6.154"></a><span id="l6.154" class="difflineminus">-  rv = GetPropertyAsAString(kWorkCountryProperty, str);</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineminus">-    t = isAPropertyOf(vObj, VCAdrProp);</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineminus">-    if (!t) t = addProp(vObj, VCAdrProp);</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineminus">-    myAddPropValue(t, VCCountryNameProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineminus">-  } else {</span>
<a href="#l6.160"></a><span id="l6.160" class="difflineminus">-    // only add this if VCAdrProp already exists</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineminus">-    t = isAPropertyOf(vObj, VCAdrProp);</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineminus">-    if (t) {</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineminus">-      addProp(t, VCDomesticProp);</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineminus">-    }</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineminus">-  }</span>
<a href="#l6.166"></a><span id="l6.166" class="difflineminus">-</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineminus">-  (void)GetPrimaryEmail(str);</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineminus">-  if (!str.IsEmpty()) {</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineminus">-    t = myAddPropValue(vObj, VCEmailAddressProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineminus">-    addProp(t, VCInternetProp);</span>
<a href="#l6.171"></a><span id="l6.171" class="difflineminus">-  }</span>
<a href="#l6.172"></a><span id="l6.172" class="difflineminus">-</span>
<a href="#l6.173"></a><span id="l6.173" class="difflineminus">-  rv = GetPropertyAsAString(kJobTitleProperty, str);</span>
<a href="#l6.174"></a><span id="l6.174" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.175"></a><span id="l6.175" class="difflineminus">-    myAddPropValue(vObj, VCTitleProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.176"></a><span id="l6.176" class="difflineminus">-  }</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineminus">-</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineminus">-  rv = GetPropertyAsAString(kWorkPhoneProperty, str);</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineminus">-    t = myAddPropValue(vObj, VCTelephoneProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineminus">-    addProp(t, VCWorkProp);</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineminus">-  }</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineminus">-</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineminus">-  rv = GetPropertyAsAString(kFaxProperty, str);</span>
<a href="#l6.185"></a><span id="l6.185" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.186"></a><span id="l6.186" class="difflineminus">-    t = myAddPropValue(vObj, VCTelephoneProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.187"></a><span id="l6.187" class="difflineminus">-    addProp(t, VCFaxProp);</span>
<a href="#l6.188"></a><span id="l6.188" class="difflineminus">-  }</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineminus">-</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineminus">-  rv = GetPropertyAsAString(kPagerProperty, str);</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.192"></a><span id="l6.192" class="difflineminus">-    t = myAddPropValue(vObj, VCTelephoneProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineminus">-    addProp(t, VCPagerProp);</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineminus">-  }</span>
<a href="#l6.195"></a><span id="l6.195" class="difflineminus">-</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineminus">-  rv = GetPropertyAsAString(kHomePhoneProperty, str);</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.198"></a><span id="l6.198" class="difflineminus">-    t = myAddPropValue(vObj, VCTelephoneProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineminus">-    addProp(t, VCHomeProp);</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-  }</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineminus">-</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineminus">-  rv = GetPropertyAsAString(kCellularProperty, str);</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineminus">-    t = myAddPropValue(vObj, VCTelephoneProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineminus">-    addProp(t, VCCellularProp);</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineminus">-  }</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineminus">-</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineminus">-  rv = GetPropertyAsAString(kNotesProperty, str);</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineminus">-    myAddPropValue(vObj, VCNoteProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineminus">-  }</span>
<a href="#l6.212"></a><span id="l6.212" class="difflineminus">-</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineminus">-  uint32_t format;</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineminus">-  rv = GetPropertyAsUint32(kPreferMailFormatProperty, &amp;format);</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; format == nsIAbPreferMailFormat::html) {</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineminus">-    myAddPropValue(vObj, VCUseHTML, u&quot;TRUE&quot;, &amp;vCardHasData);</span>
<a href="#l6.217"></a><span id="l6.217" class="difflineminus">-  } else if (NS_SUCCEEDED(rv) &amp;&amp; format == nsIAbPreferMailFormat::plaintext) {</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineminus">-    myAddPropValue(vObj, VCUseHTML, u&quot;FALSE&quot;, &amp;vCardHasData);</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineminus">-  }</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineminus">-</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineminus">-  rv = GetPropertyAsAString(kWorkWebPageProperty, str);</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !str.IsEmpty()) {</span>
<a href="#l6.223"></a><span id="l6.223" class="difflineminus">-    myAddPropValue(vObj, VCURLProp, str.get(), &amp;vCardHasData);</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-  }</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineminus">-</span>
<a href="#l6.226"></a><span id="l6.226" class="difflineminus">-  myAddPropValue(vObj, VCVersionProp, u&quot;2.1&quot;, nullptr);</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineminus">-  if (!vCardHasData) {</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineminus">-    aResult.Truncate();</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineminus">-    cleanVObject(vObj);</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-    return NS_OK;</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineminus">-  }</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineminus">-</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineminus">-  int len = 0;</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineminus">-  char *vCard = writeMemVObject(0, &amp;len, vObj);</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineminus">-  if (vObj) cleanVObject(vObj);</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineminus">-</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineminus">-  nsCString escResult;</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineminus">-  MsgEscapeString(nsDependentCString(vCard), nsINetUtil::ESCAPE_URL_PATH,</span>
<a href="#l6.240"></a><span id="l6.240" class="difflineminus">-                  escResult);</span>
<a href="#l6.241"></a><span id="l6.241" class="difflineminus">-  aResult = escResult;</span>
<a href="#l6.242"></a><span id="l6.242" class="difflineminus">-  return NS_OK;</span>
<a href="#l6.243"></a><span id="l6.243" class="difflineplus">+  nsCOMPtr&lt;nsIAbCard&gt; cardFromVCard;</span>
<a href="#l6.244"></a><span id="l6.244" class="difflineplus">+  return vCardService-&gt;AbCardToEscapedVCard(this, aResult);</span>
<a href="#l6.245"></a><span id="l6.245"> }</span>
<a href="#l6.246"></a><span id="l6.246"> </span>
<a href="#l6.247"></a><span id="l6.247"> nsresult nsAbCardProperty::ConvertToBase64EncodedXML(nsACString &amp;result) {</span>
<a href="#l6.248"></a><span id="l6.248">   nsresult rv;</span>
<a href="#l6.249"></a><span id="l6.249">   nsString xmlStr;</span>
<a href="#l6.250"></a><span id="l6.250"> </span>
<a href="#l6.251"></a><span id="l6.251">   xmlStr.AppendLiteral(</span>
<a href="#l6.252"></a><span id="l6.252">       &quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;\n&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbContentHandler.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbContentHandler.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -14,19 +14,17 @@</span>
<a href="#l7.4"></a><span id="l7.4"> #include &quot;plstr.h&quot;</span>
<a href="#l7.5"></a><span id="l7.5"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l7.6"></a><span id="l7.6"> #include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l7.7"></a><span id="l7.7"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l7.8"></a><span id="l7.8"> #include &quot;nsIDocShellTreeItem.h&quot;</span>
<a href="#l7.9"></a><span id="l7.9"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l7.10"></a><span id="l7.10"> #include &quot;nsIMsgVCardService.h&quot;</span>
<a href="#l7.11"></a><span id="l7.11"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-#include &quot;nsVCard.h&quot;</span>
<a href="#l7.13"></a><span id="l7.13"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-#include &quot;nsIMsgVCardService.h&quot;</span>
<a href="#l7.15"></a><span id="l7.15"> //</span>
<a href="#l7.16"></a><span id="l7.16"> // nsAbContentHandler</span>
<a href="#l7.17"></a><span id="l7.17"> //</span>
<a href="#l7.18"></a><span id="l7.18"> nsAbContentHandler::nsAbContentHandler() {}</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> nsAbContentHandler::~nsAbContentHandler() {}</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22"> NS_IMPL_ISUPPORTS(nsAbContentHandler, nsIContentHandler,</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineat">@@ -142,44 +140,29 @@ nsAbContentHandler::OnStreamComplete(nsI</span>
<a href="#l7.24"></a><span id="l7.24">                                      uint32_t datalen, const uint8_t *data) {</span>
<a href="#l7.25"></a><span id="l7.25">   NS_ENSURE_ARG_POINTER(aContext);</span>
<a href="#l7.26"></a><span id="l7.26">   NS_ENSURE_SUCCESS(</span>
<a href="#l7.27"></a><span id="l7.27">       aStatus, aStatus);  // don't process the vcard if we got a status error</span>
<a href="#l7.28"></a><span id="l7.28">   nsresult rv = NS_OK;</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30">   // take our vCard string and open up an address book window based on it</span>
<a href="#l7.31"></a><span id="l7.31">   nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService =</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-      do_GetService(NS_MSGVCARDSERVICE_CONTRACTID);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-  if (vCardService) {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-    mozilla::UniquePtr&lt;VObject&gt; vObj(</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-        vCardService-&gt;Parse_MIME((const char *)data, datalen));</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-    if (vObj) {</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-      int32_t len = 0;</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-      nsCString vCard;</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-      vCard.Adopt(</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-          vCardService-&gt;WriteMemoryVObjects(0, &amp;len, vObj.get(), false));</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+      do_GetService(NS_MSGVCARDSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44" class="difflineminus">-      nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService =</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-          do_GetService(NS_MSGVCARDSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+  nsCOMPtr&lt;nsIAbCard&gt; cardFromVCard;</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+  rv = vCardService-&gt;EscapedVCardToAbCard((const char *)data,</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+                                          getter_AddRefs(cardFromVCard));</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.51"></a><span id="l7.51"> </span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-      nsCOMPtr&lt;nsIAbCard&gt; cardFromVCard;</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-      rv = vCardService-&gt;EscapedVCardToAbCard(vCard.get(),</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-                                              getter_AddRefs(cardFromVCard));</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-      nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow = do_GetInterface(aContext);</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-      NS_ENSURE_TRUE(domWindow, NS_ERROR_FAILURE);</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-      nsCOMPtr&lt;nsPIDOMWindowOuter&gt; parentWindow =</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-          nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+  nsCOMPtr&lt;mozIDOMWindowProxy&gt; domWindow = do_GetInterface(aContext);</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+  NS_ENSURE_TRUE(domWindow, NS_ERROR_FAILURE);</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+  nsCOMPtr&lt;nsPIDOMWindowOuter&gt; parentWindow =</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+      nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l7.65"></a><span id="l7.65"> </span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-      RefPtr&lt;mozilla::dom::BrowsingContext&gt; dialogWindow;</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-      rv = parentWindow-&gt;OpenDialog(</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-          NS_LITERAL_STRING(</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-              &quot;chrome://messenger/content/addressbook/abNewCardDialog.xhtml&quot;),</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-          EmptyString(),</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-          NS_LITERAL_STRING(&quot;chrome,resizable=no,titlebar,modal,centerscreen&quot;),</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-          cardFromVCard, getter_AddRefs(dialogWindow));</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineminus">-    }</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-  }</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-  return rv;</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+  RefPtr&lt;mozilla::dom::BrowsingContext&gt; dialogWindow;</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+  return parentWindow-&gt;OpenDialog(</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+      NS_LITERAL_STRING(</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+          &quot;chrome://messenger/content/addressbook/abNewCardDialog.xhtml&quot;),</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+      EmptyString(),</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+      NS_LITERAL_STRING(&quot;chrome,resizable=no,titlebar,modal,centerscreen&quot;),</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+      cardFromVCard, getter_AddRefs(dialogWindow));</span>
<a href="#l7.84"></a><span id="l7.84"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">deleted file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- a/mailnews/addrbook/src/nsMsgVCardService.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ /dev/null</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -1,193 +0,0 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">-#include &quot;nsIAbCard.h&quot;</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-#include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-#include &quot;nsMsgVCardService.h&quot;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-#include &quot;nsVCard.h&quot;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-#include &quot;prmem.h&quot;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-#include &quot;plstr.h&quot;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-NS_IMPL_ISUPPORTS(nsMsgVCardService, nsIMsgVCardService)</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-nsMsgVCardService::nsMsgVCardService() {}</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-nsMsgVCardService::~nsMsgVCardService() {}</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-NS_IMETHODIMP_(void) nsMsgVCardService::CleanVObject(VObject *o) {</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-  cleanVObject(o);</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-}</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-NS_IMETHODIMP_(VObject *) nsMsgVCardService::NextVObjectInList(VObject *o) {</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-  return nextVObjectInList(o);</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-}</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-NS_IMETHODIMP_(VObject *)</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-nsMsgVCardService::Parse_MIME(const char *input, uint32_t len) {</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-  return parse_MIME(input, (unsigned long)len);</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-}</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-NS_IMETHODIMP_(char *) nsMsgVCardService::FakeCString(VObject *o) {</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-  return fakeCString(vObjectUStringZValue(o));</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-}</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-NS_IMETHODIMP_(VObject *)</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-nsMsgVCardService::IsAPropertyOf(VObject *o, const char *id) {</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-  return isAPropertyOf(o, id);</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-}</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-NS_IMETHODIMP_(char *)</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-nsMsgVCardService::WriteMemoryVObjects(const char *s, int32_t *len,</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-                                       VObject *list, bool expandSpaces) {</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-  return writeMemoryVObjects((char *)s, len, list, expandSpaces);</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-}</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-NS_IMETHODIMP_(VObject *) nsMsgVCardService::NextVObject(VObjectIterator *i) {</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-  return nextVObject(i);</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-}</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineminus">-NS_IMETHODIMP_(void)</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-nsMsgVCardService::InitPropIterator(VObjectIterator *i, VObject *o) {</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-  initPropIterator(i, o);</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-}</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-NS_IMETHODIMP_(int32_t) nsMsgVCardService::MoreIteration(VObjectIterator *i) {</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-  return ((int32_t)moreIteration(i));</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-}</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-NS_IMETHODIMP_(const char *) nsMsgVCardService::VObjectName(VObject *o) {</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-  return vObjectName(o);</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-}</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-NS_IMETHODIMP_(char *) nsMsgVCardService::VObjectAnyValue(VObject *o) {</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-  char *retval = (char *)PR_MALLOC(strlen((char *)vObjectAnyValue(o)) + 1);</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-  if (retval) PL_strcpy(retval, (char *)vObjectAnyValue(o));</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-  return retval;</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-}</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-char *getCString(VObject *vObj) {</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-  if (VALUE_TYPE(vObj) == VCVT_USTRINGZ)</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-    return fakeCString(vObjectUStringZValue(vObj));</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-  if (VALUE_TYPE(vObj) == VCVT_STRINGZ)</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-    return PL_strdup(vObjectStringZValue(vObj));</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-  return NULL;</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-}</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-static void convertNameValue(VObject *vObj, nsIAbCard *aCard) {</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-  const char *cardPropName = NULL;</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineminus">-  // if the vCard property is not a root property then we need to determine its</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-  // exact property. a good example of this is VCTelephoneProp, this prop has</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineminus">-  // four objects underneath it: fax, work and home and cellular.</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineminus">-  if (PL_strcasecmp(VCCityProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineminus">-    cardPropName = kWorkCityProperty;</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineminus">-  else if (PL_strcasecmp(VCTelephoneProp, vObjectName(vObj)) == 0) {</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineminus">-    if (isAPropertyOf(vObj, VCFaxProp))</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineminus">-      cardPropName = kFaxProperty;</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineminus">-    else if (isAPropertyOf(vObj, VCWorkProp))</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-      cardPropName = kWorkPhoneProperty;</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineminus">-    else if (isAPropertyOf(vObj, VCHomeProp))</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineminus">-      cardPropName = kHomePhoneProperty;</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineminus">-    else if (isAPropertyOf(vObj, VCCellularProp))</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineminus">-      cardPropName = kCellularProperty;</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-    else if (isAPropertyOf(vObj, VCPagerProp))</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineminus">-      cardPropName = kPagerProperty;</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineminus">-    else</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineminus">-      return;</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-  } else if (PL_strcasecmp(VCEmailAddressProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-    cardPropName = kPriEmailProperty;</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-  else if (PL_strcasecmp(VCFamilyNameProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-    cardPropName = kLastNameProperty;</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-  else if (PL_strcasecmp(VCFullNameProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-    cardPropName = kDisplayNameProperty;</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-  else if (PL_strcasecmp(VCGivenNameProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-    cardPropName = kFirstNameProperty;</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-  else if (PL_strcasecmp(VCOrgNameProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-    cardPropName = kCompanyProperty;</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-  else if (PL_strcasecmp(VCOrgUnitProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineminus">-    cardPropName = kDepartmentProperty;</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-  else if (PL_strcasecmp(VCPostalCodeProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineminus">-    cardPropName = kWorkZipCodeProperty;</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineminus">-  else if (PL_strcasecmp(VCRegionProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineminus">-    cardPropName = kWorkStateProperty;</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineminus">-  else if (PL_strcasecmp(VCStreetAddressProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineminus">-    cardPropName = kWorkAddressProperty;</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineminus">-  else if (PL_strcasecmp(VCPostalBoxProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineminus">-    cardPropName = kWorkAddress2Property;</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineminus">-  else if (PL_strcasecmp(VCCountryNameProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineminus">-    cardPropName = kWorkCountryProperty;</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineminus">-  else if (PL_strcasecmp(VCTitleProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineminus">-    cardPropName = kJobTitleProperty;</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineminus">-  else if (PL_strcasecmp(VCUseHTML, vObjectName(vObj)) == 0)</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineminus">-    cardPropName = kPreferMailFormatProperty;</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineminus">-  else if (PL_strcasecmp(VCNoteProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.132"></a><span id="l8.132" class="difflineminus">-    cardPropName = kNotesProperty;</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineminus">-  else if (PL_strcasecmp(VCURLProp, vObjectName(vObj)) == 0)</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineminus">-    cardPropName = kWorkWebPageProperty;</span>
<a href="#l8.135"></a><span id="l8.135" class="difflineminus">-  else</span>
<a href="#l8.136"></a><span id="l8.136" class="difflineminus">-    return;</span>
<a href="#l8.137"></a><span id="l8.137" class="difflineminus">-</span>
<a href="#l8.138"></a><span id="l8.138" class="difflineminus">-  if (!VALUE_TYPE(vObj)) return;</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineminus">-</span>
<a href="#l8.140"></a><span id="l8.140" class="difflineminus">-  char *cardPropValue = getCString(vObj);</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineminus">-  if (PL_strcmp(cardPropName, kPreferMailFormatProperty)) {</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineminus">-    aCard-&gt;SetPropertyAsAUTF8String(cardPropName,</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineminus">-                                    nsDependentCString(cardPropValue));</span>
<a href="#l8.144"></a><span id="l8.144" class="difflineminus">-  } else {</span>
<a href="#l8.145"></a><span id="l8.145" class="difflineminus">-    if (!PL_strcmp(cardPropValue, &quot;TRUE&quot;))</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineminus">-      aCard-&gt;SetPropertyAsUint32(cardPropName, nsIAbPreferMailFormat::html);</span>
<a href="#l8.147"></a><span id="l8.147" class="difflineminus">-    else if (!PL_strcmp(cardPropValue, &quot;FALSE&quot;))</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineminus">-      aCard-&gt;SetPropertyAsUint32(cardPropName,</span>
<a href="#l8.149"></a><span id="l8.149" class="difflineminus">-                                 nsIAbPreferMailFormat::plaintext);</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineminus">-    else</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineminus">-      aCard-&gt;SetPropertyAsUint32(cardPropName, nsIAbPreferMailFormat::unknown);</span>
<a href="#l8.152"></a><span id="l8.152" class="difflineminus">-  }</span>
<a href="#l8.153"></a><span id="l8.153" class="difflineminus">-  PR_FREEIF(cardPropValue);</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineminus">-  return;</span>
<a href="#l8.155"></a><span id="l8.155" class="difflineminus">-}</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineminus">-</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineminus">-static void convertFromVObject(VObject *vObj, nsIAbCard *aCard) {</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineminus">-  if (vObj) {</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineminus">-    VObjectIterator t;</span>
<a href="#l8.160"></a><span id="l8.160" class="difflineminus">-</span>
<a href="#l8.161"></a><span id="l8.161" class="difflineminus">-    convertNameValue(vObj, aCard);</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineminus">-</span>
<a href="#l8.163"></a><span id="l8.163" class="difflineminus">-    initPropIterator(&amp;t, vObj);</span>
<a href="#l8.164"></a><span id="l8.164" class="difflineminus">-    while (moreIteration(&amp;t)) {</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineminus">-      VObject *nextObject = nextVObject(&amp;t);</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineminus">-      convertFromVObject(nextObject, aCard);</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineminus">-    }</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineminus">-  }</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineminus">-  return;</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineminus">-}</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineminus">-</span>
<a href="#l8.172"></a><span id="l8.172" class="difflineminus">-NS_IMETHODIMP nsMsgVCardService::EscapedVCardToAbCard(</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineminus">-    const char *aEscapedVCardStr, nsIAbCard **aCard) {</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineminus">-  NS_ENSURE_ARG_POINTER(aEscapedVCardStr);</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineminus">-  NS_ENSURE_ARG_POINTER(aCard);</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineminus">-</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineminus">-  nsCOMPtr&lt;nsIAbCard&gt; cardFromVCard =</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineminus">-      do_CreateInstance(NS_ABCARDPROPERTY_CONTRACTID);</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineminus">-  if (!cardFromVCard) return NS_ERROR_FAILURE;</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineminus">-</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineminus">-  // aEscapedVCardStr will be &quot;&quot; the first time, before you have a vCard</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineminus">-  if (*aEscapedVCardStr != '\0') {</span>
<a href="#l8.183"></a><span id="l8.183" class="difflineminus">-    nsCString unescapedData;</span>
<a href="#l8.184"></a><span id="l8.184" class="difflineminus">-    MsgUnescapeString(nsDependentCString(aEscapedVCardStr), 0, unescapedData);</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineminus">-</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineminus">-    VObject *vObj = parse_MIME(unescapedData.get(), unescapedData.Length());</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineminus">-    if (vObj) {</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineminus">-      convertFromVObject(vObj, cardFromVCard);</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineminus">-</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineminus">-      cleanVObject(vObj);</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineminus">-    } else</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineminus">-      NS_WARNING(&quot;Parse of vCard failed&quot;);</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineminus">-  }</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineminus">-</span>
<a href="#l8.195"></a><span id="l8.195" class="difflineminus">-  cardFromVCard.forget(aCard);</span>
<a href="#l8.196"></a><span id="l8.196" class="difflineminus">-  return NS_OK;</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">deleted file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- a/mailnews/addrbook/src/nsMsgVCardService.h</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ /dev/null</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -1,23 +0,0 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">-</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">-#ifndef nsMsgVCardService_h___</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">-#define nsMsgVCardService_h___</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-#include &quot;nsIMsgVCardService.h&quot;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-#include &quot;nsISupports.h&quot;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-class nsMsgVCardService : public nsIMsgVCardService {</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">- public:</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-  NS_DECL_ISUPPORTS</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-  NS_DECL_NSIMSGVCARDSERVICE</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-  nsMsgVCardService();</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">- private:</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-  virtual ~nsMsgVCardService();</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-};</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-#endif /* nsMsgVCardService_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">deleted file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- a/mailnews/addrbook/src/nsVCard.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ /dev/null</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -1,1483 +0,0 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">-</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">-/***************************************************************************</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">-(C) Copyright 1996 Apple Computer, Inc., AT&amp;T Corp., International</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-Business Machines Corporation and Siemens Rolm Communications Inc.</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-For purposes of this license notice, the term Licensors shall mean,</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-collectively, Apple Computer, Inc., AT&amp;T Corp., International</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-Business Machines Corporation and Siemens Rolm Communications Inc.</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-The term Licensor shall mean any of the Licensors.</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">-Subject to acceptance of the following conditions, permission is hereby</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-granted by Licensors without the need for written agreement and without</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">-license or royalty fees, to use, copy, modify and distribute this</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-software for any purpose.</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-The above copyright notice and the following four paragraphs must be</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">-reproduced in all copies of this software and any software including</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-this software.</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">-THIS SOFTWARE IS PROVIDED ON AN &quot;AS IS&quot; BASIS AND NO LICENSOR SHALL HAVE</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-ANY OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS OR</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-MODIFICATIONS.</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-IN NO EVENT SHALL ANY LICENSOR BE LIABLE TO ANY PARTY FOR DIRECT,</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES OR LOST PROFITS ARISING OUT</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-OF THE USE OF THIS SOFTWARE EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-DAMAGE.</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-EACH LICENSOR SPECIFICALLY DISCLAIMS ANY WARRANTIES, EXPRESS OR IMPLIED,</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-INCLUDING BUT NOT LIMITED TO ANY WARRANTY OF NONINFRINGEMENT OR THE</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">-PURPOSE.</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-The software is provided with RESTRICTED RIGHTS.  Use, duplication, or</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-disclosure by the government are subject to restrictions set forth in</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-DFARS 252.227-7013 or 48 CFR 52.227-19, as applicable.</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-***************************************************************************/</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-/*</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">- * src: vcc.c</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">- * doc: Parser for vCard and vCalendar. Note that this code is</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">- * generated by a yacc parser generator. Generally it should not</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">- * be edited by hand. The real source is vcc.y. The #line directives</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">- * can be commented out here to make it easier to trace through</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">- * in a debugger. However, if a bug is found it should</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">- *</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">- * the vcc.y that _this_ vcc.c comes from is lost.</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">- * I couldn't find it in the 4.x tree</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">- * I bet we took it from IMC's original SDK, but the SDK has been taken down.</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">- * see http://www.imc.org/imc-vcard/mail-archive/msg00460.html</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">- *</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">- * for what it's worth, see</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineminus">- * http://softwarestudio.org/libical/</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">- * http://lxr.mozilla.org/mozilla/source/other-licenses/libical/src/libicalvcal/vcc.y</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">- * http://lxr.mozilla.org/mozilla/source/other-licenses/libical/src/libicalvcal/vcc.c</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">- */</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-#include &quot;nsVCard.h&quot;</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineminus">-#include &quot;nsVCardObj.h&quot;</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-#include &quot;prprf.h&quot;</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-#include &quot;nscore.h&quot;</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineminus">-#include &lt;string.h&gt;</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-#include &lt;ctype.h&gt;</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-#ifndef lint</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-char yysccsid[] = &quot;@(#)yaccpar  1.4 (Berkeley) 02/25/90&quot;;</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-#endif</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-/*#line 2 &quot;vcc.y&quot; */</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineminus">-/* debugging utilities */</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-#define DBG_(x)</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineminus">-#ifndef _NO_LINE_FOLDING</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-#  define _SUPPORT_LINE_FOLDING</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineminus">-#endif</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineminus">-</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-/****  External Functions  ****/</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineminus">-/* assign local name to parser variables and functions so that</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">- * we can use more than one yacc based parser.</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineminus">- */</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineminus">-#define yyparse mime_parse</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineminus">-#define yylex mime_lex</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-#define yyerror mime_error</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-#define yychar mime_char</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineminus">-/* #define p_yyval p_mime_val */</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-#undef yyval</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineminus">-#define yyval mime_yyval</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineminus">-/* #define p_yylval p_mime_lval */</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-#undef yylval</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineminus">-#define yylval mime_yylval</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineminus">-#define yydebug mime_debug</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineminus">-#define yynerrs mime_nerrs</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineminus">-#define yyerrflag mime_errflag</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-#define yyss mime_ss</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-#define yyssp mime_ssp</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-#define yyvs mime_vs</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-#define yyvsp mime_vsp</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineminus">-#define yylhs mime_lhs</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-#define yylen mime_len</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineminus">-#define yydefred mime_defred</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineminus">-#define yydgoto mime_dgoto</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">-#define yysindex mime_sindex</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineminus">-#define yyrindex mime_rindex</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineminus">-#define yygindex mime_gindex</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineminus">-#define yytable mime_table</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineminus">-#define yycheck mime_check</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineminus">-#define yyname mime_name</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineminus">-#define yyrule mime_rule</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineminus">-#define YYPREFIX &quot;mime_&quot;</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineminus">-#include &quot;prmem.h&quot;</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineminus">-#include &quot;plstr.h&quot;</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineminus">-</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineminus">-#ifndef FALSE</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineminus">-#  define FALSE 0</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineminus">-#endif</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineminus">-#ifndef TRUE</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineminus">-#  define TRUE 1</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineminus">-#endif</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineminus">-</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-/****  Types, Constants  ****/</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineminus">-</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineminus">-#define YYDEBUG 0       /* 1 to compile in some debugging code */</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineminus">-#define PR_MAXTOKEN 256 /* maximum token (line) length */</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineminus">-#define YYSTACKSIZE 50  /* ~unref ?*/</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineminus">-#define PR_MAXLEVEL 10  /* max # of nested objects parseable */</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineminus">-                        /* (includes outermost) */</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineminus">-</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineminus">-/****  Global Variables  ****/</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineminus">-int mime_lineNum, mime_numErrors; /* yyerror() can use these */</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineminus">-static VObject *vObjList;</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineminus">-static VObject *curProp;</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineminus">-static VObject *curObj;</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineminus">-static VObject *ObjStack[PR_MAXLEVEL];</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineminus">-static int ObjStackTop;</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineminus">-</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineminus">-/* A helpful utility for the rest of the app. */</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineminus">-extern &quot;C&quot; {</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineminus">-#endif</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineminus">-</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineminus">-extern void yyerror(const char *s);</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineminus">-extern char **fieldedProp;</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineminus">-</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineminus">-}</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineminus">-#endif</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineminus">-</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineminus">-int yyparse();</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineminus">-</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineminus">-enum LexMode {</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineminus">-  L_NORMAL,</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineminus">-  L_VCARD,</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineminus">-  L_VCAL,</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineminus">-  L_VEVENT,</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineminus">-  L_VTODO,</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineminus">-  L_VALUES,</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineminus">-  L_BASE64,</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineminus">-  L_QUOTED_PRINTABLE</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineminus">-};</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineminus">-</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineminus">-/****  Private Forward Declarations  ****/</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineminus">-static int pushVObject(const char *prop);</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineminus">-static VObject *popVObject();</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineminus">-static int lexGeta();</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineminus">-static int lexGetc_();</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineminus">-static int lexGetc();</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineminus">-static void lexSkipLookahead();</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineminus">-static int lexLookahead();</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineminus">-static void lexSkipWhite();</span>
<a href="#l10.181"></a><span id="l10.181" class="difflineminus">-static void lexClearToken();</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineminus">-static char *lexStr();</span>
<a href="#l10.183"></a><span id="l10.183" class="difflineminus">-static char *lexGetDataFromBase64();</span>
<a href="#l10.184"></a><span id="l10.184" class="difflineminus">-static char *lexGetQuotedPrintable();</span>
<a href="#l10.185"></a><span id="l10.185" class="difflineminus">-static char *lexGet1Value();</span>
<a href="#l10.186"></a><span id="l10.186" class="difflineminus">-static char *lexGetWord();</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineminus">-static void finiLex();</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineminus">-</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineminus">-static VObject *parse_MIMEHelper();</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineminus">-</span>
<a href="#l10.191"></a><span id="l10.191" class="difflineminus">-/*static char* lexDataFromBase64();*/</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineminus">-static void lexPopMode(int top);</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineminus">-static int lexWithinMode(enum LexMode mode);</span>
<a href="#l10.194"></a><span id="l10.194" class="difflineminus">-static void lexPushMode(enum LexMode mode);</span>
<a href="#l10.195"></a><span id="l10.195" class="difflineminus">-static void enterProps(const char *s);</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineminus">-static void enterAttr(const char *s1, const char *s2);</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineminus">-static void enterValues(const char *value);</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineminus">-</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineminus">-/*#line 250 &quot;vcc.y&quot; */</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineminus">-typedef union {</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineminus">-  char *str;</span>
<a href="#l10.202"></a><span id="l10.202" class="difflineminus">-  VObject *vobj;</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineminus">-} YYSTYPE;</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineminus">-/*#line 253 &quot;y_tab.c&quot;*/</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineminus">-#define EQ 257</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineminus">-#define COLON 258</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineminus">-#define DOT 259</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineminus">-#define SEMICOLON 260</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineminus">-#define SPACE 261</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineminus">-#define HTAB 262</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineminus">-#define LINESEP 263</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineminus">-#define NEWLINE 264</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineminus">-#define BEGIN_VCARD 265</span>
<a href="#l10.214"></a><span id="l10.214" class="difflineminus">-#define END_VCARD 266</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineminus">-#define BEGIN_VCAL 267</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineminus">-#define END_VCAL 268</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineminus">-#define BEGIN_VEVENT 269</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineminus">-#define END_VEVENT 270</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineminus">-#define BEGIN_VTODO 271</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineminus">-#define END_VTODO 272</span>
<a href="#l10.221"></a><span id="l10.221" class="difflineminus">-#define ID 273</span>
<a href="#l10.222"></a><span id="l10.222" class="difflineminus">-#define STRING 274</span>
<a href="#l10.223"></a><span id="l10.223" class="difflineminus">-#define YYERRCODE 256</span>
<a href="#l10.224"></a><span id="l10.224" class="difflineminus">-</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineminus">-// clang-format off</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineminus">-short yylhs[] = {                                        -1,</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineminus">-    0,    7,    6,    6,    5,    5,    9,    3,   10,    3,</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineminus">-    8,    8,   14,   11,   11,   16,   12,   12,   15,   15,</span>
<a href="#l10.229"></a><span id="l10.229" class="difflineminus">-   17,   18,   18,    1,   19,   13,   13,    2,    2,   21,</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineminus">-    4,   22,    4,   20,   20,   23,   23,   23,   26,   24,</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineminus">-   27,   24,   28,   25,   29,   25,</span>
<a href="#l10.232"></a><span id="l10.232" class="difflineminus">-};</span>
<a href="#l10.233"></a><span id="l10.233" class="difflineminus">-short yylen[] = {                                         2,</span>
<a href="#l10.234"></a><span id="l10.234" class="difflineminus">-    1,    0,    3,    1,    1,    1,    0,    4,    0,    3,</span>
<a href="#l10.235"></a><span id="l10.235" class="difflineminus">-    2,    1,    0,    5,    1,    0,    3,    1,    2,    1,</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineminus">-    2,    1,    3,    1,    0,    4,    1,    1,    0,    0,</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineminus">-    4,    0,    3,    2,    1,    1,    1,    1,    0,    4,</span>
<a href="#l10.238"></a><span id="l10.238" class="difflineminus">-    0,    3,    0,    4,    0,    3,</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineminus">-};</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineminus">-short yydefred[] = {                                      0,</span>
<a href="#l10.241"></a><span id="l10.241" class="difflineminus">-    0,    0,    0,    5,    6,    0,    1,    0,    0,    0,</span>
<a href="#l10.242"></a><span id="l10.242" class="difflineminus">-    0,    0,   15,   24,    0,    0,    0,    0,   10,    0,</span>
<a href="#l10.243"></a><span id="l10.243" class="difflineminus">-    0,   38,    0,    0,   36,   37,   33,    3,    0,    8,</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineminus">-   11,   13,    0,    0,    0,    0,   31,   34,    0,   17,</span>
<a href="#l10.245"></a><span id="l10.245" class="difflineminus">-    0,    0,    0,   42,    0,   46,    0,   21,   19,   28,</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineminus">-    0,    0,   40,   44,    0,   25,   14,   23,    0,   26,</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineminus">-};</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineminus">-short yydgoto[] = {                                       3,</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineminus">-   15,   51,    4,    5,    6,    7,   12,   22,    8,    9,</span>
<a href="#l10.250"></a><span id="l10.250" class="difflineminus">-   17,   18,   52,   42,   40,   29,   41,   48,   59,   23,</span>
<a href="#l10.251"></a><span id="l10.251" class="difflineminus">-   10,   11,   24,   25,   26,   33,   34,   35,   36,</span>
<a href="#l10.252"></a><span id="l10.252" class="difflineminus">-};</span>
<a href="#l10.253"></a><span id="l10.253" class="difflineminus">-short yysindex[] = {                                   -227,</span>
<a href="#l10.254"></a><span id="l10.254" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0, -249, -262, -253,</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineminus">- -258, -227,    0,    0,    0, -234, -249, -215,    0,    0,</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineminus">-    0,    0, -223, -253,    0,    0,    0,    0, -247,    0,</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineminus">-    0,    0, -249, -222, -249, -225,    0,    0, -224,    0,</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineminus">- -247, -221, -220,    0, -218,    0, -206,    0,    0,    0,</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineminus">- -208, -207,    0,    0, -224,    0,    0,    0, -221,    0,</span>
<a href="#l10.260"></a><span id="l10.260" class="difflineminus">-};</span>
<a href="#l10.261"></a><span id="l10.261" class="difflineminus">-short yyrindex[] = {                                      0,</span>
<a href="#l10.262"></a><span id="l10.262" class="difflineminus">- -245, -254,    0,    0,    0,    1,    0,    0,    0,    0,</span>
<a href="#l10.263"></a><span id="l10.263" class="difflineminus">-    0,    0,    0,    0, -219,    0, -235,    0,    0, -244,</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineminus">- -250,    0,    0, -213,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineminus">- -201, -255,    0,    0,    0,    0, -216,    0,    0,    0,</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineminus">- -205,    0,    0,    0,    0,    0,    0,    0, -255,    0,</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineminus">-};</span>
<a href="#l10.269"></a><span id="l10.269" class="difflineminus">-short yygindex[] = {                                      0,</span>
<a href="#l10.270"></a><span id="l10.270" class="difflineminus">-   -9,    0,    0,    0,    0,   47,    0,   -8,    0,    0,</span>
<a href="#l10.271"></a><span id="l10.271" class="difflineminus">-    0,    0,    2,    0,   19,    0,    0,    0,    0,   38,</span>
<a href="#l10.272"></a><span id="l10.272" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.273"></a><span id="l10.273" class="difflineminus">-};</span>
<a href="#l10.274"></a><span id="l10.274" class="difflineminus">-#define YYTABLESIZE 268</span>
<a href="#l10.275"></a><span id="l10.275" class="difflineminus">-short yytable[] = {                                      16,</span>
<a href="#l10.276"></a><span id="l10.276" class="difflineminus">-    4,   30,   13,   19,   29,   43,   13,   29,   31,   27,</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineminus">-    7,   39,   39,   32,   30,   20,   30,   21,   30,   14,</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineminus">-    9,   45,   43,   14,   43,   41,   45,    7,   39,   47,</span>
<a href="#l10.279"></a><span id="l10.279" class="difflineminus">-   12,   30,   12,   12,   12,   12,   12,    1,   18,    2,</span>
<a href="#l10.280"></a><span id="l10.280" class="difflineminus">-   16,   22,   32,   22,   37,   58,   46,   44,   14,   53,</span>
<a href="#l10.281"></a><span id="l10.281" class="difflineminus">-   55,   56,   50,   54,   35,   57,   20,   27,   28,   49,</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineminus">-   60,   38,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.283"></a><span id="l10.283" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.284"></a><span id="l10.284" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.285"></a><span id="l10.285" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.286"></a><span id="l10.286" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.287"></a><span id="l10.287" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.288"></a><span id="l10.288" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.289"></a><span id="l10.289" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.290"></a><span id="l10.290" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.292"></a><span id="l10.292" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.293"></a><span id="l10.293" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.294"></a><span id="l10.294" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.295"></a><span id="l10.295" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.296"></a><span id="l10.296" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.297"></a><span id="l10.297" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.299"></a><span id="l10.299" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.300"></a><span id="l10.300" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineminus">-    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,</span>
<a href="#l10.302"></a><span id="l10.302" class="difflineminus">-    0,    0,    0,    0,    0,    2,    0,    2,</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineminus">-};</span>
<a href="#l10.304"></a><span id="l10.304" class="difflineminus">-short yycheck[] = {                                       8,</span>
<a href="#l10.305"></a><span id="l10.305" class="difflineminus">-    0,  256,  256,  266,  260,  256,  256,  263,   17,  268,</span>
<a href="#l10.306"></a><span id="l10.306" class="difflineminus">-  256,  256,  260,  268,  269,  269,  271,  271,  273,  273,</span>
<a href="#l10.307"></a><span id="l10.307" class="difflineminus">-  266,  272,  273,  273,   33,  270,   35,  273,  273,   39,</span>
<a href="#l10.308"></a><span id="l10.308" class="difflineminus">-  266,  266,  268,  269,  270,  271,  272,  265,  258,  267,</span>
<a href="#l10.309"></a><span id="l10.309" class="difflineminus">-  260,  258,  258,  260,  268,   55,  272,  270,  273,  270,</span>
<a href="#l10.310"></a><span id="l10.310" class="difflineminus">-  257,  260,  274,  272,  268,  263,  258,  263,   12,   41,</span>
<a href="#l10.311"></a><span id="l10.311" class="difflineminus">-   59,   24,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.312"></a><span id="l10.312" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.313"></a><span id="l10.313" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.314"></a><span id="l10.314" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.315"></a><span id="l10.315" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.316"></a><span id="l10.316" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.317"></a><span id="l10.317" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.318"></a><span id="l10.318" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.319"></a><span id="l10.319" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.320"></a><span id="l10.320" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.321"></a><span id="l10.321" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.322"></a><span id="l10.322" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.323"></a><span id="l10.323" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.324"></a><span id="l10.324" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.325"></a><span id="l10.325" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.326"></a><span id="l10.326" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.327"></a><span id="l10.327" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.328"></a><span id="l10.328" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.329"></a><span id="l10.329" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.330"></a><span id="l10.330" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,</span>
<a href="#l10.331"></a><span id="l10.331" class="difflineminus">-   -1,   -1,   -1,   -1,   -1,  265,   -1,  267,</span>
<a href="#l10.332"></a><span id="l10.332" class="difflineminus">-};</span>
<a href="#l10.333"></a><span id="l10.333" class="difflineminus">-#define YYFINAL 3</span>
<a href="#l10.334"></a><span id="l10.334" class="difflineminus">-#ifndef YYDEBUG</span>
<a href="#l10.335"></a><span id="l10.335" class="difflineminus">-#define YYDEBUG 0</span>
<a href="#l10.336"></a><span id="l10.336" class="difflineminus">-#endif</span>
<a href="#l10.337"></a><span id="l10.337" class="difflineminus">-#define YYPR_MAXTOKEN 274</span>
<a href="#l10.338"></a><span id="l10.338" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.339"></a><span id="l10.339" class="difflineminus">-char *yyname[] = {</span>
<a href="#l10.340"></a><span id="l10.340" class="difflineminus">-&quot;end-of-file&quot;,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,</span>
<a href="#l10.341"></a><span id="l10.341" class="difflineminus">-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,</span>
<a href="#l10.342"></a><span id="l10.342" class="difflineminus">-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,</span>
<a href="#l10.343"></a><span id="l10.343" class="difflineminus">-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,</span>
<a href="#l10.344"></a><span id="l10.344" class="difflineminus">-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,</span>
<a href="#l10.345"></a><span id="l10.345" class="difflineminus">-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,</span>
<a href="#l10.346"></a><span id="l10.346" class="difflineminus">-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,&quot;EQ&quot;,&quot;COLON&quot;,&quot;DOT&quot;,&quot;SEMICOLON&quot;,</span>
<a href="#l10.347"></a><span id="l10.347" class="difflineminus">-&quot;SPACE&quot;,&quot;HTAB&quot;,&quot;LINESEP&quot;,&quot;NEWLINE&quot;,&quot;BEGIN_VCARD&quot;,&quot;END_VCARD&quot;,&quot;BEGIN_VCAL&quot;,</span>
<a href="#l10.348"></a><span id="l10.348" class="difflineminus">-&quot;END_VCAL&quot;,&quot;BEGIN_VEVENT&quot;,&quot;END_VEVENT&quot;,&quot;BEGIN_VTODO&quot;,&quot;END_VTODO&quot;,&quot;ID&quot;,&quot;STRING&quot;,</span>
<a href="#l10.349"></a><span id="l10.349" class="difflineminus">-};</span>
<a href="#l10.350"></a><span id="l10.350" class="difflineminus">-char *yyrule[] = {</span>
<a href="#l10.351"></a><span id="l10.351" class="difflineminus">-  &quot;$accept : mime&quot;,</span>
<a href="#l10.352"></a><span id="l10.352" class="difflineminus">-  &quot;mime : vobjects&quot;,</span>
<a href="#l10.353"></a><span id="l10.353" class="difflineminus">-  &quot;$$1 :&quot;,</span>
<a href="#l10.354"></a><span id="l10.354" class="difflineminus">-  &quot;vobjects : vobject $$1 vobjects&quot;,</span>
<a href="#l10.355"></a><span id="l10.355" class="difflineminus">-  &quot;vobjects : vobject&quot;,</span>
<a href="#l10.356"></a><span id="l10.356" class="difflineminus">-  &quot;vobject : vcard&quot;,</span>
<a href="#l10.357"></a><span id="l10.357" class="difflineminus">-  &quot;vobject : vcal&quot;,</span>
<a href="#l10.358"></a><span id="l10.358" class="difflineminus">-  &quot;$$2 :&quot;,</span>
<a href="#l10.359"></a><span id="l10.359" class="difflineminus">-  &quot;vcard : BEGIN_VCARD $$2 items END_VCARD&quot;,</span>
<a href="#l10.360"></a><span id="l10.360" class="difflineminus">-  &quot;$$3 :&quot;,</span>
<a href="#l10.361"></a><span id="l10.361" class="difflineminus">-  &quot;vcard : BEGIN_VCARD $$3 END_VCARD&quot;,</span>
<a href="#l10.362"></a><span id="l10.362" class="difflineminus">-  &quot;items : item items&quot;,</span>
<a href="#l10.363"></a><span id="l10.363" class="difflineminus">-  &quot;items : item&quot;,</span>
<a href="#l10.364"></a><span id="l10.364" class="difflineminus">-  &quot;$$4 :&quot;,</span>
<a href="#l10.365"></a><span id="l10.365" class="difflineminus">-  &quot;item : prop COLON $$4 values LINESEP&quot;,</span>
<a href="#l10.366"></a><span id="l10.366" class="difflineminus">-  &quot;item : error&quot;,</span>
<a href="#l10.367"></a><span id="l10.367" class="difflineminus">-  &quot;$$5 :&quot;,</span>
<a href="#l10.368"></a><span id="l10.368" class="difflineminus">-  &quot;prop : name $$5 attr_params&quot;,</span>
<a href="#l10.369"></a><span id="l10.369" class="difflineminus">-  &quot;prop : name&quot;,</span>
<a href="#l10.370"></a><span id="l10.370" class="difflineminus">-  &quot;attr_params : attr_param attr_params&quot;,</span>
<a href="#l10.371"></a><span id="l10.371" class="difflineminus">-  &quot;attr_params : attr_param&quot;,</span>
<a href="#l10.372"></a><span id="l10.372" class="difflineminus">-  &quot;attr_param : SEMICOLON attr&quot;,</span>
<a href="#l10.373"></a><span id="l10.373" class="difflineminus">-  &quot;attr : name&quot;,</span>
<a href="#l10.374"></a><span id="l10.374" class="difflineminus">-  &quot;attr : name EQ name&quot;,</span>
<a href="#l10.375"></a><span id="l10.375" class="difflineminus">-  &quot;name : ID&quot;,</span>
<a href="#l10.376"></a><span id="l10.376" class="difflineminus">-  &quot;$$6 :&quot;,</span>
<a href="#l10.377"></a><span id="l10.377" class="difflineminus">-  &quot;values : value SEMICOLON $$6 values&quot;,</span>
<a href="#l10.378"></a><span id="l10.378" class="difflineminus">-  &quot;values : value&quot;,</span>
<a href="#l10.379"></a><span id="l10.379" class="difflineminus">-  &quot;value : STRING&quot;,</span>
<a href="#l10.380"></a><span id="l10.380" class="difflineminus">-  &quot;value :&quot;,</span>
<a href="#l10.381"></a><span id="l10.381" class="difflineminus">-  &quot;$$7 :&quot;,</span>
<a href="#l10.382"></a><span id="l10.382" class="difflineminus">-  &quot;vcal : BEGIN_VCAL $$7 calitems END_VCAL&quot;,</span>
<a href="#l10.383"></a><span id="l10.383" class="difflineminus">-  &quot;$$8 :&quot;,</span>
<a href="#l10.384"></a><span id="l10.384" class="difflineminus">-  &quot;vcal : BEGIN_VCAL $$8 END_VCAL&quot;,</span>
<a href="#l10.385"></a><span id="l10.385" class="difflineminus">-  &quot;calitems : calitem calitems&quot;,</span>
<a href="#l10.386"></a><span id="l10.386" class="difflineminus">-  &quot;calitems : calitem&quot;,</span>
<a href="#l10.387"></a><span id="l10.387" class="difflineminus">-  &quot;calitem : eventitem&quot;,</span>
<a href="#l10.388"></a><span id="l10.388" class="difflineminus">-  &quot;calitem : todoitem&quot;,</span>
<a href="#l10.389"></a><span id="l10.389" class="difflineminus">-  &quot;calitem : items&quot;,</span>
<a href="#l10.390"></a><span id="l10.390" class="difflineminus">-  &quot;$$9 :&quot;,</span>
<a href="#l10.391"></a><span id="l10.391" class="difflineminus">-  &quot;eventitem : BEGIN_VEVENT $$9 items END_VEVENT&quot;,</span>
<a href="#l10.392"></a><span id="l10.392" class="difflineminus">-  &quot;$$10 :&quot;,</span>
<a href="#l10.393"></a><span id="l10.393" class="difflineminus">-  &quot;eventitem : BEGIN_VEVENT $$10 END_VEVENT&quot;,</span>
<a href="#l10.394"></a><span id="l10.394" class="difflineminus">-  &quot;$$11 :&quot;,</span>
<a href="#l10.395"></a><span id="l10.395" class="difflineminus">-  &quot;todoitem : BEGIN_VTODO $$11 items END_VTODO&quot;,</span>
<a href="#l10.396"></a><span id="l10.396" class="difflineminus">-  &quot;$$12 :&quot;,</span>
<a href="#l10.397"></a><span id="l10.397" class="difflineminus">-  &quot;todoitem : BEGIN_VTODO $$12 END_VTODO&quot;,</span>
<a href="#l10.398"></a><span id="l10.398" class="difflineminus">-};</span>
<a href="#l10.399"></a><span id="l10.399" class="difflineminus">-#endif</span>
<a href="#l10.400"></a><span id="l10.400" class="difflineminus">-// clang-format on</span>
<a href="#l10.401"></a><span id="l10.401" class="difflineminus">-</span>
<a href="#l10.402"></a><span id="l10.402" class="difflineminus">-#define yyclearin (yychar = (-1))</span>
<a href="#l10.403"></a><span id="l10.403" class="difflineminus">-#define yyerrok (yyerrflag = 0)</span>
<a href="#l10.404"></a><span id="l10.404" class="difflineminus">-#ifndef YYSTACKSIZE</span>
<a href="#l10.405"></a><span id="l10.405" class="difflineminus">-#  ifdef YYPR_MAXDEPTH</span>
<a href="#l10.406"></a><span id="l10.406" class="difflineminus">-#    define YYSTACKSIZE YYPR_MAXDEPTH</span>
<a href="#l10.407"></a><span id="l10.407" class="difflineminus">-#  else</span>
<a href="#l10.408"></a><span id="l10.408" class="difflineminus">-#    define YYSTACKSIZE 300</span>
<a href="#l10.409"></a><span id="l10.409" class="difflineminus">-#  endif</span>
<a href="#l10.410"></a><span id="l10.410" class="difflineminus">-#endif</span>
<a href="#l10.411"></a><span id="l10.411" class="difflineminus">-int yydebug;</span>
<a href="#l10.412"></a><span id="l10.412" class="difflineminus">-int yynerrs;</span>
<a href="#l10.413"></a><span id="l10.413" class="difflineminus">-int yyerrflag;</span>
<a href="#l10.414"></a><span id="l10.414" class="difflineminus">-int yychar;</span>
<a href="#l10.415"></a><span id="l10.415" class="difflineminus">-short *yyssp;</span>
<a href="#l10.416"></a><span id="l10.416" class="difflineminus">-YYSTYPE *yyvsp;</span>
<a href="#l10.417"></a><span id="l10.417" class="difflineminus">-YYSTYPE yyval;</span>
<a href="#l10.418"></a><span id="l10.418" class="difflineminus">-YYSTYPE yylval;</span>
<a href="#l10.419"></a><span id="l10.419" class="difflineminus">-#define yystacksize YYSTACKSIZE</span>
<a href="#l10.420"></a><span id="l10.420" class="difflineminus">-short yyss[YYSTACKSIZE];</span>
<a href="#l10.421"></a><span id="l10.421" class="difflineminus">-YYSTYPE yyvs[YYSTACKSIZE];</span>
<a href="#l10.422"></a><span id="l10.422" class="difflineminus">-/*#line 444 &quot;vcc.y&quot;*/</span>
<a href="#l10.423"></a><span id="l10.423" class="difflineminus">-/******************************************************************************/</span>
<a href="#l10.424"></a><span id="l10.424" class="difflineminus">-static int pushVObject(const char *prop) {</span>
<a href="#l10.425"></a><span id="l10.425" class="difflineminus">-  VObject *newObj;</span>
<a href="#l10.426"></a><span id="l10.426" class="difflineminus">-  if (ObjStackTop == PR_MAXLEVEL) return FALSE;</span>
<a href="#l10.427"></a><span id="l10.427" class="difflineminus">-</span>
<a href="#l10.428"></a><span id="l10.428" class="difflineminus">-  ObjStack[++ObjStackTop] = curObj;</span>
<a href="#l10.429"></a><span id="l10.429" class="difflineminus">-</span>
<a href="#l10.430"></a><span id="l10.430" class="difflineminus">-  if (curObj) {</span>
<a href="#l10.431"></a><span id="l10.431" class="difflineminus">-    newObj = addProp(curObj, prop);</span>
<a href="#l10.432"></a><span id="l10.432" class="difflineminus">-    curObj = newObj;</span>
<a href="#l10.433"></a><span id="l10.433" class="difflineminus">-  } else</span>
<a href="#l10.434"></a><span id="l10.434" class="difflineminus">-    curObj = newVObject(prop);</span>
<a href="#l10.435"></a><span id="l10.435" class="difflineminus">-</span>
<a href="#l10.436"></a><span id="l10.436" class="difflineminus">-  return TRUE;</span>
<a href="#l10.437"></a><span id="l10.437" class="difflineminus">-}</span>
<a href="#l10.438"></a><span id="l10.438" class="difflineminus">-</span>
<a href="#l10.439"></a><span id="l10.439" class="difflineminus">-/******************************************************************************/</span>
<a href="#l10.440"></a><span id="l10.440" class="difflineminus">-/* This pops the recently built vCard off the stack and returns it. */</span>
<a href="#l10.441"></a><span id="l10.441" class="difflineminus">-static VObject *popVObject() {</span>
<a href="#l10.442"></a><span id="l10.442" class="difflineminus">-  VObject *oldObj;</span>
<a href="#l10.443"></a><span id="l10.443" class="difflineminus">-  if (ObjStackTop &lt; 0) {</span>
<a href="#l10.444"></a><span id="l10.444" class="difflineminus">-    yyerror(&quot;pop on empty Object Stack\n&quot;);</span>
<a href="#l10.445"></a><span id="l10.445" class="difflineminus">-    return 0;</span>
<a href="#l10.446"></a><span id="l10.446" class="difflineminus">-  }</span>
<a href="#l10.447"></a><span id="l10.447" class="difflineminus">-  oldObj = curObj;</span>
<a href="#l10.448"></a><span id="l10.448" class="difflineminus">-  curObj = ObjStack[ObjStackTop--];</span>
<a href="#l10.449"></a><span id="l10.449" class="difflineminus">-</span>
<a href="#l10.450"></a><span id="l10.450" class="difflineminus">-  return oldObj;</span>
<a href="#l10.451"></a><span id="l10.451" class="difflineminus">-}</span>
<a href="#l10.452"></a><span id="l10.452" class="difflineminus">-</span>
<a href="#l10.453"></a><span id="l10.453" class="difflineminus">-extern &quot;C&quot; void deleteString(char *p);</span>
<a href="#l10.454"></a><span id="l10.454" class="difflineminus">-</span>
<a href="#l10.455"></a><span id="l10.455" class="difflineminus">-static void enterValues(const char *value) {</span>
<a href="#l10.456"></a><span id="l10.456" class="difflineminus">-  if (fieldedProp &amp;&amp; *fieldedProp) {</span>
<a href="#l10.457"></a><span id="l10.457" class="difflineminus">-    if (value) {</span>
<a href="#l10.458"></a><span id="l10.458" class="difflineminus">-      addPropValue(curProp, *fieldedProp, value);</span>
<a href="#l10.459"></a><span id="l10.459" class="difflineminus">-    }</span>
<a href="#l10.460"></a><span id="l10.460" class="difflineminus">-    /* else this field is empty, advance to next field */</span>
<a href="#l10.461"></a><span id="l10.461" class="difflineminus">-    fieldedProp++;</span>
<a href="#l10.462"></a><span id="l10.462" class="difflineminus">-  } else {</span>
<a href="#l10.463"></a><span id="l10.463" class="difflineminus">-    if (value) {</span>
<a href="#l10.464"></a><span id="l10.464" class="difflineminus">-      setVObjectUStringZValue_(curProp, fakeUnicode(value, 0));</span>
<a href="#l10.465"></a><span id="l10.465" class="difflineminus">-    }</span>
<a href="#l10.466"></a><span id="l10.466" class="difflineminus">-  }</span>
<a href="#l10.467"></a><span id="l10.467" class="difflineminus">-  deleteString((char *)value);</span>
<a href="#l10.468"></a><span id="l10.468" class="difflineminus">-}</span>
<a href="#l10.469"></a><span id="l10.469" class="difflineminus">-</span>
<a href="#l10.470"></a><span id="l10.470" class="difflineminus">-static void enterProps(const char *s) {</span>
<a href="#l10.471"></a><span id="l10.471" class="difflineminus">-  curProp = addGroup(curObj, s);</span>
<a href="#l10.472"></a><span id="l10.472" class="difflineminus">-  deleteString((char *)s);</span>
<a href="#l10.473"></a><span id="l10.473" class="difflineminus">-}</span>
<a href="#l10.474"></a><span id="l10.474" class="difflineminus">-</span>
<a href="#l10.475"></a><span id="l10.475" class="difflineminus">-static void enterAttr(const char *s1, const char *s2) {</span>
<a href="#l10.476"></a><span id="l10.476" class="difflineminus">-  const char *p1, *p2 = nullptr;</span>
<a href="#l10.477"></a><span id="l10.477" class="difflineminus">-  p1 = lookupProp_(s1);</span>
<a href="#l10.478"></a><span id="l10.478" class="difflineminus">-  if (s2) {</span>
<a href="#l10.479"></a><span id="l10.479" class="difflineminus">-    VObject *a;</span>
<a href="#l10.480"></a><span id="l10.480" class="difflineminus">-    p2 = lookupProp_(s2);</span>
<a href="#l10.481"></a><span id="l10.481" class="difflineminus">-    a = addProp(curProp, p1);</span>
<a href="#l10.482"></a><span id="l10.482" class="difflineminus">-    setVObjectStringZValue(a, p2);</span>
<a href="#l10.483"></a><span id="l10.483" class="difflineminus">-  } else</span>
<a href="#l10.484"></a><span id="l10.484" class="difflineminus">-    addProp(curProp, p1);</span>
<a href="#l10.485"></a><span id="l10.485" class="difflineminus">-  if (PL_strcasecmp(p1, VCBase64Prop) == 0 ||</span>
<a href="#l10.486"></a><span id="l10.486" class="difflineminus">-      (s2 &amp;&amp; PL_strcasecmp(p2, VCBase64Prop) == 0))</span>
<a href="#l10.487"></a><span id="l10.487" class="difflineminus">-    lexPushMode(L_BASE64);</span>
<a href="#l10.488"></a><span id="l10.488" class="difflineminus">-  else if (PL_strcasecmp(p1, VCQuotedPrintableProp) == 0 ||</span>
<a href="#l10.489"></a><span id="l10.489" class="difflineminus">-           (s2 &amp;&amp; PL_strcasecmp(p2, VCQuotedPrintableProp) == 0))</span>
<a href="#l10.490"></a><span id="l10.490" class="difflineminus">-    lexPushMode(L_QUOTED_PRINTABLE);</span>
<a href="#l10.491"></a><span id="l10.491" class="difflineminus">-  deleteString((char *)s1);</span>
<a href="#l10.492"></a><span id="l10.492" class="difflineminus">-  deleteString((char *)s2);</span>
<a href="#l10.493"></a><span id="l10.493" class="difflineminus">-}</span>
<a href="#l10.494"></a><span id="l10.494" class="difflineminus">-</span>
<a href="#l10.495"></a><span id="l10.495" class="difflineminus">-#define PR_MAX_LEX_LOOKAHEAD_0 32</span>
<a href="#l10.496"></a><span id="l10.496" class="difflineminus">-#define PR_MAX_LEX_LOOKAHEAD 64</span>
<a href="#l10.497"></a><span id="l10.497" class="difflineminus">-#define PR_MAX_LEX_MODE_STACK_SIZE 10</span>
<a href="#l10.498"></a><span id="l10.498" class="difflineminus">-#define LEXMODE() (lexBuf.lexModeStack[lexBuf.lexModeStackTop])</span>
<a href="#l10.499"></a><span id="l10.499" class="difflineminus">-</span>
<a href="#l10.500"></a><span id="l10.500" class="difflineminus">-struct LexBuf {</span>
<a href="#l10.501"></a><span id="l10.501" class="difflineminus">-  /* input */</span>
<a href="#l10.502"></a><span id="l10.502" class="difflineminus">-  char *inputString;</span>
<a href="#l10.503"></a><span id="l10.503" class="difflineminus">-  unsigned long curPos;</span>
<a href="#l10.504"></a><span id="l10.504" class="difflineminus">-  unsigned long inputLen;</span>
<a href="#l10.505"></a><span id="l10.505" class="difflineminus">-  /* lookahead buffer:</span>
<a href="#l10.506"></a><span id="l10.506" class="difflineminus">-   * lookahead buffer is short instead of char so that EOF</span>
<a href="#l10.507"></a><span id="l10.507" class="difflineminus">-   * can be represented correctly.</span>
<a href="#l10.508"></a><span id="l10.508" class="difflineminus">-   */</span>
<a href="#l10.509"></a><span id="l10.509" class="difflineminus">-  unsigned long len;</span>
<a href="#l10.510"></a><span id="l10.510" class="difflineminus">-  short buf[PR_MAX_LEX_LOOKAHEAD];</span>
<a href="#l10.511"></a><span id="l10.511" class="difflineminus">-  unsigned long getPtr;</span>
<a href="#l10.512"></a><span id="l10.512" class="difflineminus">-  /* context stack */</span>
<a href="#l10.513"></a><span id="l10.513" class="difflineminus">-  unsigned long lexModeStackTop;</span>
<a href="#l10.514"></a><span id="l10.514" class="difflineminus">-  enum LexMode lexModeStack[PR_MAX_LEX_MODE_STACK_SIZE];</span>
<a href="#l10.515"></a><span id="l10.515" class="difflineminus">-  /* token buffer */</span>
<a href="#l10.516"></a><span id="l10.516" class="difflineminus">-  unsigned long maxToken;</span>
<a href="#l10.517"></a><span id="l10.517" class="difflineminus">-  char *strs;</span>
<a href="#l10.518"></a><span id="l10.518" class="difflineminus">-  unsigned long strsLen;</span>
<a href="#l10.519"></a><span id="l10.519" class="difflineminus">-} lexBuf;</span>
<a href="#l10.520"></a><span id="l10.520" class="difflineminus">-</span>
<a href="#l10.521"></a><span id="l10.521" class="difflineminus">-static void lexPushMode(enum LexMode mode) {</span>
<a href="#l10.522"></a><span id="l10.522" class="difflineminus">-  if (lexBuf.lexModeStackTop == (PR_MAX_LEX_MODE_STACK_SIZE - 1))</span>
<a href="#l10.523"></a><span id="l10.523" class="difflineminus">-    yyerror(&quot;lexical context stack overflow&quot;);</span>
<a href="#l10.524"></a><span id="l10.524" class="difflineminus">-  else {</span>
<a href="#l10.525"></a><span id="l10.525" class="difflineminus">-    lexBuf.lexModeStack[++lexBuf.lexModeStackTop] = mode;</span>
<a href="#l10.526"></a><span id="l10.526" class="difflineminus">-  }</span>
<a href="#l10.527"></a><span id="l10.527" class="difflineminus">-}</span>
<a href="#l10.528"></a><span id="l10.528" class="difflineminus">-</span>
<a href="#l10.529"></a><span id="l10.529" class="difflineminus">-static void lexPopMode(int top) {</span>
<a href="#l10.530"></a><span id="l10.530" class="difflineminus">-  /* special case of pop for ease of error recovery -- this</span>
<a href="#l10.531"></a><span id="l10.531" class="difflineminus">-  version will never underflow */</span>
<a href="#l10.532"></a><span id="l10.532" class="difflineminus">-  if (top)</span>
<a href="#l10.533"></a><span id="l10.533" class="difflineminus">-    lexBuf.lexModeStackTop = 0;</span>
<a href="#l10.534"></a><span id="l10.534" class="difflineminus">-  else if (lexBuf.lexModeStackTop &gt; 0)</span>
<a href="#l10.535"></a><span id="l10.535" class="difflineminus">-    lexBuf.lexModeStackTop--;</span>
<a href="#l10.536"></a><span id="l10.536" class="difflineminus">-}</span>
<a href="#l10.537"></a><span id="l10.537" class="difflineminus">-</span>
<a href="#l10.538"></a><span id="l10.538" class="difflineminus">-static int lexWithinMode(enum LexMode mode) {</span>
<a href="#l10.539"></a><span id="l10.539" class="difflineminus">-  unsigned long i;</span>
<a href="#l10.540"></a><span id="l10.540" class="difflineminus">-  for (i = 0; i &lt; lexBuf.lexModeStackTop; i++)</span>
<a href="#l10.541"></a><span id="l10.541" class="difflineminus">-    if (mode == lexBuf.lexModeStack[i]) return 1;</span>
<a href="#l10.542"></a><span id="l10.542" class="difflineminus">-  return 0;</span>
<a href="#l10.543"></a><span id="l10.543" class="difflineminus">-}</span>
<a href="#l10.544"></a><span id="l10.544" class="difflineminus">-</span>
<a href="#l10.545"></a><span id="l10.545" class="difflineminus">-static int lexGetc_() {</span>
<a href="#l10.546"></a><span id="l10.546" class="difflineminus">-  /* get next char from input, no buffering. */</span>
<a href="#l10.547"></a><span id="l10.547" class="difflineminus">-  if (lexBuf.curPos == lexBuf.inputLen) return EOF;</span>
<a href="#l10.548"></a><span id="l10.548" class="difflineminus">-  if (lexBuf.inputString) return *(lexBuf.inputString + lexBuf.curPos++);</span>
<a href="#l10.549"></a><span id="l10.549" class="difflineminus">-</span>
<a href="#l10.550"></a><span id="l10.550" class="difflineminus">-  return -1;</span>
<a href="#l10.551"></a><span id="l10.551" class="difflineminus">-}</span>
<a href="#l10.552"></a><span id="l10.552" class="difflineminus">-</span>
<a href="#l10.553"></a><span id="l10.553" class="difflineminus">-static int lexGeta() {</span>
<a href="#l10.554"></a><span id="l10.554" class="difflineminus">-  ++lexBuf.len;</span>
<a href="#l10.555"></a><span id="l10.555" class="difflineminus">-  return (lexBuf.buf[lexBuf.getPtr] = lexGetc_());</span>
<a href="#l10.556"></a><span id="l10.556" class="difflineminus">-}</span>
<a href="#l10.557"></a><span id="l10.557" class="difflineminus">-</span>
<a href="#l10.558"></a><span id="l10.558" class="difflineminus">-static int lexGeta_(int i) {</span>
<a href="#l10.559"></a><span id="l10.559" class="difflineminus">-  ++lexBuf.len;</span>
<a href="#l10.560"></a><span id="l10.560" class="difflineminus">-  return (lexBuf.buf[(lexBuf.getPtr + i) % PR_MAX_LEX_LOOKAHEAD] = lexGetc_());</span>
<a href="#l10.561"></a><span id="l10.561" class="difflineminus">-}</span>
<a href="#l10.562"></a><span id="l10.562" class="difflineminus">-</span>
<a href="#l10.563"></a><span id="l10.563" class="difflineminus">-static void lexSkipLookahead() {</span>
<a href="#l10.564"></a><span id="l10.564" class="difflineminus">-  if (lexBuf.len &gt; 0 &amp;&amp; lexBuf.buf[lexBuf.getPtr] != EOF) {</span>
<a href="#l10.565"></a><span id="l10.565" class="difflineminus">-    /* don't skip EOF. */</span>
<a href="#l10.566"></a><span id="l10.566" class="difflineminus">-    lexBuf.getPtr = (lexBuf.getPtr + 1) % PR_MAX_LEX_LOOKAHEAD;</span>
<a href="#l10.567"></a><span id="l10.567" class="difflineminus">-    lexBuf.len--;</span>
<a href="#l10.568"></a><span id="l10.568" class="difflineminus">-  }</span>
<a href="#l10.569"></a><span id="l10.569" class="difflineminus">-}</span>
<a href="#l10.570"></a><span id="l10.570" class="difflineminus">-</span>
<a href="#l10.571"></a><span id="l10.571" class="difflineminus">-static int lexLookahead() {</span>
<a href="#l10.572"></a><span id="l10.572" class="difflineminus">-  int c = (lexBuf.len) ? lexBuf.buf[lexBuf.getPtr] : lexGeta();</span>
<a href="#l10.573"></a><span id="l10.573" class="difflineminus">-  /* do the \r\n -&gt; \n or \r -&gt; \n translation here */</span>
<a href="#l10.574"></a><span id="l10.574" class="difflineminus">-  if (c == '\r') {</span>
<a href="#l10.575"></a><span id="l10.575" class="difflineminus">-    int a = (lexBuf.len &gt; 1)</span>
<a href="#l10.576"></a><span id="l10.576" class="difflineminus">-                ? lexBuf.buf[(lexBuf.getPtr + 1) % PR_MAX_LEX_LOOKAHEAD]</span>
<a href="#l10.577"></a><span id="l10.577" class="difflineminus">-                : lexGeta_(1);</span>
<a href="#l10.578"></a><span id="l10.578" class="difflineminus">-    if (a == '\n') {</span>
<a href="#l10.579"></a><span id="l10.579" class="difflineminus">-      lexSkipLookahead();</span>
<a href="#l10.580"></a><span id="l10.580" class="difflineminus">-    }</span>
<a href="#l10.581"></a><span id="l10.581" class="difflineminus">-    lexBuf.buf[lexBuf.getPtr] = c = '\n';</span>
<a href="#l10.582"></a><span id="l10.582" class="difflineminus">-  } else if (c == '\n') {</span>
<a href="#l10.583"></a><span id="l10.583" class="difflineminus">-    int a = (lexBuf.len &gt; 1) ? lexBuf.buf[lexBuf.getPtr + 1] : lexGeta_(1);</span>
<a href="#l10.584"></a><span id="l10.584" class="difflineminus">-    if (a == '\r') {</span>
<a href="#l10.585"></a><span id="l10.585" class="difflineminus">-      lexSkipLookahead();</span>
<a href="#l10.586"></a><span id="l10.586" class="difflineminus">-    }</span>
<a href="#l10.587"></a><span id="l10.587" class="difflineminus">-    lexBuf.buf[lexBuf.getPtr] = '\n';</span>
<a href="#l10.588"></a><span id="l10.588" class="difflineminus">-  }</span>
<a href="#l10.589"></a><span id="l10.589" class="difflineminus">-  return c;</span>
<a href="#l10.590"></a><span id="l10.590" class="difflineminus">-}</span>
<a href="#l10.591"></a><span id="l10.591" class="difflineminus">-</span>
<a href="#l10.592"></a><span id="l10.592" class="difflineminus">-static int lexGetc() {</span>
<a href="#l10.593"></a><span id="l10.593" class="difflineminus">-  int c = lexLookahead();</span>
<a href="#l10.594"></a><span id="l10.594" class="difflineminus">-  if (lexBuf.len &gt; 0 &amp;&amp; lexBuf.buf[lexBuf.getPtr] != EOF) {</span>
<a href="#l10.595"></a><span id="l10.595" class="difflineminus">-    /* EOF will remain in lookahead buffer */</span>
<a href="#l10.596"></a><span id="l10.596" class="difflineminus">-    lexBuf.getPtr = (lexBuf.getPtr + 1) % PR_MAX_LEX_LOOKAHEAD;</span>
<a href="#l10.597"></a><span id="l10.597" class="difflineminus">-    lexBuf.len--;</span>
<a href="#l10.598"></a><span id="l10.598" class="difflineminus">-  }</span>
<a href="#l10.599"></a><span id="l10.599" class="difflineminus">-  return c;</span>
<a href="#l10.600"></a><span id="l10.600" class="difflineminus">-}</span>
<a href="#l10.601"></a><span id="l10.601" class="difflineminus">-</span>
<a href="#l10.602"></a><span id="l10.602" class="difflineminus">-static void lexSkipLookaheadWord() {</span>
<a href="#l10.603"></a><span id="l10.603" class="difflineminus">-  if (lexBuf.strsLen &lt;= lexBuf.len) {</span>
<a href="#l10.604"></a><span id="l10.604" class="difflineminus">-    lexBuf.len -= lexBuf.strsLen;</span>
<a href="#l10.605"></a><span id="l10.605" class="difflineminus">-    lexBuf.getPtr = (lexBuf.getPtr + lexBuf.strsLen) % PR_MAX_LEX_LOOKAHEAD;</span>
<a href="#l10.606"></a><span id="l10.606" class="difflineminus">-  }</span>
<a href="#l10.607"></a><span id="l10.607" class="difflineminus">-}</span>
<a href="#l10.608"></a><span id="l10.608" class="difflineminus">-</span>
<a href="#l10.609"></a><span id="l10.609" class="difflineminus">-static void lexClearToken() { lexBuf.strsLen = 0; }</span>
<a href="#l10.610"></a><span id="l10.610" class="difflineminus">-</span>
<a href="#l10.611"></a><span id="l10.611" class="difflineminus">-static void lexAppendc(int c) {</span>
<a href="#l10.612"></a><span id="l10.612" class="difflineminus">-  lexBuf.strs[lexBuf.strsLen] = c;</span>
<a href="#l10.613"></a><span id="l10.613" class="difflineminus">-  /* append up to zero termination */</span>
<a href="#l10.614"></a><span id="l10.614" class="difflineminus">-  if (c == 0) return;</span>
<a href="#l10.615"></a><span id="l10.615" class="difflineminus">-  lexBuf.strsLen++;</span>
<a href="#l10.616"></a><span id="l10.616" class="difflineminus">-  if (lexBuf.strsLen &gt;= lexBuf.maxToken) {</span>
<a href="#l10.617"></a><span id="l10.617" class="difflineminus">-    /* double the token string size */</span>
<a href="#l10.618"></a><span id="l10.618" class="difflineminus">-    lexBuf.maxToken &lt;&lt;= 1;</span>
<a href="#l10.619"></a><span id="l10.619" class="difflineminus">-    lexBuf.strs = (char *)PR_Realloc(lexBuf.strs, lexBuf.maxToken);</span>
<a href="#l10.620"></a><span id="l10.620" class="difflineminus">-  }</span>
<a href="#l10.621"></a><span id="l10.621" class="difflineminus">-}</span>
<a href="#l10.622"></a><span id="l10.622" class="difflineminus">-</span>
<a href="#l10.623"></a><span id="l10.623" class="difflineminus">-static char *lexStr() { return dupStr(lexBuf.strs, lexBuf.strsLen + 1); }</span>
<a href="#l10.624"></a><span id="l10.624" class="difflineminus">-</span>
<a href="#l10.625"></a><span id="l10.625" class="difflineminus">-static void lexSkipWhite() {</span>
<a href="#l10.626"></a><span id="l10.626" class="difflineminus">-  int c = lexLookahead();</span>
<a href="#l10.627"></a><span id="l10.627" class="difflineminus">-  while (c == ' ' || c == '\t') {</span>
<a href="#l10.628"></a><span id="l10.628" class="difflineminus">-    lexSkipLookahead();</span>
<a href="#l10.629"></a><span id="l10.629" class="difflineminus">-    c = lexLookahead();</span>
<a href="#l10.630"></a><span id="l10.630" class="difflineminus">-  }</span>
<a href="#l10.631"></a><span id="l10.631" class="difflineminus">-}</span>
<a href="#l10.632"></a><span id="l10.632" class="difflineminus">-</span>
<a href="#l10.633"></a><span id="l10.633" class="difflineminus">-static char *lexGetWord() {</span>
<a href="#l10.634"></a><span id="l10.634" class="difflineminus">-  int c;</span>
<a href="#l10.635"></a><span id="l10.635" class="difflineminus">-  lexSkipWhite();</span>
<a href="#l10.636"></a><span id="l10.636" class="difflineminus">-  lexClearToken();</span>
<a href="#l10.637"></a><span id="l10.637" class="difflineminus">-  c = lexLookahead();</span>
<a href="#l10.638"></a><span id="l10.638" class="difflineminus">-  while (c != EOF &amp;&amp; !PL_strchr(&quot;\t\n ;:=&quot;, (char)c)) {</span>
<a href="#l10.639"></a><span id="l10.639" class="difflineminus">-    lexAppendc(c);</span>
<a href="#l10.640"></a><span id="l10.640" class="difflineminus">-    lexSkipLookahead();</span>
<a href="#l10.641"></a><span id="l10.641" class="difflineminus">-    c = lexLookahead();</span>
<a href="#l10.642"></a><span id="l10.642" class="difflineminus">-  }</span>
<a href="#l10.643"></a><span id="l10.643" class="difflineminus">-  lexAppendc(0);</span>
<a href="#l10.644"></a><span id="l10.644" class="difflineminus">-  return lexStr();</span>
<a href="#l10.645"></a><span id="l10.645" class="difflineminus">-}</span>
<a href="#l10.646"></a><span id="l10.646" class="difflineminus">-</span>
<a href="#l10.647"></a><span id="l10.647" class="difflineminus">-#if 0</span>
<a href="#l10.648"></a><span id="l10.648" class="difflineminus">-static void lexPushLookahead(char *s, int len) {</span>
<a href="#l10.649"></a><span id="l10.649" class="difflineminus">-  int putptr;</span>
<a href="#l10.650"></a><span id="l10.650" class="difflineminus">-  if (len == 0) len = PL_strlen(s);</span>
<a href="#l10.651"></a><span id="l10.651" class="difflineminus">-  putptr = lexBuf.getPtr - len;</span>
<a href="#l10.652"></a><span id="l10.652" class="difflineminus">-  /* this function assumes that length of word to push back</span>
<a href="#l10.653"></a><span id="l10.653" class="difflineminus">-   * is not greater than PR_MAX_LEX_LOOKAHEAD.</span>
<a href="#l10.654"></a><span id="l10.654" class="difflineminus">-   */</span>
<a href="#l10.655"></a><span id="l10.655" class="difflineminus">-  if (putptr &lt; 0) putptr += PR_MAX_LEX_LOOKAHEAD;</span>
<a href="#l10.656"></a><span id="l10.656" class="difflineminus">-  lexBuf.getPtr = putptr;</span>
<a href="#l10.657"></a><span id="l10.657" class="difflineminus">-  while (*s) {</span>
<a href="#l10.658"></a><span id="l10.658" class="difflineminus">-    lexBuf.buf[putptr] = *s++;</span>
<a href="#l10.659"></a><span id="l10.659" class="difflineminus">-    putptr = (putptr + 1) % PR_MAX_LEX_LOOKAHEAD;</span>
<a href="#l10.660"></a><span id="l10.660" class="difflineminus">-  }</span>
<a href="#l10.661"></a><span id="l10.661" class="difflineminus">-  lexBuf.len += len;</span>
<a href="#l10.662"></a><span id="l10.662" class="difflineminus">-}</span>
<a href="#l10.663"></a><span id="l10.663" class="difflineminus">-#endif</span>
<a href="#l10.664"></a><span id="l10.664" class="difflineminus">-</span>
<a href="#l10.665"></a><span id="l10.665" class="difflineminus">-static void lexPushLookaheadc(int c) {</span>
<a href="#l10.666"></a><span id="l10.666" class="difflineminus">-  int putptr;</span>
<a href="#l10.667"></a><span id="l10.667" class="difflineminus">-  /* can't putback EOF, because it never leaves lookahead buffer */</span>
<a href="#l10.668"></a><span id="l10.668" class="difflineminus">-  if (c == EOF) return;</span>
<a href="#l10.669"></a><span id="l10.669" class="difflineminus">-  putptr = (int)lexBuf.getPtr - 1;</span>
<a href="#l10.670"></a><span id="l10.670" class="difflineminus">-  if (putptr &lt; 0) putptr += PR_MAX_LEX_LOOKAHEAD;</span>
<a href="#l10.671"></a><span id="l10.671" class="difflineminus">-  lexBuf.getPtr = putptr;</span>
<a href="#l10.672"></a><span id="l10.672" class="difflineminus">-  lexBuf.buf[putptr] = c;</span>
<a href="#l10.673"></a><span id="l10.673" class="difflineminus">-  lexBuf.len += 1;</span>
<a href="#l10.674"></a><span id="l10.674" class="difflineminus">-}</span>
<a href="#l10.675"></a><span id="l10.675" class="difflineminus">-</span>
<a href="#l10.676"></a><span id="l10.676" class="difflineminus">-static char *lexLookaheadWord() {</span>
<a href="#l10.677"></a><span id="l10.677" class="difflineminus">-  /* this function can lookahead word with max size of PR_MAX_LEX_LOOKAHEAD_0</span>
<a href="#l10.678"></a><span id="l10.678" class="difflineminus">-   /  and thing bigger than that will stop the lookahead and return 0;</span>
<a href="#l10.679"></a><span id="l10.679" class="difflineminus">-   / leading white spaces are not recoverable.</span>
<a href="#l10.680"></a><span id="l10.680" class="difflineminus">-   */</span>
<a href="#l10.681"></a><span id="l10.681" class="difflineminus">-  int c;</span>
<a href="#l10.682"></a><span id="l10.682" class="difflineminus">-  int len = 0;</span>
<a href="#l10.683"></a><span id="l10.683" class="difflineminus">-  int curgetptr = 0;</span>
<a href="#l10.684"></a><span id="l10.684" class="difflineminus">-  lexSkipWhite();</span>
<a href="#l10.685"></a><span id="l10.685" class="difflineminus">-  lexClearToken();</span>
<a href="#l10.686"></a><span id="l10.686" class="difflineminus">-  curgetptr = (int)lexBuf.getPtr; /* remember! */</span>
<a href="#l10.687"></a><span id="l10.687" class="difflineminus">-  while (len &lt; (PR_MAX_LEX_LOOKAHEAD_0)) {</span>
<a href="#l10.688"></a><span id="l10.688" class="difflineminus">-    c = lexGetc();</span>
<a href="#l10.689"></a><span id="l10.689" class="difflineminus">-    len++;</span>
<a href="#l10.690"></a><span id="l10.690" class="difflineminus">-    if (c == EOF || PL_strchr(&quot;\t\n ;:=&quot;, (char)c)) {</span>
<a href="#l10.691"></a><span id="l10.691" class="difflineminus">-      lexAppendc(0);</span>
<a href="#l10.692"></a><span id="l10.692" class="difflineminus">-      /* restore lookahead buf. */</span>
<a href="#l10.693"></a><span id="l10.693" class="difflineminus">-      lexBuf.len += len;</span>
<a href="#l10.694"></a><span id="l10.694" class="difflineminus">-      lexBuf.getPtr = curgetptr;</span>
<a href="#l10.695"></a><span id="l10.695" class="difflineminus">-      return lexStr();</span>
<a href="#l10.696"></a><span id="l10.696" class="difflineminus">-    } else</span>
<a href="#l10.697"></a><span id="l10.697" class="difflineminus">-      lexAppendc(c);</span>
<a href="#l10.698"></a><span id="l10.698" class="difflineminus">-  }</span>
<a href="#l10.699"></a><span id="l10.699" class="difflineminus">-  lexBuf.len += len; /* char that has been moved to lookahead buffer */</span>
<a href="#l10.700"></a><span id="l10.700" class="difflineminus">-  lexBuf.getPtr = curgetptr;</span>
<a href="#l10.701"></a><span id="l10.701" class="difflineminus">-  return 0;</span>
<a href="#l10.702"></a><span id="l10.702" class="difflineminus">-}</span>
<a href="#l10.703"></a><span id="l10.703" class="difflineminus">-</span>
<a href="#l10.704"></a><span id="l10.704" class="difflineminus">-#ifdef _SUPPORT_LINE_FOLDING</span>
<a href="#l10.705"></a><span id="l10.705" class="difflineminus">-static void handleMoreRFC822LineBreak(int c) {</span>
<a href="#l10.706"></a><span id="l10.706" class="difflineminus">-  /* support RFC 822 line break in cases like</span>
<a href="#l10.707"></a><span id="l10.707" class="difflineminus">-   *  ADR: foo;</span>
<a href="#l10.708"></a><span id="l10.708" class="difflineminus">-   *  morefoo;</span>
<a href="#l10.709"></a><span id="l10.709" class="difflineminus">-   *  more foo;</span>
<a href="#l10.710"></a><span id="l10.710" class="difflineminus">-   */</span>
<a href="#l10.711"></a><span id="l10.711" class="difflineminus">-  if (c == ';') {</span>
<a href="#l10.712"></a><span id="l10.712" class="difflineminus">-    int a;</span>
<a href="#l10.713"></a><span id="l10.713" class="difflineminus">-    lexSkipLookahead();</span>
<a href="#l10.714"></a><span id="l10.714" class="difflineminus">-    /* skip white spaces */</span>
<a href="#l10.715"></a><span id="l10.715" class="difflineminus">-    a = lexLookahead();</span>
<a href="#l10.716"></a><span id="l10.716" class="difflineminus">-    while (a == ' ' || a == '\t') {</span>
<a href="#l10.717"></a><span id="l10.717" class="difflineminus">-      lexSkipLookahead();</span>
<a href="#l10.718"></a><span id="l10.718" class="difflineminus">-      a = lexLookahead();</span>
<a href="#l10.719"></a><span id="l10.719" class="difflineminus">-    }</span>
<a href="#l10.720"></a><span id="l10.720" class="difflineminus">-    if (a == '\n') {</span>
<a href="#l10.721"></a><span id="l10.721" class="difflineminus">-      lexSkipLookahead();</span>
<a href="#l10.722"></a><span id="l10.722" class="difflineminus">-      a = lexLookahead();</span>
<a href="#l10.723"></a><span id="l10.723" class="difflineminus">-      if (a == ' ' || a == '\t') {</span>
<a href="#l10.724"></a><span id="l10.724" class="difflineminus">-        /* continuation, throw away all the \n and spaces read so</span>
<a href="#l10.725"></a><span id="l10.725" class="difflineminus">-         * far</span>
<a href="#l10.726"></a><span id="l10.726" class="difflineminus">-         */</span>
<a href="#l10.727"></a><span id="l10.727" class="difflineminus">-        lexSkipWhite();</span>
<a href="#l10.728"></a><span id="l10.728" class="difflineminus">-        lexPushLookaheadc(';');</span>
<a href="#l10.729"></a><span id="l10.729" class="difflineminus">-      } else {</span>
<a href="#l10.730"></a><span id="l10.730" class="difflineminus">-        lexPushLookaheadc('\n');</span>
<a href="#l10.731"></a><span id="l10.731" class="difflineminus">-        lexPushLookaheadc(';');</span>
<a href="#l10.732"></a><span id="l10.732" class="difflineminus">-      }</span>
<a href="#l10.733"></a><span id="l10.733" class="difflineminus">-    } else {</span>
<a href="#l10.734"></a><span id="l10.734" class="difflineminus">-      lexPushLookaheadc(';');</span>
<a href="#l10.735"></a><span id="l10.735" class="difflineminus">-    }</span>
<a href="#l10.736"></a><span id="l10.736" class="difflineminus">-  }</span>
<a href="#l10.737"></a><span id="l10.737" class="difflineminus">-}</span>
<a href="#l10.738"></a><span id="l10.738" class="difflineminus">-</span>
<a href="#l10.739"></a><span id="l10.739" class="difflineminus">-static char *lexGet1Value() {</span>
<a href="#l10.740"></a><span id="l10.740" class="difflineminus">-  /*  int size = 0; */</span>
<a href="#l10.741"></a><span id="l10.741" class="difflineminus">-  int c;</span>
<a href="#l10.742"></a><span id="l10.742" class="difflineminus">-  lexSkipWhite();</span>
<a href="#l10.743"></a><span id="l10.743" class="difflineminus">-  c = lexLookahead();</span>
<a href="#l10.744"></a><span id="l10.744" class="difflineminus">-  lexClearToken();</span>
<a href="#l10.745"></a><span id="l10.745" class="difflineminus">-  while (c != EOF &amp;&amp; c != ';') {</span>
<a href="#l10.746"></a><span id="l10.746" class="difflineminus">-    if (c == '\n') {</span>
<a href="#l10.747"></a><span id="l10.747" class="difflineminus">-      int a;</span>
<a href="#l10.748"></a><span id="l10.748" class="difflineminus">-      lexSkipLookahead();</span>
<a href="#l10.749"></a><span id="l10.749" class="difflineminus">-      a = lexLookahead();</span>
<a href="#l10.750"></a><span id="l10.750" class="difflineminus">-      if (a == ' ' || a == '\t') {</span>
<a href="#l10.751"></a><span id="l10.751" class="difflineminus">-        lexAppendc(' ');</span>
<a href="#l10.752"></a><span id="l10.752" class="difflineminus">-        lexSkipLookahead();</span>
<a href="#l10.753"></a><span id="l10.753" class="difflineminus">-      } else {</span>
<a href="#l10.754"></a><span id="l10.754" class="difflineminus">-        lexPushLookaheadc('\n');</span>
<a href="#l10.755"></a><span id="l10.755" class="difflineminus">-        break;</span>
<a href="#l10.756"></a><span id="l10.756" class="difflineminus">-      }</span>
<a href="#l10.757"></a><span id="l10.757" class="difflineminus">-    } else if (c == '\\') {</span>
<a href="#l10.758"></a><span id="l10.758" class="difflineminus">-      int a;</span>
<a href="#l10.759"></a><span id="l10.759" class="difflineminus">-      lexSkipLookahead();</span>
<a href="#l10.760"></a><span id="l10.760" class="difflineminus">-      a = lexLookahead();</span>
<a href="#l10.761"></a><span id="l10.761" class="difflineminus">-      if (a == '\\' || a == ',' || a == ';' || a == ':') {</span>
<a href="#l10.762"></a><span id="l10.762" class="difflineminus">-        lexAppendc(a);</span>
<a href="#l10.763"></a><span id="l10.763" class="difflineminus">-      } else if (a == 'n' || a == 'N') {</span>
<a href="#l10.764"></a><span id="l10.764" class="difflineminus">-        lexAppendc('\n');</span>
<a href="#l10.765"></a><span id="l10.765" class="difflineminus">-      } else {</span>
<a href="#l10.766"></a><span id="l10.766" class="difflineminus">-        lexAppendc(c);</span>
<a href="#l10.767"></a><span id="l10.767" class="difflineminus">-        lexAppendc(a);</span>
<a href="#l10.768"></a><span id="l10.768" class="difflineminus">-      }</span>
<a href="#l10.769"></a><span id="l10.769" class="difflineminus">-      lexSkipLookahead();</span>
<a href="#l10.770"></a><span id="l10.770" class="difflineminus">-    } else {</span>
<a href="#l10.771"></a><span id="l10.771" class="difflineminus">-      lexAppendc(c);</span>
<a href="#l10.772"></a><span id="l10.772" class="difflineminus">-      lexSkipLookahead();</span>
<a href="#l10.773"></a><span id="l10.773" class="difflineminus">-    }</span>
<a href="#l10.774"></a><span id="l10.774" class="difflineminus">-    c = lexLookahead();</span>
<a href="#l10.775"></a><span id="l10.775" class="difflineminus">-  }</span>
<a href="#l10.776"></a><span id="l10.776" class="difflineminus">-  lexAppendc(0);</span>
<a href="#l10.777"></a><span id="l10.777" class="difflineminus">-  handleMoreRFC822LineBreak(c);</span>
<a href="#l10.778"></a><span id="l10.778" class="difflineminus">-  return c == EOF ? 0 : lexStr();</span>
<a href="#l10.779"></a><span id="l10.779" class="difflineminus">-}</span>
<a href="#l10.780"></a><span id="l10.780" class="difflineminus">-#endif</span>
<a href="#l10.781"></a><span id="l10.781" class="difflineminus">-</span>
<a href="#l10.782"></a><span id="l10.782" class="difflineminus">-#ifndef _SUPPORT_LINE_FOLDING</span>
<a href="#l10.783"></a><span id="l10.783" class="difflineminus">-static char *lexGetStrUntil(char *termset) {</span>
<a href="#l10.784"></a><span id="l10.784" class="difflineminus">-  int c = lexLookahead();</span>
<a href="#l10.785"></a><span id="l10.785" class="difflineminus">-  lexClearToken();</span>
<a href="#l10.786"></a><span id="l10.786" class="difflineminus">-  while (c != EOF &amp;&amp; !PL_strchr(termset, c)) {</span>
<a href="#l10.787"></a><span id="l10.787" class="difflineminus">-    lexAppendc(c);</span>
<a href="#l10.788"></a><span id="l10.788" class="difflineminus">-    lexSkipLookahead();</span>
<a href="#l10.789"></a><span id="l10.789" class="difflineminus">-    c = lexLookahead();</span>
<a href="#l10.790"></a><span id="l10.790" class="difflineminus">-  }</span>
<a href="#l10.791"></a><span id="l10.791" class="difflineminus">-  lexAppendc(0);</span>
<a href="#l10.792"></a><span id="l10.792" class="difflineminus">-  return c == EOF ? 0 : lexStr();</span>
<a href="#l10.793"></a><span id="l10.793" class="difflineminus">-}</span>
<a href="#l10.794"></a><span id="l10.794" class="difflineminus">-#endif /* ! _SUPPORT_LINE_FOLDING */</span>
<a href="#l10.795"></a><span id="l10.795" class="difflineminus">-</span>
<a href="#l10.796"></a><span id="l10.796" class="difflineminus">-static int match_begin_name(int end) {</span>
<a href="#l10.797"></a><span id="l10.797" class="difflineminus">-  char *n = lexLookaheadWord();</span>
<a href="#l10.798"></a><span id="l10.798" class="difflineminus">-  int token = ID;</span>
<a href="#l10.799"></a><span id="l10.799" class="difflineminus">-  if (n) {</span>
<a href="#l10.800"></a><span id="l10.800" class="difflineminus">-    if (!PL_strcasecmp(n, &quot;vcard&quot;))</span>
<a href="#l10.801"></a><span id="l10.801" class="difflineminus">-      token = end ? END_VCARD : BEGIN_VCARD;</span>
<a href="#l10.802"></a><span id="l10.802" class="difflineminus">-    else if (!PL_strcasecmp(n, &quot;vcalendar&quot;))</span>
<a href="#l10.803"></a><span id="l10.803" class="difflineminus">-      token = end ? END_VCAL : BEGIN_VCAL;</span>
<a href="#l10.804"></a><span id="l10.804" class="difflineminus">-    else if (!PL_strcasecmp(n, &quot;vevent&quot;))</span>
<a href="#l10.805"></a><span id="l10.805" class="difflineminus">-      token = end ? END_VEVENT : BEGIN_VEVENT;</span>
<a href="#l10.806"></a><span id="l10.806" class="difflineminus">-    else if (!PL_strcasecmp(n, &quot;vtodo&quot;))</span>
<a href="#l10.807"></a><span id="l10.807" class="difflineminus">-      token = end ? END_VTODO : BEGIN_VTODO;</span>
<a href="#l10.808"></a><span id="l10.808" class="difflineminus">-    deleteString(n);</span>
<a href="#l10.809"></a><span id="l10.809" class="difflineminus">-    return token;</span>
<a href="#l10.810"></a><span id="l10.810" class="difflineminus">-  }</span>
<a href="#l10.811"></a><span id="l10.811" class="difflineminus">-  return 0;</span>
<a href="#l10.812"></a><span id="l10.812" class="difflineminus">-}</span>
<a href="#l10.813"></a><span id="l10.813" class="difflineminus">-</span>
<a href="#l10.814"></a><span id="l10.814" class="difflineminus">-void initLex(const char *inputstring, unsigned long inputlen) {</span>
<a href="#l10.815"></a><span id="l10.815" class="difflineminus">-  /* initialize lex mode stack */</span>
<a href="#l10.816"></a><span id="l10.816" class="difflineminus">-  lexBuf.lexModeStack[lexBuf.lexModeStackTop = 0] = L_NORMAL;</span>
<a href="#l10.817"></a><span id="l10.817" class="difflineminus">-</span>
<a href="#l10.818"></a><span id="l10.818" class="difflineminus">-  /* iniatialize lex buffer. */</span>
<a href="#l10.819"></a><span id="l10.819" class="difflineminus">-  lexBuf.inputString = (char *)inputstring;</span>
<a href="#l10.820"></a><span id="l10.820" class="difflineminus">-  lexBuf.inputLen = inputlen;</span>
<a href="#l10.821"></a><span id="l10.821" class="difflineminus">-  lexBuf.curPos = 0;</span>
<a href="#l10.822"></a><span id="l10.822" class="difflineminus">-</span>
<a href="#l10.823"></a><span id="l10.823" class="difflineminus">-  lexBuf.len = 0;</span>
<a href="#l10.824"></a><span id="l10.824" class="difflineminus">-  lexBuf.getPtr = 0;</span>
<a href="#l10.825"></a><span id="l10.825" class="difflineminus">-</span>
<a href="#l10.826"></a><span id="l10.826" class="difflineminus">-  lexBuf.maxToken = PR_MAXTOKEN;</span>
<a href="#l10.827"></a><span id="l10.827" class="difflineminus">-  lexBuf.strs = (char *)PR_CALLOC(PR_MAXTOKEN);</span>
<a href="#l10.828"></a><span id="l10.828" class="difflineminus">-  lexBuf.strsLen = 0;</span>
<a href="#l10.829"></a><span id="l10.829" class="difflineminus">-}</span>
<a href="#l10.830"></a><span id="l10.830" class="difflineminus">-</span>
<a href="#l10.831"></a><span id="l10.831" class="difflineminus">-static void finiLex() { PR_FREEIF(lexBuf.strs); }</span>
<a href="#l10.832"></a><span id="l10.832" class="difflineminus">-</span>
<a href="#l10.833"></a><span id="l10.833" class="difflineminus">-/******************************************************************************/</span>
<a href="#l10.834"></a><span id="l10.834" class="difflineminus">-/* This parses and converts the base64 format for binary encoding into</span>
<a href="#l10.835"></a><span id="l10.835" class="difflineminus">- * a decoded buffer (allocated with new).  See RFC 1521.</span>
<a href="#l10.836"></a><span id="l10.836" class="difflineminus">- */</span>
<a href="#l10.837"></a><span id="l10.837" class="difflineminus">-static char *lexGetDataFromBase64() {</span>
<a href="#l10.838"></a><span id="l10.838" class="difflineminus">-  unsigned long bytesLen = 0, bytesMax = 0;</span>
<a href="#l10.839"></a><span id="l10.839" class="difflineminus">-  int quadIx = 0, pad = 0;</span>
<a href="#l10.840"></a><span id="l10.840" class="difflineminus">-  unsigned long trip = 0;</span>
<a href="#l10.841"></a><span id="l10.841" class="difflineminus">-  unsigned char b;</span>
<a href="#l10.842"></a><span id="l10.842" class="difflineminus">-  int c;</span>
<a href="#l10.843"></a><span id="l10.843" class="difflineminus">-  unsigned char *bytes = nullptr;</span>
<a href="#l10.844"></a><span id="l10.844" class="difflineminus">-  unsigned char *oldBytes = nullptr;</span>
<a href="#l10.845"></a><span id="l10.845" class="difflineminus">-</span>
<a href="#l10.846"></a><span id="l10.846" class="difflineminus">-  DBG_((&quot;db: lexGetDataFromBase64\n&quot;));</span>
<a href="#l10.847"></a><span id="l10.847" class="difflineminus">-  while (1) {</span>
<a href="#l10.848"></a><span id="l10.848" class="difflineminus">-    c = lexGetc();</span>
<a href="#l10.849"></a><span id="l10.849" class="difflineminus">-    if (c == '\n') {</span>
<a href="#l10.850"></a><span id="l10.850" class="difflineminus">-      ++mime_lineNum;</span>
<a href="#l10.851"></a><span id="l10.851" class="difflineminus">-      if (lexLookahead() == '\n') {</span>
<a href="#l10.852"></a><span id="l10.852" class="difflineminus">-        /* a '\n' character by itself means end of data */</span>
<a href="#l10.853"></a><span id="l10.853" class="difflineminus">-        break;</span>
<a href="#l10.854"></a><span id="l10.854" class="difflineminus">-      } else</span>
<a href="#l10.855"></a><span id="l10.855" class="difflineminus">-        continue; /* ignore '\n' */</span>
<a href="#l10.856"></a><span id="l10.856" class="difflineminus">-    } else {</span>
<a href="#l10.857"></a><span id="l10.857" class="difflineminus">-      if ((c &gt;= 'A') &amp;&amp; (c &lt;= 'Z'))</span>
<a href="#l10.858"></a><span id="l10.858" class="difflineminus">-        b = (unsigned char)(c - 'A');</span>
<a href="#l10.859"></a><span id="l10.859" class="difflineminus">-      else if ((c &gt;= 'a') &amp;&amp; (c &lt;= 'z'))</span>
<a href="#l10.860"></a><span id="l10.860" class="difflineminus">-        b = (unsigned char)(c - 'a') + 26;</span>
<a href="#l10.861"></a><span id="l10.861" class="difflineminus">-      else if ((c &gt;= '0') &amp;&amp; (c &lt;= '9'))</span>
<a href="#l10.862"></a><span id="l10.862" class="difflineminus">-        b = (unsigned char)(c - '0') + 52;</span>
<a href="#l10.863"></a><span id="l10.863" class="difflineminus">-      else if (c == '+')</span>
<a href="#l10.864"></a><span id="l10.864" class="difflineminus">-        b = 62;</span>
<a href="#l10.865"></a><span id="l10.865" class="difflineminus">-      else if (c == '/')</span>
<a href="#l10.866"></a><span id="l10.866" class="difflineminus">-        b = 63;</span>
<a href="#l10.867"></a><span id="l10.867" class="difflineminus">-      else if (c == '=' &amp;&amp; (quadIx == 2 || quadIx == 3)) {</span>
<a href="#l10.868"></a><span id="l10.868" class="difflineminus">-        b = 0;</span>
<a href="#l10.869"></a><span id="l10.869" class="difflineminus">-        pad++;</span>
<a href="#l10.870"></a><span id="l10.870" class="difflineminus">-      } else if ((c == ' ') || (c == '\t')) {</span>
<a href="#l10.871"></a><span id="l10.871" class="difflineminus">-        continue;</span>
<a href="#l10.872"></a><span id="l10.872" class="difflineminus">-      } else { /* error condition */</span>
<a href="#l10.873"></a><span id="l10.873" class="difflineminus">-        if (bytes)</span>
<a href="#l10.874"></a><span id="l10.874" class="difflineminus">-          PR_Free(bytes);</span>
<a href="#l10.875"></a><span id="l10.875" class="difflineminus">-        else if (oldBytes)</span>
<a href="#l10.876"></a><span id="l10.876" class="difflineminus">-          PR_Free(oldBytes);</span>
<a href="#l10.877"></a><span id="l10.877" class="difflineminus">-        /* error recovery: skip until 2 adjacent newlines. */</span>
<a href="#l10.878"></a><span id="l10.878" class="difflineminus">-        DBG_((&quot;db: invalid character 0x%x '%c'\n&quot;, c, c));</span>
<a href="#l10.879"></a><span id="l10.879" class="difflineminus">-        if (c != EOF) {</span>
<a href="#l10.880"></a><span id="l10.880" class="difflineminus">-          c = lexGetc();</span>
<a href="#l10.881"></a><span id="l10.881" class="difflineminus">-          while (c != EOF) {</span>
<a href="#l10.882"></a><span id="l10.882" class="difflineminus">-            if (c == '\n' &amp;&amp; lexLookahead() == '\n') {</span>
<a href="#l10.883"></a><span id="l10.883" class="difflineminus">-              ++mime_lineNum;</span>
<a href="#l10.884"></a><span id="l10.884" class="difflineminus">-              break;</span>
<a href="#l10.885"></a><span id="l10.885" class="difflineminus">-            }</span>
<a href="#l10.886"></a><span id="l10.886" class="difflineminus">-            c = lexGetc();</span>
<a href="#l10.887"></a><span id="l10.887" class="difflineminus">-          }</span>
<a href="#l10.888"></a><span id="l10.888" class="difflineminus">-        }</span>
<a href="#l10.889"></a><span id="l10.889" class="difflineminus">-        return NULL;</span>
<a href="#l10.890"></a><span id="l10.890" class="difflineminus">-      }</span>
<a href="#l10.891"></a><span id="l10.891" class="difflineminus">-      trip = (trip &lt;&lt; 6) | b;</span>
<a href="#l10.892"></a><span id="l10.892" class="difflineminus">-      if (++quadIx == 4) {</span>
<a href="#l10.893"></a><span id="l10.893" class="difflineminus">-        unsigned char outBytes[3];</span>
<a href="#l10.894"></a><span id="l10.894" class="difflineminus">-        int numOut;</span>
<a href="#l10.895"></a><span id="l10.895" class="difflineminus">-        int i;</span>
<a href="#l10.896"></a><span id="l10.896" class="difflineminus">-        for (i = 0; i &lt; 3; i++) {</span>
<a href="#l10.897"></a><span id="l10.897" class="difflineminus">-          outBytes[2 - i] = (unsigned char)(trip &amp; 0xFF);</span>
<a href="#l10.898"></a><span id="l10.898" class="difflineminus">-          trip &gt;&gt;= 8;</span>
<a href="#l10.899"></a><span id="l10.899" class="difflineminus">-        }</span>
<a href="#l10.900"></a><span id="l10.900" class="difflineminus">-        numOut = 3 - pad;</span>
<a href="#l10.901"></a><span id="l10.901" class="difflineminus">-        if (bytesLen + numOut &gt; bytesMax) {</span>
<a href="#l10.902"></a><span id="l10.902" class="difflineminus">-          if (!bytes) {</span>
<a href="#l10.903"></a><span id="l10.903" class="difflineminus">-            bytesMax = 1024;</span>
<a href="#l10.904"></a><span id="l10.904" class="difflineminus">-          } else {</span>
<a href="#l10.905"></a><span id="l10.905" class="difflineminus">-            bytesMax &lt;&lt;= 2;</span>
<a href="#l10.906"></a><span id="l10.906" class="difflineminus">-            oldBytes = bytes;</span>
<a href="#l10.907"></a><span id="l10.907" class="difflineminus">-          }</span>
<a href="#l10.908"></a><span id="l10.908" class="difflineminus">-          bytes = (unsigned char *)PR_Realloc(oldBytes, bytesMax);</span>
<a href="#l10.909"></a><span id="l10.909" class="difflineminus">-          if (!bytes) {</span>
<a href="#l10.910"></a><span id="l10.910" class="difflineminus">-            mime_error(&quot;out of memory while processing BASE64 data\n&quot;);</span>
<a href="#l10.911"></a><span id="l10.911" class="difflineminus">-            break;</span>
<a href="#l10.912"></a><span id="l10.912" class="difflineminus">-          }</span>
<a href="#l10.913"></a><span id="l10.913" class="difflineminus">-        }</span>
<a href="#l10.914"></a><span id="l10.914" class="difflineminus">-        if (bytes) {</span>
<a href="#l10.915"></a><span id="l10.915" class="difflineminus">-          memcpy(bytes + bytesLen, outBytes, numOut);</span>
<a href="#l10.916"></a><span id="l10.916" class="difflineminus">-          bytesLen += numOut;</span>
<a href="#l10.917"></a><span id="l10.917" class="difflineminus">-        }</span>
<a href="#l10.918"></a><span id="l10.918" class="difflineminus">-        trip = 0;</span>
<a href="#l10.919"></a><span id="l10.919" class="difflineminus">-        quadIx = 0;</span>
<a href="#l10.920"></a><span id="l10.920" class="difflineminus">-        pad = 0;</span>
<a href="#l10.921"></a><span id="l10.921" class="difflineminus">-      }</span>
<a href="#l10.922"></a><span id="l10.922" class="difflineminus">-    }</span>
<a href="#l10.923"></a><span id="l10.923" class="difflineminus">-  } /* while */</span>
<a href="#l10.924"></a><span id="l10.924" class="difflineminus">-  DBG_((&quot;db: bytesLen = %d\n&quot;, bytesLen));</span>
<a href="#l10.925"></a><span id="l10.925" class="difflineminus">-  /* kludge: all this won't be necessary if we have tree form</span>
<a href="#l10.926"></a><span id="l10.926" class="difflineminus">-  representation */</span>
<a href="#l10.927"></a><span id="l10.927" class="difflineminus">-  if (bytes) {</span>
<a href="#l10.928"></a><span id="l10.928" class="difflineminus">-    setValueWithSize(curProp, bytes, (unsigned int)bytesLen);</span>
<a href="#l10.929"></a><span id="l10.929" class="difflineminus">-    PR_FREEIF(bytes);</span>
<a href="#l10.930"></a><span id="l10.930" class="difflineminus">-  } else if (oldBytes) {</span>
<a href="#l10.931"></a><span id="l10.931" class="difflineminus">-    setValueWithSize(curProp, oldBytes, (unsigned int)bytesLen);</span>
<a href="#l10.932"></a><span id="l10.932" class="difflineminus">-    PR_FREEIF(oldBytes);</span>
<a href="#l10.933"></a><span id="l10.933" class="difflineminus">-  }</span>
<a href="#l10.934"></a><span id="l10.934" class="difflineminus">-  return 0;</span>
<a href="#l10.935"></a><span id="l10.935" class="difflineminus">-}</span>
<a href="#l10.936"></a><span id="l10.936" class="difflineminus">-</span>
<a href="#l10.937"></a><span id="l10.937" class="difflineminus">-static int match_begin_end_name(int end) {</span>
<a href="#l10.938"></a><span id="l10.938" class="difflineminus">-  int token;</span>
<a href="#l10.939"></a><span id="l10.939" class="difflineminus">-  lexSkipWhite();</span>
<a href="#l10.940"></a><span id="l10.940" class="difflineminus">-  if (lexLookahead() != ':') return ID;</span>
<a href="#l10.941"></a><span id="l10.941" class="difflineminus">-  lexSkipLookahead();</span>
<a href="#l10.942"></a><span id="l10.942" class="difflineminus">-  lexSkipWhite();</span>
<a href="#l10.943"></a><span id="l10.943" class="difflineminus">-  token = match_begin_name(end);</span>
<a href="#l10.944"></a><span id="l10.944" class="difflineminus">-  if (token == ID) {</span>
<a href="#l10.945"></a><span id="l10.945" class="difflineminus">-    lexPushLookaheadc(':');</span>
<a href="#l10.946"></a><span id="l10.946" class="difflineminus">-    DBG_((&quot;db: ID '%s'\n&quot;, yylval.str));</span>
<a href="#l10.947"></a><span id="l10.947" class="difflineminus">-    return ID;</span>
<a href="#l10.948"></a><span id="l10.948" class="difflineminus">-  } else if (token != 0) {</span>
<a href="#l10.949"></a><span id="l10.949" class="difflineminus">-    lexSkipLookaheadWord();</span>
<a href="#l10.950"></a><span id="l10.950" class="difflineminus">-    deleteString(yylval.str);</span>
<a href="#l10.951"></a><span id="l10.951" class="difflineminus">-    DBG_((&quot;db: begin/end %d\n&quot;, token));</span>
<a href="#l10.952"></a><span id="l10.952" class="difflineminus">-    return token;</span>
<a href="#l10.953"></a><span id="l10.953" class="difflineminus">-  }</span>
<a href="#l10.954"></a><span id="l10.954" class="difflineminus">-  return 0;</span>
<a href="#l10.955"></a><span id="l10.955" class="difflineminus">-}</span>
<a href="#l10.956"></a><span id="l10.956" class="difflineminus">-</span>
<a href="#l10.957"></a><span id="l10.957" class="difflineminus">-static char *lexGetQuotedPrintable() {</span>
<a href="#l10.958"></a><span id="l10.958" class="difflineminus">-  char cur;</span>
<a href="#l10.959"></a><span id="l10.959" class="difflineminus">-  /* unsigned long len = 0; */</span>
<a href="#l10.960"></a><span id="l10.960" class="difflineminus">-</span>
<a href="#l10.961"></a><span id="l10.961" class="difflineminus">-  lexClearToken();</span>
<a href="#l10.962"></a><span id="l10.962" class="difflineminus">-  do {</span>
<a href="#l10.963"></a><span id="l10.963" class="difflineminus">-    cur = lexGetc();</span>
<a href="#l10.964"></a><span id="l10.964" class="difflineminus">-    switch (cur) {</span>
<a href="#l10.965"></a><span id="l10.965" class="difflineminus">-      case '=': {</span>
<a href="#l10.966"></a><span id="l10.966" class="difflineminus">-        int c = 0;</span>
<a href="#l10.967"></a><span id="l10.967" class="difflineminus">-        int next[2];</span>
<a href="#l10.968"></a><span id="l10.968" class="difflineminus">-        int tab[1];</span>
<a href="#l10.969"></a><span id="l10.969" class="difflineminus">-        int i;</span>
<a href="#l10.970"></a><span id="l10.970" class="difflineminus">-        for (i = 0; i &lt; 2; i++) {</span>
<a href="#l10.971"></a><span id="l10.971" class="difflineminus">-          next[i] = lexGetc();</span>
<a href="#l10.972"></a><span id="l10.972" class="difflineminus">-          if (next[i] &gt;= '0' &amp;&amp; next[i] &lt;= '9')</span>
<a href="#l10.973"></a><span id="l10.973" class="difflineminus">-            c = c * 16 + next[i] - '0';</span>
<a href="#l10.974"></a><span id="l10.974" class="difflineminus">-          else if (next[i] &gt;= 'A' &amp;&amp; next[i] &lt;= 'F')</span>
<a href="#l10.975"></a><span id="l10.975" class="difflineminus">-            c = c * 16 + next[i] - 'A' + 10;</span>
<a href="#l10.976"></a><span id="l10.976" class="difflineminus">-          else</span>
<a href="#l10.977"></a><span id="l10.977" class="difflineminus">-            break;</span>
<a href="#l10.978"></a><span id="l10.978" class="difflineminus">-        }</span>
<a href="#l10.979"></a><span id="l10.979" class="difflineminus">-        if (i == 0) {</span>
<a href="#l10.980"></a><span id="l10.980" class="difflineminus">-          /* single '=' follow by LINESEP is continuation sign? */</span>
<a href="#l10.981"></a><span id="l10.981" class="difflineminus">-          if (next[0] == '\n') {</span>
<a href="#l10.982"></a><span id="l10.982" class="difflineminus">-            tab[0] = lexGetc();</span>
<a href="#l10.983"></a><span id="l10.983" class="difflineminus">-            if (tab[0] == '\t') lexSkipWhite();</span>
<a href="#l10.984"></a><span id="l10.984" class="difflineminus">-            ++mime_lineNum;</span>
<a href="#l10.985"></a><span id="l10.985" class="difflineminus">-          } else {</span>
<a href="#l10.986"></a><span id="l10.986" class="difflineminus">-            lexAppendc(cur);</span>
<a href="#l10.987"></a><span id="l10.987" class="difflineminus">-            /* lexPushLookaheadc('=');</span>
<a href="#l10.988"></a><span id="l10.988" class="difflineminus">-            goto EndString; */</span>
<a href="#l10.989"></a><span id="l10.989" class="difflineminus">-          }</span>
<a href="#l10.990"></a><span id="l10.990" class="difflineminus">-        } else if (i == 1) {</span>
<a href="#l10.991"></a><span id="l10.991" class="difflineminus">-          lexPushLookaheadc(next[1]);</span>
<a href="#l10.992"></a><span id="l10.992" class="difflineminus">-          lexPushLookaheadc(next[0]);</span>
<a href="#l10.993"></a><span id="l10.993" class="difflineminus">-          lexAppendc('=');</span>
<a href="#l10.994"></a><span id="l10.994" class="difflineminus">-        } else {</span>
<a href="#l10.995"></a><span id="l10.995" class="difflineminus">-          lexAppendc(c);</span>
<a href="#l10.996"></a><span id="l10.996" class="difflineminus">-        }</span>
<a href="#l10.997"></a><span id="l10.997" class="difflineminus">-        break;</span>
<a href="#l10.998"></a><span id="l10.998" class="difflineminus">-      } /* '=' */</span>
<a href="#l10.999"></a><span id="l10.999" class="difflineminus">-      case '\n': {</span>
<a href="#l10.1000"></a><span id="l10.1000" class="difflineminus">-        lexPushLookaheadc('\n');</span>
<a href="#l10.1001"></a><span id="l10.1001" class="difflineminus">-        goto EndString;</span>
<a href="#l10.1002"></a><span id="l10.1002" class="difflineminus">-      }</span>
<a href="#l10.1003"></a><span id="l10.1003" class="difflineminus">-      case ';': {</span>
<a href="#l10.1004"></a><span id="l10.1004" class="difflineminus">-        lexPushLookaheadc(';');</span>
<a href="#l10.1005"></a><span id="l10.1005" class="difflineminus">-        goto EndString;</span>
<a href="#l10.1006"></a><span id="l10.1006" class="difflineminus">-      }</span>
<a href="#l10.1007"></a><span id="l10.1007" class="difflineminus">-      case (char)EOF:</span>
<a href="#l10.1008"></a><span id="l10.1008" class="difflineminus">-        break;</span>
<a href="#l10.1009"></a><span id="l10.1009" class="difflineminus">-      default:</span>
<a href="#l10.1010"></a><span id="l10.1010" class="difflineminus">-        lexAppendc(cur);</span>
<a href="#l10.1011"></a><span id="l10.1011" class="difflineminus">-        break;</span>
<a href="#l10.1012"></a><span id="l10.1012" class="difflineminus">-    } /* switch */</span>
<a href="#l10.1013"></a><span id="l10.1013" class="difflineminus">-  } while (cur != (char)EOF);</span>
<a href="#l10.1014"></a><span id="l10.1014" class="difflineminus">-</span>
<a href="#l10.1015"></a><span id="l10.1015" class="difflineminus">-EndString:</span>
<a href="#l10.1016"></a><span id="l10.1016" class="difflineminus">-  lexAppendc(0);</span>
<a href="#l10.1017"></a><span id="l10.1017" class="difflineminus">-  return lexStr();</span>
<a href="#l10.1018"></a><span id="l10.1018" class="difflineminus">-} /* LexQuotedPrintable */</span>
<a href="#l10.1019"></a><span id="l10.1019" class="difflineminus">-</span>
<a href="#l10.1020"></a><span id="l10.1020" class="difflineminus">-static int yylex() {</span>
<a href="#l10.1021"></a><span id="l10.1021" class="difflineminus">-  /* int token = 0; */</span>
<a href="#l10.1022"></a><span id="l10.1022" class="difflineminus">-  int lexmode = LEXMODE();</span>
<a href="#l10.1023"></a><span id="l10.1023" class="difflineminus">-  if (lexmode == L_VALUES) {</span>
<a href="#l10.1024"></a><span id="l10.1024" class="difflineminus">-    int c = lexGetc();</span>
<a href="#l10.1025"></a><span id="l10.1025" class="difflineminus">-    if (c == ';') {</span>
<a href="#l10.1026"></a><span id="l10.1026" class="difflineminus">-      DBG_((&quot;db: SEMICOLON\n&quot;));</span>
<a href="#l10.1027"></a><span id="l10.1027" class="difflineminus">-#ifdef _SUPPORT_LINE_FOLDING</span>
<a href="#l10.1028"></a><span id="l10.1028" class="difflineminus">-      lexPushLookaheadc(c);</span>
<a href="#l10.1029"></a><span id="l10.1029" class="difflineminus">-      handleMoreRFC822LineBreak(c);</span>
<a href="#l10.1030"></a><span id="l10.1030" class="difflineminus">-      lexSkipLookahead();</span>
<a href="#l10.1031"></a><span id="l10.1031" class="difflineminus">-#endif</span>
<a href="#l10.1032"></a><span id="l10.1032" class="difflineminus">-      return SEMICOLON;</span>
<a href="#l10.1033"></a><span id="l10.1033" class="difflineminus">-    } else if (PL_strchr(&quot;\n&quot;, (char)c)) {</span>
<a href="#l10.1034"></a><span id="l10.1034" class="difflineminus">-      ++mime_lineNum;</span>
<a href="#l10.1035"></a><span id="l10.1035" class="difflineminus">-      /* consume all line separator(s) adjacent to each other */</span>
<a href="#l10.1036"></a><span id="l10.1036" class="difflineminus">-      c = lexLookahead();</span>
<a href="#l10.1037"></a><span id="l10.1037" class="difflineminus">-      while (PL_strchr(&quot;\n&quot;, (char)c)) {</span>
<a href="#l10.1038"></a><span id="l10.1038" class="difflineminus">-        lexSkipLookahead();</span>
<a href="#l10.1039"></a><span id="l10.1039" class="difflineminus">-        c = lexLookahead();</span>
<a href="#l10.1040"></a><span id="l10.1040" class="difflineminus">-        ++mime_lineNum;</span>
<a href="#l10.1041"></a><span id="l10.1041" class="difflineminus">-      }</span>
<a href="#l10.1042"></a><span id="l10.1042" class="difflineminus">-      DBG_((&quot;db: LINESEP\n&quot;));</span>
<a href="#l10.1043"></a><span id="l10.1043" class="difflineminus">-      return LINESEP;</span>
<a href="#l10.1044"></a><span id="l10.1044" class="difflineminus">-    } else {</span>
<a href="#l10.1045"></a><span id="l10.1045" class="difflineminus">-      char *p = 0;</span>
<a href="#l10.1046"></a><span id="l10.1046" class="difflineminus">-      lexPushLookaheadc(c);</span>
<a href="#l10.1047"></a><span id="l10.1047" class="difflineminus">-      if (lexWithinMode(L_BASE64)) {</span>
<a href="#l10.1048"></a><span id="l10.1048" class="difflineminus">-        /* get each char and convert to bin on the fly... */</span>
<a href="#l10.1049"></a><span id="l10.1049" class="difflineminus">-        p = lexGetDataFromBase64();</span>
<a href="#l10.1050"></a><span id="l10.1050" class="difflineminus">-        yylval.str = p;</span>
<a href="#l10.1051"></a><span id="l10.1051" class="difflineminus">-        return !p &amp;&amp; lexLookahead() == EOF ? 0 : STRING;</span>
<a href="#l10.1052"></a><span id="l10.1052" class="difflineminus">-      } else if (lexWithinMode(L_QUOTED_PRINTABLE)) {</span>
<a href="#l10.1053"></a><span id="l10.1053" class="difflineminus">-        p = lexGetQuotedPrintable();</span>
<a href="#l10.1054"></a><span id="l10.1054" class="difflineminus">-      } else {</span>
<a href="#l10.1055"></a><span id="l10.1055" class="difflineminus">-#ifdef _SUPPORT_LINE_FOLDING</span>
<a href="#l10.1056"></a><span id="l10.1056" class="difflineminus">-        p = lexGet1Value();</span>
<a href="#l10.1057"></a><span id="l10.1057" class="difflineminus">-#else</span>
<a href="#l10.1058"></a><span id="l10.1058" class="difflineminus">-        p = lexGetStrUntil(&quot;;\n&quot;);</span>
<a href="#l10.1059"></a><span id="l10.1059" class="difflineminus">-#endif</span>
<a href="#l10.1060"></a><span id="l10.1060" class="difflineminus">-      }</span>
<a href="#l10.1061"></a><span id="l10.1061" class="difflineminus">-      if (p &amp;&amp; (*p || lexLookahead() != EOF)) {</span>
<a href="#l10.1062"></a><span id="l10.1062" class="difflineminus">-        DBG_((&quot;db: STRING: '%s'\n&quot;, p));</span>
<a href="#l10.1063"></a><span id="l10.1063" class="difflineminus">-        yylval.str = p;</span>
<a href="#l10.1064"></a><span id="l10.1064" class="difflineminus">-        return STRING;</span>
<a href="#l10.1065"></a><span id="l10.1065" class="difflineminus">-      } else</span>
<a href="#l10.1066"></a><span id="l10.1066" class="difflineminus">-        return 0;</span>
<a href="#l10.1067"></a><span id="l10.1067" class="difflineminus">-    }</span>
<a href="#l10.1068"></a><span id="l10.1068" class="difflineminus">-  } else {</span>
<a href="#l10.1069"></a><span id="l10.1069" class="difflineminus">-    /* normal mode */</span>
<a href="#l10.1070"></a><span id="l10.1070" class="difflineminus">-    while (1) {</span>
<a href="#l10.1071"></a><span id="l10.1071" class="difflineminus">-      int c = lexGetc();</span>
<a href="#l10.1072"></a><span id="l10.1072" class="difflineminus">-      switch (c) {</span>
<a href="#l10.1073"></a><span id="l10.1073" class="difflineminus">-        case ':': {</span>
<a href="#l10.1074"></a><span id="l10.1074" class="difflineminus">-          /* consume all line separator(s) adjacent to each other */</span>
<a href="#l10.1075"></a><span id="l10.1075" class="difflineminus">-          /* ignoring linesep immediately after colon. */</span>
<a href="#l10.1076"></a><span id="l10.1076" class="difflineminus">-          c = lexLookahead();</span>
<a href="#l10.1077"></a><span id="l10.1077" class="difflineminus">-          while (PL_strchr(&quot;\n&quot;, (char)c)) {</span>
<a href="#l10.1078"></a><span id="l10.1078" class="difflineminus">-            lexSkipLookahead();</span>
<a href="#l10.1079"></a><span id="l10.1079" class="difflineminus">-            c = lexLookahead();</span>
<a href="#l10.1080"></a><span id="l10.1080" class="difflineminus">-            ++mime_lineNum;</span>
<a href="#l10.1081"></a><span id="l10.1081" class="difflineminus">-          }</span>
<a href="#l10.1082"></a><span id="l10.1082" class="difflineminus">-          DBG_((&quot;db: COLON\n&quot;));</span>
<a href="#l10.1083"></a><span id="l10.1083" class="difflineminus">-          return COLON;</span>
<a href="#l10.1084"></a><span id="l10.1084" class="difflineminus">-        }</span>
<a href="#l10.1085"></a><span id="l10.1085" class="difflineminus">-        case ';':</span>
<a href="#l10.1086"></a><span id="l10.1086" class="difflineminus">-          DBG_((&quot;db: SEMICOLON\n&quot;));</span>
<a href="#l10.1087"></a><span id="l10.1087" class="difflineminus">-          return SEMICOLON;</span>
<a href="#l10.1088"></a><span id="l10.1088" class="difflineminus">-        case '=':</span>
<a href="#l10.1089"></a><span id="l10.1089" class="difflineminus">-          DBG_((&quot;db: EQ\n&quot;));</span>
<a href="#l10.1090"></a><span id="l10.1090" class="difflineminus">-          return EQ;</span>
<a href="#l10.1091"></a><span id="l10.1091" class="difflineminus">-        /* ignore whitespace in this mode */</span>
<a href="#l10.1092"></a><span id="l10.1092" class="difflineminus">-        case '\t':</span>
<a href="#l10.1093"></a><span id="l10.1093" class="difflineminus">-        case ' ':</span>
<a href="#l10.1094"></a><span id="l10.1094" class="difflineminus">-          continue;</span>
<a href="#l10.1095"></a><span id="l10.1095" class="difflineminus">-        case '\n': {</span>
<a href="#l10.1096"></a><span id="l10.1096" class="difflineminus">-          ++mime_lineNum;</span>
<a href="#l10.1097"></a><span id="l10.1097" class="difflineminus">-          continue;</span>
<a href="#l10.1098"></a><span id="l10.1098" class="difflineminus">-        }</span>
<a href="#l10.1099"></a><span id="l10.1099" class="difflineminus">-        case EOF:</span>
<a href="#l10.1100"></a><span id="l10.1100" class="difflineminus">-          return 0;</span>
<a href="#l10.1101"></a><span id="l10.1101" class="difflineminus">-        default: {</span>
<a href="#l10.1102"></a><span id="l10.1102" class="difflineminus">-          lexPushLookaheadc(c);</span>
<a href="#l10.1103"></a><span id="l10.1103" class="difflineminus">-          if (isalpha(c)) {</span>
<a href="#l10.1104"></a><span id="l10.1104" class="difflineminus">-            char *t = lexGetWord();</span>
<a href="#l10.1105"></a><span id="l10.1105" class="difflineminus">-            yylval.str = t;</span>
<a href="#l10.1106"></a><span id="l10.1106" class="difflineminus">-            if (!PL_strcasecmp(t, &quot;BEGIN&quot;)) {</span>
<a href="#l10.1107"></a><span id="l10.1107" class="difflineminus">-              return match_begin_end_name(0);</span>
<a href="#l10.1108"></a><span id="l10.1108" class="difflineminus">-            } else if (!PL_strcasecmp(t, &quot;END&quot;)) {</span>
<a href="#l10.1109"></a><span id="l10.1109" class="difflineminus">-              return match_begin_end_name(1);</span>
<a href="#l10.1110"></a><span id="l10.1110" class="difflineminus">-            } else {</span>
<a href="#l10.1111"></a><span id="l10.1111" class="difflineminus">-              DBG_((&quot;db: ID '%s'\n&quot;, t));</span>
<a href="#l10.1112"></a><span id="l10.1112" class="difflineminus">-              return ID;</span>
<a href="#l10.1113"></a><span id="l10.1113" class="difflineminus">-            }</span>
<a href="#l10.1114"></a><span id="l10.1114" class="difflineminus">-          } else {</span>
<a href="#l10.1115"></a><span id="l10.1115" class="difflineminus">-            /* unknown token */</span>
<a href="#l10.1116"></a><span id="l10.1116" class="difflineminus">-            return 0;</span>
<a href="#l10.1117"></a><span id="l10.1117" class="difflineminus">-          }</span>
<a href="#l10.1118"></a><span id="l10.1118" class="difflineminus">-        }</span>
<a href="#l10.1119"></a><span id="l10.1119" class="difflineminus">-      }</span>
<a href="#l10.1120"></a><span id="l10.1120" class="difflineminus">-    }</span>
<a href="#l10.1121"></a><span id="l10.1121" class="difflineminus">-  }</span>
<a href="#l10.1122"></a><span id="l10.1122" class="difflineminus">-}</span>
<a href="#l10.1123"></a><span id="l10.1123" class="difflineminus">-</span>
<a href="#l10.1124"></a><span id="l10.1124" class="difflineminus">-/***************************************************************************/</span>
<a href="#l10.1125"></a><span id="l10.1125" class="difflineminus">-/***              Public Functions            ****/</span>
<a href="#l10.1126"></a><span id="l10.1126" class="difflineminus">-/***************************************************************************/</span>
<a href="#l10.1127"></a><span id="l10.1127" class="difflineminus">-</span>
<a href="#l10.1128"></a><span id="l10.1128" class="difflineminus">-static VObject *parse_MIMEHelper() {</span>
<a href="#l10.1129"></a><span id="l10.1129" class="difflineminus">-  ObjStackTop = -1;</span>
<a href="#l10.1130"></a><span id="l10.1130" class="difflineminus">-  mime_numErrors = 0;</span>
<a href="#l10.1131"></a><span id="l10.1131" class="difflineminus">-  mime_lineNum = 1;</span>
<a href="#l10.1132"></a><span id="l10.1132" class="difflineminus">-  vObjList = 0;</span>
<a href="#l10.1133"></a><span id="l10.1133" class="difflineminus">-  curObj = 0;</span>
<a href="#l10.1134"></a><span id="l10.1134" class="difflineminus">-</span>
<a href="#l10.1135"></a><span id="l10.1135" class="difflineminus">-  if (yyparse() != 0) return 0;</span>
<a href="#l10.1136"></a><span id="l10.1136" class="difflineminus">-</span>
<a href="#l10.1137"></a><span id="l10.1137" class="difflineminus">-  finiLex();</span>
<a href="#l10.1138"></a><span id="l10.1138" class="difflineminus">-  return vObjList;</span>
<a href="#l10.1139"></a><span id="l10.1139" class="difflineminus">-}</span>
<a href="#l10.1140"></a><span id="l10.1140" class="difflineminus">-</span>
<a href="#l10.1141"></a><span id="l10.1141" class="difflineminus">-/******************************************************************************/</span>
<a href="#l10.1142"></a><span id="l10.1142" class="difflineminus">-VObject *parse_MIME(const char *input, unsigned long len) {</span>
<a href="#l10.1143"></a><span id="l10.1143" class="difflineminus">-  initLex(input, len);</span>
<a href="#l10.1144"></a><span id="l10.1144" class="difflineminus">-  return parse_MIMEHelper();</span>
<a href="#l10.1145"></a><span id="l10.1145" class="difflineminus">-}</span>
<a href="#l10.1146"></a><span id="l10.1146" class="difflineminus">-</span>
<a href="#l10.1147"></a><span id="l10.1147" class="difflineminus">-static MimeErrorHandler mimeErrorHandler;</span>
<a href="#l10.1148"></a><span id="l10.1148" class="difflineminus">-</span>
<a href="#l10.1149"></a><span id="l10.1149" class="difflineminus">-void registerMimeErrorHandler(MimeErrorHandler me) { mimeErrorHandler = me; }</span>
<a href="#l10.1150"></a><span id="l10.1150" class="difflineminus">-</span>
<a href="#l10.1151"></a><span id="l10.1151" class="difflineminus">-void mime_error(const char *s) {</span>
<a href="#l10.1152"></a><span id="l10.1152" class="difflineminus">-  char msg[256];</span>
<a href="#l10.1153"></a><span id="l10.1153" class="difflineminus">-  if (mimeErrorHandler) {</span>
<a href="#l10.1154"></a><span id="l10.1154" class="difflineminus">-    PR_snprintf(msg, sizeof(msg), &quot;%s at line %d&quot;, s, mime_lineNum);</span>
<a href="#l10.1155"></a><span id="l10.1155" class="difflineminus">-    mimeErrorHandler(msg);</span>
<a href="#l10.1156"></a><span id="l10.1156" class="difflineminus">-  }</span>
<a href="#l10.1157"></a><span id="l10.1157" class="difflineminus">-}</span>
<a href="#l10.1158"></a><span id="l10.1158" class="difflineminus">-</span>
<a href="#l10.1159"></a><span id="l10.1159" class="difflineminus">-/*#line 1221 &quot;y_tab.c&quot;*/</span>
<a href="#l10.1160"></a><span id="l10.1160" class="difflineminus">-#define YYABORT goto yyabort</span>
<a href="#l10.1161"></a><span id="l10.1161" class="difflineminus">-#define YYACCEPT goto yyaccept</span>
<a href="#l10.1162"></a><span id="l10.1162" class="difflineminus">-#define YYERROR goto yyerrlab</span>
<a href="#l10.1163"></a><span id="l10.1163" class="difflineminus">-int yyparse() {</span>
<a href="#l10.1164"></a><span id="l10.1164" class="difflineminus">-  int yym, yyn, yystate;</span>
<a href="#l10.1165"></a><span id="l10.1165" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1166"></a><span id="l10.1166" class="difflineminus">-  char *yys;</span>
<a href="#l10.1167"></a><span id="l10.1167" class="difflineminus">-  extern char *getenv();</span>
<a href="#l10.1168"></a><span id="l10.1168" class="difflineminus">-</span>
<a href="#l10.1169"></a><span id="l10.1169" class="difflineminus">-  if (yys = getenv(&quot;YYDEBUG&quot;)) {</span>
<a href="#l10.1170"></a><span id="l10.1170" class="difflineminus">-    yyn = *yys;</span>
<a href="#l10.1171"></a><span id="l10.1171" class="difflineminus">-    if (yyn &gt;= '0' &amp;&amp; yyn &lt;= '9') yydebug = yyn - '0';</span>
<a href="#l10.1172"></a><span id="l10.1172" class="difflineminus">-  }</span>
<a href="#l10.1173"></a><span id="l10.1173" class="difflineminus">-#endif</span>
<a href="#l10.1174"></a><span id="l10.1174" class="difflineminus">-</span>
<a href="#l10.1175"></a><span id="l10.1175" class="difflineminus">-  yynerrs = 0;</span>
<a href="#l10.1176"></a><span id="l10.1176" class="difflineminus">-  yyerrflag = 0;</span>
<a href="#l10.1177"></a><span id="l10.1177" class="difflineminus">-  yychar = (-1);</span>
<a href="#l10.1178"></a><span id="l10.1178" class="difflineminus">-</span>
<a href="#l10.1179"></a><span id="l10.1179" class="difflineminus">-  yyssp = yyss;</span>
<a href="#l10.1180"></a><span id="l10.1180" class="difflineminus">-  yyvsp = yyvs;</span>
<a href="#l10.1181"></a><span id="l10.1181" class="difflineminus">-  *yyssp = yystate = 0;</span>
<a href="#l10.1182"></a><span id="l10.1182" class="difflineminus">-</span>
<a href="#l10.1183"></a><span id="l10.1183" class="difflineminus">-yyloop:</span>
<a href="#l10.1184"></a><span id="l10.1184" class="difflineminus">-  if ((yyn = yydefred[yystate])) goto yyreduce;</span>
<a href="#l10.1185"></a><span id="l10.1185" class="difflineminus">-  if (yychar &lt; 0) {</span>
<a href="#l10.1186"></a><span id="l10.1186" class="difflineminus">-    if ((yychar = yylex()) &lt; 0) yychar = 0;</span>
<a href="#l10.1187"></a><span id="l10.1187" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1188"></a><span id="l10.1188" class="difflineminus">-    if (yydebug) {</span>
<a href="#l10.1189"></a><span id="l10.1189" class="difflineminus">-      yys = 0;</span>
<a href="#l10.1190"></a><span id="l10.1190" class="difflineminus">-      if (yychar &lt;= YYPR_MAXTOKEN) yys = yyname[yychar];</span>
<a href="#l10.1191"></a><span id="l10.1191" class="difflineminus">-      if (!yys) yys = &quot;illegal-symbol&quot;;</span>
<a href="#l10.1192"></a><span id="l10.1192" class="difflineminus">-      printf(&quot;yydebug: state %d, reading %d (%s)\n&quot;, yystate, yychar, yys);</span>
<a href="#l10.1193"></a><span id="l10.1193" class="difflineminus">-    }</span>
<a href="#l10.1194"></a><span id="l10.1194" class="difflineminus">-#endif</span>
<a href="#l10.1195"></a><span id="l10.1195" class="difflineminus">-  }</span>
<a href="#l10.1196"></a><span id="l10.1196" class="difflineminus">-  if ((yyn = yysindex[yystate]) &amp;&amp; (yyn += yychar) &gt;= 0 &amp;&amp; yyn &lt;= YYTABLESIZE &amp;&amp;</span>
<a href="#l10.1197"></a><span id="l10.1197" class="difflineminus">-      yycheck[yyn] == yychar) {</span>
<a href="#l10.1198"></a><span id="l10.1198" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1199"></a><span id="l10.1199" class="difflineminus">-    if (yydebug)</span>
<a href="#l10.1200"></a><span id="l10.1200" class="difflineminus">-      printf(&quot;yydebug: state %d, shifting to state %d\n&quot;, yystate,</span>
<a href="#l10.1201"></a><span id="l10.1201" class="difflineminus">-             yytable[yyn]);</span>
<a href="#l10.1202"></a><span id="l10.1202" class="difflineminus">-#endif</span>
<a href="#l10.1203"></a><span id="l10.1203" class="difflineminus">-    if (yyssp &gt;= yyss + yystacksize - 1) {</span>
<a href="#l10.1204"></a><span id="l10.1204" class="difflineminus">-      goto yyoverflow;</span>
<a href="#l10.1205"></a><span id="l10.1205" class="difflineminus">-    }</span>
<a href="#l10.1206"></a><span id="l10.1206" class="difflineminus">-    *++yyssp = yystate = yytable[yyn];</span>
<a href="#l10.1207"></a><span id="l10.1207" class="difflineminus">-    *++yyvsp = yylval;</span>
<a href="#l10.1208"></a><span id="l10.1208" class="difflineminus">-    yychar = (-1);</span>
<a href="#l10.1209"></a><span id="l10.1209" class="difflineminus">-    if (yyerrflag &gt; 0) --yyerrflag;</span>
<a href="#l10.1210"></a><span id="l10.1210" class="difflineminus">-    goto yyloop;</span>
<a href="#l10.1211"></a><span id="l10.1211" class="difflineminus">-  }</span>
<a href="#l10.1212"></a><span id="l10.1212" class="difflineminus">-  if ((yyn = yyrindex[yystate]) &amp;&amp; (yyn += yychar) &gt;= 0 &amp;&amp; yyn &lt;= YYTABLESIZE &amp;&amp;</span>
<a href="#l10.1213"></a><span id="l10.1213" class="difflineminus">-      yycheck[yyn] == yychar) {</span>
<a href="#l10.1214"></a><span id="l10.1214" class="difflineminus">-    yyn = yytable[yyn];</span>
<a href="#l10.1215"></a><span id="l10.1215" class="difflineminus">-    goto yyreduce;</span>
<a href="#l10.1216"></a><span id="l10.1216" class="difflineminus">-  }</span>
<a href="#l10.1217"></a><span id="l10.1217" class="difflineminus">-  if (yyerrflag) goto yyinrecovery;</span>
<a href="#l10.1218"></a><span id="l10.1218" class="difflineminus">-#ifdef lint</span>
<a href="#l10.1219"></a><span id="l10.1219" class="difflineminus">-  goto yynewerror;</span>
<a href="#l10.1220"></a><span id="l10.1220" class="difflineminus">-#endif</span>
<a href="#l10.1221"></a><span id="l10.1221" class="difflineminus">-  /*yynewerror: */</span>
<a href="#l10.1222"></a><span id="l10.1222" class="difflineminus">-  yyerror(&quot;syntax error&quot;);</span>
<a href="#l10.1223"></a><span id="l10.1223" class="difflineminus">-#ifdef lint</span>
<a href="#l10.1224"></a><span id="l10.1224" class="difflineminus">-  goto yyerrlab;</span>
<a href="#l10.1225"></a><span id="l10.1225" class="difflineminus">-#endif</span>
<a href="#l10.1226"></a><span id="l10.1226" class="difflineminus">-yyerrlab:</span>
<a href="#l10.1227"></a><span id="l10.1227" class="difflineminus">-  ++yynerrs;</span>
<a href="#l10.1228"></a><span id="l10.1228" class="difflineminus">-yyinrecovery:</span>
<a href="#l10.1229"></a><span id="l10.1229" class="difflineminus">-  if (yyerrflag &lt; 3) {</span>
<a href="#l10.1230"></a><span id="l10.1230" class="difflineminus">-    yyerrflag = 3;</span>
<a href="#l10.1231"></a><span id="l10.1231" class="difflineminus">-    for (;;) {</span>
<a href="#l10.1232"></a><span id="l10.1232" class="difflineminus">-      if ((yyn = yysindex[*yyssp]) &amp;&amp; (yyn += YYERRCODE) &gt;= 0 &amp;&amp;</span>
<a href="#l10.1233"></a><span id="l10.1233" class="difflineminus">-          yyn &lt;= YYTABLESIZE &amp;&amp; yycheck[yyn] == YYERRCODE) {</span>
<a href="#l10.1234"></a><span id="l10.1234" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1235"></a><span id="l10.1235" class="difflineminus">-        if (yydebug)</span>
<a href="#l10.1236"></a><span id="l10.1236" class="difflineminus">-          printf(&quot;yydebug: state %d, error recovery shifting to state %d\n&quot;,</span>
<a href="#l10.1237"></a><span id="l10.1237" class="difflineminus">-                 *yyssp, yytable[yyn]);</span>
<a href="#l10.1238"></a><span id="l10.1238" class="difflineminus">-#endif</span>
<a href="#l10.1239"></a><span id="l10.1239" class="difflineminus">-        if (yyssp &gt;= yyss + yystacksize - 1) {</span>
<a href="#l10.1240"></a><span id="l10.1240" class="difflineminus">-          goto yyoverflow;</span>
<a href="#l10.1241"></a><span id="l10.1241" class="difflineminus">-        }</span>
<a href="#l10.1242"></a><span id="l10.1242" class="difflineminus">-        *++yyssp = yystate = yytable[yyn];</span>
<a href="#l10.1243"></a><span id="l10.1243" class="difflineminus">-        *++yyvsp = yylval;</span>
<a href="#l10.1244"></a><span id="l10.1244" class="difflineminus">-        goto yyloop;</span>
<a href="#l10.1245"></a><span id="l10.1245" class="difflineminus">-      } else {</span>
<a href="#l10.1246"></a><span id="l10.1246" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1247"></a><span id="l10.1247" class="difflineminus">-        if (yydebug)</span>
<a href="#l10.1248"></a><span id="l10.1248" class="difflineminus">-          printf(&quot;yydebug: error recovery discarding state %d\n&quot;, *yyssp);</span>
<a href="#l10.1249"></a><span id="l10.1249" class="difflineminus">-#endif</span>
<a href="#l10.1250"></a><span id="l10.1250" class="difflineminus">-        if (yyssp &lt;= yyss) goto yyabort;</span>
<a href="#l10.1251"></a><span id="l10.1251" class="difflineminus">-        --yyssp;</span>
<a href="#l10.1252"></a><span id="l10.1252" class="difflineminus">-        --yyvsp;</span>
<a href="#l10.1253"></a><span id="l10.1253" class="difflineminus">-      }</span>
<a href="#l10.1254"></a><span id="l10.1254" class="difflineminus">-    }</span>
<a href="#l10.1255"></a><span id="l10.1255" class="difflineminus">-  } else {</span>
<a href="#l10.1256"></a><span id="l10.1256" class="difflineminus">-    if (yychar == 0) goto yyabort;</span>
<a href="#l10.1257"></a><span id="l10.1257" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1258"></a><span id="l10.1258" class="difflineminus">-    if (yydebug) {</span>
<a href="#l10.1259"></a><span id="l10.1259" class="difflineminus">-      yys = 0;</span>
<a href="#l10.1260"></a><span id="l10.1260" class="difflineminus">-      if (yychar &lt;= YYPR_MAXTOKEN) yys = yyname[yychar];</span>
<a href="#l10.1261"></a><span id="l10.1261" class="difflineminus">-      if (!yys) yys = &quot;illegal-symbol&quot;;</span>
<a href="#l10.1262"></a><span id="l10.1262" class="difflineminus">-      printf(&quot;yydebug: state %d, error recovery discards token %d (%s)\n&quot;,</span>
<a href="#l10.1263"></a><span id="l10.1263" class="difflineminus">-             yystate, yychar, yys);</span>
<a href="#l10.1264"></a><span id="l10.1264" class="difflineminus">-    }</span>
<a href="#l10.1265"></a><span id="l10.1265" class="difflineminus">-#endif</span>
<a href="#l10.1266"></a><span id="l10.1266" class="difflineminus">-    yychar = (-1);</span>
<a href="#l10.1267"></a><span id="l10.1267" class="difflineminus">-    goto yyloop;</span>
<a href="#l10.1268"></a><span id="l10.1268" class="difflineminus">-  }</span>
<a href="#l10.1269"></a><span id="l10.1269" class="difflineminus">-yyreduce:</span>
<a href="#l10.1270"></a><span id="l10.1270" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1271"></a><span id="l10.1271" class="difflineminus">-  if (yydebug)</span>
<a href="#l10.1272"></a><span id="l10.1272" class="difflineminus">-    printf(&quot;yydebug: state %d, reducing by rule %d (%s)\n&quot;, yystate, yyn,</span>
<a href="#l10.1273"></a><span id="l10.1273" class="difflineminus">-           yyrule[yyn]);</span>
<a href="#l10.1274"></a><span id="l10.1274" class="difflineminus">-#endif</span>
<a href="#l10.1275"></a><span id="l10.1275" class="difflineminus">-  yym = yylen[yyn];</span>
<a href="#l10.1276"></a><span id="l10.1276" class="difflineminus">-  yyval = yyvsp[1 - yym];</span>
<a href="#l10.1277"></a><span id="l10.1277" class="difflineminus">-  switch (yyn) {</span>
<a href="#l10.1278"></a><span id="l10.1278" class="difflineminus">-    case 2:</span>
<a href="#l10.1279"></a><span id="l10.1279" class="difflineminus">-      /*#line 282 &quot;vcc.y&quot;*/</span>
<a href="#l10.1280"></a><span id="l10.1280" class="difflineminus">-      {</span>
<a href="#l10.1281"></a><span id="l10.1281" class="difflineminus">-        addList(&amp;vObjList, yyvsp[0].vobj);</span>
<a href="#l10.1282"></a><span id="l10.1282" class="difflineminus">-        curObj = 0;</span>
<a href="#l10.1283"></a><span id="l10.1283" class="difflineminus">-      }</span>
<a href="#l10.1284"></a><span id="l10.1284" class="difflineminus">-      break;</span>
<a href="#l10.1285"></a><span id="l10.1285" class="difflineminus">-    case 4:</span>
<a href="#l10.1286"></a><span id="l10.1286" class="difflineminus">-      /*#line 285 &quot;vcc.y&quot;*/</span>
<a href="#l10.1287"></a><span id="l10.1287" class="difflineminus">-      {</span>
<a href="#l10.1288"></a><span id="l10.1288" class="difflineminus">-        addList(&amp;vObjList, yyvsp[0].vobj);</span>
<a href="#l10.1289"></a><span id="l10.1289" class="difflineminus">-        curObj = 0;</span>
<a href="#l10.1290"></a><span id="l10.1290" class="difflineminus">-      }</span>
<a href="#l10.1291"></a><span id="l10.1291" class="difflineminus">-      break;</span>
<a href="#l10.1292"></a><span id="l10.1292" class="difflineminus">-    case 7:</span>
<a href="#l10.1293"></a><span id="l10.1293" class="difflineminus">-      /*#line 294 &quot;vcc.y&quot;*/</span>
<a href="#l10.1294"></a><span id="l10.1294" class="difflineminus">-      {</span>
<a href="#l10.1295"></a><span id="l10.1295" class="difflineminus">-        lexPushMode(L_VCARD);</span>
<a href="#l10.1296"></a><span id="l10.1296" class="difflineminus">-        if (!pushVObject(VCCardProp)) YYERROR;</span>
<a href="#l10.1297"></a><span id="l10.1297" class="difflineminus">-      }</span>
<a href="#l10.1298"></a><span id="l10.1298" class="difflineminus">-      break;</span>
<a href="#l10.1299"></a><span id="l10.1299" class="difflineminus">-    case 8:</span>
<a href="#l10.1300"></a><span id="l10.1300" class="difflineminus">-      /*#line 299 &quot;vcc.y&quot;*/</span>
<a href="#l10.1301"></a><span id="l10.1301" class="difflineminus">-      {</span>
<a href="#l10.1302"></a><span id="l10.1302" class="difflineminus">-        lexPopMode(0);</span>
<a href="#l10.1303"></a><span id="l10.1303" class="difflineminus">-        yyval.vobj = popVObject();</span>
<a href="#l10.1304"></a><span id="l10.1304" class="difflineminus">-      }</span>
<a href="#l10.1305"></a><span id="l10.1305" class="difflineminus">-      break;</span>
<a href="#l10.1306"></a><span id="l10.1306" class="difflineminus">-    case 9:</span>
<a href="#l10.1307"></a><span id="l10.1307" class="difflineminus">-      /*#line 304 &quot;vcc.y&quot;*/</span>
<a href="#l10.1308"></a><span id="l10.1308" class="difflineminus">-      {</span>
<a href="#l10.1309"></a><span id="l10.1309" class="difflineminus">-        lexPushMode(L_VCARD);</span>
<a href="#l10.1310"></a><span id="l10.1310" class="difflineminus">-        if (!pushVObject(VCCardProp)) YYERROR;</span>
<a href="#l10.1311"></a><span id="l10.1311" class="difflineminus">-      }</span>
<a href="#l10.1312"></a><span id="l10.1312" class="difflineminus">-      break;</span>
<a href="#l10.1313"></a><span id="l10.1313" class="difflineminus">-    case 10:</span>
<a href="#l10.1314"></a><span id="l10.1314" class="difflineminus">-      /*#line 309 &quot;vcc.y&quot;*/</span>
<a href="#l10.1315"></a><span id="l10.1315" class="difflineminus">-      {</span>
<a href="#l10.1316"></a><span id="l10.1316" class="difflineminus">-        lexPopMode(0);</span>
<a href="#l10.1317"></a><span id="l10.1317" class="difflineminus">-        yyval.vobj = popVObject();</span>
<a href="#l10.1318"></a><span id="l10.1318" class="difflineminus">-      }</span>
<a href="#l10.1319"></a><span id="l10.1319" class="difflineminus">-      break;</span>
<a href="#l10.1320"></a><span id="l10.1320" class="difflineminus">-    case 13:</span>
<a href="#l10.1321"></a><span id="l10.1321" class="difflineminus">-      /*#line 320 &quot;vcc.y&quot;*/</span>
<a href="#l10.1322"></a><span id="l10.1322" class="difflineminus">-      { lexPushMode(L_VALUES); }</span>
<a href="#l10.1323"></a><span id="l10.1323" class="difflineminus">-      break;</span>
<a href="#l10.1324"></a><span id="l10.1324" class="difflineminus">-    case 14:</span>
<a href="#l10.1325"></a><span id="l10.1325" class="difflineminus">-      /*#line 324 &quot;vcc.y&quot;*/</span>
<a href="#l10.1326"></a><span id="l10.1326" class="difflineminus">-      {</span>
<a href="#l10.1327"></a><span id="l10.1327" class="difflineminus">-        if (lexWithinMode(L_BASE64) || lexWithinMode(L_QUOTED_PRINTABLE))</span>
<a href="#l10.1328"></a><span id="l10.1328" class="difflineminus">-          lexPopMode(0);</span>
<a href="#l10.1329"></a><span id="l10.1329" class="difflineminus">-        lexPopMode(0);</span>
<a href="#l10.1330"></a><span id="l10.1330" class="difflineminus">-      }</span>
<a href="#l10.1331"></a><span id="l10.1331" class="difflineminus">-      break;</span>
<a href="#l10.1332"></a><span id="l10.1332" class="difflineminus">-    case 16:</span>
<a href="#l10.1333"></a><span id="l10.1333" class="difflineminus">-      /*#line 332 &quot;vcc.y&quot;*/</span>
<a href="#l10.1334"></a><span id="l10.1334" class="difflineminus">-      { enterProps(yyvsp[0].str); }</span>
<a href="#l10.1335"></a><span id="l10.1335" class="difflineminus">-      break;</span>
<a href="#l10.1336"></a><span id="l10.1336" class="difflineminus">-    case 18:</span>
<a href="#l10.1337"></a><span id="l10.1337" class="difflineminus">-      /*#line 337 &quot;vcc.y&quot;*/</span>
<a href="#l10.1338"></a><span id="l10.1338" class="difflineminus">-      { enterProps(yyvsp[0].str); }</span>
<a href="#l10.1339"></a><span id="l10.1339" class="difflineminus">-      break;</span>
<a href="#l10.1340"></a><span id="l10.1340" class="difflineminus">-    case 22:</span>
<a href="#l10.1341"></a><span id="l10.1341" class="difflineminus">-      /*#line 350 &quot;vcc.y&quot;*/</span>
<a href="#l10.1342"></a><span id="l10.1342" class="difflineminus">-      { enterAttr(yyvsp[0].str, 0); }</span>
<a href="#l10.1343"></a><span id="l10.1343" class="difflineminus">-      break;</span>
<a href="#l10.1344"></a><span id="l10.1344" class="difflineminus">-    case 23:</span>
<a href="#l10.1345"></a><span id="l10.1345" class="difflineminus">-      /*#line 354 &quot;vcc.y&quot;*/</span>
<a href="#l10.1346"></a><span id="l10.1346" class="difflineminus">-      { enterAttr(yyvsp[-2].str, yyvsp[0].str); }</span>
<a href="#l10.1347"></a><span id="l10.1347" class="difflineminus">-      break;</span>
<a href="#l10.1348"></a><span id="l10.1348" class="difflineminus">-    case 25:</span>
<a href="#l10.1349"></a><span id="l10.1349" class="difflineminus">-      /*#line 363 &quot;vcc.y&quot;*/</span>
<a href="#l10.1350"></a><span id="l10.1350" class="difflineminus">-      { enterValues(yyvsp[-1].str); }</span>
<a href="#l10.1351"></a><span id="l10.1351" class="difflineminus">-      break;</span>
<a href="#l10.1352"></a><span id="l10.1352" class="difflineminus">-    case 27:</span>
<a href="#l10.1353"></a><span id="l10.1353" class="difflineminus">-      /*#line 365 &quot;vcc.y&quot;*/</span>
<a href="#l10.1354"></a><span id="l10.1354" class="difflineminus">-      { enterValues(yyvsp[0].str); }</span>
<a href="#l10.1355"></a><span id="l10.1355" class="difflineminus">-      break;</span>
<a href="#l10.1356"></a><span id="l10.1356" class="difflineminus">-    case 29:</span>
<a href="#l10.1357"></a><span id="l10.1357" class="difflineminus">-      /*#line 370 &quot;vcc.y&quot;*/</span>
<a href="#l10.1358"></a><span id="l10.1358" class="difflineminus">-      { yyval.str = 0; }</span>
<a href="#l10.1359"></a><span id="l10.1359" class="difflineminus">-      break;</span>
<a href="#l10.1360"></a><span id="l10.1360" class="difflineminus">-    case 30:</span>
<a href="#l10.1361"></a><span id="l10.1361" class="difflineminus">-      /*#line 375 &quot;vcc.y&quot;*/</span>
<a href="#l10.1362"></a><span id="l10.1362" class="difflineminus">-      {</span>
<a href="#l10.1363"></a><span id="l10.1363" class="difflineminus">-        if (!pushVObject(VCCalProp)) YYERROR;</span>
<a href="#l10.1364"></a><span id="l10.1364" class="difflineminus">-      }</span>
<a href="#l10.1365"></a><span id="l10.1365" class="difflineminus">-      break;</span>
<a href="#l10.1366"></a><span id="l10.1366" class="difflineminus">-    case 31:</span>
<a href="#l10.1367"></a><span id="l10.1367" class="difflineminus">-      /*#line 378 &quot;vcc.y&quot;*/</span>
<a href="#l10.1368"></a><span id="l10.1368" class="difflineminus">-      { yyval.vobj = popVObject(); }</span>
<a href="#l10.1369"></a><span id="l10.1369" class="difflineminus">-      break;</span>
<a href="#l10.1370"></a><span id="l10.1370" class="difflineminus">-    case 32:</span>
<a href="#l10.1371"></a><span id="l10.1371" class="difflineminus">-      /*#line 380 &quot;vcc.y&quot;*/</span>
<a href="#l10.1372"></a><span id="l10.1372" class="difflineminus">-      {</span>
<a href="#l10.1373"></a><span id="l10.1373" class="difflineminus">-        if (!pushVObject(VCCalProp)) YYERROR;</span>
<a href="#l10.1374"></a><span id="l10.1374" class="difflineminus">-      }</span>
<a href="#l10.1375"></a><span id="l10.1375" class="difflineminus">-      break;</span>
<a href="#l10.1376"></a><span id="l10.1376" class="difflineminus">-    case 33:</span>
<a href="#l10.1377"></a><span id="l10.1377" class="difflineminus">-      /*#line 382 &quot;vcc.y&quot;*/</span>
<a href="#l10.1378"></a><span id="l10.1378" class="difflineminus">-      { yyval.vobj = popVObject(); }</span>
<a href="#l10.1379"></a><span id="l10.1379" class="difflineminus">-      break;</span>
<a href="#l10.1380"></a><span id="l10.1380" class="difflineminus">-    case 39:</span>
<a href="#l10.1381"></a><span id="l10.1381" class="difflineminus">-      /*#line 397 &quot;vcc.y&quot;*/</span>
<a href="#l10.1382"></a><span id="l10.1382" class="difflineminus">-      {</span>
<a href="#l10.1383"></a><span id="l10.1383" class="difflineminus">-        lexPushMode(L_VEVENT);</span>
<a href="#l10.1384"></a><span id="l10.1384" class="difflineminus">-        if (!pushVObject(VCEventProp)) YYERROR;</span>
<a href="#l10.1385"></a><span id="l10.1385" class="difflineminus">-      }</span>
<a href="#l10.1386"></a><span id="l10.1386" class="difflineminus">-      break;</span>
<a href="#l10.1387"></a><span id="l10.1387" class="difflineminus">-    case 40:</span>
<a href="#l10.1388"></a><span id="l10.1388" class="difflineminus">-      /*#line 403 &quot;vcc.y&quot;*/</span>
<a href="#l10.1389"></a><span id="l10.1389" class="difflineminus">-      {</span>
<a href="#l10.1390"></a><span id="l10.1390" class="difflineminus">-        lexPopMode(0);</span>
<a href="#l10.1391"></a><span id="l10.1391" class="difflineminus">-        popVObject();</span>
<a href="#l10.1392"></a><span id="l10.1392" class="difflineminus">-      }</span>
<a href="#l10.1393"></a><span id="l10.1393" class="difflineminus">-      break;</span>
<a href="#l10.1394"></a><span id="l10.1394" class="difflineminus">-    case 41:</span>
<a href="#l10.1395"></a><span id="l10.1395" class="difflineminus">-      /*#line 408 &quot;vcc.y&quot;*/</span>
<a href="#l10.1396"></a><span id="l10.1396" class="difflineminus">-      {</span>
<a href="#l10.1397"></a><span id="l10.1397" class="difflineminus">-        lexPushMode(L_VEVENT);</span>
<a href="#l10.1398"></a><span id="l10.1398" class="difflineminus">-        if (!pushVObject(VCEventProp)) YYERROR;</span>
<a href="#l10.1399"></a><span id="l10.1399" class="difflineminus">-      }</span>
<a href="#l10.1400"></a><span id="l10.1400" class="difflineminus">-      break;</span>
<a href="#l10.1401"></a><span id="l10.1401" class="difflineminus">-    case 42:</span>
<a href="#l10.1402"></a><span id="l10.1402" class="difflineminus">-      /*#line 413 &quot;vcc.y&quot;*/</span>
<a href="#l10.1403"></a><span id="l10.1403" class="difflineminus">-      {</span>
<a href="#l10.1404"></a><span id="l10.1404" class="difflineminus">-        lexPopMode(0);</span>
<a href="#l10.1405"></a><span id="l10.1405" class="difflineminus">-        popVObject();</span>
<a href="#l10.1406"></a><span id="l10.1406" class="difflineminus">-      }</span>
<a href="#l10.1407"></a><span id="l10.1407" class="difflineminus">-      break;</span>
<a href="#l10.1408"></a><span id="l10.1408" class="difflineminus">-    case 43:</span>
<a href="#l10.1409"></a><span id="l10.1409" class="difflineminus">-      /*#line 421 &quot;vcc.y&quot;*/</span>
<a href="#l10.1410"></a><span id="l10.1410" class="difflineminus">-      {</span>
<a href="#l10.1411"></a><span id="l10.1411" class="difflineminus">-        lexPushMode(L_VTODO);</span>
<a href="#l10.1412"></a><span id="l10.1412" class="difflineminus">-        if (!pushVObject(VCTodoProp)) YYERROR;</span>
<a href="#l10.1413"></a><span id="l10.1413" class="difflineminus">-      }</span>
<a href="#l10.1414"></a><span id="l10.1414" class="difflineminus">-      break;</span>
<a href="#l10.1415"></a><span id="l10.1415" class="difflineminus">-    case 44:</span>
<a href="#l10.1416"></a><span id="l10.1416" class="difflineminus">-      /*#line 427 &quot;vcc.y&quot;*/</span>
<a href="#l10.1417"></a><span id="l10.1417" class="difflineminus">-      {</span>
<a href="#l10.1418"></a><span id="l10.1418" class="difflineminus">-        lexPopMode(0);</span>
<a href="#l10.1419"></a><span id="l10.1419" class="difflineminus">-        popVObject();</span>
<a href="#l10.1420"></a><span id="l10.1420" class="difflineminus">-      }</span>
<a href="#l10.1421"></a><span id="l10.1421" class="difflineminus">-      break;</span>
<a href="#l10.1422"></a><span id="l10.1422" class="difflineminus">-    case 45:</span>
<a href="#l10.1423"></a><span id="l10.1423" class="difflineminus">-      /*#line 432 &quot;vcc.y&quot;*/</span>
<a href="#l10.1424"></a><span id="l10.1424" class="difflineminus">-      {</span>
<a href="#l10.1425"></a><span id="l10.1425" class="difflineminus">-        lexPushMode(L_VTODO);</span>
<a href="#l10.1426"></a><span id="l10.1426" class="difflineminus">-        if (!pushVObject(VCTodoProp)) YYERROR;</span>
<a href="#l10.1427"></a><span id="l10.1427" class="difflineminus">-      }</span>
<a href="#l10.1428"></a><span id="l10.1428" class="difflineminus">-      break;</span>
<a href="#l10.1429"></a><span id="l10.1429" class="difflineminus">-    case 46:</span>
<a href="#l10.1430"></a><span id="l10.1430" class="difflineminus">-      /*#line 437 &quot;vcc.y&quot;*/</span>
<a href="#l10.1431"></a><span id="l10.1431" class="difflineminus">-      {</span>
<a href="#l10.1432"></a><span id="l10.1432" class="difflineminus">-        lexPopMode(0);</span>
<a href="#l10.1433"></a><span id="l10.1433" class="difflineminus">-        popVObject();</span>
<a href="#l10.1434"></a><span id="l10.1434" class="difflineminus">-      }</span>
<a href="#l10.1435"></a><span id="l10.1435" class="difflineminus">-      break;</span>
<a href="#l10.1436"></a><span id="l10.1436" class="difflineminus">-      /*#line 1520 &quot;y_tab.c&quot;*/</span>
<a href="#l10.1437"></a><span id="l10.1437" class="difflineminus">-  }</span>
<a href="#l10.1438"></a><span id="l10.1438" class="difflineminus">-  yyssp -= yym;</span>
<a href="#l10.1439"></a><span id="l10.1439" class="difflineminus">-  yystate = *yyssp;</span>
<a href="#l10.1440"></a><span id="l10.1440" class="difflineminus">-  yyvsp -= yym;</span>
<a href="#l10.1441"></a><span id="l10.1441" class="difflineminus">-  yym = yylhs[yyn];</span>
<a href="#l10.1442"></a><span id="l10.1442" class="difflineminus">-  if (yystate == 0 &amp;&amp; yym == 0) {</span>
<a href="#l10.1443"></a><span id="l10.1443" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1444"></a><span id="l10.1444" class="difflineminus">-    if (yydebug)</span>
<a href="#l10.1445"></a><span id="l10.1445" class="difflineminus">-      printf(&quot;yydebug: after reduction, shifting from state 0 to state %d\n&quot;,</span>
<a href="#l10.1446"></a><span id="l10.1446" class="difflineminus">-             YYFINAL);</span>
<a href="#l10.1447"></a><span id="l10.1447" class="difflineminus">-#endif</span>
<a href="#l10.1448"></a><span id="l10.1448" class="difflineminus">-    yystate = YYFINAL;</span>
<a href="#l10.1449"></a><span id="l10.1449" class="difflineminus">-    *++yyssp = YYFINAL;</span>
<a href="#l10.1450"></a><span id="l10.1450" class="difflineminus">-    *++yyvsp = yyval;</span>
<a href="#l10.1451"></a><span id="l10.1451" class="difflineminus">-    if (yychar &lt; 0) {</span>
<a href="#l10.1452"></a><span id="l10.1452" class="difflineminus">-      if ((yychar = yylex()) &lt; 0) yychar = 0;</span>
<a href="#l10.1453"></a><span id="l10.1453" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1454"></a><span id="l10.1454" class="difflineminus">-      if (yydebug) {</span>
<a href="#l10.1455"></a><span id="l10.1455" class="difflineminus">-        yys = 0;</span>
<a href="#l10.1456"></a><span id="l10.1456" class="difflineminus">-        if (yychar &lt;= YYPR_MAXTOKEN) yys = yyname[yychar];</span>
<a href="#l10.1457"></a><span id="l10.1457" class="difflineminus">-        if (!yys) yys = &quot;illegal-symbol&quot;;</span>
<a href="#l10.1458"></a><span id="l10.1458" class="difflineminus">-        printf(&quot;yydebug: state %d, reading %d (%s)\n&quot;, YYFINAL, yychar, yys);</span>
<a href="#l10.1459"></a><span id="l10.1459" class="difflineminus">-      }</span>
<a href="#l10.1460"></a><span id="l10.1460" class="difflineminus">-#endif</span>
<a href="#l10.1461"></a><span id="l10.1461" class="difflineminus">-    }</span>
<a href="#l10.1462"></a><span id="l10.1462" class="difflineminus">-    if (yychar == 0) goto yyaccept;</span>
<a href="#l10.1463"></a><span id="l10.1463" class="difflineminus">-    goto yyloop;</span>
<a href="#l10.1464"></a><span id="l10.1464" class="difflineminus">-  }</span>
<a href="#l10.1465"></a><span id="l10.1465" class="difflineminus">-  if ((yyn = yygindex[yym]) &amp;&amp; (yyn += yystate) &gt;= 0 &amp;&amp; yyn &lt;= YYTABLESIZE &amp;&amp;</span>
<a href="#l10.1466"></a><span id="l10.1466" class="difflineminus">-      yycheck[yyn] == yystate)</span>
<a href="#l10.1467"></a><span id="l10.1467" class="difflineminus">-    yystate = yytable[yyn];</span>
<a href="#l10.1468"></a><span id="l10.1468" class="difflineminus">-  else</span>
<a href="#l10.1469"></a><span id="l10.1469" class="difflineminus">-    yystate = yydgoto[yym];</span>
<a href="#l10.1470"></a><span id="l10.1470" class="difflineminus">-#if YYDEBUG</span>
<a href="#l10.1471"></a><span id="l10.1471" class="difflineminus">-  if (yydebug)</span>
<a href="#l10.1472"></a><span id="l10.1472" class="difflineminus">-    printf(&quot;yydebug: after reduction, shifting from state %d to state %d\n&quot;,</span>
<a href="#l10.1473"></a><span id="l10.1473" class="difflineminus">-           *yyssp, yystate);</span>
<a href="#l10.1474"></a><span id="l10.1474" class="difflineminus">-#endif</span>
<a href="#l10.1475"></a><span id="l10.1475" class="difflineminus">-  if (yyssp &gt;= yyss + yystacksize - 1) {</span>
<a href="#l10.1476"></a><span id="l10.1476" class="difflineminus">-    goto yyoverflow;</span>
<a href="#l10.1477"></a><span id="l10.1477" class="difflineminus">-  }</span>
<a href="#l10.1478"></a><span id="l10.1478" class="difflineminus">-  *++yyssp = yystate;</span>
<a href="#l10.1479"></a><span id="l10.1479" class="difflineminus">-  *++yyvsp = yyval;</span>
<a href="#l10.1480"></a><span id="l10.1480" class="difflineminus">-  goto yyloop;</span>
<a href="#l10.1481"></a><span id="l10.1481" class="difflineminus">-yyoverflow:</span>
<a href="#l10.1482"></a><span id="l10.1482" class="difflineminus">-  yyerror(&quot;yacc stack overflow&quot;);</span>
<a href="#l10.1483"></a><span id="l10.1483" class="difflineminus">-yyabort:</span>
<a href="#l10.1484"></a><span id="l10.1484" class="difflineminus">-  return (1);</span>
<a href="#l10.1485"></a><span id="l10.1485" class="difflineminus">-yyaccept:</span>
<a href="#l10.1486"></a><span id="l10.1486" class="difflineminus">-  return (0);</span>
<a href="#l10.1487"></a><span id="l10.1487" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">deleted file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- a/mailnews/addrbook/src/nsVCard.h</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ /dev/null</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -1,63 +0,0 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineminus">-/* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineminus">-</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-/***************************************************************************</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">-(C) Copyright 1996 Apple Computer, Inc., AT&amp;T Corp., International</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-Business Machines Corporation and Siemens Rolm Communications Inc.</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-For purposes of this license notice, the term Licensors shall mean,</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-collectively, Apple Computer, Inc., AT&amp;T Corp., International</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-Business Machines Corporation and Siemens Rolm Communications Inc.</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-The term Licensor shall mean any of the Licensors.</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-Subject to acceptance of the following conditions, permission is hereby</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-granted by Licensors without the need for written agreement and without</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-license or royalty fees, to use, copy, modify and distribute this</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-software for any purpose.</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-The above copyright notice and the following four paragraphs must be</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">-reproduced in all copies of this software and any software including</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-this software.</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">-THIS SOFTWARE IS PROVIDED ON AN &quot;AS IS&quot; BASIS AND NO LICENSOR SHALL HAVE</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineminus">-ANY OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS OR</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-MODIFICATIONS.</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-IN NO EVENT SHALL ANY LICENSOR BE LIABLE TO ANY PARTY FOR DIRECT,</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES OR LOST PROFITS ARISING OUT</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-OF THE USE OF THIS SOFTWARE EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-DAMAGE.</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">-EACH LICENSOR SPECIFICALLY DISCLAIMS ANY WARRANTIES, EXPRESS OR IMPLIED,</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-INCLUDING BUT NOT LIMITED TO ANY WARRANTY OF NONINFRINGEMENT OR THE</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">-IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineminus">-PURPOSE.</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">-</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-The software is provided with RESTRICTED RIGHTS.  Use, duplication, or</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-disclosure by the government are subject to restrictions set forth in</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-DFARS 252.227-7013 or 48 CFR 52.227-19, as applicable.</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-***************************************************************************/</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineminus">-#ifndef __VCC_H__</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-#define __VCC_H__ 1</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-#include &quot;nsVCardObj.h&quot;</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-extern &quot;C&quot; {</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-#endif</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-VObject *parse_MIME(const char *input, unsigned long len);</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-typedef void (*MimeErrorHandler)(char *);</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineminus">-void registerMimeErrorHandler(MimeErrorHandler);</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineminus">-</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-}</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-#endif</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-#endif /* __VCC_H__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">deleted file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- a/mailnews/addrbook/src/nsVCardObj.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ /dev/null</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -1,1179 +0,0 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineminus">-</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">-/***************************************************************************</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">-(C) Copyright 1996 Apple Computer, Inc., AT&amp;T Corp., International</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-Business Machines Corporation and Siemens Rolm Communications Inc.</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-For purposes of this license notice, the term Licensors shall mean,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-collectively, Apple Computer, Inc., AT&amp;T Corp., International</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-Business Machines Corporation and Siemens Rolm Communications Inc.</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-The term Licensor shall mean any of the Licensors.</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-Subject to acceptance of the following conditions, permission is hereby</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-granted by Licensors without the need for written agreement and without</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">-license or royalty fees, to use, copy, modify and distribute this</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-software for any purpose.</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-The above copyright notice and the following four paragraphs must be</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-reproduced in all copies of this software and any software including</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-this software.</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-THIS SOFTWARE IS PROVIDED ON AN &quot;AS IS&quot; BASIS AND NO LICENSOR SHALL HAVE</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-ANY OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS OR</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-MODIFICATIONS.</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-IN NO EVENT SHALL ANY LICENSOR BE LIABLE TO ANY PARTY FOR DIRECT,</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES OR LOST PROFITS ARISING OUT</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-OF THE USE OF THIS SOFTWARE EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-DAMAGE.</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-EACH LICENSOR SPECIFICALLY DISCLAIMS ANY WARRANTIES, EXPRESS OR IMPLIED,</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-INCLUDING BUT NOT LIMITED TO ANY WARRANTY OF NONINFRINGEMENT OR THE</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-PURPOSE.</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-The software is provided with RESTRICTED RIGHTS.  Use, duplication, or</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-disclosure by the government are subject to restrictions set forth in</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-DFARS 252.227-7013 or 48 CFR 52.227-19, as applicable.</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-***************************************************************************/</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-/*</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">- * doc: vobject and APIs to construct vobject, APIs pretty print</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">- * vobject, and convert a vobject into its textual representation.</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">- */</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-#include &quot;prlog.h&quot;</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-#include &quot;nsVCard.h&quot;</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-#include &quot;nsVCardObj.h&quot;</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-#include &quot;prmem.h&quot;</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-#include &quot;plstr.h&quot;</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineminus">-#include &quot;prprf.h&quot;</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-/* debugging utilities */</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-#define DBG_(x)</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineminus">-</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-extern &quot;C&quot; {</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-#endif</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-char **fieldedProp;</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-}</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-#endif</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-static VObject *newVObject_(const char *id);</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-#if 0</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-static int vObjectValueType(VObject *o);</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-static void initVObjectIterator(VObjectIterator *i, VObject *o);</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-#endif</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-/*----------------------------------------------------------------------</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-  The following functions involve with memory allocation:</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-  newVObject</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-  deleteVObject</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-  dupStr</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-  deleteString</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-  newStrItem</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-  deleteStrItem</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-  ----------------------------------------------------------------------*/</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineminus">-</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineminus">-static bool needsQuotedPrintable(const char *s) {</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-  const unsigned char *p = (const unsigned char *)s;</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-  while (*p) {</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-    if (*p &amp; 0x80 || *p == '\015' || *p == '\012') return true;</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-    p++;</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineminus">-  }</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-  return false;</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-}</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineminus">-</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineminus">-VObject *newVObject_(const char *id) {</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-  VObject *p = (VObject *)new (VObject);</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-  p-&gt;next = 0;</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-  p-&gt;id = id;</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineminus">-  p-&gt;prop = 0;</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineminus">-  VALUE_TYPE(p) = 0;</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-  ANY_VALUE_OF(p) = 0;</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-  return p;</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-}</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineminus">-VObject *newVObject(const char *id) { return newVObject_(lookupStr(id)); }</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineminus">-</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineminus">-void deleteVObject(VObject *p) {</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineminus">-  unUseStr(p-&gt;id);</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineminus">-  delete (p);</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineminus">-}</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineminus">-</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineminus">-char *dupStr(const char *s, unsigned int size) {</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineminus">-  char *t;</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineminus">-  if (size == 0) {</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineminus">-    size = PL_strlen(s);</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineminus">-  }</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineminus">-  t = (char *)PR_CALLOC(size + 1);</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineminus">-  if (t) {</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineminus">-    memcpy(t, s, size);</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineminus">-    t[size] = 0;</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineminus">-    return t;</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineminus">-  } else {</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineminus">-    return (char *)0;</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineminus">-  }</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineminus">-}</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineminus">-</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineminus">-static StrItem *newStrItem(const char *s, StrItem *next) {</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineminus">-  StrItem *p = (StrItem *)PR_CALLOC(sizeof(StrItem));</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineminus">-  p-&gt;next = next;</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineminus">-  p-&gt;s = s;</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineminus">-  p-&gt;refCnt = 1;</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineminus">-  return p;</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineminus">-}</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineminus">-</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineminus">-extern &quot;C&quot; void deleteString(char *p) {</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineminus">-  if (p) PR_Free((void *)p);</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineminus">-}</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineminus">-</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineminus">-extern &quot;C&quot; void deleteStrItem(StrItem *p) {</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineminus">-  if (p) PR_FREEIF(p);</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineminus">-}</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineminus">-</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineminus">-/*----------------------------------------------------------------------</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineminus">-  The following function provide accesses to VObject's value.</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineminus">-  ----------------------------------------------------------------------*/</span>
<a href="#l12.152"></a><span id="l12.152" class="difflineminus">-</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineminus">-const char *vObjectName(VObject *o) { return NAME_OF(o); }</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineminus">-</span>
<a href="#l12.155"></a><span id="l12.155" class="difflineminus">-void setVObjectName(VObject *o, const char *id) { NAME_OF(o) = id; }</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineminus">-</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineminus">-const char *vObjectStringZValue(VObject *o) { return STRINGZ_VALUE_OF(o); }</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineminus">-void setVObjectStringZValue(VObject *o, const char *s) {</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineminus">-  STRINGZ_VALUE_OF(o) = dupStr(s, 0);</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineminus">-  VALUE_TYPE(o) = VCVT_STRINGZ;</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineminus">-}</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineminus">-</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineminus">-void setVObjectStringZValue_(VObject *o, const char *s) {</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineminus">-  STRINGZ_VALUE_OF(o) = s;</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineminus">-  VALUE_TYPE(o) = VCVT_STRINGZ;</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineminus">-}</span>
<a href="#l12.168"></a><span id="l12.168" class="difflineminus">-</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineminus">-const vwchar_t *vObjectUStringZValue(VObject *o) {</span>
<a href="#l12.170"></a><span id="l12.170" class="difflineminus">-  return USTRINGZ_VALUE_OF(o);</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineminus">-}</span>
<a href="#l12.172"></a><span id="l12.172" class="difflineminus">-</span>
<a href="#l12.173"></a><span id="l12.173" class="difflineminus">-void setVObjectUStringZValue(VObject *o, const vwchar_t *s) {</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineminus">-  USTRINGZ_VALUE_OF(o) = (vwchar_t *)dupStr((char *)s, (uStrLen(s) + 1) * 2);</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineminus">-  VALUE_TYPE(o) = VCVT_USTRINGZ;</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineminus">-}</span>
<a href="#l12.177"></a><span id="l12.177" class="difflineminus">-</span>
<a href="#l12.178"></a><span id="l12.178" class="difflineminus">-void setVObjectUStringZValue_(VObject *o, const vwchar_t *s) {</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineminus">-  USTRINGZ_VALUE_OF(o) = s;</span>
<a href="#l12.180"></a><span id="l12.180" class="difflineminus">-  VALUE_TYPE(o) = VCVT_USTRINGZ;</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineminus">-}</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineminus">-</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineminus">-unsigned int vObjectIntegerValue(VObject *o) { return INTEGER_VALUE_OF(o); }</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineminus">-</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineminus">-void setVObjectIntegerValue(VObject *o, unsigned int i) {</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineminus">-  INTEGER_VALUE_OF(o) = i;</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineminus">-  VALUE_TYPE(o) = VCVT_UINT;</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineminus">-}</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineminus">-</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineminus">-unsigned long vObjectLongValue(VObject *o) { return LONG_VALUE_OF(o); }</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineminus">-</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineminus">-void setVObjectLongValue(VObject *o, unsigned long l) {</span>
<a href="#l12.193"></a><span id="l12.193" class="difflineminus">-  LONG_VALUE_OF(o) = l;</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineminus">-  VALUE_TYPE(o) = VCVT_ULONG;</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineminus">-}</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineminus">-</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineminus">-void *vObjectAnyValue(VObject *o) { return ANY_VALUE_OF(o); }</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineminus">-</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineminus">-void setVObjectAnyValue(VObject *o, void *t) {</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineminus">-  ANY_VALUE_OF(o) = t;</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineminus">-  VALUE_TYPE(o) = VCVT_RAW;</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineminus">-}</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineminus">-</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineminus">-VObject *vObjectVObjectValue(VObject *o) { return VOBJECT_VALUE_OF(o); }</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineminus">-</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineminus">-void setVObjectVObjectValue(VObject *o, VObject *p) {</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineminus">-  VOBJECT_VALUE_OF(o) = p;</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineminus">-  VALUE_TYPE(o) = VCVT_VOBJECT;</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineminus">-}</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineminus">-</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineminus">-#if 0</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineminus">-int vObjectValueType(VObject *o)</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineminus">-{</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineminus">-  return VALUE_TYPE(o);</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineminus">-}</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineminus">-#endif</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineminus">-</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineminus">-/*----------------------------------------------------------------------</span>
<a href="#l12.219"></a><span id="l12.219" class="difflineminus">-  The following functions can be used to build VObject.</span>
<a href="#l12.220"></a><span id="l12.220" class="difflineminus">-  ----------------------------------------------------------------------*/</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineminus">-</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineminus">-VObject *addVObjectProp(VObject *o, VObject *p) {</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineminus">-  /* circular link list pointed to tail */</span>
<a href="#l12.224"></a><span id="l12.224" class="difflineminus">-  /*</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineminus">-  o {next,id,prop,val}</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineminus">-             V</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineminus">-  pn {next,id,prop,val}</span>
<a href="#l12.228"></a><span id="l12.228" class="difflineminus">-             V</span>
<a href="#l12.229"></a><span id="l12.229" class="difflineminus">-  ...</span>
<a href="#l12.230"></a><span id="l12.230" class="difflineminus">-  p1 {next,id,prop,val}</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineminus">-             V</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineminus">-  pn</span>
<a href="#l12.233"></a><span id="l12.233" class="difflineminus">-  --&gt;</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineminus">-  o {next,id,prop,val}</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineminus">-             V</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineminus">-  pn {next,id,prop,val}</span>
<a href="#l12.237"></a><span id="l12.237" class="difflineminus">-             V</span>
<a href="#l12.238"></a><span id="l12.238" class="difflineminus">-  p {next,id,prop,val}</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineminus">-  ...</span>
<a href="#l12.240"></a><span id="l12.240" class="difflineminus">-  p1 {next,id,prop,val}</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineminus">-             V</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineminus">-  pn</span>
<a href="#l12.243"></a><span id="l12.243" class="difflineminus">-  */</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineminus">-</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineminus">-  VObject *tail = o-&gt;prop;</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineminus">-  if (tail) {</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineminus">-    p-&gt;next = tail-&gt;next;</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineminus">-    o-&gt;prop = tail-&gt;next = p;</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineminus">-  } else {</span>
<a href="#l12.250"></a><span id="l12.250" class="difflineminus">-    o-&gt;prop = p-&gt;next = p;</span>
<a href="#l12.251"></a><span id="l12.251" class="difflineminus">-  }</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineminus">-  return p;</span>
<a href="#l12.253"></a><span id="l12.253" class="difflineminus">-}</span>
<a href="#l12.254"></a><span id="l12.254" class="difflineminus">-</span>
<a href="#l12.255"></a><span id="l12.255" class="difflineminus">-VObject *addProp(VObject *o, const char *id) {</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineminus">-  return addVObjectProp(o, newVObject(id));</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineminus">-}</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineminus">-</span>
<a href="#l12.259"></a><span id="l12.259" class="difflineminus">-VObject *addProp_(VObject *o, const char *id) {</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineminus">-  return addVObjectProp(o, newVObject_(id));</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineminus">-}</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineminus">-</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineminus">-void addList(VObject **o, VObject *p) {</span>
<a href="#l12.264"></a><span id="l12.264" class="difflineminus">-  p-&gt;next = 0;</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineminus">-  if (*o == 0) {</span>
<a href="#l12.266"></a><span id="l12.266" class="difflineminus">-    *o = p;</span>
<a href="#l12.267"></a><span id="l12.267" class="difflineminus">-  } else {</span>
<a href="#l12.268"></a><span id="l12.268" class="difflineminus">-    VObject *t = *o;</span>
<a href="#l12.269"></a><span id="l12.269" class="difflineminus">-    while (t-&gt;next) {</span>
<a href="#l12.270"></a><span id="l12.270" class="difflineminus">-      t = t-&gt;next;</span>
<a href="#l12.271"></a><span id="l12.271" class="difflineminus">-    }</span>
<a href="#l12.272"></a><span id="l12.272" class="difflineminus">-    t-&gt;next = p;</span>
<a href="#l12.273"></a><span id="l12.273" class="difflineminus">-  }</span>
<a href="#l12.274"></a><span id="l12.274" class="difflineminus">-}</span>
<a href="#l12.275"></a><span id="l12.275" class="difflineminus">-</span>
<a href="#l12.276"></a><span id="l12.276" class="difflineminus">-VObject *nextVObjectInList(VObject *o) { return o-&gt;next; }</span>
<a href="#l12.277"></a><span id="l12.277" class="difflineminus">-</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineminus">-VObject *setValueWithSize_(VObject *prop, void *val, unsigned int size) {</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineminus">-  VObject *sizeProp;</span>
<a href="#l12.280"></a><span id="l12.280" class="difflineminus">-  setVObjectAnyValue(prop, val);</span>
<a href="#l12.281"></a><span id="l12.281" class="difflineminus">-  sizeProp = addProp(prop, VCDataSizeProp);</span>
<a href="#l12.282"></a><span id="l12.282" class="difflineminus">-  setVObjectLongValue(sizeProp, size);</span>
<a href="#l12.283"></a><span id="l12.283" class="difflineminus">-  return prop;</span>
<a href="#l12.284"></a><span id="l12.284" class="difflineminus">-}</span>
<a href="#l12.285"></a><span id="l12.285" class="difflineminus">-</span>
<a href="#l12.286"></a><span id="l12.286" class="difflineminus">-VObject *setValueWithSize(VObject *prop, void *val, unsigned int size) {</span>
<a href="#l12.287"></a><span id="l12.287" class="difflineminus">-  void *p = dupStr((const char *)val, size);</span>
<a href="#l12.288"></a><span id="l12.288" class="difflineminus">-  return setValueWithSize_(prop, p, p ? size : 0);</span>
<a href="#l12.289"></a><span id="l12.289" class="difflineminus">-}</span>
<a href="#l12.290"></a><span id="l12.290" class="difflineminus">-</span>
<a href="#l12.291"></a><span id="l12.291" class="difflineminus">-void initPropIterator(VObjectIterator *i, VObject *o) {</span>
<a href="#l12.292"></a><span id="l12.292" class="difflineminus">-  i-&gt;start = o-&gt;prop;</span>
<a href="#l12.293"></a><span id="l12.293" class="difflineminus">-  i-&gt;next = 0;</span>
<a href="#l12.294"></a><span id="l12.294" class="difflineminus">-}</span>
<a href="#l12.295"></a><span id="l12.295" class="difflineminus">-</span>
<a href="#l12.296"></a><span id="l12.296" class="difflineminus">-#if 0</span>
<a href="#l12.297"></a><span id="l12.297" class="difflineminus">-void initVObjectIterator(VObjectIterator *i, VObject *o)</span>
<a href="#l12.298"></a><span id="l12.298" class="difflineminus">-{</span>
<a href="#l12.299"></a><span id="l12.299" class="difflineminus">-  i-&gt;start = o-&gt;next;</span>
<a href="#l12.300"></a><span id="l12.300" class="difflineminus">-  i-&gt;next = 0;</span>
<a href="#l12.301"></a><span id="l12.301" class="difflineminus">-}</span>
<a href="#l12.302"></a><span id="l12.302" class="difflineminus">-#endif</span>
<a href="#l12.303"></a><span id="l12.303" class="difflineminus">-</span>
<a href="#l12.304"></a><span id="l12.304" class="difflineminus">-int moreIteration(VObjectIterator *i) {</span>
<a href="#l12.305"></a><span id="l12.305" class="difflineminus">-  return (i-&gt;start &amp;&amp; (i-&gt;next == 0 || i-&gt;next != i-&gt;start));</span>
<a href="#l12.306"></a><span id="l12.306" class="difflineminus">-}</span>
<a href="#l12.307"></a><span id="l12.307" class="difflineminus">-</span>
<a href="#l12.308"></a><span id="l12.308" class="difflineminus">-VObject *nextVObject(VObjectIterator *i) {</span>
<a href="#l12.309"></a><span id="l12.309" class="difflineminus">-  if (i-&gt;start &amp;&amp; i-&gt;next != i-&gt;start) {</span>
<a href="#l12.310"></a><span id="l12.310" class="difflineminus">-    if (i-&gt;next == 0) {</span>
<a href="#l12.311"></a><span id="l12.311" class="difflineminus">-      i-&gt;next = i-&gt;start-&gt;next;</span>
<a href="#l12.312"></a><span id="l12.312" class="difflineminus">-      return i-&gt;next;</span>
<a href="#l12.313"></a><span id="l12.313" class="difflineminus">-    } else {</span>
<a href="#l12.314"></a><span id="l12.314" class="difflineminus">-      i-&gt;next = i-&gt;next-&gt;next;</span>
<a href="#l12.315"></a><span id="l12.315" class="difflineminus">-      return i-&gt;next;</span>
<a href="#l12.316"></a><span id="l12.316" class="difflineminus">-    }</span>
<a href="#l12.317"></a><span id="l12.317" class="difflineminus">-  } else</span>
<a href="#l12.318"></a><span id="l12.318" class="difflineminus">-    return (VObject *)0;</span>
<a href="#l12.319"></a><span id="l12.319" class="difflineminus">-}</span>
<a href="#l12.320"></a><span id="l12.320" class="difflineminus">-</span>
<a href="#l12.321"></a><span id="l12.321" class="difflineminus">-VObject *isAPropertyOf(VObject *o, const char *id) {</span>
<a href="#l12.322"></a><span id="l12.322" class="difflineminus">-  VObjectIterator i;</span>
<a href="#l12.323"></a><span id="l12.323" class="difflineminus">-  initPropIterator(&amp;i, o);</span>
<a href="#l12.324"></a><span id="l12.324" class="difflineminus">-  while (moreIteration(&amp;i)) {</span>
<a href="#l12.325"></a><span id="l12.325" class="difflineminus">-    VObject *each = nextVObject(&amp;i);</span>
<a href="#l12.326"></a><span id="l12.326" class="difflineminus">-    if (!PL_strcasecmp(id, each-&gt;id)) return each;</span>
<a href="#l12.327"></a><span id="l12.327" class="difflineminus">-  }</span>
<a href="#l12.328"></a><span id="l12.328" class="difflineminus">-  return (VObject *)0;</span>
<a href="#l12.329"></a><span id="l12.329" class="difflineminus">-}</span>
<a href="#l12.330"></a><span id="l12.330" class="difflineminus">-</span>
<a href="#l12.331"></a><span id="l12.331" class="difflineminus">-VObject *addGroup(VObject *o, const char *g) {</span>
<a href="#l12.332"></a><span id="l12.332" class="difflineminus">-  /*</span>
<a href="#l12.333"></a><span id="l12.333" class="difflineminus">-  a.b.c</span>
<a href="#l12.334"></a><span id="l12.334" class="difflineminus">-  --&gt;</span>
<a href="#l12.335"></a><span id="l12.335" class="difflineminus">-  prop(c)</span>
<a href="#l12.336"></a><span id="l12.336" class="difflineminus">-  prop(VCGrouping=b)</span>
<a href="#l12.337"></a><span id="l12.337" class="difflineminus">-  prop(VCGrouping=a)</span>
<a href="#l12.338"></a><span id="l12.338" class="difflineminus">-  */</span>
<a href="#l12.339"></a><span id="l12.339" class="difflineminus">-  char *dot = PL_strrchr(g, '.');</span>
<a href="#l12.340"></a><span id="l12.340" class="difflineminus">-  if (dot) {</span>
<a href="#l12.341"></a><span id="l12.341" class="difflineminus">-    VObject *p, *t;</span>
<a href="#l12.342"></a><span id="l12.342" class="difflineminus">-    char *gs, *n = dot + 1;</span>
<a href="#l12.343"></a><span id="l12.343" class="difflineminus">-    gs = dupStr(g, 0); /* so we can write to it. */</span>
<a href="#l12.344"></a><span id="l12.344" class="difflineminus">-    t = p = addProp_(o, lookupProp(n));</span>
<a href="#l12.345"></a><span id="l12.345" class="difflineminus">-    dot = PL_strrchr(gs, '.');</span>
<a href="#l12.346"></a><span id="l12.346" class="difflineminus">-    *dot = 0;</span>
<a href="#l12.347"></a><span id="l12.347" class="difflineminus">-    do {</span>
<a href="#l12.348"></a><span id="l12.348" class="difflineminus">-      dot = PL_strrchr(gs, '.');</span>
<a href="#l12.349"></a><span id="l12.349" class="difflineminus">-      if (dot) {</span>
<a href="#l12.350"></a><span id="l12.350" class="difflineminus">-        n = dot + 1;</span>
<a href="#l12.351"></a><span id="l12.351" class="difflineminus">-        *dot = 0;</span>
<a href="#l12.352"></a><span id="l12.352" class="difflineminus">-      } else</span>
<a href="#l12.353"></a><span id="l12.353" class="difflineminus">-        n = gs;</span>
<a href="#l12.354"></a><span id="l12.354" class="difflineminus">-      /* property(VCGroupingProp=n);</span>
<a href="#l12.355"></a><span id="l12.355" class="difflineminus">-       *  and the value may have VCGrouping property</span>
<a href="#l12.356"></a><span id="l12.356" class="difflineminus">-       */</span>
<a href="#l12.357"></a><span id="l12.357" class="difflineminus">-      t = addProp(t, VCGroupingProp);</span>
<a href="#l12.358"></a><span id="l12.358" class="difflineminus">-      setVObjectStringZValue(t, lookupProp_(n));</span>
<a href="#l12.359"></a><span id="l12.359" class="difflineminus">-    } while (n != gs);</span>
<a href="#l12.360"></a><span id="l12.360" class="difflineminus">-    deleteString(gs);</span>
<a href="#l12.361"></a><span id="l12.361" class="difflineminus">-    return p;</span>
<a href="#l12.362"></a><span id="l12.362" class="difflineminus">-  } else</span>
<a href="#l12.363"></a><span id="l12.363" class="difflineminus">-    return addProp_(o, lookupProp(g));</span>
<a href="#l12.364"></a><span id="l12.364" class="difflineminus">-}</span>
<a href="#l12.365"></a><span id="l12.365" class="difflineminus">-</span>
<a href="#l12.366"></a><span id="l12.366" class="difflineminus">-VObject *addPropValue(VObject *o, const char *p, const char *v) {</span>
<a href="#l12.367"></a><span id="l12.367" class="difflineminus">-  VObject *prop;</span>
<a href="#l12.368"></a><span id="l12.368" class="difflineminus">-  prop = addProp(o, p);</span>
<a href="#l12.369"></a><span id="l12.369" class="difflineminus">-  if (v) {</span>
<a href="#l12.370"></a><span id="l12.370" class="difflineminus">-    setVObjectUStringZValue_(prop, fakeUnicode(v, 0));</span>
<a href="#l12.371"></a><span id="l12.371" class="difflineminus">-    if (needsQuotedPrintable(v)) {</span>
<a href="#l12.372"></a><span id="l12.372" class="difflineminus">-      if (PL_strcasecmp(VCCardProp, vObjectName(o)) == 0)</span>
<a href="#l12.373"></a><span id="l12.373" class="difflineminus">-        addProp(prop, VCQuotedPrintableProp);</span>
<a href="#l12.374"></a><span id="l12.374" class="difflineminus">-      else</span>
<a href="#l12.375"></a><span id="l12.375" class="difflineminus">-        addProp(o, VCQuotedPrintableProp);</span>
<a href="#l12.376"></a><span id="l12.376" class="difflineminus">-    }</span>
<a href="#l12.377"></a><span id="l12.377" class="difflineminus">-  } else</span>
<a href="#l12.378"></a><span id="l12.378" class="difflineminus">-    setVObjectUStringZValue_(prop, fakeUnicode(&quot;&quot;, 0));</span>
<a href="#l12.379"></a><span id="l12.379" class="difflineminus">-</span>
<a href="#l12.380"></a><span id="l12.380" class="difflineminus">-  return prop;</span>
<a href="#l12.381"></a><span id="l12.381" class="difflineminus">-}</span>
<a href="#l12.382"></a><span id="l12.382" class="difflineminus">-</span>
<a href="#l12.383"></a><span id="l12.383" class="difflineminus">-VObject *addPropSizedValue_(VObject *o, const char *p, const char *v,</span>
<a href="#l12.384"></a><span id="l12.384" class="difflineminus">-                            unsigned int size) {</span>
<a href="#l12.385"></a><span id="l12.385" class="difflineminus">-  VObject *prop;</span>
<a href="#l12.386"></a><span id="l12.386" class="difflineminus">-  prop = addProp(o, p);</span>
<a href="#l12.387"></a><span id="l12.387" class="difflineminus">-  setValueWithSize_(prop, (void *)v, size);</span>
<a href="#l12.388"></a><span id="l12.388" class="difflineminus">-  return prop;</span>
<a href="#l12.389"></a><span id="l12.389" class="difflineminus">-}</span>
<a href="#l12.390"></a><span id="l12.390" class="difflineminus">-</span>
<a href="#l12.391"></a><span id="l12.391" class="difflineminus">-VObject *addPropSizedValue(VObject *o, const char *p, const char *v,</span>
<a href="#l12.392"></a><span id="l12.392" class="difflineminus">-                           unsigned int size) {</span>
<a href="#l12.393"></a><span id="l12.393" class="difflineminus">-  return addPropSizedValue_(o, p, dupStr(v, size), size);</span>
<a href="#l12.394"></a><span id="l12.394" class="difflineminus">-}</span>
<a href="#l12.395"></a><span id="l12.395" class="difflineminus">-</span>
<a href="#l12.396"></a><span id="l12.396" class="difflineminus">-void cleanVObject(VObject *o) {</span>
<a href="#l12.397"></a><span id="l12.397" class="difflineminus">-  if (o == 0) return;</span>
<a href="#l12.398"></a><span id="l12.398" class="difflineminus">-  if (o-&gt;prop) {</span>
<a href="#l12.399"></a><span id="l12.399" class="difflineminus">-    /* destroy time: cannot use the iterator here.</span>
<a href="#l12.400"></a><span id="l12.400" class="difflineminus">-       Have to break the cycle in the circular link</span>
<a href="#l12.401"></a><span id="l12.401" class="difflineminus">-       list and turns it into regular NULL-terminated</span>
<a href="#l12.402"></a><span id="l12.402" class="difflineminus">-       list -- since at some point of destruction,</span>
<a href="#l12.403"></a><span id="l12.403" class="difflineminus">-       the reference entry for the iterator to work</span>
<a href="#l12.404"></a><span id="l12.404" class="difflineminus">-       will not longer be valid.</span>
<a href="#l12.405"></a><span id="l12.405" class="difflineminus">-     */</span>
<a href="#l12.406"></a><span id="l12.406" class="difflineminus">-    VObject *p;</span>
<a href="#l12.407"></a><span id="l12.407" class="difflineminus">-    p = o-&gt;prop-&gt;next;</span>
<a href="#l12.408"></a><span id="l12.408" class="difflineminus">-    o-&gt;prop-&gt;next = 0;</span>
<a href="#l12.409"></a><span id="l12.409" class="difflineminus">-    do {</span>
<a href="#l12.410"></a><span id="l12.410" class="difflineminus">-      VObject *t = p-&gt;next;</span>
<a href="#l12.411"></a><span id="l12.411" class="difflineminus">-      cleanVObject(p);</span>
<a href="#l12.412"></a><span id="l12.412" class="difflineminus">-      p = t;</span>
<a href="#l12.413"></a><span id="l12.413" class="difflineminus">-    } while (p);</span>
<a href="#l12.414"></a><span id="l12.414" class="difflineminus">-  }</span>
<a href="#l12.415"></a><span id="l12.415" class="difflineminus">-  switch (VALUE_TYPE(o)) {</span>
<a href="#l12.416"></a><span id="l12.416" class="difflineminus">-    case VCVT_USTRINGZ:</span>
<a href="#l12.417"></a><span id="l12.417" class="difflineminus">-    case VCVT_STRINGZ:</span>
<a href="#l12.418"></a><span id="l12.418" class="difflineminus">-    case VCVT_RAW:</span>
<a href="#l12.419"></a><span id="l12.419" class="difflineminus">-      /* assume they are all allocated by malloc. */</span>
<a href="#l12.420"></a><span id="l12.420" class="difflineminus">-      if ((char *)STRINGZ_VALUE_OF(o)) PR_Free((char *)STRINGZ_VALUE_OF(o));</span>
<a href="#l12.421"></a><span id="l12.421" class="difflineminus">-      break;</span>
<a href="#l12.422"></a><span id="l12.422" class="difflineminus">-    case VCVT_VOBJECT:</span>
<a href="#l12.423"></a><span id="l12.423" class="difflineminus">-      cleanVObject(VOBJECT_VALUE_OF(o));</span>
<a href="#l12.424"></a><span id="l12.424" class="difflineminus">-      break;</span>
<a href="#l12.425"></a><span id="l12.425" class="difflineminus">-  }</span>
<a href="#l12.426"></a><span id="l12.426" class="difflineminus">-  deleteVObject(o);</span>
<a href="#l12.427"></a><span id="l12.427" class="difflineminus">-}</span>
<a href="#l12.428"></a><span id="l12.428" class="difflineminus">-</span>
<a href="#l12.429"></a><span id="l12.429" class="difflineminus">-void cleanVObjects(VObject *list) {</span>
<a href="#l12.430"></a><span id="l12.430" class="difflineminus">-  while (list) {</span>
<a href="#l12.431"></a><span id="l12.431" class="difflineminus">-    VObject *t = list;</span>
<a href="#l12.432"></a><span id="l12.432" class="difflineminus">-    list = nextVObjectInList(list);</span>
<a href="#l12.433"></a><span id="l12.433" class="difflineminus">-    cleanVObject(t);</span>
<a href="#l12.434"></a><span id="l12.434" class="difflineminus">-  }</span>
<a href="#l12.435"></a><span id="l12.435" class="difflineminus">-}</span>
<a href="#l12.436"></a><span id="l12.436" class="difflineminus">-</span>
<a href="#l12.437"></a><span id="l12.437" class="difflineminus">-/*----------------------------------------------------------------------</span>
<a href="#l12.438"></a><span id="l12.438" class="difflineminus">-  The following is a String Table Facilities.</span>
<a href="#l12.439"></a><span id="l12.439" class="difflineminus">-  ----------------------------------------------------------------------*/</span>
<a href="#l12.440"></a><span id="l12.440" class="difflineminus">-</span>
<a href="#l12.441"></a><span id="l12.441" class="difflineminus">-#define STRTBLSIZE 255</span>
<a href="#l12.442"></a><span id="l12.442" class="difflineminus">-</span>
<a href="#l12.443"></a><span id="l12.443" class="difflineminus">-static StrItem *strTbl[STRTBLSIZE];</span>
<a href="#l12.444"></a><span id="l12.444" class="difflineminus">-</span>
<a href="#l12.445"></a><span id="l12.445" class="difflineminus">-static unsigned int hashStr(const char *s) {</span>
<a href="#l12.446"></a><span id="l12.446" class="difflineminus">-  unsigned int h = 0;</span>
<a href="#l12.447"></a><span id="l12.447" class="difflineminus">-  int i;</span>
<a href="#l12.448"></a><span id="l12.448" class="difflineminus">-  for (i = 0; s[i]; i++) {</span>
<a href="#l12.449"></a><span id="l12.449" class="difflineminus">-    h += s[i] * i;</span>
<a href="#l12.450"></a><span id="l12.450" class="difflineminus">-  }</span>
<a href="#l12.451"></a><span id="l12.451" class="difflineminus">-  return h % STRTBLSIZE;</span>
<a href="#l12.452"></a><span id="l12.452" class="difflineminus">-}</span>
<a href="#l12.453"></a><span id="l12.453" class="difflineminus">-</span>
<a href="#l12.454"></a><span id="l12.454" class="difflineminus">-void unUseStr(const char *s) {</span>
<a href="#l12.455"></a><span id="l12.455" class="difflineminus">-  StrItem *t, *p;</span>
<a href="#l12.456"></a><span id="l12.456" class="difflineminus">-  unsigned int h = hashStr(s);</span>
<a href="#l12.457"></a><span id="l12.457" class="difflineminus">-  if ((t = strTbl[h]) != 0) {</span>
<a href="#l12.458"></a><span id="l12.458" class="difflineminus">-    p = t;</span>
<a href="#l12.459"></a><span id="l12.459" class="difflineminus">-    do {</span>
<a href="#l12.460"></a><span id="l12.460" class="difflineminus">-      if (PL_strcasecmp(t-&gt;s, s) == 0) {</span>
<a href="#l12.461"></a><span id="l12.461" class="difflineminus">-        t-&gt;refCnt--;</span>
<a href="#l12.462"></a><span id="l12.462" class="difflineminus">-        if (t-&gt;refCnt == 0) {</span>
<a href="#l12.463"></a><span id="l12.463" class="difflineminus">-          if (t == strTbl[h]) {</span>
<a href="#l12.464"></a><span id="l12.464" class="difflineminus">-            strTbl[h] = t-&gt;next;</span>
<a href="#l12.465"></a><span id="l12.465" class="difflineminus">-          } else {</span>
<a href="#l12.466"></a><span id="l12.466" class="difflineminus">-            p-&gt;next = t-&gt;next;</span>
<a href="#l12.467"></a><span id="l12.467" class="difflineminus">-          }</span>
<a href="#l12.468"></a><span id="l12.468" class="difflineminus">-          deleteString((char *)t-&gt;s);</span>
<a href="#l12.469"></a><span id="l12.469" class="difflineminus">-          deleteStrItem(t);</span>
<a href="#l12.470"></a><span id="l12.470" class="difflineminus">-          return;</span>
<a href="#l12.471"></a><span id="l12.471" class="difflineminus">-        }</span>
<a href="#l12.472"></a><span id="l12.472" class="difflineminus">-      }</span>
<a href="#l12.473"></a><span id="l12.473" class="difflineminus">-      p = t;</span>
<a href="#l12.474"></a><span id="l12.474" class="difflineminus">-      t = t-&gt;next;</span>
<a href="#l12.475"></a><span id="l12.475" class="difflineminus">-    } while (t);</span>
<a href="#l12.476"></a><span id="l12.476" class="difflineminus">-  }</span>
<a href="#l12.477"></a><span id="l12.477" class="difflineminus">-}</span>
<a href="#l12.478"></a><span id="l12.478" class="difflineminus">-</span>
<a href="#l12.479"></a><span id="l12.479" class="difflineminus">-struct PreDefProp {</span>
<a href="#l12.480"></a><span id="l12.480" class="difflineminus">-  const char *name;</span>
<a href="#l12.481"></a><span id="l12.481" class="difflineminus">-  const char *alias;</span>
<a href="#l12.482"></a><span id="l12.482" class="difflineminus">-  const char **fields;</span>
<a href="#l12.483"></a><span id="l12.483" class="difflineminus">-  unsigned int flags;</span>
<a href="#l12.484"></a><span id="l12.484" class="difflineminus">-};</span>
<a href="#l12.485"></a><span id="l12.485" class="difflineminus">-</span>
<a href="#l12.486"></a><span id="l12.486" class="difflineminus">-/* flags in PreDefProp */</span>
<a href="#l12.487"></a><span id="l12.487" class="difflineminus">-#define PD_BEGIN 0x1</span>
<a href="#l12.488"></a><span id="l12.488" class="difflineminus">-#define PD_INTERNAL 0x2</span>
<a href="#l12.489"></a><span id="l12.489" class="difflineminus">-</span>
<a href="#l12.490"></a><span id="l12.490" class="difflineminus">-static const char *adrFields[] = {</span>
<a href="#l12.491"></a><span id="l12.491" class="difflineminus">-    VCPostalBoxProp, VCExtAddressProp, VCStreetAddressProp, VCCityProp,</span>
<a href="#l12.492"></a><span id="l12.492" class="difflineminus">-    VCRegionProp,    VCPostalCodeProp, VCCountryNameProp,   0};</span>
<a href="#l12.493"></a><span id="l12.493" class="difflineminus">-</span>
<a href="#l12.494"></a><span id="l12.494" class="difflineminus">-static const char *nameFields[] = {VCFamilyNameProp,      VCGivenNameProp,</span>
<a href="#l12.495"></a><span id="l12.495" class="difflineminus">-                                   VCAdditionalNamesProp, VCNamePrefixesProp,</span>
<a href="#l12.496"></a><span id="l12.496" class="difflineminus">-                                   VCNameSuffixesProp,    NULL};</span>
<a href="#l12.497"></a><span id="l12.497" class="difflineminus">-</span>
<a href="#l12.498"></a><span id="l12.498" class="difflineminus">-// VCFullNameProp needs to be a field so VCQuotedPrintableProp can be stored</span>
<a href="#l12.499"></a><span id="l12.499" class="difflineminus">-// with it.</span>
<a href="#l12.500"></a><span id="l12.500" class="difflineminus">-static const char *fnFields[] = {VCFullNameProp, NULL};</span>
<a href="#l12.501"></a><span id="l12.501" class="difflineminus">-</span>
<a href="#l12.502"></a><span id="l12.502" class="difflineminus">-static const char *orgFields[] = {VCOrgNameProp,  VCOrgUnitProp,</span>
<a href="#l12.503"></a><span id="l12.503" class="difflineminus">-                                  VCOrgUnit2Prop, VCOrgUnit3Prop,</span>
<a href="#l12.504"></a><span id="l12.504" class="difflineminus">-                                  VCOrgUnit4Prop, NULL};</span>
<a href="#l12.505"></a><span id="l12.505" class="difflineminus">-</span>
<a href="#l12.506"></a><span id="l12.506" class="difflineminus">-static const char *AAlarmFields[] = {VCRunTimeProp, VCSnoozeTimeProp,</span>
<a href="#l12.507"></a><span id="l12.507" class="difflineminus">-                                     VCRepeatCountProp, VCAudioContentProp, 0};</span>
<a href="#l12.508"></a><span id="l12.508" class="difflineminus">-</span>
<a href="#l12.509"></a><span id="l12.509" class="difflineminus">-static const char *coolTalkFields[] = {VCCooltalkAddress, VCUseServer, 0};</span>
<a href="#l12.510"></a><span id="l12.510" class="difflineminus">-</span>
<a href="#l12.511"></a><span id="l12.511" class="difflineminus">-/* ExDate -- has unnamed fields */</span>
<a href="#l12.512"></a><span id="l12.512" class="difflineminus">-/* RDate -- has unnamed fields */</span>
<a href="#l12.513"></a><span id="l12.513" class="difflineminus">-</span>
<a href="#l12.514"></a><span id="l12.514" class="difflineminus">-static const char *DAlarmFields[] = {VCRunTimeProp, VCSnoozeTimeProp,</span>
<a href="#l12.515"></a><span id="l12.515" class="difflineminus">-                                     VCRepeatCountProp, VCDisplayStringProp, 0};</span>
<a href="#l12.516"></a><span id="l12.516" class="difflineminus">-</span>
<a href="#l12.517"></a><span id="l12.517" class="difflineminus">-static const char *MAlarmFields[] = {VCRunTimeProp,     VCSnoozeTimeProp,</span>
<a href="#l12.518"></a><span id="l12.518" class="difflineminus">-                                     VCRepeatCountProp, VCEmailAddressProp,</span>
<a href="#l12.519"></a><span id="l12.519" class="difflineminus">-                                     VCNoteProp,        0};</span>
<a href="#l12.520"></a><span id="l12.520" class="difflineminus">-</span>
<a href="#l12.521"></a><span id="l12.521" class="difflineminus">-static const char *PAlarmFields[] = {VCRunTimeProp, VCSnoozeTimeProp,</span>
<a href="#l12.522"></a><span id="l12.522" class="difflineminus">-                                     VCRepeatCountProp, VCProcedureNameProp, 0};</span>
<a href="#l12.523"></a><span id="l12.523" class="difflineminus">-</span>
<a href="#l12.524"></a><span id="l12.524" class="difflineminus">-// clang-format off</span>
<a href="#l12.525"></a><span id="l12.525" class="difflineminus">-static struct PreDefProp propNames[] = {</span>
<a href="#l12.526"></a><span id="l12.526" class="difflineminus">-  {VC7bitProp, 0, 0, 0},</span>
<a href="#l12.527"></a><span id="l12.527" class="difflineminus">-  {VC8bitProp, 0, 0, 0},</span>
<a href="#l12.528"></a><span id="l12.528" class="difflineminus">-  {VCAAlarmProp, 0, AAlarmFields, 0},</span>
<a href="#l12.529"></a><span id="l12.529" class="difflineminus">-  {VCAdditionalNamesProp, 0, 0, 0},</span>
<a href="#l12.530"></a><span id="l12.530" class="difflineminus">-  {VCAdrProp, 0, adrFields, 0},</span>
<a href="#l12.531"></a><span id="l12.531" class="difflineminus">-  {VCAgentProp, 0, 0, 0},</span>
<a href="#l12.532"></a><span id="l12.532" class="difflineminus">-  {VCAIFFProp, 0, 0, 0},</span>
<a href="#l12.533"></a><span id="l12.533" class="difflineminus">-  {VCAOLProp, 0, 0, 0},</span>
<a href="#l12.534"></a><span id="l12.534" class="difflineminus">-  {VCAppleLinkProp, 0, 0, 0},</span>
<a href="#l12.535"></a><span id="l12.535" class="difflineminus">-  {VCAttachProp, 0, 0, 0},</span>
<a href="#l12.536"></a><span id="l12.536" class="difflineminus">-  {VCAttendeeProp, 0, 0, 0},</span>
<a href="#l12.537"></a><span id="l12.537" class="difflineminus">-  {VCATTMailProp, 0, 0, 0},</span>
<a href="#l12.538"></a><span id="l12.538" class="difflineminus">-  {VCAudioContentProp, 0, 0, 0},</span>
<a href="#l12.539"></a><span id="l12.539" class="difflineminus">-  {VCAVIProp, 0, 0, 0},</span>
<a href="#l12.540"></a><span id="l12.540" class="difflineminus">-  {VCBase64Prop, 0, 0, 0},</span>
<a href="#l12.541"></a><span id="l12.541" class="difflineminus">-  {VCBBSProp, 0, 0, 0},</span>
<a href="#l12.542"></a><span id="l12.542" class="difflineminus">-  {VCBirthDateProp, 0, 0, 0},</span>
<a href="#l12.543"></a><span id="l12.543" class="difflineminus">-  {VCBMPProp, 0, 0, 0},</span>
<a href="#l12.544"></a><span id="l12.544" class="difflineminus">-  {VCBodyProp, 0, 0, 0},</span>
<a href="#l12.545"></a><span id="l12.545" class="difflineminus">-  {VCBusinessRoleProp, 0, 0, 0},</span>
<a href="#l12.546"></a><span id="l12.546" class="difflineminus">-  {VCCalProp, 0, 0, PD_BEGIN},</span>
<a href="#l12.547"></a><span id="l12.547" class="difflineminus">-  {VCCaptionProp, 0, 0, 0},</span>
<a href="#l12.548"></a><span id="l12.548" class="difflineminus">-  {VCCardProp, 0, 0, PD_BEGIN},</span>
<a href="#l12.549"></a><span id="l12.549" class="difflineminus">-  {VCCarProp, 0, 0, 0},</span>
<a href="#l12.550"></a><span id="l12.550" class="difflineminus">-  {VCCategoriesProp, 0, 0, 0},</span>
<a href="#l12.551"></a><span id="l12.551" class="difflineminus">-  {VCCellularProp, 0, 0, 0},</span>
<a href="#l12.552"></a><span id="l12.552" class="difflineminus">-  {VCCGMProp, 0, 0, 0},</span>
<a href="#l12.553"></a><span id="l12.553" class="difflineminus">-  {VCCharSetProp, 0, 0, 0},</span>
<a href="#l12.554"></a><span id="l12.554" class="difflineminus">-  {VCCIDProp, VCContentIDProp, 0, 0},</span>
<a href="#l12.555"></a><span id="l12.555" class="difflineminus">-  {VCCISProp, 0, 0, 0},</span>
<a href="#l12.556"></a><span id="l12.556" class="difflineminus">-  {VCCityProp, 0, 0, 0},</span>
<a href="#l12.557"></a><span id="l12.557" class="difflineminus">-  {VCClassProp, 0, 0, 0},</span>
<a href="#l12.558"></a><span id="l12.558" class="difflineminus">-  {VCCommentProp, 0, 0, 0},</span>
<a href="#l12.559"></a><span id="l12.559" class="difflineminus">-  {VCCompletedProp, 0, 0, 0},</span>
<a href="#l12.560"></a><span id="l12.560" class="difflineminus">-  {VCContentIDProp, 0, 0, 0},</span>
<a href="#l12.561"></a><span id="l12.561" class="difflineminus">-  {VCCountryNameProp, 0, 0, 0},</span>
<a href="#l12.562"></a><span id="l12.562" class="difflineminus">-  {VCDAlarmProp, 0, DAlarmFields, 0},</span>
<a href="#l12.563"></a><span id="l12.563" class="difflineminus">-  {VCDataSizeProp, 0, 0, PD_INTERNAL},</span>
<a href="#l12.564"></a><span id="l12.564" class="difflineminus">-  {VCDayLightProp, 0, 0, 0},</span>
<a href="#l12.565"></a><span id="l12.565" class="difflineminus">-  {VCDCreatedProp, 0, 0, 0},</span>
<a href="#l12.566"></a><span id="l12.566" class="difflineminus">-  {VCDeliveryLabelProp, 0, 0, 0},</span>
<a href="#l12.567"></a><span id="l12.567" class="difflineminus">-  {VCDescriptionProp, 0, 0, 0},</span>
<a href="#l12.568"></a><span id="l12.568" class="difflineminus">-  {VCDIBProp, 0, 0, 0},</span>
<a href="#l12.569"></a><span id="l12.569" class="difflineminus">-  {VCDisplayStringProp, 0, 0, 0},</span>
<a href="#l12.570"></a><span id="l12.570" class="difflineminus">-  {VCDomesticProp, 0, 0, 0},</span>
<a href="#l12.571"></a><span id="l12.571" class="difflineminus">-  {VCDTendProp, 0, 0, 0},</span>
<a href="#l12.572"></a><span id="l12.572" class="difflineminus">-  {VCDTstartProp, 0, 0, 0},</span>
<a href="#l12.573"></a><span id="l12.573" class="difflineminus">-  {VCDueProp, 0, 0, 0},</span>
<a href="#l12.574"></a><span id="l12.574" class="difflineminus">-  {VCEmailAddressProp, 0, 0, 0},</span>
<a href="#l12.575"></a><span id="l12.575" class="difflineminus">-  {VCEncodingProp, 0, 0, 0},</span>
<a href="#l12.576"></a><span id="l12.576" class="difflineminus">-  {VCEndProp, 0, 0, 0},</span>
<a href="#l12.577"></a><span id="l12.577" class="difflineminus">-  {VCEventProp, 0, 0, PD_BEGIN},</span>
<a href="#l12.578"></a><span id="l12.578" class="difflineminus">-  {VCEWorldProp, 0, 0, 0},</span>
<a href="#l12.579"></a><span id="l12.579" class="difflineminus">-  {VCExNumProp, 0, 0, 0},</span>
<a href="#l12.580"></a><span id="l12.580" class="difflineminus">-  {VCExpDateProp, 0, 0, 0},</span>
<a href="#l12.581"></a><span id="l12.581" class="difflineminus">-  {VCExpectProp, 0, 0, 0},</span>
<a href="#l12.582"></a><span id="l12.582" class="difflineminus">-  {VCExtAddressProp, 0, 0, 0},</span>
<a href="#l12.583"></a><span id="l12.583" class="difflineminus">-  {VCFamilyNameProp, 0, 0, 0},</span>
<a href="#l12.584"></a><span id="l12.584" class="difflineminus">-  {VCFaxProp, 0, 0, 0},</span>
<a href="#l12.585"></a><span id="l12.585" class="difflineminus">-  {VCFullNameProp, 0, fnFields, 0},</span>
<a href="#l12.586"></a><span id="l12.586" class="difflineminus">-  {VCGeoLocationProp, 0, 0, 0},</span>
<a href="#l12.587"></a><span id="l12.587" class="difflineminus">-  {VCGeoProp, 0, 0, 0},</span>
<a href="#l12.588"></a><span id="l12.588" class="difflineminus">-  {VCGIFProp, 0, 0, 0},</span>
<a href="#l12.589"></a><span id="l12.589" class="difflineminus">-  {VCGivenNameProp, 0, 0, 0},</span>
<a href="#l12.590"></a><span id="l12.590" class="difflineminus">-  {VCGroupingProp, 0, 0, 0},</span>
<a href="#l12.591"></a><span id="l12.591" class="difflineminus">-  {VCHomeProp, 0, 0, 0},</span>
<a href="#l12.592"></a><span id="l12.592" class="difflineminus">-  {VCIBMMailProp, 0, 0, 0},</span>
<a href="#l12.593"></a><span id="l12.593" class="difflineminus">-  {VCInlineProp, 0, 0, 0},</span>
<a href="#l12.594"></a><span id="l12.594" class="difflineminus">-  {VCInternationalProp, 0, 0, 0},</span>
<a href="#l12.595"></a><span id="l12.595" class="difflineminus">-  {VCInternetProp, 0, 0, 0},</span>
<a href="#l12.596"></a><span id="l12.596" class="difflineminus">-  {VCISDNProp, 0, 0, 0},</span>
<a href="#l12.597"></a><span id="l12.597" class="difflineminus">-  {VCJPEGProp, 0, 0, 0},</span>
<a href="#l12.598"></a><span id="l12.598" class="difflineminus">-  {VCLanguageProp, 0, 0, 0},</span>
<a href="#l12.599"></a><span id="l12.599" class="difflineminus">-  {VCLastModifiedProp, 0, 0, 0},</span>
<a href="#l12.600"></a><span id="l12.600" class="difflineminus">-  {VCLastRevisedProp, 0, 0, 0},</span>
<a href="#l12.601"></a><span id="l12.601" class="difflineminus">-  {VCLocationProp, 0, 0, 0},</span>
<a href="#l12.602"></a><span id="l12.602" class="difflineminus">-  {VCLogoProp, 0, 0, 0},</span>
<a href="#l12.603"></a><span id="l12.603" class="difflineminus">-  {VCMailerProp, 0, 0, 0},</span>
<a href="#l12.604"></a><span id="l12.604" class="difflineminus">-  {VCMAlarmProp, 0, MAlarmFields, 0},</span>
<a href="#l12.605"></a><span id="l12.605" class="difflineminus">-  {VCMCIMailProp, 0, 0, 0},</span>
<a href="#l12.606"></a><span id="l12.606" class="difflineminus">-  {VCMessageProp, 0, 0, 0},</span>
<a href="#l12.607"></a><span id="l12.607" class="difflineminus">-  {VCMETProp, 0, 0, 0},</span>
<a href="#l12.608"></a><span id="l12.608" class="difflineminus">-  {VCModemProp, 0, 0, 0},</span>
<a href="#l12.609"></a><span id="l12.609" class="difflineminus">-  {VCMPEG2Prop, 0, 0, 0},</span>
<a href="#l12.610"></a><span id="l12.610" class="difflineminus">-  {VCMPEGProp, 0, 0, 0},</span>
<a href="#l12.611"></a><span id="l12.611" class="difflineminus">-  {VCMSNProp, 0, 0, 0},</span>
<a href="#l12.612"></a><span id="l12.612" class="difflineminus">-  {VCNamePrefixesProp, 0, 0, 0},</span>
<a href="#l12.613"></a><span id="l12.613" class="difflineminus">-  {VCNameProp, 0, nameFields, 0},</span>
<a href="#l12.614"></a><span id="l12.614" class="difflineminus">-  {VCNameSuffixesProp, 0, 0, 0},</span>
<a href="#l12.615"></a><span id="l12.615" class="difflineminus">-  {VCNoteProp, 0, 0, 0},</span>
<a href="#l12.616"></a><span id="l12.616" class="difflineminus">-  {VCOrgNameProp, 0, 0, 0},</span>
<a href="#l12.617"></a><span id="l12.617" class="difflineminus">-  {VCOrgProp, 0, orgFields, 0},</span>
<a href="#l12.618"></a><span id="l12.618" class="difflineminus">-  {VCOrgUnit2Prop, 0, 0, 0},</span>
<a href="#l12.619"></a><span id="l12.619" class="difflineminus">-  {VCOrgUnit3Prop, 0, 0, 0},</span>
<a href="#l12.620"></a><span id="l12.620" class="difflineminus">-  {VCOrgUnit4Prop, 0, 0, 0},</span>
<a href="#l12.621"></a><span id="l12.621" class="difflineminus">-  {VCOrgUnitProp, 0, 0, 0},</span>
<a href="#l12.622"></a><span id="l12.622" class="difflineminus">-  {VCPagerProp, 0, 0, 0},</span>
<a href="#l12.623"></a><span id="l12.623" class="difflineminus">-  {VCPAlarmProp, 0, PAlarmFields, 0},</span>
<a href="#l12.624"></a><span id="l12.624" class="difflineminus">-  {VCParcelProp, 0, 0, 0},</span>
<a href="#l12.625"></a><span id="l12.625" class="difflineminus">-  {VCPartProp, 0, 0, 0},</span>
<a href="#l12.626"></a><span id="l12.626" class="difflineminus">-  {VCPCMProp, 0, 0, 0},</span>
<a href="#l12.627"></a><span id="l12.627" class="difflineminus">-  {VCPDFProp, 0, 0, 0},</span>
<a href="#l12.628"></a><span id="l12.628" class="difflineminus">-  {VCPGPProp, 0, 0, 0},</span>
<a href="#l12.629"></a><span id="l12.629" class="difflineminus">-  {VCPhotoProp, 0, 0, 0},</span>
<a href="#l12.630"></a><span id="l12.630" class="difflineminus">-  {VCPICTProp, 0, 0, 0},</span>
<a href="#l12.631"></a><span id="l12.631" class="difflineminus">-  {VCPMBProp, 0, 0, 0},</span>
<a href="#l12.632"></a><span id="l12.632" class="difflineminus">-  {VCPostalBoxProp, 0, 0, 0},</span>
<a href="#l12.633"></a><span id="l12.633" class="difflineminus">-  {VCPostalCodeProp, 0, 0, 0},</span>
<a href="#l12.634"></a><span id="l12.634" class="difflineminus">-  {VCPostalProp, 0, 0, 0},</span>
<a href="#l12.635"></a><span id="l12.635" class="difflineminus">-  {VCPowerShareProp, 0, 0, 0},</span>
<a href="#l12.636"></a><span id="l12.636" class="difflineminus">-  {VCPreferredProp, 0, 0, 0},</span>
<a href="#l12.637"></a><span id="l12.637" class="difflineminus">-  {VCPriorityProp, 0, 0, 0},</span>
<a href="#l12.638"></a><span id="l12.638" class="difflineminus">-  {VCProcedureNameProp, 0, 0, 0},</span>
<a href="#l12.639"></a><span id="l12.639" class="difflineminus">-  {VCProdIdProp, 0, 0, 0},</span>
<a href="#l12.640"></a><span id="l12.640" class="difflineminus">-  {VCProdigyProp, 0, 0, 0},</span>
<a href="#l12.641"></a><span id="l12.641" class="difflineminus">-  {VCPronunciationProp, 0, 0, 0},</span>
<a href="#l12.642"></a><span id="l12.642" class="difflineminus">-  {VCPSProp, 0, 0, 0},</span>
<a href="#l12.643"></a><span id="l12.643" class="difflineminus">-  {VCPublicKeyProp, 0, 0, 0},</span>
<a href="#l12.644"></a><span id="l12.644" class="difflineminus">-  {VCQPProp, VCQuotedPrintableProp, 0, 0},</span>
<a href="#l12.645"></a><span id="l12.645" class="difflineminus">-  {VCQuickTimeProp, 0, 0, 0},</span>
<a href="#l12.646"></a><span id="l12.646" class="difflineminus">-  {VCQuotedPrintableProp, 0, 0, 0},</span>
<a href="#l12.647"></a><span id="l12.647" class="difflineminus">-  {VCRDateProp, 0, 0, 0},</span>
<a href="#l12.648"></a><span id="l12.648" class="difflineminus">-  {VCRegionProp, 0, 0, 0},</span>
<a href="#l12.649"></a><span id="l12.649" class="difflineminus">-  {VCRelatedToProp, 0, 0, 0},</span>
<a href="#l12.650"></a><span id="l12.650" class="difflineminus">-  {VCRepeatCountProp, 0, 0, 0},</span>
<a href="#l12.651"></a><span id="l12.651" class="difflineminus">-  {VCResourcesProp, 0, 0, 0},</span>
<a href="#l12.652"></a><span id="l12.652" class="difflineminus">-  {VCRNumProp, 0, 0, 0},</span>
<a href="#l12.653"></a><span id="l12.653" class="difflineminus">-  {VCRoleProp, 0, 0, 0},</span>
<a href="#l12.654"></a><span id="l12.654" class="difflineminus">-  {VCRRuleProp, 0, 0, 0},</span>
<a href="#l12.655"></a><span id="l12.655" class="difflineminus">-  {VCRSVPProp, 0, 0, 0},</span>
<a href="#l12.656"></a><span id="l12.656" class="difflineminus">-  {VCRunTimeProp, 0, 0, 0},</span>
<a href="#l12.657"></a><span id="l12.657" class="difflineminus">-  {VCSequenceProp, 0, 0, 0},</span>
<a href="#l12.658"></a><span id="l12.658" class="difflineminus">-  {VCSnoozeTimeProp, 0, 0, 0},</span>
<a href="#l12.659"></a><span id="l12.659" class="difflineminus">-  {VCStartProp, 0, 0, 0},</span>
<a href="#l12.660"></a><span id="l12.660" class="difflineminus">-  {VCStatusProp, 0, 0, 0},</span>
<a href="#l12.661"></a><span id="l12.661" class="difflineminus">-  {VCStreetAddressProp, 0, 0, 0},</span>
<a href="#l12.662"></a><span id="l12.662" class="difflineminus">-  {VCSubTypeProp, 0, 0, 0},</span>
<a href="#l12.663"></a><span id="l12.663" class="difflineminus">-  {VCSummaryProp, 0, 0, 0},</span>
<a href="#l12.664"></a><span id="l12.664" class="difflineminus">-  {VCTelephoneProp, 0, 0, 0},</span>
<a href="#l12.665"></a><span id="l12.665" class="difflineminus">-  {VCTIFFProp, 0, 0, 0},</span>
<a href="#l12.666"></a><span id="l12.666" class="difflineminus">-  {VCTimeZoneProp, 0, 0, 0},</span>
<a href="#l12.667"></a><span id="l12.667" class="difflineminus">-  {VCTitleProp, 0, 0, 0},</span>
<a href="#l12.668"></a><span id="l12.668" class="difflineminus">-  {VCTLXProp, 0, 0, 0},</span>
<a href="#l12.669"></a><span id="l12.669" class="difflineminus">-  {VCTodoProp, 0, 0, PD_BEGIN},</span>
<a href="#l12.670"></a><span id="l12.670" class="difflineminus">-  {VCTranspProp, 0, 0, 0},</span>
<a href="#l12.671"></a><span id="l12.671" class="difflineminus">-  {VCUniqueStringProp, 0, 0, 0},</span>
<a href="#l12.672"></a><span id="l12.672" class="difflineminus">-  {VCURLProp, 0, 0, 0},</span>
<a href="#l12.673"></a><span id="l12.673" class="difflineminus">-  {VCURLValueProp, 0, 0, 0},</span>
<a href="#l12.674"></a><span id="l12.674" class="difflineminus">-  {VCValueProp, 0, 0, 0},</span>
<a href="#l12.675"></a><span id="l12.675" class="difflineminus">-  {VCVersionProp, 0, 0, 0},</span>
<a href="#l12.676"></a><span id="l12.676" class="difflineminus">-  {VCVideoProp, 0, 0, 0},</span>
<a href="#l12.677"></a><span id="l12.677" class="difflineminus">-  {VCVoiceProp, 0, 0, 0},</span>
<a href="#l12.678"></a><span id="l12.678" class="difflineminus">-  {VCWAVEProp, 0, 0, 0},</span>
<a href="#l12.679"></a><span id="l12.679" class="difflineminus">-  {VCWMFProp, 0, 0, 0},</span>
<a href="#l12.680"></a><span id="l12.680" class="difflineminus">-  {VCWorkProp, 0, 0, 0},</span>
<a href="#l12.681"></a><span id="l12.681" class="difflineminus">-  {VCX400Prop, 0, 0, 0},</span>
<a href="#l12.682"></a><span id="l12.682" class="difflineminus">-  {VCX509Prop, 0, 0, 0},</span>
<a href="#l12.683"></a><span id="l12.683" class="difflineminus">-  {VCXRuleProp, 0, 0, 0},</span>
<a href="#l12.684"></a><span id="l12.684" class="difflineminus">-  {VCCooltalk, 0, coolTalkFields, 0},</span>
<a href="#l12.685"></a><span id="l12.685" class="difflineminus">-  {VCCooltalkAddress, 0, 0, 0},</span>
<a href="#l12.686"></a><span id="l12.686" class="difflineminus">-  {VCUseServer, 0, 0, 0},</span>
<a href="#l12.687"></a><span id="l12.687" class="difflineminus">-  {VCUseHTML, 0, 0, 0},</span>
<a href="#l12.688"></a><span id="l12.688" class="difflineminus">-  {0, 0, 0, 0}</span>
<a href="#l12.689"></a><span id="l12.689" class="difflineminus">-};</span>
<a href="#l12.690"></a><span id="l12.690" class="difflineminus">-// clang-format on</span>
<a href="#l12.691"></a><span id="l12.691" class="difflineminus">-</span>
<a href="#l12.692"></a><span id="l12.692" class="difflineminus">-static struct PreDefProp *lookupPropInfo(const char *str) {</span>
<a href="#l12.693"></a><span id="l12.693" class="difflineminus">-  /* brute force for now, could use a hash table here. */</span>
<a href="#l12.694"></a><span id="l12.694" class="difflineminus">-  int i;</span>
<a href="#l12.695"></a><span id="l12.695" class="difflineminus">-</span>
<a href="#l12.696"></a><span id="l12.696" class="difflineminus">-  for (i = 0; propNames[i].name; i++)</span>
<a href="#l12.697"></a><span id="l12.697" class="difflineminus">-    if (PL_strcasecmp(str, propNames[i].name) == 0) {</span>
<a href="#l12.698"></a><span id="l12.698" class="difflineminus">-      return &amp;propNames[i];</span>
<a href="#l12.699"></a><span id="l12.699" class="difflineminus">-    }</span>
<a href="#l12.700"></a><span id="l12.700" class="difflineminus">-</span>
<a href="#l12.701"></a><span id="l12.701" class="difflineminus">-  return 0;</span>
<a href="#l12.702"></a><span id="l12.702" class="difflineminus">-}</span>
<a href="#l12.703"></a><span id="l12.703" class="difflineminus">-</span>
<a href="#l12.704"></a><span id="l12.704" class="difflineminus">-const char *lookupProp_(const char *str) {</span>
<a href="#l12.705"></a><span id="l12.705" class="difflineminus">-  int i;</span>
<a href="#l12.706"></a><span id="l12.706" class="difflineminus">-</span>
<a href="#l12.707"></a><span id="l12.707" class="difflineminus">-  for (i = 0; propNames[i].name; i++)</span>
<a href="#l12.708"></a><span id="l12.708" class="difflineminus">-    if (PL_strcasecmp(str, propNames[i].name) == 0) {</span>
<a href="#l12.709"></a><span id="l12.709" class="difflineminus">-      const char *s;</span>
<a href="#l12.710"></a><span id="l12.710" class="difflineminus">-      s = propNames[i].alias ? propNames[i].alias : propNames[i].name;</span>
<a href="#l12.711"></a><span id="l12.711" class="difflineminus">-      return lookupStr(s);</span>
<a href="#l12.712"></a><span id="l12.712" class="difflineminus">-    }</span>
<a href="#l12.713"></a><span id="l12.713" class="difflineminus">-  return lookupStr(str);</span>
<a href="#l12.714"></a><span id="l12.714" class="difflineminus">-}</span>
<a href="#l12.715"></a><span id="l12.715" class="difflineminus">-</span>
<a href="#l12.716"></a><span id="l12.716" class="difflineminus">-const char *lookupProp(const char *str) {</span>
<a href="#l12.717"></a><span id="l12.717" class="difflineminus">-  int i;</span>
<a href="#l12.718"></a><span id="l12.718" class="difflineminus">-</span>
<a href="#l12.719"></a><span id="l12.719" class="difflineminus">-  for (i = 0; propNames[i].name; i++)</span>
<a href="#l12.720"></a><span id="l12.720" class="difflineminus">-    if (PL_strcasecmp(str, propNames[i].name) == 0) {</span>
<a href="#l12.721"></a><span id="l12.721" class="difflineminus">-      const char *s;</span>
<a href="#l12.722"></a><span id="l12.722" class="difflineminus">-      fieldedProp = (char **)propNames[i].fields;</span>
<a href="#l12.723"></a><span id="l12.723" class="difflineminus">-      s = propNames[i].alias ? propNames[i].alias : propNames[i].name;</span>
<a href="#l12.724"></a><span id="l12.724" class="difflineminus">-      return lookupStr(s);</span>
<a href="#l12.725"></a><span id="l12.725" class="difflineminus">-    }</span>
<a href="#l12.726"></a><span id="l12.726" class="difflineminus">-  fieldedProp = 0;</span>
<a href="#l12.727"></a><span id="l12.727" class="difflineminus">-  return lookupStr(str);</span>
<a href="#l12.728"></a><span id="l12.728" class="difflineminus">-}</span>
<a href="#l12.729"></a><span id="l12.729" class="difflineminus">-</span>
<a href="#l12.730"></a><span id="l12.730" class="difflineminus">-/*----------------------------------------------------------------------</span>
<a href="#l12.731"></a><span id="l12.731" class="difflineminus">-  APIs to Output text form.</span>
<a href="#l12.732"></a><span id="l12.732" class="difflineminus">-  ----------------------------------------------------------------------*/</span>
<a href="#l12.733"></a><span id="l12.733" class="difflineminus">-#define OFILE_REALLOC_SIZE 256</span>
<a href="#l12.734"></a><span id="l12.734" class="difflineminus">-</span>
<a href="#l12.735"></a><span id="l12.735" class="difflineminus">-static void appendcOFile_(OFile *fp, char c) {</span>
<a href="#l12.736"></a><span id="l12.736" class="difflineminus">-  if (fp-&gt;fail) return;</span>
<a href="#l12.737"></a><span id="l12.737" class="difflineminus">-stuff:</span>
<a href="#l12.738"></a><span id="l12.738" class="difflineminus">-  if (fp-&gt;len + 1 &lt; fp-&gt;limit) {</span>
<a href="#l12.739"></a><span id="l12.739" class="difflineminus">-    fp-&gt;s[fp-&gt;len] = c;</span>
<a href="#l12.740"></a><span id="l12.740" class="difflineminus">-    fp-&gt;len++;</span>
<a href="#l12.741"></a><span id="l12.741" class="difflineminus">-    return;</span>
<a href="#l12.742"></a><span id="l12.742" class="difflineminus">-  } else if (fp-&gt;alloc) {</span>
<a href="#l12.743"></a><span id="l12.743" class="difflineminus">-    fp-&gt;limit = fp-&gt;limit + OFILE_REALLOC_SIZE;</span>
<a href="#l12.744"></a><span id="l12.744" class="difflineminus">-    char *newBuf = (char *)PR_Realloc(fp-&gt;s, fp-&gt;limit);</span>
<a href="#l12.745"></a><span id="l12.745" class="difflineminus">-    if (newBuf) {</span>
<a href="#l12.746"></a><span id="l12.746" class="difflineminus">-      fp-&gt;s = newBuf;</span>
<a href="#l12.747"></a><span id="l12.747" class="difflineminus">-      goto stuff;</span>
<a href="#l12.748"></a><span id="l12.748" class="difflineminus">-    }</span>
<a href="#l12.749"></a><span id="l12.749" class="difflineminus">-  }</span>
<a href="#l12.750"></a><span id="l12.750" class="difflineminus">-  if (fp-&gt;alloc) PR_FREEIF(fp-&gt;s);</span>
<a href="#l12.751"></a><span id="l12.751" class="difflineminus">-  fp-&gt;s = 0;</span>
<a href="#l12.752"></a><span id="l12.752" class="difflineminus">-  fp-&gt;fail = 1;</span>
<a href="#l12.753"></a><span id="l12.753" class="difflineminus">-}</span>
<a href="#l12.754"></a><span id="l12.754" class="difflineminus">-</span>
<a href="#l12.755"></a><span id="l12.755" class="difflineminus">-static void appendcOFile(OFile *fp, char c) {</span>
<a href="#l12.756"></a><span id="l12.756" class="difflineminus">-  /* int i = 0; */</span>
<a href="#l12.757"></a><span id="l12.757" class="difflineminus">-  if (c == '\n') {</span>
<a href="#l12.758"></a><span id="l12.758" class="difflineminus">-    /* write out as &lt;CR&gt;&lt;LF&gt; */</span>
<a href="#l12.759"></a><span id="l12.759" class="difflineminus">-    /* for (i = 0; i &lt; LINEBREAK_LEN; i++)</span>
<a href="#l12.760"></a><span id="l12.760" class="difflineminus">-      appendcOFile_(fp,LINEBREAK [ i ]); */</span>
<a href="#l12.761"></a><span id="l12.761" class="difflineminus">-    appendcOFile_(fp, 0xd);</span>
<a href="#l12.762"></a><span id="l12.762" class="difflineminus">-    appendcOFile_(fp, 0xa);</span>
<a href="#l12.763"></a><span id="l12.763" class="difflineminus">-  } else</span>
<a href="#l12.764"></a><span id="l12.764" class="difflineminus">-    appendcOFile_(fp, c);</span>
<a href="#l12.765"></a><span id="l12.765" class="difflineminus">-}</span>
<a href="#l12.766"></a><span id="l12.766" class="difflineminus">-</span>
<a href="#l12.767"></a><span id="l12.767" class="difflineminus">-static void appendsOFile(OFile *fp, const char *s) {</span>
<a href="#l12.768"></a><span id="l12.768" class="difflineminus">-  int i, slen;</span>
<a href="#l12.769"></a><span id="l12.769" class="difflineminus">-  slen = PL_strlen(s);</span>
<a href="#l12.770"></a><span id="l12.770" class="difflineminus">-  for (i = 0; i &lt; slen; i++) {</span>
<a href="#l12.771"></a><span id="l12.771" class="difflineminus">-    appendcOFile(fp, s[i]);</span>
<a href="#l12.772"></a><span id="l12.772" class="difflineminus">-  }</span>
<a href="#l12.773"></a><span id="l12.773" class="difflineminus">-}</span>
<a href="#l12.774"></a><span id="l12.774" class="difflineminus">-</span>
<a href="#l12.775"></a><span id="l12.775" class="difflineminus">-static void initMemOFile(OFile *fp, char *s, int len) {</span>
<a href="#l12.776"></a><span id="l12.776" class="difflineminus">-  fp-&gt;s = s;</span>
<a href="#l12.777"></a><span id="l12.777" class="difflineminus">-  fp-&gt;len = 0;</span>
<a href="#l12.778"></a><span id="l12.778" class="difflineminus">-  fp-&gt;limit = s ? len : 0;</span>
<a href="#l12.779"></a><span id="l12.779" class="difflineminus">-  fp-&gt;alloc = s ? 0 : 1;</span>
<a href="#l12.780"></a><span id="l12.780" class="difflineminus">-  fp-&gt;fail = 0;</span>
<a href="#l12.781"></a><span id="l12.781" class="difflineminus">-}</span>
<a href="#l12.782"></a><span id="l12.782" class="difflineminus">-</span>
<a href="#l12.783"></a><span id="l12.783" class="difflineminus">-static int writeBase64(OFile *fp, unsigned char *s, long len) {</span>
<a href="#l12.784"></a><span id="l12.784" class="difflineminus">-  long cur = 0;</span>
<a href="#l12.785"></a><span id="l12.785" class="difflineminus">-  int i, numQuads = 0;</span>
<a href="#l12.786"></a><span id="l12.786" class="difflineminus">-  unsigned long trip;</span>
<a href="#l12.787"></a><span id="l12.787" class="difflineminus">-  unsigned char b;</span>
<a href="#l12.788"></a><span id="l12.788" class="difflineminus">-  char quad[5];</span>
<a href="#l12.789"></a><span id="l12.789" class="difflineminus">-#define PR_MAXQUADS 16</span>
<a href="#l12.790"></a><span id="l12.790" class="difflineminus">-</span>
<a href="#l12.791"></a><span id="l12.791" class="difflineminus">-  quad[4] = 0;</span>
<a href="#l12.792"></a><span id="l12.792" class="difflineminus">-</span>
<a href="#l12.793"></a><span id="l12.793" class="difflineminus">-  while (cur &lt; len) {</span>
<a href="#l12.794"></a><span id="l12.794" class="difflineminus">-    /* collect the triplet of bytes into 'trip' */</span>
<a href="#l12.795"></a><span id="l12.795" class="difflineminus">-    trip = 0;</span>
<a href="#l12.796"></a><span id="l12.796" class="difflineminus">-    for (i = 0; i &lt; 3; i++) {</span>
<a href="#l12.797"></a><span id="l12.797" class="difflineminus">-      b = (cur &lt; len) ? *(s + cur) : 0;</span>
<a href="#l12.798"></a><span id="l12.798" class="difflineminus">-      cur++;</span>
<a href="#l12.799"></a><span id="l12.799" class="difflineminus">-      trip = trip &lt;&lt; 8 | b;</span>
<a href="#l12.800"></a><span id="l12.800" class="difflineminus">-    }</span>
<a href="#l12.801"></a><span id="l12.801" class="difflineminus">-    /* fill in 'quad' with the appropriate four characters */</span>
<a href="#l12.802"></a><span id="l12.802" class="difflineminus">-    for (i = 3; i &gt;= 0; i--) {</span>
<a href="#l12.803"></a><span id="l12.803" class="difflineminus">-      b = (unsigned char)(trip &amp; 0x3F);</span>
<a href="#l12.804"></a><span id="l12.804" class="difflineminus">-      trip = trip &gt;&gt; 6;</span>
<a href="#l12.805"></a><span id="l12.805" class="difflineminus">-      if ((3 - i) &lt; (cur - len))</span>
<a href="#l12.806"></a><span id="l12.806" class="difflineminus">-        quad[i] = '='; /* pad char */</span>
<a href="#l12.807"></a><span id="l12.807" class="difflineminus">-      else if (b &lt; 26)</span>
<a href="#l12.808"></a><span id="l12.808" class="difflineminus">-        quad[i] = (char)b + 'A';</span>
<a href="#l12.809"></a><span id="l12.809" class="difflineminus">-      else if (b &lt; 52)</span>
<a href="#l12.810"></a><span id="l12.810" class="difflineminus">-        quad[i] = (char)(b - 26) + 'a';</span>
<a href="#l12.811"></a><span id="l12.811" class="difflineminus">-      else if (b &lt; 62)</span>
<a href="#l12.812"></a><span id="l12.812" class="difflineminus">-        quad[i] = (char)(b - 52) + '0';</span>
<a href="#l12.813"></a><span id="l12.813" class="difflineminus">-      else if (b == 62)</span>
<a href="#l12.814"></a><span id="l12.814" class="difflineminus">-        quad[i] = '+';</span>
<a href="#l12.815"></a><span id="l12.815" class="difflineminus">-      else</span>
<a href="#l12.816"></a><span id="l12.816" class="difflineminus">-        quad[i] = '/';</span>
<a href="#l12.817"></a><span id="l12.817" class="difflineminus">-    }</span>
<a href="#l12.818"></a><span id="l12.818" class="difflineminus">-    /* now output 'quad' with appropriate whitespace and line ending */</span>
<a href="#l12.819"></a><span id="l12.819" class="difflineminus">-    appendsOFile(fp, (numQuads == 0 ? &quot;    &quot; : &quot;&quot;));</span>
<a href="#l12.820"></a><span id="l12.820" class="difflineminus">-    appendsOFile(fp, quad);</span>
<a href="#l12.821"></a><span id="l12.821" class="difflineminus">-    appendsOFile(</span>
<a href="#l12.822"></a><span id="l12.822" class="difflineminus">-        fp, ((cur &gt;= len) ? &quot;\n&quot; : (numQuads == PR_MAXQUADS - 1 ? &quot;\n&quot; : &quot;&quot;)));</span>
<a href="#l12.823"></a><span id="l12.823" class="difflineminus">-    numQuads = (numQuads + 1) % PR_MAXQUADS;</span>
<a href="#l12.824"></a><span id="l12.824" class="difflineminus">-  }</span>
<a href="#l12.825"></a><span id="l12.825" class="difflineminus">-  appendcOFile(fp, '\n');</span>
<a href="#l12.826"></a><span id="l12.826" class="difflineminus">-</span>
<a href="#l12.827"></a><span id="l12.827" class="difflineminus">-  return 1;</span>
<a href="#l12.828"></a><span id="l12.828" class="difflineminus">-}</span>
<a href="#l12.829"></a><span id="l12.829" class="difflineminus">-</span>
<a href="#l12.830"></a><span id="l12.830" class="difflineminus">-static void writeQPString(OFile *fp, const char *s) {</span>
<a href="#l12.831"></a><span id="l12.831" class="difflineminus">-  const unsigned char *p = (const unsigned char *)s;</span>
<a href="#l12.832"></a><span id="l12.832" class="difflineminus">-  int current_column = 0;</span>
<a href="#l12.833"></a><span id="l12.833" class="difflineminus">-  static const char hexdigits[] = &quot;0123456789ABCDEF&quot;;</span>
<a href="#l12.834"></a><span id="l12.834" class="difflineminus">-  bool white = false;</span>
<a href="#l12.835"></a><span id="l12.835" class="difflineminus">-  bool contWhite = false;</span>
<a href="#l12.836"></a><span id="l12.836" class="difflineminus">-  bool mb_p = false;</span>
<a href="#l12.837"></a><span id="l12.837" class="difflineminus">-</span>
<a href="#l12.838"></a><span id="l12.838" class="difflineminus">-  if (needsQuotedPrintable(s)) {</span>
<a href="#l12.839"></a><span id="l12.839" class="difflineminus">-    while (*p) {</span>
<a href="#l12.840"></a><span id="l12.840" class="difflineminus">-      if (*p == '\r' || *p == '\n') {</span>
<a href="#l12.841"></a><span id="l12.841" class="difflineminus">-        /* Whitespace cannot be allowed to occur at the end of the line.</span>
<a href="#l12.842"></a><span id="l12.842" class="difflineminus">-           So we encode &quot; \n&quot; as &quot; =\n\n&quot;, that is, the whitespace, a</span>
<a href="#l12.843"></a><span id="l12.843" class="difflineminus">-           soft line break, and then a hard line break.</span>
<a href="#l12.844"></a><span id="l12.844" class="difflineminus">-         */</span>
<a href="#l12.845"></a><span id="l12.845" class="difflineminus">-</span>
<a href="#l12.846"></a><span id="l12.846" class="difflineminus">-        if (white) {</span>
<a href="#l12.847"></a><span id="l12.847" class="difflineminus">-          appendcOFile(fp, '=');</span>
<a href="#l12.848"></a><span id="l12.848" class="difflineminus">-          appendcOFile(fp, '\n');</span>
<a href="#l12.849"></a><span id="l12.849" class="difflineminus">-          appendcOFile(fp, '\t');</span>
<a href="#l12.850"></a><span id="l12.850" class="difflineminus">-          appendsOFile(fp, &quot;=0D&quot;);</span>
<a href="#l12.851"></a><span id="l12.851" class="difflineminus">-          appendsOFile(fp, &quot;=0A&quot;);</span>
<a href="#l12.852"></a><span id="l12.852" class="difflineminus">-          appendcOFile(fp, '=');</span>
<a href="#l12.853"></a><span id="l12.853" class="difflineminus">-          appendcOFile(fp, '\n');</span>
<a href="#l12.854"></a><span id="l12.854" class="difflineminus">-          appendcOFile(fp, '\t');</span>
<a href="#l12.855"></a><span id="l12.855" class="difflineminus">-        } else {</span>
<a href="#l12.856"></a><span id="l12.856" class="difflineminus">-          appendsOFile(fp, &quot;=0D&quot;);</span>
<a href="#l12.857"></a><span id="l12.857" class="difflineminus">-          appendsOFile(fp, &quot;=0A&quot;);</span>
<a href="#l12.858"></a><span id="l12.858" class="difflineminus">-          appendcOFile(fp, '=');</span>
<a href="#l12.859"></a><span id="l12.859" class="difflineminus">-          appendcOFile(fp, '\n');</span>
<a href="#l12.860"></a><span id="l12.860" class="difflineminus">-          appendcOFile(fp, '\t');</span>
<a href="#l12.861"></a><span id="l12.861" class="difflineminus">-          contWhite = false;</span>
<a href="#l12.862"></a><span id="l12.862" class="difflineminus">-        }</span>
<a href="#l12.863"></a><span id="l12.863" class="difflineminus">-</span>
<a href="#l12.864"></a><span id="l12.864" class="difflineminus">-        /* If its CRLF, swallow two chars instead of one. */</span>
<a href="#l12.865"></a><span id="l12.865" class="difflineminus">-        if (*p == '\r' &amp;&amp; *(p + 1) == '\n') p++;</span>
<a href="#l12.866"></a><span id="l12.866" class="difflineminus">-        white = false;</span>
<a href="#l12.867"></a><span id="l12.867" class="difflineminus">-        current_column = 0;</span>
<a href="#l12.868"></a><span id="l12.868" class="difflineminus">-      } else {</span>
<a href="#l12.869"></a><span id="l12.869" class="difflineminus">-        if ((*p &gt;= 33 &amp;&amp; *p &lt;= 60) || /* safe printing chars */</span>
<a href="#l12.870"></a><span id="l12.870" class="difflineminus">-            (*p &gt;= 62 &amp;&amp; *p &lt;= 126) ||</span>
<a href="#l12.871"></a><span id="l12.871" class="difflineminus">-            (mb_p &amp;&amp; (*p == 61 || *p == 127 || *p == 0x1B))) {</span>
<a href="#l12.872"></a><span id="l12.872" class="difflineminus">-          appendcOFile(fp, *p);</span>
<a href="#l12.873"></a><span id="l12.873" class="difflineminus">-          current_column++;</span>
<a href="#l12.874"></a><span id="l12.874" class="difflineminus">-          white = false;</span>
<a href="#l12.875"></a><span id="l12.875" class="difflineminus">-          contWhite = false;</span>
<a href="#l12.876"></a><span id="l12.876" class="difflineminus">-        } else if (*p == ' ' || *p == '\t') /* whitespace */</span>
<a href="#l12.877"></a><span id="l12.877" class="difflineminus">-        {</span>
<a href="#l12.878"></a><span id="l12.878" class="difflineminus">-          if (contWhite) {</span>
<a href="#l12.879"></a><span id="l12.879" class="difflineminus">-            appendcOFile(fp, '=');</span>
<a href="#l12.880"></a><span id="l12.880" class="difflineminus">-            appendcOFile(fp, hexdigits[*p &gt;&gt; 4]);</span>
<a href="#l12.881"></a><span id="l12.881" class="difflineminus">-            appendcOFile(fp, hexdigits[*p &amp; 0xF]);</span>
<a href="#l12.882"></a><span id="l12.882" class="difflineminus">-            current_column += 3;</span>
<a href="#l12.883"></a><span id="l12.883" class="difflineminus">-            contWhite = false;</span>
<a href="#l12.884"></a><span id="l12.884" class="difflineminus">-          } else {</span>
<a href="#l12.885"></a><span id="l12.885" class="difflineminus">-            appendcOFile(fp, *p);</span>
<a href="#l12.886"></a><span id="l12.886" class="difflineminus">-            current_column++;</span>
<a href="#l12.887"></a><span id="l12.887" class="difflineminus">-          }</span>
<a href="#l12.888"></a><span id="l12.888" class="difflineminus">-          white = true;</span>
<a href="#l12.889"></a><span id="l12.889" class="difflineminus">-        } else /* print as =FF */</span>
<a href="#l12.890"></a><span id="l12.890" class="difflineminus">-        {</span>
<a href="#l12.891"></a><span id="l12.891" class="difflineminus">-          appendcOFile(fp, '=');</span>
<a href="#l12.892"></a><span id="l12.892" class="difflineminus">-          appendcOFile(fp, hexdigits[*p &gt;&gt; 4]);</span>
<a href="#l12.893"></a><span id="l12.893" class="difflineminus">-          appendcOFile(fp, hexdigits[*p &amp; 0xF]);</span>
<a href="#l12.894"></a><span id="l12.894" class="difflineminus">-          current_column += 3;</span>
<a href="#l12.895"></a><span id="l12.895" class="difflineminus">-          white = false;</span>
<a href="#l12.896"></a><span id="l12.896" class="difflineminus">-          contWhite = false;</span>
<a href="#l12.897"></a><span id="l12.897" class="difflineminus">-        }</span>
<a href="#l12.898"></a><span id="l12.898" class="difflineminus">-</span>
<a href="#l12.899"></a><span id="l12.899" class="difflineminus">-        NS_ASSERTION(</span>
<a href="#l12.900"></a><span id="l12.900" class="difflineminus">-            current_column &lt;= 76,</span>
<a href="#l12.901"></a><span id="l12.901" class="difflineminus">-            &quot;1.10 &lt;rhp@netscape.com&gt; 06 Jan 2000 08:01&quot;); /* Hard limit required</span>
<a href="#l12.902"></a><span id="l12.902" class="difflineminus">-                                                             by spec */</span>
<a href="#l12.903"></a><span id="l12.903" class="difflineminus">-</span>
<a href="#l12.904"></a><span id="l12.904" class="difflineminus">-        if (current_column &gt;= 73 ||</span>
<a href="#l12.905"></a><span id="l12.905" class="difflineminus">-            ((*(p + 1) == ' ') &amp;&amp;</span>
<a href="#l12.906"></a><span id="l12.906" class="difflineminus">-             (current_column + 3 &gt;= 73))) /* soft line break: &quot;=\r\n&quot; */</span>
<a href="#l12.907"></a><span id="l12.907" class="difflineminus">-        {</span>
<a href="#l12.908"></a><span id="l12.908" class="difflineminus">-          appendcOFile(fp, '=');</span>
<a href="#l12.909"></a><span id="l12.909" class="difflineminus">-          appendcOFile(fp, '\n');</span>
<a href="#l12.910"></a><span id="l12.910" class="difflineminus">-          appendcOFile(fp, '\t');</span>
<a href="#l12.911"></a><span id="l12.911" class="difflineminus">-          current_column = 0;</span>
<a href="#l12.912"></a><span id="l12.912" class="difflineminus">-          if (white)</span>
<a href="#l12.913"></a><span id="l12.913" class="difflineminus">-            contWhite = true;</span>
<a href="#l12.914"></a><span id="l12.914" class="difflineminus">-          else</span>
<a href="#l12.915"></a><span id="l12.915" class="difflineminus">-            contWhite = false;</span>
<a href="#l12.916"></a><span id="l12.916" class="difflineminus">-          white = false;</span>
<a href="#l12.917"></a><span id="l12.917" class="difflineminus">-        }</span>
<a href="#l12.918"></a><span id="l12.918" class="difflineminus">-      }</span>
<a href="#l12.919"></a><span id="l12.919" class="difflineminus">-      p++;</span>
<a href="#l12.920"></a><span id="l12.920" class="difflineminus">-    } /* while */</span>
<a href="#l12.921"></a><span id="l12.921" class="difflineminus">-  }   /* if */</span>
<a href="#l12.922"></a><span id="l12.922" class="difflineminus">-  else {</span>
<a href="#l12.923"></a><span id="l12.923" class="difflineminus">-    while (*p) {</span>
<a href="#l12.924"></a><span id="l12.924" class="difflineminus">-      appendcOFile(fp, *p);</span>
<a href="#l12.925"></a><span id="l12.925" class="difflineminus">-      p++;</span>
<a href="#l12.926"></a><span id="l12.926" class="difflineminus">-    }</span>
<a href="#l12.927"></a><span id="l12.927" class="difflineminus">-  }</span>
<a href="#l12.928"></a><span id="l12.928" class="difflineminus">-}</span>
<a href="#l12.929"></a><span id="l12.929" class="difflineminus">-</span>
<a href="#l12.930"></a><span id="l12.930" class="difflineminus">-static void writeValue(OFile *fp, VObject *o, unsigned long size) {</span>
<a href="#l12.931"></a><span id="l12.931" class="difflineminus">-  if (o == 0) return;</span>
<a href="#l12.932"></a><span id="l12.932" class="difflineminus">-  switch (VALUE_TYPE(o)) {</span>
<a href="#l12.933"></a><span id="l12.933" class="difflineminus">-    case VCVT_USTRINGZ: {</span>
<a href="#l12.934"></a><span id="l12.934" class="difflineminus">-      char *s = fakeCString(USTRINGZ_VALUE_OF(o));</span>
<a href="#l12.935"></a><span id="l12.935" class="difflineminus">-      writeQPString(fp, s);</span>
<a href="#l12.936"></a><span id="l12.936" class="difflineminus">-      deleteString(s);</span>
<a href="#l12.937"></a><span id="l12.937" class="difflineminus">-      break;</span>
<a href="#l12.938"></a><span id="l12.938" class="difflineminus">-    }</span>
<a href="#l12.939"></a><span id="l12.939" class="difflineminus">-    case VCVT_STRINGZ: {</span>
<a href="#l12.940"></a><span id="l12.940" class="difflineminus">-      writeQPString(fp, STRINGZ_VALUE_OF(o));</span>
<a href="#l12.941"></a><span id="l12.941" class="difflineminus">-      break;</span>
<a href="#l12.942"></a><span id="l12.942" class="difflineminus">-    }</span>
<a href="#l12.943"></a><span id="l12.943" class="difflineminus">-    case VCVT_UINT: {</span>
<a href="#l12.944"></a><span id="l12.944" class="difflineminus">-      char buf[11];</span>
<a href="#l12.945"></a><span id="l12.945" class="difflineminus">-      sprintf(buf, &quot;%u&quot;, INTEGER_VALUE_OF(o));</span>
<a href="#l12.946"></a><span id="l12.946" class="difflineminus">-      appendsOFile(fp, buf);</span>
<a href="#l12.947"></a><span id="l12.947" class="difflineminus">-      break;</span>
<a href="#l12.948"></a><span id="l12.948" class="difflineminus">-    }</span>
<a href="#l12.949"></a><span id="l12.949" class="difflineminus">-    case VCVT_ULONG: {</span>
<a href="#l12.950"></a><span id="l12.950" class="difflineminus">-      char buf[21];</span>
<a href="#l12.951"></a><span id="l12.951" class="difflineminus">-      sprintf(buf, &quot;%lu&quot;, LONG_VALUE_OF(o));</span>
<a href="#l12.952"></a><span id="l12.952" class="difflineminus">-      appendsOFile(fp, buf);</span>
<a href="#l12.953"></a><span id="l12.953" class="difflineminus">-      break;</span>
<a href="#l12.954"></a><span id="l12.954" class="difflineminus">-    }</span>
<a href="#l12.955"></a><span id="l12.955" class="difflineminus">-    case VCVT_RAW: {</span>
<a href="#l12.956"></a><span id="l12.956" class="difflineminus">-      appendcOFile(fp, '\n');</span>
<a href="#l12.957"></a><span id="l12.957" class="difflineminus">-      writeBase64(fp, (unsigned char *)(ANY_VALUE_OF(o)), size);</span>
<a href="#l12.958"></a><span id="l12.958" class="difflineminus">-      break;</span>
<a href="#l12.959"></a><span id="l12.959" class="difflineminus">-    }</span>
<a href="#l12.960"></a><span id="l12.960" class="difflineminus">-    case VCVT_VOBJECT:</span>
<a href="#l12.961"></a><span id="l12.961" class="difflineminus">-      appendcOFile(fp, '\n');</span>
<a href="#l12.962"></a><span id="l12.962" class="difflineminus">-      writeVObject_(fp, VOBJECT_VALUE_OF(o));</span>
<a href="#l12.963"></a><span id="l12.963" class="difflineminus">-      break;</span>
<a href="#l12.964"></a><span id="l12.964" class="difflineminus">-  }</span>
<a href="#l12.965"></a><span id="l12.965" class="difflineminus">-}</span>
<a href="#l12.966"></a><span id="l12.966" class="difflineminus">-</span>
<a href="#l12.967"></a><span id="l12.967" class="difflineminus">-static void writeAttrValue(OFile *fp, VObject *o, int *length) {</span>
<a href="#l12.968"></a><span id="l12.968" class="difflineminus">-  int ilen = 0;</span>
<a href="#l12.969"></a><span id="l12.969" class="difflineminus">-  if (NAME_OF(o)) {</span>
<a href="#l12.970"></a><span id="l12.970" class="difflineminus">-    struct PreDefProp *pi;</span>
<a href="#l12.971"></a><span id="l12.971" class="difflineminus">-    pi = lookupPropInfo(NAME_OF(o));</span>
<a href="#l12.972"></a><span id="l12.972" class="difflineminus">-    if (pi &amp;&amp; ((pi-&gt;flags &amp; PD_INTERNAL) != 0)) return;</span>
<a href="#l12.973"></a><span id="l12.973" class="difflineminus">-    appendcOFile(fp, ';');</span>
<a href="#l12.974"></a><span id="l12.974" class="difflineminus">-    if (*length != -1) (*length)++;</span>
<a href="#l12.975"></a><span id="l12.975" class="difflineminus">-    appendsOFile(fp, NAME_OF(o));</span>
<a href="#l12.976"></a><span id="l12.976" class="difflineminus">-    if (*length != -1) (*length) += PL_strlen(NAME_OF(o));</span>
<a href="#l12.977"></a><span id="l12.977" class="difflineminus">-  } else {</span>
<a href="#l12.978"></a><span id="l12.978" class="difflineminus">-    appendcOFile(fp, ';');</span>
<a href="#l12.979"></a><span id="l12.979" class="difflineminus">-    (*length)++;</span>
<a href="#l12.980"></a><span id="l12.980" class="difflineminus">-  }</span>
<a href="#l12.981"></a><span id="l12.981" class="difflineminus">-  if (VALUE_TYPE(o)) {</span>
<a href="#l12.982"></a><span id="l12.982" class="difflineminus">-    appendcOFile(fp, '=');</span>
<a href="#l12.983"></a><span id="l12.983" class="difflineminus">-    if (*length != -1) {</span>
<a href="#l12.984"></a><span id="l12.984" class="difflineminus">-      (*length)++;</span>
<a href="#l12.985"></a><span id="l12.985" class="difflineminus">-      for (ilen = 0; ilen &lt; MAXMOZPROPNAMESIZE - (*length); ilen++)</span>
<a href="#l12.986"></a><span id="l12.986" class="difflineminus">-        appendcOFile(fp, ' ');</span>
<a href="#l12.987"></a><span id="l12.987" class="difflineminus">-    }</span>
<a href="#l12.988"></a><span id="l12.988" class="difflineminus">-    writeValue(fp, o, 0);</span>
<a href="#l12.989"></a><span id="l12.989" class="difflineminus">-  }</span>
<a href="#l12.990"></a><span id="l12.990" class="difflineminus">-}</span>
<a href="#l12.991"></a><span id="l12.991" class="difflineminus">-</span>
<a href="#l12.992"></a><span id="l12.992" class="difflineminus">-static void writeGroup(OFile *fp, VObject *o) {</span>
<a href="#l12.993"></a><span id="l12.993" class="difflineminus">-  nsAutoCString buf(NAME_OF(o));</span>
<a href="#l12.994"></a><span id="l12.994" class="difflineminus">-</span>
<a href="#l12.995"></a><span id="l12.995" class="difflineminus">-  while ((o = isAPropertyOf(o, VCGroupingProp)) != 0) {</span>
<a href="#l12.996"></a><span id="l12.996" class="difflineminus">-    buf.InsertLiteral(&quot;.&quot;, 0);</span>
<a href="#l12.997"></a><span id="l12.997" class="difflineminus">-    buf.Insert(STRINGZ_VALUE_OF(o), 0);</span>
<a href="#l12.998"></a><span id="l12.998" class="difflineminus">-  }</span>
<a href="#l12.999"></a><span id="l12.999" class="difflineminus">-  appendsOFile(fp, buf.get());</span>
<a href="#l12.1000"></a><span id="l12.1000" class="difflineminus">-}</span>
<a href="#l12.1001"></a><span id="l12.1001" class="difflineminus">-</span>
<a href="#l12.1002"></a><span id="l12.1002" class="difflineminus">-static int inList(const char **list, const char *s) {</span>
<a href="#l12.1003"></a><span id="l12.1003" class="difflineminus">-  if (list == 0) return 0;</span>
<a href="#l12.1004"></a><span id="l12.1004" class="difflineminus">-  while (*list) {</span>
<a href="#l12.1005"></a><span id="l12.1005" class="difflineminus">-    if (PL_strcasecmp(*list, s) == 0) return 1;</span>
<a href="#l12.1006"></a><span id="l12.1006" class="difflineminus">-    list++;</span>
<a href="#l12.1007"></a><span id="l12.1007" class="difflineminus">-  }</span>
<a href="#l12.1008"></a><span id="l12.1008" class="difflineminus">-  return 0;</span>
<a href="#l12.1009"></a><span id="l12.1009" class="difflineminus">-}</span>
<a href="#l12.1010"></a><span id="l12.1010" class="difflineminus">-</span>
<a href="#l12.1011"></a><span id="l12.1011" class="difflineminus">-static void writeProp(OFile *fp, VObject *o) {</span>
<a href="#l12.1012"></a><span id="l12.1012" class="difflineminus">-  int length = -1;</span>
<a href="#l12.1013"></a><span id="l12.1013" class="difflineminus">-  // int ilen = 0;</span>
<a href="#l12.1014"></a><span id="l12.1014" class="difflineminus">-</span>
<a href="#l12.1015"></a><span id="l12.1015" class="difflineminus">-  if (NAME_OF(o)) {</span>
<a href="#l12.1016"></a><span id="l12.1016" class="difflineminus">-    struct PreDefProp *pi;</span>
<a href="#l12.1017"></a><span id="l12.1017" class="difflineminus">-    VObjectIterator t;</span>
<a href="#l12.1018"></a><span id="l12.1018" class="difflineminus">-    const char **fields_ = 0;</span>
<a href="#l12.1019"></a><span id="l12.1019" class="difflineminus">-    pi = lookupPropInfo(NAME_OF(o));</span>
<a href="#l12.1020"></a><span id="l12.1020" class="difflineminus">-    if (pi &amp;&amp; ((pi-&gt;flags &amp; PD_BEGIN) != 0)) {</span>
<a href="#l12.1021"></a><span id="l12.1021" class="difflineminus">-      writeVObject_(fp, o);</span>
<a href="#l12.1022"></a><span id="l12.1022" class="difflineminus">-      return;</span>
<a href="#l12.1023"></a><span id="l12.1023" class="difflineminus">-    }</span>
<a href="#l12.1024"></a><span id="l12.1024" class="difflineminus">-    if (isAPropertyOf(o, VCGroupingProp))</span>
<a href="#l12.1025"></a><span id="l12.1025" class="difflineminus">-      writeGroup(fp, o);</span>
<a href="#l12.1026"></a><span id="l12.1026" class="difflineminus">-    else</span>
<a href="#l12.1027"></a><span id="l12.1027" class="difflineminus">-      appendsOFile(fp, NAME_OF(o));</span>
<a href="#l12.1028"></a><span id="l12.1028" class="difflineminus">-    if (pi) fields_ = pi-&gt;fields;</span>
<a href="#l12.1029"></a><span id="l12.1029" class="difflineminus">-    initPropIterator(&amp;t, o);</span>
<a href="#l12.1030"></a><span id="l12.1030" class="difflineminus">-    while (moreIteration(&amp;t)) {</span>
<a href="#l12.1031"></a><span id="l12.1031" class="difflineminus">-      const char *s;</span>
<a href="#l12.1032"></a><span id="l12.1032" class="difflineminus">-      VObject *eachProp = nextVObject(&amp;t);</span>
<a href="#l12.1033"></a><span id="l12.1033" class="difflineminus">-      s = NAME_OF(eachProp);</span>
<a href="#l12.1034"></a><span id="l12.1034" class="difflineminus">-      if (PL_strcasecmp(VCGroupingProp, s) &amp;&amp; !inList(fields_, s))</span>
<a href="#l12.1035"></a><span id="l12.1035" class="difflineminus">-        writeAttrValue(fp, eachProp, &amp;length);</span>
<a href="#l12.1036"></a><span id="l12.1036" class="difflineminus">-    }</span>
<a href="#l12.1037"></a><span id="l12.1037" class="difflineminus">-    if (fields_) {</span>
<a href="#l12.1038"></a><span id="l12.1038" class="difflineminus">-      int i = 0, n = 0;</span>
<a href="#l12.1039"></a><span id="l12.1039" class="difflineminus">-      const char **fields = fields_;</span>
<a href="#l12.1040"></a><span id="l12.1040" class="difflineminus">-      /* output prop as fields */</span>
<a href="#l12.1041"></a><span id="l12.1041" class="difflineminus">-      appendcOFile(fp, ':');</span>
<a href="#l12.1042"></a><span id="l12.1042" class="difflineminus">-      while (*fields) {</span>
<a href="#l12.1043"></a><span id="l12.1043" class="difflineminus">-        VObject *tt = isAPropertyOf(o, *fields);</span>
<a href="#l12.1044"></a><span id="l12.1044" class="difflineminus">-        i++;</span>
<a href="#l12.1045"></a><span id="l12.1045" class="difflineminus">-        if (tt) n = i;</span>
<a href="#l12.1046"></a><span id="l12.1046" class="difflineminus">-        fields++;</span>
<a href="#l12.1047"></a><span id="l12.1047" class="difflineminus">-      }</span>
<a href="#l12.1048"></a><span id="l12.1048" class="difflineminus">-      fields = fields_;</span>
<a href="#l12.1049"></a><span id="l12.1049" class="difflineminus">-      for (i = 0; i &lt; n; i++) {</span>
<a href="#l12.1050"></a><span id="l12.1050" class="difflineminus">-        writeValue(fp, isAPropertyOf(o, *fields), 0);</span>
<a href="#l12.1051"></a><span id="l12.1051" class="difflineminus">-        fields++;</span>
<a href="#l12.1052"></a><span id="l12.1052" class="difflineminus">-        if (i &lt; (n - 1)) appendcOFile(fp, ';');</span>
<a href="#l12.1053"></a><span id="l12.1053" class="difflineminus">-      }</span>
<a href="#l12.1054"></a><span id="l12.1054" class="difflineminus">-    }</span>
<a href="#l12.1055"></a><span id="l12.1055" class="difflineminus">-  }</span>
<a href="#l12.1056"></a><span id="l12.1056" class="difflineminus">-</span>
<a href="#l12.1057"></a><span id="l12.1057" class="difflineminus">-  if (VALUE_TYPE(o)) {</span>
<a href="#l12.1058"></a><span id="l12.1058" class="difflineminus">-    unsigned long size = 0;</span>
<a href="#l12.1059"></a><span id="l12.1059" class="difflineminus">-    VObject *p = isAPropertyOf(o, VCDataSizeProp);</span>
<a href="#l12.1060"></a><span id="l12.1060" class="difflineminus">-    if (p) size = LONG_VALUE_OF(p);</span>
<a href="#l12.1061"></a><span id="l12.1061" class="difflineminus">-    appendcOFile(fp, ':');</span>
<a href="#l12.1062"></a><span id="l12.1062" class="difflineminus">-    writeValue(fp, o, size);</span>
<a href="#l12.1063"></a><span id="l12.1063" class="difflineminus">-  }</span>
<a href="#l12.1064"></a><span id="l12.1064" class="difflineminus">-  appendcOFile(fp, '\n');</span>
<a href="#l12.1065"></a><span id="l12.1065" class="difflineminus">-}</span>
<a href="#l12.1066"></a><span id="l12.1066" class="difflineminus">-</span>
<a href="#l12.1067"></a><span id="l12.1067" class="difflineminus">-void writeVObject_(OFile *fp, VObject *o) {</span>
<a href="#l12.1068"></a><span id="l12.1068" class="difflineminus">-  // int ilen = 0;</span>
<a href="#l12.1069"></a><span id="l12.1069" class="difflineminus">-  if (NAME_OF(o)) {</span>
<a href="#l12.1070"></a><span id="l12.1070" class="difflineminus">-    struct PreDefProp *pi;</span>
<a href="#l12.1071"></a><span id="l12.1071" class="difflineminus">-    pi = lookupPropInfo(NAME_OF(o));</span>
<a href="#l12.1072"></a><span id="l12.1072" class="difflineminus">-</span>
<a href="#l12.1073"></a><span id="l12.1073" class="difflineminus">-    if (pi &amp;&amp; ((pi-&gt;flags &amp; PD_BEGIN) != 0)) {</span>
<a href="#l12.1074"></a><span id="l12.1074" class="difflineminus">-      VObjectIterator t;</span>
<a href="#l12.1075"></a><span id="l12.1075" class="difflineminus">-      const char *begin = NAME_OF(o);</span>
<a href="#l12.1076"></a><span id="l12.1076" class="difflineminus">-      appendsOFile(fp, &quot;begin:&quot;);</span>
<a href="#l12.1077"></a><span id="l12.1077" class="difflineminus">-      appendsOFile(fp, begin);</span>
<a href="#l12.1078"></a><span id="l12.1078" class="difflineminus">-      appendcOFile(fp, '\n');</span>
<a href="#l12.1079"></a><span id="l12.1079" class="difflineminus">-      initPropIterator(&amp;t, o);</span>
<a href="#l12.1080"></a><span id="l12.1080" class="difflineminus">-      while (moreIteration(&amp;t)) {</span>
<a href="#l12.1081"></a><span id="l12.1081" class="difflineminus">-        VObject *eachProp = nextVObject(&amp;t);</span>
<a href="#l12.1082"></a><span id="l12.1082" class="difflineminus">-        writeProp(fp, eachProp);</span>
<a href="#l12.1083"></a><span id="l12.1083" class="difflineminus">-      }</span>
<a href="#l12.1084"></a><span id="l12.1084" class="difflineminus">-      appendsOFile(fp, &quot;end:&quot;);</span>
<a href="#l12.1085"></a><span id="l12.1085" class="difflineminus">-      appendsOFile(fp, begin);</span>
<a href="#l12.1086"></a><span id="l12.1086" class="difflineminus">-      appendsOFile(fp, &quot;\n\n&quot;);</span>
<a href="#l12.1087"></a><span id="l12.1087" class="difflineminus">-    }</span>
<a href="#l12.1088"></a><span id="l12.1088" class="difflineminus">-  }</span>
<a href="#l12.1089"></a><span id="l12.1089" class="difflineminus">-}</span>
<a href="#l12.1090"></a><span id="l12.1090" class="difflineminus">-</span>
<a href="#l12.1091"></a><span id="l12.1091" class="difflineminus">-char *writeMemVObject(char *s, int *len, VObject *o) {</span>
<a href="#l12.1092"></a><span id="l12.1092" class="difflineminus">-  OFile ofp;</span>
<a href="#l12.1093"></a><span id="l12.1093" class="difflineminus">-  initMemOFile(&amp;ofp, s, len ? *len : 0);</span>
<a href="#l12.1094"></a><span id="l12.1094" class="difflineminus">-  writeVObject_(&amp;ofp, o);</span>
<a href="#l12.1095"></a><span id="l12.1095" class="difflineminus">-  if (len) *len = ofp.len;</span>
<a href="#l12.1096"></a><span id="l12.1096" class="difflineminus">-  appendcOFile(&amp;ofp, 0);</span>
<a href="#l12.1097"></a><span id="l12.1097" class="difflineminus">-  return ofp.s;</span>
<a href="#l12.1098"></a><span id="l12.1098" class="difflineminus">-}</span>
<a href="#l12.1099"></a><span id="l12.1099" class="difflineminus">-</span>
<a href="#l12.1100"></a><span id="l12.1100" class="difflineminus">-extern &quot;C&quot; char *writeMemoryVObjects(char *s, int *len, VObject *list,</span>
<a href="#l12.1101"></a><span id="l12.1101" class="difflineminus">-                                     bool expandSpaces) {</span>
<a href="#l12.1102"></a><span id="l12.1102" class="difflineminus">-  OFile ofp;</span>
<a href="#l12.1103"></a><span id="l12.1103" class="difflineminus">-  initMemOFile(&amp;ofp, s, len ? *len : 0);</span>
<a href="#l12.1104"></a><span id="l12.1104" class="difflineminus">-  while (list) {</span>
<a href="#l12.1105"></a><span id="l12.1105" class="difflineminus">-    writeVObject_(&amp;ofp, list);</span>
<a href="#l12.1106"></a><span id="l12.1106" class="difflineminus">-    list = nextVObjectInList(list);</span>
<a href="#l12.1107"></a><span id="l12.1107" class="difflineminus">-  }</span>
<a href="#l12.1108"></a><span id="l12.1108" class="difflineminus">-  if (len) *len = ofp.len;</span>
<a href="#l12.1109"></a><span id="l12.1109" class="difflineminus">-  appendcOFile(&amp;ofp, 0);</span>
<a href="#l12.1110"></a><span id="l12.1110" class="difflineminus">-  return ofp.s;</span>
<a href="#l12.1111"></a><span id="l12.1111" class="difflineminus">-}</span>
<a href="#l12.1112"></a><span id="l12.1112" class="difflineminus">-</span>
<a href="#l12.1113"></a><span id="l12.1113" class="difflineminus">-/*----------------------------------------------------------------------</span>
<a href="#l12.1114"></a><span id="l12.1114" class="difflineminus">-  APIs to do fake Unicode stuff.</span>
<a href="#l12.1115"></a><span id="l12.1115" class="difflineminus">-  ----------------------------------------------------------------------*/</span>
<a href="#l12.1116"></a><span id="l12.1116" class="difflineminus">-vwchar_t *fakeUnicode(const char *ps, int *bytes) {</span>
<a href="#l12.1117"></a><span id="l12.1117" class="difflineminus">-  vwchar_t *r, *pw;</span>
<a href="#l12.1118"></a><span id="l12.1118" class="difflineminus">-  int len = strlen(ps) + 1;</span>
<a href="#l12.1119"></a><span id="l12.1119" class="difflineminus">-</span>
<a href="#l12.1120"></a><span id="l12.1120" class="difflineminus">-  pw = r = (vwchar_t *)PR_CALLOC(sizeof(vwchar_t) * len);</span>
<a href="#l12.1121"></a><span id="l12.1121" class="difflineminus">-  if (bytes) *bytes = len * sizeof(vwchar_t);</span>
<a href="#l12.1122"></a><span id="l12.1122" class="difflineminus">-</span>
<a href="#l12.1123"></a><span id="l12.1123" class="difflineminus">-  while (*ps) {</span>
<a href="#l12.1124"></a><span id="l12.1124" class="difflineminus">-    if (*ps == '\n')</span>
<a href="#l12.1125"></a><span id="l12.1125" class="difflineminus">-      *pw = (vwchar_t)0x2028;</span>
<a href="#l12.1126"></a><span id="l12.1126" class="difflineminus">-    else if (*ps == '\r')</span>
<a href="#l12.1127"></a><span id="l12.1127" class="difflineminus">-      *pw = (vwchar_t)0x2029;</span>
<a href="#l12.1128"></a><span id="l12.1128" class="difflineminus">-    else</span>
<a href="#l12.1129"></a><span id="l12.1129" class="difflineminus">-      *pw = (vwchar_t)(unsigned char)*ps;</span>
<a href="#l12.1130"></a><span id="l12.1130" class="difflineminus">-    ps++;</span>
<a href="#l12.1131"></a><span id="l12.1131" class="difflineminus">-    pw++;</span>
<a href="#l12.1132"></a><span id="l12.1132" class="difflineminus">-  }</span>
<a href="#l12.1133"></a><span id="l12.1133" class="difflineminus">-  *pw = (vwchar_t)0;</span>
<a href="#l12.1134"></a><span id="l12.1134" class="difflineminus">-</span>
<a href="#l12.1135"></a><span id="l12.1135" class="difflineminus">-  return r;</span>
<a href="#l12.1136"></a><span id="l12.1136" class="difflineminus">-}</span>
<a href="#l12.1137"></a><span id="l12.1137" class="difflineminus">-</span>
<a href="#l12.1138"></a><span id="l12.1138" class="difflineminus">-int uStrLen(const vwchar_t *u) {</span>
<a href="#l12.1139"></a><span id="l12.1139" class="difflineminus">-  if (!u) return 0;</span>
<a href="#l12.1140"></a><span id="l12.1140" class="difflineminus">-  int i = 0;</span>
<a href="#l12.1141"></a><span id="l12.1141" class="difflineminus">-  while (*u != (vwchar_t)0) {</span>
<a href="#l12.1142"></a><span id="l12.1142" class="difflineminus">-    u++;</span>
<a href="#l12.1143"></a><span id="l12.1143" class="difflineminus">-    i++;</span>
<a href="#l12.1144"></a><span id="l12.1144" class="difflineminus">-  }</span>
<a href="#l12.1145"></a><span id="l12.1145" class="difflineminus">-  return i;</span>
<a href="#l12.1146"></a><span id="l12.1146" class="difflineminus">-}</span>
<a href="#l12.1147"></a><span id="l12.1147" class="difflineminus">-</span>
<a href="#l12.1148"></a><span id="l12.1148" class="difflineminus">-char *fakeCString(const vwchar_t *u) {</span>
<a href="#l12.1149"></a><span id="l12.1149" class="difflineminus">-  char *s, *t;</span>
<a href="#l12.1150"></a><span id="l12.1150" class="difflineminus">-  int len = uStrLen(u) + 1;</span>
<a href="#l12.1151"></a><span id="l12.1151" class="difflineminus">-  t = s = (char *)PR_CALLOC(len);</span>
<a href="#l12.1152"></a><span id="l12.1152" class="difflineminus">-  if (u) {</span>
<a href="#l12.1153"></a><span id="l12.1153" class="difflineminus">-    while (*u) {</span>
<a href="#l12.1154"></a><span id="l12.1154" class="difflineminus">-      if (*u == (vwchar_t)0x2028)</span>
<a href="#l12.1155"></a><span id="l12.1155" class="difflineminus">-        *t = '\n';</span>
<a href="#l12.1156"></a><span id="l12.1156" class="difflineminus">-      else if (*u == (vwchar_t)0x2029)</span>
<a href="#l12.1157"></a><span id="l12.1157" class="difflineminus">-        *t = '\r';</span>
<a href="#l12.1158"></a><span id="l12.1158" class="difflineminus">-      else</span>
<a href="#l12.1159"></a><span id="l12.1159" class="difflineminus">-        *t = (char)*u;</span>
<a href="#l12.1160"></a><span id="l12.1160" class="difflineminus">-      u++;</span>
<a href="#l12.1161"></a><span id="l12.1161" class="difflineminus">-      t++;</span>
<a href="#l12.1162"></a><span id="l12.1162" class="difflineminus">-    }</span>
<a href="#l12.1163"></a><span id="l12.1163" class="difflineminus">-  }</span>
<a href="#l12.1164"></a><span id="l12.1164" class="difflineminus">-  *t = 0;</span>
<a href="#l12.1165"></a><span id="l12.1165" class="difflineminus">-  return s;</span>
<a href="#l12.1166"></a><span id="l12.1166" class="difflineminus">-}</span>
<a href="#l12.1167"></a><span id="l12.1167" class="difflineminus">-</span>
<a href="#l12.1168"></a><span id="l12.1168" class="difflineminus">-const char *lookupStr(const char *s) {</span>
<a href="#l12.1169"></a><span id="l12.1169" class="difflineminus">-  StrItem *t;</span>
<a href="#l12.1170"></a><span id="l12.1170" class="difflineminus">-  unsigned int h = hashStr(s);</span>
<a href="#l12.1171"></a><span id="l12.1171" class="difflineminus">-  if ((t = strTbl[h]) != 0) {</span>
<a href="#l12.1172"></a><span id="l12.1172" class="difflineminus">-    do {</span>
<a href="#l12.1173"></a><span id="l12.1173" class="difflineminus">-      if (PL_strcasecmp(t-&gt;s, s) == 0) {</span>
<a href="#l12.1174"></a><span id="l12.1174" class="difflineminus">-        t-&gt;refCnt++;</span>
<a href="#l12.1175"></a><span id="l12.1175" class="difflineminus">-        return t-&gt;s;</span>
<a href="#l12.1176"></a><span id="l12.1176" class="difflineminus">-      }</span>
<a href="#l12.1177"></a><span id="l12.1177" class="difflineminus">-      t = t-&gt;next;</span>
<a href="#l12.1178"></a><span id="l12.1178" class="difflineminus">-    } while (t);</span>
<a href="#l12.1179"></a><span id="l12.1179" class="difflineminus">-  }</span>
<a href="#l12.1180"></a><span id="l12.1180" class="difflineminus">-  s = dupStr(s, 0);</span>
<a href="#l12.1181"></a><span id="l12.1181" class="difflineminus">-  strTbl[h] = newStrItem(s, strTbl[h]);</span>
<a href="#l12.1182"></a><span id="l12.1182" class="difflineminus">-  return s;</span>
<a href="#l12.1183"></a><span id="l12.1183" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">deleted file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- a/mailnews/addrbook/src/nsVCardObj.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ /dev/null</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -1,397 +0,0 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineminus">-/* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">-/***************************************************************************</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-(C) Copyright 1996 Apple Computer, Inc., AT&amp;T Corp., International</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">-Business Machines Corporation and Siemens Rolm Communications Inc.</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-For purposes of this license notice, the term Licensors shall mean,</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-collectively, Apple Computer, Inc., AT&amp;T Corp., International</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-Business Machines Corporation and Siemens Rolm Communications Inc.</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-The term Licensor shall mean any of the Licensors.</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-Subject to acceptance of the following conditions, permission is hereby</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-granted by Licensors without the need for written agreement and without</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-license or royalty fees, to use, copy, modify and distribute this</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-software for any purpose.</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-The above copyright notice and the following four paragraphs must be</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-reproduced in all copies of this software and any software including</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-this software.</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">-THIS SOFTWARE IS PROVIDED ON AN &quot;AS IS&quot; BASIS AND NO LICENSOR SHALL HAVE</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-ANY OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS OR</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-MODIFICATIONS.</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-IN NO EVENT SHALL ANY LICENSOR BE LIABLE TO ANY PARTY FOR DIRECT,</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES OR LOST PROFITS ARISING OUT</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-OF THE USE OF THIS SOFTWARE EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-DAMAGE.</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-EACH LICENSOR SPECIFICALLY DISCLAIMS ANY WARRANTIES, EXPRESS OR IMPLIED,</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-INCLUDING BUT NOT LIMITED TO ANY WARRANTY OF NONINFRINGEMENT OR THE</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-PURPOSE.</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-The software is provided with RESTRICTED RIGHTS.  Use, duplication, or</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-disclosure by the government are subject to restrictions set forth in</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-DFARS 252.227-7013 or 48 CFR 52.227-19, as applicable.</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-***************************************************************************/</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-/*</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-The vCard/vCalendar C interface is implemented in the set</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-of files as follows:</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-vcc.y, yacc source, and vcc.c, the yacc output you will use</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-implements the core parser</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-vobject.c implements an API that insulates the caller from</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-the parser and changes in the vCard/vCalendar BNF</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-port.h defines compilation environment dependent stuff</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-vcc.h and vobject.h are header files for their .c counterparts</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-vcaltmp.h and vcaltmp.c implement vCalendar &quot;macro&quot; functions</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-which you may find useful.</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineminus">-</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineminus">-test.c is a standalone test driver that exercises some of</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-the features of the APIs provided. Invoke test.exe on a</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-VCARD/VCALENDAR input text file and you will see the pretty</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-print output of the internal representation (this pretty print</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-output should give you a good idea of how the internal</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-representation looks like -- there is one such output in the</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-following too). Also, a file with the .out suffix is generated</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-to show that the internal representation can be written back</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-in the original text format.</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineminus">-For more information on this API see the readme.txt file</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineminus">-which accompanied this distribution.</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineminus">-</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineminus">-  Also visit:</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineminus">-</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineminus">-    http://www.versit.com</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-    http://www.ralden.com</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineminus">-*/</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineminus">-</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineminus">-#ifndef __VOBJECT_H__</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineminus">-#define __VOBJECT_H__ 1</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineminus">-</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-/*</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-Unfortunately, on the Mac (and possibly other platforms) with our current,</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-out-dated libraries (Plauger), |wchar_t| is defined incorrectly, which breaks</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">-vcards.</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineminus">-We can't fix Plauger because it doesn't come with source. Later, when we</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineminus">-upgrade to MSL, we can make this evil hack go away.  In the mean time,</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineminus">-vcards are not allowed to use the (incorrectly defined) |wchar_t| type. Instead,</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineminus">-they will use an appropriately defined local type |vwchar_t|.</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineminus">-*/</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineminus">-</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineminus">-typedef wchar_t vwchar_t;</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineminus">-</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineminus">-extern &quot;C&quot; {</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineminus">-#endif</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineminus">-</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineminus">-#define VC7bitProp &quot;7bit&quot;</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineminus">-#define VC8bitProp &quot;8bit&quot;</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineminus">-#define VCAAlarmProp &quot;aalarm&quot;</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineminus">-#define VCAdditionalNamesProp &quot;addn&quot;</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-#define VCAdrProp &quot;adr&quot;</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineminus">-#define VCAgentProp &quot;agent&quot;</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineminus">-#define VCAIFFProp &quot;aiff&quot;</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineminus">-#define VCAOLProp &quot;aol&quot;</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineminus">-#define VCAppleLinkProp &quot;applelink&quot;</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-#define VCAttachProp &quot;attach&quot;</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineminus">-#define VCAttendeeProp &quot;attendee&quot;</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineminus">-#define VCATTMailProp &quot;attmail&quot;</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineminus">-#define VCAudioContentProp &quot;audiocontent&quot;</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineminus">-#define VCAVIProp &quot;avi&quot;</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineminus">-#define VCBase64Prop &quot;base64&quot;</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineminus">-#define VCBBSProp &quot;bbs&quot;</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineminus">-#define VCBirthDateProp &quot;bday&quot;</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineminus">-#define VCBMPProp &quot;bmp&quot;</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineminus">-#define VCBodyProp &quot;body&quot;</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineminus">-#define VCBusinessRoleProp &quot;role&quot;</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineminus">-#define VCCalProp &quot;vcalendar&quot;</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineminus">-#define VCCaptionProp &quot;cap&quot;</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineminus">-#define VCCardProp &quot;vcard&quot;</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-#define VCCarProp &quot;car&quot;</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineminus">-#define VCCategoriesProp &quot;categories&quot;</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineminus">-#define VCCellularProp &quot;cell&quot;</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineminus">-#define VCCGMProp &quot;cgm&quot;</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineminus">-#define VCCharSetProp &quot;cs&quot;</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineminus">-#define VCCIDProp &quot;cid&quot;</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineminus">-#define VCCISProp &quot;cis&quot;</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineminus">-#define VCCityProp &quot;l&quot;</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineminus">-#define VCClassProp &quot;class&quot;</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineminus">-#define VCCommentProp &quot;note&quot;</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineminus">-#define VCCompletedProp &quot;completed&quot;</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineminus">-#define VCContentIDProp &quot;content-id&quot;</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineminus">-#define VCCountryNameProp &quot;c&quot;</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineminus">-#define VCDAlarmProp &quot;dalarm&quot;</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineminus">-#define VCDataSizeProp &quot;datasize&quot;</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineminus">-#define VCDayLightProp &quot;daylight&quot;</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineminus">-#define VCDCreatedProp &quot;dcreated&quot;</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineminus">-#define VCDeliveryLabelProp &quot;label&quot;</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-#define VCDescriptionProp &quot;description&quot;</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineminus">-#define VCDIBProp &quot;dib&quot;</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineminus">-#define VCDisplayStringProp &quot;displaystring&quot;</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineminus">-#define VCDomesticProp &quot;dom&quot;</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineminus">-#define VCDTendProp &quot;dtend&quot;</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineminus">-#define VCDTstartProp &quot;dtstart&quot;</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineminus">-#define VCDueProp &quot;due&quot;</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineminus">-#define VCEmailAddressProp &quot;email&quot;</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineminus">-#define VCEncodingProp &quot;encoding&quot;</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineminus">-#define VCEndProp &quot;end&quot;</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineminus">-#define VCEventProp &quot;vevent&quot;</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineminus">-#define VCEWorldProp &quot;eworld&quot;</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineminus">-#define VCExNumProp &quot;exnum&quot;</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineminus">-#define VCExpDateProp &quot;exdate&quot;</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineminus">-#define VCExpectProp &quot;expect&quot;</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineminus">-#define VCExtAddressProp &quot;ext add&quot;</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineminus">-#define VCFamilyNameProp &quot;f&quot;</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineminus">-#define VCFaxProp &quot;fax&quot;</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineminus">-#define VCFullNameProp &quot;fn&quot;</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineminus">-#define VCGeoProp &quot;geo&quot;</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineminus">-#define VCGeoLocationProp &quot;geo&quot;</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineminus">-#define VCGIFProp &quot;gif&quot;</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineminus">-#define VCGivenNameProp &quot;g&quot;</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineminus">-#define VCGroupingProp &quot;grouping&quot;</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineminus">-#define VCHomeProp &quot;home&quot;</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineminus">-#define VCIBMMailProp &quot;ibmmail&quot;</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineminus">-#define VCInlineProp &quot;inline&quot;</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineminus">-#define VCInternationalProp &quot;intl&quot;</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineminus">-#define VCInternetProp &quot;internet&quot;</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineminus">-#define VCISDNProp &quot;isdn&quot;</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineminus">-#define VCJPEGProp &quot;jpeg&quot;</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineminus">-#define VCLanguageProp &quot;lang&quot;</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineminus">-#define VCLastModifiedProp &quot;last-modified&quot;</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineminus">-#define VCLastRevisedProp &quot;rev&quot;</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineminus">-#define VCLocationProp &quot;location&quot;</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineminus">-#define VCLogoProp &quot;logo&quot;</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineminus">-#define VCMailerProp &quot;mailer&quot;</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineminus">-#define VCMAlarmProp &quot;malarm&quot;</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineminus">-#define VCMCIMailProp &quot;mcimail&quot;</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineminus">-#define VCMessageProp &quot;msg&quot;</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineminus">-#define VCMETProp &quot;met&quot;</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineminus">-#define VCModemProp &quot;modem&quot;</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineminus">-#define VCMPEG2Prop &quot;mpeg2&quot;</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineminus">-#define VCMPEGProp &quot;mpeg&quot;</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineminus">-#define VCMSNProp &quot;msn&quot;</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineminus">-#define VCNamePrefixesProp &quot;npre&quot;</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineminus">-#define VCNameProp &quot;n&quot;</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineminus">-#define VCNameSuffixesProp &quot;nsuf&quot;</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineminus">-#define VCNoteProp &quot;note&quot;</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineminus">-#define VCOrgNameProp &quot;orgname&quot;</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineminus">-#define VCOrgProp &quot;org&quot;</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineminus">-#define VCOrgUnit2Prop &quot;oun2&quot;</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineminus">-#define VCOrgUnit3Prop &quot;oun3&quot;</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineminus">-#define VCOrgUnit4Prop &quot;oun4&quot;</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineminus">-#define VCOrgUnitProp &quot;oun&quot;</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineminus">-#define VCPagerProp &quot;pager&quot;</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineminus">-#define VCPAlarmProp &quot;palarm&quot;</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineminus">-#define VCParcelProp &quot;parcel&quot;</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineminus">-#define VCPartProp &quot;part&quot;</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineminus">-#define VCPCMProp &quot;pcm&quot;</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineminus">-#define VCPDFProp &quot;pdf&quot;</span>
<a href="#l13.207"></a><span id="l13.207" class="difflineminus">-#define VCPGPProp &quot;pgp&quot;</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineminus">-#define VCPhotoProp &quot;photo&quot;</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineminus">-#define VCPICTProp &quot;pict&quot;</span>
<a href="#l13.210"></a><span id="l13.210" class="difflineminus">-#define VCPMBProp &quot;pmb&quot;</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineminus">-#define VCPostalBoxProp &quot;box&quot;</span>
<a href="#l13.212"></a><span id="l13.212" class="difflineminus">-#define VCPostalCodeProp &quot;pc&quot;</span>
<a href="#l13.213"></a><span id="l13.213" class="difflineminus">-#define VCPostalProp &quot;postal&quot;</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineminus">-#define VCPowerShareProp &quot;powershare&quot;</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineminus">-#define VCPreferredProp &quot;pref&quot;</span>
<a href="#l13.216"></a><span id="l13.216" class="difflineminus">-#define VCPriorityProp &quot;priority&quot;</span>
<a href="#l13.217"></a><span id="l13.217" class="difflineminus">-#define VCProcedureNameProp &quot;procedurename&quot;</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineminus">-#define VCProdIdProp &quot;prodid&quot;</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineminus">-#define VCProdigyProp &quot;prodigy&quot;</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineminus">-#define VCPronunciationProp &quot;sound&quot;</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineminus">-#define VCPSProp &quot;ps&quot;</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineminus">-#define VCPublicKeyProp &quot;key&quot;</span>
<a href="#l13.223"></a><span id="l13.223" class="difflineminus">-#define VCQPProp &quot;qp&quot;</span>
<a href="#l13.224"></a><span id="l13.224" class="difflineminus">-#define VCQuickTimeProp &quot;qtime&quot;</span>
<a href="#l13.225"></a><span id="l13.225" class="difflineminus">-#define VCQuotedPrintableProp &quot;quoted-printable&quot;</span>
<a href="#l13.226"></a><span id="l13.226" class="difflineminus">-#define VCRDateProp &quot;rdate&quot;</span>
<a href="#l13.227"></a><span id="l13.227" class="difflineminus">-#define VCRegionProp &quot;r&quot;</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineminus">-#define VCRelatedToProp &quot;related-to&quot;</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineminus">-#define VCRepeatCountProp &quot;repeatcount&quot;</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineminus">-#define VCResourcesProp &quot;resources&quot;</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineminus">-#define VCRNumProp &quot;rnum&quot;</span>
<a href="#l13.232"></a><span id="l13.232" class="difflineminus">-#define VCRoleProp &quot;role&quot;</span>
<a href="#l13.233"></a><span id="l13.233" class="difflineminus">-#define VCRRuleProp &quot;rrule&quot;</span>
<a href="#l13.234"></a><span id="l13.234" class="difflineminus">-#define VCRSVPProp &quot;rsvp&quot;</span>
<a href="#l13.235"></a><span id="l13.235" class="difflineminus">-#define VCRunTimeProp &quot;runtime&quot;</span>
<a href="#l13.236"></a><span id="l13.236" class="difflineminus">-#define VCSequenceProp &quot;sequence&quot;</span>
<a href="#l13.237"></a><span id="l13.237" class="difflineminus">-#define VCSnoozeTimeProp &quot;snoozetime&quot;</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineminus">-#define VCStartProp &quot;start&quot;</span>
<a href="#l13.239"></a><span id="l13.239" class="difflineminus">-#define VCStatusProp &quot;status&quot;</span>
<a href="#l13.240"></a><span id="l13.240" class="difflineminus">-#define VCStreetAddressProp &quot;street&quot;</span>
<a href="#l13.241"></a><span id="l13.241" class="difflineminus">-#define VCSubTypeProp &quot;subtype&quot;</span>
<a href="#l13.242"></a><span id="l13.242" class="difflineminus">-#define VCSummaryProp &quot;summary&quot;</span>
<a href="#l13.243"></a><span id="l13.243" class="difflineminus">-#define VCTelephoneProp &quot;tel&quot;</span>
<a href="#l13.244"></a><span id="l13.244" class="difflineminus">-#define VCTIFFProp &quot;tiff&quot;</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineminus">-#define VCTimeZoneProp &quot;tz&quot;</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineminus">-#define VCTitleProp &quot;title&quot;</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineminus">-#define VCTLXProp &quot;tlx&quot;</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineminus">-#define VCTodoProp &quot;vtodo&quot;</span>
<a href="#l13.249"></a><span id="l13.249" class="difflineminus">-#define VCTranspProp &quot;transp&quot;</span>
<a href="#l13.250"></a><span id="l13.250" class="difflineminus">-#define VCUniqueStringProp &quot;uid&quot;</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineminus">-#define VCURLProp &quot;url&quot;</span>
<a href="#l13.252"></a><span id="l13.252" class="difflineminus">-#define VCURLValueProp &quot;urlval&quot;</span>
<a href="#l13.253"></a><span id="l13.253" class="difflineminus">-#define VCValueProp &quot;value&quot;</span>
<a href="#l13.254"></a><span id="l13.254" class="difflineminus">-#define VCVersionProp &quot;version&quot;</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineminus">-#define VCVideoProp &quot;video&quot;</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineminus">-#define VCVoiceProp &quot;voice&quot;</span>
<a href="#l13.257"></a><span id="l13.257" class="difflineminus">-#define VCWAVEProp &quot;wave&quot;</span>
<a href="#l13.258"></a><span id="l13.258" class="difflineminus">-#define VCWMFProp &quot;wmf&quot;</span>
<a href="#l13.259"></a><span id="l13.259" class="difflineminus">-#define VCWorkProp &quot;work&quot;</span>
<a href="#l13.260"></a><span id="l13.260" class="difflineminus">-#define VCX400Prop &quot;x400&quot;</span>
<a href="#l13.261"></a><span id="l13.261" class="difflineminus">-#define VCX509Prop &quot;x509&quot;</span>
<a href="#l13.262"></a><span id="l13.262" class="difflineminus">-#define VCXRuleProp &quot;xrule&quot;</span>
<a href="#l13.263"></a><span id="l13.263" class="difflineminus">-#define VCCooltalk &quot;x-mozilla-cpt&quot;</span>
<a href="#l13.264"></a><span id="l13.264" class="difflineminus">-#define VCCooltalkAddress &quot;x-moxilla-cpadr&quot;</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineminus">-#define VCUseServer &quot;x-mozilla-cpsrv&quot;</span>
<a href="#l13.266"></a><span id="l13.266" class="difflineminus">-#define VCUseHTML &quot;x-mozilla-html&quot;</span>
<a href="#l13.267"></a><span id="l13.267" class="difflineminus">-</span>
<a href="#l13.268"></a><span id="l13.268" class="difflineminus">-/* return type of vObjectValueType: */</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineminus">-#define VCVT_NOVALUE 0</span>
<a href="#l13.270"></a><span id="l13.270" class="difflineminus">-/* if the VObject has no value associated with it. */</span>
<a href="#l13.271"></a><span id="l13.271" class="difflineminus">-#define VCVT_STRINGZ 1</span>
<a href="#l13.272"></a><span id="l13.272" class="difflineminus">-/* if the VObject has value set by setVObjectStringZValue. */</span>
<a href="#l13.273"></a><span id="l13.273" class="difflineminus">-#define VCVT_USTRINGZ 2</span>
<a href="#l13.274"></a><span id="l13.274" class="difflineminus">-/* if the VObject has value set by setVObjectUStringZValue. */</span>
<a href="#l13.275"></a><span id="l13.275" class="difflineminus">-#define VCVT_UINT 3</span>
<a href="#l13.276"></a><span id="l13.276" class="difflineminus">-/* if the VObject has value set by setVObjectIntegerValue. */</span>
<a href="#l13.277"></a><span id="l13.277" class="difflineminus">-#define VCVT_ULONG 4</span>
<a href="#l13.278"></a><span id="l13.278" class="difflineminus">-/* if the VObject has value set by setVObjectLongValue. */</span>
<a href="#l13.279"></a><span id="l13.279" class="difflineminus">-#define VCVT_RAW 5</span>
<a href="#l13.280"></a><span id="l13.280" class="difflineminus">-/* if the VObject has value set by setVObjectAnyValue. */</span>
<a href="#l13.281"></a><span id="l13.281" class="difflineminus">-#define VCVT_VOBJECT 6</span>
<a href="#l13.282"></a><span id="l13.282" class="difflineminus">-/* if the VObject has value set by setVObjectVObjectValue. */</span>
<a href="#l13.283"></a><span id="l13.283" class="difflineminus">-</span>
<a href="#l13.284"></a><span id="l13.284" class="difflineminus">-#define NAME_OF(o) o-&gt;id</span>
<a href="#l13.285"></a><span id="l13.285" class="difflineminus">-#define VALUE_TYPE(o) o-&gt;valType</span>
<a href="#l13.286"></a><span id="l13.286" class="difflineminus">-#define STRINGZ_VALUE_OF(o) o-&gt;val.strs</span>
<a href="#l13.287"></a><span id="l13.287" class="difflineminus">-#define USTRINGZ_VALUE_OF(o) o-&gt;val.ustrs</span>
<a href="#l13.288"></a><span id="l13.288" class="difflineminus">-#define INTEGER_VALUE_OF(o) o-&gt;val.i</span>
<a href="#l13.289"></a><span id="l13.289" class="difflineminus">-#define LONG_VALUE_OF(o) o-&gt;val.l</span>
<a href="#l13.290"></a><span id="l13.290" class="difflineminus">-#define ANY_VALUE_OF(o) o-&gt;val.any</span>
<a href="#l13.291"></a><span id="l13.291" class="difflineminus">-#define VOBJECT_VALUE_OF(o) o-&gt;val.vobj</span>
<a href="#l13.292"></a><span id="l13.292" class="difflineminus">-</span>
<a href="#l13.293"></a><span id="l13.293" class="difflineminus">-typedef struct VObject VObject;</span>
<a href="#l13.294"></a><span id="l13.294" class="difflineminus">-</span>
<a href="#l13.295"></a><span id="l13.295" class="difflineminus">-typedef union ValueItem {</span>
<a href="#l13.296"></a><span id="l13.296" class="difflineminus">-  const char *strs;</span>
<a href="#l13.297"></a><span id="l13.297" class="difflineminus">-  const vwchar_t *ustrs;</span>
<a href="#l13.298"></a><span id="l13.298" class="difflineminus">-  unsigned int i;</span>
<a href="#l13.299"></a><span id="l13.299" class="difflineminus">-  unsigned long l;</span>
<a href="#l13.300"></a><span id="l13.300" class="difflineminus">-  void *any;</span>
<a href="#l13.301"></a><span id="l13.301" class="difflineminus">-  VObject *vobj;</span>
<a href="#l13.302"></a><span id="l13.302" class="difflineminus">-} ValueItem;</span>
<a href="#l13.303"></a><span id="l13.303" class="difflineminus">-</span>
<a href="#l13.304"></a><span id="l13.304" class="difflineminus">-struct VObject {</span>
<a href="#l13.305"></a><span id="l13.305" class="difflineminus">-  VObject *next;</span>
<a href="#l13.306"></a><span id="l13.306" class="difflineminus">-  const char *id;</span>
<a href="#l13.307"></a><span id="l13.307" class="difflineminus">-  VObject *prop;</span>
<a href="#l13.308"></a><span id="l13.308" class="difflineminus">-  unsigned short valType;</span>
<a href="#l13.309"></a><span id="l13.309" class="difflineminus">-  ValueItem val;</span>
<a href="#l13.310"></a><span id="l13.310" class="difflineminus">-};</span>
<a href="#l13.311"></a><span id="l13.311" class="difflineminus">-</span>
<a href="#l13.312"></a><span id="l13.312" class="difflineminus">-typedef struct StrItem StrItem;</span>
<a href="#l13.313"></a><span id="l13.313" class="difflineminus">-</span>
<a href="#l13.314"></a><span id="l13.314" class="difflineminus">-struct StrItem {</span>
<a href="#l13.315"></a><span id="l13.315" class="difflineminus">-  StrItem *next;</span>
<a href="#l13.316"></a><span id="l13.316" class="difflineminus">-  const char *s;</span>
<a href="#l13.317"></a><span id="l13.317" class="difflineminus">-  unsigned int refCnt;</span>
<a href="#l13.318"></a><span id="l13.318" class="difflineminus">-};</span>
<a href="#l13.319"></a><span id="l13.319" class="difflineminus">-</span>
<a href="#l13.320"></a><span id="l13.320" class="difflineminus">-typedef struct OFile {</span>
<a href="#l13.321"></a><span id="l13.321" class="difflineminus">-  char *s;</span>
<a href="#l13.322"></a><span id="l13.322" class="difflineminus">-  int len;</span>
<a href="#l13.323"></a><span id="l13.323" class="difflineminus">-  int limit;</span>
<a href="#l13.324"></a><span id="l13.324" class="difflineminus">-  int alloc : 1;</span>
<a href="#l13.325"></a><span id="l13.325" class="difflineminus">-  int fail : 1;</span>
<a href="#l13.326"></a><span id="l13.326" class="difflineminus">-} OFile;</span>
<a href="#l13.327"></a><span id="l13.327" class="difflineminus">-</span>
<a href="#l13.328"></a><span id="l13.328" class="difflineminus">-typedef struct VObjectIterator {</span>
<a href="#l13.329"></a><span id="l13.329" class="difflineminus">-  VObject *start;</span>
<a href="#l13.330"></a><span id="l13.330" class="difflineminus">-  VObject *next;</span>
<a href="#l13.331"></a><span id="l13.331" class="difflineminus">-} VObjectIterator;</span>
<a href="#l13.332"></a><span id="l13.332" class="difflineminus">-</span>
<a href="#l13.333"></a><span id="l13.333" class="difflineminus">-VObject *newVObject(const char *id);</span>
<a href="#l13.334"></a><span id="l13.334" class="difflineminus">-void deleteVObject(VObject *p);</span>
<a href="#l13.335"></a><span id="l13.335" class="difflineminus">-char *dupStr(const char *s, unsigned int size);</span>
<a href="#l13.336"></a><span id="l13.336" class="difflineminus">-extern &quot;C&quot; void deleteString(char *p);</span>
<a href="#l13.337"></a><span id="l13.337" class="difflineminus">-void unUseStr(const char *s);</span>
<a href="#l13.338"></a><span id="l13.338" class="difflineminus">-</span>
<a href="#l13.339"></a><span id="l13.339" class="difflineminus">-void setVObjectName(VObject *o, const char *id);</span>
<a href="#l13.340"></a><span id="l13.340" class="difflineminus">-void setVObjectStringZValue(VObject *o, const char *s);</span>
<a href="#l13.341"></a><span id="l13.341" class="difflineminus">-void setVObjectStringZValue_(VObject *o, const char *s);</span>
<a href="#l13.342"></a><span id="l13.342" class="difflineminus">-void setVObjectUStringZValue(VObject *o, const vwchar_t *s);</span>
<a href="#l13.343"></a><span id="l13.343" class="difflineminus">-void setVObjectUStringZValue_(VObject *o, const vwchar_t *s);</span>
<a href="#l13.344"></a><span id="l13.344" class="difflineminus">-void setVObjectIntegerValue(VObject *o, unsigned int i);</span>
<a href="#l13.345"></a><span id="l13.345" class="difflineminus">-void setVObjectLongValue(VObject *o, unsigned long l);</span>
<a href="#l13.346"></a><span id="l13.346" class="difflineminus">-void setVObjectAnyValue(VObject *o, void *t);</span>
<a href="#l13.347"></a><span id="l13.347" class="difflineminus">-VObject *setValueWithSize(VObject *prop, void *val, unsigned int size);</span>
<a href="#l13.348"></a><span id="l13.348" class="difflineminus">-VObject *setValueWithSize_(VObject *prop, void *val, unsigned int size);</span>
<a href="#l13.349"></a><span id="l13.349" class="difflineminus">-</span>
<a href="#l13.350"></a><span id="l13.350" class="difflineminus">-const char *vObjectName(VObject *o);</span>
<a href="#l13.351"></a><span id="l13.351" class="difflineminus">-const char *vObjectStringZValue(VObject *o);</span>
<a href="#l13.352"></a><span id="l13.352" class="difflineminus">-const vwchar_t *vObjectUStringZValue(VObject *o);</span>
<a href="#l13.353"></a><span id="l13.353" class="difflineminus">-unsigned int vObjectIntegerValue(VObject *o);</span>
<a href="#l13.354"></a><span id="l13.354" class="difflineminus">-unsigned long vObjectLongValue(VObject *o);</span>
<a href="#l13.355"></a><span id="l13.355" class="difflineminus">-void *vObjectAnyValue(VObject *o);</span>
<a href="#l13.356"></a><span id="l13.356" class="difflineminus">-VObject *vObjectVObjectValue(VObject *o);</span>
<a href="#l13.357"></a><span id="l13.357" class="difflineminus">-void setVObjectVObjectValue(VObject *o, VObject *p);</span>
<a href="#l13.358"></a><span id="l13.358" class="difflineminus">-</span>
<a href="#l13.359"></a><span id="l13.359" class="difflineminus">-VObject *addVObjectProp(VObject *o, VObject *p);</span>
<a href="#l13.360"></a><span id="l13.360" class="difflineminus">-VObject *addProp(VObject *o, const char *id);</span>
<a href="#l13.361"></a><span id="l13.361" class="difflineminus">-VObject *addProp_(VObject *o, const char *id);</span>
<a href="#l13.362"></a><span id="l13.362" class="difflineminus">-VObject *addPropValue(VObject *o, const char *p, const char *v);</span>
<a href="#l13.363"></a><span id="l13.363" class="difflineminus">-VObject *addPropSizedValue_(VObject *o, const char *p, const char *v,</span>
<a href="#l13.364"></a><span id="l13.364" class="difflineminus">-                            unsigned int size);</span>
<a href="#l13.365"></a><span id="l13.365" class="difflineminus">-VObject *addPropSizedValue(VObject *o, const char *p, const char *v,</span>
<a href="#l13.366"></a><span id="l13.366" class="difflineminus">-                           unsigned int size);</span>
<a href="#l13.367"></a><span id="l13.367" class="difflineminus">-VObject *addGroup(VObject *o, const char *g);</span>
<a href="#l13.368"></a><span id="l13.368" class="difflineminus">-void addList(VObject **o, VObject *p);</span>
<a href="#l13.369"></a><span id="l13.369" class="difflineminus">-</span>
<a href="#l13.370"></a><span id="l13.370" class="difflineminus">-VObject *isAPropertyOf(VObject *o, const char *id);</span>
<a href="#l13.371"></a><span id="l13.371" class="difflineminus">-</span>
<a href="#l13.372"></a><span id="l13.372" class="difflineminus">-VObject *nextVObjectInList(VObject *o);</span>
<a href="#l13.373"></a><span id="l13.373" class="difflineminus">-void initPropIterator(VObjectIterator *i, VObject *o);</span>
<a href="#l13.374"></a><span id="l13.374" class="difflineminus">-int moreIteration(VObjectIterator *i);</span>
<a href="#l13.375"></a><span id="l13.375" class="difflineminus">-VObject *nextVObject(VObjectIterator *i);</span>
<a href="#l13.376"></a><span id="l13.376" class="difflineminus">-</span>
<a href="#l13.377"></a><span id="l13.377" class="difflineminus">-void writeVObject_(OFile *fp, VObject *o);</span>
<a href="#l13.378"></a><span id="l13.378" class="difflineminus">-char *writeMemVObject(char *s, int *len, VObject *o);</span>
<a href="#l13.379"></a><span id="l13.379" class="difflineminus">-extern &quot;C&quot; char *writeMemoryVObjects(char *s, int *len, VObject *list,</span>
<a href="#l13.380"></a><span id="l13.380" class="difflineminus">-                                     bool expandSpaces);</span>
<a href="#l13.381"></a><span id="l13.381" class="difflineminus">-</span>
<a href="#l13.382"></a><span id="l13.382" class="difflineminus">-const char *lookupStr(const char *s);</span>
<a href="#l13.383"></a><span id="l13.383" class="difflineminus">-</span>
<a href="#l13.384"></a><span id="l13.384" class="difflineminus">-void cleanVObject(VObject *o);</span>
<a href="#l13.385"></a><span id="l13.385" class="difflineminus">-void cleanVObjects(VObject *list);</span>
<a href="#l13.386"></a><span id="l13.386" class="difflineminus">-</span>
<a href="#l13.387"></a><span id="l13.387" class="difflineminus">-const char *lookupProp(const char *str);</span>
<a href="#l13.388"></a><span id="l13.388" class="difflineminus">-const char *lookupProp_(const char *str);</span>
<a href="#l13.389"></a><span id="l13.389" class="difflineminus">-</span>
<a href="#l13.390"></a><span id="l13.390" class="difflineminus">-vwchar_t *fakeUnicode(const char *ps, int *bytes);</span>
<a href="#l13.391"></a><span id="l13.391" class="difflineminus">-int uStrLen(const vwchar_t *u);</span>
<a href="#l13.392"></a><span id="l13.392" class="difflineminus">-char *fakeCString(const vwchar_t *u);</span>
<a href="#l13.393"></a><span id="l13.393" class="difflineminus">-</span>
<a href="#l13.394"></a><span id="l13.394" class="difflineminus">-#define MAXPROPNAMESIZE 256</span>
<a href="#l13.395"></a><span id="l13.395" class="difflineminus">-#define MAXMOZPROPNAMESIZE 16</span>
<a href="#l13.396"></a><span id="l13.396" class="difflineminus">-</span>
<a href="#l13.397"></a><span id="l13.397" class="difflineminus">-#ifdef __cplusplus</span>
<a href="#l13.398"></a><span id="l13.398" class="difflineminus">-}</span>
<a href="#l13.399"></a><span id="l13.399" class="difflineminus">-#endif</span>
<a href="#l13.400"></a><span id="l13.400" class="difflineminus">-</span>
<a href="#l13.401"></a><span id="l13.401" class="difflineminus">-#endif /* __VOBJECT_H__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/data/export.vcf</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/data/export.vcf</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineminus">-begin:vcard</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineminus">-fn:contact number one</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineminus">-n:one;contact</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineminus">-email;internet:contact1@invalid</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineminus">-version:2.1</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineminus">-end:vcard</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">-</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineminus">-begin:vcard</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-fn:contact number two</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-n:two;contact</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-email;internet:contact2@invalid</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-title:&quot;worker&quot;</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-note;quoted-printable:here's some unicode text=E2=80=A6</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-version:2.1</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-end:vcard</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+BEGIN:VCARD</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+VERSION:4.0</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+EMAIL:contact1@invalid</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+FN:contact number one</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+N:one;contact;;;</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+UID:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+END:VCARD</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+BEGIN:VCARD</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+VERSION:4.0</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+EMAIL:contact2@invalid</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+FN:contact number two</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+NOTE:here's some unicode text…</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+TITLE:&quot;worker&quot;</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+N:two;contact;;;</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+UID:yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+END:VCARD</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_bug387403.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_bug387403.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,14 +1,16 @@</span>
<a href="#l15.4"></a><span id="l15.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l15.5"></a><span id="l15.5"> /**</span>
<a href="#l15.6"></a><span id="l15.6">  * Test for bug 387403 crash when opening e-mail with broken vcard.</span>
<a href="#l15.7"></a><span id="l15.7">  */</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9"> function run_test() {</span>
<a href="#l15.10"></a><span id="l15.10">   // Before bug 387403 this would hang, eating up all the memory until it</span>
<a href="#l15.11"></a><span id="l15.11">   // crashed.</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  Cc[&quot;@mozilla.org/addressbook/msgvcardservice;1&quot;]</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-    .getService(Ci.nsIMsgVCardService)</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-    .escapedVCardToAbCard(</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-      &quot;begin:vcard\nfn;quoted-printable:Xxxx=C5=82xx  Xxx\nn;quoted-printable:Xxx;Xxxx=C5=82xx \nadr;quoted-printable;quoted-printable;dom:;;xx. Xxxxxxxxxxxx X;Xxxxxx=C3=3&quot;</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-    );</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+  try {</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+    Cc[&quot;@mozilla.org/addressbook/msgvcardservice;1&quot;]</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+      .getService(Ci.nsIMsgVCardService)</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+      .escapedVCardToAbCard(</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+        &quot;begin:vcard\nfn;quoted-printable:Xxxx=C5=82xx  Xxx\nn;quoted-printable:Xxx;Xxxx=C5=82xx \nadr;quoted-printable;quoted-printable;dom:;;xx. Xxxxxxxxxxxx X;Xxxxxx=C3=3&quot;</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+      );</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+  } catch (ex) {}</span>
<a href="#l15.24"></a><span id="l15.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_export.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_export.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -20,25 +20,27 @@ var { Services } = ChromeUtils.import(&quot;r</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5"> add_task(async () =&gt; {</span>
<a href="#l16.6"></a><span id="l16.6">   let dirPrefId = MailServices.ab.newAddressBook(&quot;new book&quot;, &quot;&quot;, 101);</span>
<a href="#l16.7"></a><span id="l16.7">   let book = MailServices.ab.getDirectoryFromId(dirPrefId);</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">   let contact1 = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;].createInstance(</span>
<a href="#l16.10"></a><span id="l16.10">     Ci.nsIAbCard</span>
<a href="#l16.11"></a><span id="l16.11">   );</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+  contact1.UID = &quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;;</span>
<a href="#l16.13"></a><span id="l16.13">   contact1.displayName = &quot;contact number one&quot;;</span>
<a href="#l16.14"></a><span id="l16.14">   contact1.firstName = &quot;contact&quot;;</span>
<a href="#l16.15"></a><span id="l16.15">   contact1.lastName = &quot;one&quot;;</span>
<a href="#l16.16"></a><span id="l16.16">   contact1.primaryEmail = &quot;contact1@invalid&quot;;</span>
<a href="#l16.17"></a><span id="l16.17">   contact1 = book.addCard(contact1);</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">   let contact2 = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;].createInstance(</span>
<a href="#l16.20"></a><span id="l16.20">     Ci.nsIAbCard</span>
<a href="#l16.21"></a><span id="l16.21">   );</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+  contact2.UID = &quot;yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy&quot;;</span>
<a href="#l16.23"></a><span id="l16.23">   contact2.displayName = &quot;contact number two&quot;;</span>
<a href="#l16.24"></a><span id="l16.24">   contact2.firstName = &quot;contact&quot;;</span>
<a href="#l16.25"></a><span id="l16.25">   contact2.lastName = &quot;two&quot;;</span>
<a href="#l16.26"></a><span id="l16.26">   contact2.primaryEmail = &quot;contact2@invalid&quot;;</span>
<a href="#l16.27"></a><span id="l16.27">   contact2.setProperty(&quot;JobTitle&quot;, `&quot;worker&quot;`);</span>
<a href="#l16.28"></a><span id="l16.28">   contact2.setProperty(&quot;Custom1&quot;, &quot;custom, 1&quot;);</span>
<a href="#l16.29"></a><span id="l16.29">   contact2.setProperty(&quot;Custom2&quot;, &quot;custom\t2&quot;);</span>
<a href="#l16.30"></a><span id="l16.30">   contact2.setProperty(&quot;Custom3&quot;, &quot;custom\r3&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -23,20 +23,65 @@ function run_test() {</span>
<a href="#l17.4"></a><span id="l17.4">       fullCard = tempCard;</span>
<a href="#l17.5"></a><span id="l17.5">     }</span>
<a href="#l17.6"></a><span id="l17.6">   }</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8">   Assert.ok(fullCard != null);</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10">   // Test - VCard.</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  Assert.equal(</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    fullCard.translateTo(&quot;vcard&quot;),</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-    &quot;begin%3Avcard%0D%0Afn%3ADisplayName1%0D%0An%3ALastName1%3BFirstName1%0D%0Aorg%3AOrganization1%3BDepartment1%0D%0Aadr%3AWorkAddress21%3B%3BWorkAddress1%3BWorkCity1%3BWorkState1%3BWorkZipCode1%3BWorkCountry1%0D%0Aemail%3Binternet%3APrimaryEmail1%40test.invalid%0D%0Atitle%3AJobTitle1%0D%0Atel%3Bwork%3AWorkPhone1%0D%0Atel%3Bfax%3AFaxNumber1%0D%0Atel%3Bpager%3APagerNumber1%0D%0Atel%3Bhome%3AHomePhone1%0D%0Atel%3Bcell%3ACellularNumber1%0D%0Anote%3ANotes1%0D%0Aurl%3Ahttp%3A//WebPage21%0D%0Aversion%3A2.1%0D%0Aend%3Avcard%0D%0A%0D%0A&quot;</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+  let actual = fullCard.translateTo(&quot;vcard&quot;);</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+  Assert.ok(actual.startsWith(&quot;BEGIN%3AVCARD%0D%0A&quot;));</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+  Assert.ok(actual.endsWith(&quot;%0D%0AEND%3AVCARD%0D%0A&quot;));</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+  let lines = decodeURIComponent(actual).split(&quot;\r\n&quot;);</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+  // The theory, the lines of the vCard are valid in any order, so just check</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+  // that they exist. In practice they are in this order.</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+  Assert.ok(lines.includes(&quot;EMAIL:PrimaryEmail1@test.invalid&quot;), &quot;EMAIL&quot;);</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+  Assert.ok(lines.includes(&quot;FN:DisplayName1&quot;), &quot;FN&quot;);</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+  Assert.ok(lines.includes(&quot;NICKNAME:NickName1&quot;), &quot;NICKNAME&quot;);</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+  Assert.ok(lines.includes(&quot;NOTE:Notes1&quot;), &quot;NOTE&quot;);</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+  Assert.ok(lines.includes(&quot;ORG:Organization1;Department1&quot;), &quot;ORG&quot;);</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+  Assert.ok(lines.includes(&quot;TITLE:JobTitle1&quot;), &quot;TITLE&quot;);</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+  Assert.ok(lines.includes(&quot;N:LastName1;FirstName1;;;&quot;), &quot;N&quot;);</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+  // These two lines wrap. If the wrapping width changes, this test will break.</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+  Assert.ok(</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+    lines.includes(</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+      &quot;ADR;TYPE=home:;HomeAddress21;HomeAddress11;HomeCity1;HomeState1;HomeZipCode&quot;</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+    ),</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+    &quot;ADR;TYPE=home&quot;</span>
<a href="#l17.35"></a><span id="l17.35">   );</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+  Assert.ok(</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+    lines.includes(</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+      &quot;ADR;TYPE=work:;WorkAddress21;WorkAddress1;WorkCity1;WorkState1;WorkZipCode1&quot;</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+    ),</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+    &quot;ADR;TYPE=work&quot;</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+  );</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+  Assert.ok(</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+    lines.includes(&quot;TEL;TYPE=home;VALUE=TEXT:HomePhone1&quot;),</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+    &quot;TEL;TYPE=home&quot;</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+  );</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+  Assert.ok(</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+    lines.includes(&quot;TEL;TYPE=work;VALUE=TEXT:WorkPhone1&quot;),</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+    &quot;TEL;TYPE=work&quot;</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  );</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+  Assert.ok(</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+    lines.includes(&quot;TEL;TYPE=fax;VALUE=TEXT:FaxNumber1&quot;),</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+    &quot;TEL;TYPE=fax&quot;</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+  );</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+  Assert.ok(</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+    lines.includes(&quot;TEL;TYPE=pager;VALUE=TEXT:PagerNumber1&quot;),</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+    &quot;TEL;TYPE=pager&quot;</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+  );</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+  Assert.ok(</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+    lines.includes(&quot;TEL;TYPE=cell;VALUE=TEXT:CellularNumber1&quot;),</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+    &quot;TEL;TYPE=cell&quot;</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+  );</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+  Assert.ok(lines.includes(&quot;URL;VALUE=URL:http://WebPage21&quot;), &quot;URL&quot;);</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+  Assert.ok(lines.includes(&quot;UID:fdcb9131-38ec-4daf-a4a7-2ef115f562a7&quot;), &quot;UID&quot;);</span>
<a href="#l17.64"></a><span id="l17.64"> </span>
<a href="#l17.65"></a><span id="l17.65">   // Test - XML</span>
<a href="#l17.66"></a><span id="l17.66"> </span>
<a href="#l17.67"></a><span id="l17.67">   // Bug 761304: Starting in TB 15, Thunderbird and SeaMonkey differ in how</span>
<a href="#l17.68"></a><span id="l17.68">   // they handle Chat / IM usernames. Unfortunately, it's not easy to multiplex</span>
<a href="#l17.69"></a><span id="l17.69">   // by appname here in XPCShell tests, so for now, we're going to make sure</span>
<a href="#l17.70"></a><span id="l17.70">   // the XML output matches what we expect from Thunderbird OR SeaMonkey. This</span>
<a href="#l17.71"></a><span id="l17.71">   // is obviously less than ideal, and we should fix this in a follow-up patch</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/build/nsMailModule.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/build/nsMailModule.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -117,17 +117,16 @@</span>
<a href="#l18.4"></a><span id="l18.4"> #include &quot;nsAbDirProperty.h&quot;</span>
<a href="#l18.5"></a><span id="l18.5"> #include &quot;nsAbAddressCollector.h&quot;</span>
<a href="#l18.6"></a><span id="l18.6"> #include &quot;nsAddbookProtocolHandler.h&quot;</span>
<a href="#l18.7"></a><span id="l18.7"> #include &quot;nsAddbookUrl.h&quot;</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> #include &quot;nsAbDirectoryQuery.h&quot;</span>
<a href="#l18.10"></a><span id="l18.10"> #include &quot;nsAbBooleanExpression.h&quot;</span>
<a href="#l18.11"></a><span id="l18.11"> #include &quot;nsAbDirectoryQueryProxy.h&quot;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-#include &quot;nsMsgVCardService.h&quot;</span>
<a href="#l18.13"></a><span id="l18.13"> #include &quot;nsAbLDIFService.h&quot;</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15"> #include &quot;nsAbLDAPDirectory.h&quot;</span>
<a href="#l18.16"></a><span id="l18.16"> #include &quot;nsAbLDAPDirectoryQuery.h&quot;</span>
<a href="#l18.17"></a><span id="l18.17"> #include &quot;nsAbLDAPReplicationService.h&quot;</span>
<a href="#l18.18"></a><span id="l18.18"> #include &quot;nsAbLDAPReplicationQuery.h&quot;</span>
<a href="#l18.19"></a><span id="l18.19"> #include &quot;nsAbLDAPReplicationData.h&quot;</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21" class="difflineat">@@ -276,29 +275,25 @@</span>
<a href="#l18.22"></a><span id="l18.22"> #include &quot;nsCMSSecureMessage.h&quot;</span>
<a href="#l18.23"></a><span id="l18.23"> #include &quot;nsCertPicker.h&quot;</span>
<a href="#l18.24"></a><span id="l18.24"> #include &quot;nsMsgSMIMECID.h&quot;</span>
<a href="#l18.25"></a><span id="l18.25"> #include &quot;nsMsgComposeSecure.h&quot;</span>
<a href="#l18.26"></a><span id="l18.26"> #include &quot;nsSMimeJSHelper.h&quot;</span>
<a href="#l18.27"></a><span id="l18.27"> #include &quot;nsEncryptedSMIMEURIsService.h&quot;</span>
<a href="#l18.28"></a><span id="l18.28"> </span>
<a href="#l18.29"></a><span id="l18.29"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-// vcard includes</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-#include &quot;nsMimeContentTypeHandler.h&quot;</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.35"></a><span id="l18.35"> // FTS3 Tokenizer</span>
<a href="#l18.36"></a><span id="l18.36"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.37"></a><span id="l18.37"> #include &quot;nsFts3TokenizerCID.h&quot;</span>
<a href="#l18.38"></a><span id="l18.38"> #include &quot;nsFts3Tokenizer.h&quot;</span>
<a href="#l18.39"></a><span id="l18.39"> </span>
<a href="#l18.40"></a><span id="l18.40"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.41"></a><span id="l18.41"> // PGP/MIME includes</span>
<a href="#l18.42"></a><span id="l18.42"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+#include &quot;nsMimeContentTypeHandler.h&quot;</span>
<a href="#l18.44"></a><span id="l18.44"> #include &quot;nsPgpMimeProxy.h&quot;</span>
<a href="#l18.45"></a><span id="l18.45"> </span>
<a href="#l18.46"></a><span id="l18.46"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.47"></a><span id="l18.47"> // i18n includes</span>
<a href="#l18.48"></a><span id="l18.48"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.49"></a><span id="l18.49"> #include &quot;nsCommUConvCID.h&quot;</span>
<a href="#l18.50"></a><span id="l18.50"> </span>
<a href="#l18.51"></a><span id="l18.51"> #include &quot;nsCharsetConverterManager.h&quot;</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineat">@@ -441,17 +436,16 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbBoole</span>
<a href="#l18.53"></a><span id="l18.53"> </span>
<a href="#l18.54"></a><span id="l18.54"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbLDAPDirectory)</span>
<a href="#l18.55"></a><span id="l18.55"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbLDAPDirectoryQuery)</span>
<a href="#l18.56"></a><span id="l18.56"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbLDAPReplicationService)</span>
<a href="#l18.57"></a><span id="l18.57"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbLDAPReplicationQuery)</span>
<a href="#l18.58"></a><span id="l18.58"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbLDAPProcessReplicationData)</span>
<a href="#l18.59"></a><span id="l18.59"> </span>
<a href="#l18.60"></a><span id="l18.60"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbDirectoryQueryProxy)</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR(nsMsgVCardService)</span>
<a href="#l18.62"></a><span id="l18.62"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbLDIFService)</span>
<a href="#l18.63"></a><span id="l18.63"> </span>
<a href="#l18.64"></a><span id="l18.64"> #ifdef XP_MACOSX</span>
<a href="#l18.65"></a><span id="l18.65"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbOSXDirectory)</span>
<a href="#l18.66"></a><span id="l18.66"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbOSXCard)</span>
<a href="#l18.67"></a><span id="l18.67"> #endif</span>
<a href="#l18.68"></a><span id="l18.68"> </span>
<a href="#l18.69"></a><span id="l18.69"> NS_DEFINE_NAMED_CID(NS_ADDRDATABASE_CID);</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineat">@@ -474,17 +468,16 @@ NS_DEFINE_NAMED_CID(NS_ABLDAPDIRECTORYQU</span>
<a href="#l18.71"></a><span id="l18.71"> NS_DEFINE_NAMED_CID(NS_ABLDAP_REPLICATIONSERVICE_CID);</span>
<a href="#l18.72"></a><span id="l18.72"> NS_DEFINE_NAMED_CID(NS_ABLDAP_REPLICATIONQUERY_CID);</span>
<a href="#l18.73"></a><span id="l18.73"> NS_DEFINE_NAMED_CID(NS_ABLDAP_PROCESSREPLICATIONDATA_CID);</span>
<a href="#l18.74"></a><span id="l18.74"> NS_DEFINE_NAMED_CID(NS_ABDIRECTORYQUERYPROXY_CID);</span>
<a href="#l18.75"></a><span id="l18.75"> #ifdef XP_MACOSX</span>
<a href="#l18.76"></a><span id="l18.76"> NS_DEFINE_NAMED_CID(NS_ABOSXDIRECTORY_CID);</span>
<a href="#l18.77"></a><span id="l18.77"> NS_DEFINE_NAMED_CID(NS_ABOSXCARD_CID);</span>
<a href="#l18.78"></a><span id="l18.78"> #endif</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_MSGVCARDSERVICE_CID);</span>
<a href="#l18.80"></a><span id="l18.80"> NS_DEFINE_NAMED_CID(NS_ABLDIFSERVICE_CID);</span>
<a href="#l18.81"></a><span id="l18.81"> </span>
<a href="#l18.82"></a><span id="l18.82"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.83"></a><span id="l18.83"> // bayesian spam filter factories</span>
<a href="#l18.84"></a><span id="l18.84"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.85"></a><span id="l18.85"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsBayesianFilter, Init)</span>
<a href="#l18.86"></a><span id="l18.86"> </span>
<a href="#l18.87"></a><span id="l18.87"> NS_DEFINE_NAMED_CID(NS_BAYESIANFILTER_CID);</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineat">@@ -716,50 +709,16 @@ NS_DEFINE_NAMED_CID(NS_SMIMEJSJELPER_CID</span>
<a href="#l18.89"></a><span id="l18.89"> NS_DEFINE_NAMED_CID(NS_SMIMEENCRYPTURISERVICE_CID);</span>
<a href="#l18.90"></a><span id="l18.90"> NS_DEFINE_NAMED_CID(NS_CMSDECODER_CID);</span>
<a href="#l18.91"></a><span id="l18.91"> NS_DEFINE_NAMED_CID(NS_CMSENCODER_CID);</span>
<a href="#l18.92"></a><span id="l18.92"> NS_DEFINE_NAMED_CID(NS_CMSMESSAGE_CID);</span>
<a href="#l18.93"></a><span id="l18.93"> NS_DEFINE_NAMED_CID(NS_CMSSECUREMESSAGE_CID);</span>
<a href="#l18.94"></a><span id="l18.94"> NS_DEFINE_NAMED_CID(NS_CERT_PICKER_CID);</span>
<a href="#l18.95"></a><span id="l18.95"> </span>
<a href="#l18.96"></a><span id="l18.96"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineminus">-// vcard factories</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineminus">-////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineminus">-</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_VCARD_CONTENT_TYPE_HANDLER_CID);</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineminus">-</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineminus">-// XXX this vcard stuff needs cleaned up to use a generic factory constructor</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineminus">-extern &quot;C&quot; MimeObjectClass *MIME_VCardCreateContentTypeHandlerClass(</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineminus">-    const char *content_type, contentTypeHandlerInitStruct *initStruct);</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineminus">-</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineminus">-static nsresult nsVCardMimeContentTypeHandlerConstructor(nsISupports *aOuter,</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineminus">-                                                         REFNSIID aIID,</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineminus">-                                                         void **aResult) {</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineminus">-  nsresult rv;</span>
<a href="#l18.110"></a><span id="l18.110" class="difflineminus">-  nsMimeContentTypeHandler *inst = nullptr;</span>
<a href="#l18.111"></a><span id="l18.111" class="difflineminus">-</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineminus">-  if (NULL == aResult) {</span>
<a href="#l18.113"></a><span id="l18.113" class="difflineminus">-    rv = NS_ERROR_NULL_POINTER;</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineminus">-    return rv;</span>
<a href="#l18.115"></a><span id="l18.115" class="difflineminus">-  }</span>
<a href="#l18.116"></a><span id="l18.116" class="difflineminus">-  *aResult = NULL;</span>
<a href="#l18.117"></a><span id="l18.117" class="difflineminus">-  if (NULL != aOuter) {</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineminus">-    rv = NS_ERROR_NO_AGGREGATION;</span>
<a href="#l18.119"></a><span id="l18.119" class="difflineminus">-    return rv;</span>
<a href="#l18.120"></a><span id="l18.120" class="difflineminus">-  }</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineminus">-</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineminus">-  NS_ADDREF(inst = new nsMimeContentTypeHandler(</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineminus">-                &quot;text/x-vcard&quot;, &amp;MIME_VCardCreateContentTypeHandlerClass));</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineminus">-  rv = inst-&gt;QueryInterface(aIID, aResult);</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineminus">-  NS_RELEASE(inst);</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineminus">-</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineminus">-  return rv;</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineminus">-}</span>
<a href="#l18.129"></a><span id="l18.129" class="difflineminus">-</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineminus">-////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.131"></a><span id="l18.131"> // PGP/MIME factories</span>
<a href="#l18.132"></a><span id="l18.132"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l18.133"></a><span id="l18.133"> </span>
<a href="#l18.134"></a><span id="l18.134"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsPgpMimeProxy, Init)</span>
<a href="#l18.135"></a><span id="l18.135"> </span>
<a href="#l18.136"></a><span id="l18.136"> NS_DEFINE_NAMED_CID(NS_PGPMIMEPROXY_CID);</span>
<a href="#l18.137"></a><span id="l18.137"> </span>
<a href="#l18.138"></a><span id="l18.138"> NS_DEFINE_NAMED_CID(NS_PGPMIME_CONTENT_TYPE_HANDLER_CID);</span>
<a href="#l18.139"></a><span id="l18.139" class="difflineat">@@ -891,17 +850,16 @@ const mozilla::Module::CIDEntry kMailNew</span>
<a href="#l18.140"></a><span id="l18.140">     {&amp;kNS_ABLDAP_PROCESSREPLICATIONDATA_CID, false, NULL,</span>
<a href="#l18.141"></a><span id="l18.141">      nsAbLDAPProcessReplicationDataConstructor},</span>
<a href="#l18.142"></a><span id="l18.142">     {&amp;kNS_ABDIRECTORYQUERYPROXY_CID, false, NULL,</span>
<a href="#l18.143"></a><span id="l18.143">      nsAbDirectoryQueryProxyConstructor},</span>
<a href="#l18.144"></a><span id="l18.144"> #ifdef XP_MACOSX</span>
<a href="#l18.145"></a><span id="l18.145">     {&amp;kNS_ABOSXDIRECTORY_CID, false, NULL, nsAbOSXDirectoryConstructor},</span>
<a href="#l18.146"></a><span id="l18.146">     {&amp;kNS_ABOSXCARD_CID, false, NULL, nsAbOSXCardConstructor},</span>
<a href="#l18.147"></a><span id="l18.147"> #endif</span>
<a href="#l18.148"></a><span id="l18.148" class="difflineminus">-    {&amp;kNS_MSGVCARDSERVICE_CID, false, NULL, nsMsgVCardServiceConstructor},</span>
<a href="#l18.149"></a><span id="l18.149">     {&amp;kNS_ABLDIFSERVICE_CID, false, NULL, nsAbLDIFServiceConstructor},</span>
<a href="#l18.150"></a><span id="l18.150">     // Bayesian Filter Entries</span>
<a href="#l18.151"></a><span id="l18.151">     {&amp;kNS_BAYESIANFILTER_CID, false, NULL, nsBayesianFilterConstructor},</span>
<a href="#l18.152"></a><span id="l18.152">     // Compose Entries</span>
<a href="#l18.153"></a><span id="l18.153">     {&amp;kNS_MSGCOMPOSE_CID, false, NULL, nsMsgComposeConstructor},</span>
<a href="#l18.154"></a><span id="l18.154">     {&amp;kNS_MSGCOMPOSESERVICE_CID, false, NULL, nsMsgComposeServiceConstructor},</span>
<a href="#l18.155"></a><span id="l18.155">     {&amp;kNS_MSGCOMPOSECONTENTHANDLER_CID, false, NULL,</span>
<a href="#l18.156"></a><span id="l18.156">      nsMsgComposeContentHandlerConstructor},</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineat">@@ -1013,19 +971,16 @@ const mozilla::Module::CIDEntry kMailNew</span>
<a href="#l18.158"></a><span id="l18.158">     {&amp;kNS_SMIMEJSJELPER_CID, false, NULL, nsSMimeJSHelperConstructor},</span>
<a href="#l18.159"></a><span id="l18.159">     {&amp;kNS_SMIMEENCRYPTURISERVICE_CID, false, NULL,</span>
<a href="#l18.160"></a><span id="l18.160">      nsEncryptedSMIMEURIsServiceConstructor},</span>
<a href="#l18.161"></a><span id="l18.161">     {&amp;kNS_CMSDECODER_CID, false, NULL, nsCMSDecoderConstructor},</span>
<a href="#l18.162"></a><span id="l18.162">     {&amp;kNS_CMSENCODER_CID, false, NULL, nsCMSEncoderConstructor},</span>
<a href="#l18.163"></a><span id="l18.163">     {&amp;kNS_CMSMESSAGE_CID, false, NULL, nsCMSMessageConstructor},</span>
<a href="#l18.164"></a><span id="l18.164">     {&amp;kNS_CMSSECUREMESSAGE_CID, false, NULL, nsCMSSecureMessageConstructor},</span>
<a href="#l18.165"></a><span id="l18.165">     {&amp;kNS_CERT_PICKER_CID, false, nullptr, nsCertPickerConstructor},</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineminus">-    // Vcard Entries</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineminus">-    {&amp;kNS_VCARD_CONTENT_TYPE_HANDLER_CID, false, NULL,</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineminus">-     nsVCardMimeContentTypeHandlerConstructor},</span>
<a href="#l18.169"></a><span id="l18.169">     // PGP/MIME Entries</span>
<a href="#l18.170"></a><span id="l18.170">     {&amp;kNS_PGPMIME_CONTENT_TYPE_HANDLER_CID, false, NULL,</span>
<a href="#l18.171"></a><span id="l18.171">      nsPgpMimeMimeContentTypeHandlerConstructor},</span>
<a href="#l18.172"></a><span id="l18.172">     {&amp;kNS_PGPMIMEPROXY_CID, false, NULL, nsPgpMimeProxyConstructor},</span>
<a href="#l18.173"></a><span id="l18.173">     // i18n Entries</span>
<a href="#l18.174"></a><span id="l18.174">     {&amp;kNS_ICHARSETCONVERTERMANAGER_CID, false, nullptr,</span>
<a href="#l18.175"></a><span id="l18.175">      nsCharsetConverterManagerConstructor},</span>
<a href="#l18.176"></a><span id="l18.176">     // Tokenizer Entries</span>
<a href="#l18.177"></a><span id="l18.177" class="difflineat">@@ -1119,17 +1074,16 @@ const mozilla::Module::ContractIDEntry k</span>
<a href="#l18.178"></a><span id="l18.178">     {NS_ABLDAP_REPLICATIONQUERY_CONTRACTID, &amp;kNS_ABLDAP_REPLICATIONQUERY_CID},</span>
<a href="#l18.179"></a><span id="l18.179">     {NS_ABLDAP_PROCESSREPLICATIONDATA_CONTRACTID,</span>
<a href="#l18.180"></a><span id="l18.180">      &amp;kNS_ABLDAP_PROCESSREPLICATIONDATA_CID},</span>
<a href="#l18.181"></a><span id="l18.181">     {NS_ABDIRECTORYQUERYPROXY_CONTRACTID, &amp;kNS_ABDIRECTORYQUERYPROXY_CID},</span>
<a href="#l18.182"></a><span id="l18.182"> #ifdef XP_MACOSX</span>
<a href="#l18.183"></a><span id="l18.183">     {NS_ABOSXDIRECTORY_CONTRACTID, &amp;kNS_ABOSXDIRECTORY_CID},</span>
<a href="#l18.184"></a><span id="l18.184">     {NS_ABOSXCARD_CONTRACTID, &amp;kNS_ABOSXCARD_CID},</span>
<a href="#l18.185"></a><span id="l18.185"> #endif</span>
<a href="#l18.186"></a><span id="l18.186" class="difflineminus">-    {NS_MSGVCARDSERVICE_CONTRACTID, &amp;kNS_MSGVCARDSERVICE_CID},</span>
<a href="#l18.187"></a><span id="l18.187">     {NS_ABLDIFSERVICE_CONTRACTID, &amp;kNS_ABLDIFSERVICE_CID},</span>
<a href="#l18.188"></a><span id="l18.188">     // Bayesian Filter Entries</span>
<a href="#l18.189"></a><span id="l18.189">     {NS_BAYESIANFILTER_CONTRACTID, &amp;kNS_BAYESIANFILTER_CID},</span>
<a href="#l18.190"></a><span id="l18.190">     // Compose Entries</span>
<a href="#l18.191"></a><span id="l18.191">     {NS_MSGCOMPOSE_CONTRACTID, &amp;kNS_MSGCOMPOSE_CID},</span>
<a href="#l18.192"></a><span id="l18.192">     {NS_MSGCOMPOSESERVICE_CONTRACTID, &amp;kNS_MSGCOMPOSESERVICE_CID},</span>
<a href="#l18.193"></a><span id="l18.193">     {NS_MSGCOMPOSESTARTUPHANDLER_CONTRACTID, &amp;kNS_MSGCOMPOSESERVICE_CID},</span>
<a href="#l18.194"></a><span id="l18.194">     {NS_MSGCOMPOSECONTENTHANDLER_CONTRACTID, &amp;kNS_MSGCOMPOSECONTENTHANDLER_CID},</span>
<a href="#l18.195"></a><span id="l18.195" class="difflineat">@@ -1256,19 +1210,16 @@ const mozilla::Module::ContractIDEntry k</span>
<a href="#l18.196"></a><span id="l18.196">     {NS_SMIMEJSHELPER_CONTRACTID, &amp;kNS_SMIMEJSJELPER_CID},</span>
<a href="#l18.197"></a><span id="l18.197">     {NS_SMIMEENCRYPTURISERVICE_CONTRACTID, &amp;kNS_SMIMEENCRYPTURISERVICE_CID},</span>
<a href="#l18.198"></a><span id="l18.198">     {NS_CMSSECUREMESSAGE_CONTRACTID, &amp;kNS_CMSSECUREMESSAGE_CID},</span>
<a href="#l18.199"></a><span id="l18.199">     {NS_CMSDECODER_CONTRACTID, &amp;kNS_CMSDECODER_CID},</span>
<a href="#l18.200"></a><span id="l18.200">     {NS_CMSENCODER_CONTRACTID, &amp;kNS_CMSENCODER_CID},</span>
<a href="#l18.201"></a><span id="l18.201">     {NS_CMSMESSAGE_CONTRACTID, &amp;kNS_CMSMESSAGE_CID},</span>
<a href="#l18.202"></a><span id="l18.202">     {NS_CERTPICKDIALOGS_CONTRACTID, &amp;kNS_CERT_PICKER_CID},</span>
<a href="#l18.203"></a><span id="l18.203">     {NS_CERT_PICKER_CONTRACTID, &amp;kNS_CERT_PICKER_CID},</span>
<a href="#l18.204"></a><span id="l18.204" class="difflineminus">-    // Vcard Entries</span>
<a href="#l18.205"></a><span id="l18.205" class="difflineminus">-    {&quot;@mozilla.org/mimecth;1?type=text/x-vcard&quot;,</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineminus">-     &amp;kNS_VCARD_CONTENT_TYPE_HANDLER_CID},</span>
<a href="#l18.207"></a><span id="l18.207">     // PGP/MIME Entries</span>
<a href="#l18.208"></a><span id="l18.208">     {&quot;@mozilla.org/mimecth;1?type=multipart/encrypted&quot;,</span>
<a href="#l18.209"></a><span id="l18.209">      &amp;kNS_PGPMIME_CONTENT_TYPE_HANDLER_CID},</span>
<a href="#l18.210"></a><span id="l18.210">     {NS_PGPMIMEPROXY_CONTRACTID, &amp;kNS_PGPMIMEPROXY_CID},</span>
<a href="#l18.211"></a><span id="l18.211">     // i18n Entries</span>
<a href="#l18.212"></a><span id="l18.212">     {NS_CHARSETCONVERTERMANAGER_CONTRACTID, &amp;kNS_ICHARSETCONVERTERMANAGER_CID},</span>
<a href="#l18.213"></a><span id="l18.213">     // Tokenizer Entries</span>
<a href="#l18.214"></a><span id="l18.214">     {NULL}};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/mime/cthandlers/moz.build</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/moz.build</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,12 +1,11 @@</span>
<a href="#l19.4"></a><span id="l19.4"> # vim: set filetype=python:</span>
<a href="#l19.5"></a><span id="l19.5"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.6"></a><span id="l19.6"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.7"></a><span id="l19.7"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9"> # pgpmime depends on glue.</span>
<a href="#l19.10"></a><span id="l19.10"> DIRS += [</span>
<a href="#l19.11"></a><span id="l19.11">     'glue',</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    'vcard',</span>
<a href="#l19.13"></a><span id="l19.13">     'pgpmime',</span>
<a href="#l19.14"></a><span id="l19.14"> ]</span>
<a href="#l19.15"></a><span id="l19.15"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">deleted file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- a/mailnews/mime/cthandlers/vcard/mimevcrd.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ /dev/null</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -1,367 +0,0 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineminus">-</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineminus">-#include &quot;mimevcrd.h&quot;</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineminus">-</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-#include &quot;mimecth.h&quot;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-#include &quot;mimexpcom.h&quot;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-#include &quot;nsIMsgVCardService.h&quot;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-#include &quot;nsINetUtil.h&quot;</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-#include &quot;prmem.h&quot;</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-#include &quot;prprf.h&quot;</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-static int MimeInlineTextVCard_parse_line(const char *, int32_t, MimeObject *);</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineminus">-static int MimeInlineTextVCard_parse_eof(MimeObject *, bool);</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">-static int MimeInlineTextVCard_parse_begin(MimeObject *obj);</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">-static int s_unique = 0;</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineminus">-</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineminus">-static int BeginVCard(MimeObject *obj);</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineminus">-static int EndVCard(MimeObject *obj);</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineminus">-static int WriteOutVCard(MimeObject *obj, VObject *v);</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-static int GenerateVCardData(MimeObject *aMimeObj, VObject *aVcard);</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-static int OutputVcardAttribute(MimeObject *aMimeObj, VObject *aVcard,</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-                                const char *id, nsACString &amp;vCardOutput);</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-static int OutputBasicVcard(MimeObject *aMimeObj, VObject *aVcard,</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-                            nsACString &amp;vCardOutput);</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-typedef struct {</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">-  const char *attributeName;</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-  int resourceId;</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">-} AttributeName;</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineminus">-</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-#define kNumAttributes 12</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-#define MSGVCARDSERVICE_CONTRACT_ID &quot;@mozilla.org/addressbook/msgvcardservice;1&quot;</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineminus">-</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineminus">-/* This is the object definition. Note: we will set the superclass</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineminus">-   to NULL and manually set this on the class creation */</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineminus">-MimeDefClass(MimeInlineTextVCard, MimeInlineTextVCardClass,</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineminus">-             mimeInlineTextVCardClass, NULL);</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineminus">-extern &quot;C&quot; MimeObjectClass *MIME_VCardCreateContentTypeHandlerClass(</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-    const char *content_type, contentTypeHandlerInitStruct *initStruct) {</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-  MimeObjectClass *clazz = (MimeObjectClass *)&amp;mimeInlineTextVCardClass;</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-  /*</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">-   * Must set the superclass by hand.</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineminus">-   */</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-  if (!COM_GetmimeInlineTextClass()) return NULL;</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineminus">-</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineminus">-  clazz-&gt;superclass = (MimeObjectClass *)COM_GetmimeInlineTextClass();</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-  initStruct-&gt;force_inline_display = true;</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineminus">-  return clazz;</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineminus">-}</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineminus">-</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineminus">-/*</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineminus">- * Implementation of VCard clazz</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineminus">- */</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineminus">-static int MimeInlineTextVCardClassInitialize(MimeInlineTextVCardClass *clazz) {</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineminus">-  MimeObjectClass *oclass = (MimeObjectClass *)clazz;</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineminus">-  NS_ASSERTION(!oclass-&gt;class_initialized,</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineminus">-               &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:11&quot;);</span>
<a href="#l20.71"></a><span id="l20.71" class="difflineminus">-  oclass-&gt;parse_begin = MimeInlineTextVCard_parse_begin;</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineminus">-  oclass-&gt;parse_line = MimeInlineTextVCard_parse_line;</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-  oclass-&gt;parse_eof = MimeInlineTextVCard_parse_eof;</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-  return 0;</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-}</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineminus">-</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineminus">-static int MimeInlineTextVCard_parse_begin(MimeObject *obj) {</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineminus">-  int status = ((MimeObjectClass *)COM_GetmimeLeafClass())-&gt;parse_begin(obj);</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineminus">-  MimeInlineTextVCardClass *clazz;</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineminus">-  if (status &lt; 0) return status;</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineminus">-</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineminus">-  if (!obj-&gt;output_p) return 0;</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineminus">-  if (!obj-&gt;options || !obj-&gt;options-&gt;write_html_p) return 0;</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineminus">-</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineminus">-  /* This is a fine place to write out any HTML before the real meat begins.</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineminus">-  In this sample code, we tell it to start a table. */</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineminus">-</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineminus">-  clazz = ((MimeInlineTextVCardClass *)obj-&gt;clazz);</span>
<a href="#l20.89"></a><span id="l20.89" class="difflineminus">-  /* initialize vcard string to empty; */</span>
<a href="#l20.90"></a><span id="l20.90" class="difflineminus">-  NS_MsgSACopy(&amp;(clazz-&gt;vCardString), &quot;&quot;);</span>
<a href="#l20.91"></a><span id="l20.91" class="difflineminus">-</span>
<a href="#l20.92"></a><span id="l20.92" class="difflineminus">-  obj-&gt;options-&gt;state-&gt;separator_suppressed_p = true;</span>
<a href="#l20.93"></a><span id="l20.93" class="difflineminus">-  return 0;</span>
<a href="#l20.94"></a><span id="l20.94" class="difflineminus">-}</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineminus">-</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineminus">-char *strcpySafe(char *dest, const char *src, size_t destLength) {</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineminus">-  char *result = strncpy(dest, src, --destLength);</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineminus">-  dest[destLength] = '\0';</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineminus">-  return result;</span>
<a href="#l20.100"></a><span id="l20.100" class="difflineminus">-}</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineminus">-</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineminus">-static int MimeInlineTextVCard_parse_line(const char *line, int32_t length,</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineminus">-                                          MimeObject *obj) {</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineminus">-  // This routine gets fed each line of data, one at a time.</span>
<a href="#l20.105"></a><span id="l20.105" class="difflineminus">-  char *linestring;</span>
<a href="#l20.106"></a><span id="l20.106" class="difflineminus">-  MimeInlineTextVCardClass *clazz = ((MimeInlineTextVCardClass *)obj-&gt;clazz);</span>
<a href="#l20.107"></a><span id="l20.107" class="difflineminus">-</span>
<a href="#l20.108"></a><span id="l20.108" class="difflineminus">-  if (!obj-&gt;output_p) return 0;</span>
<a href="#l20.109"></a><span id="l20.109" class="difflineminus">-  if (!obj-&gt;options || !obj-&gt;options-&gt;output_fn) return 0;</span>
<a href="#l20.110"></a><span id="l20.110" class="difflineminus">-  if (!obj-&gt;options-&gt;write_html_p) {</span>
<a href="#l20.111"></a><span id="l20.111" class="difflineminus">-    return COM_MimeObject_write(obj, line, length, true);</span>
<a href="#l20.112"></a><span id="l20.112" class="difflineminus">-  }</span>
<a href="#l20.113"></a><span id="l20.113" class="difflineminus">-</span>
<a href="#l20.114"></a><span id="l20.114" class="difflineminus">-  linestring = (char *)PR_MALLOC(length + 1);</span>
<a href="#l20.115"></a><span id="l20.115" class="difflineminus">-  memset(linestring, 0, (length + 1));</span>
<a href="#l20.116"></a><span id="l20.116" class="difflineminus">-</span>
<a href="#l20.117"></a><span id="l20.117" class="difflineminus">-  if (linestring) {</span>
<a href="#l20.118"></a><span id="l20.118" class="difflineminus">-    strcpySafe((char *)linestring, line, length + 1);</span>
<a href="#l20.119"></a><span id="l20.119" class="difflineminus">-    NS_MsgSACat(&amp;clazz-&gt;vCardString, linestring);</span>
<a href="#l20.120"></a><span id="l20.120" class="difflineminus">-    PR_Free(linestring);</span>
<a href="#l20.121"></a><span id="l20.121" class="difflineminus">-  }</span>
<a href="#l20.122"></a><span id="l20.122" class="difflineminus">-</span>
<a href="#l20.123"></a><span id="l20.123" class="difflineminus">-  return 0;</span>
<a href="#l20.124"></a><span id="l20.124" class="difflineminus">-}</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineminus">-</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineminus">-////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l20.127"></a><span id="l20.127" class="difflineminus">-static int MimeInlineTextVCard_parse_eof(MimeObject *obj, bool abort_p) {</span>
<a href="#l20.128"></a><span id="l20.128" class="difflineminus">-  nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService =</span>
<a href="#l20.129"></a><span id="l20.129" class="difflineminus">-      do_GetService(MSGVCARDSERVICE_CONTRACT_ID);</span>
<a href="#l20.130"></a><span id="l20.130" class="difflineminus">-  if (!vCardService) return -1;</span>
<a href="#l20.131"></a><span id="l20.131" class="difflineminus">-</span>
<a href="#l20.132"></a><span id="l20.132" class="difflineminus">-  int status = 0;</span>
<a href="#l20.133"></a><span id="l20.133" class="difflineminus">-  MimeInlineTextVCardClass *clazz = ((MimeInlineTextVCardClass *)obj-&gt;clazz);</span>
<a href="#l20.134"></a><span id="l20.134" class="difflineminus">-</span>
<a href="#l20.135"></a><span id="l20.135" class="difflineminus">-  VObject *t, *v;</span>
<a href="#l20.136"></a><span id="l20.136" class="difflineminus">-</span>
<a href="#l20.137"></a><span id="l20.137" class="difflineminus">-  if (obj-&gt;closed_p) return 0;</span>
<a href="#l20.138"></a><span id="l20.138" class="difflineminus">-</span>
<a href="#l20.139"></a><span id="l20.139" class="difflineminus">-  /* Run parent method first, to flush out any buffered data. */</span>
<a href="#l20.140"></a><span id="l20.140" class="difflineminus">-  //    status = ((MimeObjectClass*)&amp;MIME_SUPERCLASS)-&gt;parse_eof(obj, abort_p);</span>
<a href="#l20.141"></a><span id="l20.141" class="difflineminus">-  status = ((MimeObjectClass *)COM_GetmimeInlineTextClass())</span>
<a href="#l20.142"></a><span id="l20.142" class="difflineminus">-               -&gt;parse_eof(obj, abort_p);</span>
<a href="#l20.143"></a><span id="l20.143" class="difflineminus">-  if (status &lt; 0) return status;</span>
<a href="#l20.144"></a><span id="l20.144" class="difflineminus">-</span>
<a href="#l20.145"></a><span id="l20.145" class="difflineminus">-  // Don't quote vCards...</span>
<a href="#l20.146"></a><span id="l20.146" class="difflineminus">-  if ((obj-&gt;options) &amp;&amp;</span>
<a href="#l20.147"></a><span id="l20.147" class="difflineminus">-      ((obj-&gt;options-&gt;format_out == nsMimeOutput::nsMimeMessageQuoting) ||</span>
<a href="#l20.148"></a><span id="l20.148" class="difflineminus">-       (obj-&gt;options-&gt;format_out == nsMimeOutput::nsMimeMessageBodyQuoting)))</span>
<a href="#l20.149"></a><span id="l20.149" class="difflineminus">-    return 0;</span>
<a href="#l20.150"></a><span id="l20.150" class="difflineminus">-</span>
<a href="#l20.151"></a><span id="l20.151" class="difflineminus">-  if (!clazz-&gt;vCardString) return 0;</span>
<a href="#l20.152"></a><span id="l20.152" class="difflineminus">-</span>
<a href="#l20.153"></a><span id="l20.153" class="difflineminus">-  v = vCardService-&gt;Parse_MIME(clazz-&gt;vCardString, strlen(clazz-&gt;vCardString));</span>
<a href="#l20.154"></a><span id="l20.154" class="difflineminus">-  NS_ASSERTION(v, &quot;parse of vCard failed&quot;);</span>
<a href="#l20.155"></a><span id="l20.155" class="difflineminus">-</span>
<a href="#l20.156"></a><span id="l20.156" class="difflineminus">-  if (clazz-&gt;vCardString) {</span>
<a href="#l20.157"></a><span id="l20.157" class="difflineminus">-    PR_Free((char *)clazz-&gt;vCardString);</span>
<a href="#l20.158"></a><span id="l20.158" class="difflineminus">-    clazz-&gt;vCardString = NULL;</span>
<a href="#l20.159"></a><span id="l20.159" class="difflineminus">-  }</span>
<a href="#l20.160"></a><span id="l20.160" class="difflineminus">-</span>
<a href="#l20.161"></a><span id="l20.161" class="difflineminus">-  if (obj-&gt;output_p &amp;&amp; obj-&gt;options &amp;&amp; obj-&gt;options-&gt;write_html_p &amp;&amp;</span>
<a href="#l20.162"></a><span id="l20.162" class="difflineminus">-      obj-&gt;options-&gt;headers != MimeHeadersCitation) {</span>
<a href="#l20.163"></a><span id="l20.163" class="difflineminus">-    /* This is a fine place to write any closing HTML.  In fact, you may</span>
<a href="#l20.164"></a><span id="l20.164" class="difflineminus">-    want all the writing to be here, and all of the above would just</span>
<a href="#l20.165"></a><span id="l20.165" class="difflineminus">-    collect data into datastructures, though that isn't very</span>
<a href="#l20.166"></a><span id="l20.166" class="difflineminus">-    &quot;streaming&quot;. */</span>
<a href="#l20.167"></a><span id="l20.167" class="difflineminus">-    t = v;</span>
<a href="#l20.168"></a><span id="l20.168" class="difflineminus">-    while (v &amp;&amp; status &gt;= 0) {</span>
<a href="#l20.169"></a><span id="l20.169" class="difflineminus">-      /* write out html */</span>
<a href="#l20.170"></a><span id="l20.170" class="difflineminus">-      status = WriteOutVCard(obj, v);</span>
<a href="#l20.171"></a><span id="l20.171" class="difflineminus">-      /* parse next vcard in case they're embedded */</span>
<a href="#l20.172"></a><span id="l20.172" class="difflineminus">-      v = vCardService-&gt;NextVObjectInList(v);</span>
<a href="#l20.173"></a><span id="l20.173" class="difflineminus">-    }</span>
<a href="#l20.174"></a><span id="l20.174" class="difflineminus">-</span>
<a href="#l20.175"></a><span id="l20.175" class="difflineminus">-    (void)vCardService-&gt;CleanVObject(t);</span>
<a href="#l20.176"></a><span id="l20.176" class="difflineminus">-  }</span>
<a href="#l20.177"></a><span id="l20.177" class="difflineminus">-</span>
<a href="#l20.178"></a><span id="l20.178" class="difflineminus">-  if (status &lt; 0) return status;</span>
<a href="#l20.179"></a><span id="l20.179" class="difflineminus">-</span>
<a href="#l20.180"></a><span id="l20.180" class="difflineminus">-  return 0;</span>
<a href="#l20.181"></a><span id="l20.181" class="difflineminus">-}</span>
<a href="#l20.182"></a><span id="l20.182" class="difflineminus">-</span>
<a href="#l20.183"></a><span id="l20.183" class="difflineminus">-static int EndVCard(MimeObject *obj) {</span>
<a href="#l20.184"></a><span id="l20.184" class="difflineminus">-  int status = 0;</span>
<a href="#l20.185"></a><span id="l20.185" class="difflineminus">-</span>
<a href="#l20.186"></a><span id="l20.186" class="difflineminus">-  /* Scribble HTML-ending stuff into the stream */</span>
<a href="#l20.187"></a><span id="l20.187" class="difflineminus">-  char htmlFooters[32];</span>
<a href="#l20.188"></a><span id="l20.188" class="difflineminus">-  PR_snprintf(htmlFooters, sizeof(htmlFooters), &quot;&lt;/BODY&gt;%s&lt;/HTML&gt;%s&quot;,</span>
<a href="#l20.189"></a><span id="l20.189" class="difflineminus">-              MSG_LINEBREAK, MSG_LINEBREAK);</span>
<a href="#l20.190"></a><span id="l20.190" class="difflineminus">-  status = COM_MimeObject_write(obj, htmlFooters, strlen(htmlFooters), false);</span>
<a href="#l20.191"></a><span id="l20.191" class="difflineminus">-</span>
<a href="#l20.192"></a><span id="l20.192" class="difflineminus">-  if (status &lt; 0) return status;</span>
<a href="#l20.193"></a><span id="l20.193" class="difflineminus">-</span>
<a href="#l20.194"></a><span id="l20.194" class="difflineminus">-  return 0;</span>
<a href="#l20.195"></a><span id="l20.195" class="difflineminus">-}</span>
<a href="#l20.196"></a><span id="l20.196" class="difflineminus">-</span>
<a href="#l20.197"></a><span id="l20.197" class="difflineminus">-static int BeginVCard(MimeObject *obj) {</span>
<a href="#l20.198"></a><span id="l20.198" class="difflineminus">-  int status = 0;</span>
<a href="#l20.199"></a><span id="l20.199" class="difflineminus">-</span>
<a href="#l20.200"></a><span id="l20.200" class="difflineminus">-  /* Scribble HTML-starting stuff into the stream */</span>
<a href="#l20.201"></a><span id="l20.201" class="difflineminus">-  char htmlHeaders[32];</span>
<a href="#l20.202"></a><span id="l20.202" class="difflineminus">-</span>
<a href="#l20.203"></a><span id="l20.203" class="difflineminus">-  s_unique++;</span>
<a href="#l20.204"></a><span id="l20.204" class="difflineminus">-  PR_snprintf(htmlHeaders, sizeof(htmlHeaders), &quot;&lt;HTML&gt;%s&lt;BODY&gt;%s&quot;,</span>
<a href="#l20.205"></a><span id="l20.205" class="difflineminus">-              MSG_LINEBREAK, MSG_LINEBREAK);</span>
<a href="#l20.206"></a><span id="l20.206" class="difflineminus">-  status = COM_MimeObject_write(obj, htmlHeaders, strlen(htmlHeaders), true);</span>
<a href="#l20.207"></a><span id="l20.207" class="difflineminus">-</span>
<a href="#l20.208"></a><span id="l20.208" class="difflineminus">-  if (status &lt; 0) return status;</span>
<a href="#l20.209"></a><span id="l20.209" class="difflineminus">-</span>
<a href="#l20.210"></a><span id="l20.210" class="difflineminus">-  return 0;</span>
<a href="#l20.211"></a><span id="l20.211" class="difflineminus">-}</span>
<a href="#l20.212"></a><span id="l20.212" class="difflineminus">-</span>
<a href="#l20.213"></a><span id="l20.213" class="difflineminus">-static int WriteOutVCard(MimeObject *aMimeObj, VObject *aVcard) {</span>
<a href="#l20.214"></a><span id="l20.214" class="difflineminus">-  BeginVCard(aMimeObj);</span>
<a href="#l20.215"></a><span id="l20.215" class="difflineminus">-</span>
<a href="#l20.216"></a><span id="l20.216" class="difflineminus">-  GenerateVCardData(aMimeObj, aVcard);</span>
<a href="#l20.217"></a><span id="l20.217" class="difflineminus">-</span>
<a href="#l20.218"></a><span id="l20.218" class="difflineminus">-  return EndVCard(aMimeObj);</span>
<a href="#l20.219"></a><span id="l20.219" class="difflineminus">-}</span>
<a href="#l20.220"></a><span id="l20.220" class="difflineminus">-</span>
<a href="#l20.221"></a><span id="l20.221" class="difflineminus">-static int GenerateVCardData(MimeObject *aMimeObj, VObject *aVcard) {</span>
<a href="#l20.222"></a><span id="l20.222" class="difflineminus">-  // style is driven from CSS not here. Just layout the minimal vCard data</span>
<a href="#l20.223"></a><span id="l20.223" class="difflineminus">-  nsCString vCardOutput;</span>
<a href="#l20.224"></a><span id="l20.224" class="difflineminus">-</span>
<a href="#l20.225"></a><span id="l20.225" class="difflineminus">-  vCardOutput =</span>
<a href="#l20.226"></a><span id="l20.226" class="difflineminus">-      &quot;&lt;table class=\&quot;moz-vcard-table\&quot;&gt; &lt;tr&gt; &quot;;  // outer table plus the first</span>
<a href="#l20.227"></a><span id="l20.227" class="difflineminus">-                                                  // (and only row) we use for</span>
<a href="#l20.228"></a><span id="l20.228" class="difflineminus">-                                                  // this table</span>
<a href="#l20.229"></a><span id="l20.229" class="difflineminus">-</span>
<a href="#l20.230"></a><span id="l20.230" class="difflineminus">-  // we need to get an escaped vCard url to bind to our add to address book</span>
<a href="#l20.231"></a><span id="l20.231" class="difflineminus">-  // button</span>
<a href="#l20.232"></a><span id="l20.232" class="difflineminus">-  nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService =</span>
<a href="#l20.233"></a><span id="l20.233" class="difflineminus">-      do_GetService(MSGVCARDSERVICE_CONTRACT_ID);</span>
<a href="#l20.234"></a><span id="l20.234" class="difflineminus">-  if (!vCardService) return -1;</span>
<a href="#l20.235"></a><span id="l20.235" class="difflineminus">-</span>
<a href="#l20.236"></a><span id="l20.236" class="difflineminus">-  nsAutoCString vCard;</span>
<a href="#l20.237"></a><span id="l20.237" class="difflineminus">-  nsAutoCString vEscCard;</span>
<a href="#l20.238"></a><span id="l20.238" class="difflineminus">-  int len = 0;</span>
<a href="#l20.239"></a><span id="l20.239" class="difflineminus">-</span>
<a href="#l20.240"></a><span id="l20.240" class="difflineminus">-  vCard.Adopt(vCardService-&gt;WriteMemoryVObjects(0, &amp;len, aVcard, false));</span>
<a href="#l20.241"></a><span id="l20.241" class="difflineminus">-  MsgEscapeString(vCard, nsINetUtil::ESCAPE_XALPHAS, vEscCard);</span>
<a href="#l20.242"></a><span id="l20.242" class="difflineminus">-</span>
<a href="#l20.243"></a><span id="l20.243" class="difflineminus">-  // first cell in the outer table row is a clickable image which brings up the</span>
<a href="#l20.244"></a><span id="l20.244" class="difflineminus">-  // rich address book UI for the vcard</span>
<a href="#l20.245"></a><span id="l20.245" class="difflineminus">-  vCardOutput +=</span>
<a href="#l20.246"></a><span id="l20.246" class="difflineminus">-      &quot;&lt;td valign=\&quot;top\&quot;&gt; &lt;a class=\&quot;moz-vcard-badge\&quot; &quot;</span>
<a href="#l20.247"></a><span id="l20.247" class="difflineminus">-      &quot;href=\&quot;addbook:add?action=add?vcard=&quot;;</span>
<a href="#l20.248"></a><span id="l20.248" class="difflineminus">-  vCardOutput += vEscCard;  // the href is the vCard</span>
<a href="#l20.249"></a><span id="l20.249" class="difflineminus">-  vCardOutput += &quot;\&quot;&gt;&lt;/a&gt;&lt;/td&gt;&quot;;</span>
<a href="#l20.250"></a><span id="l20.250" class="difflineminus">-</span>
<a href="#l20.251"></a><span id="l20.251" class="difflineminus">-  // the 2nd cell in the outer table row is a nested table containing the actual</span>
<a href="#l20.252"></a><span id="l20.252" class="difflineminus">-  // vCard properties</span>
<a href="#l20.253"></a><span id="l20.253" class="difflineminus">-  vCardOutput += &quot;&lt;td&gt; &lt;table id=\&quot;moz-vcard-properties-table\&quot;&gt; &lt;tr&gt; &quot;;</span>
<a href="#l20.254"></a><span id="l20.254" class="difflineminus">-</span>
<a href="#l20.255"></a><span id="l20.255" class="difflineminus">-  OutputBasicVcard(aMimeObj, aVcard, vCardOutput);</span>
<a href="#l20.256"></a><span id="l20.256" class="difflineminus">-</span>
<a href="#l20.257"></a><span id="l20.257" class="difflineminus">-  // close the properties table</span>
<a href="#l20.258"></a><span id="l20.258" class="difflineminus">-  vCardOutput += &quot;&lt;/table&gt; &lt;/td&gt; &quot;;</span>
<a href="#l20.259"></a><span id="l20.259" class="difflineminus">-</span>
<a href="#l20.260"></a><span id="l20.260" class="difflineminus">-  // 2nd  cell in the outer table is our vCard image</span>
<a href="#l20.261"></a><span id="l20.261" class="difflineminus">-</span>
<a href="#l20.262"></a><span id="l20.262" class="difflineminus">-  vCardOutput += &quot;&lt;/tr&gt; &lt;/table&gt;&quot;;</span>
<a href="#l20.263"></a><span id="l20.263" class="difflineminus">-</span>
<a href="#l20.264"></a><span id="l20.264" class="difflineminus">-  // now write out the vCard</span>
<a href="#l20.265"></a><span id="l20.265" class="difflineminus">-  return COM_MimeObject_write(aMimeObj, (char *)vCardOutput.get(),</span>
<a href="#l20.266"></a><span id="l20.266" class="difflineminus">-                              vCardOutput.Length(), true);</span>
<a href="#l20.267"></a><span id="l20.267" class="difflineminus">-}</span>
<a href="#l20.268"></a><span id="l20.268" class="difflineminus">-</span>
<a href="#l20.269"></a><span id="l20.269" class="difflineminus">-static int OutputBasicVcard(MimeObject *aMimeObj, VObject *aVcard,</span>
<a href="#l20.270"></a><span id="l20.270" class="difflineminus">-                            nsACString &amp;vCardOutput) {</span>
<a href="#l20.271"></a><span id="l20.271" class="difflineminus">-  VObject *prop = NULL;</span>
<a href="#l20.272"></a><span id="l20.272" class="difflineminus">-  nsAutoCString urlstring;</span>
<a href="#l20.273"></a><span id="l20.273" class="difflineminus">-  nsAutoCString namestring;</span>
<a href="#l20.274"></a><span id="l20.274" class="difflineminus">-  nsAutoCString emailstring;</span>
<a href="#l20.275"></a><span id="l20.275" class="difflineminus">-</span>
<a href="#l20.276"></a><span id="l20.276" class="difflineminus">-  nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService =</span>
<a href="#l20.277"></a><span id="l20.277" class="difflineminus">-      do_GetService(MSGVCARDSERVICE_CONTRACT_ID);</span>
<a href="#l20.278"></a><span id="l20.278" class="difflineminus">-  if (!vCardService) return -1;</span>
<a href="#l20.279"></a><span id="l20.279" class="difflineminus">-</span>
<a href="#l20.280"></a><span id="l20.280" class="difflineminus">-  // Get the name and email, the full name is stored as a field.</span>
<a href="#l20.281"></a><span id="l20.281" class="difflineminus">-  prop = vCardService-&gt;IsAPropertyOf(aVcard, VCFullNameProp);</span>
<a href="#l20.282"></a><span id="l20.282" class="difflineminus">-  if (prop) prop = vCardService-&gt;IsAPropertyOf(prop, VCFullNameProp);</span>
<a href="#l20.283"></a><span id="l20.283" class="difflineminus">-  if (prop) {</span>
<a href="#l20.284"></a><span id="l20.284" class="difflineminus">-    if (VALUE_TYPE(prop)) {</span>
<a href="#l20.285"></a><span id="l20.285" class="difflineminus">-      if (VALUE_TYPE(prop) != VCVT_RAW)</span>
<a href="#l20.286"></a><span id="l20.286" class="difflineminus">-        namestring.Adopt(vCardService-&gt;FakeCString(prop));</span>
<a href="#l20.287"></a><span id="l20.287" class="difflineminus">-      else</span>
<a href="#l20.288"></a><span id="l20.288" class="difflineminus">-        namestring.Adopt(vCardService-&gt;VObjectAnyValue(prop));</span>
<a href="#l20.289"></a><span id="l20.289" class="difflineminus">-</span>
<a href="#l20.290"></a><span id="l20.290" class="difflineminus">-      if (!namestring.IsEmpty()) {</span>
<a href="#l20.291"></a><span id="l20.291" class="difflineminus">-        vCardOutput += &quot;&lt;td class=\&quot;moz-vcard-title-property\&quot;&gt; &quot;;</span>
<a href="#l20.292"></a><span id="l20.292" class="difflineminus">-</span>
<a href="#l20.293"></a><span id="l20.293" class="difflineminus">-        prop = vCardService-&gt;IsAPropertyOf(aVcard, VCURLProp);</span>
<a href="#l20.294"></a><span id="l20.294" class="difflineminus">-        if (prop) {</span>
<a href="#l20.295"></a><span id="l20.295" class="difflineminus">-          urlstring.Adopt(vCardService-&gt;FakeCString(prop));</span>
<a href="#l20.296"></a><span id="l20.296" class="difflineminus">-          if (urlstring.IsEmpty())</span>
<a href="#l20.297"></a><span id="l20.297" class="difflineminus">-            vCardOutput += namestring;</span>
<a href="#l20.298"></a><span id="l20.298" class="difflineminus">-          else {</span>
<a href="#l20.299"></a><span id="l20.299" class="difflineminus">-            char buf[512];</span>
<a href="#l20.300"></a><span id="l20.300" class="difflineminus">-            PR_snprintf(buf, 512,</span>
<a href="#l20.301"></a><span id="l20.301" class="difflineminus">-                        &quot;&lt;a href=&quot;</span>
<a href="#l20.302"></a><span id="l20.302" class="difflineminus">-                        &quot;%s&quot;</span>
<a href="#l20.303"></a><span id="l20.303" class="difflineminus">-                        &quot; private&gt;%s&lt;/a&gt;&quot;,</span>
<a href="#l20.304"></a><span id="l20.304" class="difflineminus">-                        urlstring.get(), namestring.get());</span>
<a href="#l20.305"></a><span id="l20.305" class="difflineminus">-            vCardOutput.Append(buf);</span>
<a href="#l20.306"></a><span id="l20.306" class="difflineminus">-          }</span>
<a href="#l20.307"></a><span id="l20.307" class="difflineminus">-        } else</span>
<a href="#l20.308"></a><span id="l20.308" class="difflineminus">-          vCardOutput += namestring;</span>
<a href="#l20.309"></a><span id="l20.309" class="difflineminus">-</span>
<a href="#l20.310"></a><span id="l20.310" class="difflineminus">-        /* get the email address */</span>
<a href="#l20.311"></a><span id="l20.311" class="difflineminus">-        prop = vCardService-&gt;IsAPropertyOf(aVcard, VCEmailAddressProp);</span>
<a href="#l20.312"></a><span id="l20.312" class="difflineminus">-        if (prop) {</span>
<a href="#l20.313"></a><span id="l20.313" class="difflineminus">-          emailstring.Adopt(vCardService-&gt;FakeCString(prop));</span>
<a href="#l20.314"></a><span id="l20.314" class="difflineminus">-          if (!emailstring.IsEmpty()) {</span>
<a href="#l20.315"></a><span id="l20.315" class="difflineminus">-            char buf[512];</span>
<a href="#l20.316"></a><span id="l20.316" class="difflineminus">-            PR_snprintf(buf, 512,</span>
<a href="#l20.317"></a><span id="l20.317" class="difflineminus">-                        &quot;&amp;nbsp;&amp;lt;&lt;a href=&quot;</span>
<a href="#l20.318"></a><span id="l20.318" class="difflineminus">-                        &quot;mailto:%s&quot;</span>
<a href="#l20.319"></a><span id="l20.319" class="difflineminus">-                        &quot; private&gt;%s&lt;/a&gt;&amp;gt;&quot;,</span>
<a href="#l20.320"></a><span id="l20.320" class="difflineminus">-                        emailstring.get(), emailstring.get());</span>
<a href="#l20.321"></a><span id="l20.321" class="difflineminus">-            vCardOutput.Append(buf);</span>
<a href="#l20.322"></a><span id="l20.322" class="difflineminus">-          }</span>
<a href="#l20.323"></a><span id="l20.323" class="difflineminus">-        }  // if email address property</span>
<a href="#l20.324"></a><span id="l20.324" class="difflineminus">-</span>
<a href="#l20.325"></a><span id="l20.325" class="difflineminus">-        vCardOutput +=</span>
<a href="#l20.326"></a><span id="l20.326" class="difflineminus">-            &quot;&lt;/td&gt; &lt;/tr&gt; &quot;;  // end the cell for the name/email address</span>
<a href="#l20.327"></a><span id="l20.327" class="difflineminus">-      }                      // if we have a name property</span>
<a href="#l20.328"></a><span id="l20.328" class="difflineminus">-    }</span>
<a href="#l20.329"></a><span id="l20.329" class="difflineminus">-  }  // if full name property</span>
<a href="#l20.330"></a><span id="l20.330" class="difflineminus">-</span>
<a href="#l20.331"></a><span id="l20.331" class="difflineminus">-  // now each basic property goes on its own line</span>
<a href="#l20.332"></a><span id="l20.332" class="difflineminus">-</span>
<a href="#l20.333"></a><span id="l20.333" class="difflineminus">-  // title</span>
<a href="#l20.334"></a><span id="l20.334" class="difflineminus">-  (void)OutputVcardAttribute(aMimeObj, aVcard, VCTitleProp, vCardOutput);</span>
<a href="#l20.335"></a><span id="l20.335" class="difflineminus">-</span>
<a href="#l20.336"></a><span id="l20.336" class="difflineminus">-  // org name and company name</span>
<a href="#l20.337"></a><span id="l20.337" class="difflineminus">-  prop = vCardService-&gt;IsAPropertyOf(aVcard, VCOrgProp);</span>
<a href="#l20.338"></a><span id="l20.338" class="difflineminus">-  if (prop) {</span>
<a href="#l20.339"></a><span id="l20.339" class="difflineminus">-    OutputVcardAttribute(aMimeObj, prop, VCOrgUnitProp, vCardOutput);</span>
<a href="#l20.340"></a><span id="l20.340" class="difflineminus">-    OutputVcardAttribute(aMimeObj, prop, VCOrgNameProp, vCardOutput);</span>
<a href="#l20.341"></a><span id="l20.341" class="difflineminus">-  }</span>
<a href="#l20.342"></a><span id="l20.342" class="difflineminus">-</span>
<a href="#l20.343"></a><span id="l20.343" class="difflineminus">-  return 0;</span>
<a href="#l20.344"></a><span id="l20.344" class="difflineminus">-}</span>
<a href="#l20.345"></a><span id="l20.345" class="difflineminus">-</span>
<a href="#l20.346"></a><span id="l20.346" class="difflineminus">-static int OutputVcardAttribute(MimeObject *aMimeObj, VObject *aVcard,</span>
<a href="#l20.347"></a><span id="l20.347" class="difflineminus">-                                const char *id, nsACString &amp;vCardOutput) {</span>
<a href="#l20.348"></a><span id="l20.348" class="difflineminus">-  VObject *prop = NULL;</span>
<a href="#l20.349"></a><span id="l20.349" class="difflineminus">-  nsAutoCString string;</span>
<a href="#l20.350"></a><span id="l20.350" class="difflineminus">-</span>
<a href="#l20.351"></a><span id="l20.351" class="difflineminus">-  nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService =</span>
<a href="#l20.352"></a><span id="l20.352" class="difflineminus">-      do_GetService(MSGVCARDSERVICE_CONTRACT_ID);</span>
<a href="#l20.353"></a><span id="l20.353" class="difflineminus">-  if (!vCardService) return -1;</span>
<a href="#l20.354"></a><span id="l20.354" class="difflineminus">-</span>
<a href="#l20.355"></a><span id="l20.355" class="difflineminus">-  prop = vCardService-&gt;IsAPropertyOf(aVcard, id);</span>
<a href="#l20.356"></a><span id="l20.356" class="difflineminus">-  if (prop)</span>
<a href="#l20.357"></a><span id="l20.357" class="difflineminus">-    if (VALUE_TYPE(prop)) {</span>
<a href="#l20.358"></a><span id="l20.358" class="difflineminus">-      if (VALUE_TYPE(prop) != VCVT_RAW)</span>
<a href="#l20.359"></a><span id="l20.359" class="difflineminus">-        string.Adopt(vCardService-&gt;FakeCString(prop));</span>
<a href="#l20.360"></a><span id="l20.360" class="difflineminus">-      else</span>
<a href="#l20.361"></a><span id="l20.361" class="difflineminus">-        string.Adopt(vCardService-&gt;VObjectAnyValue(prop));</span>
<a href="#l20.362"></a><span id="l20.362" class="difflineminus">-</span>
<a href="#l20.363"></a><span id="l20.363" class="difflineminus">-      if (!string.IsEmpty()) {</span>
<a href="#l20.364"></a><span id="l20.364" class="difflineminus">-        vCardOutput += &quot;&lt;tr&gt; &lt;td class=\&quot;moz-vcard-property\&quot;&gt;&quot;;</span>
<a href="#l20.365"></a><span id="l20.365" class="difflineminus">-        vCardOutput += string;</span>
<a href="#l20.366"></a><span id="l20.366" class="difflineminus">-        vCardOutput += &quot;&lt;/td&gt; &lt;/tr&gt; &quot;;</span>
<a href="#l20.367"></a><span id="l20.367" class="difflineminus">-      }</span>
<a href="#l20.368"></a><span id="l20.368" class="difflineminus">-    }</span>
<a href="#l20.369"></a><span id="l20.369" class="difflineminus">-</span>
<a href="#l20.370"></a><span id="l20.370" class="difflineminus">-  return 0;</span>
<a href="#l20.371"></a><span id="l20.371" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">deleted file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- a/mailnews/mime/cthandlers/vcard/mimevcrd.h</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ /dev/null</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -1,33 +0,0 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineminus">-/* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineminus">-</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineminus">-#ifndef _MIMEVCRD_H_</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineminus">-#define _MIMEVCRD_H_</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-#include &quot;mimetext.h&quot;</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-/* The MimeInlineTextHTML class implements the text/x-vcard and (maybe?</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-   someday?) the application/directory MIME content types.</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">- */</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">-</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineminus">-typedef struct MimeInlineTextVCardClass MimeInlineTextVCardClass;</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineminus">-typedef struct MimeInlineTextVCard MimeInlineTextVCard;</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineminus">-</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">-struct MimeInlineTextVCardClass {</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">-  MimeInlineTextClass text;</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineminus">-  char *vCardString;</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-};</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">-</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">-extern MimeInlineTextVCardClass mimeInlineTextVCardClass;</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-struct MimeInlineTextVCard {</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-  MimeInlineText text;</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-};</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-#define MimeInlineTextVCardClassInitializer(ITYPE, CSUPER) \</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">-  { MimeInlineTextClassInitializer(ITYPE, CSUPER) }</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">-</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-#endif /* _MIMEVCRD_H_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">deleted file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- a/mailnews/mime/cthandlers/vcard/moz.build</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ /dev/null</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -1,14 +0,0 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineminus">-# vim: set filetype=python:</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineminus">-</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineminus">-SOURCES += [</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineminus">-    'mimevcrd.cpp',</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-]</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-FINAL_LIBRARY = 'mail'</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-LOCAL_INCLUDES += [</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-    '../glue',</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-]</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

