<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 12076:9701dcb19f53b6a236dd50f9e27d882ee766e41d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9701dcb19f53b6a236dd50f9e27d882ee766e41d" />
<meta property="og:url" content="/comm-central/rev/9701dcb19f53b6a236dd50f9e27d882ee766e41d" />
<meta property="og:description" content="Bug 407956 - Remove nsISupportsArray usage from nsITreeView - adapt Thunderbird. r=mconley" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9701dcb19f53b6a236dd50f9e27d882ee766e41d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9701dcb19f53b6a236dd50f9e27d882ee766e41d">shortlog</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9701dcb19f53b6a236dd50f9e27d882ee766e41d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d">files</a> |
changeset |
<a href="/comm-central/raw-rev/9701dcb19f53b6a236dd50f9e27d882ee766e41d">raw</a>  | <a href="/comm-central/archive/9701dcb19f53b6a236dd50f9e27d882ee766e41d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=407956">Bug 407956</a> - Remove nsISupportsArray usage from nsITreeView - adapt Thunderbird. r=mconley
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 04 Mar 2013 14:40:48 -0500</td></tr>

<tr>
 <td>changeset 12076</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9701dcb19f53b6a236dd50f9e27d882ee766e41d">9701dcb19f53b6a236dd50f9e27d882ee766e41d</a></td>
</tr>



<tr>
<td>parent 12075</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1e654d550c90e1b4a101904bb84e421d9fd5a06e">1e654d550c90e1b4a101904bb84e421d9fd5a06e</a>
</td>
</tr>

<tr>
<td>child 12077</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/82aa521103e27b8b19ff68ee38adac4ab5cfb326">82aa521103e27b8b19ff68ee38adac4ab5cfb326</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9701dcb19f53b6a236dd50f9e27d882ee766e41d">8962</a></td></tr>
<tr><td>push user</td><td>trev.saunders@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 04 Mar 2013 19:46:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9701dcb19f53 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9701dcb19f53b6a236dd50f9e27d882ee766e41d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9701dcb19f53b6a236dd50f9e27d882ee766e41d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9701dcb19f53b6a236dd50f9e27d882ee766e41d&newProject=comm-central&newRevision=9701dcb19f53b6a236dd50f9e27d882ee766e41d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9701dcb19f53b6a236dd50f9e27d882ee766e41d&newProject=comm-central&newRevision=9701dcb19f53b6a236dd50f9e27d882ee766e41d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9701dcb19f53b6a236dd50f9e27d882ee766e41d&newProject=comm-central&newRevision=9701dcb19f53b6a236dd50f9e27d882ee766e41d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mconley%29&revcount=50">mconley</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=407956">407956</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=407956">Bug 407956</a> - Remove nsISupportsArray usage from nsITreeView - adapt Thunderbird. r=mconley</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/folderPane.js">mail/base/content/folderPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/folderPane.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/folderPane.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/folderPane.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/folderPane.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/folderPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/subscribe.js">mail/base/content/subscribe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/subscribe.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/subscribe.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/subscribe.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/subscribe.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/base/content/subscribe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/addrbook/content/abTrees.js">mail/components/addrbook/content/abTrees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/addrbook/content/abTrees.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/addrbook/content/abTrees.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/addrbook/content/abTrees.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/addrbook/content/abTrees.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/addrbook/content/abTrees.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/im/content/chat-messenger-overlay.js">mail/components/im/content/chat-messenger-overlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/im/content/chat-messenger-overlay.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/im/content/chat-messenger-overlay.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/im/content/chat-messenger-overlay.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/im/content/chat-messenger-overlay.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/im/content/chat-messenger-overlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/cookies.js">mail/components/preferences/cookies.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/cookies.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/cookies.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/cookies.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/cookies.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/cookies.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/permissions.js">mail/components/preferences/permissions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/permissions.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/permissions.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/permissions.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/permissions.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/components/preferences/permissions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/test/mozmill/account/test-account-tree.js">mail/test/mozmill/account/test-account-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/test/mozmill/account/test-account-tree.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/test/mozmill/account/test-account-tree.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/test/mozmill/account/test-account-tree.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/test/mozmill/account/test-account-tree.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mail/test/mozmill/account/test-account-tree.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/content/jsTreeView.js">mailnews/base/content/jsTreeView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/content/jsTreeView.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/content/jsTreeView.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/content/jsTreeView.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/content/jsTreeView.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/content/jsTreeView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/test/unit/test_nsMsgDBView.js">mailnews/base/test/unit/test_nsMsgDBView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/test/unit/test_nsMsgDBView.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/test/unit/test_nsMsgDBView.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/test/unit/test_nsMsgDBView.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/test/unit/test_nsMsgDBView.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/test/unit/test_nsMsgDBView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/util/folderUtils.jsm">mailnews/base/util/folderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/util/folderUtils.jsm">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/util/folderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/util/folderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/util/folderUtils.jsm">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/base/util/folderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/extensions/newsblog/content/feed-subscriptions.js">mailnews/extensions/newsblog/content/feed-subscriptions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/extensions/newsblog/content/feed-subscriptions.js">file</a> |
<a href="/comm-central/annotate/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/extensions/newsblog/content/feed-subscriptions.js">annotate</a> |
<a href="/comm-central/diff/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/extensions/newsblog/content/feed-subscriptions.js">diff</a> |
<a href="/comm-central/comparison/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/extensions/newsblog/content/feed-subscriptions.js">comparison</a> |
<a href="/comm-central/log/9701dcb19f53b6a236dd50f9e27d882ee766e41d/mailnews/extensions/newsblog/content/feed-subscriptions.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -708,18 +708,18 @@ let gFolderTreeView = {</span>
<a href="#l1.4"></a><span id="l1.4">   _onDragOver: function ftv_onDragOver(aEvent) {</span>
<a href="#l1.5"></a><span id="l1.5">     this._currentTransfer = aEvent.dataTransfer;</span>
<a href="#l1.6"></a><span id="l1.6">   },</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">   /**</span>
<a href="#l1.9"></a><span id="l1.9">    * CSS files will cue off of these.  Note that we reach into the rowMap's</span>
<a href="#l1.10"></a><span id="l1.10">    * items so that custom data-displays can define their own properties</span>
<a href="#l1.11"></a><span id="l1.11">    */</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  getCellProperties: function ftv_getCellProperties(aRow, aCol, aProps) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-    this._rowMap[aRow].getProperties(aProps, aCol);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+  getCellProperties: function ftv_getCellProperties(aRow, aCol) {</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    return this._rowMap[aRow].getProperties(aCol);</span>
<a href="#l1.16"></a><span id="l1.16">   },</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18">   /**</span>
<a href="#l1.19"></a><span id="l1.19">    * The actual text to display in the tree</span>
<a href="#l1.20"></a><span id="l1.20">    */</span>
<a href="#l1.21"></a><span id="l1.21">   getCellText: function ftv_getCellText(aRow, aCol) {</span>
<a href="#l1.22"></a><span id="l1.22">     if (aCol.id == &quot;folderNameCol&quot;)</span>
<a href="#l1.23"></a><span id="l1.23">       return this._rowMap[aRow].text;</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineat">@@ -740,18 +740,18 @@ let gFolderTreeView = {</span>
<a href="#l1.25"></a><span id="l1.25">   getParentIndex: function ftv_getParentIndex(aIndex) {</span>
<a href="#l1.26"></a><span id="l1.26">     return this._rowMap.indexOf(this._rowMap[aIndex]._parent);</span>
<a href="#l1.27"></a><span id="l1.27">   },</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29">   /**</span>
<a href="#l1.30"></a><span id="l1.30">    * This is duplicative for our normal ftv views, but custom data-displays may</span>
<a href="#l1.31"></a><span id="l1.31">    * want to do something special here</span>
<a href="#l1.32"></a><span id="l1.32">    */</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-  getRowProperties: function ftv_getRowProperties(aIndex, aProps) {</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-    this._rowMap[aIndex].getProperties(aProps);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+  getRowProperties: function ftv_getRowProperties(aRow) {</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+    return this._rowMap[aRow].getProperties();</span>
<a href="#l1.37"></a><span id="l1.37">   },</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">   /**</span>
<a href="#l1.40"></a><span id="l1.40">    * Check whether there are any more rows with our level before the next row</span>
<a href="#l1.41"></a><span id="l1.41">    * at our parent's level</span>
<a href="#l1.42"></a><span id="l1.42">    */</span>
<a href="#l1.43"></a><span id="l1.43">   hasNextSibling: function ftv_hasNextSibling(aIndex, aNextIndex) {</span>
<a href="#l1.44"></a><span id="l1.44">     var currentLevel = this._rowMap[aIndex].level;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineat">@@ -1070,17 +1070,17 @@ let gFolderTreeView = {</span>
<a href="#l1.46"></a><span id="l1.46">   // We don't implement any of these at the moment</span>
<a href="#l1.47"></a><span id="l1.47">   performAction: function ftv_performAction(aAction) {},</span>
<a href="#l1.48"></a><span id="l1.48">   performActionOnCell: function ftv_performActionOnCell(aAction, aRow, aCol) {},</span>
<a href="#l1.49"></a><span id="l1.49">   performActionOnRow: function ftv_performActionOnRow(aAction, aRow) {},</span>
<a href="#l1.50"></a><span id="l1.50">   selectionChanged: function ftv_selectionChanged() {},</span>
<a href="#l1.51"></a><span id="l1.51">   setCellText: function ftv_setCellText(aRow, aCol, aValue) {},</span>
<a href="#l1.52"></a><span id="l1.52">   setCellValue: function ftv_setCellValue(aRow, aCol, aValue) {},</span>
<a href="#l1.53"></a><span id="l1.53">   getCellValue: function ftv_getCellValue(aRow, aCol) {},</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-  getColumnProperties: function ftv_getColumnProperties(aCol, aProps) {},</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+  getColumnProperties: function ftv_getColumnProperties(aCol) { return &quot;&quot;; },</span>
<a href="#l1.56"></a><span id="l1.56">   getImageSrc: function ftv_getImageSrc(aRow, aCol) {},</span>
<a href="#l1.57"></a><span id="l1.57">   getProgressMode: function ftv_getProgressMode(aRow, aCol) {},</span>
<a href="#l1.58"></a><span id="l1.58">   cycleCell: function ftv_cycleCell(aRow, aCol) {},</span>
<a href="#l1.59"></a><span id="l1.59">   cycleHeader: function ftv_cycleHeader(aCol) {},</span>
<a href="#l1.60"></a><span id="l1.60"> </span>
<a href="#l1.61"></a><span id="l1.61">   // ****************** End of nsITreeView implementation **************** //</span>
<a href="#l1.62"></a><span id="l1.62"> </span>
<a href="#l1.63"></a><span id="l1.63">   //</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineat">@@ -1904,35 +1904,31 @@ ftvItem.prototype = {</span>
<a href="#l1.65"></a><span id="l1.65">       text += &quot; (&quot; + unread + &quot;)&quot;;</span>
<a href="#l1.66"></a><span id="l1.66">     return text;</span>
<a href="#l1.67"></a><span id="l1.67">   },</span>
<a href="#l1.68"></a><span id="l1.68"> </span>
<a href="#l1.69"></a><span id="l1.69">   get level() {</span>
<a href="#l1.70"></a><span id="l1.70">     return this._level;</span>
<a href="#l1.71"></a><span id="l1.71">   },</span>
<a href="#l1.72"></a><span id="l1.72"> </span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-  getProperties: function ftvItem_getProperties(aProps) {</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+  getProperties: function ftvItem_getProperties() {</span>
<a href="#l1.75"></a><span id="l1.75">     // From folderUtils.jsm</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-    setPropertyAtoms(this._folder, aProps);</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-    if (this._folder.flags &amp; nsMsgFolderFlags.Virtual) {</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-        aProps.AppendElement(Components.classes[&quot;@mozilla.org/atom-service;1&quot;]</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-                             .getService(Components.interfaces.nsIAtomService)</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-                             .getAtom(&quot;specialFolder-Smart&quot;));</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-        // a second possibility for customized smart folders</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-        aProps.AppendElement(Components.classes[&quot;@mozilla.org/atom-service;1&quot;]</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-                             .getService(Components.interfaces.nsIAtomService)</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineminus">-                             .getAtom(&quot;specialFolder-&quot;+this._folder.name.replace(' ','')));</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+    let properties = getFolderProperties(this._folder);</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+    if (this._folder.getFlag(nsMsgFolderFlags.Virtual)) {</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+      properties += &quot; specialFolder-Smart&quot;;</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+      // a second possibility for customized smart folders</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+      properties += &quot; specialFolder-&quot; + this._folder.name.replace(' ','');</span>
<a href="#l1.90"></a><span id="l1.90">     }</span>
<a href="#l1.91"></a><span id="l1.91">     // if there is a smartFolder name property, add it</span>
<a href="#l1.92"></a><span id="l1.92">     let smartFolderName = getSmartFolderName(this._folder);</span>
<a href="#l1.93"></a><span id="l1.93">     if (smartFolderName) {</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-      aProps.AppendElement(Components.classes[&quot;@mozilla.org/atom-service;1&quot;]</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineminus">-                         .getService(Components.interfaces.nsIAtomService)</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineminus">-                         .getAtom(&quot;specialFolder-&quot;+smartFolderName.replace(' ','')));</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+      properties += &quot; specialFolder-&quot; + smartFolderName.replace(' ','');</span>
<a href="#l1.98"></a><span id="l1.98">     }</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+    return properties;</span>
<a href="#l1.101"></a><span id="l1.101">   },</span>
<a href="#l1.102"></a><span id="l1.102"> </span>
<a href="#l1.103"></a><span id="l1.103">   command: function fti_command() {</span>
<a href="#l1.104"></a><span id="l1.104">     if (!Services.prefs.getBoolPref(&quot;mailnews.reuse_thread_window2&quot;))</span>
<a href="#l1.105"></a><span id="l1.105">       MsgOpenNewWindowForFolder(this._folder.URI, -1 /* key */);</span>
<a href="#l1.106"></a><span id="l1.106">   },</span>
<a href="#l1.107"></a><span id="l1.107"> </span>
<a href="#l1.108"></a><span id="l1.108">   _children: null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/subscribe.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/subscribe.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -14,20 +14,16 @@ var gFolderDelimiter = &quot;.&quot;;</span>
<a href="#l2.4"></a><span id="l2.4"> var gStatusFeedback;</span>
<a href="#l2.5"></a><span id="l2.5"> var gSubscribeDeck = null;</span>
<a href="#l2.6"></a><span id="l2.6"> var gSearchView = null;</span>
<a href="#l2.7"></a><span id="l2.7"> var gSearchTreeBoxObject = null;</span>
<a href="#l2.8"></a><span id="l2.8"> // the rdf service</span>
<a href="#l2.9"></a><span id="l2.9"> var RDF = Components.classes['@mozilla.org/rdf/rdf-service;1'].getService(Components.interfaces.nsIRDFService);</span>
<a href="#l2.10"></a><span id="l2.10"> var subscribeDS = RDF.GetDataSource(&quot;rdf:subscribe&quot;);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-// get the &quot;subscribed&quot; atom</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-var atomService = Components.classes[&quot;@mozilla.org/atom-service;1&quot;].getService().QueryInterface(Components.interfaces.nsIAtomService);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-var gSubscribedAtom = atomService.getAtom(&quot;subscribed&quot;).QueryInterface(Components.interfaces.nsISupports);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-</span>
<a href="#l2.16"></a><span id="l2.16"> var gSubscribeBundle;</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> function goDoCommand()</span>
<a href="#l2.19"></a><span id="l2.19"> {</span>
<a href="#l2.20"></a><span id="l2.20"> }</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22"> function Stop()</span>
<a href="#l2.23"></a><span id="l2.23"> {</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineat">@@ -316,29 +312,27 @@ function SearchOnClick(event)</span>
<a href="#l2.25"></a><span id="l2.25">     // double clicked on a row, reverse state</span>
<a href="#l2.26"></a><span id="l2.26">     ReverseStateFromRow(row.value);</span>
<a href="#l2.27"></a><span id="l2.27">   }</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29">   // invalidate the row</span>
<a href="#l2.30"></a><span id="l2.30">   InvalidateSearchTreeRow(row.value);</span>
<a href="#l2.31"></a><span id="l2.31"> }</span>
<a href="#l2.32"></a><span id="l2.32"> </span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-function ReverseStateFromRow(row)</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+function ReverseStateFromRow(aRow)</span>
<a href="#l2.35"></a><span id="l2.35"> {</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-    // to determine if the row is subscribed or not,</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-    // we get the properties for the &quot;subscribedColumn2&quot; cell in the row</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-    // and look for the &quot;subscribed&quot; property</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-    // if the &quot;subscribed&quot; atom is in the list of properties</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-    // we are subscribed</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-    var properties = Components.classes[&quot;@mozilla.org/supports-array;1&quot;].createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-    var col = gSearchTree.columns[&quot;subscribedColumn2&quot;];</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-    gSearchView.getCellProperties(row, col, properties);</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-    var isSubscribed = (properties.GetIndexOf(gSubscribedAtom) != -1);</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineminus">-    SetStateFromRow(row, !isSubscribed);</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+  // To determine if the row is subscribed or not,</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+  // we get the properties for the &quot;subscribedColumn2&quot; cell in the row</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+  // and look for the &quot;subscribed&quot; property.</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+  // If the &quot;subscribed&quot; string is in the list of properties</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  // we are subscribed.</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  let col = gSearchTree.columns[&quot;subscribedColumn2&quot;];</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+  let properties = gSearchView.getCellProperties(aRow, col);</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+  let isSubscribed = (properties.split(&quot; &quot;).indexOf(&quot;subscribed&quot;) != -1);</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+  SetStateFromRow(aRow, !isSubscribed);</span>
<a href="#l2.56"></a><span id="l2.56"> }</span>
<a href="#l2.57"></a><span id="l2.57"> </span>
<a href="#l2.58"></a><span id="l2.58"> function SetStateFromRow(row, state)</span>
<a href="#l2.59"></a><span id="l2.59"> {</span>
<a href="#l2.60"></a><span id="l2.60">     var col = gSearchTree.columns[&quot;nameColumn2&quot;];</span>
<a href="#l2.61"></a><span id="l2.61">     var name = gSearchView.getCellText(row, col);</span>
<a href="#l2.62"></a><span id="l2.62">     SetState(name, state);</span>
<a href="#l2.63"></a><span id="l2.63"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/addrbook/content/abTrees.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/addrbook/content/abTrees.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -54,25 +54,25 @@ abDirTreeItem.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4">       function nameSort(a, b) {</span>
<a href="#l3.5"></a><span id="l3.5">         return a._directory.dirName.localeCompare(b._directory.dirName);</span>
<a href="#l3.6"></a><span id="l3.6">       }</span>
<a href="#l3.7"></a><span id="l3.7">       this._children.sort(nameSort);</span>
<a href="#l3.8"></a><span id="l3.8">     }</span>
<a href="#l3.9"></a><span id="l3.9">     return this._children;</span>
<a href="#l3.10"></a><span id="l3.10">   },</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  getProperties: function atv_getProps(aProps) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-    var atomSvc = Components.classes[&quot;@mozilla.org/atom-service;1&quot;]</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                            .getService(Components.interfaces.nsIAtomService);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+  getProperties: function atv_getProps() {</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+    let properties = [];</span>
<a href="#l3.17"></a><span id="l3.17">     if (this._directory.isMailList)</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-      aProps.AppendElement(atomSvc.getAtom(&quot;IsMailList-true&quot;));</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+      properties.push(&quot;IsMailList-true&quot;);</span>
<a href="#l3.20"></a><span id="l3.20">     if (this._directory.isRemote)</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-      aProps.AppendElement(atomSvc.getAtom(&quot;IsRemote-true&quot;));</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+      properties.push(&quot;IsRemote-true&quot;);</span>
<a href="#l3.23"></a><span id="l3.23">     if (this._directory.isSecure)</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-      aProps.AppendElement(atomSvc.getAtom(&quot;IsSecure-true&quot;));</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+      properties.push(&quot;IsSecure-true&quot;);</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+    return properties.join(&quot; &quot;);</span>
<a href="#l3.27"></a><span id="l3.27">   }</span>
<a href="#l3.28"></a><span id="l3.28"> };</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30"> /**</span>
<a href="#l3.31"></a><span id="l3.31">  * Our actual implementation of nsITreeView.</span>
<a href="#l3.32"></a><span id="l3.32">  */</span>
<a href="#l3.33"></a><span id="l3.33"> function directoryTreeView() {}</span>
<a href="#l3.34"></a><span id="l3.34"> directoryTreeView.prototype = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/im/content/chat-messenger-overlay.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/im/content/chat-messenger-overlay.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1041,31 +1041,31 @@ function chatLogTreeGroupItem(aTitle, aL</span>
<a href="#l4.4"></a><span id="l4.4"> }</span>
<a href="#l4.5"></a><span id="l4.5"> chatLogTreeGroupItem.prototype = {</span>
<a href="#l4.6"></a><span id="l4.6">   getText: function() this._title,</span>
<a href="#l4.7"></a><span id="l4.7">   get id() this._title,</span>
<a href="#l4.8"></a><span id="l4.8">   get open() this._open,</span>
<a href="#l4.9"></a><span id="l4.9">   get level() 0,</span>
<a href="#l4.10"></a><span id="l4.10">   get _parent() null,</span>
<a href="#l4.11"></a><span id="l4.11">   get children() this._children,</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  getProperties: function(aProps) {}</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  getProperties: function() &quot;&quot;</span>
<a href="#l4.14"></a><span id="l4.14"> };</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16"> function chatLogTreeLogItem(aLog, aText, aLevel) {</span>
<a href="#l4.17"></a><span id="l4.17">   this.log = aLog;</span>
<a href="#l4.18"></a><span id="l4.18">   this._text = aText;</span>
<a href="#l4.19"></a><span id="l4.19">   this._level = aLevel;</span>
<a href="#l4.20"></a><span id="l4.20"> }</span>
<a href="#l4.21"></a><span id="l4.21"> chatLogTreeLogItem.prototype = {</span>
<a href="#l4.22"></a><span id="l4.22">   getText: function() this._text,</span>
<a href="#l4.23"></a><span id="l4.23">   get id() this.log.title,</span>
<a href="#l4.24"></a><span id="l4.24">   get open() false,</span>
<a href="#l4.25"></a><span id="l4.25">   get level() this._level,</span>
<a href="#l4.26"></a><span id="l4.26">   get children() [],</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-  getProperties: function(aProps) {}</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+  getProperties: function() &quot;&quot;</span>
<a href="#l4.29"></a><span id="l4.29"> };</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31"> function chatLogTreeView(aTree, aLogs) {</span>
<a href="#l4.32"></a><span id="l4.32">   this._tree = aTree;</span>
<a href="#l4.33"></a><span id="l4.33">   this._logs = aLogs;</span>
<a href="#l4.34"></a><span id="l4.34">   this._tree.view = this;</span>
<a href="#l4.35"></a><span id="l4.35">   this._rebuild();</span>
<a href="#l4.36"></a><span id="l4.36"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/preferences/cookies.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/preferences/cookies.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -308,19 +308,19 @@ var gCookiesWindow = {</span>
<a href="#l5.4"></a><span id="l5.4">           return (&quot;name&quot; in this._filterSet[aIndex]) ? this._filterSet[aIndex].name : &quot;&quot;;</span>
<a href="#l5.5"></a><span id="l5.5">       }</span>
<a href="#l5.6"></a><span id="l5.6">       return &quot;&quot;;</span>
<a href="#l5.7"></a><span id="l5.7">     },</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">     _selection: null,</span>
<a href="#l5.10"></a><span id="l5.10">     get selection () { return this._selection; },</span>
<a href="#l5.11"></a><span id="l5.11">     set selection (val) { this._selection = val; return val; },</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    getRowProperties: function (aIndex, aProperties) {},</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-    getCellProperties: function (aIndex, aColumn, aProperties) {},</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-    getColumnProperties: function (aColumn, aProperties) {},</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+    getRowProperties: function (aRow) { return &quot;&quot;; },</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+    getCellProperties: function (aRow, aColumn) { return &quot;&quot;; },</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+    getColumnProperties: function (aColumn) { return &quot;&quot;; },</span>
<a href="#l5.18"></a><span id="l5.18">     isContainer: function (aIndex)</span>
<a href="#l5.19"></a><span id="l5.19">     {</span>
<a href="#l5.20"></a><span id="l5.20">       if (!this._filtered) {</span>
<a href="#l5.21"></a><span id="l5.21">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l5.22"></a><span id="l5.22">         if (!item) return false;</span>
<a href="#l5.23"></a><span id="l5.23">         return item.container;</span>
<a href="#l5.24"></a><span id="l5.24">       }</span>
<a href="#l5.25"></a><span id="l5.25">       return false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/preferences/permissions.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/preferences/permissions.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -39,22 +39,21 @@ var gPermissionManager = {</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">     isSeparator: function(aIndex) { return false; },</span>
<a href="#l6.6"></a><span id="l6.6">     isSorted: function() { return false; },</span>
<a href="#l6.7"></a><span id="l6.7">     isContainer: function(aIndex) { return false; },</span>
<a href="#l6.8"></a><span id="l6.8">     setTree: function(aTree){},</span>
<a href="#l6.9"></a><span id="l6.9">     getImageSrc: function(aRow, aColumn) {},</span>
<a href="#l6.10"></a><span id="l6.10">     getProgressMode: function(aRow, aColumn) {},</span>
<a href="#l6.11"></a><span id="l6.11">     getCellValue: function(aRow, aColumn) {},</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    cycleHeader: function(column) {},</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-    getRowProperties: function(row,prop){},</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-    getColumnProperties: function(column,prop){},</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-    getCellProperties: function(row,column,prop){</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-      if (column.element.getAttribute(&quot;id&quot;) == &quot;siteCol&quot;)</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-        prop.AppendElement(this._ltrAtom);</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+    cycleHeader: function(aColumn) {},</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+    getRowProperties: function(aRow) { return &quot;&quot;; },</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+    getColumnProperties: function(aColumn) { return &quot;&quot;; },</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+    getCellProperties: function(aRow, aColumn) {</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+      return (aColumn.element.getAttribute(&quot;id&quot;) == &quot;siteCol&quot;) ? &quot;ltr&quot; : &quot;&quot;;</span>
<a href="#l6.23"></a><span id="l6.23">     }</span>
<a href="#l6.24"></a><span id="l6.24">   },</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">   _getCapabilityString: function (aCapability)</span>
<a href="#l6.27"></a><span id="l6.27">   {</span>
<a href="#l6.28"></a><span id="l6.28">     var stringKey = null;</span>
<a href="#l6.29"></a><span id="l6.29">     switch (aCapability) {</span>
<a href="#l6.30"></a><span id="l6.30">     case nsIPermissionManager.ALLOW_ACTION:</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineat">@@ -165,20 +164,16 @@ var gPermissionManager = {</span>
<a href="#l6.32"></a><span id="l6.32">     var urlLabel = document.getElementById(&quot;urlLabel&quot;);</span>
<a href="#l6.33"></a><span id="l6.33">     urlLabel.hidden = !urlFieldVisible;</span>
<a href="#l6.34"></a><span id="l6.34"> </span>
<a href="#l6.35"></a><span id="l6.35">     Services.obs.addObserver(this, &quot;perm-changed&quot;, false);</span>
<a href="#l6.36"></a><span id="l6.36"> </span>
<a href="#l6.37"></a><span id="l6.37">     this._loadPermissions();</span>
<a href="#l6.38"></a><span id="l6.38"> </span>
<a href="#l6.39"></a><span id="l6.39">     urlField.focus();</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-    this._ltrAtom = Components.classes[&quot;@mozilla.org/atom-service;1&quot;]</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-                              .getService(Components.interfaces.nsIAtomService)</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-                              .getAtom(&quot;ltr&quot;);</span>
<a href="#l6.44"></a><span id="l6.44">   },</span>
<a href="#l6.45"></a><span id="l6.45"> </span>
<a href="#l6.46"></a><span id="l6.46">   uninit: function ()</span>
<a href="#l6.47"></a><span id="l6.47">   {</span>
<a href="#l6.48"></a><span id="l6.48">     Services.obs.removeObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l6.49"></a><span id="l6.49">   },</span>
<a href="#l6.50"></a><span id="l6.50"> </span>
<a href="#l6.51"></a><span id="l6.51">   observe: function (aSubject, aTopic, aData)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-tree.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-tree.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -113,35 +113,28 @@ function subtest_check_default_account_h</span>
<a href="#l7.4"></a><span id="l7.4">   let accountTree = amc.e(&quot;accounttree&quot;);</span>
<a href="#l7.5"></a><span id="l7.5">   assert_equals(accountRow, accountTree.view.selection.currentIndex);</span>
<a href="#l7.6"></a><span id="l7.6">   let cell = accountTree.view.getItemAtIndex(accountRow).firstChild.firstChild;</span>
<a href="#l7.7"></a><span id="l7.7">   assert_equals(cell.tagName, &quot;treecell&quot;);</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">   // We can't read the computed style of the tree cell directly, so at least see</span>
<a href="#l7.10"></a><span id="l7.10">   // if the isDefaultServer-true property is set on it. Hopefully the proper style</span>
<a href="#l7.11"></a><span id="l7.11">   // is attached to this property.</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  let propArray = Cc[&quot;@mozilla.org/supports-array;1&quot;]</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                    .createInstance(Ci.nsISupportsArray);</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-  accountTree.view.getCellProperties(accountRow, accountTree.columns.getColumnAt(0),</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-                                     propArray);</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-  assert_equals(propArray.Count(), 1);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-  assert_equals(propArray.QueryElementAt(0, Ci.nsIAtom).toString(), &quot;isDefaultServer-true&quot;);</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+  let propArray = accountTree.view</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+    .getCellProperties(accountRow, accountTree.columns.getColumnAt(0)).split(&quot; &quot;);</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+  assert_not_equals(propArray.indexOf(&quot;isDefaultServer-true&quot;), -1);</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23">   // Now select another account that is not default.</span>
<a href="#l7.24"></a><span id="l7.24">   accountRow = get_account_tree_row(gPopAccount.key, null, amc);</span>
<a href="#l7.25"></a><span id="l7.25">   click_account_tree_row(amc, accountRow);</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-  cell = accountTree.view.getItemAtIndex(accountRow).firstChild.firstChild;</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-  propArray.Clear();</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-  accountTree.view.getCellProperties(accountRow, accountTree.columns.getColumnAt(0),</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-                                     propArray);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-  // There should be no properties set on its tree cell.</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-  assert_equals(propArray.Count(), 0);</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+  // There should isDefaultServer-true on its tree cell.</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+  propArray = accountTree.view</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+    .getCellProperties(accountRow, accountTree.columns.getColumnAt(0)).split(&quot; &quot;);</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+  assert_equals(propArray.indexOf(&quot;isDefaultServer-true&quot;), -1);</span>
<a href="#l7.38"></a><span id="l7.38"> }</span>
<a href="#l7.39"></a><span id="l7.39"> /**</span>
<a href="#l7.40"></a><span id="l7.40">  * Bug 58713.</span>
<a href="#l7.41"></a><span id="l7.41">  * Check if after deleting an account the next one is selected.</span>
<a href="#l7.42"></a><span id="l7.42">  *</span>
<a href="#l7.43"></a><span id="l7.43">  * This test should always be the last one as it removes our specially</span>
<a href="#l7.44"></a><span id="l7.44">  * created gPopAccount.</span>
<a href="#l7.45"></a><span id="l7.45">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/content/jsTreeView.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/content/jsTreeView.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -8,17 +8,17 @@</span>
<a href="#l8.4"></a><span id="l8.4">  * override the _rebuild function.  This function must set the _rowMap object to</span>
<a href="#l8.5"></a><span id="l8.5">  * an array of objects fitting the following interface:</span>
<a href="#l8.6"></a><span id="l8.6">  *</span>
<a href="#l8.7"></a><span id="l8.7">  * readonly attribute string id - a unique identifier for the row/object</span>
<a href="#l8.8"></a><span id="l8.8">  * readonly attribute integer level - the hierarchy level of the row</span>
<a href="#l8.9"></a><span id="l8.9">  * attribute boolean open - whether or not this item's children are exposed</span>
<a href="#l8.10"></a><span id="l8.10">  * string getText(aColName) - return the text to display for this row in the</span>
<a href="#l8.11"></a><span id="l8.11">  *                            specified column</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">- * void getProperties() - return the css-selectors</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+ * string getProperties() - return the css-selectors</span>
<a href="#l8.14"></a><span id="l8.14">  * attribute array children - return an array of child-objects also meeting this</span>
<a href="#l8.15"></a><span id="l8.15">  *                            interface</span>
<a href="#l8.16"></a><span id="l8.16">  */</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18"> function PROTO_TREE_VIEW() {</span>
<a href="#l8.19"></a><span id="l8.19">   this._tree = null;</span>
<a href="#l8.20"></a><span id="l8.20">   this._rowMap = [];</span>
<a href="#l8.21"></a><span id="l8.21">   this._persistOpenMap = [];</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -28,17 +28,17 @@ PROTO_TREE_VIEW.prototype = {</span>
<a href="#l8.23"></a><span id="l8.23">   get rowCount() {</span>
<a href="#l8.24"></a><span id="l8.24">     return this._rowMap.length;</span>
<a href="#l8.25"></a><span id="l8.25">   },</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27">   /**</span>
<a href="#l8.28"></a><span id="l8.28">    * CSS files will cue off of these.  Note that we reach into the rowMap's</span>
<a href="#l8.29"></a><span id="l8.29">    * items so that custom data-displays can define their own properties</span>
<a href="#l8.30"></a><span id="l8.30">    */</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  getCellProperties: function jstv_getCellProperties(aRow, aCol, aProps) {</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  getCellProperties: function jstv_getCellProperties(aRow, aCol) {</span>
<a href="#l8.33"></a><span id="l8.33">     return this._rowMap[aRow].getProperties(aCol);</span>
<a href="#l8.34"></a><span id="l8.34">   },</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">   /**</span>
<a href="#l8.37"></a><span id="l8.37">    * The actual text to display in the tree</span>
<a href="#l8.38"></a><span id="l8.38">    */</span>
<a href="#l8.39"></a><span id="l8.39">   getCellText: function jstv_getCellText(aRow, aCol) {</span>
<a href="#l8.40"></a><span id="l8.40">     return this._rowMap[aRow].getText(aCol.id);</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -58,18 +58,18 @@ PROTO_TREE_VIEW.prototype = {</span>
<a href="#l8.42"></a><span id="l8.42">   getParentIndex: function jstv_getParentIndex(aIndex) {</span>
<a href="#l8.43"></a><span id="l8.43">     return this._rowMap.indexOf(this._rowMap[aIndex]._parent);</span>
<a href="#l8.44"></a><span id="l8.44">   },</span>
<a href="#l8.45"></a><span id="l8.45"> </span>
<a href="#l8.46"></a><span id="l8.46">   /**</span>
<a href="#l8.47"></a><span id="l8.47">    * This is duplicative for our normal jstv views, but custom data-displays may</span>
<a href="#l8.48"></a><span id="l8.48">    * want to do something special here</span>
<a href="#l8.49"></a><span id="l8.49">    */</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-  getRowProperties: function jstv_getRowProperties(aIndex, aProps) {</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-    return this._rowMap[aIndex].getProperties();</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+  getRowProperties: function jstv_getRowProperties(aRow) {</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+    return this._rowMap[aRow].getProperties();</span>
<a href="#l8.54"></a><span id="l8.54">   },</span>
<a href="#l8.55"></a><span id="l8.55"> </span>
<a href="#l8.56"></a><span id="l8.56">   /**</span>
<a href="#l8.57"></a><span id="l8.57">    * If an item in our list has the same level and parent as us, it's a sibling</span>
<a href="#l8.58"></a><span id="l8.58">    */</span>
<a href="#l8.59"></a><span id="l8.59">   hasNextSibling: function jstv_hasNextSibling(aIndex, aNextIndex) {</span>
<a href="#l8.60"></a><span id="l8.60">     let targetLevel = this._rowMap[aIndex].level;</span>
<a href="#l8.61"></a><span id="l8.61">     for (let i = aNextIndex + 1; i &lt; this._rowMap.length; i++) {</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineat">@@ -193,17 +193,17 @@ PROTO_TREE_VIEW.prototype = {</span>
<a href="#l8.63"></a><span id="l8.63">   drop: function jstv_drop(aRow, aOrientation) {},</span>
<a href="#l8.64"></a><span id="l8.64">   performAction: function jstv_performAction(aAction) {},</span>
<a href="#l8.65"></a><span id="l8.65">   performActionOnCell: function jstv_performActionOnCell(aAction, aRow, aCol) {},</span>
<a href="#l8.66"></a><span id="l8.66">   performActionOnRow: function jstv_performActionOnRow(aAction, aRow) {},</span>
<a href="#l8.67"></a><span id="l8.67">   selectionChanged: function jstv_selectionChanged() {},</span>
<a href="#l8.68"></a><span id="l8.68">   setCellText: function jstv_setCellText(aRow, aCol, aValue) {},</span>
<a href="#l8.69"></a><span id="l8.69">   setCellValue: function jstv_setCellValue(aRow, aCol, aValue) {},</span>
<a href="#l8.70"></a><span id="l8.70">   getCellValue: function jstv_getCellValue(aRow, aCol) {},</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-  getColumnProperties: function jstv_getColumnProperties(aCol, aProps) {},</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+  getColumnProperties: function jstv_getColumnProperties(aCol) { return &quot;&quot;; },</span>
<a href="#l8.73"></a><span id="l8.73">   getImageSrc: function jstv_getImageSrc(aRow, aCol) {},</span>
<a href="#l8.74"></a><span id="l8.74">   getProgressMode: function jstv_getProgressMode(aRow, aCol) {},</span>
<a href="#l8.75"></a><span id="l8.75">   cycleCell: function jstv_cycleCell(aRow, aCol) {},</span>
<a href="#l8.76"></a><span id="l8.76">   cycleHeader: function jstv_cycleHeader(aCol) {},</span>
<a href="#l8.77"></a><span id="l8.77"> </span>
<a href="#l8.78"></a><span id="l8.78">   _tree: null,</span>
<a href="#l8.79"></a><span id="l8.79"> </span>
<a href="#l8.80"></a><span id="l8.80">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMsgDBView.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMsgDBView.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -210,18 +210,18 @@ var authorFirstLetterCustomColumn = {</span>
<a href="#l9.4"></a><span id="l9.4">   },</span>
<a href="#l9.5"></a><span id="l9.5">   getSortStringForRow: function(msgHdr) {</span>
<a href="#l9.6"></a><span id="l9.6">     return msgHdr.mime2DecodedAuthor.substr(0, 1).toUpperCase() || &quot;?&quot;;</span>
<a href="#l9.7"></a><span id="l9.7">   },</span>
<a href="#l9.8"></a><span id="l9.8">   isString: function() {</span>
<a href="#l9.9"></a><span id="l9.9">     return true;</span>
<a href="#l9.10"></a><span id="l9.10">   },</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  getCellProperties:   function(row, col, props){},</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  getRowProperties:    function(row, props){},</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  getCellProperties:   function(row, col) { return &quot;&quot;; },</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+  getRowProperties:    function(row) { return &quot;&quot;; },</span>
<a href="#l9.16"></a><span id="l9.16">   getImageSrc:         function(row, col) {return null;},</span>
<a href="#l9.17"></a><span id="l9.17">   getSortLongForRow:   function(hdr) {return 0;}</span>
<a href="#l9.18"></a><span id="l9.18"> };</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> var gDBView;</span>
<a href="#l9.21"></a><span id="l9.21"> var gTreeView;</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23"> var ViewType = Components.interfaces.nsMsgViewType;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/util/folderUtils.jsm</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/util/folderUtils.jsm</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,18 +1,18 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.6"></a><span id="l10.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> /**</span>
<a href="#l10.9"></a><span id="l10.9">  * This file contains helper methods for dealing with nsIMsgFolders.</span>
<a href="#l10.10"></a><span id="l10.10">  */</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-var EXPORTED_SYMBOLS = [&quot;setPropertyAtoms&quot;, &quot;getSpecialFolderString&quot;,</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                        &quot;getFolderFromUri&quot;, &quot;allAccountsSorted&quot;];</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+const EXPORTED_SYMBOLS = [&quot;getFolderProperties&quot;, &quot;getSpecialFolderString&quot;,</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+                          &quot;getFolderFromUri&quot;, &quot;allAccountsSorted&quot;];</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l10.18"></a><span id="l10.18"> Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> /**</span>
<a href="#l10.21"></a><span id="l10.21">  * Returns a string representation of a folder's &quot;special&quot; type</span>
<a href="#l10.22"></a><span id="l10.22">  *</span>
<a href="#l10.23"></a><span id="l10.23">  * @param aFolder  the nsIMsgFolder whose special type should be returned</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineat">@@ -36,72 +36,72 @@ function getSpecialFolderString(aFolder)</span>
<a href="#l10.25"></a><span id="l10.25">   if (aFolder.flags &amp; Ci.nsMsgFolderFlags.Archive)</span>
<a href="#l10.26"></a><span id="l10.26">     return &quot;Archive&quot;;</span>
<a href="#l10.27"></a><span id="l10.27">   if (aFolder.flags &amp; Ci.nsMsgFolderFlags.Virtual)</span>
<a href="#l10.28"></a><span id="l10.28">     return &quot;Virtual&quot;;</span>
<a href="#l10.29"></a><span id="l10.29">   return &quot;none&quot;;</span>
<a href="#l10.30"></a><span id="l10.30"> }</span>
<a href="#l10.31"></a><span id="l10.31"> </span>
<a href="#l10.32"></a><span id="l10.32"> /**</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">- * This function is meant to be used with trees. It adds atoms for all of the</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">- * common properties that css styling is based off of.</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+ * This function is meant to be used with trees. It returns the property list</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+ * for all of the common properties that css styling is based off of.</span>
<a href="#l10.37"></a><span id="l10.37">  *</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">- * @param aFolder     the folder whose properties should be added as atoms</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">- * @param aProperties the nsIProperties object where the atoms should be added</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+ * @param aFolder  the folder whose properties should be returned as a string</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+ *</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+ * @return         A string of the property names, delimited by space.</span>
<a href="#l10.43"></a><span id="l10.43">  */</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-function setPropertyAtoms(aFolder, aProperties) {</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+function getFolderProperties(aFolder) {</span>
<a href="#l10.46"></a><span id="l10.46">   const Cc = Components.classes;</span>
<a href="#l10.47"></a><span id="l10.47">   const Ci = Components.interfaces;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-  let atomSvc = Cc[&quot;@mozilla.org/atom-service;1&quot;].getService(Ci.nsIAtomService);</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-  function addAtom(aName) {</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-    aProperties.AppendElement(atomSvc.getAtom(aName));</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-  }</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+  let properties = [];</span>
<a href="#l10.53"></a><span id="l10.53"> </span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-  addAtom(&quot;folderNameCol&quot;);</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+  properties.push(&quot;folderNameCol&quot;);</span>
<a href="#l10.56"></a><span id="l10.56">   if (aFolder.getNumUnread(false) &gt; 0)</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-    addAtom(&quot;hasUnreadMessages-true&quot;);</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+    properties.push(&quot;hasUnreadMessages-true&quot;);</span>
<a href="#l10.59"></a><span id="l10.59"> </span>
<a href="#l10.60"></a><span id="l10.60">   if (aFolder.isServer)</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-    addAtom(&quot;isServer-true&quot;);</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+    properties.push(&quot;isServer-true&quot;);</span>
<a href="#l10.63"></a><span id="l10.63"> </span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-  addAtom(&quot;serverType-&quot; + aFolder.server.type);</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+  properties.push(&quot;serverType-&quot; + aFolder.server.type);</span>
<a href="#l10.66"></a><span id="l10.66"> </span>
<a href="#l10.67"></a><span id="l10.67">   // set the SpecialFolder attribute</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-  addAtom(&quot;specialFolder-&quot; + getSpecialFolderString(aFolder));</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+  properties.push(&quot;specialFolder-&quot; + getSpecialFolderString(aFolder));</span>
<a href="#l10.70"></a><span id="l10.70"> </span>
<a href="#l10.71"></a><span id="l10.71">   // Now set the biffState</span>
<a href="#l10.72"></a><span id="l10.72">   switch (aFolder.biffState) {</span>
<a href="#l10.73"></a><span id="l10.73">     case Ci.nsIMsgFolder.nsMsgBiffState_NewMail:</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-      addAtom(&quot;biffState-NewMail&quot;);</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+      properties.push(&quot;biffState-NewMail&quot;);</span>
<a href="#l10.76"></a><span id="l10.76">       break;</span>
<a href="#l10.77"></a><span id="l10.77">     case Ci.nsIMsgFolder.nsMsgBiffState_NoMail:</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineminus">-      addAtom(&quot;biffState-NoMail&quot;);</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+      properties.push(&quot;biffState-NoMail&quot;);</span>
<a href="#l10.80"></a><span id="l10.80">       break;</span>
<a href="#l10.81"></a><span id="l10.81">     default:</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-      addAtom(&quot;biffState-UnknownMail&quot;);</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+      properties.push(&quot;biffState-UnknownMail&quot;);</span>
<a href="#l10.84"></a><span id="l10.84">   }</span>
<a href="#l10.85"></a><span id="l10.85"> </span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-  addAtom(&quot;isSecure-&quot; + aFolder.server.isSecure);</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+  properties.push(&quot;isSecure-&quot; + aFolder.server.isSecure);</span>
<a href="#l10.88"></a><span id="l10.88"> </span>
<a href="#l10.89"></a><span id="l10.89">   if (aFolder.hasNewMessages)</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-    addAtom(&quot;newMessages-true&quot;);</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+    properties.push(&quot;newMessages-true&quot;);</span>
<a href="#l10.92"></a><span id="l10.92"> </span>
<a href="#l10.93"></a><span id="l10.93">   // We only set this if we're not a server</span>
<a href="#l10.94"></a><span id="l10.94">   if (!aFolder.isServer) {</span>
<a href="#l10.95"></a><span id="l10.95">     let shallowUnread = aFolder.getNumUnread(false);</span>
<a href="#l10.96"></a><span id="l10.96">     // Make sure that shallowUnread isn't negative</span>
<a href="#l10.97"></a><span id="l10.97">     if (shallowUnread &lt; 0)</span>
<a href="#l10.98"></a><span id="l10.98">       shallowUnread = 0;</span>
<a href="#l10.99"></a><span id="l10.99">     let deepUnread = aFolder.getNumUnread(true);</span>
<a href="#l10.100"></a><span id="l10.100">     if (deepUnread - shallowUnread &gt; 0)</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineminus">-      addAtom(&quot;subfoldersHaveUnreadMessages-true&quot;);</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+      properties.push(&quot;subfoldersHaveUnreadMessages-true&quot;);</span>
<a href="#l10.103"></a><span id="l10.103">   }</span>
<a href="#l10.104"></a><span id="l10.104"> </span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-  addAtom(&quot;noSelect-&quot; + aFolder.noSelect);</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-  addAtom(&quot;imapShared-&quot; + aFolder.imapShared);</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+  properties.push(&quot;noSelect-&quot; + aFolder.noSelect);</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+  properties.push(&quot;imapShared-&quot; + aFolder.imapShared);</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+  return properties.join(&quot; &quot;);</span>
<a href="#l10.111"></a><span id="l10.111"> }</span>
<a href="#l10.112"></a><span id="l10.112"> </span>
<a href="#l10.113"></a><span id="l10.113"> /**</span>
<a href="#l10.114"></a><span id="l10.114">  * Returns a folder for a particular uri</span>
<a href="#l10.115"></a><span id="l10.115">  *</span>
<a href="#l10.116"></a><span id="l10.116">  * @param aUri  the rdf uri of the folder to return</span>
<a href="#l10.117"></a><span id="l10.117">  */</span>
<a href="#l10.118"></a><span id="l10.118"> function getFolderFromUri(aUri) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -104,29 +104,16 @@ var FeedSubscriptions = {</span>
<a href="#l11.4"></a><span id="l11.4">     }</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">     this.mView.treeBox.ensureRowIsVisible(this.mView.selection.currentIndex);</span>
<a href="#l11.7"></a><span id="l11.7">     this.clearStatusInfo();</span>
<a href="#l11.8"></a><span id="l11.8">   },</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10">   mView:</span>
<a href="#l11.11"></a><span id="l11.11">   {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    _atoms: [],</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-    _getAtomFor: function(aName) {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-      if (!this._atoms[aName])</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-        this._atoms[aName] = this._makeAtom(aName);</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-      return this._atoms[aName];</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-    },</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-  </span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-    _makeAtom: function(aString) {</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-      return Cc[&quot;@mozilla.org/atom-service;1&quot;].</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-             getService(Ci.nsIAtomService).</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-             getAtom(aString);</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-    },</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-</span>
<a href="#l11.25"></a><span id="l11.25">     kRowIndexUndefined: -1,</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27">     get currentItem() {</span>
<a href="#l11.28"></a><span id="l11.28">       // Get the current selection, if any.</span>
<a href="#l11.29"></a><span id="l11.29">       let seln = this.selection;</span>
<a href="#l11.30"></a><span id="l11.30">       let currentSelectionIndex = seln ? seln.currentIndex : null;</span>
<a href="#l11.31"></a><span id="l11.31">       let item;</span>
<a href="#l11.32"></a><span id="l11.32">       if (currentSelectionIndex != null)</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineat">@@ -154,24 +141,23 @@ var FeedSubscriptions = {</span>
<a href="#l11.34"></a><span id="l11.34">     getImageSrc: function(aRow, aCol)      { return null; },</span>
<a href="#l11.35"></a><span id="l11.35">     getProgressMode : function(aRow, aCol) {},</span>
<a href="#l11.36"></a><span id="l11.36">     cycleHeader: function(aCol)            {},</span>
<a href="#l11.37"></a><span id="l11.37">     cycleCell: function(aRow, aCol)        {},</span>
<a href="#l11.38"></a><span id="l11.38">     selectionChanged: function()           {},</span>
<a href="#l11.39"></a><span id="l11.39">     performAction: function(aAction)       {},</span>
<a href="#l11.40"></a><span id="l11.40">     performActionOnRow: function (aAction, aRow)       {},</span>
<a href="#l11.41"></a><span id="l11.41">     performActionOnCell: function(aAction, aRow, aCol) {},</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-    getRowProperties: function(aRow, aProperties)      {},</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-    getColumnProperties: function(aCol, aProperties)   {},</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+    getRowProperties: function(aRow)                   { return &quot;&quot;; },</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+    getColumnProperties: function(aCol)                { return &quot;&quot;; },</span>
<a href="#l11.46"></a><span id="l11.46">     getCellValue: function (aRow, aColumn)             {},</span>
<a href="#l11.47"></a><span id="l11.47">     setCellValue: function (aRow, aColumn, aValue)     {},</span>
<a href="#l11.48"></a><span id="l11.48">     setCellText: function (aRow, aColumn, aValue)      {},</span>
<a href="#l11.49"></a><span id="l11.49"> </span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-    getCellProperties: function (aRow, aColumn, aProperties) {</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-//      aProperties.AppendElement(this._getAtomFor(&quot;folderNameCol&quot;));</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+    getCellProperties: function (aRow, aColumn) {</span>
<a href="#l11.53"></a><span id="l11.53">       let item = this.getItemAtIndex(aRow);</span>
<a href="#l11.54"></a><span id="l11.54">       let folder = item &amp;&amp; item.folder ? item.folder : null;</span>
<a href="#l11.55"></a><span id="l11.55">       return !folder ? &quot;serverType-rss&quot; :</span>
<a href="#l11.56"></a><span id="l11.56">              folder.isServer ? &quot;serverType=rss isServer-true&quot; : &quot;livemark&quot;;</span>
<a href="#l11.57"></a><span id="l11.57">     },</span>
<a href="#l11.58"></a><span id="l11.58"> </span>
<a href="#l11.59"></a><span id="l11.59">     isContainer: function (aRow)</span>
<a href="#l11.60"></a><span id="l11.60">     {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

