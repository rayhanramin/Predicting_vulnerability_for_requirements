<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 1265:963289aacfa31ded39683c31fe0e6959bd2e77b6</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 963289aacfa31ded39683c31fe0e6959bd2e77b6" />
<meta property="og:url" content="/comm-central/rev/963289aacfa31ded39683c31fe0e6959bd2e77b6" />
<meta property="og:description" content="Bug 453797 - Port Bug 392303 (Simplify installer changes) to SeaMonkey installer, r=Neil, blocking2.0a2=IanN" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 963289aacfa31ded39683c31fe0e6959bd2e77b6 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/963289aacfa31ded39683c31fe0e6959bd2e77b6">shortlog</a> |
<a href="/comm-central/log/963289aacfa31ded39683c31fe0e6959bd2e77b6">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/963289aacfa31ded39683c31fe0e6959bd2e77b6">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/963289aacfa31ded39683c31fe0e6959bd2e77b6">files</a> |
changeset |
<a href="/comm-central/raw-rev/963289aacfa31ded39683c31fe0e6959bd2e77b6">raw</a>  | <a href="/comm-central/archive/963289aacfa31ded39683c31fe0e6959bd2e77b6.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=453797">Bug 453797</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=392303">Bug 392303</a> (Simplify installer changes) to SeaMonkey installer, r=Neil, blocking2.0a2=IanN
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#114;&#97;&#110;&#107;&#32;&#87;&#101;&#105;&#110;&#32;&#60;&#109;&#99;&#115;&#109;&#117;&#114;&#102;&#64;&#109;&#99;&#115;&#109;&#117;&#114;&#102;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 01 Dec 2008 09:17:21 +0100</td></tr>

<tr>
 <td>changeset 1265</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/963289aacfa31ded39683c31fe0e6959bd2e77b6">963289aacfa31ded39683c31fe0e6959bd2e77b6</a></td>
</tr>



<tr>
<td>parent 1264</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ba6cc9834591a247a834adb4dfdf62b399671ad7">ba6cc9834591a247a834adb4dfdf62b399671ad7</a>
</td>
</tr>

<tr>
<td>child 1266</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/28df2a677d26241f6cdf6db03b60b4fd42ab4baf">28df2a677d26241f6cdf6db03b60b4fd42ab4baf</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=963289aacfa31ded39683c31fe0e6959bd2e77b6">989</a></td></tr>
<tr><td>push user</td><td>mcsmurf@mcsmurf.de</td></tr>
<tr><td>push date</td><td class="date age">Mon, 01 Dec 2008 08:25:50 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@28df2a677d26 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=28df2a677d26241f6cdf6db03b60b4fd42ab4baf">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=28df2a677d26241f6cdf6db03b60b4fd42ab4baf&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=28df2a677d26241f6cdf6db03b60b4fd42ab4baf&newProject=comm-central&newRevision=963289aacfa31ded39683c31fe0e6959bd2e77b6&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=28df2a677d26241f6cdf6db03b60b4fd42ab4baf&newProject=comm-central&newRevision=963289aacfa31ded39683c31fe0e6959bd2e77b6&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=28df2a677d26241f6cdf6db03b60b4fd42ab4baf&newProject=comm-central&newRevision=963289aacfa31ded39683c31fe0e6959bd2e77b6&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=453797">453797</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=392303">392303</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=453797">Bug 453797</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=392303">Bug 392303</a> (Simplify installer changes) to SeaMonkey installer, r=Neil, blocking2.0a2=IanN</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/custom.nsi">suite/installer/windows/nsis/custom.nsi</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/custom.nsi">file</a> |
<a href="/comm-central/annotate/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/custom.nsi">annotate</a> |
<a href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/custom.nsi">diff</a> |
<a href="/comm-central/comparison/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/custom.nsi">comparison</a> |
<a href="/comm-central/log/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/custom.nsi">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/defines.nsi.in">suite/installer/windows/nsis/defines.nsi.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/defines.nsi.in">file</a> |
<a href="/comm-central/annotate/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/defines.nsi.in">annotate</a> |
<a href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/defines.nsi.in">diff</a> |
<a href="/comm-central/comparison/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/defines.nsi.in">comparison</a> |
<a href="/comm-central/log/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/defines.nsi.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/installer.nsi">suite/installer/windows/nsis/installer.nsi</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/installer.nsi">file</a> |
<a href="/comm-central/annotate/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/installer.nsi">annotate</a> |
<a href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/installer.nsi">diff</a> |
<a href="/comm-central/comparison/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/installer.nsi">comparison</a> |
<a href="/comm-central/log/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/installer.nsi">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/shared.nsh">suite/installer/windows/nsis/shared.nsh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/shared.nsh">file</a> |
<a href="/comm-central/annotate/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/shared.nsh">annotate</a> |
<a href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/shared.nsh">diff</a> |
<a href="/comm-central/comparison/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/shared.nsh">comparison</a> |
<a href="/comm-central/log/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/shared.nsh">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/uninstaller.nsi">suite/installer/windows/nsis/uninstaller.nsi</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/uninstaller.nsi">file</a> |
<a href="/comm-central/annotate/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/uninstaller.nsi">annotate</a> |
<a href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/uninstaller.nsi">diff</a> |
<a href="/comm-central/comparison/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/uninstaller.nsi">comparison</a> |
<a href="/comm-central/log/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/installer/windows/nsis/uninstaller.nsi">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/locales/en-US/installer/windows/custom.properties">suite/locales/en-US/installer/windows/custom.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/locales/en-US/installer/windows/custom.properties">file</a> |
<a href="/comm-central/annotate/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/locales/en-US/installer/windows/custom.properties">annotate</a> |
<a href="/comm-central/diff/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/locales/en-US/installer/windows/custom.properties">diff</a> |
<a href="/comm-central/comparison/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/locales/en-US/installer/windows/custom.properties">comparison</a> |
<a href="/comm-central/log/963289aacfa31ded39683c31fe0e6959bd2e77b6/suite/locales/en-US/installer/windows/custom.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/installer/windows/nsis/custom.nsi</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/installer/windows/nsis/custom.nsi</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -71,104 +71,104 @@</span>
<a href="#l1.4"></a><span id="l1.4">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Bottom &quot;$R3&quot;</span>
<a href="#l1.5"></a><span id="l1.5">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; State  &quot;1&quot;</span>
<a href="#l1.6"></a><span id="l1.6">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Flags  &quot;GROUP&quot;</span>
<a href="#l1.7"></a><span id="l1.7">     ${GetSize} &quot;$EXEDIR\optional\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot; &quot;/S=0K&quot; $0 $8 $9</span>
<a href="#l1.8"></a><span id="l1.8">     ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@chatzilla.mozilla.org&quot;</span>
<a href="#l1.9"></a><span id="l1.9">       ${GetSize} &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@chatzilla.mozilla.org&quot; &quot;/S=0K&quot; $1 $8 $9</span>
<a href="#l1.10"></a><span id="l1.10">       IntOp $0 $0 + $1</span>
<a href="#l1.11"></a><span id="l1.11">     ${EndIf}</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    SectionSetSize 1 $0</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    SectionSetSize ${CZ_IDX} $0</span>
<a href="#l1.14"></a><span id="l1.14">     IntOp $R1 $R1 + 1</span>
<a href="#l1.15"></a><span id="l1.15">     IntOp $R2 $R2 + $R4</span>
<a href="#l1.16"></a><span id="l1.16">     IntOp $R3 $R3 + $R4</span>
<a href="#l1.17"></a><span id="l1.17">   ${Else}</span>
<a href="#l1.18"></a><span id="l1.18">     ; Hide ChatZilla in the components page if it isn't available.</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-    SectionSetText 1 &quot;&quot;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+    SectionSetText ${CZ_IDX} &quot;&quot;</span>
<a href="#l1.21"></a><span id="l1.21">   ${EndIf}</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\inspector@mozilla.org&quot;</span>
<a href="#l1.24"></a><span id="l1.24">     ; Set the details for DOMI</span>
<a href="#l1.25"></a><span id="l1.25">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Type   &quot;checkbox&quot;</span>
<a href="#l1.26"></a><span id="l1.26">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Text   &quot;$(DOMI_TITLE)&quot;</span>
<a href="#l1.27"></a><span id="l1.27">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Left   &quot;15&quot;</span>
<a href="#l1.28"></a><span id="l1.28">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Right  &quot;-1&quot;</span>
<a href="#l1.29"></a><span id="l1.29">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Top    &quot;$R2&quot;</span>
<a href="#l1.30"></a><span id="l1.30">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Bottom &quot;$R3&quot;</span>
<a href="#l1.31"></a><span id="l1.31">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; State  &quot;1&quot;</span>
<a href="#l1.32"></a><span id="l1.32">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Flags  &quot;GROUP&quot;</span>
<a href="#l1.33"></a><span id="l1.33">     ${GetSize} &quot;$EXEDIR\optional\extensions\inspector@mozilla.org&quot; &quot;/S=0K&quot; $0 $8 $9</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-    SectionSetSize 2 $0</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+    SectionSetSize ${DOMI_IDX} $0</span>
<a href="#l1.36"></a><span id="l1.36">     IntOp $R1 $R1 + 1</span>
<a href="#l1.37"></a><span id="l1.37">     IntOp $R2 $R2 + $R4</span>
<a href="#l1.38"></a><span id="l1.38">     IntOp $R3 $R3 + $R4</span>
<a href="#l1.39"></a><span id="l1.39">   ${Else}</span>
<a href="#l1.40"></a><span id="l1.40">     ; Hide DOMi in the components page if it isn't available.</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-    SectionSetText 2 &quot;&quot;</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+    SectionSetText ${DOMI_IDX} &quot;&quot;</span>
<a href="#l1.43"></a><span id="l1.43">   ${EndIf}</span>
<a href="#l1.44"></a><span id="l1.44"> </span>
<a href="#l1.45"></a><span id="l1.45">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\debugQA@mozilla.org&quot;</span>
<a href="#l1.46"></a><span id="l1.46">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Type   &quot;checkbox&quot;</span>
<a href="#l1.47"></a><span id="l1.47">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Text   &quot;$(DEBUGQA_TITLE)&quot;</span>
<a href="#l1.48"></a><span id="l1.48">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Left   &quot;15&quot;</span>
<a href="#l1.49"></a><span id="l1.49">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Right  &quot;-1&quot;</span>
<a href="#l1.50"></a><span id="l1.50">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Top    &quot;$R2&quot;</span>
<a href="#l1.51"></a><span id="l1.51">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Bottom &quot;$R3&quot;</span>
<a href="#l1.52"></a><span id="l1.52">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; State  &quot;1&quot;</span>
<a href="#l1.53"></a><span id="l1.53">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Flags  &quot;GROUP&quot;</span>
<a href="#l1.54"></a><span id="l1.54">     ${GetSize} &quot;$EXEDIR\optional\extensions\debugQA@mozilla.org&quot; &quot;/S=0K&quot; $0 $8 $9</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-    SectionSetSize 3 $0</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+    SectionSetSize ${DEBUG_IDX} $0</span>
<a href="#l1.57"></a><span id="l1.57">     IntOp $R1 $R1 + 1</span>
<a href="#l1.58"></a><span id="l1.58">     IntOp $R2 $R2 + $R4</span>
<a href="#l1.59"></a><span id="l1.59">     IntOp $R3 $R3 + $R4</span>
<a href="#l1.60"></a><span id="l1.60">   ${Else}</span>
<a href="#l1.61"></a><span id="l1.61">     ; Hide debugQA in the components page if it isn't available.</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-    SectionSetText 3 &quot;&quot;</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+    SectionSetText ${DEBUG_IDX} &quot;&quot;</span>
<a href="#l1.64"></a><span id="l1.64">   ${EndIf}</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\p@m&quot;</span>
<a href="#l1.67"></a><span id="l1.67">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Type   &quot;checkbox&quot;</span>
<a href="#l1.68"></a><span id="l1.68">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Text   &quot;$(PALMSYNC_TITLE)&quot;</span>
<a href="#l1.69"></a><span id="l1.69">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Left   &quot;15&quot;</span>
<a href="#l1.70"></a><span id="l1.70">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Right  &quot;-1&quot;</span>
<a href="#l1.71"></a><span id="l1.71">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Top    &quot;$R2&quot;</span>
<a href="#l1.72"></a><span id="l1.72">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Bottom &quot;$R3&quot;</span>
<a href="#l1.73"></a><span id="l1.73">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; State  &quot;1&quot;</span>
<a href="#l1.74"></a><span id="l1.74">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Flags  &quot;GROUP&quot;</span>
<a href="#l1.75"></a><span id="l1.75">     ${GetSize} &quot;$EXEDIR\optional\extensions\p@m&quot; &quot;/S=0K&quot; $0 $8 $9</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-    SectionSetSize 4 $0</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+    SectionSetSize ${PALM_IDX} $0</span>
<a href="#l1.78"></a><span id="l1.78">     IntOp $R1 $R1 + 1</span>
<a href="#l1.79"></a><span id="l1.79">     IntOp $R2 $R2 + $R4</span>
<a href="#l1.80"></a><span id="l1.80">     IntOp $R3 $R3 + $R4</span>
<a href="#l1.81"></a><span id="l1.81">   ${Else}</span>
<a href="#l1.82"></a><span id="l1.82">     ; Hide Palm Sync in the components page if it isn't available.</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-    SectionSetText 4 &quot;&quot;</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+    SectionSetText ${PALM_IDX} &quot;&quot;</span>
<a href="#l1.85"></a><span id="l1.85">   ${EndIf}</span>
<a href="#l1.86"></a><span id="l1.86"> </span>
<a href="#l1.87"></a><span id="l1.87">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\{f13b157f-b174-47e7-a34d-4815ddfdfeb8}&quot;</span>
<a href="#l1.88"></a><span id="l1.88">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Type   &quot;checkbox&quot;</span>
<a href="#l1.89"></a><span id="l1.89">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Text   &quot;$(VENKMAN_TITLE)&quot;</span>
<a href="#l1.90"></a><span id="l1.90">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Left   &quot;15&quot;</span>
<a href="#l1.91"></a><span id="l1.91">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Right  &quot;-1&quot;</span>
<a href="#l1.92"></a><span id="l1.92">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Top    &quot;$R2&quot;</span>
<a href="#l1.93"></a><span id="l1.93">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Bottom &quot;$R3&quot;</span>
<a href="#l1.94"></a><span id="l1.94">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; State  &quot;1&quot;</span>
<a href="#l1.95"></a><span id="l1.95">     WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field $R1&quot; Flags  &quot;GROUP&quot;</span>
<a href="#l1.96"></a><span id="l1.96">     ${GetSize} &quot;$EXEDIR\optional\extensions\{f13b157f-b174-47e7-a34d-4815ddfdfeb8}&quot; &quot;/S=0K&quot; $0 $8 $9</span>
<a href="#l1.97"></a><span id="l1.97">     ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot;</span>
<a href="#l1.98"></a><span id="l1.98">       ${GetSize} &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot; &quot;/S=0K&quot; $1 $8 $9</span>
<a href="#l1.99"></a><span id="l1.99">       IntOp $0 $0 + $1</span>
<a href="#l1.100"></a><span id="l1.100">     ${EndIf}</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineminus">-    SectionSetSize 5 $0</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+    SectionSetSize ${VENKMAN_IDX} $0</span>
<a href="#l1.103"></a><span id="l1.103">     IntOp $R1 $R1 + 1</span>
<a href="#l1.104"></a><span id="l1.104">     IntOp $R2 $R2 + $R4</span>
<a href="#l1.105"></a><span id="l1.105">     IntOp $R3 $R3 + $R4</span>
<a href="#l1.106"></a><span id="l1.106">   ${Else}</span>
<a href="#l1.107"></a><span id="l1.107">     ; Hide Venkman in the components page if it isn't available.</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineminus">-    SectionSetText 5 &quot;&quot;</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+    SectionSetText ${VENKMAN_IDX} &quot;&quot;</span>
<a href="#l1.110"></a><span id="l1.110">   ${EndIf}</span>
<a href="#l1.111"></a><span id="l1.111"> </span>
<a href="#l1.112"></a><span id="l1.112">   ; Set new values for the top and bottom of labels</span>
<a href="#l1.113"></a><span id="l1.113">   ; Top of label box</span>
<a href="#l1.114"></a><span id="l1.114">   StrCpy $R2 27</span>
<a href="#l1.115"></a><span id="l1.115">   ; Bottom of label box</span>
<a href="#l1.116"></a><span id="l1.116">   StrCpy $R3 47</span>
<a href="#l1.117"></a><span id="l1.117"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/installer/windows/nsis/defines.nsi.in</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/installer/windows/nsis/defines.nsi.in</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -10,8 +10,9 @@</span>
<a href="#l2.4"></a><span id="l2.4"> !define FileMainEXE           &quot;@MOZ_APP_NAME@.exe&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> !define WindowClass           &quot;SeaMonkeyMessageWindow&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> !define DDEApplication        &quot;SeaMonkey&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> !define AppRegName            &quot;SeaMonkey&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> !define AppRegNameMail        &quot;SeaMonkey (Mail)&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> !define AppRegNameNews        &quot;SeaMonkey (News)&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+!define MinSupportedVer       &quot;Microsoft Windows 2000&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/installer/windows/nsis/installer.nsi</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/installer/windows/nsis/installer.nsi</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -31,96 +31,115 @@</span>
<a href="#l3.4"></a><span id="l3.4"> # decision by deleting the provisions above and replace them with the notice</span>
<a href="#l3.5"></a><span id="l3.5"> # and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l3.6"></a><span id="l3.6"> # the provisions above, a recipient may use your version of this file under</span>
<a href="#l3.7"></a><span id="l3.7"> # the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.8"></a><span id="l3.8"> #</span>
<a href="#l3.9"></a><span id="l3.9"> # ***** END LICENSE BLOCK *****</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11"> # Also requires:</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+# AppAssocReg http://nsis.sourceforge.net/Application_Association_Registration_plug-in</span>
<a href="#l3.13"></a><span id="l3.13"> # ShellLink plugin http://nsis.sourceforge.net/ShellLink_plug-in</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+# UAC         http://nsis.sourceforge.net/UAC_plug-in</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> ; Set verbosity to 3 (e.g. no script) to lessen the noise in the build logs</span>
<a href="#l3.17"></a><span id="l3.17"> !verbose 3</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> ; 7-Zip provides better compression than the lzma from NSIS so we add the files</span>
<a href="#l3.20"></a><span id="l3.20"> ; uncompressed and use 7-Zip to create a SFX archive of it</span>
<a href="#l3.21"></a><span id="l3.21"> SetDatablockOptimize on</span>
<a href="#l3.22"></a><span id="l3.22"> SetCompress off</span>
<a href="#l3.23"></a><span id="l3.23"> CRCCheck on</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+RequestExecutionLevel user</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+</span>
<a href="#l3.27"></a><span id="l3.27"> !addplugindir ./</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29"> ; empty files - except for the comment line - for generating custom pages.</span>
<a href="#l3.30"></a><span id="l3.30"> !system 'echo ; &gt; options.ini'</span>
<a href="#l3.31"></a><span id="l3.31"> !system 'echo ; &gt; components.ini'</span>
<a href="#l3.32"></a><span id="l3.32"> !system 'echo ; &gt; shortcuts.ini'</span>
<a href="#l3.33"></a><span id="l3.33"> !system 'echo ; &gt; summary.ini'</span>
<a href="#l3.34"></a><span id="l3.34"> </span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+; USE_UAC_PLUGIN is temporary until other apps have been updated to use the UAC plugin</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+!define USE_UAC_PLUGIN</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+</span>
<a href="#l3.38"></a><span id="l3.38"> Var TmpVal</span>
<a href="#l3.39"></a><span id="l3.39"> Var StartMenuDir</span>
<a href="#l3.40"></a><span id="l3.40"> Var InstallType</span>
<a href="#l3.41"></a><span id="l3.41"> Var AddStartMenuSC</span>
<a href="#l3.42"></a><span id="l3.42"> Var AddQuickLaunchSC</span>
<a href="#l3.43"></a><span id="l3.43"> Var AddDesktopSC</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-Var fhInstallLog</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-Var fhUninstallLog</span>
<a href="#l3.46"></a><span id="l3.46"> </span>
<a href="#l3.47"></a><span id="l3.47"> ; Other included files may depend upon these includes!</span>
<a href="#l3.48"></a><span id="l3.48"> ; The following includes are provided by NSIS.</span>
<a href="#l3.49"></a><span id="l3.49"> !include FileFunc.nsh</span>
<a href="#l3.50"></a><span id="l3.50"> !include LogicLib.nsh</span>
<a href="#l3.51"></a><span id="l3.51"> !include TextFunc.nsh</span>
<a href="#l3.52"></a><span id="l3.52"> !include WinMessages.nsh</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+!include WinVer.nsh</span>
<a href="#l3.54"></a><span id="l3.54"> !include WordFunc.nsh</span>
<a href="#l3.55"></a><span id="l3.55"> !include MUI.nsh</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-!insertmacro FileJoin</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-!insertmacro GetTime</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-!insertmacro LineFind</span>
<a href="#l3.60"></a><span id="l3.60"> !insertmacro StrFilter</span>
<a href="#l3.61"></a><span id="l3.61"> !insertmacro TrimNewLines</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-!insertmacro WordFind</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-!insertmacro WordReplace</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-!insertmacro GetSize</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+!insertmacro GetOptions</span>
<a href="#l3.66"></a><span id="l3.66"> !insertmacro GetParameters</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-!insertmacro GetOptions</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-!insertmacro GetRoot</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-!insertmacro DriveSpace</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-!insertmacro GetParent</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+!insertmacro GetSize</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+!insertmacro WordFind</span>
<a href="#l3.73"></a><span id="l3.73"> </span>
<a href="#l3.74"></a><span id="l3.74"> ; NSIS provided macros that we have overridden</span>
<a href="#l3.75"></a><span id="l3.75"> !include overrides.nsh</span>
<a href="#l3.76"></a><span id="l3.76"> !insertmacro LocateNoDetails</span>
<a href="#l3.77"></a><span id="l3.77"> !insertmacro TextCompareNoDetails</span>
<a href="#l3.78"></a><span id="l3.78"> </span>
<a href="#l3.79"></a><span id="l3.79"> ; The following includes are custom.</span>
<a href="#l3.80"></a><span id="l3.80"> !include branding.nsi</span>
<a href="#l3.81"></a><span id="l3.81"> !include defines.nsi</span>
<a href="#l3.82"></a><span id="l3.82"> !include common.nsh</span>
<a href="#l3.83"></a><span id="l3.83"> !include locales.nsi</span>
<a href="#l3.84"></a><span id="l3.84"> !include version.nsh</span>
<a href="#l3.85"></a><span id="l3.85"> !include custom.nsi</span>
<a href="#l3.86"></a><span id="l3.86"> </span>
<a href="#l3.87"></a><span id="l3.87"> VIAddVersionKey &quot;FileDescription&quot; &quot;${BrandShortName} Installer&quot;</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+VIAddVersionKey &quot;OrginalFilename&quot; &quot;setup.exe&quot;</span>
<a href="#l3.89"></a><span id="l3.89"> </span>
<a href="#l3.90"></a><span id="l3.90" class="difflineminus">-!insertmacro GetLongPath</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+; Must be inserted before other macros that use logging</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+!insertmacro _LoggingCommon</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+!insertmacro AddDDEHandlerValues</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+!insertmacro AddHandlerValues</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+!insertmacro ChangeMUIHeaderImage</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+!insertmacro CheckForFilesInUse</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+!insertmacro CleanUpdatesDir</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+!insertmacro CloseApp</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+!insertmacro CreateRegKey</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+!insertmacro CopyFilesFromDir</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+!insertmacro GetPathFromString</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+!insertmacro GetParent</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+!insertmacro IsHandlerForInstallDir</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+!insertmacro ManualCloseAppPrompt</span>
<a href="#l3.106"></a><span id="l3.106"> !insertmacro RegCleanMain</span>
<a href="#l3.107"></a><span id="l3.107"> !insertmacro RegCleanUninstall</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-!insertmacro CloseApp</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+!insertmacro CreateRegKey</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+!insertmacro UnloadUAC</span>
<a href="#l3.111"></a><span id="l3.111"> !insertmacro WriteRegStr2</span>
<a href="#l3.112"></a><span id="l3.112"> !insertmacro WriteRegDWORD2</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineminus">-!insertmacro CreateRegKey</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineminus">-!insertmacro CanWriteToInstallDir</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-!insertmacro CheckDiskSpace</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-!insertmacro GetPathFromString</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-!insertmacro AddHandlerValues</span>
<a href="#l3.118"></a><span id="l3.118"> </span>
<a href="#l3.119"></a><span id="l3.119"> !include shared.nsh</span>
<a href="#l3.120"></a><span id="l3.120"> </span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+; Helper macros for ui callbacks. Insert these after shared.nsh</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+!insertmacro CheckCustomCommon</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+!insertmacro InstallEndCleanupCommon</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+!insertmacro InstallOnInitCommon</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+!insertmacro InstallStartCleanupCommon</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+!insertmacro LeaveDirectoryCommon</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+!insertmacro OnEndCommon</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+!insertmacro PreDirectoryCommon</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+</span>
<a href="#l3.130"></a><span id="l3.130"> Name &quot;${BrandFullName}&quot;</span>
<a href="#l3.131"></a><span id="l3.131"> OutFile &quot;setup.exe&quot;</span>
<a href="#l3.132"></a><span id="l3.132"> InstallDirRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${BrandFullNameInternal} (${AppVersion})&quot; &quot;InstallLocation&quot;</span>
<a href="#l3.133"></a><span id="l3.133"> InstallDir &quot;$PROGRAMFILES\${BrandFullName}\&quot;</span>
<a href="#l3.134"></a><span id="l3.134"> ShowInstDetails nevershow</span>
<a href="#l3.135"></a><span id="l3.135"> </span>
<a href="#l3.136"></a><span id="l3.136"> ReserveFile options.ini</span>
<a href="#l3.137"></a><span id="l3.137"> ReserveFile components.ini</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineat">@@ -144,19 +163,21 @@ ReserveFile summary.ini</span>
<a href="#l3.139"></a><span id="l3.139"> !else</span>
<a href="#l3.140"></a><span id="l3.140"> !define MUI_HEADERIMAGE_BITMAP wizHeader.bmp</span>
<a href="#l3.141"></a><span id="l3.141"> !endif</span>
<a href="#l3.142"></a><span id="l3.142"> </span>
<a href="#l3.143"></a><span id="l3.143"> /**</span>
<a href="#l3.144"></a><span id="l3.144">  * Installation Pages</span>
<a href="#l3.145"></a><span id="l3.145">  */</span>
<a href="#l3.146"></a><span id="l3.146"> ; Welcome Page</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+!define MUI_PAGE_CUSTOMFUNCTION_PRE preWelcome</span>
<a href="#l3.148"></a><span id="l3.148"> !insertmacro MUI_PAGE_WELCOME</span>
<a href="#l3.149"></a><span id="l3.149"> </span>
<a href="#l3.150"></a><span id="l3.150"> ; License Page</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+!define MUI_PAGE_CUSTOMFUNCTION_SHOW showLicense</span>
<a href="#l3.152"></a><span id="l3.152"> !define MUI_LICENSEPAGE_CHECKBOX</span>
<a href="#l3.153"></a><span id="l3.153"> !insertmacro MUI_PAGE_LICENSE license.txt</span>
<a href="#l3.154"></a><span id="l3.154"> </span>
<a href="#l3.155"></a><span id="l3.155"> ; Custom Options Page</span>
<a href="#l3.156"></a><span id="l3.156"> Page custom preOptions leaveOptions</span>
<a href="#l3.157"></a><span id="l3.157"> </span>
<a href="#l3.158"></a><span id="l3.158"> ; Custom Components Page</span>
<a href="#l3.159"></a><span id="l3.159"> Page custom preComponents leaveComponents</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineat">@@ -167,108 +188,65 @@ Page custom preComponents leaveComponent</span>
<a href="#l3.161"></a><span id="l3.161"> !define MUI_DIRECTORYPAGE_VERIFYONLEAVE</span>
<a href="#l3.162"></a><span id="l3.162"> !insertmacro MUI_PAGE_DIRECTORY</span>
<a href="#l3.163"></a><span id="l3.163"> </span>
<a href="#l3.164"></a><span id="l3.164"> ; Custom Shortcuts Page</span>
<a href="#l3.165"></a><span id="l3.165"> Page custom preShortcuts leaveShortcuts</span>
<a href="#l3.166"></a><span id="l3.166"> </span>
<a href="#l3.167"></a><span id="l3.167"> ; Start Menu Folder Page Configuration</span>
<a href="#l3.168"></a><span id="l3.168"> !define MUI_PAGE_CUSTOMFUNCTION_PRE preStartMenu</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+!define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveStartMenu</span>
<a href="#l3.170"></a><span id="l3.170"> !define MUI_STARTMENUPAGE_NODISABLE</span>
<a href="#l3.171"></a><span id="l3.171"> !define MUI_STARTMENUPAGE_REGISTRY_ROOT &quot;HKLM&quot;</span>
<a href="#l3.172"></a><span id="l3.172"> !define MUI_STARTMENUPAGE_REGISTRY_KEY &quot;Software\Mozilla\${BrandFullNameInternal}\${AppVersion} (${AB_CD})\Main&quot;</span>
<a href="#l3.173"></a><span id="l3.173"> !define MUI_STARTMENUPAGE_REGISTRY_VALUENAME &quot;Start Menu Folder&quot;</span>
<a href="#l3.174"></a><span id="l3.174"> !insertmacro MUI_PAGE_STARTMENU Application $StartMenuDir</span>
<a href="#l3.175"></a><span id="l3.175"> </span>
<a href="#l3.176"></a><span id="l3.176"> ; Custom Summary Page</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-Page custom preSummary</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+Page custom preSummary leaveSummary</span>
<a href="#l3.179"></a><span id="l3.179"> </span>
<a href="#l3.180"></a><span id="l3.180"> ; Install Files Page</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-!define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveInstFiles</span>
<a href="#l3.182"></a><span id="l3.182"> !insertmacro MUI_PAGE_INSTFILES</span>
<a href="#l3.183"></a><span id="l3.183"> </span>
<a href="#l3.184"></a><span id="l3.184"> ; Finish Page</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-!define MUI_FINISHPAGE_NOREBOOTSUPPORT</span>
<a href="#l3.186"></a><span id="l3.186"> !define MUI_FINISHPAGE_TITLE_3LINES</span>
<a href="#l3.187"></a><span id="l3.187"> !define MUI_FINISHPAGE_RUN</span>
<a href="#l3.188"></a><span id="l3.188"> !define MUI_FINISHPAGE_RUN_FUNCTION LaunchApp</span>
<a href="#l3.189"></a><span id="l3.189"> !define MUI_FINISHPAGE_RUN_TEXT $(LAUNCH_TEXT)</span>
<a href="#l3.190"></a><span id="l3.190"> !define MUI_PAGE_CUSTOMFUNCTION_PRE preFinish</span>
<a href="#l3.191"></a><span id="l3.191"> !insertmacro MUI_PAGE_FINISH</span>
<a href="#l3.192"></a><span id="l3.192"> </span>
<a href="#l3.193"></a><span id="l3.193" class="difflineminus">-################################################################################</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineminus">-# Install Sections</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+; Use the default dialog for IDD_VERIFY for a simple Banner</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+ChangeUI IDD_VERIFY &quot;${NSISDIR}\Contrib\UIs\default.exe&quot;</span>
<a href="#l3.197"></a><span id="l3.197"> </span>
<a href="#l3.198"></a><span id="l3.198" class="difflineminus">-Section &quot;-Application&quot; Section1</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineminus">-  SectionIn 1 RO</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineminus">-  SetDetailsPrint textonly</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+################################################################################</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineplus">+</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+; Cleanup operations to perform at the start of the installation.</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineplus">+Section &quot;-InstallStartCleanup&quot;</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineplus">+  SetDetailsPrint both</span>
<a href="#l3.206"></a><span id="l3.206">   DetailPrint $(STATUS_CLEANUP)</span>
<a href="#l3.207"></a><span id="l3.207">   SetDetailsPrint none</span>
<a href="#l3.208"></a><span id="l3.208"> </span>
<a href="#l3.209"></a><span id="l3.209" class="difflineminus">-  ; Try to delete the app's main executable and if we can't delete it try to</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineminus">-  ; close the app. This allows running an instance that is located in another</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineminus">-  ; directory and prevents the launching of the app during the installation.</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineminus">-  ; A copy of the executable is placed in a temporary directory so it can be</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineminus">-  ; copied back in the case where a specific file is checked / found to be in</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineminus">-  ; use that would prevent a successful install.</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineplus">+  SetOutPath &quot;$INSTDIR&quot;</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+  ${StartInstallLog} &quot;${BrandFullName}&quot; &quot;${AB_CD}&quot; &quot;${AppVersion}&quot; &quot;${GREVersion}&quot;</span>
<a href="#l3.217"></a><span id="l3.217"> </span>
<a href="#l3.218"></a><span id="l3.218" class="difflineminus">-  ; Create a temporary backup directory</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineminus">-  GetTempFileName $TmpVal &quot;$TEMP&quot;</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineminus">-  ${DeleteFile} $TmpVal</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineminus">-  SetOutPath $TmpVal</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineminus">-</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineminus">-  ${If} ${FileExists} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineplus">+  ; Delete the app exe to prevent launching the app while we are installing.</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineplus">+  ClearErrors</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineplus">+  ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineplus">+    ; If the user closed the application it can take several seconds for it to</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineplus">+    ; shut down completely. If the application is being used by another user we</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineplus">+    ; can rename the file and then delete is when the system is restarted.</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineplus">+    Sleep 5000</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineplus">+    ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.233"></a><span id="l3.233">     ClearErrors</span>
<a href="#l3.234"></a><span id="l3.234" class="difflineminus">-    CopyFiles /SILENT &quot;$INSTDIR\${FileMainEXE}&quot; &quot;$TmpVal\${FileMainEXE}&quot;</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineminus">-    Delete &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineminus">-    ${If} ${Errors}</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineminus">-      ClearErrors</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineminus">-      ${CloseApp} &quot;true&quot; $(WARN_APP_RUNNING_INSTALL)</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineminus">-      ; Try to delete it again to prevent launching the app while we are</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineminus">-      ; installing.</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineminus">-      ClearErrors</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineminus">-      CopyFiles /SILENT &quot;$INSTDIR\${FileMainEXE}&quot; &quot;$TmpVal\${FileMainEXE}&quot;</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineminus">-      Delete &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineminus">-      ${If} ${Errors}</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineminus">-        ClearErrors</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineminus">-        ; Try closing the app a second time</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineminus">-        ${CloseApp} &quot;true&quot; $(WARN_APP_RUNNING_INSTALL)</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineminus">-        StrCpy $R1 &quot;${FileMainEXE}&quot;</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineminus">-        Call CheckInUse</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineminus">-      ${EndIf}</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineminus">-    ${EndIf}</span>
<a href="#l3.252"></a><span id="l3.252">   ${EndIf}</span>
<a href="#l3.253"></a><span id="l3.253"> </span>
<a href="#l3.254"></a><span id="l3.254" class="difflineminus">-  StrCpy $R1 &quot;freebl3.dll&quot;</span>
<a href="#l3.255"></a><span id="l3.255" class="difflineminus">-  Call CheckInUse</span>
<a href="#l3.256"></a><span id="l3.256" class="difflineminus">-</span>
<a href="#l3.257"></a><span id="l3.257" class="difflineminus">-  StrCpy $R1 &quot;nssckbi.dll&quot;</span>
<a href="#l3.258"></a><span id="l3.258" class="difflineminus">-  Call CheckInUse</span>
<a href="#l3.259"></a><span id="l3.259" class="difflineminus">-</span>
<a href="#l3.260"></a><span id="l3.260" class="difflineminus">-  StrCpy $R1 &quot;nspr4.dll&quot;</span>
<a href="#l3.261"></a><span id="l3.261" class="difflineminus">-  Call CheckInUse</span>
<a href="#l3.262"></a><span id="l3.262" class="difflineminus">-</span>
<a href="#l3.263"></a><span id="l3.263" class="difflineminus">-  StrCpy $R1 &quot;xpicleanup.exe&quot;</span>
<a href="#l3.264"></a><span id="l3.264" class="difflineminus">-  Call CheckInUse</span>
<a href="#l3.265"></a><span id="l3.265" class="difflineminus">-</span>
<a href="#l3.266"></a><span id="l3.266" class="difflineminus">-  SetOutPath $INSTDIR</span>
<a href="#l3.267"></a><span id="l3.267" class="difflineminus">-  RmDir /r &quot;$TmpVal&quot;</span>
<a href="#l3.268"></a><span id="l3.268" class="difflineminus">-  ClearErrors</span>
<a href="#l3.269"></a><span id="l3.269" class="difflineminus">-</span>
<a href="#l3.270"></a><span id="l3.270" class="difflineminus">-  ; During an install Vista checks if a new entry is added under the uninstall</span>
<a href="#l3.271"></a><span id="l3.271" class="difflineminus">-  ; registry key (e.g. ARP). When the same version of the app is installed on</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineminus">-  ; top of an existing install the key is deleted / added and the Program</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineminus">-  ; Compatibility Assistant doesn't see this as a new entry and displays an</span>
<a href="#l3.274"></a><span id="l3.274" class="difflineminus">-  ; error to the user. See Bug 354000.</span>
<a href="#l3.275"></a><span id="l3.275" class="difflineminus">-  StrCpy $0 &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${BrandFullNameInternal} (${AppVersion})&quot;</span>
<a href="#l3.276"></a><span id="l3.276" class="difflineminus">-  DeleteRegKey HKLM &quot;$0&quot;</span>
<a href="#l3.277"></a><span id="l3.277" class="difflineminus">-</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineminus">-  ; Custom installs.</span>
<a href="#l3.279"></a><span id="l3.279" class="difflineminus">-  ${If} $InstallType != 1</span>
<a href="#l3.280"></a><span id="l3.280" class="difflineminus">-</span>
<a href="#l3.281"></a><span id="l3.281" class="difflineplus">+  ${If} $InstallType == ${INSTALLTYPE_CUSTOM}</span>
<a href="#l3.282"></a><span id="l3.282" class="difflineplus">+    ; Custom installs.</span>
<a href="#l3.283"></a><span id="l3.283">     ; If ChatZilla is installed and this install includes ChatZilla remove it</span>
<a href="#l3.284"></a><span id="l3.284">     ; from the installation directory. This will remove it if the user</span>
<a href="#l3.285"></a><span id="l3.285">     ; deselected ChatZilla on the components page.</span>
<a href="#l3.286"></a><span id="l3.286">     ${If} ${FileExists} &quot;$INSTDIR\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot;</span>
<a href="#l3.287"></a><span id="l3.287">     ${AndIf} ${FileExists} &quot;$EXEDIR\optional\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot;</span>
<a href="#l3.288"></a><span id="l3.288">       RmDir /r &quot;$INSTDIR\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot;</span>
<a href="#l3.289"></a><span id="l3.289">     ${EndIf}</span>
<a href="#l3.290"></a><span id="l3.290">     ${If} ${FileExists} &quot;$INSTDIR\extensions\langpack-${AB_CD}@chatzilla.mozilla.org&quot;</span>
<a href="#l3.291"></a><span id="l3.291" class="difflineat">@@ -308,74 +286,34 @@ Section &quot;-Application&quot; Section1</span>
<a href="#l3.292"></a><span id="l3.292">       RmDir /r &quot;$INSTDIR\extensions\{f13b157f-b174-47e7-a34d-4815ddfdfeb8}&quot;</span>
<a href="#l3.293"></a><span id="l3.293">     ${EndIf}</span>
<a href="#l3.294"></a><span id="l3.294">     ${If} ${FileExists} &quot;$INSTDIR\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot;</span>
<a href="#l3.295"></a><span id="l3.295">     ${AndIf} ${FileExists} &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot;</span>
<a href="#l3.296"></a><span id="l3.296">       RmDir /r &quot;$INSTDIR\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot;</span>
<a href="#l3.297"></a><span id="l3.297">     ${EndIf}</span>
<a href="#l3.298"></a><span id="l3.298">   ${EndIf}</span>
<a href="#l3.299"></a><span id="l3.299"> </span>
<a href="#l3.300"></a><span id="l3.300" class="difflineminus">-  Call CleanupOldLogs</span>
<a href="#l3.301"></a><span id="l3.301" class="difflineminus">-</span>
<a href="#l3.302"></a><span id="l3.302" class="difflineminus">-  ${If} ${FileExists} &quot;$INSTDIR\uninstall\uninstall.log&quot;</span>
<a href="#l3.303"></a><span id="l3.303" class="difflineminus">-    ; Diff cleanup.log with uninstall.bak</span>
<a href="#l3.304"></a><span id="l3.304" class="difflineminus">-    ${LogHeader} &quot;Updating Uninstall Log With XPInstall Wizard Logs&quot;</span>
<a href="#l3.305"></a><span id="l3.305" class="difflineminus">-    StrCpy $R0 &quot;$INSTDIR\uninstall\uninstall.log&quot;</span>
<a href="#l3.306"></a><span id="l3.306" class="difflineminus">-    StrCpy $R1 &quot;$INSTDIR\uninstall\cleanup.log&quot;</span>
<a href="#l3.307"></a><span id="l3.307" class="difflineminus">-    GetTempFileName $R2</span>
<a href="#l3.308"></a><span id="l3.308" class="difflineminus">-    FileOpen $R3 $R2 w</span>
<a href="#l3.309"></a><span id="l3.309" class="difflineminus">-    ${TextCompareNoDetails} &quot;$R1&quot; &quot;$R0&quot; &quot;SlowDiff&quot; &quot;GetDiff&quot;</span>
<a href="#l3.310"></a><span id="l3.310" class="difflineminus">-    FileClose $R3</span>
<a href="#l3.311"></a><span id="l3.311" class="difflineminus">-</span>
<a href="#l3.312"></a><span id="l3.312" class="difflineminus">-    ${Unless} ${Errors}</span>
<a href="#l3.313"></a><span id="l3.313" class="difflineminus">-      ${FileJoin} &quot;$INSTDIR\uninstall\uninstall.log&quot; &quot;$R2&quot; &quot;$INSTDIR\uninstall\uninstall.log&quot;</span>
<a href="#l3.314"></a><span id="l3.314" class="difflineminus">-    ${EndUnless}</span>
<a href="#l3.315"></a><span id="l3.315" class="difflineminus">-    ${DeleteFile} &quot;$INSTDIR\uninstall\cleanup.log&quot;</span>
<a href="#l3.316"></a><span id="l3.316" class="difflineminus">-    ${DeleteFile} &quot;$R2&quot;</span>
<a href="#l3.317"></a><span id="l3.317" class="difflineminus">-    ${DeleteFile} &quot;$INSTDIR\uninstall\uninstall.bak&quot;</span>
<a href="#l3.318"></a><span id="l3.318" class="difflineminus">-    Rename &quot;$INSTDIR\uninstall\uninstall.log&quot; &quot;$INSTDIR\uninstall\uninstall.bak&quot;</span>
<a href="#l3.319"></a><span id="l3.319" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.320"></a><span id="l3.320" class="difflineminus">-</span>
<a href="#l3.321"></a><span id="l3.321" class="difflineminus">-  ${Unless} ${FileExists} &quot;$INSTDIR\uninstall&quot;</span>
<a href="#l3.322"></a><span id="l3.322" class="difflineminus">-    CreateDirectory &quot;$INSTDIR\uninstall&quot;</span>
<a href="#l3.323"></a><span id="l3.323" class="difflineminus">-  ${EndUnless}</span>
<a href="#l3.324"></a><span id="l3.324" class="difflineplus">+  ; Remove the updates directory for Vista and above</span>
<a href="#l3.325"></a><span id="l3.325" class="difflineplus">+  ${CleanUpdatesDir} &quot;Mozilla\SeaMonkey&quot;</span>
<a href="#l3.326"></a><span id="l3.326"> </span>
<a href="#l3.327"></a><span id="l3.327" class="difflineminus">-  FileOpen $fhUninstallLog &quot;$INSTDIR\uninstall\uninstall.log&quot; w</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineminus">-  FileOpen $fhInstallLog &quot;$INSTDIR\install.log&quot; w</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineminus">-</span>
<a href="#l3.330"></a><span id="l3.330" class="difflineminus">-  ${GetTime} &quot;&quot; &quot;L&quot; $0 $1 $2 $3 $4 $5 $6</span>
<a href="#l3.331"></a><span id="l3.331" class="difflineminus">-  FileWrite $fhInstallLog &quot;${BrandFullName} Installation Started: $2-$1-$0 $4:$5:$6&quot;</span>
<a href="#l3.332"></a><span id="l3.332" class="difflineminus">-  Call WriteLogSeparator</span>
<a href="#l3.333"></a><span id="l3.333" class="difflineminus">-</span>
<a href="#l3.334"></a><span id="l3.334" class="difflineminus">-  ${LogHeader} &quot;Installation Details&quot;</span>
<a href="#l3.335"></a><span id="l3.335" class="difflineminus">-  ${LogMsg} &quot;Install Dir: $INSTDIR&quot;</span>
<a href="#l3.336"></a><span id="l3.336" class="difflineminus">-  ${LogMsg} &quot;Locale     : ${AB_CD}&quot;</span>
<a href="#l3.337"></a><span id="l3.337" class="difflineminus">-  ${LogMsg} &quot;App Version: ${AppVersion}&quot;</span>
<a href="#l3.338"></a><span id="l3.338" class="difflineminus">-  ${LogMsg} &quot;GRE Version: ${GREVersion}&quot;</span>
<a href="#l3.339"></a><span id="l3.339" class="difflineplus">+  ${InstallStartCleanupCommon}</span>
<a href="#l3.340"></a><span id="l3.340" class="difflineplus">+SectionEnd</span>
<a href="#l3.341"></a><span id="l3.341"> </span>
<a href="#l3.342"></a><span id="l3.342" class="difflineminus">-  ${If} ${FileExists} &quot;$EXEDIR\removed-files.log&quot;</span>
<a href="#l3.343"></a><span id="l3.343" class="difflineminus">-    ${LogHeader} &quot;Removing Obsolete Files and Directories&quot;</span>
<a href="#l3.344"></a><span id="l3.344" class="difflineminus">-    ${LineFind} &quot;$EXEDIR\removed-files.log&quot; &quot;/NUL&quot; &quot;1:-1&quot; &quot;onInstallDeleteFile&quot;</span>
<a href="#l3.345"></a><span id="l3.345" class="difflineminus">-    ${LineFind} &quot;$EXEDIR\removed-files.log&quot; &quot;/NUL&quot; &quot;1:-1&quot; &quot;onInstallRemoveDir&quot;</span>
<a href="#l3.346"></a><span id="l3.346" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.347"></a><span id="l3.347" class="difflineplus">+Section &quot;-Application&quot; APP_IDX</span>
<a href="#l3.348"></a><span id="l3.348" class="difflineplus">+  ${StartUninstallLog}</span>
<a href="#l3.349"></a><span id="l3.349"> </span>
<a href="#l3.350"></a><span id="l3.350" class="difflineminus">-  ${DeleteFile} &quot;$INSTDIR\install_wizard.log&quot;</span>
<a href="#l3.351"></a><span id="l3.351" class="difflineminus">-  ${DeleteFile} &quot;$INSTDIR\install_status.log&quot;</span>
<a href="#l3.352"></a><span id="l3.352" class="difflineminus">-</span>
<a href="#l3.353"></a><span id="l3.353" class="difflineminus">-  RmDir /r &quot;$INSTDIR\updates&quot;</span>
<a href="#l3.354"></a><span id="l3.354" class="difflineminus">-  ${DeleteFile} &quot;$INSTDIR\updates.xml&quot;</span>
<a href="#l3.355"></a><span id="l3.355" class="difflineminus">-  ${DeleteFile} &quot;$INSTDIR\active-update.xml&quot;</span>
<a href="#l3.356"></a><span id="l3.356" class="difflineminus">-</span>
<a href="#l3.357"></a><span id="l3.357" class="difflineminus">-  SetDetailsPrint textonly</span>
<a href="#l3.358"></a><span id="l3.358" class="difflineplus">+  SetDetailsPrint both </span>
<a href="#l3.359"></a><span id="l3.359">   DetailPrint $(STATUS_INSTALL_APP)</span>
<a href="#l3.360"></a><span id="l3.360">   SetDetailsPrint none</span>
<a href="#l3.361"></a><span id="l3.361" class="difflineplus">+</span>
<a href="#l3.362"></a><span id="l3.362">   ${LogHeader} &quot;Installing Main Files&quot;</span>
<a href="#l3.363"></a><span id="l3.363" class="difflineminus">-  StrCpy $R0 &quot;$EXEDIR\nonlocalized&quot;</span>
<a href="#l3.364"></a><span id="l3.364" class="difflineminus">-  StrCpy $R1 &quot;$INSTDIR&quot;</span>
<a href="#l3.365"></a><span id="l3.365" class="difflineminus">-  Call DoCopyFiles</span>
<a href="#l3.366"></a><span id="l3.366" class="difflineplus">+  ${CopyFilesFromDir} &quot;$EXEDIR\nonlocalized&quot; &quot;$INSTDIR&quot; \</span>
<a href="#l3.367"></a><span id="l3.367" class="difflineplus">+                      &quot;$(ERROR_CREATE_DIRECTORY_PREFIX)&quot; \</span>
<a href="#l3.368"></a><span id="l3.368" class="difflineplus">+                      &quot;$(ERROR_CREATE_DIRECTORY_SUFFIX)&quot;</span>
<a href="#l3.369"></a><span id="l3.369" class="difflineplus">+</span>
<a href="#l3.370"></a><span id="l3.370"> </span>
<a href="#l3.371"></a><span id="l3.371">   ; Register DLLs</span>
<a href="#l3.372"></a><span id="l3.372">   ; XXXrstrong - AccessibleMarshal.dll can be used by multiple applications but</span>
<a href="#l3.373"></a><span id="l3.373">   ; is only registered for the last application installed. When the last</span>
<a href="#l3.374"></a><span id="l3.374">   ; application installed is uninstalled AccessibleMarshal.dll will no longer be</span>
<a href="#l3.375"></a><span id="l3.375">   ; registered. bug 338878</span>
<a href="#l3.376"></a><span id="l3.376">   ${LogHeader} &quot;DLL Registration&quot;</span>
<a href="#l3.377"></a><span id="l3.377">   ClearErrors</span>
<a href="#l3.378"></a><span id="l3.378" class="difflineat">@@ -395,29 +333,24 @@ Section &quot;-Application&quot; Section1</span>
<a href="#l3.379"></a><span id="l3.379">   ${LogUninstall} &quot;File: \components\xpti.dat&quot;</span>
<a href="#l3.380"></a><span id="l3.380">   ${LogUninstall} &quot;File: \.autoreg&quot;</span>
<a href="#l3.381"></a><span id="l3.381">   ${LogUninstall} &quot;File: \active-update.xml&quot;</span>
<a href="#l3.382"></a><span id="l3.382">   ${LogUninstall} &quot;File: \install.log&quot;</span>
<a href="#l3.383"></a><span id="l3.383">   ${LogUninstall} &quot;File: \install_status.log&quot;</span>
<a href="#l3.384"></a><span id="l3.384">   ${LogUninstall} &quot;File: \install_wizard.log&quot;</span>
<a href="#l3.385"></a><span id="l3.385">   ${LogUninstall} &quot;File: \updates.xml&quot;</span>
<a href="#l3.386"></a><span id="l3.386"> </span>
<a href="#l3.387"></a><span id="l3.387" class="difflineminus">-  SetDetailsPrint textonly</span>
<a href="#l3.388"></a><span id="l3.388" class="difflineplus">+  SetDetailsPrint both</span>
<a href="#l3.389"></a><span id="l3.389">   DetailPrint $(STATUS_INSTALL_LANG)</span>
<a href="#l3.390"></a><span id="l3.390">   SetDetailsPrint none</span>
<a href="#l3.391"></a><span id="l3.391" class="difflineplus">+</span>
<a href="#l3.392"></a><span id="l3.392">   ${LogHeader} &quot;Installing Localized Files&quot;</span>
<a href="#l3.393"></a><span id="l3.393" class="difflineminus">-  StrCpy $R0 &quot;$EXEDIR\localized&quot;</span>
<a href="#l3.394"></a><span id="l3.394" class="difflineminus">-  StrCpy $R1 &quot;$INSTDIR&quot;</span>
<a href="#l3.395"></a><span id="l3.395" class="difflineminus">-  Call DoCopyFiles</span>
<a href="#l3.396"></a><span id="l3.396" class="difflineminus">-</span>
<a href="#l3.397"></a><span id="l3.397" class="difflineminus">-  ${If} $InstallType != 4</span>
<a href="#l3.398"></a><span id="l3.398" class="difflineminus">-    Call installChatZilla</span>
<a href="#l3.399"></a><span id="l3.399" class="difflineminus">-    Call installInspector</span>
<a href="#l3.400"></a><span id="l3.400" class="difflineminus">-    Call installVenkman</span>
<a href="#l3.401"></a><span id="l3.401" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.402"></a><span id="l3.402" class="difflineplus">+  ${CopyFilesFromDir} &quot;$EXEDIR\localized&quot; &quot;$INSTDIR&quot; \</span>
<a href="#l3.403"></a><span id="l3.403" class="difflineplus">+                      &quot;$(ERROR_CREATE_DIRECTORY_PREFIX)&quot; \</span>
<a href="#l3.404"></a><span id="l3.404" class="difflineplus">+                      &quot;$(ERROR_CREATE_DIRECTORY_SUFFIX)&quot;</span>
<a href="#l3.405"></a><span id="l3.405"> </span>
<a href="#l3.406"></a><span id="l3.406">   ${LogHeader} &quot;Adding Additional Files&quot;</span>
<a href="#l3.407"></a><span id="l3.407">   ; Check if QuickTime is installed and copy the nsIQTScriptablePlugin.xpt from </span>
<a href="#l3.408"></a><span id="l3.408">   ; directory into the app's components directory.</span>
<a href="#l3.409"></a><span id="l3.409">   ClearErrors</span>
<a href="#l3.410"></a><span id="l3.410">   ReadRegStr $R0 HKLM &quot;Software\Apple Computer, Inc.\QuickTime&quot; &quot;InstallDir&quot;</span>
<a href="#l3.411"></a><span id="l3.411">   ${Unless} ${Errors}</span>
<a href="#l3.412"></a><span id="l3.412">     Push $R0</span>
<a href="#l3.413"></a><span id="l3.413" class="difflineat">@@ -450,56 +383,65 @@ Section &quot;-Application&quot; Section1</span>
<a href="#l3.414"></a><span id="l3.414">     StrCpy $AddQuickLaunchSC &quot;1&quot;</span>
<a href="#l3.415"></a><span id="l3.415">   ${EndIf}</span>
<a href="#l3.416"></a><span id="l3.416"> </span>
<a href="#l3.417"></a><span id="l3.417">   ; Default for creating Desktop shortcut (1 = create, 0 = don't create)</span>
<a href="#l3.418"></a><span id="l3.418">   ${If} $AddDesktopSC == &quot;&quot;</span>
<a href="#l3.419"></a><span id="l3.419">     StrCpy $AddDesktopSC &quot;1&quot;</span>
<a href="#l3.420"></a><span id="l3.420">   ${EndIf}</span>
<a href="#l3.421"></a><span id="l3.421"> </span>
<a href="#l3.422"></a><span id="l3.422" class="difflineminus">-  ; Remove registry entries for non-existent apps and for apps that point to our</span>
<a href="#l3.423"></a><span id="l3.423" class="difflineminus">-  ; install location in the Software\Mozilla key and uninstall registry entries</span>
<a href="#l3.424"></a><span id="l3.424" class="difflineminus">-  ; that point to our install location for both HKCU and HKLM.</span>
<a href="#l3.425"></a><span id="l3.425" class="difflineplus">+  ${LogHeader} &quot;Adding Registry Entries&quot;</span>
<a href="#l3.426"></a><span id="l3.426">   SetShellVarContext current  ; Set SHCTX to HKCU</span>
<a href="#l3.427"></a><span id="l3.427">   ${RegCleanMain} &quot;Software\Mozilla&quot;</span>
<a href="#l3.428"></a><span id="l3.428">   ${RegCleanUninstall}</span>
<a href="#l3.429"></a><span id="l3.429" class="difflineminus">-</span>
<a href="#l3.430"></a><span id="l3.430" class="difflineminus">-  SetShellVarContext all  ; Set SHCTX to HKLM</span>
<a href="#l3.431"></a><span id="l3.431" class="difflineminus">-  ${RegCleanMain} &quot;Software\Mozilla&quot;</span>
<a href="#l3.432"></a><span id="l3.432" class="difflineminus">-  ${RegCleanUninstall}</span>
<a href="#l3.433"></a><span id="l3.433" class="difflineplus">+  ${UpdateProtocolHandlers}</span>
<a href="#l3.434"></a><span id="l3.434"> </span>
<a href="#l3.435"></a><span id="l3.435" class="difflineminus">-  ${LogHeader} &quot;Adding Registry Entries&quot;</span>
<a href="#l3.436"></a><span id="l3.436">   ClearErrors</span>
<a href="#l3.437"></a><span id="l3.437" class="difflineminus">-  WriteRegStr HKLM &quot;Software\Mozilla\InstallerTest&quot; &quot;InstallerTest&quot; &quot;Test&quot;</span>
<a href="#l3.438"></a><span id="l3.438" class="difflineplus">+  WriteRegStr HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot; &quot;Write Test&quot;</span>
<a href="#l3.439"></a><span id="l3.439">   ${If} ${Errors}</span>
<a href="#l3.440"></a><span id="l3.440" class="difflineminus">-    SetShellVarContext current  ; Set SHCTX to HKCU</span>
<a href="#l3.441"></a><span id="l3.441">     StrCpy $TmpVal &quot;HKCU&quot; ; used primarily for logging</span>
<a href="#l3.442"></a><span id="l3.442">   ${Else}</span>
<a href="#l3.443"></a><span id="l3.443">     SetShellVarContext all  ; Set SHCTX to HKLM</span>
<a href="#l3.444"></a><span id="l3.444" class="difflineminus">-    DeleteRegKey HKLM &quot;Software\Mozilla\InstallerTest&quot;</span>
<a href="#l3.445"></a><span id="l3.445" class="difflineplus">+    DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l3.446"></a><span id="l3.446">     StrCpy $TmpVal &quot;HKLM&quot; ; used primarily for logging</span>
<a href="#l3.447"></a><span id="l3.447" class="difflineplus">+    ${RegCleanMain} &quot;Software\Mozilla&quot;</span>
<a href="#l3.448"></a><span id="l3.448" class="difflineplus">+    ${RegCleanUninstall}</span>
<a href="#l3.449"></a><span id="l3.449" class="difflineplus">+    ${UpdateProtocolHandlers}</span>
<a href="#l3.450"></a><span id="l3.450">   ${EndIf}</span>
<a href="#l3.451"></a><span id="l3.451"> </span>
<a href="#l3.452"></a><span id="l3.452" class="difflineminus">-  ; The previous installer adds several regsitry values to both HKLM and HKCU.</span>
<a href="#l3.453"></a><span id="l3.453" class="difflineplus">+  ; The previous installer adds several registry values to both HKLM and HKCU.</span>
<a href="#l3.454"></a><span id="l3.454">   ; We now try to add to HKLM and if that fails to HKCU</span>
<a href="#l3.455"></a><span id="l3.455"> </span>
<a href="#l3.456"></a><span id="l3.456">   ; The order that reg keys and values are added is important if you use the</span>
<a href="#l3.457"></a><span id="l3.457">   ; uninstall log to remove them on uninstall. When using the uninstall log you</span>
<a href="#l3.458"></a><span id="l3.458">   ; MUST add children first so they will be removed first on uninstall so they</span>
<a href="#l3.459"></a><span id="l3.459">   ; will be empty when the key is deleted. This allows the uninstaller to</span>
<a href="#l3.460"></a><span id="l3.460">   ; specify that only empty keys will be deleted.</span>
<a href="#l3.461"></a><span id="l3.461">   ${SetAppKeys}</span>
<a href="#l3.462"></a><span id="l3.462"> </span>
<a href="#l3.463"></a><span id="l3.463">   ; XXXrstrong - this should be set in shared.nsh along with &quot;Create Quick</span>
<a href="#l3.464"></a><span id="l3.464">   ; Launch Shortcut&quot; and Create Desktop Shortcut.</span>
<a href="#l3.465"></a><span id="l3.465">   StrCpy $0 &quot;Software\Mozilla\${BrandFullNameInternal}\${AppVersion} (${AB_CD})\Uninstall&quot;</span>
<a href="#l3.466"></a><span id="l3.466">   ${WriteRegDWORD2} $TmpVal &quot;$0&quot; &quot;Create Start Menu Shortcut&quot; $AddStartMenuSC 0</span>
<a href="#l3.467"></a><span id="l3.467"> </span>
<a href="#l3.468"></a><span id="l3.468">   ${FixClassKeys}</span>
<a href="#l3.469"></a><span id="l3.469"> </span>
<a href="#l3.470"></a><span id="l3.470" class="difflineplus">+  StrCpy $1 &quot;$\&quot;$8$\&quot; -requestPending -osint -url $\&quot;%1$\&quot;&quot;</span>
<a href="#l3.471"></a><span id="l3.471" class="difflineplus">+  StrCpy $2 &quot;$\&quot;%1$\&quot;,,0,0,,,,&quot; </span>
<a href="#l3.472"></a><span id="l3.472" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\${FileMainEXE}&quot; $8 </span>
<a href="#l3.473"></a><span id="l3.473" class="difflineplus">+</span>
<a href="#l3.474"></a><span id="l3.474" class="difflineplus">+  ${AddDDEHandlerValues} &quot;SeaMonkeyHTML&quot; &quot;$1&quot; \</span>
<a href="#l3.475"></a><span id="l3.475" class="difflineplus">+                         &quot;$INSTDIR\chrome\icons\default\html-file.ico&quot; \</span>
<a href="#l3.476"></a><span id="l3.476" class="difflineplus">+                         &quot;${AppRegName} Document&quot; &quot;&quot; &quot;${DDEApplication}&quot; &quot;$3&quot; \</span>
<a href="#l3.477"></a><span id="l3.477" class="difflineplus">+                         &quot;WWW_OpenURL&quot;</span>
<a href="#l3.478"></a><span id="l3.478" class="difflineplus">+  ${AddDDEHandlerValues} &quot;SeaMonkeyURL&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;${AppRegName} URL&quot; &quot;&quot; \</span>
<a href="#l3.479"></a><span id="l3.479" class="difflineplus">+                         &quot;${DDEApplication}&quot; &quot;$2&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l3.480"></a><span id="l3.480" class="difflineplus">+</span>
<a href="#l3.481"></a><span id="l3.481" class="difflineplus">+  ${FixShellIconHandler}</span>
<a href="#l3.482"></a><span id="l3.482" class="difflineplus">+</span>
<a href="#l3.483"></a><span id="l3.483">   ; The following keys should only be set if we can write to HKLM</span>
<a href="#l3.484"></a><span id="l3.484">   ${If} $TmpVal == &quot;HKLM&quot;</span>
<a href="#l3.485"></a><span id="l3.485">     ; Uninstall keys can only exist under HKLM on some versions of windows.</span>
<a href="#l3.486"></a><span id="l3.486">     ${SetUninstallKeys}</span>
<a href="#l3.487"></a><span id="l3.487"> </span>
<a href="#l3.488"></a><span id="l3.488">     ; Set the Start Menu Internet and Vista Registered App HKLM registry keys.</span>
<a href="#l3.489"></a><span id="l3.489">     ${SetStartMenuInternet}</span>
<a href="#l3.490"></a><span id="l3.490">     ${SetClientsMail}</span>
<a href="#l3.491"></a><span id="l3.491" class="difflineat">@@ -530,392 +472,237 @@ Section &quot;-Application&quot; Section1</span>
<a href="#l3.492"></a><span id="l3.492">   StrCpy $0 &quot;Software\Microsoft\MediaPlayer\ShimInclusionList\$R9&quot;</span>
<a href="#l3.493"></a><span id="l3.493">   ${CreateRegKey} &quot;$TmpVal&quot; &quot;$0&quot; 0</span>
<a href="#l3.494"></a><span id="l3.494"> </span>
<a href="#l3.495"></a><span id="l3.495">   !insertmacro MUI_STARTMENU_WRITE_BEGIN Application</span>
<a href="#l3.496"></a><span id="l3.496"> </span>
<a href="#l3.497"></a><span id="l3.497">   ; Create Start Menu shortcuts</span>
<a href="#l3.498"></a><span id="l3.498">   ${LogHeader} &quot;Adding Shortcuts&quot;</span>
<a href="#l3.499"></a><span id="l3.499">   ${If} $AddStartMenuSC == 1</span>
<a href="#l3.500"></a><span id="l3.500" class="difflineminus">-    CreateDirectory &quot;$SMPROGRAMS\$StartMenuDir&quot;</span>
<a href="#l3.501"></a><span id="l3.501" class="difflineplus">+    ${Unless} ${FileExists} &quot;$SMPROGRAMS\$StartMenuDir&quot;</span>
<a href="#l3.502"></a><span id="l3.502" class="difflineplus">+      CreateDirectory &quot;$SMPROGRAMS\$StartMenuDir&quot;</span>
<a href="#l3.503"></a><span id="l3.503" class="difflineplus">+      ${LogMsg} &quot;Added Start Menu Directory: $SMPROGRAMS\$StartMenuDir&quot;</span>
<a href="#l3.504"></a><span id="l3.504" class="difflineplus">+    ${EndUnless}</span>
<a href="#l3.505"></a><span id="l3.505">     CreateShortCut &quot;$SMPROGRAMS\$StartMenuDir\${BrandFullNameInternal}.lnk&quot; &quot;$INSTDIR\${FileMainEXE}&quot; &quot;&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l3.506"></a><span id="l3.506">     ${LogUninstall} &quot;File: $SMPROGRAMS\$StartMenuDir\${BrandFullNameInternal}.lnk&quot;</span>
<a href="#l3.507"></a><span id="l3.507" class="difflineplus">+    ${LogMsg} &quot;Added Shortcut: $SMPROGRAMS\$StartMenuDir\${BrandFullNameInternal}.lnk&quot;</span>
<a href="#l3.508"></a><span id="l3.508">     CreateShortCut &quot;$SMPROGRAMS\$StartMenuDir\${BrandFullNameInternal} ($(SAFE_MODE)).lnk&quot; &quot;$INSTDIR\${FileMainEXE}&quot; &quot;-safe-mode&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l3.509"></a><span id="l3.509">     ${LogUninstall} &quot;File: $SMPROGRAMS\$StartMenuDir\${BrandFullNameInternal} ($(SAFE_MODE)).lnk&quot;</span>
<a href="#l3.510"></a><span id="l3.510" class="difflineplus">+    ${LogMsg} &quot;Added Shortcut: $SMPROGRAMS\$StartMenuDir${BrandFullNameInternal} ($(SAFE_MODE)).lnk&quot;</span>
<a href="#l3.511"></a><span id="l3.511">     CreateShortCut &quot;$SMPROGRAMS\$StartMenuDir\${BrandFullNameInternal} $(MAILNEWS_TEXT).lnk&quot; &quot;$INSTDIR\${FileMainEXE}&quot; &quot;-mail&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l3.512"></a><span id="l3.512">     ${LogUninstall} &quot;File: $SMPROGRAMS\$StartMenuDir\${BrandFullNameInternal} $(MAILNEWS_TEXT).lnk&quot;</span>
<a href="#l3.513"></a><span id="l3.513" class="difflineplus">+    ${LogMsg} &quot;Added Shortcut: $SMPROGRAMS\$StartMenuDir\${BrandFullNameInternal} $(MAILNEWS_TEXT).lnk&quot;</span>
<a href="#l3.514"></a><span id="l3.514">     CreateShortCut &quot;$SMPROGRAMS\$StartMenuDir\$(PROFILE_TEXT).lnk&quot; &quot;$INSTDIR\${FileMainEXE}&quot; &quot;-profileManager&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l3.515"></a><span id="l3.515">     ${LogUninstall} &quot;File: $SMPROGRAMS\$StartMenuDir\$(PROFILE_TEXT).lnk&quot;</span>
<a href="#l3.516"></a><span id="l3.516" class="difflineplus">+    ${LogMsg} &quot;Added Shortcut: $SMPROGRAMS\$StartMenuDir\$(PROFILE_TEXT).lnk&quot;</span>
<a href="#l3.517"></a><span id="l3.517">   ${EndIf}</span>
<a href="#l3.518"></a><span id="l3.518"> </span>
<a href="#l3.519"></a><span id="l3.519">   ; perhaps use the uninstall keys</span>
<a href="#l3.520"></a><span id="l3.520">   ${If} $AddQuickLaunchSC == 1</span>
<a href="#l3.521"></a><span id="l3.521">     CreateShortCut &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot; &quot;$INSTDIR\${FileMainEXE}&quot; &quot;&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l3.522"></a><span id="l3.522">     ${LogUninstall} &quot;File: $QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l3.523"></a><span id="l3.523" class="difflineplus">+    ${LogMsg} &quot;Added Shortcut: $QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l3.524"></a><span id="l3.524">   ${EndIf}</span>
<a href="#l3.525"></a><span id="l3.525"> </span>
<a href="#l3.526"></a><span id="l3.526" class="difflineminus">-  ${LogHeader} &quot;Updating Quick Launch Shortcuts&quot;</span>
<a href="#l3.527"></a><span id="l3.527">   ${If} $AddDesktopSC == 1</span>
<a href="#l3.528"></a><span id="l3.528">     CreateShortCut &quot;$DESKTOP\${BrandFullName}.lnk&quot; &quot;$INSTDIR\${FileMainEXE}&quot; &quot;&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l3.529"></a><span id="l3.529">     ${LogUninstall} &quot;File: $DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l3.530"></a><span id="l3.530" class="difflineplus">+    ${LogMsg} &quot;Added Shortcut: $DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l3.531"></a><span id="l3.531">   ${EndIf}</span>
<a href="#l3.532"></a><span id="l3.532"> </span>
<a href="#l3.533"></a><span id="l3.533">   !insertmacro MUI_STARTMENU_WRITE_END</span>
<a href="#l3.534"></a><span id="l3.534" class="difflineminus">-</span>
<a href="#l3.535"></a><span id="l3.535" class="difflineminus">-  ; Refresh desktop icons</span>
<a href="#l3.536"></a><span id="l3.536" class="difflineminus">-  System::Call &quot;shell32::SHChangeNotify(i, i, i, i) v (0x08000000, 0, 0, 0)&quot;</span>
<a href="#l3.537"></a><span id="l3.537" class="difflineminus">-SectionEnd</span>
<a href="#l3.538"></a><span id="l3.538" class="difflineminus">-</span>
<a href="#l3.539"></a><span id="l3.539" class="difflineminus">-Section /o &quot;IRC Client&quot; Section2</span>
<a href="#l3.540"></a><span id="l3.540" class="difflineminus">-  Call installChatZilla</span>
<a href="#l3.541"></a><span id="l3.541" class="difflineminus">-SectionEnd</span>
<a href="#l3.542"></a><span id="l3.542" class="difflineminus">-</span>
<a href="#l3.543"></a><span id="l3.543" class="difflineminus">-Section /o &quot;Developer Tools&quot; Section3</span>
<a href="#l3.544"></a><span id="l3.544" class="difflineminus">-  Call installInspector</span>
<a href="#l3.545"></a><span id="l3.545" class="difflineminus">-SectionEnd</span>
<a href="#l3.546"></a><span id="l3.546" class="difflineminus">-</span>
<a href="#l3.547"></a><span id="l3.547" class="difflineminus">-Section /o &quot;Debug and QA Tools&quot; Section4</span>
<a href="#l3.548"></a><span id="l3.548" class="difflineminus">-  Call installDebugQA</span>
<a href="#l3.549"></a><span id="l3.549"> SectionEnd</span>
<a href="#l3.550"></a><span id="l3.550"> </span>
<a href="#l3.551"></a><span id="l3.551" class="difflineminus">-Section /o &quot;Palm Address Book Synchronization Tool&quot; Section5</span>
<a href="#l3.552"></a><span id="l3.552" class="difflineminus">-  Call installPalmSync</span>
<a href="#l3.553"></a><span id="l3.553" class="difflineminus">-SectionEnd</span>
<a href="#l3.554"></a><span id="l3.554" class="difflineminus">-</span>
<a href="#l3.555"></a><span id="l3.555" class="difflineminus">-Section /o &quot;JavaScript Debugger&quot; Section6</span>
<a href="#l3.556"></a><span id="l3.556" class="difflineminus">-  Call installVenkman</span>
<a href="#l3.557"></a><span id="l3.557" class="difflineminus">-SectionEnd</span>
<a href="#l3.558"></a><span id="l3.558" class="difflineminus">-</span>
<a href="#l3.559"></a><span id="l3.559" class="difflineminus">-################################################################################</span>
<a href="#l3.560"></a><span id="l3.560" class="difflineminus">-# Helper Functions</span>
<a href="#l3.561"></a><span id="l3.561" class="difflineminus">-</span>
<a href="#l3.562"></a><span id="l3.562" class="difflineminus">-Function installChatZilla</span>
<a href="#l3.563"></a><span id="l3.563" class="difflineplus">+Section /o &quot;IRC Client&quot; CZ_IDX </span>
<a href="#l3.564"></a><span id="l3.564">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot;</span>
<a href="#l3.565"></a><span id="l3.565" class="difflineminus">-    SetDetailsPrint textonly</span>
<a href="#l3.566"></a><span id="l3.566" class="difflineplus">+    SetDetailsPrint both </span>
<a href="#l3.567"></a><span id="l3.567">     DetailPrint $(STATUS_INSTALL_OPTIONAL)</span>
<a href="#l3.568"></a><span id="l3.568">     SetDetailsPrint none</span>
<a href="#l3.569"></a><span id="l3.569" class="difflineplus">+</span>
<a href="#l3.570"></a><span id="l3.570">     ${RemoveDir} &quot;$INSTDIR\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot;</span>
<a href="#l3.571"></a><span id="l3.571">     ${RemoveDir} &quot;$INSTDIR\extensions\langpack-${AB_CD}@chatzilla.mozilla.org&quot;</span>
<a href="#l3.572"></a><span id="l3.572">     ClearErrors</span>
<a href="#l3.573"></a><span id="l3.573">     ${LogHeader} &quot;Installing IRC Client&quot;</span>
<a href="#l3.574"></a><span id="l3.574" class="difflineminus">-    StrCpy $R0 &quot;$EXEDIR\optional\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot;</span>
<a href="#l3.575"></a><span id="l3.575" class="difflineminus">-    StrCpy $R1 &quot;$INSTDIR\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot;</span>
<a href="#l3.576"></a><span id="l3.576" class="difflineminus">-    Call DoCopyFiles</span>
<a href="#l3.577"></a><span id="l3.577" class="difflineplus">+    ${CopyFilesFromDir} &quot;$EXEDIR\optional\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot; \</span>
<a href="#l3.578"></a><span id="l3.578" class="difflineplus">+                        &quot;$INSTDIR\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot; \</span>
<a href="#l3.579"></a><span id="l3.579" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_PREFIX)&quot; \</span>
<a href="#l3.580"></a><span id="l3.580" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_SUFFIX)&quot;</span>
<a href="#l3.581"></a><span id="l3.581">     ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@chatzilla.mozilla.org&quot;</span>
<a href="#l3.582"></a><span id="l3.582" class="difflineminus">-      StrCpy $R0 &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@chatzilla.mozilla.org&quot;</span>
<a href="#l3.583"></a><span id="l3.583" class="difflineminus">-      StrCpy $R1 &quot;$INSTDIR\extensions\langpack-${AB_CD}@chatzilla.mozilla.org&quot;</span>
<a href="#l3.584"></a><span id="l3.584" class="difflineminus">-      Call DoCopyFiles</span>
<a href="#l3.585"></a><span id="l3.585" class="difflineplus">+      ${CopyFilesFromDir} &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@chatzilla.mozilla.org&quot; \</span>
<a href="#l3.586"></a><span id="l3.586" class="difflineplus">+                          &quot;$INSTDIR\extensions\langpack-${AB_CD}@chatzilla.mozilla.org&quot; \</span>
<a href="#l3.587"></a><span id="l3.587" class="difflineplus">+                          &quot;$(ERROR_CREATE_DIRECTORY_PREFIX)&quot; \</span>
<a href="#l3.588"></a><span id="l3.588" class="difflineplus">+                          &quot;$(ERROR_CREATE_DIRECTORY_SUFFIX)&quot;</span>
<a href="#l3.589"></a><span id="l3.589">     ${EndIf}</span>
<a href="#l3.590"></a><span id="l3.590">   ${EndIf}</span>
<a href="#l3.591"></a><span id="l3.591" class="difflineminus">-FunctionEnd</span>
<a href="#l3.592"></a><span id="l3.592" class="difflineplus">+SectionEnd</span>
<a href="#l3.593"></a><span id="l3.593"> </span>
<a href="#l3.594"></a><span id="l3.594" class="difflineminus">-Function installInspector</span>
<a href="#l3.595"></a><span id="l3.595" class="difflineplus">+Section /o &quot;Developer Tools&quot; DOMI_IDX </span>
<a href="#l3.596"></a><span id="l3.596">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\inspector@mozilla.org&quot;</span>
<a href="#l3.597"></a><span id="l3.597" class="difflineminus">-    SetDetailsPrint textonly</span>
<a href="#l3.598"></a><span id="l3.598" class="difflineplus">+    SetDetailsPrint both </span>
<a href="#l3.599"></a><span id="l3.599">     DetailPrint $(STATUS_INSTALL_OPTIONAL)</span>
<a href="#l3.600"></a><span id="l3.600">     SetDetailsPrint none</span>
<a href="#l3.601"></a><span id="l3.601" class="difflineplus">+</span>
<a href="#l3.602"></a><span id="l3.602">     ${RemoveDir} &quot;$INSTDIR\extensions\inspector@mozilla.org&quot;</span>
<a href="#l3.603"></a><span id="l3.603">     ClearErrors</span>
<a href="#l3.604"></a><span id="l3.604">     ${LogHeader} &quot;Installing Developer Tools&quot;</span>
<a href="#l3.605"></a><span id="l3.605" class="difflineminus">-    StrCpy $R0 &quot;$EXEDIR\optional\extensions\inspector@mozilla.org&quot;</span>
<a href="#l3.606"></a><span id="l3.606" class="difflineminus">-    StrCpy $R1 &quot;$INSTDIR\extensions\inspector@mozilla.org&quot;</span>
<a href="#l3.607"></a><span id="l3.607" class="difflineminus">-    Call DoCopyFiles</span>
<a href="#l3.608"></a><span id="l3.608" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.609"></a><span id="l3.609" class="difflineminus">-FunctionEnd</span>
<a href="#l3.610"></a><span id="l3.610" class="difflineplus">+    ${CopyFilesFromDir} &quot;$EXEDIR\optional\extensions\inspector@mozilla.org&quot; \</span>
<a href="#l3.611"></a><span id="l3.611" class="difflineplus">+                        &quot;$INSTDIR\extensions\inspector@mozilla.org&quot; \</span>
<a href="#l3.612"></a><span id="l3.612" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_PREFIX)&quot; \</span>
<a href="#l3.613"></a><span id="l3.613" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_SUFFIX)&quot;</span>
<a href="#l3.614"></a><span id="l3.614" class="difflineplus">+  ${EndIf} </span>
<a href="#l3.615"></a><span id="l3.615" class="difflineplus">+SectionEnd</span>
<a href="#l3.616"></a><span id="l3.616"> </span>
<a href="#l3.617"></a><span id="l3.617" class="difflineminus">-Function installDebugQA</span>
<a href="#l3.618"></a><span id="l3.618" class="difflineplus">+Section /o &quot;Debug and QA Tools&quot; DEBUG_IDX </span>
<a href="#l3.619"></a><span id="l3.619">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\debugQA@mozilla.org&quot;</span>
<a href="#l3.620"></a><span id="l3.620" class="difflineminus">-    SetDetailsPrint textonly</span>
<a href="#l3.621"></a><span id="l3.621" class="difflineplus">+    SetDetailsPrint both </span>
<a href="#l3.622"></a><span id="l3.622">     DetailPrint $(STATUS_INSTALL_OPTIONAL)</span>
<a href="#l3.623"></a><span id="l3.623">     SetDetailsPrint none</span>
<a href="#l3.624"></a><span id="l3.624" class="difflineplus">+</span>
<a href="#l3.625"></a><span id="l3.625">     ${RemoveDir} &quot;$INSTDIR\extensions\debugQA@mozilla.org&quot;</span>
<a href="#l3.626"></a><span id="l3.626">     ClearErrors</span>
<a href="#l3.627"></a><span id="l3.627">     ${LogHeader} &quot;Installing Debug and QA Tools&quot;</span>
<a href="#l3.628"></a><span id="l3.628" class="difflineminus">-    StrCpy $R0 &quot;$EXEDIR\optional\extensions\debugQA@mozilla.org&quot;</span>
<a href="#l3.629"></a><span id="l3.629" class="difflineminus">-    StrCpy $R1 &quot;$INSTDIR\extensions\debugQA@mozilla.org&quot;</span>
<a href="#l3.630"></a><span id="l3.630" class="difflineminus">-    Call DoCopyFiles</span>
<a href="#l3.631"></a><span id="l3.631" class="difflineplus">+    ${CopyFilesFromDir} &quot;$EXEDIR\optional\extensions\debugQA@mozilla.org&quot; \</span>
<a href="#l3.632"></a><span id="l3.632" class="difflineplus">+                        &quot;$INSTDIR\extensions\debugQA@mozilla.org&quot; \</span>
<a href="#l3.633"></a><span id="l3.633" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_PREFIX)&quot; \</span>
<a href="#l3.634"></a><span id="l3.634" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_SUFFIX)&quot;</span>
<a href="#l3.635"></a><span id="l3.635">   ${EndIf}</span>
<a href="#l3.636"></a><span id="l3.636" class="difflineminus">-FunctionEnd</span>
<a href="#l3.637"></a><span id="l3.637" class="difflineplus">+SectionEnd</span>
<a href="#l3.638"></a><span id="l3.638"> </span>
<a href="#l3.639"></a><span id="l3.639" class="difflineminus">-Function installPalmSync</span>
<a href="#l3.640"></a><span id="l3.640" class="difflineplus">+Section /o &quot;Palm Address Book Synchronization Tool&quot; PALM_IDX </span>
<a href="#l3.641"></a><span id="l3.641">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\p@m&quot;</span>
<a href="#l3.642"></a><span id="l3.642" class="difflineminus">-    SetDetailsPrint textonly</span>
<a href="#l3.643"></a><span id="l3.643" class="difflineplus">+    SetDetailsPrint both</span>
<a href="#l3.644"></a><span id="l3.644">     DetailPrint $(STATUS_INSTALL_OPTIONAL)</span>
<a href="#l3.645"></a><span id="l3.645">     SetDetailsPrint none</span>
<a href="#l3.646"></a><span id="l3.646" class="difflineplus">+</span>
<a href="#l3.647"></a><span id="l3.647">     ${RemoveDir} &quot;$INSTDIR\extensions\p@m&quot;</span>
<a href="#l3.648"></a><span id="l3.648">     ClearErrors</span>
<a href="#l3.649"></a><span id="l3.649">     ${LogHeader} &quot;Installing Palm Address Book Synchronization Tool&quot;</span>
<a href="#l3.650"></a><span id="l3.650" class="difflineminus">-    StrCpy $R0 &quot;$EXEDIR\optional\extensions\p@m&quot;</span>
<a href="#l3.651"></a><span id="l3.651" class="difflineminus">-    StrCpy $R1 &quot;$INSTDIR\extensions\p@m&quot;</span>
<a href="#l3.652"></a><span id="l3.652" class="difflineminus">-    Call DoCopyFiles</span>
<a href="#l3.653"></a><span id="l3.653" class="difflineplus">+    ${CopyFilesFromDir} &quot;$EXEDIR\optional\extensions\p@m&quot; \</span>
<a href="#l3.654"></a><span id="l3.654" class="difflineplus">+                        &quot;$INSTDIR\extensions\p@m&quot; \</span>
<a href="#l3.655"></a><span id="l3.655" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_PREFIX)&quot; \</span>
<a href="#l3.656"></a><span id="l3.656" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_SUFFIX)&quot;</span>
<a href="#l3.657"></a><span id="l3.657">   ${EndIf}</span>
<a href="#l3.658"></a><span id="l3.658" class="difflineminus">-FunctionEnd</span>
<a href="#l3.659"></a><span id="l3.659" class="difflineplus">+SectionEnd</span>
<a href="#l3.660"></a><span id="l3.660"> </span>
<a href="#l3.661"></a><span id="l3.661" class="difflineminus">-Function installVenkman</span>
<a href="#l3.662"></a><span id="l3.662" class="difflineplus">+Section /o &quot;JavaScript Debugger&quot; VENKMAN_IDX </span>
<a href="#l3.663"></a><span id="l3.663">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\{f13b157f-b174-47e7-a34d-4815ddfdfeb8}&quot;</span>
<a href="#l3.664"></a><span id="l3.664" class="difflineminus">-    SetDetailsPrint textonly</span>
<a href="#l3.665"></a><span id="l3.665" class="difflineplus">+    SetDetailsPrint both </span>
<a href="#l3.666"></a><span id="l3.666">     DetailPrint $(STATUS_INSTALL_OPTIONAL)</span>
<a href="#l3.667"></a><span id="l3.667">     SetDetailsPrint none</span>
<a href="#l3.668"></a><span id="l3.668" class="difflineplus">+</span>
<a href="#l3.669"></a><span id="l3.669">     ${RemoveDir} &quot;$INSTDIR\extensions\{f13b157f-b174-47e7-a34d-4815ddfdfeb8}&quot;</span>
<a href="#l3.670"></a><span id="l3.670">     ${RemoveDir} &quot;$INSTDIR\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot;</span>
<a href="#l3.671"></a><span id="l3.671">     ClearErrors</span>
<a href="#l3.672"></a><span id="l3.672">     ${LogHeader} &quot;Installing JavaScript Debugger&quot;</span>
<a href="#l3.673"></a><span id="l3.673" class="difflineminus">-    StrCpy $R0 &quot;$EXEDIR\optional\extensions\{f13b157f-b174-47e7-a34d-4815ddfdfeb8}&quot;</span>
<a href="#l3.674"></a><span id="l3.674" class="difflineminus">-    StrCpy $R1 &quot;$INSTDIR\extensions\{f13b157f-b174-47e7-a34d-4815ddfdfeb8}&quot;</span>
<a href="#l3.675"></a><span id="l3.675" class="difflineminus">-    Call DoCopyFiles</span>
<a href="#l3.676"></a><span id="l3.676" class="difflineplus">+    ${CopyFilesFromDir} &quot;$EXEDIR\optional\extensions\{f13b157f-b174-47e7-a34d-4815ddfdfeb8}&quot; \</span>
<a href="#l3.677"></a><span id="l3.677" class="difflineplus">+                        &quot;$INSTDIR\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot; \</span>
<a href="#l3.678"></a><span id="l3.678" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_PREFIX)&quot; \</span>
<a href="#l3.679"></a><span id="l3.679" class="difflineplus">+                        &quot;$(ERROR_CREATE_DIRECTORY_SUFFIX)&quot;</span>
<a href="#l3.680"></a><span id="l3.680">     ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot;</span>
<a href="#l3.681"></a><span id="l3.681" class="difflineminus">-      StrCpy $R0 &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot;</span>
<a href="#l3.682"></a><span id="l3.682" class="difflineminus">-      StrCpy $R1 &quot;$INSTDIR\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot;</span>
<a href="#l3.683"></a><span id="l3.683" class="difflineminus">-      Call DoCopyFiles</span>
<a href="#l3.684"></a><span id="l3.684" class="difflineplus">+      ${CopyFilesFromDir} &quot;$EXEDIR\optional\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot; \</span>
<a href="#l3.685"></a><span id="l3.685" class="difflineplus">+                          &quot;$INSTDIR\extensions\langpack-${AB_CD}@venkman.mozilla.org&quot; \</span>
<a href="#l3.686"></a><span id="l3.686" class="difflineplus">+                          &quot;$(ERROR_CREATE_DIRECTORY_PREFIX)&quot; \</span>
<a href="#l3.687"></a><span id="l3.687" class="difflineplus">+                          &quot;$(ERROR_CREATE_DIRECTORY_SUFFIX)&quot;</span>
<a href="#l3.688"></a><span id="l3.688">     ${EndIf}</span>
<a href="#l3.689"></a><span id="l3.689">   ${EndIf}</span>
<a href="#l3.690"></a><span id="l3.690" class="difflineminus">-FunctionEnd</span>
<a href="#l3.691"></a><span id="l3.691" class="difflineplus">+SectionEnd</span>
<a href="#l3.692"></a><span id="l3.692" class="difflineplus">+</span>
<a href="#l3.693"></a><span id="l3.693" class="difflineplus">+; Cleanup operations to perform at the end of the installation.</span>
<a href="#l3.694"></a><span id="l3.694" class="difflineplus">+Section &quot;-InstallEndCleanup&quot;</span>
<a href="#l3.695"></a><span id="l3.695" class="difflineplus">+  SetDetailsPrint both</span>
<a href="#l3.696"></a><span id="l3.696" class="difflineplus">+  DetailPrint &quot;$(STATUS_CLEANUP)&quot;</span>
<a href="#l3.697"></a><span id="l3.697" class="difflineplus">+  SetDetailsPrint none</span>
<a href="#l3.698"></a><span id="l3.698" class="difflineplus">+</span>
<a href="#l3.699"></a><span id="l3.699" class="difflineplus">+  ${LogHeader} &quot;Updating Uninstall Log With Previous Uninstall Log&quot;</span>
<a href="#l3.700"></a><span id="l3.700" class="difflineplus">+  ${InstallEndCleanupCommon}</span>
<a href="#l3.701"></a><span id="l3.701" class="difflineplus">+</span>
<a href="#l3.702"></a><span id="l3.702" class="difflineplus">+  ; Refresh desktop icons</span>
<a href="#l3.703"></a><span id="l3.703" class="difflineplus">+  System::Call &quot;shell32::SHChangeNotify(i, i, i, i) v (0x08000000, 0, 0, 0)&quot;</span>
<a href="#l3.704"></a><span id="l3.704" class="difflineplus">+</span>
<a href="#l3.705"></a><span id="l3.705" class="difflineplus">+  ; If we have to reboot give SHChangeNotify time to finish the refreshing</span>
<a href="#l3.706"></a><span id="l3.706" class="difflineplus">+  ; the icons so the OS doesn't display the icons from helper.exe</span>
<a href="#l3.707"></a><span id="l3.707" class="difflineplus">+  ${If} ${RebootFlag}</span>
<a href="#l3.708"></a><span id="l3.708" class="difflineplus">+    Sleep 10000</span>
<a href="#l3.709"></a><span id="l3.709" class="difflineplus">+    ${LogHeader} &quot;Reboot Required To Finish Installation&quot;</span>
<a href="#l3.710"></a><span id="l3.710" class="difflineplus">+    ; ${FileMainEXE}.moz-upgrade should never exist but just in case...</span>
<a href="#l3.711"></a><span id="l3.711" class="difflineplus">+    ${Unless} ${FileExists} &quot;$INSTDIR\${FileMainEXE}.moz-upgrade&quot;</span>
<a href="#l3.712"></a><span id="l3.712" class="difflineplus">+      Rename &quot;$INSTDIR\${FileMainEXE}&quot; &quot;$INSTDIR\${FileMainEXE}.moz-upgrade&quot;</span>
<a href="#l3.713"></a><span id="l3.713" class="difflineplus">+    ${EndUnless}</span>
<a href="#l3.714"></a><span id="l3.714"> </span>
<a href="#l3.715"></a><span id="l3.715" class="difflineminus">-; Copies a file to a temporary backup directory and then checks if it is in use</span>
<a href="#l3.716"></a><span id="l3.716" class="difflineminus">-; by attempting to delete the file. If the file is in use an error is displayed</span>
<a href="#l3.717"></a><span id="l3.717" class="difflineminus">-; and the user is given the options to either retry or cancel. If cancel is</span>
<a href="#l3.718"></a><span id="l3.718" class="difflineminus">-; selected then the files are restored.</span>
<a href="#l3.719"></a><span id="l3.719" class="difflineminus">-Function CheckInUse</span>
<a href="#l3.720"></a><span id="l3.720" class="difflineminus">-  ${If} ${FileExists} &quot;$INSTDIR\$R1&quot;</span>
<a href="#l3.721"></a><span id="l3.721" class="difflineminus">-    retry:</span>
<a href="#l3.722"></a><span id="l3.722" class="difflineminus">-    ClearErrors</span>
<a href="#l3.723"></a><span id="l3.723" class="difflineminus">-    CopyFiles /SILENT &quot;$INSTDIR\$R1&quot; &quot;$TmpVal\$R1&quot;</span>
<a href="#l3.724"></a><span id="l3.724" class="difflineminus">-    ${Unless} ${Errors}</span>
<a href="#l3.725"></a><span id="l3.725" class="difflineminus">-      Delete &quot;$INSTDIR\$R1&quot;</span>
<a href="#l3.726"></a><span id="l3.726" class="difflineplus">+    ${If} ${FileExists} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.727"></a><span id="l3.727" class="difflineplus">+      ClearErrors</span>
<a href="#l3.728"></a><span id="l3.728" class="difflineplus">+      Rename &quot;$INSTDIR\${FileMainEXE}&quot; &quot;$INSTDIR\${FileMainEXE}.moz-delete&quot;</span>
<a href="#l3.729"></a><span id="l3.729" class="difflineplus">+      ${Unless} ${Errors}</span>
<a href="#l3.730"></a><span id="l3.730" class="difflineplus">+        Delete /REBOOTOK &quot;$INSTDIR\${FileMainEXE}.moz-delete&quot;</span>
<a href="#l3.731"></a><span id="l3.731" class="difflineplus">+      ${EndUnless}</span>
<a href="#l3.732"></a><span id="l3.732" class="difflineplus">+    ${EndUnless}</span>
<a href="#l3.733"></a><span id="l3.733" class="difflineplus">+    ${Unless} ${FileExists} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.734"></a><span id="l3.734" class="difflineplus">+      CopyFiles /SILENT &quot;$INSTDIR\uninstall\helper.exe&quot; &quot;$INSTDIR&quot;</span>
<a href="#l3.735"></a><span id="l3.735" class="difflineplus">+      FileOpen $0 &quot;$INSTDIR\${FileMainEXE}&quot; w</span>
<a href="#l3.736"></a><span id="l3.736" class="difflineplus">+      FileWrite $0 &quot;Will be deleted on restart&quot;</span>
<a href="#l3.737"></a><span id="l3.737" class="difflineplus">+      Rename /REBOOTOK &quot;$INSTDIR\${FileMainEXE}.moz-upgrade&quot; &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.738"></a><span id="l3.738" class="difflineplus">+      FileClose $0</span>
<a href="#l3.739"></a><span id="l3.739" class="difflineplus">+      Delete &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.740"></a><span id="l3.740" class="difflineplus">+      Rename &quot;$INSTDIR\helper.exe&quot; &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.741"></a><span id="l3.741">     ${EndUnless}</span>
<a href="#l3.742"></a><span id="l3.742" class="difflineminus">-    ${If} ${Errors}</span>
<a href="#l3.743"></a><span id="l3.743" class="difflineminus">-      StrCpy $0 &quot;$INSTDIR\$R1&quot;</span>
<a href="#l3.744"></a><span id="l3.744" class="difflineminus">-      ${WordReplace} &quot;$(^FileError_NoIgnore)&quot; &quot;\r\n&quot; &quot;$\r$\n&quot; &quot;+*&quot; $0</span>
<a href="#l3.745"></a><span id="l3.745" class="difflineminus">-      MessageBox MB_RETRYCANCEL|MB_ICONQUESTION &quot;$0&quot; IDRETRY retry</span>
<a href="#l3.746"></a><span id="l3.746" class="difflineminus">-      Delete &quot;$TmpVal\$R1&quot;</span>
<a href="#l3.747"></a><span id="l3.747" class="difflineminus">-      CopyFiles /SILENT &quot;$TmpVal\*&quot; &quot;$INSTDIR\&quot;</span>
<a href="#l3.748"></a><span id="l3.748" class="difflineminus">-      SetOutPath $INSTDIR</span>
<a href="#l3.749"></a><span id="l3.749" class="difflineminus">-      RmDir /r &quot;$TmpVal&quot;</span>
<a href="#l3.750"></a><span id="l3.750" class="difflineminus">-      Quit</span>
<a href="#l3.751"></a><span id="l3.751" class="difflineplus">+  ${EndIf}</span>
<a href="#l3.752"></a><span id="l3.752" class="difflineplus">+SectionEnd    </span>
<a href="#l3.753"></a><span id="l3.753" class="difflineplus">+    </span>
<a href="#l3.754"></a><span id="l3.754" class="difflineplus">+Function CheckExistingInstall</span>
<a href="#l3.755"></a><span id="l3.755" class="difflineplus">+  ; If there is a pending file copy from a previous uninstall don't allow</span>
<a href="#l3.756"></a><span id="l3.756" class="difflineplus">+  ; installing until after the system has rebooted.</span>
<a href="#l3.757"></a><span id="l3.757" class="difflineplus">+  IfFileExists &quot;$INSTDIR\${FileMainEXE}.moz-upgrade&quot; +1 +4</span>
<a href="#l3.758"></a><span id="l3.758" class="difflineplus">+  MessageBox MB_YESNO &quot;$(WARN_RESTART_REQUIRED_UPGRADE)&quot; IDNO +2</span>
<a href="#l3.759"></a><span id="l3.759" class="difflineplus">+  Reboot</span>
<a href="#l3.760"></a><span id="l3.760" class="difflineplus">+  Quit</span>
<a href="#l3.761"></a><span id="l3.761" class="difflineplus">+</span>
<a href="#l3.762"></a><span id="l3.762" class="difflineplus">+  ; If there is a pending file deletion from a previous uninstall don't allow</span>
<a href="#l3.763"></a><span id="l3.763" class="difflineplus">+  ; installing until after the system has rebooted.</span>
<a href="#l3.764"></a><span id="l3.764" class="difflineplus">+  IfFileExists &quot;$INSTDIR\${FileMainEXE}.moz-delete&quot; +1 +4</span>
<a href="#l3.765"></a><span id="l3.765" class="difflineplus">+  MessageBox MB_YESNO &quot;$(WARN_RESTART_REQUIRED_UNINSTALL)&quot; IDNO +2</span>
<a href="#l3.766"></a><span id="l3.766" class="difflineplus">+  Reboot</span>
<a href="#l3.767"></a><span id="l3.767" class="difflineplus">+  Quit</span>
<a href="#l3.768"></a><span id="l3.768" class="difflineplus">+</span>
<a href="#l3.769"></a><span id="l3.769" class="difflineplus">+  ${If} ${FileExists} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.770"></a><span id="l3.770" class="difflineplus">+    Banner::show /NOUNLOAD &quot;$(BANNER_CHECK_EXISTING)&quot;</span>
<a href="#l3.771"></a><span id="l3.771" class="difflineplus">+    ${If} &quot;$TmpVal&quot; == &quot;FoundMessageWindow&quot;</span>
<a href="#l3.772"></a><span id="l3.772" class="difflineplus">+      Sleep 5000</span>
<a href="#l3.773"></a><span id="l3.773" class="difflineplus">+    ${EndIf}</span>
<a href="#l3.774"></a><span id="l3.774" class="difflineplus">+    ${PushFilesToCheck}</span>
<a href="#l3.775"></a><span id="l3.775" class="difflineplus">+    ; Store the return value in $TmpVal so it is less likely to be accidentally</span>
<a href="#l3.776"></a><span id="l3.776" class="difflineplus">+    ; overwritten elsewhere.</span>
<a href="#l3.777"></a><span id="l3.777" class="difflineplus">+    ${CheckForFilesInUse} $TmpVal</span>
<a href="#l3.778"></a><span id="l3.778" class="difflineplus">+</span>
<a href="#l3.779"></a><span id="l3.779" class="difflineplus">+    Banner::destroy</span>
<a href="#l3.780"></a><span id="l3.780" class="difflineplus">+</span>
<a href="#l3.781"></a><span id="l3.781" class="difflineplus">+    ${If} &quot;$TmpVal&quot; == &quot;true&quot;</span>
<a href="#l3.782"></a><span id="l3.782" class="difflineplus">+      StrCpy $TmpVal &quot;FoundMessageWindow&quot;</span>
<a href="#l3.783"></a><span id="l3.783" class="difflineplus">+      ${ManualCloseAppPrompt} &quot;${WindowClass}&quot; &quot;$(WARN_MANUALLY_CLOSE_APP_INSTALL)&quot;</span>
<a href="#l3.784"></a><span id="l3.784" class="difflineplus">+      StrCpy $TmpVal &quot;true&quot;</span>
<a href="#l3.785"></a><span id="l3.785">     ${EndIf}</span>
<a href="#l3.786"></a><span id="l3.786">   ${EndIf}</span>
<a href="#l3.787"></a><span id="l3.787"> FunctionEnd</span>
<a href="#l3.788"></a><span id="l3.788"> </span>
<a href="#l3.789"></a><span id="l3.789" class="difflineminus">-; Adds a section divider to the human readable log.</span>
<a href="#l3.790"></a><span id="l3.790" class="difflineminus">-Function WriteLogSeparator</span>
<a href="#l3.791"></a><span id="l3.791" class="difflineminus">-  FileWrite $fhInstallLog &quot;$\r$\n-------------------------------------------------------------------------------$\r$\n&quot;</span>
<a href="#l3.792"></a><span id="l3.792" class="difflineminus">-FunctionEnd</span>
<a href="#l3.793"></a><span id="l3.793" class="difflineminus">-</span>
<a href="#l3.794"></a><span id="l3.794" class="difflineminus">-; Check whether to display the current page (e.g. if we aren't performing a</span>
<a href="#l3.795"></a><span id="l3.795" class="difflineminus">-; custom install don't display the custom pages).</span>
<a href="#l3.796"></a><span id="l3.796" class="difflineminus">-Function CheckCustom</span>
<a href="#l3.797"></a><span id="l3.797" class="difflineminus">-  ${If} $InstallType != 4</span>
<a href="#l3.798"></a><span id="l3.798" class="difflineminus">-    Abort</span>
<a href="#l3.799"></a><span id="l3.799" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.800"></a><span id="l3.800" class="difflineminus">-FunctionEnd</span>
<a href="#l3.801"></a><span id="l3.801" class="difflineminus">-</span>
<a href="#l3.802"></a><span id="l3.802" class="difflineminus">-Function onInstallDeleteFile</span>
<a href="#l3.803"></a><span id="l3.803" class="difflineminus">-  ${TrimNewLines} &quot;$R9&quot; &quot;$R9&quot;</span>
<a href="#l3.804"></a><span id="l3.804" class="difflineminus">-  StrCpy $R1 &quot;$R9&quot; 5</span>
<a href="#l3.805"></a><span id="l3.805" class="difflineminus">-  ${If} $R1 == &quot;File:&quot;</span>
<a href="#l3.806"></a><span id="l3.806" class="difflineminus">-    StrCpy $R9 &quot;$R9&quot; &quot;&quot; 6</span>
<a href="#l3.807"></a><span id="l3.807" class="difflineminus">-    ${If} ${FileExists} &quot;$INSTDIR$R9&quot;</span>
<a href="#l3.808"></a><span id="l3.808" class="difflineminus">-      ClearErrors</span>
<a href="#l3.809"></a><span id="l3.809" class="difflineminus">-      Delete &quot;$INSTDIR$R9&quot;</span>
<a href="#l3.810"></a><span id="l3.810" class="difflineminus">-      ${If} ${Errors}</span>
<a href="#l3.811"></a><span id="l3.811" class="difflineminus">-        ${LogMsg} &quot;** ERROR Deleting File: $INSTDIR$R9 **&quot;</span>
<a href="#l3.812"></a><span id="l3.812" class="difflineminus">-      ${Else}</span>
<a href="#l3.813"></a><span id="l3.813" class="difflineminus">-        ${LogMsg} &quot;Deleted File: $INSTDIR$R9&quot;</span>
<a href="#l3.814"></a><span id="l3.814" class="difflineminus">-      ${EndIf}</span>
<a href="#l3.815"></a><span id="l3.815" class="difflineminus">-    ${EndIf}</span>
<a href="#l3.816"></a><span id="l3.816" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.817"></a><span id="l3.817" class="difflineminus">-  ClearErrors</span>
<a href="#l3.818"></a><span id="l3.818" class="difflineminus">-  Push 0</span>
<a href="#l3.819"></a><span id="l3.819" class="difflineminus">-FunctionEnd</span>
<a href="#l3.820"></a><span id="l3.820" class="difflineminus">-</span>
<a href="#l3.821"></a><span id="l3.821" class="difflineminus">-; The previous installer removed directories even when they aren't empty so this</span>
<a href="#l3.822"></a><span id="l3.822" class="difflineminus">-; function does as well.</span>
<a href="#l3.823"></a><span id="l3.823" class="difflineminus">-Function onInstallRemoveDir</span>
<a href="#l3.824"></a><span id="l3.824" class="difflineminus">-  ${TrimNewLines} &quot;$R9&quot; &quot;$R9&quot;</span>
<a href="#l3.825"></a><span id="l3.825" class="difflineminus">-  StrCpy $R1 &quot;$R9&quot; 4</span>
<a href="#l3.826"></a><span id="l3.826" class="difflineminus">-  ${If} $R1 == &quot;Dir:&quot;</span>
<a href="#l3.827"></a><span id="l3.827" class="difflineminus">-    StrCpy $R9 &quot;$R9&quot; &quot;&quot; 5</span>
<a href="#l3.828"></a><span id="l3.828" class="difflineminus">-    StrCpy $R1 &quot;$R9&quot; &quot;&quot; -1</span>
<a href="#l3.829"></a><span id="l3.829" class="difflineminus">-    ${If} $R1 == &quot;\&quot;</span>
<a href="#l3.830"></a><span id="l3.830" class="difflineminus">-      StrCpy $R9 &quot;$R9&quot; -1</span>
<a href="#l3.831"></a><span id="l3.831" class="difflineminus">-    ${EndIf}</span>
<a href="#l3.832"></a><span id="l3.832" class="difflineminus">-    ${If} ${FileExists} &quot;$INSTDIR$R9&quot;</span>
<a href="#l3.833"></a><span id="l3.833" class="difflineminus">-      ClearErrors</span>
<a href="#l3.834"></a><span id="l3.834" class="difflineminus">-      RmDir /r &quot;$INSTDIR$R9&quot;</span>
<a href="#l3.835"></a><span id="l3.835" class="difflineminus">-      ${If} ${Errors}</span>
<a href="#l3.836"></a><span id="l3.836" class="difflineminus">-        ${LogMsg} &quot;** ERROR Removing Directory: $INSTDIR$R9 **&quot;</span>
<a href="#l3.837"></a><span id="l3.837" class="difflineminus">-      ${Else}</span>
<a href="#l3.838"></a><span id="l3.838" class="difflineminus">-        ${LogMsg} &quot;Removed Directory: $INSTDIR$R9&quot;</span>
<a href="#l3.839"></a><span id="l3.839" class="difflineminus">-      ${EndIf}</span>
<a href="#l3.840"></a><span id="l3.840" class="difflineminus">-    ${EndIf}</span>
<a href="#l3.841"></a><span id="l3.841" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.842"></a><span id="l3.842" class="difflineminus">-  ClearErrors</span>
<a href="#l3.843"></a><span id="l3.843" class="difflineminus">-  Push 0</span>
<a href="#l3.844"></a><span id="l3.844" class="difflineminus">-FunctionEnd</span>
<a href="#l3.845"></a><span id="l3.845" class="difflineminus">-</span>
<a href="#l3.846"></a><span id="l3.846" class="difflineminus">-Function GetDiff</span>
<a href="#l3.847"></a><span id="l3.847" class="difflineminus">-  ${TrimNewLines} &quot;$9&quot; &quot;$9&quot;</span>
<a href="#l3.848"></a><span id="l3.848" class="difflineminus">-  ${If} $9 != &quot;&quot;</span>
<a href="#l3.849"></a><span id="l3.849" class="difflineminus">-    FileWrite $R3 &quot;$9$\r$\n&quot;</span>
<a href="#l3.850"></a><span id="l3.850" class="difflineminus">-    ${LogMsg} &quot;Added To Uninstall Log: $9&quot;</span>
<a href="#l3.851"></a><span id="l3.851" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.852"></a><span id="l3.852" class="difflineminus">-  Push 0</span>
<a href="#l3.853"></a><span id="l3.853" class="difflineminus">-FunctionEnd</span>
<a href="#l3.854"></a><span id="l3.854" class="difflineminus">-</span>
<a href="#l3.855"></a><span id="l3.855" class="difflineminus">-Function DoCopyFiles</span>
<a href="#l3.856"></a><span id="l3.856" class="difflineminus">-  StrLen $R2 $R0</span>
<a href="#l3.857"></a><span id="l3.857" class="difflineminus">-  ${LocateNoDetails} &quot;$R0&quot; &quot;/L=FD&quot; &quot;CopyFile&quot;</span>
<a href="#l3.858"></a><span id="l3.858" class="difflineplus">+Function LaunchApp</span>
<a href="#l3.859"></a><span id="l3.859" class="difflineplus">+  GetFunctionAddress $0 LaunchAppFromElevatedProcess</span>
<a href="#l3.860"></a><span id="l3.860" class="difflineplus">+  UAC::ExecCodeSegment $0</span>
<a href="#l3.861"></a><span id="l3.861"> FunctionEnd</span>
<a href="#l3.862"></a><span id="l3.862"> </span>
<a href="#l3.863"></a><span id="l3.863" class="difflineminus">-Function CopyFile</span>
<a href="#l3.864"></a><span id="l3.864" class="difflineminus">-  StrCpy $R3 $R8 &quot;&quot; $R2</span>
<a href="#l3.865"></a><span id="l3.865" class="difflineminus">-  retry:</span>
<a href="#l3.866"></a><span id="l3.866" class="difflineminus">-  ClearErrors</span>
<a href="#l3.867"></a><span id="l3.867" class="difflineminus">-  ${If} $R6 ==  &quot;&quot;</span>
<a href="#l3.868"></a><span id="l3.868" class="difflineminus">-    ${Unless} ${FileExists} &quot;$R1$R3\$R7&quot;</span>
<a href="#l3.869"></a><span id="l3.869" class="difflineminus">-      ClearErrors</span>
<a href="#l3.870"></a><span id="l3.870" class="difflineminus">-      CreateDirectory &quot;$R1$R3\$R7&quot;</span>
<a href="#l3.871"></a><span id="l3.871" class="difflineminus">-      ${If} ${Errors}</span>
<a href="#l3.872"></a><span id="l3.872" class="difflineminus">-        ${LogMsg}  &quot;** ERROR Creating Directory: $R1$R3\$R7 **&quot;</span>
<a href="#l3.873"></a><span id="l3.873" class="difflineminus">-        StrCpy $0 &quot;$R1$R3\$R7&quot;</span>
<a href="#l3.874"></a><span id="l3.874" class="difflineminus">-        ${WordReplace} &quot;$(^FileError_NoIgnore)&quot; &quot;\r\n&quot; &quot;$\r$\n&quot; &quot;+*&quot; $0</span>
<a href="#l3.875"></a><span id="l3.875" class="difflineminus">-        MessageBox MB_RETRYCANCEL|MB_ICONQUESTION &quot;$0&quot; IDRETRY retry</span>
<a href="#l3.876"></a><span id="l3.876" class="difflineminus">-        Quit</span>
<a href="#l3.877"></a><span id="l3.877" class="difflineminus">-      ${Else}</span>
<a href="#l3.878"></a><span id="l3.878" class="difflineminus">-        ${LogMsg}  &quot;Created Directory: $R1$R3\$R7&quot;</span>
<a href="#l3.879"></a><span id="l3.879" class="difflineminus">-      ${EndIf}</span>
<a href="#l3.880"></a><span id="l3.880" class="difflineminus">-    ${EndUnless}</span>
<a href="#l3.881"></a><span id="l3.881" class="difflineminus">-  ${Else}</span>
<a href="#l3.882"></a><span id="l3.882" class="difflineminus">-    ${Unless} ${FileExists} &quot;$R1$R3&quot;</span>
<a href="#l3.883"></a><span id="l3.883" class="difflineminus">-      ClearErrors</span>
<a href="#l3.884"></a><span id="l3.884" class="difflineminus">-      CreateDirectory &quot;$R1$R3&quot;</span>
<a href="#l3.885"></a><span id="l3.885" class="difflineminus">-      ${If} ${Errors}</span>
<a href="#l3.886"></a><span id="l3.886" class="difflineminus">-        ${LogMsg}  &quot;** ERROR Creating Directory: $R1$R3 **&quot;</span>
<a href="#l3.887"></a><span id="l3.887" class="difflineminus">-        StrCpy $0 &quot;$R1$R3&quot;</span>
<a href="#l3.888"></a><span id="l3.888" class="difflineminus">-        ${WordReplace} &quot;$(^FileError_NoIgnore)&quot; &quot;\r\n&quot; &quot;$\r$\n&quot; &quot;+*&quot; $0</span>
<a href="#l3.889"></a><span id="l3.889" class="difflineminus">-        MessageBox MB_RETRYCANCEL|MB_ICONQUESTION &quot;$0&quot; IDRETRY retry</span>
<a href="#l3.890"></a><span id="l3.890" class="difflineminus">-        Quit</span>
<a href="#l3.891"></a><span id="l3.891" class="difflineminus">-      ${Else}</span>
<a href="#l3.892"></a><span id="l3.892" class="difflineminus">-        ${LogMsg}  &quot;Created Directory: $R1$R3&quot;</span>
<a href="#l3.893"></a><span id="l3.893" class="difflineminus">-      ${EndIf}</span>
<a href="#l3.894"></a><span id="l3.894" class="difflineminus">-    ${EndUnless}</span>
<a href="#l3.895"></a><span id="l3.895" class="difflineminus">-    ${If} ${FileExists} &quot;$R1$R3\$R7&quot;</span>
<a href="#l3.896"></a><span id="l3.896" class="difflineminus">-      ClearErrors</span>
<a href="#l3.897"></a><span id="l3.897" class="difflineminus">-      Delete &quot;$R1$R3\$R7&quot;</span>
<a href="#l3.898"></a><span id="l3.898" class="difflineminus">-      ${If} ${Errors}</span>
<a href="#l3.899"></a><span id="l3.899" class="difflineminus">-        ${LogMsg} &quot;** ERROR Deleting File: $R1$R3\$R7 **&quot;</span>
<a href="#l3.900"></a><span id="l3.900" class="difflineminus">-        StrCpy $0 &quot;$R1$R3\$R7&quot;</span>
<a href="#l3.901"></a><span id="l3.901" class="difflineminus">-        ${WordReplace} &quot;$(^FileError_NoIgnore)&quot; &quot;\r\n&quot; &quot;$\r$\n&quot; &quot;+*&quot; $0</span>
<a href="#l3.902"></a><span id="l3.902" class="difflineminus">-        MessageBox MB_RETRYCANCEL|MB_ICONQUESTION &quot;$0&quot; IDRETRY retry</span>
<a href="#l3.903"></a><span id="l3.903" class="difflineminus">-        Quit</span>
<a href="#l3.904"></a><span id="l3.904" class="difflineminus">-      ${EndIf}</span>
<a href="#l3.905"></a><span id="l3.905" class="difflineminus">-    ${EndIf}</span>
<a href="#l3.906"></a><span id="l3.906" class="difflineminus">-    ClearErrors</span>
<a href="#l3.907"></a><span id="l3.907" class="difflineminus">-    CopyFiles /SILENT $R9 &quot;$R1$R3&quot;</span>
<a href="#l3.908"></a><span id="l3.908" class="difflineminus">-    ${If} ${Errors}</span>
<a href="#l3.909"></a><span id="l3.909" class="difflineminus">-      ${LogMsg} &quot;** ERROR Installing File: $R1$R3\$R7 **&quot;</span>
<a href="#l3.910"></a><span id="l3.910" class="difflineminus">-      StrCpy $0 &quot;$R1$R3\$R7&quot;</span>
<a href="#l3.911"></a><span id="l3.911" class="difflineminus">-      ${WordReplace} &quot;$(^FileError_NoIgnore)&quot; &quot;\r\n&quot; &quot;$\r$\n&quot; &quot;+*&quot; $0</span>
<a href="#l3.912"></a><span id="l3.912" class="difflineminus">-      MessageBox MB_RETRYCANCEL|MB_ICONQUESTION &quot;$0&quot; IDRETRY retry</span>
<a href="#l3.913"></a><span id="l3.913" class="difflineminus">-      Quit</span>
<a href="#l3.914"></a><span id="l3.914" class="difflineminus">-    ${Else}</span>
<a href="#l3.915"></a><span id="l3.915" class="difflineminus">-      ${LogMsg} &quot;Installed File: $R1$R3\$R7&quot;</span>
<a href="#l3.916"></a><span id="l3.916" class="difflineminus">-    ${EndIf}</span>
<a href="#l3.917"></a><span id="l3.917" class="difflineminus">-    ; If the file is installed into the installation directory remove the</span>
<a href="#l3.918"></a><span id="l3.918" class="difflineminus">-    ; installation directory's path from the file path when writing to the</span>
<a href="#l3.919"></a><span id="l3.919" class="difflineminus">-    ; uninstall.log so it will be a relative path. This allows the same</span>
<a href="#l3.920"></a><span id="l3.920" class="difflineminus">-    ; helper.exe to be used with zip builds if we supply an uninstall.log.</span>
<a href="#l3.921"></a><span id="l3.921" class="difflineminus">-    ${WordReplace} &quot;$R1$R3\$R7&quot; &quot;$INSTDIR&quot; &quot;&quot; &quot;+&quot; $R3</span>
<a href="#l3.922"></a><span id="l3.922" class="difflineminus">-    ${LogUninstall} &quot;File: $R3&quot;</span>
<a href="#l3.923"></a><span id="l3.923" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.924"></a><span id="l3.924" class="difflineminus">-  Push 0</span>
<a href="#l3.925"></a><span id="l3.925" class="difflineminus">-FunctionEnd</span>
<a href="#l3.926"></a><span id="l3.926" class="difflineminus">-</span>
<a href="#l3.927"></a><span id="l3.927" class="difflineminus">-; Clean up the old log files. We only diff the first two found since it is</span>
<a href="#l3.928"></a><span id="l3.928" class="difflineminus">-; possible for there to be several MB and comparing that many would take a very</span>
<a href="#l3.929"></a><span id="l3.929" class="difflineminus">-; long time to diff.</span>
<a href="#l3.930"></a><span id="l3.930" class="difflineminus">-Function CleanupOldLogs</span>
<a href="#l3.931"></a><span id="l3.931" class="difflineminus">-  FindFirst $0 $TmpVal &quot;$INSTDIR\uninstall\*wizard*&quot;</span>
<a href="#l3.932"></a><span id="l3.932" class="difflineminus">-  StrCmp $TmpVal &quot;&quot; done</span>
<a href="#l3.933"></a><span id="l3.933" class="difflineminus">-  StrCpy $TmpVal &quot;$INSTDIR\uninstall\$TmpVal&quot;</span>
<a href="#l3.934"></a><span id="l3.934" class="difflineminus">-</span>
<a href="#l3.935"></a><span id="l3.935" class="difflineminus">-  FindNext $0 $1</span>
<a href="#l3.936"></a><span id="l3.936" class="difflineminus">-  StrCmp $1 &quot;&quot; cleanup</span>
<a href="#l3.937"></a><span id="l3.937" class="difflineminus">-  StrCpy $1 &quot;$INSTDIR\uninstall\$1&quot;</span>
<a href="#l3.938"></a><span id="l3.938" class="difflineminus">-  Push $1</span>
<a href="#l3.939"></a><span id="l3.939" class="difflineminus">-  Call DiffOldLogFiles</span>
<a href="#l3.940"></a><span id="l3.940" class="difflineminus">-  FindClose $0</span>
<a href="#l3.941"></a><span id="l3.941" class="difflineminus">-  ${DeleteFile} &quot;$1&quot;</span>
<a href="#l3.942"></a><span id="l3.942" class="difflineminus">-</span>
<a href="#l3.943"></a><span id="l3.943" class="difflineminus">-  cleanup:</span>
<a href="#l3.944"></a><span id="l3.944" class="difflineminus">-    StrCpy $2 &quot;$INSTDIR\uninstall\cleanup.log&quot;</span>
<a href="#l3.945"></a><span id="l3.945" class="difflineminus">-    ${DeleteFile} &quot;$2&quot;</span>
<a href="#l3.946"></a><span id="l3.946" class="difflineminus">-    FileOpen $R2 $2 w</span>
<a href="#l3.947"></a><span id="l3.947" class="difflineminus">-    Push $TmpVal</span>
<a href="#l3.948"></a><span id="l3.948" class="difflineminus">-    ${LineFind} &quot;$INSTDIR\uninstall\$TmpVal&quot; &quot;/NUL&quot; &quot;1:-1&quot; &quot;CleanOldLogFilesCallback&quot;</span>
<a href="#l3.949"></a><span id="l3.949" class="difflineminus">-    ${DeleteFile} &quot;$INSTDIR\uninstall\$TmpVal&quot;</span>
<a href="#l3.950"></a><span id="l3.950" class="difflineminus">-  done:</span>
<a href="#l3.951"></a><span id="l3.951" class="difflineminus">-    FindClose $0</span>
<a href="#l3.952"></a><span id="l3.952" class="difflineminus">-    FileClose $R2</span>
<a href="#l3.953"></a><span id="l3.953" class="difflineminus">-    FileClose $R3</span>
<a href="#l3.954"></a><span id="l3.954" class="difflineminus">-FunctionEnd</span>
<a href="#l3.955"></a><span id="l3.955" class="difflineminus">-</span>
<a href="#l3.956"></a><span id="l3.956" class="difflineminus">-Function DiffOldLogFiles</span>
<a href="#l3.957"></a><span id="l3.957" class="difflineminus">-  StrCpy $R1 &quot;$1&quot;</span>
<a href="#l3.958"></a><span id="l3.958" class="difflineminus">-  GetTempFileName $R2</span>
<a href="#l3.959"></a><span id="l3.959" class="difflineminus">-  FileOpen $R3 $R2 w</span>
<a href="#l3.960"></a><span id="l3.960" class="difflineminus">-  ${TextCompareNoDetails} &quot;$R1&quot; &quot;$TmpVal&quot; &quot;SlowDiff&quot; &quot;GetDiff&quot;</span>
<a href="#l3.961"></a><span id="l3.961" class="difflineminus">-  FileClose $R3</span>
<a href="#l3.962"></a><span id="l3.962" class="difflineminus">-  ${FileJoin} &quot;$TmpVal&quot; &quot;$R2&quot; &quot;$TmpVal&quot;</span>
<a href="#l3.963"></a><span id="l3.963" class="difflineminus">-  ${DeleteFile} &quot;$R2&quot;</span>
<a href="#l3.964"></a><span id="l3.964" class="difflineminus">-FunctionEnd</span>
<a href="#l3.965"></a><span id="l3.965" class="difflineminus">-</span>
<a href="#l3.966"></a><span id="l3.966" class="difflineminus">-Function CleanOldLogFilesCallback</span>
<a href="#l3.967"></a><span id="l3.967" class="difflineminus">-  ${TrimNewLines} &quot;$R9&quot; $R9</span>
<a href="#l3.968"></a><span id="l3.968" class="difflineminus">-  ${WordReplace} &quot;$R9&quot; &quot;$INSTDIR&quot; &quot;&quot; &quot;+&quot; $R3</span>
<a href="#l3.969"></a><span id="l3.969" class="difflineminus">-  ${WordFind} &quot;$R9&quot; &quot;	&quot; &quot;E+1}&quot; $R0</span>
<a href="#l3.970"></a><span id="l3.970" class="difflineminus">-  IfErrors updater 0</span>
<a href="#l3.971"></a><span id="l3.971" class="difflineminus">-</span>
<a href="#l3.972"></a><span id="l3.972" class="difflineminus">-  ${WordFind} &quot;$R0&quot; &quot;Installing: &quot; &quot;E+1}&quot; $R1</span>
<a href="#l3.973"></a><span id="l3.973" class="difflineminus">-  ${Unless} ${Errors}</span>
<a href="#l3.974"></a><span id="l3.974" class="difflineminus">-    FileWrite $R2 &quot;File: $R1$\r$\n&quot;</span>
<a href="#l3.975"></a><span id="l3.975" class="difflineminus">-    GoTo done</span>
<a href="#l3.976"></a><span id="l3.976" class="difflineminus">-  ${EndUnless}</span>
<a href="#l3.977"></a><span id="l3.977" class="difflineminus">-</span>
<a href="#l3.978"></a><span id="l3.978" class="difflineminus">-  ${WordFind} &quot;$R0&quot; &quot;Replacing: &quot; &quot;E+1}&quot; $R1</span>
<a href="#l3.979"></a><span id="l3.979" class="difflineminus">-  ${Unless} ${Errors}</span>
<a href="#l3.980"></a><span id="l3.980" class="difflineminus">-    FileWrite $R2 &quot;File: $R1$\r$\n&quot;</span>
<a href="#l3.981"></a><span id="l3.981" class="difflineminus">-    GoTo done</span>
<a href="#l3.982"></a><span id="l3.982" class="difflineminus">-  ${EndUnless}</span>
<a href="#l3.983"></a><span id="l3.983" class="difflineminus">-</span>
<a href="#l3.984"></a><span id="l3.984" class="difflineminus">-  ${WordFind} &quot;$R0&quot; &quot;Windows Shortcut: &quot; &quot;E+1}&quot; $R1</span>
<a href="#l3.985"></a><span id="l3.985" class="difflineminus">-  ${Unless} ${Errors}</span>
<a href="#l3.986"></a><span id="l3.986" class="difflineminus">-    FileWrite $R2 &quot;File: $R1.lnk$\r$\n&quot;</span>
<a href="#l3.987"></a><span id="l3.987" class="difflineminus">-    GoTo done</span>
<a href="#l3.988"></a><span id="l3.988" class="difflineminus">-  ${EndUnless}</span>
<a href="#l3.989"></a><span id="l3.989" class="difflineminus">-</span>
<a href="#l3.990"></a><span id="l3.990" class="difflineminus">-  ${WordFind} &quot;$R0&quot; &quot;Create Folder: &quot; &quot;E+1}&quot; $R1</span>
<a href="#l3.991"></a><span id="l3.991" class="difflineminus">-  ${Unless} ${Errors}</span>
<a href="#l3.992"></a><span id="l3.992" class="difflineminus">-    FileWrite $R2 &quot;Dir: $R1$\r$\n&quot;</span>
<a href="#l3.993"></a><span id="l3.993" class="difflineminus">-    GoTo done</span>
<a href="#l3.994"></a><span id="l3.994" class="difflineminus">-  ${EndUnless}</span>
<a href="#l3.995"></a><span id="l3.995" class="difflineminus">-</span>
<a href="#l3.996"></a><span id="l3.996" class="difflineminus">-  updater:</span>
<a href="#l3.997"></a><span id="l3.997" class="difflineminus">-    ${WordFind} &quot;$R9&quot; &quot;installing: &quot; &quot;E+1}&quot; $R0</span>
<a href="#l3.998"></a><span id="l3.998" class="difflineminus">-    ${Unless} ${Errors}</span>
<a href="#l3.999"></a><span id="l3.999" class="difflineminus">-      FileWrite $R2 &quot;File: $R0$\r$\n&quot;</span>
<a href="#l3.1000"></a><span id="l3.1000" class="difflineminus">-    ${EndUnless}</span>
<a href="#l3.1001"></a><span id="l3.1001" class="difflineminus">-</span>
<a href="#l3.1002"></a><span id="l3.1002" class="difflineminus">-  done:</span>
<a href="#l3.1003"></a><span id="l3.1003" class="difflineminus">-    Push 0</span>
<a href="#l3.1004"></a><span id="l3.1004" class="difflineminus">-FunctionEnd</span>
<a href="#l3.1005"></a><span id="l3.1005" class="difflineminus">-</span>
<a href="#l3.1006"></a><span id="l3.1006" class="difflineminus">-Function LaunchApp</span>
<a href="#l3.1007"></a><span id="l3.1007" class="difflineminus">-  ${CloseApp} &quot;true&quot; $(WARN_APP_RUNNING_INSTALL)</span>
<a href="#l3.1008"></a><span id="l3.1008" class="difflineminus">-  Exec &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.1009"></a><span id="l3.1009" class="difflineplus">+Function LaunchAppFromElevatedProcess</span>
<a href="#l3.1010"></a><span id="l3.1010" class="difflineplus">+  ${ManualCloseAppPrompt} &quot;${WindowClass}&quot; &quot;$(WARN_MANUALLY_CLOSE_APP_LAUNCH)&quot;</span>
<a href="#l3.1011"></a><span id="l3.1011" class="difflineplus">+  ; Find the installation directory when launching using GetFunctionAddress</span>
<a href="#l3.1012"></a><span id="l3.1012" class="difflineplus">+  ; from an elevated installer since $INSTDIR will not be set in this installer</span>
<a href="#l3.1013"></a><span id="l3.1013" class="difflineplus">+  ${StrFilter} &quot;${FileMainEXE}&quot; &quot;+&quot; &quot;&quot; &quot;&quot; $R9</span>
<a href="#l3.1014"></a><span id="l3.1014" class="difflineplus">+  ReadRegStr $0 HKLM &quot;Software\Clients\StartMenuInternet\$R9\DefaultIcon&quot; &quot;&quot;</span>
<a href="#l3.1015"></a><span id="l3.1015" class="difflineplus">+  ${GetPathFromString} &quot;$0&quot; $0</span>
<a href="#l3.1016"></a><span id="l3.1016" class="difflineplus">+  ${GetParent} &quot;$0&quot; $1</span>
<a href="#l3.1017"></a><span id="l3.1017" class="difflineplus">+  ; Set our current working directory to the application's install directory</span>
<a href="#l3.1018"></a><span id="l3.1018" class="difflineplus">+  ; otherwise the 7-Zip temp directory will be in use and won't be deleted.</span>
<a href="#l3.1019"></a><span id="l3.1019" class="difflineplus">+  SetOutPath &quot;$1&quot;</span>
<a href="#l3.1020"></a><span id="l3.1020" class="difflineplus">+  Exec &quot;$0&quot;</span>
<a href="#l3.1021"></a><span id="l3.1021"> FunctionEnd</span>
<a href="#l3.1022"></a><span id="l3.1022"> </span>
<a href="#l3.1023"></a><span id="l3.1023"> ################################################################################</span>
<a href="#l3.1024"></a><span id="l3.1024"> # Language</span>
<a href="#l3.1025"></a><span id="l3.1025"> </span>
<a href="#l3.1026"></a><span id="l3.1026"> !insertmacro MOZ_MUI_LANGUAGE 'baseLocale'</span>
<a href="#l3.1027"></a><span id="l3.1027"> !verbose push</span>
<a href="#l3.1028"></a><span id="l3.1028"> !verbose 3</span>
<a href="#l3.1029"></a><span id="l3.1029" class="difflineat">@@ -925,147 +712,167 @@ FunctionEnd</span>
<a href="#l3.1030"></a><span id="l3.1030"> </span>
<a href="#l3.1031"></a><span id="l3.1031"> ; Set this after the locale files to override it if it is in the locale</span>
<a href="#l3.1032"></a><span id="l3.1032"> ; using &quot; &quot; for BrandingText will hide the &quot;Nullsoft Install System...&quot; branding</span>
<a href="#l3.1033"></a><span id="l3.1033"> BrandingText &quot; &quot;</span>
<a href="#l3.1034"></a><span id="l3.1034"> </span>
<a href="#l3.1035"></a><span id="l3.1035"> ################################################################################</span>
<a href="#l3.1036"></a><span id="l3.1036"> # Page pre and leave functions</span>
<a href="#l3.1037"></a><span id="l3.1037"> </span>
<a href="#l3.1038"></a><span id="l3.1038" class="difflineplus">+Function preWelcome</span>
<a href="#l3.1039"></a><span id="l3.1039" class="difflineplus">+  ${If} ${FileExists} &quot;$EXEDIR\localized\distribution\modern-wizard.bmp&quot;</span>
<a href="#l3.1040"></a><span id="l3.1040" class="difflineplus">+    Delete &quot;$PLUGINSDIR\modern-wizard.bmp&quot;</span>
<a href="#l3.1041"></a><span id="l3.1041" class="difflineplus">+    CopyFiles /SILENT &quot;$EXEDIR\localized\distribution\modern-wizard.bmp&quot; &quot;$PLUGINSDIR\modern-wizard.bmp&quot;</span>
<a href="#l3.1042"></a><span id="l3.1042" class="difflineplus">+  ${EndIf}</span>
<a href="#l3.1043"></a><span id="l3.1043" class="difflineplus">+FunctionEnd</span>
<a href="#l3.1044"></a><span id="l3.1044" class="difflineplus">+</span>
<a href="#l3.1045"></a><span id="l3.1045" class="difflineplus">+Function showLicense</span>
<a href="#l3.1046"></a><span id="l3.1046" class="difflineplus">+  ${If} ${FileExists} &quot;$EXEDIR\localized\distribution\modern-header.bmp&quot;</span>
<a href="#l3.1047"></a><span id="l3.1047" class="difflineplus">+  ${AndIf} $hHeaderBitmap == &quot;&quot;</span>
<a href="#l3.1048"></a><span id="l3.1048" class="difflineplus">+    Delete &quot;$PLUGINSDIR\modern-header.bmp&quot;</span>
<a href="#l3.1049"></a><span id="l3.1049" class="difflineplus">+    CopyFiles /SILENT &quot;$EXEDIR\localized\distribution\modern-header.bmp&quot; &quot;$PLUGINSDIR\modern-header.bmp&quot;</span>
<a href="#l3.1050"></a><span id="l3.1050" class="difflineplus">+    ${ChangeMUIHeaderImage} &quot;$PLUGINSDIR\modern-header.bmp&quot;</span>
<a href="#l3.1051"></a><span id="l3.1051" class="difflineplus">+  ${EndIf}</span>
<a href="#l3.1052"></a><span id="l3.1052" class="difflineplus">+FunctionEnd</span>
<a href="#l3.1053"></a><span id="l3.1053" class="difflineplus">+</span>
<a href="#l3.1054"></a><span id="l3.1054"> Function preOptions</span>
<a href="#l3.1055"></a><span id="l3.1055">   !insertmacro MUI_HEADER_TEXT &quot;$(OPTIONS_PAGE_TITLE)&quot; &quot;$(OPTIONS_PAGE_SUBTITLE)&quot;</span>
<a href="#l3.1056"></a><span id="l3.1056">   !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;options.ini&quot;</span>
<a href="#l3.1057"></a><span id="l3.1057"> FunctionEnd</span>
<a href="#l3.1058"></a><span id="l3.1058"> </span>
<a href="#l3.1059"></a><span id="l3.1059"> Function leaveOptions</span>
<a href="#l3.1060"></a><span id="l3.1060">   ${MUI_INSTALLOPTIONS_READ} $0 &quot;options.ini&quot; &quot;Settings&quot; &quot;State&quot;</span>
<a href="#l3.1061"></a><span id="l3.1061">   ${If} $0 != 0</span>
<a href="#l3.1062"></a><span id="l3.1062">     Abort</span>
<a href="#l3.1063"></a><span id="l3.1063">   ${EndIf}</span>
<a href="#l3.1064"></a><span id="l3.1064">   ${MUI_INSTALLOPTIONS_READ} $R0 &quot;options.ini&quot; &quot;Field 2&quot; &quot;State&quot;</span>
<a href="#l3.1065"></a><span id="l3.1065">   StrCmp $R0 &quot;1&quot; +1 +2</span>
<a href="#l3.1066"></a><span id="l3.1066" class="difflineminus">-  StrCpy $InstallType &quot;1&quot;</span>
<a href="#l3.1067"></a><span id="l3.1067" class="difflineplus">+  StrCpy $InstallType ${INSTALLTYPE_BASIC} </span>
<a href="#l3.1068"></a><span id="l3.1068">   ${MUI_INSTALLOPTIONS_READ} $R0 &quot;options.ini&quot; &quot;Field 3&quot; &quot;State&quot;</span>
<a href="#l3.1069"></a><span id="l3.1069">   StrCmp $R0 &quot;1&quot; +1 +2</span>
<a href="#l3.1070"></a><span id="l3.1070" class="difflineminus">-  StrCpy $InstallType &quot;4&quot;</span>
<a href="#l3.1071"></a><span id="l3.1071" class="difflineplus">+  StrCpy $InstallType ${INSTALLTYPE_CUSTOM}</span>
<a href="#l3.1072"></a><span id="l3.1072" class="difflineplus">+</span>
<a href="#l3.1073"></a><span id="l3.1073" class="difflineplus">+  ${If} $InstallType != ${INSTALLTYPE_CUSTOM}</span>
<a href="#l3.1074"></a><span id="l3.1074" class="difflineplus">+!ifndef NO_INSTDIR_FROM_REG</span>
<a href="#l3.1075"></a><span id="l3.1075" class="difflineplus">+    SetShellVarContext all      ; Set SHCTX to HKLM</span>
<a href="#l3.1076"></a><span id="l3.1076" class="difflineplus">+    ${GetSingleInstallPath} &quot;Software\Mozilla\${BrandFullNameInternal}&quot; $R9</span>
<a href="#l3.1077"></a><span id="l3.1077" class="difflineplus">+    StrCmp &quot;$R9&quot; &quot;false&quot; +1 fix_install_dir</span>
<a href="#l3.1078"></a><span id="l3.1078" class="difflineplus">+    SetShellVarContext current  ; Set SHCTX to HKCU</span>
<a href="#l3.1079"></a><span id="l3.1079" class="difflineplus">+    ${GetSingleInstallPath} &quot;Software\Mozilla\${BrandFullNameInternal}&quot; $R9</span>
<a href="#l3.1080"></a><span id="l3.1080" class="difflineplus">+</span>
<a href="#l3.1081"></a><span id="l3.1081" class="difflineplus">+    fix_install_dir:</span>
<a href="#l3.1082"></a><span id="l3.1082" class="difflineplus">+    StrCmp &quot;$R9&quot; &quot;false&quot; +2 +1</span>
<a href="#l3.1083"></a><span id="l3.1083" class="difflineplus">+    StrCpy $INSTDIR &quot;$R9&quot;</span>
<a href="#l3.1084"></a><span id="l3.1084" class="difflineplus">+!endif</span>
<a href="#l3.1085"></a><span id="l3.1085" class="difflineplus">+</span>
<a href="#l3.1086"></a><span id="l3.1086" class="difflineplus">+    Call CheckExistingInstall</span>
<a href="#l3.1087"></a><span id="l3.1087" class="difflineplus">+  ${EndIf}</span>
<a href="#l3.1088"></a><span id="l3.1088"> FunctionEnd</span>
<a href="#l3.1089"></a><span id="l3.1089"> </span>
<a href="#l3.1090"></a><span id="l3.1090"> Function preComponents</span>
<a href="#l3.1091"></a><span id="l3.1091" class="difflineminus">-  Call CheckCustom</span>
<a href="#l3.1092"></a><span id="l3.1092" class="difflineplus">+  ${CheckCustomCommon}</span>
<a href="#l3.1093"></a><span id="l3.1093">   !insertmacro checkSuiteComponents</span>
<a href="#l3.1094"></a><span id="l3.1094">   !insertmacro MUI_HEADER_TEXT &quot;$(OPTIONAL_COMPONENTS_TITLE)&quot; &quot;$(OPTIONAL_COMPONENTS_SUBTITLE)&quot;</span>
<a href="#l3.1095"></a><span id="l3.1095">   !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;components.ini&quot;</span>
<a href="#l3.1096"></a><span id="l3.1096"> FunctionEnd</span>
<a href="#l3.1097"></a><span id="l3.1097"> </span>
<a href="#l3.1098"></a><span id="l3.1098"> Function leaveComponents</span>
<a href="#l3.1099"></a><span id="l3.1099">   ; If ChatZilla exists then it will be Field 2.</span>
<a href="#l3.1100"></a><span id="l3.1100">   ; If ChatZilla doesn't exist then DOMi will be Field 2 (when ChatZilla and DOMi</span>
<a href="#l3.1101"></a><span id="l3.1101">   ; don't exist, debugQA will be Field 2).</span>
<a href="#l3.1102"></a><span id="l3.1102">   StrCpy $R1 2</span>
<a href="#l3.1103"></a><span id="l3.1103">   </span>
<a href="#l3.1104"></a><span id="l3.1104">  ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}&quot;</span>
<a href="#l3.1105"></a><span id="l3.1105">     ${MUI_INSTALLOPTIONS_READ} $R0 &quot;components.ini&quot; &quot;Field $R1&quot; &quot;State&quot;</span>
<a href="#l3.1106"></a><span id="l3.1106">     ; State will be 1 for checked and 0 for unchecked so we can use that to set</span>
<a href="#l3.1107"></a><span id="l3.1107">     ; the section flags for installation.</span>
<a href="#l3.1108"></a><span id="l3.1108" class="difflineminus">-    SectionSetFlags 1 $R0</span>
<a href="#l3.1109"></a><span id="l3.1109" class="difflineplus">+    SectionSetFlags ${CZ_IDX} $R0</span>
<a href="#l3.1110"></a><span id="l3.1110">     IntOp $R1 $R1 + 1</span>
<a href="#l3.1111"></a><span id="l3.1111">   ${Else}</span>
<a href="#l3.1112"></a><span id="l3.1112" class="difflineminus">-    SectionSetFlags 1 0 ; Disable install for chatzilla</span>
<a href="#l3.1113"></a><span id="l3.1113" class="difflineplus">+    SectionSetFlags ${CZ_IDX} 0 ; Disable install for chatzilla</span>
<a href="#l3.1114"></a><span id="l3.1114">   ${EndIf}</span>
<a href="#l3.1115"></a><span id="l3.1115"> </span>
<a href="#l3.1116"></a><span id="l3.1116">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\inspector@mozilla.org&quot;</span>
<a href="#l3.1117"></a><span id="l3.1117">     ${MUI_INSTALLOPTIONS_READ} $R0 &quot;components.ini&quot; &quot;Field $R1&quot; &quot;State&quot;</span>
<a href="#l3.1118"></a><span id="l3.1118">     ; State will be 1 for checked and 0 for unchecked so we can use that to set</span>
<a href="#l3.1119"></a><span id="l3.1119">     ; the section flags for installation.</span>
<a href="#l3.1120"></a><span id="l3.1120" class="difflineminus">-    SectionSetFlags 2 $R0</span>
<a href="#l3.1121"></a><span id="l3.1121" class="difflineplus">+    SectionSetFlags ${DOMI_IDX} $R0</span>
<a href="#l3.1122"></a><span id="l3.1122">     IntOp $R1 $R1 + 1</span>
<a href="#l3.1123"></a><span id="l3.1123">   ${Else}</span>
<a href="#l3.1124"></a><span id="l3.1124" class="difflineminus">-    SectionSetFlags 2 0 ; Disable install for DOMi</span>
<a href="#l3.1125"></a><span id="l3.1125" class="difflineplus">+    SectionSetFlags ${DOMI_IDX} 0 ; Disable install for DOMi</span>
<a href="#l3.1126"></a><span id="l3.1126">   ${EndIf}</span>
<a href="#l3.1127"></a><span id="l3.1127"> </span>
<a href="#l3.1128"></a><span id="l3.1128">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\debugQA@mozilla.org&quot;</span>
<a href="#l3.1129"></a><span id="l3.1129">     ${MUI_INSTALLOPTIONS_READ} $R0 &quot;components.ini&quot; &quot;Field $R1&quot; &quot;State&quot;</span>
<a href="#l3.1130"></a><span id="l3.1130">     ; State will be 1 for checked and 0 for unchecked so we can use that to set</span>
<a href="#l3.1131"></a><span id="l3.1131">     ; the section flags for installation.</span>
<a href="#l3.1132"></a><span id="l3.1132" class="difflineminus">-    SectionSetFlags 3 $R0</span>
<a href="#l3.1133"></a><span id="l3.1133" class="difflineplus">+    SectionSetFlags ${DEBUG_IDX} $R0</span>
<a href="#l3.1134"></a><span id="l3.1134">     IntOp $R1 $R1 + 1</span>
<a href="#l3.1135"></a><span id="l3.1135">   ${Else}</span>
<a href="#l3.1136"></a><span id="l3.1136" class="difflineminus">-    SectionSetFlags 3 0 ; Disable install for debugQA</span>
<a href="#l3.1137"></a><span id="l3.1137" class="difflineplus">+    SectionSetFlags ${DEBUG_IDX} 0 ; Disable install for debugQA</span>
<a href="#l3.1138"></a><span id="l3.1138">   ${EndIf}</span>
<a href="#l3.1139"></a><span id="l3.1139"> </span>
<a href="#l3.1140"></a><span id="l3.1140">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\p@m&quot;</span>
<a href="#l3.1141"></a><span id="l3.1141">     ${MUI_INSTALLOPTIONS_READ} $R0 &quot;components.ini&quot; &quot;Field $R1&quot; &quot;State&quot;</span>
<a href="#l3.1142"></a><span id="l3.1142">     ; State will be 1 for checked and 0 for unchecked so we can use that to set</span>
<a href="#l3.1143"></a><span id="l3.1143">     ; the section flags for installation.</span>
<a href="#l3.1144"></a><span id="l3.1144" class="difflineminus">-    SectionSetFlags 4 $R0</span>
<a href="#l3.1145"></a><span id="l3.1145" class="difflineplus">+    SectionSetFlags ${PALM_IDX} $R0</span>
<a href="#l3.1146"></a><span id="l3.1146">     IntOp $R1 $R1 + 1</span>
<a href="#l3.1147"></a><span id="l3.1147">   ${Else}</span>
<a href="#l3.1148"></a><span id="l3.1148" class="difflineminus">-    SectionSetFlags 4 0 ; Disable install for palmsync</span>
<a href="#l3.1149"></a><span id="l3.1149" class="difflineplus">+    SectionSetFlags ${PALM_IDX} 0 ; Disable install for palmsync</span>
<a href="#l3.1150"></a><span id="l3.1150">   ${EndIf}</span>
<a href="#l3.1151"></a><span id="l3.1151"> </span>
<a href="#l3.1152"></a><span id="l3.1152">   ${If} ${FileExists} &quot;$EXEDIR\optional\extensions\{f13b157f-b174-47e7-a34d-4815ddfdfeb8}&quot;</span>
<a href="#l3.1153"></a><span id="l3.1153">     ${MUI_INSTALLOPTIONS_READ} $R0 &quot;components.ini&quot; &quot;Field $R1&quot; &quot;State&quot;</span>
<a href="#l3.1154"></a><span id="l3.1154">     ; State will be 1 for checked and 0 for unchecked so we can use that to set</span>
<a href="#l3.1155"></a><span id="l3.1155">     ; the section flags for installation.</span>
<a href="#l3.1156"></a><span id="l3.1156" class="difflineminus">-    SectionSetFlags 5 $R0</span>
<a href="#l3.1157"></a><span id="l3.1157" class="difflineplus">+    SectionSetFlags ${VENKMAN_IDX} $R0</span>
<a href="#l3.1158"></a><span id="l3.1158">     IntOp $R1 $R1 + 1</span>
<a href="#l3.1159"></a><span id="l3.1159">   ${Else}</span>
<a href="#l3.1160"></a><span id="l3.1160" class="difflineminus">-    SectionSetFlags 5 0 ; Disable install for venkman</span>
<a href="#l3.1161"></a><span id="l3.1161" class="difflineplus">+    SectionSetFlags ${VENKMAN_IDX} 0 ; Disable install for venkman</span>
<a href="#l3.1162"></a><span id="l3.1162">   ${EndIf}</span>
<a href="#l3.1163"></a><span id="l3.1163"> FunctionEnd</span>
<a href="#l3.1164"></a><span id="l3.1164"> </span>
<a href="#l3.1165"></a><span id="l3.1165"> Function preDirectory</span>
<a href="#l3.1166"></a><span id="l3.1166" class="difflineminus">-  ${If} $InstallType != 4</span>
<a href="#l3.1167"></a><span id="l3.1167" class="difflineminus">-    ${CheckDiskSpace} $R9</span>
<a href="#l3.1168"></a><span id="l3.1168" class="difflineminus">-    ${If} $R9 != &quot;false&quot;</span>
<a href="#l3.1169"></a><span id="l3.1169" class="difflineminus">-      ${CanWriteToInstallDir} $R9</span>
<a href="#l3.1170"></a><span id="l3.1170" class="difflineminus">-      ${If} $R9 != &quot;false&quot;</span>
<a href="#l3.1171"></a><span id="l3.1171" class="difflineminus">-        Abort</span>
<a href="#l3.1172"></a><span id="l3.1172" class="difflineminus">-      ${EndIf}</span>
<a href="#l3.1173"></a><span id="l3.1173" class="difflineminus">-    ${EndIf}</span>
<a href="#l3.1174"></a><span id="l3.1174" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.1175"></a><span id="l3.1175" class="difflineplus">+  ${PreDirectoryCommon}</span>
<a href="#l3.1176"></a><span id="l3.1176"> FunctionEnd</span>
<a href="#l3.1177"></a><span id="l3.1177"> </span>
<a href="#l3.1178"></a><span id="l3.1178"> Function leaveDirectory</span>
<a href="#l3.1179"></a><span id="l3.1179" class="difflineminus">-  ${CheckDiskSpace} $R9</span>
<a href="#l3.1180"></a><span id="l3.1180" class="difflineminus">-  ${If} $R9 == &quot;false&quot;</span>
<a href="#l3.1181"></a><span id="l3.1181" class="difflineminus">-    MessageBox MB_OK &quot;$(WARN_DISK_SPACE)&quot;</span>
<a href="#l3.1182"></a><span id="l3.1182" class="difflineminus">-    Abort</span>
<a href="#l3.1183"></a><span id="l3.1183" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.1184"></a><span id="l3.1184" class="difflineminus">-</span>
<a href="#l3.1185"></a><span id="l3.1185" class="difflineminus">-  ${CanWriteToInstallDir} $R9</span>
<a href="#l3.1186"></a><span id="l3.1186" class="difflineminus">-  ${If} $R9 == &quot;false&quot;</span>
<a href="#l3.1187"></a><span id="l3.1187" class="difflineminus">-    MessageBox MB_OK &quot;$(WARN_WRITE_ACCESS)&quot;</span>
<a href="#l3.1188"></a><span id="l3.1188" class="difflineminus">-    Abort</span>
<a href="#l3.1189"></a><span id="l3.1189" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.1190"></a><span id="l3.1190" class="difflineplus">+  ${LeaveDirectoryCommon} &quot;$(WARN_DISK_SPACE)&quot; &quot;$(WARN_WRITE_ACCESS)&quot;</span>
<a href="#l3.1191"></a><span id="l3.1191"> FunctionEnd</span>
<a href="#l3.1192"></a><span id="l3.1192"> </span>
<a href="#l3.1193"></a><span id="l3.1193"> Function preShortcuts</span>
<a href="#l3.1194"></a><span id="l3.1194" class="difflineminus">-  Call CheckCustom</span>
<a href="#l3.1195"></a><span id="l3.1195" class="difflineplus">+  ${CheckCustomCommon}</span>
<a href="#l3.1196"></a><span id="l3.1196">   !insertmacro MUI_HEADER_TEXT &quot;$(SHORTCUTS_PAGE_TITLE)&quot; &quot;$(SHORTCUTS_PAGE_SUBTITLE)&quot;</span>
<a href="#l3.1197"></a><span id="l3.1197">   !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;shortcuts.ini&quot;</span>
<a href="#l3.1198"></a><span id="l3.1198"> FunctionEnd</span>
<a href="#l3.1199"></a><span id="l3.1199"> </span>
<a href="#l3.1200"></a><span id="l3.1200"> Function leaveShortcuts</span>
<a href="#l3.1201"></a><span id="l3.1201">   ${MUI_INSTALLOPTIONS_READ} $0 &quot;shortcuts.ini&quot; &quot;Settings&quot; &quot;State&quot;</span>
<a href="#l3.1202"></a><span id="l3.1202">   ${If} $0 != 0</span>
<a href="#l3.1203"></a><span id="l3.1203">     Abort</span>
<a href="#l3.1204"></a><span id="l3.1204">   ${EndIf}</span>
<a href="#l3.1205"></a><span id="l3.1205">   ${MUI_INSTALLOPTIONS_READ} $AddDesktopSC &quot;shortcuts.ini&quot; &quot;Field 2&quot; &quot;State&quot;</span>
<a href="#l3.1206"></a><span id="l3.1206">   ${MUI_INSTALLOPTIONS_READ} $AddStartMenuSC &quot;shortcuts.ini&quot; &quot;Field 3&quot; &quot;State&quot;</span>
<a href="#l3.1207"></a><span id="l3.1207">   ${MUI_INSTALLOPTIONS_READ} $AddQuickLaunchSC &quot;shortcuts.ini&quot; &quot;Field 4&quot; &quot;State&quot;</span>
<a href="#l3.1208"></a><span id="l3.1208"> FunctionEnd</span>
<a href="#l3.1209"></a><span id="l3.1209"> </span>
<a href="#l3.1210"></a><span id="l3.1210"> Function preStartMenu</span>
<a href="#l3.1211"></a><span id="l3.1211" class="difflineminus">-  Call CheckCustom</span>
<a href="#l3.1212"></a><span id="l3.1212" class="difflineplus">+  ${CheckCustomCommon}</span>
<a href="#l3.1213"></a><span id="l3.1213">   ${If} $AddStartMenuSC != 1</span>
<a href="#l3.1214"></a><span id="l3.1214">     Abort</span>
<a href="#l3.1215"></a><span id="l3.1215">   ${EndIf}</span>
<a href="#l3.1216"></a><span id="l3.1216"> FunctionEnd</span>
<a href="#l3.1217"></a><span id="l3.1217"> </span>
<a href="#l3.1218"></a><span id="l3.1218" class="difflineplus">+Function leaveStartMenu</span>
<a href="#l3.1219"></a><span id="l3.1219" class="difflineplus">+  ${If} $InstallType == ${INSTALLTYPE_CUSTOM}</span>
<a href="#l3.1220"></a><span id="l3.1220" class="difflineplus">+    Call CheckExistingInstall</span>
<a href="#l3.1221"></a><span id="l3.1221" class="difflineplus">+  ${EndIf}</span>
<a href="#l3.1222"></a><span id="l3.1222" class="difflineplus">+FunctionEnd</span>
<a href="#l3.1223"></a><span id="l3.1223" class="difflineplus">+</span>
<a href="#l3.1224"></a><span id="l3.1224"> Function preSummary</span>
<a href="#l3.1225"></a><span id="l3.1225">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Settings&quot; NumFields &quot;3&quot;</span>
<a href="#l3.1226"></a><span id="l3.1226"> </span>
<a href="#l3.1227"></a><span id="l3.1227">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 1&quot; Type   &quot;label&quot;</span>
<a href="#l3.1228"></a><span id="l3.1228">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 1&quot; Text   &quot;$(SUMMARY_INSTALLED_TO)&quot;</span>
<a href="#l3.1229"></a><span id="l3.1229">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 1&quot; Left   &quot;0&quot;</span>
<a href="#l3.1230"></a><span id="l3.1230">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 1&quot; Right  &quot;-1&quot;</span>
<a href="#l3.1231"></a><span id="l3.1231">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 1&quot; Top    &quot;5&quot;</span>
<a href="#l3.1232"></a><span id="l3.1232" class="difflineat">@@ -1095,205 +902,60 @@ Function preSummary</span>
<a href="#l3.1233"></a><span id="l3.1233">     WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 4&quot; Left   &quot;0&quot;</span>
<a href="#l3.1234"></a><span id="l3.1234">     WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 4&quot; Right  &quot;-1&quot;</span>
<a href="#l3.1235"></a><span id="l3.1235">     WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 4&quot; Top    &quot;35&quot;</span>
<a href="#l3.1236"></a><span id="l3.1236">     WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 4&quot; Bottom &quot;45&quot;</span>
<a href="#l3.1237"></a><span id="l3.1237"> </span>
<a href="#l3.1238"></a><span id="l3.1238">     WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Settings&quot; NumFields &quot;4&quot;</span>
<a href="#l3.1239"></a><span id="l3.1239">   ${EndIf}</span>
<a href="#l3.1240"></a><span id="l3.1240"> </span>
<a href="#l3.1241"></a><span id="l3.1241" class="difflineminus">-  ReadINIStr $0 &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 6&quot; &quot;State&quot;</span>
<a href="#l3.1242"></a><span id="l3.1242" class="difflineminus">-  ${If} &quot;$0&quot; == &quot;1&quot;</span>
<a href="#l3.1243"></a><span id="l3.1243" class="difflineminus">-    ${If} &quot;$TmpVal&quot; == &quot;true&quot;</span>
<a href="#l3.1244"></a><span id="l3.1244" class="difflineminus">-      ; To insert this control reset Top / Bottom for controls below this one</span>
<a href="#l3.1245"></a><span id="l3.1245" class="difflineminus">-      WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 4&quot; Top    &quot;50&quot;</span>
<a href="#l3.1246"></a><span id="l3.1246" class="difflineminus">-      WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 4&quot; Bottom &quot;60&quot;</span>
<a href="#l3.1247"></a><span id="l3.1247" class="difflineminus">-      StrCpy $0 &quot;5&quot;</span>
<a href="#l3.1248"></a><span id="l3.1248" class="difflineminus">-    ${Else}</span>
<a href="#l3.1249"></a><span id="l3.1249" class="difflineminus">-      StrCpy $0 &quot;4&quot;</span>
<a href="#l3.1250"></a><span id="l3.1250" class="difflineminus">-    ${EndIf}</span>
<a href="#l3.1251"></a><span id="l3.1251" class="difflineminus">-</span>
<a href="#l3.1252"></a><span id="l3.1252" class="difflineminus">-    WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field $0&quot; Type   &quot;label&quot;</span>
<a href="#l3.1253"></a><span id="l3.1253" class="difflineminus">-    WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field $0&quot; Text   &quot;$(SUMMARY_MAKE_DEFAULT)&quot;</span>
<a href="#l3.1254"></a><span id="l3.1254" class="difflineminus">-    WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field $0&quot; Left   &quot;0&quot;</span>
<a href="#l3.1255"></a><span id="l3.1255" class="difflineminus">-    WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field $0&quot; Right  &quot;-1&quot;</span>
<a href="#l3.1256"></a><span id="l3.1256" class="difflineminus">-    WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field $0&quot; Top    &quot;35&quot;</span>
<a href="#l3.1257"></a><span id="l3.1257" class="difflineminus">-    WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field $0&quot; Bottom &quot;45&quot;</span>
<a href="#l3.1258"></a><span id="l3.1258" class="difflineminus">-</span>
<a href="#l3.1259"></a><span id="l3.1259" class="difflineminus">-    WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Settings&quot; NumFields &quot;$0&quot;</span>
<a href="#l3.1260"></a><span id="l3.1260" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.1261"></a><span id="l3.1261" class="difflineminus">-</span>
<a href="#l3.1262"></a><span id="l3.1262">   !insertmacro MUI_HEADER_TEXT &quot;$(SUMMARY_PAGE_TITLE)&quot; &quot;$(SUMMARY_PAGE_SUBTITLE)&quot;</span>
<a href="#l3.1263"></a><span id="l3.1263"> </span>
<a href="#l3.1264"></a><span id="l3.1264">   ; The Summary custom page has a textbox that will automatically receive</span>
<a href="#l3.1265"></a><span id="l3.1265">   ; focus. This sets the focus to the Install button instead.</span>
<a href="#l3.1266"></a><span id="l3.1266">   !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;summary.ini&quot;</span>
<a href="#l3.1267"></a><span id="l3.1267">   GetDlgItem $0 $HWNDPARENT 1</span>
<a href="#l3.1268"></a><span id="l3.1268">   System::Call &quot;user32::SetFocus(i r0, i 0x0007, i,i)i&quot;</span>
<a href="#l3.1269"></a><span id="l3.1269" class="difflineminus">-</span>
<a href="#l3.1270"></a><span id="l3.1270">   ${MUI_INSTALLOPTIONS_READ} $1 &quot;summary.ini&quot; &quot;Field 2&quot; &quot;HWND&quot;                  </span>
<a href="#l3.1271"></a><span id="l3.1271">   SendMessage $1 ${WM_SETTEXT} 0 &quot;STR:$INSTDIR&quot;      </span>
<a href="#l3.1272"></a><span id="l3.1272">   !insertmacro MUI_INSTALLOPTIONS_SHOW</span>
<a href="#l3.1273"></a><span id="l3.1273"> FunctionEnd</span>
<a href="#l3.1274"></a><span id="l3.1274"> </span>
<a href="#l3.1275"></a><span id="l3.1275" class="difflineminus">-Function leaveInstFiles</span>
<a href="#l3.1276"></a><span id="l3.1276" class="difflineminus">-  FileClose $fhUninstallLog</span>
<a href="#l3.1277"></a><span id="l3.1277" class="difflineminus">-  ; Diff and add missing entries from the previous file log if it exists</span>
<a href="#l3.1278"></a><span id="l3.1278" class="difflineminus">-  ${If} ${FileExists} &quot;$INSTDIR\uninstall\uninstall.bak&quot;</span>
<a href="#l3.1279"></a><span id="l3.1279" class="difflineminus">-    SetDetailsPrint textonly</span>
<a href="#l3.1280"></a><span id="l3.1280" class="difflineminus">-    DetailPrint $(STATUS_CLEANUP)</span>
<a href="#l3.1281"></a><span id="l3.1281" class="difflineminus">-    SetDetailsPrint none</span>
<a href="#l3.1282"></a><span id="l3.1282" class="difflineminus">-    ${LogHeader} &quot;Updating Uninstall Log With Previous Uninstall Log&quot;</span>
<a href="#l3.1283"></a><span id="l3.1283" class="difflineminus">-    StrCpy $R0 &quot;$INSTDIR\uninstall\uninstall.log&quot;</span>
<a href="#l3.1284"></a><span id="l3.1284" class="difflineminus">-    StrCpy $R1 &quot;$INSTDIR\uninstall\uninstall.bak&quot;</span>
<a href="#l3.1285"></a><span id="l3.1285" class="difflineminus">-    GetTempFileName $R2</span>
<a href="#l3.1286"></a><span id="l3.1286" class="difflineminus">-    FileOpen $R3 $R2 w</span>
<a href="#l3.1287"></a><span id="l3.1287" class="difflineminus">-    ${TextCompareNoDetails} &quot;$R1&quot; &quot;$R0&quot; &quot;SlowDiff&quot; &quot;GetDiff&quot;</span>
<a href="#l3.1288"></a><span id="l3.1288" class="difflineminus">-    FileClose $R3</span>
<a href="#l3.1289"></a><span id="l3.1289" class="difflineminus">-    ${Unless} ${Errors}</span>
<a href="#l3.1290"></a><span id="l3.1290" class="difflineminus">-      ${FileJoin} &quot;$INSTDIR\uninstall\uninstall.log&quot; &quot;$R2&quot; &quot;$INSTDIR\uninstall\uninstall.log&quot;</span>
<a href="#l3.1291"></a><span id="l3.1291" class="difflineminus">-    ${EndUnless}</span>
<a href="#l3.1292"></a><span id="l3.1292" class="difflineminus">-    ${DeleteFile} &quot;$INSTDIR\uninstall\uninstall.bak&quot;</span>
<a href="#l3.1293"></a><span id="l3.1293" class="difflineminus">-    ${DeleteFile} &quot;$R2&quot;</span>
<a href="#l3.1294"></a><span id="l3.1294" class="difflineplus">+Function leaveSummary</span>
<a href="#l3.1295"></a><span id="l3.1295" class="difflineplus">+  ${If} $InstallType != ${INSTALLTYPE_CUSTOM}</span>
<a href="#l3.1296"></a><span id="l3.1296" class="difflineplus">+    ; Set DOM Inspector, Venkman, ChatZilla to be installed</span>
<a href="#l3.1297"></a><span id="l3.1297" class="difflineplus">+    SectionSetFlags ${DOMI_IDX} 1</span>
<a href="#l3.1298"></a><span id="l3.1298" class="difflineplus">+    SectionSetFlags ${VENKMAN_IDX} 1</span>
<a href="#l3.1299"></a><span id="l3.1299" class="difflineplus">+    SectionSetFlags ${CZ_IDX} 1</span>
<a href="#l3.1300"></a><span id="l3.1300">   ${EndIf}</span>
<a href="#l3.1301"></a><span id="l3.1301" class="difflineminus">-</span>
<a href="#l3.1302"></a><span id="l3.1302" class="difflineminus">-  Call WriteLogSeparator</span>
<a href="#l3.1303"></a><span id="l3.1303" class="difflineminus">-  ${GetTime} &quot;&quot; &quot;L&quot; $0 $1 $2 $3 $4 $5 $6</span>
<a href="#l3.1304"></a><span id="l3.1304" class="difflineminus">-  FileWrite $fhInstallLog &quot;${BrandFullName} Installation Finished: $2-$1-$0 $4:$5:$6$\r$\n&quot;</span>
<a href="#l3.1305"></a><span id="l3.1305" class="difflineminus">-  FileClose $fhInstallLog</span>
<a href="#l3.1306"></a><span id="l3.1306" class="difflineplus">+  ; Try to delete the app executable and if we can't delete it try to find the</span>
<a href="#l3.1307"></a><span id="l3.1307" class="difflineplus">+  ; app's message window and prompt the user to close the app. This allows</span>
<a href="#l3.1308"></a><span id="l3.1308" class="difflineplus">+  ; running an instance that is located in another directory. If for whatever</span>
<a href="#l3.1309"></a><span id="l3.1309" class="difflineplus">+  ; reason there is no message window we will just rename the app's files and</span>
<a href="#l3.1310"></a><span id="l3.1310" class="difflineplus">+  ; then remove them on restart.</span>
<a href="#l3.1311"></a><span id="l3.1311" class="difflineplus">+  ClearErrors</span>
<a href="#l3.1312"></a><span id="l3.1312" class="difflineplus">+  ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.1313"></a><span id="l3.1313" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l3.1314"></a><span id="l3.1314" class="difflineplus">+    ${ManualCloseAppPrompt} &quot;${WindowClass}&quot; &quot;$(WARN_MANUALLY_CLOSE_APP_INSTALL)&quot;</span>
<a href="#l3.1315"></a><span id="l3.1315" class="difflineplus">+  ${EndIf}</span>
<a href="#l3.1316"></a><span id="l3.1316"> FunctionEnd</span>
<a href="#l3.1317"></a><span id="l3.1317"> </span>
<a href="#l3.1318"></a><span id="l3.1318"> ; When we add an optional action to the finish page the cancel button is</span>
<a href="#l3.1319"></a><span id="l3.1319"> ; enabled. This disables it and leaves the finish button as the only choice.</span>
<a href="#l3.1320"></a><span id="l3.1320"> Function preFinish</span>
<a href="#l3.1321"></a><span id="l3.1321" class="difflineplus">+  ${EndInstallLog} &quot;${BrandFullName}&quot;</span>
<a href="#l3.1322"></a><span id="l3.1322">   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;settings&quot; &quot;cancelenabled&quot; &quot;0&quot;</span>
<a href="#l3.1323"></a><span id="l3.1323"> FunctionEnd</span>
<a href="#l3.1324"></a><span id="l3.1324"> </span>
<a href="#l3.1325"></a><span id="l3.1325"> ################################################################################</span>
<a href="#l3.1326"></a><span id="l3.1326"> # Initialization Functions</span>
<a href="#l3.1327"></a><span id="l3.1327"> </span>
<a href="#l3.1328"></a><span id="l3.1328"> Function .onInit</span>
<a href="#l3.1329"></a><span id="l3.1329" class="difflineminus">-  ${GetParameters} $R0</span>
<a href="#l3.1330"></a><span id="l3.1330" class="difflineminus">-  ${If} $R0 != &quot;&quot;</span>
<a href="#l3.1331"></a><span id="l3.1331" class="difflineminus">-    ClearErrors</span>
<a href="#l3.1332"></a><span id="l3.1332" class="difflineminus">-    ${GetOptions} &quot;$R0&quot; &quot;-ms&quot; $R1</span>
<a href="#l3.1333"></a><span id="l3.1333" class="difflineminus">-    ${If} ${Errors}</span>
<a href="#l3.1334"></a><span id="l3.1334" class="difflineminus">-      ; Default install type</span>
<a href="#l3.1335"></a><span id="l3.1335" class="difflineminus">-      StrCpy $InstallType &quot;1&quot;</span>
<a href="#l3.1336"></a><span id="l3.1336" class="difflineminus">-      ; Support for specifying an installation configuration file.</span>
<a href="#l3.1337"></a><span id="l3.1337" class="difflineminus">-      ClearErrors</span>
<a href="#l3.1338"></a><span id="l3.1338" class="difflineminus">-      ${GetOptions} &quot;$R0&quot; &quot;/INI=&quot; $R1</span>
<a href="#l3.1339"></a><span id="l3.1339" class="difflineminus">-      ${Unless} ${Errors}</span>
<a href="#l3.1340"></a><span id="l3.1340" class="difflineminus">-        ; The configuration file must also exist</span>
<a href="#l3.1341"></a><span id="l3.1341" class="difflineminus">-        ${If} ${FileExists} &quot;$R1&quot;</span>
<a href="#l3.1342"></a><span id="l3.1342" class="difflineminus">-          SetSilent silent</span>
<a href="#l3.1343"></a><span id="l3.1343" class="difflineminus">-          ReadINIStr $0 $R1 &quot;Install&quot; &quot;InstallDirectoryName&quot;</span>
<a href="#l3.1344"></a><span id="l3.1344" class="difflineminus">-          ${If} $0 != &quot;&quot;</span>
<a href="#l3.1345"></a><span id="l3.1345" class="difflineminus">-            StrCpy $INSTDIR &quot;$PROGRAMFILES\$0&quot;</span>
<a href="#l3.1346"></a><span id="l3.1346" class="difflineminus">-          ${Else}</span>
<a href="#l3.1347"></a><span id="l3.1347" class="difflineminus">-            ReadINIStr $0 $R1 &quot;Install&quot; &quot;InstallDirectoryPath&quot;</span>
<a href="#l3.1348"></a><span id="l3.1348" class="difflineminus">-            ${If} $$0 != &quot;&quot;</span>
<a href="#l3.1349"></a><span id="l3.1349" class="difflineminus">-              StrCpy $INSTDIR &quot;$0&quot;</span>
<a href="#l3.1350"></a><span id="l3.1350" class="difflineminus">-            ${EndIf}</span>
<a href="#l3.1351"></a><span id="l3.1351" class="difflineminus">-          ${EndIf}</span>
<a href="#l3.1352"></a><span id="l3.1352" class="difflineminus">-</span>
<a href="#l3.1353"></a><span id="l3.1353" class="difflineminus">-          ${If} $INSTDIR == &quot;&quot;</span>
<a href="#l3.1354"></a><span id="l3.1354" class="difflineminus">-            ; Check if there is an existing uninstall registry entry for this</span>
<a href="#l3.1355"></a><span id="l3.1355" class="difflineminus">-            ; version of the application and if present install into that location</span>
<a href="#l3.1356"></a><span id="l3.1356" class="difflineminus">-            ReadRegStr $0 HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${BrandFullNameInternal} (${AppVersion})&quot; &quot;InstallLocation&quot;</span>
<a href="#l3.1357"></a><span id="l3.1357" class="difflineminus">-            ${If} $0 == &quot;&quot;</span>
<a href="#l3.1358"></a><span id="l3.1358" class="difflineminus">-              StrCpy $INSTDIR &quot;$PROGRAMFILES\${BrandFullName}&quot;</span>
<a href="#l3.1359"></a><span id="l3.1359" class="difflineminus">-            ${Else}</span>
<a href="#l3.1360"></a><span id="l3.1360" class="difflineminus">-              GetFullPathName $INSTDIR &quot;$0&quot;</span>
<a href="#l3.1361"></a><span id="l3.1361" class="difflineminus">-              ${Unless} ${FileExists} &quot;$INSTDIR&quot;</span>
<a href="#l3.1362"></a><span id="l3.1362" class="difflineminus">-                StrCpy $INSTDIR &quot;$PROGRAMFILES\${BrandFullName}&quot;</span>
<a href="#l3.1363"></a><span id="l3.1363" class="difflineminus">-              ${EndUnless}</span>
<a href="#l3.1364"></a><span id="l3.1364" class="difflineminus">-            ${EndIf}</span>
<a href="#l3.1365"></a><span id="l3.1365" class="difflineminus">-          ${EndIf}</span>
<a href="#l3.1366"></a><span id="l3.1366" class="difflineminus">-</span>
<a href="#l3.1367"></a><span id="l3.1367" class="difflineminus">-          ; Quit if we are unable to create the installation directory or we are</span>
<a href="#l3.1368"></a><span id="l3.1368" class="difflineminus">-          ; unable to write to a file in the installation directory.</span>
<a href="#l3.1369"></a><span id="l3.1369" class="difflineminus">-          ClearErrors</span>
<a href="#l3.1370"></a><span id="l3.1370" class="difflineminus">-          ${If} ${FileExists} &quot;$INSTDIR&quot;</span>
<a href="#l3.1371"></a><span id="l3.1371" class="difflineminus">-            GetTempFileName $R2 &quot;$INSTDIR&quot;</span>
<a href="#l3.1372"></a><span id="l3.1372" class="difflineminus">-            FileOpen $R3 $R2 w</span>
<a href="#l3.1373"></a><span id="l3.1373" class="difflineminus">-            FileWrite $R3 &quot;Write Access Test&quot;</span>
<a href="#l3.1374"></a><span id="l3.1374" class="difflineminus">-            FileClose $R3</span>
<a href="#l3.1375"></a><span id="l3.1375" class="difflineminus">-            Delete $R2</span>
<a href="#l3.1376"></a><span id="l3.1376" class="difflineminus">-            ${If} ${Errors}</span>
<a href="#l3.1377"></a><span id="l3.1377" class="difflineminus">-              Quit</span>
<a href="#l3.1378"></a><span id="l3.1378" class="difflineminus">-            ${EndIf}</span>
<a href="#l3.1379"></a><span id="l3.1379" class="difflineminus">-          ${Else}</span>
<a href="#l3.1380"></a><span id="l3.1380" class="difflineminus">-            CreateDirectory &quot;$INSTDIR&quot;</span>
<a href="#l3.1381"></a><span id="l3.1381" class="difflineminus">-            ${If} ${Errors}</span>
<a href="#l3.1382"></a><span id="l3.1382" class="difflineminus">-              Quit</span>
<a href="#l3.1383"></a><span id="l3.1383" class="difflineminus">-            ${EndIf}</span>
<a href="#l3.1384"></a><span id="l3.1384" class="difflineminus">-          ${EndIf}</span>
<a href="#l3.1385"></a><span id="l3.1385" class="difflineplus">+  ${InstallOnInitCommon} &quot;$(WARN_UNSUPPORTED_MSG)&quot;</span>
<a href="#l3.1386"></a><span id="l3.1386"> </span>
<a href="#l3.1387"></a><span id="l3.1387" class="difflineminus">-          ReadINIStr $0 $R1 &quot;Install&quot; &quot;CloseAppNoPrompt&quot;</span>
<a href="#l3.1388"></a><span id="l3.1388" class="difflineminus">-          ${If} $0 == &quot;true&quot;</span>
<a href="#l3.1389"></a><span id="l3.1389" class="difflineminus">-            ; Try to close the app if the exe is in use.</span>
<a href="#l3.1390"></a><span id="l3.1390" class="difflineminus">-            ClearErrors</span>
<a href="#l3.1391"></a><span id="l3.1391" class="difflineminus">-            ${If} ${FileExists} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.1392"></a><span id="l3.1392" class="difflineminus">-              ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.1393"></a><span id="l3.1393" class="difflineminus">-            ${EndIf}</span>
<a href="#l3.1394"></a><span id="l3.1394" class="difflineminus">-            ${If} ${Errors}</span>
<a href="#l3.1395"></a><span id="l3.1395" class="difflineminus">-              ClearErrors</span>
<a href="#l3.1396"></a><span id="l3.1396" class="difflineminus">-              ${CloseApp} &quot;false&quot; &quot;&quot;</span>
<a href="#l3.1397"></a><span id="l3.1397" class="difflineminus">-              ClearErrors</span>
<a href="#l3.1398"></a><span id="l3.1398" class="difflineminus">-              ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.1399"></a><span id="l3.1399" class="difflineminus">-              ; If unsuccessful try one more time and if it still fails Quit</span>
<a href="#l3.1400"></a><span id="l3.1400" class="difflineminus">-              ${If} ${Errors}</span>
<a href="#l3.1401"></a><span id="l3.1401" class="difflineminus">-                ClearErrors</span>
<a href="#l3.1402"></a><span id="l3.1402" class="difflineminus">-                ${CloseApp} &quot;false&quot; &quot;&quot;</span>
<a href="#l3.1403"></a><span id="l3.1403" class="difflineminus">-                ClearErrors</span>
<a href="#l3.1404"></a><span id="l3.1404" class="difflineminus">-                ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l3.1405"></a><span id="l3.1405" class="difflineminus">-                ${If} ${Errors}</span>
<a href="#l3.1406"></a><span id="l3.1406" class="difflineminus">-                  Quit</span>
<a href="#l3.1407"></a><span id="l3.1407" class="difflineminus">-                ${EndIf}</span>
<a href="#l3.1408"></a><span id="l3.1408" class="difflineminus">-              ${EndIf}</span>
<a href="#l3.1409"></a><span id="l3.1409" class="difflineminus">-            ${EndIf}</span>
<a href="#l3.1410"></a><span id="l3.1410" class="difflineminus">-          ${EndIf}</span>
<a href="#l3.1411"></a><span id="l3.1411" class="difflineminus">-</span>
<a href="#l3.1412"></a><span id="l3.1412" class="difflineminus">-          ReadINIStr $0 $R1 &quot;Install&quot; &quot;QuickLaunchShortcut&quot;</span>
<a href="#l3.1413"></a><span id="l3.1413" class="difflineminus">-          ${If} $0 == &quot;false&quot;</span>
<a href="#l3.1414"></a><span id="l3.1414" class="difflineminus">-            StrCpy $AddQuickLaunchSC &quot;0&quot;</span>
<a href="#l3.1415"></a><span id="l3.1415" class="difflineminus">-          ${Else}</span>
<a href="#l3.1416"></a><span id="l3.1416" class="difflineminus">-            StrCpy $AddQuickLaunchSC &quot;1&quot;</span>
<a href="#l3.1417"></a><span id="l3.1417" class="difflineminus">-          ${EndIf}</span>
<a href="#l3.1418"></a><span id="l3.1418" class="difflineminus">-</span>
<a href="#l3.1419"></a><span id="l3.1419" class="difflineminus">-          ReadINIStr $0 $R1 &quot;Install&quot; &quot;DesktopShortcut&quot;</span>
<a href="#l3.1420"></a><span id="l3.1420" class="difflineminus">-          ${If} $0 == &quot;false&quot;</span>
<a href="#l3.1421"></a><span id="l3.1421" class="difflineminus">-            StrCpy $AddDesktopSC &quot;0&quot;</span>
<a href="#l3.1422"></a><span id="l3.1422" class="difflineminus">-          ${Else}</span>
<a href="#l3.1423"></a><span id="l3.1423" class="difflineminus">-            StrCpy $AddDesktopSC &quot;1&quot;</span>
<a href="#l3.1424"></a><span id="l3.1424" class="difflineminus">-          ${EndIf}</span>
<a href="#l3.1425"></a><span id="l3.1425" class="difflineminus">-</span>
<a href="#l3.1426"></a><span id="l3.1426" class="difflineminus">-          ReadINIStr $0 $R1 &quot;Install&quot; &quot;StartMenuShortcuts&quot;</span>
<a href="#l3.1427"></a><span id="l3.1427" class="difflineminus">-          ${If} $0 == &quot;false&quot;</span>
<a href="#l3.1428"></a><span id="l3.1428" class="difflineminus">-            StrCpy $AddStartMenuSC &quot;0&quot;</span>
<a href="#l3.1429"></a><span id="l3.1429" class="difflineminus">-          ${Else}</span>
<a href="#l3.1430"></a><span id="l3.1430" class="difflineminus">-            StrCpy $AddStartMenuSC &quot;1&quot;</span>
<a href="#l3.1431"></a><span id="l3.1431" class="difflineminus">-          ${EndIf}</span>
<a href="#l3.1432"></a><span id="l3.1432" class="difflineminus">-</span>
<a href="#l3.1433"></a><span id="l3.1433" class="difflineminus">-          ReadINIStr $0 $R1 &quot;Install&quot; &quot;StartMenuDirectoryName&quot;</span>
<a href="#l3.1434"></a><span id="l3.1434" class="difflineminus">-          ${If} $0 != &quot;&quot;</span>
<a href="#l3.1435"></a><span id="l3.1435" class="difflineminus">-            StrCpy $StartMenuDir &quot;$0&quot;</span>
<a href="#l3.1436"></a><span id="l3.1436" class="difflineminus">-          ${EndIf}</span>
<a href="#l3.1437"></a><span id="l3.1437" class="difflineminus">-        ${EndIf}</span>
<a href="#l3.1438"></a><span id="l3.1438" class="difflineminus">-      ${EndUnless}</span>
<a href="#l3.1439"></a><span id="l3.1439" class="difflineminus">-    ${Else}</span>
<a href="#l3.1440"></a><span id="l3.1440" class="difflineminus">-      ; Support for the deprecated -ms command line argument. The new command</span>
<a href="#l3.1441"></a><span id="l3.1441" class="difflineminus">-      ; line arguments are not supported when -ms is used.</span>
<a href="#l3.1442"></a><span id="l3.1442" class="difflineminus">-      SetSilent silent</span>
<a href="#l3.1443"></a><span id="l3.1443" class="difflineminus">-    ${EndIf}</span>
<a href="#l3.1444"></a><span id="l3.1444" class="difflineminus">-  ${EndIf}</span>
<a href="#l3.1445"></a><span id="l3.1445" class="difflineminus">-  ClearErrors</span>
<a href="#l3.1446"></a><span id="l3.1446" class="difflineminus">-</span>
<a href="#l3.1447"></a><span id="l3.1447" class="difflineminus">-  StrCpy $LANGUAGE 0</span>
<a href="#l3.1448"></a><span id="l3.1448">   !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;options.ini&quot;</span>
<a href="#l3.1449"></a><span id="l3.1449">   !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;components.ini&quot;</span>
<a href="#l3.1450"></a><span id="l3.1450">   !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;shortcuts.ini&quot;</span>
<a href="#l3.1451"></a><span id="l3.1451">   !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;summary.ini&quot;</span>
<a href="#l3.1452"></a><span id="l3.1452"> </span>
<a href="#l3.1453"></a><span id="l3.1453">   ; Setup the options.ini file for the Custom Options Page</span>
<a href="#l3.1454"></a><span id="l3.1454">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Settings&quot; NumFields &quot;5&quot;</span>
<a href="#l3.1455"></a><span id="l3.1455"> </span>
<a href="#l3.1456"></a><span id="l3.1456" class="difflineat">@@ -1368,15 +1030,25 @@ Function .onInit</span>
<a href="#l3.1457"></a><span id="l3.1457">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Type   &quot;checkbox&quot;</span>
<a href="#l3.1458"></a><span id="l3.1458">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Text   &quot;$(ICONS_QUICKLAUNCH)&quot;</span>
<a href="#l3.1459"></a><span id="l3.1459">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Left   &quot;15&quot;</span>
<a href="#l3.1460"></a><span id="l3.1460">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Right  &quot;-1&quot;</span>
<a href="#l3.1461"></a><span id="l3.1461">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Top    &quot;60&quot;</span>
<a href="#l3.1462"></a><span id="l3.1462">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Bottom &quot;70&quot;</span>
<a href="#l3.1463"></a><span id="l3.1463">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; State  &quot;1&quot;</span>
<a href="#l3.1464"></a><span id="l3.1464"> </span>
<a href="#l3.1465"></a><span id="l3.1465" class="difflineplus">+  StrCpy $LANGUAGE 0</span>
<a href="#l3.1466"></a><span id="l3.1466" class="difflineplus">+</span>
<a href="#l3.1467"></a><span id="l3.1467">   ; There must always be nonlocalized and localized directories.</span>
<a href="#l3.1468"></a><span id="l3.1468" class="difflineminus">-  ${GetSize} &quot;$EXEDIR\nonlocalized\&quot; &quot;/S=0K&quot; $1 $8 $9</span>
<a href="#l3.1469"></a><span id="l3.1469" class="difflineminus">-  ${GetSize} &quot;$EXEDIR\localized\&quot; &quot;/S=0K&quot; $2 $8 $9</span>
<a href="#l3.1470"></a><span id="l3.1470" class="difflineminus">-  IntOp $0 $1 + $2</span>
<a href="#l3.1471"></a><span id="l3.1471" class="difflineminus">-  SectionSetSize 0 $0</span>
<a href="#l3.1472"></a><span id="l3.1472" class="difflineplus">+  ${GetSize} &quot;$EXEDIR\nonlocalized\&quot; &quot;/S=0K&quot; $R5 $R7 $R8</span>
<a href="#l3.1473"></a><span id="l3.1473" class="difflineplus">+  ${GetSize} &quot;$EXEDIR\localized\&quot; &quot;/S=0K&quot; $R6 $R7 $R8</span>
<a href="#l3.1474"></a><span id="l3.1474" class="difflineplus">+  IntOp $R8 $R5 + $R6</span>
<a href="#l3.1475"></a><span id="l3.1475" class="difflineplus">+  SectionSetSize ${APP_IDX} $R8</span>
<a href="#l3.1476"></a><span id="l3.1476"> </span>
<a href="#l3.1477"></a><span id="l3.1477" class="difflineplus">+  ; Initialize $hHeaderBitmap to prevent redundant changing of the bitmap if</span>
<a href="#l3.1478"></a><span id="l3.1478" class="difflineplus">+  ; the user clicks the back button</span>
<a href="#l3.1479"></a><span id="l3.1479" class="difflineplus">+  StrCpy $hHeaderBitmap &quot;&quot;</span>
<a href="#l3.1480"></a><span id="l3.1480"> FunctionEnd</span>
<a href="#l3.1481"></a><span id="l3.1481" class="difflineplus">+</span>
<a href="#l3.1482"></a><span id="l3.1482" class="difflineplus">+Function .onGUIEnd</span>
<a href="#l3.1483"></a><span id="l3.1483" class="difflineplus">+  ${OnEndCommon}</span>
<a href="#l3.1484"></a><span id="l3.1484" class="difflineplus">+FunctionEnd</span>
<a href="#l3.1485"></a><span id="l3.1485" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/installer/windows/nsis/shared.nsh</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/installer/windows/nsis/shared.nsh</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -31,86 +31,241 @@</span>
<a href="#l4.4"></a><span id="l4.4"> # decision by deleting the provisions above and replace them with the notice</span>
<a href="#l4.5"></a><span id="l4.5"> # and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l4.6"></a><span id="l4.6"> # the provisions above, a recipient may use your version of this file under</span>
<a href="#l4.7"></a><span id="l4.7"> # the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l4.8"></a><span id="l4.8"> #</span>
<a href="#l4.9"></a><span id="l4.9"> # ***** END LICENSE BLOCK *****</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11"> !macro PostUpdate</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  SetShellVarContext all</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  ${SetStartMenuInternet}</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-  ${SetClientsMail}</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-</span>
<a href="#l4.16"></a><span id="l4.16">   ; Remove registry entries for non-existent apps and for apps that point to our</span>
<a href="#l4.17"></a><span id="l4.17">   ; install location in the Software\Mozilla key and uninstall registry entries</span>
<a href="#l4.18"></a><span id="l4.18">   ; that point to our install location for both HKCU and HKLM.</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-  SetShellVarContext current  ; Set SHCTX to HKCU</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+  SetShellVarContext current  ; Set SHCTX to the current user (e.g. HKCU) </span>
<a href="#l4.21"></a><span id="l4.21">   ${RegCleanMain} &quot;Software\Mozilla&quot;</span>
<a href="#l4.22"></a><span id="l4.22">   ${RegCleanUninstall}</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+  ${UpdateProtocolHandlers}</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-  SetShellVarContext all  ; Set SHCTX to HKLM</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-  ${RegCleanMain} &quot;Software\Mozilla&quot;</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-  ${RegCleanUninstall}</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+  ClearErrors</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+  WriteRegStr HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot; &quot;Write Test&quot;</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+    StrCpy $TmpVal &quot;HKCU&quot; ; used primarily for logging</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  ${Else}</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+    DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+    SetShellVarContext all ; Set SHCTX to all users (e.g. HKLM)</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+    StrCpy $TmpVal &quot;HKLM&quot; ; used primarily for logging</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+    ${RegCleanMain} &quot;Software\Mozilla&quot;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+    ${RegCleanUninstall}</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+    ${SetStartMenuInternet}</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+    ${FixShellIconHandler}</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+    ${SetUninstallKeys}</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+    ${UpdateProtocolHandlers}</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+    ReadRegStr $0 HKLM &quot;Software\mozilla.org\Mozilla&quot; &quot;CurrentVersion&quot;</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+    ${If} &quot;$0&quot; != &quot;${GREVersion}&quot;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+      WriteRegStr HKLM &quot;Software\mozilla.org\Mozilla&quot; &quot;CurrentVersion&quot; &quot;${GREVersion}&quot;</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+    ; Only update the Clients\Mail registry key values if they don't exist or</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+    ; this installation is the same as the one set in those keys.</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+    ReadRegStr $0 HKLM &quot;Software\Clients\Mail\${BrandFullNameInternal}\DefaultIcon&quot; &quot;&quot;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+    ${GetPathFromString} &quot;$0&quot; $0</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+    ${GetParent} &quot;$0&quot; $0</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+    ${If} ${FileExists} &quot;$0&quot;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+      ${GetLongPath} &quot;$0&quot; $0</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+    ${If} &quot;$0&quot; == &quot;$INSTDIR&quot;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+      ${SetClientsMail}</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+    ; Only update the Clients\News registry key values if they don't exist or</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+    ; this installation is the same as the one set in those keys.</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+    ReadRegStr $0 HKLM &quot;Software\Clients\News\${BrandFullNameInternal}\DefaultIcon&quot; &quot;&quot;</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+    ${GetPathFromString} &quot;$0&quot; $0</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+    ${GetParent} &quot;$0&quot; $0</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+    ${If} ${FileExists} &quot;$0&quot;</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+      ${GetLongPath} &quot;$0&quot; $0</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+    ${If} &quot;$0&quot; == &quot;$INSTDIR&quot;</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+      ${SetClientsNews}</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.72"></a><span id="l4.72"> </span>
<a href="#l4.73"></a><span id="l4.73">   ; Add Software\Mozilla\ registry entries</span>
<a href="#l4.74"></a><span id="l4.74">   ${SetAppKeys}</span>
<a href="#l4.75"></a><span id="l4.75"> </span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-  ${SetUninstallKeys}</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+  ${FixClassKeys}</span>
<a href="#l4.78"></a><span id="l4.78"> </span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-  ${FixClassKeys}</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+  ; Remove files that may be left behind by the application in the</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+  ; VirtualStore directory.</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+  ${CleanVirtualStore}</span>
<a href="#l4.83"></a><span id="l4.83"> !macroend</span>
<a href="#l4.84"></a><span id="l4.84"> !define PostUpdate &quot;!insertmacro PostUpdate&quot;</span>
<a href="#l4.85"></a><span id="l4.85"> </span>
<a href="#l4.86"></a><span id="l4.86"> !macro SetAsDefaultAppUser</span>
<a href="#l4.87"></a><span id="l4.87">   SetShellVarContext current</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-  ${SetHandlers}</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+  ; It is only possible to set this installation of the application as the</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+  ; handler for the various types if those types were added to the respective</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+  ; HKLM\Clients registry keys.</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+  ; http://support.microsoft.com/kb/297878</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+  ${GetParameters} $R0</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+  ClearErrors</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineplus">+  ${GetOptions} &quot;$R0&quot; &quot;Browser&quot; $R1</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+  ${Unless} ${Errors}</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+    ${StrFilter} &quot;${FileMainEXE}&quot; &quot;+&quot; &quot;&quot; &quot;&quot; $R9</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+    ClearErrors</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+    ReadRegStr $0 HKLM &quot;Software\Clients\StartMenuInternet\$R9\DefaultIcon&quot; &quot;&quot;</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+    ${GetPathFromString} &quot;$0&quot; $0</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineplus">+    ${GetParent} &quot;$0&quot; $0</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineplus">+    ${If} ${FileExists} &quot;$0&quot;</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+      ${GetLongPath} &quot;$0&quot; $0</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+    ${If} &quot;$0&quot; != &quot;$INSTDIR&quot;</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+      DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+      ClearErrors</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+      WriteRegStr HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot; &quot;Write Test&quot;</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+      ${If} ${Errors}</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+        ; Prevent multiple elevation requests</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+        ClearErrors</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+        ${GetOptions} &quot;$R0&quot; &quot;/UAC:&quot; $R1</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineplus">+        ${Unless} ${Errors}</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineplus">+          Quit</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+        ${EndUnless}</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+        ${ElevateUAC}</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineplus">+      ${EndIf}</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+      DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+      ${SetStartMenuInternet}</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineplus">+    SetShellVarContext all  ; Set SHCTX to all users (e.g. HKLM)</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineplus">+    ${FixShellIconHandler}</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineplus">+    WriteRegStr HKCU &quot;Software\Clients\StartMenuInternet&quot; &quot;&quot; &quot;$R9&quot;</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+    ${If} ${AtLeastWinVista}</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineplus">+      ClearErrors</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineplus">+      ReadRegStr $0 HKLM &quot;Software\RegisteredApplications&quot; &quot;${AppRegName}&quot;</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+      ; Only register as the handler on Vista if the app registry name exists</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineplus">+      ; under the RegisteredApplications registry key.</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+      ${Unless} ${Errors}</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineplus">+        AppAssocReg::SetAppAsDefaultAll &quot;${AppRegName}&quot;</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineplus">+      ${EndUnless}</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+    SetShellVarContext current  ; Set SHCTX to the current user (e.g. HKCU)</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineplus">+    ${SetHandlersBrowser}</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+  ${EndUnless} </span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineplus">+  ClearErrors</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineplus">+  ${GetOptions} &quot;$R0&quot; &quot;Mail&quot; $R1</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineplus">+  ${Unless} ${Errors}</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineplus">+    ReadRegStr $0 HKLM &quot;Software\Clients\Mail\${BrandFullNameInternal}\DefaultIcon&quot; &quot;&quot;</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineplus">+    ${GetPathFromString} &quot;$0&quot; $0</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+    ${GetParent} &quot;$0&quot; $0</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineplus">+    ${If} ${FileExists} &quot;$0&quot;</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineplus">+      ${GetLongPath} &quot;$0&quot; $0</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineplus">+    ${If} &quot;$0&quot; != &quot;$INSTDIR&quot;</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineplus">+      DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineplus">+      ClearErrors</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineplus">+      WriteRegStr HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot; &quot;Write Test&quot;</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineplus">+      ${If} ${Errors}</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineplus">+        ; Prevent multiple elevation requests</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineplus">+        ClearErrors</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineplus">+        ${GetOptions} &quot;$R0&quot; &quot;/UAC:&quot; $R1</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineplus">+        ${Unless} ${Errors}</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineplus">+          Quit</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+        ${EndUnless}</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineplus">+        ${ElevateUAC}</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineplus">+      ${EndIf}</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineplus">+      DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineplus">+      SetShellVarContext all     ; Set SHCTX to all users (e.g. HKLM)</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineplus">+      ${SetClientsMail}</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineplus">+    GetFunctionAddress $0 SetAsDefaultMailAppUser</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineplus">+    UAC::ExecCodeSegment $0</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineplus">+  ${EndUnless}</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineplus">+</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineplus">+  ClearErrors</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineplus">+  ${GetOptions} &quot;$R0&quot; &quot;News&quot; $R1</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineplus">+  ${Unless} ${Errors}</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineplus">+    ReadRegStr $0 HKLM &quot;Software\Clients\News\${BrandFullNameInternal}\DefaultIcon&quot; &quot;&quot;</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineplus">+    ${GetPathFromString} &quot;$0&quot; $0</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineplus">+    ${GetParent} &quot;$0&quot; $0</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+    ${If} ${FileExists} &quot;$0&quot;</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineplus">+      ${GetLongPath} &quot;$0&quot; $0</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineplus">+    ${If} &quot;$0&quot; != &quot;$INSTDIR&quot;</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineplus">+      DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineplus">+      ClearErrors</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineplus">+      WriteRegStr HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot; &quot;Write Test&quot;</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+      ${If} ${Errors}</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineplus">+        ; Prevent multiple elevation requests</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineplus">+        ClearErrors</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineplus">+        ${GetOptions} &quot;$R0&quot; &quot;/UAC:&quot; $R1</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineplus">+        ${Unless} ${Errors}</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineplus">+          Quit</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineplus">+        ${EndUnless}</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineplus">+        ${ElevateUAC}</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineplus">+      ${EndIf}</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineplus">+      DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineplus">+      SetShellVarContext all     ; Set SHCTX to all users (e.g. HKLM)</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineplus">+      ${SetClientsNews}</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineplus">+    GetFunctionAddress $0 SetAsDefaultNewsAppUser</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineplus">+    UAC::ExecCodeSegment $0</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineplus">+  ${EndUnless}</span>
<a href="#l4.200"></a><span id="l4.200"> !macroend</span>
<a href="#l4.201"></a><span id="l4.201"> !define SetAsDefaultAppUser &quot;!insertmacro SetAsDefaultAppUser&quot;</span>
<a href="#l4.202"></a><span id="l4.202"> </span>
<a href="#l4.203"></a><span id="l4.203"> !macro SetAsDefaultAppGlobal</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-  SetShellVarContext all</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-  ${SetHandlers}</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineplus">+  SetShellVarContext all      ; Set SHCTX to all users (e.g. HKLM)</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineplus">+  ${SetHandlersBrowser}</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineplus">+  ${SetHandlersMail}</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineplus">+  ${SetHandlersNews}</span>
<a href="#l4.210"></a><span id="l4.210">   ${SetStartMenuInternet}</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineplus">+  ${SetClientsMail}</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineplus">+  ${SetClientsNews}</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineplus">+  ${FixShellIconHandler}</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineplus">+  ${ShowShortcuts}</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineplus">+  ${StrFilter} &quot;${FileMainEXE}&quot; &quot;+&quot; &quot;&quot; &quot;&quot; $R9</span>
<a href="#l4.216"></a><span id="l4.216">   WriteRegStr HKLM &quot;Software\Clients\StartMenuInternet&quot; &quot;&quot; &quot;$R9&quot;</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineminus">-  ${SetClientsMail}</span>
<a href="#l4.218"></a><span id="l4.218">   WriteRegStr HKLM &quot;Software\Clients\Mail&quot; &quot;&quot; &quot;${BrandFullNameInternal}&quot;</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineminus">-  ${ShowShortcuts}</span>
<a href="#l4.220"></a><span id="l4.220"> !macroend</span>
<a href="#l4.221"></a><span id="l4.221"> !define SetAsDefaultAppGlobal &quot;!insertmacro SetAsDefaultAppGlobal&quot;</span>
<a href="#l4.222"></a><span id="l4.222"> </span>
<a href="#l4.223"></a><span id="l4.223"> !macro HideShortcuts</span>
<a href="#l4.224"></a><span id="l4.224">   StrCpy $R1 &quot;Software\Clients\Mail\${BrandFullNameInternal}\InstallInfo&quot;</span>
<a href="#l4.225"></a><span id="l4.225">   WriteRegDWORD HKLM $R1 &quot;IconsVisible&quot; 0</span>
<a href="#l4.226"></a><span id="l4.226">   SetShellVarContext all  ; Set $DESKTOP to All Users</span>
<a href="#l4.227"></a><span id="l4.227">   ${Unless} ${FileExists} &quot;$DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l4.228"></a><span id="l4.228">     SetShellVarContext current  ; Set $DESKTOP to the current user's desktop</span>
<a href="#l4.229"></a><span id="l4.229">   ${EndUnless}</span>
<a href="#l4.230"></a><span id="l4.230"> </span>
<a href="#l4.231"></a><span id="l4.231">   ${If} ${FileExists} &quot;$DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l4.232"></a><span id="l4.232">     ShellLink::GetShortCutArgs &quot;$DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l4.233"></a><span id="l4.233">     Pop $0</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-    ${If} $0 == &quot;&quot;</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineplus">+    ${If} &quot;$0&quot; == &quot;&quot;</span>
<a href="#l4.236"></a><span id="l4.236">       ShellLink::GetShortCutTarget &quot;$DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l4.237"></a><span id="l4.237">       Pop $0</span>
<a href="#l4.238"></a><span id="l4.238">       ; Needs to handle short paths</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-      ${If} $0 == &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineplus">+      ${If} &quot;$0&quot; == &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.241"></a><span id="l4.241">         Delete &quot;$DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l4.242"></a><span id="l4.242">       ${EndIf}</span>
<a href="#l4.243"></a><span id="l4.243">     ${EndIf}</span>
<a href="#l4.244"></a><span id="l4.244">   ${EndIf}</span>
<a href="#l4.245"></a><span id="l4.245"> </span>
<a href="#l4.246"></a><span id="l4.246">   ${If} ${FileExists} &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l4.247"></a><span id="l4.247">     ShellLink::GetShortCutArgs &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l4.248"></a><span id="l4.248">     Pop $0</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineminus">-    ${If} $0 == &quot;&quot;</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineplus">+    ${If} &quot;$0&quot; == &quot;&quot;</span>
<a href="#l4.251"></a><span id="l4.251">       ShellLink::GetShortCutTarget &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l4.252"></a><span id="l4.252">       Pop $0</span>
<a href="#l4.253"></a><span id="l4.253">       ; Needs to handle short paths</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineminus">-      ${If} $0 == &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineplus">+      ${If} &quot;$0&quot; == &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.256"></a><span id="l4.256">         Delete &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l4.257"></a><span id="l4.257">       ${EndIf}</span>
<a href="#l4.258"></a><span id="l4.258">     ${EndIf}</span>
<a href="#l4.259"></a><span id="l4.259">   ${EndIf}</span>
<a href="#l4.260"></a><span id="l4.260"> !macroend</span>
<a href="#l4.261"></a><span id="l4.261"> !define HideShortcuts &quot;!insertmacro HideShortcuts&quot;</span>
<a href="#l4.262"></a><span id="l4.262"> </span>
<a href="#l4.263"></a><span id="l4.263"> !macro ShowShortcuts</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineat">@@ -130,66 +285,110 @@</span>
<a href="#l4.265"></a><span id="l4.265">   ${EndUnless}</span>
<a href="#l4.266"></a><span id="l4.266">   ${Unless} ${FileExists} &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l4.267"></a><span id="l4.267">     CreateShortCut &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot; &quot;$INSTDIR\${FileMainEXE}&quot; &quot;&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l4.268"></a><span id="l4.268">     ShellLink::SetShortCutWorkingDirectory &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot; &quot;$INSTDIR&quot;</span>
<a href="#l4.269"></a><span id="l4.269">   ${EndUnless}</span>
<a href="#l4.270"></a><span id="l4.270"> !macroend</span>
<a href="#l4.271"></a><span id="l4.271"> !define ShowShortcuts &quot;!insertmacro ShowShortcuts&quot;</span>
<a href="#l4.272"></a><span id="l4.272"> </span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-!macro SetHandlers</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineminus">-  GetFullPathName $8 &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineplus">+!macro SetHandlersBrowser</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\${FileMainEXE}&quot; $8</span>
<a href="#l4.277"></a><span id="l4.277"> </span>
<a href="#l4.278"></a><span id="l4.278">   StrCpy $0 &quot;SOFTWARE\Classes&quot;</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineminus">-  StrCpy $2 &quot;$\&quot;$8$\&quot; -url $\&quot;%1$\&quot; -requestPending&quot;</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineminus">-  StrCpy $2 &quot;$\&quot;$8$\&quot; -mail $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineminus">-  StrCpy $3 &quot;$\&quot;$8$\&quot; -compose $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineminus">-</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineminus">-  ; BROWSER part</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineminus">-  ; Associate the file handlers with SeaMonkeyHTML</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineminus">-  WriteRegStr SHCTX &quot;$0\.htm&quot;   &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineminus">-  WriteRegStr SHCTX &quot;$0\.html&quot;  &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineminus">-  WriteRegStr SHCTX &quot;$0\.shtml&quot; &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineminus">-  WriteRegStr SHCTX &quot;$0\.xht&quot;   &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineminus">-  WriteRegStr SHCTX &quot;$0\.xhtml&quot; &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineplus">+  StrCpy $1 &quot;$\&quot;$8$\&quot; -requestPending -osint -url $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineplus">+  StrCpy $2 &quot;$\&quot;$8$\&quot; -url $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineplus">+  StrCpy $3 &quot;$\&quot;%1$\&quot;,,0,0,,,,&quot;</span>
<a href="#l4.293"></a><span id="l4.293"> </span>
<a href="#l4.294"></a><span id="l4.294">   ; An empty string is used for the 5th param because SeaMonkeyHTML is not a</span>
<a href="#l4.295"></a><span id="l4.295">   ; protocol handler</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineminus">-  ${AddHandlerValues} &quot;$0\SeaMonkeyHTML&quot; &quot;$2&quot; &quot;$INSTDIR\chrome\icons\default\html-file.ico&quot; &quot;${AppRegName} Document&quot; &quot;&quot; &quot;true&quot;</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineminus">-</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineminus">-  ${AddHandlerValues} &quot;$0\SeaMonkeyURL&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;${AppRegName} URL&quot; &quot;true&quot; &quot;true&quot;</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineminus">-  ${AddHandlerValues} &quot;$0\gopher&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;URL:Gopher Protocol&quot; &quot;true&quot; &quot;true&quot;</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineplus">+  ${AddHandlerValues} &quot;$0\SeaMonkeyHTML&quot; &quot;$2&quot; \</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineplus">+                      &quot;$INSTDIR\chrome\icons\default\html-file.ico&quot; \</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineplus">+                      &quot;${AppRegName} Document&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineplus">+  ${AddDDEHandlerValues} &quot;SeaMonkeyURL&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;{AppRegName} URL&quot; &quot;true&quot; \</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineplus">+                         &quot;${DDEApplication}&quot; &quot;$3&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l4.305"></a><span id="l4.305"> </span>
<a href="#l4.306"></a><span id="l4.306">   ; An empty string is used for the 4th &amp; 5th params because the following</span>
<a href="#l4.307"></a><span id="l4.307">   ; protocol handlers already have a display name and additional keys required</span>
<a href="#l4.308"></a><span id="l4.308">   ; for a protocol handler.</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-  ${AddHandlerValues} &quot;$0\ftp&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;true&quot;</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-  ${AddHandlerValues} &quot;$0\http&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;true&quot;</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-  ${AddHandlerValues} &quot;$0\https&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;true&quot;</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineplus">+  ${AddDDEHandlerValues} &quot;ftp&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;${DDEApplication}&quot; &quot;$3&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineplus">+  ${AddDDEHandlerValues} &quot;http&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;${DDEApplication}&quot; &quot;$3&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineplus">+  ${AddDDEHandlerValues} &quot;https&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;${DDEApplication}&quot; &quot;$3&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineplus">+</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineplus">+  ${AddDDEHandlerValues} &quot;gopher&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;URL:Gopher Protocol&quot; &quot;true&quot; \</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineplus">+                         &quot;${DDEApplication}&quot; &quot;$3&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineplus">+</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineplus">+  ReadRegStr $6 HKCR &quot;.htm&quot; &quot;&quot;</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineplus">+  ${If} &quot;$6&quot; != &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineplus">+    WriteRegStr SHCTX &quot;$0\.htm&quot; &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineplus">+</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineplus">+  ReadRegStr $6 HKCR &quot;.html&quot; &quot;&quot;</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineplus">+  ${If} &quot;$6&quot; != &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineplus">+    WriteRegStr SHCTX &quot;$0\.html&quot; &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.328"></a><span id="l4.328"> </span>
<a href="#l4.329"></a><span id="l4.329" class="difflineminus">-  ; MAIL/NEWS part</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineminus">-  ; Associate the .eml file handler with SeaMonkeyEML</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineminus">-  WriteRegStr SHCTX &quot;$0\.eml&quot;   &quot;&quot; &quot;SeaMonkeyEML&quot;</span>
<a href="#l4.332"></a><span id="l4.332" class="difflineplus">+  ReadRegStr $6 HKCR &quot;.shtml&quot; &quot;&quot;</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineplus">+  ${If} &quot;$6&quot; != &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineplus">+    WriteRegStr SHCTX &quot;$0\.shtml&quot; &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineplus">+</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineplus">+  ReadRegStr $6 HKCR &quot;.xht&quot; &quot;&quot;</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineplus">+  ${If} &quot;$6&quot; != &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.339"></a><span id="l4.339" class="difflineplus">+     WriteRegStr SHCTX &quot;$0\.xht&quot; &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.340"></a><span id="l4.340" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineplus">+</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineplus">+  ReadRegStr $6 HKCR &quot;.xhtml&quot; &quot;&quot;</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineplus">+  ${If} &quot;$6&quot; != &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineplus">+    WriteRegStr SHCTX &quot;$0\.xhtml&quot; &quot;&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l4.345"></a><span id="l4.345" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineplus">+!macroend</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineplus">+!define SetHandlersBrowser &quot;!insertmacro SetHandlersBrowser&quot;</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineplus">+</span>
<a href="#l4.349"></a><span id="l4.349" class="difflineplus">+!macro SetHandlersMail</span>
<a href="#l4.350"></a><span id="l4.350" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\${FileMainEXE}&quot; $8</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineplus">+</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineplus">+  StrCpy $0 &quot;SOFTWARE\Classes&quot;</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineplus">+  StrCpy $1 &quot;$\&quot;$8$\&quot; $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineplus">+  StrCpy $2 &quot;$\&quot;$8$\&quot; -osint -compose $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.355"></a><span id="l4.355"> </span>
<a href="#l4.356"></a><span id="l4.356">   ; An empty string is used for the 5th param because SeaMonkeyEML is not a</span>
<a href="#l4.357"></a><span id="l4.357">   ; protocol handler</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineminus">-  ${AddHandlerValues} &quot;$0\SeaMonkeyEML&quot;  &quot;$2&quot; &quot;$INSTDIR\chrome\icons\default\misc-file.ico&quot; &quot;${AppRegNameMail} Document&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineplus">+  ${AddHandlerValues} &quot;$0\SeaMonkeyEML&quot;  &quot;$1&quot; &quot;$INSTDIR\chrome\icons\default\misc-file.ico&quot; &quot;${AppRegNameMail} Document&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineplus">+</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineplus">+  ${AddHandlerValues} &quot;$0\SeaMonkeyCOMPOSE&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;${AppRegNameMail} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineplus">+</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineplus">+  ; An empty string is used for the 4th &amp; 5th params because the following</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineplus">+  ; protocol handler already has a display name and additional keys required</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineplus">+  ; for a protocol handler.</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineplus">+  ${AddHandlerValues} &quot;$0\mailto&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;${AppRegNameMail} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.367"></a><span id="l4.367"> </span>
<a href="#l4.368"></a><span id="l4.368" class="difflineminus">-  ${AddHandlerValues} &quot;$0\SeaMonkeyCOMPOSE&quot;  &quot;$3&quot; &quot;$8,0&quot; &quot;${AppRegNameMail} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineminus">-  ${AddHandlerValues} &quot;$0\SeaMonkeyNEWS&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;${AppRegNameNews} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineplus">+  ; Associate the file handlers with SeaMonkeyEML</span>
<a href="#l4.371"></a><span id="l4.371" class="difflineplus">+  ReadRegStr $6 HKCR &quot;.eml&quot; &quot;&quot;</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineplus">+  ${If} &quot;$6&quot; != &quot;SeaMonkeyEML&quot;</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineplus">+    WriteRegStr SHCTX &quot;$0\.eml&quot;   &quot;&quot; &quot;SeaMonkeyEML&quot;</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineplus">+!macroend</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineplus">+!define SetHandlersMail &quot;!insertmacro SetHandlersMail&quot;</span>
<a href="#l4.377"></a><span id="l4.377"> </span>
<a href="#l4.378"></a><span id="l4.378" class="difflineplus">+!macro SetHandlersNews</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\${FileMainEXE}&quot; $8</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineplus">+  StrCpy $0 &quot;SOFTWARE\Classes&quot;</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineplus">+  StrCpy $1 &quot;$\&quot;$8$\&quot; -osint -mail $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineplus">+</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineplus">+  ${AddHandlerValues} &quot;$0\SeaMonkeyNEWS&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;${AppRegNameNews} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.384"></a><span id="l4.384">   ; An empty string is used for the 4th &amp; 5th params because the following</span>
<a href="#l4.385"></a><span id="l4.385">   ; protocol handlers already have a display name and additional keys required</span>
<a href="#l4.386"></a><span id="l4.386">   ; for a protocol handler.</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineminus">-  ${AddHandlerValues} &quot;$0\mailto&quot; &quot;$3&quot; &quot;$8,0&quot; &quot;${AppRegNameMail} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.388"></a><span id="l4.388">   ${AddHandlerValues} &quot;$0\news&quot;   &quot;$2&quot; &quot;$8,0&quot; &quot;${AppRegNameNews} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.389"></a><span id="l4.389">   ${AddHandlerValues} &quot;$0\nntp&quot;   &quot;$2&quot; &quot;$8,0&quot; &quot;${AppRegNameNews} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.390"></a><span id="l4.390">   ${AddHandlerValues} &quot;$0\snews&quot;  &quot;$2&quot; &quot;$8,0&quot; &quot;${AppRegNameNews} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.391"></a><span id="l4.391"> !macroend</span>
<a href="#l4.392"></a><span id="l4.392" class="difflineminus">-!define SetHandlers &quot;!insertmacro SetHandlers&quot;</span>
<a href="#l4.393"></a><span id="l4.393" class="difflineplus">+!define SetHandlersNews &quot;!insertmacro SetHandlersNews&quot;</span>
<a href="#l4.394"></a><span id="l4.394" class="difflineplus">+</span>
<a href="#l4.395"></a><span id="l4.395"> ; XXXrstrong - there are several values that will be overwritten by and</span>
<a href="#l4.396"></a><span id="l4.396"> ; overwrite other installs of the same application.</span>
<a href="#l4.397"></a><span id="l4.397"> !macro SetStartMenuInternet</span>
<a href="#l4.398"></a><span id="l4.398">   GetFullPathName $8 &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.399"></a><span id="l4.399">   GetFullPathName $7 &quot;$INSTDIR\uninstall\helper.exe&quot;</span>
<a href="#l4.400"></a><span id="l4.400"> </span>
<a href="#l4.401"></a><span id="l4.401">   ${StrFilter} &quot;${FileMainEXE}&quot; &quot;+&quot; &quot;&quot; &quot;&quot; $R9</span>
<a href="#l4.402"></a><span id="l4.402"> </span>
<a href="#l4.403"></a><span id="l4.403" class="difflineat">@@ -227,41 +426,44 @@</span>
<a href="#l4.404"></a><span id="l4.404"> </span>
<a href="#l4.405"></a><span id="l4.405">   WriteRegStr HKLM &quot;$0\Capabilities\URLAssociations&quot; &quot;ftp&quot;    &quot;SeaMonkeyURL&quot;</span>
<a href="#l4.406"></a><span id="l4.406">   WriteRegStr HKLM &quot;$0\Capabilities\URLAssociations&quot; &quot;gopher&quot; &quot;SeaMonkeyURL&quot;</span>
<a href="#l4.407"></a><span id="l4.407">   WriteRegStr HKLM &quot;$0\Capabilities\URLAssociations&quot; &quot;http&quot;   &quot;SeaMonkeyURL&quot;</span>
<a href="#l4.408"></a><span id="l4.408">   WriteRegStr HKLM &quot;$0\Capabilities\URLAssociations&quot; &quot;https&quot;  &quot;SeaMonkeyURL&quot;</span>
<a href="#l4.409"></a><span id="l4.409"> </span>
<a href="#l4.410"></a><span id="l4.410">   ; Vista Registered Application</span>
<a href="#l4.411"></a><span id="l4.411">   WriteRegStr HKLM &quot;Software\RegisteredApplications&quot; &quot;${AppRegName}&quot; &quot;$0\Capabilities&quot;</span>
<a href="#l4.412"></a><span id="l4.412" class="difflineplus">+!macroend</span>
<a href="#l4.413"></a><span id="l4.413" class="difflineplus">+!define SetStartMenuInternet &quot;!insertmacro SetStartMenuInternet&quot;</span>
<a href="#l4.414"></a><span id="l4.414"> </span>
<a href="#l4.415"></a><span id="l4.415" class="difflineplus">+!macro FixShellIconHandler</span>
<a href="#l4.416"></a><span id="l4.416">   ; The IconHandler reference for SeaMonkeyHTML can end up in an inconsistent</span>
<a href="#l4.417"></a><span id="l4.417">   ; state due to changes not being detected by the IconHandler for side by side</span>
<a href="#l4.418"></a><span id="l4.418">   ; installs. The symptoms can be either an incorrect icon or no icon being</span>
<a href="#l4.419"></a><span id="l4.419">   ; displayed for files associated with Firefox. By setting it here it will</span>
<a href="#l4.420"></a><span id="l4.420">   ; always reference the install referenced in the</span>
<a href="#l4.421"></a><span id="l4.421">   ; HKLM\Software\Classes\SeaMonkeyHTML registry key.</span>
<a href="#l4.422"></a><span id="l4.422">   ClearErrors</span>
<a href="#l4.423"></a><span id="l4.423">   ReadRegStr $2 HKLM &quot;Software\Classes\SeaMonkeyHTML\ShellEx\IconHandler&quot; &quot;&quot;</span>
<a href="#l4.424"></a><span id="l4.424">   ${Unless} ${Errors}</span>
<a href="#l4.425"></a><span id="l4.425">     ClearErrors</span>
<a href="#l4.426"></a><span id="l4.426">     ReadRegStr $3 HKLM &quot;Software\Classes\CLSID\$2\Old Icon\SeaMonkeyHTML\DefaultIcon&quot; &quot;&quot;</span>
<a href="#l4.427"></a><span id="l4.427">     ${Unless} ${Errors}</span>
<a href="#l4.428"></a><span id="l4.428">       WriteRegStr HKLM &quot;Software\Classes\CLSID\$2\Old Icon\SeaMonkeyHTML\DefaultIcon&quot; &quot;&quot; &quot;$8,1&quot;</span>
<a href="#l4.429"></a><span id="l4.429">     ${EndUnless}</span>
<a href="#l4.430"></a><span id="l4.430">   ${EndUnless}</span>
<a href="#l4.431"></a><span id="l4.431"> !macroend</span>
<a href="#l4.432"></a><span id="l4.432" class="difflineminus">-!define SetStartMenuInternet &quot;!insertmacro SetStartMenuInternet&quot;</span>
<a href="#l4.433"></a><span id="l4.433" class="difflineplus">+!define FixShellIconHandler &quot;!insertmacro FixShellIconHandler&quot;</span>
<a href="#l4.434"></a><span id="l4.434"> </span>
<a href="#l4.435"></a><span id="l4.435"> ; XXXrstrong - there are several values that will be overwritten by and</span>
<a href="#l4.436"></a><span id="l4.436"> ; overwrite other installs of the same application.</span>
<a href="#l4.437"></a><span id="l4.437"> !macro SetClientsMail</span>
<a href="#l4.438"></a><span id="l4.438" class="difflineminus">-  GetFullPathName $8 &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.439"></a><span id="l4.439" class="difflineminus">-  GetFullPathName $7 &quot;$INSTDIR\uninstall\helper.exe&quot;</span>
<a href="#l4.440"></a><span id="l4.440" class="difflineminus">-  GetFullPathName $6 &quot;$INSTDIR\mozMapi32.dll&quot;</span>
<a href="#l4.441"></a><span id="l4.441" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\${FileMainEXE}&quot; $8</span>
<a href="#l4.442"></a><span id="l4.442" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\uninstall\helper.exe&quot; $7</span>
<a href="#l4.443"></a><span id="l4.443" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\mozMapi32.dll&quot; $6</span>
<a href="#l4.444"></a><span id="l4.444"> </span>
<a href="#l4.445"></a><span id="l4.445">   StrCpy $0 &quot;Software\Clients\Mail\${BrandFullNameInternal}&quot;</span>
<a href="#l4.446"></a><span id="l4.446">   WriteRegStr HKLM &quot;$0&quot; &quot;&quot; &quot;${BrandFullNameInternal}&quot;</span>
<a href="#l4.447"></a><span id="l4.447">   WriteRegStr HKLM &quot;$0\DefaultIcon&quot; &quot;&quot; &quot;$8,0&quot;</span>
<a href="#l4.448"></a><span id="l4.448">   WriteRegStr HKLM &quot;$0&quot; &quot;DLLPath&quot; &quot;$6&quot;</span>
<a href="#l4.449"></a><span id="l4.449"> </span>
<a href="#l4.450"></a><span id="l4.450">   ; MapiProxy.dll can be used by multiple applications but</span>
<a href="#l4.451"></a><span id="l4.451">   ; is only registered for the last application installed. When the last</span>
<a href="#l4.452"></a><span id="l4.452" class="difflineat">@@ -293,16 +495,28 @@</span>
<a href="#l4.453"></a><span id="l4.453">   WriteRegStr HKLM &quot;$1\MozillaMapi.1\CLSID&quot; &quot;&quot; &quot;{29F458BE-8866-11D5-A3DD-00B0D0F3BAA7}&quot;</span>
<a href="#l4.454"></a><span id="l4.454"> </span>
<a href="#l4.455"></a><span id="l4.455">   ; The Reinstall Command is defined at</span>
<a href="#l4.456"></a><span id="l4.456">   ; http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/shell/programmersguide/shell_adv/registeringapps.asp</span>
<a href="#l4.457"></a><span id="l4.457">   WriteRegStr HKLM &quot;$0\InstallInfo&quot; &quot;HideIconsCommand&quot; &quot;$\&quot;$7$\&quot; /HideShortcuts&quot;</span>
<a href="#l4.458"></a><span id="l4.458">   WriteRegStr HKLM &quot;$0\InstallInfo&quot; &quot;ShowIconsCommand&quot; &quot;$\&quot;$7$\&quot; /ShowShortcuts&quot;</span>
<a href="#l4.459"></a><span id="l4.459">   WriteRegStr HKLM &quot;$0\InstallInfo&quot; &quot;ReinstallCommand&quot; &quot;$\&quot;$7$\&quot; /SetAsDefaultAppGlobal&quot;</span>
<a href="#l4.460"></a><span id="l4.460"> </span>
<a href="#l4.461"></a><span id="l4.461" class="difflineplus">+  ClearErrors</span>
<a href="#l4.462"></a><span id="l4.462" class="difflineplus">+  ReadRegDWORD $1 HKLM &quot;$0\InstallInfo&quot; &quot;IconsVisible&quot;</span>
<a href="#l4.463"></a><span id="l4.463" class="difflineplus">+  ; If the IconsVisible name value pair doesn't exist add it otherwise the</span>
<a href="#l4.464"></a><span id="l4.464" class="difflineplus">+  ; application won't be displayed in Set Program Access and Defaults.</span>
<a href="#l4.465"></a><span id="l4.465" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l4.466"></a><span id="l4.466" class="difflineplus">+    ${If} ${FileExists} &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l4.467"></a><span id="l4.467" class="difflineplus">+      WriteRegDWORD HKLM &quot;$0\InstallInfo&quot; &quot;IconsVisible&quot; 1</span>
<a href="#l4.468"></a><span id="l4.468" class="difflineplus">+    ${Else}</span>
<a href="#l4.469"></a><span id="l4.469" class="difflineplus">+      WriteRegDWORD HKLM &quot;$0\InstallInfo&quot; &quot;IconsVisible&quot; 0</span>
<a href="#l4.470"></a><span id="l4.470" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.471"></a><span id="l4.471" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.472"></a><span id="l4.472" class="difflineplus">+</span>
<a href="#l4.473"></a><span id="l4.473">   ; Mail shell/open/command</span>
<a href="#l4.474"></a><span id="l4.474">   WriteRegStr HKLM &quot;$0\shell\open\command&quot; &quot;&quot; &quot;$\&quot;$8$\&quot; -mail&quot;</span>
<a href="#l4.475"></a><span id="l4.475"> </span>
<a href="#l4.476"></a><span id="l4.476">   ; options</span>
<a href="#l4.477"></a><span id="l4.477">   WriteRegStr HKLM &quot;$0\shell\properties&quot; &quot;&quot; &quot;$(CONTEXT_OPTIONS)&quot;</span>
<a href="#l4.478"></a><span id="l4.478">   WriteRegStr HKLM &quot;$0\shell\properties\command&quot; &quot;&quot; &quot;$\&quot;$8$\&quot; -options&quot;</span>
<a href="#l4.479"></a><span id="l4.479"> </span>
<a href="#l4.480"></a><span id="l4.480">   ; safemode</span>
<a href="#l4.481"></a><span id="l4.481" class="difflineat">@@ -318,25 +532,62 @@</span>
<a href="#l4.482"></a><span id="l4.482">   WriteRegStr HKLM &quot;$0\Capabilities&quot; &quot;ApplicationIcon&quot; &quot;$8,0&quot;</span>
<a href="#l4.483"></a><span id="l4.483">   WriteRegStr HKLM &quot;$0\Capabilities&quot; &quot;ApplicationName&quot; &quot;${AppRegNameMail}&quot;</span>
<a href="#l4.484"></a><span id="l4.484">   WriteRegStr HKLM &quot;$0\Capabilities\FileAssociations&quot; &quot;.eml&quot;   &quot;SeaMonkeyEML&quot;</span>
<a href="#l4.485"></a><span id="l4.485">   WriteRegStr HKLM &quot;$0\Capabilities\StartMenu&quot; &quot;Mail&quot; &quot;${BrandFullNameInternal}&quot;</span>
<a href="#l4.486"></a><span id="l4.486">   WriteRegStr HKLM &quot;$0\Capabilities\URLAssociations&quot; &quot;mailto&quot; &quot;SeaMonkeyCOMPOSE&quot;</span>
<a href="#l4.487"></a><span id="l4.487"> </span>
<a href="#l4.488"></a><span id="l4.488">   ; Vista Registered Application</span>
<a href="#l4.489"></a><span id="l4.489">   WriteRegStr HKLM &quot;Software\RegisteredApplications&quot; &quot;${AppRegNameMail}&quot; &quot;$0\Capabilities&quot;</span>
<a href="#l4.490"></a><span id="l4.490" class="difflineplus">+!macroend</span>
<a href="#l4.491"></a><span id="l4.491" class="difflineplus">+!define SetClientsMail &quot;!insertmacro SetClientsMail&quot;</span>
<a href="#l4.492"></a><span id="l4.492"> </span>
<a href="#l4.493"></a><span id="l4.493" class="difflineminus">-  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<a href="#l4.494"></a><span id="l4.494" class="difflineminus">-  ; News</span>
<a href="#l4.495"></a><span id="l4.495" class="difflineminus">-  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<a href="#l4.496"></a><span id="l4.496" class="difflineplus">+; XXXrstrong - there are several values that will be overwritten by and</span>
<a href="#l4.497"></a><span id="l4.497" class="difflineplus">+; overwrite other installs of the same application.</span>
<a href="#l4.498"></a><span id="l4.498" class="difflineplus">+!macro SetClientsNews</span>
<a href="#l4.499"></a><span id="l4.499" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\${FileMainEXE}&quot; $8</span>
<a href="#l4.500"></a><span id="l4.500" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\uninstall\helper.exe&quot; $7</span>
<a href="#l4.501"></a><span id="l4.501" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\mozMapi32.dll&quot; $6</span>
<a href="#l4.502"></a><span id="l4.502" class="difflineplus">+  </span>
<a href="#l4.503"></a><span id="l4.503">   StrCpy $0 &quot;Software\Clients\News\${BrandFullNameInternal}&quot;</span>
<a href="#l4.504"></a><span id="l4.504">   WriteRegStr HKLM &quot;$0&quot; &quot;&quot; &quot;${BrandFullNameInternal}&quot;</span>
<a href="#l4.505"></a><span id="l4.505">   WriteRegStr HKLM &quot;$0\DefaultIcon&quot; &quot;&quot; &quot;$8,0&quot;</span>
<a href="#l4.506"></a><span id="l4.506">   WriteRegStr HKLM &quot;$0&quot; &quot;DLLPath&quot; &quot;$6&quot;</span>
<a href="#l4.507"></a><span id="l4.507"> </span>
<a href="#l4.508"></a><span id="l4.508" class="difflineplus">+  ; MapiProxy.dll can exist in multiple installs of the application. Registration</span>
<a href="#l4.509"></a><span id="l4.509" class="difflineplus">+  ; occurs as follows with the last action to occur being the one that wins:</span>
<a href="#l4.510"></a><span id="l4.510" class="difflineplus">+  ; On install and software update when helper.exe runs with the /PostUpdate</span>
<a href="#l4.511"></a><span id="l4.511" class="difflineplus">+  ; argument. On setting the application as the system's default application </span>
<a href="#l4.512"></a><span id="l4.512" class="difflineplus">+  ; using Window's &quot;Set program access and defaults&quot;.</span>
<a href="#l4.513"></a><span id="l4.513" class="difflineplus">+</span>
<a href="#l4.514"></a><span id="l4.514" class="difflineplus">+  !ifndef NO_LOG</span>
<a href="#l4.515"></a><span id="l4.515" class="difflineplus">+    ${LogHeader} &quot;DLL Registration&quot;</span>
<a href="#l4.516"></a><span id="l4.516" class="difflineplus">+  !endif</span>
<a href="#l4.517"></a><span id="l4.517" class="difflineplus">+  ClearErrors</span>
<a href="#l4.518"></a><span id="l4.518" class="difflineplus">+  RegDLL &quot;$INSTDIR\MapiProxy.dll&quot;</span>
<a href="#l4.519"></a><span id="l4.519" class="difflineplus">+  !ifndef NO_LOG  </span>
<a href="#l4.520"></a><span id="l4.520" class="difflineplus">+    ${If} ${Errors}</span>
<a href="#l4.521"></a><span id="l4.521" class="difflineplus">+      ${LogMsg} &quot;** ERROR Registering: $INSTDIR\MapiProxy.dll **&quot;</span>
<a href="#l4.522"></a><span id="l4.522" class="difflineplus">+    ${Else}</span>
<a href="#l4.523"></a><span id="l4.523" class="difflineplus">+      ${LogUninstall} &quot;DLLReg: \MapiProxy.dll&quot;</span>
<a href="#l4.524"></a><span id="l4.524" class="difflineplus">+      ${LogMsg} &quot;Registered: $INSTDIR\MapiProxy.dll&quot;</span>
<a href="#l4.525"></a><span id="l4.525" class="difflineplus">+    ${EndIf}</span>
<a href="#l4.526"></a><span id="l4.526" class="difflineplus">+  !endif</span>
<a href="#l4.527"></a><span id="l4.527" class="difflineplus">+</span>
<a href="#l4.528"></a><span id="l4.528" class="difflineplus">+  StrCpy $1 &quot;Software\Classes\CLSID\{29F458BE-8866-11D5-A3DD-00B0D0F3BAA7}&quot;</span>
<a href="#l4.529"></a><span id="l4.529" class="difflineplus">+  WriteRegStr HKLM &quot;$1\LocalServer32&quot; &quot;&quot; &quot;$\&quot;$8$\&quot; /MAPIStartup&quot;</span>
<a href="#l4.530"></a><span id="l4.530" class="difflineplus">+  WriteRegStr HKLM &quot;$1\ProgID&quot; &quot;&quot; &quot;MozillaMapi.1&quot;</span>
<a href="#l4.531"></a><span id="l4.531" class="difflineplus">+  WriteRegStr HKLM &quot;$1\VersionIndependentProgID&quot; &quot;&quot; &quot;MozillaMAPI&quot;</span>
<a href="#l4.532"></a><span id="l4.532" class="difflineplus">+  StrCpy $1 &quot;SOFTWARE\Classes&quot;</span>
<a href="#l4.533"></a><span id="l4.533" class="difflineplus">+  WriteRegStr HKLM &quot;$1\MozillaMapi&quot; &quot;&quot; &quot;Mozilla MAPI&quot;</span>
<a href="#l4.534"></a><span id="l4.534" class="difflineplus">+  WriteRegStr HKLM &quot;$1\MozillaMapi\CLSID&quot; &quot;&quot; &quot;{29F458BE-8866-11D5-A3DD-00B0D0F3BAA7}&quot;</span>
<a href="#l4.535"></a><span id="l4.535" class="difflineplus">+  WriteRegStr HKLM &quot;$1\MozillaMapi\CurVer&quot; &quot;&quot; &quot;MozillaMapi.1&quot;</span>
<a href="#l4.536"></a><span id="l4.536" class="difflineplus">+  WriteRegStr HKLM &quot;$1\MozillaMapi.1&quot; &quot;&quot; &quot;Mozilla MAPI&quot;</span>
<a href="#l4.537"></a><span id="l4.537" class="difflineplus">+  WriteRegStr HKLM &quot;$1\MozillaMapi.1\CLSID&quot; &quot;&quot; &quot;{29F458BE-8866-11D5-A3DD-00B0D0F3BAA7}&quot;</span>
<a href="#l4.538"></a><span id="l4.538" class="difflineplus">+  </span>
<a href="#l4.539"></a><span id="l4.539">   ; Mail shell/open/command</span>
<a href="#l4.540"></a><span id="l4.540">   WriteRegStr HKLM &quot;$0\shell\open\command&quot; &quot;&quot; &quot;$\&quot;$8$\&quot; -mail&quot;</span>
<a href="#l4.541"></a><span id="l4.541"> </span>
<a href="#l4.542"></a><span id="l4.542">   ; Vista Capabilities registry keys</span>
<a href="#l4.543"></a><span id="l4.543">   WriteRegStr HKLM &quot;$0\Capabilities&quot; &quot;ApplicationDescription&quot; &quot;$(REG_APP_DESC)&quot;</span>
<a href="#l4.544"></a><span id="l4.544">   WriteRegStr HKLM &quot;$0\Capabilities&quot; &quot;ApplicationIcon&quot; &quot;$8,0&quot;</span>
<a href="#l4.545"></a><span id="l4.545">   WriteRegStr HKLM &quot;$0\Capabilities&quot; &quot;ApplicationName&quot; &quot;${AppRegNameNews}&quot;</span>
<a href="#l4.546"></a><span id="l4.546">   WriteRegStr HKLM &quot;$0\Capabilities\URLAssociations&quot; &quot;nntp&quot; &quot;SeaMonkeyNEWS&quot;</span>
<a href="#l4.547"></a><span id="l4.547" class="difflineat">@@ -347,112 +598,200 @@</span>
<a href="#l4.548"></a><span id="l4.548">   StrCpy $1 &quot;$\&quot;$8$\&quot; -mail $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.549"></a><span id="l4.549">   ${AddHandlerValues} &quot;$0\Protocols\nntp&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;${AppRegNameNews} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.550"></a><span id="l4.550">   ${AddHandlerValues} &quot;$0\Protocols\news&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;${AppRegNameNews} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.551"></a><span id="l4.551">   ${AddHandlerValues} &quot;$0\Protocols\snews&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;${AppRegNameNews} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.552"></a><span id="l4.552"> </span>
<a href="#l4.553"></a><span id="l4.553">   ; Vista Registered Application</span>
<a href="#l4.554"></a><span id="l4.554">   WriteRegStr HKLM &quot;Software\RegisteredApplications&quot; &quot;${AppRegNameNews}&quot; &quot;$0\Capabilities&quot;</span>
<a href="#l4.555"></a><span id="l4.555"> !macroend</span>
<a href="#l4.556"></a><span id="l4.556" class="difflineminus">-!define SetClientsMail &quot;!insertmacro SetClientsMail&quot;</span>
<a href="#l4.557"></a><span id="l4.557" class="difflineplus">+!define SetClientsNews &quot;!insertmacro SetClientsNews&quot;</span>
<a href="#l4.558"></a><span id="l4.558"> </span>
<a href="#l4.559"></a><span id="l4.559"> !macro SetAppKeys</span>
<a href="#l4.560"></a><span id="l4.560" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR&quot; $8</span>
<a href="#l4.561"></a><span id="l4.561">   StrCpy $0 &quot;Software\Mozilla\${BrandFullNameInternal}\${AppVersion} (${AB_CD})\Main&quot;</span>
<a href="#l4.562"></a><span id="l4.562" class="difflineminus">-  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Install Directory&quot; &quot;$INSTDIR&quot; 0</span>
<a href="#l4.563"></a><span id="l4.563" class="difflineminus">-  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;PathToExe&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l4.564"></a><span id="l4.564" class="difflineplus">+  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Install Directory&quot; &quot;$8&quot; 0</span>
<a href="#l4.565"></a><span id="l4.565" class="difflineplus">+  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;PathToExe&quot; &quot;$8\${FileMainEXE}&quot; 0</span>
<a href="#l4.566"></a><span id="l4.566">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Program Folder Path&quot; &quot;$SMPROGRAMS\$StartMenuDir&quot; 0</span>
<a href="#l4.567"></a><span id="l4.567"> </span>
<a href="#l4.568"></a><span id="l4.568">   SetShellVarContext all  ; Set $DESKTOP to All Users</span>
<a href="#l4.569"></a><span id="l4.569">   ${Unless} ${FileExists} &quot;$DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l4.570"></a><span id="l4.570">     SetShellVarContext current  ; Set $DESKTOP to the current user's desktop</span>
<a href="#l4.571"></a><span id="l4.571">   ${EndUnless}</span>
<a href="#l4.572"></a><span id="l4.572"> </span>
<a href="#l4.573"></a><span id="l4.573">   ${If} ${FileExists} &quot;$DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l4.574"></a><span id="l4.574">     ShellLink::GetShortCutArgs &quot;$DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l4.575"></a><span id="l4.575">     Pop $1</span>
<a href="#l4.576"></a><span id="l4.576" class="difflineminus">-    ${If} $1 == &quot;&quot;</span>
<a href="#l4.577"></a><span id="l4.577" class="difflineplus">+    ${If} &quot;$1&quot; == &quot;&quot;</span>
<a href="#l4.578"></a><span id="l4.578">       ShellLink::GetShortCutTarget &quot;$DESKTOP\${BrandFullName}.lnk&quot;</span>
<a href="#l4.579"></a><span id="l4.579">       Pop $1</span>
<a href="#l4.580"></a><span id="l4.580" class="difflineminus">-      ; Needs to handle short paths</span>
<a href="#l4.581"></a><span id="l4.581" class="difflineminus">-      ${If} $1 == &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.582"></a><span id="l4.582" class="difflineplus">+      ${GetLongPath} &quot;$1&quot; $1</span>
<a href="#l4.583"></a><span id="l4.583" class="difflineplus">+      ${If} &quot;$1&quot; == &quot;$8\{FileMainEXE}&quot;</span>
<a href="#l4.584"></a><span id="l4.584">         ${WriteRegDWORD2} $TmpVal &quot;$0&quot; &quot;Create Desktop Shortcut&quot; 1 0</span>
<a href="#l4.585"></a><span id="l4.585">       ${Else}</span>
<a href="#l4.586"></a><span id="l4.586">         ${WriteRegDWORD2} $TmpVal &quot;$0&quot; &quot;Create Desktop Shortcut&quot; 0 0</span>
<a href="#l4.587"></a><span id="l4.587">       ${EndIf}</span>
<a href="#l4.588"></a><span id="l4.588">     ${EndIf}</span>
<a href="#l4.589"></a><span id="l4.589">   ${EndIf}</span>
<a href="#l4.590"></a><span id="l4.590"> </span>
<a href="#l4.591"></a><span id="l4.591">   ; XXXrstrong - need a cleaner way to prevent unsetting SHCTX from HKLM when</span>
<a href="#l4.592"></a><span id="l4.592">   ; trying to find the desktop shortcut.</span>
<a href="#l4.593"></a><span id="l4.593" class="difflineminus">-  ${If} $TmpVal == &quot;HKCU&quot;</span>
<a href="#l4.594"></a><span id="l4.594" class="difflineplus">+  ${If} &quot;$TmpVal&quot; == &quot;HKCU&quot;</span>
<a href="#l4.595"></a><span id="l4.595">     SetShellVarContext current</span>
<a href="#l4.596"></a><span id="l4.596">   ${Else}</span>
<a href="#l4.597"></a><span id="l4.597">     SetShellVarContext all</span>
<a href="#l4.598"></a><span id="l4.598">   ${EndIf}</span>
<a href="#l4.599"></a><span id="l4.599"> </span>
<a href="#l4.600"></a><span id="l4.600">   ${If} ${FileExists} &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l4.601"></a><span id="l4.601">     ShellLink::GetShortCutArgs &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l4.602"></a><span id="l4.602">     Pop $1</span>
<a href="#l4.603"></a><span id="l4.603" class="difflineminus">-    ${If} $1 == &quot;&quot;</span>
<a href="#l4.604"></a><span id="l4.604" class="difflineplus">+    ${If} &quot;$1&quot; == &quot;&quot;</span>
<a href="#l4.605"></a><span id="l4.605">       ShellLink::GetShortCutTarget &quot;$QUICKLAUNCH\${BrandFullName}.lnk&quot;</span>
<a href="#l4.606"></a><span id="l4.606">       Pop $1</span>
<a href="#l4.607"></a><span id="l4.607" class="difflineminus">-      ; Needs to handle short paths</span>
<a href="#l4.608"></a><span id="l4.608" class="difflineminus">-      ${If} $1 == &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.609"></a><span id="l4.609" class="difflineplus">+      ${GetLongPath} &quot;$1&quot; $1</span>
<a href="#l4.610"></a><span id="l4.610" class="difflineplus">+      ${If} &quot;$1&quot; == &quot;$8\${FileMainEXE}&quot;</span>
<a href="#l4.611"></a><span id="l4.611">         ${WriteRegDWORD2} $TmpVal &quot;$0&quot; &quot;Create Quick Launch Shortcut&quot; 1 0</span>
<a href="#l4.612"></a><span id="l4.612">       ${Else}</span>
<a href="#l4.613"></a><span id="l4.613">         ${WriteRegDWORD2} $TmpVal &quot;$0&quot; &quot;Create Quick Launch Shortcut&quot; 0 0</span>
<a href="#l4.614"></a><span id="l4.614">       ${EndIf}</span>
<a href="#l4.615"></a><span id="l4.615">     ${EndIf}</span>
<a href="#l4.616"></a><span id="l4.616">   ${EndIf}</span>
<a href="#l4.617"></a><span id="l4.617">   ; XXXrstrong - &quot;Create Start Menu Shortcut&quot; and &quot;Start Menu Folder&quot; are only</span>
<a href="#l4.618"></a><span id="l4.618">   ; set in the installer and should also be set here for software update.</span>
<a href="#l4.619"></a><span id="l4.619"> </span>
<a href="#l4.620"></a><span id="l4.620">   StrCpy $0 &quot;Software\Mozilla\${BrandFullNameInternal}\${AppVersion} (${AB_CD})\Uninstall&quot;</span>
<a href="#l4.621"></a><span id="l4.621" class="difflineminus">-  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Uninstall Log Folder&quot; &quot;$INSTDIR\uninstall&quot; 0</span>
<a href="#l4.622"></a><span id="l4.622" class="difflineplus">+  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Uninstall Log Folder&quot; &quot;$8\uninstall&quot; 0</span>
<a href="#l4.623"></a><span id="l4.623">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Description&quot; &quot;${BrandFullNameInternal} (${AppVersion})&quot; 0</span>
<a href="#l4.624"></a><span id="l4.624"> </span>
<a href="#l4.625"></a><span id="l4.625">   StrCpy $0 &quot;Software\Mozilla\${BrandFullNameInternal}\${AppVersion} (${AB_CD})&quot;</span>
<a href="#l4.626"></a><span id="l4.626">   ${WriteRegStr2} $TmpVal  &quot;$0&quot; &quot;&quot; &quot;${AppVersion} (${AB_CD})&quot; 0</span>
<a href="#l4.627"></a><span id="l4.627"> </span>
<a href="#l4.628"></a><span id="l4.628">   StrCpy $0 &quot;Software\Mozilla\${BrandFullNameInternal} ${AppVersion}\bin&quot;</span>
<a href="#l4.629"></a><span id="l4.629" class="difflineminus">-  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;PathToExe&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l4.630"></a><span id="l4.630" class="difflineplus">+  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;PathToExe&quot; &quot;$8\${FileMainEXE}&quot; 0</span>
<a href="#l4.631"></a><span id="l4.631"> </span>
<a href="#l4.632"></a><span id="l4.632">   StrCpy $0 &quot;Software\Mozilla\${BrandFullNameInternal} ${AppVersion}\extensions&quot;</span>
<a href="#l4.633"></a><span id="l4.633" class="difflineminus">-  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Components&quot; &quot;$INSTDIR\components&quot; 0</span>
<a href="#l4.634"></a><span id="l4.634" class="difflineminus">-  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Plugins&quot; &quot;$INSTDIR\plugins&quot; 0</span>
<a href="#l4.635"></a><span id="l4.635" class="difflineplus">+  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Components&quot; &quot;$8\components&quot; 0</span>
<a href="#l4.636"></a><span id="l4.636" class="difflineplus">+  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Plugins&quot; &quot;$8\plugins&quot; 0</span>
<a href="#l4.637"></a><span id="l4.637"> </span>
<a href="#l4.638"></a><span id="l4.638">   StrCpy $0 &quot;Software\Mozilla\${BrandFullNameInternal} ${AppVersion}&quot;</span>
<a href="#l4.639"></a><span id="l4.639">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;GeckoVer&quot; &quot;${GREVersion}&quot; 0</span>
<a href="#l4.640"></a><span id="l4.640"> </span>
<a href="#l4.641"></a><span id="l4.641">   StrCpy $0 &quot;Software\Mozilla\${BrandFullNameInternal}&quot;</span>
<a href="#l4.642"></a><span id="l4.642">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;&quot; &quot;${GREVersion}&quot; 0</span>
<a href="#l4.643"></a><span id="l4.643">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;CurrentVersion&quot; &quot;${AppVersion} (${AB_CD})&quot; 0</span>
<a href="#l4.644"></a><span id="l4.644"> !macroend</span>
<a href="#l4.645"></a><span id="l4.645"> !define SetAppKeys &quot;!insertmacro SetAppKeys&quot;</span>
<a href="#l4.646"></a><span id="l4.646"> </span>
<a href="#l4.647"></a><span id="l4.647"> !macro SetUninstallKeys</span>
<a href="#l4.648"></a><span id="l4.648" class="difflineplus">+  StrCpy $0 &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${BrandFullNameInternal} (${AppVersion})&quot;</span>
<a href="#l4.649"></a><span id="l4.649" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR&quot; $8</span>
<a href="#l4.650"></a><span id="l4.650" class="difflineplus">+</span>
<a href="#l4.651"></a><span id="l4.651">   ; Write the uninstall registry keys</span>
<a href="#l4.652"></a><span id="l4.652" class="difflineminus">-  StrCpy $0 &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${BrandFullNameInternal} (${AppVersion})&quot;</span>
<a href="#l4.653"></a><span id="l4.653" class="difflineminus">-  GetFullPathName $8 &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l4.654"></a><span id="l4.654" class="difflineminus">-  GetFullPathName $7 &quot;$INSTDIR\uninstall\helper.exe&quot;</span>
<a href="#l4.655"></a><span id="l4.655" class="difflineminus">-</span>
<a href="#l4.656"></a><span id="l4.656">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Comments&quot; &quot;${BrandFullNameInternal}&quot; 0</span>
<a href="#l4.657"></a><span id="l4.657" class="difflineminus">-  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;DisplayIcon&quot; &quot;$8,0&quot; 0</span>
<a href="#l4.658"></a><span id="l4.658" class="difflineplus">+  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;DisplayIcon&quot; &quot;$8\${FileMainEXE},0&quot; 0</span>
<a href="#l4.659"></a><span id="l4.659">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;DisplayName&quot; &quot;${BrandFullNameInternal} (${AppVersion})&quot; 0</span>
<a href="#l4.660"></a><span id="l4.660">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;DisplayVersion&quot; &quot;${AppVersion} (${AB_CD})&quot; 0</span>
<a href="#l4.661"></a><span id="l4.661" class="difflineminus">-  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;InstallLocation&quot; &quot;$INSTDIR&quot; 0</span>
<a href="#l4.662"></a><span id="l4.662" class="difflineplus">+  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;InstallLocation&quot; &quot;$8&quot; 0</span>
<a href="#l4.663"></a><span id="l4.663">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Publisher&quot; &quot;Mozilla&quot; 0</span>
<a href="#l4.664"></a><span id="l4.664" class="difflineminus">-  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;UninstallString&quot; &quot;$7&quot; 0</span>
<a href="#l4.665"></a><span id="l4.665" class="difflineplus">+  ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;UninstallString&quot; &quot;$8\uninstall\helper.exe&quot; 0</span>
<a href="#l4.666"></a><span id="l4.666">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;URLInfoAbout&quot; &quot;${URLInfoAbout}&quot; 0</span>
<a href="#l4.667"></a><span id="l4.667">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;URLUpdateInfo&quot; &quot;${URLUpdateInfo}&quot; 0</span>
<a href="#l4.668"></a><span id="l4.668">   ${WriteRegDWORD2} $TmpVal &quot;$0&quot; &quot;NoModify&quot; 1 0</span>
<a href="#l4.669"></a><span id="l4.669">   ${WriteRegDWORD2} $TmpVal &quot;$0&quot; &quot;NoRepair&quot; 1 0</span>
<a href="#l4.670"></a><span id="l4.670"> !macroend</span>
<a href="#l4.671"></a><span id="l4.671"> !define SetUninstallKeys &quot;!insertmacro SetUninstallKeys&quot;</span>
<a href="#l4.672"></a><span id="l4.672"> </span>
<a href="#l4.673"></a><span id="l4.673" class="difflineplus">+; Updates protocol handlers if their registry open command value is for this</span>
<a href="#l4.674"></a><span id="l4.674" class="difflineplus">+; install location</span>
<a href="#l4.675"></a><span id="l4.675" class="difflineplus">+!macro UpdateProtocolHandlers</span>
<a href="#l4.676"></a><span id="l4.676" class="difflineplus">+  ; Store the command to open the app with an url in a register for easy access.</span>
<a href="#l4.677"></a><span id="l4.677" class="difflineplus">+  ${GetLongPath} &quot;$INSTDIR\${FileMainEXE}&quot; $8</span>
<a href="#l4.678"></a><span id="l4.678" class="difflineplus">+  StrCpy $0 &quot;SOFTWARE\Classes&quot;</span>
<a href="#l4.679"></a><span id="l4.679" class="difflineplus">+  StrCpy $1 &quot;$\&quot;$8$\&quot; -osint -compose $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.680"></a><span id="l4.680" class="difflineplus">+  StrCpy $2 &quot;$\&quot;$8$\&quot; -osint -mail $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.681"></a><span id="l4.681" class="difflineplus">+  StrCpy $3 &quot;$\&quot;$8$\&quot; -requestPending -osint -url $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.682"></a><span id="l4.682" class="difflineplus">+  StrCpy $4 &quot;$\&quot;%1$\&quot;,,0,0,,,,&quot;</span>
<a href="#l4.683"></a><span id="l4.683" class="difflineplus">+  StrCpy $5 &quot;$\&quot;$8$\&quot; -url $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.684"></a><span id="l4.684" class="difflineplus">+</span>
<a href="#l4.685"></a><span id="l4.685" class="difflineplus">+  ; Only set the file and protocol handlers if the existing one under HKCR is</span>
<a href="#l4.686"></a><span id="l4.686" class="difflineplus">+  ; for this install location.</span>
<a href="#l4.687"></a><span id="l4.687" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;SeaMonkeyHTML&quot; $R9</span>
<a href="#l4.688"></a><span id="l4.688" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.689"></a><span id="l4.689" class="difflineplus">+    ; An empty string is used for the 5th param because SeaMonkeyHTML is not a</span>
<a href="#l4.690"></a><span id="l4.690" class="difflineplus">+    ; protocol handler.</span>
<a href="#l4.691"></a><span id="l4.691" class="difflineplus">+    ${AddHandlerValues} &quot;SeaMonkeyHTML&quot; &quot;$5&quot; \</span>
<a href="#l4.692"></a><span id="l4.692" class="difflineplus">+                        &quot;$INSTDIR\chrome\icons\default\html-file.ico&quot; \</span>
<a href="#l4.693"></a><span id="l4.693" class="difflineplus">+                        &quot;${AppRegName} Document&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.694"></a><span id="l4.694" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.695"></a><span id="l4.695" class="difflineplus">+</span>
<a href="#l4.696"></a><span id="l4.696" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;SeaMonkeyURL&quot; $R9</span>
<a href="#l4.697"></a><span id="l4.697" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.698"></a><span id="l4.698" class="difflineplus">+    ${AddDDEHandlerValues} &quot;SeaMonkeyURL&quot; &quot;$3&quot; &quot;$8,0&quot; &quot;${AppRegName} URL&quot; \</span>
<a href="#l4.699"></a><span id="l4.699" class="difflineplus">+                           &quot;true&quot; &quot;${DDEApplication}&quot; &quot;$4&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l4.700"></a><span id="l4.700" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.701"></a><span id="l4.701" class="difflineplus">+</span>
<a href="#l4.702"></a><span id="l4.702" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;ftp&quot; $R9</span>
<a href="#l4.703"></a><span id="l4.703" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.704"></a><span id="l4.704" class="difflineplus">+    ${AddDDEHandlerValues} &quot;ftp&quot; &quot;$3&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;${DDEApplication}&quot; \</span>
<a href="#l4.705"></a><span id="l4.705" class="difflineplus">+                           &quot;$4&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l4.706"></a><span id="l4.706" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.707"></a><span id="l4.707" class="difflineplus">+</span>
<a href="#l4.708"></a><span id="l4.708" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;http&quot; $R9</span>
<a href="#l4.709"></a><span id="l4.709" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.710"></a><span id="l4.710" class="difflineplus">+    ${AddDDEHandlerValues} &quot;http&quot; &quot;$3&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;${DDEApplication}&quot; \</span>
<a href="#l4.711"></a><span id="l4.711" class="difflineplus">+                           &quot;$4&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l4.712"></a><span id="l4.712" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.713"></a><span id="l4.713" class="difflineplus">+</span>
<a href="#l4.714"></a><span id="l4.714" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;https&quot; $R9</span>
<a href="#l4.715"></a><span id="l4.715" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.716"></a><span id="l4.716" class="difflineplus">+    ${AddDDEHandlerValues} &quot;https&quot; &quot;$3&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;${DDEApplication}&quot; \</span>
<a href="#l4.717"></a><span id="l4.717" class="difflineplus">+                           &quot;$4&quot; &quot;WWW_OpenURL&quot;</span>
<a href="#l4.718"></a><span id="l4.718" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.719"></a><span id="l4.719" class="difflineplus">+</span>
<a href="#l4.720"></a><span id="l4.720" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;SeaMonkeyEML&quot; $R9</span>
<a href="#l4.721"></a><span id="l4.721" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.722"></a><span id="l4.722" class="difflineplus">+    ${AddHandlerValues} &quot;SOFTWARE\Classes\SeaMonkeyEML&quot; &quot;$2&quot; \</span>
<a href="#l4.723"></a><span id="l4.723" class="difflineplus">+                        &quot;$INSTDIR\chrome\icons\default\misc-file.ico&quot; \</span>
<a href="#l4.724"></a><span id="l4.724" class="difflineplus">+                        &quot;${AppRegNameMail} Document&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.725"></a><span id="l4.725" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.726"></a><span id="l4.726" class="difflineplus">+</span>
<a href="#l4.727"></a><span id="l4.727" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;SeaMonkeyMAIL&quot; $R9</span>
<a href="#l4.728"></a><span id="l4.728" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.729"></a><span id="l4.729" class="difflineplus">+    ${AddHandlerValues} &quot;SOFTWARE\Classes\SeaMonkeyMAIL&quot; &quot;$2&quot; &quot;$8,0&quot; \</span>
<a href="#l4.730"></a><span id="l4.730" class="difflineplus">+                        &quot;${AppRegNameMail} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.731"></a><span id="l4.731" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.732"></a><span id="l4.732" class="difflineplus">+</span>
<a href="#l4.733"></a><span id="l4.733" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;mailto&quot; $R9</span>
<a href="#l4.734"></a><span id="l4.734" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.735"></a><span id="l4.735" class="difflineplus">+    ${AddHandlerValues} &quot;SOFTWARE\Classes\mailto&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.736"></a><span id="l4.736" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.737"></a><span id="l4.737" class="difflineplus">+</span>
<a href="#l4.738"></a><span id="l4.738" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;SeaMonkeyNEWS&quot; $R9</span>
<a href="#l4.739"></a><span id="l4.739" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.740"></a><span id="l4.740" class="difflineplus">+    ${AddHandlerValues} &quot;SOFTWARE\Classes\SeaMonkeyNEWS&quot; &quot;$2&quot; &quot;$8,0&quot; \</span>
<a href="#l4.741"></a><span id="l4.741" class="difflineplus">+                        &quot;${AppRegNameMail} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.742"></a><span id="l4.742" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.743"></a><span id="l4.743" class="difflineplus">+</span>
<a href="#l4.744"></a><span id="l4.744" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;news&quot; $R9</span>
<a href="#l4.745"></a><span id="l4.745" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.746"></a><span id="l4.746" class="difflineplus">+    ${AddHandlerValues} &quot;SOFTWARE\Classes\news&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.747"></a><span id="l4.747" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.748"></a><span id="l4.748" class="difflineplus">+</span>
<a href="#l4.749"></a><span id="l4.749" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;snews&quot; $R9</span>
<a href="#l4.750"></a><span id="l4.750" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.751"></a><span id="l4.751" class="difflineplus">+    ${AddHandlerValues} &quot;SOFTWARE\Classes\snews&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.752"></a><span id="l4.752" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.753"></a><span id="l4.753" class="difflineplus">+</span>
<a href="#l4.754"></a><span id="l4.754" class="difflineplus">+  ${IsHandlerForInstallDir} &quot;nntp&quot; $R9</span>
<a href="#l4.755"></a><span id="l4.755" class="difflineplus">+  ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l4.756"></a><span id="l4.756" class="difflineplus">+    ${AddHandlerValues} &quot;SOFTWARE\Classes\nntp&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.757"></a><span id="l4.757" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.758"></a><span id="l4.758" class="difflineplus">+!macroend</span>
<a href="#l4.759"></a><span id="l4.759" class="difflineplus">+!define UpdateProtocolHandlers &quot;!insertmacro UpdateProtocolHandlers&quot;</span>
<a href="#l4.760"></a><span id="l4.760" class="difflineplus">+</span>
<a href="#l4.761"></a><span id="l4.761"> !macro FixClassKeys</span>
<a href="#l4.762"></a><span id="l4.762">   StrCpy $0 &quot;SOFTWARE\Classes&quot;</span>
<a href="#l4.763"></a><span id="l4.763"> </span>
<a href="#l4.764"></a><span id="l4.764">   ; BROWSER part</span>
<a href="#l4.765"></a><span id="l4.765">   ; File handler keys and name value pairs that may need to be created during</span>
<a href="#l4.766"></a><span id="l4.766">   ; install or upgrade.</span>
<a href="#l4.767"></a><span id="l4.767">   ReadRegStr $2 SHCTX &quot;$0\.shtml&quot; &quot;Content Type&quot;</span>
<a href="#l4.768"></a><span id="l4.768">   ${If} $2 == &quot;&quot;</span>
<a href="#l4.769"></a><span id="l4.769" class="difflineat">@@ -547,17 +886,17 @@</span>
<a href="#l4.770"></a><span id="l4.770">   GetFullPathName $2 &quot;$3&quot;</span>
<a href="#l4.771"></a><span id="l4.771">   ClearErrors</span>
<a href="#l4.772"></a><span id="l4.772">   ${WordFind} &quot;$2&quot; &quot;${FileMainEXE}&quot; &quot;E+1{&quot; $R1</span>
<a href="#l4.773"></a><span id="l4.773">   ${Unless} ${Errors}</span>
<a href="#l4.774"></a><span id="l4.774">    ${AddHandlerValues} &quot;$0\mailto&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.775"></a><span id="l4.775">   ${EndUnless}</span>
<a href="#l4.776"></a><span id="l4.776"> </span>
<a href="#l4.777"></a><span id="l4.777">   StrCpy $1 &quot;$\&quot;$8$\&quot; $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.778"></a><span id="l4.778" class="difflineminus">-  ${AddHandlerValues} &quot;$0\SeaMonkeyEML&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;${AppRegNameMail} Document&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.779"></a><span id="l4.779" class="difflineplus">+  ${AddHandlerValues} &quot;$0\SeaMonkeyEML&quot; &quot;$1&quot; &quot;$INSTDIR\chrome\icons\default\misc-file.ico&quot; &quot;${AppRegNameMail} Document&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l4.780"></a><span id="l4.780"> </span>
<a href="#l4.781"></a><span id="l4.781">   StrCpy $1 &quot;$\&quot;$8$\&quot; -mail $\&quot;%1$\&quot;&quot;</span>
<a href="#l4.782"></a><span id="l4.782">   ${AddHandlerValues} &quot;$0\SeaMonkeyNEWS&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;${AppRegNameNews} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l4.783"></a><span id="l4.783"> </span>
<a href="#l4.784"></a><span id="l4.784">   ReadRegStr $2 SHCTX &quot;$0\news\shell\open\command&quot; &quot;&quot;</span>
<a href="#l4.785"></a><span id="l4.785">   ${GetPathFromString} &quot;$2&quot; $3</span>
<a href="#l4.786"></a><span id="l4.786">   GetFullPathName $2 &quot;$3&quot;</span>
<a href="#l4.787"></a><span id="l4.787">   ClearErrors</span>
<a href="#l4.788"></a><span id="l4.788" class="difflineat">@@ -600,8 +939,66 @@</span>
<a href="#l4.789"></a><span id="l4.789">   ClearErrors</span>
<a href="#l4.790"></a><span id="l4.790">   ${WordFind} &quot;$2&quot; &quot;${FileMainEXE}&quot; &quot;E+1{&quot; $R1</span>
<a href="#l4.791"></a><span id="l4.791">   ${Unless} ${Errors}</span>
<a href="#l4.792"></a><span id="l4.792">     DeleteRegKey HKLM &quot;$0\.eml\DefaultIcon&quot;</span>
<a href="#l4.793"></a><span id="l4.793">   ${EndUnless}</span>
<a href="#l4.794"></a><span id="l4.794"> </span>
<a href="#l4.795"></a><span id="l4.795"> !macroend</span>
<a href="#l4.796"></a><span id="l4.796"> !define FixClassKeys &quot;!insertmacro FixClassKeys&quot;</span>
<a href="#l4.797"></a><span id="l4.797" class="difflineplus">+</span>
<a href="#l4.798"></a><span id="l4.798" class="difflineplus">+; The files to check if they are in use during (un)install so the restart is</span>
<a href="#l4.799"></a><span id="l4.799" class="difflineplus">+; required message is displayed. All files must be located in the $INSTDIR</span>
<a href="#l4.800"></a><span id="l4.800" class="difflineplus">+; directory.</span>
<a href="#l4.801"></a><span id="l4.801" class="difflineplus">+!macro PushFilesToCheck</span>
<a href="#l4.802"></a><span id="l4.802" class="difflineplus">+  ; The first string to be pushed onto the stack MUST be &quot;end&quot; to indicate</span>
<a href="#l4.803"></a><span id="l4.803" class="difflineplus">+  ; that there are no more files to check in $INSTDIR and the last string</span>
<a href="#l4.804"></a><span id="l4.804" class="difflineplus">+  ; should be ${FileMainEXE} so if it is in use the CheckForFilesInUse macro</span>
<a href="#l4.805"></a><span id="l4.805" class="difflineplus">+  ; returns after the first check.</span>
<a href="#l4.806"></a><span id="l4.806" class="difflineplus">+  Push &quot;end&quot;</span>
<a href="#l4.807"></a><span id="l4.807" class="difflineplus">+  Push &quot;AccessibleMarshal.dll&quot;</span>
<a href="#l4.808"></a><span id="l4.808" class="difflineplus">+  Push &quot;freebl3.dll&quot;</span>
<a href="#l4.809"></a><span id="l4.809" class="difflineplus">+  Push &quot;nssckbi.dll&quot;</span>
<a href="#l4.810"></a><span id="l4.810" class="difflineplus">+  Push &quot;nspr4.dll&quot;</span>
<a href="#l4.811"></a><span id="l4.811" class="difflineplus">+  Push &quot;nssdbm3.dll&quot;</span>
<a href="#l4.812"></a><span id="l4.812" class="difflineplus">+  Push &quot;sqlite3.dll&quot;</span>
<a href="#l4.813"></a><span id="l4.813" class="difflineplus">+  Push &quot;xpcom.dll&quot;</span>
<a href="#l4.814"></a><span id="l4.814" class="difflineplus">+  Push &quot;crashreporter.exe&quot;</span>
<a href="#l4.815"></a><span id="l4.815" class="difflineplus">+  Push &quot;updater.exe&quot;</span>
<a href="#l4.816"></a><span id="l4.816" class="difflineplus">+  Push &quot;xpicleanup.exe&quot;</span>
<a href="#l4.817"></a><span id="l4.817" class="difflineplus">+  Push &quot;MapiProxy.dll&quot;</span>
<a href="#l4.818"></a><span id="l4.818" class="difflineplus">+  Push &quot;mozMapi32.dll&quot;</span>
<a href="#l4.819"></a><span id="l4.819" class="difflineplus">+  Push &quot;${FileMainEXE}&quot;</span>
<a href="#l4.820"></a><span id="l4.820" class="difflineplus">+!macroend</span>
<a href="#l4.821"></a><span id="l4.821" class="difflineplus">+!define PushFilesToCheck &quot;!insertmacro PushFilesToCheck&quot;</span>
<a href="#l4.822"></a><span id="l4.822" class="difflineplus">+</span>
<a href="#l4.823"></a><span id="l4.823" class="difflineplus">+; The !ifdef NO_LOG prevents warnings when compiling the installer since these</span>
<a href="#l4.824"></a><span id="l4.824" class="difflineplus">+; functions are currently only used by the uninstaller.</span>
<a href="#l4.825"></a><span id="l4.825" class="difflineplus">+!ifdef NO_LOG</span>
<a href="#l4.826"></a><span id="l4.826" class="difflineplus">+Function SetAsDefaultMailAppUser</span>
<a href="#l4.827"></a><span id="l4.827" class="difflineplus">+  SetShellVarContext current  ; Set SHCTX to the current user (e.g. HKCU)</span>
<a href="#l4.828"></a><span id="l4.828" class="difflineplus">+  ${SetHandlersMail}</span>
<a href="#l4.829"></a><span id="l4.829" class="difflineplus">+  ${If} ${AtLeastWinVista}</span>
<a href="#l4.830"></a><span id="l4.830" class="difflineplus">+    ClearErrors</span>
<a href="#l4.831"></a><span id="l4.831" class="difflineplus">+    ReadRegStr $0 HKLM &quot;Software\RegisteredApplications&quot; &quot;${AppRegNameMail}&quot;</span>
<a href="#l4.832"></a><span id="l4.832" class="difflineplus">+    ; Only register as the handler on Vista if the app registry name exists</span>
<a href="#l4.833"></a><span id="l4.833" class="difflineplus">+    ; under the RegisteredApplications registry key.</span>
<a href="#l4.834"></a><span id="l4.834" class="difflineplus">+    ${Unless} ${Errors}</span>
<a href="#l4.835"></a><span id="l4.835" class="difflineplus">+      AppAssocReg::SetAppAsDefaultAll &quot;${AppRegNameMail}&quot;</span>
<a href="#l4.836"></a><span id="l4.836" class="difflineplus">+    ${EndUnless}</span>
<a href="#l4.837"></a><span id="l4.837" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.838"></a><span id="l4.838" class="difflineplus">+FunctionEnd</span>
<a href="#l4.839"></a><span id="l4.839" class="difflineplus">+</span>
<a href="#l4.840"></a><span id="l4.840" class="difflineplus">+Function SetAsDefaultNewsAppUser</span>
<a href="#l4.841"></a><span id="l4.841" class="difflineplus">+  SetShellVarContext current  ; Set SHCTX to the current user (e.g. HKCU)</span>
<a href="#l4.842"></a><span id="l4.842" class="difflineplus">+  ${SetHandlersNews}</span>
<a href="#l4.843"></a><span id="l4.843" class="difflineplus">+  ${If} ${AtLeastWinVista}</span>
<a href="#l4.844"></a><span id="l4.844" class="difflineplus">+    ClearErrors</span>
<a href="#l4.845"></a><span id="l4.845" class="difflineplus">+    ReadRegStr $0 HKLM &quot;Software\RegisteredApplications&quot; &quot;${AppRegNameNews}&quot;</span>
<a href="#l4.846"></a><span id="l4.846" class="difflineplus">+    ; Only register as the handler on Vista if the app registry name exists</span>
<a href="#l4.847"></a><span id="l4.847" class="difflineplus">+    ; under the RegisteredApplications registry key.</span>
<a href="#l4.848"></a><span id="l4.848" class="difflineplus">+    ${Unless} ${Errors}</span>
<a href="#l4.849"></a><span id="l4.849" class="difflineplus">+      AppAssocReg::SetAppAsDefaultAll &quot;${AppRegNameNews}&quot;</span>
<a href="#l4.850"></a><span id="l4.850" class="difflineplus">+    ${EndUnless}</span>
<a href="#l4.851"></a><span id="l4.851" class="difflineplus">+  ${EndIf}</span>
<a href="#l4.852"></a><span id="l4.852" class="difflineplus">+FunctionEnd</span>
<a href="#l4.853"></a><span id="l4.853" class="difflineplus">+!endif</span>
<a href="#l4.854"></a><span id="l4.854" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/installer/windows/nsis/uninstaller.nsi</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/installer/windows/nsis/uninstaller.nsi</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -31,79 +31,108 @@</span>
<a href="#l5.4"></a><span id="l5.4"> # decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.5"></a><span id="l5.5"> # and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.6"></a><span id="l5.6"> # the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.7"></a><span id="l5.7"> # the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.8"></a><span id="l5.8"> #</span>
<a href="#l5.9"></a><span id="l5.9"> # ***** END LICENSE BLOCK *****</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> # Also requires:</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-# ShellLink plugin http://nsis.sourceforge.net/ShellLink_plug-in</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+# AppAssocReg http://nsis.sourceforge.net/Application_Association_Registration_plug-in</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+# ShellLink   http://nsis.sourceforge.net/ShellLink_plug-in</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+# UAC         http://nsis.sourceforge.net/UAC_plug-in</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> ; Set verbosity to 3 (e.g. no script) to lessen the noise in the build logs</span>
<a href="#l5.19"></a><span id="l5.19"> !verbose 3</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21"> ; 7-Zip provides better compression than the lzma from NSIS so we add the files</span>
<a href="#l5.22"></a><span id="l5.22"> ; uncompressed and use 7-Zip to create a SFX archive of it</span>
<a href="#l5.23"></a><span id="l5.23"> SetDatablockOptimize on</span>
<a href="#l5.24"></a><span id="l5.24"> SetCompress off</span>
<a href="#l5.25"></a><span id="l5.25"> CRCCheck on</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+RequestExecutionLevel user</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+</span>
<a href="#l5.29"></a><span id="l5.29"> !addplugindir ./</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+; USE_UAC_PLUGIN is temporary until other apps have been updated to use the UAC plugin</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+!define USE_UAC_PLUGIN</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+</span>
<a href="#l5.34"></a><span id="l5.34"> ; prevents compiling of the reg write logging.</span>
<a href="#l5.35"></a><span id="l5.35"> !define NO_LOG</span>
<a href="#l5.36"></a><span id="l5.36"> </span>
<a href="#l5.37"></a><span id="l5.37"> Var TmpVal</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39"> ; Other included files may depend upon these includes!</span>
<a href="#l5.40"></a><span id="l5.40"> ; The following includes are provided by NSIS.</span>
<a href="#l5.41"></a><span id="l5.41"> !include FileFunc.nsh</span>
<a href="#l5.42"></a><span id="l5.42"> !include LogicLib.nsh</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+!include MUI.nsh</span>
<a href="#l5.44"></a><span id="l5.44"> !include TextFunc.nsh</span>
<a href="#l5.45"></a><span id="l5.45"> !include WinMessages.nsh</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+!include WinVer.nsh</span>
<a href="#l5.47"></a><span id="l5.47"> !include WordFunc.nsh</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-!include MUI.nsh</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50"> !insertmacro GetOptions</span>
<a href="#l5.51"></a><span id="l5.51"> !insertmacro GetParameters</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+!insertmacro GetParent</span>
<a href="#l5.53"></a><span id="l5.53"> !insertmacro StrFilter</span>
<a href="#l5.54"></a><span id="l5.54"> !insertmacro WordFind</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-!insertmacro WordReplace</span>
<a href="#l5.56"></a><span id="l5.56"> </span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-!insertmacro un.LineFind</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-!insertmacro un.TrimNewLines</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+!insertmacro un.GetParent</span>
<a href="#l5.60"></a><span id="l5.60"> </span>
<a href="#l5.61"></a><span id="l5.61"> ; The following includes are custom.</span>
<a href="#l5.62"></a><span id="l5.62"> !include branding.nsi</span>
<a href="#l5.63"></a><span id="l5.63"> !include defines.nsi</span>
<a href="#l5.64"></a><span id="l5.64"> !include common.nsh</span>
<a href="#l5.65"></a><span id="l5.65"> !include locales.nsi</span>
<a href="#l5.66"></a><span id="l5.66"> !include version.nsh</span>
<a href="#l5.67"></a><span id="l5.67"> </span>
<a href="#l5.68"></a><span id="l5.68"> ; This is named BrandShortName helper because we use this for software update</span>
<a href="#l5.69"></a><span id="l5.69"> ; post update cleanup.</span>
<a href="#l5.70"></a><span id="l5.70"> VIAddVersionKey &quot;FileDescription&quot; &quot;${BrandShortName} Helper&quot;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+VIAddVersionKey &quot;OriginalFilename&quot; &quot;helper.exe&quot;</span>
<a href="#l5.72"></a><span id="l5.72"> </span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+!insertmacro AddDDEHandlerValues</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+!insertmacro AddHandlerValues</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+!insertmacro CleanVirtualStore</span>
<a href="#l5.76"></a><span id="l5.76"> !insertmacro GetLongPath</span>
<a href="#l5.77"></a><span id="l5.77"> !insertmacro GetPathFromString</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-!insertmacro AddHandlerValues</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+!insertmacro IsHandlerForInstallDir</span>
<a href="#l5.80"></a><span id="l5.80"> !insertmacro RegCleanMain</span>
<a href="#l5.81"></a><span id="l5.81"> !insertmacro RegCleanUninstall</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-!insertmacro WriteRegStr2</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+!insertmacro UnloadUAC</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+!insertmacro WordReplace</span>
<a href="#l5.85"></a><span id="l5.85"> !insertmacro WriteRegDWORD2</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+!insertmacro WriteRegStr2</span>
<a href="#l5.87"></a><span id="l5.87"> </span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+!insertmacro un.ChangeMUIHeaderImage</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+!insertmacro un.CheckForFilesInUse</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+!insertmacro un.CleanUpdatesDir</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+!insertmacro un.CleanVirtualStore</span>
<a href="#l5.92"></a><span id="l5.92"> !insertmacro un.GetLongPath</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+!insertmacro un.GetSecondInstallPath</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+!insertmacro un.ManualCloseAppPrompt</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+!insertmacro un.ParseUninstallLog</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+!insertmacro un.RegCleanAppHandler</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+!insertmacro un.RegCleanFileHandler</span>
<a href="#l5.98"></a><span id="l5.98"> !insertmacro un.RegCleanMain</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+!insertmacro un.RegCleanProtocolHandler</span>
<a href="#l5.100"></a><span id="l5.100"> !insertmacro un.RegCleanUninstall</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-!insertmacro un.CloseApp</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-!insertmacro un.GetSecondInstallPath</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+!insertmacro un.RemoveQuotesFromPath</span>
<a href="#l5.104"></a><span id="l5.104"> </span>
<a href="#l5.105"></a><span id="l5.105"> !include shared.nsh</span>
<a href="#l5.106"></a><span id="l5.106"> </span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+; Helper macros for ui callbacks. Insert these after shared.nsh</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+!insertmacro OnEndCommon</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+!insertmacro UninstallOnInitCommon</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+!insertmacro un.OnEndCommon</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+</span>
<a href="#l5.113"></a><span id="l5.113"> Name &quot;${BrandFullName}&quot;</span>
<a href="#l5.114"></a><span id="l5.114"> OutFile &quot;helper.exe&quot;</span>
<a href="#l5.115"></a><span id="l5.115"> InstallDirRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${BrandFullNameInternal} (${AppVersion})&quot; &quot;InstallLocation&quot;</span>
<a href="#l5.116"></a><span id="l5.116"> InstallDir &quot;$PROGRAMFILES\${BrandFullName}&quot;</span>
<a href="#l5.117"></a><span id="l5.117"> ShowUnInstDetails nevershow</span>
<a href="#l5.118"></a><span id="l5.118"> </span>
<a href="#l5.119"></a><span id="l5.119"> ################################################################################</span>
<a href="#l5.120"></a><span id="l5.120"> # Modern User Interface - MUI</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineat">@@ -122,273 +151,234 @@ ShowUnInstDetails nevershow</span>
<a href="#l5.122"></a><span id="l5.122"> !else</span>
<a href="#l5.123"></a><span id="l5.123"> !define MUI_HEADERIMAGE_BITMAP wizHeader.bmp</span>
<a href="#l5.124"></a><span id="l5.124"> !endif</span>
<a href="#l5.125"></a><span id="l5.125"> </span>
<a href="#l5.126"></a><span id="l5.126"> /**</span>
<a href="#l5.127"></a><span id="l5.127">  * Uninstall Pages</span>
<a href="#l5.128"></a><span id="l5.128">  */</span>
<a href="#l5.129"></a><span id="l5.129"> ; Welcome Page</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+!define MUI_PAGE_CUSTOMFUNCTION_PRE un.preWelcome</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineplus">+!define MUI_PAGE_CUSTOMFUNCTION_LEAVE un.leaveWelcome</span>
<a href="#l5.132"></a><span id="l5.132"> !insertmacro MUI_UNPAGE_WELCOME</span>
<a href="#l5.133"></a><span id="l5.133"> </span>
<a href="#l5.134"></a><span id="l5.134"> ; Uninstall Confirm Page</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-!insertmacro MUI_UNPAGE_CONFIRM</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineplus">+UninstPage custom un.preConfirm un.leaveConfirm</span>
<a href="#l5.137"></a><span id="l5.137"> </span>
<a href="#l5.138"></a><span id="l5.138"> ; Remove Files Page</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-!define MUI_PAGE_CUSTOMFUNCTION_PRE un.preInstFiles</span>
<a href="#l5.140"></a><span id="l5.140"> !insertmacro MUI_UNPAGE_INSTFILES</span>
<a href="#l5.141"></a><span id="l5.141"> </span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-; Finish Page</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+; Don't setup the survey controls, functions, etc. when the application has</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+; defined NO_UNINSTALL_SURVEY</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+!ifndef NO_UNINSTALL_SURVEY</span>
<a href="#l5.146"></a><span id="l5.146"> !define MUI_PAGE_CUSTOMFUNCTION_PRE un.preFinish</span>
<a href="#l5.147"></a><span id="l5.147"> !define MUI_FINISHPAGE_SHOWREADME_NOTCHECKED</span>
<a href="#l5.148"></a><span id="l5.148"> !define MUI_FINISHPAGE_SHOWREADME &quot;&quot;</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-; Setup the survey controls, functions, etc. except when the application has</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineminus">-; defined NO_UNINSTALL_SURVEY</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-!ifndef NO_UNINSTALL_SURVEY</span>
<a href="#l5.153"></a><span id="l5.153"> !define MUI_FINISHPAGE_SHOWREADME_TEXT $(SURVEY_TEXT)</span>
<a href="#l5.154"></a><span id="l5.154"> !define MUI_FINISHPAGE_SHOWREADME_FUNCTION un.Survey</span>
<a href="#l5.155"></a><span id="l5.155"> !endif</span>
<a href="#l5.156"></a><span id="l5.156"> </span>
<a href="#l5.157"></a><span id="l5.157"> !insertmacro MUI_UNPAGE_FINISH</span>
<a href="#l5.158"></a><span id="l5.158"> </span>
<a href="#l5.159"></a><span id="l5.159" class="difflineplus">+; Use the default dialog for IDD_VERIFY for a simple Banner</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+ChangeUI IDD_VERIFY &quot;${NSISDIR}\Contrib\UIs\default.exe&quot;</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+</span>
<a href="#l5.162"></a><span id="l5.162"> ################################################################################</span>
<a href="#l5.163"></a><span id="l5.163"> # Install Sections</span>
<a href="#l5.164"></a><span id="l5.164"> ; Empty section required for the installer to compile as an uninstaller</span>
<a href="#l5.165"></a><span id="l5.165"> Section &quot;&quot;</span>
<a href="#l5.166"></a><span id="l5.166"> SectionEnd</span>
<a href="#l5.167"></a><span id="l5.167"> </span>
<a href="#l5.168"></a><span id="l5.168"> ################################################################################</span>
<a href="#l5.169"></a><span id="l5.169"> # Uninstall Sections</span>
<a href="#l5.170"></a><span id="l5.170"> </span>
<a href="#l5.171"></a><span id="l5.171"> Section &quot;Uninstall&quot;</span>
<a href="#l5.172"></a><span id="l5.172">   SetDetailsPrint textonly</span>
<a href="#l5.173"></a><span id="l5.173">   DetailPrint $(STATUS_UNINSTALL_MAIN)</span>
<a href="#l5.174"></a><span id="l5.174">   SetDetailsPrint none</span>
<a href="#l5.175"></a><span id="l5.175"> </span>
<a href="#l5.176"></a><span id="l5.176" class="difflineminus">-  ; Remove registry entries for non-existent apps and for apps that point to our</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineminus">-  ; install location in the Software\Mozilla key and uninstall registry entries</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineminus">-  ; that point to our install location for both HKCU and HKLM.</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineminus">-  SetShellVarContext current  ; Sets SHCTX to HKCU</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineplus">+  ; Delete the app exe to prevent launching the app while we are uninstalling.</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineplus">+  ClearErrors</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineplus">+  ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineplus">+    ; If the user closed the application it can take several seconds for it to</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineplus">+    ; shut down completely. If the application is being used by another user we</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineplus">+    ; can still delete the files when the system is restarted.</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineplus">+    Sleep 5000</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineplus">+    ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineplus">+    ClearErrors</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineplus">+</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineplus">+  SetShellVarContext current  ; Set SHCTX to HKCU</span>
<a href="#l5.193"></a><span id="l5.193">   ${un.RegCleanMain} &quot;Software\Mozilla&quot;</span>
<a href="#l5.194"></a><span id="l5.194">   ${un.RegCleanUninstall}</span>
<a href="#l5.195"></a><span id="l5.195"> </span>
<a href="#l5.196"></a><span id="l5.196" class="difflineminus">-  SetShellVarContext all  ; Sets SHCTX to HKLM</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineminus">-  ${un.RegCleanMain} &quot;Software\Mozilla&quot;</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineminus">-  ${un.RegCleanUninstall}</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineplus">+  ClearErrors</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+  WriteRegStr HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot; &quot;Write Test&quot;</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineplus">+    StrCpy $TmpVal &quot;HKCU&quot; ; used primarily for logging</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineplus">+  ${Else}</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineplus">+    SetShellVarContext all  ; Set SHCTX to HKLM</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineplus">+    DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineplus">+    StrCpy $TmpVal &quot;HKLM&quot; ; used primarily for logging</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+    ${un.RegCleanMain} &quot;Software\Mozilla&quot;</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineplus">+    ${un.RegCleanUninstall}</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineplus">+  ${un.RegCleanAppHandler} &quot;SeaMonkeyURL&quot;</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+  ${un.RegCleanAppHandler} &quot;SeaMonkeyHTML&quot;</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineplus">+  ${un.RegCleanAppHandler} &quot;SeaMonkeyMAIL&quot;</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineplus">+  ${un.RegCleanAppHandler} &quot;SeaMonkeyNEWS&quot;</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineplus">+  ${un.RegCleanAppHandler} &quot;SeaMonkeyEML&quot;</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineplus">+  ${un.RegCleanProtocolHandler} &quot;http&quot;</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineplus">+  ${un.RegCleanProtocolHandler} &quot;https&quot;</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineplus">+  ${un.RegCleanProtocolHandler} &quot;ftp&quot;</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineplus">+  ${un.RegCleanProtocolHandler} &quot;mailto&quot;</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineplus">+  ${un.RegCleanProtocolHandler} &quot;news&quot;</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineplus">+  ${un.RegCleanProtocolHandler} &quot;nntp&quot;</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineplus">+  ${un.RegCleanProtocolHandler} &quot;snews&quot;</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineplus">+</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineplus">+  ClearErrors</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineplus">+  ReadRegStr $R9 HKCR &quot;SeaMonkeyEML&quot; &quot;&quot;</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineplus">+  ; Don't clean up the file handlers if the SeaMonkeyEML key still exists since</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineplus">+  ; there could be a second installation that may be the default file handler</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineplus">+    ${un.RegCleanFileHandler}  &quot;.eml&quot;   &quot;SeaMonkeyEML&quot;</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineplus">+</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineplus">+  ClearErrors</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineplus">+  ReadRegStr $R9 HKCR &quot;SeaMonkeyHTML&quot; &quot;&quot;</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineplus">+  ; Don't clean up the file handlers if the SeaMonkeyHTML key still exists since</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineplus">+  ; there could be a second installation that may be the default file handler</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineplus">+    ${un.RegCleanFileHandler}  &quot;.htm&quot;   &quot;SeaMonkeyHTML&quot;</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineplus">+    ${un.RegCleanFileHandler}  &quot;.html&quot;  &quot;SeaMonkeyHTML&quot;</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineplus">+    ${un.RegCleanFileHandler}  &quot;.shtml&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineplus">+    ${un.RegCleanFileHandler}  &quot;.xht&quot;   &quot;SeaMonkeyHTML&quot;</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineplus">+    ${un.RegCleanFileHandler}  &quot;.xhtml&quot; &quot;SeaMonkeyHTML&quot;</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.243"></a><span id="l5.243"> </span>
<a href="#l5.244"></a><span id="l5.244">   SetShellVarContext all  ; Set SHCTX to HKLM</span>
<a href="#l5.245"></a><span id="l5.245">   ${un.GetSecondInstallPath} &quot;Software\Mozilla&quot; $R9</span>
<a href="#l5.246"></a><span id="l5.246">   ${If} $R9 == &quot;false&quot;</span>
<a href="#l5.247"></a><span id="l5.247">     SetShellVarContext current  ; Set SHCTX to HKCU</span>
<a href="#l5.248"></a><span id="l5.248">     ${un.GetSecondInstallPath} &quot;Software\Mozilla&quot; $R9</span>
<a href="#l5.249"></a><span id="l5.249">   ${EndIf}</span>
<a href="#l5.250"></a><span id="l5.250"> </span>
<a href="#l5.251"></a><span id="l5.251">   StrCpy $0 &quot;Software\Clients\StartMenuInternet\${FileMainEXE}\shell\open\command&quot;</span>
<a href="#l5.252"></a><span id="l5.252" class="difflineminus">-  ReadRegStr $1 HKLM &quot;$0&quot; &quot;&quot;</span>
<a href="#l5.253"></a><span id="l5.253" class="difflineminus">-  Push $1</span>
<a href="#l5.254"></a><span id="l5.254" class="difflineminus">-  ${GetPathFromRegStr}</span>
<a href="#l5.255"></a><span id="l5.255" class="difflineminus">-  Pop $R0</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineminus">-  Push $R0</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineminus">-  ${GetParentDir}</span>
<a href="#l5.258"></a><span id="l5.258" class="difflineminus">-  Pop $R1</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineplus">+  ReadRegStr $R1 HKLM &quot;$0&quot; &quot;&quot;</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineplus">+  ${un.RemoveQuotesFromPath} &quot;$R1&quot; $R1</span>
<a href="#l5.261"></a><span id="l5.261" class="difflineplus">+  ${un.GetParent} &quot;$R1&quot; $R1</span>
<a href="#l5.262"></a><span id="l5.262"> </span>
<a href="#l5.263"></a><span id="l5.263">   ; Only remove the StartMenuInternet key if it refers to this install location.</span>
<a href="#l5.264"></a><span id="l5.264">   ; The StartMenuInternet registry key is independent of the default browser</span>
<a href="#l5.265"></a><span id="l5.265">   ; settings. The XPInstall base un-installer always removes this key if it is</span>
<a href="#l5.266"></a><span id="l5.266">   ; uninstalling the default browser and it will always replace the keys when</span>
<a href="#l5.267"></a><span id="l5.267">   ; installing even if there is another install of SeaMonkey that is set as the</span>
<a href="#l5.268"></a><span id="l5.268">   ; default browser. Now the key is always updated on install but it is only</span>
<a href="#l5.269"></a><span id="l5.269">   ; removed if it refers to this install location.</span>
<a href="#l5.270"></a><span id="l5.270">   ${If} &quot;$INSTDIR&quot; == &quot;$R1&quot;</span>
<a href="#l5.271"></a><span id="l5.271" class="difflineminus">-    ; XXXrstrong - if there is another installation of the same app ideally we</span>
<a href="#l5.272"></a><span id="l5.272" class="difflineminus">-    ; would just modify these values. The GetSecondInstallPath macro could be</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineminus">-    ; made to provide enough information to do this.</span>
<a href="#l5.274"></a><span id="l5.274">     DeleteRegKey HKLM &quot;Software\Clients\StartMenuInternet\${FileMainEXE}&quot;</span>
<a href="#l5.275"></a><span id="l5.275">     DeleteRegValue HKLM &quot;Software\RegisteredApplications&quot; &quot;${AppRegName}&quot;</span>
<a href="#l5.276"></a><span id="l5.276">   ${EndIf}</span>
<a href="#l5.277"></a><span id="l5.277"> </span>
<a href="#l5.278"></a><span id="l5.278">   StrCpy $0 &quot;Software\Clients\Mail\${BrandFullNameInternal}\shell\open\command&quot;</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineminus">-  ReadRegStr $1 HKLM &quot;$0&quot; &quot;&quot;</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineminus">-  Push $1</span>
<a href="#l5.281"></a><span id="l5.281" class="difflineminus">-  ${GetPathFromRegStr}</span>
<a href="#l5.282"></a><span id="l5.282" class="difflineminus">-  Pop $R0</span>
<a href="#l5.283"></a><span id="l5.283" class="difflineminus">-  Push $R0</span>
<a href="#l5.284"></a><span id="l5.284" class="difflineminus">-  ${GetParentDir}</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineminus">-  Pop $R1</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineplus">+  ReadRegStr $R1 HKLM &quot;$0&quot; &quot;&quot;</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineplus">+  ${un.RemoveQuotesFromPath} &quot;$R1&quot; $R1</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineplus">+  ${un.GetParent} &quot;$R1&quot; $R1</span>
<a href="#l5.289"></a><span id="l5.289"> </span>
<a href="#l5.290"></a><span id="l5.290">   ; Only remove the Clients\Mail and Clients\News key if it refers to this</span>
<a href="#l5.291"></a><span id="l5.291">   ; install location. The Clients\Mail &amp; Clients\News keys are independent</span>
<a href="#l5.292"></a><span id="l5.292">   ; of the default app for the OS settings. The XPInstall base un-installer</span>
<a href="#l5.293"></a><span id="l5.293">   ; always removes these keys if it is uninstalling the default app and it</span>
<a href="#l5.294"></a><span id="l5.294">   ; will always replace the keys when installing even if there is another</span>
<a href="#l5.295"></a><span id="l5.295">   ; install of SeaMonkey that is set as the default app. Now the keys are always</span>
<a href="#l5.296"></a><span id="l5.296">   ; updated on install but are only removed if they refer to this install</span>
<a href="#l5.297"></a><span id="l5.297">   ; location.</span>
<a href="#l5.298"></a><span id="l5.298">   ${If} &quot;$INSTDIR&quot; == &quot;$R1&quot;</span>
<a href="#l5.299"></a><span id="l5.299" class="difflineminus">-    ; XXXrstrong - if there is another installation of the same app ideally we</span>
<a href="#l5.300"></a><span id="l5.300" class="difflineminus">-    ; would just modify these values. The GetSecondInstallPath macro could be</span>
<a href="#l5.301"></a><span id="l5.301" class="difflineminus">-    ; made to provide enough information to do this.</span>
<a href="#l5.302"></a><span id="l5.302">     DeleteRegKey HKLM &quot;Software\Clients\Mail\${BrandFullNameInternal}&quot;</span>
<a href="#l5.303"></a><span id="l5.303">     DeleteRegKey HKLM &quot;Software\Clients\News\${BrandFullNameInternal}&quot;</span>
<a href="#l5.304"></a><span id="l5.304">     DeleteRegValue HKLM &quot;Software\RegisteredApplications&quot; &quot;${AppRegNameMail}&quot;</span>
<a href="#l5.305"></a><span id="l5.305">     DeleteRegValue HKLM &quot;Software\RegisteredApplications&quot; &quot;${AppRegNameNews}&quot;</span>
<a href="#l5.306"></a><span id="l5.306">   ${EndIf}</span>
<a href="#l5.307"></a><span id="l5.307"> </span>
<a href="#l5.308"></a><span id="l5.308">   StrCpy $0 &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\${FileMainEXE}&quot;</span>
<a href="#l5.309"></a><span id="l5.309">   ${If} $R9 == &quot;false&quot;</span>
<a href="#l5.310"></a><span id="l5.310">     DeleteRegKey HKLM &quot;$0&quot;</span>
<a href="#l5.311"></a><span id="l5.311">     DeleteRegKey HKCU &quot;$0&quot;</span>
<a href="#l5.312"></a><span id="l5.312">     StrCpy $0 &quot;Software\Microsoft\MediaPlayer\ShimInclusionList\${FileMainEXE}&quot;</span>
<a href="#l5.313"></a><span id="l5.313">     DeleteRegKey HKLM &quot;$0&quot;</span>
<a href="#l5.314"></a><span id="l5.314">     DeleteRegKey HKCU &quot;$0&quot;</span>
<a href="#l5.315"></a><span id="l5.315">   ${Else}</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineminus">-    ReadRegStr $1 HKLM &quot;$0&quot; &quot;&quot;</span>
<a href="#l5.317"></a><span id="l5.317" class="difflineminus">-    Push $1</span>
<a href="#l5.318"></a><span id="l5.318" class="difflineminus">-    ${GetPathFromRegStr}</span>
<a href="#l5.319"></a><span id="l5.319" class="difflineminus">-    Pop $R0</span>
<a href="#l5.320"></a><span id="l5.320" class="difflineminus">-    Push $R0</span>
<a href="#l5.321"></a><span id="l5.321" class="difflineminus">-    ${GetParentDir}</span>
<a href="#l5.322"></a><span id="l5.322" class="difflineminus">-    Pop $R1</span>
<a href="#l5.323"></a><span id="l5.323" class="difflineplus">+    ReadRegStr $R1 HKLM &quot;$0&quot; &quot;&quot;</span>
<a href="#l5.324"></a><span id="l5.324" class="difflineplus">+    ${un.RemoveQuotesFromPath} &quot;$R1&quot; $R1</span>
<a href="#l5.325"></a><span id="l5.325" class="difflineplus">+    ${un.GetParent} &quot;$R1&quot; $R1</span>
<a href="#l5.326"></a><span id="l5.326">     ${If} &quot;$INSTDIR&quot; == &quot;$R1&quot;</span>
<a href="#l5.327"></a><span id="l5.327">       WriteRegStr HKLM &quot;$0&quot; &quot;&quot; &quot;$R9&quot;</span>
<a href="#l5.328"></a><span id="l5.328" class="difflineminus">-      Push $R9</span>
<a href="#l5.329"></a><span id="l5.329" class="difflineminus">-      ${GetParentDir}</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineminus">-      Pop $R1</span>
<a href="#l5.331"></a><span id="l5.331" class="difflineplus">+      ${un.GetParent} &quot;$R9&quot; $R1</span>
<a href="#l5.332"></a><span id="l5.332">       WriteRegStr HKLM &quot;$0&quot; &quot;Path&quot; &quot;$R1&quot;</span>
<a href="#l5.333"></a><span id="l5.333">     ${EndIf}</span>
<a href="#l5.334"></a><span id="l5.334">   ${EndIf}</span>
<a href="#l5.335"></a><span id="l5.335"> </span>
<a href="#l5.336"></a><span id="l5.336" class="difflineminus">-  ; Remove files. If we don't have a log file skip</span>
<a href="#l5.337"></a><span id="l5.337" class="difflineminus">-  ${If} ${FileExists} &quot;$INSTDIR\uninstall\uninstall.log&quot;</span>
<a href="#l5.338"></a><span id="l5.338" class="difflineminus">-    ; Copy the uninstall log file to a temporary file</span>
<a href="#l5.339"></a><span id="l5.339" class="difflineminus">-    GetTempFileName $TmpVal</span>
<a href="#l5.340"></a><span id="l5.340" class="difflineminus">-    CopyFiles &quot;$INSTDIR\uninstall\uninstall.log&quot; &quot;$TmpVal&quot;</span>
<a href="#l5.341"></a><span id="l5.341" class="difflineminus">-</span>
<a href="#l5.342"></a><span id="l5.342" class="difflineminus">-    ; Unregister DLL's</span>
<a href="#l5.343"></a><span id="l5.343" class="difflineminus">-    ${un.LineFind} &quot;$TmpVal&quot; &quot;/NUL&quot; &quot;1:-1&quot; &quot;un.UnRegDLLsCallback&quot;</span>
<a href="#l5.344"></a><span id="l5.344" class="difflineminus">-</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineminus">-    ; Delete files</span>
<a href="#l5.346"></a><span id="l5.346" class="difflineminus">-    ${un.LineFind} &quot;$TmpVal&quot; &quot;/NUL&quot; &quot;1:-1&quot; &quot;un.RemoveFilesCallback&quot;</span>
<a href="#l5.347"></a><span id="l5.347" class="difflineminus">-</span>
<a href="#l5.348"></a><span id="l5.348" class="difflineminus">-    ; Remove directories we always control</span>
<a href="#l5.349"></a><span id="l5.349" class="difflineminus">-    RmDir /r &quot;$INSTDIR\uninstall&quot;</span>
<a href="#l5.350"></a><span id="l5.350" class="difflineminus">-    RmDir /r &quot;$INSTDIR\updates&quot;</span>
<a href="#l5.351"></a><span id="l5.351" class="difflineminus">-    RmDir /r &quot;$INSTDIR\defaults\shortcuts&quot;</span>
<a href="#l5.352"></a><span id="l5.352" class="difflineminus">-</span>
<a href="#l5.353"></a><span id="l5.353" class="difflineminus">-    ; Remove empty directories</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineminus">-    ${un.LineFind} &quot;$TmpVal&quot; &quot;/NUL&quot; &quot;1:-1&quot; &quot;un.RemoveDirsCallback&quot;</span>
<a href="#l5.355"></a><span id="l5.355" class="difflineminus">-</span>
<a href="#l5.356"></a><span id="l5.356" class="difflineminus">-    ; Delete the temporary uninstall log file</span>
<a href="#l5.357"></a><span id="l5.357" class="difflineminus">-    ${DeleteFile} &quot;$TmpVal&quot;</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineminus">-</span>
<a href="#l5.359"></a><span id="l5.359" class="difflineminus">-    ; Remove the installation directory if it is empty</span>
<a href="#l5.360"></a><span id="l5.360" class="difflineminus">-    ${RemoveDir} &quot;$INSTDIR&quot;</span>
<a href="#l5.361"></a><span id="l5.361" class="difflineplus">+  ; Remove directories and files we always control before parsing the uninstall</span>
<a href="#l5.362"></a><span id="l5.362" class="difflineplus">+  ; log so empty directories can be removed.</span>
<a href="#l5.363"></a><span id="l5.363" class="difflineplus">+  ${If} ${FileExists} &quot;$INSTDIR\updates&quot;</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineplus">+    RmDir /r /REBOOTOK &quot;$INSTDIR\updates&quot;</span>
<a href="#l5.365"></a><span id="l5.365" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.366"></a><span id="l5.366" class="difflineplus">+  ${If} ${FileExists} &quot;$INSTDIR\defaults\shortcuts&quot;</span>
<a href="#l5.367"></a><span id="l5.367" class="difflineplus">+    RmDir /r /REBOOTOK &quot;$INSTDIR\defaults\shortcuts&quot;</span>
<a href="#l5.368"></a><span id="l5.368" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineplus">+  ${If} ${FileExists} &quot;$INSTDIR\distribution&quot;</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineplus">+    RmDir /r /REBOOTOK &quot;$INSTDIR\distribution&quot;</span>
<a href="#l5.371"></a><span id="l5.371" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.372"></a><span id="l5.372" class="difflineplus">+  ${If} ${FileExists} &quot;$INSTDIR\removed-files&quot;</span>
<a href="#l5.373"></a><span id="l5.373" class="difflineplus">+    Delete /REBOOTOK &quot;$INSTDIR\removed-files&quot;</span>
<a href="#l5.374"></a><span id="l5.374">   ${EndIf}</span>
<a href="#l5.375"></a><span id="l5.375"> </span>
<a href="#l5.376"></a><span id="l5.376" class="difflineplus">+  ; Remove the updates directory for Vista and above</span>
<a href="#l5.377"></a><span id="l5.377" class="difflineplus">+  ${un.CleanUpdatesDir} &quot;Mozilla\SeaMonkey&quot;</span>
<a href="#l5.378"></a><span id="l5.378" class="difflineplus">+</span>
<a href="#l5.379"></a><span id="l5.379" class="difflineplus">+  ; Remove files that may be left behind by the application in the</span>
<a href="#l5.380"></a><span id="l5.380" class="difflineplus">+  ; VirtualStore directory.</span>
<a href="#l5.381"></a><span id="l5.381" class="difflineplus">+  ${un.CleanVirtualStore}</span>
<a href="#l5.382"></a><span id="l5.382" class="difflineplus">+</span>
<a href="#l5.383"></a><span id="l5.383" class="difflineplus">+  ; Parse the uninstall log to unregister dll's and remove all installed</span>
<a href="#l5.384"></a><span id="l5.384" class="difflineplus">+  ; files / directories this install is responsible for.</span>
<a href="#l5.385"></a><span id="l5.385" class="difflineplus">+  ${un.ParseUninstallLog}</span>
<a href="#l5.386"></a><span id="l5.386" class="difflineplus">+</span>
<a href="#l5.387"></a><span id="l5.387" class="difflineplus">+  ; Remove the uninstall directory that we control</span>
<a href="#l5.388"></a><span id="l5.388" class="difflineplus">+  RmDir /r /REBOOTOK &quot;$INSTDIR\uninstall&quot;</span>
<a href="#l5.389"></a><span id="l5.389" class="difflineplus">+</span>
<a href="#l5.390"></a><span id="l5.390" class="difflineplus">+  ; Remove the installation directory if it is empty</span>
<a href="#l5.391"></a><span id="l5.391" class="difflineplus">+  ${RemoveDir} &quot;$INSTDIR&quot;</span>
<a href="#l5.392"></a><span id="l5.392" class="difflineplus">+</span>
<a href="#l5.393"></a><span id="l5.393" class="difflineplus">+  ; If seamonkey.exe was successfully deleted yet we still need to restart to</span>
<a href="#l5.394"></a><span id="l5.394" class="difflineplus">+  ; remove other files create a dummy seamonkey.exe.moz-delete to prevent the</span>
<a href="#l5.395"></a><span id="l5.395" class="difflineplus">+  ; installer from allowing an install without restart when it is required</span>
<a href="#l5.396"></a><span id="l5.396" class="difflineplus">+  ; to complete an uninstall.</span>
<a href="#l5.397"></a><span id="l5.397" class="difflineplus">+  ${If} ${RebootFlag}</span>
<a href="#l5.398"></a><span id="l5.398" class="difflineplus">+    ${Unless} ${FileExists} &quot;$INSTDIR\${FileMainEXE}.moz-delete&quot;</span>
<a href="#l5.399"></a><span id="l5.399" class="difflineplus">+      FileOpen $0 &quot;$INSTDIR\${FileMainEXE}.moz-delete&quot; w</span>
<a href="#l5.400"></a><span id="l5.400" class="difflineplus">+      FileWrite $0 &quot;Will be deleted on restart&quot;</span>
<a href="#l5.401"></a><span id="l5.401" class="difflineplus">+      Delete /REBOOTOK &quot;$INSTDIR\${FileMainEXE}.moz-delete&quot;</span>
<a href="#l5.402"></a><span id="l5.402" class="difflineplus">+      FileClose $0</span>
<a href="#l5.403"></a><span id="l5.403" class="difflineplus">+    ${EndUnless}</span>
<a href="#l5.404"></a><span id="l5.404" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.405"></a><span id="l5.405" class="difflineplus">+</span>
<a href="#l5.406"></a><span id="l5.406" class="difflineplus">+</span>
<a href="#l5.407"></a><span id="l5.407">   ; Refresh desktop icons otherwise the start menu internet item won't be</span>
<a href="#l5.408"></a><span id="l5.408" class="difflineminus">-  ; removed and other ugly things will happen like recreation of the registry</span>
<a href="#l5.409"></a><span id="l5.409" class="difflineminus">-  ; key by the OS under some conditions.</span>
<a href="#l5.410"></a><span id="l5.410" class="difflineplus">+  ; removed and other ugly things will happen like recreation of the app's</span>
<a href="#l5.411"></a><span id="l5.411" class="difflineplus">+  ; clients registry key by the OS under some conditions.</span>
<a href="#l5.412"></a><span id="l5.412">   System::Call &quot;shell32::SHChangeNotify(i, i, i, i) v (0x08000000, 0, 0, 0)&quot;</span>
<a href="#l5.413"></a><span id="l5.413"> SectionEnd</span>
<a href="#l5.414"></a><span id="l5.414"> </span>
<a href="#l5.415"></a><span id="l5.415"> ################################################################################</span>
<a href="#l5.416"></a><span id="l5.416"> # Helper Functions</span>
<a href="#l5.417"></a><span id="l5.417"> </span>
<a href="#l5.418"></a><span id="l5.418" class="difflineminus">-Function un.RemoveFilesCallback</span>
<a href="#l5.419"></a><span id="l5.419" class="difflineminus">-  ${un.TrimNewLines} &quot;$R9&quot; &quot;$R9&quot;</span>
<a href="#l5.420"></a><span id="l5.420" class="difflineminus">-  StrCpy $R1 &quot;$R9&quot; 5</span>
<a href="#l5.421"></a><span id="l5.421" class="difflineminus">-  ${If} $R1 == &quot;File:&quot;</span>
<a href="#l5.422"></a><span id="l5.422" class="difflineminus">-    StrCpy $R9 &quot;$R9&quot; &quot;&quot; 6</span>
<a href="#l5.423"></a><span id="l5.423" class="difflineminus">-    StrCpy $R0 &quot;$R9&quot; 1</span>
<a href="#l5.424"></a><span id="l5.424" class="difflineminus">-    ; If the path is relative prepend the install directory</span>
<a href="#l5.425"></a><span id="l5.425" class="difflineminus">-    ${If} $R0 == &quot;\&quot;</span>
<a href="#l5.426"></a><span id="l5.426" class="difflineminus">-      StrCpy $R0 &quot;$INSTDIR$R9&quot;</span>
<a href="#l5.427"></a><span id="l5.427" class="difflineminus">-    ${Else}</span>
<a href="#l5.428"></a><span id="l5.428" class="difflineminus">-      StrCpy $R0 &quot;$R9&quot;</span>
<a href="#l5.429"></a><span id="l5.429" class="difflineminus">-    ${EndIf}</span>
<a href="#l5.430"></a><span id="l5.430" class="difflineminus">-    ${If} ${FileExists} &quot;$R0&quot;</span>
<a href="#l5.431"></a><span id="l5.431" class="difflineminus">-      ${DeleteFile} &quot;$R0&quot;</span>
<a href="#l5.432"></a><span id="l5.432" class="difflineminus">-    ${EndIf}</span>
<a href="#l5.433"></a><span id="l5.433" class="difflineminus">-  ${EndIf}</span>
<a href="#l5.434"></a><span id="l5.434" class="difflineminus">-  ClearErrors</span>
<a href="#l5.435"></a><span id="l5.435" class="difflineminus">-  Push 0</span>
<a href="#l5.436"></a><span id="l5.436" class="difflineminus">-FunctionEnd</span>
<a href="#l5.437"></a><span id="l5.437" class="difflineminus">-</span>
<a href="#l5.438"></a><span id="l5.438" class="difflineminus">-; Using locate will leave file handles open to some of the directories which</span>
<a href="#l5.439"></a><span id="l5.439" class="difflineminus">-; will prevent the deletion of these directories. This parses the uninstall.log</span>
<a href="#l5.440"></a><span id="l5.440" class="difflineminus">-; and uses the file entries to find / remove empty directories.</span>
<a href="#l5.441"></a><span id="l5.441" class="difflineminus">-Function un.RemoveDirsCallback</span>
<a href="#l5.442"></a><span id="l5.442" class="difflineminus">-  ${un.TrimNewLines} &quot;$R9&quot; &quot;$R9&quot;</span>
<a href="#l5.443"></a><span id="l5.443" class="difflineminus">-  StrCpy $R1 &quot;$R9&quot; 5</span>
<a href="#l5.444"></a><span id="l5.444" class="difflineminus">-  ${If} $R1 == &quot;File:&quot;</span>
<a href="#l5.445"></a><span id="l5.445" class="difflineminus">-    StrCpy $R9 &quot;$R9&quot; &quot;&quot; 6</span>
<a href="#l5.446"></a><span id="l5.446" class="difflineminus">-    StrCpy $R1 &quot;$R9&quot; 1</span>
<a href="#l5.447"></a><span id="l5.447" class="difflineminus">-    ${If} $R1 == &quot;\&quot;</span>
<a href="#l5.448"></a><span id="l5.448" class="difflineminus">-      StrCpy $R2 &quot;$INSTDIR&quot;</span>
<a href="#l5.449"></a><span id="l5.449" class="difflineminus">-      StrCpy $R1 &quot;$INSTDIR$R9&quot;</span>
<a href="#l5.450"></a><span id="l5.450" class="difflineminus">-    ${Else}</span>
<a href="#l5.451"></a><span id="l5.451" class="difflineminus">-      StrCpy $R2 &quot;&quot;</span>
<a href="#l5.452"></a><span id="l5.452" class="difflineminus">-      StrCpy $R1 &quot;$R9&quot;</span>
<a href="#l5.453"></a><span id="l5.453" class="difflineminus">-    ${EndIf}</span>
<a href="#l5.454"></a><span id="l5.454" class="difflineminus">-    loop:</span>
<a href="#l5.455"></a><span id="l5.455" class="difflineminus">-      Push $R1</span>
<a href="#l5.456"></a><span id="l5.456" class="difflineminus">-      ${GetParentDir}</span>
<a href="#l5.457"></a><span id="l5.457" class="difflineminus">-      Pop $R0</span>
<a href="#l5.458"></a><span id="l5.458" class="difflineminus">-      GetFullPathName $R1 &quot;$R0&quot;</span>
<a href="#l5.459"></a><span id="l5.459" class="difflineminus">-      ; We only try to remove empty directories but the Desktop, StartMenu, and</span>
<a href="#l5.460"></a><span id="l5.460" class="difflineminus">-      ; QuickLaunch directories can be empty so guard against removing them.</span>
<a href="#l5.461"></a><span id="l5.461" class="difflineminus">-      ${If} &quot;$R2&quot; != &quot;$INSTDIR&quot;</span>
<a href="#l5.462"></a><span id="l5.462" class="difflineminus">-        SetShellVarContext all</span>
<a href="#l5.463"></a><span id="l5.463" class="difflineminus">-        ${If} $R1 == &quot;$DESKTOP&quot;</span>
<a href="#l5.464"></a><span id="l5.464" class="difflineminus">-        ${OrIf} $R1 == &quot;$STARTMENU&quot;</span>
<a href="#l5.465"></a><span id="l5.465" class="difflineminus">-          GoTo end</span>
<a href="#l5.466"></a><span id="l5.466" class="difflineminus">-        ${EndIf}</span>
<a href="#l5.467"></a><span id="l5.467" class="difflineminus">-        SetShellVarContext current</span>
<a href="#l5.468"></a><span id="l5.468" class="difflineminus">-        ${If} $R1 == &quot;$QUICKLAUNCH&quot;</span>
<a href="#l5.469"></a><span id="l5.469" class="difflineminus">-        ${OrIf} $R1 == &quot;$DESKTOP&quot;</span>
<a href="#l5.470"></a><span id="l5.470" class="difflineminus">-        ${OrIf} $R1 == &quot;$STARTMENU&quot;</span>
<a href="#l5.471"></a><span id="l5.471" class="difflineminus">-          GoTo end</span>
<a href="#l5.472"></a><span id="l5.472" class="difflineminus">-        ${EndIf}</span>
<a href="#l5.473"></a><span id="l5.473" class="difflineminus">-      ${ElseIf} &quot;$R1&quot; == &quot;$INSTDIR&quot;</span>
<a href="#l5.474"></a><span id="l5.474" class="difflineminus">-        GoTo end</span>
<a href="#l5.475"></a><span id="l5.475" class="difflineminus">-      ${EndIf}</span>
<a href="#l5.476"></a><span id="l5.476" class="difflineminus">-      ${If} ${FileExists} &quot;$R1&quot;</span>
<a href="#l5.477"></a><span id="l5.477" class="difflineminus">-        RmDir &quot;$R1&quot;</span>
<a href="#l5.478"></a><span id="l5.478" class="difflineminus">-      ${EndIf}</span>
<a href="#l5.479"></a><span id="l5.479" class="difflineminus">-      ${If} ${Errors}</span>
<a href="#l5.480"></a><span id="l5.480" class="difflineminus">-      ${OrIf} &quot;$R2&quot; != &quot;$INSTDIR&quot;</span>
<a href="#l5.481"></a><span id="l5.481" class="difflineminus">-        GoTo end</span>
<a href="#l5.482"></a><span id="l5.482" class="difflineminus">-      ${EndIf}</span>
<a href="#l5.483"></a><span id="l5.483" class="difflineminus">-      GoTo loop</span>
<a href="#l5.484"></a><span id="l5.484" class="difflineminus">-  ${EndIf}</span>
<a href="#l5.485"></a><span id="l5.485" class="difflineminus">-</span>
<a href="#l5.486"></a><span id="l5.486" class="difflineminus">-  end:</span>
<a href="#l5.487"></a><span id="l5.487" class="difflineminus">-    ClearErrors</span>
<a href="#l5.488"></a><span id="l5.488" class="difflineminus">-    Push 0</span>
<a href="#l5.489"></a><span id="l5.489" class="difflineminus">-FunctionEnd</span>
<a href="#l5.490"></a><span id="l5.490" class="difflineminus">-</span>
<a href="#l5.491"></a><span id="l5.491" class="difflineminus">-Function un.UnRegDLLsCallback</span>
<a href="#l5.492"></a><span id="l5.492" class="difflineminus">-  ${un.TrimNewLines} &quot;$R9&quot; &quot;$R9&quot;</span>
<a href="#l5.493"></a><span id="l5.493" class="difflineminus">-  StrCpy $R1 &quot;$R9&quot; 7</span>
<a href="#l5.494"></a><span id="l5.494" class="difflineminus">-  ${If} $R1 == &quot;DLLReg:&quot;</span>
<a href="#l5.495"></a><span id="l5.495" class="difflineminus">-    StrCpy $R9 &quot;$R9&quot; &quot;&quot; 8</span>
<a href="#l5.496"></a><span id="l5.496" class="difflineminus">-    StrCpy $R1 &quot;$R9&quot; 1</span>
<a href="#l5.497"></a><span id="l5.497" class="difflineminus">-    ${If} $R1 == &quot;\&quot;</span>
<a href="#l5.498"></a><span id="l5.498" class="difflineminus">-      StrCpy $R1 &quot;$INSTDIR$R9&quot;</span>
<a href="#l5.499"></a><span id="l5.499" class="difflineminus">-    ${Else}</span>
<a href="#l5.500"></a><span id="l5.500" class="difflineminus">-      StrCpy $R1 &quot;$R9&quot;</span>
<a href="#l5.501"></a><span id="l5.501" class="difflineminus">-    ${EndIf}</span>
<a href="#l5.502"></a><span id="l5.502" class="difflineminus">-    UnRegDLL $R1</span>
<a href="#l5.503"></a><span id="l5.503" class="difflineminus">-  ${EndIf}</span>
<a href="#l5.504"></a><span id="l5.504" class="difflineminus">-  ClearErrors</span>
<a href="#l5.505"></a><span id="l5.505" class="difflineminus">-  Push 0</span>
<a href="#l5.506"></a><span id="l5.506" class="difflineminus">-FunctionEnd</span>
<a href="#l5.507"></a><span id="l5.507" class="difflineminus">-</span>
<a href="#l5.508"></a><span id="l5.508" class="difflineminus">-; Setup the survey controls, functions, etc. except when the application has</span>
<a href="#l5.509"></a><span id="l5.509" class="difflineplus">+; Don't setup the survey controls, functions, etc. when the application has</span>
<a href="#l5.510"></a><span id="l5.510"> ; defined NO_UNINSTALL_SURVEY</span>
<a href="#l5.511"></a><span id="l5.511"> !ifndef NO_UNINSTALL_SURVEY</span>
<a href="#l5.512"></a><span id="l5.512"> Function un.Survey</span>
<a href="#l5.513"></a><span id="l5.513">   Exec &quot;$\&quot;$TmpVal$\&quot; $\&quot;${SurveyURL}$\&quot;&quot;</span>
<a href="#l5.514"></a><span id="l5.514"> FunctionEnd</span>
<a href="#l5.515"></a><span id="l5.515"> !endif</span>
<a href="#l5.516"></a><span id="l5.516"> </span>
<a href="#l5.517"></a><span id="l5.517"> ################################################################################</span>
<a href="#l5.518"></a><span id="l5.518" class="difflineat">@@ -401,150 +391,168 @@ FunctionEnd</span>
<a href="#l5.519"></a><span id="l5.519"> !include &quot;customLocale.nsh&quot;</span>
<a href="#l5.520"></a><span id="l5.520"> !verbose pop</span>
<a href="#l5.521"></a><span id="l5.521"> </span>
<a href="#l5.522"></a><span id="l5.522"> ; Set this after the locale files to override it if it is in the locale. Using</span>
<a href="#l5.523"></a><span id="l5.523"> ; &quot; &quot; for BrandingText will hide the &quot;Nullsoft Install System...&quot; branding.</span>
<a href="#l5.524"></a><span id="l5.524"> BrandingText &quot; &quot;</span>
<a href="#l5.525"></a><span id="l5.525"> </span>
<a href="#l5.526"></a><span id="l5.526"> ################################################################################</span>
<a href="#l5.527"></a><span id="l5.527" class="difflineminus">-# Page pre and leave functions</span>
<a href="#l5.528"></a><span id="l5.528" class="difflineplus">+# Page pre, show, and leave functions</span>
<a href="#l5.529"></a><span id="l5.529"> </span>
<a href="#l5.530"></a><span id="l5.530" class="difflineminus">-; Checks if the app being uninstalled is running.</span>
<a href="#l5.531"></a><span id="l5.531" class="difflineminus">-Function un.preInstFiles</span>
<a href="#l5.532"></a><span id="l5.532" class="difflineminus">-  ; Try to delete the app executable and if we can't delete it try to close the</span>
<a href="#l5.533"></a><span id="l5.533" class="difflineminus">-  ; app. This allows running an instance that is located in another directory.</span>
<a href="#l5.534"></a><span id="l5.534" class="difflineminus">-  ClearErrors</span>
<a href="#l5.535"></a><span id="l5.535" class="difflineminus">-  ${If} ${FileExists} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.536"></a><span id="l5.536" class="difflineminus">-    ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.537"></a><span id="l5.537" class="difflineplus">+Function un.preWelcome</span>
<a href="#l5.538"></a><span id="l5.538" class="difflineplus">+  ${If} ${FileExists} &quot;$INSTDIR\distribution\modern-wizard.bmp&quot;</span>
<a href="#l5.539"></a><span id="l5.539" class="difflineplus">+    Delete &quot;$PLUGINSDIR\modern-wizard.bmp&quot;</span>
<a href="#l5.540"></a><span id="l5.540" class="difflineplus">+    CopyFiles /SILENT &quot;$INSTDIR\distribution\modern-wizard.bmp&quot; &quot;$PLUGINSDIR\modern-wizard.bmp&quot;</span>
<a href="#l5.541"></a><span id="l5.541">   ${EndIf}</span>
<a href="#l5.542"></a><span id="l5.542" class="difflineminus">-  ${If} ${Errors}</span>
<a href="#l5.543"></a><span id="l5.543" class="difflineminus">-    ClearErrors</span>
<a href="#l5.544"></a><span id="l5.544" class="difflineminus">-    ${un.CloseApp} &quot;true&quot; $(WARN_APP_RUNNING_UNINSTALL)</span>
<a href="#l5.545"></a><span id="l5.545" class="difflineminus">-    ; Delete the app exe to prevent launching the app while we are uninstalling.</span>
<a href="#l5.546"></a><span id="l5.546" class="difflineminus">-    ClearErrors</span>
<a href="#l5.547"></a><span id="l5.547" class="difflineminus">-    ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.548"></a><span id="l5.548" class="difflineminus">-    ${If} ${Errors}</span>
<a href="#l5.549"></a><span id="l5.549" class="difflineminus">-      ClearErrors</span>
<a href="#l5.550"></a><span id="l5.550" class="difflineminus">-      ${un.CloseApp} &quot;true&quot; $(WARN_APP_RUNNING_UNINSTALL)</span>
<a href="#l5.551"></a><span id="l5.551" class="difflineminus">-      ClearErrors</span>
<a href="#l5.552"></a><span id="l5.552" class="difflineminus">-      ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.553"></a><span id="l5.553" class="difflineplus">+FunctionEnd</span>
<a href="#l5.554"></a><span id="l5.554" class="difflineplus">+</span>
<a href="#l5.555"></a><span id="l5.555" class="difflineplus">+Function un.leaveWelcome</span>
<a href="#l5.556"></a><span id="l5.556" class="difflineplus">+  ${If} ${FileExists} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.557"></a><span id="l5.557" class="difflineplus">+    Banner::show /NOUNLOAD &quot;$(BANNER_CHECK_EXISTING)&quot;</span>
<a href="#l5.558"></a><span id="l5.558" class="difflineplus">+</span>
<a href="#l5.559"></a><span id="l5.559" class="difflineplus">+    ${If} &quot;$TmpVal&quot; == &quot;FoundMessageWindow&quot;</span>
<a href="#l5.560"></a><span id="l5.560" class="difflineplus">+      Sleep 5000</span>
<a href="#l5.561"></a><span id="l5.561" class="difflineplus">+    ${EndIf}</span>
<a href="#l5.562"></a><span id="l5.562" class="difflineplus">+</span>
<a href="#l5.563"></a><span id="l5.563" class="difflineplus">+    ${PushFilesToCheck}</span>
<a href="#l5.564"></a><span id="l5.564" class="difflineplus">+</span>
<a href="#l5.565"></a><span id="l5.565" class="difflineplus">+    ${un.CheckForFilesInUse} $TmpVal</span>
<a href="#l5.566"></a><span id="l5.566" class="difflineplus">+</span>
<a href="#l5.567"></a><span id="l5.567" class="difflineplus">+    Banner::destroy</span>
<a href="#l5.568"></a><span id="l5.568" class="difflineplus">+</span>
<a href="#l5.569"></a><span id="l5.569" class="difflineplus">+    ${If} &quot;$TmpVal&quot; == &quot;true&quot;</span>
<a href="#l5.570"></a><span id="l5.570" class="difflineplus">+      StrCpy $TmpVal &quot;FoundMessageWindow&quot;</span>
<a href="#l5.571"></a><span id="l5.571" class="difflineplus">+      ${un.ManualCloseAppPrompt} &quot;${WindowClass}&quot; &quot;$(WARN_MANUALLY_CLOSE_APP_UNINSTALL)&quot;</span>
<a href="#l5.572"></a><span id="l5.572" class="difflineplus">+      StrCpy $TmpVal &quot;true&quot;</span>
<a href="#l5.573"></a><span id="l5.573">     ${EndIf}</span>
<a href="#l5.574"></a><span id="l5.574">   ${EndIf}</span>
<a href="#l5.575"></a><span id="l5.575"> FunctionEnd</span>
<a href="#l5.576"></a><span id="l5.576"> </span>
<a href="#l5.577"></a><span id="l5.577" class="difflineminus">-; When we add an optional action to the finish page the cancel button is</span>
<a href="#l5.578"></a><span id="l5.578" class="difflineminus">-; enabled. This disables it and leaves the finish button as the only choice.</span>
<a href="#l5.579"></a><span id="l5.579" class="difflineminus">-Function un.preFinish</span>
<a href="#l5.580"></a><span id="l5.580" class="difflineminus">-  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;settings&quot; &quot;cancelenabled&quot; &quot;0&quot;</span>
<a href="#l5.581"></a><span id="l5.581" class="difflineplus">+Function un.preConfirm</span>
<a href="#l5.582"></a><span id="l5.582" class="difflineplus">+  ${If} ${FileExists} &quot;$INSTDIR\distribution\modern-header.bmp&quot;</span>
<a href="#l5.583"></a><span id="l5.583" class="difflineplus">+  ${AndIf} $hHeaderBitmap == &quot;&quot;</span>
<a href="#l5.584"></a><span id="l5.584" class="difflineplus">+    Delete &quot;$PLUGINSDIR\modern-header.bmp&quot;</span>
<a href="#l5.585"></a><span id="l5.585" class="difflineplus">+    CopyFiles /SILENT &quot;$INSTDIR\distribution\modern-header.bmp&quot; &quot;$PLUGINSDIR\modern-header.bmp&quot;</span>
<a href="#l5.586"></a><span id="l5.586" class="difflineplus">+    ${un.ChangeMUIHeaderImage} &quot;$PLUGINSDIR\modern-header.bmp&quot;</span>
<a href="#l5.587"></a><span id="l5.587" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.588"></a><span id="l5.588" class="difflineplus">+</span>
<a href="#l5.589"></a><span id="l5.589" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Settings&quot; NumFields &quot;3&quot;</span>
<a href="#l5.590"></a><span id="l5.590" class="difflineplus">+</span>
<a href="#l5.591"></a><span id="l5.591" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 1&quot; Type   &quot;label&quot;</span>
<a href="#l5.592"></a><span id="l5.592" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 1&quot; Text   &quot;$(UN_CONFIRM_UNINSTALLED_FROM)&quot;</span>
<a href="#l5.593"></a><span id="l5.593" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 1&quot; Left   &quot;0&quot;</span>
<a href="#l5.594"></a><span id="l5.594" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 1&quot; Right  &quot;-1&quot;</span>
<a href="#l5.595"></a><span id="l5.595" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 1&quot; Top    &quot;5&quot;</span>
<a href="#l5.596"></a><span id="l5.596" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 1&quot; Bottom &quot;15&quot;</span>
<a href="#l5.597"></a><span id="l5.597" class="difflineplus">+</span>
<a href="#l5.598"></a><span id="l5.598" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 2&quot; Type   &quot;text&quot;</span>
<a href="#l5.599"></a><span id="l5.599" class="difflineplus">+  ; The contents of this control must be set as follows in the pre function</span>
<a href="#l5.600"></a><span id="l5.600" class="difflineplus">+  ; ${MUI_INSTALLOPTIONS_READ} $1 &quot;unconfirm.ini&quot; &quot;Field 2&quot; &quot;HWND&quot;</span>
<a href="#l5.601"></a><span id="l5.601" class="difflineplus">+  ; SendMessage $1 ${WM_SETTEXT} 0 &quot;STR:$INSTDIR&quot;</span>
<a href="#l5.602"></a><span id="l5.602" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 2&quot; State  &quot;&quot;</span>
<a href="#l5.603"></a><span id="l5.603" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 2&quot; Left   &quot;0&quot;</span>
<a href="#l5.604"></a><span id="l5.604" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 2&quot; Right  &quot;-1&quot;</span>
<a href="#l5.605"></a><span id="l5.605" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 2&quot; Top    &quot;17&quot;</span>
<a href="#l5.606"></a><span id="l5.606" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 2&quot; Bottom &quot;30&quot;</span>
<a href="#l5.607"></a><span id="l5.607" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 2&quot; flags  &quot;READONLY&quot;</span>
<a href="#l5.608"></a><span id="l5.608" class="difflineplus">+</span>
<a href="#l5.609"></a><span id="l5.609" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 3&quot; Type   &quot;label&quot;</span>
<a href="#l5.610"></a><span id="l5.610" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 3&quot; Text   &quot;$(UN_CONFIRM_CLICK)&quot;</span>
<a href="#l5.611"></a><span id="l5.611" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 3&quot; Left   &quot;0&quot;</span>
<a href="#l5.612"></a><span id="l5.612" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 3&quot; Right  &quot;-1&quot;</span>
<a href="#l5.613"></a><span id="l5.613" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 3&quot; Top    &quot;130&quot;</span>
<a href="#l5.614"></a><span id="l5.614" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 3&quot; Bottom &quot;150&quot;</span>
<a href="#l5.615"></a><span id="l5.615"> </span>
<a href="#l5.616"></a><span id="l5.616" class="difflineminus">-  ; Setup the survey controls, functions, etc. except when the application has</span>
<a href="#l5.617"></a><span id="l5.617" class="difflineminus">-  ; defined NO_UNINSTALL_SURVEY</span>
<a href="#l5.618"></a><span id="l5.618" class="difflineminus">-  !ifdef NO_UNINSTALL_SURVEY</span>
<a href="#l5.619"></a><span id="l5.619" class="difflineminus">-    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;settings&quot; &quot;NumFields&quot; &quot;3&quot;</span>
<a href="#l5.620"></a><span id="l5.620" class="difflineminus">-  !else</span>
<a href="#l5.621"></a><span id="l5.621" class="difflineplus">+  ${If} &quot;$TmpVal&quot; == &quot;true&quot;</span>
<a href="#l5.622"></a><span id="l5.622" class="difflineplus">+    WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 4&quot; Type   &quot;label&quot;</span>
<a href="#l5.623"></a><span id="l5.623" class="difflineplus">+    WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 4&quot; Text   &quot;$(SUMMARY_REBOOT_REQUIRED_UNINSTALL)&quot;</span>
<a href="#l5.624"></a><span id="l5.624" class="difflineplus">+    WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 4&quot; Left   &quot;0&quot;</span>
<a href="#l5.625"></a><span id="l5.625" class="difflineplus">+    WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 4&quot; Right  &quot;-1&quot;</span>
<a href="#l5.626"></a><span id="l5.626" class="difflineplus">+    WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 4&quot; Top    &quot;35&quot;</span>
<a href="#l5.627"></a><span id="l5.627" class="difflineplus">+    WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Field 4&quot; Bottom &quot;45&quot;</span>
<a href="#l5.628"></a><span id="l5.628" class="difflineplus">+</span>
<a href="#l5.629"></a><span id="l5.629" class="difflineplus">+    WriteINIStr &quot;$PLUGINSDIR\unconfirm.ini&quot; &quot;Settings&quot; NumFields &quot;4&quot;</span>
<a href="#l5.630"></a><span id="l5.630" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.631"></a><span id="l5.631" class="difflineplus">+</span>
<a href="#l5.632"></a><span id="l5.632" class="difflineplus">+  !insertmacro MUI_HEADER_TEXT &quot;$(UN_CONFIRM_PAGE_TITLE)&quot; &quot;$(UN_CONFIRM_PAGE_SUBTITLE)&quot;</span>
<a href="#l5.633"></a><span id="l5.633" class="difflineplus">+  ; The Summary custom page has a textbox that will automatically receive</span>
<a href="#l5.634"></a><span id="l5.634" class="difflineplus">+  ; focus. This sets the focus to the Install button instead.</span>
<a href="#l5.635"></a><span id="l5.635" class="difflineplus">+  !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;unconfirm.ini&quot;</span>
<a href="#l5.636"></a><span id="l5.636" class="difflineplus">+  GetDlgItem $0 $HWNDPARENT 1</span>
<a href="#l5.637"></a><span id="l5.637" class="difflineplus">+  System::Call &quot;user32::SetFocus(i r0, i 0x0007, i,i)i&quot;</span>
<a href="#l5.638"></a><span id="l5.638" class="difflineplus">+  ${MUI_INSTALLOPTIONS_READ} $1 &quot;unconfirm.ini&quot; &quot;Field 2&quot; &quot;HWND&quot;</span>
<a href="#l5.639"></a><span id="l5.639" class="difflineplus">+  SendMessage $1 ${WM_SETTEXT} 0 &quot;STR:$INSTDIR&quot;</span>
<a href="#l5.640"></a><span id="l5.640" class="difflineplus">+  !insertmacro MUI_INSTALLOPTIONS_SHOW</span>
<a href="#l5.641"></a><span id="l5.641" class="difflineplus">+FunctionEnd</span>
<a href="#l5.642"></a><span id="l5.642" class="difflineplus">+</span>
<a href="#l5.643"></a><span id="l5.643" class="difflineplus">+Function un.leaveConfirm</span>
<a href="#l5.644"></a><span id="l5.644" class="difflineplus">+  ; Try to delete the app executable and if we can't delete it try to find the</span>
<a href="#l5.645"></a><span id="l5.645" class="difflineplus">+  ; app's message window and prompt the user to close the app. This allows</span>
<a href="#l5.646"></a><span id="l5.646" class="difflineplus">+  ; running an instance that is located in another directory. If for whatever</span>
<a href="#l5.647"></a><span id="l5.647" class="difflineplus">+  ; reason there is no message window we will just rename the app's files and</span>
<a href="#l5.648"></a><span id="l5.648" class="difflineplus">+  ; then remove them on restart if they are in use.</span>
<a href="#l5.649"></a><span id="l5.649" class="difflineplus">+  ClearErrors</span>
<a href="#l5.650"></a><span id="l5.650" class="difflineplus">+  ${DeleteFile} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.651"></a><span id="l5.651" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l5.652"></a><span id="l5.652" class="difflineplus">+    ${un.ManualCloseAppPrompt} &quot;${WindowClass}&quot; &quot;$(WARN_MANUALLY_CLOSE_APP_UNINSTALL)&quot;</span>
<a href="#l5.653"></a><span id="l5.653" class="difflineplus">+  ${EndIf}</span>
<a href="#l5.654"></a><span id="l5.654" class="difflineplus">+FunctionEnd</span>
<a href="#l5.655"></a><span id="l5.655" class="difflineplus">+</span>
<a href="#l5.656"></a><span id="l5.656" class="difflineplus">+!ifndef NO_UNINSTALL_SURVEY</span>
<a href="#l5.657"></a><span id="l5.657" class="difflineplus">+Function un.preFinish</span>
<a href="#l5.658"></a><span id="l5.658" class="difflineplus">+  ; Do not modify the finish page if there is a reboot pending</span>
<a href="#l5.659"></a><span id="l5.659" class="difflineplus">+  ${Unless} ${RebootFlag}</span>
<a href="#l5.660"></a><span id="l5.660" class="difflineplus">+    ; Setup the survey controls, functions, etc.</span>
<a href="#l5.661"></a><span id="l5.661">     StrCpy $TmpVal &quot;SOFTWARE\Microsoft\IE Setup\Setup&quot;</span>
<a href="#l5.662"></a><span id="l5.662">     ClearErrors</span>
<a href="#l5.663"></a><span id="l5.663">     ReadRegStr $0 HKLM $TmpVal &quot;Path&quot;</span>
<a href="#l5.664"></a><span id="l5.664">     ${If} ${Errors}</span>
<a href="#l5.665"></a><span id="l5.665">       !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;settings&quot; &quot;NumFields&quot; &quot;3&quot;</span>
<a href="#l5.666"></a><span id="l5.666">     ${Else}</span>
<a href="#l5.667"></a><span id="l5.667">       ExpandEnvStrings $0 &quot;$0&quot; ; this value will usually contain %programfiles%</span>
<a href="#l5.668"></a><span id="l5.668">       ${If} $0 != &quot;\&quot;</span>
<a href="#l5.669"></a><span id="l5.669">         StrCpy $0 &quot;$0\&quot;</span>
<a href="#l5.670"></a><span id="l5.670">       ${EndIf}</span>
<a href="#l5.671"></a><span id="l5.671">       StrCpy $0 &quot;$0\iexplore.exe&quot;</span>
<a href="#l5.672"></a><span id="l5.672">       ClearErrors</span>
<a href="#l5.673"></a><span id="l5.673">       GetFullPathName $TmpVal $0</span>
<a href="#l5.674"></a><span id="l5.674">       ${If} ${Errors}</span>
<a href="#l5.675"></a><span id="l5.675">         !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;settings&quot; &quot;NumFields&quot; &quot;3&quot;</span>
<a href="#l5.676"></a><span id="l5.676" class="difflineplus">+      ${Else}</span>
<a href="#l5.677"></a><span id="l5.677" class="difflineplus">+        ; When we add an optional action to the finish page the cancel button</span>
<a href="#l5.678"></a><span id="l5.678" class="difflineplus">+        ; is enabled. This disables it and leaves the finish button as the</span>
<a href="#l5.679"></a><span id="l5.679" class="difflineplus">+        ; only choice.</span>
<a href="#l5.680"></a><span id="l5.680" class="difflineplus">+        !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;settings&quot; &quot;cancelenabled&quot; &quot;0&quot;</span>
<a href="#l5.681"></a><span id="l5.681">       ${EndIf}</span>
<a href="#l5.682"></a><span id="l5.682">     ${EndIf}</span>
<a href="#l5.683"></a><span id="l5.683" class="difflineminus">-  !endif</span>
<a href="#l5.684"></a><span id="l5.684"> FunctionEnd</span>
<a href="#l5.685"></a><span id="l5.685" class="difflineplus">+!endif</span>
<a href="#l5.686"></a><span id="l5.686"> </span>
<a href="#l5.687"></a><span id="l5.687"> ################################################################################</span>
<a href="#l5.688"></a><span id="l5.688"> # Initialization Functions</span>
<a href="#l5.689"></a><span id="l5.689"> </span>
<a href="#l5.690"></a><span id="l5.690"> Function .onInit</span>
<a href="#l5.691"></a><span id="l5.691" class="difflineminus">-  GetFullPathName $INSTDIR &quot;$EXEDIR\..&quot;</span>
<a href="#l5.692"></a><span id="l5.692" class="difflineminus">-  ${Unless} ${FileExists} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.693"></a><span id="l5.693" class="difflineminus">-    Abort</span>
<a href="#l5.694"></a><span id="l5.694" class="difflineminus">-  ${EndUnless}</span>
<a href="#l5.695"></a><span id="l5.695" class="difflineminus">-  ${GetParameters} $R0</span>
<a href="#l5.696"></a><span id="l5.696" class="difflineminus">-</span>
<a href="#l5.697"></a><span id="l5.697" class="difflineminus">-  ${Switch} $R0</span>
<a href="#l5.698"></a><span id="l5.698" class="difflineminus">-    ${Case} &quot;/HideShortcuts&quot;</span>
<a href="#l5.699"></a><span id="l5.699" class="difflineminus">-      ${HideShortcuts}</span>
<a href="#l5.700"></a><span id="l5.700" class="difflineminus">-      StrCpy $R1 &quot;true&quot;</span>
<a href="#l5.701"></a><span id="l5.701" class="difflineminus">-      ${Break}</span>
<a href="#l5.702"></a><span id="l5.702" class="difflineminus">-    ${Case} &quot;/ShowShortcuts&quot;</span>
<a href="#l5.703"></a><span id="l5.703" class="difflineminus">-      ${ShowShortcuts}</span>
<a href="#l5.704"></a><span id="l5.704" class="difflineminus">-      StrCpy $R1 &quot;true&quot;</span>
<a href="#l5.705"></a><span id="l5.705" class="difflineminus">-      ${Break}</span>
<a href="#l5.706"></a><span id="l5.706" class="difflineminus">-    ${Case} &quot;/SetAsDefaultAppUser&quot;</span>
<a href="#l5.707"></a><span id="l5.707" class="difflineminus">-      ${SetAsDefaultAppUser}</span>
<a href="#l5.708"></a><span id="l5.708" class="difflineminus">-      StrCpy $R1 &quot;true&quot;</span>
<a href="#l5.709"></a><span id="l5.709" class="difflineminus">-      ${Break}</span>
<a href="#l5.710"></a><span id="l5.710" class="difflineminus">-    ${Case} &quot;/SetAsDefaultAppGlobal&quot;</span>
<a href="#l5.711"></a><span id="l5.711" class="difflineminus">-      ${SetAsDefaultAppGlobal}</span>
<a href="#l5.712"></a><span id="l5.712" class="difflineminus">-      StrCpy $R1 &quot;true&quot;</span>
<a href="#l5.713"></a><span id="l5.713" class="difflineminus">-      ${Break}</span>
<a href="#l5.714"></a><span id="l5.714" class="difflineminus">-    ${Default}</span>
<a href="#l5.715"></a><span id="l5.715" class="difflineminus">-      ClearErrors</span>
<a href="#l5.716"></a><span id="l5.716" class="difflineminus">-      ${Unless} &quot;$R0&quot; == &quot;&quot;</span>
<a href="#l5.717"></a><span id="l5.717" class="difflineminus">-        ${WordReplace} &quot;$R0&quot; &quot;$\&quot;&quot; &quot;&quot; &quot;+&quot; $R0</span>
<a href="#l5.718"></a><span id="l5.718" class="difflineminus">-        ClearErrors</span>
<a href="#l5.719"></a><span id="l5.719" class="difflineminus">-        ${GetOptions} &quot;$R0&quot; &quot;/PostUpdate&quot; $R2</span>
<a href="#l5.720"></a><span id="l5.720" class="difflineminus">-        ${Unless} ${Errors}</span>
<a href="#l5.721"></a><span id="l5.721" class="difflineminus">-          ${PostUpdate}</span>
<a href="#l5.722"></a><span id="l5.722" class="difflineminus">-          ClearErrors</span>
<a href="#l5.723"></a><span id="l5.723" class="difflineminus">-          ${GetOptions} &quot;$R0&quot; &quot;/UninstallLog=&quot; $R2</span>
<a href="#l5.724"></a><span id="l5.724" class="difflineminus">-          ${Unless} ${Errors}</span>
<a href="#l5.725"></a><span id="l5.725" class="difflineminus">-            ${Unless} &quot;$R2&quot; == &quot;&quot;</span>
<a href="#l5.726"></a><span id="l5.726" class="difflineminus">-              GetFullPathName $R3 &quot;$R2&quot;</span>
<a href="#l5.727"></a><span id="l5.727" class="difflineminus">-              ${If} ${FileExists} &quot;$R3&quot;</span>
<a href="#l5.728"></a><span id="l5.728" class="difflineminus">-                Delete &quot;$INSTDIR\uninstall\*wizard*&quot;</span>
<a href="#l5.729"></a><span id="l5.729" class="difflineminus">-                Delete &quot;$INSTDIR\uninstall\uninstall.log&quot;</span>
<a href="#l5.730"></a><span id="l5.730" class="difflineminus">-                CopyFiles /SILENT &quot;$R3&quot; &quot;$INSTDIR\uninstall\&quot;</span>
<a href="#l5.731"></a><span id="l5.731" class="difflineminus">-                Push $R3</span>
<a href="#l5.732"></a><span id="l5.732" class="difflineminus">-                ${GetParentDir}</span>
<a href="#l5.733"></a><span id="l5.733" class="difflineminus">-                Pop $R4</span>
<a href="#l5.734"></a><span id="l5.734" class="difflineminus">-                Delete &quot;$R3&quot;</span>
<a href="#l5.735"></a><span id="l5.735" class="difflineminus">-                RmDir &quot;$R4&quot;</span>
<a href="#l5.736"></a><span id="l5.736" class="difflineminus">-              ${EndIf}</span>
<a href="#l5.737"></a><span id="l5.737" class="difflineminus">-            ${EndUnless}</span>
<a href="#l5.738"></a><span id="l5.738" class="difflineminus">-          ${EndUnless}</span>
<a href="#l5.739"></a><span id="l5.739" class="difflineminus">-          StrCpy $R1 &quot;true&quot;</span>
<a href="#l5.740"></a><span id="l5.740" class="difflineminus">-        ${EndUnless}</span>
<a href="#l5.741"></a><span id="l5.741" class="difflineminus">-      ${EndUnless}</span>
<a href="#l5.742"></a><span id="l5.742" class="difflineminus">-      ${Break}</span>
<a href="#l5.743"></a><span id="l5.743" class="difflineminus">-  ${EndSwitch}</span>
<a href="#l5.744"></a><span id="l5.744" class="difflineminus">-</span>
<a href="#l5.745"></a><span id="l5.745" class="difflineminus">-  ${If} $R1 == &quot;true&quot;</span>
<a href="#l5.746"></a><span id="l5.746" class="difflineminus">-    System::Call &quot;shell32::SHChangeNotify(i, i, i, i) v (0x08000000, 0, 0, 0)&quot;</span>
<a href="#l5.747"></a><span id="l5.747" class="difflineminus">-    Quit</span>
<a href="#l5.748"></a><span id="l5.748" class="difflineminus">-  ${EndIf}</span>
<a href="#l5.749"></a><span id="l5.749" class="difflineminus">-</span>
<a href="#l5.750"></a><span id="l5.750" class="difflineminus">-  ; If we made it this far then this installer is being used as an uninstaller.</span>
<a href="#l5.751"></a><span id="l5.751" class="difflineminus">-  WriteUninstaller &quot;$EXEDIR\uninstaller.exe&quot;</span>
<a href="#l5.752"></a><span id="l5.752" class="difflineminus">-</span>
<a href="#l5.753"></a><span id="l5.753" class="difflineminus">-  ${If} $R0 == &quot;/S&quot;</span>
<a href="#l5.754"></a><span id="l5.754" class="difflineminus">-    StrCpy $TmpVal &quot;$\&quot;$EXEDIR\uninstaller.exe$\&quot; /S&quot;</span>
<a href="#l5.755"></a><span id="l5.755" class="difflineminus">-  ${Else}</span>
<a href="#l5.756"></a><span id="l5.756" class="difflineminus">-    StrCpy $TmpVal &quot;$\&quot;$EXEDIR\uninstaller.exe$\&quot;&quot;</span>
<a href="#l5.757"></a><span id="l5.757" class="difflineminus">-  ${EndIf}</span>
<a href="#l5.758"></a><span id="l5.758" class="difflineminus">-</span>
<a href="#l5.759"></a><span id="l5.759" class="difflineminus">-  ; When the uninstaller is launched it copies itself to the temp directory so</span>
<a href="#l5.760"></a><span id="l5.760" class="difflineminus">-  ; it won't be in use so it can delete itself.</span>
<a href="#l5.761"></a><span id="l5.761" class="difflineminus">-  ExecWait $TmpVal</span>
<a href="#l5.762"></a><span id="l5.762" class="difflineminus">-  ${DeleteFile} &quot;$EXEDIR\uninstaller.exe&quot;</span>
<a href="#l5.763"></a><span id="l5.763" class="difflineminus">-  SetErrorLevel 0</span>
<a href="#l5.764"></a><span id="l5.764" class="difflineminus">-  Quit</span>
<a href="#l5.765"></a><span id="l5.765" class="difflineplus">+  ${UninstallOnInitCommon}</span>
<a href="#l5.766"></a><span id="l5.766"> FunctionEnd</span>
<a href="#l5.767"></a><span id="l5.767"> </span>
<a href="#l5.768"></a><span id="l5.768"> Function un.onInit</span>
<a href="#l5.769"></a><span id="l5.769">   GetFullPathName $INSTDIR &quot;$INSTDIR\..&quot;</span>
<a href="#l5.770"></a><span id="l5.770" class="difflineplus">+  ${un.GetLongPath} &quot;$INSTDIR&quot; $INSTDIR</span>
<a href="#l5.771"></a><span id="l5.771">   ${Unless} ${FileExists} &quot;$INSTDIR\${FileMainEXE}&quot;</span>
<a href="#l5.772"></a><span id="l5.772">     Abort</span>
<a href="#l5.773"></a><span id="l5.773">   ${EndUnless}</span>
<a href="#l5.774"></a><span id="l5.774" class="difflineplus">+</span>
<a href="#l5.775"></a><span id="l5.775">   StrCpy $LANGUAGE 0</span>
<a href="#l5.776"></a><span id="l5.776" class="difflineplus">+</span>
<a href="#l5.777"></a><span id="l5.777" class="difflineplus">+  ; Initialize $hHeaderBitmap to prevent redundant changing of the bitmap if</span>
<a href="#l5.778"></a><span id="l5.778" class="difflineplus">+  ; the user clicks the back button</span>
<a href="#l5.779"></a><span id="l5.779" class="difflineplus">+  StrCpy $hHeaderBitmap &quot;&quot;</span>
<a href="#l5.780"></a><span id="l5.780"> FunctionEnd</span>
<a href="#l5.781"></a><span id="l5.781" class="difflineplus">+</span>
<a href="#l5.782"></a><span id="l5.782" class="difflineplus">+Function .onGUIEnd</span>
<a href="#l5.783"></a><span id="l5.783" class="difflineplus">+  ${OnEndCommon}</span>
<a href="#l5.784"></a><span id="l5.784" class="difflineplus">+FunctionEnd</span>
<a href="#l5.785"></a><span id="l5.785" class="difflineplus">+</span>
<a href="#l5.786"></a><span id="l5.786" class="difflineplus">+Function un.onGUIEnd</span>
<a href="#l5.787"></a><span id="l5.787" class="difflineplus">+  ${un.OnEndCommon}</span>
<a href="#l5.788"></a><span id="l5.788" class="difflineplus">+FunctionEnd</span>
<a href="#l5.789"></a><span id="l5.789" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/locales/en-US/installer/windows/custom.properties</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/locales/en-US/installer/windows/custom.properties</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -70,33 +70,48 @@ PROFILE_TEXT=Profile Manager</span>
<a href="#l6.4"></a><span id="l6.4"> OPTIONS_PAGE_TITLE=Setup Type</span>
<a href="#l6.5"></a><span id="l6.5"> OPTIONS_PAGE_SUBTITLE=Choose setup options</span>
<a href="#l6.6"></a><span id="l6.6"> SHORTCUTS_PAGE_TITLE=Set Up Shortcuts</span>
<a href="#l6.7"></a><span id="l6.7"> SHORTCUTS_PAGE_SUBTITLE=Create Program Icons</span>
<a href="#l6.8"></a><span id="l6.8"> SUMMARY_PAGE_TITLE=Summary</span>
<a href="#l6.9"></a><span id="l6.9"> SUMMARY_PAGE_SUBTITLE=Ready to start installing ${BrandShortName}</span>
<a href="#l6.10"></a><span id="l6.10"> SUMMARY_INSTALLED_TO=${BrandShortName} will be installed to the following location:</span>
<a href="#l6.11"></a><span id="l6.11"> SUMMARY_CLICK=Click Install to continue.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+SUMMARY_REBOOT_REQUIRED_INSTALL=A restart of your computer may be required to complete the installation.</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+SUMMARY_REBOOT_REQUIRED_UNINSTALL=A restart of your computer may be required to complete the uninstall.</span>
<a href="#l6.14"></a><span id="l6.14"> SURVEY_TEXT=&amp;Tell us what you thought of ${BrandShortName}</span>
<a href="#l6.15"></a><span id="l6.15"> LAUNCH_TEXT=&amp;Launch ${BrandFullName} now</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-WARN_APP_RUNNING_INSTALL=${BrandFullName} must be closed to proceed with the installation.\n\nClick &quot;OK&quot; to exit ${BrandFullName} automatically and continue.</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-WARN_APP_RUNNING_UNINSTALL=${BrandFullName} must be closed to proceed with the uninstall.\n\nClick &quot;OK&quot; to exit ${BrandFullName} automatically and continue.</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+WARN_MANUALLY_CLOSE_APP_LAUNCH=${BrandShortName} is already running.\n\nPlease close ${BrandShortName} prior to launching the version you have just installed.</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+WARN_UNSUPPORTED_MSG=Sorry, ${BrandShortName} can't be installed. This version of ${BrandShortName} requires ${MinUnsupportedVer} or newer.</span>
<a href="#l6.20"></a><span id="l6.20"> CREATE_ICONS_DESC=Create icons for ${BrandShortName}:</span>
<a href="#l6.21"></a><span id="l6.21"> ICONS_DESKTOP=On my &amp;Desktop</span>
<a href="#l6.22"></a><span id="l6.22"> ICONS_STARTMENU=In my &amp;Start Menu Programs folder</span>
<a href="#l6.23"></a><span id="l6.23"> ICONS_QUICKLAUNCH=In my &amp;Quick Launch bar</span>
<a href="#l6.24"></a><span id="l6.24"> WARN_WRITE_ACCESS=You don't have access to write to the installation directory.\n\nClick OK to select a different directory.</span>
<a href="#l6.25"></a><span id="l6.25"> WARN_DISK_SPACE=You don't have sufficient disk space to install to this location.\n\nClick OK to select a different location.</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+WARN_MANUALLY_CLOSE_APP_INSTALL=${BrandShortName} must be closed to proceed with the installation.\n\nPlease close ${BrandShortName} to continue.</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+WARN_MANUALLY_CLOSE_APP_UNINSTALL=${BrandShortName} must be closed to proceed with the uninstall.\n\nPlease close ${BrandShortName} to continue.</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+WARN_RESTART_REQUIRED_UNINSTALL=Your computer must be restarted to complete a previous uninstall of ${BrandShortName}. Do you want to reboot now?</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+WARN_RESTART_REQUIRED_UPGRADE=Your computer must be restarted to complete a previous upgrade of ${BrandShortName}. Do you want to reboot now?</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+ERROR_CREATE_DIRECTORY_PREFIX=Error creating directory:</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+ERROR_CREATE_DIRECTORY_SUFFIX=Click Cancel to stop the installation or\nRetry to try again.</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+UN_CONFIRM_CLICK=Click Uninstall to continue.</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+UN_CONFIRM_PAGE_TITLE=Uninstall ${BrandFullName}</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+UN_CONFIRM_PAGE_SUBTITLE=Remove ${BrandFullName} from your computer.</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+UN_CONFIRM_UNINSTALLED_FROM=${BrandShortName} will be uninstalled from the following location:</span>
<a href="#l6.37"></a><span id="l6.37"> </span>
<a href="#l6.38"></a><span id="l6.38"> STATUS_INSTALL_APP=Installing ${BrandShortName}</span>
<a href="#l6.39"></a><span id="l6.39"> STATUS_INSTALL_LANG=Installing Language Files (${AB_CD})</span>
<a href="#l6.40"></a><span id="l6.40"> STATUS_INSTALL_OPTIONAL=Installing Optional Components</span>
<a href="#l6.41"></a><span id="l6.41"> STATUS_UNINSTALL_MAIN=Uninstalling ${BrandShortName}</span>
<a href="#l6.42"></a><span id="l6.42"> STATUS_CLEANUP=A Little Housekeeping</span>
<a href="#l6.43"></a><span id="l6.43"> </span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+BANNER_CHECK_EXISTING=Checking existing installation</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+</span>
<a href="#l6.46"></a><span id="l6.46"> # _DESC strings support approximately 65 characters per line.</span>
<a href="#l6.47"></a><span id="l6.47"> # One line</span>
<a href="#l6.48"></a><span id="l6.48"> OPTIONS_SUMMARY=Choose the type of setup you prefer, then click Next.</span>
<a href="#l6.49"></a><span id="l6.49"> # One line</span>
<a href="#l6.50"></a><span id="l6.50"> OPTION_STANDARD_DESC=${BrandShortName} will be installed with the most common options.</span>
<a href="#l6.51"></a><span id="l6.51"> OPTION_STANDARD_RADIO=&amp;Standard</span>
<a href="#l6.52"></a><span id="l6.52"> # One line</span>
<a href="#l6.53"></a><span id="l6.53"> OPTION_COMPLETE_DESC=${BrandShortName} will be installed with all available options.</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

