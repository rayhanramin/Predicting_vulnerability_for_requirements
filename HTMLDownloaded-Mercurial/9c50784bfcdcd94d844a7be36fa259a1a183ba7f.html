<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27405:9c50784bfcdcd94d844a7be36fa259a1a183ba7f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9c50784bfcdcd94d844a7be36fa259a1a183ba7f" />
<meta property="og:url" content="/comm-central/rev/9c50784bfcdcd94d844a7be36fa259a1a183ba7f" />
<meta property="og:description" content="Bug 1572324 - Run the address book tests for both Mork and JS/SQLite providers; r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9c50784bfcdcd94d844a7be36fa259a1a183ba7f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9c50784bfcdcd94d844a7be36fa259a1a183ba7f">shortlog</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9c50784bfcdcd94d844a7be36fa259a1a183ba7f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f">files</a> |
changeset |
<a href="/comm-central/raw-rev/9c50784bfcdcd94d844a7be36fa259a1a183ba7f">raw</a>  | <a href="/comm-central/archive/9c50784bfcdcd94d844a7be36fa259a1a183ba7f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1572324">Bug 1572324</a> - Run the address book tests for both Mork and JS/SQLite providers; r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 26 Aug 2019 12:13:46 +1200</td></tr>

<tr>
 <td>changeset 27405</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9c50784bfcdcd94d844a7be36fa259a1a183ba7f">9c50784bfcdcd94d844a7be36fa259a1a183ba7f</a></td>
</tr>



<tr>
<td>parent 27404</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7c25688758480fd4658babc88034e6a3cdf04d80">7c25688758480fd4658babc88034e6a3cdf04d80</a>
</td>
</tr>

<tr>
<td>child 27406</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/fa465d49d7bf9f021772b7080340e9856edf71c5">fa465d49d7bf9f021772b7080340e9856edf71c5</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9c50784bfcdcd94d844a7be36fa259a1a183ba7f">16323</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Mon, 26 Aug 2019 00:14:48 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9c50784bfcdc [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9c50784bfcdcd94d844a7be36fa259a1a183ba7f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9c50784bfcdcd94d844a7be36fa259a1a183ba7f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9c50784bfcdcd94d844a7be36fa259a1a183ba7f&newProject=comm-central&newRevision=b0bac431a4e7e4adc6ae732285b3d892c74bdc9b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9c50784bfcdcd94d844a7be36fa259a1a183ba7f&newProject=comm-central&newRevision=b0bac431a4e7e4adc6ae732285b3d892c74bdc9b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9c50784bfcdcd94d844a7be36fa259a1a183ba7f&newProject=comm-central&newRevision=b0bac431a4e7e4adc6ae732285b3d892c74bdc9b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1572324">1572324</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1572324">Bug 1572324</a> - Run the address book tests for both Mork and JS/SQLite providers; r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/moz.build">mailnews/addrbook/test/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/moz.build">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/moz.build">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/moz.build">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/moz.build">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/cardForEmail.sql">mailnews/addrbook/test/unit/data/cardForEmail.sql</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/cardForEmail.sql">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/cardForEmail.sql">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/cardForEmail.sql">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/cardForEmail.sql">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/cardForEmail.sql">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/collect.sql">mailnews/addrbook/test/unit/data/collect.sql</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/collect.sql">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/collect.sql">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/collect.sql">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/collect.sql">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/data/collect.sql">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_addrbook.js">mailnews/addrbook/test/unit/head_addrbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_addrbook.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_addrbook.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_addrbook.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_addrbook.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_addrbook.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_jsaddrbook.js">mailnews/addrbook/test/unit/head_jsaddrbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_jsaddrbook.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_jsaddrbook.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_jsaddrbook.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_jsaddrbook.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/head_jsaddrbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug1522453.js">mailnews/addrbook/test/unit/test_bug1522453.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug1522453.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug1522453.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug1522453.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug1522453.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug1522453.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug448165.js">mailnews/addrbook/test/unit/test_bug448165.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug448165.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug448165.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug448165.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug448165.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug448165.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug_448165.js">mailnews/addrbook/test/unit/test_bug_448165.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug_448165.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug_448165.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_bug_448165.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_cardForEmail.js">mailnews/addrbook/test/unit/test_cardForEmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_cardForEmail.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_cardForEmail.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_cardForEmail.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_cardForEmail.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_cardForEmail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_collection_2.js">mailnews/addrbook/test/unit/test_collection_2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_collection_2.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_collection_2.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_collection_2.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_collection_2.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_collection_2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_jsaddrbook.js">mailnews/addrbook/test/unit/test_jsaddrbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_jsaddrbook.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_jsaddrbook.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_jsaddrbook.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_jsaddrbook.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_jsaddrbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_mailList1.js">mailnews/addrbook/test/unit/test_mailList1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_mailList1.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_mailList1.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_mailList1.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_mailList1.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_mailList1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_notifications.js">mailnews/addrbook/test/unit/test_notifications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_notifications.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_notifications.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_notifications.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_notifications.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_notifications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbManager2.js">mailnews/addrbook/test/unit/test_nsAbManager2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbManager2.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbManager2.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbManager2.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbManager2.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsAbManager2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsIAbCard.js">mailnews/addrbook/test/unit/test_nsIAbCard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsIAbCard.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsIAbCard.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsIAbCard.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsIAbCard.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_nsIAbCard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_uuid.js">mailnews/addrbook/test/unit/test_uuid.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_uuid.js">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_uuid.js">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_uuid.js">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_uuid.js">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/test_uuid.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-jsaddrbook.ini">mailnews/addrbook/test/unit/xpcshell-jsaddrbook.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-jsaddrbook.ini">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-jsaddrbook.ini">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-jsaddrbook.ini">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-jsaddrbook.ini">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-jsaddrbook.ini">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-mdbaddrbook.ini">mailnews/addrbook/test/unit/xpcshell-mdbaddrbook.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-mdbaddrbook.ini">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-mdbaddrbook.ini">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-mdbaddrbook.ini">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-mdbaddrbook.ini">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell-mdbaddrbook.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell.ini">mailnews/addrbook/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/addrbook/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/abLists1.sql">mailnews/test/data/abLists1.sql</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/abLists1.sql">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/abLists1.sql">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/abLists1.sql">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/abLists1.sql">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/abLists1.sql">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/tb2hexpopularity.sql">mailnews/test/data/tb2hexpopularity.sql</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/tb2hexpopularity.sql">file</a> |
<a href="/comm-central/annotate/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/tb2hexpopularity.sql">annotate</a> |
<a href="/comm-central/diff/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/tb2hexpopularity.sql">diff</a> |
<a href="/comm-central/comparison/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/tb2hexpopularity.sql">comparison</a> |
<a href="/comm-central/log/9c50784bfcdcd94d844a7be36fa259a1a183ba7f/mailnews/test/data/tb2hexpopularity.sql">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/test/moz.build</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/test/moz.build</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,7 +1,9 @@</span>
<a href="#l1.4"></a><span id="l1.4"> # vim: set filetype=python:</span>
<a href="#l1.5"></a><span id="l1.5"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.6"></a><span id="l1.6"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.7"></a><span id="l1.7"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9" class="difflineminus">-XPCSHELL_TESTS_MANIFESTS += ['unit/xpcshell.ini']</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+XPCSHELL_TESTS_MANIFESTS += [</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    'unit/xpcshell-jsaddrbook.ini',</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    'unit/xpcshell-mdbaddrbook.ini',</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/mailnews/addrbook/test/unit/data/cardForEmail.sql</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,83 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+PRAGMA user_version = 1;</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+CREATE TABLE cards (uid TEXT PRIMARY KEY, localId INTEGER);</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+CREATE TABLE properties (card TEXT, name TEXT, value TEXT);</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+CREATE TABLE lists (uid TEXT PRIMARY KEY, localId INTEGER, name TEXT, nickName TEXT, description TEXT);</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+CREATE TABLE list_cards (list TEXT, card TEXT, PRIMARY KEY(list, card));</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+INSERT INTO cards (uid, localId) VALUES</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  ('85f4ad83-38fd-4d17-9364-038d11da77e6', 1),</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 2),</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 3),</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 4);</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+INSERT INTO properties (card, name, value) VALUES</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+  ('85f4ad83-38fd-4d17-9364-038d11da77e6', 'LastName', 'Email'),</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+  ('85f4ad83-38fd-4d17-9364-038d11da77e6', 'DisplayName', 'Empty Email'),</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+  ('85f4ad83-38fd-4d17-9364-038d11da77e6', 'FirstName', 'Empty'),</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+  ('85f4ad83-38fd-4d17-9364-038d11da77e6', 'AllowRemoteContent', '0'),</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+  ('85f4ad83-38fd-4d17-9364-038d11da77e6', 'PopularityIndex', '0'),</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+  ('85f4ad83-38fd-4d17-9364-038d11da77e6', 'PreferMailFormat', '0'),</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+  ('85f4ad83-38fd-4d17-9364-038d11da77e6', 'LastModifiedDate', '0'),</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'LastName', 'LastName1'),</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'Custom4', 'Custom41'),</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'LastModifiedDate', '1237281794'),</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'WebPage2', 'http://WebPage11'),</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'NickName', 'NickName1'),</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'DisplayName', 'DisplayName1'),</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'WorkZipCode', 'WorkZipCode1'),</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', '_AimScreenName', 'ScreenName1'),</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'WorkAddress', 'WorkAddress1'),</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'HomeCountry', 'HomeCountry1'),</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'WorkPhone', 'WorkPhone1'),</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'PrimaryEmail', 'PrimaryEmail1@test.invalid'),</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'HomeAddress', 'HomeAddress11'),</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'LowercasePrimaryEmail', 'primaryemail1@test.invalid'),</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'WorkCity', 'WorkCity1'),</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'SecondEmail', 'SecondEmail1√ê@test.invalid'),</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'HomeZipCode', 'HomeZipCode1'),</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'Custom3', 'Custom31'),</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'FaxNumber', 'FaxNumber1'),</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'Custom1', 'Custom11'),</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'HomePhone', 'HomePhone1'),</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'FirstName', 'FirstName1'),</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'HomeCity', 'HomeCity1'),</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'PagerNumber', 'PagerNumber1'),</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'CellularNumber', 'CellularNumber1'),</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'WorkAddress2', 'WorkAddress21'),</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'WorkState', 'WorkState1'),</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'HomeAddress2', 'HomeAddress21'),</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'WebPage1', 'http://WebPage21'),</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'Notes', 'Notes1'),</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'Custom2', 'Custom21'),</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'Department', 'Department1'),</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'WorkCountry', 'WorkCountry1'),</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'HomeState', 'HomeState1'),</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'JobTitle', 'JobTitle1'),</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'Company', 'Organization1'),</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'PopularityIndex', '0'),</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'AllowRemoteContent', '1'),</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+  ('fdcb9131-38ec-4daf-a4a7-2ef115f562a7', 'PreferMailFormat', '0'),</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'LastModifiedDate', '1245128765'),</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'NickName', 'johnd'),</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'DisplayName', 'John Doe'),</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'LastName', 'Doe'),</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'PrimaryEmail', 'john.doe@mailinator.invalid'),</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'FirstName', 'John'),</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'LowercasePrimaryEmail', 'john.doe@mailinator.invalid'),</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'AllowRemoteContent', '0'),</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'PopularityIndex', '0'),</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+  ('61c3b8fe-69d0-4a11-a970-ff381ae82d95', 'PreferMailFormat', '0'),</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'NickName', 'janed'),</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'DisplayName', 'Jane Doe'),</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'LastName', 'Doe'),</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'PrimaryEmail', 'jane.doe@mailinator.invalid'),</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'FirstName', 'Jane'),</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'LowercasePrimaryEmail', 'jane.doe@mailinator.invalid'),</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'LastModifiedDate', '0'),</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'AllowRemoteContent', '0'),</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'PopularityIndex', '0'),</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+  ('b73bffd5-850d-4a59-8c72-12272d2616a6', 'PreferMailFormat', '0');</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mailnews/addrbook/test/unit/data/collect.sql</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,20 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+PRAGMA user_version = 1;</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+CREATE TABLE cards (uid TEXT PRIMARY KEY, localId INTEGER);</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+CREATE TABLE properties (card TEXT, name TEXT, value TEXT);</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+CREATE TABLE lists (uid TEXT PRIMARY KEY, localId INTEGER, name TEXT, nickName TEXT, description TEXT);</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+CREATE TABLE list_cards (list TEXT, card TEXT, PRIMARY KEY(list, card));</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+INSERT INTO cards (uid, localId) VALUES</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 1);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+INSERT INTO properties (card, name, value) VALUES</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 'DisplayName', 'Other Book'),</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 'LastName', 'Book'),</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 'PrimaryEmail', 'other@book.invalid'),</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 'FirstName', 'Other'),</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 'LowercasePrimaryEmail', 'other@book.invalid'),</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 'LastModifiedDate', '0'),</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 'AllowRemoteContent', '0'),</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 'PopularityIndex', '0'),</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+  ('28fd662c-1662-4b02-8950-12dd131a1116', 'PreferMailFormat', '0');</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/head_addrbook.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/head_addrbook.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -6,11 +6,16 @@ var CC = Components.Constructor;</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> // Ensure the profile directory is set up</span>
<a href="#l4.6"></a><span id="l4.6"> do_get_profile();</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> // Import the required setup scripts.</span>
<a href="#l4.9"></a><span id="l4.9"> /* import-globals-from ../../../test/resources/abSetup.js */</span>
<a href="#l4.10"></a><span id="l4.10"> load(&quot;../../../resources/abSetup.js&quot;);</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+function loadABFile(source, dest) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  let testAB = do_get_file(`${source}.mab`);</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  testAB.copyTo(do_get_profile(), dest);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+}</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+</span>
<a href="#l4.17"></a><span id="l4.17"> registerCleanupFunction(function() {</span>
<a href="#l4.18"></a><span id="l4.18">   load(&quot;../../../resources/mailShutdown.js&quot;);</span>
<a href="#l4.19"></a><span id="l4.19"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/mailnews/addrbook/test/unit/head_jsaddrbook.js</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,77 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+// Ensure the profile directory is set up</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+do_get_profile();</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+// What follows is a copy of abSetup.js modified for tests with the</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+// JS directory provider. We don't yet make the personal address book</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+// and collected addresses book with this provider, so add two new</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+// directories and pretend they are the original ones.</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+MailServices.ab.newAddressBook(&quot;pab2&quot;, &quot;jsaddrbook://abook.sqlite&quot;, 101);</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+MailServices.ab.newAddressBook(&quot;history2&quot;, &quot;jsaddrbook://abook-1.sqlite&quot;, 101);</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+Services.prefs.setIntPref(&quot;ldap_2.servers.history2.position&quot;, 2);</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+// Personal Address Book configuration items.</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+var kPABData = {</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+  URI: &quot;jsaddrbook://abook.sqlite&quot;,</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+  fileName: &quot;abook.sqlite&quot;,</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+  dirName: &quot;pab2&quot;,</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+  dirType: 101,</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+  dirPrefID: &quot;ldap_2.servers.pab2&quot;,</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+  readOnly: false,</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+  position: 1,</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+};</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+// Collected Address Book configuration items.</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+var kCABData = {</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+  URI: &quot;jsaddrbook://abook-1.sqlite&quot;,</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+  fileName: &quot;abook-1.sqlite&quot;,</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+  dirName: &quot;history2&quot;,</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+  dirType: 101,</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+  dirPrefID: &quot;ldap_2.servers.history2&quot;,</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+  readOnly: false,</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+  position: 2,</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+};</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+// Windows (Outlook Express) Address Book deactivation. (Bug 448859)</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+Services.prefs.deleteBranch(&quot;ldap_2.servers.oe.&quot;);</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+// OSX Address Book deactivation (Bug 955842)</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+Services.prefs.deleteBranch(&quot;ldap_2.servers.osx.&quot;);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+// This currently applies to all address books of local type.</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+var kNormalPropertiesURI =</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+  &quot;chrome://messenger/content/addressbook/abAddressBookNameDialog.xul&quot;;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+function loadABFile(source, dest) {</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+  let sourceFile = do_get_file(`${source}.sql`);</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+  let destFile = do_get_profile();</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+  destFile.append(kPABData.fileName);</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+  let fstream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+                  .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+  let cstream = Cc[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+                  .createInstance(Ci.nsIConverterInputStream);</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+  fstream.init(sourceFile, -1, 0, 0);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+  cstream.init(fstream, &quot;UTF-8&quot;, 0, 0);</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+  let data = &quot;&quot;;</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+  let read = 0;</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+  do {</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+    let str = {};</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+    read = cstream.readString(0xffffffff, str);</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+    data += str.value;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+  } while (read != 0);</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+  cstream.close();</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+  let conn = Services.storage.openDatabase(destFile);</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+  conn.executeSimpleSQL(data);</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+  conn.close();</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+}</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+registerCleanupFunction(function() {</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+  load(&quot;../../../resources/mailShutdown.js&quot;);</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_bug1522453.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_bug1522453.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -59,18 +59,20 @@ function run_test() {</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">   // Reload the address book manager.</span>
<a href="#l6.6"></a><span id="l6.6">   Services.obs.notifyObservers(null, &quot;addrbook-reload&quot;);</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   MailServices.ab.directories;</span>
<a href="#l6.9"></a><span id="l6.9">   book = MailServices.ab.getDirectory(kPABData.URI);</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">   // For some unknown reason this is necessary for book.addressLists to be populated.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  book.QueryInterface(Ci.nsIAbMDBDirectory).database.getMailingListsFromDB(book);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  equal(1, book.addressLists.Count());</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  if (kPABData.dirType == 2) {</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    book.QueryInterface(Ci.nsIAbMDBDirectory).database.getMailingListsFromDB(book);</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+    equal(1, book.addressLists.Count());</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+  }</span>
<a href="#l6.18"></a><span id="l6.18">   list = book.addressLists.GetElementAt(0).QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">   // list.childCards should contain contacts 1 and 3.</span>
<a href="#l6.21"></a><span id="l6.21">   listCards = list.childCards;</span>
<a href="#l6.22"></a><span id="l6.22">   ok(listCards.hasMoreElements());</span>
<a href="#l6.23"></a><span id="l6.23">   equal(contact1.UID, listCards.getNext().QueryInterface(Ci.nsIAbCard).UID);</span>
<a href="#l6.24"></a><span id="l6.24">   ok(listCards.hasMoreElements());</span>
<a href="#l6.25"></a><span id="l6.25">   equal(contact3.UID, listCards.getNext().QueryInterface(Ci.nsIAbCard).UID);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">rename from mailnews/addrbook/test/unit/test_bug_448165.js</span>
<a href="#l7.2"></a><span id="l7.2">rename to mailnews/addrbook/test/unit/test_bug448165.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -14,21 +14,17 @@ function check_correct_card(card) {</span>
<a href="#l8.4"></a><span id="l8.4">   Assert.equal(card.firstName, &quot;FirstName1&quot;);</span>
<a href="#l8.5"></a><span id="l8.5">   Assert.equal(card.lastName, &quot;LastName1&quot;);</span>
<a href="#l8.6"></a><span id="l8.6">   Assert.equal(card.displayName, &quot;DisplayName1&quot;);</span>
<a href="#l8.7"></a><span id="l8.7">   Assert.equal(card.primaryEmail, &quot;PrimaryEmail1@test.invalid&quot;);</span>
<a href="#l8.8"></a><span id="l8.8">   Assert.equal(card.getProperty(&quot;SecondEmail&quot;, &quot;BAD&quot;), &quot;SecondEmail1\u00D0@test.invalid&quot;);</span>
<a href="#l8.9"></a><span id="l8.9"> }</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11"> function run_test() {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  // Test setup - copy the data file into place</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-  var testAB = do_get_file(&quot;data/cardForEmail.mab&quot;);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-  // Copy the file to the profile directory for a PAB</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-  testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+  loadABFile(&quot;data/cardForEmail&quot;, kPABData.fileName);</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19">   // Test - Get the directory</span>
<a href="#l8.20"></a><span id="l8.20">   let AB = MailServices.ab.getDirectory(kPABData.URI);</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22">   // Test - Check that a null string succeeds and does not</span>
<a href="#l8.23"></a><span id="l8.23">   // return a card (bug 404264)</span>
<a href="#l8.24"></a><span id="l8.24">   Assert.ok(AB.cardForEmailAddress(null) == null);</span>
<a href="#l8.25"></a><span id="l8.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_collection_2.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_collection_2.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -14,21 +14,17 @@ function run_test() {</span>
<a href="#l9.4"></a><span id="l9.4">   // Get the actual collecter</span>
<a href="#l9.5"></a><span id="l9.5">   var addressCollect =</span>
<a href="#l9.6"></a><span id="l9.6">     Cc[&quot;@mozilla.org/addressbook/services/addressCollector;1&quot;]</span>
<a href="#l9.7"></a><span id="l9.7">       .getService(Ci.nsIAbAddressCollector);</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">   // Set the new pref afterwards to ensure we change correctly</span>
<a href="#l9.10"></a><span id="l9.10">   Services.prefs.setCharPref(&quot;mail.collect_addressbook&quot;, kCABData.URI);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  // For this test use an address book that isn't the one we're collecting</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  // to.</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-  var testAB = do_get_file(&quot;data/collect.mab&quot;);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-  testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+  loadABFile(&quot;data/collect&quot;, kPABData.fileName);</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19">   // XXX Getting all directories ensures we create all ABs because the</span>
<a href="#l9.20"></a><span id="l9.20">   // address collecter can't currently create ABs itself (bug 314448).</span>
<a href="#l9.21"></a><span id="l9.21">   MailServices.ab.directories;</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23">   addressCollect.collectAddress(&quot;Other Book &lt;other@book.invalid&gt;&quot;, true,</span>
<a href="#l9.24"></a><span id="l9.24">                                 nsIAbPMF.unknown);</span>
<a href="#l9.25"></a><span id="l9.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_jsaddrbook.js</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,305 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ * file, you can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+var DIR_TYPE = kPABData.dirType;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+var FILE_NAME = DIR_TYPE == 101 ? &quot;abook-2.sqlite&quot; : &quot;abook-1.mab&quot;;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+var SCHEME = DIR_TYPE == 101 ? &quot;jsaddrbook&quot; : &quot;moz-abmdbdirectory&quot;;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+var { MailServices } = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+var book, contact, list, listCard;</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+var observer = {</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+  setUp() {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+    MailServices.ab.addAddressBookListener(observer, Ci.nsIAbListener.all);</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+    Services.obs.addObserver(observer, &quot;addrbook-contact-created&quot;);</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+    Services.obs.addObserver(observer, &quot;addrbook-contact-updated&quot;);</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+    Services.obs.addObserver(observer, &quot;addrbook-list-updated&quot;);</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+    Services.obs.addObserver(observer, &quot;addrbook-list-member-added&quot;);</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+  },</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+  cleanUp() {</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+    MailServices.ab.removeAddressBookListener(observer);</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+    Services.obs.removeObserver(observer, &quot;addrbook-contact-created&quot;);</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+    Services.obs.removeObserver(observer, &quot;addrbook-contact-updated&quot;);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+    Services.obs.removeObserver(observer, &quot;addrbook-list-updated&quot;);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+    Services.obs.removeObserver(observer, &quot;addrbook-list-member-added&quot;);</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+  },</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+  events: [],</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+  onItemAdded(parent, item) {</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+    this.events.push([&quot;onItemAdded&quot;, parent, item]);</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+  },</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+  onItemRemoved(parent, item) {</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+    this.events.push([&quot;onItemRemoved&quot;, parent, item]);</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+  },</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+  onItemPropertyChanged(item, property, oldValue, newValue) {</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+    this.events.push([&quot;onItemPropertyChanged&quot;, item, property, oldValue, newValue]);</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+  },</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+  observe(subject, topic, data) {</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+    this.events.push([topic, subject, data]);</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+  },</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+  checkEvents(...events) {</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+    info(&quot;Actual events: &quot; + JSON.stringify(observer.events.map(e =&gt; e.map(a =&gt; {</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+      if (a instanceof Ci.nsIAbDirectory) {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+        return `[nsIAbDirectory]`;</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+      }</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+      if (a instanceof Ci.nsIAbCard) {</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+        return `[nsIAbCard]`;</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+      }</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+      return a;</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+    }))));</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+    equal(observer.events.length, events.length);</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+    for (let expectedEvent of events) {</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+      let actualEvent = observer.events.shift();</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+      for (let i = 0; i &lt; expectedEvent.length; i++) {</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+        try {</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+          expectedEvent[i].QueryInterface(Ci.nsIAbCard);</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+          ok(actualEvent[i].equals(expectedEvent[i]));</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+        } catch (ex) {</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+          if (expectedEvent[i] instanceof Ci.nsIAbDirectory) {</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+            equal(actualEvent[i].UID, expectedEvent[i].UID);</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+          } else if (expectedEvent[i] !== undefined) {</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+            equal(actualEvent[i], expectedEvent[i]);</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+          }</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+        }</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+      }</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+    }</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+  },</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+};</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+add_task(async function setUp() {</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+  do_get_profile();</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+  observer.setUp();</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+});</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+add_task(async function createAddressBook() {</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+  let dirPrefId = MailServices.ab.newAddressBook(&quot;new book&quot;, &quot;&quot;, DIR_TYPE);</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+  book = MailServices.ab.getDirectoryFromId(dirPrefId);</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+  observer.checkEvents([&quot;onItemAdded&quot;, undefined, book]);</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+  // Check nsIAbItem properties.</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+  equal(book.uuid, &quot;ldap_2.servers.newbook&amp;new book&quot;);</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+  // Check nsIAbCollection properties;</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+  ok(!book.readOnly);</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+  ok(!book.isRemote);</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+  ok(!book.isSecure);</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+  // Check nsIAbDirectory properties.</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+  equal(book.dirName, &quot;new book&quot;);</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+  equal(book.dirType, DIR_TYPE);</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+  equal(book.fileName, FILE_NAME);</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+  equal(book.UID.length, 36);</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+  equal(book.URI, `${SCHEME}://${FILE_NAME}`);</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+  equal(book.isMailList, false);</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+  equal(book.isQuery, false);</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+  equal(book.supportsMailingLists, true);</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+  equal(book.dirPrefId, &quot;ldap_2.servers.newbook&quot;);</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+  // Check enumerations.</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+  equal(Array.from(book.addressLists.enumerate()).length, 0);</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+  equal(Array.from(book.childNodes).length, 0);</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+  equal(Array.from(book.childCards).length, 0);</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+  // Check prefs.</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+  equal(Services.prefs.getStringPref(&quot;ldap_2.servers.newbook.description&quot;), &quot;new book&quot;);</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+  equal(Services.prefs.getIntPref(&quot;ldap_2.servers.newbook.dirType&quot;), DIR_TYPE);</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineplus">+  equal(Services.prefs.getStringPref(&quot;ldap_2.servers.newbook.filename&quot;), FILE_NAME);</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+  equal(Services.prefs.getStringPref(&quot;ldap_2.servers.newbook.uid&quot;), book.UID);</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+  equal([...MailServices.ab.directories].length, DIR_TYPE == 101 ? 5 : 3);</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+});</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineplus">+</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+add_task(async function editAddressBook() {</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+  book.dirName = &quot;updated book&quot;;</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+  observer.checkEvents([&quot;onItemPropertyChanged&quot;, book, &quot;DirName&quot;, &quot;new book&quot;, &quot;updated book&quot;]);</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+  equal(book.dirName, &quot;updated book&quot;);</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineplus">+  equal(Services.prefs.getStringPref(&quot;ldap_2.servers.newbook.description&quot;), &quot;updated book&quot;);</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineplus">+});</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineplus">+add_task(async function createContact() {</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineplus">+  contact = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;].createInstance(Ci.nsIAbCard);</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineplus">+  contact.displayName = &quot;a new contact&quot;;</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineplus">+  contact.firstName = &quot;new&quot;;</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+  contact.lastName = &quot;contact&quot;;</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineplus">+  contact.primaryEmail = &quot;test@invalid&quot;;</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineplus">+  contact = book.addCard(contact);</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineplus">+  observer.checkEvents(</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineplus">+    [&quot;onItemAdded&quot;, book, contact],</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineplus">+    [&quot;addrbook-contact-created&quot;, contact, book.UID]</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+  );</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineplus">+</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineplus">+  // Check enumerations.</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+  let childCards = Array.from(book.childCards, cc =&gt; cc.QueryInterface(Ci.nsIAbCard));</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineplus">+  equal(childCards.length, 1);</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineplus">+  ok(childCards[0].equals(contact));</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineplus">+</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineplus">+  // Check nsIAbItem properties.</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+  equal(contact.uuid, &quot;ldap_2.servers.newbook&amp;updated book#1&quot;);</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineplus">+</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+  // Check nsIAbItem methods.</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineplus">+  equal(contact.generateName(Ci.nsIAbItem.GENERATE_DISPLAY_NAME), &quot;a new contact&quot;);</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineplus">+  equal(contact.generateName(Ci.nsIAbItem.GENERATE_LAST_FIRST_ORDER), &quot;contact, new&quot;);</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+  equal(contact.generateName(Ci.nsIAbItem.GENERATE_FIRST_LAST_ORDER), &quot;new contact&quot;);</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineplus">+</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineplus">+  // Check nsIAbCard properties.</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineplus">+  equal(contact.directoryId, book.uuid);</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineplus">+  equal(contact.localId, 1);</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineplus">+  equal(contact.UID.length, 36);</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineplus">+  equal(contact.firstName, &quot;new&quot;);</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineplus">+  equal(contact.lastName, &quot;contact&quot;);</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineplus">+  equal(contact.displayName, &quot;a new contact&quot;);</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineplus">+  equal(contact.primaryEmail, &quot;test@invalid&quot;);</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineplus">+  equal(contact.isMailList, false);</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineplus">+});</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineplus">+</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineplus">+add_task(async function editContact() {</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineplus">+  contact.firstName = &quot;updated&quot;;</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineplus">+  contact.lastName = &quot;contact&quot;;</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineplus">+  book.modifyCard(contact);</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineplus">+  observer.checkEvents(</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineplus">+    // TODO MDB has three null args but we can do better than that.</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineplus">+    [&quot;onItemPropertyChanged&quot;, contact],</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineplus">+    [&quot;addrbook-contact-updated&quot;, contact, book.UID],</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineplus">+  );</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineplus">+  equal(contact.firstName, &quot;updated&quot;);</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineplus">+  equal(contact.lastName, &quot;contact&quot;);</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineplus">+});</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineplus">+</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineplus">+add_task(async function createMailingList() {</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineplus">+  list = Cc[&quot;@mozilla.org/addressbook/directoryproperty;1&quot;].createInstance(Ci.nsIAbDirectory);</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineplus">+  list.isMailList = true;</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+  list.dirName = &quot;new list&quot;;</span>
<a href="#l10.181"></a><span id="l10.181" class="difflineplus">+  list = book.addMailList(list);</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineplus">+  // Skip checking events temporarily, until listCard is defined.</span>
<a href="#l10.183"></a><span id="l10.183" class="difflineplus">+</span>
<a href="#l10.184"></a><span id="l10.184" class="difflineplus">+  // Check enumerations.</span>
<a href="#l10.185"></a><span id="l10.185" class="difflineplus">+  let addressLists = Array.from(book.addressLists.enumerate(), al =&gt; al.QueryInterface(Ci.nsIAbDirectory));</span>
<a href="#l10.186"></a><span id="l10.186" class="difflineplus">+  equal(addressLists.length, 1);</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineplus">+  equal(addressLists[0].UID, list.UID); // TODO Object equality doesn't work because of XPCOM.</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineplus">+  let childNodes = Array.from(book.childNodes, cn =&gt; cn.QueryInterface(Ci.nsIAbDirectory));</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineplus">+  equal(childNodes.length, 1);</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineplus">+  equal(childNodes[0].UID, list.UID); // TODO Object equality doesn't work because of XPCOM.</span>
<a href="#l10.191"></a><span id="l10.191" class="difflineplus">+  let childCards = Array.from(book.childCards, cc =&gt; cc.QueryInterface(Ci.nsIAbCard));</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineplus">+  equal(childCards.length, 2);</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineplus">+  if (childCards[0].isMailList) {</span>
<a href="#l10.194"></a><span id="l10.194" class="difflineplus">+    listCard = childCards[0];</span>
<a href="#l10.195"></a><span id="l10.195" class="difflineplus">+    ok(childCards[1].equals(contact));</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineplus">+  } else {</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineplus">+    ok(childCards[0].equals(contact));</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineplus">+    listCard = childCards[1];</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineplus">+  }</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineplus">+  equal(listCard.UID, list.UID);</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineplus">+</span>
<a href="#l10.202"></a><span id="l10.202" class="difflineplus">+  observer.checkEvents(</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineplus">+    [&quot;onItemAdded&quot;, book, listCard],</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineplus">+    [&quot;onItemAdded&quot;, book, list]</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineplus">+  );</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineplus">+</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineplus">+  // Check nsIAbItem properties.</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineplus">+  equal(list.uuid, &quot;&amp;new list&quot;);</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineplus">+</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineplus">+  // Check nsIAbDirectory properties.</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineplus">+  equal(list.dirName, &quot;new list&quot;);</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineplus">+  equal(list.UID.length, 36);</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineplus">+  equal(list.URI, `${SCHEME}://${FILE_NAME}/MailList1`);</span>
<a href="#l10.214"></a><span id="l10.214" class="difflineplus">+  equal(list.isMailList, true);</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineplus">+  equal(list.isQuery, false);</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineplus">+  equal(list.supportsMailingLists, false);</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineplus">+</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineplus">+  // Check list enumerations.</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineplus">+  equal(Array.from(list.addressLists.enumerate()).length, 0);</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineplus">+  equal(Array.from(list.childNodes).length, 0);</span>
<a href="#l10.221"></a><span id="l10.221" class="difflineplus">+  equal(Array.from(list.childCards).length, 0);</span>
<a href="#l10.222"></a><span id="l10.222" class="difflineplus">+});</span>
<a href="#l10.223"></a><span id="l10.223" class="difflineplus">+</span>
<a href="#l10.224"></a><span id="l10.224" class="difflineplus">+add_task(async function editMailingList() {</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineplus">+  list.dirName = &quot;updated list&quot;;</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineplus">+  list.editMailListToDatabase(null);</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineplus">+  observer.checkEvents(</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineplus">+    [&quot;onItemPropertyChanged&quot;, list, &quot;DirName&quot;, undefined, &quot;updated list&quot;],</span>
<a href="#l10.229"></a><span id="l10.229" class="difflineplus">+    [&quot;onItemPropertyChanged&quot;, list, &quot;DirName&quot;, undefined, &quot;updated list&quot;], // Seriously?</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineplus">+    [&quot;addrbook-list-updated&quot;, list, null]</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineplus">+  );</span>
<a href="#l10.232"></a><span id="l10.232" class="difflineplus">+  equal(&quot;updated list&quot;, list.dirName);</span>
<a href="#l10.233"></a><span id="l10.233" class="difflineplus">+});</span>
<a href="#l10.234"></a><span id="l10.234" class="difflineplus">+</span>
<a href="#l10.235"></a><span id="l10.235" class="difflineplus">+add_task(async function addMailingListMember() {</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineplus">+  list.addCard(contact);</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineplus">+  observer.checkEvents(</span>
<a href="#l10.238"></a><span id="l10.238" class="difflineplus">+    [&quot;onItemPropertyChanged&quot;, contact, null, null, null],</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineplus">+    [&quot;onItemPropertyChanged&quot;, contact, null, null, null],</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineplus">+    [&quot;onItemAdded&quot;, book, contact],</span>
<a href="#l10.241"></a><span id="l10.241" class="difflineplus">+    [&quot;onItemAdded&quot;, list, contact],</span>
<a href="#l10.242"></a><span id="l10.242" class="difflineplus">+    // [&quot;addrbook-list-member-added&quot;, contact, list.UID] // MDB fires this on dropcard but not addcard?!</span>
<a href="#l10.243"></a><span id="l10.243" class="difflineplus">+  );</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineplus">+  equal(1, list.addressLists.Count());</span>
<a href="#l10.245"></a><span id="l10.245" class="difflineplus">+</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineplus">+  // Check list enumerations.</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineplus">+  let addressLists = Array.from(list.addressLists.enumerate(), al =&gt; al.QueryInterface(Ci.nsIAbCard));</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineplus">+  equal(addressLists.length, 1);</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineplus">+  ok(addressLists[0].equals(contact));</span>
<a href="#l10.250"></a><span id="l10.250" class="difflineplus">+  equal(Array.from(list.childNodes).length, 0);</span>
<a href="#l10.251"></a><span id="l10.251" class="difflineplus">+  let childCards = Array.from(list.childCards, cc =&gt; cc.QueryInterface(Ci.nsIAbCard));</span>
<a href="#l10.252"></a><span id="l10.252" class="difflineplus">+  equal(childCards.length, 1);</span>
<a href="#l10.253"></a><span id="l10.253" class="difflineplus">+  ok(childCards[0].equals(contact));</span>
<a href="#l10.254"></a><span id="l10.254" class="difflineplus">+});</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineplus">+</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineplus">+add_task(async function removeMailingListMember() {</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineplus">+  let cardArray = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineplus">+  cardArray.appendElement(contact);</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineplus">+  list.deleteCards(cardArray);</span>
<a href="#l10.260"></a><span id="l10.260" class="difflineplus">+  equal(0, list.addressLists.Count());</span>
<a href="#l10.261"></a><span id="l10.261" class="difflineplus">+  observer.checkEvents([&quot;onItemRemoved&quot;, list, contact]);</span>
<a href="#l10.262"></a><span id="l10.262" class="difflineplus">+</span>
<a href="#l10.263"></a><span id="l10.263" class="difflineplus">+  // Check list enumerations.</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineplus">+  equal(Array.from(list.addressLists.enumerate()).length, 0);</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineplus">+  equal(Array.from(list.childNodes).length, 0);</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineplus">+  equal(Array.from(list.childCards).length, 0);</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineplus">+});</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineplus">+</span>
<a href="#l10.269"></a><span id="l10.269" class="difflineplus">+add_task(async function deleteMailingList() {</span>
<a href="#l10.270"></a><span id="l10.270" class="difflineplus">+  MailServices.ab.deleteAddressBook(list.URI);</span>
<a href="#l10.271"></a><span id="l10.271" class="difflineplus">+  observer.checkEvents(</span>
<a href="#l10.272"></a><span id="l10.272" class="difflineplus">+    [&quot;onItemRemoved&quot;, book, listCard],</span>
<a href="#l10.273"></a><span id="l10.273" class="difflineplus">+    [&quot;onItemRemoved&quot;, list, listCard],</span>
<a href="#l10.274"></a><span id="l10.274" class="difflineplus">+    [&quot;onItemRemoved&quot;, book, list]</span>
<a href="#l10.275"></a><span id="l10.275" class="difflineplus">+  );</span>
<a href="#l10.276"></a><span id="l10.276" class="difflineplus">+});</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineplus">+</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineplus">+add_task(async function deleteContact() {</span>
<a href="#l10.279"></a><span id="l10.279" class="difflineplus">+  let cardArray = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l10.280"></a><span id="l10.280" class="difflineplus">+  cardArray.appendElement(contact);</span>
<a href="#l10.281"></a><span id="l10.281" class="difflineplus">+  book.deleteCards(cardArray);</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineplus">+  observer.checkEvents([&quot;onItemRemoved&quot;, book, contact]);</span>
<a href="#l10.283"></a><span id="l10.283" class="difflineplus">+</span>
<a href="#l10.284"></a><span id="l10.284" class="difflineplus">+  // Check enumerations.</span>
<a href="#l10.285"></a><span id="l10.285" class="difflineplus">+  equal(Array.from(book.addressLists.enumerate()).length, 0);</span>
<a href="#l10.286"></a><span id="l10.286" class="difflineplus">+  equal(Array.from(book.childNodes).length, 0);</span>
<a href="#l10.287"></a><span id="l10.287" class="difflineplus">+  equal(Array.from(book.childCards).length, 0);</span>
<a href="#l10.288"></a><span id="l10.288" class="difflineplus">+});</span>
<a href="#l10.289"></a><span id="l10.289" class="difflineplus">+</span>
<a href="#l10.290"></a><span id="l10.290" class="difflineplus">+add_task(async function deleteAddressBook() {</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineplus">+  MailServices.ab.deleteAddressBook(book.URI);</span>
<a href="#l10.292"></a><span id="l10.292" class="difflineplus">+  observer.checkEvents([&quot;onItemRemoved&quot;, undefined, book]);</span>
<a href="#l10.293"></a><span id="l10.293" class="difflineplus">+  ok(!Services.prefs.prefHasUserValue(&quot;ldap_2.servers.newbook.dirType&quot;));</span>
<a href="#l10.294"></a><span id="l10.294" class="difflineplus">+  ok(!Services.prefs.prefHasUserValue(&quot;ldap_2.servers.newbook.description&quot;));</span>
<a href="#l10.295"></a><span id="l10.295" class="difflineplus">+  ok(!Services.prefs.prefHasUserValue(&quot;ldap_2.servers.newbook.filename&quot;));</span>
<a href="#l10.296"></a><span id="l10.296" class="difflineplus">+  ok(!Services.prefs.prefHasUserValue(&quot;ldap_2.servers.newbook.uid&quot;));</span>
<a href="#l10.297"></a><span id="l10.297" class="difflineplus">+  let dbFile = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineplus">+  dbFile.append(FILE_NAME);</span>
<a href="#l10.299"></a><span id="l10.299" class="difflineplus">+  ok(!dbFile.exists());</span>
<a href="#l10.300"></a><span id="l10.300" class="difflineplus">+  equal([...MailServices.ab.directories].length, DIR_TYPE == 101 ? 4 : 2);</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineplus">+  if (DIR_TYPE == 101) {</span>
<a href="#l10.302"></a><span id="l10.302" class="difflineplus">+    throws(() =&gt; MailServices.ab.getDirectory(`${SCHEME}://${FILE_NAME}`), /.*/);</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineplus">+  }</span>
<a href="#l10.304"></a><span id="l10.304" class="difflineplus">+});</span>
<a href="#l10.305"></a><span id="l10.305" class="difflineplus">+</span>
<a href="#l10.306"></a><span id="l10.306" class="difflineplus">+add_task(async function cleanUp() {</span>
<a href="#l10.307"></a><span id="l10.307" class="difflineplus">+  observer.checkEvents();</span>
<a href="#l10.308"></a><span id="l10.308" class="difflineplus">+  observer.cleanUp();</span>
<a href="#l10.309"></a><span id="l10.309" class="difflineplus">+});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_mailList1.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_mailList1.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -25,22 +25,17 @@ function checkLists(childNodes, number) </span>
<a href="#l11.4"></a><span id="l11.4">       mailListArray[index - 1] = list;</span>
<a href="#l11.5"></a><span id="l11.5">     }</span>
<a href="#l11.6"></a><span id="l11.6">   }</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8">   mailListArray.forEach(function(value) { Assert.notEqual(value, null); });</span>
<a href="#l11.9"></a><span id="l11.9"> }</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11"> function run_test() {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  // Create a new card</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  // Test setup - copy the data file into place</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-  var testAB = do_get_file(&quot;../../../data/abLists1.mab&quot;);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-  // Copy the file to the profile directory for a PAB</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-  testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+  loadABFile(&quot;../../../data/abLists1&quot;, kPABData.fileName);</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">   // Test - Get the directory.</span>
<a href="#l11.21"></a><span id="l11.21"> </span>
<a href="#l11.22"></a><span id="l11.22">   // XXX Getting all directories ensures we create all ABs because mailing</span>
<a href="#l11.23"></a><span id="l11.23">   // lists need help initialising themselves</span>
<a href="#l11.24"></a><span id="l11.24">   MailServices.ab.directories;</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">   let AB = MailServices.ab.getDirectory(kPABData.URI);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_notifications.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_notifications.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -131,32 +131,39 @@ add_test(function() {</span>
<a href="#l12.4"></a><span id="l12.4">   Assert.equal(book.dirName, &quot;TestList&quot;);</span>
<a href="#l12.5"></a><span id="l12.5">   Assert.equal(book.listNickName, &quot;test&quot;);</span>
<a href="#l12.6"></a><span id="l12.6">   Assert.equal(book.description, &quot;testdescription&quot;);</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8">   abListener.result = [];</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10">   // Test - Remove a list.</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+  // With this line, there'll be three notifications below.</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  // Without it, there'll be two. Go figure.</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+  [...book.childCards];</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+  abListener.maxResults = 3;</span>
<a href="#l12.17"></a><span id="l12.17">   AB.deleteDirectory(book);</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-  Assert.equal(abListener.result.length, 2);</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+  Assert.equal(abListener.result.length, 3);</span>
<a href="#l12.21"></a><span id="l12.21">   Assert.equal(abListener.result[0][0], &quot;onItemRemoved&quot;);</span>
<a href="#l12.22"></a><span id="l12.22">   Assert.equal(abListener.result[0][1], AB);</span>
<a href="#l12.23"></a><span id="l12.23">   Assert.equal(abListener.result[1][0], &quot;onItemRemoved&quot;);</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-  Assert.equal(abListener.result[1][1], AB);</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+  Assert.equal(abListener.result[1][1].QueryInterface(Ci.nsIAbDirectory).UID, book.UID);</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+  Assert.equal(abListener.result[2][0], &quot;onItemRemoved&quot;);</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+  Assert.equal(abListener.result[2][1], AB);</span>
<a href="#l12.28"></a><span id="l12.28"> </span>
<a href="#l12.29"></a><span id="l12.29">   // Now verify the card and the directory</span>
<a href="#l12.30"></a><span id="l12.30">   card = abListener.result[0][2].QueryInterface(Ci.nsIAbCard);</span>
<a href="#l12.31"></a><span id="l12.31">   Assert.ok(card.isMailList);</span>
<a href="#l12.32"></a><span id="l12.32">   Assert.equal(card.displayName, &quot;TestList&quot;);</span>
<a href="#l12.33"></a><span id="l12.33">   Assert.equal(card.getProperty(&quot;Notes&quot;, &quot;BAD&quot;), &quot;testdescription&quot;);</span>
<a href="#l12.34"></a><span id="l12.34">   Assert.equal(card.getProperty(&quot;NickName&quot;, &quot;BAD&quot;), &quot;test&quot;);</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-  book = abListener.result[1][2].QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+  book = abListener.result[2][2].QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l12.38"></a><span id="l12.38">   Assert.ok(book.isMailList);</span>
<a href="#l12.39"></a><span id="l12.39">   Assert.equal(book.dirName, &quot;TestList&quot;);</span>
<a href="#l12.40"></a><span id="l12.40">   Assert.equal(book.listNickName, &quot;test&quot;);</span>
<a href="#l12.41"></a><span id="l12.41">   Assert.equal(book.description, &quot;testdescription&quot;);</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43">   // Remove listener</span>
<a href="#l12.44"></a><span id="l12.44"> </span>
<a href="#l12.45"></a><span id="l12.45">   MailServices.ab.removeAddressBookListener(abListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -39,20 +39,17 @@ acObserver.prototype = {</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5">   onSearchResult(aSearch, aResult) {</span>
<a href="#l13.6"></a><span id="l13.6">     this._search = aSearch;</span>
<a href="#l13.7"></a><span id="l13.7">     this._result = aResult;</span>
<a href="#l13.8"></a><span id="l13.8">   },</span>
<a href="#l13.9"></a><span id="l13.9"> };</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11"> function run_test() {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  // Copy the data files into place</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-  let testAB = do_get_file(&quot;../../../data/tb2hexpopularity.mab&quot;);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-  testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+  loadABFile(&quot;../../../data/tb2hexpopularity&quot;, kPABData.fileName);</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">   // Test - Create a new search component</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20">   let acs = Cc[&quot;@mozilla.org/autocomplete/search;1?name=addrbook&quot;]</span>
<a href="#l13.21"></a><span id="l13.21">     .getService(Ci.nsIAutoCompleteSearch);</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23">   let obs = new acObserver();</span>
<a href="#l13.24"></a><span id="l13.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbManager2.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbManager2.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -110,16 +110,20 @@ function run_test() {</span>
<a href="#l14.4"></a><span id="l14.4">   MailServices.ab.addAddressBookListener(gAblAll, nsIAbListener.all);</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6">   for (i = 0; i &lt; numListenerOptions; ++i) {</span>
<a href="#l14.7"></a><span id="l14.7">     gAblSingle[i] = new abL;</span>
<a href="#l14.8"></a><span id="l14.8">     MailServices.ab.addAddressBookListener(gAblSingle[i], 1 &lt;&lt; i);</span>
<a href="#l14.9"></a><span id="l14.9">   }</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">   var expectedABs = [kPABData.URI, kCABData.URI];</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+  if (kPABData.dirType == 101) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+    expectedABs.push(&quot;moz-abmdbdirectory://abook.mab&quot;);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+    expectedABs.push(&quot;moz-abmdbdirectory://history.mab&quot;);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+  }</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">   // Test - Check initial directories</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">   checkDirs(MailServices.ab.directories, expectedABs);</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21">   // Test - Add a directory</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23">   var newDirectory1 = addDirectory(&quot;testAb1&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -5,21 +5,17 @@</span>
<a href="#l15.4"></a><span id="l15.4">  * XXX At the moment these just check the functions basically work i.e. can set</span>
<a href="#l15.5"></a><span id="l15.5">  * up all the parameters correctly. We'll have to extend them as we develop</span>
<a href="#l15.6"></a><span id="l15.6">  * the address book more, especially looking towards standards etc.</span>
<a href="#l15.7"></a><span id="l15.7">  */</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9"> // Main function for the this test so we can check both personal and</span>
<a href="#l15.10"></a><span id="l15.10"> // collected books work correctly in an easy manner.</span>
<a href="#l15.11"></a><span id="l15.11"> function run_test() {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  // Test setup - copy the data file into place</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  var testAB = do_get_file(&quot;data/cardForEmail.mab&quot;);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-  // Copy the file to the profile directory for a PAB</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-  testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+  loadABFile(&quot;data/cardForEmail&quot;, kPABData.fileName);</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19">   // Test - Get the directory</span>
<a href="#l15.20"></a><span id="l15.20">   let AB = MailServices.ab.getDirectory(kPABData.URI);</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22">   var childCards = AB.childCards;</span>
<a href="#l15.23"></a><span id="l15.23">   var fullCard = null;</span>
<a href="#l15.24"></a><span id="l15.24">   var tempCard;</span>
<a href="#l15.25"></a><span id="l15.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_uuid.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_uuid.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -95,21 +95,17 @@ function check_directory(directory) {</span>
<a href="#l16.4"></a><span id="l16.4">     // Question 5.2: Does readding a card try to best-fit the uid?</span>
<a href="#l16.5"></a><span id="l16.5">     card = directory.addCard(card);</span>
<a href="#l16.6"></a><span id="l16.6">     Assert.equal(card.directoryId, prefId);</span>
<a href="#l16.7"></a><span id="l16.7">     Assert.equal(card.localId, localId);</span>
<a href="#l16.8"></a><span id="l16.8">   }</span>
<a href="#l16.9"></a><span id="l16.9"> }</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11"> function run_test() {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  // Preliminary: we need a directory for local tests</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  var testAB = do_get_file(&quot;data/cardForEmail.mab&quot;);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-  // Copy the file to the profile directory for a PAB</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-  testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+  loadABFile(&quot;data/cardForEmail&quot;, kPABData.fileName);</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">   // Step 1: What is the ID of an empty card?</span>
<a href="#l16.20"></a><span id="l16.20">   var newCard = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;]</span>
<a href="#l16.21"></a><span id="l16.21">                   .createInstance(Ci.nsIAbCard);</span>
<a href="#l16.22"></a><span id="l16.22">   Assert.equal(newCard.uuid, &quot;&quot;);</span>
<a href="#l16.23"></a><span id="l16.23">   Assert.equal(newCard.directoryId, &quot;&quot;);</span>
<a href="#l16.24"></a><span id="l16.24">   Assert.equal(newCard.localId, &quot;&quot;);</span>
<a href="#l16.25"></a><span id="l16.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/mailnews/addrbook/test/unit/xpcshell-jsaddrbook.ini</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,8 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+[DEFAULT]</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+dupe-manifest =</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+head = head_jsaddrbook.js</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+tail =</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+support-files = data/*</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+tags = jsaddrbook</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+[include:xpcshell.ini]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/mailnews/addrbook/test/unit/xpcshell-mdbaddrbook.ini</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,19 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+[DEFAULT]</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineplus">+dupe-manifest =</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineplus">+head = head_addrbook.js</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+tail =</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+support-files = data/*</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+tags = mdbaddrbook</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+# These are the tests that do not pass or should not pass when using the</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+# JS directory provider.</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+[test_bug534822.js] # head_jsaddrbook.js breaks test</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+[test_ldap1.js]</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+[test_ldap2.js]</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+[test_ldapOffline.js]</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+[test_nsIAbCard.js] # translateTo is not implemented</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+[test_uid.js]</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+[test_uuid.js]</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+[include:xpcshell.ini]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/xpcshell.ini</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/xpcshell.ini</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,34 +1,23 @@</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineminus">-[DEFAULT]</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineminus">-head = head_addrbook.js</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineminus">-tail =</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineminus">-support-files = data/*</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineminus">-</span>
<a href="#l19.9"></a><span id="l19.9"> [test_basic_nsIAbCard.js]</span>
<a href="#l19.10"></a><span id="l19.10"> [test_basic_nsIAbDirectory.js]</span>
<a href="#l19.11"></a><span id="l19.11"> [test_bug387403.js]</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-[test_bug534822.js]</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-[test_bug_448165.js]</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+[test_bug448165.js]</span>
<a href="#l19.15"></a><span id="l19.15"> [test_bug1522453.js]</span>
<a href="#l19.16"></a><span id="l19.16"> [test_cardForEmail.js]</span>
<a href="#l19.17"></a><span id="l19.17"> [test_collection.js]</span>
<a href="#l19.18"></a><span id="l19.18"> [test_collection_2.js]</span>
<a href="#l19.19"></a><span id="l19.19"> [test_db_enumerator.js]</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-[test_ldap1.js]</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">-[test_ldap2.js]</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineminus">-[test_ldapOffline.js]</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+[test_jsaddrbook.js]</span>
<a href="#l19.24"></a><span id="l19.24"> [test_mailList1.js]</span>
<a href="#l19.25"></a><span id="l19.25"> [test_notifications.js]</span>
<a href="#l19.26"></a><span id="l19.26"> [test_nsAbAutoCompleteMyDomain.js]</span>
<a href="#l19.27"></a><span id="l19.27"> [test_nsAbAutoCompleteSearch1.js]</span>
<a href="#l19.28"></a><span id="l19.28"> [test_nsAbAutoCompleteSearch2.js]</span>
<a href="#l19.29"></a><span id="l19.29"> [test_nsAbAutoCompleteSearch3.js]</span>
<a href="#l19.30"></a><span id="l19.30"> [test_nsAbAutoCompleteSearch4.js]</span>
<a href="#l19.31"></a><span id="l19.31"> [test_nsAbAutoCompleteSearch5.js]</span>
<a href="#l19.32"></a><span id="l19.32"> [test_nsAbAutoCompleteSearch6.js]</span>
<a href="#l19.33"></a><span id="l19.33"> [test_nsAbAutoCompleteSearch7.js]</span>
<a href="#l19.34"></a><span id="l19.34"> [test_nsAbManager1.js]</span>
<a href="#l19.35"></a><span id="l19.35"> [test_nsAbManager2.js]</span>
<a href="#l19.36"></a><span id="l19.36"> [test_nsAbManager3.js]</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">-[test_nsIAbCard.js]</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">-[test_uid.js]</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">-[test_uuid.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">new file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- /dev/null</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ b/mailnews/test/data/abLists1.sql</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -0,0 +1,61 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineplus">+PRAGMA user_version = 1;</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineplus">+</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineplus">+CREATE TABLE cards (uid TEXT PRIMARY KEY, localId INTEGER);</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineplus">+CREATE TABLE properties (card TEXT, name TEXT, value TEXT);</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineplus">+CREATE TABLE lists (uid TEXT PRIMARY KEY, localId INTEGER, name TEXT, nickName TEXT, description TEXT);</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineplus">+CREATE TABLE list_cards (list TEXT, card TEXT, PRIMARY KEY(list, card));</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineplus">+</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+INSERT INTO cards (uid, localId) VALUES</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  ('0a64d642-7b51-4a84-be67-59b27ff2b528', 1),</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+  ('ce1bd5ad-17e7-4a1b-a51e-fbce76556ebd', 2),</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+  ('caaadb6c-425d-40e3-8f19-72546f6b01d8', 3),</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+  ('23acb230-f0d9-4348-a7be-1242cd579631', 4),</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+  ('02cf43d5-e5b8-48b4-9546-1bb509cd998f', 5);</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+INSERT INTO properties (card, name, value) VALUES</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+  ('0a64d642-7b51-4a84-be67-59b27ff2b528', 'PrimaryEmail', 'test1@foo.invalid'),</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+  ('0a64d642-7b51-4a84-be67-59b27ff2b528', 'LowercasePrimaryEmail', 'test1@foo.invalid'),</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+  ('0a64d642-7b51-4a84-be67-59b27ff2b528', 'PreferMailFormat', '0'),</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+  ('0a64d642-7b51-4a84-be67-59b27ff2b528', 'PopularityIndex', '0'),</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineplus">+  ('0a64d642-7b51-4a84-be67-59b27ff2b528', 'AllowRemoteContent', '0'),</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+  ('0a64d642-7b51-4a84-be67-59b27ff2b528', 'LastModifiedDate', '0'),</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+  ('ce1bd5ad-17e7-4a1b-a51e-fbce76556ebd', 'PrimaryEmail', 'test2@foo.invalid'),</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+  ('ce1bd5ad-17e7-4a1b-a51e-fbce76556ebd', 'LowercasePrimaryEmail', 'test2@foo.invalid'),</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+  ('ce1bd5ad-17e7-4a1b-a51e-fbce76556ebd', 'PreferMailFormat', '0'),</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineplus">+  ('ce1bd5ad-17e7-4a1b-a51e-fbce76556ebd', 'PopularityIndex', '0'),</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+  ('ce1bd5ad-17e7-4a1b-a51e-fbce76556ebd', 'AllowRemoteContent', '0'),</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+  ('ce1bd5ad-17e7-4a1b-a51e-fbce76556ebd', 'LastModifiedDate', '0'),</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineplus">+</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+  ('caaadb6c-425d-40e3-8f19-72546f6b01d8', 'PrimaryEmail', 'test3@foo.invalid'),</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+  ('caaadb6c-425d-40e3-8f19-72546f6b01d8', 'LowercasePrimaryEmail', 'test3@foo.invalid'),</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineplus">+  ('caaadb6c-425d-40e3-8f19-72546f6b01d8', 'PreferMailFormat', '0'),</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineplus">+  ('caaadb6c-425d-40e3-8f19-72546f6b01d8', 'PopularityIndex', '0'),</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+  ('caaadb6c-425d-40e3-8f19-72546f6b01d8', 'AllowRemoteContent', '0'),</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+  ('caaadb6c-425d-40e3-8f19-72546f6b01d8', 'LastModifiedDate', '0'),</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineplus">+  ('23acb230-f0d9-4348-a7be-1242cd579631', 'PrimaryEmail', 'test4@foo.invalid'),</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineplus">+  ('23acb230-f0d9-4348-a7be-1242cd579631', 'LowercasePrimaryEmail', 'test4@foo.invalid'),</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineplus">+  ('23acb230-f0d9-4348-a7be-1242cd579631', 'LastModifiedDate', '1200685646'),</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineplus">+  ('23acb230-f0d9-4348-a7be-1242cd579631', 'PreferMailFormat', '1'),</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+  ('23acb230-f0d9-4348-a7be-1242cd579631', 'PopularityIndex', '0'),</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+  ('23acb230-f0d9-4348-a7be-1242cd579631', 'AllowRemoteContent', '0'),</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+  ('02cf43d5-e5b8-48b4-9546-1bb509cd998f', 'PrimaryEmail', 'test5@foo.invalid'),</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+  ('02cf43d5-e5b8-48b4-9546-1bb509cd998f', 'LowercasePrimaryEmail', 'test5@foo.invalid'),</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+  ('02cf43d5-e5b8-48b4-9546-1bb509cd998f', 'LastModifiedDate', '1200685651'),</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+  ('02cf43d5-e5b8-48b4-9546-1bb509cd998f', 'PreferMailFormat', '2'),</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineplus">+  ('02cf43d5-e5b8-48b4-9546-1bb509cd998f', 'PopularityIndex', '0'),</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineplus">+  ('02cf43d5-e5b8-48b4-9546-1bb509cd998f', 'AllowRemoteContent', '0');</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+INSERT INTO lists (uid, localId, name, nickName, description) VALUES</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineplus">+  ('98636844-ed9c-4ac1-98ac-de7989a93615', 1, 'TestList1', '', ''),</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineplus">+  ('31c44c28-450f-44d6-ba39-71cae90fac21', 2, 'TestList2', '', ''),</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+  ('46cf4cbf-5945-43e4-a822-30c2f2969db9', 3, 'TestList3', '', '');</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineplus">+</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineplus">+INSERT INTO list_cards (list, card) VALUES</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+  ('98636844-ed9c-4ac1-98ac-de7989a93615', '0a64d642-7b51-4a84-be67-59b27ff2b528'),</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+  ('98636844-ed9c-4ac1-98ac-de7989a93615', 'ce1bd5ad-17e7-4a1b-a51e-fbce76556ebd'),</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineplus">+  ('98636844-ed9c-4ac1-98ac-de7989a93615', 'caaadb6c-425d-40e3-8f19-72546f6b01d8'),</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineplus">+  ('31c44c28-450f-44d6-ba39-71cae90fac21', '23acb230-f0d9-4348-a7be-1242cd579631'),</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+  ('31c44c28-450f-44d6-ba39-71cae90fac21', '02cf43d5-e5b8-48b4-9546-1bb509cd998f');</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">new file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- /dev/null</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ b/mailnews/test/data/tb2hexpopularity.sql</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -0,0 +1,75 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineplus">+PRAGMA user_version = 1;</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineplus">+</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineplus">+CREATE TABLE cards (uid TEXT PRIMARY KEY, localId INTEGER);</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineplus">+CREATE TABLE properties (card TEXT, name TEXT, value TEXT);</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineplus">+CREATE TABLE lists (uid TEXT PRIMARY KEY, localId INTEGER, name TEXT, nickName TEXT, description TEXT);</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineplus">+CREATE TABLE list_cards (list TEXT, card TEXT, PRIMARY KEY(list, card));</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineplus">+</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+INSERT INTO cards (uid, localId) VALUES</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 1),</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 2),</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 3),</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 4),</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 5);</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+INSERT INTO properties (card, name, value) VALUES</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'FirstName', 'firs'),</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'LastName', 'lastn'),</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'PrimaryEmail', 'ema@test.invalid'),</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'LowercasePrimaryEmail', 'ema@test.invalid'),</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'DisplayName', 'd'),</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'NickName', 'ni'),</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'PreferMailFormat', '0'),</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'PopularityIndex', '0'),</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'AllowRemoteContent', '0'),</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+  ('9c4232ec-8992-44b2-8fd7-71dfb23a93c6', 'LastModifiedDate', '0'),</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'FirstName', 'first'),</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'NickName', 'nic'),</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'PrimaryEmail', 'emai@test.invalid'),</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'LowercasePrimaryEmail', 'emai@test.invalid'),</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'LastName', 'l'),</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'DisplayName', 'di'),</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'PreferMailFormat', '0'),</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'PopularityIndex', '0'),</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'AllowRemoteContent', '0'),</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+  ('40326ec9-5361-4f8c-9797-0de3b28edce9', 'LastModifiedDate', '0'),</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'DisplayName', 'dis'),</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'NickName', 'nick'),</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'PrimaryEmail', 'email@test.invalid'),</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'LowercasePrimaryEmail', 'email@test.invalid'),</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'FirstName', 'f'),</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'LastName', 'la'),</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'PreferMailFormat', '0'),</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'PopularityIndex', '0'),</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'AllowRemoteContent', '0'),</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+  ('f96f5eb1-6181-4588-b0d4-0fc47c9ac995', 'LastModifiedDate', '0'),</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineplus">+</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'LastName', 'las'),</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'DisplayName', 'disp'),</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'NickName', 'nickn'),</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'PrimaryEmail', 'e@test.invalid'),</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'LowercasePrimaryEmail', 'e@test.invalid'),</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'FirstName', 'fi'),</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'PreferMailFormat', '0'),</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'PopularityIndex', '0'),</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'AllowRemoteContent', '0'),</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+  ('a95c192c-ad3d-4e56-a7e3-8b969c80c717', 'LastModifiedDate', '0'),</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'FirstName', 'fir'),</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'LastName', 'last'),</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'DisplayName', 'displ'),</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'PrimaryEmail', 'em@test.invalid'),</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'LowercasePrimaryEmail', 'em@test.invalid'),</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'NickName', 'n'),</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'PreferMailFormat', '0'),</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'PopularityIndex', 'a'),</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'AllowRemoteContent', '0'),</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+  ('620c1226-eb2d-4df7-a532-f731544525ba', 'LastModifiedDate', '0');</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineplus">+INSERT INTO lists (uid, localId, name, nickName, description) VALUES</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineplus">+  ('ab831252-d358-435b-a5a4-7f8536ea53d5', 6, 't', '', 'list'),</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineplus">+  ('52924d31-3a7d-420f-b4b4-039e9888ed08', 7, 'te', '', 'lis'),</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineplus">+  ('71b6f54e-dbc4-4bf0-a7d7-7235a5551ba5', 8, 'tes', '', 'li'),</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineplus">+  ('a0f4d368-7451-4756-b003-1018f231c7b4', 9, 'test', 'abcdef', 'l');</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

