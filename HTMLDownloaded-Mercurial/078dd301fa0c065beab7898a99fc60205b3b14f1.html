<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 11871:078dd301fa0c065beab7898a99fc60205b3b14f1</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 078dd301fa0c065beab7898a99fc60205b3b14f1" />
<meta property="og:url" content="/comm-central/rev/078dd301fa0c065beab7898a99fc60205b3b14f1" />
<meta property="og:description" content="Bug 759422 - Remove all uses of e4x from comm-central to reopen a CLOSED TREE, r=BenB." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 078dd301fa0c065beab7898a99fc60205b3b14f1 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/078dd301fa0c065beab7898a99fc60205b3b14f1">shortlog</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/078dd301fa0c065beab7898a99fc60205b3b14f1">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1">files</a> |
changeset |
<a href="/comm-central/raw-rev/078dd301fa0c065beab7898a99fc60205b3b14f1">raw</a>  | <a href="/comm-central/archive/078dd301fa0c065beab7898a99fc60205b3b14f1.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=759422">Bug 759422</a> - Remove all uses of e4x from comm-central to reopen a CLOSED TREE, r=BenB.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#115;&#104;&#117;&#97;&#32;&#67;&#114;&#97;&#110;&#109;&#101;&#114;&#32;&#60;&#80;&#105;&#100;&#103;&#101;&#111;&#116;&#49;&#56;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 07 Aug 2012 14:58:47 -0500</td></tr>

<tr>
 <td>changeset 11871</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/078dd301fa0c065beab7898a99fc60205b3b14f1">078dd301fa0c065beab7898a99fc60205b3b14f1</a></td>
</tr>



<tr>
<td>parent 11870</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/eb1a4a4c5a76c040279c84fe6c1950c5d76c9585">eb1a4a4c5a76c040279c84fe6c1950c5d76c9585</a>
</td>
</tr>

<tr>
<td>child 11872</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8c02df6a242dbe3dc3166a4f2921e74df6cac2d0">8c02df6a242dbe3dc3166a4f2921e74df6cac2d0</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=078dd301fa0c065beab7898a99fc60205b3b14f1">8847</a></td></tr>
<tr><td>push user</td><td>Pidgeot18@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 04 Feb 2013 00:22:20 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@078dd301fa0c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=078dd301fa0c065beab7898a99fc60205b3b14f1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=078dd301fa0c065beab7898a99fc60205b3b14f1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=078dd301fa0c065beab7898a99fc60205b3b14f1&newProject=comm-central&newRevision=078dd301fa0c065beab7898a99fc60205b3b14f1&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=078dd301fa0c065beab7898a99fc60205b3b14f1&newProject=comm-central&newRevision=078dd301fa0c065beab7898a99fc60205b3b14f1&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=078dd301fa0c065beab7898a99fc60205b3b14f1&newProject=comm-central&newRevision=078dd301fa0c065beab7898a99fc60205b3b14f1&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28BenB%29&revcount=50">BenB</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=759422">759422</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=759422">Bug 759422</a> - Remove all uses of e4x from comm-central to reopen a CLOSED TREE, r=BenB.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/app/profile/all-thunderbird.js">mail/app/profile/all-thunderbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/app/profile/all-thunderbird.js">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/app/profile/all-thunderbird.js">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/app/profile/all-thunderbird.js">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/app/profile/all-thunderbird.js">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/app/profile/all-thunderbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/cloudfile/nsYouSendIt.js">mail/components/cloudfile/nsYouSendIt.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/cloudfile/nsYouSendIt.js">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/cloudfile/nsYouSendIt.js">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/cloudfile/nsYouSendIt.js">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/cloudfile/nsYouSendIt.js">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/cloudfile/nsYouSendIt.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/newmailaccount/content/uriListener.js">mail/components/newmailaccount/content/uriListener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/newmailaccount/content/uriListener.js">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/newmailaccount/content/uriListener.js">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/newmailaccount/content/uriListener.js">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/newmailaccount/content/uriListener.js">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mail/components/newmailaccount/content/uriListener.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchConfig.js">mailnews/base/prefs/content/accountcreation/fetchConfig.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchConfig.js">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchConfig.js">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchConfig.js">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchConfig.js">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchConfig.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchhttp.js">mailnews/base/prefs/content/accountcreation/fetchhttp.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchhttp.js">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchhttp.js">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchhttp.js">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchhttp.js">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/fetchhttp.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/readFromXML.js">mailnews/base/prefs/content/accountcreation/readFromXML.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/readFromXML.js">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/readFromXML.js">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/readFromXML.js">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/readFromXML.js">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/prefs/content/accountcreation/readFromXML.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_autoconfigXML.js">mailnews/base/test/unit/test_autoconfigXML.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_autoconfigXML.js">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_autoconfigXML.js">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_autoconfigXML.js">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_autoconfigXML.js">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_autoconfigXML.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_searchCustomTerm.js">mailnews/base/test/unit/test_searchCustomTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_searchCustomTerm.js">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_searchCustomTerm.js">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_searchCustomTerm.js">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_searchCustomTerm.js">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/test/unit/test_searchCustomTerm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/JXON.js">mailnews/base/util/JXON.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/JXON.js">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/JXON.js">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/JXON.js">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/JXON.js">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/JXON.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/Makefile.in">mailnews/base/util/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/Makefile.in">file</a> |
<a href="/comm-central/annotate/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/Makefile.in">annotate</a> |
<a href="/comm-central/diff/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/Makefile.in">diff</a> |
<a href="/comm-central/comparison/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/Makefile.in">comparison</a> |
<a href="/comm-central/log/078dd301fa0c065beab7898a99fc60205b3b14f1/mailnews/base/util/Makefile.in">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -6,18 +6,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #filter substitution</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> #ifdef XP_UNIX</span>
<a href="#l1.7"></a><span id="l1.7"> #ifndef XP_MACOSX</span>
<a href="#l1.8"></a><span id="l1.8"> #define UNIX_BUT_NOT_MAC</span>
<a href="#l1.9"></a><span id="l1.9"> #endif</span>
<a href="#l1.10"></a><span id="l1.10"> #endif</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-pref(&quot;javascript.options.xml.chrome&quot;, true);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-</span>
<a href="#l1.14"></a><span id="l1.14"> pref(&quot;general.useragent.locale&quot;, &quot;@AB_CD@&quot;);</span>
<a href="#l1.15"></a><span id="l1.15"> pref(&quot;general.skins.selectedSkin&quot;, &quot;classic/1.0&quot;);</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> #ifdef XP_MACOSX</span>
<a href="#l1.18"></a><span id="l1.18"> pref(&quot;browser.chromeURL&quot;, &quot;chrome://messenger/content/messengercompose/messengercompose.xul&quot;);</span>
<a href="#l1.19"></a><span id="l1.19"> pref(&quot;mail.biff.animate_dock_icon&quot;, false);</span>
<a href="#l1.20"></a><span id="l1.20"> #endif</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -381,18 +379,16 @@ pref(&quot;browser.download.manager.showAlert</span>
<a href="#l1.23"></a><span id="l1.23"> pref(&quot;browser.download.manager.retention&quot;, 1);</span>
<a href="#l1.24"></a><span id="l1.24"> pref(&quot;browser.download.manager.showWhenStarting&quot;, true);</span>
<a href="#l1.25"></a><span id="l1.25"> pref(&quot;browser.download.manager.closeWhenDone&quot;, true);</span>
<a href="#l1.26"></a><span id="l1.26"> pref(&quot;browser.download.manager.openDelay&quot;, 100);</span>
<a href="#l1.27"></a><span id="l1.27"> pref(&quot;browser.download.manager.focusWhenStarting&quot;, false);</span>
<a href="#l1.28"></a><span id="l1.28"> pref(&quot;browser.download.manager.flashCount&quot;, 0);</span>
<a href="#l1.29"></a><span id="l1.29"> pref(&quot;browser.download.manager.addToRecentDocs&quot;, true);</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-pref(&quot;javascript.options.showInConsole&quot;,    true);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-</span>
<a href="#l1.33"></a><span id="l1.33"> pref(&quot;spellchecker.dictionary&quot;, &quot;&quot;);</span>
<a href="#l1.34"></a><span id="l1.34"> // Dictionary download preference</span>
<a href="#l1.35"></a><span id="l1.35"> pref(&quot;spellchecker.dictionaries.download.url&quot;, &quot;https://addons.mozilla.org/%LOCALE%/%APP%/dictionaries/&quot;);</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37"> // profile.force.migration can be used to bypass the migration wizard, forcing migration from a particular</span>
<a href="#l1.38"></a><span id="l1.38"> // mail application without any user intervention. Possible values are: </span>
<a href="#l1.39"></a><span id="l1.39"> // seamonkey (mozilla suite), eudora, oexpress, outlook.</span>
<a href="#l1.40"></a><span id="l1.40"> pref(&quot;profile.force.migration&quot;, &quot;&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/cloudfile/nsYouSendIt.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/cloudfile/nsYouSendIt.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -975,27 +975,17 @@ nsYouSendItFileUploader.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">     let curDate = Date.now().toString();</span>
<a href="#l2.5"></a><span id="l2.5">     this.log.info(&quot;upload url = &quot; + this._urlInfo.uploadUrl[0]);</span>
<a href="#l2.6"></a><span id="l2.6">     this.request = req;</span>
<a href="#l2.7"></a><span id="l2.7">     req.open(&quot;POST&quot;, this._urlInfo.uploadUrl[0] + &quot;?&quot; + kUrlTail, true);</span>
<a href="#l2.8"></a><span id="l2.8">     req.onload = function() {</span>
<a href="#l2.9"></a><span id="l2.9">       this.cleanupTempFile();</span>
<a href="#l2.10"></a><span id="l2.10">       if (req.status &gt;= 200 &amp;&amp; req.status &lt; 400) {</span>
<a href="#l2.11"></a><span id="l2.11">         try {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-          let response = req.responseText.replace(/&lt;\?xml[^&gt;]*\?&gt;/, &quot;&quot;);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-          this.log.info(&quot;upload response = &quot; + response);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-          let docResponse = new XML(response);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-          this.log.info(&quot;docResponse = &quot; + docResponse);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-          this._uploadResponse = docResponse;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-          let ysiError = docResponse['ysi-error'];</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-          let uploadStatus = docResponse['upload-status'];</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-          this.log.info(&quot;upload status = &quot; + uploadStatus);</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-          this.log.info(&quot;ysi error = &quot; + ysiError);</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-          let errorCode = docResponse['error-code'];</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-          this.log.info(&quot;error code = &quot; + errorCode);</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+          this.log.info(&quot;upload response = &quot; + req.responseText);</span>
<a href="#l2.24"></a><span id="l2.24">           this._commitSend();</span>
<a href="#l2.25"></a><span id="l2.25">         } catch (ex) {</span>
<a href="#l2.26"></a><span id="l2.26">           this.log.error(ex);</span>
<a href="#l2.27"></a><span id="l2.27">         }</span>
<a href="#l2.28"></a><span id="l2.28">       }</span>
<a href="#l2.29"></a><span id="l2.29">       else</span>
<a href="#l2.30"></a><span id="l2.30">         this.callback(this.requestObserver,</span>
<a href="#l2.31"></a><span id="l2.31">                       Ci.nsIMsgCloudFileProvider.uploadErr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/newmailaccount/content/uriListener.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/newmailaccount/content/uriListener.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -11,16 +11,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> let Cu = Components.utils;</span>
<a href="#l3.5"></a><span id="l3.5"> let Cc = Components.classes;</span>
<a href="#l3.6"></a><span id="l3.6"> let Ci = Components.interfaces;</span>
<a href="#l3.7"></a><span id="l3.7"> let Cr = Components.results;</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.10"></a><span id="l3.10"> Cu.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l3.11"></a><span id="l3.11"> Cu.import(&quot;resource://gre/modules/NetUtil.jsm&quot;);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+Cu.import(&quot;resource://gre/modules/JXON.js&quot;);</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14"> /**</span>
<a href="#l3.15"></a><span id="l3.15">  * This is an observer that watches all HTTP requests for one where the</span>
<a href="#l3.16"></a><span id="l3.16">  * response contentType contains text/xml.  Once that observation is</span>
<a href="#l3.17"></a><span id="l3.17">  * made, we ensure that the associated window for that request matches</span>
<a href="#l3.18"></a><span id="l3.18">  * the window belonging to the content tab for the account order form.</span>
<a href="#l3.19"></a><span id="l3.19">  * If so, we attach an nsITraceableListener to read the contents of the</span>
<a href="#l3.20"></a><span id="l3.20">  * request response, and react accordingly if the contents can be turned</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -170,20 +171,19 @@ TracingListener.prototype = {</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23">     let tabmail = document.getElementById('tabmail');</span>
<a href="#l3.24"></a><span id="l3.24">     let success = false;</span>
<a href="#l3.25"></a><span id="l3.25">     let account;</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27">     try {</span>
<a href="#l3.28"></a><span id="l3.28">       // Attempt to construct the downloaded data into XML</span>
<a href="#l3.29"></a><span id="l3.29">       let data = this.chunks.join(&quot;&quot;);</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-      let xml = new XML(data);</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32">       // Attempt to derive email account information</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-      let accountConfig = accountCreationFuncs.readFromXML(xml);</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+      let accountConfig = accountCreationFuncs.readFromXML(JXON.build(data));</span>
<a href="#l3.35"></a><span id="l3.35">       accountCreationFuncs.replaceVariables(accountConfig,</span>
<a href="#l3.36"></a><span id="l3.36">                                             this.params.realName,</span>
<a href="#l3.37"></a><span id="l3.37">                                             this.params.email);</span>
<a href="#l3.38"></a><span id="l3.38">       account = accountCreationFuncs.createAccountInBackend(accountConfig);</span>
<a href="#l3.39"></a><span id="l3.39">       success = true;</span>
<a href="#l3.40"></a><span id="l3.40">     } catch (e) {</span>
<a href="#l3.41"></a><span id="l3.41">       // Something went wrong with account set up. Dump the error out to the</span>
<a href="#l3.42"></a><span id="l3.42">       // error console. The tab will be closed, and the Account Provisioner</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/prefs/content/accountcreation/fetchConfig.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/prefs/content/accountcreation/fetchConfig.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -5,32 +5,35 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> /**</span>
<a href="#l4.6"></a><span id="l4.6">  * Tries to find a configuration for this ISP on the local harddisk, in the</span>
<a href="#l4.7"></a><span id="l4.7">  * application install directory's &quot;isp&quot; subdirectory.</span>
<a href="#l4.8"></a><span id="l4.8">  * Params @see fetchConfigFromISP()</span>
<a href="#l4.9"></a><span id="l4.9">  */</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/JXON.js&quot;);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15"> function fetchConfigFromDisk(domain, successCallback, errorCallback)</span>
<a href="#l4.16"></a><span id="l4.16"> {</span>
<a href="#l4.17"></a><span id="l4.17">   return new TimeoutAbortable(runAsync(function()</span>
<a href="#l4.18"></a><span id="l4.18">   {</span>
<a href="#l4.19"></a><span id="l4.19">     try {</span>
<a href="#l4.20"></a><span id="l4.20">       // &lt;TB installdir&gt;/isp/example.com.xml</span>
<a href="#l4.21"></a><span id="l4.21">       var configLocation = Services.dirsvc.get(&quot;CurProcD&quot;, Ci.nsIFile);</span>
<a href="#l4.22"></a><span id="l4.22">       configLocation.append(&quot;isp&quot;);</span>
<a href="#l4.23"></a><span id="l4.23">       configLocation.append(sanitize.hostname(domain) + &quot;.xml&quot;);</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">       var contents =</span>
<a href="#l4.26"></a><span id="l4.26">         readURLasUTF8(Services.io.newFileURI(configLocation));</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-       // Bug 336551 trips over &lt;?xml ... &gt;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-      contents = contents.replace(/&lt;\?xml[^&gt;]*\?&gt;/, &quot;&quot;);</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-      successCallback(readFromXML(new XML(contents)));</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+      let domParser = Cc[&quot;@mozilla.org/xmlextras/domparser;1&quot;]</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+                       .createInstance(Ci.nsIDOMParser);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+      successCallback(readFromXML(JXON.build(</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+        domParser.parseFromString(contents, &quot;text/xml&quot;))));</span>
<a href="#l4.34"></a><span id="l4.34">     } catch (e) { errorCallback(e); }</span>
<a href="#l4.35"></a><span id="l4.35">   }));</span>
<a href="#l4.36"></a><span id="l4.36"> }</span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38"> /**</span>
<a href="#l4.39"></a><span id="l4.39">  * Tries to get a configuration from the ISP / mail provider directly.</span>
<a href="#l4.40"></a><span id="l4.40">  *</span>
<a href="#l4.41"></a><span id="l4.41">  * Disclaimers:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/prefs/content/accountcreation/fetchhttp.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/prefs/content/accountcreation/fetchhttp.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -10,16 +10,18 @@</span>
<a href="#l5.4"></a><span id="l5.4">  *</span>
<a href="#l5.5"></a><span id="l5.5">  * It does not provide download progress, but assumes that the</span>
<a href="#l5.6"></a><span id="l5.6">  * fetched resource is so small (&lt;1 10 KB) that the roundtrip and</span>
<a href="#l5.7"></a><span id="l5.7">  * response generation is far more significant than the</span>
<a href="#l5.8"></a><span id="l5.8">  * download time of the response. In other words, it's fine for RPC,</span>
<a href="#l5.9"></a><span id="l5.9">  * but not for bigger file downloads.</span>
<a href="#l5.10"></a><span id="l5.10">  */</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/JXON.js&quot;);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+</span>
<a href="#l5.14"></a><span id="l5.14"> /**</span>
<a href="#l5.15"></a><span id="l5.15">  * Set up a fetch.</span>
<a href="#l5.16"></a><span id="l5.16">  *</span>
<a href="#l5.17"></a><span id="l5.17">  * @param url {String}   URL of the server function.</span>
<a href="#l5.18"></a><span id="l5.18">  *    ATTENTION: The caller needs to make sure that the URL is secure to call.</span>
<a href="#l5.19"></a><span id="l5.19">  * @param urlArgs {Object, associative array} Parameters to add</span>
<a href="#l5.20"></a><span id="l5.20">  *   to the end of the URL as query string. E.g.</span>
<a href="#l5.21"></a><span id="l5.21">  *   { foo: &quot;bla&quot;, bar: &quot;blub blub&quot; } will add &quot;?foo=bla&amp;bar=blub%20blub&quot;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -130,21 +132,18 @@ FetchHTTP.prototype =</span>
<a href="#l5.23"></a><span id="l5.23">         var mimetype = this._request.getResponseHeader(&quot;Content-Type&quot;);</span>
<a href="#l5.24"></a><span id="l5.24">         if (!mimetype)</span>
<a href="#l5.25"></a><span id="l5.25">           mimetype = &quot;&quot;;</span>
<a href="#l5.26"></a><span id="l5.26">         mimetype = mimetype.split(&quot;;&quot;)[0];</span>
<a href="#l5.27"></a><span id="l5.27">         if (mimetype == &quot;text/xml&quot; ||</span>
<a href="#l5.28"></a><span id="l5.28">             mimetype == &quot;application/xml&quot; ||</span>
<a href="#l5.29"></a><span id="l5.29">             mimetype == &quot;text/rdf&quot;)</span>
<a href="#l5.30"></a><span id="l5.30">         {</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-          // Bug 270553 prevents usage of .responseXML</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-          var text = this._request.responseText;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-           // Bug 336551 trips over &lt;?xml ... &gt;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-          text = text.replace(/&lt;\?xml[^&gt;]*\?&gt;/, &quot;&quot;);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-          this.result = new XML(text);</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+          this._request.overrideMimeType(&quot;text/xml&quot;);</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+          this.result = JXON.build(this._request.responseXML);</span>
<a href="#l5.38"></a><span id="l5.38">         }</span>
<a href="#l5.39"></a><span id="l5.39">         else</span>
<a href="#l5.40"></a><span id="l5.40">         {</span>
<a href="#l5.41"></a><span id="l5.41">           //ddump(&quot;mimetype: &quot; + mimetype + &quot; only supported as text&quot;);</span>
<a href="#l5.42"></a><span id="l5.42">           this.result = this._request.responseText;</span>
<a href="#l5.43"></a><span id="l5.43">         }</span>
<a href="#l5.44"></a><span id="l5.44">         //ddump(&quot;result:\n&quot; + this.result);</span>
<a href="#l5.45"></a><span id="l5.45">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/prefs/content/accountcreation/readFromXML.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/prefs/content/accountcreation/readFromXML.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,88 +1,92 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l6.5"></a><span id="l6.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> /**</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">- * Takes an XML snipplet (as E4X) and reads the values into</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+ * Takes an XML snipplet (as JXON) and reads the values into</span>
<a href="#l6.12"></a><span id="l6.12">  * a new AccountConfig object.</span>
<a href="#l6.13"></a><span id="l6.13">  * It does so securely (or tries to), by trying to avoid remote execution</span>
<a href="#l6.14"></a><span id="l6.14">  * and similar holes which can appear when reading too naively.</span>
<a href="#l6.15"></a><span id="l6.15">  * Of course it cannot tell whether the actual values are correct,</span>
<a href="#l6.16"></a><span id="l6.16">  * e.g. it can't tell whether the host name is a good server.</span>
<a href="#l6.17"></a><span id="l6.17">  *</span>
<a href="#l6.18"></a><span id="l6.18">  * The XML format is documented at</span>
<a href="#l6.19"></a><span id="l6.19">  * &lt;https://wiki.mozilla.org/Thunderbird:Autoconfiguration:ConfigFileFormat&gt;</span>
<a href="#l6.20"></a><span id="l6.20">  *</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">- * @param clientConfigXML {E4X}  The &lt;clientConfig&gt; node.</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+ * @param clientConfigXML {JXON}  The &lt;clientConfig&gt; node.</span>
<a href="#l6.23"></a><span id="l6.23">  * @return AccountConfig   object filled with the data from XML</span>
<a href="#l6.24"></a><span id="l6.24">  */</span>
<a href="#l6.25"></a><span id="l6.25"> function readFromXML(clientConfigXML)</span>
<a href="#l6.26"></a><span id="l6.26"> {</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+  function array_or_undef(value) {</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+    return value === undefined ? [] : value;</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+  }</span>
<a href="#l6.30"></a><span id="l6.30">   var exception;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  if (typeof(clientConfigXML) != &quot;xml&quot; ||</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-      !(&quot;emailProvider&quot; in clientConfigXML))</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+  if (typeof(clientConfigXML) != &quot;object&quot; ||</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+      !(&quot;clientConfig&quot; in clientConfigXML) ||</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+      !(&quot;emailProvider&quot; in clientConfigXML.clientConfig))</span>
<a href="#l6.36"></a><span id="l6.36">   {</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-    dump(&quot;client config xml = &quot; + clientConfigXML + &quot;\n&quot;);</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+    dump(&quot;client config xml = &quot; + JSON.stringify(clientConfigXML) + &quot;\n&quot;);</span>
<a href="#l6.39"></a><span id="l6.39">     var stringBundle = getStringBundle(</span>
<a href="#l6.40"></a><span id="l6.40">         &quot;chrome://messenger/locale/accountCreationModel.properties&quot;);</span>
<a href="#l6.41"></a><span id="l6.41">     throw stringBundle.GetStringFromName(&quot;no_emailProvider.error&quot;);</span>
<a href="#l6.42"></a><span id="l6.42">   }</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-  var xml = clientConfigXML.emailProvider;</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+  var xml = clientConfigXML.clientConfig.emailProvider;</span>
<a href="#l6.45"></a><span id="l6.45"> </span>
<a href="#l6.46"></a><span id="l6.46">   var d = new AccountConfig();</span>
<a href="#l6.47"></a><span id="l6.47">   d.source = AccountConfig.kSourceXML;</span>
<a href="#l6.48"></a><span id="l6.48"> </span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-  d.id = sanitize.hostname(xml.@id);</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+  d.id = sanitize.hostname(xml[&quot;@id&quot;]);</span>
<a href="#l6.51"></a><span id="l6.51">   d.displayName = d.id;</span>
<a href="#l6.52"></a><span id="l6.52">   try {</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-    d.displayName = sanitize.label(xml.displayName[0]);</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+    d.displayName = sanitize.label(xml.displayName);</span>
<a href="#l6.55"></a><span id="l6.55">   } catch (e) { logException(e); }</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-  for each (var domain in xml.domain)</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+  for (var domain of xml.$domain)</span>
<a href="#l6.58"></a><span id="l6.58">   {</span>
<a href="#l6.59"></a><span id="l6.59">     try {</span>
<a href="#l6.60"></a><span id="l6.60">       d.domains.push(sanitize.hostname(domain));</span>
<a href="#l6.61"></a><span id="l6.61">     } catch (e) { logException(e); exception = e; }</span>
<a href="#l6.62"></a><span id="l6.62">   }</span>
<a href="#l6.63"></a><span id="l6.63">   if (domain.length == 0)</span>
<a href="#l6.64"></a><span id="l6.64">     throw exception ? exception : &quot;need proper &lt;domain&gt; in XML&quot;;</span>
<a href="#l6.65"></a><span id="l6.65">   exception = null;</span>
<a href="#l6.66"></a><span id="l6.66"> </span>
<a href="#l6.67"></a><span id="l6.67">   // incoming server</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-  for each (let iX in xml.incomingServer) // input (XML)</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+  for (let iX of array_or_undef(xml.$incomingServer)) // input (XML)</span>
<a href="#l6.70"></a><span id="l6.70">   {</span>
<a href="#l6.71"></a><span id="l6.71">     let iO = d.createNewIncoming(); // output (object)</span>
<a href="#l6.72"></a><span id="l6.72">     try {</span>
<a href="#l6.73"></a><span id="l6.73">       // throws if not supported</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-      iO.type = sanitize.enum(iX.@type, [&quot;pop3&quot;, &quot;imap&quot;, &quot;nntp&quot;]);</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-      iO.hostname = sanitize.hostname(iX.hostname[0]);</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-      iO.port = sanitize.integerRange(iX.port[0], 1, 65535);</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+      iO.type = sanitize.enum(iX[&quot;@type&quot;], [&quot;pop3&quot;, &quot;imap&quot;, &quot;nntp&quot;]);</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+      iO.hostname = sanitize.hostname(iX.hostname);</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+      iO.port = sanitize.integerRange(iX.port, 1, 65535);</span>
<a href="#l6.80"></a><span id="l6.80">       // We need a username even for Kerberos, need it even internally.</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-      iO.username = sanitize.string(iX.username[0]); // may be a %VARIABLE%</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+      iO.username = sanitize.string(iX.username); // may be a %VARIABLE%</span>
<a href="#l6.83"></a><span id="l6.83"> </span>
<a href="#l6.84"></a><span id="l6.84">       if (&quot;password&quot; in iX) {</span>
<a href="#l6.85"></a><span id="l6.85">         d.rememberPassword = true;</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-        iO.password = sanitize.string(iX.password[0]);</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+        iO.password = sanitize.string(iX.password);</span>
<a href="#l6.88"></a><span id="l6.88">       }</span>
<a href="#l6.89"></a><span id="l6.89"> </span>
<a href="#l6.90"></a><span id="l6.90" class="difflineminus">-      for each (let iXsocketType in iX.socketType)</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineplus">+      for (let iXsocketType of array_or_undef(iX.$socketType))</span>
<a href="#l6.92"></a><span id="l6.92">       {</span>
<a href="#l6.93"></a><span id="l6.93">         try {</span>
<a href="#l6.94"></a><span id="l6.94">           iO.socketType = sanitize.translate(iXsocketType,</span>
<a href="#l6.95"></a><span id="l6.95">               { plain : 1, SSL: 2, STARTTLS: 3 });</span>
<a href="#l6.96"></a><span id="l6.96">           break; // take first that we support</span>
<a href="#l6.97"></a><span id="l6.97">         } catch (e) { exception = e; }</span>
<a href="#l6.98"></a><span id="l6.98">       }</span>
<a href="#l6.99"></a><span id="l6.99">       if (!iO.socketType)</span>
<a href="#l6.100"></a><span id="l6.100">         throw exception ? exception : &quot;need proper &lt;socketType&gt; in XML&quot;;</span>
<a href="#l6.101"></a><span id="l6.101">       exception = null;</span>
<a href="#l6.102"></a><span id="l6.102"> </span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-      for each (let iXauth in iX.authentication)</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineplus">+      for (let iXauth of array_or_undef(iX.$authentication))</span>
<a href="#l6.105"></a><span id="l6.105">       {</span>
<a href="#l6.106"></a><span id="l6.106">         try {</span>
<a href="#l6.107"></a><span id="l6.107">           iO.auth = sanitize.translate(iXauth,</span>
<a href="#l6.108"></a><span id="l6.108">               { &quot;password-cleartext&quot; : Ci.nsMsgAuthMethod.passwordCleartext,</span>
<a href="#l6.109"></a><span id="l6.109">                 // @deprecated TODO remove</span>
<a href="#l6.110"></a><span id="l6.110">                 &quot;plain&quot; : Ci.nsMsgAuthMethod.passwordCleartext,</span>
<a href="#l6.111"></a><span id="l6.111">                 &quot;password-encrypted&quot; : Ci.nsMsgAuthMethod.passwordEncrypted,</span>
<a href="#l6.112"></a><span id="l6.112">                 // @deprecated TODO remove</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineat">@@ -95,25 +99,25 @@ function readFromXML(clientConfigXML)</span>
<a href="#l6.114"></a><span id="l6.114">       if (!iO.auth)</span>
<a href="#l6.115"></a><span id="l6.115">         throw exception ? exception : &quot;need proper &lt;authentication&gt; in XML&quot;;</span>
<a href="#l6.116"></a><span id="l6.116">       exception = null;</span>
<a href="#l6.117"></a><span id="l6.117"> </span>
<a href="#l6.118"></a><span id="l6.118">       // defaults are in accountConfig.js</span>
<a href="#l6.119"></a><span id="l6.119">       if (iO.type == &quot;pop3&quot; &amp;&amp; &quot;pop3&quot; in iX)</span>
<a href="#l6.120"></a><span id="l6.120">       {</span>
<a href="#l6.121"></a><span id="l6.121">         try {</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineminus">-          if (&quot;leaveMessagesOnServer&quot; in iX.pop3[0])</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineplus">+          if (&quot;leaveMessagesOnServer&quot; in iX.pop3)</span>
<a href="#l6.124"></a><span id="l6.124">             iO.leaveMessagesOnServer =</span>
<a href="#l6.125"></a><span id="l6.125">                 sanitize.boolean(iX.pop3.leaveMessagesOnServer);</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineminus">-          if (&quot;daysToLeaveMessagesOnServer&quot; in iX.pop3[0])</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineplus">+          if (&quot;daysToLeaveMessagesOnServer&quot; in iX.pop3)</span>
<a href="#l6.128"></a><span id="l6.128">             iO.daysToLeaveMessagesOnServer =</span>
<a href="#l6.129"></a><span id="l6.129">                 sanitize.integer(iX.pop3.daysToLeaveMessagesOnServer);</span>
<a href="#l6.130"></a><span id="l6.130">         } catch (e) { logException(e); }</span>
<a href="#l6.131"></a><span id="l6.131">         try {</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineminus">-          if (&quot;downloadOnBiff&quot; in iX.pop3[0])</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineplus">+          if (&quot;downloadOnBiff&quot; in iX.pop3)</span>
<a href="#l6.134"></a><span id="l6.134">             iO.downloadOnBiff = sanitize.boolean(iX.pop3.downloadOnBiff);</span>
<a href="#l6.135"></a><span id="l6.135">         } catch (e) { logException(e); }</span>
<a href="#l6.136"></a><span id="l6.136">       }</span>
<a href="#l6.137"></a><span id="l6.137"> </span>
<a href="#l6.138"></a><span id="l6.138">       // processed successfully, now add to result object</span>
<a href="#l6.139"></a><span id="l6.139">       if (!d.incoming.hostname) // first valid</span>
<a href="#l6.140"></a><span id="l6.140">         d.incoming = iO;</span>
<a href="#l6.141"></a><span id="l6.141">       else</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineat">@@ -121,42 +125,42 @@ function readFromXML(clientConfigXML)</span>
<a href="#l6.143"></a><span id="l6.143">     } catch (e) { exception = e; }</span>
<a href="#l6.144"></a><span id="l6.144">   }</span>
<a href="#l6.145"></a><span id="l6.145">   if (!d.incoming.hostname)</span>
<a href="#l6.146"></a><span id="l6.146">     // throw exception for last server</span>
<a href="#l6.147"></a><span id="l6.147">     throw exception ? exception : &quot;Need proper &lt;incomingServer&gt; in XML file&quot;;</span>
<a href="#l6.148"></a><span id="l6.148">   exception = null;</span>
<a href="#l6.149"></a><span id="l6.149"> </span>
<a href="#l6.150"></a><span id="l6.150">   // outgoing server</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineminus">-  for each (let oX in xml.outgoingServer) // input (XML)</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineplus">+  for (let oX of array_or_undef(xml.$outgoingServer)) // input (XML)</span>
<a href="#l6.153"></a><span id="l6.153">   {</span>
<a href="#l6.154"></a><span id="l6.154">     let oO = d.createNewOutgoing(); // output (object)</span>
<a href="#l6.155"></a><span id="l6.155">     try {</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineminus">-      if (oX.@type != &quot;smtp&quot;)</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineplus">+      if (oX[&quot;@type&quot;] != &quot;smtp&quot;)</span>
<a href="#l6.158"></a><span id="l6.158">       {</span>
<a href="#l6.159"></a><span id="l6.159">         var stringBundle = getStringBundle(</span>
<a href="#l6.160"></a><span id="l6.160">             &quot;chrome://messenger/locale/accountCreationModel.properties&quot;);</span>
<a href="#l6.161"></a><span id="l6.161">         throw stringBundle.GetStringFromName(&quot;outgoing_not_smtp.error&quot;);</span>
<a href="#l6.162"></a><span id="l6.162">       }</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineminus">-      oO.hostname = sanitize.hostname(oX.hostname[0]);</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineminus">-      oO.port = sanitize.integerRange(oX.port[0], 1, 65535);</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineplus">+      oO.hostname = sanitize.hostname(oX.hostname);</span>
<a href="#l6.166"></a><span id="l6.166" class="difflineplus">+      oO.port = sanitize.integerRange(oX.port, 1, 65535);</span>
<a href="#l6.167"></a><span id="l6.167"> </span>
<a href="#l6.168"></a><span id="l6.168" class="difflineminus">-      for each (let oXsocketType in oX.socketType)</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineplus">+      for (let oXsocketType of array_or_undef(oX.$socketType))</span>
<a href="#l6.170"></a><span id="l6.170">       {</span>
<a href="#l6.171"></a><span id="l6.171">         try {</span>
<a href="#l6.172"></a><span id="l6.172">           oO.socketType = sanitize.translate(oXsocketType,</span>
<a href="#l6.173"></a><span id="l6.173">               { plain : 1, SSL: 2, STARTTLS: 3 });</span>
<a href="#l6.174"></a><span id="l6.174">           break; // take first that we support</span>
<a href="#l6.175"></a><span id="l6.175">         } catch (e) { exception = e; }</span>
<a href="#l6.176"></a><span id="l6.176">       }</span>
<a href="#l6.177"></a><span id="l6.177">       if (!oO.socketType)</span>
<a href="#l6.178"></a><span id="l6.178">         throw exception ? exception : &quot;need proper &lt;socketType&gt; in XML&quot;;</span>
<a href="#l6.179"></a><span id="l6.179">       exception = null;</span>
<a href="#l6.180"></a><span id="l6.180"> </span>
<a href="#l6.181"></a><span id="l6.181" class="difflineminus">-      for each (let oXauth in oX.authentication)</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineplus">+      for (let oXauth of array_or_undef(oX.$authentication))</span>
<a href="#l6.183"></a><span id="l6.183">       {</span>
<a href="#l6.184"></a><span id="l6.184">         try {</span>
<a href="#l6.185"></a><span id="l6.185">           oO.auth = sanitize.translate(oXauth,</span>
<a href="#l6.186"></a><span id="l6.186">               { // open relay</span>
<a href="#l6.187"></a><span id="l6.187">                 &quot;none&quot; : Ci.nsMsgAuthMethod.none,</span>
<a href="#l6.188"></a><span id="l6.188">                 // inside ISP or corp network</span>
<a href="#l6.189"></a><span id="l6.189">                 &quot;client-IP-address&quot; : Ci.nsMsgAuthMethod.none,</span>
<a href="#l6.190"></a><span id="l6.190">                 // hope for the best</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineat">@@ -177,21 +181,21 @@ function readFromXML(clientConfigXML)</span>
<a href="#l6.192"></a><span id="l6.192">         throw exception ? exception : &quot;need proper &lt;authentication&gt; in XML&quot;;</span>
<a href="#l6.193"></a><span id="l6.193">       exception = null;</span>
<a href="#l6.194"></a><span id="l6.194"> </span>
<a href="#l6.195"></a><span id="l6.195">       if (&quot;username&quot; in oX ||</span>
<a href="#l6.196"></a><span id="l6.196">           // if password-based auth, we need a username,</span>
<a href="#l6.197"></a><span id="l6.197">           // so go there anyways and throw.</span>
<a href="#l6.198"></a><span id="l6.198">           oO.auth == Ci.nsMsgAuthMethod.passwordCleartext ||</span>
<a href="#l6.199"></a><span id="l6.199">           oO.auth == Ci.nsMsgAuthMethod.passwordEncrypted)</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-        oO.username = sanitize.string(oX.username[0]);</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineplus">+        oO.username = sanitize.string(oX.username);</span>
<a href="#l6.202"></a><span id="l6.202"> </span>
<a href="#l6.203"></a><span id="l6.203">       if (&quot;password&quot; in oX) {</span>
<a href="#l6.204"></a><span id="l6.204">         d.rememberPassword = true;</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineminus">-        oO.password = sanitize.string(oX.password[0]);</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineplus">+        oO.password = sanitize.string(oX.password);</span>
<a href="#l6.207"></a><span id="l6.207">       }</span>
<a href="#l6.208"></a><span id="l6.208"> </span>
<a href="#l6.209"></a><span id="l6.209">       try {</span>
<a href="#l6.210"></a><span id="l6.210">         // defaults are in accountConfig.js</span>
<a href="#l6.211"></a><span id="l6.211">         if (&quot;addThisServer&quot; in oX)</span>
<a href="#l6.212"></a><span id="l6.212">           oO.addThisServer = sanitize.boolean(oX.addThisServer);</span>
<a href="#l6.213"></a><span id="l6.213">         if (&quot;useGlobalPreferredServer&quot; in oX)</span>
<a href="#l6.214"></a><span id="l6.214">           oO.useGlobalPreferredServer =</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineat">@@ -206,24 +210,24 @@ function readFromXML(clientConfigXML)</span>
<a href="#l6.216"></a><span id="l6.216">     } catch (e) { logException(e); exception = e; }</span>
<a href="#l6.217"></a><span id="l6.217">   }</span>
<a href="#l6.218"></a><span id="l6.218">   if (!d.outgoing.hostname)</span>
<a href="#l6.219"></a><span id="l6.219">     // throw exception for last server</span>
<a href="#l6.220"></a><span id="l6.220">     throw exception ? exception : &quot;Need proper &lt;outgoingServer&gt; in XML file&quot;;</span>
<a href="#l6.221"></a><span id="l6.221">   exception = null;</span>
<a href="#l6.222"></a><span id="l6.222"> </span>
<a href="#l6.223"></a><span id="l6.223">   d.inputFields = new Array();</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-  for each (let inputField in xml.inputField)</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineplus">+  for (let inputField of array_or_undef(xml.$inputField))</span>
<a href="#l6.226"></a><span id="l6.226">   {</span>
<a href="#l6.227"></a><span id="l6.227">     try {</span>
<a href="#l6.228"></a><span id="l6.228">       var fieldset =</span>
<a href="#l6.229"></a><span id="l6.229">       {</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineminus">-        varname : sanitize.alphanumdash(inputField.@key).toUpperCase(),</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-        displayName : sanitize.label(inputField.@label),</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineminus">-        exampleValue : sanitize.label(inputField.text())</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineplus">+        varname : sanitize.alphanumdash(inputField[&quot;@key&quot;]).toUpperCase(),</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineplus">+        displayName : sanitize.label(inputField[&quot;@label&quot;]),</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineplus">+        exampleValue : sanitize.label(inputField.value)</span>
<a href="#l6.236"></a><span id="l6.236">       };</span>
<a href="#l6.237"></a><span id="l6.237">       d.inputFields.push(fieldset);</span>
<a href="#l6.238"></a><span id="l6.238">     } catch (e) { logException(e); } // for now, don't throw,</span>
<a href="#l6.239"></a><span id="l6.239">         // because we don't support custom fields yet anyways.</span>
<a href="#l6.240"></a><span id="l6.240">   }</span>
<a href="#l6.241"></a><span id="l6.241"> </span>
<a href="#l6.242"></a><span id="l6.242">   return d;</span>
<a href="#l6.243"></a><span id="l6.243"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/test/unit/test_autoconfigXML.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_autoconfigXML.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -12,16 +12,19 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * reading and allow fallback mechanisms. This test checks whether that works,</span>
<a href="#l7.5"></a><span id="l7.5">  * and of course also whether we can read a normal config and get the proper</span>
<a href="#l7.6"></a><span id="l7.6">  * values.</span>
<a href="#l7.7"></a><span id="l7.7">  */</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> // Globals</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/JXON.js&quot;);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+var DOMParser = Components.Constructor(&quot;@mozilla.org/xmlextras/domparser;1&quot;);</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16"> var xmlReader = {};</span>
<a href="#l7.17"></a><span id="l7.17"> try {</span>
<a href="#l7.18"></a><span id="l7.18">   Services.scriptloader.loadSubScript(</span>
<a href="#l7.19"></a><span id="l7.19">       &quot;chrome://messenger/content/accountcreation/util.js&quot;, xmlReader);</span>
<a href="#l7.20"></a><span id="l7.20">   Services.scriptloader.loadSubScript(</span>
<a href="#l7.21"></a><span id="l7.21">       &quot;chrome://messenger/content/accountcreation/accountConfig.js&quot;,</span>
<a href="#l7.22"></a><span id="l7.22">       xmlReader);</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineat">@@ -60,114 +63,115 @@ function assert_equal_config(aA, aB, fie</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25"> /**</span>
<a href="#l7.26"></a><span id="l7.26">  * Test that the xml reader returns a proper config and</span>
<a href="#l7.27"></a><span id="l7.27">  * is also forwards-compatible to new additions to the data format.</span>
<a href="#l7.28"></a><span id="l7.28">  */</span>
<a href="#l7.29"></a><span id="l7.29"> function test_readFromXML_config1()</span>
<a href="#l7.30"></a><span id="l7.30"> {</span>
<a href="#l7.31"></a><span id="l7.31">   var clientConfigXML =</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-    &lt;clientConfig&gt;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-      &lt;emailProvider id=&quot;example.com&quot;&gt;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-        &lt;domain&gt;example.com&lt;/domain&gt;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-        &lt;domain&gt;example.net&lt;/domain&gt;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-        &lt;displayName&gt;Example&lt;/displayName&gt;</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-        &lt;displayShortName&gt;Example Mail&lt;/displayShortName&gt;</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+    '&lt;clientConfig&gt;' +</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+      '&lt;emailProvider id=&quot;example.com&quot;&gt;' +</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+        '&lt;domain&gt;example.com&lt;/domain&gt;' +</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+        '&lt;domain&gt;example.net&lt;/domain&gt;' +</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+        '&lt;displayName&gt;Example&lt;/displayName&gt;' +</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+        '&lt;displayShortName&gt;Example Mail&lt;/displayShortName&gt;' +</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-        &lt;!-- 1. - protocol not supported --&gt;</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-        &lt;incomingServer type=&quot;imap5&quot;&gt;</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-          &lt;hostname&gt;badprotocol.example.com&lt;/hostname&gt;</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-          &lt;port&gt;993&lt;/port&gt;</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-          &lt;socketType&gt;SSL&lt;/socketType&gt;</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-          &lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-          &lt;authentication&gt;ssl-client-cert&lt;/authentication&gt;</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-        &lt;/incomingServer&gt;</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-        &lt;!-- 2. - socket type not supported --&gt;</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-        &lt;incomingServer type=&quot;imap&quot;&gt;</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-          &lt;hostname&gt;badsocket.example.com&lt;/hostname&gt;</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-          &lt;port&gt;993&lt;/port&gt;</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-          &lt;socketType&gt;key-from-DNSSEC&lt;/socketType&gt;</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-          &lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-          &lt;authentication&gt;password-cleartext&lt;/authentication&gt;</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-        &lt;/incomingServer&gt;</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-        &lt;!-- 3. - first supported incoming server --&gt;</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-        &lt;incomingServer type=&quot;imap&quot;&gt;</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-          &lt;hostname&gt;imapmail.example.com&lt;/hostname&gt;</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineminus">-          &lt;port&gt;993&lt;/port&gt;</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-          &lt;socketType&gt;SSL&lt;/socketType&gt;</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-          &lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-          &lt;authentication&gt;password-cleartext&lt;/authentication&gt;</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-        &lt;/incomingServer&gt;</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-        &lt;!-- 4. - auth method not supported --&gt;</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-        &lt;incomingServer type=&quot;imap&quot;&gt;</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-          &lt;hostname&gt;badauth.example.com&lt;/hostname&gt;</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-          &lt;port&gt;993&lt;/port&gt;</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineminus">-          &lt;socketType&gt;SSL&lt;/socketType&gt;</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-          &lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-          &lt;authentication&gt;ssl-client-cert&lt;/authentication&gt;</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-          &lt;!-- Throw in some elements we don't support yet --&gt;</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-          &lt;imap&gt;</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-            &lt;rootFolder path=&quot;INBOX.&quot; /&gt;</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-            &lt;specialFolder id=&quot;sent&quot; path=&quot;INBOX.Sent Mail&quot; /&gt;</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineminus">-          &lt;/imap&gt;</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-        &lt;/incomingServer&gt;</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-        &lt;!-- 5. - second supported incoming server --&gt;</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-        &lt;incomingServer type=&quot;pop3&quot;&gt;</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineminus">-          &lt;hostname&gt;popmail.example.com&lt;/hostname&gt;</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-          &lt;!-- alternative hostname, not yet supported, should be ignored --&gt;</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-          &lt;hostname&gt;popbackup.example.com&lt;/hostname&gt;</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineminus">-          &lt;port&gt;110&lt;/port&gt;</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-          &lt;port&gt;7878&lt;/port&gt;</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineminus">-          &lt;!-- unsupported socket type --&gt;</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-          &lt;socketType&gt;GSSAPI2&lt;/socketType&gt;</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineminus">-          &lt;!-- but fall back --&gt;</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-          &lt;socketType&gt;plain&lt;/socketType&gt;</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-          &lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-          &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineminus">-          &lt;!-- unsupported auth method --&gt;</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineminus">-          &lt;authentication&gt;GSSAPI2&lt;/authentication&gt;</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-          &lt;!-- but fall back --&gt;</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-          &lt;authentication&gt;password-encrypted&lt;/authentication&gt;</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineminus">-          &lt;pop3&gt;</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-            &lt;leaveMessagesOnServer&gt;true&lt;/leaveMessagesOnServer&gt;</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">-            &lt;daysToLeaveMessagesOnServer&gt;999&lt;/daysToLeaveMessagesOnServer&gt;</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">-          &lt;/pop3&gt;</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineminus">-        &lt;/incomingServer&gt;</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+        // 1. - protocol not supported</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+        '&lt;incomingServer type=&quot;imap5&quot;&gt;' +</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+          '&lt;hostname&gt;badprotocol.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+          '&lt;port&gt;993&lt;/port&gt;' +</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+          '&lt;socketType&gt;SSL&lt;/socketType&gt;' +</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+          '&lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;' +</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+          '&lt;authentication&gt;ssl-client-cert&lt;/authentication&gt;' +</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineplus">+        '&lt;/incomingServer&gt;' +</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineplus">+        // 2. - socket type not supported</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineplus">+        '&lt;incomingServer type=&quot;imap&quot;&gt;' +</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineplus">+          '&lt;hostname&gt;badsocket.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineplus">+          '&lt;port&gt;993&lt;/port&gt;' +</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineplus">+          '&lt;socketType&gt;key-from-DNSSEC&lt;/socketType&gt;' +</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineplus">+          '&lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;' +</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineplus">+          '&lt;authentication&gt;password-cleartext&lt;/authentication&gt;' +</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineplus">+        '&lt;/incomingServer&gt;' +</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineplus">+        // 3. - first supported incoming server</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineplus">+        '&lt;incomingServer type=&quot;imap&quot;&gt;' +</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineplus">+          '&lt;hostname&gt;imapmail.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineplus">+          '&lt;port&gt;993&lt;/port&gt;' +</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineplus">+          '&lt;socketType&gt;SSL&lt;/socketType&gt;' +</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineplus">+          '&lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;' +</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineplus">+          '&lt;authentication&gt;password-cleartext&lt;/authentication&gt;' +</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineplus">+        '&lt;/incomingServer&gt;' +</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineplus">+        // 4. - auth method not supported</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineplus">+        '&lt;incomingServer type=&quot;imap&quot;&gt;' +</span>
<a href="#l7.130"></a><span id="l7.130" class="difflineplus">+          '&lt;hostname&gt;badauth.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineplus">+          '&lt;port&gt;993&lt;/port&gt;' +</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineplus">+          '&lt;socketType&gt;SSL&lt;/socketType&gt;' +</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineplus">+          '&lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;' +</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineplus">+          '&lt;authentication&gt;ssl-client-cert&lt;/authentication&gt;' +</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineplus">+          // Throw in some elements we don't support yet</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineplus">+          '&lt;imap&gt;' +</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineplus">+            '&lt;rootFolder path=&quot;INBOX.&quot; /&gt;' +</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineplus">+            '&lt;specialFolder id=&quot;sent&quot; path=&quot;INBOX.Sent Mail&quot; /&gt;' +</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineplus">+          '&lt;/imap&gt;' +</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineplus">+        '&lt;/incomingServer&gt;' +</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineplus">+        // 5. - second supported incoming server</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineplus">+        '&lt;incomingServer type=&quot;pop3&quot;&gt;' +</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineplus">+          '&lt;hostname&gt;popmail.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineplus">+          // alternative hostname, not yet supported, should be ignored</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineplus">+          '&lt;hostname&gt;popbackup.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineplus">+          '&lt;port&gt;110&lt;/port&gt;' +</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineplus">+          '&lt;port&gt;7878&lt;/port&gt;' +</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineplus">+          // unsupported socket type</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineplus">+          '&lt;socketType&gt;GSSAPI2&lt;/socketType&gt;' +</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineplus">+          // but fall back</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineplus">+          '&lt;socketType&gt;plain&lt;/socketType&gt;' +</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineplus">+          '&lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;' +</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineplus">+          '&lt;username&gt;%EMAILADDRESS%&lt;/username&gt;' +</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineplus">+          // unsupported auth method</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineplus">+          '&lt;authentication&gt;GSSAPI2&lt;/authentication&gt;' +</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineplus">+          // but fall back</span>
<a href="#l7.157"></a><span id="l7.157" class="difflineplus">+          '&lt;authentication&gt;password-encrypted&lt;/authentication&gt;' +</span>
<a href="#l7.158"></a><span id="l7.158" class="difflineplus">+          '&lt;pop3&gt;' +</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineplus">+            '&lt;leaveMessagesOnServer&gt;true&lt;/leaveMessagesOnServer&gt;' +</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineplus">+            '&lt;daysToLeaveMessagesOnServer&gt;999&lt;/daysToLeaveMessagesOnServer&gt;' +</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineplus">+          '&lt;/pop3&gt;' +</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineplus">+        '&lt;/incomingServer&gt;' +</span>
<a href="#l7.163"></a><span id="l7.163"> </span>
<a href="#l7.164"></a><span id="l7.164" class="difflineminus">-        &lt;!-- outgoing server with invalid auth method --&gt;</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineminus">-        &lt;outgoingServer type=&quot;smtp&quot;&gt;</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineminus">-          &lt;hostname&gt;badauth.example.com&lt;/hostname&gt;</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineminus">-          &lt;port&gt;587&lt;/port&gt;</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineminus">-          &lt;socketType&gt;STARTTLS&lt;/socketType&gt;</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineminus">-          &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;</span>
<a href="#l7.170"></a><span id="l7.170" class="difflineminus">-          &lt;authentication&gt;smtp-after-imap&lt;/authentication&gt;</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineminus">-        &lt;/outgoingServer&gt;</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineminus">-        &lt;!-- outgoing server - supported --&gt;</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineminus">-        &lt;outgoingServer type=&quot;smtp&quot;&gt;</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineminus">-          &lt;hostname&gt;smtpout.example.com&lt;/hostname&gt;</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineminus">-          &lt;hostname&gt;smtpfallback.example.com&lt;/hostname&gt;</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineminus">-          &lt;port&gt;587&lt;/port&gt;</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineminus">-          &lt;port&gt;7878&lt;/port&gt;</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineminus">-          &lt;socketType&gt;GSSAPI2&lt;/socketType&gt;</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineminus">-          &lt;socketType&gt;STARTTLS&lt;/socketType&gt;</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineminus">-          &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;</span>
<a href="#l7.181"></a><span id="l7.181" class="difflineminus">-          &lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;</span>
<a href="#l7.182"></a><span id="l7.182" class="difflineminus">-          &lt;authentication&gt;GSSAPI2&lt;/authentication&gt;</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineminus">-          &lt;authentication&gt;client-IP-address&lt;/authentication&gt;</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineminus">-          &lt;smtp/&gt;</span>
<a href="#l7.185"></a><span id="l7.185" class="difflineminus">-        &lt;/outgoingServer&gt;</span>
<a href="#l7.186"></a><span id="l7.186" class="difflineplus">+        // outgoing server with invalid auth method</span>
<a href="#l7.187"></a><span id="l7.187" class="difflineplus">+        '&lt;outgoingServer type=&quot;smtp&quot;&gt;' +</span>
<a href="#l7.188"></a><span id="l7.188" class="difflineplus">+          '&lt;hostname&gt;badauth.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.189"></a><span id="l7.189" class="difflineplus">+          '&lt;port&gt;587&lt;/port&gt;' +</span>
<a href="#l7.190"></a><span id="l7.190" class="difflineplus">+          '&lt;socketType&gt;STARTTLS&lt;/socketType&gt;' +</span>
<a href="#l7.191"></a><span id="l7.191" class="difflineplus">+          '&lt;username&gt;%EMAILADDRESS%&lt;/username&gt;' +</span>
<a href="#l7.192"></a><span id="l7.192" class="difflineplus">+          '&lt;authentication&gt;smtp-after-imap&lt;/authentication&gt;' +</span>
<a href="#l7.193"></a><span id="l7.193" class="difflineplus">+        '&lt;/outgoingServer&gt;' +</span>
<a href="#l7.194"></a><span id="l7.194" class="difflineplus">+        // outgoing server - supported</span>
<a href="#l7.195"></a><span id="l7.195" class="difflineplus">+        '&lt;outgoingServer type=&quot;smtp&quot;&gt;' +</span>
<a href="#l7.196"></a><span id="l7.196" class="difflineplus">+          '&lt;hostname&gt;smtpout.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.197"></a><span id="l7.197" class="difflineplus">+          '&lt;hostname&gt;smtpfallback.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.198"></a><span id="l7.198" class="difflineplus">+          '&lt;port&gt;587&lt;/port&gt;' +</span>
<a href="#l7.199"></a><span id="l7.199" class="difflineplus">+          '&lt;port&gt;7878&lt;/port&gt;' +</span>
<a href="#l7.200"></a><span id="l7.200" class="difflineplus">+          '&lt;socketType&gt;GSSAPI2&lt;/socketType&gt;' +</span>
<a href="#l7.201"></a><span id="l7.201" class="difflineplus">+          '&lt;socketType&gt;STARTTLS&lt;/socketType&gt;' +</span>
<a href="#l7.202"></a><span id="l7.202" class="difflineplus">+          '&lt;username&gt;%EMAILADDRESS%&lt;/username&gt;' +</span>
<a href="#l7.203"></a><span id="l7.203" class="difflineplus">+          '&lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;' +</span>
<a href="#l7.204"></a><span id="l7.204" class="difflineplus">+          '&lt;authentication&gt;GSSAPI2&lt;/authentication&gt;' +</span>
<a href="#l7.205"></a><span id="l7.205" class="difflineplus">+          '&lt;authentication&gt;client-IP-address&lt;/authentication&gt;' +</span>
<a href="#l7.206"></a><span id="l7.206" class="difflineplus">+          '&lt;smtp/&gt;' +</span>
<a href="#l7.207"></a><span id="l7.207" class="difflineplus">+        '&lt;/outgoingServer&gt;' +</span>
<a href="#l7.208"></a><span id="l7.208" class="difflineplus">+        // Throw in some more elements we don't support yet</span>
<a href="#l7.209"></a><span id="l7.209" class="difflineplus">+        '&lt;enableURL url=&quot;http://foobar&quot; /&gt;' +</span>
<a href="#l7.210"></a><span id="l7.210" class="difflineplus">+        '&lt;instructionsURL url=&quot;http://foobar&quot; /&gt;' +</span>
<a href="#l7.211"></a><span id="l7.211"> </span>
<a href="#l7.212"></a><span id="l7.212" class="difflineminus">-        &lt;!-- Throw in some more elements we don't support yet --&gt;</span>
<a href="#l7.213"></a><span id="l7.213" class="difflineminus">-        &lt;enableURL url=&quot;http://foobar&quot; /&gt;</span>
<a href="#l7.214"></a><span id="l7.214" class="difflineminus">-        &lt;instructionsURL url=&quot;http://foobar&quot; /&gt;</span>
<a href="#l7.215"></a><span id="l7.215" class="difflineplus">+      '&lt;/emailProvider&gt;' +</span>
<a href="#l7.216"></a><span id="l7.216" class="difflineplus">+    '&lt;/clientConfig&gt;';</span>
<a href="#l7.217"></a><span id="l7.217"> </span>
<a href="#l7.218"></a><span id="l7.218" class="difflineminus">-      &lt;/emailProvider&gt;</span>
<a href="#l7.219"></a><span id="l7.219" class="difflineminus">-    &lt;/clientConfig&gt;;</span>
<a href="#l7.220"></a><span id="l7.220" class="difflineminus">-</span>
<a href="#l7.221"></a><span id="l7.221" class="difflineminus">-  var config = xmlReader.readFromXML(clientConfigXML);</span>
<a href="#l7.222"></a><span id="l7.222" class="difflineplus">+  var domParser = new DOMParser();</span>
<a href="#l7.223"></a><span id="l7.223" class="difflineplus">+  var config = xmlReader.readFromXML(JXON.build(</span>
<a href="#l7.224"></a><span id="l7.224" class="difflineplus">+    domParser.parseFromString(clientConfigXML, &quot;text/xml&quot;)));</span>
<a href="#l7.225"></a><span id="l7.225"> </span>
<a href="#l7.226"></a><span id="l7.226">   do_check_eq(config instanceof xmlReader.AccountConfig, true);</span>
<a href="#l7.227"></a><span id="l7.227">   do_check_eq(&quot;example.com&quot;, config.id);</span>
<a href="#l7.228"></a><span id="l7.228">   do_check_eq(&quot;Example&quot;, config.displayName);</span>
<a href="#l7.229"></a><span id="l7.229">   do_check_neq(-1, config.domains.indexOf(&quot;example.com&quot;));</span>
<a href="#l7.230"></a><span id="l7.230">   // 1. incoming server skipped because of an unsupported protocol</span>
<a href="#l7.231"></a><span id="l7.231">   // 2. incoming server skipped because of an so-far unknown auth method</span>
<a href="#l7.232"></a><span id="l7.232">   // 3. incoming server is fine for us: IMAP, SSL, cleartext password</span>
<a href="#l7.233"></a><span id="l7.233" class="difflineat">@@ -197,45 +201,47 @@ function test_readFromXML_config1()</span>
<a href="#l7.234"></a><span id="l7.234"> }</span>
<a href="#l7.235"></a><span id="l7.235"> </span>
<a href="#l7.236"></a><span id="l7.236"> /**</span>
<a href="#l7.237"></a><span id="l7.237">  * Test the replaceVariables method.</span>
<a href="#l7.238"></a><span id="l7.238">  */</span>
<a href="#l7.239"></a><span id="l7.239"> function test_replaceVariables()</span>
<a href="#l7.240"></a><span id="l7.240"> {</span>
<a href="#l7.241"></a><span id="l7.241">   var clientConfigXML =</span>
<a href="#l7.242"></a><span id="l7.242" class="difflineminus">-    &lt;clientConfig&gt;</span>
<a href="#l7.243"></a><span id="l7.243" class="difflineminus">-      &lt;emailProvider id=&quot;example.com&quot;&gt;</span>
<a href="#l7.244"></a><span id="l7.244" class="difflineminus">-        &lt;domain&gt;example.com&lt;/domain&gt;</span>
<a href="#l7.245"></a><span id="l7.245" class="difflineminus">-        &lt;displayName&gt;example.com&lt;/displayName&gt;</span>
<a href="#l7.246"></a><span id="l7.246" class="difflineminus">-        &lt;displayShortName&gt;example.com&lt;/displayShortName&gt;</span>
<a href="#l7.247"></a><span id="l7.247" class="difflineminus">-        &lt;incomingServer type=&quot;pop3&quot;&gt;</span>
<a href="#l7.248"></a><span id="l7.248" class="difflineminus">-          &lt;hostname&gt;pop.%EMAILDOMAIN%&lt;/hostname&gt;</span>
<a href="#l7.249"></a><span id="l7.249" class="difflineminus">-          &lt;port&gt;995&lt;/port&gt;</span>
<a href="#l7.250"></a><span id="l7.250" class="difflineminus">-          &lt;socketType&gt;SSL&lt;/socketType&gt;</span>
<a href="#l7.251"></a><span id="l7.251" class="difflineminus">-          &lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;</span>
<a href="#l7.252"></a><span id="l7.252" class="difflineminus">-          &lt;authentication&gt;plain&lt;/authentication&gt;</span>
<a href="#l7.253"></a><span id="l7.253" class="difflineminus">-          &lt;pop3&gt;</span>
<a href="#l7.254"></a><span id="l7.254" class="difflineminus">-            &lt;leaveMessagesOnServer&gt;true&lt;/leaveMessagesOnServer&gt;</span>
<a href="#l7.255"></a><span id="l7.255" class="difflineminus">-            &lt;daysToLeaveMessagesOnServer&gt;999&lt;/daysToLeaveMessagesOnServer&gt;</span>
<a href="#l7.256"></a><span id="l7.256" class="difflineminus">-          &lt;/pop3&gt;</span>
<a href="#l7.257"></a><span id="l7.257" class="difflineminus">-        &lt;/incomingServer&gt;</span>
<a href="#l7.258"></a><span id="l7.258" class="difflineminus">-        &lt;outgoingServer type=&quot;smtp&quot;&gt;</span>
<a href="#l7.259"></a><span id="l7.259" class="difflineminus">-          &lt;hostname&gt;smtp.example.com&lt;/hostname&gt;</span>
<a href="#l7.260"></a><span id="l7.260" class="difflineminus">-          &lt;port&gt;587&lt;/port&gt;</span>
<a href="#l7.261"></a><span id="l7.261" class="difflineminus">-          &lt;socketType&gt;STARTTLS&lt;/socketType&gt;</span>
<a href="#l7.262"></a><span id="l7.262" class="difflineminus">-          &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;</span>
<a href="#l7.263"></a><span id="l7.263" class="difflineminus">-          &lt;authentication&gt;plain&lt;/authentication&gt;</span>
<a href="#l7.264"></a><span id="l7.264" class="difflineminus">-          &lt;addThisServer&gt;true&lt;/addThisServer&gt;</span>
<a href="#l7.265"></a><span id="l7.265" class="difflineminus">-          &lt;useGlobalPreferredServer&gt;false&lt;/useGlobalPreferredServer&gt;</span>
<a href="#l7.266"></a><span id="l7.266" class="difflineminus">-        &lt;/outgoingServer&gt;</span>
<a href="#l7.267"></a><span id="l7.267" class="difflineminus">-      &lt;/emailProvider&gt;</span>
<a href="#l7.268"></a><span id="l7.268" class="difflineminus">-    &lt;/clientConfig&gt;;</span>
<a href="#l7.269"></a><span id="l7.269" class="difflineplus">+    '&lt;clientConfig&gt;' +</span>
<a href="#l7.270"></a><span id="l7.270" class="difflineplus">+      '&lt;emailProvider id=&quot;example.com&quot;&gt;' +</span>
<a href="#l7.271"></a><span id="l7.271" class="difflineplus">+        '&lt;domain&gt;example.com&lt;/domain&gt;' +</span>
<a href="#l7.272"></a><span id="l7.272" class="difflineplus">+        '&lt;displayName&gt;example.com&lt;/displayName&gt;' +</span>
<a href="#l7.273"></a><span id="l7.273" class="difflineplus">+        '&lt;displayShortName&gt;example.com&lt;/displayShortName&gt;' +</span>
<a href="#l7.274"></a><span id="l7.274" class="difflineplus">+        '&lt;incomingServer type=&quot;pop3&quot;&gt;' +</span>
<a href="#l7.275"></a><span id="l7.275" class="difflineplus">+          '&lt;hostname&gt;pop.%EMAILDOMAIN%&lt;/hostname&gt;' +</span>
<a href="#l7.276"></a><span id="l7.276" class="difflineplus">+          '&lt;port&gt;995&lt;/port&gt;' +</span>
<a href="#l7.277"></a><span id="l7.277" class="difflineplus">+          '&lt;socketType&gt;SSL&lt;/socketType&gt;' +</span>
<a href="#l7.278"></a><span id="l7.278" class="difflineplus">+          '&lt;username&gt;%EMAILLOCALPART%&lt;/username&gt;' +</span>
<a href="#l7.279"></a><span id="l7.279" class="difflineplus">+          '&lt;authentication&gt;plain&lt;/authentication&gt;' +</span>
<a href="#l7.280"></a><span id="l7.280" class="difflineplus">+          '&lt;pop3&gt;' +</span>
<a href="#l7.281"></a><span id="l7.281" class="difflineplus">+            '&lt;leaveMessagesOnServer&gt;true&lt;/leaveMessagesOnServer&gt;' +</span>
<a href="#l7.282"></a><span id="l7.282" class="difflineplus">+            '&lt;daysToLeaveMessagesOnServer&gt;999&lt;/daysToLeaveMessagesOnServer&gt;' +</span>
<a href="#l7.283"></a><span id="l7.283" class="difflineplus">+          '&lt;/pop3&gt;' +</span>
<a href="#l7.284"></a><span id="l7.284" class="difflineplus">+        '&lt;/incomingServer&gt;' +</span>
<a href="#l7.285"></a><span id="l7.285" class="difflineplus">+        '&lt;outgoingServer type=&quot;smtp&quot;&gt;' +</span>
<a href="#l7.286"></a><span id="l7.286" class="difflineplus">+          '&lt;hostname&gt;smtp.example.com&lt;/hostname&gt;' +</span>
<a href="#l7.287"></a><span id="l7.287" class="difflineplus">+          '&lt;port&gt;587&lt;/port&gt;' +</span>
<a href="#l7.288"></a><span id="l7.288" class="difflineplus">+          '&lt;socketType&gt;STARTTLS&lt;/socketType&gt;' +</span>
<a href="#l7.289"></a><span id="l7.289" class="difflineplus">+          '&lt;username&gt;%EMAILADDRESS%&lt;/username&gt;' +</span>
<a href="#l7.290"></a><span id="l7.290" class="difflineplus">+          '&lt;authentication&gt;plain&lt;/authentication&gt;' +</span>
<a href="#l7.291"></a><span id="l7.291" class="difflineplus">+          '&lt;addThisServer&gt;true&lt;/addThisServer&gt;' +</span>
<a href="#l7.292"></a><span id="l7.292" class="difflineplus">+          '&lt;useGlobalPreferredServer&gt;false&lt;/useGlobalPreferredServer&gt;' +</span>
<a href="#l7.293"></a><span id="l7.293" class="difflineplus">+        '&lt;/outgoingServer&gt;' +</span>
<a href="#l7.294"></a><span id="l7.294" class="difflineplus">+      '&lt;/emailProvider&gt;' +</span>
<a href="#l7.295"></a><span id="l7.295" class="difflineplus">+    '&lt;/clientConfig&gt;';</span>
<a href="#l7.296"></a><span id="l7.296"> </span>
<a href="#l7.297"></a><span id="l7.297" class="difflineminus">-  var config = xmlReader.readFromXML(clientConfigXML);</span>
<a href="#l7.298"></a><span id="l7.298" class="difflineplus">+  var domParser = new DOMParser();</span>
<a href="#l7.299"></a><span id="l7.299" class="difflineplus">+  var config = xmlReader.readFromXML(JXON.build(</span>
<a href="#l7.300"></a><span id="l7.300" class="difflineplus">+    domParser.parseFromString(clientConfigXML, &quot;text/xml&quot;)));</span>
<a href="#l7.301"></a><span id="l7.301"> </span>
<a href="#l7.302"></a><span id="l7.302">   xmlReader.replaceVariables(config, </span>
<a href="#l7.303"></a><span id="l7.303">                              &quot;Yamato Nadeshiko&quot;,</span>
<a href="#l7.304"></a><span id="l7.304">                              &quot;yamato.nadeshiko@example.com&quot;,</span>
<a href="#l7.305"></a><span id="l7.305">                              &quot;abc12345&quot;);</span>
<a href="#l7.306"></a><span id="l7.306"> </span>
<a href="#l7.307"></a><span id="l7.307">   assert_equal_config(config.incoming.username,</span>
<a href="#l7.308"></a><span id="l7.308">                       &quot;yamato.nadeshiko&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchCustomTerm.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchCustomTerm.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -29,22 +29,22 @@ var Tests =</span>
<a href="#l8.4"></a><span id="l8.4"> // nsIMsgSearchCustomTerm object</span>
<a href="#l8.5"></a><span id="l8.5"> var customTerm =</span>
<a href="#l8.6"></a><span id="l8.6"> {</span>
<a href="#l8.7"></a><span id="l8.7">   id: kCustomId,</span>
<a href="#l8.8"></a><span id="l8.8">   name: &quot;term name&quot;,</span>
<a href="#l8.9"></a><span id="l8.9">   getEnabled: function(scope, op)</span>
<a href="#l8.10"></a><span id="l8.10">     {</span>
<a href="#l8.11"></a><span id="l8.11">       return scope == Ci.nsMsgSearchScope.offlineMail &amp;&amp;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-             op == Ci.nsMsgSearchOp::Is</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+             op == Ci.nsMsgSearchOp.Is</span>
<a href="#l8.14"></a><span id="l8.14">     },</span>
<a href="#l8.15"></a><span id="l8.15">   getAvailable: function(scope, op)</span>
<a href="#l8.16"></a><span id="l8.16">     {</span>
<a href="#l8.17"></a><span id="l8.17">       return scope == Ci.nsMsgSearchScope.offlineMail &amp;&amp;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-             op == Ci.nsMsgSearchOp::Is</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+             op == Ci.nsMsgSearchOp.Is</span>
<a href="#l8.20"></a><span id="l8.20">     },</span>
<a href="#l8.21"></a><span id="l8.21">   getAvailableOperators: function(scope, length)</span>
<a href="#l8.22"></a><span id="l8.22">     {</span>
<a href="#l8.23"></a><span id="l8.23">        length.value = 1;</span>
<a href="#l8.24"></a><span id="l8.24">        return [Ci.nsMsgSearchOp.Is];</span>
<a href="#l8.25"></a><span id="l8.25">     },</span>
<a href="#l8.26"></a><span id="l8.26">   match: function(msgHdr, searchValue, searchOp)</span>
<a href="#l8.27"></a><span id="l8.27">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mailnews/base/util/JXON.js</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,181 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+ * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+// This is a modification of the JXON parsers found on the page</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+// &lt;https://developer.mozilla.org/en-US/docs/JXON&gt;</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+var EXPORTED_SYMBOLS = [&quot;JXON&quot;];</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+let Cc = Components.classes;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+let Ci = Components.interfaces;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+const JXON = new (function() {</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+  const sValueProp = &quot;value&quot;; /* you can customize these values */</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+  const sAttributesProp = &quot;attr&quot;;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+  const sAttrPref = &quot;@&quot;;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+  const sElementListPrefix = &quot;$&quot;;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+  const sConflictSuffix = &quot;_&quot;; // used when there's a name conflict with special JXON properties</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+  const aCache = [];</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+  const rIsNull = /^\s*$/;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+  const rIsBool = /^(?:true|false)$/i;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  function parseText(sValue) {</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+    //if (rIsNull.test(sValue))</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+    //  return null;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+    if (rIsBool.test(sValue)) </span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+      return sValue.toLowerCase() === &quot;true&quot;;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+    if (isFinite(sValue))</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+      return parseFloat(sValue);</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+    if (isFinite(Date.parse(sValue)))</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+      return new Date(sValue);</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+    return sValue;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+  };</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+  function EmptyTree() {</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+  }</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+  EmptyTree.prototype = {</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+    toString : function () {</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+      return &quot;null&quot;;</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+    },</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+    valueOf : function () {</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+      return null;</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+    },</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+  };</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+  function objectify(vValue) {</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+    if (vValue === null)</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+      return new EmptyTree();</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+    else if (vValue instanceof Object)</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+      return vValue;</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+    else</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+      return new vValue.constructor(vValue); // What does this? copy?</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+  };</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+  function createObjTree(oParentNode, nVerb, bFreeze, bNesteAttr) {</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+    const nLevelStart = aCache.length;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+    const bChildren = oParentNode.hasChildNodes();</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+    const bAttributes = oParentNode.hasAttributes();</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+    const bHighVerb = Boolean(nVerb &amp; 2);</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+    var sProp = 0;</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+    var vContent = 0;</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+    var nLength = 0;</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+    var sCollectedTxt = &quot;&quot;;</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+    var vResult = bHighVerb ? {} : /* put here the default value for empty nodes: */ true;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+    if (bChildren) {</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+      for (var oNode, nItem = 0; nItem &lt; oParentNode.childNodes.length; nItem++) {</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+        oNode = oParentNode.childNodes.item(nItem);</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+        if (oNode.nodeType === 4) // CDATASection</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+          sCollectedTxt += oNode.nodeValue; </span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+        else if (oNode.nodeType === 3) // Text</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+          sCollectedTxt += oNode.nodeValue;</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+        else if (oNode.nodeType === 1) // Element</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+          aCache.push(oNode);</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+      }</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+    }</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+    const nLevelEnd = aCache.length;</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+    const vBuiltVal = parseText(sCollectedTxt);</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+    if (!bHighVerb &amp;&amp; (bChildren || bAttributes))</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+      vResult = nVerb === 0 ? objectify(vBuiltVal) : {};</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+    for (var nElId = nLevelStart; nElId &lt; nLevelEnd; nElId++) {</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+      sProp = aCache[nElId].nodeName;</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+      if (sProp == sValueProp || sProp == sAttributesProp)</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+        sProp = sProp + sConflictSuffix;</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+      vContent = createObjTree(aCache[nElId], nVerb, bFreeze, bNesteAttr);</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+      if (!vResult.hasOwnProperty(sProp)) {</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+        vResult[sProp] = vContent;</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+        vResult[sElementListPrefix + sProp] = [];</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+      }</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+      vResult[sElementListPrefix + sProp].push(vContent);</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+      nLength++;</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineplus">+    }</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineplus">+</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineplus">+    if (bAttributes) {</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineplus">+      const nAttrLen = oParentNode.attributes.length;</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineplus">+      const sAPrefix = bNesteAttr ? &quot;&quot; : sAttrPref;</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineplus">+      const oAttrParent = bNesteAttr ? {} : vResult;</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+      for (var oAttrib, nAttrib = 0; nAttrib &lt; nAttrLen; nLength++, nAttrib++) {</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+        oAttrib = oParentNode.attributes.item(nAttrib);</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+        oAttrParent[sAPrefix + oAttrib.name] = parseText(oAttrib.value);</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineplus">+      }</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineplus">+</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineplus">+      if (bNesteAttr) {</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineplus">+        if (bFreeze)</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineplus">+          Object.freeze(oAttrParent);</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineplus">+        vResult[sAttributesProp] = oAttrParent;</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineplus">+        nLength -= nAttrLen - 1;</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineplus">+      }</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineplus">+    }</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineplus">+</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineplus">+    if (nVerb === 3 || (nVerb === 2 || nVerb === 1 &amp;&amp; nLength &gt; 0) &amp;&amp; sCollectedTxt)</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineplus">+      vResult[sValueProp] = vBuiltVal;</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineplus">+    else if (!bHighVerb &amp;&amp; nLength === 0 &amp;&amp; sCollectedTxt)</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineplus">+      vResult = vBuiltVal;</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineplus">+</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineplus">+    if (bFreeze &amp;&amp; (bHighVerb || nLength &gt; 0))</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+      Object.freeze(vResult);</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+    aCache.length = nLevelStart;</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineplus">+</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineplus">+    return vResult;</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineplus">+  };</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineplus">+</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+  function loadObjTree(oXMLDoc, oParentEl, oParentObj) {</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineplus">+    var vValue, oChild;</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineplus">+</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineplus">+    if (oParentObj instanceof String || oParentObj instanceof Number ||</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineplus">+        oParentObj instanceof Boolean)</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineplus">+      oParentEl.appendChild(oXMLDoc.createTextNode(oParentObj.toString())); /* verbosity level is 0 */</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+    else if (oParentObj.constructor === Date)</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineplus">+      oParentEl.appendChild(oXMLDoc.createTextNode(oParentObj.toGMTString()));</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineplus">+</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineplus">+    for (var sName in oParentObj) {</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineplus">+      vValue = oParentObj[sName];</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineplus">+      if (isFinite(sName) || vValue instanceof Function)</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineplus">+        continue; /* verbosity level is 0 */</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineplus">+      if (sName === sValueProp) {</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineplus">+        if (vValue !== null &amp;&amp; vValue !== true) {</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineplus">+          oParentEl.appendChild(oXMLDoc.createTextNode(</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineplus">+              vValue.constructor === Date ? vValue.toGMTString() : String(vValue)));</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineplus">+        }</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineplus">+      } else if (sName === sAttributesProp) { /* verbosity level is 3 */</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+        for (var sAttrib in vValue)</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineplus">+          oParentEl.setAttribute(sAttrib, vValue[sAttrib]);</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineplus">+      } else if (sName.charAt(0) === sAttrPref) {</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineplus">+        oParentEl.setAttribute(sName.slice(1), vValue);</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineplus">+      } else if (vValue.constructor === Array) {</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineplus">+        for (var nItem = 0; nItem &lt; vValue.length; nItem++) {</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineplus">+          oChild = oXMLDoc.createElement(sName);</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineplus">+          loadObjTree(oXMLDoc, oChild, vValue[nItem]);</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+          oParentEl.appendChild(oChild);</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineplus">+        }</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineplus">+      } else {</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineplus">+        oChild = oXMLDoc.createElement(sName);</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineplus">+        if (vValue instanceof Object)</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineplus">+          loadObjTree(oXMLDoc, oChild, vValue);</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineplus">+        else if (vValue !== null &amp;&amp; vValue !== true)</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineplus">+          oChild.appendChild(oXMLDoc.createTextNode(vValue.toString()));</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineplus">+        oParentEl.appendChild(oChild);</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineplus">+     }</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineplus">+   }</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineplus">+  };</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineplus">+</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineplus">+  this.build = function(oXMLParent, nVerbosity /* optional */, bFreeze /* optional */, bNesteAttributes /* optional */) {</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+    const _nVerb = arguments.length &gt; 1 &amp;&amp;</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+        typeof nVerbosity === &quot;number&quot; ? nVerbosity &amp; 3 :</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineplus">+        /* put here the default verbosity level: */ 1;</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineplus">+    return createObjTree(oXMLParent, _nVerb, bFreeze || false,</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineplus">+        arguments.length &gt; 3 ? bNesteAttributes : _nVerb === 3);</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineplus">+  };</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineplus">+</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineplus">+  this.unbuild = function(oObjTree) {</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineplus">+    const oNewDoc = document.implementation.createDocument(&quot;&quot;, &quot;&quot;, null);</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineplus">+    loadObjTree(oNewDoc, oNewDoc, oObjTree);</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineplus">+    return oNewDoc;</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineplus">+  };</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineplus">+})();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/util/Makefile.in</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/util/Makefile.in</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -66,16 +66,20 @@ EXTRA_JS_MODULES = \</span>
<a href="#l10.4"></a><span id="l10.4"> 		templateUtils.js \</span>
<a href="#l10.5"></a><span id="l10.5"> 		IOUtils.js \</span>
<a href="#l10.6"></a><span id="l10.6"> 		mailnewsMigrator.js \</span>
<a href="#l10.7"></a><span id="l10.7"> 		mailServices.js \</span>
<a href="#l10.8"></a><span id="l10.8"> 		msgDBCacheManager.js \</span>
<a href="#l10.9"></a><span id="l10.9"> 		hostnameUtils.jsm \</span>
<a href="#l10.10"></a><span id="l10.10"> 		$(NULL)</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+ifdef MOZ_THUNDERBIRD</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+EXTRA_JS_MODULES += JXON.js</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+endif</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+</span>
<a href="#l10.16"></a><span id="l10.16"> # we don't want the shared lib, but we want to force the creation of a static lib.</span>
<a href="#l10.17"></a><span id="l10.17"> FORCE_STATIC_LIB = 1</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19"> DEFINES		+= -D_IMPL_NS_MSG_BASE</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l10.22"></a><span id="l10.22"> DEFINES		+= -DZLIB_DLL</span>
<a href="#l10.23"></a><span id="l10.23"> OS_CXXFLAGS	+= -DNOMINMAX</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

