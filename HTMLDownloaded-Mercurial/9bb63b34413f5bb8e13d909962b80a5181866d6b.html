<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20070:9bb63b34413f5bb8e13d909962b80a5181866d6b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9bb63b34413f5bb8e13d909962b80a5181866d6b" />
<meta property="og:url" content="/comm-central/rev/9bb63b34413f5bb8e13d909962b80a5181866d6b" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - (almost) enable no-extra-parens rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9bb63b34413f5bb8e13d909962b80a5181866d6b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9bb63b34413f5bb8e13d909962b80a5181866d6b">shortlog</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9bb63b34413f5bb8e13d909962b80a5181866d6b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b">files</a> |
changeset |
<a href="/comm-central/raw-rev/9bb63b34413f5bb8e13d909962b80a5181866d6b">raw</a>  | <a href="/comm-central/archive/9bb63b34413f5bb8e13d909962b80a5181866d6b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - (almost) enable no-extra-parens rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 14:03:51 +0200</td></tr>

<tr>
 <td>changeset 20070</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9bb63b34413f5bb8e13d909962b80a5181866d6b">9bb63b34413f5bb8e13d909962b80a5181866d6b</a></td>
</tr>



<tr>
<td>parent 20069</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/12957589835a7d5e54809d335388c5b960019105">12957589835a7d5e54809d335388c5b960019105</a>
</td>
</tr>

<tr>
<td>child 20071</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3d474ac6379c7c7278e3d41fb40437d95b9f7470">3d474ac6379c7c7278e3d41fb40437d95b9f7470</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9bb63b34413f5bb8e13d909962b80a5181866d6b">12307</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sat, 17 Sep 2016 23:18:38 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9bb63b34413f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9bb63b34413f5bb8e13d909962b80a5181866d6b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9bb63b34413f5bb8e13d909962b80a5181866d6b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9bb63b34413f5bb8e13d909962b80a5181866d6b&newProject=comm-central&newRevision=9bb63b34413f5bb8e13d909962b80a5181866d6b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9bb63b34413f5bb8e13d909962b80a5181866d6b&newProject=comm-central&newRevision=9bb63b34413f5bb8e13d909962b80a5181866d6b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9bb63b34413f5bb8e13d909962b80a5181866d6b&newProject=comm-central&newRevision=9bb63b34413f5bb8e13d909962b80a5181866d6b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - (almost) enable no-extra-parens rule. r=MakeMyDay

MozReview-Commit-ID: AIxffiiJaCp</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.xml">calendar/base/content/agenda-listbox.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/agenda-listbox.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-common-sets.js">calendar/base/content/calendar-common-sets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-common-sets.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-common-sets.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-common-sets.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-common-sets.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-common-sets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-menus.xml">calendar/base/content/calendar-menus.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-menus.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-menus.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-menus.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-menus.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-menus.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-view.js">calendar/base/content/calendar-task-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-view.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-view.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-view.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-view.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-task-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-view-core.xml">calendar/base/content/calendar-view-core.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-view-core.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-view-core.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-view-core.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-view-core.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/calendar-view-core.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-dialog-utils.js">calendar/base/content/dialogs/calendar-dialog-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-dialog-utils.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-dialog-utils.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-dialog-utils.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-dialog-utils.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-dialog-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">calendar/base/content/dialogs/calendar-event-dialog-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">calendar/base/content/dialogs/calendar-event-dialog-timezone.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-properties-dialog.js">calendar/base/content/dialogs/calendar-properties-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-properties-dialog.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-properties-dialog.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-properties-dialog.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-properties-dialog.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/dialogs/calendar-properties-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/today-pane.js">calendar/base/content/today-pane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/today-pane.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/today-pane.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/today-pane.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/today-pane.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/today-pane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-list-tree.xml">calendar/base/content/widgets/calendar-list-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-list-tree.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-list-tree.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-list-tree.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-list-tree.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-list-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-widgets.xml">calendar/base/content/widgets/calendar-widgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-widgets.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-widgets.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-widgets.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-widgets.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/calendar-widgets.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calAlarmUtils.jsm">calendar/base/modules/calAlarmUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calAlarmUtils.jsm">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calAlarmUtils.jsm">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calAlarmUtils.jsm">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calAlarmUtils.jsm">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calAlarmUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calEvent.js">calendar/base/src/calEvent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calEvent.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calEvent.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calEvent.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calEvent.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calEvent.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calIcsParser.js">calendar/base/src/calIcsParser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calIcsParser.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calIcsParser.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calIcsParser.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calIcsParser.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calIcsParser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItipItem.js">calendar/base/src/calItipItem.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItipItem.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItipItem.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItipItem.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItipItem.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calItipItem.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTodo.js">calendar/base/src/calTodo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTodo.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTodo.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTodo.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTodo.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTodo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTransactionManager.js">calendar/base/src/calTransactionManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTransactionManager.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTransactionManager.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTransactionManager.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTransactionManager.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calTransactionManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calWeekInfoService.js">calendar/base/src/calWeekInfoService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calWeekInfoService.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calWeekInfoService.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calWeekInfoService.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calWeekInfoService.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/base/src/calWeekInfoService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calHtmlExport.js">calendar/import-export/calHtmlExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calHtmlExport.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calHtmlExport.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calHtmlExport.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calHtmlExport.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calHtmlExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calMonthGridPrinter.js">calendar/import-export/calMonthGridPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calMonthGridPrinter.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calMonthGridPrinter.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calMonthGridPrinter.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calMonthGridPrinter.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calMonthGridPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calWeekPrinter.js">calendar/import-export/calWeekPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calWeekPrinter.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calWeekPrinter.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calWeekPrinter.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calWeekPrinter.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/import-export/calWeekPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/itip/calItipEmailTransport.js">calendar/itip/calItipEmailTransport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/itip/calItipEmailTransport.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/itip/calItipEmailTransport.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/itip/calItipEmailTransport.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/itip/calItipEmailTransport.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/itip/calItipEmailTransport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/lightning/modules/ltnInvitationUtils.jsm">calendar/lightning/modules/ltnInvitationUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/lightning/modules/ltnInvitationUtils.jsm">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/lightning/modules/ltnInvitationUtils.jsm">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/lightning/modules/ltnInvitationUtils.jsm">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/lightning/modules/ltnInvitationUtils.jsm">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/lightning/modules/ltnInvitationUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavRequestHandlers.js">calendar/providers/caldav/calDavRequestHandlers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavRequestHandlers.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavRequestHandlers.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavRequestHandlers.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavRequestHandlers.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/caldav/calDavRequestHandlers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/memory/calMemoryCalendar.js">calendar/providers/memory/calMemoryCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/memory/calMemoryCalendar.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/memory/calMemoryCalendar.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/memory/calMemoryCalendar.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/memory/calMemoryCalendar.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/memory/calMemoryCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendar.js">calendar/providers/wcap/calWcapCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendar.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendar.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendar.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendar.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarModule.js">calendar/providers/wcap/calWcapCalendarModule.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarModule.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarModule.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarModule.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarModule.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapCalendarModule.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapErrors.js">calendar/providers/wcap/calWcapErrors.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapErrors.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapErrors.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapErrors.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapErrors.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapErrors.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapRequest.js">calendar/providers/wcap/calWcapRequest.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapRequest.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapRequest.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapRequest.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapRequest.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapRequest.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapUtils.js">calendar/providers/wcap/calWcapUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapUtils.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapUtils.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapUtils.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapUtils.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/providers/wcap/calWcapUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/calendarCreation.js">calendar/resources/content/calendarCreation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/calendarCreation.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/calendarCreation.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/calendarCreation.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/calendarCreation.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/calendarCreation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/mouseoverPreviews.js">calendar/resources/content/mouseoverPreviews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/mouseoverPreviews.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/mouseoverPreviews.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/mouseoverPreviews.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/mouseoverPreviews.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/resources/content/mouseoverPreviews.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/eventDialog/testEventDialog.js">calendar/test/mozmill/eventDialog/testEventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/eventDialog/testEventDialog.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/eventDialog/testEventDialog.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/eventDialog/testEventDialog.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/eventDialog/testEventDialog.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/eventDialog/testEventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/shared-modules/calendar-utils.js">calendar/test/mozmill/shared-modules/calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/shared-modules/calendar-utils.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/shared-modules/calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/shared-modules/calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/shared-modules/calendar-utils.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/mozmill/shared-modules/calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_alarmservice.js">calendar/test/unit/test_alarmservice.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_alarmservice.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_alarmservice.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_alarmservice.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_alarmservice.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_alarmservice.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_gdata_provider.js">calendar/test/unit/test_gdata_provider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_gdata_provider.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_gdata_provider.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_gdata_provider.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_gdata_provider.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_gdata_provider.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_timezone_definition.js">calendar/test/unit/test_timezone_definition.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_timezone_definition.js">file</a> |
<a href="/comm-central/annotate/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_timezone_definition.js">annotate</a> |
<a href="/comm-central/diff/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_timezone_definition.js">diff</a> |
<a href="/comm-central/comparison/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_timezone_definition.js">comparison</a> |
<a href="/comm-central/log/9bb63b34413f5bb8e13d909962b80a5181866d6b/calendar/test/unit/test_timezone_definition.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -351,16 +351,20 @@</span>
<a href="#l1.4"></a><span id="l1.4">     &quot;no-floating-decimal&quot;: 2,</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">     // Require Space Before Blocks</span>
<a href="#l1.7"></a><span id="l1.7">     &quot;space-before-blocks&quot;: 2,</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     // Operators always before the line break</span>
<a href="#l1.10"></a><span id="l1.10">     &quot;operator-linebreak&quot;: [2, &quot;after&quot;, { &quot;overrides&quot;: { &quot;:&quot;: &quot;before&quot;, &quot;?&quot;: &quot;ignore&quot;}}],</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Restricts the use of parentheses to only where they are necessary</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    // Disabled for now since this also removes parens around assignments, e.g. let foo = bar == baz</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+    // &quot;no-extra-parens&quot;: [2, &quot;all&quot;, { &quot;conditionalAssign&quot;: false, &quot;returnAssign&quot;: false, &quot;nestedBinaryExpressions&quot;: false }],</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+</span>
<a href="#l1.16"></a><span id="l1.16">     // Will enable these rules later</span>
<a href="#l1.17"></a><span id="l1.17">     &quot;block-spacing&quot;: 0,</span>
<a href="#l1.18"></a><span id="l1.18">     &quot;no-lonely-if&quot;: 0,</span>
<a href="#l1.19"></a><span id="l1.19">     &quot;computed-property-spacing&quot;: 0,</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21">     // The following rules will not be enabled currently, but are kept here for</span>
<a href="#l1.22"></a><span id="l1.22">     // easier updates in the future.</span>
<a href="#l1.23"></a><span id="l1.23">     &quot;no-else-return&quot;: 0,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -132,17 +132,17 @@ function onCheckboxChange(event) {</span>
<a href="#l2.4"></a><span id="l2.4">         agendaListbox.refreshCalendarQuery(period.start, period.end);</span>
<a href="#l2.5"></a><span id="l2.5">     } else {</span>
<a href="#l2.6"></a><span id="l2.6">         listItem = listItem.nextSibling;</span>
<a href="#l2.7"></a><span id="l2.7">         let leaveloop;</span>
<a href="#l2.8"></a><span id="l2.8">         do {</span>
<a href="#l2.9"></a><span id="l2.9">             leaveloop = (listItem == null);</span>
<a href="#l2.10"></a><span id="l2.10">             if (!leaveloop) {</span>
<a href="#l2.11"></a><span id="l2.11">                 let nextItemSibling = listItem.nextSibling;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                leaveloop = (!agendaListbox.isEventListItem(listItem));</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                leaveloop = !agendaListbox.isEventListItem(listItem);</span>
<a href="#l2.14"></a><span id="l2.14">                 if (!leaveloop) {</span>
<a href="#l2.15"></a><span id="l2.15">                     listItem.remove();</span>
<a href="#l2.16"></a><span id="l2.16">                     listItem = nextItemSibling;</span>
<a href="#l2.17"></a><span id="l2.17">                 }</span>
<a href="#l2.18"></a><span id="l2.18">             }</span>
<a href="#l2.19"></a><span id="l2.19">         } while (!leaveloop);</span>
<a href="#l2.20"></a><span id="l2.20">     }</span>
<a href="#l2.21"></a><span id="l2.21">     calendarController.onSelectionChanged({ detail: [] });</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -377,25 +377,25 @@ function isBefore(aItem, aCompItem, aPer</span>
<a href="#l2.23"></a><span id="l2.23">         // - events and events spanning multiple days: start, end, (sorted by</span>
<a href="#l2.24"></a><span id="l2.24">         //   time) and intermediate.</span>
<a href="#l2.25"></a><span id="l2.25">         if (itemDate.isDate &amp;&amp; aItem.duration.days == 1) {</span>
<a href="#l2.26"></a><span id="l2.26">             // all-day events with duration one day</span>
<a href="#l2.27"></a><span id="l2.27">             return true;</span>
<a href="#l2.28"></a><span id="l2.28">         } else if (itemDate.isDate) {</span>
<a href="#l2.29"></a><span id="l2.29">             if (aItem.startDate.compare(itemDate) == 0) {</span>
<a href="#l2.30"></a><span id="l2.30">                 // starting day of an all-day events spannig multiple days</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-                return (!compItemDate.isDate || aCompItem.duration.days != 1);</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+                return !compItemDate.isDate || aCompItem.duration.days != 1;</span>
<a href="#l2.33"></a><span id="l2.33">             } else if (aItem.endDate.compare(itemDateEndDate) == 0) {</span>
<a href="#l2.34"></a><span id="l2.34">                 // ending day of an all-day events spannig multiple days</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-                return (!compItemDate.isDate ||</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-                        (aCompItem.duration.days != 1 &amp;&amp;</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-                          aCompItem.startDate.compare(compItemDate) != 0));</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+                return !compItemDate.isDate ||</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+                       (aCompItem.duration.days != 1 &amp;&amp;</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+                        aCompItem.startDate.compare(compItemDate) != 0);</span>
<a href="#l2.41"></a><span id="l2.41">             } else {</span>
<a href="#l2.42"></a><span id="l2.42">                 // intermediate day of an all-day events spannig multiple days</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-                return (!compItemDate.isDate);</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+                return !compItemDate.isDate;</span>
<a href="#l2.45"></a><span id="l2.45">             }</span>
<a href="#l2.46"></a><span id="l2.46">         } else if (aCompItem.startDate.isDate) {</span>
<a href="#l2.47"></a><span id="l2.47">             return false;</span>
<a href="#l2.48"></a><span id="l2.48">         }</span>
<a href="#l2.49"></a><span id="l2.49">     }</span>
<a href="#l2.50"></a><span id="l2.50">     // Non all-day event sorted by date-time. When equal, sorted by start</span>
<a href="#l2.51"></a><span id="l2.51">     // date-time then by end date-time.</span>
<a href="#l2.52"></a><span id="l2.52">     let comp = itemDate.compare(compItemDate);</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineat">@@ -464,17 +464,17 @@ function getListItems(aItem, aPeriod) {</span>
<a href="#l2.54"></a><span id="l2.54">     }</span>
<a href="#l2.55"></a><span id="l2.55">     if (periods.length &gt; 0) {</span>
<a href="#l2.56"></a><span id="l2.56">         for (let i = 0; i &lt; periods.length; i++) {</span>
<a href="#l2.57"></a><span id="l2.57">             let period = periods[i];</span>
<a href="#l2.58"></a><span id="l2.58">             let complistItem = period.listItem;</span>
<a href="#l2.59"></a><span id="l2.59">             let leaveloop;</span>
<a href="#l2.60"></a><span id="l2.60">             do {</span>
<a href="#l2.61"></a><span id="l2.61">                 complistItem = complistItem.nextSibling;</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-                leaveloop = (!this.isEventListItem(complistItem));</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+                leaveloop = !this.isEventListItem(complistItem);</span>
<a href="#l2.64"></a><span id="l2.64">                 if (!leaveloop) {</span>
<a href="#l2.65"></a><span id="l2.65">                     if (this.isSameEvent(aItem, complistItem.occurrence)) {</span>
<a href="#l2.66"></a><span id="l2.66">                         retlistItems.push(complistItem);</span>
<a href="#l2.67"></a><span id="l2.67">                         break;</span>
<a href="#l2.68"></a><span id="l2.68">                     }</span>
<a href="#l2.69"></a><span id="l2.69">                 }</span>
<a href="#l2.70"></a><span id="l2.70">             } while (!leaveloop);</span>
<a href="#l2.71"></a><span id="l2.71">         }</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineat">@@ -531,31 +531,31 @@ function deleteItemsFromCalendar(aCalend</span>
<a href="#l2.73"></a><span id="l2.73">  * matches</span>
<a href="#l2.74"></a><span id="l2.74">  *</span>
<a href="#l2.75"></a><span id="l2.75">  * @param aItem         The item to compare.</span>
<a href="#l2.76"></a><span id="l2.76">  * @param aCompItem     The item to compare with.</span>
<a href="#l2.77"></a><span id="l2.77">  * @return              True, if the items match with the above noted criteria.</span>
<a href="#l2.78"></a><span id="l2.78">  */</span>
<a href="#l2.79"></a><span id="l2.79"> agendaListbox.isSameEvent =</span>
<a href="#l2.80"></a><span id="l2.80"> function isSameEvent(aItem, aCompItem) {</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-    return ((aItem.id == aCompItem.id) &amp;&amp;</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-            (aItem[calGetStartDateProp(aItem)].compare(aCompItem[calGetStartDateProp(aCompItem)]) == 0));</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    return aItem.id == aCompItem.id &amp;&amp;</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+           aItem[calGetStartDateProp(aItem)].compare(aCompItem[calGetStartDateProp(aCompItem)]) == 0;</span>
<a href="#l2.85"></a><span id="l2.85"> };</span>
<a href="#l2.86"></a><span id="l2.86"> </span>
<a href="#l2.87"></a><span id="l2.87"> /**</span>
<a href="#l2.88"></a><span id="l2.88">  * Checks if the currently selected node in the listbox is an Event item (not a</span>
<a href="#l2.89"></a><span id="l2.89">  * period item).</span>
<a href="#l2.90"></a><span id="l2.90">  *</span>
<a href="#l2.91"></a><span id="l2.91">  * @return              True, if the node is not a period item.</span>
<a href="#l2.92"></a><span id="l2.92">  */</span>
<a href="#l2.93"></a><span id="l2.93"> agendaListbox.isEventSelected =</span>
<a href="#l2.94"></a><span id="l2.94"> function isEventSelected() {</span>
<a href="#l2.95"></a><span id="l2.95">     let listItem = this.agendaListboxControl.selectedItem;</span>
<a href="#l2.96"></a><span id="l2.96">     if (listItem) {</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">-        return (this.isEventListItem(listItem));</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+        return this.isEventListItem(listItem);</span>
<a href="#l2.99"></a><span id="l2.99">     }</span>
<a href="#l2.100"></a><span id="l2.100">     return false;</span>
<a href="#l2.101"></a><span id="l2.101"> };</span>
<a href="#l2.102"></a><span id="l2.102"> </span>
<a href="#l2.103"></a><span id="l2.103"> /**</span>
<a href="#l2.104"></a><span id="l2.104">  * Delete the selected item from its calendar (if it is an event item)</span>
<a href="#l2.105"></a><span id="l2.105">  *</span>
<a href="#l2.106"></a><span id="l2.106">  * @param aDoNotConfirm     If true, the user will not be prompted.</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineat">@@ -781,17 +781,17 @@ function addListener(aListener) {</span>
<a href="#l2.108"></a><span id="l2.108">  * @return              Returns true if today is shown.</span>
<a href="#l2.109"></a><span id="l2.109">  */</span>
<a href="#l2.110"></a><span id="l2.110"> agendaListbox.showsToday =</span>
<a href="#l2.111"></a><span id="l2.111"> function showsToday(aStartDate) {</span>
<a href="#l2.112"></a><span id="l2.112">     let lstart = aStartDate;</span>
<a href="#l2.113"></a><span id="l2.113">     if (!lstart) {</span>
<a href="#l2.114"></a><span id="l2.114">         lstart = this.today.start;</span>
<a href="#l2.115"></a><span id="l2.115">     }</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineminus">-    let lshowsToday = (sameDay(now(), lstart));</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+    let lshowsToday = sameDay(now(), lstart);</span>
<a href="#l2.118"></a><span id="l2.118">     if (lshowsToday) {</span>
<a href="#l2.119"></a><span id="l2.119">         this.periods = [this.today, this.tomorrow, this.soon];</span>
<a href="#l2.120"></a><span id="l2.120">     } else {</span>
<a href="#l2.121"></a><span id="l2.121">         this.periods = [this.today];</span>
<a href="#l2.122"></a><span id="l2.122">     }</span>
<a href="#l2.123"></a><span id="l2.123">     return lshowsToday;</span>
<a href="#l2.124"></a><span id="l2.124"> };</span>
<a href="#l2.125"></a><span id="l2.125"> </span>
<a href="#l2.126"></a><span id="l2.126" class="difflineat">@@ -1064,17 +1064,17 @@ function setCurrentEvent() {</span>
<a href="#l2.127"></a><span id="l2.127">     let msScheduleTime = -1;</span>
<a href="#l2.128"></a><span id="l2.128">     let complistItem = agendaListbox.tomorrow.listItem.previousSibling;</span>
<a href="#l2.129"></a><span id="l2.129">     let removelist = [];</span>
<a href="#l2.130"></a><span id="l2.130">     let anow = now();</span>
<a href="#l2.131"></a><span id="l2.131">     let msuntillend = 0;</span>
<a href="#l2.132"></a><span id="l2.132">     let msuntillstart = 0;</span>
<a href="#l2.133"></a><span id="l2.133">     let leaveloop;</span>
<a href="#l2.134"></a><span id="l2.134">     do {</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineminus">-        leaveloop = (!agendaListbox.isEventListItem(complistItem));</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+        leaveloop = !agendaListbox.isEventListItem(complistItem);</span>
<a href="#l2.137"></a><span id="l2.137">         if (!leaveloop) {</span>
<a href="#l2.138"></a><span id="l2.138">             msuntillstart = complistItem.occurrence.startDate</span>
<a href="#l2.139"></a><span id="l2.139">                                         .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l2.140"></a><span id="l2.140">                                         .subtractDate(anow).inSeconds;</span>
<a href="#l2.141"></a><span id="l2.141">             if (msuntillstart &lt;= 0) {</span>
<a href="#l2.142"></a><span id="l2.142">                 msuntillend = complistItem.occurrence.endDate</span>
<a href="#l2.143"></a><span id="l2.143">                                           .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l2.144"></a><span id="l2.144">                                           .subtractDate(anow).inSeconds;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -263,19 +263,19 @@</span>
<a href="#l3.4"></a><span id="l3.4">             } else {</span>
<a href="#l3.5"></a><span id="l3.5">                 durationbox.textContent += &quot; &quot; + aItem.title;</span>
<a href="#l3.6"></a><span id="l3.6">             }</span>
<a href="#l3.7"></a><span id="l3.7">             this.refreshColor();</span>
<a href="#l3.8"></a><span id="l3.8">         ]]&gt;&lt;/body&gt;</span>
<a href="#l3.9"></a><span id="l3.9">       &lt;/method&gt;</span>
<a href="#l3.10"></a><span id="l3.10">       &lt;method name=&quot;refreshColor&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-            let calcolor = ((this.mOccurrence &amp;&amp;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                             this.mOccurrence.calendar.getProperty(&quot;color&quot;)) ||</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                            &quot;#a8c2e1&quot;);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+            let calcolor = (this.mOccurrence &amp;&amp;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+                            this.mOccurrence.calendar.getProperty(&quot;color&quot;)) ||</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+                           &quot;#a8c2e1&quot;;</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">             let imagebox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-calendar-image&quot;);</span>
<a href="#l3.20"></a><span id="l3.20">             imagebox.setAttribute(&quot;style&quot;, &quot;background-color: &quot; + calcolor + &quot;;&quot;);</span>
<a href="#l3.21"></a><span id="l3.21">         ]]&gt;&lt;/body&gt;</span>
<a href="#l3.22"></a><span id="l3.22">       &lt;/method&gt;</span>
<a href="#l3.23"></a><span id="l3.23">     &lt;/implementation&gt;</span>
<a href="#l3.24"></a><span id="l3.24">     &lt;handlers&gt;</span>
<a href="#l3.25"></a><span id="l3.25">       &lt;handler event=&quot;dragstart&quot;&gt;&lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-common-sets.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-common-sets.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -507,17 +507,17 @@ var calendarController = {</span>
<a href="#l4.4"></a><span id="l4.4">     selected_events_requires_network: false,</span>
<a href="#l4.5"></a><span id="l4.5">     selected_events_invitation: false,</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">     /**</span>
<a href="#l4.8"></a><span id="l4.8">      * Returns a boolean indicating if its possible to write items to any</span>
<a href="#l4.9"></a><span id="l4.9">      * calendar.</span>
<a href="#l4.10"></a><span id="l4.10">      */</span>
<a href="#l4.11"></a><span id="l4.11">     get writable() {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-        return (cal.getCalendarManager().getCalendars({}).some(cal.isCalendarWritable));</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+        return cal.getCalendarManager().getCalendars({}).some(cal.isCalendarWritable);</span>
<a href="#l4.14"></a><span id="l4.14">     },</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">     /**</span>
<a href="#l4.17"></a><span id="l4.17">      * Returns a boolean indicating if the application is currently in offline</span>
<a href="#l4.18"></a><span id="l4.18">      * mode.</span>
<a href="#l4.19"></a><span id="l4.19">      */</span>
<a href="#l4.20"></a><span id="l4.20">     get offline() {</span>
<a href="#l4.21"></a><span id="l4.21">         return Services.io.offline;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -397,21 +397,22 @@ function openEventDialog(calendarItem, c</span>
<a href="#l5.4"></a><span id="l5.4">         calendars = calendars.filter(userCanAddItemsToCalendar);</span>
<a href="#l5.5"></a><span id="l5.5">     } else { /* modify */</span>
<a href="#l5.6"></a><span id="l5.6">         calendars = calendars.filter((aCalendar) =&gt; {</span>
<a href="#l5.7"></a><span id="l5.7">             /* If the calendar is the item calendar, we check that the item</span>
<a href="#l5.8"></a><span id="l5.8">              * can be modified. If the calendar is NOT the item calendar, we</span>
<a href="#l5.9"></a><span id="l5.9">              * check that the user can remove items from that calendar and</span>
<a href="#l5.10"></a><span id="l5.10">              * add items to the current one.</span>
<a href="#l5.11"></a><span id="l5.11">              */</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-            return (((calendarItem.calendar != aCalendar) &amp;&amp;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                     userCanDeleteItemsFromCalendar(calendarItem.calendar) &amp;&amp;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-                     userCanAddItemsToCalendar(aCalendar)) ||</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-                    ((calendarItem.calendar == aCalendar) &amp;&amp;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-                     userCanModifyItem(calendarItem)));</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+            let isSameCalendar = calendarItem.calendar == aCalendar;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+            let canModify = userCanModifyItem(calendarItem);</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+            let canMoveItems = userCanDeleteItemsFromCalendar(calendarItem.calendar) &amp;&amp;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+                               userCanAddItemsToCalendar(aCalendar);</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+            return isSameCalendar ? canModify : canMoveItems;</span>
<a href="#l5.23"></a><span id="l5.23">         });</span>
<a href="#l5.24"></a><span id="l5.24">     }</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">     if (mode == &quot;new&quot; &amp;&amp;</span>
<a href="#l5.27"></a><span id="l5.27">         (!isCalendarWritable(calendar) ||</span>
<a href="#l5.28"></a><span id="l5.28">          !userCanAddItemsToCalendar(calendar) ||</span>
<a href="#l5.29"></a><span id="l5.29">          !isItemSupported(calendar))) {</span>
<a href="#l5.30"></a><span id="l5.30">         if (calendars.length &lt; 1) {</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineat">@@ -433,17 +434,17 @@ function openEventDialog(calendarItem, c</span>
<a href="#l5.32"></a><span id="l5.32"> </span>
<a href="#l5.33"></a><span id="l5.33">     // Setup the window arguments</span>
<a href="#l5.34"></a><span id="l5.34">     let args = {};</span>
<a href="#l5.35"></a><span id="l5.35">     args.calendarEvent = calendarItem;</span>
<a href="#l5.36"></a><span id="l5.36">     args.calendar = calendar;</span>
<a href="#l5.37"></a><span id="l5.37">     args.mode = mode;</span>
<a href="#l5.38"></a><span id="l5.38">     args.onOk = callback;</span>
<a href="#l5.39"></a><span id="l5.39">     args.job = job;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-    args.initialStartDateValue = (initialDate || getDefaultStartDate());</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+    args.initialStartDateValue = initialDate || getDefaultStartDate();</span>
<a href="#l5.42"></a><span id="l5.42">     args.inTab = Preferences.get(&quot;calendar.item.editInTab&quot;, false);</span>
<a href="#l5.43"></a><span id="l5.43">     args.useNewItemUI = Preferences.get(&quot;calendar.item.useNewItemUI&quot;, false);</span>
<a href="#l5.44"></a><span id="l5.44"> </span>
<a href="#l5.45"></a><span id="l5.45">     // this will be called if file-&gt;new has been selected from within the dialog</span>
<a href="#l5.46"></a><span id="l5.46">     args.onNewEvent = function(opcalendar) {</span>
<a href="#l5.47"></a><span id="l5.47">         createEventWithDialog(opcalendar, null, null);</span>
<a href="#l5.48"></a><span id="l5.48">     };</span>
<a href="#l5.49"></a><span id="l5.49">     args.onNewTodo = function(opcalendar) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -414,17 +414,17 @@ var calendarOfflineManager = {</span>
<a href="#l6.4"></a><span id="l6.4">         if (!this.initialized) {</span>
<a href="#l6.5"></a><span id="l6.5">             throw Components.results.NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l6.6"></a><span id="l6.6">         }</span>
<a href="#l6.7"></a><span id="l6.7">         Services.obs.removeObserver(this, &quot;network:offline-status-changed&quot;, false);</span>
<a href="#l6.8"></a><span id="l6.8">         this.initialized = false;</span>
<a href="#l6.9"></a><span id="l6.9">     },</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">     isOnline: function cOM_isOnline() {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        return (!Services.io.offline);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+        return !Services.io.offline;</span>
<a href="#l6.14"></a><span id="l6.14">     },</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16">     updateOfflineUI: function cOM_updateOfflineUI(aIsOffline) {</span>
<a href="#l6.17"></a><span id="l6.17">         // Refresh the current view</span>
<a href="#l6.18"></a><span id="l6.18">         currentView().goToDay(currentView().selectedDay);</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">         // Set up disabled locks for offline</span>
<a href="#l6.21"></a><span id="l6.21">         document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-menus.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-menus.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -44,24 +44,24 @@</span>
<a href="#l7.4"></a><span id="l7.4">             }</span>
<a href="#l7.5"></a><span id="l7.5">             let propertyValue;</span>
<a href="#l7.6"></a><span id="l7.6">             if (gTabmail &amp;&amp; gTabmail.currentTabInfo.mode.type == &quot;calendarTask&quot;) {</span>
<a href="#l7.7"></a><span id="l7.7">                 // We are in a task tab (editing a single task).</span>
<a href="#l7.8"></a><span id="l7.8">                 propertyValue = gConfig[this.mType];</span>
<a href="#l7.9"></a><span id="l7.9">             } else {</span>
<a href="#l7.10"></a><span id="l7.10">                 // We are in the Tasks tab.</span>
<a href="#l7.11"></a><span id="l7.11">                 let tasks = getSelectedTasks();</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-                let tasksSelected = ((tasks != null) &amp;&amp; (tasks.length &gt; 0));</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+                let tasksSelected = (tasks != null) &amp;&amp; (tasks.length &gt; 0);</span>
<a href="#l7.14"></a><span id="l7.14">                 if (tasksSelected) {</span>
<a href="#l7.15"></a><span id="l7.15">                     let task = tasks[0];</span>
<a href="#l7.16"></a><span id="l7.16">                     if (isPropertyValueSame(tasks, this.mType)) {</span>
<a href="#l7.17"></a><span id="l7.17">                         propertyValue = task[this.mType];</span>
<a href="#l7.18"></a><span id="l7.18">                     }</span>
<a href="#l7.19"></a><span id="l7.19">                 } else {</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-                    applyAttributeToMenuChildren(this, &quot;disabled&quot;, (!tasksSelected));</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+                    applyAttributeToMenuChildren(this, &quot;disabled&quot;, !tasksSelected);</span>
<a href="#l7.22"></a><span id="l7.22">                 }</span>
<a href="#l7.23"></a><span id="l7.23">             }</span>
<a href="#l7.24"></a><span id="l7.24">             if (propertyValue || propertyValue == 0) {</span>
<a href="#l7.25"></a><span id="l7.25">                 let command = document.getElementById(&quot;calendar_&quot; + this.mType + &quot;-&quot; + propertyValue + &quot;_command&quot;);</span>
<a href="#l7.26"></a><span id="l7.26">                 if (command) {</span>
<a href="#l7.27"></a><span id="l7.27">                     command.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l7.28"></a><span id="l7.28">                 }</span>
<a href="#l7.29"></a><span id="l7.29">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -742,17 +742,17 @@</span>
<a href="#l8.4"></a><span id="l8.4">               spanTotal = 0;</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6">               // Each layer contains a list of the columns that</span>
<a href="#l8.7"></a><span id="l8.7">               // need to be created for a span.</span>
<a href="#l8.8"></a><span id="l8.8">               for (let column of layer) {</span>
<a href="#l8.9"></a><span id="l8.9">                   let innerColumn = createXULElement(&quot;box&quot;);</span>
<a href="#l8.10"></a><span id="l8.10">                   innerColumn.setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-                  let colFlex = column.specialSpan ? (columnCount * column.specialSpan) : 1;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                  let colFlex = column.specialSpan ? columnCount * column.specialSpan : 1;</span>
<a href="#l8.14"></a><span id="l8.14">                   innerColumn.setAttribute(&quot;flex&quot;, colFlex);</span>
<a href="#l8.15"></a><span id="l8.15">                   spanTotal += colFlex;</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">                   innerColumn.style.minWidth = &quot;1px&quot;;</span>
<a href="#l8.18"></a><span id="l8.18">                   innerColumn.style.minHeight = &quot;1px&quot;;</span>
<a href="#l8.19"></a><span id="l8.19">                   innerColumn.style.width = colFlex + &quot;px&quot;;</span>
<a href="#l8.20"></a><span id="l8.20">                   innerColumn.style.height = colFlex + &quot;px&quot;;</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -1133,17 +1133,17 @@</span>
<a href="#l8.23"></a><span id="l8.23">                   // are introduced based on the start column and number of spanning columns of an item.</span>
<a href="#l8.24"></a><span id="l8.24">                   if (data.colSpan != 1) {</span>
<a href="#l8.25"></a><span id="l8.25">                       let index = glob.totalCols * data.colSpan + data.startCol;</span>
<a href="#l8.26"></a><span id="l8.26">                       layerIndex = layerArray[index];</span>
<a href="#l8.27"></a><span id="l8.27">                       if (!layerIndex) {</span>
<a href="#l8.28"></a><span id="l8.28">                           layerIndex = layerCounter++;</span>
<a href="#l8.29"></a><span id="l8.29">                           layerArray[index] = layerIndex;</span>
<a href="#l8.30"></a><span id="l8.30">                       }</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-                      let offset = ((glob.totalCols - data.colSpan) % glob.totalCols);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+                      let offset = (glob.totalCols - data.colSpan) % glob.totalCols;</span>
<a href="#l8.33"></a><span id="l8.33">                       if (offset != 0) {</span>
<a href="#l8.34"></a><span id="l8.34">                           specialSpan = data.colSpan / glob.totalCols;</span>
<a href="#l8.35"></a><span id="l8.35">                       }</span>
<a href="#l8.36"></a><span id="l8.36">                   } else {</span>
<a href="#l8.37"></a><span id="l8.37">                       layerIndex = 0;</span>
<a href="#l8.38"></a><span id="l8.38">                   }</span>
<a href="#l8.39"></a><span id="l8.39">                   layerIndex += layerOffset;</span>
<a href="#l8.40"></a><span id="l8.40"> </span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -1308,17 +1308,17 @@</span>
<a href="#l8.42"></a><span id="l8.42">               if ((this.mDragState.shadows - 1 - this.mDragState.offset) &gt; currentOffsetEndSide &amp;&amp;</span>
<a href="#l8.43"></a><span id="l8.43">                    lastCol.nextSibling) {</span>
<a href="#l8.44"></a><span id="l8.44">                   lastCol.nextSibling.fgboxes.dragbox.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l8.45"></a><span id="l8.45">                   lastCol.nextSibling.fgboxes.box.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l8.46"></a><span id="l8.46">               }</span>
<a href="#l8.47"></a><span id="l8.47">           }</span>
<a href="#l8.48"></a><span id="l8.48"> </span>
<a href="#l8.49"></a><span id="l8.49">           // set shadow boxes size for every part of the occurrence</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-          let firstShadowSize = (aCurrentShadows == 1) ? aEnd - aStart : this.mEndMin - aStart;</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+          let firstShadowSize = (aCurrentShadows == 1 ? aEnd : this.mEndMin) - aStart;</span>
<a href="#l8.52"></a><span id="l8.52">           let column = firstCol;</span>
<a href="#l8.53"></a><span id="l8.53">           for (let i = firstIndex; column &amp;&amp; i &lt;= lastIndex; i++) {</span>
<a href="#l8.54"></a><span id="l8.54">               column.fgboxes.box.setAttribute(&quot;dragging&quot;, &quot;true&quot;);</span>
<a href="#l8.55"></a><span id="l8.55">               column.fgboxes.dragbox.setAttribute(&quot;dragging&quot;, &quot;true&quot;);</span>
<a href="#l8.56"></a><span id="l8.56">               if (i == 0) {</span>
<a href="#l8.57"></a><span id="l8.57">                   // first shadow</span>
<a href="#l8.58"></a><span id="l8.58">                   column.fgboxes.dragspacer.setAttribute(aSizeattr, aStart * column.mPixPerMin);</span>
<a href="#l8.59"></a><span id="l8.59">                   column.fgboxes.dragbox.setAttribute(aSizeattr, firstShadowSize * column.mPixPerMin);</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineat">@@ -1934,18 +1934,18 @@</span>
<a href="#l8.61"></a><span id="l8.61">       &lt;method name=&quot;updateDragLabels&quot;&gt;</span>
<a href="#l8.62"></a><span id="l8.62">         &lt;parameter name=&quot;aFirstColumn&quot;/&gt;</span>
<a href="#l8.63"></a><span id="l8.63">         &lt;parameter name=&quot;aLastColumn&quot;/&gt;</span>
<a href="#l8.64"></a><span id="l8.64">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.65"></a><span id="l8.65">           if (!this.mDragState) {</span>
<a href="#l8.66"></a><span id="l8.66">               return;</span>
<a href="#l8.67"></a><span id="l8.67">           }</span>
<a href="#l8.68"></a><span id="l8.68"> </span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-          let firstColumn = (aFirstColumn || this);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-          let lastColumn = (aLastColumn || this);</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+          let firstColumn = aFirstColumn || this;</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+          let lastColumn = aLastColumn || this;</span>
<a href="#l8.73"></a><span id="l8.73">           let realstartmin = this.mDragState.startMin + this.mStartMin;</span>
<a href="#l8.74"></a><span id="l8.74">           let realendmin = this.mDragState.endMin + this.mStartMin;</span>
<a href="#l8.75"></a><span id="l8.75">           let starthr = Math.floor(realstartmin / 60);</span>
<a href="#l8.76"></a><span id="l8.76">           let startmin = realstartmin % 60;</span>
<a href="#l8.77"></a><span id="l8.77"> </span>
<a href="#l8.78"></a><span id="l8.78">           let endhr = Math.floor(realendmin / 60);</span>
<a href="#l8.79"></a><span id="l8.79">           let endmin = realendmin % 60;</span>
<a href="#l8.80"></a><span id="l8.80"> </span>
<a href="#l8.81"></a><span id="l8.81" class="difflineat">@@ -3057,18 +3057,18 @@</span>
<a href="#l8.82"></a><span id="l8.82">                   let occEnd = occ[endDateProperty];</span>
<a href="#l8.83"></a><span id="l8.83">                   // must have at least one of start or end</span>
<a href="#l8.84"></a><span id="l8.84">                   if (!occStart &amp;&amp; !occEnd) {</span>
<a href="#l8.85"></a><span id="l8.85">                       continue; // task with no dates</span>
<a href="#l8.86"></a><span id="l8.86">                   }</span>
<a href="#l8.87"></a><span id="l8.87"> </span>
<a href="#l8.88"></a><span id="l8.88">                   // if just has single datetime, treat as zero duration item</span>
<a href="#l8.89"></a><span id="l8.89">                   // (such as task with due datetime or start datetime only)</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineminus">-                  occStart = (occStart || occEnd);</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineminus">-                  occEnd = (occEnd || occStart);</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineplus">+                  occStart = occStart || occEnd;</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineplus">+                  occEnd = occEnd || occStart;</span>
<a href="#l8.94"></a><span id="l8.94">                   // Now both occStart and occEnd are datetimes.</span>
<a href="#l8.95"></a><span id="l8.95"> </span>
<a href="#l8.96"></a><span id="l8.96">                   // skip occurrence if all-day: it won't show in time view.</span>
<a href="#l8.97"></a><span id="l8.97">                   if (occStart.isDate || occEnd.isDate) {</span>
<a href="#l8.98"></a><span id="l8.98">                      continue;</span>
<a href="#l8.99"></a><span id="l8.99">                   }</span>
<a href="#l8.100"></a><span id="l8.100"> </span>
<a href="#l8.101"></a><span id="l8.101">                   // Trim dates to view.  (Not mutated so just reuse view dates)</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineat">@@ -3162,17 +3162,17 @@</span>
<a href="#l8.103"></a><span id="l8.103">             d.day += 1;</span>
<a href="#l8.104"></a><span id="l8.104">           }</span>
<a href="#l8.105"></a><span id="l8.105"> </span>
<a href="#l8.106"></a><span id="l8.106">           return count;</span>
<a href="#l8.107"></a><span id="l8.107">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l8.108"></a><span id="l8.108">       &lt;/property&gt;</span>
<a href="#l8.109"></a><span id="l8.109"> </span>
<a href="#l8.110"></a><span id="l8.110">       &lt;property name=&quot;orient&quot;&gt;</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[return (this.getAttribute(&quot;orient&quot;) || &quot;vertical&quot;);]]&gt;&lt;/getter&gt;</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[return this.getAttribute(&quot;orient&quot;) || &quot;vertical&quot;;]]&gt;&lt;/getter&gt;</span>
<a href="#l8.113"></a><span id="l8.113">         &lt;setter&gt;&lt;![CDATA[this.setAttribute(&quot;orient&quot;, val); return val;]]&gt;&lt;/setter&gt;</span>
<a href="#l8.114"></a><span id="l8.114">       &lt;/property&gt;</span>
<a href="#l8.115"></a><span id="l8.115"> </span>
<a href="#l8.116"></a><span id="l8.116">       &lt;property name=&quot;timeBarTimeIndicator&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l8.117"></a><span id="l8.117">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.118"></a><span id="l8.118">           let timebar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;timebar&quot;);</span>
<a href="#l8.119"></a><span id="l8.119">           return document.getAnonymousElementByAttribute(timebar, &quot;anonid&quot;, &quot;timeIndicatorBoxTimeBar&quot;);</span>
<a href="#l8.120"></a><span id="l8.120">         ]]&gt;&lt;/getter&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -187,17 +187,17 @@</span>
<a href="#l9.4"></a><span id="l9.4">           let ordinals = &quot;&quot;;</span>
<a href="#l9.5"></a><span id="l9.5">           let visible = &quot;&quot;;</span>
<a href="#l9.6"></a><span id="l9.6">           let sorted = this.mTreeView.selectedColumn;</span>
<a href="#l9.7"></a><span id="l9.7">           let tree = document.getAnonymousNodes(this)[0];</span>
<a href="#l9.8"></a><span id="l9.8">           let treecols = tree.getElementsByTagNameNS(tree.namespaceURI, &quot;treecol&quot;);</span>
<a href="#l9.9"></a><span id="l9.9">           for (let i = 0; i &lt; treecols.length; i++) {</span>
<a href="#l9.10"></a><span id="l9.10">               if (treecols[i].getAttribute(&quot;hidden&quot;) != &quot;true&quot;) {</span>
<a href="#l9.11"></a><span id="l9.11">                 let content = treecols[i].getAttribute(&quot;itemproperty&quot;);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-                visible += (visible.length &gt; 0) ? &quot; &quot; + content : content;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+                visible += visible.length &gt; 0 ? &quot; &quot; + content : content;</span>
<a href="#l9.14"></a><span id="l9.14">               }</span>
<a href="#l9.15"></a><span id="l9.15">               if (ordinals.length &gt; 0) {</span>
<a href="#l9.16"></a><span id="l9.16">                   ordinals += &quot; &quot;;</span>
<a href="#l9.17"></a><span id="l9.17">               }</span>
<a href="#l9.18"></a><span id="l9.18">               ordinals += treecols[i].ordinal;</span>
<a href="#l9.19"></a><span id="l9.19">               if (widths.length &gt; 0) {</span>
<a href="#l9.20"></a><span id="l9.20">                   widths += &quot; &quot;;</span>
<a href="#l9.21"></a><span id="l9.21">               }</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -237,17 +237,17 @@</span>
<a href="#l9.23"></a><span id="l9.23">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l9.24"></a><span id="l9.24">           let tree = document.getAnonymousElementByAttribute(</span>
<a href="#l9.25"></a><span id="l9.25">               this, &quot;anonid&quot;, &quot;calendar-task-tree&quot;);</span>
<a href="#l9.26"></a><span id="l9.26">           let index = tree.currentIndex;</span>
<a href="#l9.27"></a><span id="l9.27">           if (tree.view &amp;&amp; tree.view.selection) {</span>
<a href="#l9.28"></a><span id="l9.28">               // If the current index is not selected, then ignore</span>
<a href="#l9.29"></a><span id="l9.29">               index = (tree.view.selection.isSelected(index) ? index : -1);</span>
<a href="#l9.30"></a><span id="l9.30">           }</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-          return (index &lt; 0) ? null : this.mTaskArray[index];</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+          return index &lt; 0 ? null : this.mTaskArray[index];</span>
<a href="#l9.33"></a><span id="l9.33">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l9.34"></a><span id="l9.34">       &lt;/property&gt;</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36">       &lt;property name=&quot;selectedTasks&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l9.37"></a><span id="l9.37">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l9.38"></a><span id="l9.38">           let tasks = [];</span>
<a href="#l9.39"></a><span id="l9.39">           let start = {};</span>
<a href="#l9.40"></a><span id="l9.40">           let end = {};</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -1101,17 +1101,17 @@</span>
<a href="#l9.42"></a><span id="l9.42">                 let context = document.getElementById(this.getAttribute(&quot;context&quot;));</span>
<a href="#l9.43"></a><span id="l9.43">                 if (context &amp;&amp; context.state) {</span>
<a href="#l9.44"></a><span id="l9.44">                     menuOpen = (context.state == &quot;open&quot;) || (context.state == &quot;showing&quot;);</span>
<a href="#l9.45"></a><span id="l9.45">                 }</span>
<a href="#l9.46"></a><span id="l9.46">             }</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48">             let focused = (document.activeElement == tree) || menuOpen;</span>
<a href="#l9.49"></a><span id="l9.49"> </span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-            calendarController.onSelectionChanged({ detail: (focused ? this.selectedTasks : []) });</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+            calendarController.onSelectionChanged({ detail: focused ? this.selectedTasks : [] });</span>
<a href="#l9.52"></a><span id="l9.52">             calendarController.todo_tasktree_focused = focused;</span>
<a href="#l9.53"></a><span id="l9.53">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.54"></a><span id="l9.54">       &lt;/method&gt;</span>
<a href="#l9.55"></a><span id="l9.55"> </span>
<a href="#l9.56"></a><span id="l9.56">     &lt;/implementation&gt;</span>
<a href="#l9.57"></a><span id="l9.57"> </span>
<a href="#l9.58"></a><span id="l9.58">     &lt;handlers&gt;</span>
<a href="#l9.59"></a><span id="l9.59">       &lt;handler event=&quot;select&quot;&gt;&lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-task-view.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-view.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -50,20 +50,20 @@ var taskDetailsView = {</span>
<a href="#l10.4"></a><span id="l10.4">                     document.getElementById(&quot;calendar-task-details-organizer&quot;).value = name;</span>
<a href="#l10.5"></a><span id="l10.5">                 }</span>
<a href="#l10.6"></a><span id="l10.6">             }</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">             let priority = 0;</span>
<a href="#l10.9"></a><span id="l10.9">             if (item.calendar.getProperty(&quot;capabilities.priority.supported&quot;) != false) {</span>
<a href="#l10.10"></a><span id="l10.10">                 priority = parseInt(item.priority, 10);</span>
<a href="#l10.11"></a><span id="l10.11">             }</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-            displayElement(&quot;calendar-task-details-priority-label&quot;, (priority &gt; 0));</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-            displayElement(&quot;calendar-task-details-priority-low&quot;, (priority &gt;= 6 &amp;&amp; priority &lt;= 9));</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+            displayElement(&quot;calendar-task-details-priority-label&quot;, priority &gt; 0);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+            displayElement(&quot;calendar-task-details-priority-low&quot;, priority &gt;= 6 &amp;&amp; priority &lt;= 9);</span>
<a href="#l10.16"></a><span id="l10.16">             displayElement(&quot;calendar-task-details-priority-normal&quot;, priority == 5);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-            displayElement(&quot;calendar-task-details-priority-high&quot;, (priority &gt;= 1 &amp;&amp; priority &lt;= 4));</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+            displayElement(&quot;calendar-task-details-priority-high&quot;, priority &gt;= 1 &amp;&amp; priority &lt;= 4);</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20">             let status = item.getProperty(&quot;STATUS&quot;);</span>
<a href="#l10.21"></a><span id="l10.21">             if (displayElement(&quot;calendar-task-details-status-row&quot;, status &amp;&amp; status.length &gt; 0)) {</span>
<a href="#l10.22"></a><span id="l10.22">                 let statusDetails = document.getElementById(&quot;calendar-task-details-status&quot;);</span>
<a href="#l10.23"></a><span id="l10.23">                 switch (status) {</span>
<a href="#l10.24"></a><span id="l10.24">                     case &quot;NEEDS-ACTION&quot;:</span>
<a href="#l10.25"></a><span id="l10.25">                         statusDetails.value = calGetString(</span>
<a href="#l10.26"></a><span id="l10.26">                             &quot;calendar&quot;,</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineat">@@ -253,17 +253,17 @@ function taskViewOnLoad() {</span>
<a href="#l10.28"></a><span id="l10.28">     if (deck &amp;&amp; tree) {</span>
<a href="#l10.29"></a><span id="l10.29">         deck.addEventListener(&quot;select&quot;, taskViewObserveDisplayDeckChange, true);</span>
<a href="#l10.30"></a><span id="l10.30">         tree.textFilterField = &quot;task-text-filter-field&quot;;</span>
<a href="#l10.31"></a><span id="l10.31"> </span>
<a href="#l10.32"></a><span id="l10.32">         // setup the platform-dependent placeholder for the text filter field</span>
<a href="#l10.33"></a><span id="l10.33">         let textFilter = document.getElementById(&quot;task-text-filter-field&quot;);</span>
<a href="#l10.34"></a><span id="l10.34">         if (textFilter) {</span>
<a href="#l10.35"></a><span id="l10.35">             let base = textFilter.getAttribute(&quot;emptytextbase&quot;);</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-            let keyLabel = textFilter.getAttribute((AppConstants.platform == &quot;macosx&quot;) ?</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+            let keyLabel = textFilter.getAttribute(AppConstants.platform == &quot;macosx&quot; ?</span>
<a href="#l10.38"></a><span id="l10.38">                                                    &quot;keyLabelMac&quot; : &quot;keyLabelNonMac&quot;);</span>
<a href="#l10.39"></a><span id="l10.39"> </span>
<a href="#l10.40"></a><span id="l10.40">             textFilter.setAttribute(&quot;placeholder&quot;, base.replace(&quot;#1&quot;, keyLabel));</span>
<a href="#l10.41"></a><span id="l10.41">             textFilter.value = &quot;&quot;;</span>
<a href="#l10.42"></a><span id="l10.42">         }</span>
<a href="#l10.43"></a><span id="l10.43">     }</span>
<a href="#l10.44"></a><span id="l10.44"> </span>
<a href="#l10.45"></a><span id="l10.45">     // Setup customizeDone handler for the task action toolbox.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -81,17 +81,17 @@ function getElementValue(aElement, aProp</span>
<a href="#l11.4"></a><span id="l11.4">  * removing the attribute</span>
<a href="#l11.5"></a><span id="l11.5">  *</span>
<a href="#l11.6"></a><span id="l11.6">  * @param aXulElement     The XUL element/string ID the attribute is applied to.</span>
<a href="#l11.7"></a><span id="l11.7">  * @param aAttribute      The name of the attribute</span>
<a href="#l11.8"></a><span id="l11.8">  * @param aValue          The boolean value</span>
<a href="#l11.9"></a><span id="l11.9">  * @return                Returns aValue (for chaining)</span>
<a href="#l11.10"></a><span id="l11.10">  */</span>
<a href="#l11.11"></a><span id="l11.11"> function setBooleanAttribute(aXulElement, aAttribute, aValue) {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    setElementValue(aXulElement, (aValue ? &quot;true&quot; : false), aAttribute);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    setElementValue(aXulElement, aValue ? &quot;true&quot; : false, aAttribute);</span>
<a href="#l11.14"></a><span id="l11.14">     return aValue;</span>
<a href="#l11.15"></a><span id="l11.15"> }</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17"> /**</span>
<a href="#l11.18"></a><span id="l11.18">  * Unconditionally show the element (hidden attribute)</span>
<a href="#l11.19"></a><span id="l11.19">  *</span>
<a href="#l11.20"></a><span id="l11.20">  * @param aElement      ID of XUL element to set, or the element node itself</span>
<a href="#l11.21"></a><span id="l11.21">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -509,17 +509,17 @@ var unifinderTreeView = {</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5">     /**</span>
<a href="#l12.6"></a><span id="l12.6">      * Sets the items that should be in the unifinder. This removes all items</span>
<a href="#l12.7"></a><span id="l12.7">      * that were previously in the unifinder.</span>
<a href="#l12.8"></a><span id="l12.8">      */</span>
<a href="#l12.9"></a><span id="l12.9">     setItems: function uTV_setItems(aItemArray, aDontSort) {</span>
<a href="#l12.10"></a><span id="l12.10">         let oldCount = this.eventArray.length;</span>
<a href="#l12.11"></a><span id="l12.11">         this.eventArray = aItemArray.slice(0);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-        this.tree.rowCountChanged(oldCount - 1, (this.eventArray.length - oldCount));</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+        this.tree.rowCountChanged(oldCount - 1, this.eventArray.length - oldCount);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">         if (aDontSort) {</span>
<a href="#l12.16"></a><span id="l12.16">             this.calculateIndexMap();</span>
<a href="#l12.17"></a><span id="l12.17">         } else {</span>
<a href="#l12.18"></a><span id="l12.18">             this.sortItems();</span>
<a href="#l12.19"></a><span id="l12.19">         }</span>
<a href="#l12.20"></a><span id="l12.20">     },</span>
<a href="#l12.21"></a><span id="l12.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -343,17 +343,17 @@</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5">         // stop 'single click edit' timeout (if started)</span>
<a href="#l13.6"></a><span id="l13.6">         if (this.editingTimer) {</span>
<a href="#l13.7"></a><span id="l13.7">             clearTimeout(this.editingTimer);</span>
<a href="#l13.8"></a><span id="l13.8">             this.editingTimer = null;</span>
<a href="#l13.9"></a><span id="l13.9">         }</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">         if (this.calendarView &amp;&amp; this.calendarView.controller) {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-            let item = (event.ctrlKey) ? this.mOccurrence.parentItem : this.mOccurrence;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+            let item = event.ctrlKey ? this.mOccurrence.parentItem : this.mOccurrence;</span>
<a href="#l13.14"></a><span id="l13.14">             this.calendarView.controller.modifyOccurrence(item);</span>
<a href="#l13.15"></a><span id="l13.15">         }</span>
<a href="#l13.16"></a><span id="l13.16">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l13.17"></a><span id="l13.17">       &lt;handler event=&quot;mouseover&quot;&gt;&lt;![CDATA[</span>
<a href="#l13.18"></a><span id="l13.18">         if (this.calendarView &amp;&amp; this.calendarView.controller) {</span>
<a href="#l13.19"></a><span id="l13.19">             event.stopPropagation();</span>
<a href="#l13.20"></a><span id="l13.20">             onMouseOverItem(event);</span>
<a href="#l13.21"></a><span id="l13.21">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -132,19 +132,19 @@ function createReminderFromMenuitem(aMen</span>
<a href="#l14.4"></a><span id="l14.4">  * extension to open the reminder dialog, set the menulist &quot;item-alarm&quot; to the</span>
<a href="#l14.5"></a><span id="l14.5">  * custom menuitem and call updateReminder().</span>
<a href="#l14.6"></a><span id="l14.6">  */</span>
<a href="#l14.7"></a><span id="l14.7"> function editReminder() {</span>
<a href="#l14.8"></a><span id="l14.8">     let customItem = document.getElementById(&quot;reminder-custom-menuitem&quot;);</span>
<a href="#l14.9"></a><span id="l14.9">     let args = {};</span>
<a href="#l14.10"></a><span id="l14.10">     args.reminders = customItem.reminders;</span>
<a href="#l14.11"></a><span id="l14.11">     args.item = window.calendarItem;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    args.timezone = (window.gStartTimezone ||</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-                     window.gEndTimezone ||</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-                     calendarDefaultTimezone());</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+    args.timezone = window.gStartTimezone ||</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+                    window.gEndTimezone ||</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+                    calendarDefaultTimezone();</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">     args.calendar = getCurrentCalendar();</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21">     // While these are &quot;just&quot; callbacks, the dialog is opened modally, so aside</span>
<a href="#l14.22"></a><span id="l14.22">     // from whats needed to set up the reminders, nothing else needs to be done.</span>
<a href="#l14.23"></a><span id="l14.23">     args.onOk = function(reminders) {</span>
<a href="#l14.24"></a><span id="l14.24">         customItem.reminders = reminders;</span>
<a href="#l14.25"></a><span id="l14.25">     };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -238,17 +238,17 @@</span>
<a href="#l15.4"></a><span id="l15.4">           let cn = aAttendee.commonName || &quot;&quot;;</span>
<a href="#l15.5"></a><span id="l15.5">           let inputValue = cal.removeMailTo(aAttendee.id || &quot;&quot;);</span>
<a href="#l15.6"></a><span id="l15.6">           if (cn.length) {</span>
<a href="#l15.7"></a><span id="l15.7">               // Make the commonName appear in quotes if it contains a</span>
<a href="#l15.8"></a><span id="l15.8">               // character that could confuse the header parser</span>
<a href="#l15.9"></a><span id="l15.9">               if (cn.search(/[,;&lt;&gt;@]/) != -1) {</span>
<a href="#l15.10"></a><span id="l15.10">                   cn = '&quot;' + cn + '&quot;';</span>
<a href="#l15.11"></a><span id="l15.11">               }</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-              inputValue = (inputValue.length) ? cn + ' &lt;' + inputValue + '&gt;' : cn;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+              inputValue = inputValue.length ? cn + ' &lt;' + inputValue + '&gt;' : cn;</span>
<a href="#l15.14"></a><span id="l15.14">           }</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16">           // trim spaces if any</span>
<a href="#l15.17"></a><span id="l15.17">           inputValue = inputValue.trim();</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19">           // don't set value with null, otherwise autocomplete stops working,</span>
<a href="#l15.20"></a><span id="l15.20">           // but make sure attendee and dirty are set</span>
<a href="#l15.21"></a><span id="l15.21">           if (inputValue.length) {</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -449,17 +449,17 @@</span>
<a href="#l15.23"></a><span id="l15.23">           return null;</span>
<a href="#l15.24"></a><span id="l15.24">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l15.25"></a><span id="l15.25">       &lt;/property&gt;</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27">       &lt;method name=&quot;_resolveListByName&quot;&gt;</span>
<a href="#l15.28"></a><span id="l15.28">         &lt;parameter name=&quot;value&quot;/&gt;</span>
<a href="#l15.29"></a><span id="l15.29">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.30"></a><span id="l15.30">             let entries = MailServices.headerParser.makeFromDisplayAddress(value);</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-            return (entries.length) ? this._findListInAddrBooks(entries[0].name) : null;</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+            return entries.length ? this._findListInAddrBooks(entries[0].name) : null;</span>
<a href="#l15.33"></a><span id="l15.33">           ]]&gt;&lt;/body&gt;</span>
<a href="#l15.34"></a><span id="l15.34">     &lt;/method&gt;</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36">     &lt;method name=&quot;_findListInAddrBooks&quot;&gt;</span>
<a href="#l15.37"></a><span id="l15.37">         &lt;parameter name=&quot;entryname&quot;/&gt;</span>
<a href="#l15.38"></a><span id="l15.38">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.39"></a><span id="l15.39">             let allAddressBooks = MailServices.ab.directories;</span>
<a href="#l15.40"></a><span id="l15.40"> </span>
<a href="#l15.41"></a><span id="l15.41" class="difflineat">@@ -674,32 +674,32 @@</span>
<a href="#l15.42"></a><span id="l15.42">               &quot;OPT-PARTICIPANT&quot;: &quot;optional&quot;,</span>
<a href="#l15.43"></a><span id="l15.43">               &quot;NON-PARTICIPANT&quot;: &quot;nonparticipant&quot;,</span>
<a href="#l15.44"></a><span id="l15.44">               &quot;CHAIR&quot;: &quot;chair&quot;</span>
<a href="#l15.45"></a><span id="l15.45">             };</span>
<a href="#l15.46"></a><span id="l15.46"> </span>
<a href="#l15.47"></a><span id="l15.47">             let roleNameString = &quot;event.attendee.role.&quot; + (role in roleMap ? roleMap[role] : &quot;unknown&quot;);</span>
<a href="#l15.48"></a><span id="l15.48">             let tooltip = cal.calGetString(&quot;calendar-event-dialog-attendees&quot;,</span>
<a href="#l15.49"></a><span id="l15.49">                                            roleNameString,</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-                                           (role in roleMap ? null : [role]));</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+                                           role in roleMap ? null : [role]);</span>
<a href="#l15.52"></a><span id="l15.52">             targetIcon.setAttribute(&quot;tooltiptext&quot;, tooltip);</span>
<a href="#l15.53"></a><span id="l15.53">         } else if (targetIcon.className == &quot;usertype-icon&quot;) {</span>
<a href="#l15.54"></a><span id="l15.54">             let cutype = targetIcon.getAttribute(&quot;cutype&quot;);</span>
<a href="#l15.55"></a><span id="l15.55">             const cutypeMap = {</span>
<a href="#l15.56"></a><span id="l15.56">                 &quot;INDIVIDUAL&quot;: &quot;individual&quot;,</span>
<a href="#l15.57"></a><span id="l15.57">                 &quot;GROUP&quot;: &quot;group&quot;,</span>
<a href="#l15.58"></a><span id="l15.58">                 &quot;RESOURCE&quot;: &quot;resource&quot;,</span>
<a href="#l15.59"></a><span id="l15.59">                 &quot;ROOM&quot;: &quot;room&quot;,</span>
<a href="#l15.60"></a><span id="l15.60">                 // I've decided UNKNOWN will not be handled.</span>
<a href="#l15.61"></a><span id="l15.61">             };</span>
<a href="#l15.62"></a><span id="l15.62"> </span>
<a href="#l15.63"></a><span id="l15.63">             let cutypeString = &quot;event.attendee.usertype.&quot; + (cutype in cutypeMap ? cutypeMap[cutype] : &quot;unknown&quot;);</span>
<a href="#l15.64"></a><span id="l15.64">             let tooltip = cal.calGetString(&quot;calendar-event-dialog-attendees&quot;,</span>
<a href="#l15.65"></a><span id="l15.65">                                            cutypeString,</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-                                           (cutype in cutypeMap ? null : [cutype]));</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineplus">+                                           cutype in cutypeMap ? null : [cutype]);</span>
<a href="#l15.68"></a><span id="l15.68">             targetIcon.setAttribute(&quot;tooltiptext&quot;, tooltip);</span>
<a href="#l15.69"></a><span id="l15.69">         }</span>
<a href="#l15.70"></a><span id="l15.70">       ]]&gt;&lt;/body&gt;</span>
<a href="#l15.71"></a><span id="l15.71">       &lt;/method&gt;</span>
<a href="#l15.72"></a><span id="l15.72"> </span>
<a href="#l15.73"></a><span id="l15.73">       &lt;property name=&quot;documentSize&quot;&gt;</span>
<a href="#l15.74"></a><span id="l15.74">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l15.75"></a><span id="l15.75">             return this.mRowHeight * this.mMaxAttendees;</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineat">@@ -961,17 +961,17 @@</span>
<a href="#l15.77"></a><span id="l15.77"> </span>
<a href="#l15.78"></a><span id="l15.78">       &lt;method name=&quot;returnHit&quot;&gt;</span>
<a href="#l15.79"></a><span id="l15.79">         &lt;parameter name=&quot;element&quot;/&gt;</span>
<a href="#l15.80"></a><span id="l15.80">         &lt;parameter name=&quot;noAdvance&quot;/&gt;</span>
<a href="#l15.81"></a><span id="l15.81">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.82"></a><span id="l15.82">           function parseHeaderValue(aMsgIAddressObject) {</span>
<a href="#l15.83"></a><span id="l15.83">               if (aMsgIAddressObject.name.match(/[&lt;&gt;@,]/)) {</span>
<a href="#l15.84"></a><span id="l15.84">                   // special handling only needed for a name with a comma which are not already quoted</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineminus">-                  return ((aMsgIAddressObject.name.match(/^&quot;.*&quot;$/))</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+                  return (aMsgIAddressObject.name.match(/^&quot;.*&quot;$/)</span>
<a href="#l15.87"></a><span id="l15.87">                           ? aMsgIAddressObject.name</span>
<a href="#l15.88"></a><span id="l15.88">                           : '&quot;' + aMsgIAddressObject.name + '&quot;'</span>
<a href="#l15.89"></a><span id="l15.89">                          ) + ' &lt;' + aMsgIAddressObject.email + '&gt;';</span>
<a href="#l15.90"></a><span id="l15.90">               } else {</span>
<a href="#l15.91"></a><span id="l15.91">                   return aMsgIAddressObject.toString();</span>
<a href="#l15.92"></a><span id="l15.92">               }</span>
<a href="#l15.93"></a><span id="l15.93">           }</span>
<a href="#l15.94"></a><span id="l15.94"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -46,19 +46,19 @@ function onLoad() {</span>
<a href="#l16.4"></a><span id="l16.4">     for (let action of supportedActions) {</span>
<a href="#l16.5"></a><span id="l16.5">         allowedActionsMap[action] = true;</span>
<a href="#l16.6"></a><span id="l16.6">     }</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">     // Hide all actions that are not supported by this provider</span>
<a href="#l16.9"></a><span id="l16.9">     let firstAvailableItem;</span>
<a href="#l16.10"></a><span id="l16.10">     let actionNodes = document.getElementById(&quot;reminder-actions-menupopup&quot;).childNodes;</span>
<a href="#l16.11"></a><span id="l16.11">     for (let actionNode of actionNodes) {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        let shouldHide = (!(actionNode.value in allowedActionsMap) ||</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-                          (actionNode.hasAttribute(&quot;provider&quot;) &amp;&amp;</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-                           actionNode.getAttribute(&quot;provider&quot;) != calendar.type));</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+        let shouldHide = !(actionNode.value in allowedActionsMap) ||</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+                         (actionNode.hasAttribute(&quot;provider&quot;) &amp;&amp;</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+                          actionNode.getAttribute(&quot;provider&quot;) != calendar.type);</span>
<a href="#l16.18"></a><span id="l16.18">         setElementValue(actionNode, shouldHide &amp;&amp; &quot;true&quot;, &quot;hidden&quot;);</span>
<a href="#l16.19"></a><span id="l16.19">         if (!firstAvailableItem &amp;&amp; !shouldHide) {</span>
<a href="#l16.20"></a><span id="l16.20">             firstAvailableItem = actionNode;</span>
<a href="#l16.21"></a><span id="l16.21">         }</span>
<a href="#l16.22"></a><span id="l16.22">     }</span>
<a href="#l16.23"></a><span id="l16.23"> </span>
<a href="#l16.24"></a><span id="l16.24">     // Correct the selected item on the supported actions list. This will be</span>
<a href="#l16.25"></a><span id="l16.25">     // changed when reminders are loaded, but in case there are none we need to</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineat">@@ -403,18 +403,18 @@ function onNewReminder() {</span>
<a href="#l16.27"></a><span id="l16.27"> </span>
<a href="#l16.28"></a><span id="l16.28"> /**</span>
<a href="#l16.29"></a><span id="l16.29">  * Handler function to be called when the &quot;remove&quot; button is pressed to remove</span>
<a href="#l16.30"></a><span id="l16.30">  * the selected reminder item and advance the selection.</span>
<a href="#l16.31"></a><span id="l16.31">  */</span>
<a href="#l16.32"></a><span id="l16.32"> function onRemoveReminder() {</span>
<a href="#l16.33"></a><span id="l16.33">     let listbox = document.getElementById(&quot;reminder-listbox&quot;);</span>
<a href="#l16.34"></a><span id="l16.34">     let listitem = listbox.selectedItem;</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-    let newSelection = (listitem ? listitem.nextSibling ||</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-                                   listitem.previousSibling : null);</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+    let newSelection = listitem ? listitem.nextSibling || listitem.previousSibling</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+                                 : null;</span>
<a href="#l16.39"></a><span id="l16.39"> </span>
<a href="#l16.40"></a><span id="l16.40">     listbox.clearSelection();</span>
<a href="#l16.41"></a><span id="l16.41">     listitem.remove();</span>
<a href="#l16.42"></a><span id="l16.42">     listbox.selectItem(newSelection);</span>
<a href="#l16.43"></a><span id="l16.43"> </span>
<a href="#l16.44"></a><span id="l16.44">     setElementValue(&quot;reminder-remove-button&quot;,</span>
<a href="#l16.45"></a><span id="l16.45">                     listbox.childNodes.length &lt; 1 &amp;&amp; &quot;true&quot;,</span>
<a href="#l16.46"></a><span id="l16.46">                     &quot;disabled&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -10,18 +10,18 @@ Components.utils.import(&quot;resource://cale</span>
<a href="#l17.4"></a><span id="l17.4">  * Sets up the timezone dialog from the window arguments, also setting up all</span>
<a href="#l17.5"></a><span id="l17.5">  * dialog controls from the window's dates.</span>
<a href="#l17.6"></a><span id="l17.6">  */</span>
<a href="#l17.7"></a><span id="l17.7"> function onLoad() {</span>
<a href="#l17.8"></a><span id="l17.8">     let args = window.arguments[0];</span>
<a href="#l17.9"></a><span id="l17.9">     window.time = args.time;</span>
<a href="#l17.10"></a><span id="l17.10">     window.onAcceptCallback = args.onOk;</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    let tzProvider = (args.calendar.getProperty(&quot;timezones.provider&quot;) ||</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-                      cal.getTimezoneService());</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+    let tzProvider = args.calendar.getProperty(&quot;timezones.provider&quot;) ||</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+                     cal.getTimezoneService();</span>
<a href="#l17.16"></a><span id="l17.16">     window.tzProvider = tzProvider;</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18">     let menulist = document.getElementById(&quot;timezone-menulist&quot;);</span>
<a href="#l17.19"></a><span id="l17.19">     let tzMenuPopup = document.getElementById(&quot;timezone-menupopup&quot;);</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21">     // floating and UTC (if supported) at the top:</span>
<a href="#l17.22"></a><span id="l17.22">     if (args.calendar.getProperty(&quot;capabilities.timezones.floating.supported&quot;) !== false) {</span>
<a href="#l17.23"></a><span id="l17.23">         addMenuItem(tzMenuPopup, floating().displayName, floating().tzid);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -69,17 +69,17 @@ function loadCalendarPrintDialog() {</span>
<a href="#l18.4"></a><span id="l18.4">  * settings.</span>
<a href="#l18.5"></a><span id="l18.5">  *</span>
<a href="#l18.6"></a><span id="l18.6">  * @param receiverFunc  The callback function to call on completion.</span>
<a href="#l18.7"></a><span id="l18.7">  */</span>
<a href="#l18.8"></a><span id="l18.8"> function getPrintSettings(receiverFunc) {</span>
<a href="#l18.9"></a><span id="l18.9">     let tempTitle = document.getElementById(&quot;title-field&quot;).value;</span>
<a href="#l18.10"></a><span id="l18.10">     let settings = {};</span>
<a href="#l18.11"></a><span id="l18.11">     let requiresFetch = true;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    settings.title = (tempTitle || calGetString(&quot;calendar&quot;, &quot;Untitled&quot;));</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    settings.title = tempTitle || calGetString(&quot;calendar&quot;, &quot;Untitled&quot;);</span>
<a href="#l18.14"></a><span id="l18.14">     settings.layoutCId = document.getElementById(&quot;layout-field&quot;).value;</span>
<a href="#l18.15"></a><span id="l18.15">     settings.start = null;</span>
<a href="#l18.16"></a><span id="l18.16">     settings.end = null;</span>
<a href="#l18.17"></a><span id="l18.17">     settings.eventList = [];</span>
<a href="#l18.18"></a><span id="l18.18">     settings.printEvents = document.getElementById(&quot;events&quot;).checked;</span>
<a href="#l18.19"></a><span id="l18.19">     settings.printTasks = document.getElementById(&quot;tasks&quot;).checked;</span>
<a href="#l18.20"></a><span id="l18.20">     settings.printCompletedTasks = document.getElementById(&quot;completed-tasks&quot;).checked;</span>
<a href="#l18.21"></a><span id="l18.21">     settings.printTasksWithNoDueDate = document.getElementById(&quot;tasks-with-no-due-date&quot;).checked;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-properties-dialog.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-properties-dialog.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -27,23 +27,23 @@ function onLoad() {</span>
<a href="#l19.4"></a><span id="l19.4">     document.getElementById(&quot;read-only&quot;).checked = gCalendar.readOnly;</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6">     // Set up refresh interval</span>
<a href="#l19.7"></a><span id="l19.7">     initRefreshInterval();</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">     // Set up the cache field</span>
<a href="#l19.10"></a><span id="l19.10">     let cacheBox = document.getElementById(&quot;cache&quot;);</span>
<a href="#l19.11"></a><span id="l19.11">     let canCache = (gCalendar.getProperty(&quot;cache.supported&quot;) !== false);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    let alwaysCache = (gCalendar.getProperty(&quot;cache.always&quot;));</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    let alwaysCache = gCalendar.getProperty(&quot;cache.always&quot;);</span>
<a href="#l19.14"></a><span id="l19.14">     if (!canCache || alwaysCache) {</span>
<a href="#l19.15"></a><span id="l19.15">         cacheBox.setAttribute(&quot;disable-capability&quot;, &quot;true&quot;);</span>
<a href="#l19.16"></a><span id="l19.16">         cacheBox.hidden = true;</span>
<a href="#l19.17"></a><span id="l19.17">         cacheBox.disabled = true;</span>
<a href="#l19.18"></a><span id="l19.18">     }</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-    cacheBox.checked = (alwaysCache || (canCache &amp;&amp; gCalendar.getProperty(&quot;cache.enabled&quot;)));</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+    cacheBox.checked = alwaysCache || (canCache &amp;&amp; gCalendar.getProperty(&quot;cache.enabled&quot;));</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22">     // Set up the show alarms row and checkbox</span>
<a href="#l19.23"></a><span id="l19.23">     let suppressAlarmsRow = document.getElementById(&quot;calendar-suppressAlarms-row&quot;);</span>
<a href="#l19.24"></a><span id="l19.24">     let suppressAlarms = gCalendar.getProperty('suppressAlarms');</span>
<a href="#l19.25"></a><span id="l19.25">     document.getElementById(&quot;fire-alarms&quot;).checked = !suppressAlarms;</span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27">     suppressAlarmsRow.hidden =</span>
<a href="#l19.28"></a><span id="l19.28">         (gCalendar.getProperty(&quot;capabilities.alarms.popup.supported&quot;) === false);</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineat">@@ -88,17 +88,17 @@ function onAcceptDialog() {</span>
<a href="#l19.30"></a><span id="l19.30"> </span>
<a href="#l19.31"></a><span id="l19.31">     // Save refresh interval</span>
<a href="#l19.32"></a><span id="l19.32">     if (gCalendar.canRefresh) {</span>
<a href="#l19.33"></a><span id="l19.33">         let value = getElementValue(&quot;calendar-refreshInterval-menulist&quot;);</span>
<a href="#l19.34"></a><span id="l19.34">         gCalendar.setProperty(&quot;refreshInterval&quot;, value);</span>
<a href="#l19.35"></a><span id="l19.35">     }</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37">     // Save cache options</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">-    let alwaysCache = (gCalendar.getProperty(&quot;cache.always&quot;));</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+    let alwaysCache = gCalendar.getProperty(&quot;cache.always&quot;);</span>
<a href="#l19.40"></a><span id="l19.40">     if (!alwaysCache) {</span>
<a href="#l19.41"></a><span id="l19.41">         gCalendar.setProperty(&quot;cache.enabled&quot;, document.getElementById(&quot;cache&quot;).checked);</span>
<a href="#l19.42"></a><span id="l19.42">     }</span>
<a href="#l19.43"></a><span id="l19.43"> </span>
<a href="#l19.44"></a><span id="l19.44">     if (!gCalendar.getProperty(&quot;force-disabled&quot;)) {</span>
<a href="#l19.45"></a><span id="l19.45">         // Save disabled option (should do this last), remove auto-enabled</span>
<a href="#l19.46"></a><span id="l19.46">         gCalendar.setProperty(&quot;disabled&quot;, !document.getElementById(&quot;calendar-enabled-checkbox&quot;).checked);</span>
<a href="#l19.47"></a><span id="l19.47">         gCalendar.deleteProperty(&quot;auto-enabled&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/today-pane.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/today-pane.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -70,24 +70,24 @@ var TodayPane = {</span>
<a href="#l20.4"></a><span id="l20.4">             agendaIsVisible = true;</span>
<a href="#l20.5"></a><span id="l20.5">             document.getElementById(&quot;agenda-panel&quot;).setVisible(agendaIsVisible);</span>
<a href="#l20.6"></a><span id="l20.6">             index = 2;</span>
<a href="#l20.7"></a><span id="l20.7">         }</span>
<a href="#l20.8"></a><span id="l20.8">         let todayHeader = document.getElementById(&quot;today-pane-header&quot;);</span>
<a href="#l20.9"></a><span id="l20.9">         todayHeader.setAttribute(&quot;index&quot;, index);</span>
<a href="#l20.10"></a><span id="l20.10">         todayHeader.setAttribute(&quot;value&quot;, this.paneViews[index]);</span>
<a href="#l20.11"></a><span id="l20.11">         let todayPaneSplitter = document.getElementById(&quot;today-pane-splitter&quot;);</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-        setBooleanAttribute(todayPaneSplitter, &quot;hidden&quot;, (index != 0));</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+        setBooleanAttribute(todayPaneSplitter, &quot;hidden&quot;, index != 0);</span>
<a href="#l20.14"></a><span id="l20.14">         let todayIsVisible = document.getElementById(&quot;today-pane-panel&quot;).isVisible();</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16">         // Disable or enable the today pane menuitems that have an attribute</span>
<a href="#l20.17"></a><span id="l20.17">         // name=&quot;minidisplay&quot; depending on the visibility of elements.</span>
<a href="#l20.18"></a><span id="l20.18">         let menu = document.getElementById(&quot;ltnTodayPaneMenuPopup&quot;);</span>
<a href="#l20.19"></a><span id="l20.19">         if (menu) {</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-            setAttributeToChildren(menu, &quot;disabled&quot;, (!todayIsVisible || !agendaIsVisible), &quot;name&quot;, &quot;minidisplay&quot;);</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+            setAttributeToChildren(menu, &quot;disabled&quot;, !todayIsVisible || !agendaIsVisible, &quot;name&quot;, &quot;minidisplay&quot;);</span>
<a href="#l20.22"></a><span id="l20.22">         }</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24">         onCalendarViewResize();</span>
<a href="#l20.25"></a><span id="l20.25">     },</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27">     /**</span>
<a href="#l20.28"></a><span id="l20.28">      * Sets up the miniday display in the today pane.</span>
<a href="#l20.29"></a><span id="l20.29">      */</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineat">@@ -384,17 +384,17 @@ var TodayPane = {</span>
<a href="#l20.31"></a><span id="l20.31">             this.setDay(this.start);</span>
<a href="#l20.32"></a><span id="l20.32">         }</span>
<a href="#l20.33"></a><span id="l20.33">     },</span>
<a href="#l20.34"></a><span id="l20.34"> </span>
<a href="#l20.35"></a><span id="l20.35">     /**</span>
<a href="#l20.36"></a><span id="l20.36">      * Checks if the today pane is showing today's date.</span>
<a href="#l20.37"></a><span id="l20.37">      */</span>
<a href="#l20.38"></a><span id="l20.38">     showsToday: function showsToday() {</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-        return (cal.sameDay(cal.now(), this.start));</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+        return cal.sameDay(cal.now(), this.start);</span>
<a href="#l20.41"></a><span id="l20.41">     },</span>
<a href="#l20.42"></a><span id="l20.42"> </span>
<a href="#l20.43"></a><span id="l20.43">     /**</span>
<a href="#l20.44"></a><span id="l20.44">      * Update the period headers in the agenda listbox using the today pane's</span>
<a href="#l20.45"></a><span id="l20.45">      * start date.</span>
<a href="#l20.46"></a><span id="l20.46">      */</span>
<a href="#l20.47"></a><span id="l20.47">     updatePeriod: function updatePeriod() {</span>
<a href="#l20.48"></a><span id="l20.48">         agendaListbox.refreshPeriodDates(this.start.clone());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -60,18 +60,18 @@</span>
<a href="#l21.4"></a><span id="l21.4">           // Setting calendars externally is not wanted. This is done internally</span>
<a href="#l21.5"></a><span id="l21.5">           // in the compositeCalendar setter.</span>
<a href="#l21.6"></a><span id="l21.6">           throw Components.Exception(&quot;Seting calendars on type='full' is not supported&quot;,</span>
<a href="#l21.7"></a><span id="l21.7">                                      Components.results.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l21.8"></a><span id="l21.8">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l21.9"></a><span id="l21.9">       &lt;/property&gt;</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11">       &lt;field name=&quot;calMgrObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      ({ listTree: this,</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+      ({</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+        listTree: this,</span>
<a href="#l21.16"></a><span id="l21.16">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICalendarManagerObserver]),</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18">         // calICalendarManagerObserver</span>
<a href="#l21.19"></a><span id="l21.19">         onCalendarRegistered: function cMO_onCalendarRegistered(aCalendar) {</span>
<a href="#l21.20"></a><span id="l21.20">             this.listTree.addCalendar(aCalendar);</span>
<a href="#l21.21"></a><span id="l21.21">             let composite = this.listTree.compositeCalendar;</span>
<a href="#l21.22"></a><span id="l21.22">             let inComposite = aCalendar.getProperty(composite.prefPrefix +</span>
<a href="#l21.23"></a><span id="l21.23">                                                     &quot;-in-composite&quot;);</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineat">@@ -88,18 +88,18 @@</span>
<a href="#l21.25"></a><span id="l21.25">             // Now that the calendar is unregistered, update the commands to</span>
<a href="#l21.26"></a><span id="l21.26">             // make sure that New Event/Task commands are correctly</span>
<a href="#l21.27"></a><span id="l21.27">             // enabled/disabled.</span>
<a href="#l21.28"></a><span id="l21.28">             document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l21.29"></a><span id="l21.29">         }</span>
<a href="#l21.30"></a><span id="l21.30">       })</span>
<a href="#l21.31"></a><span id="l21.31">       ]]&gt;&lt;/field&gt;</span>
<a href="#l21.32"></a><span id="l21.32">       &lt;field name=&quot;compositeObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-      ({ listTree: this,</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+      ({</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+        listTree: this,</span>
<a href="#l21.37"></a><span id="l21.37">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICompositeObserver,</span>
<a href="#l21.38"></a><span id="l21.38">                                                Components.interfaces.calIObserver]),</span>
<a href="#l21.39"></a><span id="l21.39"> </span>
<a href="#l21.40"></a><span id="l21.40">         // calICompositeObserver</span>
<a href="#l21.41"></a><span id="l21.41">         onCalendarAdded: function onCalendarAdded(aCalendar) {</span>
<a href="#l21.42"></a><span id="l21.42">             // Make sure the checkbox state is updated</span>
<a href="#l21.43"></a><span id="l21.43">             this.listTree.updateCalendar(aCalendar);</span>
<a href="#l21.44"></a><span id="l21.44">         },</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineat">@@ -248,18 +248,18 @@</span>
<a href="#l21.46"></a><span id="l21.46">         this.calObserver.listTree = null;</span>
<a href="#l21.47"></a><span id="l21.47"> </span>
<a href="#l21.48"></a><span id="l21.48">         if (this.mCompositeCalendar) {</span>
<a href="#l21.49"></a><span id="l21.49">             this.mCompositeCalendar.removeObserver(this.compositeObserver);</span>
<a href="#l21.50"></a><span id="l21.50">         }</span>
<a href="#l21.51"></a><span id="l21.51">       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l21.52"></a><span id="l21.52"> </span>
<a href="#l21.53"></a><span id="l21.53">       &lt;field name=&quot;calObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-      ({ listTree: this,</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+      ({</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+        listTree: this,</span>
<a href="#l21.58"></a><span id="l21.58">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIObserver]),</span>
<a href="#l21.59"></a><span id="l21.59"> </span>
<a href="#l21.60"></a><span id="l21.60">         // calIObserver. Note that each registered calendar uses this observer</span>
<a href="#l21.61"></a><span id="l21.61">         onStartBatch: function cMO_onStartBatch() { },</span>
<a href="#l21.62"></a><span id="l21.62">         onEndBatch: function cMO_onEndBatch() { },</span>
<a href="#l21.63"></a><span id="l21.63">         onLoad: function cMO_onLoad() { },</span>
<a href="#l21.64"></a><span id="l21.64"> </span>
<a href="#l21.65"></a><span id="l21.65">         onAddItem: function cMO_onAddItem(aItem) { },</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineat">@@ -294,18 +294,18 @@</span>
<a href="#l21.67"></a><span id="l21.67">             // but should not be the same as the value, set it to a different</span>
<a href="#l21.68"></a><span id="l21.68">             // value.</span>
<a href="#l21.69"></a><span id="l21.69">             this.onPropertyChanged(aCalendar, aName, null, null);</span>
<a href="#l21.70"></a><span id="l21.70">         }</span>
<a href="#l21.71"></a><span id="l21.71">       })</span>
<a href="#l21.72"></a><span id="l21.72">       ]]&gt;&lt;/field&gt;</span>
<a href="#l21.73"></a><span id="l21.73"> </span>
<a href="#l21.74"></a><span id="l21.74">       &lt;field name=&quot;compositeObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineminus">-      ({ listTree: this,</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineminus">-</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineplus">+      ({</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineplus">+        listTree: this,</span>
<a href="#l21.79"></a><span id="l21.79">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICompositeObserver]),</span>
<a href="#l21.80"></a><span id="l21.80"> </span>
<a href="#l21.81"></a><span id="l21.81">         // calICompositeObserver</span>
<a href="#l21.82"></a><span id="l21.82">         onCalendarAdded: function onCalendarAdded(aCalendar) {</span>
<a href="#l21.83"></a><span id="l21.83">             // Make sure the checkbox state is updated</span>
<a href="#l21.84"></a><span id="l21.84">             this.listTree.updateCalendar(aCalendar);</span>
<a href="#l21.85"></a><span id="l21.85">         },</span>
<a href="#l21.86"></a><span id="l21.86"> </span>
<a href="#l21.87"></a><span id="l21.87" class="difflineat">@@ -403,17 +403,18 @@</span>
<a href="#l21.88"></a><span id="l21.88">           let event = document.createEvent('Events');</span>
<a href="#l21.89"></a><span id="l21.89">           event.initEvent(&quot;SortOrderChanged&quot;, true, false);</span>
<a href="#l21.90"></a><span id="l21.90">           event.sortOrder = this.sortOrder;</span>
<a href="#l21.91"></a><span id="l21.91">           this.dispatchEvent(event);</span>
<a href="#l21.92"></a><span id="l21.92"> </span>
<a href="#l21.93"></a><span id="l21.93">           let handler = this.getAttribute(&quot;onSortOrderChanged&quot;);</span>
<a href="#l21.94"></a><span id="l21.94">           if (handler) {</span>
<a href="#l21.95"></a><span id="l21.95">               // Call the given code in a function</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineminus">-              (new Function(&quot;event&quot;, handler))(event);</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineplus">+              let func = new Function(&quot;event&quot;, handler);</span>
<a href="#l21.98"></a><span id="l21.98" class="difflineplus">+              func(event);</span>
<a href="#l21.99"></a><span id="l21.99">           }</span>
<a href="#l21.100"></a><span id="l21.100">         ]]&gt;&lt;/body&gt;</span>
<a href="#l21.101"></a><span id="l21.101">       &lt;/method&gt;</span>
<a href="#l21.102"></a><span id="l21.102">       &lt;method name=&quot;displayScrollbarSpacer&quot;&gt;</span>
<a href="#l21.103"></a><span id="l21.103">         &lt;parameter name=&quot;aShouldDisplay&quot;/&gt;</span>
<a href="#l21.104"></a><span id="l21.104">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.105"></a><span id="l21.105">             let spacer = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;scrollbar-spacer&quot;);</span>
<a href="#l21.106"></a><span id="l21.106">             spacer.collapsed = !aShouldDisplay;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -341,17 +341,17 @@</span>
<a href="#l22.4"></a><span id="l22.4">             if (!this.isVisibleInMode(lMode)) {</span>
<a href="#l22.5"></a><span id="l22.5">                 return false;</span>
<a href="#l22.6"></a><span id="l22.6">             }</span>
<a href="#l22.7"></a><span id="l22.7">             let collapsedModes = this.getAttribute(&quot;collapsedinmodes&quot;).split(&quot;,&quot;);</span>
<a href="#l22.8"></a><span id="l22.8">             return (!collapsedModes.includes(lMode));</span>
<a href="#l22.9"></a><span id="l22.9">         ]]&gt;&lt;/body&gt;</span>
<a href="#l22.10"></a><span id="l22.10">       &lt;/method&gt;</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-      &lt;method name=&quot;setModeAttribute&quot;&gt; </span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+      &lt;method name=&quot;setModeAttribute&quot;&gt;</span>
<a href="#l22.14"></a><span id="l22.14">         &lt;parameter name=&quot;aModeAttribute&quot;/&gt;</span>
<a href="#l22.15"></a><span id="l22.15">         &lt;parameter name=&quot;aModeValue&quot;/&gt;</span>
<a href="#l22.16"></a><span id="l22.16">         &lt;parameter name=&quot;amode&quot;/&gt;</span>
<a href="#l22.17"></a><span id="l22.17">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l22.18"></a><span id="l22.18">             if (this.hasAttribute(aModeAttribute)) {</span>
<a href="#l22.19"></a><span id="l22.19">                 let lMode = amode || this.currentMode;</span>
<a href="#l22.20"></a><span id="l22.20">                 let modeAttributeValues = this.getAttribute(aModeAttribute).split(&quot;,&quot;);</span>
<a href="#l22.21"></a><span id="l22.21">                 let modes = this.getAttribute(&quot;mode&quot;).split(&quot;,&quot;);</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineat">@@ -377,33 +377,33 @@</span>
<a href="#l22.23"></a><span id="l22.23">         ]]&gt;&lt;/body&gt;</span>
<a href="#l22.24"></a><span id="l22.24">       &lt;/method&gt;</span>
<a href="#l22.25"></a><span id="l22.25"> </span>
<a href="#l22.26"></a><span id="l22.26">       &lt;method name=&quot;setVisible&quot;&gt;</span>
<a href="#l22.27"></a><span id="l22.27">         &lt;parameter name=&quot;aVisible&quot;/&gt;</span>
<a href="#l22.28"></a><span id="l22.28">         &lt;parameter name=&quot;aPushModeCollapsedAttribute&quot;/&gt;</span>
<a href="#l22.29"></a><span id="l22.29">         &lt;parameter name=&quot;aNotifyRefControl&quot;/&gt;</span>
<a href="#l22.30"></a><span id="l22.30">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-            let notifyRefControl = ((aNotifyRefControl == null) || (aNotifyRefControl === true));</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+            let notifyRefControl = aNotifyRefControl == null || aNotifyRefControl === true;</span>
<a href="#l22.33"></a><span id="l22.33">             let pushModeCollapsedAttribute = aPushModeCollapsedAttribute == null ||</span>
<a href="#l22.34"></a><span id="l22.34">                                              aPushModeCollapsedAttribute === true;</span>
<a href="#l22.35"></a><span id="l22.35">             let collapsedModes = [];</span>
<a href="#l22.36"></a><span id="l22.36">             let modeIndex = -1;</span>
<a href="#l22.37"></a><span id="l22.37">             let display = aVisible;</span>
<a href="#l22.38"></a><span id="l22.38">             let collapsedInMode = false;</span>
<a href="#l22.39"></a><span id="l22.39">             if (this.hasAttribute(&quot;collapsedinmodes&quot;)) {</span>
<a href="#l22.40"></a><span id="l22.40">                 collapsedModes = this.getAttribute(&quot;collapsedinmodes&quot;).split(&quot;,&quot;);</span>
<a href="#l22.41"></a><span id="l22.41">                 modeIndex = collapsedModes.indexOf(this.currentMode);</span>
<a href="#l22.42"></a><span id="l22.42">                 collapsedInMode = (modeIndex &gt; -1);</span>
<a href="#l22.43"></a><span id="l22.43">             }</span>
<a href="#l22.44"></a><span id="l22.44">             if ((aVisible === true) &amp;&amp; (pushModeCollapsedAttribute == false)) {</span>
<a href="#l22.45"></a><span id="l22.45">                 display = (aVisible === true) &amp;&amp; (!collapsedInMode);</span>
<a href="#l22.46"></a><span id="l22.46">             }</span>
<a href="#l22.47"></a><span id="l22.47"> </span>
<a href="#l22.48"></a><span id="l22.48" class="difflineminus">-            setBooleanAttribute(this, &quot;collapsed&quot;, (!display || !this.isVisibleInMode()));</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineplus">+            setBooleanAttribute(this, &quot;collapsed&quot;, !display || !this.isVisibleInMode());</span>
<a href="#l22.50"></a><span id="l22.50">             if (pushModeCollapsedAttribute) {</span>
<a href="#l22.51"></a><span id="l22.51">                 if (!display) {</span>
<a href="#l22.52"></a><span id="l22.52">                     if (modeIndex == -1) {</span>
<a href="#l22.53"></a><span id="l22.53">                         collapsedModes.push(this.currentMode);</span>
<a href="#l22.54"></a><span id="l22.54">                         if (this.getAttribute(&quot;collapsedinmodes&quot;) == &quot;,&quot;) {</span>
<a href="#l22.55"></a><span id="l22.55">                             collapsedModes.splice(0, 2);</span>
<a href="#l22.56"></a><span id="l22.56">                         }</span>
<a href="#l22.57"></a><span id="l22.57">                     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -184,31 +184,31 @@</span>
<a href="#l23.4"></a><span id="l23.4">          ]]&gt;&lt;/body&gt;</span>
<a href="#l23.5"></a><span id="l23.5">        &lt;/method&gt;</span>
<a href="#l23.6"></a><span id="l23.6">        &lt;method name=&quot;updateMonthPopup&quot;&gt;</span>
<a href="#l23.7"></a><span id="l23.7">          &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l23.8"></a><span id="l23.8">          &lt;body&gt;&lt;![CDATA[</span>
<a href="#l23.9"></a><span id="l23.9">            let months = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;months-popup&quot;).firstChild.childNodes;</span>
<a href="#l23.10"></a><span id="l23.10">            let month = aDate.getMonth();</span>
<a href="#l23.11"></a><span id="l23.11">            for (let i = 0; i &lt; months.length; i++) {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-               months[i].setAttribute(&quot;current&quot;, (i == month) ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+               months[i].setAttribute(&quot;current&quot;, i == month ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l23.14"></a><span id="l23.14">            }</span>
<a href="#l23.15"></a><span id="l23.15">          ]]&gt;&lt;/body&gt;</span>
<a href="#l23.16"></a><span id="l23.16">        &lt;/method&gt;</span>
<a href="#l23.17"></a><span id="l23.17">        &lt;method name=&quot;updateYearPopup&quot;&gt;</span>
<a href="#l23.18"></a><span id="l23.18">          &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l23.19"></a><span id="l23.19">          &lt;body&gt;&lt;![CDATA[</span>
<a href="#l23.20"></a><span id="l23.20">            let years = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;).firstChild.childNodes;</span>
<a href="#l23.21"></a><span id="l23.21">            let year = new Date(aDate);</span>
<a href="#l23.22"></a><span id="l23.22">            let compFullYear = aDate.getFullYear();</span>
<a href="#l23.23"></a><span id="l23.23">            year.setFullYear(Math.max(1, compFullYear - Math.trunc(years.length / 2) + 1));</span>
<a href="#l23.24"></a><span id="l23.24">            for (let i = 1; i &lt; years.length - 1; i++) {</span>
<a href="#l23.25"></a><span id="l23.25">                let curfullYear = year.getFullYear();</span>
<a href="#l23.26"></a><span id="l23.26">                years[i].setAttribute(&quot;value&quot;, curfullYear);</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">-               years[i].setAttribute(&quot;current&quot;, (curfullYear == compFullYear) ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineplus">+               years[i].setAttribute(&quot;current&quot;, curfullYear == compFullYear ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l23.29"></a><span id="l23.29">                year.setFullYear(curfullYear + 1);</span>
<a href="#l23.30"></a><span id="l23.30">            }</span>
<a href="#l23.31"></a><span id="l23.31">          ]]&gt;&lt;/body&gt;</span>
<a href="#l23.32"></a><span id="l23.32">        &lt;/method&gt;</span>
<a href="#l23.33"></a><span id="l23.33"> </span>
<a href="#l23.34"></a><span id="l23.34">        &lt;method name=&quot;scrollYears&quot;&gt;</span>
<a href="#l23.35"></a><span id="l23.35">          &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l23.36"></a><span id="l23.36">          &lt;body&gt;&lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/modules/calAlarmUtils.jsm</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/modules/calAlarmUtils.jsm</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -33,19 +33,19 @@ cal.alarms = {</span>
<a href="#l24.4"></a><span id="l24.4">                 // You can't have an alarm if the entryDate doesn't exist.</span>
<a href="#l24.5"></a><span id="l24.5">                 aItem.entryDate = cal.now();</span>
<a href="#l24.6"></a><span id="l24.6">             }</span>
<a href="#l24.7"></a><span id="l24.7">             alarm.related = Components.interfaces.calIAlarm.ALARM_RELATED_START;</span>
<a href="#l24.8"></a><span id="l24.8">             alarm.offset = alarmOffset;</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10">             // Default to a display alarm, unless the calendar doesn't support</span>
<a href="#l24.11"></a><span id="l24.11">             // it or we have no calendar yet. (Man this is hard to wrap)</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-            let actionValues = ((aItem.calendar &amp;&amp;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+            let actionValues = (aItem.calendar &amp;&amp;</span>
<a href="#l24.14"></a><span id="l24.14">                                  aItem.calendar.getProperty(&quot;capabilities.alarms.actionValues&quot;)) ||</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-                                [&quot;DISPLAY&quot;]);</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+                                [&quot;DISPLAY&quot;];</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18">             alarm.action = (actionValues.includes(&quot;DISPLAY&quot;) ? &quot;DISPLAY&quot; : actionValues[0]);</span>
<a href="#l24.19"></a><span id="l24.19">             aItem.addAlarm(alarm);</span>
<a href="#l24.20"></a><span id="l24.20">         }</span>
<a href="#l24.21"></a><span id="l24.21">     },</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23">     /**</span>
<a href="#l24.24"></a><span id="l24.24">      * Calculate the alarm date for a calIAlarm.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -107,19 +107,19 @@ cal.itip = {</span>
<a href="#l25.4"></a><span id="l25.4">     /**</span>
<a href="#l25.5"></a><span id="l25.5">      * Checks if the given calendar is a scheduling calendar. This means it</span>
<a href="#l25.6"></a><span id="l25.6">      * needs an organizer id and an itip transport. It should also be writable.</span>
<a href="#l25.7"></a><span id="l25.7">      *</span>
<a href="#l25.8"></a><span id="l25.8">      * @param calendar    The calendar to check</span>
<a href="#l25.9"></a><span id="l25.9">      * @return            True, if its a scheduling calendar.</span>
<a href="#l25.10"></a><span id="l25.10">      */</span>
<a href="#l25.11"></a><span id="l25.11">     isSchedulingCalendar: function isSchedulingCalendar(calendar) {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        return (cal.isCalendarWritable(calendar) &amp;&amp;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-                calendar.getProperty(&quot;organizerId&quot;) &amp;&amp;</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-                calendar.getProperty(&quot;itip.transport&quot;));</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+        return cal.isCalendarWritable(calendar) &amp;&amp;</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+               calendar.getProperty(&quot;organizerId&quot;) &amp;&amp;</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+               calendar.getProperty(&quot;itip.transport&quot;);</span>
<a href="#l25.18"></a><span id="l25.18">     },</span>
<a href="#l25.19"></a><span id="l25.19"> </span>
<a href="#l25.20"></a><span id="l25.20">     /**</span>
<a href="#l25.21"></a><span id="l25.21">      * Scope: iTIP message receiver</span>
<a href="#l25.22"></a><span id="l25.22">      *</span>
<a href="#l25.23"></a><span id="l25.23">      * Given an nsIMsgDBHdr and an imipMethod, set up the given itip item.</span>
<a href="#l25.24"></a><span id="l25.24">      *</span>
<a href="#l25.25"></a><span id="l25.25">      * @param itipItem    The item to set up</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineat">@@ -466,17 +466,17 @@ cal.itip = {</span>
<a href="#l25.27"></a><span id="l25.27">                                    &quot;_blank&quot;, &quot;chrome,titlebar,modal,resizable&quot;, args);</span>
<a href="#l25.28"></a><span id="l25.28">             }</span>
<a href="#l25.29"></a><span id="l25.29"> </span>
<a href="#l25.30"></a><span id="l25.30">             if (targetCalendar) {</span>
<a href="#l25.31"></a><span id="l25.31">                 aItipItem.targetCalendar = targetCalendar;</span>
<a href="#l25.32"></a><span id="l25.32">             }</span>
<a href="#l25.33"></a><span id="l25.33">         }</span>
<a href="#l25.34"></a><span id="l25.34"> </span>
<a href="#l25.35"></a><span id="l25.35" class="difflineminus">-        return (!needsCalendar || targetCalendar != null);</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+        return !needsCalendar || targetCalendar != null;</span>
<a href="#l25.37"></a><span id="l25.37">     },</span>
<a href="#l25.38"></a><span id="l25.38"> </span>
<a href="#l25.39"></a><span id="l25.39">     /**</span>
<a href="#l25.40"></a><span id="l25.40">      * Clean up after the given iTIP item. This needs to be called once for each</span>
<a href="#l25.41"></a><span id="l25.41">      * time processItipItem is called. May be called with a null itipItem in</span>
<a href="#l25.42"></a><span id="l25.42">      * which case it will do nothing.</span>
<a href="#l25.43"></a><span id="l25.43">      *</span>
<a href="#l25.44"></a><span id="l25.44">      * @param itipItem      The iTIP item to clean up for.</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineat">@@ -563,19 +563,19 @@ cal.itip = {</span>
<a href="#l25.46"></a><span id="l25.46">                 let exdates = [];</span>
<a href="#l25.47"></a><span id="l25.47">                 for (let ritem of clonedItem.recurrenceInfo.getRecurrenceItems({})) {</span>
<a href="#l25.48"></a><span id="l25.48">                     let wrappedRItem = cal.wrapInstance(ritem, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l25.49"></a><span id="l25.49">                     if (ritem.isNegative &amp;&amp;</span>
<a href="#l25.50"></a><span id="l25.50">                         wrappedRItem &amp;&amp;</span>
<a href="#l25.51"></a><span id="l25.51">                         !aOriginalItem.recurrenceInfo.getRecurrenceItems({}).some(</span>
<a href="#l25.52"></a><span id="l25.52">                             function(r) {</span>
<a href="#l25.53"></a><span id="l25.53">                                 let wrappedR = cal.wrapInstance(r, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineminus">-                                return (r.isNegative &amp;&amp;</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-                                        wrappedR &amp;&amp;</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineminus">-                                        wrappedR.date.compare(wrappedRItem.date) == 0);</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineplus">+                                return r.isNegative &amp;&amp;</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineplus">+                                       wrappedR &amp;&amp;</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineplus">+                                       wrappedR.date.compare(wrappedRItem.date) == 0;</span>
<a href="#l25.60"></a><span id="l25.60">                             })) {</span>
<a href="#l25.61"></a><span id="l25.61">                         exdates.push(wrappedRItem);</span>
<a href="#l25.62"></a><span id="l25.62">                     }</span>
<a href="#l25.63"></a><span id="l25.63">                 }</span>
<a href="#l25.64"></a><span id="l25.64">                 if (exdates.length &gt; 0) {</span>
<a href="#l25.65"></a><span id="l25.65">                     // check whether really only EXDATEs have been added:</span>
<a href="#l25.66"></a><span id="l25.66">                     let recInfo = clonedItem.recurrenceInfo;</span>
<a href="#l25.67"></a><span id="l25.67">                     exdates.forEach(recInfo.deleteRecurrenceItem, recInfo);</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineat">@@ -834,33 +834,32 @@ cal.itip = {</span>
<a href="#l25.69"></a><span id="l25.69">     /**</span>
<a href="#l25.70"></a><span id="l25.70">      * Returns a copy of an itipItem with modified properties and items build from scratch</span>
<a href="#l25.71"></a><span id="l25.71">      * Use itipItem.clone() instead if only a simple copy is required</span>
<a href="#l25.72"></a><span id="l25.72">      *</span>
<a href="#l25.73"></a><span id="l25.73">      * @param aItipItem     ItipItem to derive a new one from</span>
<a href="#l25.74"></a><span id="l25.74">      * @param aItems        List of items to be contained in the new itipItem</span>
<a href="#l25.75"></a><span id="l25.75">      * @param aProps        List of properties to be different in the new itipItem</span>
<a href="#l25.76"></a><span id="l25.76">      */</span>
<a href="#l25.77"></a><span id="l25.77" class="difflineminus">-    getModifiedItipItem: function cal_getModifiedItipItem(aItipItem, aItems, aProps) {</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineplus">+    getModifiedItipItem: function cal_getModifiedItipItem(aItipItem, aItems=[], aProps={}) {</span>
<a href="#l25.79"></a><span id="l25.79">         let itipItem = Components.classes[&quot;@mozilla.org/calendar/itip-item;1&quot;]</span>
<a href="#l25.80"></a><span id="l25.80">                                  .createInstance(Components.interfaces.calIItipItem);</span>
<a href="#l25.81"></a><span id="l25.81">         let serializedItems = &quot;&quot;;</span>
<a href="#l25.82"></a><span id="l25.82" class="difflineminus">-        for (let item of (aItems || [])) {</span>
<a href="#l25.83"></a><span id="l25.83" class="difflineplus">+        for (let item of aItems) {</span>
<a href="#l25.84"></a><span id="l25.84">             serializedItems += cal.getSerializedItem(item);</span>
<a href="#l25.85"></a><span id="l25.85">         }</span>
<a href="#l25.86"></a><span id="l25.86">         itipItem.init(serializedItems);</span>
<a href="#l25.87"></a><span id="l25.87"> </span>
<a href="#l25.88"></a><span id="l25.88" class="difflineminus">-        let props = aProps || {};</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineminus">-        itipItem.autoResponse = (&quot;autoResponse&quot; in props) ? props.autoResponse : aItipItem.autoResponse;</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineminus">-        itipItem.identity = (&quot;identity&quot; in props) ? props.identity : aItipItem.identity;</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineminus">-        itipItem.isSend = (&quot;isSend&quot; in props) ? props.isSend : aItipItem.isSend;</span>
<a href="#l25.92"></a><span id="l25.92" class="difflineminus">-        itipItem.localStatus = (&quot;localStatus&quot; in props) ? props.localStatus : aItipItem.localStatus;</span>
<a href="#l25.93"></a><span id="l25.93" class="difflineminus">-        itipItem.receivedMethod = (&quot;receivedMethod&quot; in props) ? props.receivedMethod : aItipItem.receivedMethod;</span>
<a href="#l25.94"></a><span id="l25.94" class="difflineminus">-        itipItem.responseMethod = (&quot;responseMethod&quot; in props) ? props.responseMethod : aItipItem.responseMethod;</span>
<a href="#l25.95"></a><span id="l25.95" class="difflineminus">-        itipItem.targetCalendar = (&quot;targetCalendar&quot; in props) ? properties.targetCalendar : aItipItem.targetCalendar;</span>
<a href="#l25.96"></a><span id="l25.96" class="difflineplus">+        itipItem.autoResponse = (&quot;autoResponse&quot; in aProps) ? aProps.autoResponse : aItipItem.autoResponse;</span>
<a href="#l25.97"></a><span id="l25.97" class="difflineplus">+        itipItem.identity = (&quot;identity&quot; in aProps) ? aProps.identity : aItipItem.identity;</span>
<a href="#l25.98"></a><span id="l25.98" class="difflineplus">+        itipItem.isSend = (&quot;isSend&quot; in aProps) ? aProps.isSend : aItipItem.isSend;</span>
<a href="#l25.99"></a><span id="l25.99" class="difflineplus">+        itipItem.localStatus = (&quot;localStatus&quot; in aProps) ? aProps.localStatus : aItipItem.localStatus;</span>
<a href="#l25.100"></a><span id="l25.100" class="difflineplus">+        itipItem.receivedMethod = (&quot;receivedMethod&quot; in aProps) ? aProps.receivedMethod : aItipItem.receivedMethod;</span>
<a href="#l25.101"></a><span id="l25.101" class="difflineplus">+        itipItem.responseMethod = (&quot;responseMethod&quot; in aProps) ? aProps.responseMethod : aItipItem.responseMethod;</span>
<a href="#l25.102"></a><span id="l25.102" class="difflineplus">+        itipItem.targetCalendar = (&quot;targetCalendar&quot; in aProps) ? aProps.targetCalendar : aItipItem.targetCalendar;</span>
<a href="#l25.103"></a><span id="l25.103"> </span>
<a href="#l25.104"></a><span id="l25.104">         return itipItem;</span>
<a href="#l25.105"></a><span id="l25.105">     }</span>
<a href="#l25.106"></a><span id="l25.106"> };</span>
<a href="#l25.107"></a><span id="l25.107"> </span>
<a href="#l25.108"></a><span id="l25.108"> /** local to this module file</span>
<a href="#l25.109"></a><span id="l25.109">  * Sets the received info either on the passed attendee or item object.</span>
<a href="#l25.110"></a><span id="l25.110">  *</span>
<a href="#l25.111"></a><span id="l25.111" class="difflineat">@@ -938,17 +937,17 @@ function updateItem(item, itipItemItem) </span>
<a href="#l25.112"></a><span id="l25.112">     if (recInfo) {</span>
<a href="#l25.113"></a><span id="l25.113">         // keep care of installing all overridden items, and mind existing alarms, categories:</span>
<a href="#l25.114"></a><span id="l25.114">         for (let rid of recInfo.getExceptionIds({})) {</span>
<a href="#l25.115"></a><span id="l25.115">             let excItem = recInfo.getExceptionFor(rid).clone();</span>
<a href="#l25.116"></a><span id="l25.116">             cal.ASSERT(excItem, &quot;unexpected!&quot;);</span>
<a href="#l25.117"></a><span id="l25.117">             let newExc = newItem.recurrenceInfo.getOccurrenceFor(rid).clone();</span>
<a href="#l25.118"></a><span id="l25.118">             newExc.icalComponent = excItem.icalComponent;</span>
<a href="#l25.119"></a><span id="l25.119">             setReceivedInfo(newExc, itipItemItem);</span>
<a href="#l25.120"></a><span id="l25.120" class="difflineminus">-            let existingExcItem = (item.recurrenceInfo &amp;&amp; item.recurrenceInfo.getExceptionFor(rid));</span>
<a href="#l25.121"></a><span id="l25.121" class="difflineplus">+            let existingExcItem = item.recurrenceInfo &amp;&amp; item.recurrenceInfo.getExceptionFor(rid);</span>
<a href="#l25.122"></a><span id="l25.122">             if (existingExcItem) {</span>
<a href="#l25.123"></a><span id="l25.123">                 updateUserData(newExc, existingExcItem);</span>
<a href="#l25.124"></a><span id="l25.124">             }</span>
<a href="#l25.125"></a><span id="l25.125">             newItem.recurrenceInfo.modifyException(newExc, true);</span>
<a href="#l25.126"></a><span id="l25.126">         }</span>
<a href="#l25.127"></a><span id="l25.127">     }</span>
<a href="#l25.128"></a><span id="l25.128"> </span>
<a href="#l25.129"></a><span id="l25.129">     return newItem;</span>
<a href="#l25.130"></a><span id="l25.130" class="difflineat">@@ -1020,23 +1019,24 @@ function sendMessage(aItem, aMethod, aRe</span>
<a href="#l25.131"></a><span id="l25.131"> </span>
<a href="#l25.132"></a><span id="l25.132">     let aTransport = aItem.calendar.getProperty(&quot;itip.transport&quot;);</span>
<a href="#l25.133"></a><span id="l25.133">     if (!aTransport) { // can only send if there's a transport for the calendar</span>
<a href="#l25.134"></a><span id="l25.134">         return false;</span>
<a href="#l25.135"></a><span id="l25.135">     }</span>
<a href="#l25.136"></a><span id="l25.136">     aTransport = aTransport.QueryInterface(Components.interfaces.calIItipTransport);</span>
<a href="#l25.137"></a><span id="l25.137"> </span>
<a href="#l25.138"></a><span id="l25.138">     let _sendItem = function(aSendToList, aSendItem) {</span>
<a href="#l25.139"></a><span id="l25.139" class="difflineplus">+        let cIII = Components.interfaces.calIItipItem;</span>
<a href="#l25.140"></a><span id="l25.140">         let itipItem = Components.classes[&quot;@mozilla.org/calendar/itip-item;1&quot;]</span>
<a href="#l25.141"></a><span id="l25.141">                                  .createInstance(Components.interfaces.calIItipItem);</span>
<a href="#l25.142"></a><span id="l25.142">         itipItem.init(cal.getSerializedItem(aSendItem));</span>
<a href="#l25.143"></a><span id="l25.143">         itipItem.responseMethod = aMethod;</span>
<a href="#l25.144"></a><span id="l25.144">         itipItem.targetCalendar = aSendItem.calendar;</span>
<a href="#l25.145"></a><span id="l25.145" class="difflineminus">-        itipItem.autoResponse = ((autoResponse &amp;&amp; autoResponse.value) ? Components.interfaces.calIItipItem.AUTO</span>
<a href="#l25.146"></a><span id="l25.146" class="difflineminus">-                                                                      : Components.interfaces.calIItipItem.USER);</span>
<a href="#l25.147"></a><span id="l25.147" class="difflineplus">+        itipItem.autoResponse = autoResponse &amp;&amp; autoResponse.value ? cIII.calIItipItem.AUTO</span>
<a href="#l25.148"></a><span id="l25.148" class="difflineplus">+                                                                   : cIII.USER;</span>
<a href="#l25.149"></a><span id="l25.149">         if (autoResponse) {</span>
<a href="#l25.150"></a><span id="l25.150">             autoResponse.value = true; // auto every following</span>
<a href="#l25.151"></a><span id="l25.151">         }</span>
<a href="#l25.152"></a><span id="l25.152">         // XXX I don't know whether the below are used at all, since we don't use the itip processor</span>
<a href="#l25.153"></a><span id="l25.153">         itipItem.isSend = true;</span>
<a href="#l25.154"></a><span id="l25.154"> </span>
<a href="#l25.155"></a><span id="l25.155">         return aTransport.sendItems(aSendToList.length, aSendToList, itipItem);</span>
<a href="#l25.156"></a><span id="l25.156">     };</span>
<a href="#l25.157"></a><span id="l25.157" class="difflineat">@@ -1389,17 +1389,17 @@ ItipItemFinder.prototype = {</span>
<a href="#l25.158"></a><span id="l25.158">                                 case &quot;REPLY&quot;: {</span>
<a href="#l25.159"></a><span id="l25.159">                                     let attendees = itipItemItem.getAttendees({});</span>
<a href="#l25.160"></a><span id="l25.160">                                     cal.ASSERT(attendees.length == 1, &quot;invalid number of attendees in REPLY!&quot;);</span>
<a href="#l25.161"></a><span id="l25.161">                                     if (attendees.length &gt; 0 &amp;&amp;</span>
<a href="#l25.162"></a><span id="l25.162">                                         (item.calendar.getProperty(&quot;itip.disableRevisionChecks&quot;) ||</span>
<a href="#l25.163"></a><span id="l25.163">                                          (cal.itip.compare(itipItemItem, item.getAttendeeById(attendees[0].id)) &gt; 0))) {</span>
<a href="#l25.164"></a><span id="l25.164">                                         // accepts REPLYs from previously uninvited attendees:</span>
<a href="#l25.165"></a><span id="l25.165">                                         let newItem = item.clone();</span>
<a href="#l25.166"></a><span id="l25.166" class="difflineminus">-                                        let att = (item.getAttendeeById(attendees[0].id) || attendees[0]);</span>
<a href="#l25.167"></a><span id="l25.167" class="difflineplus">+                                        let att = item.getAttendeeById(attendees[0].id) || attendees[0];</span>
<a href="#l25.168"></a><span id="l25.168">                                         newItem.removeAttendee(att);</span>
<a href="#l25.169"></a><span id="l25.169">                                         att = att.clone();</span>
<a href="#l25.170"></a><span id="l25.170">                                         setReceivedInfo(att, itipItemItem);</span>
<a href="#l25.171"></a><span id="l25.171">                                         att.participationStatus = attendees[0].participationStatus;</span>
<a href="#l25.172"></a><span id="l25.172">                                         newItem.addAttendee(att);</span>
<a href="#l25.173"></a><span id="l25.173"> </span>
<a href="#l25.174"></a><span id="l25.174">                                         // Make sure the provider-specified properties are copied over</span>
<a href="#l25.175"></a><span id="l25.175">                                         copyProviderProperties(this.mItipItem, itipItemItem, newItem);</span>
<a href="#l25.176"></a><span id="l25.176" class="difflineat">@@ -1498,17 +1498,17 @@ ItipItemFinder.prototype = {</span>
<a href="#l25.177"></a><span id="l25.177">                                     cal.ASSERT(att, &quot;no attendee to reply REQUEST!&quot;);</span>
<a href="#l25.178"></a><span id="l25.178">                                     return null;</span>
<a href="#l25.179"></a><span id="l25.179">                                 }</span>
<a href="#l25.180"></a><span id="l25.180">                             } else {</span>
<a href="#l25.181"></a><span id="l25.181">                                 cal.ASSERT(itipItemItem.getAttendees({}).length == 0,</span>
<a href="#l25.182"></a><span id="l25.182">                                            &quot;invalid number of attendees in PUBLISH!&quot;);</span>
<a href="#l25.183"></a><span id="l25.183">                             }</span>
<a href="#l25.184"></a><span id="l25.184">                             return newItem.calendar.addItem(newItem,</span>
<a href="#l25.185"></a><span id="l25.185" class="difflineminus">-                                                            (method == &quot;REQUEST&quot;)</span>
<a href="#l25.186"></a><span id="l25.186" class="difflineplus">+                                                            method == &quot;REQUEST&quot;</span>
<a href="#l25.187"></a><span id="l25.187">                                                             ? new ItipOpListener(opListener, null)</span>
<a href="#l25.188"></a><span id="l25.188">                                                             : opListener);</span>
<a href="#l25.189"></a><span id="l25.189">                         };</span>
<a href="#l25.190"></a><span id="l25.190">                         operations.push(action);</span>
<a href="#l25.191"></a><span id="l25.191">                         break;</span>
<a href="#l25.192"></a><span id="l25.192">                     }</span>
<a href="#l25.193"></a><span id="l25.193">                     case &quot;CANCEL&quot;: // has already been processed</span>
<a href="#l25.194"></a><span id="l25.194">                     case &quot;REPLY&quot;: // item has been previously removed from the calendar</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -403,19 +403,19 @@ calCalendarManager.prototype = {</span>
<a href="#l26.4"></a><span id="l26.4">         let hostAppName = calGetString(&quot;brand&quot;, &quot;brandShortName&quot;, null, &quot;branding&quot;);</span>
<a href="#l26.5"></a><span id="l26.5">         let calAppName = calGetString(&quot;lightning&quot;, &quot;brandShortName&quot;, null, &quot;lightning&quot;);</span>
<a href="#l26.6"></a><span id="l26.6">         let errorBoxTitle = calGetString(&quot;calendar&quot;, &quot;tooNewSchemaErrorBoxTitle&quot;, [calAppName]);</span>
<a href="#l26.7"></a><span id="l26.7">         let errorBoxText = calGetString(&quot;calendar&quot;, &quot;tooNewSchemaErrorBoxTextLightning&quot;, [calAppName, hostAppName]);</span>
<a href="#l26.8"></a><span id="l26.8">         let errorBoxButtonLabel = calGetString(&quot;calendar&quot;, &quot;tooNewSchemaButtonRestart&quot;, [hostAppName]);</span>
<a href="#l26.9"></a><span id="l26.9"> </span>
<a href="#l26.10"></a><span id="l26.10">         let promptSvc = Services.prompt;</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-        let errorBoxButtonFlags = (promptSvc.BUTTON_POS_0 *</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-                                   promptSvc.BUTTON_TITLE_IS_STRING +</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-                                   promptSvc.BUTTON_POS_0_DEFAULT);</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+        let errorBoxButtonFlags = promptSvc.BUTTON_POS_0 *</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+                                  promptSvc.BUTTON_TITLE_IS_STRING +</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+                                  promptSvc.BUTTON_POS_0_DEFAULT;</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19">         promptSvc.confirmEx(null,</span>
<a href="#l26.20"></a><span id="l26.20">                             errorBoxTitle,</span>
<a href="#l26.21"></a><span id="l26.21">                             errorBoxText,</span>
<a href="#l26.22"></a><span id="l26.22">                             errorBoxButtonFlags,</span>
<a href="#l26.23"></a><span id="l26.23">                             errorBoxButtonLabel,</span>
<a href="#l26.24"></a><span id="l26.24">                             null, // No second button text</span>
<a href="#l26.25"></a><span id="l26.25">                             null, // No third button text</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineat">@@ -718,34 +718,34 @@ calCalendarManager.prototype = {</span>
<a href="#l26.27"></a><span id="l26.27">         }</span>
<a href="#l26.28"></a><span id="l26.28">     },</span>
<a href="#l26.29"></a><span id="l26.29"> </span>
<a href="#l26.30"></a><span id="l26.30">     getCalendarPref_: function(calendar, name) {</span>
<a href="#l26.31"></a><span id="l26.31">         cal.ASSERT(calendar, &quot;Invalid Calendar!&quot;);</span>
<a href="#l26.32"></a><span id="l26.32">         cal.ASSERT(calendar.id !== null, &quot;Calendar id needs to be set!&quot;);</span>
<a href="#l26.33"></a><span id="l26.33">         cal.ASSERT(name &amp;&amp; name.length &gt; 0, &quot;Pref Name must be non-empty!&quot;);</span>
<a href="#l26.34"></a><span id="l26.34"> </span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-        let branch = (getPrefBranchFor(calendar.id) + name);</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+        let branch = getPrefBranchFor(calendar.id) + name;</span>
<a href="#l26.37"></a><span id="l26.37">         let value = Preferences.get(branch, null);</span>
<a href="#l26.38"></a><span id="l26.38"> </span>
<a href="#l26.39"></a><span id="l26.39">         if (typeof value == &quot;string&quot; &amp;&amp; value.startsWith(&quot;bignum:&quot;)) {</span>
<a href="#l26.40"></a><span id="l26.40">             let converted = Number(value.substr(7));</span>
<a href="#l26.41"></a><span id="l26.41">             if (!isNaN(converted)) {</span>
<a href="#l26.42"></a><span id="l26.42">                 value = converted;</span>
<a href="#l26.43"></a><span id="l26.43">             }</span>
<a href="#l26.44"></a><span id="l26.44">         }</span>
<a href="#l26.45"></a><span id="l26.45">         return value;</span>
<a href="#l26.46"></a><span id="l26.46">     },</span>
<a href="#l26.47"></a><span id="l26.47"> </span>
<a href="#l26.48"></a><span id="l26.48">     setCalendarPref_: function(calendar, name, value) {</span>
<a href="#l26.49"></a><span id="l26.49">         cal.ASSERT(calendar, &quot;Invalid Calendar!&quot;);</span>
<a href="#l26.50"></a><span id="l26.50">         cal.ASSERT(calendar.id !== null, &quot;Calendar id needs to be set!&quot;);</span>
<a href="#l26.51"></a><span id="l26.51">         cal.ASSERT(name &amp;&amp; name.length &gt; 0, &quot;Pref Name must be non-empty!&quot;);</span>
<a href="#l26.52"></a><span id="l26.52"> </span>
<a href="#l26.53"></a><span id="l26.53" class="difflineminus">-        let branch = (getPrefBranchFor(calendar.id) + name);</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineplus">+        let branch = getPrefBranchFor(calendar.id) + name;</span>
<a href="#l26.55"></a><span id="l26.55"> </span>
<a href="#l26.56"></a><span id="l26.56">         if (typeof value == &quot;number&quot; &amp;&amp; (value &gt; MAX_INT || value &lt; MIN_INT || !Number.isInteger(value))) {</span>
<a href="#l26.57"></a><span id="l26.57">             // This is something the preferences service can't store directly.</span>
<a href="#l26.58"></a><span id="l26.58">             // Convert to string and tag it so we know how to handle it.</span>
<a href="#l26.59"></a><span id="l26.59">             value = &quot;bignum:&quot; + value;</span>
<a href="#l26.60"></a><span id="l26.60">         }</span>
<a href="#l26.61"></a><span id="l26.61"> </span>
<a href="#l26.62"></a><span id="l26.62">         // Delete before to allow pref-type changes, then set the pref.</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineat">@@ -1025,17 +1025,17 @@ calDummyCalendar.prototype = {</span>
<a href="#l26.64"></a><span id="l26.64">                 return true;</span>
<a href="#l26.65"></a><span id="l26.65">             default:</span>
<a href="#l26.66"></a><span id="l26.66">                 return this.__proto__.__proto__.getProperty.apply(this, arguments);</span>
<a href="#l26.67"></a><span id="l26.67">         }</span>
<a href="#l26.68"></a><span id="l26.68">     }</span>
<a href="#l26.69"></a><span id="l26.69"> };</span>
<a href="#l26.70"></a><span id="l26.70"> </span>
<a href="#l26.71"></a><span id="l26.71"> function getPrefBranchFor(id) {</span>
<a href="#l26.72"></a><span id="l26.72" class="difflineminus">-    return (REGISTRY_BRANCH + id + &quot;.&quot;);</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineplus">+    return REGISTRY_BRANCH + id + &quot;.&quot;;</span>
<a href="#l26.74"></a><span id="l26.74"> }</span>
<a href="#l26.75"></a><span id="l26.75"> </span>
<a href="#l26.76"></a><span id="l26.76"> /**</span>
<a href="#l26.77"></a><span id="l26.77">  * Helper function to flush the preferences file. If the application crashes</span>
<a href="#l26.78"></a><span id="l26.78">  * after a calendar has been created using the prefs registry, then the calendar</span>
<a href="#l26.79"></a><span id="l26.79">  * won't show up. Writing the prefs helps counteract.</span>
<a href="#l26.80"></a><span id="l26.80">  */</span>
<a href="#l26.81"></a><span id="l26.81"> function flushPrefs() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/src/calEvent.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/src/calEvent.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -148,17 +148,17 @@ calEvent.prototype = {</span>
<a href="#l27.4"></a><span id="l27.4">         this.importUnpromotedProperties(event, this.eventPromotedProps);</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6">         // Importing didn't really change anything</span>
<a href="#l27.7"></a><span id="l27.7">         this.mDirty = false;</span>
<a href="#l27.8"></a><span id="l27.8">     },</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10">     isPropertyPromoted: function(name) {</span>
<a href="#l27.11"></a><span id="l27.11">         // avoid strict undefined property warning</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-        return (this.eventPromotedProps[name] || false);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+        return this.eventPromotedProps[name] || false;</span>
<a href="#l27.14"></a><span id="l27.14">     },</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16">     set startDate(value) {</span>
<a href="#l27.17"></a><span id="l27.17">         this.modify();</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19">         // We're about to change the start date of an item which probably</span>
<a href="#l27.20"></a><span id="l27.20">         // could break the associated calIRecurrenceInfo. We're calling</span>
<a href="#l27.21"></a><span id="l27.21">         // the appropriate method here to adjust the internal structure in</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -747,17 +747,17 @@ calFilter.prototype = {</span>
<a href="#l28.4"></a><span id="l28.4">     /**</span>
<a href="#l28.5"></a><span id="l28.5">      * Checks if the item matches the currently applied filter properties and text filter.</span>
<a href="#l28.6"></a><span id="l28.6">      *</span>
<a href="#l28.7"></a><span id="l28.7">      * @param aItem               The item to check.</span>
<a href="#l28.8"></a><span id="l28.8">      * @return                    Returns true if the item matches the filters,</span>
<a href="#l28.9"></a><span id="l28.9">      *                            false otherwise.</span>
<a href="#l28.10"></a><span id="l28.10">      */</span>
<a href="#l28.11"></a><span id="l28.11">     isItemInFilters: function cF_isItemInFilters(aItem) {</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        return (this.propertyFilter(aItem) &amp;&amp; this.textFilter(aItem));</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+        return this.propertyFilter(aItem) &amp;&amp; this.textFilter(aItem);</span>
<a href="#l28.14"></a><span id="l28.14">     },</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16">     /**</span>
<a href="#l28.17"></a><span id="l28.17">      * Finds the next occurrence of a repeating item that matches the currently applied</span>
<a href="#l28.18"></a><span id="l28.18">      * filter properties.</span>
<a href="#l28.19"></a><span id="l28.19">      *</span>
<a href="#l28.20"></a><span id="l28.20">      * @param aItem               The parent item to find the next occurrence of.</span>
<a href="#l28.21"></a><span id="l28.21">      * @return                    Returns the next occurrence that matches the filters,</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -790,17 +790,17 @@ calFilter.prototype = {</span>
<a href="#l28.23"></a><span id="l28.23">             cal.WARN(&quot;[calFilter] getNextOccurrence: reached maximum iterations for &quot; + aItem.title);</span>
<a href="#l28.24"></a><span id="l28.24">             return null;</span>
<a href="#l28.25"></a><span id="l28.25">         } else {</span>
<a href="#l28.26"></a><span id="l28.26">             // the parent item doesn't match the filter, we can return the first future exception</span>
<a href="#l28.27"></a><span id="l28.27">             // that matches the filter</span>
<a href="#l28.28"></a><span id="l28.28">             let exMatch = null;</span>
<a href="#l28.29"></a><span id="l28.29">             aItem.recurrenceInfo.getExceptionIds({}).forEach(function(rID) {</span>
<a href="#l28.30"></a><span id="l28.30">                 let ex = aItem.recurrenceInfo.getExceptionFor(rID);</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-                if (ex &amp;&amp; cal.now().compare((ex.startDate || ex.entryDate)) &lt; 0 &amp;&amp;</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+                if (ex &amp;&amp; cal.now().compare(ex.startDate || ex.entryDate) &lt; 0 &amp;&amp;</span>
<a href="#l28.33"></a><span id="l28.33">                     this.isItemInFilters(ex)) {</span>
<a href="#l28.34"></a><span id="l28.34">                     exMatch = ex;</span>
<a href="#l28.35"></a><span id="l28.35">                 }</span>
<a href="#l28.36"></a><span id="l28.36">             }, this);</span>
<a href="#l28.37"></a><span id="l28.37">             return exMatch;</span>
<a href="#l28.38"></a><span id="l28.38">         }</span>
<a href="#l28.39"></a><span id="l28.39">     },</span>
<a href="#l28.40"></a><span id="l28.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/src/calIcsParser.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/src/calIcsParser.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -234,20 +234,20 @@ parserState.prototype = {</span>
<a href="#l29.4"></a><span id="l29.4">             let tzid = dt.timezone.tzid;</span>
<a href="#l29.5"></a><span id="l29.5">             let hid = item.hashId + &quot;#&quot; + tzid;</span>
<a href="#l29.6"></a><span id="l29.6">             if (!(hid in this.tzErrors)) {</span>
<a href="#l29.7"></a><span id="l29.7">                 // For now, publish errors to console and alert user.</span>
<a href="#l29.8"></a><span id="l29.8">                 // In future, maybe make them available through an interface method</span>
<a href="#l29.9"></a><span id="l29.9">                 // so this UI code can be removed from the parser, and caller can</span>
<a href="#l29.10"></a><span id="l29.10">                 // choose whether to alert, or show user the problem items and ask</span>
<a href="#l29.11"></a><span id="l29.11">                 // for fixes, or something else.</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-                let msg = (calGetString(&quot;calendar&quot;, &quot;unknownTimezoneInItem&quot;,</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-                                        [tzid, item.title, cal.getDateFormatter().formatDateTime(dt)]) +</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-                           &quot;\n&quot; + item.icalString);</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-                cal.ERROR(msg);</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+                let msgArgs = [tzid, item.title, cal.getDateFormatter().formatDateTime(dt)];</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineplus">+                let msg = calGetString(&quot;calendar&quot;, &quot;unknownTimezoneInItem&quot;, msgArgs);</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+                cal.ERROR(msg + &quot;\n&quot; + item.icalString);</span>
<a href="#l29.20"></a><span id="l29.20">                 this.tzErrors[hid] = true;</span>
<a href="#l29.21"></a><span id="l29.21">             }</span>
<a href="#l29.22"></a><span id="l29.22">         }</span>
<a href="#l29.23"></a><span id="l29.23">     },</span>
<a href="#l29.24"></a><span id="l29.24"> </span>
<a href="#l29.25"></a><span id="l29.25">     /**</span>
<a href="#l29.26"></a><span id="l29.26">      * Submit processing of a subcomponent to the event queue</span>
<a href="#l29.27"></a><span id="l29.27">      *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -55,17 +55,17 @@ calItemBase.prototype = {</span>
<a href="#l30.4"></a><span id="l30.4">      */</span>
<a href="#l30.5"></a><span id="l30.5">     QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIItemBase]),</span>
<a href="#l30.6"></a><span id="l30.6"> </span>
<a href="#l30.7"></a><span id="l30.7">     /**</span>
<a href="#l30.8"></a><span id="l30.8">      * @see calIItemBase</span>
<a href="#l30.9"></a><span id="l30.9">      */</span>
<a href="#l30.10"></a><span id="l30.10">     get aclEntry() {</span>
<a href="#l30.11"></a><span id="l30.11">         let aclEntry = this.mACLEntry;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-        let aclManager = (this.calendar &amp;&amp; this.calendar.superCalendar.aclManager);</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+        let aclManager = this.calendar &amp;&amp; this.calendar.superCalendar.aclManager;</span>
<a href="#l30.14"></a><span id="l30.14"> </span>
<a href="#l30.15"></a><span id="l30.15">         if (!aclEntry &amp;&amp; aclManager) {</span>
<a href="#l30.16"></a><span id="l30.16">             this.mACLEntry = aclManager.getItemEntry(this);</span>
<a href="#l30.17"></a><span id="l30.17">             aclEntry = this.mACLEntry;</span>
<a href="#l30.18"></a><span id="l30.18">         }</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20">         if (!aclEntry &amp;&amp; this.parentItem != this) {</span>
<a href="#l30.21"></a><span id="l30.21">             // No ACL entry on this item, check the parent</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -116,17 +116,17 @@ calItemBase.prototype = {</span>
<a href="#l30.23"></a><span id="l30.23">     },</span>
<a href="#l30.24"></a><span id="l30.24">     set recurrenceInfo(value) {</span>
<a href="#l30.25"></a><span id="l30.25">         this.modify();</span>
<a href="#l30.26"></a><span id="l30.26">         return (this.mRecurrenceInfo = calTryWrappedJSObject(value));</span>
<a href="#l30.27"></a><span id="l30.27">     },</span>
<a href="#l30.28"></a><span id="l30.28"> </span>
<a href="#l30.29"></a><span id="l30.29">     // attribute calIItemBase parentItem;</span>
<a href="#l30.30"></a><span id="l30.30">     get parentItem() {</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-        return (this.mParentItem || this);</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+        return this.mParentItem || this;</span>
<a href="#l30.33"></a><span id="l30.33">     },</span>
<a href="#l30.34"></a><span id="l30.34">     set parentItem(value) {</span>
<a href="#l30.35"></a><span id="l30.35">         if (this.mImmutable) {</span>
<a href="#l30.36"></a><span id="l30.36">             throw Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l30.37"></a><span id="l30.37">         }</span>
<a href="#l30.38"></a><span id="l30.38">         return (this.mParentItem = calTryWrappedJSObject(value));</span>
<a href="#l30.39"></a><span id="l30.39">     },</span>
<a href="#l30.40"></a><span id="l30.40"> </span>
<a href="#l30.41"></a><span id="l30.41" class="difflineat">@@ -224,20 +224,20 @@ calItemBase.prototype = {</span>
<a href="#l30.42"></a><span id="l30.42">         }</span>
<a href="#l30.43"></a><span id="l30.43"> </span>
<a href="#l30.44"></a><span id="l30.44">         this.ensureNotDirty();</span>
<a href="#l30.45"></a><span id="l30.45">         this.mImmutable = true;</span>
<a href="#l30.46"></a><span id="l30.46">     },</span>
<a href="#l30.47"></a><span id="l30.47"> </span>
<a href="#l30.48"></a><span id="l30.48">      // boolean hasSameIds(in calIItemBase aItem);</span>
<a href="#l30.49"></a><span id="l30.49">     hasSameIds: function cIB_hasSameIds(that) {</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineminus">-        return (that &amp;&amp; this.id == that.id &amp;&amp;</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineminus">-                (this.recurrenceId == that.recurrenceId || // both null</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineminus">-                 (this.recurrenceId &amp;&amp; that.recurrenceId &amp;&amp;</span>
<a href="#l30.53"></a><span id="l30.53" class="difflineminus">-                  this.recurrenceId.compare(that.recurrenceId) == 0)));</span>
<a href="#l30.54"></a><span id="l30.54" class="difflineplus">+        return that &amp;&amp; this.id == that.id &amp;&amp;</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineplus">+               (this.recurrenceId == that.recurrenceId || // both null</span>
<a href="#l30.56"></a><span id="l30.56" class="difflineplus">+                (this.recurrenceId &amp;&amp; that.recurrenceId &amp;&amp;</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineplus">+                 this.recurrenceId.compare(that.recurrenceId) == 0));</span>
<a href="#l30.58"></a><span id="l30.58">     },</span>
<a href="#l30.59"></a><span id="l30.59"> </span>
<a href="#l30.60"></a><span id="l30.60">     // calIItemBase clone();</span>
<a href="#l30.61"></a><span id="l30.61">     clone: function cIB_clone() {</span>
<a href="#l30.62"></a><span id="l30.62">         return this.cloneShallow(this.mParentItem);</span>
<a href="#l30.63"></a><span id="l30.63">     },</span>
<a href="#l30.64"></a><span id="l30.64"> </span>
<a href="#l30.65"></a><span id="l30.65">     /**</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineat">@@ -246,17 +246,17 @@ calItemBase.prototype = {</span>
<a href="#l30.67"></a><span id="l30.67">      *</span>
<a href="#l30.68"></a><span id="l30.68">      * @param m     The item to clone this item into</span>
<a href="#l30.69"></a><span id="l30.69">      * @param aNewParent    (optional) The new parent item to set on m.</span>
<a href="#l30.70"></a><span id="l30.70">      */</span>
<a href="#l30.71"></a><span id="l30.71">     cloneItemBaseInto: function cIB_cloneItemBaseInto(m, aNewParent) {</span>
<a href="#l30.72"></a><span id="l30.72">         m.mImmutable = false;</span>
<a href="#l30.73"></a><span id="l30.73">         m.mACLEntry = this.mACLEntry;</span>
<a href="#l30.74"></a><span id="l30.74">         m.mIsProxy = this.mIsProxy;</span>
<a href="#l30.75"></a><span id="l30.75" class="difflineminus">-        m.mParentItem = (calTryWrappedJSObject(aNewParent) || this.mParentItem);</span>
<a href="#l30.76"></a><span id="l30.76" class="difflineplus">+        m.mParentItem = calTryWrappedJSObject(aNewParent) || this.mParentItem;</span>
<a href="#l30.77"></a><span id="l30.77">         m.mHashId = this.mHashId;</span>
<a href="#l30.78"></a><span id="l30.78">         m.mCalendar = this.mCalendar;</span>
<a href="#l30.79"></a><span id="l30.79">         if (this.mRecurrenceInfo) {</span>
<a href="#l30.80"></a><span id="l30.80">             m.mRecurrenceInfo = calTryWrappedJSObject(this.mRecurrenceInfo.clone());</span>
<a href="#l30.81"></a><span id="l30.81">             m.mRecurrenceInfo.item = m;</span>
<a href="#l30.82"></a><span id="l30.82">         }</span>
<a href="#l30.83"></a><span id="l30.83"> </span>
<a href="#l30.84"></a><span id="l30.84">         let org = this.organizer;</span>
<a href="#l30.85"></a><span id="l30.85" class="difflineat">@@ -449,18 +449,18 @@ calItemBase.prototype = {</span>
<a href="#l30.86"></a><span id="l30.86">         return null;</span>
<a href="#l30.87"></a><span id="l30.87">     },</span>
<a href="#l30.88"></a><span id="l30.88"> </span>
<a href="#l30.89"></a><span id="l30.89">     // boolean hasPropertyParameter(in AString aPropertyName,</span>
<a href="#l30.90"></a><span id="l30.90">     //                              in AString aParameterName);</span>
<a href="#l30.91"></a><span id="l30.91">     hasPropertyParameter: function cIB_hasPropertyParameter(aPropName, aParamName) {</span>
<a href="#l30.92"></a><span id="l30.92">         let propName = aPropName.toUpperCase();</span>
<a href="#l30.93"></a><span id="l30.93">         let paramName = aParamName.toUpperCase();</span>
<a href="#l30.94"></a><span id="l30.94" class="difflineminus">-        return ((propName in this.mPropertyParams) &amp;&amp;</span>
<a href="#l30.95"></a><span id="l30.95" class="difflineminus">-                (paramName in this.mPropertyParams[propName]));</span>
<a href="#l30.96"></a><span id="l30.96" class="difflineplus">+        return (propName in this.mPropertyParams) &amp;&amp;</span>
<a href="#l30.97"></a><span id="l30.97" class="difflineplus">+                (paramName in this.mPropertyParams[propName]);</span>
<a href="#l30.98"></a><span id="l30.98">     },</span>
<a href="#l30.99"></a><span id="l30.99"> </span>
<a href="#l30.100"></a><span id="l30.100">     // void setPropertyParameter(in AString aPropertyName,</span>
<a href="#l30.101"></a><span id="l30.101">     //                           in AString aParameterName,</span>
<a href="#l30.102"></a><span id="l30.102">     //                           in AUTF8String aParameterValue);</span>
<a href="#l30.103"></a><span id="l30.103">     setPropertyParameter: function cIB_setPropertyParameter(aPropName, aParamName, aParamValue) {</span>
<a href="#l30.104"></a><span id="l30.104">         let propName = aPropName.toUpperCase();</span>
<a href="#l30.105"></a><span id="l30.105">         let paramName = aParamName.toUpperCase();</span>
<a href="#l30.106"></a><span id="l30.106" class="difflineat">@@ -936,17 +936,17 @@ calItemBase.prototype = {</span>
<a href="#l30.107"></a><span id="l30.107">                     this.mPropertyParams[propName][paramName] = paramValue;</span>
<a href="#l30.108"></a><span id="l30.108">                 }</span>
<a href="#l30.109"></a><span id="l30.109">             }</span>
<a href="#l30.110"></a><span id="l30.110">         }</span>
<a href="#l30.111"></a><span id="l30.111">     },</span>
<a href="#l30.112"></a><span id="l30.112"> </span>
<a href="#l30.113"></a><span id="l30.113">     // boolean isPropertyPromoted(in AString name);</span>
<a href="#l30.114"></a><span id="l30.114">     isPropertyPromoted: function cIB_isPropertyPromoted(name) {</span>
<a href="#l30.115"></a><span id="l30.115" class="difflineminus">-        return (this.itemBasePromotedProps[name.toUpperCase()]);</span>
<a href="#l30.116"></a><span id="l30.116" class="difflineplus">+        return this.itemBasePromotedProps[name.toUpperCase()];</span>
<a href="#l30.117"></a><span id="l30.117">     },</span>
<a href="#l30.118"></a><span id="l30.118"> </span>
<a href="#l30.119"></a><span id="l30.119">     // attribute calIIcalComponent icalComponent;</span>
<a href="#l30.120"></a><span id="l30.120">     get icalComponent() {</span>
<a href="#l30.121"></a><span id="l30.121">         throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l30.122"></a><span id="l30.122">     },</span>
<a href="#l30.123"></a><span id="l30.123">     set icalComponent(val) {</span>
<a href="#l30.124"></a><span id="l30.124">         throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/src/calItipItem.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/src/calItipItem.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -184,17 +184,17 @@ calItipItem.prototype = {</span>
<a href="#l31.4"></a><span id="l31.4"> </span>
<a href="#l31.5"></a><span id="l31.5">     /**</span>
<a href="#l31.6"></a><span id="l31.6">      * Note that this code forces the user to respond to all items in the same</span>
<a href="#l31.7"></a><span id="l31.7">      * way, which is a current limitation of the spec.</span>
<a href="#l31.8"></a><span id="l31.8">      */</span>
<a href="#l31.9"></a><span id="l31.9">     setAttendeeStatus: function ciiSAS(aAttendeeId, aStatus) {</span>
<a href="#l31.10"></a><span id="l31.10">         // Append &quot;mailto:&quot; to the attendee if it is missing it.</span>
<a href="#l31.11"></a><span id="l31.11">         if (!aAttendeeId.match(/^mailto:/i)) {</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-            aAttendeeId = (&quot;mailto:&quot; + aAttendeeId);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+            aAttendeeId = &quot;mailto:&quot; + aAttendeeId;</span>
<a href="#l31.14"></a><span id="l31.14">         }</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16">         for (let item of this.mItemList) {</span>
<a href="#l31.17"></a><span id="l31.17">             let attendee = item.getAttendeeById(aAttendeeId);</span>
<a href="#l31.18"></a><span id="l31.18">             if (attendee) {</span>
<a href="#l31.19"></a><span id="l31.19">                 // Replies should not have the RSVP property.</span>
<a href="#l31.20"></a><span id="l31.20">                 // XXX BUG 351589: workaround for updating an attendee</span>
<a href="#l31.21"></a><span id="l31.21">                 item.removeAttendee(attendee);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -588,19 +588,18 @@ function guessSystemTimezone() {</span>
<a href="#l32.4"></a><span id="l32.4">     // First, try to detect operating system timezone.</span>
<a href="#l32.5"></a><span id="l32.5">     let zoneInfoIdFromOSUserTimeZone = null;</span>
<a href="#l32.6"></a><span id="l32.6">     let osUserTimeZone = null;</span>
<a href="#l32.7"></a><span id="l32.7">     try {</span>
<a href="#l32.8"></a><span id="l32.8">         let handler = Components.classes[&quot;@mozilla.org/network/protocol;1?name=http&quot;]</span>
<a href="#l32.9"></a><span id="l32.9">                                 .getService(Components.interfaces.nsIHttpProtocolHandler);</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11">         if (handler.oscpu.match(/^Windows/)) {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-            let wrk = (Components</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-                       .classes[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineminus">-                       .createInstance(Components.interfaces.nsIWindowsRegKey));</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+            let wrk = Components.classes[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+                                .createInstance(Components.interfaces.nsIWindowsRegKey);</span>
<a href="#l32.17"></a><span id="l32.17">             wrk.open(wrk.ROOT_KEY_LOCAL_MACHINE,</span>
<a href="#l32.18"></a><span id="l32.18">                      &quot;SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation&quot;,</span>
<a href="#l32.19"></a><span id="l32.19">                      wrk.ACCESS_READ);</span>
<a href="#l32.20"></a><span id="l32.20">             if (wrk.hasValue(&quot;TimeZoneKeyName&quot;)) {</span>
<a href="#l32.21"></a><span id="l32.21">                 // Windows Vista and later have this key.</span>
<a href="#l32.22"></a><span id="l32.22">                 // Clear trailing garbage on this key, see bug 1129712.</span>
<a href="#l32.23"></a><span id="l32.23">                 osUserTimeZone = wrk.readStringValue(&quot;TimeZoneKeyName&quot;).split(&quot;\0&quot;)[0];</span>
<a href="#l32.24"></a><span id="l32.24">             } else {</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineat">@@ -650,21 +649,21 @@ function guessSystemTimezone() {</span>
<a href="#l32.26"></a><span id="l32.26">             // The timezone is set per user via the TZ environment variable.</span>
<a href="#l32.27"></a><span id="l32.27">             // TZ may contain a path that may start with a colon and ends with</span>
<a href="#l32.28"></a><span id="l32.28">             // a ZoneInfo timezone identifier, such as &quot;:America/New_York&quot; or</span>
<a href="#l32.29"></a><span id="l32.29">             // &quot;:/share/lib/zoneinfo/America/New_York&quot;.  The others are</span>
<a href="#l32.30"></a><span id="l32.30">             // in the filesystem so they give one timezone for the system;</span>
<a href="#l32.31"></a><span id="l32.31">             // the values are similar (but cannot have a leading colon).</span>
<a href="#l32.32"></a><span id="l32.32">             // (Note: the OS ZoneInfo database may be a different version from</span>
<a href="#l32.33"></a><span id="l32.33">             // the one we use, so still need to check that DST dates match.)</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineminus">-            osUserTimeZone = (environmentVariableValue(&quot;TZ&quot;) ||</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineminus">-                              symbolicLinkTarget(&quot;/etc/localtime&quot;) ||</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-                              fileFirstZoneLineString(&quot;/etc/TIMEZONE&quot;) ||</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineminus">-                              fileFirstZoneLineString(&quot;/etc/timezone&quot;) ||</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineminus">-                              fileFirstZoneLineString(&quot;/etc/sysconfig/clock&quot;));</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+            osUserTimeZone = environmentVariableValue(&quot;TZ&quot;) ||</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineplus">+                             symbolicLinkTarget(&quot;/etc/localtime&quot;) ||</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineplus">+                             fileFirstZoneLineString(&quot;/etc/TIMEZONE&quot;) ||</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineplus">+                             fileFirstZoneLineString(&quot;/etc/timezone&quot;) ||</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineplus">+                             fileFirstZoneLineString(&quot;/etc/sysconfig/clock&quot;);</span>
<a href="#l32.44"></a><span id="l32.44">             let results = osUserTimeZone.match(tzRegex);</span>
<a href="#l32.45"></a><span id="l32.45">             if (results) {</span>
<a href="#l32.46"></a><span id="l32.46">                 zoneInfoIdFromOSUserTimeZone = results[1];</span>
<a href="#l32.47"></a><span id="l32.47">             }</span>
<a href="#l32.48"></a><span id="l32.48">         }</span>
<a href="#l32.49"></a><span id="l32.49"> </span>
<a href="#l32.50"></a><span id="l32.50">         // check how well OS tz matches tz defined in our version of zoneinfo db</span>
<a href="#l32.51"></a><span id="l32.51">         if (zoneInfoIdFromOSUserTimeZone != null) {</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineat">@@ -779,30 +778,29 @@ function guessSystemTimezone() {</span>
<a href="#l32.53"></a><span id="l32.53">             let warningDetail;</span>
<a href="#l32.54"></a><span id="l32.54">             if (probableTZScore == 1) {</span>
<a href="#l32.55"></a><span id="l32.55">                 // score 1 means has daylight time,</span>
<a href="#l32.56"></a><span id="l32.56">                 // but transitions start on different weekday from os timezone.</span>
<a href="#l32.57"></a><span id="l32.57">                 let standardStart = getIcalString(standard, &quot;DTSTART&quot;);</span>
<a href="#l32.58"></a><span id="l32.58">                 let standardStartWeekday = weekday(standardStart, tz);</span>
<a href="#l32.59"></a><span id="l32.59">                 let standardRule = getIcalString(standard, &quot;RRULE&quot;);</span>
<a href="#l32.60"></a><span id="l32.60">                 let standardText =</span>
<a href="#l32.61"></a><span id="l32.61" class="difflineminus">-                    (&quot;  Standard: &quot; + standardStart + &quot; &quot; + standardStartWeekday + &quot;\n&quot; +</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineminus">-                     &quot;            &quot; + standardRule + &quot;\n&quot;);</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+                    &quot;  Standard: &quot; + standardStart + &quot; &quot; + standardStartWeekday + &quot;\n&quot; +</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineplus">+                    &quot;            &quot; + standardRule + &quot;\n&quot;;</span>
<a href="#l32.65"></a><span id="l32.65">                 let daylightStart = getIcalString(daylight, &quot;DTSTART&quot;);</span>
<a href="#l32.66"></a><span id="l32.66">                 let daylightStartWeekday = weekday(daylightStart, tz);</span>
<a href="#l32.67"></a><span id="l32.67">                 let daylightRule = getIcalString(daylight, &quot;RRULE&quot;);</span>
<a href="#l32.68"></a><span id="l32.68">                 let daylightText =</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineminus">-                    (&quot;  Daylight: &quot; + daylightStart + &quot; &quot; + daylightStartWeekday + &quot;\n&quot; +</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineminus">-                     &quot;            &quot; + daylightRule + &quot;\n&quot;);</span>
<a href="#l32.71"></a><span id="l32.71" class="difflineplus">+                    &quot;  Daylight: &quot; + daylightStart + &quot; &quot; + daylightStartWeekday + &quot;\n&quot; +</span>
<a href="#l32.72"></a><span id="l32.72" class="difflineplus">+                    &quot;            &quot; + daylightRule + &quot;\n&quot;;</span>
<a href="#l32.73"></a><span id="l32.73">                 warningDetail =</span>
<a href="#l32.74"></a><span id="l32.74" class="difflineminus">-                    ((standardStart &lt; daylightStart</span>
<a href="#l32.75"></a><span id="l32.75" class="difflineplus">+                    (standardStart &lt; daylightStart</span>
<a href="#l32.76"></a><span id="l32.76">                       ? standardText + daylightText</span>
<a href="#l32.77"></a><span id="l32.77">                       : daylightText + standardText) +</span>
<a href="#l32.78"></a><span id="l32.78" class="difflineminus">-                     (calProperties.GetStringFromName(</span>
<a href="#l32.79"></a><span id="l32.79" class="difflineminus">-                      &quot;TZAlmostMatchesOSDifferAtMostAWeek&quot;)));</span>
<a href="#l32.80"></a><span id="l32.80" class="difflineplus">+                     calProperties.GetStringFromName(&quot;TZAlmostMatchesOSDifferAtMostAWeek&quot;);</span>
<a href="#l32.81"></a><span id="l32.81">             } else {</span>
<a href="#l32.82"></a><span id="l32.82">                 warningDetail = calProperties.GetStringFromName(&quot;TZSeemsToMatchOS&quot;);</span>
<a href="#l32.83"></a><span id="l32.83">             }</span>
<a href="#l32.84"></a><span id="l32.84">             let offsetString = standardTZOffset +</span>
<a href="#l32.85"></a><span id="l32.85">                                  (!daylightTZOffset ? &quot;&quot; : &quot;/&quot; + daylightTZOffset);</span>
<a href="#l32.86"></a><span id="l32.86">             let warningMsg = calProperties.formatStringFromName(&quot;WarningUsingGuessedTZ&quot;,</span>
<a href="#l32.87"></a><span id="l32.87">                               [tzId, offsetString, warningDetail, probableTZSource], 4);</span>
<a href="#l32.88"></a><span id="l32.88">             cal.WARN(warningMsg);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/src/calTodo.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/src/calTodo.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -185,17 +185,17 @@ calTodo.prototype = {</span>
<a href="#l33.4"></a><span id="l33.4"> </span>
<a href="#l33.5"></a><span id="l33.5">         this.importUnpromotedProperties(todo, this.todoPromotedProps);</span>
<a href="#l33.6"></a><span id="l33.6">         // Importing didn't really change anything</span>
<a href="#l33.7"></a><span id="l33.7">         this.mDirty = false;</span>
<a href="#l33.8"></a><span id="l33.8">     },</span>
<a href="#l33.9"></a><span id="l33.9"> </span>
<a href="#l33.10"></a><span id="l33.10">     isPropertyPromoted: function(name) {</span>
<a href="#l33.11"></a><span id="l33.11">         // avoid strict undefined property warning</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-        return (this.todoPromotedProps[name] || false);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+        return this.todoPromotedProps[name] || false;</span>
<a href="#l33.14"></a><span id="l33.14">     },</span>
<a href="#l33.15"></a><span id="l33.15"> </span>
<a href="#l33.16"></a><span id="l33.16">     set entryDate(value) {</span>
<a href="#l33.17"></a><span id="l33.17">         this.modify();</span>
<a href="#l33.18"></a><span id="l33.18"> </span>
<a href="#l33.19"></a><span id="l33.19">         // We're about to change the start date of an item which probably</span>
<a href="#l33.20"></a><span id="l33.20">         // could break the associated calIRecurrenceInfo. We're calling</span>
<a href="#l33.21"></a><span id="l33.21">         // the appropriate method here to adjust the internal structure in</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/src/calTransactionManager.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/src/calTransactionManager.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -61,27 +61,27 @@ calTransactionManager.prototype = {</span>
<a href="#l34.4"></a><span id="l34.4">         return trans &amp;&amp; checkItem(trans.mItem) &amp;&amp; checkItem(trans.mOldItem);</span>
<a href="#l34.5"></a><span id="l34.5">     },</span>
<a href="#l34.6"></a><span id="l34.6"> </span>
<a href="#l34.7"></a><span id="l34.7">     undo: function cTM_undo() {</span>
<a href="#l34.8"></a><span id="l34.8">         this.transactionManager.undoTransaction();</span>
<a href="#l34.9"></a><span id="l34.9">     },</span>
<a href="#l34.10"></a><span id="l34.10"> </span>
<a href="#l34.11"></a><span id="l34.11">     canUndo: function cTM_canUndo() {</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-        return ((this.transactionManager.numberOfUndoItems &gt; 0) &amp;&amp;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-                this.checkWritable(this.transactionManager.peekUndoStack()));</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+        return this.transactionManager.numberOfUndoItems &gt; 0 &amp;&amp;</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+               this.checkWritable(this.transactionManager.peekUndoStack());</span>
<a href="#l34.16"></a><span id="l34.16">     },</span>
<a href="#l34.17"></a><span id="l34.17"> </span>
<a href="#l34.18"></a><span id="l34.18">     redo: function cTM_redo() {</span>
<a href="#l34.19"></a><span id="l34.19">         this.transactionManager.redoTransaction();</span>
<a href="#l34.20"></a><span id="l34.20">     },</span>
<a href="#l34.21"></a><span id="l34.21"> </span>
<a href="#l34.22"></a><span id="l34.22">     canRedo: function cTM_canRedo() {</span>
<a href="#l34.23"></a><span id="l34.23" class="difflineminus">-        return ((this.transactionManager.numberOfRedoItems &gt; 0) &amp;&amp;</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineminus">-                this.checkWritable(this.transactionManager.peekRedoStack()));</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineplus">+        return this.transactionManager.numberOfRedoItems &gt; 0 &amp;&amp;</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineplus">+               this.checkWritable(this.transactionManager.peekRedoStack());</span>
<a href="#l34.27"></a><span id="l34.27">     }</span>
<a href="#l34.28"></a><span id="l34.28"> };</span>
<a href="#l34.29"></a><span id="l34.29"> </span>
<a href="#l34.30"></a><span id="l34.30"> function calTransaction(aAction, aItem, aCalendar, aOldItem, aListener) {</span>
<a href="#l34.31"></a><span id="l34.31">     this.wrappedJSObject = this;</span>
<a href="#l34.32"></a><span id="l34.32">     this.mAction = aAction;</span>
<a href="#l34.33"></a><span id="l34.33">     this.mItem = aItem;</span>
<a href="#l34.34"></a><span id="l34.34">     this.mCalendar = aCalendar;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -262,57 +262,57 @@ function getCalendarDirectory() {</span>
<a href="#l35.4"></a><span id="l35.4">  * Check if the specified calendar is writable. This is the case when it is not</span>
<a href="#l35.5"></a><span id="l35.5">  * marked readOnly, we are not offline, or we are offline and the calendar is</span>
<a href="#l35.6"></a><span id="l35.6">  * local.</span>
<a href="#l35.7"></a><span id="l35.7">  *</span>
<a href="#l35.8"></a><span id="l35.8">  * @param aCalendar     The calendar to check</span>
<a href="#l35.9"></a><span id="l35.9">  * @return              True if the calendar is writable</span>
<a href="#l35.10"></a><span id="l35.10">  */</span>
<a href="#l35.11"></a><span id="l35.11"> function isCalendarWritable(aCalendar) {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    return (!aCalendar.getProperty(&quot;disabled&quot;) &amp;&amp;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+    return !aCalendar.getProperty(&quot;disabled&quot;) &amp;&amp;</span>
<a href="#l35.14"></a><span id="l35.14">             !aCalendar.readOnly &amp;&amp;</span>
<a href="#l35.15"></a><span id="l35.15">             (!Services.io.offline ||</span>
<a href="#l35.16"></a><span id="l35.16">              aCalendar.getProperty(&quot;cache.enabled&quot;) ||</span>
<a href="#l35.17"></a><span id="l35.17">              aCalendar.getProperty(&quot;cache.always&quot;) ||</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">-             aCalendar.getProperty(&quot;requiresNetwork&quot;) === false));</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+             aCalendar.getProperty(&quot;requiresNetwork&quot;) === false);</span>
<a href="#l35.20"></a><span id="l35.20"> }</span>
<a href="#l35.21"></a><span id="l35.21"> </span>
<a href="#l35.22"></a><span id="l35.22"> /**</span>
<a href="#l35.23"></a><span id="l35.23">  * Check if the specified calendar is writable from an ACL point of view.</span>
<a href="#l35.24"></a><span id="l35.24">  *</span>
<a href="#l35.25"></a><span id="l35.25">  * @param aCalendar     The calendar to check</span>
<a href="#l35.26"></a><span id="l35.26">  * @return              True if the calendar is writable</span>
<a href="#l35.27"></a><span id="l35.27">  */</span>
<a href="#l35.28"></a><span id="l35.28"> function userCanAddItemsToCalendar(aCalendar) {</span>
<a href="#l35.29"></a><span id="l35.29">     let aclEntry = aCalendar.aclEntry;</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineminus">-    return (!aclEntry || !aclEntry.hasAccessControl || aclEntry.userIsOwner || aclEntry.userCanAddItems);</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineplus">+    return !aclEntry || !aclEntry.hasAccessControl || aclEntry.userIsOwner || aclEntry.userCanAddItems;</span>
<a href="#l35.32"></a><span id="l35.32"> }</span>
<a href="#l35.33"></a><span id="l35.33"> </span>
<a href="#l35.34"></a><span id="l35.34"> /**</span>
<a href="#l35.35"></a><span id="l35.35">  * Check if the user can delete items from the specified calendar, from an ACL point of view.</span>
<a href="#l35.36"></a><span id="l35.36">  *</span>
<a href="#l35.37"></a><span id="l35.37">  * @param aCalendar     The calendar to check</span>
<a href="#l35.38"></a><span id="l35.38">  * @return              True if the calendar is writable</span>
<a href="#l35.39"></a><span id="l35.39">  */</span>
<a href="#l35.40"></a><span id="l35.40"> function userCanDeleteItemsFromCalendar(aCalendar) {</span>
<a href="#l35.41"></a><span id="l35.41">     let aclEntry = aCalendar.aclEntry;</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineminus">-    return (!aclEntry || !aclEntry.hasAccessControl || aclEntry.userIsOwner || aclEntry.userCanDeleteItems);</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineplus">+    return !aclEntry || !aclEntry.hasAccessControl || aclEntry.userIsOwner || aclEntry.userCanDeleteItems;</span>
<a href="#l35.44"></a><span id="l35.44"> }</span>
<a href="#l35.45"></a><span id="l35.45"> </span>
<a href="#l35.46"></a><span id="l35.46"> /**</span>
<a href="#l35.47"></a><span id="l35.47">  * Check if the user can fully modify the specified item, from an ACL point of view.</span>
<a href="#l35.48"></a><span id="l35.48">  * Note to be confused with the right to respond to an invitation, which is</span>
<a href="#l35.49"></a><span id="l35.49">  * handled instead by userCanRespondToInvitation.</span>
<a href="#l35.50"></a><span id="l35.50">  *</span>
<a href="#l35.51"></a><span id="l35.51">  * @param aItem         The calendar item to check</span>
<a href="#l35.52"></a><span id="l35.52">  * @return              True if the item is modifiable</span>
<a href="#l35.53"></a><span id="l35.53">  */</span>
<a href="#l35.54"></a><span id="l35.54"> function userCanModifyItem(aItem) {</span>
<a href="#l35.55"></a><span id="l35.55">     let aclEntry = aItem.aclEntry;</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineminus">-    return (!aclEntry || !aclEntry.calendarEntry.hasAccessControl || aclEntry.calendarEntry.userIsOwner || aclEntry.userCanModify);</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineplus">+    return !aclEntry || !aclEntry.calendarEntry.hasAccessControl || aclEntry.calendarEntry.userIsOwner || aclEntry.userCanModify;</span>
<a href="#l35.58"></a><span id="l35.58"> }</span>
<a href="#l35.59"></a><span id="l35.59"> </span>
<a href="#l35.60"></a><span id="l35.60"> /**</span>
<a href="#l35.61"></a><span id="l35.61">  * Check if the attendee object matches one of the addresses in the list. This</span>
<a href="#l35.62"></a><span id="l35.62">  * is useful to determine whether the current user acts as a delegate.</span>
<a href="#l35.63"></a><span id="l35.63">  *</span>
<a href="#l35.64"></a><span id="l35.64">  * @param aAttendee     The reference attendee object</span>
<a href="#l35.65"></a><span id="l35.65">  * @param addresses     The list of addresses</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineat">@@ -696,17 +696,17 @@ function calGetString(aBundleName, aStri</span>
<a href="#l35.67"></a><span id="l35.67">         let props = Services.strings.createBundle(propName);</span>
<a href="#l35.68"></a><span id="l35.68"> </span>
<a href="#l35.69"></a><span id="l35.69">         if (aParams &amp;&amp; aParams.length) {</span>
<a href="#l35.70"></a><span id="l35.70">             return props.formatStringFromName(aStringName, aParams, aParams.length);</span>
<a href="#l35.71"></a><span id="l35.71">         } else {</span>
<a href="#l35.72"></a><span id="l35.72">             return props.GetStringFromName(aStringName);</span>
<a href="#l35.73"></a><span id="l35.73">         }</span>
<a href="#l35.74"></a><span id="l35.74">     } catch (ex) {</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineminus">-        let s = (&quot;Failed to read '&quot; + aStringName + &quot;' from &quot; + propName + &quot;.&quot;);</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineplus">+        let s = &quot;Failed to read '&quot; + aStringName + &quot;' from &quot; + propName + &quot;.&quot;;</span>
<a href="#l35.77"></a><span id="l35.77">         Components.utils.reportError(s + &quot; Error: &quot; + ex);</span>
<a href="#l35.78"></a><span id="l35.78">         return s;</span>
<a href="#l35.79"></a><span id="l35.79">     }</span>
<a href="#l35.80"></a><span id="l35.80"> }</span>
<a href="#l35.81"></a><span id="l35.81"> </span>
<a href="#l35.82"></a><span id="l35.82"> /**</span>
<a href="#l35.83"></a><span id="l35.83">  * Make a UUID using the UUIDGenerator service available, we'll use that.</span>
<a href="#l35.84"></a><span id="l35.84">  */</span>
<a href="#l35.85"></a><span id="l35.85" class="difflineat">@@ -1099,35 +1099,35 @@ function checkIfInRange(item, rangeStart</span>
<a href="#l35.86"></a><span id="l35.86">     let endDate;</span>
<a href="#l35.87"></a><span id="l35.87">     let queryStart = ensureDateTime(rangeStart);</span>
<a href="#l35.88"></a><span id="l35.88">     if (isEvent(item)) {</span>
<a href="#l35.89"></a><span id="l35.89">         startDate = item.startDate;</span>
<a href="#l35.90"></a><span id="l35.90">         if (!startDate) { // DTSTART mandatory</span>
<a href="#l35.91"></a><span id="l35.91">             // xxx todo: should we assert this case?</span>
<a href="#l35.92"></a><span id="l35.92">             return null;</span>
<a href="#l35.93"></a><span id="l35.93">         }</span>
<a href="#l35.94"></a><span id="l35.94" class="difflineminus">-        endDate = (item.endDate || startDate);</span>
<a href="#l35.95"></a><span id="l35.95" class="difflineplus">+        endDate = item.endDate || startDate;</span>
<a href="#l35.96"></a><span id="l35.96">     } else {</span>
<a href="#l35.97"></a><span id="l35.97">         let dueDate = item.dueDate;</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineminus">-        startDate = (item.entryDate || dueDate);</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineplus">+        startDate = item.entryDate || dueDate;</span>
<a href="#l35.100"></a><span id="l35.100">         if (!item.entryDate) {</span>
<a href="#l35.101"></a><span id="l35.101">             if (returnDtstartOrDue) { // DTSTART or DUE mandatory</span>
<a href="#l35.102"></a><span id="l35.102">                 return null;</span>
<a href="#l35.103"></a><span id="l35.103">             }</span>
<a href="#l35.104"></a><span id="l35.104">             // 3.6.2. To-do Component</span>
<a href="#l35.105"></a><span id="l35.105">             // A &quot;VTODO&quot; calendar component without the &quot;DTSTART&quot; and &quot;DUE&quot; (or</span>
<a href="#l35.106"></a><span id="l35.106">             // &quot;DURATION&quot;) properties specifies a to-do that will be associated</span>
<a href="#l35.107"></a><span id="l35.107">             // with each successive calendar date, until it is completed.</span>
<a href="#l35.108"></a><span id="l35.108">             let completedDate = ensureDateTime(item.completedDate);</span>
<a href="#l35.109"></a><span id="l35.109">             dueDate = ensureDateTime(dueDate);</span>
<a href="#l35.110"></a><span id="l35.110">             return !completedDate || !queryStart ||</span>
<a href="#l35.111"></a><span id="l35.111">                    completedDate.compare(queryStart) &gt; 0 ||</span>
<a href="#l35.112"></a><span id="l35.112">                    (dueDate &amp;&amp; dueDate.compare(queryStart) &gt;= 0);</span>
<a href="#l35.113"></a><span id="l35.113">         }</span>
<a href="#l35.114"></a><span id="l35.114" class="difflineminus">-        endDate = (dueDate || startDate);</span>
<a href="#l35.115"></a><span id="l35.115" class="difflineplus">+        endDate = dueDate || startDate;</span>
<a href="#l35.116"></a><span id="l35.116">     }</span>
<a href="#l35.117"></a><span id="l35.117"> </span>
<a href="#l35.118"></a><span id="l35.118">     let start = ensureDateTime(startDate);</span>
<a href="#l35.119"></a><span id="l35.119">     let end = ensureDateTime(endDate);</span>
<a href="#l35.120"></a><span id="l35.120">     let queryEnd = ensureDateTime(rangeEnd);</span>
<a href="#l35.121"></a><span id="l35.121"> </span>
<a href="#l35.122"></a><span id="l35.122">     if (start.compare(end) == 0) {</span>
<a href="#l35.123"></a><span id="l35.123">         if ((!queryStart || start.compare(queryStart) &gt;= 0) &amp;&amp;</span>
<a href="#l35.124"></a><span id="l35.124" class="difflineat">@@ -1278,20 +1278,20 @@ function sendMailTo(aRecipient, aSubject</span>
<a href="#l35.125"></a><span id="l35.125">  * calendar operations (without handle).</span>
<a href="#l35.126"></a><span id="l35.126">  */</span>
<a href="#l35.127"></a><span id="l35.127"> function calOperationGroup(cancelFunc) {</span>
<a href="#l35.128"></a><span id="l35.128">     this.wrappedJSObject = this;</span>
<a href="#l35.129"></a><span id="l35.129">     if (calOperationGroup.mOpGroupId === undefined) {</span>
<a href="#l35.130"></a><span id="l35.130">         calOperationGroup.mOpGroupId = 0;</span>
<a href="#l35.131"></a><span id="l35.131">     }</span>
<a href="#l35.132"></a><span id="l35.132">     if (calOperationGroup.mOpGroupPrefix === undefined) {</span>
<a href="#l35.133"></a><span id="l35.133" class="difflineminus">-        calOperationGroup.mOpGroupPrefix = (getUUID() + &quot;-&quot;);</span>
<a href="#l35.134"></a><span id="l35.134" class="difflineplus">+        calOperationGroup.mOpGroupPrefix = getUUID() + &quot;-&quot;;</span>
<a href="#l35.135"></a><span id="l35.135">     }</span>
<a href="#l35.136"></a><span id="l35.136">     this.mCancelFunc = cancelFunc;</span>
<a href="#l35.137"></a><span id="l35.137" class="difflineminus">-    this.mId = (calOperationGroup.mOpGroupPrefix + calOperationGroup.mOpGroupId++);</span>
<a href="#l35.138"></a><span id="l35.138" class="difflineplus">+    this.mId = calOperationGroup.mOpGroupPrefix + calOperationGroup.mOpGroupId++;</span>
<a href="#l35.139"></a><span id="l35.139">     this.mSubOperations = [];</span>
<a href="#l35.140"></a><span id="l35.140"> }</span>
<a href="#l35.141"></a><span id="l35.141"> calOperationGroup.prototype = {</span>
<a href="#l35.142"></a><span id="l35.142">     mCancelFunc: null,</span>
<a href="#l35.143"></a><span id="l35.143">     mId: null,</span>
<a href="#l35.144"></a><span id="l35.144">     mIsPending: true,</span>
<a href="#l35.145"></a><span id="l35.145">     mStatus: Components.results.NS_OK,</span>
<a href="#l35.146"></a><span id="l35.146">     mSubOperations: null,</span>
<a href="#l35.147"></a><span id="l35.147" class="difflineat">@@ -1318,17 +1318,17 @@ calOperationGroup.prototype = {</span>
<a href="#l35.148"></a><span id="l35.148">             this.mIsPending = false;</span>
<a href="#l35.149"></a><span id="l35.149">             if (status) {</span>
<a href="#l35.150"></a><span id="l35.150">                 this.mStatus = status;</span>
<a href="#l35.151"></a><span id="l35.151">             }</span>
<a href="#l35.152"></a><span id="l35.152">         }</span>
<a href="#l35.153"></a><span id="l35.153">     },</span>
<a href="#l35.154"></a><span id="l35.154"> </span>
<a href="#l35.155"></a><span id="l35.155">     toString: function calOperationGroup_toString() {</span>
<a href="#l35.156"></a><span id="l35.156" class="difflineminus">-        return (&quot;[calOperationGroup] id=&quot; + this.id);</span>
<a href="#l35.157"></a><span id="l35.157" class="difflineplus">+        return &quot;[calOperationGroup] id=&quot; + this.id;</span>
<a href="#l35.158"></a><span id="l35.158">     },</span>
<a href="#l35.159"></a><span id="l35.159"> </span>
<a href="#l35.160"></a><span id="l35.160">     // calIOperation:</span>
<a href="#l35.161"></a><span id="l35.161">     get id() {</span>
<a href="#l35.162"></a><span id="l35.162">         return this.mId;</span>
<a href="#l35.163"></a><span id="l35.163">     },</span>
<a href="#l35.164"></a><span id="l35.164"> </span>
<a href="#l35.165"></a><span id="l35.165">     get isPending() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/base/src/calWeekInfoService.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/base/src/calWeekInfoService.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -90,21 +90,20 @@ calWeekInfoService.prototype = {</span>
<a href="#l36.4"></a><span id="l36.4">      * of the preference setting &quot;calendar.week.start&quot;</span>
<a href="#l36.5"></a><span id="l36.5">      *</span>
<a href="#l36.6"></a><span id="l36.6">      * @param aDate     a date time object</span>
<a href="#l36.7"></a><span id="l36.7">      * @return          a dateTime-object denoting the first day of the week</span>
<a href="#l36.8"></a><span id="l36.8">      */</span>
<a href="#l36.9"></a><span id="l36.9">     getStartOfWeek: function(aDate) {</span>
<a href="#l36.10"></a><span id="l36.10">         let date = aDate.clone();</span>
<a href="#l36.11"></a><span id="l36.11">         date.isDate = true;</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-        let offset = (Preferences.get(&quot;calendar.week.start&quot;, 0) - aDate.weekday);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+        let offset = Preferences.get(&quot;calendar.week.start&quot;, 0) - aDate.weekday;</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+        date.day += offset;</span>
<a href="#l36.15"></a><span id="l36.15">         if (offset &gt; 0) {</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineminus">-            date.day -= (7 - offset);</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineminus">-        } else {</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineminus">-            date.day += offset;</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineplus">+            date.day -= 7;</span>
<a href="#l36.20"></a><span id="l36.20">         }</span>
<a href="#l36.21"></a><span id="l36.21">         return date;</span>
<a href="#l36.22"></a><span id="l36.22">     },</span>
<a href="#l36.23"></a><span id="l36.23"> </span>
<a href="#l36.24"></a><span id="l36.24">     /**</span>
<a href="#l36.25"></a><span id="l36.25">      * gets the last day of a week of a passed day under consideration</span>
<a href="#l36.26"></a><span id="l36.26">      * of the preference setting &quot;calendar.week.start&quot;</span>
<a href="#l36.27"></a><span id="l36.27">      *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/import-export/calHtmlExport.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/import-export/calHtmlExport.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -79,17 +79,17 @@ calHtmlExporter.prototype = {</span>
<a href="#l37.4"></a><span id="l37.4">             let endDate = item[cal.calGetEndDateProp(item)];</span>
<a href="#l37.5"></a><span id="l37.5">             if (startDate || endDate) {</span>
<a href="#l37.6"></a><span id="l37.6">                 // This is a task with a start or due date, format accordingly</span>
<a href="#l37.7"></a><span id="l37.7">                 let prefixWhen = cal.calGetString(&quot;calendar&quot;, &quot;htmlPrefixWhen&quot;);</span>
<a href="#l37.8"></a><span id="l37.8">                 itemNode.querySelector(&quot;.intervalkey&quot;).textContent = prefixWhen;</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10">                 let startNode = itemNode.querySelector(&quot;.dtstart&quot;);</span>
<a href="#l37.11"></a><span id="l37.11">                 let dateString = cal.getDateFormatter().formatItemInterval(item);</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-                startNode.setAttribute(&quot;title&quot;, (startDate ? startDate.icalString : &quot;none&quot;));</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+                startNode.setAttribute(&quot;title&quot;, startDate ? startDate.icalString : &quot;none&quot;);</span>
<a href="#l37.14"></a><span id="l37.14">                 startNode.textContent = dateString;</span>
<a href="#l37.15"></a><span id="l37.15">             } else {</span>
<a href="#l37.16"></a><span id="l37.16">                 let row = itemNode.querySelector(&quot;.intervalrow&quot;);</span>
<a href="#l37.17"></a><span id="l37.17">                 row.remove();</span>
<a href="#l37.18"></a><span id="l37.18">                 if (row.nextSibling instanceof Components.interfaces.nsIDOMText) {</span>
<a href="#l37.19"></a><span id="l37.19">                     row.nextSibling.remove();</span>
<a href="#l37.20"></a><span id="l37.20">                 }</span>
<a href="#l37.21"></a><span id="l37.21">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -174,17 +174,17 @@ calMonthPrinter.prototype = {</span>
<a href="#l38.4"></a><span id="l38.4">         let weekContainer = currentMonth.querySelector(&quot;.week-container&quot;);</span>
<a href="#l38.5"></a><span id="l38.5"> </span>
<a href="#l38.6"></a><span id="l38.6">         for (let weekStart = startOfMonthView; weekStart.compare(endOfMonthView) &lt; 0; weekStart.day += 7) {</span>
<a href="#l38.7"></a><span id="l38.7">             this.setupWeek(document, weekContainer, weekStart, mainMonth, dayTable);</span>
<a href="#l38.8"></a><span id="l38.8">         }</span>
<a href="#l38.9"></a><span id="l38.9"> </span>
<a href="#l38.10"></a><span id="l38.10">         // Now insert the month into the page container, sorting by date (and therefore by month)</span>
<a href="#l38.11"></a><span id="l38.11">         function compareDates(a, b) {</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-            return (!a || !b) ? -1 : a.compare(b);</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+            return !a || !b ? -1 : a.compare(b);</span>
<a href="#l38.14"></a><span id="l38.14">         }</span>
<a href="#l38.15"></a><span id="l38.15"> </span>
<a href="#l38.16"></a><span id="l38.16">         cal.binaryInsertNode(monthContainer, currentMonth, currentMonth.item, compareDates);</span>
<a href="#l38.17"></a><span id="l38.17">     },</span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19">     setupWeek: function monthPrint_setupWeek(document, weekContainer, startOfWeek, mainMonth, dayTable) {</span>
<a href="#l38.20"></a><span id="l38.20">         const weekdayMap = [&quot;sunday&quot;, &quot;monday&quot;, &quot;tuesday&quot;, &quot;wednesday&quot;, &quot;thursday&quot;, &quot;friday&quot;, &quot;saturday&quot;];</span>
<a href="#l38.21"></a><span id="l38.21">         let weekTemplate = document.getElementById(&quot;week-template&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -476,17 +476,17 @@ calOutlookCSVExporter.prototype = {</span>
<a href="#l39.4"></a><span id="l39.4">                 alarmDate = cal.alarms.calculateAlarmDate(item, alarms[0]);</span>
<a href="#l39.5"></a><span id="l39.5">             }</span>
<a href="#l39.6"></a><span id="l39.6">             line.push(alarmDate ? localeEn.valueTrue : localeEn.valueFalse);</span>
<a href="#l39.7"></a><span id="l39.7">             line.push(alarmDate ? dateString(alarmDate) : &quot;&quot;);</span>
<a href="#l39.8"></a><span id="l39.8">             line.push(alarmDate ? timeString(alarmDate) : &quot;&quot;);</span>
<a href="#l39.9"></a><span id="l39.9">             line.push(txtString(cal.categoriesArrayToString(item.getCategories({})))); // xxx todo: what's the correct way to encode ',' in csv?, how are multi-values expressed?</span>
<a href="#l39.10"></a><span id="l39.10">             line.push(txtString(item.getProperty(&quot;DESCRIPTION&quot;)));</span>
<a href="#l39.11"></a><span id="l39.11">             line.push(txtString(item.getProperty(&quot;LOCATION&quot;)));</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-            line.push((item.privacy == &quot;PRIVATE&quot;) ? localeEn.valueTrue : localeEn.valueFalse);</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+            line.push(item.privacy == &quot;PRIVATE&quot; ? localeEn.valueTrue : localeEn.valueFalse);</span>
<a href="#l39.14"></a><span id="l39.14"> </span>
<a href="#l39.15"></a><span id="l39.15">             line = line.map(function(v) {</span>
<a href="#l39.16"></a><span id="l39.16">                 v = String(v).replace(/&quot;/g, '&quot;&quot;');</span>
<a href="#l39.17"></a><span id="l39.17">                 return '&quot;' + v + '&quot;';</span>
<a href="#l39.18"></a><span id="l39.18">             });</span>
<a href="#l39.19"></a><span id="l39.19">             str = line.join(',') + exportLineEnding;</span>
<a href="#l39.20"></a><span id="l39.20">             aStream.write(str, str.length);</span>
<a href="#l39.21"></a><span id="l39.21">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/import-export/calWeekPrinter.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/import-export/calWeekPrinter.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -127,14 +127,14 @@ calWeekPrinter.prototype = {</span>
<a href="#l40.4"></a><span id="l40.4">             if (Preferences.get(dayOffPrefName, false)) {</span>
<a href="#l40.5"></a><span id="l40.5">                 let daysOffNode = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-box&quot;);</span>
<a href="#l40.6"></a><span id="l40.6">                 daysOffNode.className += &quot; day-off&quot;;</span>
<a href="#l40.7"></a><span id="l40.7">             }</span>
<a href="#l40.8"></a><span id="l40.8">         }</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10">         // Now insert the week into the week container, sorting by date (and therefore week number)</span>
<a href="#l40.11"></a><span id="l40.11">         function compareDates(a, b) {</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-            return (!a || !b) ? -1 : a.compare(b);</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+            return !a || !b ? -1 : a.compare(b);</span>
<a href="#l40.14"></a><span id="l40.14">         }</span>
<a href="#l40.15"></a><span id="l40.15"> </span>
<a href="#l40.16"></a><span id="l40.16">         cal.binaryInsertNode(weekContainer, currentPage, currentPage.item, compareDates);</span>
<a href="#l40.17"></a><span id="l40.17">     }</span>
<a href="#l40.18"></a><span id="l40.18"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/itip/calItipEmailTransport.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/itip/calItipEmailTransport.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -43,51 +43,48 @@ calItipEmailTransport.prototype = {</span>
<a href="#l41.4"></a><span id="l41.4">     set senderAddress(aValue) {</span>
<a href="#l41.5"></a><span id="l41.5">         return (this.mSenderAddress = aValue);</span>
<a href="#l41.6"></a><span id="l41.6">     },</span>
<a href="#l41.7"></a><span id="l41.7"> </span>
<a href="#l41.8"></a><span id="l41.8">     sendItems: function cietSI(aCount, aRecipients, aItipItem) {</span>
<a href="#l41.9"></a><span id="l41.9">         if (this.mHasXpcomMail) {</span>
<a href="#l41.10"></a><span id="l41.10">             cal.LOG(&quot;sendItems: Sending Email...&quot;);</span>
<a href="#l41.11"></a><span id="l41.11">             let items = this._prepareItems(aItipItem);</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-            return (items === false)</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-                ? false</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineminus">-                : this._sendXpcomMail(</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineminus">-                    aRecipients,</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineminus">-                    items.subject,</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineminus">-                    items.body,</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineminus">-                    aItipItem</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineminus">-                );</span>
<a href="#l41.20"></a><span id="l41.20" class="difflineplus">+            if (items === false) {</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineplus">+                return false;</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineplus">+            } else {</span>
<a href="#l41.23"></a><span id="l41.23" class="difflineplus">+                return this._sendXpcomMail(aRecipients, items.subject, items.body, aItipItem);</span>
<a href="#l41.24"></a><span id="l41.24" class="difflineplus">+            }</span>
<a href="#l41.25"></a><span id="l41.25">         } else {</span>
<a href="#l41.26"></a><span id="l41.26">             // Sunbird case: Call user's default mailer on system.</span>
<a href="#l41.27"></a><span id="l41.27">             throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l41.28"></a><span id="l41.28">         }</span>
<a href="#l41.29"></a><span id="l41.29">     },</span>
<a href="#l41.30"></a><span id="l41.30"> </span>
<a href="#l41.31"></a><span id="l41.31">     _prepareItems: function(aItipItem) {</span>
<a href="#l41.32"></a><span id="l41.32">         let item = aItipItem.getItemList({})[0];</span>
<a href="#l41.33"></a><span id="l41.33"> </span>
<a href="#l41.34"></a><span id="l41.34">         // Get ourselves some default text - when we handle organizer properly</span>
<a href="#l41.35"></a><span id="l41.35">         // We'll need a way to configure the Common Name attribute and we should</span>
<a href="#l41.36"></a><span id="l41.36">         // use it here rather than the email address</span>
<a href="#l41.37"></a><span id="l41.37"> </span>
<a href="#l41.38"></a><span id="l41.38" class="difflineminus">-        let summary = (item.getProperty(&quot;SUMMARY&quot;) || &quot;&quot;);</span>
<a href="#l41.39"></a><span id="l41.39" class="difflineplus">+        let summary = item.getProperty(&quot;SUMMARY&quot;) || &quot;&quot;;</span>
<a href="#l41.40"></a><span id="l41.40">         let subject = &quot;&quot;;</span>
<a href="#l41.41"></a><span id="l41.41">         let body = &quot;&quot;;</span>
<a href="#l41.42"></a><span id="l41.42">         switch (aItipItem.responseMethod) {</span>
<a href="#l41.43"></a><span id="l41.43">             case &quot;REQUEST&quot;:</span>
<a href="#l41.44"></a><span id="l41.44">                 let usePrefixes = Preferences.get(</span>
<a href="#l41.45"></a><span id="l41.45">                     &quot;calendar.itip.useInvitationSubjectPrefixes&quot;,</span>
<a href="#l41.46"></a><span id="l41.46">                     true</span>
<a href="#l41.47"></a><span id="l41.47">                 );</span>
<a href="#l41.48"></a><span id="l41.48">                 if (!usePrefixes) {</span>
<a href="#l41.49"></a><span id="l41.49">                     subject = summary;</span>
<a href="#l41.50"></a><span id="l41.50">                 } else {</span>
<a href="#l41.51"></a><span id="l41.51">                     let seq = item.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l41.52"></a><span id="l41.52" class="difflineminus">-                    let subjectKey = (seq &amp;&amp; seq &gt; 0)</span>
<a href="#l41.53"></a><span id="l41.53" class="difflineplus">+                    let subjectKey = seq &amp;&amp; seq &gt; 0</span>
<a href="#l41.54"></a><span id="l41.54">                         ? &quot;itipRequestUpdatedSubject&quot;</span>
<a href="#l41.55"></a><span id="l41.55">                         : &quot;itipRequestSubject&quot;;</span>
<a href="#l41.56"></a><span id="l41.56">                     subject = cal.calGetString(</span>
<a href="#l41.57"></a><span id="l41.57">                         &quot;lightning&quot;,</span>
<a href="#l41.58"></a><span id="l41.58">                         subjectKey,</span>
<a href="#l41.59"></a><span id="l41.59">                         [summary],</span>
<a href="#l41.60"></a><span id="l41.60">                         &quot;lightning&quot;</span>
<a href="#l41.61"></a><span id="l41.61">                     );</span>
<a href="#l41.62"></a><span id="l41.62" class="difflineat">@@ -213,25 +210,25 @@ calItipEmailTransport.prototype = {</span>
<a href="#l41.63"></a><span id="l41.63">         }</span>
<a href="#l41.64"></a><span id="l41.64">         if (!identity) { // use some default identity/account:</span>
<a href="#l41.65"></a><span id="l41.65">             identity = this.mDefaultIdentity;</span>
<a href="#l41.66"></a><span id="l41.66">             account = this.mDefaultAccount;</span>
<a href="#l41.67"></a><span id="l41.67">         }</span>
<a href="#l41.68"></a><span id="l41.68"> </span>
<a href="#l41.69"></a><span id="l41.69">         let compatMode = 0;</span>
<a href="#l41.70"></a><span id="l41.70">         switch (aItem.autoResponse) {</span>
<a href="#l41.71"></a><span id="l41.71" class="difflineminus">-            case (Components.interfaces.calIItipItem.USER): {</span>
<a href="#l41.72"></a><span id="l41.72" class="difflineplus">+            case Components.interfaces.calIItipItem.USER: {</span>
<a href="#l41.73"></a><span id="l41.73">                 cal.LOG(&quot;sendXpcomMail: Found USER autoResponse type.\n&quot; +</span>
<a href="#l41.74"></a><span id="l41.74">                         &quot;This type is currently unsupported, the compose API will always enter a text/plain\n&quot; +</span>
<a href="#l41.75"></a><span id="l41.75">                         &quot;or text/html part as first part of the message.\n&quot; +</span>
<a href="#l41.76"></a><span id="l41.76">                         &quot;This will disable OL (up to 2003) to consume the mail as an iTIP invitation showing\n&quot; +</span>
<a href="#l41.77"></a><span id="l41.77">                         &quot;the usual calendar buttons.&quot;);</span>
<a href="#l41.78"></a><span id="l41.78">                 // To somehow have a last resort before sending spam, the user can choose to send the mail.</span>
<a href="#l41.79"></a><span id="l41.79">                 let prefCompatMode = Preferences.get(&quot;calendar.itip.compatSendMode&quot;, 0);</span>
<a href="#l41.80"></a><span id="l41.80" class="difflineminus">-                let inoutCheck = { value: (prefCompatMode == 1) };</span>
<a href="#l41.81"></a><span id="l41.81" class="difflineplus">+                let inoutCheck = { value: prefCompatMode == 1 };</span>
<a href="#l41.82"></a><span id="l41.82">                 let parent = Services.wm.getMostRecentWindow(null);</span>
<a href="#l41.83"></a><span id="l41.83">                 if (parent.closed) {</span>
<a href="#l41.84"></a><span id="l41.84">                     parent = cal.getCalendarWindow();</span>
<a href="#l41.85"></a><span id="l41.85">                 }</span>
<a href="#l41.86"></a><span id="l41.86">                 if (Services.prompt.confirmEx(parent,</span>
<a href="#l41.87"></a><span id="l41.87">                                               cal.calGetString(&quot;lightning&quot;, &quot;imipSendMail.title&quot;, null, &quot;lightning&quot;),</span>
<a href="#l41.88"></a><span id="l41.88">                                               cal.calGetString(&quot;lightning&quot;, &quot;imipSendMail.text&quot;, null, &quot;lightning&quot;),</span>
<a href="#l41.89"></a><span id="l41.89">                                               Services.prompt.STD_YES_NO_BUTTONS,</span>
<a href="#l41.90"></a><span id="l41.90" class="difflineat">@@ -243,29 +240,29 @@ calItipEmailTransport.prototype = {</span>
<a href="#l41.91"></a><span id="l41.91">                     break;</span>
<a href="#l41.92"></a><span id="l41.92">                 } // else go on with auto sending for now</span>
<a href="#l41.93"></a><span id="l41.93">                 compatMode = (inoutCheck.value ? 1 : 0);</span>
<a href="#l41.94"></a><span id="l41.94">                 if (compatMode != prefCompatMode) {</span>
<a href="#l41.95"></a><span id="l41.95">                     Preferences.set(&quot;calendar.itip.compatSendMode&quot;, compatMode);</span>
<a href="#l41.96"></a><span id="l41.96">                 }</span>
<a href="#l41.97"></a><span id="l41.97">             }</span>
<a href="#l41.98"></a><span id="l41.98">             // falls through, based on prompting above</span>
<a href="#l41.99"></a><span id="l41.99" class="difflineminus">-            case (Components.interfaces.calIItipItem.AUTO): {</span>
<a href="#l41.100"></a><span id="l41.100" class="difflineplus">+            case Components.interfaces.calIItipItem.AUTO: {</span>
<a href="#l41.101"></a><span id="l41.101">                 // don't show log message in case of falling through</span>
<a href="#l41.102"></a><span id="l41.102">                 if (aItem.autoResponse == Components.interfaces.calIItipItem.AUTO) {</span>
<a href="#l41.103"></a><span id="l41.103">                     cal.LOG(&quot;sendXpcomMail: Found AUTO autoResponse type.&quot;);</span>
<a href="#l41.104"></a><span id="l41.104">                 }</span>
<a href="#l41.105"></a><span id="l41.105">                 let cbEmail = function(aVal, aInd, aArr) {</span>
<a href="#l41.106"></a><span id="l41.106">                     let email = cal.getAttendeeEmail(aVal, true);</span>
<a href="#l41.107"></a><span id="l41.107">                     if (!email.length) {</span>
<a href="#l41.108"></a><span id="l41.108">                         cal.LOG(&quot;Invalid recipient for email transport: &quot; + aVal.toString());</span>
<a href="#l41.109"></a><span id="l41.109">                     }</span>
<a href="#l41.110"></a><span id="l41.110">                     return email;</span>
<a href="#l41.111"></a><span id="l41.111">                 };</span>
<a href="#l41.112"></a><span id="l41.112" class="difflineminus">-                let toMap = aToList.map(cbEmail).filter(function(aVal, aInd, aArr) {return (aVal.length);});</span>
<a href="#l41.113"></a><span id="l41.113" class="difflineplus">+                let toMap = aToList.map(cbEmail).filter(v =&gt; v.length);</span>
<a href="#l41.114"></a><span id="l41.114">                 if (toMap.length &lt; aToList.length) {</span>
<a href="#l41.115"></a><span id="l41.115">                     // at least one invalid recipient, so we skip sending for this message</span>
<a href="#l41.116"></a><span id="l41.116">                     return false;</span>
<a href="#l41.117"></a><span id="l41.117">                 }</span>
<a href="#l41.118"></a><span id="l41.118">                 let toList = toMap.join(', ');</span>
<a href="#l41.119"></a><span id="l41.119">                 let composeUtils = Components.classes[&quot;@mozilla.org/messengercompose/computils;1&quot;]</span>
<a href="#l41.120"></a><span id="l41.120">                                              .createInstance(Components.interfaces.nsIMsgCompUtils);</span>
<a href="#l41.121"></a><span id="l41.121">                 let messageId = composeUtils.msgGenerateMessageId(identity);</span>
<a href="#l41.122"></a><span id="l41.122" class="difflineat">@@ -313,17 +310,17 @@ calItipEmailTransport.prototype = {</span>
<a href="#l41.123"></a><span id="l41.123">                                             null  /* nsIMsgDBHdr msgToReplace */,</span>
<a href="#l41.124"></a><span id="l41.124">                                             null  /* nsIMsgSendListener aListener */,</span>
<a href="#l41.125"></a><span id="l41.125">                                             null  /* nsIMsgStatusFeedback aStatusFeedback */,</span>
<a href="#l41.126"></a><span id="l41.126">                                             &quot;&quot;    /* password */);</span>
<a href="#l41.127"></a><span id="l41.127">                     return true;</span>
<a href="#l41.128"></a><span id="l41.128">                 }</span>
<a href="#l41.129"></a><span id="l41.129">                 break;</span>
<a href="#l41.130"></a><span id="l41.130">             }</span>
<a href="#l41.131"></a><span id="l41.131" class="difflineminus">-            case (Components.interfaces.calIItipItem.NONE):</span>
<a href="#l41.132"></a><span id="l41.132" class="difflineplus">+            case Components.interfaces.calIItipItem.NONE:</span>
<a href="#l41.133"></a><span id="l41.133">                 cal.LOG(&quot;sendXpcomMail: Found NONE autoResponse type.&quot;);</span>
<a href="#l41.134"></a><span id="l41.134"> </span>
<a href="#l41.135"></a><span id="l41.135">                 // No response</span>
<a href="#l41.136"></a><span id="l41.136">                 break;</span>
<a href="#l41.137"></a><span id="l41.137">             default:</span>
<a href="#l41.138"></a><span id="l41.138">                 // Unknown autoResponse type</span>
<a href="#l41.139"></a><span id="l41.139">                 throw new Error(&quot;sendXpcomMail: &quot; +</span>
<a href="#l41.140"></a><span id="l41.140">                                 &quot;Unknown autoResponse type: &quot; +</span>
<a href="#l41.141"></a><span id="l41.141" class="difflineat">@@ -345,52 +342,52 @@ calItipEmailTransport.prototype = {</span>
<a href="#l41.142"></a><span id="l41.142">             let utf8CalText = ltn.invitation.encodeUTF8(calText);</span>
<a href="#l41.143"></a><span id="l41.143"> </span>
<a href="#l41.144"></a><span id="l41.144">             // Home-grown mail composition; I'd love to use nsIMimeEmitter, but it's not clear to me whether</span>
<a href="#l41.145"></a><span id="l41.145">             // it can cope with nested attachments,</span>
<a href="#l41.146"></a><span id="l41.146">             // like multipart/alternative with enclosed text/calendar and text/plain.</span>
<a href="#l41.147"></a><span id="l41.147">             let mailText = ltn.invitation.getHeaderSection(aMessageId, aIdentity, aToList, aSubject);</span>
<a href="#l41.148"></a><span id="l41.148">             switch (compatMode) {</span>
<a href="#l41.149"></a><span id="l41.149">                 case 1:</span>
<a href="#l41.150"></a><span id="l41.150" class="difflineminus">-                    mailText += (&quot;Content-class: urn:content-classes:calendarmessage\r\n&quot; +</span>
<a href="#l41.151"></a><span id="l41.151" class="difflineminus">-                                 &quot;Content-type: text/calendar; method=&quot; + aItem.responseMethod + &quot;; charset=UTF-8\r\n&quot; +</span>
<a href="#l41.152"></a><span id="l41.152" class="difflineminus">-                                 &quot;Content-transfer-encoding: 8BIT\r\n&quot; +</span>
<a href="#l41.153"></a><span id="l41.153" class="difflineminus">-                                 &quot;\r\n&quot; +</span>
<a href="#l41.154"></a><span id="l41.154" class="difflineminus">-                                 utf8CalText +</span>
<a href="#l41.155"></a><span id="l41.155" class="difflineminus">-                                 &quot;\r\n&quot;);</span>
<a href="#l41.156"></a><span id="l41.156" class="difflineplus">+                    mailText += &quot;Content-class: urn:content-classes:calendarmessage\r\n&quot; +</span>
<a href="#l41.157"></a><span id="l41.157" class="difflineplus">+                                &quot;Content-type: text/calendar; method=&quot; + aItem.responseMethod + &quot;; charset=UTF-8\r\n&quot; +</span>
<a href="#l41.158"></a><span id="l41.158" class="difflineplus">+                                &quot;Content-transfer-encoding: 8BIT\r\n&quot; +</span>
<a href="#l41.159"></a><span id="l41.159" class="difflineplus">+                                &quot;\r\n&quot; +</span>
<a href="#l41.160"></a><span id="l41.160" class="difflineplus">+                                utf8CalText +</span>
<a href="#l41.161"></a><span id="l41.161" class="difflineplus">+                                &quot;\r\n&quot;;</span>
<a href="#l41.162"></a><span id="l41.162">                     break;</span>
<a href="#l41.163"></a><span id="l41.163">                 default:</span>
<a href="#l41.164"></a><span id="l41.164" class="difflineminus">-                    mailText += (&quot;Content-type: multipart/mixed; boundary=\&quot;Boundary_(ID_qyG4ZdjoAsiZ+Jo19dCbWQ)\&quot;\r\n&quot; +</span>
<a href="#l41.165"></a><span id="l41.165" class="difflineminus">-                                 &quot;\r\n\r\n&quot; +</span>
<a href="#l41.166"></a><span id="l41.166" class="difflineminus">-                                 &quot;--Boundary_(ID_qyG4ZdjoAsiZ+Jo19dCbWQ)\r\n&quot; +</span>
<a href="#l41.167"></a><span id="l41.167" class="difflineminus">-                                 &quot;Content-type: multipart/alternative;\r\n&quot; +</span>
<a href="#l41.168"></a><span id="l41.168" class="difflineminus">-                                 &quot; boundary=\&quot;Boundary_(ID_ryU4ZdJoASiZ+Jo21dCbwA)\&quot;\r\n&quot; +</span>
<a href="#l41.169"></a><span id="l41.169" class="difflineminus">-                                 &quot;\r\n\r\n&quot; +</span>
<a href="#l41.170"></a><span id="l41.170" class="difflineminus">-                                 &quot;--Boundary_(ID_ryU4ZdJoASiZ+Jo21dCbwA)\r\n&quot; +</span>
<a href="#l41.171"></a><span id="l41.171" class="difflineminus">-                                 &quot;Content-type: text/plain; charset=UTF-8\r\n&quot; +</span>
<a href="#l41.172"></a><span id="l41.172" class="difflineminus">-                                 &quot;Content-transfer-encoding: 8BIT\r\n&quot; +</span>
<a href="#l41.173"></a><span id="l41.173" class="difflineminus">-                                 &quot;\r\n&quot; +</span>
<a href="#l41.174"></a><span id="l41.174" class="difflineminus">-                                 ltn.invitation.encodeUTF8(aBody) +</span>
<a href="#l41.175"></a><span id="l41.175" class="difflineminus">-                                 &quot;\r\n\r\n\r\n&quot; +</span>
<a href="#l41.176"></a><span id="l41.176" class="difflineminus">-                                 &quot;--Boundary_(ID_ryU4ZdJoASiZ+Jo21dCbwA)\r\n&quot; +</span>
<a href="#l41.177"></a><span id="l41.177" class="difflineminus">-                                 &quot;Content-type: text/calendar; method=&quot; + aItem.responseMethod + &quot;; charset=UTF-8\r\n&quot; +</span>
<a href="#l41.178"></a><span id="l41.178" class="difflineminus">-                                 &quot;Content-transfer-encoding: 8BIT\r\n&quot; +</span>
<a href="#l41.179"></a><span id="l41.179" class="difflineminus">-                                 &quot;\r\n&quot; +</span>
<a href="#l41.180"></a><span id="l41.180" class="difflineminus">-                                 utf8CalText +</span>
<a href="#l41.181"></a><span id="l41.181" class="difflineminus">-                                 &quot;\r\n\r\n&quot; +</span>
<a href="#l41.182"></a><span id="l41.182" class="difflineminus">-                                 &quot;--Boundary_(ID_ryU4ZdJoASiZ+Jo21dCbwA)--\r\n&quot; +</span>
<a href="#l41.183"></a><span id="l41.183" class="difflineminus">-                                 &quot;\r\n&quot; +</span>
<a href="#l41.184"></a><span id="l41.184" class="difflineminus">-                                 &quot;--Boundary_(ID_qyG4ZdjoAsiZ+Jo19dCbWQ)\r\n&quot; +</span>
<a href="#l41.185"></a><span id="l41.185" class="difflineminus">-                                 &quot;Content-type: application/ics; name=invite.ics\r\n&quot; +</span>
<a href="#l41.186"></a><span id="l41.186" class="difflineminus">-                                 &quot;Content-transfer-encoding: 8BIT\r\n&quot; +</span>
<a href="#l41.187"></a><span id="l41.187" class="difflineminus">-                                 &quot;Content-disposition: attachment; filename=invite.ics\r\n&quot; +</span>
<a href="#l41.188"></a><span id="l41.188" class="difflineminus">-                                 &quot;\r\n&quot; +</span>
<a href="#l41.189"></a><span id="l41.189" class="difflineminus">-                                 utf8CalText +</span>
<a href="#l41.190"></a><span id="l41.190" class="difflineminus">-                                 &quot;\r\n\r\n&quot; +</span>
<a href="#l41.191"></a><span id="l41.191" class="difflineminus">-                                 &quot;--Boundary_(ID_qyG4ZdjoAsiZ+Jo19dCbWQ)--\r\n&quot;);</span>
<a href="#l41.192"></a><span id="l41.192" class="difflineplus">+                    mailText += &quot;Content-type: multipart/mixed; boundary=\&quot;Boundary_(ID_qyG4ZdjoAsiZ+Jo19dCbWQ)\&quot;\r\n&quot; +</span>
<a href="#l41.193"></a><span id="l41.193" class="difflineplus">+                                &quot;\r\n\r\n&quot; +</span>
<a href="#l41.194"></a><span id="l41.194" class="difflineplus">+                                &quot;--Boundary_(ID_qyG4ZdjoAsiZ+Jo19dCbWQ)\r\n&quot; +</span>
<a href="#l41.195"></a><span id="l41.195" class="difflineplus">+                                &quot;Content-type: multipart/alternative;\r\n&quot; +</span>
<a href="#l41.196"></a><span id="l41.196" class="difflineplus">+                                &quot; boundary=\&quot;Boundary_(ID_ryU4ZdJoASiZ+Jo21dCbwA)\&quot;\r\n&quot; +</span>
<a href="#l41.197"></a><span id="l41.197" class="difflineplus">+                                &quot;\r\n\r\n&quot; +</span>
<a href="#l41.198"></a><span id="l41.198" class="difflineplus">+                                &quot;--Boundary_(ID_ryU4ZdJoASiZ+Jo21dCbwA)\r\n&quot; +</span>
<a href="#l41.199"></a><span id="l41.199" class="difflineplus">+                                &quot;Content-type: text/plain; charset=UTF-8\r\n&quot; +</span>
<a href="#l41.200"></a><span id="l41.200" class="difflineplus">+                                &quot;Content-transfer-encoding: 8BIT\r\n&quot; +</span>
<a href="#l41.201"></a><span id="l41.201" class="difflineplus">+                                &quot;\r\n&quot; +</span>
<a href="#l41.202"></a><span id="l41.202" class="difflineplus">+                                ltn.invitation.encodeUTF8(aBody) +</span>
<a href="#l41.203"></a><span id="l41.203" class="difflineplus">+                                &quot;\r\n\r\n\r\n&quot; +</span>
<a href="#l41.204"></a><span id="l41.204" class="difflineplus">+                                &quot;--Boundary_(ID_ryU4ZdJoASiZ+Jo21dCbwA)\r\n&quot; +</span>
<a href="#l41.205"></a><span id="l41.205" class="difflineplus">+                                &quot;Content-type: text/calendar; method=&quot; + aItem.responseMethod + &quot;; charset=UTF-8\r\n&quot; +</span>
<a href="#l41.206"></a><span id="l41.206" class="difflineplus">+                                &quot;Content-transfer-encoding: 8BIT\r\n&quot; +</span>
<a href="#l41.207"></a><span id="l41.207" class="difflineplus">+                                &quot;\r\n&quot; +</span>
<a href="#l41.208"></a><span id="l41.208" class="difflineplus">+                                utf8CalText +</span>
<a href="#l41.209"></a><span id="l41.209" class="difflineplus">+                                &quot;\r\n\r\n&quot; +</span>
<a href="#l41.210"></a><span id="l41.210" class="difflineplus">+                                &quot;--Boundary_(ID_ryU4ZdJoASiZ+Jo21dCbwA)--\r\n&quot; +</span>
<a href="#l41.211"></a><span id="l41.211" class="difflineplus">+                                &quot;\r\n&quot; +</span>
<a href="#l41.212"></a><span id="l41.212" class="difflineplus">+                                &quot;--Boundary_(ID_qyG4ZdjoAsiZ+Jo19dCbWQ)\r\n&quot; +</span>
<a href="#l41.213"></a><span id="l41.213" class="difflineplus">+                                &quot;Content-type: application/ics; name=invite.ics\r\n&quot; +</span>
<a href="#l41.214"></a><span id="l41.214" class="difflineplus">+                                &quot;Content-transfer-encoding: 8BIT\r\n&quot; +</span>
<a href="#l41.215"></a><span id="l41.215" class="difflineplus">+                                &quot;Content-disposition: attachment; filename=invite.ics\r\n&quot; +</span>
<a href="#l41.216"></a><span id="l41.216" class="difflineplus">+                                &quot;\r\n&quot; +</span>
<a href="#l41.217"></a><span id="l41.217" class="difflineplus">+                                utf8CalText +</span>
<a href="#l41.218"></a><span id="l41.218" class="difflineplus">+                                &quot;\r\n\r\n&quot; +</span>
<a href="#l41.219"></a><span id="l41.219" class="difflineplus">+                                &quot;--Boundary_(ID_qyG4ZdjoAsiZ+Jo19dCbWQ)--\r\n&quot;;</span>
<a href="#l41.220"></a><span id="l41.220">                     break;</span>
<a href="#l41.221"></a><span id="l41.221">             }</span>
<a href="#l41.222"></a><span id="l41.222">             cal.LOG(&quot;mail text:\n&quot; + mailText);</span>
<a href="#l41.223"></a><span id="l41.223"> </span>
<a href="#l41.224"></a><span id="l41.224">             let tempFile = Services.dirsvc.get(&quot;TmpD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l41.225"></a><span id="l41.225">             tempFile.append(&quot;itipTemp&quot;);</span>
<a href="#l41.226"></a><span id="l41.226">             tempFile.createUnique(Components.interfaces.nsIFile.NORMAL_FILE_TYPE,</span>
<a href="#l41.227"></a><span id="l41.227">                                   parseInt(&quot;0600&quot;, 8));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -225,17 +225,17 @@ ltn.invitation = {</span>
<a href="#l42.4"></a><span id="l42.4">             // display itip icon</span>
<a href="#l42.5"></a><span id="l42.5">             let role = aAttendee.role || &quot;REQ-PARTICIPANT&quot;;</span>
<a href="#l42.6"></a><span id="l42.6">             let ps = aAttendee.participationStatus || &quot;NEEDS-ACTION&quot;;</span>
<a href="#l42.7"></a><span id="l42.7">             let ut = aAttendee.userType || &quot;INDIVIDUAL&quot;;</span>
<a href="#l42.8"></a><span id="l42.8">             let itipIcon = row.getElementsByClassName(&quot;itip-icon&quot;)[0];</span>
<a href="#l42.9"></a><span id="l42.9">             itipIcon.setAttribute(&quot;role&quot;, role);</span>
<a href="#l42.10"></a><span id="l42.10">             itipIcon.setAttribute(&quot;usertype&quot;, ut);</span>
<a href="#l42.11"></a><span id="l42.11">             itipIcon.setAttribute(&quot;partstat&quot;, ps);</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-            let attName = (aAttendee.commonName &amp;&amp; aAttendee.commonName.length)</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+            let attName = aAttendee.commonName &amp;&amp; aAttendee.commonName.length</span>
<a href="#l42.14"></a><span id="l42.14">                           ? aAttendee.commonName : aAttendee.toString();</span>
<a href="#l42.15"></a><span id="l42.15">             let utString = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.attendeeUserType2.&quot; + ut,</span>
<a href="#l42.16"></a><span id="l42.16">                                          [aAttendee.toString()]);</span>
<a href="#l42.17"></a><span id="l42.17">             let roleString = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.attendeeRole2.&quot; + role,</span>
<a href="#l42.18"></a><span id="l42.18">                                            [utString]);</span>
<a href="#l42.19"></a><span id="l42.19">             let psString = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.attendeePartStat2.&quot; + ps,</span>
<a href="#l42.20"></a><span id="l42.20">                                          [attName, del.delegatees]);</span>
<a href="#l42.21"></a><span id="l42.21">             let itipTooltip = ltn.getString(&quot;lightning&quot;, &quot;imipHtml.attendee.combined&quot;,</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -276,17 +276,17 @@ ltn.invitation = {</span>
<a href="#l42.23"></a><span id="l42.23">          * @param {String}  aText   [optional]</span>
<a href="#l42.24"></a><span id="l42.24">          * @param {Boolean} aClear  [optional] for consecutive changes on the same node, set to false</span>
<a href="#l42.25"></a><span id="l42.25">          */</span>
<a href="#l42.26"></a><span id="l42.26">         function _content2Child(aToNode, aType, aText = '', aClear = true) {</span>
<a href="#l42.27"></a><span id="l42.27">             let nodeDoc = aToNode.ownerDocument;</span>
<a href="#l42.28"></a><span id="l42.28">             if (aClear &amp;&amp; aToNode.hasChildNodes()) {</span>
<a href="#l42.29"></a><span id="l42.29">                 aToNode.removeChild(aToNode.firstChild);</span>
<a href="#l42.30"></a><span id="l42.30">             }</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-            let n = nodeDoc.createElement((aType.toLowerCase() == 'newline') ? 'br' : 'span');</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+            let n = nodeDoc.createElement(aType.toLowerCase() == 'newline' ? 'br' : 'span');</span>
<a href="#l42.33"></a><span id="l42.33">             switch (aType) {</span>
<a href="#l42.34"></a><span id="l42.34">                 case 'added':</span>
<a href="#l42.35"></a><span id="l42.35">                 case 'modified':</span>
<a href="#l42.36"></a><span id="l42.36">                 case 'removed':</span>
<a href="#l42.37"></a><span id="l42.37">                     n.className = aType;</span>
<a href="#l42.38"></a><span id="l42.38">                     if (Preferences.get('calendar.view.useSystemColors', false)) {</span>
<a href="#l42.39"></a><span id="l42.39">                         n.setAttribute('systemcolors', true);</span>
<a href="#l42.40"></a><span id="l42.40">                     }</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineat">@@ -311,17 +311,17 @@ ltn.invitation = {</span>
<a href="#l42.42"></a><span id="l42.42">             }</span>
<a href="#l42.43"></a><span id="l42.43">             return attendees;</span>
<a href="#l42.44"></a><span id="l42.44">         }</span>
<a href="#l42.45"></a><span id="l42.45">         /**</span>
<a href="#l42.46"></a><span id="l42.46">          * Compares both documents for elements related to the given name</span>
<a href="#l42.47"></a><span id="l42.47">          * @param {String} aElement  part of the element id within the html template</span>
<a href="#l42.48"></a><span id="l42.48">          */</span>
<a href="#l42.49"></a><span id="l42.49">         function _compareElement(aElement) {</span>
<a href="#l42.50"></a><span id="l42.50" class="difflineminus">-            let element = (aElement == 'attendee') ? aElement + 's' : aElement;</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+            let element = aElement == 'attendee' ? aElement + 's' : aElement;</span>
<a href="#l42.52"></a><span id="l42.52">             let oldRow = aOldDoc.getElementById('imipHtml-' + element + '-row');</span>
<a href="#l42.53"></a><span id="l42.53">             let newRow = aNewDoc.getElementById('imipHtml-' + element + '-row');</span>
<a href="#l42.54"></a><span id="l42.54">             let row = doc.getElementById('imipHtml-' + element + '-row');</span>
<a href="#l42.55"></a><span id="l42.55">             let oldContent = aOldDoc.getElementById('imipHtml-' + aElement + '-content');</span>
<a href="#l42.56"></a><span id="l42.56">             let content = doc.getElementById('imipHtml-' + aElement + '-content');</span>
<a href="#l42.57"></a><span id="l42.57"> </span>
<a href="#l42.58"></a><span id="l42.58">             if (newRow.hidden &amp;&amp; !oldRow.hidden) {</span>
<a href="#l42.59"></a><span id="l42.59">                 // element was removed</span>
<a href="#l42.60"></a><span id="l42.60" class="difflineat">@@ -358,18 +358,18 @@ ltn.invitation = {</span>
<a href="#l42.61"></a><span id="l42.61">                         for (let att of Object.keys(attendees)) {</span>
<a href="#l42.62"></a><span id="l42.62">                             if (!(att in oldAttendees)) {</span>
<a href="#l42.63"></a><span id="l42.63">                                 _content2Child(attendees[att], 'added', att);</span>
<a href="#l42.64"></a><span id="l42.64">                             }</span>
<a href="#l42.65"></a><span id="l42.65">                         }</span>
<a href="#l42.66"></a><span id="l42.66">                         for (let att of Object.keys(oldAttendees)) {</span>
<a href="#l42.67"></a><span id="l42.67">                             // if att is the user his/herself, who accepted an invitation he/she was</span>
<a href="#l42.68"></a><span id="l42.68">                             // not invited to, we exclude him/her from decoration</span>
<a href="#l42.69"></a><span id="l42.69" class="difflineminus">-                            let notExcluded = (excludeAddress == &quot;&quot; ||</span>
<a href="#l42.70"></a><span id="l42.70" class="difflineminus">-                                               !att.includes(excludeAddress));</span>
<a href="#l42.71"></a><span id="l42.71" class="difflineplus">+                            let notExcluded = excludeAddress == &quot;&quot; ||</span>
<a href="#l42.72"></a><span id="l42.72" class="difflineplus">+                                               !att.includes(excludeAddress);</span>
<a href="#l42.73"></a><span id="l42.73">                             // decorate removed attendees</span>
<a href="#l42.74"></a><span id="l42.74">                             if (!(att in attendees) &amp;&amp; notExcluded) {</span>
<a href="#l42.75"></a><span id="l42.75">                                 _content2Child(oldAttendees[att], 'removed', att);</span>
<a href="#l42.76"></a><span id="l42.76">                                 content.appendChild(oldAttendees[att].parentNode.cloneNode(true));</span>
<a href="#l42.77"></a><span id="l42.77">                             } else if ((att in attendees) &amp;&amp; notExcluded) {</span>
<a href="#l42.78"></a><span id="l42.78">                                 // highlight partstat, role or usertype changes</span>
<a href="#l42.79"></a><span id="l42.79">                                 let oldAtts = oldAttendees[att].parentNode</span>
<a href="#l42.80"></a><span id="l42.80">                                                                .getElementsByClassName(&quot;itip-icon&quot;)[0]</span>
<a href="#l42.81"></a><span id="l42.81" class="difflineat">@@ -404,40 +404,40 @@ ltn.invitation = {</span>
<a href="#l42.82"></a><span id="l42.82">      * @param   {String}         aMessageId  the message id to use for that email</span>
<a href="#l42.83"></a><span id="l42.83">      * @param   {nsIMsgIdentity} aIdentity   the identity to use for that email</span>
<a href="#l42.84"></a><span id="l42.84">      * @returns {String}                     the source code of the header section of the email</span>
<a href="#l42.85"></a><span id="l42.85">      */</span>
<a href="#l42.86"></a><span id="l42.86">     getHeaderSection: function(aMessageId, aIdentity, aToList, aSubject) {</span>
<a href="#l42.87"></a><span id="l42.87">         let from = !aIdentity.fullName.length ? aIdentity.email</span>
<a href="#l42.88"></a><span id="l42.88">                                               : cal.validateRecipientList(aIdentity.fullName +</span>
<a href="#l42.89"></a><span id="l42.89">                                                                           &quot; &lt;&quot; + aIdentity.email + &quot;&gt;&quot;);</span>
<a href="#l42.90"></a><span id="l42.90" class="difflineminus">-        let header = (&quot;MIME-version: 1.0\r\n&quot; +</span>
<a href="#l42.91"></a><span id="l42.91" class="difflineminus">-                      (aIdentity.replyTo ? &quot;Return-path: &quot; +</span>
<a href="#l42.92"></a><span id="l42.92" class="difflineminus">-                                           ltn.invitation.encodeMimeHeader(aIdentity.replyTo, true) +</span>
<a href="#l42.93"></a><span id="l42.93" class="difflineminus">-                                           &quot;\r\n&quot; : &quot;&quot;) +</span>
<a href="#l42.94"></a><span id="l42.94" class="difflineminus">-                      &quot;From: &quot; + ltn.invitation.encodeMimeHeader(from, true) + &quot;\r\n&quot; +</span>
<a href="#l42.95"></a><span id="l42.95" class="difflineminus">-                      (aIdentity.organization ? &quot;Organization: &quot; +</span>
<a href="#l42.96"></a><span id="l42.96" class="difflineminus">-                                                ltn.invitation.encodeMimeHeader(aIdentity.organization) +</span>
<a href="#l42.97"></a><span id="l42.97" class="difflineminus">-                                                &quot;\r\n&quot; : &quot;&quot;) +</span>
<a href="#l42.98"></a><span id="l42.98" class="difflineminus">-                      &quot;Message-ID: &quot; + aMessageId + &quot;\r\n&quot; +</span>
<a href="#l42.99"></a><span id="l42.99" class="difflineminus">-                      &quot;To: &quot; + ltn.invitation.encodeMimeHeader(aToList, true) + &quot;\r\n&quot; +</span>
<a href="#l42.100"></a><span id="l42.100" class="difflineminus">-                      &quot;Date: &quot; + ltn.invitation.getRfc5322FormattedDate() + &quot;\r\n&quot; +</span>
<a href="#l42.101"></a><span id="l42.101" class="difflineminus">-                      &quot;Subject: &quot; + ltn.invitation</span>
<a href="#l42.102"></a><span id="l42.102" class="difflineminus">-                                       .encodeMimeHeader(aSubject.replace(/(\n|\r\n)/, &quot;|&quot;)) + &quot;\r\n&quot;);</span>
<a href="#l42.103"></a><span id="l42.103" class="difflineplus">+        let header = &quot;MIME-version: 1.0\r\n&quot; +</span>
<a href="#l42.104"></a><span id="l42.104" class="difflineplus">+                     (aIdentity.replyTo ? &quot;Return-path: &quot; +</span>
<a href="#l42.105"></a><span id="l42.105" class="difflineplus">+                                          ltn.invitation.encodeMimeHeader(aIdentity.replyTo, true) +</span>
<a href="#l42.106"></a><span id="l42.106" class="difflineplus">+                                          &quot;\r\n&quot; : &quot;&quot;) +</span>
<a href="#l42.107"></a><span id="l42.107" class="difflineplus">+                     &quot;From: &quot; + ltn.invitation.encodeMimeHeader(from, true) + &quot;\r\n&quot; +</span>
<a href="#l42.108"></a><span id="l42.108" class="difflineplus">+                     (aIdentity.organization ? &quot;Organization: &quot; +</span>
<a href="#l42.109"></a><span id="l42.109" class="difflineplus">+                                               ltn.invitation.encodeMimeHeader(aIdentity.organization) +</span>
<a href="#l42.110"></a><span id="l42.110" class="difflineplus">+                                               &quot;\r\n&quot; : &quot;&quot;) +</span>
<a href="#l42.111"></a><span id="l42.111" class="difflineplus">+                     &quot;Message-ID: &quot; + aMessageId + &quot;\r\n&quot; +</span>
<a href="#l42.112"></a><span id="l42.112" class="difflineplus">+                     &quot;To: &quot; + ltn.invitation.encodeMimeHeader(aToList, true) + &quot;\r\n&quot; +</span>
<a href="#l42.113"></a><span id="l42.113" class="difflineplus">+                     &quot;Date: &quot; + ltn.invitation.getRfc5322FormattedDate() + &quot;\r\n&quot; +</span>
<a href="#l42.114"></a><span id="l42.114" class="difflineplus">+                     &quot;Subject: &quot; + ltn.invitation</span>
<a href="#l42.115"></a><span id="l42.115" class="difflineplus">+                                      .encodeMimeHeader(aSubject.replace(/(\n|\r\n)/, &quot;|&quot;)) + &quot;\r\n&quot;;</span>
<a href="#l42.116"></a><span id="l42.116">         let validRecipients;</span>
<a href="#l42.117"></a><span id="l42.117">         if (aIdentity.doCc) {</span>
<a href="#l42.118"></a><span id="l42.118">             validRecipients = cal.validateRecipientList(aIdentity.doCcList);</span>
<a href="#l42.119"></a><span id="l42.119">             if (validRecipients != &quot;&quot;) {</span>
<a href="#l42.120"></a><span id="l42.120" class="difflineminus">-                header += (&quot;Cc: &quot; + ltn.invitation.encodeMimeHeader(validRecipients, true) + &quot;\r\n&quot;);</span>
<a href="#l42.121"></a><span id="l42.121" class="difflineplus">+                header += &quot;Cc: &quot; + ltn.invitation.encodeMimeHeader(validRecipients, true) + &quot;\r\n&quot;;</span>
<a href="#l42.122"></a><span id="l42.122">             }</span>
<a href="#l42.123"></a><span id="l42.123">         }</span>
<a href="#l42.124"></a><span id="l42.124">         if (aIdentity.doBcc) {</span>
<a href="#l42.125"></a><span id="l42.125">             validRecipients = cal.validateRecipientList(aIdentity.doBccList);</span>
<a href="#l42.126"></a><span id="l42.126">             if (validRecipients != &quot;&quot;) {</span>
<a href="#l42.127"></a><span id="l42.127" class="difflineminus">-                header += (&quot;Bcc: &quot; + ltn.invitation.encodeMimeHeader(validRecipients, true) + &quot;\r\n&quot;);</span>
<a href="#l42.128"></a><span id="l42.128" class="difflineplus">+                header += &quot;Bcc: &quot; + ltn.invitation.encodeMimeHeader(validRecipients, true) + &quot;\r\n&quot;;</span>
<a href="#l42.129"></a><span id="l42.129">             }</span>
<a href="#l42.130"></a><span id="l42.130">         }</span>
<a href="#l42.131"></a><span id="l42.131">         return header;</span>
<a href="#l42.132"></a><span id="l42.132">     },</span>
<a href="#l42.133"></a><span id="l42.133"> </span>
<a href="#l42.134"></a><span id="l42.134">     /**</span>
<a href="#l42.135"></a><span id="l42.135">      * Returns a datetime string according to section 3.3 of RfC5322</span>
<a href="#l42.136"></a><span id="l42.136">      * @param  {Date}   [optional] Js Date object to format; if not provided current DateTime is used</span>
<a href="#l42.137"></a><span id="l42.137" class="difflineat">@@ -483,17 +483,17 @@ ltn.invitation = {</span>
<a href="#l42.138"></a><span id="l42.138">     /**</span>
<a href="#l42.139"></a><span id="l42.139">      * Converts a header to a mime encoded header</span>
<a href="#l42.140"></a><span id="l42.140">      * @param  {String}  aHeader   a header to encode</span>
<a href="#l42.141"></a><span id="l42.141">      * @param  {boolean} aIsEmail  if enabled, only the CN but not the email address gets</span>
<a href="#l42.142"></a><span id="l42.142">      *                             converted - default value is false</span>
<a href="#l42.143"></a><span id="l42.143">      * @return {String}            the encoded string</span>
<a href="#l42.144"></a><span id="l42.144">      */</span>
<a href="#l42.145"></a><span id="l42.145">     encodeMimeHeader: function(aHeader, aIsEmail = false) {</span>
<a href="#l42.146"></a><span id="l42.146" class="difflineminus">-        let fieldNameLen = (aHeader.indexOf(&quot;: &quot;) + 2);</span>
<a href="#l42.147"></a><span id="l42.147" class="difflineplus">+        let fieldNameLen = aHeader.indexOf(&quot;: &quot;) + 2;</span>
<a href="#l42.148"></a><span id="l42.148">         return MailServices.mimeConverter</span>
<a href="#l42.149"></a><span id="l42.149">                            .encodeMimePartIIStr_UTF8(aHeader,</span>
<a href="#l42.150"></a><span id="l42.150">                                                      aIsEmail,</span>
<a href="#l42.151"></a><span id="l42.151">                                                      &quot;UTF-8&quot;,</span>
<a href="#l42.152"></a><span id="l42.152">                                                      fieldNameLen,</span>
<a href="#l42.153"></a><span id="l42.153">                                                      Components.interfaces</span>
<a href="#l42.154"></a><span id="l42.154">                                                                .nsIMimeConverter</span>
<a href="#l42.155"></a><span id="l42.155">                                                                .MIME_ENCODED_WORD_SIZE);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -236,17 +236,17 @@ calDavCalendar.prototype = {</span>
<a href="#l43.4"></a><span id="l43.4">             this.setupAuthentication(aChangeLogListener);</span>
<a href="#l43.5"></a><span id="l43.5">         } else {</span>
<a href="#l43.6"></a><span id="l43.6">             this.safeRefresh(aChangeLogListener);</span>
<a href="#l43.7"></a><span id="l43.7">         }</span>
<a href="#l43.8"></a><span id="l43.8">     },</span>
<a href="#l43.9"></a><span id="l43.9">     setMetaData: function caldav_setMetaData(id, path, etag, isInboxItem) {</span>
<a href="#l43.10"></a><span id="l43.10">         if (this.mOfflineStorage.setMetaData) {</span>
<a href="#l43.11"></a><span id="l43.11">             if (id) {</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-                let dataString = [etag, path, (isInboxItem ? &quot;true&quot; : &quot;false&quot;)].join(&quot;\u001A&quot;);</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+                let dataString = [etag, path, isInboxItem ? &quot;true&quot; : &quot;false&quot;].join(&quot;\u001A&quot;);</span>
<a href="#l43.14"></a><span id="l43.14">                 this.mOfflineStorage.setMetaData(id, dataString);</span>
<a href="#l43.15"></a><span id="l43.15">             } else {</span>
<a href="#l43.16"></a><span id="l43.16">                 cal.LOG(&quot;CalDAV: cannot store meta data without an id&quot;);</span>
<a href="#l43.17"></a><span id="l43.17">             }</span>
<a href="#l43.18"></a><span id="l43.18">         } else {</span>
<a href="#l43.19"></a><span id="l43.19">             cal.ERROR(&quot;CalDAV: calendar storage does not support meta data&quot;);</span>
<a href="#l43.20"></a><span id="l43.20">         }</span>
<a href="#l43.21"></a><span id="l43.21">     },</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineat">@@ -318,17 +318,17 @@ calDavCalendar.prototype = {</span>
<a href="#l43.23"></a><span id="l43.23">                 let isInboxItem = itemDataArray[2];</span>
<a href="#l43.24"></a><span id="l43.24">                 if (itemDataArray.length == 3) {</span>
<a href="#l43.25"></a><span id="l43.25">                     this.mHrefIndex[resourcePath] = itemId;</span>
<a href="#l43.26"></a><span id="l43.26">                     let locationPath = resourcePath</span>
<a href="#l43.27"></a><span id="l43.27">                         .substr(this.mLocationPath.length);</span>
<a href="#l43.28"></a><span id="l43.28">                     let item = { etag: etag,</span>
<a href="#l43.29"></a><span id="l43.29">                                  isNew: false,</span>
<a href="#l43.30"></a><span id="l43.30">                                  locationPath: locationPath,</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-                                 isInboxItem: (isInboxItem == &quot;true&quot;) };</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+                                 isInboxItem: isInboxItem == &quot;true&quot; };</span>
<a href="#l43.33"></a><span id="l43.33">                     this.mItemInfoCache[itemId] = item;</span>
<a href="#l43.34"></a><span id="l43.34">                 }</span>
<a href="#l43.35"></a><span id="l43.35">             }</span>
<a href="#l43.36"></a><span id="l43.36">         }</span>
<a href="#l43.37"></a><span id="l43.37"> </span>
<a href="#l43.38"></a><span id="l43.38">         this.ensureMetaData();</span>
<a href="#l43.39"></a><span id="l43.39">     },</span>
<a href="#l43.40"></a><span id="l43.40"> </span>
<a href="#l43.41"></a><span id="l43.41" class="difflineat">@@ -372,17 +372,17 @@ calDavCalendar.prototype = {</span>
<a href="#l43.42"></a><span id="l43.42">             }</span>
<a href="#l43.43"></a><span id="l43.43"> </span>
<a href="#l43.44"></a><span id="l43.44">             self.mLastRedirectStatus = null;</span>
<a href="#l43.45"></a><span id="l43.45">             channel.asyncOpen(listener, channel);</span>
<a href="#l43.46"></a><span id="l43.46">         }</span>
<a href="#l43.47"></a><span id="l43.47"> </span>
<a href="#l43.48"></a><span id="l43.48">         const OAUTH_GRACE_TIME = 30 * 1000;</span>
<a href="#l43.49"></a><span id="l43.49"> </span>
<a href="#l43.50"></a><span id="l43.50" class="difflineminus">-        let usesGoogleOAuth = (aUri &amp;&amp; aUri.host == &quot;apidata.googleusercontent.com&quot; &amp;&amp; this.oauth);</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineplus">+        let usesGoogleOAuth = aUri &amp;&amp; aUri.host == &quot;apidata.googleusercontent.com&quot; &amp;&amp; this.oauth;</span>
<a href="#l43.52"></a><span id="l43.52">         let origArgs = arguments;</span>
<a href="#l43.53"></a><span id="l43.53">         let self = this;</span>
<a href="#l43.54"></a><span id="l43.54"> </span>
<a href="#l43.55"></a><span id="l43.55">         if (usesGoogleOAuth &amp;&amp; (</span>
<a href="#l43.56"></a><span id="l43.56">               !this.oauth.accessToken ||</span>
<a href="#l43.57"></a><span id="l43.57">               this.oauth.tokenExpires - OAUTH_GRACE_TIME &lt; (new Date()).getTime())) {</span>
<a href="#l43.58"></a><span id="l43.58">             // The token has expired, we need to reauthenticate first</span>
<a href="#l43.59"></a><span id="l43.59">             cal.LOG(&quot;CalDAV: OAuth token expired or empty, refreshing&quot;);</span>
<a href="#l43.60"></a><span id="l43.60" class="difflineat">@@ -559,19 +559,19 @@ calDavCalendar.prototype = {</span>
<a href="#l43.61"></a><span id="l43.61">             case &quot;organizerCN&quot;:</span>
<a href="#l43.62"></a><span id="l43.62">                 return null; // xxx todo</span>
<a href="#l43.63"></a><span id="l43.63">             case &quot;itip.transport&quot;:</span>
<a href="#l43.64"></a><span id="l43.64">                 if (this.hasAutoScheduling || this.hasScheduling) {</span>
<a href="#l43.65"></a><span id="l43.65">                     return this.QueryInterface(Components.interfaces.calIItipTransport);</span>
<a href="#l43.66"></a><span id="l43.66">                 } // else use outbound email-based iTIP (from cal.ProviderBase)</span>
<a href="#l43.67"></a><span id="l43.67">                 break;</span>
<a href="#l43.68"></a><span id="l43.68">             case &quot;capabilities.tasks.supported&quot;:</span>
<a href="#l43.69"></a><span id="l43.69" class="difflineminus">-                return (this.supportedItemTypes.includes(&quot;VTODO&quot;));</span>
<a href="#l43.70"></a><span id="l43.70" class="difflineplus">+                return this.supportedItemTypes.includes(&quot;VTODO&quot;);</span>
<a href="#l43.71"></a><span id="l43.71">             case &quot;capabilities.events.supported&quot;:</span>
<a href="#l43.72"></a><span id="l43.72" class="difflineminus">-                return (this.supportedItemTypes.includes(&quot;VEVENT&quot;));</span>
<a href="#l43.73"></a><span id="l43.73" class="difflineplus">+                return this.supportedItemTypes.includes(&quot;VEVENT&quot;);</span>
<a href="#l43.74"></a><span id="l43.74">             case &quot;capabilities.autoschedule.supported&quot;:</span>
<a href="#l43.75"></a><span id="l43.75">                 return this.hasAutoScheduling;</span>
<a href="#l43.76"></a><span id="l43.76">         }</span>
<a href="#l43.77"></a><span id="l43.77">         return this.__proto__.__proto__.getProperty.apply(this, arguments);</span>
<a href="#l43.78"></a><span id="l43.78">     },</span>
<a href="#l43.79"></a><span id="l43.79"> </span>
<a href="#l43.80"></a><span id="l43.80">     promptOverwrite: function caldav_promptOverwrite(aMethod, aItem, aListener, aOldItem) {</span>
<a href="#l43.81"></a><span id="l43.81">         let overwrite = cal.promptOverwrite(aMethod, aItem, aListener, aOldItem);</span>
<a href="#l43.82"></a><span id="l43.82" class="difflineat">@@ -2613,19 +2613,19 @@ calDavCalendar.prototype = {</span>
<a href="#l43.83"></a><span id="l43.83">                 cal.WARN(&quot;CalDAV: Exception decoding path &quot; + aString + &quot;, segment: &quot; + uriComponents[i]);</span>
<a href="#l43.84"></a><span id="l43.84">             }</span>
<a href="#l43.85"></a><span id="l43.85">         }</span>
<a href="#l43.86"></a><span id="l43.86">         return uriComponents.join(&quot;/&quot;);</span>
<a href="#l43.87"></a><span id="l43.87">     },</span>
<a href="#l43.88"></a><span id="l43.88">     isInbox: function caldav_isInbox(aString) {</span>
<a href="#l43.89"></a><span id="l43.89">         // Note: If you change this, make sure it really returns a boolean</span>
<a href="#l43.90"></a><span id="l43.90">         // value and not null!</span>
<a href="#l43.91"></a><span id="l43.91" class="difflineminus">-        return ((this.hasScheduling || this.hasAutoScheduling) &amp;&amp;</span>
<a href="#l43.92"></a><span id="l43.92" class="difflineminus">-                (this.mInboxUrl != null) &amp;&amp;</span>
<a href="#l43.93"></a><span id="l43.93" class="difflineminus">-                aString.startsWith(this.mInboxUrl.spec));</span>
<a href="#l43.94"></a><span id="l43.94" class="difflineplus">+        return (this.hasScheduling || this.hasAutoScheduling) &amp;&amp;</span>
<a href="#l43.95"></a><span id="l43.95" class="difflineplus">+               this.mInboxUrl != null &amp;&amp;</span>
<a href="#l43.96"></a><span id="l43.96" class="difflineplus">+               aString.startsWith(this.mInboxUrl.spec);</span>
<a href="#l43.97"></a><span id="l43.97">     },</span>
<a href="#l43.98"></a><span id="l43.98"> </span>
<a href="#l43.99"></a><span id="l43.99">     /**</span>
<a href="#l43.100"></a><span id="l43.100">      * Query contents of scheduling inbox</span>
<a href="#l43.101"></a><span id="l43.101">      *</span>
<a href="#l43.102"></a><span id="l43.102">      */</span>
<a href="#l43.103"></a><span id="l43.103">     pollInbox: function caldav_pollInbox() {</span>
<a href="#l43.104"></a><span id="l43.104">         // If polling the inbox was switched off, no need to poll the inbox.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -566,17 +566,17 @@ webDavSyncHandler.prototype = {</span>
<a href="#l44.4"></a><span id="l44.4">                            r.href &amp;&amp; r.href.length &amp;&amp;</span>
<a href="#l44.5"></a><span id="l44.5">                            (!r.status ||                 // Draft 3 does not require</span>
<a href="#l44.6"></a><span id="l44.6">                             r.status.length == 0 ||      // a status for created or updated items but</span>
<a href="#l44.7"></a><span id="l44.7">                             r.status.indexOf(&quot; 204&quot;) ||  // draft 0, 1 and 2 needed it so treat no status</span>
<a href="#l44.8"></a><span id="l44.8">                             r.status.indexOf(&quot; 200&quot;) ||  // Apple iCloud returns 200 status for each item</span>
<a href="#l44.9"></a><span id="l44.9">                             r.status.indexOf(&quot; 201&quot;))) { // and status 201 and 204 the same</span>
<a href="#l44.10"></a><span id="l44.10">                     this.itemsReported[r.href] = r.getetag;</span>
<a href="#l44.11"></a><span id="l44.11">                     let itemId = this.calendar.mHrefIndex[r.href];</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-                    let oldEtag = (itemId &amp;&amp; this.calendar.mItemInfoCache[itemId].etag);</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+                    let oldEtag = itemId &amp;&amp; this.calendar.mItemInfoCache[itemId].etag;</span>
<a href="#l44.14"></a><span id="l44.14"> </span>
<a href="#l44.15"></a><span id="l44.15">                     if (!oldEtag || oldEtag != r.getetag) {</span>
<a href="#l44.16"></a><span id="l44.16">                         // Etag mismatch, getting new/updated item.</span>
<a href="#l44.17"></a><span id="l44.17">                         this.itemsNeedFetching.push(r.href);</span>
<a href="#l44.18"></a><span id="l44.18">                     }</span>
<a href="#l44.19"></a><span id="l44.19">                 } else if (r.status &amp;&amp;</span>
<a href="#l44.20"></a><span id="l44.20">                            r.status.includes(&quot; 507&quot;)) {</span>
<a href="#l44.21"></a><span id="l44.21">                     // webdav-sync says that if a 507 is encountered and the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -128,17 +128,17 @@ calICSCalendar.prototype = {</span>
<a href="#l45.4"></a><span id="l45.4">         } else {</span>
<a href="#l45.5"></a><span id="l45.5">             this.mHooks = new dummyHooks(this);</span>
<a href="#l45.6"></a><span id="l45.6">         }</span>
<a href="#l45.7"></a><span id="l45.7">     },</span>
<a href="#l45.8"></a><span id="l45.8"> </span>
<a href="#l45.9"></a><span id="l45.9">     getProperty: function calICSCalendar_getProperty(aName) {</span>
<a href="#l45.10"></a><span id="l45.10">         switch (aName) {</span>
<a href="#l45.11"></a><span id="l45.11">             case &quot;requiresNetwork&quot;:</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-                return (!this.uri.schemeIs(&quot;file&quot;));</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+                return !this.uri.schemeIs(&quot;file&quot;);</span>
<a href="#l45.14"></a><span id="l45.14">         }</span>
<a href="#l45.15"></a><span id="l45.15">         return this.__proto__.__proto__.getProperty.apply(this, arguments);</span>
<a href="#l45.16"></a><span id="l45.16">     },</span>
<a href="#l45.17"></a><span id="l45.17"> </span>
<a href="#l45.18"></a><span id="l45.18">     refresh: function calICSCalendar_refresh() {</span>
<a href="#l45.19"></a><span id="l45.19">         this.queue.push({ action: 'refresh', forceRefresh: false });</span>
<a href="#l45.20"></a><span id="l45.20">         this.processQueue();</span>
<a href="#l45.21"></a><span id="l45.21">     },</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineat">@@ -656,20 +656,17 @@ calICSCalendar.prototype = {</span>
<a href="#l45.23"></a><span id="l45.23">         }</span>
<a href="#l45.24"></a><span id="l45.24"> </span>
<a href="#l45.25"></a><span id="l45.25">         function purgeBackupsByType(files, type) {</span>
<a href="#l45.26"></a><span id="l45.26">             // filter out backups of the type we care about.</span>
<a href="#l45.27"></a><span id="l45.27">             let filteredFiles = files.filter(</span>
<a href="#l45.28"></a><span id="l45.28">                 v =&gt; v.name.includes(&quot;calBackupData_&quot; + pseudoID + &quot;_&quot; + type)</span>
<a href="#l45.29"></a><span id="l45.29">             );</span>
<a href="#l45.30"></a><span id="l45.30">             // Sort by lastmodifed</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-            filteredFiles.sort(</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineminus">-                function s(a, b) {</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineminus">-                    return (a.lastmodified - b.lastmodified);</span>
<a href="#l45.34"></a><span id="l45.34" class="difflineminus">-                });</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineplus">+            filteredFiles.sort((a, b) =&gt; a.lastmodified - b.lastmodified);</span>
<a href="#l45.36"></a><span id="l45.36">             // And delete the oldest files, and keep the desired number of</span>
<a href="#l45.37"></a><span id="l45.37">             // old backups</span>
<a href="#l45.38"></a><span id="l45.38">             for (let i = 0; i &lt; filteredFiles.length - numBackupFiles; ++i) {</span>
<a href="#l45.39"></a><span id="l45.39">                 let file = backupDir.clone();</span>
<a href="#l45.40"></a><span id="l45.40">                 file.append(filteredFiles[i].name);</span>
<a href="#l45.41"></a><span id="l45.41"> </span>
<a href="#l45.42"></a><span id="l45.42">                 try {</span>
<a href="#l45.43"></a><span id="l45.43">                     file.remove(false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -375,17 +375,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l46.4"></a><span id="l46.4">         let superCal;</span>
<a href="#l46.5"></a><span id="l46.5">         try {</span>
<a href="#l46.6"></a><span id="l46.6">             superCal = this.superCalendar.QueryInterface(Components.interfaces.calISchedulingSupport);</span>
<a href="#l46.7"></a><span id="l46.7">         } catch (exc) {</span>
<a href="#l46.8"></a><span id="l46.8">             wantUnrespondedInvitations = false;</span>
<a href="#l46.9"></a><span id="l46.9">         }</span>
<a href="#l46.10"></a><span id="l46.10">         function checkUnrespondedInvitation(item) {</span>
<a href="#l46.11"></a><span id="l46.11">             let att = superCal.getInvitedAttendee(item);</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-            return (att &amp;&amp; (att.participationStatus == &quot;NEEDS-ACTION&quot;));</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+            return att &amp;&amp; att.participationStatus == &quot;NEEDS-ACTION&quot;;</span>
<a href="#l46.14"></a><span id="l46.14">         }</span>
<a href="#l46.15"></a><span id="l46.15"> </span>
<a href="#l46.16"></a><span id="l46.16">         // item base type</span>
<a href="#l46.17"></a><span id="l46.17">         let wantEvents = ((aItemFilter &amp; calICalendar.ITEM_FILTER_TYPE_EVENT) != 0);</span>
<a href="#l46.18"></a><span id="l46.18">         let wantTodos = ((aItemFilter &amp; calICalendar.ITEM_FILTER_TYPE_TODO) != 0);</span>
<a href="#l46.19"></a><span id="l46.19">         if (!wantEvents &amp;&amp; !wantTodos) {</span>
<a href="#l46.20"></a><span id="l46.20">             // bail.</span>
<a href="#l46.21"></a><span id="l46.21">             this.notifyOperationComplete(aListener,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -2048,17 +2048,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l47.4"></a><span id="l47.4">             let dtstamp = item.stampTime;</span>
<a href="#l47.5"></a><span id="l47.5">             if (dtstamp) {</span>
<a href="#l47.6"></a><span id="l47.6">                 ip.todo_stamp = dtstamp.nativeTime;</span>
<a href="#l47.7"></a><span id="l47.7">             }</span>
<a href="#l47.8"></a><span id="l47.8">             this.setDateParamHelper(ip, &quot;todo_completed&quot;, item.getProperty(&quot;COMPLETED&quot;));</span>
<a href="#l47.9"></a><span id="l47.9"> </span>
<a href="#l47.10"></a><span id="l47.10">             ip.todo_complete = item.getProperty(&quot;PERCENT-COMPLETED&quot;);</span>
<a href="#l47.11"></a><span id="l47.11"> </span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-            let someDate = (item.entryDate || item.dueDate);</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+            let someDate = item.entryDate || item.dueDate;</span>
<a href="#l47.14"></a><span id="l47.14">             if (someDate &amp;&amp; someDate.isDate) {</span>
<a href="#l47.15"></a><span id="l47.15">                 flags |= CAL_ITEM_FLAG.EVENT_ALLDAY;</span>
<a href="#l47.16"></a><span id="l47.16">             }</span>
<a href="#l47.17"></a><span id="l47.17"> </span>
<a href="#l47.18"></a><span id="l47.18">             ip.flags = flags;</span>
<a href="#l47.19"></a><span id="l47.19"> </span>
<a href="#l47.20"></a><span id="l47.20">             this.mInsertTodo.executeStep();</span>
<a href="#l47.21"></a><span id="l47.21">         } finally {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -89,17 +89,17 @@ var EXPORTED_SYMBOLS = [&quot;DB_SCHEMA_VERSI</span>
<a href="#l48.4"></a><span id="l48.4">  * @param alternateName (optional) The table or index name to be used in the</span>
<a href="#l48.5"></a><span id="l48.5">  *                        resulting CREATE statement. If not set, tblName will</span>
<a href="#l48.6"></a><span id="l48.6">  *                        be used.</span>
<a href="#l48.7"></a><span id="l48.7">  * @return              The SQL Statement for the given table or index and</span>
<a href="#l48.8"></a><span id="l48.8">  *                        version as a string.</span>
<a href="#l48.9"></a><span id="l48.9">  */</span>
<a href="#l48.10"></a><span id="l48.10"> function getSql(tblName, tblData, alternateName) {</span>
<a href="#l48.11"></a><span id="l48.11">     tblData = tblData || getSqlTable();</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-    let altName = (alternateName || tblName);</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+    let altName = alternateName || tblName;</span>
<a href="#l48.14"></a><span id="l48.14">     let sql;</span>
<a href="#l48.15"></a><span id="l48.15">     if (tblName.substr(0, 4) == &quot;idx_&quot;) {</span>
<a href="#l48.16"></a><span id="l48.16">         // If this is an index, we need construct the SQL differently</span>
<a href="#l48.17"></a><span id="l48.17">         let idxTbl = tblData[tblName].shift();</span>
<a href="#l48.18"></a><span id="l48.18">         let idxOn = idxTbl + &quot;(&quot; + tblData[tblName].join(&quot;,&quot;) + &quot;)&quot;;</span>
<a href="#l48.19"></a><span id="l48.19">         sql = &quot;CREATE INDEX &quot; + altName + &quot; ON &quot; + idxOn + &quot;;&quot;;</span>
<a href="#l48.20"></a><span id="l48.20">     } else {</span>
<a href="#l48.21"></a><span id="l48.21">         sql = &quot;CREATE TABLE &quot; + altName + &quot; (\n&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -35,17 +35,17 @@ calWcapCalendar.prototype = {</span>
<a href="#l49.4"></a><span id="l49.4">         contractID: &quot;@mozilla.org/calendar/calendar;1?type=wcap&quot;,</span>
<a href="#l49.5"></a><span id="l49.5">         classDescription: &quot;Sun Java System Calendar Server WCAP Provider&quot;,</span>
<a href="#l49.6"></a><span id="l49.6">         interfaces: calWcapCalendarInterfaces</span>
<a href="#l49.7"></a><span id="l49.7">     }),</span>
<a href="#l49.8"></a><span id="l49.8"> </span>
<a href="#l49.9"></a><span id="l49.9">     toString: function calWcapCalendar_toString() {</span>
<a href="#l49.10"></a><span id="l49.10">         let str = this.session.toString();</span>
<a href="#l49.11"></a><span id="l49.11">         if (this.m_calId) {</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-            str += (&quot;, calId=&quot; + this.calId);</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+            str += &quot;, calId=&quot; + this.calId;</span>
<a href="#l49.14"></a><span id="l49.14">         } else {</span>
<a href="#l49.15"></a><span id="l49.15">             str += &quot;, default calendar&quot;;</span>
<a href="#l49.16"></a><span id="l49.16">         }</span>
<a href="#l49.17"></a><span id="l49.17">         return str;</span>
<a href="#l49.18"></a><span id="l49.18">     },</span>
<a href="#l49.19"></a><span id="l49.19"> </span>
<a href="#l49.20"></a><span id="l49.20">     notifyError_: function calWcapCalendar_notifyError_(err, msg, context) {</span>
<a href="#l49.21"></a><span id="l49.21">         let rc = getResultCode(err);</span>
<a href="#l49.22"></a><span id="l49.22" class="difflineat">@@ -57,17 +57,17 @@ calWcapCalendar.prototype = {</span>
<a href="#l49.23"></a><span id="l49.23">                 msg = errorToString(err);</span>
<a href="#l49.24"></a><span id="l49.24">                 log(&quot;error: &quot; + msg, context);</span>
<a href="#l49.25"></a><span id="l49.25">                 break;</span>
<a href="#l49.26"></a><span id="l49.26">         }</span>
<a href="#l49.27"></a><span id="l49.27">         this.__proto__.__proto__.notifyError.apply(</span>
<a href="#l49.28"></a><span id="l49.28">             this,</span>
<a href="#l49.29"></a><span id="l49.29">             err instanceof Components.interfaces.nsIException</span>
<a href="#l49.30"></a><span id="l49.30">             ? [err.result, err.message]</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-            : [(isNaN(err) ? Components.results.NS_ERROR_FAILURE : err), msg]);</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineplus">+            : [isNaN(err) ? Components.results.NS_ERROR_FAILURE : err, msg]);</span>
<a href="#l49.33"></a><span id="l49.33">     },</span>
<a href="#l49.34"></a><span id="l49.34">     notifyError: function calWcapCalendar_notifyError(err, msg) {</span>
<a href="#l49.35"></a><span id="l49.35">         this.notifyError_(err, msg, this);</span>
<a href="#l49.36"></a><span id="l49.36">     },</span>
<a href="#l49.37"></a><span id="l49.37"> </span>
<a href="#l49.38"></a><span id="l49.38">     // calICalendarProvider:</span>
<a href="#l49.39"></a><span id="l49.39">     get prefChromeOverlay() {</span>
<a href="#l49.40"></a><span id="l49.40">         return null;</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineat">@@ -105,17 +105,17 @@ calWcapCalendar.prototype = {</span>
<a href="#l49.42"></a><span id="l49.42">     },</span>
<a href="#l49.43"></a><span id="l49.43">     set uri(thatUri) {</span>
<a href="#l49.44"></a><span id="l49.44">         this.m_uri = thatUri.clone();</span>
<a href="#l49.45"></a><span id="l49.45">         let path = thatUri.path;</span>
<a href="#l49.46"></a><span id="l49.46">         let qmPos = path.indexOf(&quot;?&quot;);</span>
<a href="#l49.47"></a><span id="l49.47">         if (qmPos != -1) {</span>
<a href="#l49.48"></a><span id="l49.48">             let pos = path.indexOf(&quot;?calid=&quot;, qmPos);</span>
<a href="#l49.49"></a><span id="l49.49">             if (pos != -1) {</span>
<a href="#l49.50"></a><span id="l49.50" class="difflineminus">-                let start = (pos + &quot;?calid=&quot;.length);</span>
<a href="#l49.51"></a><span id="l49.51" class="difflineplus">+                let start = pos + &quot;?calid=&quot;.length;</span>
<a href="#l49.52"></a><span id="l49.52">                 let end = path.indexOf(&quot;&amp;&quot;, start);</span>
<a href="#l49.53"></a><span id="l49.53">                 this.m_calId = decodeURIComponent(</span>
<a href="#l49.54"></a><span id="l49.54">                     path.substring(start, end == -1 ? path.length : end));</span>
<a href="#l49.55"></a><span id="l49.55">             }</span>
<a href="#l49.56"></a><span id="l49.56">         }</span>
<a href="#l49.57"></a><span id="l49.57">         return this.uri;</span>
<a href="#l49.58"></a><span id="l49.58">     },</span>
<a href="#l49.59"></a><span id="l49.59"> </span>
<a href="#l49.60"></a><span id="l49.60" class="difflineat">@@ -239,17 +239,17 @@ calWcapCalendar.prototype = {</span>
<a href="#l49.61"></a><span id="l49.61">         if (!this.m_session) {</span>
<a href="#l49.62"></a><span id="l49.62">             this.m_session = getWcapSessionFor(this);</span>
<a href="#l49.63"></a><span id="l49.63">         }</span>
<a href="#l49.64"></a><span id="l49.64">         return this.m_session;</span>
<a href="#l49.65"></a><span id="l49.65">     },</span>
<a href="#l49.66"></a><span id="l49.66"> </span>
<a href="#l49.67"></a><span id="l49.67">     m_calId: null,</span>
<a href="#l49.68"></a><span id="l49.68">     get calId() {</span>
<a href="#l49.69"></a><span id="l49.69" class="difflineminus">-        return (this.m_calId || this.session.defaultCalId);</span>
<a href="#l49.70"></a><span id="l49.70" class="difflineplus">+        return this.m_calId || this.session.defaultCalId;</span>
<a href="#l49.71"></a><span id="l49.71">     },</span>
<a href="#l49.72"></a><span id="l49.72"> </span>
<a href="#l49.73"></a><span id="l49.73">     get ownerId() {</span>
<a href="#l49.74"></a><span id="l49.74">         let ar = this.getCalendarProperties(&quot;X-NSCP-CALPROPS-PRIMARY-OWNER&quot;);</span>
<a href="#l49.75"></a><span id="l49.75">         if (ar.length == 0) {</span>
<a href="#l49.76"></a><span id="l49.76">             let calId = this.calId;</span>
<a href="#l49.77"></a><span id="l49.77">             log(&quot;cannot determine primary owner of calendar &quot; + calId, this);</span>
<a href="#l49.78"></a><span id="l49.78">             // fallback to calId prefix:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -12,17 +12,17 @@ function calWcapCalendar_encodeAttendee(</span>
<a href="#l50.4"></a><span id="l50.4">         log(&quot;attendee.icalProperty.icalString=&quot; + att.icalProperty.icalString, this);</span>
<a href="#l50.5"></a><span id="l50.5">     }</span>
<a href="#l50.6"></a><span id="l50.6">     function encodeAttr(val, attr, params) {</span>
<a href="#l50.7"></a><span id="l50.7">         if (val &amp;&amp; val.length &gt; 0) {</span>
<a href="#l50.8"></a><span id="l50.8">             if (params.length &gt; 0) {</span>
<a href="#l50.9"></a><span id="l50.9">                 params += &quot;^&quot;;</span>
<a href="#l50.10"></a><span id="l50.10">             }</span>
<a href="#l50.11"></a><span id="l50.11">             if (attr) {</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-                params += (attr + &quot;=&quot;);</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+                params += attr + &quot;=&quot;;</span>
<a href="#l50.14"></a><span id="l50.14">             }</span>
<a href="#l50.15"></a><span id="l50.15">             params += encodeURIComponent(val);</span>
<a href="#l50.16"></a><span id="l50.16">         }</span>
<a href="#l50.17"></a><span id="l50.17">         return params;</span>
<a href="#l50.18"></a><span id="l50.18">     }</span>
<a href="#l50.19"></a><span id="l50.19">     let params = encodeAttr(att.rsvp, &quot;RSVP&quot;, &quot;&quot;);</span>
<a href="#l50.20"></a><span id="l50.20">     params = encodeAttr(att.participationStatus, &quot;PARTSTAT&quot;, params);</span>
<a href="#l50.21"></a><span id="l50.21">     params = encodeAttr(att.role, &quot;ROLE&quot;, params);</span>
<a href="#l50.22"></a><span id="l50.22" class="difflineat">@@ -42,17 +42,17 @@ function calWcapCalendar_getRecurrencePa</span>
<a href="#l50.23"></a><span id="l50.23">     out_exdates.value = [];</span>
<a href="#l50.24"></a><span id="l50.24">     if (item.recurrenceInfo) {</span>
<a href="#l50.25"></a><span id="l50.25">         let rItems = item.recurrenceInfo.getRecurrenceItems({});</span>
<a href="#l50.26"></a><span id="l50.26">         for (let rItem of rItems) {</span>
<a href="#l50.27"></a><span id="l50.27">             let isNeg = rItem.isNegative;</span>
<a href="#l50.28"></a><span id="l50.28">             let rRuleInstance = cal.wrapInstance(rItem, Components.interfaces.calIRecurrenceRule);</span>
<a href="#l50.29"></a><span id="l50.29">             let rDateInstance = cal.wrapInstance(rItem, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l50.30"></a><span id="l50.30">             if (rRuleInstance) {</span>
<a href="#l50.31"></a><span id="l50.31" class="difflineminus">-                let rule = (&quot;\&quot;&quot; + encodeURIComponent(rRuleInstance.icalProperty.valueAsIcalString) + &quot;\&quot;&quot;);</span>
<a href="#l50.32"></a><span id="l50.32" class="difflineplus">+                let rule = &quot;\&quot;&quot; + encodeURIComponent(rRuleInstance.icalProperty.valueAsIcalString) + &quot;\&quot;&quot;;</span>
<a href="#l50.33"></a><span id="l50.33">                 if (isNeg) {</span>
<a href="#l50.34"></a><span id="l50.34">                     out_exrules.value.push(rule);</span>
<a href="#l50.35"></a><span id="l50.35">                 } else {</span>
<a href="#l50.36"></a><span id="l50.36">                     out_rrules.value.push(rule);</span>
<a href="#l50.37"></a><span id="l50.37">                 }</span>
<a href="#l50.38"></a><span id="l50.38">             } else if (rDateInstance) {</span>
<a href="#l50.39"></a><span id="l50.39">                 // cs does not accept DATEs here:</span>
<a href="#l50.40"></a><span id="l50.40">                 if (isNeg) {</span>
<a href="#l50.41"></a><span id="l50.41" class="difflineat">@@ -64,21 +64,18 @@ function calWcapCalendar_getRecurrencePa</span>
<a href="#l50.42"></a><span id="l50.42">                 this.notifyError(NS_ERROR_UNEXPECTED,</span>
<a href="#l50.43"></a><span id="l50.43">                                  &quot;don\'t know how to handle this recurrence item: &quot; + rItem.valueAsIcalString);</span>
<a href="#l50.44"></a><span id="l50.44">             }</span>
<a href="#l50.45"></a><span id="l50.45">         }</span>
<a href="#l50.46"></a><span id="l50.46">     }</span>
<a href="#l50.47"></a><span id="l50.47"> };</span>
<a href="#l50.48"></a><span id="l50.48"> </span>
<a href="#l50.49"></a><span id="l50.49"> function sameStringSet(list, list_) {</span>
<a href="#l50.50"></a><span id="l50.50" class="difflineminus">-    return (list.length == list_.length &amp;&amp;</span>
<a href="#l50.51"></a><span id="l50.51" class="difflineminus">-            list.every(function everyFunc(x) {</span>
<a href="#l50.52"></a><span id="l50.52" class="difflineminus">-                    return list_.some(</span>
<a href="#l50.53"></a><span id="l50.53" class="difflineminus">-                        function someFunc(y) { return x == y; });</span>
<a href="#l50.54"></a><span id="l50.54" class="difflineminus">-                }));</span>
<a href="#l50.55"></a><span id="l50.55" class="difflineplus">+    return list.length == list_.length &amp;&amp;</span>
<a href="#l50.56"></a><span id="l50.56" class="difflineplus">+           list.every(x =&gt; list_.some(y =&gt; x == y));</span>
<a href="#l50.57"></a><span id="l50.57"> }</span>
<a href="#l50.58"></a><span id="l50.58"> </span>
<a href="#l50.59"></a><span id="l50.59"> calWcapCalendar.prototype.encodeRecurrenceParams =</span>
<a href="#l50.60"></a><span id="l50.60">     function calWcapCalendar_encodeRecurrenceParams(item, oldItem, excludeExdates) {</span>
<a href="#l50.61"></a><span id="l50.61">     let rrules = {};</span>
<a href="#l50.62"></a><span id="l50.62">     let rdates = {};</span>
<a href="#l50.63"></a><span id="l50.63">     let exrules = {};</span>
<a href="#l50.64"></a><span id="l50.64">     let exdates = {};</span>
<a href="#l50.65"></a><span id="l50.65" class="difflineat">@@ -116,26 +113,26 @@ calWcapCalendar.prototype.encodeRecurren</span>
<a href="#l50.66"></a><span id="l50.66">         }</span>
<a href="#l50.67"></a><span id="l50.67">         if (excludeExdates || sameStringSet(exdates.value, exdates_.value)) {</span>
<a href="#l50.68"></a><span id="l50.68">             exdates.value = null; // don't write</span>
<a href="#l50.69"></a><span id="l50.69">         }</span>
<a href="#l50.70"></a><span id="l50.70">     }</span>
<a href="#l50.71"></a><span id="l50.71"> </span>
<a href="#l50.72"></a><span id="l50.72">     let ret = &quot;&quot;;</span>
<a href="#l50.73"></a><span id="l50.73">     if (rrules.value) {</span>
<a href="#l50.74"></a><span id="l50.74" class="difflineminus">-        ret += (&quot;&amp;rrules=&quot; + rrules.value.join(&quot;;&quot;));</span>
<a href="#l50.75"></a><span id="l50.75" class="difflineplus">+        ret += &quot;&amp;rrules=&quot; + rrules.value.join(&quot;;&quot;);</span>
<a href="#l50.76"></a><span id="l50.76">     }</span>
<a href="#l50.77"></a><span id="l50.77">     if (rdates.value) {</span>
<a href="#l50.78"></a><span id="l50.78" class="difflineminus">-        ret += (&quot;&amp;rdates=&quot; + rdates.value.join(&quot;;&quot;));</span>
<a href="#l50.79"></a><span id="l50.79" class="difflineplus">+        ret += &quot;&amp;rdates=&quot; + rdates.value.join(&quot;;&quot;);</span>
<a href="#l50.80"></a><span id="l50.80">     }</span>
<a href="#l50.81"></a><span id="l50.81">     if (exrules.value) {</span>
<a href="#l50.82"></a><span id="l50.82" class="difflineminus">-        ret += (&quot;&amp;exrules=&quot; + exrules.value.join(&quot;;&quot;));</span>
<a href="#l50.83"></a><span id="l50.83" class="difflineplus">+        ret += &quot;&amp;exrules=&quot; + exrules.value.join(&quot;;&quot;);</span>
<a href="#l50.84"></a><span id="l50.84">     }</span>
<a href="#l50.85"></a><span id="l50.85">     if (!excludeExdates &amp;&amp; exdates.value) {</span>
<a href="#l50.86"></a><span id="l50.86" class="difflineminus">-        ret += (&quot;&amp;exdates=&quot; + exdates.value.join(&quot;;&quot;));</span>
<a href="#l50.87"></a><span id="l50.87" class="difflineplus">+        ret += &quot;&amp;exdates=&quot; + exdates.value.join(&quot;;&quot;);</span>
<a href="#l50.88"></a><span id="l50.88">     }</span>
<a href="#l50.89"></a><span id="l50.89">     return ret;</span>
<a href="#l50.90"></a><span id="l50.90">     // xxx todo:</span>
<a href="#l50.91"></a><span id="l50.91">     // rchange=1: expand recurrences,</span>
<a href="#l50.92"></a><span id="l50.92">     // or whether to replace the rrule, ambiguous documentation!!!</span>
<a href="#l50.93"></a><span id="l50.93">     // check with store(with no uid) upon adoptItem() which behaves strange</span>
<a href="#l50.94"></a><span id="l50.94">     // if rchange=0 is set!</span>
<a href="#l50.95"></a><span id="l50.95"> };</span>
<a href="#l50.96"></a><span id="l50.96" class="difflineat">@@ -161,18 +158,18 @@ function calWcapCalendar_getAlarmParams(</span>
<a href="#l50.97"></a><span id="l50.97"> </span>
<a href="#l50.98"></a><span id="l50.98">         let emails = &quot;&quot;;</span>
<a href="#l50.99"></a><span id="l50.99">         if (item.hasProperty(&quot;alarmEmailAddress&quot;)) {</span>
<a href="#l50.100"></a><span id="l50.100">             emails = encodeURIComponent(item.getProperty(&quot;alarmEmailAddress&quot;));</span>
<a href="#l50.101"></a><span id="l50.101">         } else {</span>
<a href="#l50.102"></a><span id="l50.102">             emails = this.session.getDefaultAlarmEmails({}).map(encodeURIComponent).join(&quot;;&quot;);</span>
<a href="#l50.103"></a><span id="l50.103">         }</span>
<a href="#l50.104"></a><span id="l50.104">         if (emails.length &gt; 0) {</span>
<a href="#l50.105"></a><span id="l50.105" class="difflineminus">-            params = (&quot;&amp;alarmStart=&quot; + alarmStart.icalString);</span>
<a href="#l50.106"></a><span id="l50.106" class="difflineminus">-            params += (&quot;&amp;alarmEmails=&quot; + emails);</span>
<a href="#l50.107"></a><span id="l50.107" class="difflineplus">+            params = &quot;&amp;alarmStart=&quot; + alarmStart.icalString;</span>
<a href="#l50.108"></a><span id="l50.108" class="difflineplus">+            params += &quot;&amp;alarmEmails=&quot; + emails;</span>
<a href="#l50.109"></a><span id="l50.109">         }</span>
<a href="#l50.110"></a><span id="l50.110">         // else popup</span>
<a href="#l50.111"></a><span id="l50.111">     }</span>
<a href="#l50.112"></a><span id="l50.112">     if (!params) { // clear popup, email alarm:</span>
<a href="#l50.113"></a><span id="l50.113">         params = &quot;&amp;alarmStart=&amp;alarmPopup=&amp;alarmEmails=&quot;;</span>
<a href="#l50.114"></a><span id="l50.114">     }</span>
<a href="#l50.115"></a><span id="l50.115">     return params;</span>
<a href="#l50.116"></a><span id="l50.116"> };</span>
<a href="#l50.117"></a><span id="l50.117" class="difflineat">@@ -222,37 +219,37 @@ function calWcapCalendar_canNotify(metho</span>
<a href="#l50.118"></a><span id="l50.118">     if (!this.session.isLoggedIn) {</span>
<a href="#l50.119"></a><span id="l50.119">         return false;</span>
<a href="#l50.120"></a><span id="l50.120">     }</span>
<a href="#l50.121"></a><span id="l50.121">     let calId = this.calId;</span>
<a href="#l50.122"></a><span id="l50.122">     switch (method) {</span>
<a href="#l50.123"></a><span id="l50.123">         case &quot;REQUEST&quot;:</span>
<a href="#l50.124"></a><span id="l50.124">         case &quot;CANCEL&quot;:</span>
<a href="#l50.125"></a><span id="l50.125">             // when creating new items, mind that organizer's id</span>
<a href="#l50.126"></a><span id="l50.126" class="difflineminus">-            return (!item.organizer || // might yet not be set</span>
<a href="#l50.127"></a><span id="l50.127" class="difflineminus">-                    (item.organizer.id == calId) || // or is set to raw calId</span>
<a href="#l50.128"></a><span id="l50.128" class="difflineminus">-                    (getCalId(item.organizer) == calId));</span>
<a href="#l50.129"></a><span id="l50.129" class="difflineplus">+            return !item.organizer || // might yet not be set</span>
<a href="#l50.130"></a><span id="l50.130" class="difflineplus">+                   item.organizer.id == calId || // or is set to raw calId</span>
<a href="#l50.131"></a><span id="l50.131" class="difflineplus">+                   getCalId(item.organizer) == calId;</span>
<a href="#l50.132"></a><span id="l50.132">         case &quot;REPLY&quot;: // only if we we're invited from cs, and find matching X-S1CS-CALID:</span>
<a href="#l50.133"></a><span id="l50.133">             return (getAttendeeByCalId(item.getAttendees({}), calId) != null);</span>
<a href="#l50.134"></a><span id="l50.134">         default:</span>
<a href="#l50.135"></a><span id="l50.135">             return false;</span>
<a href="#l50.136"></a><span id="l50.136">     }</span>
<a href="#l50.137"></a><span id="l50.137"> };</span>
<a href="#l50.138"></a><span id="l50.138"> </span>
<a href="#l50.139"></a><span id="l50.139"> function equalDatetimes(one, two) {</span>
<a href="#l50.140"></a><span id="l50.140" class="difflineminus">-    return ((!one &amp;&amp; !two) ||</span>
<a href="#l50.141"></a><span id="l50.141" class="difflineminus">-            (one &amp;&amp; two &amp;&amp;</span>
<a href="#l50.142"></a><span id="l50.142" class="difflineminus">-             (one.isDate == two.isDate) &amp;&amp;</span>
<a href="#l50.143"></a><span id="l50.143" class="difflineminus">-             (one.compare(two) == 0)));</span>
<a href="#l50.144"></a><span id="l50.144" class="difflineplus">+    return !one &amp;&amp; !two ||</span>
<a href="#l50.145"></a><span id="l50.145" class="difflineplus">+           (one &amp;&amp; two &amp;&amp;</span>
<a href="#l50.146"></a><span id="l50.146" class="difflineplus">+            one.isDate == two.isDate &amp;&amp;</span>
<a href="#l50.147"></a><span id="l50.147" class="difflineplus">+            one.compare(two) == 0);</span>
<a href="#l50.148"></a><span id="l50.148"> }</span>
<a href="#l50.149"></a><span id="l50.149"> </span>
<a href="#l50.150"></a><span id="l50.150"> function identicalDatetimes(one, two) {</span>
<a href="#l50.151"></a><span id="l50.151" class="difflineminus">-    return ((!one &amp;&amp; !two) ||</span>
<a href="#l50.152"></a><span id="l50.152" class="difflineminus">-            (equalDatetimes(one, two) &amp;&amp;</span>
<a href="#l50.153"></a><span id="l50.153" class="difflineminus">-             compareObjects(one.timezone, two.timezone)));</span>
<a href="#l50.154"></a><span id="l50.154" class="difflineplus">+    return !one &amp;&amp; !two ||</span>
<a href="#l50.155"></a><span id="l50.155" class="difflineplus">+           (equalDatetimes(one, two) &amp;&amp;</span>
<a href="#l50.156"></a><span id="l50.156" class="difflineplus">+            compareObjects(one.timezone, two.timezone));</span>
<a href="#l50.157"></a><span id="l50.157"> }</span>
<a href="#l50.158"></a><span id="l50.158"> </span>
<a href="#l50.159"></a><span id="l50.159"> // @return null if nothing has changed else value to be written</span>
<a href="#l50.160"></a><span id="l50.160"> function diffProperty(newItem, oldItem, propName) {</span>
<a href="#l50.161"></a><span id="l50.161">     let val = newItem.getProperty(propName);</span>
<a href="#l50.162"></a><span id="l50.162">     let oldVal = (oldItem ? oldItem.getProperty(propName) : null);</span>
<a href="#l50.163"></a><span id="l50.163">     if (val === null) {</span>
<a href="#l50.164"></a><span id="l50.164">         // force being set when - no old item, eg when adding new item</span>
<a href="#l50.165"></a><span id="l50.165" class="difflineat">@@ -342,62 +339,62 @@ function calWcapCalendar_storeItem(bAddI</span>
<a href="#l50.166"></a><span id="l50.166">         if (att) {</span>
<a href="#l50.167"></a><span id="l50.167">             log(&quot;attendee: &quot; + att.icalProperty.icalString, this);</span>
<a href="#l50.168"></a><span id="l50.168">             let oldAtt = null;</span>
<a href="#l50.169"></a><span id="l50.169">             if (oldItem) {</span>
<a href="#l50.170"></a><span id="l50.170">                 oldAtt = getAttendeeByCalId(oldItem.getAttendees({}), calId);</span>
<a href="#l50.171"></a><span id="l50.171">             }</span>
<a href="#l50.172"></a><span id="l50.172">             if (!oldAtt || (att.participationStatus != oldAtt.participationStatus)) {</span>
<a href="#l50.173"></a><span id="l50.173">                 // REPLY first for just this calendar:</span>
<a href="#l50.174"></a><span id="l50.174" class="difflineminus">-                params += (&quot;&amp;attendees=PARTSTAT=&quot; + att.participationStatus +</span>
<a href="#l50.175"></a><span id="l50.175" class="difflineminus">-                           &quot;^&quot; + encodeURIComponent(att.id));</span>
<a href="#l50.176"></a><span id="l50.176" class="difflineplus">+                params += &quot;&amp;attendees=PARTSTAT=&quot; + att.participationStatus +</span>
<a href="#l50.177"></a><span id="l50.177" class="difflineplus">+                           &quot;^&quot; + encodeURIComponent(att.id);</span>
<a href="#l50.178"></a><span id="l50.178">             }</span>
<a href="#l50.179"></a><span id="l50.179">         }</span>
<a href="#l50.180"></a><span id="l50.180">     } else { // PUBLISH, REQUEST</span>
<a href="#l50.181"></a><span id="l50.181">         // workarounds for server bugs concerning recurrences/exceptions:</span>
<a href="#l50.182"></a><span id="l50.182">         // - if first occurrence is an exception</span>
<a href="#l50.183"></a><span id="l50.183">         //   and an EXDATE for that occurrence ought to be written,</span>
<a href="#l50.184"></a><span id="l50.184">         //   then the master item's data is replaced with that EXDATEd exception. WTF.</span>
<a href="#l50.185"></a><span id="l50.185">         // - if start/end date is being written on master, the previously EXDATEd</span>
<a href="#l50.186"></a><span id="l50.186">         //   exception overwrites master, why ever.</span>
<a href="#l50.187"></a><span id="l50.187">         // So in these cases: write all data of master.</span>
<a href="#l50.188"></a><span id="l50.188"> </span>
<a href="#l50.189"></a><span id="l50.189">         let bIsAllDay = false;</span>
<a href="#l50.190"></a><span id="l50.190">         let dtstart, dtend;</span>
<a href="#l50.191"></a><span id="l50.191">         if (bIsEvent) {</span>
<a href="#l50.192"></a><span id="l50.192">             dtstart = item.startDate;</span>
<a href="#l50.193"></a><span id="l50.193">             dtend = item.endDate;</span>
<a href="#l50.194"></a><span id="l50.194" class="difflineminus">-            bIsAllDay = (dtstart.isDate &amp;&amp; dtend.isDate);</span>
<a href="#l50.195"></a><span id="l50.195" class="difflineplus">+            bIsAllDay = dtstart.isDate &amp;&amp; dtend.isDate;</span>
<a href="#l50.196"></a><span id="l50.196">             if (!oldItem || !identicalDatetimes(dtstart, oldItem.startDate) ||</span>
<a href="#l50.197"></a><span id="l50.197">                 !identicalDatetimes(dtend, oldItem.endDate)) {</span>
<a href="#l50.198"></a><span id="l50.198" class="difflineminus">-                params += (&quot;&amp;dtstart=&quot; + getIcalUTC(dtstart)); // timezone will be set with tzid param</span>
<a href="#l50.199"></a><span id="l50.199" class="difflineminus">-                params += (&quot;&amp;dtend=&quot; + getIcalUTC(dtend));</span>
<a href="#l50.200"></a><span id="l50.200" class="difflineminus">-                params += (bIsAllDay ? &quot;&amp;isAllDay=1&quot; : &quot;&amp;isAllDay=0&quot;);</span>
<a href="#l50.201"></a><span id="l50.201" class="difflineplus">+                params += &quot;&amp;dtstart=&quot; + getIcalUTC(dtstart); // timezone will be set with tzid param</span>
<a href="#l50.202"></a><span id="l50.202" class="difflineplus">+                params += &quot;&amp;dtend=&quot; + getIcalUTC(dtend);</span>
<a href="#l50.203"></a><span id="l50.203" class="difflineplus">+                params += bIsAllDay ? &quot;&amp;isAllDay=1&quot; : &quot;&amp;isAllDay=0&quot;;</span>
<a href="#l50.204"></a><span id="l50.204"> </span>
<a href="#l50.205"></a><span id="l50.205">                 if (bIsParent &amp;&amp; item.recurrenceInfo) {</span>
<a href="#l50.206"></a><span id="l50.206">                     oldItem = null; // recurrence/exceptions hack: write whole master</span>
<a href="#l50.207"></a><span id="l50.207">                 }</span>
<a href="#l50.208"></a><span id="l50.208">             }</span>
<a href="#l50.209"></a><span id="l50.209">         } else { // calITodo</span>
<a href="#l50.210"></a><span id="l50.210">             // xxx todo: dtstart is mandatory for cs, so if this is</span>
<a href="#l50.211"></a><span id="l50.211">             //           undefined, assume an allDay todo???</span>
<a href="#l50.212"></a><span id="l50.212">             dtstart = item.entryDate;</span>
<a href="#l50.213"></a><span id="l50.213">             dtend = item.dueDate;</span>
<a href="#l50.214"></a><span id="l50.214"> </span>
<a href="#l50.215"></a><span id="l50.215">             // cs bug: enforce DUE (set to DTSTART) if alarm is set</span>
<a href="#l50.216"></a><span id="l50.216">             if (!dtend &amp;&amp; item.getAlarms({}).length) {</span>
<a href="#l50.217"></a><span id="l50.217">                 dtend = dtstart;</span>
<a href="#l50.218"></a><span id="l50.218">             }</span>
<a href="#l50.219"></a><span id="l50.219"> </span>
<a href="#l50.220"></a><span id="l50.220" class="difflineminus">-            bIsAllDay = (dtstart &amp;&amp; dtstart.isDate);</span>
<a href="#l50.221"></a><span id="l50.221" class="difflineplus">+            bIsAllDay = dtstart &amp;&amp; dtstart.isDate;</span>
<a href="#l50.222"></a><span id="l50.222">             if (!oldItem || !identicalDatetimes(dtstart, oldItem.entryDate) ||</span>
<a href="#l50.223"></a><span id="l50.223">                 !identicalDatetimes(dtend, oldItem.dueDate)) {</span>
<a href="#l50.224"></a><span id="l50.224" class="difflineminus">-                params += (&quot;&amp;dtstart=&quot; + getIcalUTC(dtstart)); // timezone will be set with tzid param</span>
<a href="#l50.225"></a><span id="l50.225" class="difflineminus">-                params += (&quot;&amp;due=&quot; + getIcalUTC(dtend)); // timezone will be set with tzid param</span>
<a href="#l50.226"></a><span id="l50.226" class="difflineminus">-                params += (bIsAllDay ? &quot;&amp;isAllDay=1&quot; : &quot;&amp;isAllDay=0&quot;);</span>
<a href="#l50.227"></a><span id="l50.227" class="difflineplus">+                params += &quot;&amp;dtstart=&quot; + getIcalUTC(dtstart); // timezone will be set with tzid param</span>
<a href="#l50.228"></a><span id="l50.228" class="difflineplus">+                params += &quot;&amp;due=&quot; + getIcalUTC(dtend); // timezone will be set with tzid param</span>
<a href="#l50.229"></a><span id="l50.229" class="difflineplus">+                params += bIsAllDay ? &quot;&amp;isAllDay=1&quot; : &quot;&amp;isAllDay=0&quot;;</span>
<a href="#l50.230"></a><span id="l50.230"> </span>
<a href="#l50.231"></a><span id="l50.231">                 if (bIsParent &amp;&amp; item.recurrenceInfo) {</span>
<a href="#l50.232"></a><span id="l50.232">                     oldItem = null; // recurrence/exceptions hack: write whole master</span>
<a href="#l50.233"></a><span id="l50.233">                 }</span>
<a href="#l50.234"></a><span id="l50.234">             }</span>
<a href="#l50.235"></a><span id="l50.235">         }</span>
<a href="#l50.236"></a><span id="l50.236">         if (bIsParent) {</span>
<a href="#l50.237"></a><span id="l50.237">             let recParams = this.encodeRecurrenceParams(item, oldItem, !bAddItem /* exclude EXDATEs */);</span>
<a href="#l50.238"></a><span id="l50.238" class="difflineat">@@ -415,119 +412,119 @@ function calWcapCalendar_storeItem(bAddI</span>
<a href="#l50.239"></a><span id="l50.239">             } // else outbound</span>
<a href="#l50.240"></a><span id="l50.240">         }</span>
<a href="#l50.241"></a><span id="l50.241"> </span>
<a href="#l50.242"></a><span id="l50.242">         let attendees = item.getAttendees({});</span>
<a href="#l50.243"></a><span id="l50.243">         if (attendees.length &gt; 0) {</span>
<a href="#l50.244"></a><span id="l50.244">             // xxx todo: why ever, X-S1CS-EMAIL is unsupported though documented for calprops... WTF.</span>
<a href="#l50.245"></a><span id="l50.245">             let attParam = encodeAttendees(attendees);</span>
<a href="#l50.246"></a><span id="l50.246">             if (!oldItem || attParam != encodeAttendees(oldItem.getAttendees({}))) {</span>
<a href="#l50.247"></a><span id="l50.247" class="difflineminus">-                params += (&quot;&amp;attendees=&quot; + attParam);</span>
<a href="#l50.248"></a><span id="l50.248" class="difflineplus">+                params += &quot;&amp;attendees=&quot; + attParam;</span>
<a href="#l50.249"></a><span id="l50.249">             }</span>
<a href="#l50.250"></a><span id="l50.250"> </span>
<a href="#l50.251"></a><span id="l50.251">             if (orgCalId == calId) {</span>
<a href="#l50.252"></a><span id="l50.252">                 method = METHOD_REQUEST;</span>
<a href="#l50.253"></a><span id="l50.253">             } else {</span>
<a href="#l50.254"></a><span id="l50.254">                 method = METHOD_UPDATE;</span>
<a href="#l50.255"></a><span id="l50.255">                 bNoSmtpNotify = true;</span>
<a href="#l50.256"></a><span id="l50.256">             }</span>
<a href="#l50.257"></a><span id="l50.257">         } else if (oldItem &amp;&amp; oldItem.getAttendees({}).length &gt; 0) {</span>
<a href="#l50.258"></a><span id="l50.258">             // else using just PUBLISH</span>
<a href="#l50.259"></a><span id="l50.259">             params += &quot;&amp;attendees=&quot;; // clear attendees</span>
<a href="#l50.260"></a><span id="l50.260">         }</span>
<a href="#l50.261"></a><span id="l50.261"> </span>
<a href="#l50.262"></a><span id="l50.262">         if (orgCalId) {</span>
<a href="#l50.263"></a><span id="l50.263">             if (!oldItem || (orgCalId != getCalId(oldItem.organizer))) {</span>
<a href="#l50.264"></a><span id="l50.264" class="difflineminus">-                params += (&quot;&amp;orgCalid=&quot; + encodeURIComponent(orgCalId));</span>
<a href="#l50.265"></a><span id="l50.265" class="difflineplus">+                params += &quot;&amp;orgCalid=&quot; + encodeURIComponent(orgCalId);</span>
<a href="#l50.266"></a><span id="l50.266">             }</span>
<a href="#l50.267"></a><span id="l50.267">         } else { // might be a copy of an iTIP invitation:</span>
<a href="#l50.268"></a><span id="l50.268">             let orgEmail = getOrgId(item);</span>
<a href="#l50.269"></a><span id="l50.269">             if (!oldItem || (getOrgId(oldItem) != orgEmail)) {</span>
<a href="#l50.270"></a><span id="l50.270" class="difflineminus">-                params += (&quot;&amp;orgEmail=&quot; + encodeURIComponent(orgEmail));</span>
<a href="#l50.271"></a><span id="l50.271" class="difflineplus">+                params += &quot;&amp;orgEmail=&quot; + encodeURIComponent(orgEmail);</span>
<a href="#l50.272"></a><span id="l50.272">             }</span>
<a href="#l50.273"></a><span id="l50.273">         }</span>
<a href="#l50.274"></a><span id="l50.274"> </span>
<a href="#l50.275"></a><span id="l50.275">         let val = item.title;</span>
<a href="#l50.276"></a><span id="l50.276">         if (!oldItem || val != oldItem.title) {</span>
<a href="#l50.277"></a><span id="l50.277" class="difflineminus">-            params += (&quot;&amp;summary=&quot; + encodeURIComponent(val));</span>
<a href="#l50.278"></a><span id="l50.278" class="difflineplus">+            params += &quot;&amp;summary=&quot; + encodeURIComponent(val);</span>
<a href="#l50.279"></a><span id="l50.279">         }</span>
<a href="#l50.280"></a><span id="l50.280"> </span>
<a href="#l50.281"></a><span id="l50.281">         let categories = item.getCategories({});</span>
<a href="#l50.282"></a><span id="l50.282">         let catParam = encodeCategories(categories);</span>
<a href="#l50.283"></a><span id="l50.283">         if (!oldItem || catParam != encodeCategories(oldItem.getCategories({}))) {</span>
<a href="#l50.284"></a><span id="l50.284" class="difflineminus">-            params += (&quot;&amp;categories=&quot; + catParam);</span>
<a href="#l50.285"></a><span id="l50.285" class="difflineplus">+            params += &quot;&amp;categories=&quot; + catParam;</span>
<a href="#l50.286"></a><span id="l50.286">         }</span>
<a href="#l50.287"></a><span id="l50.287"> </span>
<a href="#l50.288"></a><span id="l50.288">         val = diffProperty(item, oldItem, &quot;DESCRIPTION&quot;);</span>
<a href="#l50.289"></a><span id="l50.289">         if (val !== null) {</span>
<a href="#l50.290"></a><span id="l50.290" class="difflineminus">-            params += (&quot;&amp;desc=&quot; + encodeURIComponent(val));</span>
<a href="#l50.291"></a><span id="l50.291" class="difflineplus">+            params += &quot;&amp;desc=&quot; + encodeURIComponent(val);</span>
<a href="#l50.292"></a><span id="l50.292">         }</span>
<a href="#l50.293"></a><span id="l50.293">         val = diffProperty(item, oldItem, &quot;LOCATION&quot;);</span>
<a href="#l50.294"></a><span id="l50.294">         if (val !== null) {</span>
<a href="#l50.295"></a><span id="l50.295" class="difflineminus">-            params += (&quot;&amp;location=&quot; + encodeURIComponent(val));</span>
<a href="#l50.296"></a><span id="l50.296" class="difflineplus">+            params += &quot;&amp;location=&quot; + encodeURIComponent(val);</span>
<a href="#l50.297"></a><span id="l50.297">         }</span>
<a href="#l50.298"></a><span id="l50.298">         val = diffProperty(item, oldItem, &quot;URL&quot;);</span>
<a href="#l50.299"></a><span id="l50.299">         if (val !== null) {</span>
<a href="#l50.300"></a><span id="l50.300" class="difflineminus">-            params += (&quot;&amp;icsUrl=&quot; + encodeURIComponent(val));</span>
<a href="#l50.301"></a><span id="l50.301" class="difflineplus">+            params += &quot;&amp;icsUrl=&quot; + encodeURIComponent(val);</span>
<a href="#l50.302"></a><span id="l50.302">         }</span>
<a href="#l50.303"></a><span id="l50.303">         // xxx todo: default prio is 0 (5 in sjs cs)</span>
<a href="#l50.304"></a><span id="l50.304">         val = item.priority;</span>
<a href="#l50.305"></a><span id="l50.305">         if (!oldItem || val != oldItem.priority) {</span>
<a href="#l50.306"></a><span id="l50.306" class="difflineminus">-            params += (&quot;&amp;priority=&quot; + encodeURIComponent(val));</span>
<a href="#l50.307"></a><span id="l50.307" class="difflineplus">+            params += &quot;&amp;priority=&quot; + encodeURIComponent(val);</span>
<a href="#l50.308"></a><span id="l50.308">         }</span>
<a href="#l50.309"></a><span id="l50.309"> </span>
<a href="#l50.310"></a><span id="l50.310">         let icsClass = getPrivacy(item);</span>
<a href="#l50.311"></a><span id="l50.311">         if (!oldItem || icsClass != getPrivacy(oldItem)) {</span>
<a href="#l50.312"></a><span id="l50.312" class="difflineminus">-            params += (&quot;&amp;icsClass=&quot; + icsClass);</span>
<a href="#l50.313"></a><span id="l50.313" class="difflineplus">+            params += &quot;&amp;icsClass=&quot; + icsClass;</span>
<a href="#l50.314"></a><span id="l50.314">         }</span>
<a href="#l50.315"></a><span id="l50.315"> </span>
<a href="#l50.316"></a><span id="l50.316">         if (!oldItem || item.status != oldItem.status) {</span>
<a href="#l50.317"></a><span id="l50.317">             switch (item.status) {</span>
<a href="#l50.318"></a><span id="l50.318">                 case &quot;CONFIRMED&quot;: params += &quot;&amp;status=0&quot;; break;</span>
<a href="#l50.319"></a><span id="l50.319">                 case &quot;CANCELLED&quot;: params += &quot;&amp;status=1&quot;; break;</span>
<a href="#l50.320"></a><span id="l50.320">                 case &quot;TENTATIVE&quot;: params += &quot;&amp;status=2&quot;; break;</span>
<a href="#l50.321"></a><span id="l50.321">                 case &quot;NEEDS-ACTION&quot;: params += &quot;&amp;status=3&quot;; break;</span>
<a href="#l50.322"></a><span id="l50.322">                 case &quot;COMPLETED&quot;: params += &quot;&amp;status=4&quot;; break;</span>
<a href="#l50.323"></a><span id="l50.323">                 case &quot;IN-PROCESS&quot;: params += &quot;&amp;status=5&quot;; break;</span>
<a href="#l50.324"></a><span id="l50.324">                 case &quot;DRAFT&quot;: params += &quot;&amp;status=6&quot;; break;</span>
<a href="#l50.325"></a><span id="l50.325">                 case &quot;FINAL&quot;: params += &quot;&amp;status=7&quot;; break;</span>
<a href="#l50.326"></a><span id="l50.326">                 default: // reset to default</span>
<a href="#l50.327"></a><span id="l50.327" class="difflineminus">-                    params += (bIsEvent ? &quot;&amp;status=0&quot; : &quot;&amp;status=3&quot;);</span>
<a href="#l50.328"></a><span id="l50.328" class="difflineplus">+                    params += bIsEvent ? &quot;&amp;status=0&quot; : &quot;&amp;status=3&quot;;</span>
<a href="#l50.329"></a><span id="l50.329">                     break;</span>
<a href="#l50.330"></a><span id="l50.330">             }</span>
<a href="#l50.331"></a><span id="l50.331">         }</span>
<a href="#l50.332"></a><span id="l50.332"> </span>
<a href="#l50.333"></a><span id="l50.333">         val = diffProperty(item, oldItem, &quot;TRANSP&quot;);</span>
<a href="#l50.334"></a><span id="l50.334">         if (val !== null) {</span>
<a href="#l50.335"></a><span id="l50.335">             switch (val) {</span>
<a href="#l50.336"></a><span id="l50.336">                 case &quot;TRANSPARENT&quot;:</span>
<a href="#l50.337"></a><span id="l50.337">                     params += &quot;&amp;transparent=1&quot;;</span>
<a href="#l50.338"></a><span id="l50.338">                     break;</span>
<a href="#l50.339"></a><span id="l50.339">                 case &quot;OPAQUE&quot;:</span>
<a href="#l50.340"></a><span id="l50.340">                     params += &quot;&amp;transparent=0&quot;;</span>
<a href="#l50.341"></a><span id="l50.341">                     break;</span>
<a href="#l50.342"></a><span id="l50.342">                 default:</span>
<a href="#l50.343"></a><span id="l50.343" class="difflineminus">-                    params += (&quot;&amp;transparent=&quot; + (((icsClass == &quot;PRIVATE&quot;) || bIsAllDay) ? &quot;1&quot; : &quot;0&quot;));</span>
<a href="#l50.344"></a><span id="l50.344" class="difflineplus">+                    params += &quot;&amp;transparent=&quot; + (icsClass == &quot;PRIVATE&quot; || bIsAllDay ? &quot;1&quot; : &quot;0&quot;);</span>
<a href="#l50.345"></a><span id="l50.345">                     break;</span>
<a href="#l50.346"></a><span id="l50.346">             }</span>
<a href="#l50.347"></a><span id="l50.347">         }</span>
<a href="#l50.348"></a><span id="l50.348"> </span>
<a href="#l50.349"></a><span id="l50.349">         if (!bIsEvent) {</span>
<a href="#l50.350"></a><span id="l50.350">             if (!oldItem || item.percentComplete != oldItem.percentComplete) {</span>
<a href="#l50.351"></a><span id="l50.351" class="difflineminus">-                params += (&quot;&amp;percent=&quot; + item.percentComplete.toString(10));</span>
<a href="#l50.352"></a><span id="l50.352" class="difflineplus">+                params += &quot;&amp;percent=&quot; + item.percentComplete.toString(10);</span>
<a href="#l50.353"></a><span id="l50.353">             }</span>
<a href="#l50.354"></a><span id="l50.354">             if (!oldItem || !equalDatetimes(item.completedDate, oldItem.completedDate)) {</span>
<a href="#l50.355"></a><span id="l50.355" class="difflineminus">-                params += (&quot;&amp;completed=&quot; + getIcalUTC(item.completedDate));</span>
<a href="#l50.356"></a><span id="l50.356" class="difflineplus">+                params += &quot;&amp;completed=&quot; + getIcalUTC(item.completedDate);</span>
<a href="#l50.357"></a><span id="l50.357">             }</span>
<a href="#l50.358"></a><span id="l50.358">         }</span>
<a href="#l50.359"></a><span id="l50.359"> </span>
<a href="#l50.360"></a><span id="l50.360">         // attachment urls:</span>
<a href="#l50.361"></a><span id="l50.361">         val = getAttachments(item);</span>
<a href="#l50.362"></a><span id="l50.362">         if (!oldItem || val != getAttachments(oldItem)) {</span>
<a href="#l50.363"></a><span id="l50.363" class="difflineminus">-            params += (&quot;&amp;attachments=&quot; + val);</span>
<a href="#l50.364"></a><span id="l50.364" class="difflineplus">+            params += &quot;&amp;attachments=&quot; + val;</span>
<a href="#l50.365"></a><span id="l50.365">         }</span>
<a href="#l50.366"></a><span id="l50.366">     } // PUBLISH, REQUEST</span>
<a href="#l50.367"></a><span id="l50.367"> </span>
<a href="#l50.368"></a><span id="l50.368">     let alarmParams = this.getAlarmParams(item);</span>
<a href="#l50.369"></a><span id="l50.369">     if (!oldItem || (this.getAlarmParams(oldItem) != alarmParams)) {</span>
<a href="#l50.370"></a><span id="l50.370">         if ((method == METHOD_REQUEST) &amp;&amp; params.length == 0) {</span>
<a href="#l50.371"></a><span id="l50.371">             // assure no email notifications about this change:</span>
<a href="#l50.372"></a><span id="l50.372">             bNoSmtpNotify = true;</span>
<a href="#l50.373"></a><span id="l50.373" class="difflineat">@@ -538,40 +535,40 @@ function calWcapCalendar_storeItem(bAddI</span>
<a href="#l50.374"></a><span id="l50.374">     if (params.length == 0) {</span>
<a href="#l50.375"></a><span id="l50.375">         log(&quot;no change at all.&quot;, this);</span>
<a href="#l50.376"></a><span id="l50.376">         if (LOG_LEVEL &gt; 2) {</span>
<a href="#l50.377"></a><span id="l50.377">             log(&quot;old item:\n&quot; + oldItem.icalString + &quot;\n\nnew item:\n&quot; + item.icalString, this);</span>
<a href="#l50.378"></a><span id="l50.378">         }</span>
<a href="#l50.379"></a><span id="l50.379">         request.execRespFunc(null, item);</span>
<a href="#l50.380"></a><span id="l50.380">     } else {</span>
<a href="#l50.381"></a><span id="l50.381">         // cs does not support separate timezones for start and end, just pick one for tzid param:</span>
<a href="#l50.382"></a><span id="l50.382" class="difflineminus">-        let someDate = (item.startDate || item.entryDate || item.dueDate);</span>
<a href="#l50.383"></a><span id="l50.383" class="difflineplus">+        let someDate = item.startDate || item.entryDate || item.dueDate;</span>
<a href="#l50.384"></a><span id="l50.384">         if (someDate &amp;&amp; !someDate.timezone.isUTC) {</span>
<a href="#l50.385"></a><span id="l50.385" class="difflineminus">-            params += (&quot;&amp;tzid=&quot; + encodeURIComponent(this.getAlignedTzid(someDate.timezone)));</span>
<a href="#l50.386"></a><span id="l50.386" class="difflineplus">+            params += &quot;&amp;tzid=&quot; + encodeURIComponent(this.getAlignedTzid(someDate.timezone));</span>
<a href="#l50.387"></a><span id="l50.387">         }</span>
<a href="#l50.388"></a><span id="l50.388"> </span>
<a href="#l50.389"></a><span id="l50.389">         if (item.id) {</span>
<a href="#l50.390"></a><span id="l50.390" class="difflineminus">-            params += (&quot;&amp;uid=&quot; + encodeURIComponent(item.id));</span>
<a href="#l50.391"></a><span id="l50.391" class="difflineplus">+            params += &quot;&amp;uid=&quot; + encodeURIComponent(item.id);</span>
<a href="#l50.392"></a><span id="l50.392">         }</span>
<a href="#l50.393"></a><span id="l50.393"> </span>
<a href="#l50.394"></a><span id="l50.394">         // be picky about create/modify, if possible:</span>
<a href="#l50.395"></a><span id="l50.395">         // WCAP_STORE_TYPE_CREATE, WCAP_STORE_TYPE_MODIFY</span>
<a href="#l50.396"></a><span id="l50.396">         if (bAddItem) {</span>
<a href="#l50.397"></a><span id="l50.397">             params += &quot;&amp;storetype=1&quot;;</span>
<a href="#l50.398"></a><span id="l50.398">         } else if (oldItem) {</span>
<a href="#l50.399"></a><span id="l50.399">             params += &quot;&amp;storetype=2&quot;;</span>
<a href="#l50.400"></a><span id="l50.400">         } // else we don't know exactly, so don't check</span>
<a href="#l50.401"></a><span id="l50.401"> </span>
<a href="#l50.402"></a><span id="l50.402">         if (bIsParent) {</span>
<a href="#l50.403"></a><span id="l50.403">             params += &quot;&amp;mod=4&quot;; // THIS AND ALL INSTANCES</span>
<a href="#l50.404"></a><span id="l50.404">         } else {</span>
<a href="#l50.405"></a><span id="l50.405" class="difflineminus">-            params += (&quot;&amp;mod=1&amp;rid=&quot; + getIcalUTC(ensureDateTime(item.recurrenceId))); // THIS INSTANCE</span>
<a href="#l50.406"></a><span id="l50.406" class="difflineplus">+            params += &quot;&amp;mod=1&amp;rid=&quot; + getIcalUTC(ensureDateTime(item.recurrenceId)); // THIS INSTANCE</span>
<a href="#l50.407"></a><span id="l50.407">         }</span>
<a href="#l50.408"></a><span id="l50.408"> </span>
<a href="#l50.409"></a><span id="l50.409" class="difflineminus">-        params += (&quot;&amp;method=&quot; + method);</span>
<a href="#l50.410"></a><span id="l50.410" class="difflineplus">+        params += &quot;&amp;method=&quot; + method;</span>
<a href="#l50.411"></a><span id="l50.411">         if (bNoSmtpNotify) {</span>
<a href="#l50.412"></a><span id="l50.412">             params += &quot;&amp;smtp=0&amp;smtpNotify=0&amp;notify=0&quot;;</span>
<a href="#l50.413"></a><span id="l50.413">         }</span>
<a href="#l50.414"></a><span id="l50.414">         params += &quot;&amp;replace=1&quot;; // (update) don't append to any lists</span>
<a href="#l50.415"></a><span id="l50.415">         params += &quot;&amp;fetch=1&amp;relativealarm=1&amp;compressed=1&amp;recurring=1&quot;;</span>
<a href="#l50.416"></a><span id="l50.416">         params += &quot;&amp;emailorcalid=1&amp;fmt-out=text%2Fcalendar&quot;;</span>
<a href="#l50.417"></a><span id="l50.417"> </span>
<a href="#l50.418"></a><span id="l50.418">         let netRespFunc = (err, icalRootComp) =&gt; {</span>
<a href="#l50.419"></a><span id="l50.419" class="difflineat">@@ -700,17 +697,17 @@ function calWcapCalendar_modifyItem(newI</span>
<a href="#l50.420"></a><span id="l50.420">                 let params = &quot;&amp;uid=&quot;;</span>
<a href="#l50.421"></a><span id="l50.421">                 // all deletes on the same item:</span>
<a href="#l50.422"></a><span id="l50.422">                 for (let i = exdates.value.length; i--;) {</span>
<a href="#l50.423"></a><span id="l50.423">                     params += encodeURIComponent(newItem.id);</span>
<a href="#l50.424"></a><span id="l50.424">                     if (i &gt; 0) {</span>
<a href="#l50.425"></a><span id="l50.425">                         params += &quot;;&quot;;</span>
<a href="#l50.426"></a><span id="l50.426">                     }</span>
<a href="#l50.427"></a><span id="l50.427">                 }</span>
<a href="#l50.428"></a><span id="l50.428" class="difflineminus">-                params += (&quot;&amp;mod=1&amp;rid=&quot; + exdates.value.join(&quot;;&quot;));</span>
<a href="#l50.429"></a><span id="l50.429" class="difflineplus">+                params += &quot;&amp;mod=1&amp;rid=&quot; + exdates.value.join(&quot;;&quot;);</span>
<a href="#l50.430"></a><span id="l50.430"> </span>
<a href="#l50.431"></a><span id="l50.431">                 let orgCalId = getCalId(newItem.organizer);</span>
<a href="#l50.432"></a><span id="l50.432">                 if (!orgCalId || (orgCalId != this.calId)) {</span>
<a href="#l50.433"></a><span id="l50.433">                     // item does not belong to this user, so don't notify:</span>
<a href="#l50.434"></a><span id="l50.434">                     params += &quot;&amp;smtp=0&amp;smtpNotify=0&amp;notify=0&quot;;</span>
<a href="#l50.435"></a><span id="l50.435">                 }</span>
<a href="#l50.436"></a><span id="l50.436">                 params += &quot;&amp;fmt-out=text%2Fxml&quot;;</span>
<a href="#l50.437"></a><span id="l50.437"> </span>
<a href="#l50.438"></a><span id="l50.438" class="difflineat">@@ -760,22 +757,22 @@ function calWcapCalendar_deleteItem(item</span>
<a href="#l50.439"></a><span id="l50.439">             }</span>
<a href="#l50.440"></a><span id="l50.440">         },</span>
<a href="#l50.441"></a><span id="l50.441">         log(&quot;deleteItem() call: &quot; + item.id, this));</span>
<a href="#l50.442"></a><span id="l50.442"> </span>
<a href="#l50.443"></a><span id="l50.443">     try {</span>
<a href="#l50.444"></a><span id="l50.444">         if (!item.id) {</span>
<a href="#l50.445"></a><span id="l50.445">             throw new Components.Exception(&quot;no item id!&quot;);</span>
<a href="#l50.446"></a><span id="l50.446">         }</span>
<a href="#l50.447"></a><span id="l50.447" class="difflineminus">-        let params = (&quot;&amp;uid=&quot; + encodeURIComponent(item.id));</span>
<a href="#l50.448"></a><span id="l50.448" class="difflineplus">+        let params = &quot;&amp;uid=&quot; + encodeURIComponent(item.id);</span>
<a href="#l50.449"></a><span id="l50.449">         if (isParent(item)) { // delete THIS AND ALL:</span>
<a href="#l50.450"></a><span id="l50.450">             params += &quot;&amp;mod=4&amp;rid=0&quot;;</span>
<a href="#l50.451"></a><span id="l50.451">         } else { // delete THIS INSTANCE:</span>
<a href="#l50.452"></a><span id="l50.452">             // cs does not accept DATE here:</span>
<a href="#l50.453"></a><span id="l50.453" class="difflineminus">-            params += (&quot;&amp;mod=1&amp;rid=&quot; + getIcalUTC(ensureDateTime(item.recurrenceId)));</span>
<a href="#l50.454"></a><span id="l50.454" class="difflineplus">+            params += &quot;&amp;mod=1&amp;rid=&quot; + getIcalUTC(ensureDateTime(item.recurrenceId));</span>
<a href="#l50.455"></a><span id="l50.455">         }</span>
<a href="#l50.456"></a><span id="l50.456"> </span>
<a href="#l50.457"></a><span id="l50.457">         let orgCalId = getCalId(item.organizer);</span>
<a href="#l50.458"></a><span id="l50.458">         if (!orgCalId || (orgCalId != this.calId)) {</span>
<a href="#l50.459"></a><span id="l50.459">             // item does not belong to this user, so don't notify:</span>
<a href="#l50.460"></a><span id="l50.460">             params += &quot;&amp;smtp=0&amp;smtpNotify=0&amp;notify=0&quot;;</span>
<a href="#l50.461"></a><span id="l50.461">         }</span>
<a href="#l50.462"></a><span id="l50.462"> </span>
<a href="#l50.463"></a><span id="l50.463" class="difflineat">@@ -1010,17 +1007,17 @@ calWcapCalendar.prototype.parseItems = f</span>
<a href="#l50.464"></a><span id="l50.464">                 }</span>
<a href="#l50.465"></a><span id="l50.465">             }</span>
<a href="#l50.466"></a><span id="l50.466">             // only proxies returned:</span>
<a href="#l50.467"></a><span id="l50.467">             items = items.concat(occurrences);</span>
<a href="#l50.468"></a><span id="l50.468">         }</span>
<a href="#l50.469"></a><span id="l50.469">     } else {</span>
<a href="#l50.470"></a><span id="l50.470">         if (maxResults != 0 &amp;&amp;</span>
<a href="#l50.471"></a><span id="l50.471">             (items.length + unexpandedItems.length) &gt; maxResults) {</span>
<a href="#l50.472"></a><span id="l50.472" class="difflineminus">-            unexpandedItems.length = (maxResults - items.length);</span>
<a href="#l50.473"></a><span id="l50.473" class="difflineplus">+            unexpandedItems.length = maxResults - items.length;</span>
<a href="#l50.474"></a><span id="l50.474">         }</span>
<a href="#l50.475"></a><span id="l50.475">         if (!bLeaveMutable) {</span>
<a href="#l50.476"></a><span id="l50.476">             for (let item of unexpandedItems) {</span>
<a href="#l50.477"></a><span id="l50.477">                 item.makeImmutable();</span>
<a href="#l50.478"></a><span id="l50.478">             }</span>
<a href="#l50.479"></a><span id="l50.479">         }</span>
<a href="#l50.480"></a><span id="l50.480">         if (LOG_LEVEL &gt; 2) {</span>
<a href="#l50.481"></a><span id="l50.481">             for (let item of unexpandedItems) {</span>
<a href="#l50.482"></a><span id="l50.482" class="difflineat">@@ -1132,17 +1129,17 @@ function getItemFilterParams(itemFilter)</span>
<a href="#l50.483"></a><span id="l50.483"> //     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_NEEDSNOACTION) {</span>
<a href="#l50.484"></a><span id="l50.484"> //         compstate += &quot;;REQUEST-NEEDSNOACTION&quot;;</span>
<a href="#l50.485"></a><span id="l50.485"> //     }</span>
<a href="#l50.486"></a><span id="l50.486"> //     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_PENDING)</span>
<a href="#l50.487"></a><span id="l50.487"> //         compstate += &quot;;REQUEST-PENDING&quot;;</span>
<a href="#l50.488"></a><span id="l50.488"> //     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_WAITFORREPLY)</span>
<a href="#l50.489"></a><span id="l50.489"> //         compstate += &quot;;REQUEST-WAITFORREPLY&quot;;</span>
<a href="#l50.490"></a><span id="l50.490">     if (compstate.length &gt; 0) {</span>
<a href="#l50.491"></a><span id="l50.491" class="difflineminus">-        params += (&quot;&amp;compstate=&quot; + compstate.substr(1));</span>
<a href="#l50.492"></a><span id="l50.492" class="difflineplus">+        params += &quot;&amp;compstate=&quot; + compstate.substr(1);</span>
<a href="#l50.493"></a><span id="l50.493">     }</span>
<a href="#l50.494"></a><span id="l50.494">     return params;</span>
<a href="#l50.495"></a><span id="l50.495"> }</span>
<a href="#l50.496"></a><span id="l50.496"> </span>
<a href="#l50.497"></a><span id="l50.497"> calWcapCalendar.prototype.getItems =</span>
<a href="#l50.498"></a><span id="l50.498"> function calWcapCalendar_getItems(itemFilter, maxResults, rangeStart, rangeEnd, listener) {</span>
<a href="#l50.499"></a><span id="l50.499">     rangeStart = ensureDateTime(rangeStart);</span>
<a href="#l50.500"></a><span id="l50.500">     rangeEnd = ensureDateTime(rangeEnd);</span>
<a href="#l50.501"></a><span id="l50.501" class="difflineat">@@ -1191,24 +1188,24 @@ function calWcapCalendar_getItems(itemFi</span>
<a href="#l50.502"></a><span id="l50.502">                 }</span>
<a href="#l50.503"></a><span id="l50.503">                 request.execRespFunc(null, entry.results);</span>
<a href="#l50.504"></a><span id="l50.504">                 return request;</span>
<a href="#l50.505"></a><span id="l50.505">             }</span>
<a href="#l50.506"></a><span id="l50.506">         }</span>
<a href="#l50.507"></a><span id="l50.507">     }</span>
<a href="#l50.508"></a><span id="l50.508"> </span>
<a href="#l50.509"></a><span id="l50.509">     try {</span>
<a href="#l50.510"></a><span id="l50.510" class="difflineminus">-        let params = (&quot;&amp;relativealarm=1&amp;compressed=1&amp;recurring=1&amp;emailorcalid=1&amp;fmt-out=text%2Fcalendar&quot;);</span>
<a href="#l50.511"></a><span id="l50.511" class="difflineplus">+        let params = &quot;&amp;relativealarm=1&amp;compressed=1&amp;recurring=1&amp;emailorcalid=1&amp;fmt-out=text%2Fcalendar&quot;;</span>
<a href="#l50.512"></a><span id="l50.512">         // setting component-type, compstate filters:</span>
<a href="#l50.513"></a><span id="l50.513">         params += getItemFilterParams(itemFilter);</span>
<a href="#l50.514"></a><span id="l50.514">         if (maxResults &gt; 0) {</span>
<a href="#l50.515"></a><span id="l50.515" class="difflineminus">-            params += (&quot;&amp;maxResults=&quot; + maxResults);</span>
<a href="#l50.516"></a><span id="l50.516" class="difflineplus">+            params += &quot;&amp;maxResults=&quot; + maxResults;</span>
<a href="#l50.517"></a><span id="l50.517">         }</span>
<a href="#l50.518"></a><span id="l50.518" class="difflineminus">-        params += (&quot;&amp;dtstart=&quot; + zRangeStart);</span>
<a href="#l50.519"></a><span id="l50.519" class="difflineminus">-        params += (&quot;&amp;dtend=&quot; + zRangeEnd);</span>
<a href="#l50.520"></a><span id="l50.520" class="difflineplus">+        params += &quot;&amp;dtstart=&quot; + zRangeStart;</span>
<a href="#l50.521"></a><span id="l50.521" class="difflineplus">+        params += &quot;&amp;dtend=&quot; + zRangeEnd;</span>
<a href="#l50.522"></a><span id="l50.522"> </span>
<a href="#l50.523"></a><span id="l50.523">         this.issueNetworkRequest(</span>
<a href="#l50.524"></a><span id="l50.524">             request,</span>
<a href="#l50.525"></a><span id="l50.525">             function netResp(err, icalRootComp) {</span>
<a href="#l50.526"></a><span id="l50.526">                 if (err) {</span>
<a href="#l50.527"></a><span id="l50.527">                     if (checkErrorCode(err, calIWcapErrors.WCAP_ACCESS_DENIED_TO_CALENDAR)) {</span>
<a href="#l50.528"></a><span id="l50.528">                         // try free-busy times:</span>
<a href="#l50.529"></a><span id="l50.529">                         if (listener &amp;&amp;</span>
<a href="#l50.530"></a><span id="l50.530" class="difflineat">@@ -1217,17 +1214,17 @@ function calWcapCalendar_getItems(itemFi</span>
<a href="#l50.531"></a><span id="l50.531">                             let freeBusyListener = { // calIGenericOperationListener:</span>
<a href="#l50.532"></a><span id="l50.532">                                 onResult: function freeBusyListener_onResult(oprequest, result) {</span>
<a href="#l50.533"></a><span id="l50.533">                                     if (!Components.isSuccessCode(oprequest.status)) {</span>
<a href="#l50.534"></a><span id="l50.534">                                         throw oprequest.status;</span>
<a href="#l50.535"></a><span id="l50.535">                                     }</span>
<a href="#l50.536"></a><span id="l50.536">                                     let items = [];</span>
<a href="#l50.537"></a><span id="l50.537">                                     for (let entry of result) {</span>
<a href="#l50.538"></a><span id="l50.538">                                         let item = createEvent();</span>
<a href="#l50.539"></a><span id="l50.539" class="difflineminus">-                                        item.id = (g_busyPhantomItemUuidPrefix + getIcalUTC(entry.interval.start));</span>
<a href="#l50.540"></a><span id="l50.540" class="difflineplus">+                                        item.id = g_busyPhantomItemUuidPrefix + getIcalUTC(entry.interval.start);</span>
<a href="#l50.541"></a><span id="l50.541">                                         item.calendar = this_.superCalendar;</span>
<a href="#l50.542"></a><span id="l50.542">                                         item.title = g_busyItemTitle;</span>
<a href="#l50.543"></a><span id="l50.543">                                         item.startDate = entry.interval.start;</span>
<a href="#l50.544"></a><span id="l50.544">                                         item.endDate = entry.interval.end;</span>
<a href="#l50.545"></a><span id="l50.545">                                         item.makeImmutable();</span>
<a href="#l50.546"></a><span id="l50.546">                                         items.push(item);</span>
<a href="#l50.547"></a><span id="l50.547">                                     }</span>
<a href="#l50.548"></a><span id="l50.548">                                     listener.onGetResult(this_.superCalendar, NS_OK, calIItemBase,</span>
<a href="#l50.549"></a><span id="l50.549" class="difflineat">@@ -1347,17 +1344,17 @@ function calWcapCalendar_replayChangesOn</span>
<a href="#l50.550"></a><span id="l50.550">                 }</span>
<a href="#l50.551"></a><span id="l50.551">             }</span>
<a href="#l50.552"></a><span id="l50.552">         };</span>
<a href="#l50.553"></a><span id="l50.553">         let request = new calWcapRequest(</span>
<a href="#l50.554"></a><span id="l50.554">             function netFinishedRespFunc(err, data) {</span>
<a href="#l50.555"></a><span id="l50.555">                 let modifiedIds = {};</span>
<a href="#l50.556"></a><span id="l50.556">                 for (let item of request.m_modifiedItems) {</span>
<a href="#l50.557"></a><span id="l50.557">                     let dtCreated = item.getProperty(&quot;CREATED&quot;);</span>
<a href="#l50.558"></a><span id="l50.558" class="difflineminus">-                    let bAdd = (!dtCreated || !dtFrom || dtCreated.compare(dtFrom) &gt;= 0);</span>
<a href="#l50.559"></a><span id="l50.559" class="difflineplus">+                    let bAdd = !dtCreated || !dtFrom || dtCreated.compare(dtFrom) &gt;= 0;</span>
<a href="#l50.560"></a><span id="l50.560">                     modifiedIds[item.id] = true;</span>
<a href="#l50.561"></a><span id="l50.561">                     if (bAdd) {</span>
<a href="#l50.562"></a><span id="l50.562">                         log(&quot;replayChangesOn(): new item &quot; + item.id, this_);</span>
<a href="#l50.563"></a><span id="l50.563">                         if (this_.offlineStorage) {</span>
<a href="#l50.564"></a><span id="l50.564">                             this_.offlineStorage.addItem(item, writeListener);</span>
<a href="#l50.565"></a><span id="l50.565">                         }</span>
<a href="#l50.566"></a><span id="l50.566">                     } else {</span>
<a href="#l50.567"></a><span id="l50.567">                         log(&quot;replayChangesOn(): modified item &quot; + item.id, this_);</span>
<a href="#l50.568"></a><span id="l50.568" class="difflineat">@@ -1391,23 +1388,23 @@ function calWcapCalendar_replayChangesOn</span>
<a href="#l50.569"></a><span id="l50.569">         // assure being logged in to calc server times:</span>
<a href="#l50.570"></a><span id="l50.570">         this.session.getSessionId(</span>
<a href="#l50.571"></a><span id="l50.571">             request,</span>
<a href="#l50.572"></a><span id="l50.572">             function getSessionId_resp(err, sessionId) {</span>
<a href="#l50.573"></a><span id="l50.573">                 try {</span>
<a href="#l50.574"></a><span id="l50.574">                     if (err) {</span>
<a href="#l50.575"></a><span id="l50.575">                         throw err;</span>
<a href="#l50.576"></a><span id="l50.576">                     }</span>
<a href="#l50.577"></a><span id="l50.577" class="difflineminus">-                    let params = (&quot;&amp;relativealarm=1&amp;compressed=1&amp;recurring=1&quot; +</span>
<a href="#l50.578"></a><span id="l50.578" class="difflineminus">-                                  &quot;&amp;emailorcalid=1&amp;fmt-out=text%2Fcalendar&quot;);</span>
<a href="#l50.579"></a><span id="l50.579" class="difflineplus">+                    let params = &quot;&amp;relativealarm=1&amp;compressed=1&amp;recurring=1&quot; +</span>
<a href="#l50.580"></a><span id="l50.580" class="difflineplus">+                                 &quot;&amp;emailorcalid=1&amp;fmt-out=text%2Fcalendar&quot;;</span>
<a href="#l50.581"></a><span id="l50.581">                     if (dtFrom) {</span>
<a href="#l50.582"></a><span id="l50.582">                         dtFrom = this_.session.getServerTime(dtFrom);</span>
<a href="#l50.583"></a><span id="l50.583">                     }</span>
<a href="#l50.584"></a><span id="l50.584" class="difflineminus">-                    params += (&quot;&amp;dtstart=&quot; + getIcalUTC(dtFrom));</span>
<a href="#l50.585"></a><span id="l50.585" class="difflineminus">-                    params += (&quot;&amp;dtend=&quot; + getIcalUTC(this_.session.getServerTime(now)));</span>
<a href="#l50.586"></a><span id="l50.586" class="difflineplus">+                    params += &quot;&amp;dtstart=&quot; + getIcalUTC(dtFrom);</span>
<a href="#l50.587"></a><span id="l50.587" class="difflineplus">+                    params += &quot;&amp;dtend=&quot; + getIcalUTC(this_.session.getServerTime(now));</span>
<a href="#l50.588"></a><span id="l50.588"> </span>
<a href="#l50.589"></a><span id="l50.589">                     log(&quot;replayChangesOn(): getting last modifications...&quot;, this_);</span>
<a href="#l50.590"></a><span id="l50.590">                     this_.issueNetworkRequest(</span>
<a href="#l50.591"></a><span id="l50.591">                         request,</span>
<a href="#l50.592"></a><span id="l50.592">                         function modifiedNetResp(fetcherr, icalRootComp) {</span>
<a href="#l50.593"></a><span id="l50.593">                             if (fetcherr) {</span>
<a href="#l50.594"></a><span id="l50.594">                                 throw fetcherr;</span>
<a href="#l50.595"></a><span id="l50.595">                             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarModule.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarModule.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -52,17 +52,17 @@ var LOG_LEVEL = 0;</span>
<a href="#l51.4"></a><span id="l51.4"> function initWcapProvider() {</span>
<a href="#l51.5"></a><span id="l51.5">     try {</span>
<a href="#l51.6"></a><span id="l51.6">         initLogging();</span>
<a href="#l51.7"></a><span id="l51.7"> </span>
<a href="#l51.8"></a><span id="l51.8">         // some string resources:</span>
<a href="#l51.9"></a><span id="l51.9">         g_privateItemTitle = cal.calGetString(&quot;wcap&quot;, &quot;privateItem.title.text&quot;);</span>
<a href="#l51.10"></a><span id="l51.10">         g_confidentialItemTitle = cal.calGetString(&quot;wcap&quot;, &quot;confidentialItem.title.text&quot;);</span>
<a href="#l51.11"></a><span id="l51.11">         g_busyItemTitle = cal.calGetString(&quot;wcap&quot;, &quot;busyItem.title.text&quot;);</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-        g_busyPhantomItemUuidPrefix = (&quot;PHANTOM_uuid_&quot; + cal.getUUID());</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+        g_busyPhantomItemUuidPrefix = &quot;PHANTOM_uuid_&quot; + cal.getUUID();</span>
<a href="#l51.14"></a><span id="l51.14"> </span>
<a href="#l51.15"></a><span id="l51.15">         CACHE_LAST_RESULTS = Preferences.get(&quot;calendar.wcap.cache_last_results&quot;, 4);</span>
<a href="#l51.16"></a><span id="l51.16">         CACHE_LAST_RESULTS_INVALIDATE = Preferences.get(&quot;calendar.wcap.cache_last_results_invalidate&quot;, 120);</span>
<a href="#l51.17"></a><span id="l51.17">     } catch (exc) {</span>
<a href="#l51.18"></a><span id="l51.18">         logError(exc, &quot;error in init sequence&quot;);</span>
<a href="#l51.19"></a><span id="l51.19">     }</span>
<a href="#l51.20"></a><span id="l51.20"> }</span>
<a href="#l51.21"></a><span id="l51.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapErrors.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapErrors.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -23,17 +23,17 @@ function generateNetFailure(code) {</span>
<a href="#l52.4"></a><span id="l52.4">     return generateFailure(NS_ERROR_MODULE_NETWORK, code);</span>
<a href="#l52.5"></a><span id="l52.5"> }</span>
<a href="#l52.6"></a><span id="l52.6"> </span>
<a href="#l52.7"></a><span id="l52.7"> function getResultCode(err) {</span>
<a href="#l52.8"></a><span id="l52.8">     if (err === undefined || err === null) {</span>
<a href="#l52.9"></a><span id="l52.9">         return NS_OK;</span>
<a href="#l52.10"></a><span id="l52.10">     }</span>
<a href="#l52.11"></a><span id="l52.11">     if (isNaN(err)) {</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-        return ((err instanceof nsIException) ? err.result : Components.results.NS_ERROR_FAILURE);</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+        return (err instanceof nsIException ? err.result : Components.results.NS_ERROR_FAILURE);</span>
<a href="#l52.14"></a><span id="l52.14">     }</span>
<a href="#l52.15"></a><span id="l52.15">     return err;</span>
<a href="#l52.16"></a><span id="l52.16"> }</span>
<a href="#l52.17"></a><span id="l52.17"> </span>
<a href="#l52.18"></a><span id="l52.18"> function getErrorModule(err) {</span>
<a href="#l52.19"></a><span id="l52.19">     let rc = getResultCode(err);</span>
<a href="#l52.20"></a><span id="l52.20">     return (((rc &gt;&gt;&gt; 16) &amp; 0x7fff) - NS_ERROR_MODULE_BASE_OFFSET);</span>
<a href="#l52.21"></a><span id="l52.21"> }</span>
<a href="#l52.22"></a><span id="l52.22" class="difflineat">@@ -323,17 +323,17 @@ function errorToString(err) {</span>
<a href="#l52.23"></a><span id="l52.23">         }</span>
<a href="#l52.24"></a><span id="l52.24">         if (err instanceof Error) {</span>
<a href="#l52.25"></a><span id="l52.25">             return err.message;</span>
<a href="#l52.26"></a><span id="l52.26">         }</span>
<a href="#l52.27"></a><span id="l52.27">         if (err instanceof nsIException) {</span>
<a href="#l52.28"></a><span id="l52.28">             return err.toString(); // xxx todo: or just message?</span>
<a href="#l52.29"></a><span id="l52.29">         }</span>
<a href="#l52.30"></a><span id="l52.30">         if (isNaN(err)) {</span>
<a href="#l52.31"></a><span id="l52.31" class="difflineminus">-            return (&quot;[&quot; + err + &quot;] unknown error.&quot;);</span>
<a href="#l52.32"></a><span id="l52.32" class="difflineplus">+            return &quot;[&quot; + err + &quot;] unknown error.&quot;;</span>
<a href="#l52.33"></a><span id="l52.33">         }</span>
<a href="#l52.34"></a><span id="l52.34">     }</span>
<a href="#l52.35"></a><span id="l52.35">     // numeric codes:</span>
<a href="#l52.36"></a><span id="l52.36">     switch (err) {</span>
<a href="#l52.37"></a><span id="l52.37">         case undefined:</span>
<a href="#l52.38"></a><span id="l52.38">         case null:</span>
<a href="#l52.39"></a><span id="l52.39">         case NS_OK:</span>
<a href="#l52.40"></a><span id="l52.40">             return &quot;NS_OK&quot;;</span>
<a href="#l52.41"></a><span id="l52.41" class="difflineat">@@ -373,14 +373,14 @@ function errorToString(err) {</span>
<a href="#l52.42"></a><span id="l52.42">                 } catch (exc2) {</span>
<a href="#l52.43"></a><span id="l52.43">                     if (err &amp; calIErrors.ERROR_BASE) {</span>
<a href="#l52.44"></a><span id="l52.44">                         for (let err_ in calIErrors) {</span>
<a href="#l52.45"></a><span id="l52.45">                             if (calIErrors[err_] == err) {</span>
<a href="#l52.46"></a><span id="l52.46">                                 return err_;</span>
<a href="#l52.47"></a><span id="l52.47">                             }</span>
<a href="#l52.48"></a><span id="l52.48">                         }</span>
<a href="#l52.49"></a><span id="l52.49">                     }</span>
<a href="#l52.50"></a><span id="l52.50" class="difflineminus">-                    return (&quot;[0x&quot; + err.toString(0x10) + &quot;] unknown error.&quot;);</span>
<a href="#l52.51"></a><span id="l52.51" class="difflineplus">+                    return &quot;[0x&quot; + err.toString(0x10) + &quot;] unknown error.&quot;;</span>
<a href="#l52.52"></a><span id="l52.52">                 }</span>
<a href="#l52.53"></a><span id="l52.53">             }</span>
<a href="#l52.54"></a><span id="l52.54">     }</span>
<a href="#l52.55"></a><span id="l52.55"> }</span>
<a href="#l52.56"></a><span id="l52.56"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -19,21 +19,21 @@</span>
<a href="#l53.4"></a><span id="l53.4"> </span>
<a href="#l53.5"></a><span id="l53.5"> /* exported issueNetworkRequest, getWcapRequestStatusString, stringToIcal, stringToXml */</span>
<a href="#l53.6"></a><span id="l53.6"> </span>
<a href="#l53.7"></a><span id="l53.7"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l53.8"></a><span id="l53.8"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l53.9"></a><span id="l53.9"> </span>
<a href="#l53.10"></a><span id="l53.10"> function generateRequestId() {</span>
<a href="#l53.11"></a><span id="l53.11">     if (!generateRequestId.mRequestPrefix) {</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-        generateRequestId.mRequestPrefix = (cal.getUUID() + &quot;-&quot;);</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+        generateRequestId.mRequestPrefix = cal.getUUID() + &quot;-&quot;;</span>
<a href="#l53.14"></a><span id="l53.14">         generateRequestId.mRequestId = 0;</span>
<a href="#l53.15"></a><span id="l53.15">     }</span>
<a href="#l53.16"></a><span id="l53.16">     ++generateRequestId.mRequestId;</span>
<a href="#l53.17"></a><span id="l53.17" class="difflineminus">-    return (generateRequestId.mRequestPrefix + generateRequestId.mRequestId);</span>
<a href="#l53.18"></a><span id="l53.18" class="difflineplus">+    return generateRequestId.mRequestPrefix + generateRequestId.mRequestId;</span>
<a href="#l53.19"></a><span id="l53.19"> }</span>
<a href="#l53.20"></a><span id="l53.20"> </span>
<a href="#l53.21"></a><span id="l53.21"> function calWcapRequest(respFunc, logContext) {</span>
<a href="#l53.22"></a><span id="l53.22">     this.wrappedJSObject = this;</span>
<a href="#l53.23"></a><span id="l53.23">     this.m_logContext = logContext;</span>
<a href="#l53.24"></a><span id="l53.24">     this.m_id = generateRequestId();</span>
<a href="#l53.25"></a><span id="l53.25">     this.m_isPending = true;</span>
<a href="#l53.26"></a><span id="l53.26">     this.m_status = NS_OK;</span>
<a href="#l53.27"></a><span id="l53.27" class="difflineat">@@ -74,27 +74,27 @@ calWcapRequest.prototype = {</span>
<a href="#l53.28"></a><span id="l53.28">             // assures that respFunc is executed:</span>
<a href="#l53.29"></a><span id="l53.29">             if (this.m_attachedRequests.length == 0) {</span>
<a href="#l53.30"></a><span id="l53.30">                 this.execRespFunc();</span>
<a href="#l53.31"></a><span id="l53.31">             }</span>
<a href="#l53.32"></a><span id="l53.32">         }</span>
<a href="#l53.33"></a><span id="l53.33">     },</span>
<a href="#l53.34"></a><span id="l53.34"> </span>
<a href="#l53.35"></a><span id="l53.35">     toString: function calWcapRequest_toString() {</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineminus">-        let ret = (&quot;calWcapRequest id=&quot; + this.id +</span>
<a href="#l53.37"></a><span id="l53.37" class="difflineminus">-                   &quot;, parent-id=&quot; + (this.parentRequest ? this.parentRequest.id : &quot;&lt;none&gt;&quot;) +</span>
<a href="#l53.38"></a><span id="l53.38" class="difflineminus">-                   &quot; (&quot; + this.m_logContext + &quot;)&quot;);</span>
<a href="#l53.39"></a><span id="l53.39" class="difflineplus">+        let ret = &quot;calWcapRequest id=&quot; + this.id +</span>
<a href="#l53.40"></a><span id="l53.40" class="difflineplus">+                  &quot;, parent-id=&quot; + (this.parentRequest ? this.parentRequest.id : &quot;&lt;none&gt;&quot;) +</span>
<a href="#l53.41"></a><span id="l53.41" class="difflineplus">+                  &quot; (&quot; + this.m_logContext + &quot;)&quot;;</span>
<a href="#l53.42"></a><span id="l53.42">         if (LOG_LEVEL &gt; 2 &amp;&amp; this.m_attachedRequests.length &gt; 0) {</span>
<a href="#l53.43"></a><span id="l53.43">             ret += &quot;\nattached requests:&quot;;</span>
<a href="#l53.44"></a><span id="l53.44">             for (let req of this.m_attachedRequests) {</span>
<a href="#l53.45"></a><span id="l53.45" class="difflineminus">-                ret += (&quot;\n#&quot; + req.id + &quot;\t&quot; + req);</span>
<a href="#l53.46"></a><span id="l53.46" class="difflineplus">+                ret += &quot;\n#&quot; + req.id + &quot;\t&quot; + req;</span>
<a href="#l53.47"></a><span id="l53.47">             }</span>
<a href="#l53.48"></a><span id="l53.48">         }</span>
<a href="#l53.49"></a><span id="l53.49" class="difflineminus">-        ret += (&quot;, isPending=&quot; + this.isPending);</span>
<a href="#l53.50"></a><span id="l53.50" class="difflineminus">-        ret += (&quot;, status=&quot; + errorToString(this.status));</span>
<a href="#l53.51"></a><span id="l53.51" class="difflineplus">+        ret += &quot;, isPending=&quot; + this.isPending;</span>
<a href="#l53.52"></a><span id="l53.52" class="difflineplus">+        ret += &quot;, status=&quot; + errorToString(this.status);</span>
<a href="#l53.53"></a><span id="l53.53">         return ret;</span>
<a href="#l53.54"></a><span id="l53.54">     },</span>
<a href="#l53.55"></a><span id="l53.55"> </span>
<a href="#l53.56"></a><span id="l53.56">     attachSubRequest: function calWcapRequest_attachSubRequest(req) {</span>
<a href="#l53.57"></a><span id="l53.57">         if (req) {</span>
<a href="#l53.58"></a><span id="l53.58">             if (!this.m_attachedRequests.some(function(req_) { return req.id == req_.id; })) {</span>
<a href="#l53.59"></a><span id="l53.59">                 if (req.isPending) {</span>
<a href="#l53.60"></a><span id="l53.60">                     this.m_attachedRequests.push(req);</span>
<a href="#l53.61"></a><span id="l53.61" class="difflineat">@@ -292,34 +292,34 @@ calWcapNetworkRequest.prototype = {</span>
<a href="#l53.62"></a><span id="l53.62">         let httpChannel = aLoader.channel.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l53.63"></a><span id="l53.63">         switch (httpChannel.responseStatus / 100) {</span>
<a href="#l53.64"></a><span id="l53.64">             case 2: /* 2xx codes */</span>
<a href="#l53.65"></a><span id="l53.65">                 // Everything worked out, we are done</span>
<a href="#l53.66"></a><span id="l53.66">                 this.execRespFunc(aStatus, unicharData);</span>
<a href="#l53.67"></a><span id="l53.67">                 break;</span>
<a href="#l53.68"></a><span id="l53.68">             default: {</span>
<a href="#l53.69"></a><span id="l53.69">                 // Something else went wrong</span>
<a href="#l53.70"></a><span id="l53.70" class="difflineminus">-                let error = (&quot;A request Error Occurred. Status Code: &quot; +</span>
<a href="#l53.71"></a><span id="l53.71" class="difflineminus">-                             httpChannel.responseStatus + &quot; &quot; +</span>
<a href="#l53.72"></a><span id="l53.72" class="difflineminus">-                             httpChannel.responseStatusText + &quot; Body: &quot; +</span>
<a href="#l53.73"></a><span id="l53.73" class="difflineminus">-                             unicharData);</span>
<a href="#l53.74"></a><span id="l53.74" class="difflineplus">+                let error = &quot;A request Error Occurred. Status Code: &quot; +</span>
<a href="#l53.75"></a><span id="l53.75" class="difflineplus">+                            httpChannel.responseStatus + &quot; &quot; +</span>
<a href="#l53.76"></a><span id="l53.76" class="difflineplus">+                            httpChannel.responseStatusText + &quot; Body: &quot; +</span>
<a href="#l53.77"></a><span id="l53.77" class="difflineplus">+                            unicharData;</span>
<a href="#l53.78"></a><span id="l53.78">                 this.execRespFunc(Components.Exception(error, NS_BINDING_FAILED));</span>
<a href="#l53.79"></a><span id="l53.79">                 break;</span>
<a href="#l53.80"></a><span id="l53.80">             }</span>
<a href="#l53.81"></a><span id="l53.81">         }</span>
<a href="#l53.82"></a><span id="l53.82">     },</span>
<a href="#l53.83"></a><span id="l53.83"> </span>
<a href="#l53.84"></a><span id="l53.84">     toString: function calWcapNetworkRequest_toString() {</span>
<a href="#l53.85"></a><span id="l53.85" class="difflineminus">-        let ret = (&quot;calWcapNetworkRequest id=&quot; + this.id +</span>
<a href="#l53.86"></a><span id="l53.86" class="difflineminus">-                   &quot;, parent-id=&quot; + (this.parentRequest ? this.parentRequest.id : &quot;&lt;none&gt;&quot;));</span>
<a href="#l53.87"></a><span id="l53.87" class="difflineplus">+        let ret = &quot;calWcapNetworkRequest id=&quot; + this.id +</span>
<a href="#l53.88"></a><span id="l53.88" class="difflineplus">+                   &quot;, parent-id=&quot; + (this.parentRequest ? this.parentRequest.id : &quot;&lt;none&gt;&quot;);</span>
<a href="#l53.89"></a><span id="l53.89">         if (this.m_bLogging) {</span>
<a href="#l53.90"></a><span id="l53.90" class="difflineminus">-            ret += (&quot; (&quot; + this.m_url + &quot;)&quot;);</span>
<a href="#l53.91"></a><span id="l53.91" class="difflineplus">+            ret += &quot; (&quot; + this.m_url + &quot;)&quot;;</span>
<a href="#l53.92"></a><span id="l53.92">         }</span>
<a href="#l53.93"></a><span id="l53.93" class="difflineminus">-        ret += (&quot;, isPending=&quot; + this.isPending);</span>
<a href="#l53.94"></a><span id="l53.94" class="difflineminus">-        ret += (&quot;, status=&quot; + errorToString(this.status));</span>
<a href="#l53.95"></a><span id="l53.95" class="difflineplus">+        ret += &quot;, isPending=&quot; + this.isPending;</span>
<a href="#l53.96"></a><span id="l53.96" class="difflineplus">+        ret += &quot;, status=&quot; + errorToString(this.status);</span>
<a href="#l53.97"></a><span id="l53.97">         return ret;</span>
<a href="#l53.98"></a><span id="l53.98">     },</span>
<a href="#l53.99"></a><span id="l53.99"> </span>
<a href="#l53.100"></a><span id="l53.100">     m_parentRequest: null,</span>
<a href="#l53.101"></a><span id="l53.101">     get parentRequest() {</span>
<a href="#l53.102"></a><span id="l53.102">         return this.m_parentRequest;</span>
<a href="#l53.103"></a><span id="l53.103">     },</span>
<a href="#l53.104"></a><span id="l53.104">     set parentRequest(req) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -32,19 +32,19 @@ calWcapTimezone.prototype = {</span>
<a href="#l54.4"></a><span id="l54.4">     toString: function() {</span>
<a href="#l54.5"></a><span id="l54.5">         return this.icalComponent.toString();</span>
<a href="#l54.6"></a><span id="l54.6">     }</span>
<a href="#l54.7"></a><span id="l54.7"> };</span>
<a href="#l54.8"></a><span id="l54.8"> </span>
<a href="#l54.9"></a><span id="l54.9"> function splitUriParams(uri) {</span>
<a href="#l54.10"></a><span id="l54.10">     let spec = uri.spec;</span>
<a href="#l54.11"></a><span id="l54.11">     let qmPos = spec.indexOf(&quot;?&quot;);</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-    return ((qmPos != -1)</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineminus">-            ? [spec.substring(0, qmPos), spec.substring(qmPos)]</span>
<a href="#l54.14"></a><span id="l54.14" class="difflineminus">-            : [spec, &quot;&quot;]);</span>
<a href="#l54.15"></a><span id="l54.15" class="difflineplus">+    return qmPos != -1</span>
<a href="#l54.16"></a><span id="l54.16" class="difflineplus">+           ? [spec.substring(0, qmPos), spec.substring(qmPos)]</span>
<a href="#l54.17"></a><span id="l54.17" class="difflineplus">+           : [spec, &quot;&quot;];</span>
<a href="#l54.18"></a><span id="l54.18"> }</span>
<a href="#l54.19"></a><span id="l54.19"> </span>
<a href="#l54.20"></a><span id="l54.20"> function getWcapSessionFor(calendar, uri) {</span>
<a href="#l54.21"></a><span id="l54.21">     let contextId = calendar.getProperty(&quot;shared_context&quot;);</span>
<a href="#l54.22"></a><span id="l54.22">     if (!contextId) {</span>
<a href="#l54.23"></a><span id="l54.23">         contextId = cal.getUUID();</span>
<a href="#l54.24"></a><span id="l54.24">         calendar.setProperty(&quot;shared_context&quot;, contextId);</span>
<a href="#l54.25"></a><span id="l54.25">     }</span>
<a href="#l54.26"></a><span id="l54.26" class="difflineat">@@ -77,17 +77,17 @@ function getWcapSessionFor(calendar, uri</span>
<a href="#l54.27"></a><span id="l54.27"> </span>
<a href="#l54.28"></a><span id="l54.28">             // check and fix changing urls (autoconf) of subscribed calendars here:</span>
<a href="#l54.29"></a><span id="l54.29">             for (let regCal of registeredCalendars) {</span>
<a href="#l54.30"></a><span id="l54.30">                 if (!regCal.isDefaultCalendar) {</span>
<a href="#l54.31"></a><span id="l54.31">                     let [spec, params] = splitUriParams(regCal.uri);</span>
<a href="#l54.32"></a><span id="l54.32">                     if (spec != defaultSpec) {</span>
<a href="#l54.33"></a><span id="l54.33">                         log(&quot;fixing url of subscribed calendar: &quot; + regCal.calId, session);</span>
<a href="#l54.34"></a><span id="l54.34">                         let caluri = regCal.uri.clone();</span>
<a href="#l54.35"></a><span id="l54.35" class="difflineminus">-                        caluri.spec = (defaultSpec + params);</span>
<a href="#l54.36"></a><span id="l54.36" class="difflineplus">+                        caluri.spec = defaultSpec + params;</span>
<a href="#l54.37"></a><span id="l54.37">                         regCal.uri = caluri;</span>
<a href="#l54.38"></a><span id="l54.38">                         regCal.setProperty(&quot;uri&quot;, caluri.spec);</span>
<a href="#l54.39"></a><span id="l54.39">                     }</span>
<a href="#l54.40"></a><span id="l54.40">                 }</span>
<a href="#l54.41"></a><span id="l54.41">             }</span>
<a href="#l54.42"></a><span id="l54.42">         } else { // no default calendar found, dump all subscribed calendars:</span>
<a href="#l54.43"></a><span id="l54.43">             registeredCalendars.forEach(cal.getCalendarManager().unregisterCalendar,</span>
<a href="#l54.44"></a><span id="l54.44">                                         cal.getCalendarManager());</span>
<a href="#l54.45"></a><span id="l54.45" class="difflineat">@@ -119,19 +119,19 @@ calWcapSession.prototype = {</span>
<a href="#l54.46"></a><span id="l54.46">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l54.47"></a><span id="l54.47">         classID: calWcapSessionClassID,</span>
<a href="#l54.48"></a><span id="l54.48">         contractID: &quot;@mozilla.org/calendar/wcap/session;1&quot;,</span>
<a href="#l54.49"></a><span id="l54.49">         classDescription: &quot;Sun Java System Calendar Server WCAP Session&quot;,</span>
<a href="#l54.50"></a><span id="l54.50">         interfaces: calWcapSessionInterfaces</span>
<a href="#l54.51"></a><span id="l54.51">     }),</span>
<a href="#l54.52"></a><span id="l54.52"> </span>
<a href="#l54.53"></a><span id="l54.53">     toString: function calWcapSession_toString(msg) {</span>
<a href="#l54.54"></a><span id="l54.54" class="difflineminus">-        let str = (&quot;context-id: &quot; + this.m_contextId + &quot;, uri: &quot; + (this.uri ? this.uri.spec : &quot;unknown&quot;));</span>
<a href="#l54.55"></a><span id="l54.55" class="difflineplus">+        let str = &quot;context-id: &quot; + this.m_contextId + &quot;, uri: &quot; + (this.uri ? this.uri.spec : &quot;unknown&quot;);</span>
<a href="#l54.56"></a><span id="l54.56">         if (this.credentials.userId) {</span>
<a href="#l54.57"></a><span id="l54.57" class="difflineminus">-            str += (&quot;, userId=&quot; + this.credentials.userId);</span>
<a href="#l54.58"></a><span id="l54.58" class="difflineplus">+            str += &quot;, userId=&quot; + this.credentials.userId;</span>
<a href="#l54.59"></a><span id="l54.59">         }</span>
<a href="#l54.60"></a><span id="l54.60">         if (!this.m_sessionId) {</span>
<a href="#l54.61"></a><span id="l54.61">             str += (Services.io.offline ? &quot;, offline&quot; : &quot;, not logged in&quot;);</span>
<a href="#l54.62"></a><span id="l54.62">         }</span>
<a href="#l54.63"></a><span id="l54.63">         return str;</span>
<a href="#l54.64"></a><span id="l54.64">     },</span>
<a href="#l54.65"></a><span id="l54.65">     notifyError: function calWcapSession_notifyError(err) {</span>
<a href="#l54.66"></a><span id="l54.66">         if (this.defaultCalendar) {</span>
<a href="#l54.67"></a><span id="l54.67" class="difflineat">@@ -575,17 +575,17 @@ calWcapSession.prototype = {</span>
<a href="#l54.68"></a><span id="l54.68">                     checkWcapXmlErrno(node);</span>
<a href="#l54.69"></a><span id="l54.69">                     let ar = filterXmlNodes(&quot;X-NSCP-CALPROPS-RELATIVE-CALID&quot;, node);</span>
<a href="#l54.70"></a><span id="l54.70">                     if (ar.length &gt; 0) {</span>
<a href="#l54.71"></a><span id="l54.71">                         let calId = ar[0];</span>
<a href="#l54.72"></a><span id="l54.72">                         let calendar = cals[calId];</span>
<a href="#l54.73"></a><span id="l54.73">                         if (calendar === null) {</span>
<a href="#l54.74"></a><span id="l54.74">                             calendar = new calWcapCalendar(this_);</span>
<a href="#l54.75"></a><span id="l54.75">                             let uri = this_.uri.clone();</span>
<a href="#l54.76"></a><span id="l54.76" class="difflineminus">-                            uri.path += (&quot;?calid=&quot; + encodeURIComponent(calId));</span>
<a href="#l54.77"></a><span id="l54.77" class="difflineplus">+                            uri.path += &quot;?calid=&quot; + encodeURIComponent(calId);</span>
<a href="#l54.78"></a><span id="l54.78">                             calendar.uri = uri;</span>
<a href="#l54.79"></a><span id="l54.79">                         }</span>
<a href="#l54.80"></a><span id="l54.80">                         if (calendar) {</span>
<a href="#l54.81"></a><span id="l54.81">                             calendar.m_calProps = node;</span>
<a href="#l54.82"></a><span id="l54.82">                             if (respFunc) {</span>
<a href="#l54.83"></a><span id="l54.83">                                 respFunc(calendar);</span>
<a href="#l54.84"></a><span id="l54.84">                             }</span>
<a href="#l54.85"></a><span id="l54.85">                         }</span>
<a href="#l54.86"></a><span id="l54.86" class="difflineat">@@ -698,17 +698,17 @@ calWcapSession.prototype = {</span>
<a href="#l54.87"></a><span id="l54.87">                 log(&quot;installed timezones.&quot;, this_);</span>
<a href="#l54.88"></a><span id="l54.88">             },</span>
<a href="#l54.89"></a><span id="l54.89">             stringToIcal, &quot;get_all_timezones&quot;, &quot;&amp;fmt-out=text%2Fcalendar&quot;,</span>
<a href="#l54.90"></a><span id="l54.90">             sessionId);</span>
<a href="#l54.91"></a><span id="l54.91">     },</span>
<a href="#l54.92"></a><span id="l54.92"> </span>
<a href="#l54.93"></a><span id="l54.93">     getCommandUrl: function calWcapSession_getCommandUrl(wcapCommand, params, sessionId) {</span>
<a href="#l54.94"></a><span id="l54.94">         let url = this.sessionUri.spec;</span>
<a href="#l54.95"></a><span id="l54.95" class="difflineminus">-        url += (wcapCommand + &quot;.wcap?appid=mozilla-calendar&amp;id=&quot;);</span>
<a href="#l54.96"></a><span id="l54.96" class="difflineplus">+        url += wcapCommand + &quot;.wcap?appid=mozilla-calendar&amp;id=&quot;;</span>
<a href="#l54.97"></a><span id="l54.97">         url += sessionId;</span>
<a href="#l54.98"></a><span id="l54.98">         url += params;</span>
<a href="#l54.99"></a><span id="l54.99">         return url;</span>
<a href="#l54.100"></a><span id="l54.100">     },</span>
<a href="#l54.101"></a><span id="l54.101"> </span>
<a href="#l54.102"></a><span id="l54.102">     issueNetworkRequest: function calWcapSession_issueNetworkRequest(</span>
<a href="#l54.103"></a><span id="l54.103">                     request, respFunc, dataConvFunc, wcapCommand, params) {</span>
<a href="#l54.104"></a><span id="l54.104">         let this_ = this;</span>
<a href="#l54.105"></a><span id="l54.105" class="difflineat">@@ -879,22 +879,22 @@ calWcapSession.prototype = {</span>
<a href="#l54.106"></a><span id="l54.106">                     listener.onResult(oprequest, data);</span>
<a href="#l54.107"></a><span id="l54.107">                 }</span>
<a href="#l54.108"></a><span id="l54.108">             },</span>
<a href="#l54.109"></a><span id="l54.109">             log(&quot;searchForCalendars, searchString=&quot; + searchString, this));</span>
<a href="#l54.110"></a><span id="l54.110"> </span>
<a href="#l54.111"></a><span id="l54.111">         try {</span>
<a href="#l54.112"></a><span id="l54.112">             let registeredCalendars = this.getRegisteredCalendars(true);</span>
<a href="#l54.113"></a><span id="l54.113"> </span>
<a href="#l54.114"></a><span id="l54.114" class="difflineminus">-            let params = (&quot;&amp;fmt-out=text%2Fxml&amp;search-string=&quot; + encodeURIComponent(searchString));</span>
<a href="#l54.115"></a><span id="l54.115" class="difflineplus">+            let params = &quot;&amp;fmt-out=text%2Fxml&amp;search-string=&quot; + encodeURIComponent(searchString);</span>
<a href="#l54.116"></a><span id="l54.116">             if (maxResults &gt; 0) {</span>
<a href="#l54.117"></a><span id="l54.117" class="difflineminus">-                params += (&quot;&amp;maxResults=&quot; + maxResults);</span>
<a href="#l54.118"></a><span id="l54.118" class="difflineplus">+                params += &quot;&amp;maxResults=&quot; + maxResults;</span>
<a href="#l54.119"></a><span id="l54.119">             }</span>
<a href="#l54.120"></a><span id="l54.120" class="difflineminus">-            params += (&quot;&amp;name=1&amp;calid=1&amp;primaryOwner=1&amp;searchOpts=&quot; +</span>
<a href="#l54.121"></a><span id="l54.121" class="difflineminus">-                       ((hints &amp; calICalendarSearchProvider.HINT_EXACT_MATCH) ? &quot;3&quot; : &quot;0&quot;));</span>
<a href="#l54.122"></a><span id="l54.122" class="difflineplus">+            params += &quot;&amp;name=1&amp;calid=1&amp;primaryOwner=1&amp;searchOpts=&quot; +</span>
<a href="#l54.123"></a><span id="l54.123" class="difflineplus">+                       (hints &amp; calICalendarSearchProvider.HINT_EXACT_MATCH ? &quot;3&quot; : &quot;0&quot;);</span>
<a href="#l54.124"></a><span id="l54.124"> </span>
<a href="#l54.125"></a><span id="l54.125">             this.issueNetworkRequest(</span>
<a href="#l54.126"></a><span id="l54.126">                 request,</span>
<a href="#l54.127"></a><span id="l54.127">                 function searchForCalendars_netResp(err, data) {</span>
<a href="#l54.128"></a><span id="l54.128">                     if (err) {</span>
<a href="#l54.129"></a><span id="l54.129">                         throw err;</span>
<a href="#l54.130"></a><span id="l54.130">                     }</span>
<a href="#l54.131"></a><span id="l54.131">                     // string to xml converter func without WCAP errno check:</span>
<a href="#l54.132"></a><span id="l54.132" class="difflineat">@@ -913,17 +913,17 @@ calWcapSession.prototype = {</span>
<a href="#l54.133"></a><span id="l54.133">                             if (ar.length &gt; 0) {</span>
<a href="#l54.134"></a><span id="l54.134">                                 let calId = ar[0];</span>
<a href="#l54.135"></a><span id="l54.135">                                 let calendar = registeredCalendars[calId];</span>
<a href="#l54.136"></a><span id="l54.136">                                 if (calendar) {</span>
<a href="#l54.137"></a><span id="l54.137">                                     calendar.m_calProps = node; // update calprops</span>
<a href="#l54.138"></a><span id="l54.138">                                 } else {</span>
<a href="#l54.139"></a><span id="l54.139">                                     calendar = new calWcapCalendar(this_, node);</span>
<a href="#l54.140"></a><span id="l54.140">                                     let uri = this_.uri.clone();</span>
<a href="#l54.141"></a><span id="l54.141" class="difflineminus">-                                    uri.path += (&quot;?calid=&quot; + encodeURIComponent(calId));</span>
<a href="#l54.142"></a><span id="l54.142" class="difflineplus">+                                    uri.path += &quot;?calid=&quot; + encodeURIComponent(calId);</span>
<a href="#l54.143"></a><span id="l54.143">                                     calendar.uri = uri;</span>
<a href="#l54.144"></a><span id="l54.144">                                 }</span>
<a href="#l54.145"></a><span id="l54.145">                                 ret.push(calendar);</span>
<a href="#l54.146"></a><span id="l54.146">                             }</span>
<a href="#l54.147"></a><span id="l54.147">                         } catch (exc) {</span>
<a href="#l54.148"></a><span id="l54.148">                             switch (getResultCode(exc)) {</span>
<a href="#l54.149"></a><span id="l54.149">                                 case calIWcapErrors.WCAP_NO_ERRNO: // workaround</span>
<a href="#l54.150"></a><span id="l54.150">                                 case calIWcapErrors.WCAP_ACCESS_DENIED_TO_CALENDAR:</span>
<a href="#l54.151"></a><span id="l54.151" class="difflineat">@@ -982,20 +982,20 @@ calWcapSession.prototype = {</span>
<a href="#l54.152"></a><span id="l54.152">             if (!data || data.length == 0) { // assuming invalid user</span>
<a href="#l54.153"></a><span id="l54.153">                 throw new Components.Exception(errorToString(calIWcapErrors.WCAP_CALENDAR_DOES_NOT_EXIST),</span>
<a href="#l54.154"></a><span id="l54.154">                                                calIWcapErrors.WCAP_CALENDAR_DOES_NOT_EXIST);</span>
<a href="#l54.155"></a><span id="l54.155">             }</span>
<a href="#l54.156"></a><span id="l54.156">             return stringToXml(session, data);</span>
<a href="#l54.157"></a><span id="l54.157">         };</span>
<a href="#l54.158"></a><span id="l54.158"> </span>
<a href="#l54.159"></a><span id="l54.159">         try {</span>
<a href="#l54.160"></a><span id="l54.160" class="difflineminus">-            let params = (&quot;&amp;calid=&quot; + encodeURIComponent(calId));</span>
<a href="#l54.161"></a><span id="l54.161" class="difflineminus">-            params += (&quot;&amp;busyonly=&quot; + ((busyTypes &amp; calIFreeBusyInterval.FREE) ? &quot;0&quot; : &quot;1&quot;));</span>
<a href="#l54.162"></a><span id="l54.162" class="difflineminus">-            params += (&quot;&amp;dtstart=&quot; + zRangeStart);</span>
<a href="#l54.163"></a><span id="l54.163" class="difflineminus">-            params += (&quot;&amp;dtend=&quot; + zRangeEnd);</span>
<a href="#l54.164"></a><span id="l54.164" class="difflineplus">+            let params = &quot;&amp;calid=&quot; + encodeURIComponent(calId);</span>
<a href="#l54.165"></a><span id="l54.165" class="difflineplus">+            params += &quot;&amp;busyonly=&quot; + (busyTypes &amp; calIFreeBusyInterval.FREE ? &quot;0&quot; : &quot;1&quot;);</span>
<a href="#l54.166"></a><span id="l54.166" class="difflineplus">+            params += &quot;&amp;dtstart=&quot; + zRangeStart;</span>
<a href="#l54.167"></a><span id="l54.167" class="difflineplus">+            params += &quot;&amp;dtend=&quot; + zRangeEnd;</span>
<a href="#l54.168"></a><span id="l54.168">             params += &quot;&amp;fmt-out=text%2Fxml&quot;;</span>
<a href="#l54.169"></a><span id="l54.169"> </span>
<a href="#l54.170"></a><span id="l54.170">             this.issueNetworkRequest(</span>
<a href="#l54.171"></a><span id="l54.171">                 request,</span>
<a href="#l54.172"></a><span id="l54.172">                 function net_resp(err, xml) {</span>
<a href="#l54.173"></a><span id="l54.173">                     if (err) {</span>
<a href="#l54.174"></a><span id="l54.174">                         throw err;</span>
<a href="#l54.175"></a><span id="l54.175">                     }</span>
<a href="#l54.176"></a><span id="l54.176" class="difflineat">@@ -1146,17 +1146,17 @@ function confirmInsecureLogin(uri) {</span>
<a href="#l54.177"></a><span id="l54.177">         if (out_dontAskAgain.value) {</span>
<a href="#l54.178"></a><span id="l54.178">             // save decision for all running calendars and</span>
<a href="#l54.179"></a><span id="l54.179">             // all future confirmations:</span>
<a href="#l54.180"></a><span id="l54.180">             let newConfirmedLogins = getPref(&quot;calendar.wcap.confirmed_http_logins&quot;, &quot;&quot;);</span>
<a href="#l54.181"></a><span id="l54.181">             if (newConfirmedLogins.length &gt; 0) {</span>
<a href="#l54.182"></a><span id="l54.182">                 newConfirmedLogins += &quot;,&quot;;</span>
<a href="#l54.183"></a><span id="l54.183">             }</span>
<a href="#l54.184"></a><span id="l54.184">             confirmedEntry = (bConfirmed ? &quot;1&quot; : &quot;0&quot;);</span>
<a href="#l54.185"></a><span id="l54.185" class="difflineminus">-            newConfirmedLogins += (encodedHost + &quot;:&quot; + confirmedEntry);</span>
<a href="#l54.186"></a><span id="l54.186" class="difflineplus">+            newConfirmedLogins += encodedHost + &quot;:&quot; + confirmedEntry;</span>
<a href="#l54.187"></a><span id="l54.187">             Preferences.set(&quot;calendar.wcap.confirmed_http_logins&quot;, newConfirmedLogins);</span>
<a href="#l54.188"></a><span id="l54.188">             getPref(&quot;calendar.wcap.confirmed_http_logins&quot;); // log written entry</span>
<a href="#l54.189"></a><span id="l54.189">             confirmInsecureLogin.m_confirmedHttpLogins[encodedHost] = confirmedEntry;</span>
<a href="#l54.190"></a><span id="l54.190">         }</span>
<a href="#l54.191"></a><span id="l54.191">     }</span>
<a href="#l54.192"></a><span id="l54.192"> </span>
<a href="#l54.193"></a><span id="l54.193">     log(&quot;returned: &quot; + bConfirmed, &quot;confirmInsecureLogin(&quot; + host + &quot;)&quot;);</span>
<a href="#l54.194"></a><span id="l54.194">     return bConfirmed;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapUtils.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapUtils.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -84,37 +84,37 @@ function initLogging() {</span>
<a href="#l55.4"></a><span id="l55.4">         Services.obs.addObserver(appObserver, &quot;quit-application&quot;, false);</span>
<a href="#l55.5"></a><span id="l55.5">     }</span>
<a href="#l55.6"></a><span id="l55.6"> }</span>
<a href="#l55.7"></a><span id="l55.7"> </span>
<a href="#l55.8"></a><span id="l55.8"> function log(msg, context, bForce) {</span>
<a href="#l55.9"></a><span id="l55.9">     if (bForce || LOG_LEVEL &gt; 0) {</span>
<a href="#l55.10"></a><span id="l55.10">         let ret = &quot;&quot;;</span>
<a href="#l55.11"></a><span id="l55.11">         if (context) {</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-            ret += (&quot;[&quot; + context + &quot;]&quot;);</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+            ret += &quot;[&quot; + context + &quot;]&quot;;</span>
<a href="#l55.14"></a><span id="l55.14">         }</span>
<a href="#l55.15"></a><span id="l55.15">         if (ret.length &gt; 0) {</span>
<a href="#l55.16"></a><span id="l55.16">             ret += &quot;\n&quot;;</span>
<a href="#l55.17"></a><span id="l55.17">         }</span>
<a href="#l55.18"></a><span id="l55.18">         ret += msg;</span>
<a href="#l55.19"></a><span id="l55.19">         let now = getTime();</span>
<a href="#l55.20"></a><span id="l55.20">         if (now &amp;&amp; initLogging.mLogTimezone) {</span>
<a href="#l55.21"></a><span id="l55.21">             now = now.getInTimezone(initLogging.mLogTimezone);</span>
<a href="#l55.22"></a><span id="l55.22">         }</span>
<a href="#l55.23"></a><span id="l55.23" class="difflineminus">-        let str = (&quot;### WCAP log entry: &quot; + now + &quot;\n&quot; + ret);</span>
<a href="#l55.24"></a><span id="l55.24" class="difflineplus">+        let str = &quot;### WCAP log entry: &quot; + now + &quot;\n&quot; + ret;</span>
<a href="#l55.25"></a><span id="l55.25">         Services.console.logStringMessage(str);</span>
<a href="#l55.26"></a><span id="l55.26" class="difflineminus">-        str = (&quot;\n&quot; + str + &quot;\n&quot;);</span>
<a href="#l55.27"></a><span id="l55.27" class="difflineplus">+        str = &quot;\n&quot; + str + &quot;\n&quot;;</span>
<a href="#l55.28"></a><span id="l55.28">         dump(str);</span>
<a href="#l55.29"></a><span id="l55.29">         if (initLogging.mLogFilestream) {</span>
<a href="#l55.30"></a><span id="l55.30">             try {</span>
<a href="#l55.31"></a><span id="l55.31">                 // xxx todo?</span>
<a href="#l55.32"></a><span id="l55.32">                 // assuming ANSI chars here, for logging sufficient:</span>
<a href="#l55.33"></a><span id="l55.33">                 initLogging.mLogFilestream.write(str, str.length);</span>
<a href="#l55.34"></a><span id="l55.34">             } catch (exc) { // catching any io errors here:</span>
<a href="#l55.35"></a><span id="l55.35" class="difflineminus">-                let err = (&quot;error writing log file: &quot; + errorToString(exc));</span>
<a href="#l55.36"></a><span id="l55.36" class="difflineplus">+                let err = &quot;error writing log file: &quot; + errorToString(exc);</span>
<a href="#l55.37"></a><span id="l55.37">                 Components.utils.reportError(exc);</span>
<a href="#l55.38"></a><span id="l55.38">                 Services.console.logStringMessage(err);</span>
<a href="#l55.39"></a><span id="l55.39">                 dump(err + &quot;\n\n&quot;);</span>
<a href="#l55.40"></a><span id="l55.40">             }</span>
<a href="#l55.41"></a><span id="l55.41">         }</span>
<a href="#l55.42"></a><span id="l55.42">         return ret;</span>
<a href="#l55.43"></a><span id="l55.43">     } else {</span>
<a href="#l55.44"></a><span id="l55.44">         return msg;</span>
<a href="#l55.45"></a><span id="l55.45" class="difflineat">@@ -156,17 +156,17 @@ function getDomParser() {</span>
<a href="#l55.46"></a><span id="l55.46">     }</span>
<a href="#l55.47"></a><span id="l55.47">     return getDomParser.m_obj;</span>
<a href="#l55.48"></a><span id="l55.48"> }</span>
<a href="#l55.49"></a><span id="l55.49"> </span>
<a href="#l55.50"></a><span id="l55.50"> function isParent(item) {</span>
<a href="#l55.51"></a><span id="l55.51">     if (item.id != item.parentItem.id) {</span>
<a href="#l55.52"></a><span id="l55.52">         throw new Components.Exception(&quot;proxy has different id than its parent!&quot;);</span>
<a href="#l55.53"></a><span id="l55.53">     }</span>
<a href="#l55.54"></a><span id="l55.54" class="difflineminus">-    return (!item.recurrenceId);</span>
<a href="#l55.55"></a><span id="l55.55" class="difflineplus">+    return !item.recurrenceId;</span>
<a href="#l55.56"></a><span id="l55.56"> }</span>
<a href="#l55.57"></a><span id="l55.57"> </span>
<a href="#l55.58"></a><span id="l55.58"> function filterXmlNodes(name, rootNode) {</span>
<a href="#l55.59"></a><span id="l55.59">     let ret = [];</span>
<a href="#l55.60"></a><span id="l55.60">     if (rootNode) {</span>
<a href="#l55.61"></a><span id="l55.61">         let nodeList = rootNode.getElementsByTagName(name);</span>
<a href="#l55.62"></a><span id="l55.62">         for (let i = 0; i &lt; nodeList.length; ++i) {</span>
<a href="#l55.63"></a><span id="l55.63">             let node = nodeList.item(i);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/resources/content/calendarCreation.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/resources/content/calendarCreation.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -33,17 +33,17 @@ function initLocationPage() {</span>
<a href="#l56.4"></a><span id="l56.4">  * Initialize the customize page</span>
<a href="#l56.5"></a><span id="l56.5">  */</span>
<a href="#l56.6"></a><span id="l56.6"> function initCustomizePage() {</span>
<a href="#l56.7"></a><span id="l56.7">     initNameFromURI();</span>
<a href="#l56.8"></a><span id="l56.8">     checkRequired();</span>
<a href="#l56.9"></a><span id="l56.9"> </span>
<a href="#l56.10"></a><span id="l56.10">     let suppressAlarmsRow = document.getElementById(&quot;customize-suppressAlarms-row&quot;);</span>
<a href="#l56.11"></a><span id="l56.11">     suppressAlarmsRow.hidden =</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-        (gCalendar &amp;&amp; gCalendar.getProperty(&quot;capabilities.alarms.popup.supported&quot;) === false);</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+        gCalendar &amp;&amp; gCalendar.getProperty(&quot;capabilities.alarms.popup.supported&quot;) === false;</span>
<a href="#l56.14"></a><span id="l56.14">     document.getElementById(&quot;calendar-color&quot;).value = &quot;#A8C2E1&quot;;</span>
<a href="#l56.15"></a><span id="l56.15"> }</span>
<a href="#l56.16"></a><span id="l56.16"> </span>
<a href="#l56.17"></a><span id="l56.17"> /**</span>
<a href="#l56.18"></a><span id="l56.18">  * Sets up notifications for the location page. On aReason == SUCCESS, all</span>
<a href="#l56.19"></a><span id="l56.19">  * notifications are removed. Otherwise, the respective notification is added to</span>
<a href="#l56.20"></a><span id="l56.20">  * the notification box. Only one notification per reason will be shown.</span>
<a href="#l56.21"></a><span id="l56.21">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -449,18 +449,18 @@</span>
<a href="#l57.4"></a><span id="l57.4">                 if (aEvent) {</span>
<a href="#l57.5"></a><span id="l57.5">                     aEvent.stopPropagation();</span>
<a href="#l57.6"></a><span id="l57.6">                 }</span>
<a href="#l57.7"></a><span id="l57.7">                 let date = this.parseDateTime(this.kTextBox.value);</span>
<a href="#l57.8"></a><span id="l57.8">                 if (date) {</span>
<a href="#l57.9"></a><span id="l57.9">                     this.update(date, aRefresh);</span>
<a href="#l57.10"></a><span id="l57.10">                 } else {</span>
<a href="#l57.11"></a><span id="l57.11">                     // Invalid date, revert to previous date.</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-                    this.kTextBox.value = (this.mValue == &quot;forever&quot;) ? this.mForeverStr</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineminus">-                                                                     : this.formatDate(this.mValue);</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineplus">+                    this.kTextBox.value = this.mValue == &quot;forever&quot; ? this.mForeverStr</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineplus">+                                                                   : this.formatDate(this.mValue);</span>
<a href="#l57.16"></a><span id="l57.16">                 }</span>
<a href="#l57.17"></a><span id="l57.17">                 this.lastDateParseIncludedTime = false;</span>
<a href="#l57.18"></a><span id="l57.18">             }</span>
<a href="#l57.19"></a><span id="l57.19">           ]]&gt;</span>
<a href="#l57.20"></a><span id="l57.20">         &lt;/body&gt;</span>
<a href="#l57.21"></a><span id="l57.21">       &lt;/method&gt;</span>
<a href="#l57.22"></a><span id="l57.22"> </span>
<a href="#l57.23"></a><span id="l57.23">       &lt;method name=&quot;onMenuitemForever&quot;&gt;</span>
<a href="#l57.24"></a><span id="l57.24" class="difflineat">@@ -577,19 +577,19 @@</span>
<a href="#l57.25"></a><span id="l57.25">       &lt;constructor&gt;</span>
<a href="#l57.26"></a><span id="l57.26">         &lt;![CDATA[</span>
<a href="#l57.27"></a><span id="l57.27">           let hbox = document.getAnonymousNodes(this)[0];</span>
<a href="#l57.28"></a><span id="l57.28">           this.kTextBox = hbox.childNodes[0];</span>
<a href="#l57.29"></a><span id="l57.29">           this.kTextBox.kTimePicker = this; // enable call back to method in Moz1.7</span>
<a href="#l57.30"></a><span id="l57.30"> </span>
<a href="#l57.31"></a><span id="l57.31">           let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l57.32"></a><span id="l57.32">           if (val) {</span>
<a href="#l57.33"></a><span id="l57.33" class="difflineminus">-            this.value = (new Date(val));</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineplus">+            this.value = new Date(val);</span>
<a href="#l57.35"></a><span id="l57.35">           } else {</span>
<a href="#l57.36"></a><span id="l57.36" class="difflineminus">-            this.value = (new Date());</span>
<a href="#l57.37"></a><span id="l57.37" class="difflineplus">+            this.value = new Date();</span>
<a href="#l57.38"></a><span id="l57.38">           }</span>
<a href="#l57.39"></a><span id="l57.39"> </span>
<a href="#l57.40"></a><span id="l57.40">           // Change the grids in the timepicker-grids for 12-hours time format.</span>
<a href="#l57.41"></a><span id="l57.41">           if (this.ampmIndex) {</span>
<a href="#l57.42"></a><span id="l57.42">             // Find the locale strings for the AM/PM prefix/suffix.</span>
<a href="#l57.43"></a><span id="l57.43">             let amTime = new Date(2000, 0, 1, 6, 12, 34);</span>
<a href="#l57.44"></a><span id="l57.44">             let pmTime = new Date(2000, 0, 1, 18, 12, 34);</span>
<a href="#l57.45"></a><span id="l57.45">             amTime = amTime.toLocaleFormat(this.kTimeFormatString);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/calendar/resources/content/mouseoverPreviews.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/calendar/resources/content/mouseoverPreviews.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -126,17 +126,17 @@ function getPreviewForTask(toDoItem) {</span>
<a href="#l58.4"></a><span id="l58.4">     if (description) {</span>
<a href="#l58.5"></a><span id="l58.5">       // display wrapped description lines like body of message below headers</span>
<a href="#l58.6"></a><span id="l58.6">       if (hasHeader) {</span>
<a href="#l58.7"></a><span id="l58.7">         boxAppendBodySeparator(vbox);</span>
<a href="#l58.8"></a><span id="l58.8">       }</span>
<a href="#l58.9"></a><span id="l58.9">       boxAppendBody(vbox, description);</span>
<a href="#l58.10"></a><span id="l58.10">     }</span>
<a href="#l58.11"></a><span id="l58.11"> </span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-    return (vbox);</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+    return vbox;</span>
<a href="#l58.14"></a><span id="l58.14">   } else {</span>
<a href="#l58.15"></a><span id="l58.15">     return null;</span>
<a href="#l58.16"></a><span id="l58.16">   }</span>
<a href="#l58.17"></a><span id="l58.17"> }</span>
<a href="#l58.18"></a><span id="l58.18"> </span>
<a href="#l58.19"></a><span id="l58.19"> /**</span>
<a href="#l58.20"></a><span id="l58.20">  *  Called when mouse moves over a different, or</span>
<a href="#l58.21"></a><span id="l58.21">  *  when mouse moves over event in event list.</span>
<a href="#l58.22"></a><span id="l58.22" class="difflineat">@@ -186,17 +186,17 @@ function getPreviewForEvent(aEvent) {</span>
<a href="#l58.23"></a><span id="l58.23">     }</span>
<a href="#l58.24"></a><span id="l58.24"> </span>
<a href="#l58.25"></a><span id="l58.25">     let description = event.getProperty(&quot;DESCRIPTION&quot;);</span>
<a href="#l58.26"></a><span id="l58.26">     if (description) {</span>
<a href="#l58.27"></a><span id="l58.27">       boxAppendBodySeparator(vbox);</span>
<a href="#l58.28"></a><span id="l58.28">       // display wrapped description lines, like body of message below headers</span>
<a href="#l58.29"></a><span id="l58.29">       boxAppendBody(vbox, description);</span>
<a href="#l58.30"></a><span id="l58.30">     }</span>
<a href="#l58.31"></a><span id="l58.31" class="difflineminus">-    return (vbox);</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineplus">+    return vbox;</span>
<a href="#l58.33"></a><span id="l58.33">   } else {</span>
<a href="#l58.34"></a><span id="l58.34">       return null;</span>
<a href="#l58.35"></a><span id="l58.35">   }</span>
<a href="#l58.36"></a><span id="l58.36"> }</span>
<a href="#l58.37"></a><span id="l58.37"> </span>
<a href="#l58.38"></a><span id="l58.38"> </span>
<a href="#l58.39"></a><span id="l58.39"> /** String for event status: (none), Tentative, Confirmed, or Cancelled **/</span>
<a href="#l58.40"></a><span id="l58.40"> function getEventStatusString(calendarEvent) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -122,17 +122,17 @@ var testEventDialog = function() {</span>
<a href="#l59.4"></a><span id="l59.4">   md.start(handleAttendees);</span>
<a href="#l59.5"></a><span id="l59.5">   event.click(new elementslib.ID(event.window.document, &quot;button-attendees&quot;));</span>
<a href="#l59.6"></a><span id="l59.6">   event.assertValue(new elementslib.ID(event.window.document, &quot;attendee-list&quot;),</span>
<a href="#l59.7"></a><span id="l59.7">     attendee);</span>
<a href="#l59.8"></a><span id="l59.8"> </span>
<a href="#l59.9"></a><span id="l59.9">   // make it private and verify label visible</span>
<a href="#l59.10"></a><span id="l59.10">   event.click(new elementslib.ID(event.window.document, &quot;button-privacy&quot;));</span>
<a href="#l59.11"></a><span id="l59.11">   event.click(new elementslib.ID(event.window.document, &quot;event-privacy-private-menuitem&quot;));</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-  let label = (new elementslib.ID(event.window.document, &quot;status-privacy-private-box&quot;));</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+  let label = new elementslib.ID(event.window.document, &quot;status-privacy-private-box&quot;);</span>
<a href="#l59.14"></a><span id="l59.14">   event.assertJS(event.window.getComputedStyle(label.getNode(), null).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l59.15"></a><span id="l59.15"> </span>
<a href="#l59.16"></a><span id="l59.16">   // add attachment and verify added</span>
<a href="#l59.17"></a><span id="l59.17">   calUtils.handleAddingAttachment(event, url);</span>
<a href="#l59.18"></a><span id="l59.18">   event.click(new elementslib.ID(event.window.document, &quot;button-url&quot;));</span>
<a href="#l59.19"></a><span id="l59.19">   event.assertNode(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l59.20"></a><span id="l59.20">     'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}'));</span>
<a href="#l59.21"></a><span id="l59.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -101,45 +101,45 @@ function handleParentModification(contro</span>
<a href="#l60.4"></a><span id="l60.4">  *  @param view - day, week, multiweek or month</span>
<a href="#l60.5"></a><span id="l60.5">  */</span>
<a href="#l60.6"></a><span id="l60.6"> function switchToView(controller, view) {</span>
<a href="#l60.7"></a><span id="l60.7">   switch (view) {</span>
<a href="#l60.8"></a><span id="l60.8">     case &quot;week&quot;:</span>
<a href="#l60.9"></a><span id="l60.9">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l60.10"></a><span id="l60.10">         &quot;calendar-week-view-button&quot;));</span>
<a href="#l60.11"></a><span id="l60.11">       controller.waitFor(function() {</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-        let button = (new elementslib.ID(controller.window.document,</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineminus">-        &quot;calendar-week-view-button&quot;));</span>
<a href="#l60.14"></a><span id="l60.14" class="difflineplus">+        let button = new elementslib.ID(controller.window.document,</span>
<a href="#l60.15"></a><span id="l60.15" class="difflineplus">+        &quot;calendar-week-view-button&quot;);</span>
<a href="#l60.16"></a><span id="l60.16">         return button.getNode().selected == true;</span>
<a href="#l60.17"></a><span id="l60.17">       });</span>
<a href="#l60.18"></a><span id="l60.18">       break;</span>
<a href="#l60.19"></a><span id="l60.19">     case &quot;multiweek&quot;:</span>
<a href="#l60.20"></a><span id="l60.20">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l60.21"></a><span id="l60.21">         &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l60.22"></a><span id="l60.22">       controller.waitFor(function() {</span>
<a href="#l60.23"></a><span id="l60.23" class="difflineminus">-        let button = (new elementslib.ID(controller.window.document,</span>
<a href="#l60.24"></a><span id="l60.24" class="difflineminus">-        &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l60.25"></a><span id="l60.25" class="difflineplus">+        let button = new elementslib.ID(controller.window.document,</span>
<a href="#l60.26"></a><span id="l60.26" class="difflineplus">+        &quot;calendar-multiweek-view-button&quot;);</span>
<a href="#l60.27"></a><span id="l60.27">         return button.getNode().selected == true;</span>
<a href="#l60.28"></a><span id="l60.28">       });</span>
<a href="#l60.29"></a><span id="l60.29">       break;</span>
<a href="#l60.30"></a><span id="l60.30">     case &quot;month&quot;:</span>
<a href="#l60.31"></a><span id="l60.31">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l60.32"></a><span id="l60.32">         &quot;calendar-month-view-button&quot;));</span>
<a href="#l60.33"></a><span id="l60.33">       controller.waitFor(function() {</span>
<a href="#l60.34"></a><span id="l60.34" class="difflineminus">-        let button = (new elementslib.ID(controller.window.document,</span>
<a href="#l60.35"></a><span id="l60.35" class="difflineminus">-        &quot;calendar-month-view-button&quot;));</span>
<a href="#l60.36"></a><span id="l60.36" class="difflineplus">+        let button = new elementslib.ID(controller.window.document,</span>
<a href="#l60.37"></a><span id="l60.37" class="difflineplus">+        &quot;calendar-month-view-button&quot;);</span>
<a href="#l60.38"></a><span id="l60.38">         return button.getNode().selected == true;</span>
<a href="#l60.39"></a><span id="l60.39">       });</span>
<a href="#l60.40"></a><span id="l60.40">       break;</span>
<a href="#l60.41"></a><span id="l60.41">     default:</span>
<a href="#l60.42"></a><span id="l60.42">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l60.43"></a><span id="l60.43">         &quot;calendar-day-view-button&quot;));</span>
<a href="#l60.44"></a><span id="l60.44">       controller.waitFor(function() {</span>
<a href="#l60.45"></a><span id="l60.45" class="difflineminus">-        let button = (new elementslib.ID(controller.window.document,</span>
<a href="#l60.46"></a><span id="l60.46" class="difflineminus">-        &quot;calendar-day-view-button&quot;));</span>
<a href="#l60.47"></a><span id="l60.47" class="difflineplus">+        let button = new elementslib.ID(controller.window.document,</span>
<a href="#l60.48"></a><span id="l60.48" class="difflineplus">+        &quot;calendar-day-view-button&quot;);</span>
<a href="#l60.49"></a><span id="l60.49">         return button.getNode().selected == true;</span>
<a href="#l60.50"></a><span id="l60.50">       });</span>
<a href="#l60.51"></a><span id="l60.51">   }</span>
<a href="#l60.52"></a><span id="l60.52"> }</span>
<a href="#l60.53"></a><span id="l60.53"> </span>
<a href="#l60.54"></a><span id="l60.54"> /**</span>
<a href="#l60.55"></a><span id="l60.55">  *  Go to a specific date using minimonth</span>
<a href="#l60.56"></a><span id="l60.56">  *  @param controller - main window controller</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/calendar/test/unit/test_alarmservice.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/calendar/test/unit/test_alarmservice.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -45,19 +45,19 @@ var alarmObserver = {</span>
<a href="#l61.4"></a><span id="l61.4">             aOperation.call();</span>
<a href="#l61.5"></a><span id="l61.5">         } else {</span>
<a href="#l61.6"></a><span id="l61.6">             // the calendar hasn't been fully loaded yet, set as a pending operation</span>
<a href="#l61.7"></a><span id="l61.7">             this.pendingOps[aCalendar.id] = aOperation;</span>
<a href="#l61.8"></a><span id="l61.8">         }</span>
<a href="#l61.9"></a><span id="l61.9">     },</span>
<a href="#l61.10"></a><span id="l61.10"> </span>
<a href="#l61.11"></a><span id="l61.11">     getTimer: function obs_getTimer(aCalendarId, aItemId, aAlarmStr) {</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-        return (aCalendarId in this.service.mTimerMap &amp;&amp;</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineminus">-                aItemId in this.service.mTimerMap[aCalendarId] &amp;&amp;</span>
<a href="#l61.14"></a><span id="l61.14" class="difflineminus">-                aAlarmStr in this.service.mTimerMap[aCalendarId][aItemId]) ?</span>
<a href="#l61.15"></a><span id="l61.15" class="difflineplus">+        return aCalendarId in this.service.mTimerMap &amp;&amp;</span>
<a href="#l61.16"></a><span id="l61.16" class="difflineplus">+               aItemId in this.service.mTimerMap[aCalendarId] &amp;&amp;</span>
<a href="#l61.17"></a><span id="l61.17" class="difflineplus">+               aAlarmStr in this.service.mTimerMap[aCalendarId][aItemId] ?</span>
<a href="#l61.18"></a><span id="l61.18">                this.service.mTimerMap[aCalendarId][aItemId][aAlarmStr] : null;</span>
<a href="#l61.19"></a><span id="l61.19">     },</span>
<a href="#l61.20"></a><span id="l61.20"> </span>
<a href="#l61.21"></a><span id="l61.21">     expectResult: function obs_expectResult(aCalendar, aItem, aAlarm, aExpected) {</span>
<a href="#l61.22"></a><span id="l61.22">         this.expectedMap[aCalendar.id] = this.expectedMap[aCalendar.id] || {};</span>
<a href="#l61.23"></a><span id="l61.23">         this.expectedMap[aCalendar.id][aItem.hashId] = this.expectedMap[aCalendar.id][aItem.hashId] || {};</span>
<a href="#l61.24"></a><span id="l61.24">         this.expectedMap[aCalendar.id][aItem.hashId][aAlarm.icalString] = aExpected;</span>
<a href="#l61.25"></a><span id="l61.25">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -513,36 +513,36 @@ add_task(function* test_migrate_cache() </span>
<a href="#l62.4"></a><span id="l62.4">     let unwrapped = client.wrappedJSObject;</span>
<a href="#l62.5"></a><span id="l62.5">     let migrateStorageCache = unwrapped.migrateStorageCache.bind(unwrapped);</span>
<a href="#l62.6"></a><span id="l62.6"> </span>
<a href="#l62.7"></a><span id="l62.7">     monkeyPatch(unwrapped, &quot;resetSync&quot;, function(protofunc) {</span>
<a href="#l62.8"></a><span id="l62.8">         return Promise.resolve();</span>
<a href="#l62.9"></a><span id="l62.9">     });</span>
<a href="#l62.10"></a><span id="l62.10"> </span>
<a href="#l62.11"></a><span id="l62.11">     // No version, should not reset</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-    equal((yield migrateStorageCache()), false);</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+    equal(yield migrateStorageCache(), false);</span>
<a href="#l62.14"></a><span id="l62.14">     equal(client.getProperty(&quot;cache.version&quot;), 3);</span>
<a href="#l62.15"></a><span id="l62.15"> </span>
<a href="#l62.16"></a><span id="l62.16">     // Check migrate 1 -&gt; 2</span>
<a href="#l62.17"></a><span id="l62.17">     unwrapped.CACHE_DB_VERSION = 2;</span>
<a href="#l62.18"></a><span id="l62.18">     client.setProperty(&quot;cache.version&quot;, 1);</span>
<a href="#l62.19"></a><span id="l62.19" class="difflineminus">-    equal((yield migrateStorageCache()), true);</span>
<a href="#l62.20"></a><span id="l62.20" class="difflineplus">+    equal(yield migrateStorageCache(), true);</span>
<a href="#l62.21"></a><span id="l62.21">     equal(client.getProperty(&quot;cache.version&quot;), 2);</span>
<a href="#l62.22"></a><span id="l62.22"> </span>
<a href="#l62.23"></a><span id="l62.23">     // Check migrate 2 -&gt; 3 normal calendar</span>
<a href="#l62.24"></a><span id="l62.24">     unwrapped.CACHE_DB_VERSION = 3;</span>
<a href="#l62.25"></a><span id="l62.25">     client.setProperty(&quot;cache.version&quot;, 2);</span>
<a href="#l62.26"></a><span id="l62.26" class="difflineminus">-    equal((yield migrateStorageCache()), false);</span>
<a href="#l62.27"></a><span id="l62.27" class="difflineplus">+    equal(yield migrateStorageCache(), false);</span>
<a href="#l62.28"></a><span id="l62.28"> </span>
<a href="#l62.29"></a><span id="l62.29">     // Check migrate 2 -&gt; 3 birthday calendar</span>
<a href="#l62.30"></a><span id="l62.30">     unwrapped.CACHE_DB_VERSION = 3;</span>
<a href="#l62.31"></a><span id="l62.31">     uri = &quot;googleapi://xpcshell/?calendar=%23contacts%40group.v.calendar.google.com&quot;;</span>
<a href="#l62.32"></a><span id="l62.32">     unwrapped.uri = Services.io.newURI(uri, null, null);</span>
<a href="#l62.33"></a><span id="l62.33">     client.setProperty(&quot;cache.version&quot;, 2);</span>
<a href="#l62.34"></a><span id="l62.34" class="difflineminus">-    equal((yield migrateStorageCache()), true);</span>
<a href="#l62.35"></a><span id="l62.35" class="difflineplus">+    equal(yield migrateStorageCache(), true);</span>
<a href="#l62.36"></a><span id="l62.36"> });</span>
<a href="#l62.37"></a><span id="l62.37"> </span>
<a href="#l62.38"></a><span id="l62.38"> add_test(function test_migrate_uri() {</span>
<a href="#l62.39"></a><span id="l62.39">     function checkMigrate(fromUri, session, calendarId, tasksId) {</span>
<a href="#l62.40"></a><span id="l62.40">         let uri = Services.io.newURI(fromUri, null, null);</span>
<a href="#l62.41"></a><span id="l62.41">         let client = cal.getCalendarManager().createCalendar(&quot;gdata&quot;, uri);</span>
<a href="#l62.42"></a><span id="l62.42"> </span>
<a href="#l62.43"></a><span id="l62.43">         if (session) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/calendar/test/unit/test_timezone_definition.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/calendar/test/unit/test_timezone_definition.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -7,17 +7,17 @@ function run_test() {</span>
<a href="#l63.4"></a><span id="l63.4"> }</span>
<a href="#l63.5"></a><span id="l63.5"> </span>
<a href="#l63.6"></a><span id="l63.6"> /**</span>
<a href="#l63.7"></a><span id="l63.7">  * Checks whether the pased string is a valid tz version number</span>
<a href="#l63.8"></a><span id="l63.8">  * @param    {String}         aVersionString</span>
<a href="#l63.9"></a><span id="l63.9">  * @returns  {boolean}</span>
<a href="#l63.10"></a><span id="l63.10">  */</span>
<a href="#l63.11"></a><span id="l63.11"> function valid_tz_version(aVersionString) {</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-    return (aVersionString.match(/^2\.(\d{4})(z*[a-z])$/));</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+    return aVersionString.match(/^2\.(\d{4})(z*[a-z])$/);</span>
<a href="#l63.14"></a><span id="l63.14"> }</span>
<a href="#l63.15"></a><span id="l63.15"> </span>
<a href="#l63.16"></a><span id="l63.16"> // check tz database version</span>
<a href="#l63.17"></a><span id="l63.17"> add_task(function* version_test() {</span>
<a href="#l63.18"></a><span id="l63.18">     let tzs = cal.getTimezoneService();</span>
<a href="#l63.19"></a><span id="l63.19">     ok(valid_tz_version(tzs.version), &quot;timezone version&quot;);</span>
<a href="#l63.20"></a><span id="l63.20"> });</span>
<a href="#l63.21"></a><span id="l63.21"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

