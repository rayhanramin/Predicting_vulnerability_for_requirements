<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26376:e920876482870bfc239ab3bc3ecd1514d9958382</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ e920876482870bfc239ab3bc3ecd1514d9958382" />
<meta property="og:url" content="/comm-central/rev/e920876482870bfc239ab3bc3ecd1514d9958382" />
<meta property="og:description" content="Bug 1535725 - Port bug 1519948: Replace use of boxObject: .x, .y, .height, .width, .screenX, .screenY. r=me" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / e920876482870bfc239ab3bc3ecd1514d9958382 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/e920876482870bfc239ab3bc3ecd1514d9958382">shortlog</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/e920876482870bfc239ab3bc3ecd1514d9958382">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382">files</a> |
changeset |
<a href="/comm-central/raw-rev/e920876482870bfc239ab3bc3ecd1514d9958382">raw</a>  | <a href="/comm-central/archive/e920876482870bfc239ab3bc3ecd1514d9958382.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1535725">Bug 1535725</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1519948">bug 1519948</a>: Replace use of boxObject: .x, .y, .height, .width, .screenX, .screenY. r=me
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 17 Apr 2019 23:58:15 +0200</td></tr>

<tr>
 <td>changeset 26376</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/e920876482870bfc239ab3bc3ecd1514d9958382">e920876482870bfc239ab3bc3ecd1514d9958382</a></td>
</tr>



<tr>
<td>parent 26375</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/268b0132591a59bddc5bcb98ea842639e0420fdb">268b0132591a59bddc5bcb98ea842639e0420fdb</a>
</td>
</tr>

<tr>
<td>child 26377</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/72eadf95a12007ee4a2c5d02951ffd7851612628">72eadf95a12007ee4a2c5d02951ffd7851612628</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=e920876482870bfc239ab3bc3ecd1514d9958382">15808</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 17 Apr 2019 21:58:54 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@e92087648287 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e920876482870bfc239ab3bc3ecd1514d9958382">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e920876482870bfc239ab3bc3ecd1514d9958382&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e920876482870bfc239ab3bc3ecd1514d9958382&newProject=comm-central&newRevision=42139c6ab12273f0a1ff95b03e74d23e50d7c484&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e920876482870bfc239ab3bc3ecd1514d9958382&newProject=comm-central&newRevision=42139c6ab12273f0a1ff95b03e74d23e50d7c484&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e920876482870bfc239ab3bc3ecd1514d9958382&newProject=comm-central&newRevision=42139c6ab12273f0a1ff95b03e74d23e50d7c484&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28me%29&revcount=50">me</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1535725">1535725</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1519948">1519948</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1535725">Bug 1535725</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1519948">bug 1519948</a>: Replace use of boxObject: .x, .y, .height, .width, .screenX, .screenY. r=me</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-base-view.js">calendar/base/content/calendar-base-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-base-view.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-base-view.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-base-view.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-base-view.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-base-view.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/today-pane.js">calendar/base/content/today-pane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/today-pane.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/today-pane.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/today-pane.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/today-pane.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/today-pane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/widgets/calendar-list-tree.xml">calendar/base/content/widgets/calendar-list-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/widgets/calendar-list-tree.xml">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/widgets/calendar-list-tree.xml">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/widgets/calendar-list-tree.xml">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/widgets/calendar-list-tree.xml">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/content/widgets/calendar-list-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/modules/utils/calViewUtils.jsm">calendar/base/modules/utils/calViewUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/modules/utils/calViewUtils.jsm">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/modules/utils/calViewUtils.jsm">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/modules/utils/calViewUtils.jsm">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/modules/utils/calViewUtils.jsm">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/base/modules/utils/calViewUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testBasicFunctionality.js">calendar/test/mozmill/testBasicFunctionality.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testBasicFunctionality.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testBasicFunctionality.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testBasicFunctionality.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testBasicFunctionality.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testBasicFunctionality.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testTimezones.js">calendar/test/mozmill/testTimezones.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testTimezones.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testTimezones.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testTimezones.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testTimezones.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/calendar/test/mozmill/testTimezones.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/notificationbox.xml">common/bindings/notificationbox.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/notificationbox.xml">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/notificationbox.xml">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/notificationbox.xml">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/notificationbox.xml">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/notificationbox.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/richlistbox.xml">common/bindings/richlistbox.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/richlistbox.xml">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/richlistbox.xml">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/richlistbox.xml">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/richlistbox.xml">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/common/bindings/richlistbox.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/common/src/customizeToolbar.js">common/src/customizeToolbar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/common/src/customizeToolbar.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/common/src/customizeToolbar.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/common/src/customizeToolbar.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/common/src/customizeToolbar.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/common/src/customizeToolbar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/folderDisplay.js">mail/base/content/folderDisplay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/folderDisplay.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/folderDisplay.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/folderDisplay.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/folderDisplay.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/folderDisplay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/mailWidgets.xml">mail/base/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/msgHdrView.js">mail/base/content/msgHdrView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/msgHdrView.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/msgHdrView.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/msgHdrView.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/msgHdrView.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/msgHdrView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/sanitizeDialog.js">mail/base/content/sanitizeDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/sanitizeDialog.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/sanitizeDialog.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/sanitizeDialog.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/sanitizeDialog.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/sanitizeDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/tabmail.xml">mail/base/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/modules/GlobalPopupNotifications.jsm">mail/base/modules/GlobalPopupNotifications.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/modules/GlobalPopupNotifications.jsm">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/modules/GlobalPopupNotifications.jsm">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/modules/GlobalPopupNotifications.jsm">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/modules/GlobalPopupNotifications.jsm">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/base/modules/GlobalPopupNotifications.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/addressingWidgetOverlay.js">mail/components/compose/content/addressingWidgetOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/addressingWidgetOverlay.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/addressingWidgetOverlay.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/addressingWidgetOverlay.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/addressingWidgetOverlay.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/compose/content/addressingWidgetOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/im/content/imconversation.xml">mail/components/im/content/imconversation.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/im/content/imconversation.xml">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/im/content/imconversation.xml">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/im/content/imconversation.xml">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/im/content/imconversation.xml">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/components/im/content/imconversation.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/attachment/test-attachment.js">mail/test/mozmill/attachment/test-attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/attachment/test-attachment.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/attachment/test-attachment.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/attachment/test-attachment.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/attachment/test-attachment.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/attachment/test-attachment.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/folder-display/test-opening-messages.js">mail/test/mozmill/folder-display/test-opening-messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/folder-display/test-opening-messages.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/folder-display/test-opening-messages.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/folder-display/test-opening-messages.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/folder-display/test-opening-messages.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/folder-display/test-opening-messages.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/session-store/test-session-store.js">mail/test/mozmill/session-store/test-session-store.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/session-store/test-session-store.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/session-store/test-session-store.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/session-store/test-session-store.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/session-store/test-session-store.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/session-store/test-session-store.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">mail/test/mozmill/shared-modules/test-folder-display-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-mouse-event-helpers.js">mail/test/mozmill/shared-modules/test-mouse-event-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-mouse-event-helpers.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-mouse-event-helpers.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-mouse-event-helpers.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-mouse-event-helpers.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-mouse-event-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">mail/test/mozmill/tabmail/test-tabmail-dragndrop.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/resources/mozmill/mozmill/extension/content/modules/events.jsm">mail/test/resources/mozmill/mozmill/extension/content/modules/events.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/resources/mozmill/mozmill/extension/content/modules/events.jsm">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/resources/mozmill/mozmill/extension/content/modules/events.jsm">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/resources/mozmill/mozmill/extension/content/modules/events.jsm">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/resources/mozmill/mozmill/extension/content/modules/events.jsm">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mail/test/resources/mozmill/mozmill/extension/content/modules/events.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mailnews/db/gloda/content/autocomplete-richlistitem.js">mailnews/db/gloda/content/autocomplete-richlistitem.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e920876482870bfc239ab3bc3ecd1514d9958382/mailnews/db/gloda/content/autocomplete-richlistitem.js">file</a> |
<a href="/comm-central/annotate/e920876482870bfc239ab3bc3ecd1514d9958382/mailnews/db/gloda/content/autocomplete-richlistitem.js">annotate</a> |
<a href="/comm-central/diff/e920876482870bfc239ab3bc3ecd1514d9958382/mailnews/db/gloda/content/autocomplete-richlistitem.js">diff</a> |
<a href="/comm-central/comparison/e920876482870bfc239ab3bc3ecd1514d9958382/mailnews/db/gloda/content/autocomplete-richlistitem.js">comparison</a> |
<a href="/comm-central/log/e920876482870bfc239ab3bc3ecd1514d9958382/mailnews/db/gloda/content/autocomplete-richlistitem.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -98,17 +98,17 @@ class MozCalendarDayLabel extends MozXUL</span>
<a href="#l1.4"></a><span id="l1.4">         this.getLongWeekdayPixels();</span>
<a href="#l1.5"></a><span id="l1.5">         setBooleanAttribute(this.longWeekdayName, &quot;hidden&quot;, val);</span>
<a href="#l1.6"></a><span id="l1.6">         setBooleanAttribute(this.shortWeekdayName, &quot;hidden&quot;, !val);</span>
<a href="#l1.7"></a><span id="l1.7">         return val;</span>
<a href="#l1.8"></a><span id="l1.8">     }</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">     getLongWeekdayPixels() {</span>
<a href="#l1.11"></a><span id="l1.11">         // Only do this if the long weekdays are visible and we haven't already cached.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        let longNameWidth = this.longWeekdayName.boxObject.width;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        let longNameWidth = this.longWeekdayName.getBoundingClientRect().width;</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15">         if (longNameWidth == 0) {</span>
<a href="#l1.16"></a><span id="l1.16">             // weekdaypixels have not yet been laid out</span>
<a href="#l1.17"></a><span id="l1.17">             return 0;</span>
<a href="#l1.18"></a><span id="l1.18">         }</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">         this.longWeekdayPixels = longNameWidth +</span>
<a href="#l1.21"></a><span id="l1.21">             getSummarizedStyleValues(this.longWeekdayName, [&quot;margin-left&quot;, &quot;margin-right&quot;]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1343,21 +1343,21 @@</span>
<a href="#l2.4"></a><span id="l2.4">             // If we are at the bottom or top of the view (or left/right when</span>
<a href="#l2.5"></a><span id="l2.5">             // rotated), calculate the difference and start accelerating the</span>
<a href="#l2.6"></a><span id="l2.6">             // scrollbar.</span>
<a href="#l2.7"></a><span id="l2.7">             let diffStart, diffEnd;</span>
<a href="#l2.8"></a><span id="l2.8">             let orient = event.target.getAttribute(&quot;orient&quot;);</span>
<a href="#l2.9"></a><span id="l2.9">             let scrollbox = document.getAnonymousElementByAttribute(</span>
<a href="#l2.10"></a><span id="l2.10">                            event.target, &quot;anonid&quot;, &quot;scrollbox&quot;);</span>
<a href="#l2.11"></a><span id="l2.11">             if (orient == &quot;vertical&quot;) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                diffStart = event.clientY - scrollbox.boxObject.y;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                diffEnd = scrollbox.boxObject.y + scrollbox.boxObject.height - event.clientY;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+                diffStart = event.clientY - scrollbox.getBoundingClientRect().y;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+                diffEnd = scrollbox.getBoundingClientRect().y + scrollbox.getBoundingClientRect().height - event.clientY;</span>
<a href="#l2.16"></a><span id="l2.16">             } else {</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-                diffStart = event.clientX - scrollbox.boxObject.x;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-                diffEnd = scrollbox.boxObject.x + scrollbox.boxObject.width - event.clientX;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+                diffStart = event.clientX - scrollbox.getBoundingClientRect().x;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+                diffEnd = scrollbox.getBoundingClientRect().x + scrollbox.getBoundingClientRect().width - event.clientX;</span>
<a href="#l2.21"></a><span id="l2.21">             }</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">             const SCROLLZONE = 55;     // Size (pixels) of the top/bottom view where the scroll starts.</span>
<a href="#l2.24"></a><span id="l2.24">             const MAXTIMEOUT = 250;    // Max and min time interval (ms) between</span>
<a href="#l2.25"></a><span id="l2.25">             const MINTIMEOUT = 30;     // two consecutive scrolls.</span>
<a href="#l2.26"></a><span id="l2.26">             const SCROLLBYHOUR = 0.33; // Part of hour to move for each scroll.</span>
<a href="#l2.27"></a><span id="l2.27">             let insideScrollZone = 0;</span>
<a href="#l2.28"></a><span id="l2.28">             let pxPerHr = event.target.mPixPerMin * 60;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineat">@@ -1398,20 +1398,20 @@</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31">             let lateralColumns = col.firstLastShadowColumns();</span>
<a href="#l2.32"></a><span id="l2.32">             let firstCol = lateralColumns.firstCol;</span>
<a href="#l2.33"></a><span id="l2.33">             let firstIndex = lateralColumns.firstIndex;</span>
<a href="#l2.34"></a><span id="l2.34"> </span>
<a href="#l2.35"></a><span id="l2.35">             // If we leave the view, then stop our internal sweeping and start a</span>
<a href="#l2.36"></a><span id="l2.36">             // real drag session. Someday we need to fix the sweep to soely be a</span>
<a href="#l2.37"></a><span id="l2.37">             // drag session, no sweeping.</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-            if (event.clientX &lt; (event.target.boxObject.x) ||</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-                event.clientX &gt; (event.target.boxObject.x + event.target.boxObject.width) ||</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-                event.clientY &lt; (event.target.boxObject.y) ||</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-                event.clientY &gt; (event.target.boxObject.y + event.target.boxObject.height)) {</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+            if (event.clientX &lt; (event.target.getBoundingClientRect().x) ||</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+                event.clientX &gt; (event.target.getBoundingClientRect().x + event.target.getBoundingClientRect().width) ||</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+                event.clientY &lt; (event.target.getBoundingClientRect().y) ||</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+                event.clientY &gt; (event.target.getBoundingClientRect().y + event.target.getBoundingClientRect().height)) {</span>
<a href="#l2.46"></a><span id="l2.46">                 // Remove the drag state</span>
<a href="#l2.47"></a><span id="l2.47">                 for (let column = firstCol, i = firstIndex;</span>
<a href="#l2.48"></a><span id="l2.48">                      column &amp;&amp; i &lt; col.mDragState.shadows;</span>
<a href="#l2.49"></a><span id="l2.49">                      column = column.nextSibling, i++) {</span>
<a href="#l2.50"></a><span id="l2.50">                     column.fgboxes.dragbox.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l2.51"></a><span id="l2.51">                     column.fgboxes.box.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l2.52"></a><span id="l2.52">                 }</span>
<a href="#l2.53"></a><span id="l2.53"> </span>
<a href="#l2.54"></a><span id="l2.54" class="difflineat">@@ -1483,20 +1483,20 @@</span>
<a href="#l2.55"></a><span id="l2.55">                 col.onEventSweepMouseMove(event);</span>
<a href="#l2.56"></a><span id="l2.56"> </span>
<a href="#l2.57"></a><span id="l2.57">                 return;</span>
<a href="#l2.58"></a><span id="l2.58">             }</span>
<a href="#l2.59"></a><span id="l2.59"> </span>
<a href="#l2.60"></a><span id="l2.60">             let mousePos;</span>
<a href="#l2.61"></a><span id="l2.61">             let sizeattr;</span>
<a href="#l2.62"></a><span id="l2.62">             if (col.getAttribute(&quot;orient&quot;) == &quot;vertical&quot;) {</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-                mousePos = event.screenY - col.parentNode.boxObject.screenY;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+                mousePos = event.screenY - col.parentNode.screenY;</span>
<a href="#l2.65"></a><span id="l2.65">                 sizeattr = &quot;height&quot;;</span>
<a href="#l2.66"></a><span id="l2.66">             } else {</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-                mousePos = event.screenX - col.parentNode.boxObject.screenX;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+                mousePos = event.screenX - col.parentNode.screenX;</span>
<a href="#l2.69"></a><span id="l2.69">                 sizeattr = &quot;width&quot;;</span>
<a href="#l2.70"></a><span id="l2.70">             }</span>
<a href="#l2.71"></a><span id="l2.71">             // don't let mouse position go outside the window edges</span>
<a href="#l2.72"></a><span id="l2.72">             let pos = Math.max(0, mousePos) - dragState.mouseOffset;</span>
<a href="#l2.73"></a><span id="l2.73"> </span>
<a href="#l2.74"></a><span id="l2.74">             // snap interval: 15 minutes or 1 minute if modifier key is pressed</span>
<a href="#l2.75"></a><span id="l2.75">             let snapIntMin = (event.shiftKey &amp;&amp;</span>
<a href="#l2.76"></a><span id="l2.76">                               !event.ctrlKey &amp;&amp;</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineat">@@ -1858,19 +1858,19 @@</span>
<a href="#l2.78"></a><span id="l2.78">                 let shadowElements = this.getShadowElements(this.mDragState.origMinStart,</span>
<a href="#l2.79"></a><span id="l2.79">                                                             this.mDragState.origMinEnd);</span>
<a href="#l2.80"></a><span id="l2.80">                 this.mDragState.shadows = shadowElements.shadows;</span>
<a href="#l2.81"></a><span id="l2.81">                 this.mDragState.offset = shadowElements.offset;</span>
<a href="#l2.82"></a><span id="l2.82">                 // we need to set a mouse offset, since we're not dragging from</span>
<a href="#l2.83"></a><span id="l2.83">                 // one end of the element</span>
<a href="#l2.84"></a><span id="l2.84">                 if (aEventBox) {</span>
<a href="#l2.85"></a><span id="l2.85">                     if (this.getAttribute(&quot;orient&quot;) == &quot;vertical&quot;) {</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-                        this.mDragState.mouseOffset = aMouseY - aEventBox.boxObject.screenY;</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+                        this.mDragState.mouseOffset = aMouseY - aEventBox.screenY;</span>
<a href="#l2.88"></a><span id="l2.88">                     } else {</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-                        this.mDragState.mouseOffset = aMouseX - aEventBox.boxObject.screenX;</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+                        this.mDragState.mouseOffset = aMouseX - aEventBox.screenX;</span>
<a href="#l2.91"></a><span id="l2.91">                     }</span>
<a href="#l2.92"></a><span id="l2.92">                 }</span>
<a href="#l2.93"></a><span id="l2.93">             } else {</span>
<a href="#l2.94"></a><span id="l2.94">                 // Invalid grabbed element.</span>
<a href="#l2.95"></a><span id="l2.95">             }</span>
<a href="#l2.96"></a><span id="l2.96"> </span>
<a href="#l2.97"></a><span id="l2.97">             document.calendarEventColumnDragging = this;</span>
<a href="#l2.98"></a><span id="l2.98"> </span>
<a href="#l2.99"></a><span id="l2.99" class="difflineat">@@ -1962,19 +1962,19 @@</span>
<a href="#l2.100"></a><span id="l2.100">             newStart.isDate = false;</span>
<a href="#l2.101"></a><span id="l2.101">             newStart.hour = 0;</span>
<a href="#l2.102"></a><span id="l2.102"> </span>
<a href="#l2.103"></a><span id="l2.103">             const ROUND_INTERVAL = 15;</span>
<a href="#l2.104"></a><span id="l2.104"> </span>
<a href="#l2.105"></a><span id="l2.105">             let interval = this.mPixPerMin * ROUND_INTERVAL;</span>
<a href="#l2.106"></a><span id="l2.106">             let pos;</span>
<a href="#l2.107"></a><span id="l2.107">             if (this.getAttribute(&quot;orient&quot;) == &quot;vertical&quot;) {</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-                pos = event.screenY - this.parentNode.boxObject.screenY;</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+                pos = event.screenY - this.parentNode.screenY;</span>
<a href="#l2.110"></a><span id="l2.110">             } else {</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineminus">-                pos = event.screenX - this.parentNode.boxObject.screenX;</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+                pos = event.screenX - this.parentNode.screenX;</span>
<a href="#l2.113"></a><span id="l2.113">             }</span>
<a href="#l2.114"></a><span id="l2.114">             newStart.minute = (Math.round(pos / interval) * ROUND_INTERVAL) + this.mStartMin;</span>
<a href="#l2.115"></a><span id="l2.115">             event.stopPropagation();</span>
<a href="#l2.116"></a><span id="l2.116">             return newStart;</span>
<a href="#l2.117"></a><span id="l2.117">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.118"></a><span id="l2.118">       &lt;/method&gt;</span>
<a href="#l2.119"></a><span id="l2.119">     &lt;/implementation&gt;</span>
<a href="#l2.120"></a><span id="l2.120"> </span>
<a href="#l2.121"></a><span id="l2.121" class="difflineat">@@ -2032,23 +2032,23 @@</span>
<a href="#l2.122"></a><span id="l2.122">           let snapIntMin = (event.shiftKey &amp;&amp;</span>
<a href="#l2.123"></a><span id="l2.123">                             !event.ctrlKey &amp;&amp;</span>
<a href="#l2.124"></a><span id="l2.124">                             !event.altKey &amp;&amp;</span>
<a href="#l2.125"></a><span id="l2.125">                             !event.metaKey) ? 1 : 15;</span>
<a href="#l2.126"></a><span id="l2.126">           let interval = this.mPixPerMin * snapIntMin;</span>
<a href="#l2.127"></a><span id="l2.127"> </span>
<a href="#l2.128"></a><span id="l2.128">           if (this.getAttribute(&quot;orient&quot;) == &quot;vertical&quot;) {</span>
<a href="#l2.129"></a><span id="l2.129">               this.mDragState.origLoc = event.screenY;</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineminus">-              this.mDragState.origMin = Math.floor((event.screenY - this.parentNode.boxObject.screenY) / interval) * snapIntMin;</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+              this.mDragState.origMin = Math.floor((event.screenY - this.parentNode.screenY) / interval) * snapIntMin;</span>
<a href="#l2.132"></a><span id="l2.132">               this.mDragState.limitEndMin = this.mDragState.origMin;</span>
<a href="#l2.133"></a><span id="l2.133">               this.mDragState.limitStartMin = this.mDragState.origMin;</span>
<a href="#l2.134"></a><span id="l2.134">               this.fgboxes.dragspacer.setAttribute(&quot;height&quot;, this.mDragState.origMin * this.mPixPerMin);</span>
<a href="#l2.135"></a><span id="l2.135">           } else {</span>
<a href="#l2.136"></a><span id="l2.136">               this.mDragState.origLoc = event.screenX;</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineminus">-              this.mDragState.origMin = Math.floor((event.screenX - this.parentNode.boxObject.screenX) / interval) * snapIntMin;</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+              this.mDragState.origMin = Math.floor((event.screenX - this.parentNode.screenX) / interval) * snapIntMin;</span>
<a href="#l2.139"></a><span id="l2.139">               this.fgboxes.dragspacer.setAttribute(&quot;width&quot;, this.mDragState.origMin * this.mPixPerMin);</span>
<a href="#l2.140"></a><span id="l2.140">           }</span>
<a href="#l2.141"></a><span id="l2.141"> </span>
<a href="#l2.142"></a><span id="l2.142">           document.calendarEventColumnDragging = this;</span>
<a href="#l2.143"></a><span id="l2.143"> </span>
<a href="#l2.144"></a><span id="l2.144">           window.addEventListener(&quot;mousemove&quot;, this.onEventSweepMouseMove);</span>
<a href="#l2.145"></a><span id="l2.145">           window.addEventListener(&quot;mouseup&quot;, this.onEventSweepMouseUp);</span>
<a href="#l2.146"></a><span id="l2.146">           window.addEventListener(&quot;keypress&quot;, this.onEventSweepKeypress);</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineat">@@ -2338,18 +2338,18 @@</span>
<a href="#l2.148"></a><span id="l2.148"> </span>
<a href="#l2.149"></a><span id="l2.149">             if (item.title &amp;&amp; item.title != &quot;&quot;) {</span>
<a href="#l2.150"></a><span id="l2.150">                 // Use &lt;description&gt; textContent so it can wrap.</span>
<a href="#l2.151"></a><span id="l2.151">                 evl.textContent = item.title;</span>
<a href="#l2.152"></a><span id="l2.152">             } else {</span>
<a href="#l2.153"></a><span id="l2.153">                 evl.textContent = cal.l10n.getCalString(&quot;eventUntitled&quot;);</span>
<a href="#l2.154"></a><span id="l2.154">             }</span>
<a href="#l2.155"></a><span id="l2.155"> </span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">-            let gripbar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;gripbar1&quot;).boxObject.height;</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineminus">-            let height = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;eventbox&quot;).boxObject.height;</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineplus">+            let gripbar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;gripbar1&quot;).getBoundingClientRect().height;</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineplus">+            let height = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;eventbox&quot;).getBoundingClientRect().height;</span>
<a href="#l2.160"></a><span id="l2.160">             evl.setAttribute(&quot;style&quot;, &quot;max-height: &quot; + Math.max(0, height-gripbar * 2) + &quot;px&quot;);</span>
<a href="#l2.161"></a><span id="l2.161">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.162"></a><span id="l2.162">       &lt;/method&gt;</span>
<a href="#l2.163"></a><span id="l2.163">     &lt;/implementation&gt;</span>
<a href="#l2.164"></a><span id="l2.164"> </span>
<a href="#l2.165"></a><span id="l2.165">     &lt;handlers&gt;</span>
<a href="#l2.166"></a><span id="l2.166">       &lt;handler event=&quot;mousedown&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l2.167"></a><span id="l2.167">           event.stopPropagation();</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineat">@@ -2632,19 +2632,19 @@</span>
<a href="#l2.169"></a><span id="l2.169">       &lt;method name=&quot;onResize&quot;&gt;</span>
<a href="#l2.170"></a><span id="l2.170">         &lt;parameter name=&quot;aRealSelf&quot;/&gt;</span>
<a href="#l2.171"></a><span id="l2.171">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.172"></a><span id="l2.172">             let self = aRealSelf || this; // eslint-disable-line consistent-this</span>
<a href="#l2.173"></a><span id="l2.173">             let isARelayout = !aRealSelf;</span>
<a href="#l2.174"></a><span id="l2.174">             let scrollbox = document.getAnonymousElementByAttribute(self, &quot;anonid&quot;, &quot;scrollbox&quot;);</span>
<a href="#l2.175"></a><span id="l2.175">             let size;</span>
<a href="#l2.176"></a><span id="l2.176">             if (self.orient == &quot;horizontal&quot;) {</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineminus">-                size = scrollbox.boxObject.width;</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineplus">+                size = scrollbox.getBoundingClientRect().width;</span>
<a href="#l2.179"></a><span id="l2.179">             } else {</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineminus">-                size = scrollbox.boxObject.height;</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineplus">+                size = scrollbox.getBoundingClientRect().height;</span>
<a href="#l2.182"></a><span id="l2.182">             }</span>
<a href="#l2.183"></a><span id="l2.183">             let ppm = size / self.mVisibleMinutes;</span>
<a href="#l2.184"></a><span id="l2.184">             ppm = Math.floor(ppm * 1000) / 1000;</span>
<a href="#l2.185"></a><span id="l2.185">             if (ppm &lt; self.mMinPixelsPerMinute) {</span>
<a href="#l2.186"></a><span id="l2.186">                 ppm = self.mMinPixelsPerMinute;</span>
<a href="#l2.187"></a><span id="l2.187">             }</span>
<a href="#l2.188"></a><span id="l2.188">             let ppmChanged = (self.pixelsPerMinute != ppm);</span>
<a href="#l2.189"></a><span id="l2.189">             self.pixelsPerMinute = ppm;</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineat">@@ -3561,21 +3561,21 @@</span>
<a href="#l2.191"></a><span id="l2.191">       &lt;method name=&quot;findColumnForClientPoint&quot;&gt;</span>
<a href="#l2.192"></a><span id="l2.192">         &lt;parameter name=&quot;aClientX&quot;/&gt;</span>
<a href="#l2.193"></a><span id="l2.193">         &lt;parameter name=&quot;aClientY&quot;/&gt;</span>
<a href="#l2.194"></a><span id="l2.194">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.195"></a><span id="l2.195">             if (!this.mDateColumns) {</span>
<a href="#l2.196"></a><span id="l2.196">                 return null;</span>
<a href="#l2.197"></a><span id="l2.197">             }</span>
<a href="#l2.198"></a><span id="l2.198">             for (let col of this.mDateColumns) {</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineminus">-                let boxObject = document.getAnonymousElementByAttribute(col.column, &quot;anonid&quot;, &quot;boxstack&quot;).boxObject;</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineminus">-                if (aClientX &gt;= boxObject.screenX &amp;&amp;</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineminus">-                    aClientX &lt;= (boxObject.screenX + boxObject.width) &amp;&amp;</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineminus">-                    aClientY &gt;= boxObject.screenY &amp;&amp;</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineminus">-                    aClientY &lt;= (boxObject.screenY + boxObject.height)) {</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineplus">+                let element = document.getAnonymousElementByAttribute(col.column, &quot;anonid&quot;, &quot;boxstack&quot;);</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineplus">+                if (aClientX &gt;= element.screenX &amp;&amp;</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineplus">+                    aClientX &lt;= (element.screenX + element.getBoundingClientRect().width) &amp;&amp;</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineplus">+                    aClientY &gt;= element.screenY &amp;&amp;</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineplus">+                    aClientY &lt;= (element.screenY + element.getBoundingClientRect().height)) {</span>
<a href="#l2.209"></a><span id="l2.209">                     return col.column;</span>
<a href="#l2.210"></a><span id="l2.210">                 }</span>
<a href="#l2.211"></a><span id="l2.211">             }</span>
<a href="#l2.212"></a><span id="l2.212">             return null;</span>
<a href="#l2.213"></a><span id="l2.213">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.214"></a><span id="l2.214">       &lt;/method&gt;</span>
<a href="#l2.215"></a><span id="l2.215"> </span>
<a href="#l2.216"></a><span id="l2.216">       &lt;method name=&quot;adjustScrollbarSpacersForAlldayEvents&quot;&gt;</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineat">@@ -3689,17 +3689,17 @@</span>
<a href="#l2.218"></a><span id="l2.218">             let headerPropertyValue = propertyValue;</span>
<a href="#l2.219"></a><span id="l2.219">             let headerDayBox = document.getAnonymousElementByAttribute(</span>
<a href="#l2.220"></a><span id="l2.220">                                this, &quot;anonid&quot;, &quot;headerdaybox&quot;);</span>
<a href="#l2.221"></a><span id="l2.221">             if (headerDayBox) {</span>
<a href="#l2.222"></a><span id="l2.222">                 // Only do this when there are multiple days</span>
<a href="#l2.223"></a><span id="l2.223">                 let headerDayBoxMaxHeight = parseInt(document.defaultView.getComputedStyle(headerDayBox)</span>
<a href="#l2.224"></a><span id="l2.224">                                                              .getPropertyValue(&quot;max-height&quot;), 10);</span>
<a href="#l2.225"></a><span id="l2.225">                 if (this.getAttribute(&quot;orient&quot;) == &quot;vertical&quot; &amp;&amp;</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineminus">-                    headerDayBox.boxObject.height &gt;= headerDayBoxMaxHeight) {</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineplus">+                    headerDayBox.getBoundingClientRect().height &gt;= headerDayBoxMaxHeight) {</span>
<a href="#l2.228"></a><span id="l2.228">                     // If the headerDayBox is just as high as the max-height, then</span>
<a href="#l2.229"></a><span id="l2.229">                     // there is already a scrollbar and we don't need to show the</span>
<a href="#l2.230"></a><span id="l2.230">                     // headerScrollbarSpacer. This is only valid for the non-rotated</span>
<a href="#l2.231"></a><span id="l2.231">                     // view.</span>
<a href="#l2.232"></a><span id="l2.232">                     headerPropertyValue = 0;</span>
<a href="#l2.233"></a><span id="l2.233">                 }</span>
<a href="#l2.234"></a><span id="l2.234">             }</span>
<a href="#l2.235"></a><span id="l2.235"> </span>
<a href="#l2.236"></a><span id="l2.236" class="difflineat">@@ -3717,17 +3717,17 @@</span>
<a href="#l2.237"></a><span id="l2.237">       &lt;method name=&quot;scrollToMinute&quot;&gt;</span>
<a href="#l2.238"></a><span id="l2.238">         &lt;parameter name=&quot;aMinute&quot;/&gt;</span>
<a href="#l2.239"></a><span id="l2.239">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.240"></a><span id="l2.240">             let scrollbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;scrollbox&quot;);</span>
<a href="#l2.241"></a><span id="l2.241">             // 'aMinute' will be the first minute showed in the view, so it must</span>
<a href="#l2.242"></a><span id="l2.242">             // belong to the range 0 &lt;-&gt; (24*60 - minutes_showed_in_the_view) but</span>
<a href="#l2.243"></a><span id="l2.243">             // we consider 25 hours instead of 24 to let the view scroll until</span>
<a href="#l2.244"></a><span id="l2.244">             // showing events that start just before 0.00</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineminus">-            let maxFirstMin = 25 * 60 - Math.round(scrollbox.boxObject.height / this.mPixPerMin);</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineplus">+            let maxFirstMin = 25 * 60 - Math.round(scrollbox.getBoundingClientRect().height / this.mPixPerMin);</span>
<a href="#l2.247"></a><span id="l2.247">             aMinute = Math.min(maxFirstMin, Math.max(0, aMinute));</span>
<a href="#l2.248"></a><span id="l2.248"> </span>
<a href="#l2.249"></a><span id="l2.249">             if (scrollbox.scrollHeight &gt; 0) {</span>
<a href="#l2.250"></a><span id="l2.250">                 let pos = Math.round(aMinute * this.mPixPerMin);</span>
<a href="#l2.251"></a><span id="l2.251">                 if (scrollbox.getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;) {</span>
<a href="#l2.252"></a><span id="l2.252">                     scrollbox.scrollTo(scrollbox.scrollLeft, pos);</span>
<a href="#l2.253"></a><span id="l2.253">                 } else {</span>
<a href="#l2.254"></a><span id="l2.254">                     scrollbox.scrollTo(pos, scrollbox.scrollTop);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -97,26 +97,26 @@ class MozCalendarEventFreebusyTimebar ex</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">     /**</span>
<a href="#l3.6"></a><span id="l3.6">      * Gets the difference between the x coordinate of the first two freebusy-day elements.</span>
<a href="#l3.7"></a><span id="l3.7">      *</span>
<a href="#l3.8"></a><span id="l3.8">      * @returns {Number}       X coordinate difference value</span>
<a href="#l3.9"></a><span id="l3.9">      */</span>
<a href="#l3.10"></a><span id="l3.10">     get contentWidth() {</span>
<a href="#l3.11"></a><span id="l3.11">         let template = this.getElementsByTagName(&quot;freebusy-day&quot;)[0];</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-        return template.nextSibling.boxObject.x - template.boxObject.x;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+        return template.nextSibling.getBoundingClientRect().x - template.getBoundingClientRect().x;</span>
<a href="#l3.14"></a><span id="l3.14">     }</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16">     /**</span>
<a href="#l3.17"></a><span id="l3.17">      * Gets parent node's width.</span>
<a href="#l3.18"></a><span id="l3.18">      *</span>
<a href="#l3.19"></a><span id="l3.19">      * @returns {Number}       Parent node's width</span>
<a href="#l3.20"></a><span id="l3.20">      */</span>
<a href="#l3.21"></a><span id="l3.21">     get containerWidth() {</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-        return this.parentNode.boxObject.width;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+        return this.parentNode.getBoundingClientRect().width;</span>
<a href="#l3.24"></a><span id="l3.24">     }</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">     /**</span>
<a href="#l3.27"></a><span id="l3.27">      * Sets startDate to a new value and make it immutable.</span>
<a href="#l3.28"></a><span id="l3.28">      *</span>
<a href="#l3.29"></a><span id="l3.29">      * @param {calIDateTime} val       New startDate value</span>
<a href="#l3.30"></a><span id="l3.30">      * @returns {calIDateTime}         New startDate value</span>
<a href="#l3.31"></a><span id="l3.31">      */</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineat">@@ -1063,28 +1063,28 @@ class MozCalendarEventAttendeesList exte</span>
<a href="#l3.33"></a><span id="l3.33">      * Calculates attendee list content height.</span>
<a href="#l3.34"></a><span id="l3.34">      */</span>
<a href="#l3.35"></a><span id="l3.35">     calcContentHeight() {</span>
<a href="#l3.36"></a><span id="l3.36">         let items = this.getElementsByTagName(&quot;richlistitem&quot;);</span>
<a href="#l3.37"></a><span id="l3.37">         this.mContentHeight = 0;</span>
<a href="#l3.38"></a><span id="l3.38">         if (items.length &gt; 0) {</span>
<a href="#l3.39"></a><span id="l3.39">             let i = 0;</span>
<a href="#l3.40"></a><span id="l3.40">             do {</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-                this.mRowHeight = items[i].boxObject.height;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+                this.mRowHeight = items[i].getBoundingClientRect().height;</span>
<a href="#l3.43"></a><span id="l3.43">                 ++i;</span>
<a href="#l3.44"></a><span id="l3.44">             } while (i &lt; items.length &amp;&amp; !this.mRowHeight);</span>
<a href="#l3.45"></a><span id="l3.45">             this.mContentHeight = this.mRowHeight * items.length;</span>
<a href="#l3.46"></a><span id="l3.46">         }</span>
<a href="#l3.47"></a><span id="l3.47">     }</span>
<a href="#l3.48"></a><span id="l3.48"> </span>
<a href="#l3.49"></a><span id="l3.49">     /**</span>
<a href="#l3.50"></a><span id="l3.50">      * Creates or removes dummy rows from the calendar-event-attendees-list.</span>
<a href="#l3.51"></a><span id="l3.51">      */</span>
<a href="#l3.52"></a><span id="l3.52">     createOrRemoveDummyRows() {</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-        let listboxHeight = this.boxObject.height;</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+        let listboxHeight = this.getBoundingClientRect().height;</span>
<a href="#l3.55"></a><span id="l3.55"> </span>
<a href="#l3.56"></a><span id="l3.56">         // Remove rows to remove scrollbar.</span>
<a href="#l3.57"></a><span id="l3.57">         let kids = this.childNodes;</span>
<a href="#l3.58"></a><span id="l3.58">         for (let i = kids.length - 1; this.mContentHeight &gt; listboxHeight &amp;&amp; i &gt;= 0; --i) {</span>
<a href="#l3.59"></a><span id="l3.59">             if (kids[i].hasAttribute(&quot;_isDummyRow&quot;)) {</span>
<a href="#l3.60"></a><span id="l3.60">                 this.mContentHeight -= this.mRowHeight;</span>
<a href="#l3.61"></a><span id="l3.61">                 kids[i].remove();</span>
<a href="#l3.62"></a><span id="l3.62">             }</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineat">@@ -1530,27 +1530,27 @@ class MozCalendarEventFreebusyRow extend</span>
<a href="#l3.64"></a><span id="l3.64"> </span>
<a href="#l3.65"></a><span id="l3.65">     /**</span>
<a href="#l3.66"></a><span id="l3.66">      * Gets width of the content.</span>
<a href="#l3.67"></a><span id="l3.67">      *</span>
<a href="#l3.68"></a><span id="l3.68">      * @returns {Number}        Content width</span>
<a href="#l3.69"></a><span id="l3.69">      */</span>
<a href="#l3.70"></a><span id="l3.70">     get contentWidth() {</span>
<a href="#l3.71"></a><span id="l3.71">         // Difference between the x coordinate of first and second child of hours node</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-        const diffX = this.hoursNode.childNodes[1].boxObject.x - this.hoursNode.childNodes[0].boxObject.x;</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+        const diffX = this.hoursNode.childNodes[1].getBoundingClientRect().x - this.hoursNode.childNodes[0].getBoundingClientRect().x;</span>
<a href="#l3.74"></a><span id="l3.74">         return diffX * this.numHours;</span>
<a href="#l3.75"></a><span id="l3.75">     }</span>
<a href="#l3.76"></a><span id="l3.76"> </span>
<a href="#l3.77"></a><span id="l3.77">     /**</span>
<a href="#l3.78"></a><span id="l3.78">      * Returns width of nearest listbox element.</span>
<a href="#l3.79"></a><span id="l3.79">      *</span>
<a href="#l3.80"></a><span id="l3.80">      * @returns {Number}        Nearest listbox width</span>
<a href="#l3.81"></a><span id="l3.81">      */</span>
<a href="#l3.82"></a><span id="l3.82">     get containerWidth() {</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-        return this.closest(&quot;listbox&quot;).boxObject.width;</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+        return this.closest(&quot;listbox&quot;).getBoundingClientRect().width;</span>
<a href="#l3.85"></a><span id="l3.85">     }</span>
<a href="#l3.86"></a><span id="l3.86"> </span>
<a href="#l3.87"></a><span id="l3.87">     /**</span>
<a href="#l3.88"></a><span id="l3.88">      * Sets offset value and calls showState which maps entries to the attribute of xul elements.</span>
<a href="#l3.89"></a><span id="l3.89">      *</span>
<a href="#l3.90"></a><span id="l3.90">      * @returns {Number}        New offset value</span>
<a href="#l3.91"></a><span id="l3.91">      */</span>
<a href="#l3.92"></a><span id="l3.92">     set dayOffset(val) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -559,26 +559,26 @@ function onResize() {</span>
<a href="#l4.4"></a><span id="l4.4">     // Don't do anything if we haven't been initialized.</span>
<a href="#l4.5"></a><span id="l4.5">     if (!gStartDate || !gEndDate) {</span>
<a href="#l4.6"></a><span id="l4.6">         return;</span>
<a href="#l4.7"></a><span id="l4.7">     }</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">     let grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l4.10"></a><span id="l4.10">     let gridScrollbar = document.getElementById(&quot;horizontal-scrollbar&quot;);</span>
<a href="#l4.11"></a><span id="l4.11">     grid.fitDummyRows();</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    let gridRatio = grid.boxObject.width / grid.documentSize;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    let gridRatio = grid.getBoundingClientRect().width / grid.documentSize;</span>
<a href="#l4.14"></a><span id="l4.14">     let gridMaxpos = gridScrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l4.15"></a><span id="l4.15">     let gridInc = gridMaxpos * gridRatio / (1 - gridRatio);</span>
<a href="#l4.16"></a><span id="l4.16">     gridScrollbar.setAttribute(&quot;pageincrement&quot;, gridInc);</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">     let attendees = document.getElementById(&quot;attendees-list&quot;);</span>
<a href="#l4.19"></a><span id="l4.19">     let attendeesScrollbar = document.getElementById(&quot;vertical-scrollbar&quot;);</span>
<a href="#l4.20"></a><span id="l4.20">     let box = document.getElementById(&quot;vertical-scrollbar-box&quot;);</span>
<a href="#l4.21"></a><span id="l4.21">     attendees.fitDummyRows();</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-    let attRatio = attendees.boxObject.height / attendees.documentSize;</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+    let attRatio = attendees.getBoundingClientRect().height / attendees.documentSize;</span>
<a href="#l4.24"></a><span id="l4.24">     let attMaxpos = attendeesScrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l4.25"></a><span id="l4.25">     if (attRatio &lt; 1) {</span>
<a href="#l4.26"></a><span id="l4.26">         box.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l4.27"></a><span id="l4.27">         let attInc = attMaxpos * attRatio / (1 - attRatio);</span>
<a href="#l4.28"></a><span id="l4.28">         attendeesScrollbar.setAttribute(&quot;pageincrement&quot;, attInc);</span>
<a href="#l4.29"></a><span id="l4.29">     } else {</span>
<a href="#l4.30"></a><span id="l4.30">         box.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l4.31"></a><span id="l4.31">     }</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineat">@@ -865,17 +865,17 @@ function onMouseScroll(event) {</span>
<a href="#l4.33"></a><span id="l4.33"> /**</span>
<a href="#l4.34"></a><span id="l4.34">  * Handler function to take care of attribute changes on the window</span>
<a href="#l4.35"></a><span id="l4.35">  *</span>
<a href="#l4.36"></a><span id="l4.36">  * @param event     The DOMAttrModified event caused by this change.</span>
<a href="#l4.37"></a><span id="l4.37">  */</span>
<a href="#l4.38"></a><span id="l4.38"> function onAttrModified(event) {</span>
<a href="#l4.39"></a><span id="l4.39">     if (event.attrName == &quot;width&quot;) {</span>
<a href="#l4.40"></a><span id="l4.40">         let selectionbar = document.getElementById(&quot;selection-bar&quot;);</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-        selectionbar.setWidth(selectionbar.boxObject.width);</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+        selectionbar.setWidth(selectionbar.getBoundingClientRect().width);</span>
<a href="#l4.43"></a><span id="l4.43">         return;</span>
<a href="#l4.44"></a><span id="l4.44">     }</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46">     // Synchronize grid and attendee list</span>
<a href="#l4.47"></a><span id="l4.47">     let target = event.originalTarget;</span>
<a href="#l4.48"></a><span id="l4.48">     if (target.hasAttribute(&quot;anonid&quot;) &amp;&amp;</span>
<a href="#l4.49"></a><span id="l4.49">         target.getAttribute(&quot;anonid&quot;) == &quot;input&quot; &amp;&amp;</span>
<a href="#l4.50"></a><span id="l4.50">         event.attrName == &quot;focused&quot;) {</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineat">@@ -928,18 +928,18 @@ function onAttrModified(event) {</span>
<a href="#l4.52"></a><span id="l4.52">  */</span>
<a href="#l4.53"></a><span id="l4.53"> function onTimebar(event) {</span>
<a href="#l4.54"></a><span id="l4.54">     document.getElementById(&quot;selection-bar&quot;).init(event.details, event.height);</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56">     // we need to enforce several layout constraints which can't be modelled</span>
<a href="#l4.57"></a><span id="l4.57">     // with plain xul and css, at least as far as i know.</span>
<a href="#l4.58"></a><span id="l4.58">     let timebar = document.getElementById(&quot;timebar&quot;);</span>
<a href="#l4.59"></a><span id="l4.59">     let scrollbar = document.getElementById(&quot;horizontal-scrollbar&quot;);</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-    document.documentElement.style.setProperty(&quot;--spacer-top-height&quot;, timebar.boxObject.height + &quot;px&quot;);</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-    document.documentElement.style.setProperty(&quot;--spacer-bottom-height&quot;, scrollbar.boxObject.height + &quot;px&quot;);</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+    document.documentElement.style.setProperty(&quot;--spacer-top-height&quot;, timebar.getBoundingClientRect().height + &quot;px&quot;);</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+    document.documentElement.style.setProperty(&quot;--spacer-bottom-height&quot;, scrollbar.getBoundingClientRect().height + &quot;px&quot;);</span>
<a href="#l4.64"></a><span id="l4.64"> }</span>
<a href="#l4.65"></a><span id="l4.65"> </span>
<a href="#l4.66"></a><span id="l4.66"> /**</span>
<a href="#l4.67"></a><span id="l4.67">  * Handler function to update controls when the time has changed on the</span>
<a href="#l4.68"></a><span id="l4.68">  * selection bar.</span>
<a href="#l4.69"></a><span id="l4.69">  *</span>
<a href="#l4.70"></a><span id="l4.70">  * @param event     The &quot;timechange&quot; event with startDate and endDate</span>
<a href="#l4.71"></a><span id="l4.71">  *                    properties.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -145,27 +145,27 @@</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">       &lt;property name=&quot;leftdragWidth&quot;&gt;</span>
<a href="#l5.6"></a><span id="l5.6">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l5.7"></a><span id="l5.7">             if (!this.mLeftBox) {</span>
<a href="#l5.8"></a><span id="l5.8">                 this.mLeftBox =</span>
<a href="#l5.9"></a><span id="l5.9">                     document.getAnonymousElementByAttribute(</span>
<a href="#l5.10"></a><span id="l5.10">                         this, &quot;anonid&quot;, &quot;leftbox&quot;);</span>
<a href="#l5.11"></a><span id="l5.11">             }</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-            return this.mLeftBox.boxObject.width;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+            return this.mLeftBox.getBoundingClientRect().width;</span>
<a href="#l5.14"></a><span id="l5.14">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.15"></a><span id="l5.15">       &lt;/property&gt;</span>
<a href="#l5.16"></a><span id="l5.16">       &lt;property name=&quot;rightdragWidth&quot;&gt;</span>
<a href="#l5.17"></a><span id="l5.17">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l5.18"></a><span id="l5.18">             if (!this.mRightBox) {</span>
<a href="#l5.19"></a><span id="l5.19">                 this.mRightBox =</span>
<a href="#l5.20"></a><span id="l5.20">                     document.getAnonymousElementByAttribute(</span>
<a href="#l5.21"></a><span id="l5.21">                         this, &quot;anonid&quot;, &quot;rightbox&quot;);</span>
<a href="#l5.22"></a><span id="l5.22">             }</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-            return this.mRightBox.boxObject.width;</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+            return this.mRightBox.getBoundingClientRect().width;</span>
<a href="#l5.25"></a><span id="l5.25">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.26"></a><span id="l5.26">       &lt;/property&gt;</span>
<a href="#l5.27"></a><span id="l5.27"> </span>
<a href="#l5.28"></a><span id="l5.28">       &lt;method name=&quot;init&quot;&gt;</span>
<a href="#l5.29"></a><span id="l5.29">         &lt;parameter name=&quot;width&quot;/&gt;</span>
<a href="#l5.30"></a><span id="l5.30">         &lt;parameter name=&quot;height&quot;/&gt;</span>
<a href="#l5.31"></a><span id="l5.31">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.32"></a><span id="l5.32">             this.mContentWidth = width;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineat">@@ -222,17 +222,17 @@</span>
<a href="#l5.34"></a><span id="l5.34">             if (this.mWidth &lt; totaldragwidths) {</span>
<a href="#l5.35"></a><span id="l5.35">                 this.mWidth = totaldragwidths;</span>
<a href="#l5.36"></a><span id="l5.36">             }</span>
<a href="#l5.37"></a><span id="l5.37">             this.mMargin = start_offset_in_hours * hour_width;</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">             // Calculate the difference between content and container in pixels.</span>
<a href="#l5.40"></a><span id="l5.40">             // The container is the window showing this control, the content is the</span>
<a href="#l5.41"></a><span id="l5.41">             // total number of pixels the selection bar can theoretically take up.</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-            let total_width = this.mContentWidth * this.mRange - this.parentNode.boxObject.width;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+            let total_width = this.mContentWidth * this.mRange - this.parentNode.getBoundingClientRect().width;</span>
<a href="#l5.44"></a><span id="l5.44"> </span>
<a href="#l5.45"></a><span id="l5.45">             // Calculate the current scroll offset.</span>
<a href="#l5.46"></a><span id="l5.46">             offset = Math.floor(total_width * this.mRatio);</span>
<a href="#l5.47"></a><span id="l5.47"> </span>
<a href="#l5.48"></a><span id="l5.48">             // The final margin is the difference between the date-based margin</span>
<a href="#l5.49"></a><span id="l5.49">             // and the scroll-based margin.</span>
<a href="#l5.50"></a><span id="l5.50">             this.mMargin -= offset;</span>
<a href="#l5.51"></a><span id="l5.51"> </span>
<a href="#l5.52"></a><span id="l5.52" class="difflineat">@@ -328,17 +328,17 @@</span>
<a href="#l5.53"></a><span id="l5.53">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.54"></a><span id="l5.54">       &lt;/method&gt;</span>
<a href="#l5.55"></a><span id="l5.55">     &lt;/implementation&gt;</span>
<a href="#l5.56"></a><span id="l5.56"> </span>
<a href="#l5.57"></a><span id="l5.57">     &lt;handlers&gt;</span>
<a href="#l5.58"></a><span id="l5.58">       &lt;handler event=&quot;mousedown&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.59"></a><span id="l5.59">           let element = event.target;</span>
<a href="#l5.60"></a><span id="l5.60">           this.mMouseX = event.screenX;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-          let mouseX = event.clientX - element.boxObject.x;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+          let mouseX = event.clientX - element.getBoundingClientRect().x;</span>
<a href="#l5.63"></a><span id="l5.63"> </span>
<a href="#l5.64"></a><span id="l5.64">           if (mouseX &gt;= this.mMargin) {</span>
<a href="#l5.65"></a><span id="l5.65">               if (mouseX &lt;= (this.mMargin + this.mWidth)) {</span>
<a href="#l5.66"></a><span id="l5.66">                   if (mouseX &lt;= (this.mMargin + this.leftdragWidth)) {</span>
<a href="#l5.67"></a><span id="l5.67">                       // Move the startdate only...</span>
<a href="#l5.68"></a><span id="l5.68">                       window.setCursor(&quot;w-resize&quot;);</span>
<a href="#l5.69"></a><span id="l5.69">                       this.mDragState = 2;</span>
<a href="#l5.70"></a><span id="l5.70">                   } else if (mouseX &gt;= (this.mMargin + this.mWidth - (this.rightdragWidth))) {</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineat">@@ -372,32 +372,32 @@</span>
<a href="#l5.72"></a><span id="l5.72"> </span>
<a href="#l5.73"></a><span id="l5.73">                   this.startDate = newStart;</span>
<a href="#l5.74"></a><span id="l5.74">                   this.endDate = newEnd;</span>
<a href="#l5.75"></a><span id="l5.75">                   this.mMouseX = mouseX;</span>
<a href="#l5.76"></a><span id="l5.76">                   this.update();</span>
<a href="#l5.77"></a><span id="l5.77">               }</span>
<a href="#l5.78"></a><span id="l5.78">           } else if (this.mDragState == 2) {</span>
<a href="#l5.79"></a><span id="l5.79">               // Move the startdate only...</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-              let delta = event.screenX - this.mSelectionbar.boxObject.screenX;</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+              let delta = event.screenX - this.mSelectionbar.screenX;</span>
<a href="#l5.82"></a><span id="l5.82">               let newStart = this.moveTime(this.mStartDate, delta, true);</span>
<a href="#l5.83"></a><span id="l5.83">               if (newStart.compare(this.mEndDate) &gt;= 0) {</span>
<a href="#l5.84"></a><span id="l5.84">                   if (this.mStartDate.isDate) {</span>
<a href="#l5.85"></a><span id="l5.85">                       return;</span>
<a href="#l5.86"></a><span id="l5.86">                   }</span>
<a href="#l5.87"></a><span id="l5.87">                   newStart = this.mEndDate;</span>
<a href="#l5.88"></a><span id="l5.88">               }</span>
<a href="#l5.89"></a><span id="l5.89">               if (newStart.compare(this.mStartDate) != 0) {</span>
<a href="#l5.90"></a><span id="l5.90">                   this.startDate = newStart;</span>
<a href="#l5.91"></a><span id="l5.91">                   this.update();</span>
<a href="#l5.92"></a><span id="l5.92">               }</span>
<a href="#l5.93"></a><span id="l5.93">           } else if (this.mDragState == 3) {</span>
<a href="#l5.94"></a><span id="l5.94">               // Move the enddate only..</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-              let delta = mouseX - (this.mSelectionbar.boxObject.screenX +</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-                                    this.mSelectionbar.boxObject.width);</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+              let delta = mouseX - (this.mSelectionbar.screenX +</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+                                    this.mSelectionbar.getBoundingClientRect().width);</span>
<a href="#l5.99"></a><span id="l5.99">               let newEnd = this.moveTime(this.mEndDate, delta, true);</span>
<a href="#l5.100"></a><span id="l5.100">               if (newEnd.compare(this.mStartDate) &lt; 0) {</span>
<a href="#l5.101"></a><span id="l5.101">                   newEnd = this.mStartDate;</span>
<a href="#l5.102"></a><span id="l5.102">               }</span>
<a href="#l5.103"></a><span id="l5.103">               if (newEnd.compare(this.mEndDate) != 0) {</span>
<a href="#l5.104"></a><span id="l5.104">                   // We need to adapt this date in case we're dealing with</span>
<a href="#l5.105"></a><span id="l5.105">                   // an all-day event. This is because setting 'endDate' will</span>
<a href="#l5.106"></a><span id="l5.106">                   // automatically add one day extra for all-day events.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -96,17 +96,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l6.5"></a><span id="l6.5">       &lt;/property&gt;</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">       &lt;property name=&quot;dayHeight&quot;&gt;</span>
<a href="#l6.8"></a><span id="l6.8">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l6.9"></a><span id="l6.9">             let day =</span>
<a href="#l6.10"></a><span id="l6.10">                 document.getAnonymousElementByAttribute(</span>
<a href="#l6.11"></a><span id="l6.11">                     this, &quot;anonid&quot;, &quot;day&quot;);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-            return day.boxObject.height;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+            return day.getBoundingClientRect().height;</span>
<a href="#l6.14"></a><span id="l6.14">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l6.15"></a><span id="l6.15">       &lt;/property&gt;</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">       &lt;property name=&quot;date&quot;&gt;</span>
<a href="#l6.18"></a><span id="l6.18">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l6.19"></a><span id="l6.19">             let date = val.clone();</span>
<a href="#l6.20"></a><span id="l6.20">             date.hour = 0;</span>
<a href="#l6.21"></a><span id="l6.21">             date.minute = 0;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -605,27 +605,27 @@</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24">       &lt;method name=&quot;calcContentHeight&quot;&gt;</span>
<a href="#l6.25"></a><span id="l6.25">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l6.26"></a><span id="l6.26">             let items = this.getElementsByTagName(&quot;richlistitem&quot;);</span>
<a href="#l6.27"></a><span id="l6.27">             this.mContentHeight = 0;</span>
<a href="#l6.28"></a><span id="l6.28">             if (items.length &gt; 0) {</span>
<a href="#l6.29"></a><span id="l6.29">                 let i = 0;</span>
<a href="#l6.30"></a><span id="l6.30">                 do {</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-                    this.mRowHeight = items[i].boxObject.height;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+                    this.mRowHeight = items[i].getBoundingClientRect().height;</span>
<a href="#l6.33"></a><span id="l6.33">                     ++i;</span>
<a href="#l6.34"></a><span id="l6.34">                 } while (i &lt; items.length &amp;&amp; !this.mRowHeight);</span>
<a href="#l6.35"></a><span id="l6.35">                 this.mContentHeight = this.mRowHeight * items.length;</span>
<a href="#l6.36"></a><span id="l6.36">             }</span>
<a href="#l6.37"></a><span id="l6.37">         ]]&gt;&lt;/body&gt;</span>
<a href="#l6.38"></a><span id="l6.38">       &lt;/method&gt;</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40">       &lt;method name=&quot;createOrRemoveDummyRows&quot;&gt;</span>
<a href="#l6.41"></a><span id="l6.41">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-            let listboxHeight = this.boxObject.height;</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+            let listboxHeight = this.getBoundingClientRect().height;</span>
<a href="#l6.44"></a><span id="l6.44"> </span>
<a href="#l6.45"></a><span id="l6.45">             // Remove rows to remove scrollbar</span>
<a href="#l6.46"></a><span id="l6.46">             let kids = this.childNodes;</span>
<a href="#l6.47"></a><span id="l6.47">             for (let i = kids.length - 1; this.mContentHeight &gt; listboxHeight &amp;&amp; i &gt;= 0; --i) {</span>
<a href="#l6.48"></a><span id="l6.48">                 if (kids[i].hasAttribute(&quot;_isDummyRow&quot;)) {</span>
<a href="#l6.49"></a><span id="l6.49">                     this.mContentHeight -= this.mRowHeight;</span>
<a href="#l6.50"></a><span id="l6.50">                     kids[i].remove();</span>
<a href="#l6.51"></a><span id="l6.51">                 }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -57,26 +57,26 @@ const RecurrencePreview = {</span>
<a href="#l7.4"></a><span id="l7.4">      * Updates #recurrence-preview node layout on window resize.</span>
<a href="#l7.5"></a><span id="l7.5">      */</span>
<a href="#l7.6"></a><span id="l7.6">     onResize() {</span>
<a href="#l7.7"></a><span id="l7.7">         let minimonth = this.node.querySelector(&quot;minimonth&quot;);</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">         let row = this.node.querySelector(&quot;row&quot;);</span>
<a href="#l7.10"></a><span id="l7.10">         let rows = row.parentNode;</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-        let contentWidth = minimonth.boxObject.width;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-        let containerWidth = this.node.boxObject.width;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+        let contentWidth = minimonth.getBoundingClientRect().width;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+        let containerWidth = this.node.getBoundingClientRect().width;</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17">         // Now find out how much elements can be displayed.</span>
<a href="#l7.18"></a><span id="l7.18">         // this is a simple division which always yields a positive integer value.</span>
<a href="#l7.19"></a><span id="l7.19">         const cWidth = containerWidth % contentWidth;</span>
<a href="#l7.20"></a><span id="l7.20">         let numHorizontal = (containerWidth - cWidth) / contentWidth;</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-        let contentHeight = minimonth.boxObject.height;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">-        let containerHeight = this.node.boxObject.height;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+        let contentHeight = minimonth.getBoundingClientRect().height;</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+        let containerHeight = this.node.getBoundingClientRect().height;</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">         const cHeight = containerHeight % contentHeight;</span>
<a href="#l7.28"></a><span id="l7.28">         // Now find out how much elements can be displayed.</span>
<a href="#l7.29"></a><span id="l7.29">         // this is a simple division which always yields a positive integer value.</span>
<a href="#l7.30"></a><span id="l7.30">         let numVertical = (containerHeight - cHeight) / contentHeight;</span>
<a href="#l7.31"></a><span id="l7.31"> </span>
<a href="#l7.32"></a><span id="l7.32">         // Count the number of existing rows</span>
<a href="#l7.33"></a><span id="l7.33">         let numRows = 0;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineat">@@ -141,17 +141,17 @@ const RecurrencePreview = {</span>
<a href="#l7.35"></a><span id="l7.35">             row = row.nextSibling;</span>
<a href="#l7.36"></a><span id="l7.36">         }</span>
<a href="#l7.37"></a><span id="l7.37">     },</span>
<a href="#l7.38"></a><span id="l7.38">     /**</span>
<a href="#l7.39"></a><span id="l7.39">      * Updates preview of #recurrence-preview node.</span>
<a href="#l7.40"></a><span id="l7.40">      */</span>
<a href="#l7.41"></a><span id="l7.41">     updatePreview(recurrenceInfo) {</span>
<a href="#l7.42"></a><span id="l7.42">         let minimonth = this.node.querySelector(&quot;minimonth&quot;);</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineminus">-        this.node.style.minHeight = minimonth.boxObject.height + &quot;px&quot;;</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+        this.node.style.minHeight = minimonth.getBoundingClientRect().height + &quot;px&quot;;</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46">         this.mRecurrenceInfo = recurrenceInfo;</span>
<a href="#l7.47"></a><span id="l7.47">         let start = this.dateTime.clone();</span>
<a href="#l7.48"></a><span id="l7.48">         start.day = 1;</span>
<a href="#l7.49"></a><span id="l7.49">         start.hour = 0;</span>
<a href="#l7.50"></a><span id="l7.50">         start.minute = 0;</span>
<a href="#l7.51"></a><span id="l7.51">         start.second = 0;</span>
<a href="#l7.52"></a><span id="l7.52">         let end = start.clone();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/today-pane.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/today-pane.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -180,17 +180,17 @@ var TodayPane = {</span>
<a href="#l8.4"></a><span id="l8.4">         } else if (x * x + y * y &gt; 9) {</span>
<a href="#l8.5"></a><span id="l8.5">             // move the mouse a bit before starting the drag session</span>
<a href="#l8.6"></a><span id="l8.6">             window.addEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching);</span>
<a href="#l8.7"></a><span id="l8.7">             TodayPane.minidayDrag.session = true;</span>
<a href="#l8.8"></a><span id="l8.8">             let dragCenterImage = document.getElementById(&quot;dragCenter-image&quot;);</span>
<a href="#l8.9"></a><span id="l8.9">             dragCenterImage.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l8.10"></a><span id="l8.10">             // Move the starting point in the center so we have a fixed</span>
<a href="#l8.11"></a><span id="l8.11">             // point where stopping the day switching while still dragging</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-            let centerObj = dragCenterImage.boxObject;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+            let centerObj = dragCenterImage.getBoundingClientRect();</span>
<a href="#l8.14"></a><span id="l8.14">             TodayPane.minidayDrag.startX = Math.floor(centerObj.x + centerObj.width / 2);</span>
<a href="#l8.15"></a><span id="l8.15">             TodayPane.minidayDrag.startY = Math.floor(centerObj.y + centerObj.height / 2);</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">             TodayPane.updateAdvanceTimer();</span>
<a href="#l8.18"></a><span id="l8.18">         }</span>
<a href="#l8.19"></a><span id="l8.19">     },</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">     /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -877,17 +877,17 @@</span>
<a href="#l9.4"></a><span id="l9.4">           -</span>
<a href="#l9.5"></a><span id="l9.5">           - @param event     The DOM drop event.</span>
<a href="#l9.6"></a><span id="l9.6">           - @return          Boolean indicating if the drop succeeded.</span>
<a href="#l9.7"></a><span id="l9.7">           -</span>
<a href="#l9.8"></a><span id="l9.8">           --&gt;</span>
<a href="#l9.9"></a><span id="l9.9">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l9.10"></a><span id="l9.10">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.11"></a><span id="l9.11">             let hasDropped;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-            if (event.clientY &lt; this.tree.boxObject.y) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+            if (event.clientY &lt; this.tree.getBoundingClientRect().y) {</span>
<a href="#l9.14"></a><span id="l9.14">                 hasDropped = this.drop(this.treebox.getFirstVisibleRow(), -1);</span>
<a href="#l9.15"></a><span id="l9.15">             } else {</span>
<a href="#l9.16"></a><span id="l9.16">                 hasDropped = this.drop(this.treebox.getLastVisibleRow(), 1);</span>
<a href="#l9.17"></a><span id="l9.17">             }</span>
<a href="#l9.18"></a><span id="l9.18">             if (hasDropped) {</span>
<a href="#l9.19"></a><span id="l9.19">                 event.preventDefault();</span>
<a href="#l9.20"></a><span id="l9.20">             }</span>
<a href="#l9.21"></a><span id="l9.21">             return hasDropped;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -898,17 +898,17 @@</span>
<a href="#l9.23"></a><span id="l9.23">         &lt;!--</span>
<a href="#l9.24"></a><span id="l9.24">           - Similar function to foreignCanDrop but for the dragenter event</span>
<a href="#l9.25"></a><span id="l9.25">           - @see ::foreignDrop</span>
<a href="#l9.26"></a><span id="l9.26">           --&gt;</span>
<a href="#l9.27"></a><span id="l9.27">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l9.28"></a><span id="l9.28">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.29"></a><span id="l9.29">             // The dragenter/dragover events expect false to be returned when</span>
<a href="#l9.30"></a><span id="l9.30">             // dropping is allowed, therefore we return !canDrop.</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-            if (event.clientY &lt; this.tree.boxObject.y) {</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+            if (event.clientY &lt; this.tree.getBoundingClientRect().y) {</span>
<a href="#l9.33"></a><span id="l9.33">                 return !this.canDrop(this.treebox.getFirstVisibleRow(), -1);</span>
<a href="#l9.34"></a><span id="l9.34">             } else {</span>
<a href="#l9.35"></a><span id="l9.35">                 return !this.canDrop(this.treebox.getLastVisibleRow(), 1);</span>
<a href="#l9.36"></a><span id="l9.36">             }</span>
<a href="#l9.37"></a><span id="l9.37">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.38"></a><span id="l9.38">       &lt;/method&gt;</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40">       &lt;method name=&quot;getParentIndex&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/modules/utils/calViewUtils.jsm</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/modules/utils/calViewUtils.jsm</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -20,21 +20,21 @@ var calview = {</span>
<a href="#l10.4"></a><span id="l10.4">      * Checks if the mousepointer of an event resides over a XULBox during an event</span>
<a href="#l10.5"></a><span id="l10.5">      *</span>
<a href="#l10.6"></a><span id="l10.6">      * @param aMouseEvent   The event eg. a 'mouseout' or 'mousedown' event</span>
<a href="#l10.7"></a><span id="l10.7">      * @param aXULBox       The xul element</span>
<a href="#l10.8"></a><span id="l10.8">      * @return              true or false depending on whether the mouse pointer</span>
<a href="#l10.9"></a><span id="l10.9">      *                      resides over the xulelement</span>
<a href="#l10.10"></a><span id="l10.10">      */</span>
<a href="#l10.11"></a><span id="l10.11">     isMouseOverBox: function(aMouseEvent, aXULElement) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-        let boxObject = aXULElement.boxObject;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-        let boxWidth = boxObject.width;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-        let boxHeight = boxObject.height;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-        let boxScreenX = boxObject.screenX;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-        let boxScreenY = boxObject.screenY;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+        let boundingRect = aXULElement.getBoundingClientRect();</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+        let boxWidth = boundingRect.width;</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+        let boxHeight = boundingRect.height;</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+        let boxScreenX = aXULElement.screenX;</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+        let boxScreenY = aXULElement.screenY;</span>
<a href="#l10.22"></a><span id="l10.22">         let mouseX = aMouseEvent.screenX;</span>
<a href="#l10.23"></a><span id="l10.23">         let mouseY = aMouseEvent.screenY;</span>
<a href="#l10.24"></a><span id="l10.24">         let xIsWithin = (mouseX &gt;= boxScreenX) &amp;&amp;</span>
<a href="#l10.25"></a><span id="l10.25">                         (mouseX &lt;= (boxScreenX + boxWidth));</span>
<a href="#l10.26"></a><span id="l10.26">         let yIsWithin = (mouseY &gt;= boxScreenY) &amp;&amp;</span>
<a href="#l10.27"></a><span id="l10.27">                         (mouseY &lt;= (boxScreenY + boxHeight));</span>
<a href="#l10.28"></a><span id="l10.28">         return (xIsWithin &amp;&amp; yIsWithin);</span>
<a href="#l10.29"></a><span id="l10.29">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -80,15 +80,15 @@ function testSmokeTest() {</span>
<a href="#l11.4"></a><span id="l11.4">     `));</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">     // Create test calendar.</span>
<a href="#l11.7"></a><span id="l11.7">     plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, (wizard) =&gt; {</span>
<a href="#l11.8"></a><span id="l11.8">         handleNewCalendarWizard(wizard, CALENDARNAME);</span>
<a href="#l11.9"></a><span id="l11.9">     });</span>
<a href="#l11.10"></a><span id="l11.10">     let calendarList = lookup(CALENDARLIST);</span>
<a href="#l11.11"></a><span id="l11.11">     // Double click on bottom left.</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    controller.doubleClick(calendarList, 0, calendarList.getNode().boxObject.height);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    controller.doubleClick(calendarList, 0, calendarList.getNode().getBoundingClientRect().height);</span>
<a href="#l11.14"></a><span id="l11.14">     wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l11.15"></a><span id="l11.15"> }</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17"> function teardownTest(module) {</span>
<a href="#l11.18"></a><span id="l11.18">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l11.19"></a><span id="l11.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/test/mozmill/testTimezones.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/test/mozmill/testTimezones.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -261,34 +261,34 @@ function verify(controller, dates, timez</span>
<a href="#l12.4"></a><span id="l12.4">     for (let [selectedYear, selectedMonth, selectedDay, selectedTime] of datetimes()) {</span>
<a href="#l12.5"></a><span id="l12.5">         goToDate(controller, selectedYear, selectedMonth, selectedDay);</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7">         // Find event with timezone tz.</span>
<a href="#l12.8"></a><span id="l12.8">         for (let tzIdx = 0; tzIdx &lt; timezones.length; tzIdx++) {</span>
<a href="#l12.9"></a><span id="l12.9">             let [correctHour, minutes, day] = selectedTime[tzIdx];</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">             let timeNode = lookup(`${timeLine}/[${correctHour}]`).getNode();</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-            let timeY = timeNode.boxObject.y + timeNode.boxObject.height * (minutes / 60);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+            let timeY = timeNode.getBoundingClientRect().y + timeNode.getBoundingClientRect().height * (minutes / 60);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">             let eventNodes = [];</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17">             // following day</span>
<a href="#l12.18"></a><span id="l12.18">             if (day == 1) {</span>
<a href="#l12.19"></a><span id="l12.19">                 viewForward(controller, 1);</span>
<a href="#l12.20"></a><span id="l12.20">             } else if (day == -1) {</span>
<a href="#l12.21"></a><span id="l12.21">                 viewBack(controller, 1);</span>
<a href="#l12.22"></a><span id="l12.22">             }</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">             let stackNode = lookup(dayStack);</span>
<a href="#l12.25"></a><span id="l12.25">             controller.waitForElement(stackNode);</span>
<a href="#l12.26"></a><span id="l12.26">             stackNode = stackNode.getNode();</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">             findEventsInNode(stackNode, eventNodes);</span>
<a href="#l12.29"></a><span id="l12.29">             eventNodes = eventNodes.filter(node =&gt; node.mOccurrence.title == timezones[tzIdx])</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-                                   .map(node =&gt; node.boxObject.y);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+                                   .map(node =&gt; node.getBoundingClientRect().y);</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33">             dump(`Looking for ${timezones[tzIdx]} at ${timeY}: found `);</span>
<a href="#l12.34"></a><span id="l12.34">             dump(eventNodes.join(&quot;, &quot;) + &quot;\n&quot;);</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36">             if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l12.37"></a><span id="l12.37">                 viewBack(controller, 1);</span>
<a href="#l12.38"></a><span id="l12.38">             }</span>
<a href="#l12.39"></a><span id="l12.39"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/common/bindings/notificationbox.xml</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/common/bindings/notificationbox.xml</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -278,17 +278,17 @@</span>
<a href="#l13.4"></a><span id="l13.4">       &lt;method name=&quot;_showNotification&quot;&gt;</span>
<a href="#l13.5"></a><span id="l13.5">         &lt;parameter name=&quot;aNotification&quot;/&gt;</span>
<a href="#l13.6"></a><span id="l13.6">         &lt;parameter name=&quot;aSlideIn&quot;/&gt;</span>
<a href="#l13.7"></a><span id="l13.7">         &lt;parameter name=&quot;aSkipAnimation&quot;/&gt;</span>
<a href="#l13.8"></a><span id="l13.8">         &lt;body&gt;</span>
<a href="#l13.9"></a><span id="l13.9">           &lt;![CDATA[</span>
<a href="#l13.10"></a><span id="l13.10">             this._finishAnimation();</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-            var height = aNotification.boxObject.height;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+            var height = aNotification.getBoundingClientRect().height;</span>
<a href="#l13.14"></a><span id="l13.14">             var skipAnimation = aSkipAnimation || height == 0 ||</span>
<a href="#l13.15"></a><span id="l13.15">                                 !this._allowAnimation;</span>
<a href="#l13.16"></a><span id="l13.16">             aNotification.classList.toggle(&quot;animated&quot;, !skipAnimation);</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">             if (aSlideIn) {</span>
<a href="#l13.19"></a><span id="l13.19">               this.currentNotification = aNotification;</span>
<a href="#l13.20"></a><span id="l13.20">               aNotification.style.removeProperty(&quot;position&quot;);</span>
<a href="#l13.21"></a><span id="l13.21">               aNotification.style.removeProperty(&quot;top&quot;);</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -346,18 +346,18 @@</span>
<a href="#l13.23"></a><span id="l13.23">                 canvas = document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;canvas&quot;);</span>
<a href="#l13.24"></a><span id="l13.24">               const XULNS = &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;;</span>
<a href="#l13.25"></a><span id="l13.25">               let content = this.firstChild;</span>
<a href="#l13.26"></a><span id="l13.26">               if (!content ||</span>
<a href="#l13.27"></a><span id="l13.27">                    content.namespaceURI != XULNS ||</span>
<a href="#l13.28"></a><span id="l13.28">                    content.localName != &quot;browser&quot;)</span>
<a href="#l13.29"></a><span id="l13.29">                 return;</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-              var width = content.boxObject.width;</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-              var height = content.boxObject.height;</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+              var width = content.getBoundingClientRect().width;</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+              var height = content.getBoundingClientRect().height;</span>
<a href="#l13.35"></a><span id="l13.35">               content.collapsed = true;</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37">               canvas.setAttribute(&quot;width&quot;, width);</span>
<a href="#l13.38"></a><span id="l13.38">               canvas.setAttribute(&quot;height&quot;, height);</span>
<a href="#l13.39"></a><span id="l13.39">               canvas.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l13.40"></a><span id="l13.40"> </span>
<a href="#l13.41"></a><span id="l13.41">               this.appendChild(canvas);</span>
<a href="#l13.42"></a><span id="l13.42">               this._blockingCanvas = canvas;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/common/bindings/richlistbox.xml</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/common/bindings/richlistbox.xml</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -540,26 +540,26 @@</span>
<a href="#l14.4"></a><span id="l14.4">             // the existing current item.</span>
<a href="#l14.5"></a><span id="l14.5">             if (this._isItemVisible(this.currentItem))</span>
<a href="#l14.6"></a><span id="l14.6">               this.scrollBy(0, this.clientHeight * aDirection);</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8">             // Figure out, how many items fully fit into the view port</span>
<a href="#l14.9"></a><span id="l14.9">             // (including the currently selected one), and determine</span>
<a href="#l14.10"></a><span id="l14.10">             // the index of the first one lying (partially) outside</span>
<a href="#l14.11"></a><span id="l14.11">             var height = this.clientHeight;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-            var startBorder = this.currentItem.boxObject.y;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+            var startBorder = this.currentItem.getBoundingClientRect().y;</span>
<a href="#l14.14"></a><span id="l14.14">             if (aDirection == -1)</span>
<a href="#l14.15"></a><span id="l14.15">               startBorder += this.currentItem.clientHeight;</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">             var index = this.currentIndex;</span>
<a href="#l14.18"></a><span id="l14.18">             for (var ix = index; 0 &lt;= ix &amp;&amp; ix &lt; children.length; ix += aDirection) {</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-              var boxObject = children[ix].boxObject;</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-              if (boxObject.height == 0)</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+              var boundingRect = children[ix].getBoundingClientRect();</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+              if (boundingRect.height == 0)</span>
<a href="#l14.23"></a><span id="l14.23">                 continue; // hidden children have a y of 0</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-              var endBorder = boxObject.y + (aDirection == -1 ? boxObject.height : 0);</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+              var endBorder = boundingRect.y + (aDirection == -1 ? boundingRect.height : 0);</span>
<a href="#l14.26"></a><span id="l14.26">               if ((endBorder - startBorder) * aDirection &gt; height)</span>
<a href="#l14.27"></a><span id="l14.27">                 break; // we've reached the desired distance</span>
<a href="#l14.28"></a><span id="l14.28">               index = ix;</span>
<a href="#l14.29"></a><span id="l14.29">             }</span>
<a href="#l14.30"></a><span id="l14.30"> </span>
<a href="#l14.31"></a><span id="l14.31">             return index != this.currentIndex ? index - this.currentIndex : aDirection;</span>
<a href="#l14.32"></a><span id="l14.32">           ]]&gt;</span>
<a href="#l14.33"></a><span id="l14.33">         &lt;/body&gt;</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineat">@@ -663,21 +663,21 @@</span>
<a href="#l14.35"></a><span id="l14.35"> </span>
<a href="#l14.36"></a><span id="l14.36">       &lt;method name=&quot;_isItemVisible&quot;&gt;</span>
<a href="#l14.37"></a><span id="l14.37">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l14.38"></a><span id="l14.38">         &lt;body&gt;</span>
<a href="#l14.39"></a><span id="l14.39">           &lt;![CDATA[</span>
<a href="#l14.40"></a><span id="l14.40">             if (!aItem)</span>
<a href="#l14.41"></a><span id="l14.41">               return false;</span>
<a href="#l14.42"></a><span id="l14.42"> </span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-            var y = this.scrollTop + this.boxObject.y;</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+            var y = this.scrollTop + this.getBoundingClientRect().y;</span>
<a href="#l14.45"></a><span id="l14.45"> </span>
<a href="#l14.46"></a><span id="l14.46">             // Partially visible items are also considered visible</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-            return (aItem.boxObject.y + aItem.clientHeight &gt; y) &amp;&amp;</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-                   (aItem.boxObject.y &lt; y + this.clientHeight);</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+            return (aItem.getBoundingClientRect().y + aItem.clientHeight &gt; y) &amp;&amp;</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+                   (aItem.getBoundingClientRect().y &lt; y + this.clientHeight);</span>
<a href="#l14.51"></a><span id="l14.51">           ]]&gt;</span>
<a href="#l14.52"></a><span id="l14.52">         &lt;/body&gt;</span>
<a href="#l14.53"></a><span id="l14.53">       &lt;/method&gt;</span>
<a href="#l14.54"></a><span id="l14.54"> </span>
<a href="#l14.55"></a><span id="l14.55">       &lt;property name=&quot;suppressOnSelect&quot;</span>
<a href="#l14.56"></a><span id="l14.56">                 onget=&quot;return this.getAttribute('suppressonselect') == 'true';&quot;</span>
<a href="#l14.57"></a><span id="l14.57">                 onset=&quot;this.setAttribute('suppressonselect', val);&quot;/&gt;</span>
<a href="#l14.58"></a><span id="l14.58"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/common/src/customizeToolbar.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/common/src/customizeToolbar.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -108,19 +108,19 @@ function repositionDialog(aWindow) {</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5">   var width;</span>
<a href="#l15.6"></a><span id="l15.6">   if (aWindow != window)</span>
<a href="#l15.7"></a><span id="l15.7">     width = aWindow.getBoundingClientRect().width;</span>
<a href="#l15.8"></a><span id="l15.8">   else if (document.documentElement.hasAttribute(&quot;width&quot;))</span>
<a href="#l15.9"></a><span id="l15.9">     width = document.documentElement.getAttribute(&quot;width&quot;);</span>
<a href="#l15.10"></a><span id="l15.10">   else</span>
<a href="#l15.11"></a><span id="l15.11">     width = parseInt(document.documentElement.style.width);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  var screenX = gToolbox.boxObject.screenX</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-                + ((gToolbox.boxObject.width - width) / 2);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-  var screenY = gToolbox.boxObject.screenY + gToolbox.boxObject.height;</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+  var screenX = gToolbox.screenX</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+                + ((gToolbox.getBoundingClientRect().width - width) / 2);</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+  var screenY = gToolbox.screenY + gToolbox.getBoundingClientRect().height;</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19">   aWindow.moveTo(screenX, screenY);</span>
<a href="#l15.20"></a><span id="l15.20"> }</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22"> function removeToolboxListeners() {</span>
<a href="#l15.23"></a><span id="l15.23">   var elts = getRootElements();</span>
<a href="#l15.24"></a><span id="l15.24">   for (let i = 0; i &lt; elts.length; i++) {</span>
<a href="#l15.25"></a><span id="l15.25">     elts[i].removeEventListener(&quot;dragstart&quot;, onToolbarDragStart, true);</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineat">@@ -669,17 +669,17 @@ function onToolbarDragOver(aEvent) {</span>
<a href="#l15.27"></a><span id="l15.27">   var previousDragItem = gCurrentDragOverItem;</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">   if (dropTarget.localName == &quot;toolbar&quot;) {</span>
<a href="#l15.30"></a><span id="l15.30">     gCurrentDragOverItem = dropTarget;</span>
<a href="#l15.31"></a><span id="l15.31">   } else {</span>
<a href="#l15.32"></a><span id="l15.32">     gCurrentDragOverItem = null;</span>
<a href="#l15.33"></a><span id="l15.33"> </span>
<a href="#l15.34"></a><span id="l15.34">     var direction = window.getComputedStyle(dropTarget.parentNode).direction;</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-    var dropTargetCenter = dropTarget.boxObject.x + (dropTarget.boxObject.width / 2);</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+    var dropTargetCenter = dropTarget.getBoundingClientRect().x + (dropTarget.getBoundingClientRect().width / 2);</span>
<a href="#l15.37"></a><span id="l15.37">     var dragAfter;</span>
<a href="#l15.38"></a><span id="l15.38">     if (direction == &quot;ltr&quot;)</span>
<a href="#l15.39"></a><span id="l15.39">       dragAfter = aEvent.clientX &gt; dropTargetCenter;</span>
<a href="#l15.40"></a><span id="l15.40">     else</span>
<a href="#l15.41"></a><span id="l15.41">       dragAfter = aEvent.clientX &lt; dropTargetCenter;</span>
<a href="#l15.42"></a><span id="l15.42"> </span>
<a href="#l15.43"></a><span id="l15.43">     if (dragAfter) {</span>
<a href="#l15.44"></a><span id="l15.44">       gCurrentDragOverItem = dropTarget.nextSibling;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/base/content/folderDisplay.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/base/content/folderDisplay.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -2622,22 +2622,22 @@ FakeTree.prototype = {</span>
<a href="#l16.4"></a><span id="l16.4">       // Nothing to do</span>
<a href="#l16.5"></a><span id="l16.5">       return;</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7">     let selection = this.view.selection;</span>
<a href="#l16.8"></a><span id="l16.8">     if (selection)</span>
<a href="#l16.9"></a><span id="l16.9">       selection.adjustSelection(aIndex, aCount);</span>
<a href="#l16.10"></a><span id="l16.10">   },</span>
<a href="#l16.11"></a><span id="l16.11">   get element() { return this.domNode; },</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  get x() { return this.domNode.boxObject.x; },</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  get y() { return this.domNode.boxObject.y; },</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-  get screenX() { return this.domNode.boxObject.screenX; },</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-  get screenY() { return this.domNode.boxObject.screenY; },</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-  get width() { return this.domNode.boxObject.width; },</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-  get height() { return this.domNode.boxObject.height; },</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+  get x() { return this.domNode.getBoundingClientRect().x; },</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+  get y() { return this.domNode.getBoundingClientRect().y; },</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+  get screenX() { return this.domNode.screenX; },</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+  get screenY() { return this.domNode.screenY; },</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+  get width() { return this.domNode.getBoundingClientRect().width; },</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+  get height() { return this.domNode.getBoundingClientRect().height; },</span>
<a href="#l16.24"></a><span id="l16.24">   get parentBox() { return this.domNode.boxObject.parentBox; },</span>
<a href="#l16.25"></a><span id="l16.25">   get firstChild() { return this.domNode.boxObject.firstChild; },</span>
<a href="#l16.26"></a><span id="l16.26">   get lastChild() { return this.domNode.boxObject.lastChild; },</span>
<a href="#l16.27"></a><span id="l16.27">   get nextSibling() { return this.domNode.boxObject.nextSibling; },</span>
<a href="#l16.28"></a><span id="l16.28">   get previousSibling() { return this.domNode.boxObject.previousSibling; },</span>
<a href="#l16.29"></a><span id="l16.29">   getPropertyAsSupports(propertyName) {</span>
<a href="#l16.30"></a><span id="l16.30">     return this.domNode.boxObject.getPropertyAsSupports(propertyName);</span>
<a href="#l16.31"></a><span id="l16.31">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -95,41 +95,41 @@</span>
<a href="#l17.4"></a><span id="l17.4">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.5"></a><span id="l17.5">           if (this._childNodes.length == 0)</span>
<a href="#l17.6"></a><span id="l17.6">             return -1;</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8">           // First try to estimate which row is visible, assuming they're all</span>
<a href="#l17.9"></a><span id="l17.9">           // the same height.</span>
<a href="#l17.10"></a><span id="l17.10">           let box = this;</span>
<a href="#l17.11"></a><span id="l17.11">           let estimatedRow = Math.floor(box.scrollTop /</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-                                        this._childNodes[0].boxObject.height);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+                                        this._childNodes[0].getBoundingClientRect().height);</span>
<a href="#l17.14"></a><span id="l17.14">           let estimatedIndex = estimatedRow * this._itemsPerRow();</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-          let offset = this._childNodes[estimatedIndex].boxObject.screenY -</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-                       box.boxObject.screenY;</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+          let offset = this._childNodes[estimatedIndex].screenY -</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+                       box.screenY;</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">           if (offset &gt; 0) {</span>
<a href="#l17.21"></a><span id="l17.21">             // We went too far! Go back until we find an item totally off-</span>
<a href="#l17.22"></a><span id="l17.22">             // screen, then return the one after that.</span>
<a href="#l17.23"></a><span id="l17.23">             for (let i = estimatedIndex - 1; i &gt;= 0; i--) {</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-              let childBoxObj = this._childNodes[i].boxObject;</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-              if (childBoxObj.screenY + childBoxObj.height &lt;=</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">-                  box.boxObject.screenY)</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+              let element = this._childNodes[i];</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+              if (element.screenY + element.getBoundingClientRect().height &lt;=</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+                  box.screenY)</span>
<a href="#l17.30"></a><span id="l17.30">                 return i + 1;</span>
<a href="#l17.31"></a><span id="l17.31">             }</span>
<a href="#l17.32"></a><span id="l17.32"> </span>
<a href="#l17.33"></a><span id="l17.33">             // If we get here, we must have gone back to the beginning of the</span>
<a href="#l17.34"></a><span id="l17.34">             // list, so just return 0.</span>
<a href="#l17.35"></a><span id="l17.35">             return 0;</span>
<a href="#l17.36"></a><span id="l17.36">           }</span>
<a href="#l17.37"></a><span id="l17.37">           // We didn't go far enough! Keep going until we find an item at</span>
<a href="#l17.38"></a><span id="l17.38">           // least partially on-screen.</span>
<a href="#l17.39"></a><span id="l17.39">           for (let i = estimatedIndex; i &lt; this._childNodes.length; i++) {</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-            let childBoxObj = this._childNodes[i].boxObject;</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-            if (childBoxObj.screenY + childBoxObj.height &gt;</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-                box.boxObject.screenY &gt; 0)</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+            let element = this._childNodes[i];</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+            if (element.screenY + element.getBoundingClientRect().height &gt;</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+                box.screenY &gt; 0)</span>
<a href="#l17.46"></a><span id="l17.46">               return i;</span>
<a href="#l17.47"></a><span id="l17.47">           }</span>
<a href="#l17.48"></a><span id="l17.48"> </span>
<a href="#l17.49"></a><span id="l17.49">           // If we get here, something is very wrong.</span>
<a href="#l17.50"></a><span id="l17.50">           Cu.reportError(</span>
<a href="#l17.51"></a><span id="l17.51">             &quot;Couldn't get index of first visible row for attachmentlist!\n&quot;);</span>
<a href="#l17.52"></a><span id="l17.52">           return -1;</span>
<a href="#l17.53"></a><span id="l17.53">         ]]&gt;&lt;/body&gt;</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineat">@@ -141,33 +141,33 @@</span>
<a href="#l17.55"></a><span id="l17.55">         ]]&gt;&lt;/body&gt;</span>
<a href="#l17.56"></a><span id="l17.56">       &lt;/method&gt;</span>
<a href="#l17.57"></a><span id="l17.57">       &lt;method name=&quot;ensureElementIsVisible&quot;&gt;</span>
<a href="#l17.58"></a><span id="l17.58">         &lt;parameter name=&quot;item&quot;/&gt;</span>
<a href="#l17.59"></a><span id="l17.59">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.60"></a><span id="l17.60">           let box = this;</span>
<a href="#l17.61"></a><span id="l17.61"> </span>
<a href="#l17.62"></a><span id="l17.62">           // Are we too far down?</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-          if (item.boxObject.screenY &lt; box.boxObject.screenY)</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-            box.scrollTop = item.boxObject.y - box.boxObject.y;</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+          if (item.screenY &lt; box.screenY)</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+            box.scrollTop = item.getBoundingClientRect().y - box.getBoundingClientRect().y;</span>
<a href="#l17.67"></a><span id="l17.67">           // ... or not far enough?</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineminus">-          else if (item.boxObject.screenY + item.boxObject.height &gt;</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-                   box.boxObject.screenY + box.boxObject.height)</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineminus">-            box.scrollTop = item.boxObject.y + item.boxObject.height -</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineminus">-                            box.boxObject.y - box.boxObject.height;</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineplus">+          else if (item.screenY + item.getBoundingClientRect().height &gt;</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineplus">+                   box.screenY + box.getBoundingClientRect().height)</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+            box.scrollTop = item.getBoundingClientRect().y + item.getBoundingClientRect().height -</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+                            box.getBoundingClientRect().y - box.getBoundingClientRect().height;</span>
<a href="#l17.76"></a><span id="l17.76">         ]]&gt;&lt;/body&gt;</span>
<a href="#l17.77"></a><span id="l17.77">       &lt;/method&gt;</span>
<a href="#l17.78"></a><span id="l17.78">       &lt;method name=&quot;scrollToIndex&quot;&gt;</span>
<a href="#l17.79"></a><span id="l17.79">         &lt;parameter name=&quot;index&quot;/&gt;</span>
<a href="#l17.80"></a><span id="l17.80">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.81"></a><span id="l17.81">           let box = this;</span>
<a href="#l17.82"></a><span id="l17.82">           let item = this.getItemAtIndex(index);</span>
<a href="#l17.83"></a><span id="l17.83">           if (!item)</span>
<a href="#l17.84"></a><span id="l17.84">             return;</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-          box.scrollTop = item.boxObject.y - box.boxObject.y;</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+          box.scrollTop = item.getBoundingClientRect().y - box.getBoundingClientRect().y;</span>
<a href="#l17.87"></a><span id="l17.87">         ]]&gt;&lt;/body&gt;</span>
<a href="#l17.88"></a><span id="l17.88">       &lt;/method&gt;</span>
<a href="#l17.89"></a><span id="l17.89">       &lt;method name=&quot;appendItem&quot;&gt;</span>
<a href="#l17.90"></a><span id="l17.90">         &lt;parameter name=&quot;attachment&quot;/&gt;</span>
<a href="#l17.91"></a><span id="l17.91">         &lt;parameter name=&quot;name&quot;/&gt;</span>
<a href="#l17.92"></a><span id="l17.92">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.93"></a><span id="l17.93">           // -1 appends due to the way getItemAtIndex is implemented.</span>
<a href="#l17.94"></a><span id="l17.94">           return this.insertItemAt(-1, attachment, name);</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineat">@@ -210,19 +210,19 @@</span>
<a href="#l17.96"></a><span id="l17.96">           item.attachment = attachment;</span>
<a href="#l17.97"></a><span id="l17.97"> </span>
<a href="#l17.98"></a><span id="l17.98">           this.insertBefore(item, this.getItemAtIndex(index));</span>
<a href="#l17.99"></a><span id="l17.99">           return item;</span>
<a href="#l17.100"></a><span id="l17.100">         ]]&gt;&lt;/body&gt;</span>
<a href="#l17.101"></a><span id="l17.101">       &lt;/method&gt;</span>
<a href="#l17.102"></a><span id="l17.102"> </span>
<a href="#l17.103"></a><span id="l17.103">       &lt;!-- Get the preferred height (the height that would allow us to fit</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-           everything without scrollbars) of the attachmentlist's boxObject. --&gt;</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+           everything without scrollbars) of the attachmentlist's bounding rectangle. --&gt;</span>
<a href="#l17.106"></a><span id="l17.106">       &lt;property name=&quot;preferredHeight&quot; readonly=&quot;true&quot;</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineminus">-                onget=&quot;return this.scrollbox.scrollHeight - this.scrollbox.clientHeight + this.boxObject.height;&quot;/&gt;</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineplus">+                onget=&quot;return this.scrollbox.scrollHeight - this.scrollbox.clientHeight + this.getBoundingClientRect().height;&quot;/&gt;</span>
<a href="#l17.109"></a><span id="l17.109"> </span>
<a href="#l17.110"></a><span id="l17.110">       &lt;!-- Find the attachmentitem node for the specified nsIMsgAttachment. --&gt;</span>
<a href="#l17.111"></a><span id="l17.111">       &lt;method name=&quot;findItemForAttachment&quot;&gt;</span>
<a href="#l17.112"></a><span id="l17.112">         &lt;parameter name=&quot;aAttachment&quot;/&gt;</span>
<a href="#l17.113"></a><span id="l17.113">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.114"></a><span id="l17.114">           for (let i = 0; i &lt; this.itemCount; i++) {</span>
<a href="#l17.115"></a><span id="l17.115">             let item = this.getItemAtIndex(i);</span>
<a href="#l17.116"></a><span id="l17.116">             if (item.attachment == aAttachment)</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineat">@@ -255,18 +255,18 @@</span>
<a href="#l17.118"></a><span id="l17.118">       &lt;/method&gt;</span>
<a href="#l17.119"></a><span id="l17.119"> </span>
<a href="#l17.120"></a><span id="l17.120">       &lt;method name=&quot;_itemsPerRow&quot;&gt;</span>
<a href="#l17.121"></a><span id="l17.121">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.122"></a><span id="l17.122">           // For 0 or 1 children, we can assume that they all fit in one row.</span>
<a href="#l17.123"></a><span id="l17.123">           if (this._childNodes.length &lt; 2)</span>
<a href="#l17.124"></a><span id="l17.124">             return this._childNodes.length;</span>
<a href="#l17.125"></a><span id="l17.125"> </span>
<a href="#l17.126"></a><span id="l17.126" class="difflineminus">-          let itemWidth = this._childNodes[1].boxObject.x -</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineminus">-                          this._childNodes[0].boxObject.x;</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineplus">+          let itemWidth = this._childNodes[1].getBoundingClientRect().x -</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineplus">+                          this._childNodes[0].getBoundingClientRect().x;</span>
<a href="#l17.130"></a><span id="l17.130"> </span>
<a href="#l17.131"></a><span id="l17.131">           if (itemWidth == 0) // Each item takes up a full row</span>
<a href="#l17.132"></a><span id="l17.132">             return 1;</span>
<a href="#l17.133"></a><span id="l17.133">           return Math.floor(this.clientWidth / itemWidth);</span>
<a href="#l17.134"></a><span id="l17.134">         ]]&gt;&lt;/body&gt;</span>
<a href="#l17.135"></a><span id="l17.135">       &lt;/method&gt;</span>
<a href="#l17.136"></a><span id="l17.136"> </span>
<a href="#l17.137"></a><span id="l17.137">       &lt;method name=&quot;_itemsPerCol&quot;&gt;</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineat">@@ -274,18 +274,18 @@</span>
<a href="#l17.139"></a><span id="l17.139">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.140"></a><span id="l17.140">           let itemsPerRow = aItemsPerRow || this._itemsPerRow();</span>
<a href="#l17.141"></a><span id="l17.141"> </span>
<a href="#l17.142"></a><span id="l17.142">           if (this._childNodes.length == 0)</span>
<a href="#l17.143"></a><span id="l17.143">             return 0;</span>
<a href="#l17.144"></a><span id="l17.144">           else if (this._childNodes.length &lt;= itemsPerRow)</span>
<a href="#l17.145"></a><span id="l17.145">             return 1;</span>
<a href="#l17.146"></a><span id="l17.146"> </span>
<a href="#l17.147"></a><span id="l17.147" class="difflineminus">-          let itemHeight = this._childNodes[itemsPerRow].boxObject.y -</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineminus">-                           this._childNodes[0].boxObject.y;</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineplus">+          let itemHeight = this._childNodes[itemsPerRow].getBoundingClientRect().y -</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineplus">+                           this._childNodes[0].getBoundingClientRect().y;</span>
<a href="#l17.151"></a><span id="l17.151"> </span>
<a href="#l17.152"></a><span id="l17.152">           return Math.floor(this.clientHeight / itemHeight);</span>
<a href="#l17.153"></a><span id="l17.153">         ]]&gt;&lt;/body&gt;</span>
<a href="#l17.154"></a><span id="l17.154">       &lt;/method&gt;</span>
<a href="#l17.155"></a><span id="l17.155"> </span>
<a href="#l17.156"></a><span id="l17.156">       &lt;method name=&quot;_setImageSize&quot;&gt;</span>
<a href="#l17.157"></a><span id="l17.157">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.158"></a><span id="l17.158">           let size = this.sizes[this.view] || 16;</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineat">@@ -332,17 +332,17 @@</span>
<a href="#l17.160"></a><span id="l17.160">     &lt;/content&gt;</span>
<a href="#l17.161"></a><span id="l17.161">     &lt;implementation&gt;</span>
<a href="#l17.162"></a><span id="l17.162">       &lt;method name=&quot;setOptimumWidth&quot;&gt;</span>
<a href="#l17.163"></a><span id="l17.163">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.164"></a><span id="l17.164">           if (this._childNodes.length == 0)</span>
<a href="#l17.165"></a><span id="l17.165">             return;</span>
<a href="#l17.166"></a><span id="l17.166"> </span>
<a href="#l17.167"></a><span id="l17.167">           let width = 0;</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineminus">-          let border = this._childNodes[0].boxObject.width -</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineplus">+          let border = this._childNodes[0].getBoundingClientRect().width -</span>
<a href="#l17.170"></a><span id="l17.170">                        this._childNodes[0].clientWidth;</span>
<a href="#l17.171"></a><span id="l17.171"> </span>
<a href="#l17.172"></a><span id="l17.172">           // If widths have changed after the initial calculation (updated</span>
<a href="#l17.173"></a><span id="l17.173">           // size string), clear each item's prior hardcoded width so</span>
<a href="#l17.174"></a><span id="l17.174">           // scrollwidth is natural, then get the width for the widest item</span>
<a href="#l17.175"></a><span id="l17.175">           // and set it on all the items again.</span>
<a href="#l17.176"></a><span id="l17.176">           for (let child of this._childNodes) {</span>
<a href="#l17.177"></a><span id="l17.177">             child.width = &quot;&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/base/content/msgHdrView.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/base/content/msgHdrView.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -2596,22 +2596,22 @@ function toggleAttachmentList(expanded, </span>
<a href="#l18.4"></a><span id="l18.4">     attachmentList.collapsed = false;</span>
<a href="#l18.5"></a><span id="l18.5">     if (!attachmentView.collapsed)</span>
<a href="#l18.6"></a><span id="l18.6">       attachmentSplitter.collapsed = false;</span>
<a href="#l18.7"></a><span id="l18.7">     attachmentBar.setAttribute(&quot;tooltiptext&quot;, bundle.getString(</span>
<a href="#l18.8"></a><span id="l18.8">       &quot;collapseAttachmentPaneTooltip&quot;));</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">     attachmentList.setOptimumWidth();</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    var attachmentHeight = attachmentView.boxObject.height -</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-      attachmentList.boxObject.height + attachmentList.preferredHeight;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+    var attachmentHeight = attachmentView.getBoundingClientRect().height -</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+      attachmentList.getBoundingClientRect().height + attachmentList.preferredHeight;</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">     // If the attachments box takes up too much of the message pane, downsize:</span>
<a href="#l18.18"></a><span id="l18.18">     var maxAttachmentHeight = document.getElementById(&quot;messagepanebox&quot;)</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-                                      .boxObject.height / 4;</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+                                      .getBoundingClientRect().height / 4;</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22">     attachmentView.setAttribute(&quot;height&quot;, Math.min(attachmentHeight,</span>
<a href="#l18.23"></a><span id="l18.23">                                                    maxAttachmentHeight));</span>
<a href="#l18.24"></a><span id="l18.24">     attachmentView.setAttribute(&quot;maxheight&quot;, attachmentHeight);</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26">     if (updateFocus)</span>
<a href="#l18.27"></a><span id="l18.27">       attachmentList.focus();</span>
<a href="#l18.28"></a><span id="l18.28">   } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/base/content/sanitizeDialog.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/base/content/sanitizeDialog.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -67,26 +67,26 @@ var gSanitizePromptDialog = {</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5">     var warningBox = this.warningBox;</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7">     // If clearing everything</span>
<a href="#l19.8"></a><span id="l19.8">     if (this.selectedTimespan === Sanitizer.TIMESPAN_EVERYTHING) {</span>
<a href="#l19.9"></a><span id="l19.9">       this.prepareWarning();</span>
<a href="#l19.10"></a><span id="l19.10">       if (warningBox.hidden) {</span>
<a href="#l19.11"></a><span id="l19.11">         warningBox.hidden = false;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-        window.resizeBy(0, warningBox.boxObject.height);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+        window.resizeBy(0, warningBox.getBoundingClientRect().height);</span>
<a href="#l19.14"></a><span id="l19.14">       }</span>
<a href="#l19.15"></a><span id="l19.15">       window.document.title =</span>
<a href="#l19.16"></a><span id="l19.16">         this.bundleBrowser.getString(&quot;sanitizeDialog2.everything.title&quot;);</span>
<a href="#l19.17"></a><span id="l19.17">       return;</span>
<a href="#l19.18"></a><span id="l19.18">     }</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20">     // If clearing a specific time range</span>
<a href="#l19.21"></a><span id="l19.21">     if (!warningBox.hidden) {</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineminus">-      window.resizeBy(0, -warningBox.boxObject.height);</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+      window.resizeBy(0, -warningBox.getBoundingClientRect().height);</span>
<a href="#l19.24"></a><span id="l19.24">       warningBox.hidden = true;</span>
<a href="#l19.25"></a><span id="l19.25">     }</span>
<a href="#l19.26"></a><span id="l19.26">     window.document.title =</span>
<a href="#l19.27"></a><span id="l19.27">       window.document.documentElement.getAttribute(&quot;noneverythingtitle&quot;);</span>
<a href="#l19.28"></a><span id="l19.28">   },</span>
<a href="#l19.29"></a><span id="l19.29"> </span>
<a href="#l19.30"></a><span id="l19.30">   sanitize() {</span>
<a href="#l19.31"></a><span id="l19.31">     // Update pref values before handing off to the sanitizer (bug 453440)</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineat">@@ -194,31 +194,31 @@ var gSanitizePromptDialog = {</span>
<a href="#l19.33"></a><span id="l19.33">    */</span>
<a href="#l19.34"></a><span id="l19.34">   showItemList() {</span>
<a href="#l19.35"></a><span id="l19.35">     var itemList = document.getElementById(&quot;itemList&quot;);</span>
<a href="#l19.36"></a><span id="l19.36">     var expanderButton = document.getElementById(&quot;detailsExpander&quot;);</span>
<a href="#l19.37"></a><span id="l19.37"> </span>
<a href="#l19.38"></a><span id="l19.38">     if (itemList.collapsed) {</span>
<a href="#l19.39"></a><span id="l19.39">       expanderButton.className = &quot;expander-up&quot;;</span>
<a href="#l19.40"></a><span id="l19.40">       itemList.setAttribute(&quot;collapsed&quot;, &quot;false&quot;);</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-      if (document.documentElement.boxObject.height)</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-        window.resizeBy(0, itemList.boxObject.height);</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+      if (document.documentElement.getBoundingClientRect().height)</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+        window.resizeBy(0, itemList.getBoundingClientRect().height);</span>
<a href="#l19.45"></a><span id="l19.45">     }</span>
<a href="#l19.46"></a><span id="l19.46">   },</span>
<a href="#l19.47"></a><span id="l19.47"> </span>
<a href="#l19.48"></a><span id="l19.48">   /**</span>
<a href="#l19.49"></a><span id="l19.49">    * Hide the history items list.</span>
<a href="#l19.50"></a><span id="l19.50">    */</span>
<a href="#l19.51"></a><span id="l19.51">   hideItemList() {</span>
<a href="#l19.52"></a><span id="l19.52">     var itemList = document.getElementById(&quot;itemList&quot;);</span>
<a href="#l19.53"></a><span id="l19.53">     var expanderButton = document.getElementById(&quot;detailsExpander&quot;);</span>
<a href="#l19.54"></a><span id="l19.54"> </span>
<a href="#l19.55"></a><span id="l19.55">     if (!itemList.collapsed) {</span>
<a href="#l19.56"></a><span id="l19.56">       expanderButton.className = &quot;expander-down&quot;;</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineminus">-      window.resizeBy(0, -itemList.boxObject.height);</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineplus">+      window.resizeBy(0, -itemList.getBoundingClientRect().height);</span>
<a href="#l19.59"></a><span id="l19.59">       itemList.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l19.60"></a><span id="l19.60">     }</span>
<a href="#l19.61"></a><span id="l19.61">   },</span>
<a href="#l19.62"></a><span id="l19.62"> </span>
<a href="#l19.63"></a><span id="l19.63">   /**</span>
<a href="#l19.64"></a><span id="l19.64">    * Called by the item list expander button to toggle the list's visibility.</span>
<a href="#l19.65"></a><span id="l19.65">    */</span>
<a href="#l19.66"></a><span id="l19.66">   toggleItemList() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -2148,17 +2148,17 @@</span>
<a href="#l20.4"></a><span id="l20.4">           // 1 - alltabs    = close buttons on all tabs</span>
<a href="#l20.5"></a><span id="l20.5">           // 2 - noclose    = no close buttons at all</span>
<a href="#l20.6"></a><span id="l20.6">           // 3 - closeatend = close button at the end of the tabstrip</span>
<a href="#l20.7"></a><span id="l20.7">           switch (this.mCloseButtons) {</span>
<a href="#l20.8"></a><span id="l20.8">           case 0:</span>
<a href="#l20.9"></a><span id="l20.9">             this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l20.10"></a><span id="l20.10">             break;</span>
<a href="#l20.11"></a><span id="l20.11">           case 1:</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-            var width = this.firstChild.boxObject.width;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+            var width = this.firstChild.getBoundingClientRect().width;</span>
<a href="#l20.14"></a><span id="l20.14">             // 0 width is an invalid value and indicates</span>
<a href="#l20.15"></a><span id="l20.15">             // an item without display, so ignore.</span>
<a href="#l20.16"></a><span id="l20.16">             if (width &gt; this.mTabClipWidth || width == 0)</span>
<a href="#l20.17"></a><span id="l20.17">               this.setAttribute(&quot;closebuttons&quot;, &quot;alltabs&quot;);</span>
<a href="#l20.18"></a><span id="l20.18">             else</span>
<a href="#l20.19"></a><span id="l20.19">               this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l20.20"></a><span id="l20.20">             break;</span>
<a href="#l20.21"></a><span id="l20.21">           case 2:</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -2181,17 +2181,17 @@</span>
<a href="#l20.23"></a><span id="l20.23">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.24"></a><span id="l20.24">           switch (aEvent.type) {</span>
<a href="#l20.25"></a><span id="l20.25">             case &quot;overflow&quot;:</span>
<a href="#l20.26"></a><span id="l20.26">               this.arrowScrollbox.ensureElementIsVisible(this.selectedItem);</span>
<a href="#l20.27"></a><span id="l20.27">               break;</span>
<a href="#l20.28"></a><span id="l20.28">             case &quot;underflow&quot;:</span>
<a href="#l20.29"></a><span id="l20.29">               break;</span>
<a href="#l20.30"></a><span id="l20.30">             case &quot;resize&quot;:</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-              var width = this.arrowScrollbox.boxObject.width;</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+              var width = this.arrowScrollbox.getBoundingClientRect().width;</span>
<a href="#l20.33"></a><span id="l20.33">               if (width != this.arrowScrollboxWidth) {</span>
<a href="#l20.34"></a><span id="l20.34">                 this._updateCloseButtons();</span>
<a href="#l20.35"></a><span id="l20.35">                 // XXX without this line the tab bar won't budge</span>
<a href="#l20.36"></a><span id="l20.36">                 this.arrowScrollbox.scrollByPixels(1);</span>
<a href="#l20.37"></a><span id="l20.37">                 this._handleTabSelect();</span>
<a href="#l20.38"></a><span id="l20.38">                 this.arrowScrollboxWidth = width;</span>
<a href="#l20.39"></a><span id="l20.39">               }</span>
<a href="#l20.40"></a><span id="l20.40">               break;</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineat">@@ -2240,23 +2240,22 @@</span>
<a href="#l20.42"></a><span id="l20.42">             this.mDownBoxAnimate.style.opacity = 0.0;</span>
<a href="#l20.43"></a><span id="l20.43">           }</span>
<a href="#l20.44"></a><span id="l20.44">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.45"></a><span id="l20.45">       &lt;/method&gt;</span>
<a href="#l20.46"></a><span id="l20.46"> </span>
<a href="#l20.47"></a><span id="l20.47">       &lt;method name=&quot;_notifyBackgroundTab&quot;&gt;</span>
<a href="#l20.48"></a><span id="l20.48">         &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l20.49"></a><span id="l20.49">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-          var tsbo = this.arrowScrollbox.boxObject;</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+          var tsbo = this.arrowScrollbox;</span>
<a href="#l20.52"></a><span id="l20.52">           var tsboStart = tsbo.screenX;</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-          var tsboEnd = tsboStart + tsbo.width;</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">-          var ctbo = aTab.boxObject;</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineminus">-          var ctboStart = ctbo.screenX;</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-          var ctboEnd = ctboStart + ctbo.width;</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+          var tsboEnd = tsboStart + tsbo.getBoundingClientRect().width;</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineplus">+</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineplus">+          var ctboStart = aTab.screenX;</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+          var ctboEnd = ctboStart + aTab.getBoundingClientRect().width;</span>
<a href="#l20.62"></a><span id="l20.62"> </span>
<a href="#l20.63"></a><span id="l20.63">           // only start the flash timer if the new tab (which was loaded in</span>
<a href="#l20.64"></a><span id="l20.64">           // the background) is not completely visible</span>
<a href="#l20.65"></a><span id="l20.65">           if (tsboStart &gt; ctboStart || ctboEnd &gt; tsboEnd) {</span>
<a href="#l20.66"></a><span id="l20.66">             this._animateStep = 0;</span>
<a href="#l20.67"></a><span id="l20.67"> </span>
<a href="#l20.68"></a><span id="l20.68">             if (!this._animateTimer)</span>
<a href="#l20.69"></a><span id="l20.69">               this._animateTimer =</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineat">@@ -2296,41 +2295,39 @@</span>
<a href="#l20.71"></a><span id="l20.71">           if (event.target.localName != &quot;tab&quot;)</span>
<a href="#l20.72"></a><span id="l20.72">             return null;</span>
<a href="#l20.73"></a><span id="l20.73"> </span>
<a href="#l20.74"></a><span id="l20.74">           let tab = event.target;</span>
<a href="#l20.75"></a><span id="l20.75"> </span>
<a href="#l20.76"></a><span id="l20.76">           if ((event.type != &quot;drop&quot;) &amp;&amp; (event.type != &quot;dragover&quot;))</span>
<a href="#l20.77"></a><span id="l20.77">             return tab;</span>
<a href="#l20.78"></a><span id="l20.78"> </span>
<a href="#l20.79"></a><span id="l20.79" class="difflineminus">-          let boxObject = tab.boxObject;</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineminus">-</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineminus">-          if (event.screenX &lt; boxObject.screenX + boxObject.width * .25)</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineplus">+          if (event.screenX &lt; tab.screenX + tab.getBoundingClientRect().width * .25)</span>
<a href="#l20.83"></a><span id="l20.83">             return null;</span>
<a href="#l20.84"></a><span id="l20.84"> </span>
<a href="#l20.85"></a><span id="l20.85" class="difflineminus">-          if (event.screenX &gt; boxObject.screenX + boxObject.width * .75)</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineplus">+          if (event.screenX &gt; tab.screenX + tab.getBoundingClientRect().width * .75)</span>
<a href="#l20.87"></a><span id="l20.87">             return null;</span>
<a href="#l20.88"></a><span id="l20.88"> </span>
<a href="#l20.89"></a><span id="l20.89">           return tab;</span>
<a href="#l20.90"></a><span id="l20.90">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.91"></a><span id="l20.91">       &lt;/method&gt;</span>
<a href="#l20.92"></a><span id="l20.92"> </span>
<a href="#l20.93"></a><span id="l20.93"> </span>
<a href="#l20.94"></a><span id="l20.94">       &lt;method name=&quot;_getDropIndex&quot;&gt;</span>
<a href="#l20.95"></a><span id="l20.95">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l20.96"></a><span id="l20.96">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.97"></a><span id="l20.97">           let tabs = this.childNodes;</span>
<a href="#l20.98"></a><span id="l20.98"> </span>
<a href="#l20.99"></a><span id="l20.99">           if (window.getComputedStyle(this).direction == &quot;ltr&quot;) {</span>
<a href="#l20.100"></a><span id="l20.100">             for (let i = 0; i &lt; tabs.length; i++)</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineminus">-              if (event.screenX &lt; (tabs[i].boxObject.screenX + (tabs[i].boxObject.width / 2)))</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineplus">+              if (event.screenX &lt; (tabs[i].screenX + (tabs[i].getBoundingClientRect().width / 2)))</span>
<a href="#l20.103"></a><span id="l20.103">                 return i;</span>
<a href="#l20.104"></a><span id="l20.104">           } else {</span>
<a href="#l20.105"></a><span id="l20.105">             for (let i = 0; i &lt; tabs.length; i++)</span>
<a href="#l20.106"></a><span id="l20.106" class="difflineminus">-              if (event.screenX &gt; (tabs[i].boxObject.screenX + (tabs[i].boxObject.width / 2)))</span>
<a href="#l20.107"></a><span id="l20.107" class="difflineplus">+              if (event.screenX &gt; (tabs[i].screenX + (tabs[i].getBoundingClientRect().width / 2)))</span>
<a href="#l20.108"></a><span id="l20.108">                 return i;</span>
<a href="#l20.109"></a><span id="l20.109">           }</span>
<a href="#l20.110"></a><span id="l20.110"> </span>
<a href="#l20.111"></a><span id="l20.111">            return tabs.length;</span>
<a href="#l20.112"></a><span id="l20.112">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.113"></a><span id="l20.113">       &lt;/method&gt;</span>
<a href="#l20.114"></a><span id="l20.114">     &lt;/implementation&gt;</span>
<a href="#l20.115"></a><span id="l20.115">     &lt;handlers&gt;</span>
<a href="#l20.116"></a><span id="l20.116" class="difflineat">@@ -2380,26 +2377,26 @@</span>
<a href="#l20.117"></a><span id="l20.117"> </span>
<a href="#l20.118"></a><span id="l20.118">         // Create Drag Image</span>
<a href="#l20.119"></a><span id="l20.119">         let panel = document.getElementById(&quot;tabpanelcontainer&quot;);</span>
<a href="#l20.120"></a><span id="l20.120"> </span>
<a href="#l20.121"></a><span id="l20.121">         let thumbnail = document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;canvas&quot;);</span>
<a href="#l20.122"></a><span id="l20.122">         thumbnail.width = Math.ceil(screen.availWidth / 5.75);</span>
<a href="#l20.123"></a><span id="l20.123">         thumbnail.height = Math.round(thumbnail.width * 0.5625);</span>
<a href="#l20.124"></a><span id="l20.124"> </span>
<a href="#l20.125"></a><span id="l20.125" class="difflineminus">-        let snippetWidth = panel.boxObject.width * .6;</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineplus">+        let snippetWidth = panel.getBoundingClientRect().width * .6;</span>
<a href="#l20.127"></a><span id="l20.127">         let scale = thumbnail.width / snippetWidth;</span>
<a href="#l20.128"></a><span id="l20.128"> </span>
<a href="#l20.129"></a><span id="l20.129">         let ctx = thumbnail.getContext(&quot;2d&quot;);</span>
<a href="#l20.130"></a><span id="l20.130"> </span>
<a href="#l20.131"></a><span id="l20.131">         ctx.scale(scale, scale);</span>
<a href="#l20.132"></a><span id="l20.132"> </span>
<a href="#l20.133"></a><span id="l20.133">         ctx.drawWindow(window,</span>
<a href="#l20.134"></a><span id="l20.134" class="difflineminus">-                panel.boxObject.screenX - window.mozInnerScreenX,</span>
<a href="#l20.135"></a><span id="l20.135" class="difflineminus">-                panel.boxObject.screenY - window.mozInnerScreenY,</span>
<a href="#l20.136"></a><span id="l20.136" class="difflineplus">+                panel.screenX - window.mozInnerScreenX,</span>
<a href="#l20.137"></a><span id="l20.137" class="difflineplus">+                panel.screenY - window.mozInnerScreenY,</span>
<a href="#l20.138"></a><span id="l20.138">                 snippetWidth,</span>
<a href="#l20.139"></a><span id="l20.139">                 snippetWidth * 0.5625,</span>
<a href="#l20.140"></a><span id="l20.140">                 &quot;rgb(255,255,255)&quot;);</span>
<a href="#l20.141"></a><span id="l20.141"> </span>
<a href="#l20.142"></a><span id="l20.142">         dt = event.dataTransfer;</span>
<a href="#l20.143"></a><span id="l20.143">         dt.setDragImage(thumbnail, 0, 0);</span>
<a href="#l20.144"></a><span id="l20.144"> </span>
<a href="#l20.145"></a><span id="l20.145">         event.stopPropagation();</span>
<a href="#l20.146"></a><span id="l20.146" class="difflineat">@@ -2636,20 +2633,20 @@</span>
<a href="#l20.147"></a><span id="l20.147">           return;</span>
<a href="#l20.148"></a><span id="l20.148"> </span>
<a href="#l20.149"></a><span id="l20.149">         // Disable detach within the browser toolbox</span>
<a href="#l20.150"></a><span id="l20.150">         var eX = event.screenX;</span>
<a href="#l20.151"></a><span id="l20.151">         var wX = window.screenX;</span>
<a href="#l20.152"></a><span id="l20.152"> </span>
<a href="#l20.153"></a><span id="l20.153">         // check if the drop point is horizontally within the window</span>
<a href="#l20.154"></a><span id="l20.154">         if (eX &gt; wX &amp;&amp; eX &lt; (wX + window.outerWidth)) {</span>
<a href="#l20.155"></a><span id="l20.155" class="difflineminus">-          let bo = this.arrowScrollbox.boxObject;</span>
<a href="#l20.156"></a><span id="l20.156" class="difflineplus">+          let bo = this.arrowScrollbox;</span>
<a href="#l20.157"></a><span id="l20.157">           // also avoid detaching if the the tab was dropped too close to</span>
<a href="#l20.158"></a><span id="l20.158">           // the tabbar (half a tab)</span>
<a href="#l20.159"></a><span id="l20.159" class="difflineminus">-          let endScreenY = bo.screenY + 1.5 * bo.height;</span>
<a href="#l20.160"></a><span id="l20.160" class="difflineplus">+          let endScreenY = bo.screenY + 1.5 * bo.getBoundingClientRect().height;</span>
<a href="#l20.161"></a><span id="l20.161">           let eY = event.screenY;</span>
<a href="#l20.162"></a><span id="l20.162"> </span>
<a href="#l20.163"></a><span id="l20.163">           if (eY &lt; endScreenY &amp;&amp; eY &gt; window.screenY)</span>
<a href="#l20.164"></a><span id="l20.164">             return;</span>
<a href="#l20.165"></a><span id="l20.165">         }</span>
<a href="#l20.166"></a><span id="l20.166"> </span>
<a href="#l20.167"></a><span id="l20.167">         // user wants to deatach tab from window...</span>
<a href="#l20.168"></a><span id="l20.168">         if (dt.mozItemCount != 1)</span>
<a href="#l20.169"></a><span id="l20.169" class="difflineat">@@ -2751,21 +2748,21 @@</span>
<a href="#l20.170"></a><span id="l20.170"> </span>
<a href="#l20.171"></a><span id="l20.171">       &lt;method name=&quot;_updateTabsVisibilityStatus&quot;&gt;</span>
<a href="#l20.172"></a><span id="l20.172">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.173"></a><span id="l20.173">           var tabContainer = document.getElementById(&quot;tabmail&quot;).tabContainer;</span>
<a href="#l20.174"></a><span id="l20.174">           // We don't want menu item decoration unless there is overflow.</span>
<a href="#l20.175"></a><span id="l20.175">           if (tabContainer.getAttribute(&quot;overflow&quot;) != &quot;true&quot;)</span>
<a href="#l20.176"></a><span id="l20.176">             return;</span>
<a href="#l20.177"></a><span id="l20.177"> </span>
<a href="#l20.178"></a><span id="l20.178" class="difflineminus">-          var tabstripBO = tabContainer.arrowScrollbox.boxObject;</span>
<a href="#l20.179"></a><span id="l20.179" class="difflineplus">+          var tabstripBO = tabContainer.arrowScrollbox;</span>
<a href="#l20.180"></a><span id="l20.180">           for (var i = 0; i &lt; this.childNodes.length; i++) {</span>
<a href="#l20.181"></a><span id="l20.181" class="difflineminus">-            var curTabBO = this.childNodes[i].tab.boxObject;</span>
<a href="#l20.182"></a><span id="l20.182" class="difflineplus">+            var curTabBO = this.childNodes[i].tab;</span>
<a href="#l20.183"></a><span id="l20.183">             if (curTabBO.screenX &gt;= tabstripBO.screenX &amp;&amp;</span>
<a href="#l20.184"></a><span id="l20.184" class="difflineminus">-                curTabBO.screenX + curTabBO.width &lt;= tabstripBO.screenX + tabstripBO.width)</span>
<a href="#l20.185"></a><span id="l20.185" class="difflineplus">+                curTabBO.screenX + curTabBO.getBoundingClientRect().width &lt;= tabstripBO.screenX + tabstripBO.getBoundingClientRect().width)</span>
<a href="#l20.186"></a><span id="l20.186">               this.childNodes[i].setAttribute(&quot;tabIsVisible&quot;, &quot;true&quot;);</span>
<a href="#l20.187"></a><span id="l20.187">             else</span>
<a href="#l20.188"></a><span id="l20.188">               this.childNodes[i].removeAttribute(&quot;tabIsVisible&quot;);</span>
<a href="#l20.189"></a><span id="l20.189">           }</span>
<a href="#l20.190"></a><span id="l20.190">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.191"></a><span id="l20.191">       &lt;/method&gt;</span>
<a href="#l20.192"></a><span id="l20.192"> </span>
<a href="#l20.193"></a><span id="l20.193">       &lt;method name=&quot;_createTabMenuItem&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/base/modules/GlobalPopupNotifications.jsm</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/base/modules/GlobalPopupNotifications.jsm</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -828,32 +828,32 @@ PopupNotifications.prototype = {</span>
<a href="#l21.4"></a><span id="l21.4">     if (!notificationsToShow.length) {</span>
<a href="#l21.5"></a><span id="l21.5">       return;</span>
<a href="#l21.6"></a><span id="l21.6">     }</span>
<a href="#l21.7"></a><span id="l21.7">     let notificationIds = notificationsToShow.map(n =&gt; n.id);</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9">     this._refreshPanel(notificationsToShow);</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11">     // If the anchor element is hidden or null, fall back to the identity icon.</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    if (!anchorElement || (anchorElement.boxObject.height == 0 &amp;&amp;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-                           anchorElement.boxObject.width == 0)) {</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+    if (!anchorElement || (anchorElement.getBoundingClientRect().height == 0 &amp;&amp;</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+                           anchorElement.getBoundingClientRect().width == 0)) {</span>
<a href="#l21.16"></a><span id="l21.16">       anchorElement = this.window.document.getElementById(&quot;identity-icon&quot;);</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18">       // If the identity icon is not available in this window, or maybe the</span>
<a href="#l21.19"></a><span id="l21.19">       // entire location bar is hidden for any reason, use the tab as the</span>
<a href="#l21.20"></a><span id="l21.20">       // anchor. We only ever show notifications for the current browser, so we</span>
<a href="#l21.21"></a><span id="l21.21">       // can just use the current tab.</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineminus">-      if (!anchorElement || (anchorElement.boxObject.height == 0 &amp;&amp;</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">-                             anchorElement.boxObject.width == 0)) {</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+      if (!anchorElement || (anchorElement.getBoundingClientRect().height == 0 &amp;&amp;</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+                             anchorElement.getBoundingClientRect().width == 0)) {</span>
<a href="#l21.26"></a><span id="l21.26">         anchorElement = this.tabbrowser.selectedTab;</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28">         // If we're in an entirely chromeless environment, set the anchorElement</span>
<a href="#l21.29"></a><span id="l21.29">         // to null and let openPopup show the notification at (0,0) later.</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-        if (!anchorElement || (anchorElement.boxObject.height == 0 &amp;&amp;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-                               anchorElement.boxObject.width == 0)) {</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+        if (!anchorElement || (anchorElement.getBoundingClientRect().height == 0 &amp;&amp;</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+                               anchorElement.getBoundingClientRect().width == 0)) {</span>
<a href="#l21.34"></a><span id="l21.34">           anchorElement = null;</span>
<a href="#l21.35"></a><span id="l21.35">         }</span>
<a href="#l21.36"></a><span id="l21.36">       }</span>
<a href="#l21.37"></a><span id="l21.37">     }</span>
<a href="#l21.38"></a><span id="l21.38"> </span>
<a href="#l21.39"></a><span id="l21.39">     if (this.isPanelOpen &amp;&amp; this._currentAnchorElement == anchorElement) {</span>
<a href="#l21.40"></a><span id="l21.40">       notificationsToShow.forEach(function(n) {</span>
<a href="#l21.41"></a><span id="l21.41">         this._fireCallback(n, NOTIFICATION_EVENT_SHOWN);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -5653,43 +5653,40 @@ var envelopeDragObserver = {</span>
<a href="#l22.4"></a><span id="l22.4">    *                                   bottom of the list.</span>
<a href="#l22.5"></a><span id="l22.5">    */</span>
<a href="#l22.6"></a><span id="l22.6">   _adjustDropTarget(aEvent) {</span>
<a href="#l22.7"></a><span id="l22.7">     let target = aEvent.target;</span>
<a href="#l22.8"></a><span id="l22.8">     let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10">     if (target == bucket) {</span>
<a href="#l22.11"></a><span id="l22.11">       // Dragging or dropping at top/bottom border of the listbox</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-      let box = target.boxObject;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-      if ((aEvent.screenY - box.screenY) / box.height &lt; 0.5) {</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+      if ((aEvent.screenY - target.screenY) / target.getBoundingClientRect().height &lt; 0.5) {</span>
<a href="#l22.15"></a><span id="l22.15">         target = bucket.firstChild;</span>
<a href="#l22.16"></a><span id="l22.16">       } else {</span>
<a href="#l22.17"></a><span id="l22.17">         target = bucket.lastChild;</span>
<a href="#l22.18"></a><span id="l22.18">       }</span>
<a href="#l22.19"></a><span id="l22.19">       // We'll check below if this is a valid target.</span>
<a href="#l22.20"></a><span id="l22.20">     } else if (target.id == &quot;attachmentBucketCount&quot;) {</span>
<a href="#l22.21"></a><span id="l22.21">       // Dragging or dropping at top border of the listbox.</span>
<a href="#l22.22"></a><span id="l22.22">       // Allow bottom half of attachment list header as extended drop target</span>
<a href="#l22.23"></a><span id="l22.23">       // for top of list, because otherwise it would be too small.</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">-      let box = target.boxObject;</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">-      if ((aEvent.screenY - box.screenY) / box.height &gt;= 0.5) {</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+      if ((aEvent.screenY - target.screenY) / target.getBoundingClientRect().height &gt;= 0.5) {</span>
<a href="#l22.27"></a><span id="l22.27">         target = bucket.firstChild;</span>
<a href="#l22.28"></a><span id="l22.28">         // We'll check below if this is a valid target.</span>
<a href="#l22.29"></a><span id="l22.29">       } else {</span>
<a href="#l22.30"></a><span id="l22.30">         // Top half of attachment list header: sorry, can't drop here.</span>
<a href="#l22.31"></a><span id="l22.31">         return &quot;none&quot;;</span>
<a href="#l22.32"></a><span id="l22.32">       }</span>
<a href="#l22.33"></a><span id="l22.33">     }</span>
<a href="#l22.34"></a><span id="l22.34"> </span>
<a href="#l22.35"></a><span id="l22.35">     // Target is an attachmentitem.</span>
<a href="#l22.36"></a><span id="l22.36">     if (target.matches(&quot;richlistitem.attachmentItem&quot;)) {</span>
<a href="#l22.37"></a><span id="l22.37">       // If we're dragging/dropping in bottom half of attachmentitem,</span>
<a href="#l22.38"></a><span id="l22.38">       // adjust target to target.nextSibling (to show dropmarker above that).</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineminus">-      let box = target.boxObject;</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">-      if ((aEvent.screenY - box.screenY) / box.height &gt;= 0.5) {</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+      if ((aEvent.screenY - target.screenY) / target.getBoundingClientRect().height &gt;= 0.5) {</span>
<a href="#l22.42"></a><span id="l22.42">         target = target.nextSibling;</span>
<a href="#l22.43"></a><span id="l22.43"> </span>
<a href="#l22.44"></a><span id="l22.44">         // If there's no target.nextSibling, we're dragging/dropping</span>
<a href="#l22.45"></a><span id="l22.45">         // to the bottom of the list.</span>
<a href="#l22.46"></a><span id="l22.46">         if (!target) {</span>
<a href="#l22.47"></a><span id="l22.47">           // We can't move a bottom block selection to the bottom.</span>
<a href="#l22.48"></a><span id="l22.48">           if (attachmentsSelectionIsBlock(&quot;bottom&quot;))</span>
<a href="#l22.49"></a><span id="l22.49">             return &quot;none&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/components/compose/content/addressingWidgetOverlay.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/components/compose/content/addressingWidgetOverlay.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -56,20 +56,20 @@ function awInitializeNumberOfRowsShown()</span>
<a href="#l23.4"></a><span id="l23.4">   let extraHeight = 2;</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6">   // Set minimum number of rows shown for address widget, per hardwired</span>
<a href="#l23.7"></a><span id="l23.7">   // rows=&quot;1&quot; attribute of addressingWidget, to prevent resizing the</span>
<a href="#l23.8"></a><span id="l23.8">   // subject and format toolbar over the address widget.</span>
<a href="#l23.9"></a><span id="l23.9">   // This lets users shrink the address widget to one row (with delicate UX)</span>
<a href="#l23.10"></a><span id="l23.10">   // and thus maximize the space available for composition body,</span>
<a href="#l23.11"></a><span id="l23.11">   // especially on small screens.</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  msgHeadersToolbar.minHeight = msgHeadersToolbar.boxObject.height;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  msgHeadersToolbar.minHeight = msgHeadersToolbar.getBoundingClientRect().height;</span>
<a href="#l23.14"></a><span id="l23.14"> </span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-  msgHeadersToolbar.height = msgHeadersToolbar.boxObject.height +</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">-    addressingWidget.boxObject.height * (awNumRowsShownDefault - 1) +</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+  msgHeadersToolbar.height = msgHeadersToolbar.getBoundingClientRect().height +</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineplus">+    addressingWidget.getBoundingClientRect().height * (awNumRowsShownDefault - 1) +</span>
<a href="#l23.19"></a><span id="l23.19">     extraHeight;</span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21">   // Update addressingWidget internals.</span>
<a href="#l23.22"></a><span id="l23.22">   awCreateOrRemoveDummyRows();</span>
<a href="#l23.23"></a><span id="l23.23"> }</span>
<a href="#l23.24"></a><span id="l23.24"> </span>
<a href="#l23.25"></a><span id="l23.25"> function awInputElementName() {</span>
<a href="#l23.26"></a><span id="l23.26">   if (inputElementType == &quot;&quot;)</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineat">@@ -876,17 +876,17 @@ var gAWRowHeight = 0;</span>
<a href="#l23.28"></a><span id="l23.28"> </span>
<a href="#l23.29"></a><span id="l23.29"> function awFitDummyRows() {</span>
<a href="#l23.30"></a><span id="l23.30">   awCalcContentHeight();</span>
<a href="#l23.31"></a><span id="l23.31">   awCreateOrRemoveDummyRows();</span>
<a href="#l23.32"></a><span id="l23.32"> }</span>
<a href="#l23.33"></a><span id="l23.33"> </span>
<a href="#l23.34"></a><span id="l23.34"> function awCreateOrRemoveDummyRows() {</span>
<a href="#l23.35"></a><span id="l23.35">   let listbox = document.getElementById(&quot;addressingWidget&quot;);</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">-  let listboxHeight = listbox.boxObject.height;</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineplus">+  let listboxHeight = listbox.getBoundingClientRect().height;</span>
<a href="#l23.38"></a><span id="l23.38"> </span>
<a href="#l23.39"></a><span id="l23.39">   // remove rows to remove scrollbar</span>
<a href="#l23.40"></a><span id="l23.40">   let kids = listbox.querySelectorAll(&quot;[_isDummyRow]&quot;);</span>
<a href="#l23.41"></a><span id="l23.41">   for (let i = kids.length - 1; gAWContentHeight &gt; listboxHeight &amp;&amp; i &gt;= 0; --i) {</span>
<a href="#l23.42"></a><span id="l23.42">     gAWContentHeight -= gAWRowHeight;</span>
<a href="#l23.43"></a><span id="l23.43">     kids[i].remove();</span>
<a href="#l23.44"></a><span id="l23.44">   }</span>
<a href="#l23.45"></a><span id="l23.45"> </span>
<a href="#l23.46"></a><span id="l23.46" class="difflineat">@@ -904,31 +904,31 @@ function awCalcContentHeight() {</span>
<a href="#l23.47"></a><span id="l23.47">   var items = listbox.getElementsByTagName(&quot;richlistitem&quot;);</span>
<a href="#l23.48"></a><span id="l23.48"> </span>
<a href="#l23.49"></a><span id="l23.49">   gAWContentHeight = 0;</span>
<a href="#l23.50"></a><span id="l23.50">   if (items.length &gt; 0) {</span>
<a href="#l23.51"></a><span id="l23.51">     // all rows are forced to a uniform height in xul listboxes, so</span>
<a href="#l23.52"></a><span id="l23.52">     // find the first listitem with a boxObject and use it as precedent</span>
<a href="#l23.53"></a><span id="l23.53">     var i = 0;</span>
<a href="#l23.54"></a><span id="l23.54">     do {</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineminus">-      gAWRowHeight = items[i].boxObject.height;</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineplus">+      gAWRowHeight = items[i].getBoundingClientRect().height;</span>
<a href="#l23.57"></a><span id="l23.57">       ++i;</span>
<a href="#l23.58"></a><span id="l23.58">     } while (i &lt; items.length &amp;&amp; !gAWRowHeight);</span>
<a href="#l23.59"></a><span id="l23.59">     gAWContentHeight = gAWRowHeight * items.length;</span>
<a href="#l23.60"></a><span id="l23.60">   }</span>
<a href="#l23.61"></a><span id="l23.61"> }</span>
<a href="#l23.62"></a><span id="l23.62"> </span>
<a href="#l23.63"></a><span id="l23.63"> function awCreateDummyItem(aParent) {</span>
<a href="#l23.64"></a><span id="l23.64">   var listbox = document.getElementById(&quot;addressingWidget&quot;);</span>
<a href="#l23.65"></a><span id="l23.65">   var item = listbox.getElementsByTagName(&quot;richlistitem&quot;)[0];</span>
<a href="#l23.66"></a><span id="l23.66"> </span>
<a href="#l23.67"></a><span id="l23.67">   var titem = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l23.68"></a><span id="l23.68">   titem.setAttribute(&quot;_isDummyRow&quot;, &quot;true&quot;);</span>
<a href="#l23.69"></a><span id="l23.69">   titem.setAttribute(&quot;class&quot;, &quot;dummy-row&quot;);</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineminus">-  titem.style.height = item.boxObject.height + &quot;px&quot;;</span>
<a href="#l23.71"></a><span id="l23.71" class="difflineplus">+  titem.style.height = item.getBoundingClientRect().height + &quot;px&quot;;</span>
<a href="#l23.72"></a><span id="l23.72"> </span>
<a href="#l23.73"></a><span id="l23.73">   for (let i = 0; i &lt; awGetNumberOfCols(); i++) {</span>
<a href="#l23.74"></a><span id="l23.74">     let cell = awCreateDummyCell(titem);</span>
<a href="#l23.75"></a><span id="l23.75">     if (item.children[i].hasAttribute(&quot;style&quot;)) {</span>
<a href="#l23.76"></a><span id="l23.76">       cell.setAttribute(&quot;style&quot;, item.children[i].getAttribute(&quot;style&quot;));</span>
<a href="#l23.77"></a><span id="l23.77">     }</span>
<a href="#l23.78"></a><span id="l23.78">     if (item.children[i].hasAttribute(&quot;flex&quot;)) {</span>
<a href="#l23.79"></a><span id="l23.79">       cell.setAttribute(&quot;flex&quot;, item.children[i].getAttribute(&quot;flex&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/components/im/content/imconversation.xml</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/components/im/content/imconversation.xml</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -375,17 +375,17 @@</span>
<a href="#l24.4"></a><span id="l24.4">         let totalSpace = parseInt(window.getComputedStyle(this)</span>
<a href="#l24.5"></a><span id="l24.5">                                         .getPropertyValue(&quot;height&quot;));</span>
<a href="#l24.6"></a><span id="l24.6">         let textbox = this.editor;</span>
<a href="#l24.7"></a><span id="l24.7">         let textboxStyle = window.getComputedStyle(textbox);</span>
<a href="#l24.8"></a><span id="l24.8">         let lineHeight = parseInt(textboxStyle.getPropertyValue(&quot;line-height&quot;));</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10">         // Compute the overhead size.</span>
<a href="#l24.11"></a><span id="l24.11">         let textboxHeight = textbox.clientHeight;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-        let deckHeight = textbox.parentNode.boxObject.height;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+        let deckHeight = textbox.parentNode.getBoundingClientRect().height;</span>
<a href="#l24.14"></a><span id="l24.14">         this._TEXTBOX_VERTICAL_OVERHEAD = deckHeight - textboxHeight;</span>
<a href="#l24.15"></a><span id="l24.15"> </span>
<a href="#l24.16"></a><span id="l24.16">         // Calculate the number of lines to display.</span>
<a href="#l24.17"></a><span id="l24.17">         let numberOfLines =</span>
<a href="#l24.18"></a><span id="l24.18">           Math.round(totalSpace * this._TEXTBOX_RATIO / lineHeight);</span>
<a href="#l24.19"></a><span id="l24.19">         if (numberOfLines &lt;= 0)</span>
<a href="#l24.20"></a><span id="l24.20">           numberOfLines = 1;</span>
<a href="#l24.21"></a><span id="l24.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/test/mozmill/attachment/test-attachment.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/test/mozmill/attachment/test-attachment.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -189,17 +189,17 @@ function test_long_attachment_name() {</span>
<a href="#l25.4"></a><span id="l25.4">   be_in_folder(folder);</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">   select_click_row(4);</span>
<a href="#l25.7"></a><span id="l25.7">   assert_selected_and_displayed(4);</span>
<a href="#l25.8"></a><span id="l25.8"> </span>
<a href="#l25.9"></a><span id="l25.9">   let messagepaneBox = mc.e(&quot;messagepanebox&quot;);</span>
<a href="#l25.10"></a><span id="l25.10">   let attachmentBar = mc.e(&quot;attachmentBar&quot;);</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  assert_true(messagepaneBox.boxObject.width &gt;= attachmentBar.boxObject.width,</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  assert_true(messagepaneBox.getBoundingClientRect().width &gt;= attachmentBar.getBoundingClientRect().width,</span>
<a href="#l25.14"></a><span id="l25.14">               &quot;Attachment bar has expanded off the edge of the window!&quot;);</span>
<a href="#l25.15"></a><span id="l25.15"> }</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17"> /**</span>
<a href="#l25.18"></a><span id="l25.18">  * Make sure that, when opening attached messages, we only show the attachments</span>
<a href="#l25.19"></a><span id="l25.19">  * &quot;beneath&quot; the attached message (as opposed to all attachments for the root</span>
<a href="#l25.20"></a><span id="l25.20">  * message).</span>
<a href="#l25.21"></a><span id="l25.21">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-opening-messages.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-opening-messages.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -163,42 +163,42 @@ function test_open_message_in_existing_w</span>
<a href="#l26.4"></a><span id="l26.4"> }</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6"> /**</span>
<a href="#l26.7"></a><span id="l26.7">  * Check if the message pane in a new tab has the full height, so no</span>
<a href="#l26.8"></a><span id="l26.8">  * empty box is visible below it.</span>
<a href="#l26.9"></a><span id="l26.9">  */</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11"> function check_message_pane_in_tab_full_height() {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  let messagesBoxHeight = mc.e(&quot;messagesBox&quot;).boxObject.height;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  let displayDeckHeight = mc.e(&quot;displayDeck&quot;).boxObject.height;</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-  let messagePaneBoxWrapperHeight = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.height;</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-  let notificationBoxHeight = mc.e(&quot;msg-footer-notification-box&quot;).boxObject.height;</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+  let messagesBoxHeight = mc.e(&quot;messagesBox&quot;).getBoundingClientRect().height;</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+  let displayDeckHeight = mc.e(&quot;displayDeck&quot;).getBoundingClientRect().height;</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+  let messagePaneBoxWrapperHeight = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().height;</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+  let notificationBoxHeight = mc.e(&quot;msg-footer-notification-box&quot;).getBoundingClientRect().height;</span>
<a href="#l26.20"></a><span id="l26.20"> </span>
<a href="#l26.21"></a><span id="l26.21">   assert_equals(messagesBoxHeight, displayDeckHeight + messagePaneBoxWrapperHeight + notificationBoxHeight,</span>
<a href="#l26.22"></a><span id="l26.22">       &quot;messanges box height (&quot; + messagesBoxHeight +</span>
<a href="#l26.23"></a><span id="l26.23">       &quot;) not equal to the sum of displayDeck height (&quot; + displayDeckHeight +</span>
<a href="#l26.24"></a><span id="l26.24">       &quot;) and message pane box wrapper height (&quot; + messagePaneBoxWrapperHeight +</span>
<a href="#l26.25"></a><span id="l26.25">       &quot;) and message notification box height (&quot; + notificationBoxHeight +</span>
<a href="#l26.26"></a><span id="l26.26">       &quot;)&quot;);</span>
<a href="#l26.27"></a><span id="l26.27"> }</span>
<a href="#l26.28"></a><span id="l26.28"> </span>
<a href="#l26.29"></a><span id="l26.29"> /**</span>
<a href="#l26.30"></a><span id="l26.30">  * Check if the message pane in a new window has the full height, so no</span>
<a href="#l26.31"></a><span id="l26.31">  * empty box is visible below it.</span>
<a href="#l26.32"></a><span id="l26.32">  */</span>
<a href="#l26.33"></a><span id="l26.33"> </span>
<a href="#l26.34"></a><span id="l26.34"> function check_message_pane_in_window_full_height(aWC) {</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-  let messengerWindowHeight = aWC.e(&quot;messengerWindow&quot;).boxObject.height;</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+  let messengerWindowHeight = aWC.e(&quot;messengerWindow&quot;).getBoundingClientRect().height;</span>
<a href="#l26.37"></a><span id="l26.37">   let messengerChildren = aWC.e(&quot;messengerWindow&quot;).children;</span>
<a href="#l26.38"></a><span id="l26.38">   let childrenHeightsSum = 0;</span>
<a href="#l26.39"></a><span id="l26.39">   let childrenHeightsStr = &quot;&quot;;</span>
<a href="#l26.40"></a><span id="l26.40">   for (let child of messengerChildren) {</span>
<a href="#l26.41"></a><span id="l26.41">     if (&quot;boxObject&quot; in child) {</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-      childrenHeightsSum += child.boxObject.height;</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineminus">-      childrenHeightsStr += '&quot;' + child.id + '&quot;: ' + child.boxObject.height + ', ';</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+      childrenHeightsSum += child.getBoundingClientRect().height;</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineplus">+      childrenHeightsStr += '&quot;' + child.id + '&quot;: ' + child.getBoundingClientRect().height + ', ';</span>
<a href="#l26.46"></a><span id="l26.46">     }</span>
<a href="#l26.47"></a><span id="l26.47">   }</span>
<a href="#l26.48"></a><span id="l26.48"> </span>
<a href="#l26.49"></a><span id="l26.49">   assert_equals(messengerWindowHeight, childrenHeightsSum,</span>
<a href="#l26.50"></a><span id="l26.50">     &quot;messenger window height not equal to the sum of children heights: &quot; +</span>
<a href="#l26.51"></a><span id="l26.51">     childrenHeightsStr);</span>
<a href="#l26.52"></a><span id="l26.52"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/test/mozmill/session-store/test-session-store.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/test/mozmill/session-store/test-session-store.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -199,30 +199,30 @@ function test_message_pane_height_persis</span>
<a href="#l27.4"></a><span id="l27.4">   be_in_folder(folderA);</span>
<a href="#l27.5"></a><span id="l27.5">   assert_message_pane_visible();</span>
<a href="#l27.6"></a><span id="l27.6">   assert_pane_layout(kClassicMailLayout);</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8">   // Get the state object. This assumes there is one and only one</span>
<a href="#l27.9"></a><span id="l27.9">   // 3pane window.</span>
<a href="#l27.10"></a><span id="l27.10">   let mail3PaneWindow = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  let oldHeight = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.height;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  let oldHeight = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().height;</span>
<a href="#l27.14"></a><span id="l27.14">   let minHeight = Math.floor(mc.e(&quot;messagepaneboxwrapper&quot;).getAttribute(&quot;minheight&quot;));</span>
<a href="#l27.15"></a><span id="l27.15">   let newHeight = Math.floor((minHeight + oldHeight) / 2);</span>
<a href="#l27.16"></a><span id="l27.16">   let diffHeight = oldHeight - newHeight;</span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18">   assert_not_equals(oldHeight, newHeight,</span>
<a href="#l27.19"></a><span id="l27.19">     &quot;To really perform a test the new message pane height should be &quot; +</span>
<a href="#l27.20"></a><span id="l27.20">     &quot;should be different from the old one but they are the same: &quot; +</span>
<a href="#l27.21"></a><span id="l27.21">     newHeight);</span>
<a href="#l27.22"></a><span id="l27.22"> </span>
<a href="#l27.23"></a><span id="l27.23">   _move_splitter(mc.e(&quot;threadpane-splitter&quot;), 0, diffHeight);</span>
<a href="#l27.24"></a><span id="l27.24"> </span>
<a href="#l27.25"></a><span id="l27.25">   // Check that the moving of the threadpane-splitter resulted in the correct height.</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineminus">-  let actualHeight = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.height;</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineplus">+  let actualHeight = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().height;</span>
<a href="#l27.28"></a><span id="l27.28"> </span>
<a href="#l27.29"></a><span id="l27.29">   assert_equals(newHeight, actualHeight,</span>
<a href="#l27.30"></a><span id="l27.30">     &quot;The message pane height should be &quot; + newHeight + &quot;, but is actually &quot; +</span>
<a href="#l27.31"></a><span id="l27.31">     actualHeight + &quot;. The oldHeight was: &quot; + oldHeight);</span>
<a href="#l27.32"></a><span id="l27.32"> </span>
<a href="#l27.33"></a><span id="l27.33">   // Make sure we have a different window open, so that we don't start shutting</span>
<a href="#l27.34"></a><span id="l27.34">   // down just because the last window was closed.</span>
<a href="#l27.35"></a><span id="l27.35">   let abwc = openAddressBook();</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineat">@@ -231,17 +231,17 @@ function test_message_pane_height_persis</span>
<a href="#l27.37"></a><span id="l27.37">   close_window(new mozmill.controller.MozMillController(mail3PaneWindow));</span>
<a href="#l27.38"></a><span id="l27.38">   // Wait for window close async session write to finish.</span>
<a href="#l27.39"></a><span id="l27.39">   controller.sleep(asyncFileWriteDelayMS);</span>
<a href="#l27.40"></a><span id="l27.40"> </span>
<a href="#l27.41"></a><span id="l27.41">   mc = open3PaneWindow();</span>
<a href="#l27.42"></a><span id="l27.42">   be_in_folder(folderA);</span>
<a href="#l27.43"></a><span id="l27.43">   assert_message_pane_visible();</span>
<a href="#l27.44"></a><span id="l27.44"> </span>
<a href="#l27.45"></a><span id="l27.45" class="difflineminus">-  actualHeight = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.height;</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineplus">+  actualHeight = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().height;</span>
<a href="#l27.47"></a><span id="l27.47"> </span>
<a href="#l27.48"></a><span id="l27.48">   assert_equals(newHeight, actualHeight,</span>
<a href="#l27.49"></a><span id="l27.49">     &quot;The message pane height should be &quot; + newHeight + &quot;, but is actually &quot; +</span>
<a href="#l27.50"></a><span id="l27.50">     actualHeight + &quot;. The oldHeight was: &quot; + oldHeight);</span>
<a href="#l27.51"></a><span id="l27.51"> </span>
<a href="#l27.52"></a><span id="l27.52">   // The old height is restored.</span>
<a href="#l27.53"></a><span id="l27.53">   _move_splitter(mc.e(&quot;threadpane-splitter&quot;), 0, -diffHeight);</span>
<a href="#l27.54"></a><span id="l27.54"> </span>
<a href="#l27.55"></a><span id="l27.55" class="difflineat">@@ -249,17 +249,17 @@ function test_message_pane_height_persis</span>
<a href="#l27.56"></a><span id="l27.56">   close_window(mc);</span>
<a href="#l27.57"></a><span id="l27.57">   // Wait for window close async session write to finish.</span>
<a href="#l27.58"></a><span id="l27.58">   controller.sleep(asyncFileWriteDelayMS);</span>
<a href="#l27.59"></a><span id="l27.59"> </span>
<a href="#l27.60"></a><span id="l27.60">   mc = open3PaneWindow();</span>
<a href="#l27.61"></a><span id="l27.61">   be_in_folder(folderA);</span>
<a href="#l27.62"></a><span id="l27.62">   assert_message_pane_visible();</span>
<a href="#l27.63"></a><span id="l27.63"> </span>
<a href="#l27.64"></a><span id="l27.64" class="difflineminus">-  actualHeight = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.height;</span>
<a href="#l27.65"></a><span id="l27.65" class="difflineplus">+  actualHeight = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().height;</span>
<a href="#l27.66"></a><span id="l27.66">   assert_equals(oldHeight, actualHeight,</span>
<a href="#l27.67"></a><span id="l27.67">     &quot;The message pane height should be &quot; + oldHeight + &quot;, but is actually &quot; +</span>
<a href="#l27.68"></a><span id="l27.68">     actualHeight);</span>
<a href="#l27.69"></a><span id="l27.69"> </span>
<a href="#l27.70"></a><span id="l27.70">   // We don't need the address book window any more.</span>
<a href="#l27.71"></a><span id="l27.71">   plan_for_window_close(abwc);</span>
<a href="#l27.72"></a><span id="l27.72">   abwc.window.close();</span>
<a href="#l27.73"></a><span id="l27.73">   wait_for_window_close();</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineat">@@ -274,30 +274,30 @@ function test_message_pane_width_persist</span>
<a href="#l27.75"></a><span id="l27.75">   assert_pane_layout(kClassicMailLayout);</span>
<a href="#l27.76"></a><span id="l27.76">   set_pane_layout(kVerticalMailLayout);</span>
<a href="#l27.77"></a><span id="l27.77">   assert_pane_layout(kVerticalMailLayout);</span>
<a href="#l27.78"></a><span id="l27.78"> </span>
<a href="#l27.79"></a><span id="l27.79">   // Get the state object. This assumes there is one and only one</span>
<a href="#l27.80"></a><span id="l27.80">   // 3pane window.</span>
<a href="#l27.81"></a><span id="l27.81">   let mail3PaneWindow = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l27.82"></a><span id="l27.82"> </span>
<a href="#l27.83"></a><span id="l27.83" class="difflineminus">-  let oldWidth = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.width;</span>
<a href="#l27.84"></a><span id="l27.84" class="difflineplus">+  let oldWidth = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().width;</span>
<a href="#l27.85"></a><span id="l27.85">   let minWidth = Math.floor(mc.e(&quot;messagepaneboxwrapper&quot;).getAttribute(&quot;minwidth&quot;));</span>
<a href="#l27.86"></a><span id="l27.86">   let newWidth = Math.floor((minWidth + oldWidth) / 2);</span>
<a href="#l27.87"></a><span id="l27.87">   let diffWidth = oldWidth - newWidth;</span>
<a href="#l27.88"></a><span id="l27.88"> </span>
<a href="#l27.89"></a><span id="l27.89">   assert_not_equals(newWidth, oldWidth,</span>
<a href="#l27.90"></a><span id="l27.90">     &quot;To really perform a test the new message pane width should be &quot; +</span>
<a href="#l27.91"></a><span id="l27.91">     &quot;should be different from the old one but they are the same: &quot; + newWidth);</span>
<a href="#l27.92"></a><span id="l27.92"> </span>
<a href="#l27.93"></a><span id="l27.93">   // We move the threadpane-splitter and not the folderpane_splitter because</span>
<a href="#l27.94"></a><span id="l27.94">   // we are in vertical layout.</span>
<a href="#l27.95"></a><span id="l27.95">   _move_splitter(mc.e(&quot;threadpane-splitter&quot;), diffWidth, 0);</span>
<a href="#l27.96"></a><span id="l27.96">   // Check that the moving of the folderpane_splitter resulted in the correct width.</span>
<a href="#l27.97"></a><span id="l27.97" class="difflineminus">-  let actualWidth = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.width;</span>
<a href="#l27.98"></a><span id="l27.98" class="difflineplus">+  let actualWidth = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().width;</span>
<a href="#l27.99"></a><span id="l27.99"> </span>
<a href="#l27.100"></a><span id="l27.100">   // FIXME: For whatever reasons the new width is off by one pixel on Mac OSX</span>
<a href="#l27.101"></a><span id="l27.101">   // But this test case is not for testing moving around a splitter but for</span>
<a href="#l27.102"></a><span id="l27.102">   // persistency. Therefore it is enough if the actual width is equal to the</span>
<a href="#l27.103"></a><span id="l27.103">   // the requested width plus/minus one pixel.</span>
<a href="#l27.104"></a><span id="l27.104">   assert_equals_fuzzy(newWidth, actualWidth, 1,</span>
<a href="#l27.105"></a><span id="l27.105">     &quot;The message pane width should be &quot; + newWidth + &quot;, but is actually &quot; +</span>
<a href="#l27.106"></a><span id="l27.106">     actualWidth + &quot;. The oldWidth was: &quot; + oldWidth);</span>
<a href="#l27.107"></a><span id="l27.107" class="difflineat">@@ -312,23 +312,23 @@ function test_message_pane_width_persist</span>
<a href="#l27.108"></a><span id="l27.108">   // Wait for window close async session write to finish.</span>
<a href="#l27.109"></a><span id="l27.109">   controller.sleep(asyncFileWriteDelayMS);</span>
<a href="#l27.110"></a><span id="l27.110"> </span>
<a href="#l27.111"></a><span id="l27.111">   mc = open3PaneWindow();</span>
<a href="#l27.112"></a><span id="l27.112">   be_in_folder(folderA);</span>
<a href="#l27.113"></a><span id="l27.113">   assert_message_pane_visible();</span>
<a href="#l27.114"></a><span id="l27.114">   assert_pane_layout(kVerticalMailLayout);</span>
<a href="#l27.115"></a><span id="l27.115"> </span>
<a href="#l27.116"></a><span id="l27.116" class="difflineminus">-  actualWidth = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.width;</span>
<a href="#l27.117"></a><span id="l27.117" class="difflineplus">+  actualWidth = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().width;</span>
<a href="#l27.118"></a><span id="l27.118">   assert_equals(newWidth, actualWidth, &quot;The message pane width should be &quot; +</span>
<a href="#l27.119"></a><span id="l27.119">     newWidth + &quot;, but is actually &quot; + actualWidth);</span>
<a href="#l27.120"></a><span id="l27.120"> </span>
<a href="#l27.121"></a><span id="l27.121">   // The old width is restored.</span>
<a href="#l27.122"></a><span id="l27.122">   _move_splitter(mc.e(&quot;threadpane-splitter&quot;), -diffWidth, 0);</span>
<a href="#l27.123"></a><span id="l27.123" class="difflineminus">-  actualWidth = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.width;</span>
<a href="#l27.124"></a><span id="l27.124" class="difflineplus">+  actualWidth = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().width;</span>
<a href="#l27.125"></a><span id="l27.125"> </span>
<a href="#l27.126"></a><span id="l27.126">   // FIXME: For whatever reasons the new width is off by two pixels on Mac OSX</span>
<a href="#l27.127"></a><span id="l27.127">   // But this test case is not for testing moving around a splitter but for</span>
<a href="#l27.128"></a><span id="l27.128">   // persistency. Therefore it is enough if the actual width is equal to the</span>
<a href="#l27.129"></a><span id="l27.129">   // the requested width plus/minus two pixels.</span>
<a href="#l27.130"></a><span id="l27.130">   assert_equals_fuzzy(oldWidth, actualWidth, 2,</span>
<a href="#l27.131"></a><span id="l27.131">     &quot;The message pane width should be &quot; + oldWidth + &quot;, but is actually &quot; +</span>
<a href="#l27.132"></a><span id="l27.132">     actualWidth);</span>
<a href="#l27.133"></a><span id="l27.133" class="difflineat">@@ -339,17 +339,17 @@ function test_message_pane_width_persist</span>
<a href="#l27.134"></a><span id="l27.134">   // Wait for window close async session write to finish.</span>
<a href="#l27.135"></a><span id="l27.135">   controller.sleep(asyncFileWriteDelayMS);</span>
<a href="#l27.136"></a><span id="l27.136"> </span>
<a href="#l27.137"></a><span id="l27.137">   mc = open3PaneWindow();</span>
<a href="#l27.138"></a><span id="l27.138">   be_in_folder(folderA);</span>
<a href="#l27.139"></a><span id="l27.139">   assert_message_pane_visible();</span>
<a href="#l27.140"></a><span id="l27.140">   assert_pane_layout(kVerticalMailLayout);</span>
<a href="#l27.141"></a><span id="l27.141"> </span>
<a href="#l27.142"></a><span id="l27.142" class="difflineminus">-  actualWidth = mc.e(&quot;messagepaneboxwrapper&quot;).boxObject.width;</span>
<a href="#l27.143"></a><span id="l27.143" class="difflineplus">+  actualWidth = mc.e(&quot;messagepaneboxwrapper&quot;).getBoundingClientRect().width;</span>
<a href="#l27.144"></a><span id="l27.144">   assert_equals(oldWidth, actualWidth, &quot;The message pane width should be &quot; +</span>
<a href="#l27.145"></a><span id="l27.145">     oldWidth + &quot;, but is actually &quot; + actualWidth);</span>
<a href="#l27.146"></a><span id="l27.146"> </span>
<a href="#l27.147"></a><span id="l27.147">   // The layout is reset to classical mail layout.</span>
<a href="#l27.148"></a><span id="l27.148">   set_pane_layout(kClassicMailLayout);</span>
<a href="#l27.149"></a><span id="l27.149">   assert_pane_layout(kClassicMailLayout);</span>
<a href="#l27.150"></a><span id="l27.150"> </span>
<a href="#l27.151"></a><span id="l27.151">   // We don't need the address book window any more.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1091,28 +1091,28 @@ function select_shift_click_row(aViewInd</span>
<a href="#l28.4"></a><span id="l28.4">  * Helper function to click on a row with a given button.</span>
<a href="#l28.5"></a><span id="l28.5">  */</span>
<a href="#l28.6"></a><span id="l28.6"> function _row_click_helper(aController, aTree, aViewIndex, aButton, aExtra) {</span>
<a href="#l28.7"></a><span id="l28.7">   // Force-focus the tree</span>
<a href="#l28.8"></a><span id="l28.8">   aTree.focus();</span>
<a href="#l28.9"></a><span id="l28.9">   // very important, gotta be able to see the row</span>
<a href="#l28.10"></a><span id="l28.10">   aTree.ensureRowIsVisible(aViewIndex);</span>
<a href="#l28.11"></a><span id="l28.11">   // coordinates of the upper left of the entire tree widget (headers included)</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  let tx = aTree.boxObject.x, ty = aTree.boxObject.y;</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  let tx = aTree.getBoundingClientRect().x, ty = aTree.getBoundingClientRect().y;</span>
<a href="#l28.14"></a><span id="l28.14">   // coordinates of the row display region of the tree (below the headers)</span>
<a href="#l28.15"></a><span id="l28.15">   let children = aController.e(aTree.id, {tagName: &quot;treechildren&quot;});</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">-  let x = children.boxObject.x, y = children.boxObject.y;</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineplus">+  let x = children.getBoundingClientRect().x, y = children.getBoundingClientRect().y;</span>
<a href="#l28.18"></a><span id="l28.18">   // Click in the middle of the row by default</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineminus">-  let rowX = children.boxObject.width / 2;</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+  let rowX = children.getBoundingClientRect().width / 2;</span>
<a href="#l28.21"></a><span id="l28.21">   // For the thread tree, Position our click on the subject column (which cannot</span>
<a href="#l28.22"></a><span id="l28.22">   // be hidden), and far enough in that we are in no danger of clicking the</span>
<a href="#l28.23"></a><span id="l28.23">   // expand toggler unless that is explicitly requested.</span>
<a href="#l28.24"></a><span id="l28.24">   if (aTree.id == &quot;threadTree&quot;) {</span>
<a href="#l28.25"></a><span id="l28.25">     let subjectCol = aController.e(&quot;subjectCol&quot;);</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-    rowX = subjectCol.boxObject.x - tx + 8;</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineplus">+    rowX = subjectCol.getBoundingClientRect().x - tx + 8;</span>
<a href="#l28.28"></a><span id="l28.28">     // click on the toggle if so requested</span>
<a href="#l28.29"></a><span id="l28.29">     if (aExtra !== &quot;toggle&quot;)</span>
<a href="#l28.30"></a><span id="l28.30">       rowX += 32;</span>
<a href="#l28.31"></a><span id="l28.31">   }</span>
<a href="#l28.32"></a><span id="l28.32">   let rowY = aTree.rowHeight * (aViewIndex - aTree.getFirstVisibleRow()) +</span>
<a href="#l28.33"></a><span id="l28.33">     aTree.rowHeight / 2;</span>
<a href="#l28.34"></a><span id="l28.34">   if (aTree.getRowAt(x + rowX, y + rowY) != aViewIndex) {</span>
<a href="#l28.35"></a><span id="l28.35">     throw new Error(&quot;Thought we would find row &quot; + aViewIndex + &quot; at &quot; +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-mouse-event-helpers.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-mouse-event-helpers.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -51,20 +51,20 @@ function drag_n_drop_element(aDragObject</span>
<a href="#l29.4"></a><span id="l29.4">                              aDropWindow, aRelDropX, aRelDropY, aListener)</span>
<a href="#l29.5"></a><span id="l29.5"> {</span>
<a href="#l29.6"></a><span id="l29.6">   let dt = synthesize_drag_start(aDragWindow, aDragObject, aListener);</span>
<a href="#l29.7"></a><span id="l29.7">   fdh.assert_true(dt, &quot;Drag target was undefined&quot;);</span>
<a href="#l29.8"></a><span id="l29.8"> </span>
<a href="#l29.9"></a><span id="l29.9">   synthesize_drag_over(aDropWindow, aDropObject, dt);</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11">   synthesize_drop(aDropWindow, aDropObject, dt,</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-      { screenX : aDropObject.boxObject.screenX +</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-                    (aDropObject.boxObject.width * aRelDropX),</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-        screenY : aDropObject.boxObject.screenY +</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-                    (aDropObject.boxObject.width * aRelDropY)</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+      { screenX : aDropObject.screenX +</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineplus">+                    (aDropObject.getBoundingClientRect().width * aRelDropX),</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+        screenY : aDropObject.screenY +</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+                    (aDropObject.getBoundingClientRect().width * aRelDropY)</span>
<a href="#l29.20"></a><span id="l29.20">       });</span>
<a href="#l29.21"></a><span id="l29.21"> }</span>
<a href="#l29.22"></a><span id="l29.22"> </span>
<a href="#l29.23"></a><span id="l29.23"> /**</span>
<a href="#l29.24"></a><span id="l29.24">  * Starts a drag new session.</span>
<a href="#l29.25"></a><span id="l29.25">  * @param {} aWindow</span>
<a href="#l29.26"></a><span id="l29.26">  * @param {XULElement} aDispatcher</span>
<a href="#l29.27"></a><span id="l29.27">  *   the element from which the drag session should be started.</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineat">@@ -166,21 +166,21 @@ function synthesize_drop(aWindow, aDispa</span>
<a href="#l29.29"></a><span id="l29.29">  *   arguments passed to the mouse event.</span>
<a href="#l29.30"></a><span id="l29.30">  */</span>
<a href="#l29.31"></a><span id="l29.31"> function _synthesizeDragEvent(aType, aWindow, aDispatcher, aDt, aArgs)</span>
<a href="#l29.32"></a><span id="l29.32"> {</span>
<a href="#l29.33"></a><span id="l29.33">   let screenX;</span>
<a href="#l29.34"></a><span id="l29.34">   if (aArgs &amp;&amp; (&quot;screenX&quot; in aArgs))</span>
<a href="#l29.35"></a><span id="l29.35">     screenX = aArgs.screenX;</span>
<a href="#l29.36"></a><span id="l29.36">   else</span>
<a href="#l29.37"></a><span id="l29.37" class="difflineminus">-    screenX = aDispatcher.boxObject.ScreenX;</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineplus">+    screenX = aDispatcher.ScreenX;</span>
<a href="#l29.39"></a><span id="l29.39"> </span>
<a href="#l29.40"></a><span id="l29.40">   let screenY;</span>
<a href="#l29.41"></a><span id="l29.41">   if (aArgs &amp;&amp; (&quot;screenY&quot; in aArgs))</span>
<a href="#l29.42"></a><span id="l29.42">     screenY = aArgs.screenY;</span>
<a href="#l29.43"></a><span id="l29.43">   else</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineminus">-    screenY = aDispatcher.boxObject.ScreenY;</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineplus">+    screenY = aDispatcher.ScreenY;</span>
<a href="#l29.46"></a><span id="l29.46"> </span>
<a href="#l29.47"></a><span id="l29.47">   let event = aWindow.document.createEvent(&quot;DragEvent&quot;);</span>
<a href="#l29.48"></a><span id="l29.48">   event.initDragEvent(aType, true, true, aWindow, 0,</span>
<a href="#l29.49"></a><span id="l29.49">       screenX, screenY, 0, 0, false, false, false, false, 0, null, aDt);</span>
<a href="#l29.50"></a><span id="l29.50">   aDispatcher.dispatchEvent(event);</span>
<a href="#l29.51"></a><span id="l29.51"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -72,17 +72,17 @@ var nameToBarDomId = {</span>
<a href="#l30.4"></a><span id="l30.4"> function assert_quick_filter_button_enabled(aEnabled) {</span>
<a href="#l30.5"></a><span id="l30.5">   if (mc.e(&quot;qfb-show-filter-bar&quot;).disabled == aEnabled) {</span>
<a href="#l30.6"></a><span id="l30.6">     throw new Error(&quot;Quick filter bar button should be &quot; +</span>
<a href="#l30.7"></a><span id="l30.7">                     (aEnabled ? &quot;enabled&quot; : &quot;disabled&quot;));</span>
<a href="#l30.8"></a><span id="l30.8">   }</span>
<a href="#l30.9"></a><span id="l30.9"> }</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11"> function assert_quick_filter_bar_visible(aVisible) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  if ((mc.e(&quot;quick-filter-bar&quot;).boxObject.height &gt; 0) != aVisible) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+  if ((mc.e(&quot;quick-filter-bar&quot;).getBoundingClientRect().height &gt; 0) != aVisible) {</span>
<a href="#l30.14"></a><span id="l30.14">     throw new Error(&quot;Quick filter bar should be &quot; +</span>
<a href="#l30.15"></a><span id="l30.15">                     (aVisible ? &quot;visible&quot; : &quot;collapsed&quot;));</span>
<a href="#l30.16"></a><span id="l30.16">   }</span>
<a href="#l30.17"></a><span id="l30.17"> }</span>
<a href="#l30.18"></a><span id="l30.18"> </span>
<a href="#l30.19"></a><span id="l30.19"> /**</span>
<a href="#l30.20"></a><span id="l30.20">  * Toggle the state of the message filter bar as if by a mouse click.</span>
<a href="#l30.21"></a><span id="l30.21">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -223,26 +223,25 @@ function test_tab_reorder_detach(){</span>
<a href="#l31.4"></a><span id="l31.4">   plan_for_new_window(&quot;mail:3pane&quot;);</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6">   // ... now start dragging</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8">   mc.tabmail.switchToTab(1);</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10">   let tab1 = mc.tabmail.tabContainer.childNodes[1];</span>
<a href="#l31.11"></a><span id="l31.11">   let dropContent = mc.e(&quot;tabpanelcontainer&quot;);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  let box = dropContent.boxObject;</span>
<a href="#l31.13"></a><span id="l31.13"> </span>
<a href="#l31.14"></a><span id="l31.14">   let dt = synthesize_drag_start(mc.window, tab1, mc.tabmail.tabContainer);</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16">   synthesize_drag_over(mc.window, dropContent, dt);</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18">   // notify tab1 drag has ended</span>
<a href="#l31.19"></a><span id="l31.19">   synthesize_drag_end(mc.window, dropContent, tab1, dt,</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineminus">-      { screenX : (box.screenX + box.width / 2 ),</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineminus">-        screenY : (box.screenY + box.height / 2 ) });</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineplus">+      { screenX : (dropContent.screenX + dropContent.getBoundingClientRect().width / 2 ),</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineplus">+        screenY : (dropContent.screenY + dropContent.getBoundingClientRect().height / 2 ) });</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25">   // ... and wait for the new window</span>
<a href="#l31.26"></a><span id="l31.26">   mc2 = wait_for_new_window(&quot;mail:3pane&quot;);</span>
<a href="#l31.27"></a><span id="l31.27">   wait_for_message_display_completion(mc2, true);</span>
<a href="#l31.28"></a><span id="l31.28"> </span>
<a href="#l31.29"></a><span id="l31.29">   assert_true(mc.tabmail.tabContainer.childNodes.length == 1,</span>
<a href="#l31.30"></a><span id="l31.30">       &quot;Moving tab to new window failed, tab still in old window&quot;);</span>
<a href="#l31.31"></a><span id="l31.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/modules/events.jsm</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/modules/events.jsm</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -148,18 +148,18 @@ var triggerKeyEvent = function(element, </span>
<a href="#l32.4"></a><span id="l32.4"> </span>
<a href="#l32.5"></a><span id="l32.5"> /* Fire a mouse event in a browser-compatible manner */</span>
<a href="#l32.6"></a><span id="l32.6"> var triggerMouseEvent = function(element, eventType, canBubble, clientX, clientY, controlKeyDown, altKeyDown, shiftKeyDown, metaKeyDown) {</span>
<a href="#l32.7"></a><span id="l32.7">   clientX = clientX ? clientX : 0;</span>
<a href="#l32.8"></a><span id="l32.8">   clientY = clientY ? clientY : 0;</span>
<a href="#l32.9"></a><span id="l32.9"> </span>
<a href="#l32.10"></a><span id="l32.10">   // Fixing this - make the mouse understand where it is on the screen, needed</span>
<a href="#l32.11"></a><span id="l32.11">   // for double click.</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  var screenX = element.boxObject.screenX ? element.boxObject.screenX : 0;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-  var screenY = element.boxObject.screenY ? element.boxObject.screenY : 0;</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+  var screenX = element.screenX ? element.screenX : 0;</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+  var screenY = element.screenY ? element.screenY : 0;</span>
<a href="#l32.16"></a><span id="l32.16"> </span>
<a href="#l32.17"></a><span id="l32.17">   canBubble = (typeof(canBubble) == undefined) ? true : canBubble;</span>
<a href="#l32.18"></a><span id="l32.18"> </span>
<a href="#l32.19"></a><span id="l32.19">   var evt = element.ownerGlobal.document.createEvent(&quot;MouseEvents&quot;);</span>
<a href="#l32.20"></a><span id="l32.20">   if (evt.initMouseEvent) {</span>
<a href="#l32.21"></a><span id="l32.21">     // LOG.info(&quot;element has initMouseEvent&quot;);</span>
<a href="#l32.22"></a><span id="l32.22">     // Safari</span>
<a href="#l32.23"></a><span id="l32.23">     evt.initMouseEvent(eventType, canBubble, true, element.ownerGlobal, 1, screenX, screenY, clientX, clientY, controlKeyDown, altKeyDown, shiftKeyDown, metaKeyDown, 0, null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/db/gloda/content/autocomplete-richlistitem.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/db/gloda/content/autocomplete-richlistitem.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -149,21 +149,21 @@</span>
<a href="#l33.4"></a><span id="l33.4"> </span>
<a href="#l33.5"></a><span id="l33.5">     _setUpOverflow(aParentBox, aEllipsis) {</span>
<a href="#l33.6"></a><span id="l33.6">       // Hide the ellipsis in case there's just enough to not underflow.</span>
<a href="#l33.7"></a><span id="l33.7">       aEllipsis.hidden = true;</span>
<a href="#l33.8"></a><span id="l33.8"> </span>
<a href="#l33.9"></a><span id="l33.9">       // Start with the parent's width and subtract off its children.</span>
<a href="#l33.10"></a><span id="l33.10">       let tooltip = [];</span>
<a href="#l33.11"></a><span id="l33.11">       let children = aParentBox.childNodes;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-      let widthDiff = aParentBox.boxObject.width;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+      let widthDiff = aParentBox.getBoundingClientRect().width;</span>
<a href="#l33.14"></a><span id="l33.14"> </span>
<a href="#l33.15"></a><span id="l33.15">       for (let i = 0; i &lt; children.length; i++) {</span>
<a href="#l33.16"></a><span id="l33.16">         // Only consider a child if it actually takes up space.</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineminus">-        let childWidth = children[i].boxObject.width;</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineplus">+        let childWidth = children[i].getBoundingClientRect().width;</span>
<a href="#l33.19"></a><span id="l33.19">         if (childWidth &gt; 0) {</span>
<a href="#l33.20"></a><span id="l33.20">           // Subtract a little less to account for subpixel rounding.</span>
<a href="#l33.21"></a><span id="l33.21">           widthDiff -= childWidth - .5;</span>
<a href="#l33.22"></a><span id="l33.22"> </span>
<a href="#l33.23"></a><span id="l33.23">           // Add to the tooltip if it's not hidden and has text.</span>
<a href="#l33.24"></a><span id="l33.24">           let childText = children[i].textContent;</span>
<a href="#l33.25"></a><span id="l33.25">           if (childText) {</span>
<a href="#l33.26"></a><span id="l33.26">             tooltip.push(childText);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

