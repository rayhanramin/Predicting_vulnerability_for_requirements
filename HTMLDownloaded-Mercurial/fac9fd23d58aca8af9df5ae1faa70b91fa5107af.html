<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26978:fac9fd23d58aca8af9df5ae1faa70b91fa5107af</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ fac9fd23d58aca8af9df5ae1faa70b91fa5107af" />
<meta property="og:url" content="/comm-central/rev/fac9fd23d58aca8af9df5ae1faa70b91fa5107af" />
<meta property="og:description" content="Bug 1096006 - Backout of AM in pref tab. a=backout" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / fac9fd23d58aca8af9df5ae1faa70b91fa5107af 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/fac9fd23d58aca8af9df5ae1faa70b91fa5107af">shortlog</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/fac9fd23d58aca8af9df5ae1faa70b91fa5107af">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af">files</a> |
changeset |
<a href="/comm-central/raw-rev/fac9fd23d58aca8af9df5ae1faa70b91fa5107af">raw</a>  | <a href="/comm-central/archive/fac9fd23d58aca8af9df5ae1faa70b91fa5107af.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1096006">Bug 1096006</a> - Backout of AM in pref tab. a=backout
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 24 Jun 2019 22:27:34 +0200</td></tr>

<tr>
 <td>changeset 26978</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/fac9fd23d58aca8af9df5ae1faa70b91fa5107af">fac9fd23d58aca8af9df5ae1faa70b91fa5107af</a></td>
</tr>



<tr>
<td>parent 26977</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0b01d4da30db1a135350792847dbf2f218f97813">0b01d4da30db1a135350792847dbf2f218f97813</a>
</td>
</tr>

<tr>
<td>child 26979</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cf23f4f4e5abfd5d3a97382cb76754e767553bdd">cf23f4f4e5abfd5d3a97382cb76754e767553bdd</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=fac9fd23d58aca8af9df5ae1faa70b91fa5107af">16094</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 24 Jun 2019 20:29:07 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@fac9fd23d58a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=fac9fd23d58aca8af9df5ae1faa70b91fa5107af">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=fac9fd23d58aca8af9df5ae1faa70b91fa5107af&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fac9fd23d58aca8af9df5ae1faa70b91fa5107af&newProject=comm-central&newRevision=a920efa6f8206b5ce2962e110552cf55c624b106&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fac9fd23d58aca8af9df5ae1faa70b91fa5107af&newProject=comm-central&newRevision=a920efa6f8206b5ce2962e110552cf55c624b106&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fac9fd23d58aca8af9df5ae1faa70b91fa5107af&newProject=comm-central&newRevision=a920efa6f8206b5ce2962e110552cf55c624b106&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28backout%29&revcount=50">backout</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1096006">1096006</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1096006">Bug 1096006</a> - Backout of AM in pref tab. a=backout</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.js">mail/components/accountcreation/content/emailWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.xul">mail/components/accountcreation/content/emailWizard.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/accountcreation/content/emailWizard.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/am-im.xul">mail/components/im/content/am-im.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/am-im.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/am-im.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/am-im.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/am-im.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/am-im.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.js">mail/components/im/content/imAccounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.xul">mail/components/im/content/imAccounts.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/im/content/imAccounts.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.js">mail/components/newmailaccount/content/accountProvisioner.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.xhtml">mail/components/newmailaccount/content/accountProvisioner.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.xhtml">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.xhtml">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.xhtml">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.xhtml">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/newmailaccount/content/accountProvisioner.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/aboutPreferences.xul">mail/components/preferences/aboutPreferences.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/aboutPreferences.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/aboutPreferences.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/aboutPreferences.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/aboutPreferences.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/aboutPreferences.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/accounts.inc.xul">mail/components/preferences/accounts.inc.xul</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/accounts.inc.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/accounts.inc.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/accounts.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/accounts.js">mail/components/preferences/accounts.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/accounts.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/accounts.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/accounts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/advanced.inc.xul">mail/components/preferences/advanced.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/advanced.inc.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/advanced.inc.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/advanced.inc.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/advanced.inc.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/advanced.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/doctype.inc.xul">mail/components/preferences/doctype.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/doctype.inc.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/doctype.inc.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/doctype.inc.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/doctype.inc.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/doctype.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/jar.mn">mail/components/preferences/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/jar.mn">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/jar.mn">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/jar.mn">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/jar.mn">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferences.js">mail/components/preferences/preferences.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferences.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferences.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferences.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferences.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferences.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferencesTab.js">mail/components/preferences/preferencesTab.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferencesTab.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferencesTab.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferencesTab.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferencesTab.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/components/preferences/preferencesTab.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/AccountManager.dtd">mail/locales/en-US/chrome/messenger/AccountManager.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/AccountManager.dtd">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/AccountManager.dtd">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/AccountManager.dtd">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/AccountManager.dtd">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/AccountManager.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd">mail/locales/en-US/chrome/messenger/preferences/preferences.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-ab-whitelist.js">mail/test/mozmill/account/test-ab-whitelist.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-ab-whitelist.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-ab-whitelist.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-ab-whitelist.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-ab-whitelist.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-ab-whitelist.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-actions.js">mail/test/mozmill/account/test-account-actions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-actions.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-actions.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-actions.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-actions.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-actions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-deletion.js">mail/test/mozmill/account/test-account-deletion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-deletion.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-deletion.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-deletion.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-deletion.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-deletion.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-port-setting.js">mail/test/mozmill/account/test-account-port-setting.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-port-setting.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-port-setting.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-port-setting.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-port-setting.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-port-setting.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-settings-infrastructure.js">mail/test/mozmill/account/test-account-settings-infrastructure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-settings-infrastructure.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-settings-infrastructure.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-settings-infrastructure.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-settings-infrastructure.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-settings-infrastructure.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-tree.js">mail/test/mozmill/account/test-account-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-tree.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-tree.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-tree.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-tree.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-tree.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-values.js">mail/test/mozmill/account/test-account-values.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-values.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-values.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-values.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-values.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-account-values.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-archive-options.js">mail/test/mozmill/account/test-archive-options.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-archive-options.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-archive-options.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-archive-options.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-archive-options.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-archive-options.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-mail-account-setup-wizard.js">mail/test/mozmill/account/test-mail-account-setup-wizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-mail-account-setup-wizard.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-mail-account-setup-wizard.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-mail-account-setup-wizard.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-mail-account-setup-wizard.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-mail-account-setup-wizard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-retest-config.js">mail/test/mozmill/account/test-retest-config.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-retest-config.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-retest-config.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-retest-config.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-retest-config.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/account/test-retest-config.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">mail/test/mozmill/shared-modules/test-account-manager-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">mail/test/mozmill/shared-modules/test-pref-window-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/accountManage.css">mail/themes/linux/mail/accountManage.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/accountManage.css">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/accountManage.css">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/accountManage.css">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/accountManage.css">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/accountManage.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/preferences/aboutPreferences.css">mail/themes/linux/mail/preferences/aboutPreferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/preferences/aboutPreferences.css">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/preferences/aboutPreferences.css">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/preferences/aboutPreferences.css">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/preferences/aboutPreferences.css">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/linux/mail/preferences/aboutPreferences.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/accountManage.css">mail/themes/osx/mail/accountManage.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/accountManage.css">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/accountManage.css">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/accountManage.css">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/accountManage.css">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/accountManage.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/preferences/aboutPreferences.css">mail/themes/osx/mail/preferences/aboutPreferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/preferences/aboutPreferences.css">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/preferences/aboutPreferences.css">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/preferences/aboutPreferences.css">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/preferences/aboutPreferences.css">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/osx/mail/preferences/aboutPreferences.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">mail/themes/shared/mail/incontentprefs/aboutPreferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/accountManage.css">mail/themes/windows/mail/accountManage.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/accountManage.css">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/accountManage.css">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/accountManage.css">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/accountManage.css">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/accountManage.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/messenger.css">mail/themes/windows/mail/messenger.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/messenger.css">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/messenger.css">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/messenger.css">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/messenger.css">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mail/themes/windows/mail/messenger.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.js">mailnews/base/prefs/content/AccountManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.xul">mailnews/base/prefs/content/AccountManager.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountManager.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountWizard.js">mailnews/base/prefs/content/AccountWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountWizard.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountWizard.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountWizard.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountWizard.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/AccountWizard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/SmtpServerEdit.xul">mailnews/base/prefs/content/SmtpServerEdit.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/SmtpServerEdit.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/SmtpServerEdit.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/SmtpServerEdit.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/SmtpServerEdit.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/SmtpServerEdit.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/accountUtils.js">mailnews/base/prefs/content/accountUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/accountUtils.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/accountUtils.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/accountUtils.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/accountUtils.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/accountUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-addressing.xul">mailnews/base/prefs/content/am-addressing.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-addressing.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-addressing.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-addressing.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-addressing.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-addressing.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-archiveoptions.xul">mailnews/base/prefs/content/am-archiveoptions.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-archiveoptions.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-archiveoptions.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-archiveoptions.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-archiveoptions.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-archiveoptions.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-copies.xul">mailnews/base/prefs/content/am-copies.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-copies.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-copies.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-copies.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-copies.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-copies.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.js">mailnews/base/prefs/content/am-identities-list.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.xul">mailnews/base/prefs/content/am-identities-list.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identities-list.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.js">mailnews/base/prefs/content/am-identity-edit.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.xul">mailnews/base/prefs/content/am-identity-edit.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-identity-edit.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-junk.xul">mailnews/base/prefs/content/am-junk.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-junk.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-junk.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-junk.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-junk.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-junk.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.js">mailnews/base/prefs/content/am-main.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.xul">mailnews/base/prefs/content/am-main.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-main.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.js">mailnews/base/prefs/content/am-offline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.xul">mailnews/base/prefs/content/am-offline.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-offline.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server-advanced.xul">mailnews/base/prefs/content/am-server-advanced.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server-advanced.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server-advanced.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server-advanced.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server-advanced.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server-advanced.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.js">mailnews/base/prefs/content/am-server.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.xul">mailnews/base/prefs/content/am-server.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-server.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.js">mailnews/base/prefs/content/am-serverwithnoidentities.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.js">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.js">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.js">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.js">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.xul">mailnews/base/prefs/content/am-serverwithnoidentities.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-serverwithnoidentities.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-smtp.xul">mailnews/base/prefs/content/am-smtp.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-smtp.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-smtp.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-smtp.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-smtp.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/base/prefs/content/am-smtp.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/mdn/content/am-mdn.xul">mailnews/extensions/mdn/content/am-mdn.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/mdn/content/am-mdn.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/mdn/content/am-mdn.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/mdn/content/am-mdn.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/mdn/content/am-mdn.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/mdn/content/am-mdn.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/newsblog/content/am-newsblog.xul">mailnews/extensions/newsblog/content/am-newsblog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/newsblog/content/am-newsblog.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/newsblog/content/am-newsblog.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/newsblog/content/am-newsblog.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/newsblog/content/am-newsblog.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/newsblog/content/am-newsblog.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/smime/content/am-smime.inc.xul">mailnews/extensions/smime/content/am-smime.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/smime/content/am-smime.inc.xul">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/smime/content/am-smime.inc.xul">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/smime/content/am-smime.inc.xul">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/smime/content/am-smime.inc.xul">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/extensions/smime/content/am-smime.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/jar.mn">mailnews/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/jar.mn">file</a> |
<a href="/comm-central/annotate/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/jar.mn">annotate</a> |
<a href="/comm-central/diff/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/jar.mn">diff</a> |
<a href="/comm-central/comparison/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/jar.mn">comparison</a> |
<a href="/comm-central/log/fac9fd23d58aca8af9df5ae1faa70b91fa5107af/mailnews/jar.mn">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/accountcreation/content/emailWizard.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/accountcreation/content/emailWizard.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1549,17 +1549,26 @@ EmailConfigWizard.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">       alertPrompt(gStringsBundle.getString(&quot;error_creating_account&quot;),</span>
<a href="#l1.5"></a><span id="l1.5">                   gStringsBundle.getString(&quot;incoming_server_exists&quot;));</span>
<a href="#l1.6"></a><span id="l1.6">       return;</span>
<a href="#l1.7"></a><span id="l1.7">     }</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     gEmailWizardLogger.info(&quot;creating account in backend&quot;);</span>
<a href="#l1.10"></a><span id="l1.10">     let newAccount = createAccountInBackend(configFilledIn);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    MsgAccountManager(&quot;am-server.xul&quot;, newAccount.incomingServer);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    let existingAccountManager = Services.wm</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+        .getMostRecentWindow(&quot;mailnews:accountmanager&quot;);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    if (existingAccountManager) {</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+      existingAccountManager.focus();</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+    } else {</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+      window.openDialog(&quot;chrome://messenger/content/AccountManager.xul&quot;,</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+                        &quot;AccountManager&quot;, &quot;chrome,centerscreen,modal,titlebar&quot;,</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+                        { server: newAccount.incomingServer,</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+                          selectPage: &quot;am-server.xul&quot; });</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+    }</span>
<a href="#l1.23"></a><span id="l1.23">     window.close();</span>
<a href="#l1.24"></a><span id="l1.24">   },</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   /**</span>
<a href="#l1.27"></a><span id="l1.27">    * [Re-test] button click handler.</span>
<a href="#l1.28"></a><span id="l1.28">    * Restarts the config guessing process after a person editing the server</span>
<a href="#l1.29"></a><span id="l1.29">    * fields.</span>
<a href="#l1.30"></a><span id="l1.30">    * It's called &quot;half-manual&quot;, because we take the user-entered values</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/accountcreation/content/emailWizard.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/accountcreation/content/emailWizard.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -40,18 +40,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">   &lt;script src=&quot;chrome://messenger/content/accountcreation/fetchhttp.js&quot;/&gt;</span>
<a href="#l2.5"></a><span id="l2.5">   &lt;script src=&quot;chrome://messenger/content/accountcreation/readFromXML.js&quot;/&gt;</span>
<a href="#l2.6"></a><span id="l2.6">   &lt;script src=&quot;chrome://messenger/content/accountcreation/guessConfig.js&quot;/&gt;</span>
<a href="#l2.7"></a><span id="l2.7">   &lt;script src=&quot;chrome://messenger/content/accountcreation/verifyConfig.js&quot;/&gt;</span>
<a href="#l2.8"></a><span id="l2.8">   &lt;script src=&quot;chrome://messenger/content/accountcreation/fetchConfig.js&quot;/&gt;</span>
<a href="#l2.9"></a><span id="l2.9">   &lt;script src=&quot;chrome://messenger/content/accountcreation/exchangeAutoDiscover.js&quot;/&gt;</span>
<a href="#l2.10"></a><span id="l2.10">   &lt;script src=&quot;chrome://messenger/content/accountcreation/createInBackend.js&quot;/&gt;</span>
<a href="#l2.11"></a><span id="l2.11">   &lt;script src=&quot;chrome://messenger/content/accountcreation/MyBadCertHandler.js&quot;/&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  &lt;script src=&quot;chrome://communicator/content/utilityOverlay.js&quot;/&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/accountUtils.js&quot; /&gt;</span>
<a href="#l2.15"></a><span id="l2.15">   &lt;script src=&quot;chrome://messenger/content/customElements.js&quot;/&gt;</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17">   &lt;keyset id=&quot;mailKeys&quot;&gt;</span>
<a href="#l2.18"></a><span id="l2.18">     &lt;key keycode=&quot;VK_ESCAPE&quot; oncommand=&quot;window.close();&quot;/&gt;</span>
<a href="#l2.19"></a><span id="l2.19">   &lt;/keyset&gt;</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">   &lt;panel id=&quot;insecureserver-cleartext-panel&quot; class=&quot;popup-panel&quot;&gt;</span>
<a href="#l2.22"></a><span id="l2.22">     &lt;hbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/im/content/am-im.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/im/content/am-im.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,15 +1,13 @@</span>
<a href="#l3.4"></a><span id="l3.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l3.5"></a><span id="l3.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l3.12"></a><span id="l3.12"> </span>
<a href="#l3.13"></a><span id="l3.13"> &lt;!DOCTYPE window [</span>
<a href="#l3.14"></a><span id="l3.14">   &lt;!ENTITY % imDTD SYSTEM &quot;chrome://messenger/locale/am-im.dtd&quot;&gt;</span>
<a href="#l3.15"></a><span id="l3.15">   &lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot;&gt;</span>
<a href="#l3.16"></a><span id="l3.16">   %imDTD;</span>
<a href="#l3.17"></a><span id="l3.17">   %brandDTD;</span>
<a href="#l3.18"></a><span id="l3.18"> ]&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/im/content/imAccounts.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/im/content/imAccounts.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,18 +1,16 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> // mail/base/content/nsDragAndDrop.js</span>
<a href="#l4.9"></a><span id="l4.9"> /* globals FlavourSet, TransferData, MozElements */</span>
<a href="#l4.10"></a><span id="l4.10"> // imStatusSelector.js</span>
<a href="#l4.11"></a><span id="l4.11"> /* globals statusSelector */</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-// mailnews/base/prefs/content/accountUtils.js</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-/* globals MsgAccountManager */</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15"> var {Services} = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l4.16"></a><span id="l4.16"> var {fixIterator} = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l4.17"></a><span id="l4.17"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l4.18"></a><span id="l4.18"> var {DownloadUtils} = ChromeUtils.import(&quot;resource://gre/modules/DownloadUtils.jsm&quot;);</span>
<a href="#l4.19"></a><span id="l4.19"> ChromeUtils.defineModuleGetter(this, &quot;PluralForm&quot;, &quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21"> // This is the list of notifications that the account manager window observes</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -307,17 +305,26 @@ var gAccountManager = {</span>
<a href="#l4.23"></a><span id="l4.23">       if (!incomingServer || incomingServer.type != &quot;im&quot;)</span>
<a href="#l4.24"></a><span id="l4.24">         continue;</span>
<a href="#l4.25"></a><span id="l4.25">       if (incomingServer.wrappedJSObject.imAccount.numericId == imAccountId) {</span>
<a href="#l4.26"></a><span id="l4.26">         server = incomingServer;</span>
<a href="#l4.27"></a><span id="l4.27">         break;</span>
<a href="#l4.28"></a><span id="l4.28">       }</span>
<a href="#l4.29"></a><span id="l4.29">     }</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    MsgAccountManager(null, server);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    let win = Services.wm.getMostRecentWindow(&quot;mailnews:accountmanager&quot;);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+    if (win) {</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+      win.focus();</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+      win.selectServer(server);</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+    } else {</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+      window.openDialog(&quot;chrome://messenger/content/AccountManager.xul&quot;,</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+                        &quot;AccountManager&quot;,</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+                        &quot;chrome,centerscreen,modal,titlebar,resizable&quot;,</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+                        { server, selectPage: null });</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+    }</span>
<a href="#l4.42"></a><span id="l4.42">   },</span>
<a href="#l4.43"></a><span id="l4.43">   autologin() {</span>
<a href="#l4.44"></a><span id="l4.44">     var elt = this.accountList.selectedItem;</span>
<a href="#l4.45"></a><span id="l4.45">     elt.autoLogin = !elt.autoLogin;</span>
<a href="#l4.46"></a><span id="l4.46">   },</span>
<a href="#l4.47"></a><span id="l4.47">   close() {</span>
<a href="#l4.48"></a><span id="l4.48">     // If a modal dialog is opened, we can't close this window now</span>
<a href="#l4.49"></a><span id="l4.49">     if (this.modalDialog)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/im/content/imAccounts.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/im/content/imAccounts.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -22,18 +22,16 @@</span>
<a href="#l5.4"></a><span id="l5.4">         xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l5.5"></a><span id="l5.5">         id=&quot;accountManager&quot;</span>
<a href="#l5.6"></a><span id="l5.6">         windowtype=&quot;Messenger:Accounts&quot;</span>
<a href="#l5.7"></a><span id="l5.7">         title=&quot;&amp;accountsWindow.title;&quot;</span>
<a href="#l5.8"></a><span id="l5.8">         style=&quot;&amp;accountsWindow2.style;&quot;</span>
<a href="#l5.9"></a><span id="l5.9">         persist=&quot;width height screenX screenY&quot;&gt;</span>
<a href="#l5.10"></a><span id="l5.10">  &lt;script src=&quot;chrome://messenger/content/chat/imAccounts.js&quot;/&gt;</span>
<a href="#l5.11"></a><span id="l5.11">  &lt;script src=&quot;chrome://messenger/content/chat/imStatusSelector.js&quot;/&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">- &lt;script src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">- &lt;script src=&quot;chrome://communicator/content/utilityOverlay.js&quot;/&gt;</span>
<a href="#l5.14"></a><span id="l5.14">  &lt;script src=&quot;chrome://global/content/nsDragAndDrop.js&quot; /&gt;</span>
<a href="#l5.15"></a><span id="l5.15">  &lt;script src=&quot;chrome://global/content/nsTransferable.js&quot; /&gt;</span>
<a href="#l5.16"></a><span id="l5.16">  &lt;script src=&quot;chrome://chat/content/chat-account-richlistitem.js&quot; /&gt;</span>
<a href="#l5.17"></a><span id="l5.17">  &lt;stringbundle id=&quot;accountsBundle&quot; src=&quot;chrome://messenger/locale/imAccounts.properties&quot;/&gt;</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19">  &lt;linkset&gt;</span>
<a href="#l5.20"></a><span id="l5.20">    &lt;html:link rel=&quot;localization&quot; href=&quot;security/certificates/certManager.ftl&quot;/&gt;</span>
<a href="#l5.21"></a><span id="l5.21">  &lt;/linkset&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/newmailaccount/content/accountProvisioner.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/newmailaccount/content/accountProvisioner.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,15 +1,12 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">-// mailnews/base/prefs/content/accountUtils.js</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-/* globals MsgAccountManager */</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-</span>
<a href="#l6.11"></a><span id="l6.11"> var {AppConstants} = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l6.12"></a><span id="l6.12"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.13"></a><span id="l6.13"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l6.14"></a><span id="l6.14"> var {PluralForm} = ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l6.15"></a><span id="l6.15"> var {StringBundle} = ChromeUtils.import(&quot;resource:///modules/StringBundle.js&quot;);</span>
<a href="#l6.16"></a><span id="l6.16"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l6.17"></a><span id="l6.17"> var { Log4Moz } = ChromeUtils.import(&quot;resource:///modules/gloda/log4moz.js&quot;);</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19" class="difflineat">@@ -175,17 +172,25 @@ var EmailAccountProvisioner = {</span>
<a href="#l6.20"></a><span id="l6.20">                                              account.defaultIdentity, null);</span>
<a href="#l6.21"></a><span id="l6.21">     });</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">     document.getElementById(&quot;success-addons&quot;).addEventListener(&quot;click&quot;, function() {</span>
<a href="#l6.24"></a><span id="l6.24">       EmailAccountProvisioner.openAddonsMgr();</span>
<a href="#l6.25"></a><span id="l6.25">     });</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27">     document.getElementById(&quot;success-signature&quot;).addEventListener(&quot;click&quot;, function() {</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-      MsgAccountManager(null, account.incomingServer);</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+      var existingAccountManager =</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+        Services.wm.getMostRecentWindow(&quot;mailnews:accountmanager&quot;);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+      if (existingAccountManager)</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+        existingAccountManager.focus();</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+      else</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+        window.openDialog(&quot;chrome://messenger/content/AccountManager.xul&quot;,</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+                          &quot;AccountManager&quot;, &quot;chrome,centerscreen,modal,titlebar&quot;,</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+                          {server: account.incomingServer});</span>
<a href="#l6.38"></a><span id="l6.38">     });</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40">     document.getElementById(&quot;window&quot;).style.display = &quot;none&quot;;</span>
<a href="#l6.41"></a><span id="l6.41">     document.getElementById(&quot;successful_account&quot;).style.display = &quot;block&quot;;</span>
<a href="#l6.42"></a><span id="l6.42">   },</span>
<a href="#l6.43"></a><span id="l6.43"> </span>
<a href="#l6.44"></a><span id="l6.44">   /**</span>
<a href="#l6.45"></a><span id="l6.45">    * Save the name entered into the search field to a pref, so we can</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/newmailaccount/content/accountProvisioner.xhtml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/newmailaccount/content/accountProvisioner.xhtml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -17,24 +17,30 @@</span>
<a href="#l7.4"></a><span id="l7.4">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6">   &lt;title&gt;&amp;window.title;&lt;/title&gt;</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">   &lt;link rel=&quot;stylesheet&quot;</span>
<a href="#l7.9"></a><span id="l7.9">         type=&quot;text/css&quot;</span>
<a href="#l7.10"></a><span id="l7.10">         href=&quot;chrome://messenger/skin/newmailaccount/accountProvisioner.css&quot; /&gt;</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/accountcreation/util.js&quot;/&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/accountcreation/accountConfig.js&quot;/&gt;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/accountcreation/sanitizeDatatypes.js&quot;/&gt;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/accountcreation/readFromXML.js&quot;/&gt;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/accountcreation/createInBackend.js&quot;/&gt;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-  &lt;script src=&quot;chrome://communicator/content/utilityOverlay.js&quot;/&gt;</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/newmailaccount/accountProvisioner.js&quot;/&gt;</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/accountcreation/util.js&quot;&gt;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+  &lt;/script&gt;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/accountcreation/accountConfig.js&quot;&gt;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+  &lt;/script&gt;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/accountcreation/sanitizeDatatypes.js&quot;&gt;</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+  &lt;/script&gt;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/accountcreation/readFromXML.js&quot;&gt;</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+  &lt;/script&gt;</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/accountcreation/createInBackend.js&quot;&gt;</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+  &lt;/script&gt;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+  &lt;script src=&quot;chrome://communicator/content/utilityOverlay.js&quot;&gt;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+  &lt;/script&gt;</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/newmailaccount/accountProvisioner.js&quot;&gt;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+  &lt;/script&gt;</span>
<a href="#l7.34"></a><span id="l7.34"> &lt;/head&gt;</span>
<a href="#l7.35"></a><span id="l7.35"> &lt;body dir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l7.36"></a><span id="l7.36">   &lt;div id=&quot;window&quot; class=&quot;vbox&quot;&gt;</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38">     &lt;div id=&quot;content&quot; class=&quot;boxFlex vbox&quot;&gt;</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40">       &lt;div id=&quot;upper&quot; class=&quot;contentPadded&quot;&gt;</span>
<a href="#l7.41"></a><span id="l7.41">         &lt;div class=&quot;header&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/preferences/aboutPreferences.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/preferences/aboutPreferences.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,19 +1,19 @@</span>
<a href="#l8.4"></a><span id="l8.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l8.5"></a><span id="l8.5"> # -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l8.6"></a><span id="l8.6"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.7"></a><span id="l8.7"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.8"></a><span id="l8.8"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/global.css&quot;?&gt;</span>
<a href="#l8.11"></a><span id="l8.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/content/messenger.css&quot;?&gt;</span>
<a href="#l8.12"></a><span id="l8.12"> &lt;?xml-stylesheet href=&quot;chrome://messenger/content/preferences/handlers.css&quot;?&gt;</span>
<a href="#l8.13"></a><span id="l8.13"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/filefield.css&quot;?&gt;</span>
<a href="#l8.14"></a><span id="l8.14"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/applications.css&quot;?&gt;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot;?&gt;</span>
<a href="#l8.16"></a><span id="l8.16"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l8.17"></a><span id="l8.17"> &lt;?xml-stylesheet href=&quot;chrome://global/skin/in-content/common.css&quot;?&gt;</span>
<a href="#l8.18"></a><span id="l8.18"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/aboutPreferences.css&quot;?&gt;</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20"> #include doctype.inc.xul</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22"> &lt;preftab id=&quot;MailPreferences&quot; flex=&quot;1&quot;</span>
<a href="#l8.23"></a><span id="l8.23">          windowtype=&quot;Mail:Preferences&quot;</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineat">@@ -67,17 +67,16 @@</span>
<a href="#l8.25"></a><span id="l8.25"> #include display.inc.xul</span>
<a href="#l8.26"></a><span id="l8.26"> #include compose.inc.xul</span>
<a href="#l8.27"></a><span id="l8.27"> #include chat.inc.xul</span>
<a href="#l8.28"></a><span id="l8.28"> #include privacy.inc.xul</span>
<a href="#l8.29"></a><span id="l8.29"> #include security.inc.xul</span>
<a href="#l8.30"></a><span id="l8.30"> #include applications.inc.xul</span>
<a href="#l8.31"></a><span id="l8.31">             &lt;prefpane id=&quot;paneLightning&quot; label=&quot;&amp;paneLightning.title;&quot;/&gt;</span>
<a href="#l8.32"></a><span id="l8.32"> #include advanced.inc.xul</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-#include accounts.inc.xul</span>
<a href="#l8.34"></a><span id="l8.34">           &lt;/hbox&gt;</span>
<a href="#l8.35"></a><span id="l8.35">         &lt;/hbox&gt;</span>
<a href="#l8.36"></a><span id="l8.36">       &lt;/hbox&gt;</span>
<a href="#l8.37"></a><span id="l8.37">     &lt;/hbox&gt;</span>
<a href="#l8.38"></a><span id="l8.38">     &lt;stack id=&quot;dialogStack&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l8.39"></a><span id="l8.39">     &lt;vbox id=&quot;dialogTemplate&quot;</span>
<a href="#l8.40"></a><span id="l8.40">           class=&quot;dialogOverlay&quot;</span>
<a href="#l8.41"></a><span id="l8.41">           align=&quot;center&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">deleted file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- a/mail/components/preferences/accounts.inc.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ /dev/null</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -1,68 +0,0 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">-</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">-  &lt;prefpane id=&quot;paneAccount&quot; label=&quot;&amp;paneAccount.title;&quot;&gt;</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">-    &lt;script src=&quot;chrome://messenger/content/AccountManager.js&quot;/&gt;</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">-    &lt;script src=&quot;chrome://messenger/content/am-prefs.js&quot;/&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    &lt;script src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-    &lt;script src=&quot;chrome://messenger/content/amUtils.js&quot;/&gt;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-    &lt;script src=&quot;chrome://messenger/content/preferences/accounts.js&quot;/&gt;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-    &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-    &lt;stringbundle id=&quot;bundle_prefs&quot; src=&quot;chrome://messenger/locale/prefs.properties&quot;/&gt;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-    &lt;hbox flex=&quot;1&quot; id=&quot;accountManager&quot;&gt;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-      &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-        &lt;tree flex=&quot;1&quot; onselect=&quot;onAccountTreeSelect(null, null);&quot; id=&quot;accounttree&quot;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-              seltype=&quot;single&quot; hidecolumnpicker=&quot;true&quot;&gt;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-          &lt;treecols&gt;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-            &lt;treecol id=&quot;AccountCol&quot; flex=&quot;1&quot; primary=&quot;true&quot; hideheader=&quot;true&quot;/&gt;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-          &lt;/treecols&gt;</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-          &lt;treechildren id=&quot;account-tree-children&quot;/&gt;</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-        &lt;/tree&gt;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-        &lt;button id=&quot;accountActionsButton&quot; type=&quot;menu&quot;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-                label=&quot;&amp;accountActionsButton.label;&quot;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-                accesskey=&quot;&amp;accountActionsButton.accesskey;&quot;&gt;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-          &lt;menupopup id=&quot;accountActionsDropdown&quot;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-                     onpopupshowing=&quot;initAccountActionsButtons(this);&quot;&gt;</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">-            &lt;menuitem id=&quot;accountActionsAddMailAccount&quot;</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-                      label=&quot;&amp;addMailAccountButton.label;&quot;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-                      accesskey=&quot;&amp;addMailAccountButton.accesskey;&quot;</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-                      prefstring=&quot;mail.disable_new_account_addition&quot;</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-                      oncommand=&quot;AddMailAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-            &lt;menuitem id=&quot;accountActionsAddIMAccount&quot;</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-                      label=&quot;&amp;addIMAccountButton.label;&quot;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-                      accesskey=&quot;&amp;addIMAccountButton.accesskey;&quot;</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-                      prefstring=&quot;mail.disable_new_account_addition&quot;</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-                      oncommand=&quot;AddIMAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineminus">-            &lt;menuitem id=&quot;accountActionsAddFeedAccount&quot;</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-                      label=&quot;&amp;addFeedAccountButton.label;&quot;</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-                      accesskey=&quot;&amp;addFeedAccountButton.accesskey;&quot;</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-                      prefstring=&quot;mail.disable_new_account_addition&quot;</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">-                      oncommand=&quot;AddFeedAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-            &lt;menuitem id=&quot;accountActionsAddOtherAccount&quot;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-                      label=&quot;&amp;addOtherAccountButton.label;&quot;</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-                      accesskey=&quot;&amp;addOtherAccountButton.accesskey;&quot;</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-                      prefstring=&quot;mail.disable_new_account_addition&quot;</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-                      oncommand=&quot;onAddAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-            &lt;menuseparator id=&quot;accountActionsDropdownSep1&quot;/&gt;</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-            &lt;menuitem id=&quot;accountActionsDropdownSetDefault&quot;</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-                      label=&quot;&amp;setDefaultButton.label;&quot;</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineminus">-                      accesskey=&quot;&amp;setDefaultButton.accesskey;&quot;</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-                      prefstring=&quot;mail.disable_button.set_default_account&quot;</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineminus">-                      oncommand=&quot;onSetDefault(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-            &lt;menuitem id=&quot;accountActionsDropdownRemove&quot;</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineminus">-                      label=&quot;&amp;removeButton.label;&quot;</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-                      accesskey=&quot;&amp;removeButton.accesskey;&quot;</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-                      prefstring=&quot;mail.disable_button.delete_account&quot;</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-                      oncommand=&quot;onRemoveAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">-          &lt;/menupopup&gt;</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-        &lt;/button&gt;</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-      &lt;vbox flex=&quot;5&quot;&gt;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-        &lt;iframe id=&quot;contentFrame&quot; name=&quot;contentFrame&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-    &lt;/hbox&gt;</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-  &lt;/prefpane&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">deleted file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- a/mail/components/preferences/accounts.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ /dev/null</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -1,30 +0,0 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineminus">-/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">- * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">-</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">-&quot;use strict&quot;;</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">-</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-/* import-globals-from ../../../mailnews/base/prefs/content/AccountManager.js */</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-var gAccountsPane = {</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-  paneSelectionChanged(event) {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-    if (event.detail.newPane == &quot;paneAccount&quot;) {</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-      if (!document.getElementById(&quot;account-tree-children&quot;).hasChildNodes()) {</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-        // Only load the account tree when the pane is first shown.</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">-        onLoad();</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-      }</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">-    }</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-    if (event.detail.oldPane == &quot;paneAccount&quot;) {</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-      onAccept(false);</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-    }</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">-  },</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-  unload() {</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">-    onAccept(false);</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-    onUnload();</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-  },</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-};</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-window.addEventListener(&quot;paneSelected&quot;, gAccountsPane.paneSelectionChanged);</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-window.addEventListener(&quot;unload&quot;, () =&gt; gAccountsPane.unload());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/preferences/advanced.inc.xul</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/preferences/advanced.inc.xul</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -449,9 +449,10 @@</span>
<a href="#l11.4"></a><span id="l11.4">                     label=&quot;&amp;viewSecurityDevices.label;&quot;</span>
<a href="#l11.5"></a><span id="l11.5">                     accesskey=&quot;&amp;viewSecurityDevices.accesskey;&quot;</span>
<a href="#l11.6"></a><span id="l11.6">                     oncommand=&quot;gAdvancedPane.showSecurityDevices();&quot;</span>
<a href="#l11.7"></a><span id="l11.7">                     preference=&quot;security.disable_button.openDeviceManager&quot;/&gt;</span>
<a href="#l11.8"></a><span id="l11.8">           &lt;/hbox&gt;</span>
<a href="#l11.9"></a><span id="l11.9">         &lt;/tabpanel&gt;</span>
<a href="#l11.10"></a><span id="l11.10">       &lt;/tabpanels&gt;</span>
<a href="#l11.11"></a><span id="l11.11">     &lt;/tabbox&gt;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+    &lt;separator/&gt;</span>
<a href="#l11.13"></a><span id="l11.13">   &lt;/prefpane&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/preferences/doctype.inc.xul</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/preferences/doctype.inc.xul</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -36,11 +36,9 @@</span>
<a href="#l12.4"></a><span id="l12.4"> &lt;!ENTITY % searchIntegrationDefaultDTD SYSTEM &quot;chrome://messenger/locale/searchIntegrationDefault.dtd&quot; &gt;</span>
<a href="#l12.5"></a><span id="l12.5"> %searchIntegrationDefaultDTD;</span>
<a href="#l12.6"></a><span id="l12.6"> #endif</span>
<a href="#l12.7"></a><span id="l12.7"> #endif</span>
<a href="#l12.8"></a><span id="l12.8"> #ifdef MOZ_UPDATER</span>
<a href="#l12.9"></a><span id="l12.9"> &lt;!ENTITY % aboutDialogDTD SYSTEM &quot;chrome://messenger/locale/aboutDialog.dtd&quot; &gt;</span>
<a href="#l12.10"></a><span id="l12.10"> %aboutDialogDTD;</span>
<a href="#l12.11"></a><span id="l12.11"> #endif</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-&lt;!ENTITY % accountDTD SYSTEM &quot;chrome://messenger/locale/AccountManager.dtd&quot;&gt;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-%accountDTD;</span>
<a href="#l12.14"></a><span id="l12.14"> ]&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/preferences/jar.mn</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/preferences/jar.mn</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -6,17 +6,16 @@ messenger.jar:</span>
<a href="#l13.4"></a><span id="l13.4"> *   content/messenger/preferences/aboutPreferences.xul</span>
<a href="#l13.5"></a><span id="l13.5">     content/messenger/preferences/preferences.js</span>
<a href="#l13.6"></a><span id="l13.6">     content/messenger/preferences/preferencesTab.js</span>
<a href="#l13.7"></a><span id="l13.7">     content/messenger/preferences/general.js</span>
<a href="#l13.8"></a><span id="l13.8"> #ifdef XP_MACOSX</span>
<a href="#l13.9"></a><span id="l13.9">     content/messenger/preferences/dockoptions.js</span>
<a href="#l13.10"></a><span id="l13.10">     content/messenger/preferences/dockoptions.xul</span>
<a href="#l13.11"></a><span id="l13.11"> #endif</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    content/messenger/preferences/accounts.js</span>
<a href="#l13.13"></a><span id="l13.13">     content/messenger/preferences/display.js</span>
<a href="#l13.14"></a><span id="l13.14">     content/messenger/preferences/chat.js</span>
<a href="#l13.15"></a><span id="l13.15">     content/messenger/preferences/messagestyle.js</span>
<a href="#l13.16"></a><span id="l13.16">     content/messenger/preferences/messengerLanguages.js</span>
<a href="#l13.17"></a><span id="l13.17">     content/messenger/preferences/messengerLanguages.xul</span>
<a href="#l13.18"></a><span id="l13.18">     content/messenger/preferences/colors.js</span>
<a href="#l13.19"></a><span id="l13.19"> *   content/messenger/preferences/colors.xul</span>
<a href="#l13.20"></a><span id="l13.20">     content/messenger/preferences/compose.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/preferences/preferences.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/preferences/preferences.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -87,21 +87,17 @@ function showPane(paneID) {</span>
<a href="#l14.4"></a><span id="l14.4">     if (currentlySelected == pane) {</span>
<a href="#l14.5"></a><span id="l14.5">       return;</span>
<a href="#l14.6"></a><span id="l14.6">     }</span>
<a href="#l14.7"></a><span id="l14.7">     currentlySelected.removeAttribute(&quot;selected&quot;);</span>
<a href="#l14.8"></a><span id="l14.8">   }</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">   selector.value = paneID;</span>
<a href="#l14.11"></a><span id="l14.11">   pane.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  pane.dispatchEvent(new CustomEvent(&quot;paneSelected&quot;,</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    { bubbles: true,</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-      detail: { oldPane: (currentlySelected ? currentlySelected.id : null),</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-                newPane: paneID },</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-    }));</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+  pane.dispatchEvent(new CustomEvent(&quot;paneSelected&quot;, { bubbles: true }));</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">   document.documentElement.setAttribute(&quot;lastSelected&quot;, paneID);</span>
<a href="#l14.20"></a><span id="l14.20">   Services.xulStore.persist(document.documentElement, &quot;lastSelected&quot;);</span>
<a href="#l14.21"></a><span id="l14.21"> }</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23"> /**</span>
<a href="#l14.24"></a><span id="l14.24">  * Selects the specified preferences pane</span>
<a href="#l14.25"></a><span id="l14.25">  *</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineat">@@ -121,36 +117,25 @@ function selectPaneAndTab(prefWindow, pa</span>
<a href="#l14.27"></a><span id="l14.27">     }</span>
<a href="#l14.28"></a><span id="l14.28">   }</span>
<a href="#l14.29"></a><span id="l14.29"> }</span>
<a href="#l14.30"></a><span id="l14.30"> </span>
<a href="#l14.31"></a><span id="l14.31"> /**</span>
<a href="#l14.32"></a><span id="l14.32">  * Select the specified tab</span>
<a href="#l14.33"></a><span id="l14.33">  *</span>
<a href="#l14.34"></a><span id="l14.34">  * @param pane         prefpane to operate on</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">- * @param tabID        ID of tab to select on the prefpane (or server for AM)</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+ * @param tabID        ID of tab to select on the prefpane</span>
<a href="#l14.37"></a><span id="l14.37">  * @param subdialogID  ID of button to activate, opening a subdialog</span>
<a href="#l14.38"></a><span id="l14.38">  */</span>
<a href="#l14.39"></a><span id="l14.39"> function showTab(pane, tabID, subdialogID) {</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-  if (pane.id != &quot;paneAccount&quot;) {</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-    pane.querySelector(&quot;tabbox&quot;).selectedTab = document.getElementById(tabID);</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-    if (subdialogID) {</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-      setTimeout(function() {</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-        document.getElementById(subdialogID).click();</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-      });</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-    }</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-  } else {</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-    // For the accounts pane, tabID is the server key, subdialogID is the settings pane.</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-    let accountTree = document.getElementById(&quot;account-tree-children&quot;);</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-    if (!accountTree.hasAttribute(&quot;tree-loaded&quot;)) {</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-      accountTree.addEventListener(&quot;account-tree-loaded&quot;,</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-        () =&gt; window.selectServerByKey(tabID, subdialogID), {once: true});</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-    } else {</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-      window.selectServerByKey(tabID, subdialogID);</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-    }</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+  pane.querySelector(&quot;tabbox&quot;).selectedTab = document.getElementById(tabID);</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+  if (subdialogID) {</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+    setTimeout(function() {</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+      document.getElementById(subdialogID).click();</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+    });</span>
<a href="#l14.61"></a><span id="l14.61">   }</span>
<a href="#l14.62"></a><span id="l14.62"> }</span>
<a href="#l14.63"></a><span id="l14.63"> </span>
<a href="#l14.64"></a><span id="l14.64"> /**</span>
<a href="#l14.65"></a><span id="l14.65">  * Get the ID of the current pane.</span>
<a href="#l14.66"></a><span id="l14.66">  */</span>
<a href="#l14.67"></a><span id="l14.67"> function getCurrentPaneID() {</span>
<a href="#l14.68"></a><span id="l14.68">   let currentlySelected = paneDeck.querySelector(&quot;#paneDeck &gt; prefpane[selected]&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/preferences/preferencesTab.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/preferences/preferencesTab.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -124,28 +124,20 @@ var preferencesTabType = {</span>
<a href="#l15.4"></a><span id="l15.4">     gPrefTab = aTab;</span>
<a href="#l15.5"></a><span id="l15.5">     this.lastBrowserId++;</span>
<a href="#l15.6"></a><span id="l15.6">   },</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">   persistTab(aTab) {</span>
<a href="#l15.9"></a><span id="l15.9">     if (aTab.browser.currentURI.spec == &quot;about:blank&quot;)</span>
<a href="#l15.10"></a><span id="l15.10">       return null;</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    let currentPane = aTab.browser.contentWindow.getCurrentPaneID();</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-    let tabId;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-    if (currentPane == &quot;paneAccount&quot;) {</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-      let account = aTab.browser.contentWindow.getCurrentAccount();</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-      tabId = (account ? account.incomingServer.key : null);</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-    } else {</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-      tabId = aTab.tabID;</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-    }</span>
<a href="#l15.20"></a><span id="l15.20">     return {</span>
<a href="#l15.21"></a><span id="l15.21">       tabURI: aTab.url,</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-      paneID: currentPane,</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-      tabID: tabId,</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+      paneID: aTab.paneID,</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+      tabID: aTab.tabID,</span>
<a href="#l15.26"></a><span id="l15.26">       otherArgs: aTab.otherArgs,</span>
<a href="#l15.27"></a><span id="l15.27">     };</span>
<a href="#l15.28"></a><span id="l15.28">   },</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30">   restoreTab(aTabmail, aPersistedState) {</span>
<a href="#l15.31"></a><span id="l15.31">     aTabmail.openTab(&quot;preferencesTab&quot;, {</span>
<a href="#l15.32"></a><span id="l15.32">       contentPage: aPersistedState.tabURI,</span>
<a href="#l15.33"></a><span id="l15.33">       paneID: aPersistedState.paneID,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/AccountManager.dtd</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/AccountManager.dtd</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -15,8 +15,20 @@</span>
<a href="#l16.4"></a><span id="l16.4"> &lt;!ENTITY addFeedAccountButton.label &quot;Add Feed Account…&quot;&gt;</span>
<a href="#l16.5"></a><span id="l16.5"> &lt;!ENTITY addFeedAccountButton.accesskey &quot;F&quot;&gt;</span>
<a href="#l16.6"></a><span id="l16.6"> &lt;!ENTITY addOtherAccountButton.label &quot;Add Other Account…&quot;&gt;</span>
<a href="#l16.7"></a><span id="l16.7"> &lt;!ENTITY addOtherAccountButton.accesskey &quot;O&quot;&gt;</span>
<a href="#l16.8"></a><span id="l16.8"> &lt;!ENTITY setDefaultButton.label &quot;Set as Default&quot;&gt;</span>
<a href="#l16.9"></a><span id="l16.9"> &lt;!ENTITY setDefaultButton.accesskey &quot;D&quot;&gt;</span>
<a href="#l16.10"></a><span id="l16.10"> &lt;!ENTITY removeButton.label &quot;Remove Account&quot;&gt;</span>
<a href="#l16.11"></a><span id="l16.11"> &lt;!ENTITY removeButton.accesskey &quot;R&quot;&gt;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+&lt;!-- AccountManager.xul --&gt;</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+&lt;!-- LOCALIZATION NOTE : this is part of an inline-style attribute on the account</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+     setting dialog, which specifies the width and height in em units of the dialog.</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+     Localizers ONLY can increase these widths if they are having difficulty getting</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+     panel content to fit.</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+     1ch = The width of the &quot;0&quot; (ZERO, U+0030) glyph for the current font.</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+     1em = The height of the font.</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+     XUL/FE DEVELOPERS: DO NOT MODIFY THIS VALUE. It represents the correct size of</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+     this window for en-US. --&gt;</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+&lt;!ENTITY accountManager.size &quot;width: 105ch; height: 55em;&quot;&gt;</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+&lt;!ENTITY accountTree.width &quot;width: 32ch;&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -19,8 +19,11 @@</span>
<a href="#l17.4"></a><span id="l17.4"> &lt;!ENTITY paneAttachments.title    &quot;Attachments&quot;&gt;</span>
<a href="#l17.5"></a><span id="l17.5"> &lt;!ENTITY panePrivacy.title        &quot;Privacy&quot;&gt;</span>
<a href="#l17.6"></a><span id="l17.6"> &lt;!ENTITY paneSecurity.title       &quot;Security&quot;&gt;</span>
<a href="#l17.7"></a><span id="l17.7"> &lt;!ENTITY paneLightning.title      &quot;Calendar&quot;&gt;</span>
<a href="#l17.8"></a><span id="l17.8"> &lt;!ENTITY paneAdvanced.title       &quot;Advanced&quot;&gt;</span>
<a href="#l17.9"></a><span id="l17.9"> &lt;!ENTITY paneAccount.title        &quot;Accounts&quot;&gt;</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11"> &lt;!ENTITY addonsButton.label       &quot;Extensions &amp;amp; Themes&quot;&gt;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+&lt;!ENTITY okButton.title           &quot;OK&quot;&gt;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+&lt;!ENTITY okButton.accesskey       &quot;O&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/test/mozmill/account/test-ab-whitelist.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-ab-whitelist.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1,45 +1,44 @@</span>
<a href="#l18.4"></a><span id="l18.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l18.5"></a><span id="l18.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l18.6"></a><span id="l18.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8"> &quot;use strict&quot;;</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10"> /* import-globals-from ../shared-modules/test-account-manager-helpers.js */</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineminus">-/* import-globals-from ../shared-modules/test-content-tab-helpers.js */</span>
<a href="#l18.12"></a><span id="l18.12"> /* import-globals-from ../shared-modules/test-folder-display-helpers.js */</span>
<a href="#l18.13"></a><span id="l18.13"> /* import-globals-from ../shared-modules/test-keyboard-helpers.js */</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-/* import-globals-from ../shared-modules/test-pref-window-helpers.js */</span>
<a href="#l18.15"></a><span id="l18.15"> /* import-globals-from ../shared-modules/test-window-helpers.js */</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17"> var MODULE_NAME = &quot;test-ab-whitelist&quot;;</span>
<a href="#l18.18"></a><span id="l18.18"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l18.19"></a><span id="l18.19"> var MODULE_REQUIRES = [</span>
<a href="#l18.20"></a><span id="l18.20">   &quot;folder-display-helpers&quot;,</span>
<a href="#l18.21"></a><span id="l18.21">   &quot;window-helpers&quot;,</span>
<a href="#l18.22"></a><span id="l18.22">   &quot;account-manager-helpers&quot;,</span>
<a href="#l18.23"></a><span id="l18.23">   &quot;keyboard-helpers&quot;,</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-  &quot;content-tab-helpers&quot;,</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-  &quot;pref-window-helpers&quot;,</span>
<a href="#l18.26"></a><span id="l18.26"> ];</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28"> var mozmill = ChromeUtils.import(&quot;chrome://mozmill/content/modules/mozmill.jsm&quot;);</span>
<a href="#l18.29"></a><span id="l18.29"> var controller = ChromeUtils.import(&quot;chrome://mozmill/content/modules/controller.jsm&quot;);</span>
<a href="#l18.30"></a><span id="l18.30"> var elib = ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.jsm&quot;);</span>
<a href="#l18.31"></a><span id="l18.31"> </span>
<a href="#l18.32"></a><span id="l18.32"> var gOldWhiteList = null;</span>
<a href="#l18.33"></a><span id="l18.33"> var gKeyString = null;</span>
<a href="#l18.34"></a><span id="l18.34"> </span>
<a href="#l18.35"></a><span id="l18.35"> var gAccount = null;</span>
<a href="#l18.36"></a><span id="l18.36"> </span>
<a href="#l18.37"></a><span id="l18.37"> function setupModule(module) {</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-    collector.getModule(lib).installInto(module);</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-  }</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+  let wh = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+  wh.installInto(module);</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+  let fdh = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineplus">+  fdh.installInto(module);</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineplus">+  let amh = collector.getModule(&quot;account-manager-helpers&quot;);</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+  amh.installInto(module);</span>
<a href="#l18.47"></a><span id="l18.47"> </span>
<a href="#l18.48"></a><span id="l18.48">   let server = MailServices.accounts</span>
<a href="#l18.49"></a><span id="l18.49">                            .FindServer(&quot;tinderbox&quot;, FAKE_SERVER_HOSTNAME, &quot;pop3&quot;);</span>
<a href="#l18.50"></a><span id="l18.50">   gAccount = MailServices.accounts.FindAccountForServer(server);</span>
<a href="#l18.51"></a><span id="l18.51">   let serverKey = server.key;</span>
<a href="#l18.52"></a><span id="l18.52"> </span>
<a href="#l18.53"></a><span id="l18.53">   gKeyString = &quot;mail.server.&quot; + serverKey + &quot;.whiteListAbURI&quot;;</span>
<a href="#l18.54"></a><span id="l18.54">   gOldWhiteList = Services.prefs.getCharPref(gKeyString);</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineat">@@ -49,78 +48,75 @@ function setupModule(module) {</span>
<a href="#l18.56"></a><span id="l18.56"> function teardownModule(module) {</span>
<a href="#l18.57"></a><span id="l18.57">   Services.prefs.setCharPref(gKeyString, gOldWhiteList);</span>
<a href="#l18.58"></a><span id="l18.58"> }</span>
<a href="#l18.59"></a><span id="l18.59"> </span>
<a href="#l18.60"></a><span id="l18.60"> /* First, test that when we initially load the account manager, that</span>
<a href="#l18.61"></a><span id="l18.61">  * we're not whitelisting any address books.  Then, we'll check all</span>
<a href="#l18.62"></a><span id="l18.62">  * address books and save.</span>
<a href="#l18.63"></a><span id="l18.63">  */</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-function test_check_whitelist_init_and_save() {</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineplus">+function subtest_check_whitelist_init_and_save(amc) {</span>
<a href="#l18.67"></a><span id="l18.67">   // Ok, the advanced settings window is open.  Let's choose</span>
<a href="#l18.68"></a><span id="l18.68">   // the junkmail settings.</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-  let accountRow = get_account_tree_row(gAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineplus">+  let accountRow = get_account_tree_row(gAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l18.73"></a><span id="l18.73"> </span>
<a href="#l18.74"></a><span id="l18.74" class="difflineminus">-  let doc = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineplus">+  let doc = amc.window.document.getElementById(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l18.76"></a><span id="l18.76"> </span>
<a href="#l18.77"></a><span id="l18.77">   // At this point, we shouldn't have anything checked, but we should have</span>
<a href="#l18.78"></a><span id="l18.78">   // the two default address books (Personal and Collected) displayed</span>
<a href="#l18.79"></a><span id="l18.79">   let list = doc.getElementById(&quot;whiteListAbURI&quot;);</span>
<a href="#l18.80"></a><span id="l18.80">   assert_equals(2, list.getRowCount(),</span>
<a href="#l18.81"></a><span id="l18.81">                 &quot;There was an unexpected number of address books&quot;);</span>
<a href="#l18.82"></a><span id="l18.82"> </span>
<a href="#l18.83"></a><span id="l18.83">   // Now we'll check both address books</span>
<a href="#l18.84"></a><span id="l18.84">   for (let i = 0; i &lt; list.getRowCount(); i++) {</span>
<a href="#l18.85"></a><span id="l18.85">     let abNode = list.getItemAtIndex(i);</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineminus">-    mc.click(new elib.Elem(abNode.firstChild));</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineplus">+    amc.click(new elib.Elem(abNode.firstChild));</span>
<a href="#l18.88"></a><span id="l18.88">   }</span>
<a href="#l18.89"></a><span id="l18.89"> </span>
<a href="#l18.90"></a><span id="l18.90">   // And close the dialog</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineplus">+  amc.window.document.getElementById(&quot;accountManager&quot;).acceptDialog();</span>
<a href="#l18.93"></a><span id="l18.93"> }</span>
<a href="#l18.94"></a><span id="l18.94"> </span>
<a href="#l18.95"></a><span id="l18.95"> /* Next, we'll make sure that the address books we checked in</span>
<a href="#l18.96"></a><span id="l18.96">  * subtest_check_whitelist_init_and_save were properly saved.</span>
<a href="#l18.97"></a><span id="l18.97">  * Then, we'll clear the address books and save.</span>
<a href="#l18.98"></a><span id="l18.98">  */</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineminus">-function test_check_whitelist_load_and_clear() {</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineminus">-  let accountRow = get_account_tree_row(gAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineplus">+function subtest_check_whitelist_load_and_clear(amc) {</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineplus">+  let accountRow = get_account_tree_row(gAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l18.106"></a><span id="l18.106"> </span>
<a href="#l18.107"></a><span id="l18.107" class="difflineminus">-  let doc = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineplus">+  let doc = amc.window.document.getElementById(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l18.109"></a><span id="l18.109">   let list = doc.getElementById(&quot;whiteListAbURI&quot;);</span>
<a href="#l18.110"></a><span id="l18.110">   let whiteListURIs = Services.prefs.getCharPref(gKeyString).split(&quot; &quot;);</span>
<a href="#l18.111"></a><span id="l18.111"> </span>
<a href="#l18.112"></a><span id="l18.112">   for (let i = 0; i &lt; list.getRowCount(); i++) {</span>
<a href="#l18.113"></a><span id="l18.113">     let abNode = list.getItemAtIndex(i);</span>
<a href="#l18.114"></a><span id="l18.114">     assert_equals(&quot;true&quot;, abNode.firstChild.getAttribute(&quot;checked&quot;),</span>
<a href="#l18.115"></a><span id="l18.115">                   &quot;Should have been checked&quot;);</span>
<a href="#l18.116"></a><span id="l18.116">     // Also ensure that the address book URI was properly saved in the</span>
<a href="#l18.117"></a><span id="l18.117">     // prefs</span>
<a href="#l18.118"></a><span id="l18.118">     assert_true(whiteListURIs.includes(abNode.getAttribute(&quot;value&quot;)));</span>
<a href="#l18.119"></a><span id="l18.119">     // Now un-check that address book</span>
<a href="#l18.120"></a><span id="l18.120" class="difflineminus">-    mc.click(new elib.Elem(abNode.firstChild));</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineplus">+    amc.click(new elib.Elem(abNode.firstChild));</span>
<a href="#l18.122"></a><span id="l18.122">   }</span>
<a href="#l18.123"></a><span id="l18.123"> </span>
<a href="#l18.124"></a><span id="l18.124">   // And close the dialog</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineplus">+  amc.window.document.getElementById(&quot;accountManager&quot;).acceptDialog();</span>
<a href="#l18.127"></a><span id="l18.127"> }</span>
<a href="#l18.128"></a><span id="l18.128"> </span>
<a href="#l18.129"></a><span id="l18.129"> /* Finally, we'll make sure that the address books we cleared</span>
<a href="#l18.130"></a><span id="l18.130">  * were actually cleared.</span>
<a href="#l18.131"></a><span id="l18.131">  */</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineminus">-function test_check_whitelist_load_cleared() {</span>
<a href="#l18.133"></a><span id="l18.133" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineminus">-  let accountRow = get_account_tree_row(gAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineplus">+function subtest_check_whitelist_load_cleared(amc) {</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineplus">+  let accountRow = get_account_tree_row(gAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l18.139"></a><span id="l18.139"> </span>
<a href="#l18.140"></a><span id="l18.140" class="difflineminus">-  let doc = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineplus">+  let doc = amc.window.document.getElementById(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l18.142"></a><span id="l18.142">   let list = doc.getElementById(&quot;whiteListAbURI&quot;);</span>
<a href="#l18.143"></a><span id="l18.143">   let whiteListURIs = &quot;&quot;;</span>
<a href="#l18.144"></a><span id="l18.144"> </span>
<a href="#l18.145"></a><span id="l18.145">   try {</span>
<a href="#l18.146"></a><span id="l18.146">     whiteListURIs = Services.prefs.getCharPref(gKeyString);</span>
<a href="#l18.147"></a><span id="l18.147">     // We should have failed here, because the pref should have been cleared</span>
<a href="#l18.148"></a><span id="l18.148">     // out.</span>
<a href="#l18.149"></a><span id="l18.149">     throw Error(&quot;The whitelist preference for this server wasn't properly &quot;</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineat">@@ -133,10 +129,16 @@ function test_check_whitelist_load_clear</span>
<a href="#l18.151"></a><span id="l18.151">     assert_equals(&quot;false&quot;, abNode.firstChild.getAttribute(&quot;checked&quot;),</span>
<a href="#l18.152"></a><span id="l18.152">                   &quot;Should not have been checked&quot;);</span>
<a href="#l18.153"></a><span id="l18.153">     // Also ensure that the address book URI was properly cleared in the</span>
<a href="#l18.154"></a><span id="l18.154">     // prefs</span>
<a href="#l18.155"></a><span id="l18.155">     assert_false(whiteListURIs.includes(abNode.getAttribute(&quot;value&quot;)));</span>
<a href="#l18.156"></a><span id="l18.156">   }</span>
<a href="#l18.157"></a><span id="l18.157"> </span>
<a href="#l18.158"></a><span id="l18.158">   // And close the dialog</span>
<a href="#l18.159"></a><span id="l18.159" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l18.160"></a><span id="l18.160" class="difflineplus">+  amc.window.document.getElementById(&quot;accountManager&quot;).acceptDialog();</span>
<a href="#l18.161"></a><span id="l18.161"> }</span>
<a href="#l18.162"></a><span id="l18.162" class="difflineplus">+</span>
<a href="#l18.163"></a><span id="l18.163" class="difflineplus">+function test_address_book_whitelist() {</span>
<a href="#l18.164"></a><span id="l18.164" class="difflineplus">+  open_advanced_settings(subtest_check_whitelist_init_and_save);</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineplus">+  open_advanced_settings(subtest_check_whitelist_load_and_clear);</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineplus">+  open_advanced_settings(subtest_check_whitelist_load_cleared);</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-actions.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-actions.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,36 +1,28 @@</span>
<a href="#l19.4"></a><span id="l19.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.5"></a><span id="l19.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l19.6"></a><span id="l19.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8"> &quot;use strict&quot;;</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10"> /* import-globals-from ../shared-modules/test-account-manager-helpers.js */</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineminus">-/* import-globals-from ../shared-modules/test-content-tab-helpers.js */</span>
<a href="#l19.12"></a><span id="l19.12"> /* import-globals-from ../shared-modules/test-folder-display-helpers.js */</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-/* import-globals-from ../shared-modules/test-pref-window-helpers.js */</span>
<a href="#l19.14"></a><span id="l19.14"> /* import-globals-from ../shared-modules/test-window-helpers.js */</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16"> var MODULE_NAME = &quot;test-account-actions&quot;;</span>
<a href="#l19.17"></a><span id="l19.17"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-var MODULE_REQUIRES = [</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-  &quot;folder-display-helpers&quot;,</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-  &quot;window-helpers&quot;,</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">-  &quot;account-manager-helpers&quot;,</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineminus">-  &quot;content-tab-helpers&quot;,</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">-  &quot;pref-window-helpers&quot;,</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineminus">-];</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineplus">+var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;window-helpers&quot;, &quot;account-manager-helpers&quot;];</span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27"> var imapAccount, nntpAccount, originalAccountCount;</span>
<a href="#l19.28"></a><span id="l19.28"> </span>
<a href="#l19.29"></a><span id="l19.29"> function setupModule(module) {</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-    collector.getModule(lib).installInto(module);</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-  }</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+  collector.getModule(&quot;window-helpers&quot;).installInto(module);</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+  collector.getModule(&quot;folder-display-helpers&quot;).installInto(module);</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+  collector.getModule(&quot;account-manager-helpers&quot;).installInto(module);</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37">   // There may be pre-existing accounts from other tests.</span>
<a href="#l19.38"></a><span id="l19.38">   originalAccountCount = MailServices.accounts.allServers.length;</span>
<a href="#l19.39"></a><span id="l19.39">   // There already should be a Local Folders account created.</span>
<a href="#l19.40"></a><span id="l19.40">   // It is needed for this test.</span>
<a href="#l19.41"></a><span id="l19.41">   assert_true(MailServices.accounts.localFoldersServer);</span>
<a href="#l19.42"></a><span id="l19.42"> </span>
<a href="#l19.43"></a><span id="l19.43">   // Create an IMAP server</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineat">@@ -66,93 +58,104 @@ function teardownModule(module) {</span>
<a href="#l19.45"></a><span id="l19.45">   MailServices.accounts.removeAccount(imapAccount);</span>
<a href="#l19.46"></a><span id="l19.46">   // There should be only the original accounts left.</span>
<a href="#l19.47"></a><span id="l19.47">   assert_equals(MailServices.accounts.allServers.length, originalAccountCount);</span>
<a href="#l19.48"></a><span id="l19.48"> }</span>
<a href="#l19.49"></a><span id="l19.49"> </span>
<a href="#l19.50"></a><span id="l19.50"> /**</span>
<a href="#l19.51"></a><span id="l19.51">  * Check that the account actions for the account are enabled or disabled appropriately.</span>
<a href="#l19.52"></a><span id="l19.52">  *</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+ * @param amc          the account options controller</span>
<a href="#l19.54"></a><span id="l19.54">  * @param aAccountKey  the key of the account to select</span>
<a href="#l19.55"></a><span id="l19.55">  * @param aIsSetAsDefaultEnabled  true if the menuitem should be enabled, false otherwise</span>
<a href="#l19.56"></a><span id="l19.56">  * @param aIsRemoveEnabled        true if the menuitem should be enabled, false otherwise</span>
<a href="#l19.57"></a><span id="l19.57">  * @param aIsAddAccountEnabled    true if the menuitems (Add Mail Account+Add Other Account)</span>
<a href="#l19.58"></a><span id="l19.58">  *                                should be enabled, false otherwise</span>
<a href="#l19.59"></a><span id="l19.59">  */</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineminus">-function subtest_check_account_actions(aAccountKey, aIsSetAsDefaultEnabled,</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineplus">+function subtest_check_account_actions(amc, aAccountKey, aIsSetAsDefaultEnabled,</span>
<a href="#l19.62"></a><span id="l19.62">                                        aIsRemoveEnabled, aIsAddAccountEnabled) {</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineminus">-  let accountRow = get_account_tree_row(aAccountKey, null, tab);</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineplus">+  let accountRow = get_account_tree_row(aAccountKey, null, amc);</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l19.68"></a><span id="l19.68"> </span>
<a href="#l19.69"></a><span id="l19.69">   // click the Actions Button to bring up the popup with menuitems to test</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineminus">-  mc.click(content_tab_eid(tab, &quot;accountActionsButton&quot;), 5, 5);</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineminus">-  wait_for_popup_to_open(content_tab_e(tab, &quot;accountActionsDropdown&quot;));</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineplus">+  amc.click(amc.eid(&quot;accountActionsButton&quot;), 5, 5);</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineplus">+  wait_for_popup_to_open(amc.e(&quot;accountActionsDropdown&quot;));</span>
<a href="#l19.74"></a><span id="l19.74"> </span>
<a href="#l19.75"></a><span id="l19.75" class="difflineminus">-  let actionAddMailAccount = content_tab_e(tab, &quot;accountActionsAddMailAccount&quot;);</span>
<a href="#l19.76"></a><span id="l19.76" class="difflineplus">+  let actionAddMailAccount = amc.e(&quot;accountActionsAddMailAccount&quot;);</span>
<a href="#l19.77"></a><span id="l19.77">   assert_not_equals(actionAddMailAccount, undefined);</span>
<a href="#l19.78"></a><span id="l19.78">   assert_equals(!actionAddMailAccount.getAttribute(&quot;disabled&quot;), aIsAddAccountEnabled);</span>
<a href="#l19.79"></a><span id="l19.79"> </span>
<a href="#l19.80"></a><span id="l19.80" class="difflineminus">-  let actionAddOtherAccount = content_tab_e(tab, &quot;accountActionsAddOtherAccount&quot;);</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineplus">+  let actionAddOtherAccount = amc.e(&quot;accountActionsAddOtherAccount&quot;);</span>
<a href="#l19.82"></a><span id="l19.82">   assert_not_equals(actionAddOtherAccount, undefined);</span>
<a href="#l19.83"></a><span id="l19.83">   assert_equals(!actionAddOtherAccount.getAttribute(&quot;disabled&quot;), aIsAddAccountEnabled);</span>
<a href="#l19.84"></a><span id="l19.84"> </span>
<a href="#l19.85"></a><span id="l19.85" class="difflineminus">-  let actionSetDefault = content_tab_e(tab, &quot;accountActionsDropdownSetDefault&quot;);</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineplus">+  let actionSetDefault = amc.e(&quot;accountActionsDropdownSetDefault&quot;);</span>
<a href="#l19.87"></a><span id="l19.87">   assert_not_equals(actionSetDefault, undefined);</span>
<a href="#l19.88"></a><span id="l19.88">   assert_equals(!actionSetDefault.getAttribute(&quot;disabled&quot;), aIsSetAsDefaultEnabled);</span>
<a href="#l19.89"></a><span id="l19.89"> </span>
<a href="#l19.90"></a><span id="l19.90" class="difflineminus">-  let actionRemove = content_tab_e(tab, &quot;accountActionsDropdownRemove&quot;);</span>
<a href="#l19.91"></a><span id="l19.91" class="difflineplus">+  let actionRemove = amc.e(&quot;accountActionsDropdownRemove&quot;);</span>
<a href="#l19.92"></a><span id="l19.92">   assert_not_equals(actionRemove, undefined);</span>
<a href="#l19.93"></a><span id="l19.93">   assert_equals(!actionRemove.getAttribute(&quot;disabled&quot;), aIsRemoveEnabled);</span>
<a href="#l19.94"></a><span id="l19.94"> </span>
<a href="#l19.95"></a><span id="l19.95" class="difflineminus">-  close_popup(mc, content_tab_eid(tab, &quot;accountActionsDropdown&quot;));</span>
<a href="#l19.96"></a><span id="l19.96" class="difflineminus">-</span>
<a href="#l19.97"></a><span id="l19.97" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l19.98"></a><span id="l19.98" class="difflineplus">+  close_popup(amc, amc.eid(&quot;accountActionsDropdown&quot;));</span>
<a href="#l19.99"></a><span id="l19.99"> }</span>
<a href="#l19.100"></a><span id="l19.100"> </span>
<a href="#l19.101"></a><span id="l19.101"> function test_account_actions() {</span>
<a href="#l19.102"></a><span id="l19.102">   // IMAP account: can be default, can be removed.</span>
<a href="#l19.103"></a><span id="l19.103" class="difflineminus">-  subtest_check_account_actions(imapAccount.key, true, true, true);</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l19.105"></a><span id="l19.105" class="difflineplus">+    subtest_check_account_actions(amc, imapAccount.key, true, true, true);</span>
<a href="#l19.106"></a><span id="l19.106" class="difflineplus">+  });</span>
<a href="#l19.107"></a><span id="l19.107"> </span>
<a href="#l19.108"></a><span id="l19.108">   // NNTP (News) account: can't be default, can be removed.</span>
<a href="#l19.109"></a><span id="l19.109" class="difflineminus">-  subtest_check_account_actions(nntpAccount.key, false, true, true);</span>
<a href="#l19.110"></a><span id="l19.110" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineplus">+    subtest_check_account_actions(amc, nntpAccount.key, false, true, true);</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineplus">+  });</span>
<a href="#l19.113"></a><span id="l19.113"> </span>
<a href="#l19.114"></a><span id="l19.114">   // Local Folders account: can't be removed, can't be default.</span>
<a href="#l19.115"></a><span id="l19.115">   var localFoldersAccount = MailServices.accounts.FindAccountForServer(MailServices.accounts.localFoldersServer);</span>
<a href="#l19.116"></a><span id="l19.116" class="difflineminus">-  subtest_check_account_actions(localFoldersAccount.key, false, false, true);</span>
<a href="#l19.117"></a><span id="l19.117" class="difflineminus">-</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l19.119"></a><span id="l19.119" class="difflineplus">+    subtest_check_account_actions(amc, localFoldersAccount.key, false, false, true);</span>
<a href="#l19.120"></a><span id="l19.120" class="difflineplus">+  });</span>
<a href="#l19.121"></a><span id="l19.121">   // SMTP server row: can't be removed, can't be default.</span>
<a href="#l19.122"></a><span id="l19.122" class="difflineminus">-  subtest_check_account_actions(null, false, false, true);</span>
<a href="#l19.123"></a><span id="l19.123" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l19.124"></a><span id="l19.124" class="difflineplus">+    subtest_check_account_actions(amc, null, false, false, true);</span>
<a href="#l19.125"></a><span id="l19.125" class="difflineplus">+  });</span>
<a href="#l19.126"></a><span id="l19.126"> </span>
<a href="#l19.127"></a><span id="l19.127">   // on the IMAP account, disable Delete Account menu item</span>
<a href="#l19.128"></a><span id="l19.128">   let disableItemPref = &quot;mail.disable_button.delete_account&quot;;</span>
<a href="#l19.129"></a><span id="l19.129"> </span>
<a href="#l19.130"></a><span id="l19.130">   // Set the pref on the default branch, otherwise .getBoolPref on it throws.</span>
<a href="#l19.131"></a><span id="l19.131">   Services.prefs.getDefaultBranch(&quot;&quot;).setBoolPref(disableItemPref, true);</span>
<a href="#l19.132"></a><span id="l19.132">   Services.prefs.lockPref(disableItemPref);</span>
<a href="#l19.133"></a><span id="l19.133"> </span>
<a href="#l19.134"></a><span id="l19.134" class="difflineminus">-  subtest_check_account_actions(imapAccount.key, true, false, true);</span>
<a href="#l19.135"></a><span id="l19.135" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l19.136"></a><span id="l19.136" class="difflineplus">+    subtest_check_account_actions(amc, imapAccount.key, true, false, true);</span>
<a href="#l19.137"></a><span id="l19.137" class="difflineplus">+  });</span>
<a href="#l19.138"></a><span id="l19.138"> </span>
<a href="#l19.139"></a><span id="l19.139">   Services.prefs.unlockPref(disableItemPref);</span>
<a href="#l19.140"></a><span id="l19.140">   Services.prefs.getDefaultBranch(&quot;&quot;).deleteBranch(disableItemPref);</span>
<a href="#l19.141"></a><span id="l19.141"> </span>
<a href="#l19.142"></a><span id="l19.142">   // on the IMAP account, disable Set as Default menu item</span>
<a href="#l19.143"></a><span id="l19.143">   disableItemPref = &quot;mail.disable_button.set_default_account&quot;;</span>
<a href="#l19.144"></a><span id="l19.144"> </span>
<a href="#l19.145"></a><span id="l19.145">   Services.prefs.getDefaultBranch(&quot;&quot;).setBoolPref(disableItemPref, true);</span>
<a href="#l19.146"></a><span id="l19.146">   Services.prefs.lockPref(disableItemPref);</span>
<a href="#l19.147"></a><span id="l19.147"> </span>
<a href="#l19.148"></a><span id="l19.148" class="difflineminus">-  subtest_check_account_actions(imapAccount.key, false, true, true);</span>
<a href="#l19.149"></a><span id="l19.149" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l19.150"></a><span id="l19.150" class="difflineplus">+    subtest_check_account_actions(amc, imapAccount.key, false, true, true);</span>
<a href="#l19.151"></a><span id="l19.151" class="difflineplus">+  });</span>
<a href="#l19.152"></a><span id="l19.152"> </span>
<a href="#l19.153"></a><span id="l19.153">   Services.prefs.unlockPref(disableItemPref);</span>
<a href="#l19.154"></a><span id="l19.154">   Services.prefs.getDefaultBranch(&quot;&quot;).deleteBranch(disableItemPref);</span>
<a href="#l19.155"></a><span id="l19.155"> </span>
<a href="#l19.156"></a><span id="l19.156">   // on the IMAP account, disable Add new Account menu items</span>
<a href="#l19.157"></a><span id="l19.157">   disableItemPref = &quot;mail.disable_new_account_addition&quot;;</span>
<a href="#l19.158"></a><span id="l19.158"> </span>
<a href="#l19.159"></a><span id="l19.159">   Services.prefs.getDefaultBranch(&quot;&quot;).setBoolPref(disableItemPref, true);</span>
<a href="#l19.160"></a><span id="l19.160">   Services.prefs.lockPref(disableItemPref);</span>
<a href="#l19.161"></a><span id="l19.161"> </span>
<a href="#l19.162"></a><span id="l19.162" class="difflineminus">-  subtest_check_account_actions(imapAccount.key, true, true, false);</span>
<a href="#l19.163"></a><span id="l19.163" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l19.164"></a><span id="l19.164" class="difflineplus">+    subtest_check_account_actions(amc, imapAccount.key, true, true, false);</span>
<a href="#l19.165"></a><span id="l19.165" class="difflineplus">+  });</span>
<a href="#l19.166"></a><span id="l19.166"> </span>
<a href="#l19.167"></a><span id="l19.167">   Services.prefs.unlockPref(disableItemPref);</span>
<a href="#l19.168"></a><span id="l19.168">   Services.prefs.getDefaultBranch(&quot;&quot;).deleteBranch(disableItemPref);</span>
<a href="#l19.169"></a><span id="l19.169"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-deletion.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-deletion.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -4,30 +4,22 @@</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> /**</span>
<a href="#l20.6"></a><span id="l20.6">  * This test checks proper deletion of an account from the Account manager.</span>
<a href="#l20.7"></a><span id="l20.7">  */</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> &quot;use strict&quot;;</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11"> /* import-globals-from ../shared-modules/test-account-manager-helpers.js */</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-/* import-globals-from ../shared-modules/test-content-tab-helpers.js */</span>
<a href="#l20.13"></a><span id="l20.13"> /* import-globals-from ../shared-modules/test-folder-display-helpers.js */</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-/* import-globals-from ../shared-modules/test-pref-window-helpers.js */</span>
<a href="#l20.15"></a><span id="l20.15"> /* import-globals-from ../shared-modules/test-window-helpers.js */</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17"> var MODULE_NAME = &quot;test-account-deletion&quot;;</span>
<a href="#l20.18"></a><span id="l20.18"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-var MODULE_REQUIRES = [</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-  &quot;folder-display-helpers&quot;,</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-  &quot;window-helpers&quot;,</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineminus">-  &quot;account-manager-helpers&quot;,</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">-  &quot;content-tab-helpers&quot;,</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-  &quot;pref-window-helpers&quot;,</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">-];</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;window-helpers&quot;, &quot;account-manager-helpers&quot;];</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28"> var gPopAccount, gImapAccount, gNntpAccount, gOriginalAccountCount;</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30"> function setupModule(module) {</span>
<a href="#l20.31"></a><span id="l20.31">   for (let lib of MODULE_REQUIRES) {</span>
<a href="#l20.32"></a><span id="l20.32">     collector.getModule(lib).installInto(module);</span>
<a href="#l20.33"></a><span id="l20.33">   }</span>
<a href="#l20.34"></a><span id="l20.34"> </span>
<a href="#l20.35"></a><span id="l20.35" class="difflineat">@@ -61,51 +53,55 @@ function setupModule(module) {</span>
<a href="#l20.36"></a><span id="l20.36">   assert_equals(MailServices.accounts.allServers.length, gOriginalAccountCount + 2);</span>
<a href="#l20.37"></a><span id="l20.37"> }</span>
<a href="#l20.38"></a><span id="l20.38"> </span>
<a href="#l20.39"></a><span id="l20.39"> function teardownModule(module) {</span>
<a href="#l20.40"></a><span id="l20.40">   // There should be only the original accounts left.</span>
<a href="#l20.41"></a><span id="l20.41">   assert_equals(MailServices.accounts.allServers.length, gOriginalAccountCount);</span>
<a href="#l20.42"></a><span id="l20.42"> }</span>
<a href="#l20.43"></a><span id="l20.43"> </span>
<a href="#l20.44"></a><span id="l20.44" class="difflineplus">+function test_account_data_deletion() {</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+    subtest_account_data_deletion1(amc);</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+  });</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+    subtest_account_data_deletion2(amc);</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+  });</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineplus">+}</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineplus">+</span>
<a href="#l20.54"></a><span id="l20.54"> /**</span>
<a href="#l20.55"></a><span id="l20.55">  * Bug 274452</span>
<a href="#l20.56"></a><span id="l20.56">  * Check if files of an account are preserved.</span>
<a href="#l20.57"></a><span id="l20.57">  *</span>
<a href="#l20.58"></a><span id="l20.58">  * @param amc  The account options controller.</span>
<a href="#l20.59"></a><span id="l20.59">  */</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-function test_account_data_deletion1() {</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+function subtest_account_data_deletion1(amc) {</span>
<a href="#l20.63"></a><span id="l20.63">   let accountDir = gPopAccount.incomingServer.localPath;</span>
<a href="#l20.64"></a><span id="l20.64">   assert_true(accountDir.isDirectory());</span>
<a href="#l20.65"></a><span id="l20.65"> </span>
<a href="#l20.66"></a><span id="l20.66">   // Get some existing file in the POP3 account data dir.</span>
<a href="#l20.67"></a><span id="l20.67">   let inboxFile = accountDir.clone();</span>
<a href="#l20.68"></a><span id="l20.68">   inboxFile.append(&quot;Inbox.msf&quot;);</span>
<a href="#l20.69"></a><span id="l20.69">   assert_true(inboxFile.isFile());</span>
<a href="#l20.70"></a><span id="l20.70"> </span>
<a href="#l20.71"></a><span id="l20.71" class="difflineminus">-  remove_account(gPopAccount, tab, true, false);</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineplus">+  remove_account(gPopAccount, amc, true, false);</span>
<a href="#l20.73"></a><span id="l20.73">   assert_true(accountDir.exists());</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l20.76"></a><span id="l20.76"> }</span>
<a href="#l20.77"></a><span id="l20.77"> </span>
<a href="#l20.78"></a><span id="l20.78"> /**</span>
<a href="#l20.79"></a><span id="l20.79">  * Bug 274452</span>
<a href="#l20.80"></a><span id="l20.80">  * Check if files of an account can be deleted.</span>
<a href="#l20.81"></a><span id="l20.81">  *</span>
<a href="#l20.82"></a><span id="l20.82">  * @param amc  The account options controller.</span>
<a href="#l20.83"></a><span id="l20.83">  */</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineminus">-function test_account_data_deletion2() {</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineplus">+function subtest_account_data_deletion2(amc) {</span>
<a href="#l20.87"></a><span id="l20.87">   let accountDir = gImapAccount.incomingServer.localPath;</span>
<a href="#l20.88"></a><span id="l20.88">   assert_true(accountDir.isDirectory());</span>
<a href="#l20.89"></a><span id="l20.89"> </span>
<a href="#l20.90"></a><span id="l20.90">   // Get some file in the IMAP account data dir.</span>
<a href="#l20.91"></a><span id="l20.91">   let inboxFile = accountDir.clone();</span>
<a href="#l20.92"></a><span id="l20.92">   inboxFile.append(&quot;INBOX.msf&quot;);</span>
<a href="#l20.93"></a><span id="l20.93">   assert_true(inboxFile.isFile());</span>
<a href="#l20.94"></a><span id="l20.94"> </span>
<a href="#l20.95"></a><span id="l20.95" class="difflineminus">-  remove_account(gImapAccount, tab, true, true);</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineplus">+  remove_account(gImapAccount, amc, true, true);</span>
<a href="#l20.97"></a><span id="l20.97">   assert_false(accountDir.exists());</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineminus">-</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l20.100"></a><span id="l20.100"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-port-setting.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-port-setting.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,79 +1,78 @@</span>
<a href="#l21.4"></a><span id="l21.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.5"></a><span id="l21.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.6"></a><span id="l21.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> &quot;use strict&quot;;</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10"> /* import-globals-from ../shared-modules/test-account-manager-helpers.js */</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineminus">-/* import-globals-from ../shared-modules/test-content-tab-helpers.js */</span>
<a href="#l21.12"></a><span id="l21.12"> /* import-globals-from ../shared-modules/test-folder-display-helpers.js */</span>
<a href="#l21.13"></a><span id="l21.13"> /* import-globals-from ../shared-modules/test-keyboard-helpers.js */</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-/* import-globals-from ../shared-modules/test-pref-window-helpers.js */</span>
<a href="#l21.15"></a><span id="l21.15"> /* import-globals-from ../shared-modules/test-window-helpers.js */</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17"> var MODULE_NAME = &quot;test-account-port-setting&quot;;</span>
<a href="#l21.18"></a><span id="l21.18"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l21.19"></a><span id="l21.19"> var MODULE_REQUIRES = [</span>
<a href="#l21.20"></a><span id="l21.20">   &quot;folder-display-helpers&quot;,</span>
<a href="#l21.21"></a><span id="l21.21">   &quot;window-helpers&quot;,</span>
<a href="#l21.22"></a><span id="l21.22">   &quot;account-manager-helpers&quot;,</span>
<a href="#l21.23"></a><span id="l21.23">   &quot;keyboard-helpers&quot;,</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">-  &quot;content-tab-helpers&quot;,</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineminus">-  &quot;pref-window-helpers&quot;,</span>
<a href="#l21.26"></a><span id="l21.26"> ];</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28"> var elib = ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.jsm&quot;);</span>
<a href="#l21.29"></a><span id="l21.29"> </span>
<a href="#l21.30"></a><span id="l21.30"> var PORT_NUMBERS_TO_TEST =</span>
<a href="#l21.31"></a><span id="l21.31">   [</span>
<a href="#l21.32"></a><span id="l21.32">     &quot;110&quot;, // The original port number. We don't input this though.</span>
<a href="#l21.33"></a><span id="l21.33">     &quot;456&quot;, // Random port number.</span>
<a href="#l21.34"></a><span id="l21.34">     &quot;995&quot;, // The SSL port number.</span>
<a href="#l21.35"></a><span id="l21.35">     &quot;110&quot;, // Back to the original.</span>
<a href="#l21.36"></a><span id="l21.36">   ];</span>
<a href="#l21.37"></a><span id="l21.37"> </span>
<a href="#l21.38"></a><span id="l21.38"> var gTestNumber;</span>
<a href="#l21.39"></a><span id="l21.39"> </span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">-function setupModule(module) {</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineminus">-  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineminus">-    collector.getModule(lib).installInto(module);</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineminus">-  }</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-}</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineminus">-</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-function subtest_check_set_port_number(aDontSet) {</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+function subtest_check_set_port_number(amc, aDontSet) {</span>
<a href="#l21.48"></a><span id="l21.48">   // This test expects the following POP account to exist by default</span>
<a href="#l21.49"></a><span id="l21.49">   // with port number 110 and no security.</span>
<a href="#l21.50"></a><span id="l21.50">   let server = MailServices.accounts</span>
<a href="#l21.51"></a><span id="l21.51">                            .FindServer(&quot;tinderbox&quot;, FAKE_SERVER_HOSTNAME, &quot;pop3&quot;);</span>
<a href="#l21.52"></a><span id="l21.52">   let account = MailServices.accounts.FindAccountForServer(server);</span>
<a href="#l21.53"></a><span id="l21.53"> </span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-  let accountRow = get_account_tree_row(account.key, &quot;am-server.xul&quot;, tab);</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+  let accountRow = get_account_tree_row(account.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l21.59"></a><span id="l21.59"> </span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l21.62"></a><span id="l21.62">   let portElem = iframe.contentDocument.getElementById(&quot;server.port&quot;);</span>
<a href="#l21.63"></a><span id="l21.63">   portElem.focus();</span>
<a href="#l21.64"></a><span id="l21.64"> </span>
<a href="#l21.65"></a><span id="l21.65">   if (portElem.value != PORT_NUMBERS_TO_TEST[gTestNumber - 1])</span>
<a href="#l21.66"></a><span id="l21.66">     throw new Error(&quot;Port Value is not &quot; +</span>
<a href="#l21.67"></a><span id="l21.67">                     PORT_NUMBERS_TO_TEST[gTestNumber - 1] +</span>
<a href="#l21.68"></a><span id="l21.68">                     &quot; as expected, it is: &quot; + portElem.value);</span>
<a href="#l21.69"></a><span id="l21.69"> </span>
<a href="#l21.70"></a><span id="l21.70">   if (!aDontSet) {</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">-    delete_all_existing(mc, new elib.Elem(portElem));</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineminus">-    input_value(mc, PORT_NUMBERS_TO_TEST[gTestNumber]);</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+    delete_all_existing(amc, new elib.Elem(portElem));</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+    input_value(amc, PORT_NUMBERS_TO_TEST[gTestNumber]);</span>
<a href="#l21.75"></a><span id="l21.75"> </span>
<a href="#l21.76"></a><span id="l21.76">     mc.sleep(0);</span>
<a href="#l21.77"></a><span id="l21.77">   }</span>
<a href="#l21.78"></a><span id="l21.78"> </span>
<a href="#l21.79"></a><span id="l21.79" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+  mc.click(new elib.Elem(amc.window.document.getElementById(&quot;accountManager&quot;).getButton(&quot;accept&quot;)));</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineplus">+}</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+function subtest_check_port_number(amc) {</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+  subtest_check_set_port_number(amc, true);</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineplus">+}</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineplus">+</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineplus">+function setupModule(module) {</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineplus">+  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineplus">+    collector.getModule(lib).installInto(module);</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+  }</span>
<a href="#l21.91"></a><span id="l21.91"> }</span>
<a href="#l21.92"></a><span id="l21.92"> </span>
<a href="#l21.93"></a><span id="l21.93"> function test_account_port_setting() {</span>
<a href="#l21.94"></a><span id="l21.94">   for (gTestNumber = 1; gTestNumber &lt; PORT_NUMBERS_TO_TEST.length; ++gTestNumber) {</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineminus">-    subtest_check_set_port_number(false);</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+    open_advanced_settings(subtest_check_set_port_number);</span>
<a href="#l21.97"></a><span id="l21.97">   }</span>
<a href="#l21.98"></a><span id="l21.98"> </span>
<a href="#l21.99"></a><span id="l21.99" class="difflineminus">-  subtest_check_set_port_number(true);</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineplus">+  open_advanced_settings(subtest_check_port_number);</span>
<a href="#l21.101"></a><span id="l21.101"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-settings-infrastructure.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-settings-infrastructure.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -8,39 +8,31 @@</span>
<a href="#l22.4"></a><span id="l22.4">  * panes are switched.</span>
<a href="#l22.5"></a><span id="l22.5">  *</span>
<a href="#l22.6"></a><span id="l22.6">  * New checks can be added to it as needed.</span>
<a href="#l22.7"></a><span id="l22.7">  */</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9"> &quot;use strict&quot;;</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11"> /* import-globals-from ../shared-modules/test-account-manager-helpers.js */</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-/* import-globals-from ../shared-modules/test-content-tab-helpers.js */</span>
<a href="#l22.13"></a><span id="l22.13"> /* import-globals-from ../shared-modules/test-folder-display-helpers.js */</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-/* import-globals-from ../shared-modules/test-pref-window-helpers.js */</span>
<a href="#l22.15"></a><span id="l22.15"> /* import-globals-from ../shared-modules/test-window-helpers.js */</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17"> var MODULE_NAME = &quot;test-account-settings-infrastructure&quot;;</span>
<a href="#l22.18"></a><span id="l22.18"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-var MODULE_REQUIRES = [</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-  &quot;folder-display-helpers&quot;,</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">-  &quot;window-helpers&quot;,</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">-  &quot;account-manager-helpers&quot;,</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineminus">-  &quot;content-tab-helpers&quot;,</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">-  &quot;pref-window-helpers&quot;,</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">-];</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;window-helpers&quot;, &quot;account-manager-helpers&quot;];</span>
<a href="#l22.27"></a><span id="l22.27"> </span>
<a href="#l22.28"></a><span id="l22.28"> var elib = ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.jsm&quot;);</span>
<a href="#l22.29"></a><span id="l22.29"> </span>
<a href="#l22.30"></a><span id="l22.30"> var gPopAccount, gImapAccount, gOriginalAccountCount;</span>
<a href="#l22.31"></a><span id="l22.31"> </span>
<a href="#l22.32"></a><span id="l22.32"> function setupModule(module) {</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">-  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineminus">-    collector.getModule(lib).installInto(module);</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">-  }</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineplus">+  collector.getModule(&quot;window-helpers&quot;).installInto(module);</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+  collector.getModule(&quot;folder-display-helpers&quot;).installInto(module);</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+  collector.getModule(&quot;account-manager-helpers&quot;).installInto(module);</span>
<a href="#l22.39"></a><span id="l22.39"> </span>
<a href="#l22.40"></a><span id="l22.40">   // There may be pre-existing accounts from other tests.</span>
<a href="#l22.41"></a><span id="l22.41">   gOriginalAccountCount = MailServices.accounts.allServers.length;</span>
<a href="#l22.42"></a><span id="l22.42"> </span>
<a href="#l22.43"></a><span id="l22.43">   // Create a POP server</span>
<a href="#l22.44"></a><span id="l22.44">   let popServer = MailServices.accounts</span>
<a href="#l22.45"></a><span id="l22.45">     .createIncomingServer(&quot;nobody&quot;, &quot;pop.invalid&quot;, &quot;pop3&quot;)</span>
<a href="#l22.46"></a><span id="l22.46">     .QueryInterface(Ci.nsIPop3IncomingServer);</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineat">@@ -76,133 +68,151 @@ function teardownModule(module) {</span>
<a href="#l22.48"></a><span id="l22.48">   // There should be only the original accounts left.</span>
<a href="#l22.49"></a><span id="l22.49">   assert_equals(MailServices.accounts.allServers.length, gOriginalAccountCount);</span>
<a href="#l22.50"></a><span id="l22.50"> }</span>
<a href="#l22.51"></a><span id="l22.51"> </span>
<a href="#l22.52"></a><span id="l22.52"> /**</span>
<a href="#l22.53"></a><span id="l22.53">  * Bug 525024.</span>
<a href="#l22.54"></a><span id="l22.54">  * Check that the options in the server pane are properly preserved across</span>
<a href="#l22.55"></a><span id="l22.55">  * pane switches.</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineminus">- *</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineplus">+ */</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineplus">+function test_account_dot_IDs() {</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineplus">+    subtest_check_account_dot_IDs(amc);</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineplus">+  });</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineplus">+}</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineplus">+</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineplus">+/**</span>
<a href="#l22.65"></a><span id="l22.65">  * Check that the options in the server pane are stored even if the id</span>
<a href="#l22.66"></a><span id="l22.66">  * of the element contains multiple dots (not used in standard TB yet</span>
<a href="#l22.67"></a><span id="l22.67">  * but extensions may want it).</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineplus">+ *</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineplus">+ * @param amc  the account options controller</span>
<a href="#l22.70"></a><span id="l22.70">  */</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineminus">-function test_account_dot_IDs() {</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineminus">-  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, tab);</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.75"></a><span id="l22.75" class="difflineplus">+function subtest_check_account_dot_IDs(amc) {</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineplus">+  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.78"></a><span id="l22.78"> </span>
<a href="#l22.79"></a><span id="l22.79" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineplus">+  let iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.81"></a><span id="l22.81">   // Check whether a standard element with &quot;server.loginAtStartUp&quot; stores its</span>
<a href="#l22.82"></a><span id="l22.82">   // value properly.</span>
<a href="#l22.83"></a><span id="l22.83">   let loginCheck = iframe.getElementById(&quot;server.loginAtStartUp&quot;);</span>
<a href="#l22.84"></a><span id="l22.84">   assert_false(loginCheck.checked);</span>
<a href="#l22.85"></a><span id="l22.85" class="difflineminus">-  mc.check(new elib.Elem(loginCheck), true);</span>
<a href="#l22.86"></a><span id="l22.86" class="difflineplus">+  amc.check(new elib.Elem(loginCheck), true);</span>
<a href="#l22.87"></a><span id="l22.87"> </span>
<a href="#l22.88"></a><span id="l22.88" class="difflineminus">-  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineplus">+  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l22.91"></a><span id="l22.91" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.92"></a><span id="l22.92"> </span>
<a href="#l22.93"></a><span id="l22.93" class="difflineminus">-  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, tab);</span>
<a href="#l22.94"></a><span id="l22.94" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.95"></a><span id="l22.95" class="difflineplus">+  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l22.96"></a><span id="l22.96" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.97"></a><span id="l22.97"> </span>
<a href="#l22.98"></a><span id="l22.98">   // Re-assign iframe.contentDocument because it was lost when changing panes</span>
<a href="#l22.99"></a><span id="l22.99">   // (uses loadURI to load a new document).</span>
<a href="#l22.100"></a><span id="l22.100" class="difflineminus">-  iframe = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.101"></a><span id="l22.101" class="difflineplus">+  iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.102"></a><span id="l22.102"> </span>
<a href="#l22.103"></a><span id="l22.103">   // Check by element properties.</span>
<a href="#l22.104"></a><span id="l22.104">   loginCheck = iframe.getElementById(&quot;server.loginAtStartUp&quot;);</span>
<a href="#l22.105"></a><span id="l22.105">   assert_true(loginCheck.checked);</span>
<a href="#l22.106"></a><span id="l22.106"> </span>
<a href="#l22.107"></a><span id="l22.107">   // Check for correct value in the accountValues array, that will be saved into prefs.</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineminus">-  let rawCheckValue = tab.browser.contentWindow.getAccountValue(gPopAccount,</span>
<a href="#l22.109"></a><span id="l22.109" class="difflineminus">-                        tab.browser.contentWindow.getValueArrayFor(gPopAccount),</span>
<a href="#l22.110"></a><span id="l22.110" class="difflineminus">-                        &quot;server&quot;, &quot;loginAtStartUp&quot;,</span>
<a href="#l22.111"></a><span id="l22.111" class="difflineminus">-                        null, false);</span>
<a href="#l22.112"></a><span id="l22.112" class="difflineplus">+  let rawCheckValue = amc.window.getAccountValue(gPopAccount,</span>
<a href="#l22.113"></a><span id="l22.113" class="difflineplus">+                                                 amc.window.getValueArrayFor(gPopAccount),</span>
<a href="#l22.114"></a><span id="l22.114" class="difflineplus">+                                                 &quot;server&quot;, &quot;loginAtStartUp&quot;,</span>
<a href="#l22.115"></a><span id="l22.115" class="difflineplus">+                                                 null, false);</span>
<a href="#l22.116"></a><span id="l22.116"> </span>
<a href="#l22.117"></a><span id="l22.117">   assert_true(rawCheckValue);</span>
<a href="#l22.118"></a><span id="l22.118"> </span>
<a href="#l22.119"></a><span id="l22.119">   // The &quot;server.login.At.StartUp&quot; value does not exist yet, so the value should be 'null'.</span>
<a href="#l22.120"></a><span id="l22.120" class="difflineminus">-  rawCheckValue = tab.browser.contentWindow.getAccountValue(gPopAccount,</span>
<a href="#l22.121"></a><span id="l22.121" class="difflineminus">-                    tab.browser.contentWindow.getValueArrayFor(gPopAccount),</span>
<a href="#l22.122"></a><span id="l22.122" class="difflineminus">-                    &quot;server&quot;, &quot;login.At.StartUp&quot;,</span>
<a href="#l22.123"></a><span id="l22.123" class="difflineminus">-                    null, false);</span>
<a href="#l22.124"></a><span id="l22.124" class="difflineplus">+  rawCheckValue = amc.window.getAccountValue(gPopAccount,</span>
<a href="#l22.125"></a><span id="l22.125" class="difflineplus">+                                             amc.window.getValueArrayFor(gPopAccount),</span>
<a href="#l22.126"></a><span id="l22.126" class="difflineplus">+                                             &quot;server&quot;, &quot;login.At.StartUp&quot;,</span>
<a href="#l22.127"></a><span id="l22.127" class="difflineplus">+                                             null, false);</span>
<a href="#l22.128"></a><span id="l22.128">   assert_equals(rawCheckValue, null);</span>
<a href="#l22.129"></a><span id="l22.129"> </span>
<a href="#l22.130"></a><span id="l22.130">   // Change the ID so that &quot;server.login.At.StartUp&quot; exists now.</span>
<a href="#l22.131"></a><span id="l22.131">   loginCheck.id = &quot;server.login.At.StartUp&quot;;</span>
<a href="#l22.132"></a><span id="l22.132"> </span>
<a href="#l22.133"></a><span id="l22.133" class="difflineminus">-  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l22.134"></a><span id="l22.134" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.135"></a><span id="l22.135" class="difflineplus">+  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l22.136"></a><span id="l22.136" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.137"></a><span id="l22.137"> </span>
<a href="#l22.138"></a><span id="l22.138" class="difflineminus">-  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, tab);</span>
<a href="#l22.139"></a><span id="l22.139" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.140"></a><span id="l22.140" class="difflineplus">+  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l22.141"></a><span id="l22.141" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.142"></a><span id="l22.142"> </span>
<a href="#l22.143"></a><span id="l22.143">   // Check for correct value in the accountValues array, that will be saved into prefs.</span>
<a href="#l22.144"></a><span id="l22.144">   // We can't check by element property here, because the am-server.xul pane was</span>
<a href="#l22.145"></a><span id="l22.145">   // reloaded and the element now has the original ID of &quot;server.loginAtStartUp&quot;.</span>
<a href="#l22.146"></a><span id="l22.146" class="difflineminus">-  rawCheckValue = tab.browser.contentWindow.getAccountValue(gPopAccount,</span>
<a href="#l22.147"></a><span id="l22.147" class="difflineminus">-                    tab.browser.contentWindow.getValueArrayFor(gPopAccount),</span>
<a href="#l22.148"></a><span id="l22.148" class="difflineminus">-                    &quot;server&quot;, &quot;login.At.StartUp&quot;,</span>
<a href="#l22.149"></a><span id="l22.149" class="difflineminus">-                    null, false);</span>
<a href="#l22.150"></a><span id="l22.150" class="difflineplus">+  rawCheckValue = amc.window.getAccountValue(gPopAccount,</span>
<a href="#l22.151"></a><span id="l22.151" class="difflineplus">+                                             amc.window.getValueArrayFor(gPopAccount),</span>
<a href="#l22.152"></a><span id="l22.152" class="difflineplus">+                                             &quot;server&quot;, &quot;login.At.StartUp&quot;,</span>
<a href="#l22.153"></a><span id="l22.153" class="difflineplus">+                                             null, false);</span>
<a href="#l22.154"></a><span id="l22.154"> </span>
<a href="#l22.155"></a><span id="l22.155">   assert_true(rawCheckValue);</span>
<a href="#l22.156"></a><span id="l22.156" class="difflineminus">-</span>
<a href="#l22.157"></a><span id="l22.157" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l22.158"></a><span id="l22.158"> }</span>
<a href="#l22.159"></a><span id="l22.159"> </span>
<a href="#l22.160"></a><span id="l22.160"> /**</span>
<a href="#l22.161"></a><span id="l22.161">  * Test for bug 807101.</span>
<a href="#l22.162"></a><span id="l22.162">  * Check if form controls are properly disabled when their attached prefs are locked.</span>
<a href="#l22.163"></a><span id="l22.163" class="difflineminus">- *</span>
<a href="#l22.164"></a><span id="l22.164" class="difflineplus">+ */</span>
<a href="#l22.165"></a><span id="l22.165" class="difflineplus">+function test_account_locked_prefs() {</span>
<a href="#l22.166"></a><span id="l22.166" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l22.167"></a><span id="l22.167" class="difflineplus">+    subtest_check_locked_prefs_addressing(amc);</span>
<a href="#l22.168"></a><span id="l22.168" class="difflineplus">+  });</span>
<a href="#l22.169"></a><span id="l22.169" class="difflineplus">+</span>
<a href="#l22.170"></a><span id="l22.170" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l22.171"></a><span id="l22.171" class="difflineplus">+    subtest_check_locked_prefs_server(amc);</span>
<a href="#l22.172"></a><span id="l22.172" class="difflineplus">+  });</span>
<a href="#l22.173"></a><span id="l22.173" class="difflineplus">+}</span>
<a href="#l22.174"></a><span id="l22.174" class="difflineplus">+</span>
<a href="#l22.175"></a><span id="l22.175" class="difflineplus">+/**</span>
<a href="#l22.176"></a><span id="l22.176">  * Check that the LDAP server selection elements (radio group) are properly</span>
<a href="#l22.177"></a><span id="l22.177">  * disabled when their attached pref (prefstring attribute) is locked.</span>
<a href="#l22.178"></a><span id="l22.178" class="difflineplus">+ *</span>
<a href="#l22.179"></a><span id="l22.179" class="difflineplus">+ * @param amc  the account options controller</span>
<a href="#l22.180"></a><span id="l22.180">  */</span>
<a href="#l22.181"></a><span id="l22.181" class="difflineminus">-function test_locked_prefs_addressing() {</span>
<a href="#l22.182"></a><span id="l22.182" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l22.183"></a><span id="l22.183" class="difflineminus">-  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-addressing.xul&quot;, tab);</span>
<a href="#l22.184"></a><span id="l22.184" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.185"></a><span id="l22.185" class="difflineplus">+function subtest_check_locked_prefs_addressing(amc) {</span>
<a href="#l22.186"></a><span id="l22.186" class="difflineplus">+  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-addressing.xul&quot;, amc);</span>
<a href="#l22.187"></a><span id="l22.187" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.188"></a><span id="l22.188"> </span>
<a href="#l22.189"></a><span id="l22.189" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.190"></a><span id="l22.190" class="difflineplus">+  let iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.191"></a><span id="l22.191"> </span>
<a href="#l22.192"></a><span id="l22.192">   // By default, 'use global LDAP server preferences' is set, not the</span>
<a href="#l22.193"></a><span id="l22.193">   // 'different LDAP server'.</span>
<a href="#l22.194"></a><span id="l22.194">   let useLDAPdirectory = iframe.getElementById(&quot;directories&quot;);</span>
<a href="#l22.195"></a><span id="l22.195">   assert_false(useLDAPdirectory.selected);</span>
<a href="#l22.196"></a><span id="l22.196"> </span>
<a href="#l22.197"></a><span id="l22.197">   // So the server selector is disabled.</span>
<a href="#l22.198"></a><span id="l22.198">   let LDAPdirectory = iframe.getElementById(&quot;identity.directoryServer&quot;);</span>
<a href="#l22.199"></a><span id="l22.199">   assert_true(LDAPdirectory.disabled);</span>
<a href="#l22.200"></a><span id="l22.200"> </span>
<a href="#l22.201"></a><span id="l22.201">   // And the Edit button too.</span>
<a href="#l22.202"></a><span id="l22.202">   let LDAPeditButton = iframe.getElementById(&quot;editButton&quot;);</span>
<a href="#l22.203"></a><span id="l22.203">   assert_true(LDAPeditButton.disabled);</span>
<a href="#l22.204"></a><span id="l22.204"> </span>
<a href="#l22.205"></a><span id="l22.205">   // Now toggle the 'different LDAP server' on. The server selector</span>
<a href="#l22.206"></a><span id="l22.206">   // and edit button should enable.</span>
<a href="#l22.207"></a><span id="l22.207" class="difflineminus">-  mc.radio(new elib.Elem(useLDAPdirectory));</span>
<a href="#l22.208"></a><span id="l22.208" class="difflineplus">+  amc.radio(new elib.Elem(useLDAPdirectory));</span>
<a href="#l22.209"></a><span id="l22.209">   assert_false(LDAPdirectory.disabled);</span>
<a href="#l22.210"></a><span id="l22.210">   assert_false(LDAPeditButton.disabled);</span>
<a href="#l22.211"></a><span id="l22.211"> </span>
<a href="#l22.212"></a><span id="l22.212">   // Lock the pref for the server selector.</span>
<a href="#l22.213"></a><span id="l22.213">   let prefstring = LDAPdirectory.getAttribute(&quot;prefstring&quot;);</span>
<a href="#l22.214"></a><span id="l22.214">   let controlPref = prefstring.replace(&quot;%identitykey%&quot;, gPopAccount.defaultIdentity.key);</span>
<a href="#l22.215"></a><span id="l22.215">   Services.prefs.getDefaultBranch(&quot;&quot;).setBoolPref(controlPref, &quot;xxx&quot;);</span>
<a href="#l22.216"></a><span id="l22.216">   Services.prefs.lockPref(controlPref);</span>
<a href="#l22.217"></a><span id="l22.217"> </span>
<a href="#l22.218"></a><span id="l22.218">   // Refresh the pane by switching to another one.</span>
<a href="#l22.219"></a><span id="l22.219" class="difflineminus">-  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l22.220"></a><span id="l22.220" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.221"></a><span id="l22.221" class="difflineplus">+  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l22.222"></a><span id="l22.222" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.223"></a><span id="l22.223"> </span>
<a href="#l22.224"></a><span id="l22.224" class="difflineminus">-  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-addressing.xul&quot;, tab);</span>
<a href="#l22.225"></a><span id="l22.225" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.226"></a><span id="l22.226" class="difflineplus">+  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-addressing.xul&quot;, amc);</span>
<a href="#l22.227"></a><span id="l22.227" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.228"></a><span id="l22.228"> </span>
<a href="#l22.229"></a><span id="l22.229">   // Re-assign iframe.contentDocument because it was lost when changing panes</span>
<a href="#l22.230"></a><span id="l22.230">   // (uses loadURI to load a new document).</span>
<a href="#l22.231"></a><span id="l22.231" class="difflineminus">-  iframe = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.232"></a><span id="l22.232" class="difflineplus">+  iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.233"></a><span id="l22.233"> </span>
<a href="#l22.234"></a><span id="l22.234">   // We are now back and the 'different LDAP server' should still be selected</span>
<a href="#l22.235"></a><span id="l22.235">   // (the setting was saved).</span>
<a href="#l22.236"></a><span id="l22.236">   useLDAPdirectory = iframe.getElementById(&quot;directories&quot;);</span>
<a href="#l22.237"></a><span id="l22.237">   assert_true(useLDAPdirectory.selected);</span>
<a href="#l22.238"></a><span id="l22.238"> </span>
<a href="#l22.239"></a><span id="l22.239">   // But now the server selector should be disabled due to locked pref.</span>
<a href="#l22.240"></a><span id="l22.240">   LDAPdirectory = iframe.getElementById(&quot;identity.directoryServer&quot;);</span>
<a href="#l22.241"></a><span id="l22.241" class="difflineat">@@ -210,76 +220,72 @@ function test_locked_prefs_addressing() </span>
<a href="#l22.242"></a><span id="l22.242"> </span>
<a href="#l22.243"></a><span id="l22.243">   // The edit button still enabled (does not depend on the same pref lock)</span>
<a href="#l22.244"></a><span id="l22.244">   LDAPeditButton = iframe.getElementById(&quot;editButton&quot;);</span>
<a href="#l22.245"></a><span id="l22.245">   assert_false(LDAPeditButton.disabled);</span>
<a href="#l22.246"></a><span id="l22.246"> </span>
<a href="#l22.247"></a><span id="l22.247">   // Unlock the pref to clean up.</span>
<a href="#l22.248"></a><span id="l22.248">   Services.prefs.unlockPref(controlPref);</span>
<a href="#l22.249"></a><span id="l22.249">   Services.prefs.getDefaultBranch(&quot;&quot;).deleteBranch(controlPref);</span>
<a href="#l22.250"></a><span id="l22.250" class="difflineminus">-</span>
<a href="#l22.251"></a><span id="l22.251" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l22.252"></a><span id="l22.252"> }</span>
<a href="#l22.253"></a><span id="l22.253"> </span>
<a href="#l22.254"></a><span id="l22.254"> /**</span>
<a href="#l22.255"></a><span id="l22.255" class="difflineminus">- * Test for bug 807101.</span>
<a href="#l22.256"></a><span id="l22.256" class="difflineminus">- * Check if form controls are properly disabled when their attached prefs are locked.</span>
<a href="#l22.257"></a><span id="l22.257" class="difflineminus">- *</span>
<a href="#l22.258"></a><span id="l22.258">  * Check that the POP3 'keep on server' settings elements (2-level</span>
<a href="#l22.259"></a><span id="l22.259">  * checkboxes + textbox) are properly disabled when their attached pref</span>
<a href="#l22.260"></a><span id="l22.260">  * (prefstring attribute) is locked.</span>
<a href="#l22.261"></a><span id="l22.261" class="difflineplus">+ *</span>
<a href="#l22.262"></a><span id="l22.262" class="difflineplus">+ * @param amc  the account options controller</span>
<a href="#l22.263"></a><span id="l22.263">  */</span>
<a href="#l22.264"></a><span id="l22.264" class="difflineminus">-function test_locked_prefs_server() {</span>
<a href="#l22.265"></a><span id="l22.265" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l22.266"></a><span id="l22.266" class="difflineminus">-  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, tab);</span>
<a href="#l22.267"></a><span id="l22.267" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.268"></a><span id="l22.268" class="difflineplus">+function subtest_check_locked_prefs_server(amc) {</span>
<a href="#l22.269"></a><span id="l22.269" class="difflineplus">+  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l22.270"></a><span id="l22.270" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.271"></a><span id="l22.271"> </span>
<a href="#l22.272"></a><span id="l22.272" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.273"></a><span id="l22.273" class="difflineplus">+  let iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.274"></a><span id="l22.274"> </span>
<a href="#l22.275"></a><span id="l22.275">   // Top level leaveOnServer checkbox, disabled by default.</span>
<a href="#l22.276"></a><span id="l22.276">   let leaveOnServer = iframe.getElementById(&quot;pop3.leaveMessagesOnServer&quot;);</span>
<a href="#l22.277"></a><span id="l22.277">   assert_false(leaveOnServer.disabled);</span>
<a href="#l22.278"></a><span id="l22.278">   assert_false(leaveOnServer.checked);</span>
<a href="#l22.279"></a><span id="l22.279"> </span>
<a href="#l22.280"></a><span id="l22.280">   // Second level deleteByAge checkbox, disabled by default.</span>
<a href="#l22.281"></a><span id="l22.281">   let deleteByAge = iframe.getElementById(&quot;pop3.deleteByAgeFromServer&quot;);</span>
<a href="#l22.282"></a><span id="l22.282">   assert_true(deleteByAge.disabled);</span>
<a href="#l22.283"></a><span id="l22.283">   assert_false(deleteByAge.checked);</span>
<a href="#l22.284"></a><span id="l22.284"> </span>
<a href="#l22.285"></a><span id="l22.285">   // Third level daysToLeave textbox, disabled by default.</span>
<a href="#l22.286"></a><span id="l22.286">   let daysToLeave = iframe.getElementById(&quot;pop3.numDaysToLeaveOnServer&quot;);</span>
<a href="#l22.287"></a><span id="l22.287">   assert_true(daysToLeave.disabled);</span>
<a href="#l22.288"></a><span id="l22.288"> </span>
<a href="#l22.289"></a><span id="l22.289">   // When leaveOnServer is checked, only deleteByAge will get enabled.</span>
<a href="#l22.290"></a><span id="l22.290" class="difflineminus">-  mc.check(new elib.Elem(leaveOnServer), true);</span>
<a href="#l22.291"></a><span id="l22.291" class="difflineplus">+  amc.check(new elib.Elem(leaveOnServer), true);</span>
<a href="#l22.292"></a><span id="l22.292">   assert_true(leaveOnServer.checked);</span>
<a href="#l22.293"></a><span id="l22.293">   assert_false(deleteByAge.disabled);</span>
<a href="#l22.294"></a><span id="l22.294">   assert_true(daysToLeave.disabled);</span>
<a href="#l22.295"></a><span id="l22.295"> </span>
<a href="#l22.296"></a><span id="l22.296">   // When deleteByAge is checked, daysToLeave will get enabled.</span>
<a href="#l22.297"></a><span id="l22.297" class="difflineminus">-  mc.check(new elib.Elem(deleteByAge), true);</span>
<a href="#l22.298"></a><span id="l22.298" class="difflineplus">+  amc.check(new elib.Elem(deleteByAge), true);</span>
<a href="#l22.299"></a><span id="l22.299">   assert_true(deleteByAge.checked);</span>
<a href="#l22.300"></a><span id="l22.300">   assert_false(daysToLeave.disabled);</span>
<a href="#l22.301"></a><span id="l22.301"> </span>
<a href="#l22.302"></a><span id="l22.302">   // Lock the pref deleteByAge checkbox (middle of the element hierarchy).</span>
<a href="#l22.303"></a><span id="l22.303">   let prefstring = deleteByAge.getAttribute(&quot;prefstring&quot;);</span>
<a href="#l22.304"></a><span id="l22.304">   let controlPref = prefstring.replace(&quot;%serverkey%&quot;, gPopAccount.incomingServer.key);</span>
<a href="#l22.305"></a><span id="l22.305">   Services.prefs.getDefaultBranch(&quot;&quot;).setBoolPref(controlPref, true);</span>
<a href="#l22.306"></a><span id="l22.306">   Services.prefs.lockPref(controlPref);</span>
<a href="#l22.307"></a><span id="l22.307"> </span>
<a href="#l22.308"></a><span id="l22.308">   // Refresh the pane by switching to another one.</span>
<a href="#l22.309"></a><span id="l22.309" class="difflineminus">-  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l22.310"></a><span id="l22.310" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.311"></a><span id="l22.311" class="difflineplus">+  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l22.312"></a><span id="l22.312" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.313"></a><span id="l22.313"> </span>
<a href="#l22.314"></a><span id="l22.314" class="difflineminus">-  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, tab);</span>
<a href="#l22.315"></a><span id="l22.315" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.316"></a><span id="l22.316" class="difflineplus">+  accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l22.317"></a><span id="l22.317" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.318"></a><span id="l22.318"> </span>
<a href="#l22.319"></a><span id="l22.319">   // Re-assign iframe.contentDocument because it was lost when changing panes</span>
<a href="#l22.320"></a><span id="l22.320">   // (uses loadURI to load a new document).</span>
<a href="#l22.321"></a><span id="l22.321" class="difflineminus">-  iframe = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.322"></a><span id="l22.322" class="difflineplus">+  iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.323"></a><span id="l22.323"> </span>
<a href="#l22.324"></a><span id="l22.324">   // Now leaveOnServer was preserved as checked.</span>
<a href="#l22.325"></a><span id="l22.325">   leaveOnServer = iframe.getElementById(&quot;pop3.leaveMessagesOnServer&quot;);</span>
<a href="#l22.326"></a><span id="l22.326">   assert_false(leaveOnServer.disabled);</span>
<a href="#l22.327"></a><span id="l22.327">   assert_true(leaveOnServer.checked);</span>
<a href="#l22.328"></a><span id="l22.328"> </span>
<a href="#l22.329"></a><span id="l22.329">   // Now deleteByAge was preserved as checked but is locked/disabled.</span>
<a href="#l22.330"></a><span id="l22.330">   deleteByAge = iframe.getElementById(&quot;pop3.deleteByAgeFromServer&quot;);</span>
<a href="#l22.331"></a><span id="l22.331" class="difflineat">@@ -287,101 +293,114 @@ function test_locked_prefs_server() {</span>
<a href="#l22.332"></a><span id="l22.332">   assert_true(deleteByAge.checked);</span>
<a href="#l22.333"></a><span id="l22.333"> </span>
<a href="#l22.334"></a><span id="l22.334">   // Because deleteByAge is checked, daysToLeave should be enabled.</span>
<a href="#l22.335"></a><span id="l22.335">   daysToLeave = iframe.getElementById(&quot;pop3.numDaysToLeaveOnServer&quot;);</span>
<a href="#l22.336"></a><span id="l22.336">   assert_false(daysToLeave.disabled);</span>
<a href="#l22.337"></a><span id="l22.337"> </span>
<a href="#l22.338"></a><span id="l22.338">   // When leaveOnserver is unchecked, both of deleteByAge and daysToLeave</span>
<a href="#l22.339"></a><span id="l22.339">   // should get disabled.</span>
<a href="#l22.340"></a><span id="l22.340" class="difflineminus">-  mc.check(new elib.Elem(leaveOnServer), false);</span>
<a href="#l22.341"></a><span id="l22.341" class="difflineplus">+  amc.check(new elib.Elem(leaveOnServer), false);</span>
<a href="#l22.342"></a><span id="l22.342">   assert_false(leaveOnServer.disabled);</span>
<a href="#l22.343"></a><span id="l22.343">   assert_false(leaveOnServer.checked);</span>
<a href="#l22.344"></a><span id="l22.344"> </span>
<a href="#l22.345"></a><span id="l22.345">   assert_true(deleteByAge.disabled);</span>
<a href="#l22.346"></a><span id="l22.346">   assert_true(deleteByAge.checked);</span>
<a href="#l22.347"></a><span id="l22.347">   assert_true(daysToLeave.disabled);</span>
<a href="#l22.348"></a><span id="l22.348"> </span>
<a href="#l22.349"></a><span id="l22.349">   // Unlock the pref to clean up.</span>
<a href="#l22.350"></a><span id="l22.350">   Services.prefs.unlockPref(controlPref);</span>
<a href="#l22.351"></a><span id="l22.351">   Services.prefs.getDefaultBranch(&quot;&quot;).deleteBranch(controlPref);</span>
<a href="#l22.352"></a><span id="l22.352" class="difflineminus">-</span>
<a href="#l22.353"></a><span id="l22.353" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l22.354"></a><span id="l22.354"> }</span>
<a href="#l22.355"></a><span id="l22.355"> </span>
<a href="#l22.356"></a><span id="l22.356"> /**</span>
<a href="#l22.357"></a><span id="l22.357">  * Bug 530142.</span>
<a href="#l22.358"></a><span id="l22.358">  * Check that that if one field is set to a value, switching directly to another</span>
<a href="#l22.359"></a><span id="l22.359">  * account pane showing the same field really loads the value from the new account,</span>
<a href="#l22.360"></a><span id="l22.360">  * even when empty. This is tested on the Reply-To field.</span>
<a href="#l22.361"></a><span id="l22.361">  */</span>
<a href="#l22.362"></a><span id="l22.362"> function test_replyTo_leak() {</span>
<a href="#l22.363"></a><span id="l22.363" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l22.364"></a><span id="l22.364" class="difflineminus">-  let accountRow = get_account_tree_row(gPopAccount.key, null, tab);</span>
<a href="#l22.365"></a><span id="l22.365" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.366"></a><span id="l22.366" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l22.367"></a><span id="l22.367" class="difflineplus">+    subtest_check_replyTo_leak(amc);</span>
<a href="#l22.368"></a><span id="l22.368" class="difflineplus">+  });</span>
<a href="#l22.369"></a><span id="l22.369" class="difflineplus">+}</span>
<a href="#l22.370"></a><span id="l22.370"> </span>
<a href="#l22.371"></a><span id="l22.371" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l22.372"></a><span id="l22.372" class="difflineplus">+/**</span>
<a href="#l22.373"></a><span id="l22.373" class="difflineplus">+ * @param amc  the account options controller</span>
<a href="#l22.374"></a><span id="l22.374" class="difflineplus">+ */</span>
<a href="#l22.375"></a><span id="l22.375" class="difflineplus">+function subtest_check_replyTo_leak(amc) {</span>
<a href="#l22.376"></a><span id="l22.376" class="difflineplus">+  let accountRow = get_account_tree_row(gPopAccount.key, null, amc);</span>
<a href="#l22.377"></a><span id="l22.377" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.378"></a><span id="l22.378" class="difflineplus">+</span>
<a href="#l22.379"></a><span id="l22.379" class="difflineplus">+  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l22.380"></a><span id="l22.380"> </span>
<a href="#l22.381"></a><span id="l22.381">   // The Reply-To field should be empty.</span>
<a href="#l22.382"></a><span id="l22.382">   let replyAddress = iframe.contentDocument.getElementById(&quot;identity.replyTo&quot;);</span>
<a href="#l22.383"></a><span id="l22.383">   assert_equals(replyAddress.value, &quot;&quot;);</span>
<a href="#l22.384"></a><span id="l22.384"> </span>
<a href="#l22.385"></a><span id="l22.385">   // Now we set a value into it and switch to another account, the main pane.</span>
<a href="#l22.386"></a><span id="l22.386">   replyAddress.value = &quot;somewhere@else.com&quot;;</span>
<a href="#l22.387"></a><span id="l22.387"> </span>
<a href="#l22.388"></a><span id="l22.388">   // This test expects the following POP account to exist by default</span>
<a href="#l22.389"></a><span id="l22.389">   // in the test profile with port number 110 and no security.</span>
<a href="#l22.390"></a><span id="l22.390">   let firstServer = MailServices.accounts</span>
<a href="#l22.391"></a><span id="l22.391">                                 .FindServer(&quot;tinderbox&quot;, FAKE_SERVER_HOSTNAME, &quot;pop3&quot;);</span>
<a href="#l22.392"></a><span id="l22.392">   let firstAccount = MailServices.accounts.FindAccountForServer(firstServer);</span>
<a href="#l22.393"></a><span id="l22.393"> </span>
<a href="#l22.394"></a><span id="l22.394" class="difflineminus">-  accountRow = get_account_tree_row(firstAccount.key, null, tab);</span>
<a href="#l22.395"></a><span id="l22.395" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.396"></a><span id="l22.396" class="difflineplus">+  accountRow = get_account_tree_row(firstAccount.key, null, amc);</span>
<a href="#l22.397"></a><span id="l22.397" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.398"></a><span id="l22.398"> </span>
<a href="#l22.399"></a><span id="l22.399">   // the Reply-To field should be empty as this account does not have it set.</span>
<a href="#l22.400"></a><span id="l22.400">   replyAddress = iframe.contentDocument.getElementById(&quot;identity.replyTo&quot;);</span>
<a href="#l22.401"></a><span id="l22.401">   assert_equals(replyAddress.value, &quot;&quot;);</span>
<a href="#l22.402"></a><span id="l22.402" class="difflineminus">-</span>
<a href="#l22.403"></a><span id="l22.403" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l22.404"></a><span id="l22.404"> }</span>
<a href="#l22.405"></a><span id="l22.405"> </span>
<a href="#l22.406"></a><span id="l22.406"> /**</span>
<a href="#l22.407"></a><span id="l22.407">  * Test for bug 804091.</span>
<a href="#l22.408"></a><span id="l22.408">  * Check if onchange handlers are properly executed when panes are switched.</span>
<a href="#l22.409"></a><span id="l22.409">  */</span>
<a href="#l22.410"></a><span id="l22.410"> function test_account_onchange_handler() {</span>
<a href="#l22.411"></a><span id="l22.411" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l22.412"></a><span id="l22.412" class="difflineminus">-  let accountRow = get_account_tree_row(gImapAccount.key, &quot;am-offline.xul&quot;, tab);</span>
<a href="#l22.413"></a><span id="l22.413" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.414"></a><span id="l22.414" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l22.415"></a><span id="l22.415" class="difflineplus">+    subtest_check_onchange_handler(amc);</span>
<a href="#l22.416"></a><span id="l22.416" class="difflineplus">+  });</span>
<a href="#l22.417"></a><span id="l22.417" class="difflineplus">+}</span>
<a href="#l22.418"></a><span id="l22.418"> </span>
<a href="#l22.419"></a><span id="l22.419" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.420"></a><span id="l22.420" class="difflineplus">+/**</span>
<a href="#l22.421"></a><span id="l22.421" class="difflineplus">+ * Check if onchange handlers are properly executed when panes are switched.</span>
<a href="#l22.422"></a><span id="l22.422" class="difflineplus">+ *</span>
<a href="#l22.423"></a><span id="l22.423" class="difflineplus">+ * @param amc  the account options controller</span>
<a href="#l22.424"></a><span id="l22.424" class="difflineplus">+ */</span>
<a href="#l22.425"></a><span id="l22.425" class="difflineplus">+function subtest_check_onchange_handler(amc) {</span>
<a href="#l22.426"></a><span id="l22.426" class="difflineplus">+  let accountRow = get_account_tree_row(gImapAccount.key, &quot;am-offline.xul&quot;, amc);</span>
<a href="#l22.427"></a><span id="l22.427" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.428"></a><span id="l22.428" class="difflineplus">+</span>
<a href="#l22.429"></a><span id="l22.429" class="difflineplus">+  let iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.430"></a><span id="l22.430"> </span>
<a href="#l22.431"></a><span id="l22.431">   let autoSync = iframe.getElementById(&quot;autosyncValue&quot;);</span>
<a href="#l22.432"></a><span id="l22.432">   // 30 is the default value so check if we are in clean state.</span>
<a href="#l22.433"></a><span id="l22.433">   assert_equals(autoSync.value, 30);</span>
<a href="#l22.434"></a><span id="l22.434"> </span>
<a href="#l22.435"></a><span id="l22.435">   let autoSyncInterval = iframe.getElementById(&quot;autosyncInterval&quot;);</span>
<a href="#l22.436"></a><span id="l22.436">   // 1 is the default value and means the 30 is in days.</span>
<a href="#l22.437"></a><span id="l22.437">   assert_equals(autoSyncInterval.value, 1);</span>
<a href="#l22.438"></a><span id="l22.438"> </span>
<a href="#l22.439"></a><span id="l22.439">   // Now type in 35 (days).</span>
<a href="#l22.440"></a><span id="l22.440" class="difflineminus">-  mc.radio(new elib.ID(iframe, &quot;useAutosync.ByAge&quot;));</span>
<a href="#l22.441"></a><span id="l22.441" class="difflineplus">+  amc.radio(new elib.ID(iframe, &quot;useAutosync.ByAge&quot;));</span>
<a href="#l22.442"></a><span id="l22.442">   autoSync.select();</span>
<a href="#l22.443"></a><span id="l22.443" class="difflineminus">-  mc.type(new elib.Elem(autoSync), &quot;35&quot;);</span>
<a href="#l22.444"></a><span id="l22.444" class="difflineplus">+  amc.type(new elib.Elem(autoSync), &quot;35&quot;);</span>
<a href="#l22.445"></a><span id="l22.445"> </span>
<a href="#l22.446"></a><span id="l22.446">   // Immediately switch to another pane and back.</span>
<a href="#l22.447"></a><span id="l22.447" class="difflineminus">-  accountRow = get_account_tree_row(gImapAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l22.448"></a><span id="l22.448" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.449"></a><span id="l22.449" class="difflineplus">+  accountRow = get_account_tree_row(gImapAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l22.450"></a><span id="l22.450" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.451"></a><span id="l22.451"> </span>
<a href="#l22.452"></a><span id="l22.452" class="difflineminus">-  accountRow = get_account_tree_row(gImapAccount.key, &quot;am-offline.xul&quot;, tab);</span>
<a href="#l22.453"></a><span id="l22.453" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l22.454"></a><span id="l22.454" class="difflineplus">+  accountRow = get_account_tree_row(gImapAccount.key, &quot;am-offline.xul&quot;, amc);</span>
<a href="#l22.455"></a><span id="l22.455" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l22.456"></a><span id="l22.456"> </span>
<a href="#l22.457"></a><span id="l22.457" class="difflineminus">-  iframe = content_tab_e(tab, &quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.458"></a><span id="l22.458" class="difflineplus">+  iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l22.459"></a><span id="l22.459"> </span>
<a href="#l22.460"></a><span id="l22.460">   // The pane optimized the entered value a bit. So now we should find 5.</span>
<a href="#l22.461"></a><span id="l22.461">   autoSync = iframe.getElementById(&quot;autosyncValue&quot;);</span>
<a href="#l22.462"></a><span id="l22.462">   assert_equals(autoSync.value, 5);</span>
<a href="#l22.463"></a><span id="l22.463"> </span>
<a href="#l22.464"></a><span id="l22.464">   // And the unit is 7 days = week.</span>
<a href="#l22.465"></a><span id="l22.465">   autoSyncInterval = iframe.getElementById(&quot;autosyncInterval&quot;);</span>
<a href="#l22.466"></a><span id="l22.466">   assert_equals(autoSyncInterval.value, 7);</span>
<a href="#l22.467"></a><span id="l22.467" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l22.468"></a><span id="l22.468"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-tree.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-tree.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -4,37 +4,29 @@</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5"> /**</span>
<a href="#l23.6"></a><span id="l23.6">  * This test checks proper operation of the account tree in the Account manager.</span>
<a href="#l23.7"></a><span id="l23.7">  */</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9"> &quot;use strict&quot;;</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11"> /* import-globals-from ../shared-modules/test-account-manager-helpers.js */</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-/* import-globals-from ../shared-modules/test-content-tab-helpers.js */</span>
<a href="#l23.13"></a><span id="l23.13"> /* import-globals-from ../shared-modules/test-folder-display-helpers.js */</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-/* import-globals-from ../shared-modules/test-pref-window-helpers.js */</span>
<a href="#l23.15"></a><span id="l23.15"> /* import-globals-from ../shared-modules/test-window-helpers.js */</span>
<a href="#l23.16"></a><span id="l23.16"> </span>
<a href="#l23.17"></a><span id="l23.17"> var MODULE_NAME = &quot;test-account-tree&quot;;</span>
<a href="#l23.18"></a><span id="l23.18"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineminus">-var MODULE_REQUIRES = [</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineminus">-  &quot;folder-display-helpers&quot;,</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineminus">-  &quot;window-helpers&quot;,</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineminus">-  &quot;account-manager-helpers&quot;,</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineminus">-  &quot;content-tab-helpers&quot;,</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-  &quot;pref-window-helpers&quot;,</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">-];</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineplus">+var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;window-helpers&quot;, &quot;account-manager-helpers&quot;];</span>
<a href="#l23.27"></a><span id="l23.27"> </span>
<a href="#l23.28"></a><span id="l23.28"> var gPopAccount, gOriginalAccountCount;</span>
<a href="#l23.29"></a><span id="l23.29"> </span>
<a href="#l23.30"></a><span id="l23.30"> function setupModule(module) {</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">-    collector.getModule(lib).installInto(module);</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">-  }</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+  collector.getModule(&quot;window-helpers&quot;).installInto(module);</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+  collector.getModule(&quot;folder-display-helpers&quot;).installInto(module);</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineplus">+  collector.getModule(&quot;account-manager-helpers&quot;).installInto(module);</span>
<a href="#l23.37"></a><span id="l23.37"> </span>
<a href="#l23.38"></a><span id="l23.38">   // There may be pre-existing accounts from other tests.</span>
<a href="#l23.39"></a><span id="l23.39">   gOriginalAccountCount = MailServices.accounts.allServers.length;</span>
<a href="#l23.40"></a><span id="l23.40"> </span>
<a href="#l23.41"></a><span id="l23.41">   // Create a POP server</span>
<a href="#l23.42"></a><span id="l23.42">   let popServer = MailServices.accounts</span>
<a href="#l23.43"></a><span id="l23.43">     .createIncomingServer(&quot;nobody&quot;, &quot;foo.invalid&quot;, &quot;pop3&quot;)</span>
<a href="#l23.44"></a><span id="l23.44">     .QueryInterface(Ci.nsIPop3IncomingServer);</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineat">@@ -57,114 +49,131 @@ function teardownModule(module) {</span>
<a href="#l23.46"></a><span id="l23.46">   assert_equals(MailServices.accounts.allServers.length, gOriginalAccountCount);</span>
<a href="#l23.47"></a><span id="l23.47"> }</span>
<a href="#l23.48"></a><span id="l23.48"> </span>
<a href="#l23.49"></a><span id="l23.49"> /**</span>
<a href="#l23.50"></a><span id="l23.50">  * Test for bug 536248.</span>
<a href="#l23.51"></a><span id="l23.51">  * Check if the account manager dialog remembers the open state of accounts.</span>
<a href="#l23.52"></a><span id="l23.52">  */</span>
<a href="#l23.53"></a><span id="l23.53"> function test_account_open_state() {</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineminus">-  subtest_check_account_open_state(true);</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineminus">-</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineminus">-  subtest_check_account_open_state(false);</span>
<a href="#l23.57"></a><span id="l23.57" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineplus">+    subtest_check_account_open_state(amc, true);</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineplus">+  });</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineplus">+    subtest_check_account_open_state(amc, false);</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineplus">+  });</span>
<a href="#l23.63"></a><span id="l23.63">   // After this test all the accounts must be &quot;open&quot;.</span>
<a href="#l23.64"></a><span id="l23.64"> }</span>
<a href="#l23.65"></a><span id="l23.65"> </span>
<a href="#l23.66"></a><span id="l23.66"> /**</span>
<a href="#l23.67"></a><span id="l23.67">  * Check if the open state of accounts is in the wished state.</span>
<a href="#l23.68"></a><span id="l23.68">  *</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineplus">+ * @param amc           The account options controller.</span>
<a href="#l23.70"></a><span id="l23.70">  * @param aWishedState  The open state in which the account row should be found (bool).</span>
<a href="#l23.71"></a><span id="l23.71">  */</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineminus">-function subtest_check_account_open_state(aWishedState) {</span>
<a href="#l23.73"></a><span id="l23.73" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineminus">-  let accountRow = get_account_tree_row(gPopAccount.key, null, tab);</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l23.76"></a><span id="l23.76" class="difflineplus">+function subtest_check_account_open_state(amc, aWishedState) {</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineplus">+  let accountRow = get_account_tree_row(gPopAccount.key, null, amc);</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l23.79"></a><span id="l23.79"> </span>
<a href="#l23.80"></a><span id="l23.80">   // See if the account row is in the wished open state.</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineminus">-  let accountTree = content_tab_e(tab, &quot;accounttree&quot;);</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineplus">+  let accountTree = amc.e(&quot;accounttree&quot;);</span>
<a href="#l23.83"></a><span id="l23.83">   assert_equals(accountRow, accountTree.view.selection.currentIndex);</span>
<a href="#l23.84"></a><span id="l23.84">   assert_equals(accountTree.view.isContainerOpen(accountRow), aWishedState);</span>
<a href="#l23.85"></a><span id="l23.85"> </span>
<a href="#l23.86"></a><span id="l23.86">   accountTree.view.toggleOpenState(accountRow);</span>
<a href="#l23.87"></a><span id="l23.87">   assert_equals(accountTree.view.isContainerOpen(accountRow), !aWishedState);</span>
<a href="#l23.88"></a><span id="l23.88"> </span>
<a href="#l23.89"></a><span id="l23.89">   // Whatever the open state of the account was, selecting one of its subpanes</span>
<a href="#l23.90"></a><span id="l23.90">   // must open it.</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineminus">-  tab.browser.contentWindow.selectServer(gPopAccount.incomingServer, &quot;am-junk.xul&quot;);</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineminus">-  wait_for_account_tree_selection(tab);</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineplus">+  amc.window.selectServer(gPopAccount.incomingServer, &quot;am-junk.xul&quot;);</span>
<a href="#l23.94"></a><span id="l23.94">   assert_true(accountTree.view.isContainerOpen(accountRow));</span>
<a href="#l23.95"></a><span id="l23.95"> </span>
<a href="#l23.96"></a><span id="l23.96">   // Set the proper state again for continuation of the test.</span>
<a href="#l23.97"></a><span id="l23.97">   accountTree.view.getItemAtIndex(accountRow).setAttribute(&quot;open&quot;, !aWishedState);</span>
<a href="#l23.98"></a><span id="l23.98">   assert_equals(accountTree.view.isContainerOpen(accountRow), !aWishedState);</span>
<a href="#l23.99"></a><span id="l23.99" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l23.100"></a><span id="l23.100"> }</span>
<a href="#l23.101"></a><span id="l23.101"> </span>
<a href="#l23.102"></a><span id="l23.102"> /**</span>
<a href="#l23.103"></a><span id="l23.103">  * Bug 740617.</span>
<a href="#l23.104"></a><span id="l23.104" class="difflineminus">- * Check if the default account is styled in bold and another account is not.</span>
<a href="#l23.105"></a><span id="l23.105" class="difflineplus">+ * Check if the default account is styled in bold.</span>
<a href="#l23.106"></a><span id="l23.106" class="difflineplus">+ *</span>
<a href="#l23.107"></a><span id="l23.107">  */</span>
<a href="#l23.108"></a><span id="l23.108"> function test_default_account_highlight() {</span>
<a href="#l23.109"></a><span id="l23.109" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l23.110"></a><span id="l23.110" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l23.111"></a><span id="l23.111" class="difflineplus">+    subtest_check_default_account_highlight(amc);</span>
<a href="#l23.112"></a><span id="l23.112" class="difflineplus">+  });</span>
<a href="#l23.113"></a><span id="l23.113" class="difflineplus">+}</span>
<a href="#l23.114"></a><span id="l23.114" class="difflineplus">+</span>
<a href="#l23.115"></a><span id="l23.115" class="difflineplus">+/**</span>
<a href="#l23.116"></a><span id="l23.116" class="difflineplus">+ * Check if the default account is styled in bold and another account is not.</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineplus">+ *</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineplus">+ * @param amc           The account options controller.</span>
<a href="#l23.119"></a><span id="l23.119" class="difflineplus">+ */</span>
<a href="#l23.120"></a><span id="l23.120" class="difflineplus">+function subtest_check_default_account_highlight(amc) {</span>
<a href="#l23.121"></a><span id="l23.121">   // Select the default account.</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineminus">-  let accountRow = get_account_tree_row(MailServices.accounts.defaultAccount.key, null, tab);</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l23.124"></a><span id="l23.124" class="difflineplus">+  let accountRow = get_account_tree_row(MailServices.accounts.defaultAccount.key, null, amc);</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l23.126"></a><span id="l23.126"> </span>
<a href="#l23.127"></a><span id="l23.127" class="difflineminus">-  let accountTree = content_tab_e(tab, &quot;accounttree&quot;);</span>
<a href="#l23.128"></a><span id="l23.128" class="difflineplus">+  let accountTree = amc.e(&quot;accounttree&quot;);</span>
<a href="#l23.129"></a><span id="l23.129">   assert_equals(accountRow, accountTree.view.selection.currentIndex);</span>
<a href="#l23.130"></a><span id="l23.130">   let cell = accountTree.view.getItemAtIndex(accountRow).firstChild.firstChild;</span>
<a href="#l23.131"></a><span id="l23.131">   assert_equals(cell.tagName, &quot;treecell&quot;);</span>
<a href="#l23.132"></a><span id="l23.132"> </span>
<a href="#l23.133"></a><span id="l23.133">   // We can't read the computed style of the tree cell directly, so at least see</span>
<a href="#l23.134"></a><span id="l23.134">   // if the isDefaultServer-true property is set on it. Hopefully the proper style</span>
<a href="#l23.135"></a><span id="l23.135">   // is attached to this property.</span>
<a href="#l23.136"></a><span id="l23.136">   let propArray = accountTree.view</span>
<a href="#l23.137"></a><span id="l23.137">     .getCellProperties(accountRow, accountTree.columns.getColumnAt(0)).split(&quot; &quot;);</span>
<a href="#l23.138"></a><span id="l23.138">   assert_true(propArray.includes(&quot;isDefaultServer-true&quot;));</span>
<a href="#l23.139"></a><span id="l23.139"> </span>
<a href="#l23.140"></a><span id="l23.140">   // Now select another account that is not default.</span>
<a href="#l23.141"></a><span id="l23.141" class="difflineminus">-  accountRow = get_account_tree_row(gPopAccount.key, null, tab);</span>
<a href="#l23.142"></a><span id="l23.142" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l23.143"></a><span id="l23.143" class="difflineplus">+  accountRow = get_account_tree_row(gPopAccount.key, null, amc);</span>
<a href="#l23.144"></a><span id="l23.144" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l23.145"></a><span id="l23.145"> </span>
<a href="#l23.146"></a><span id="l23.146">   // There should isDefaultServer-true on its tree cell.</span>
<a href="#l23.147"></a><span id="l23.147">   propArray = accountTree.view</span>
<a href="#l23.148"></a><span id="l23.148">     .getCellProperties(accountRow, accountTree.columns.getColumnAt(0)).split(&quot; &quot;);</span>
<a href="#l23.149"></a><span id="l23.149">   assert_false(propArray.includes(&quot;isDefaultServer-true&quot;));</span>
<a href="#l23.150"></a><span id="l23.150" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l23.151"></a><span id="l23.151"> }</span>
<a href="#l23.152"></a><span id="l23.152" class="difflineminus">-</span>
<a href="#l23.153"></a><span id="l23.153"> /**</span>
<a href="#l23.154"></a><span id="l23.154">  * Bug 58713.</span>
<a href="#l23.155"></a><span id="l23.155">  * Check if after deleting an account the next one is selected.</span>
<a href="#l23.156"></a><span id="l23.156">  *</span>
<a href="#l23.157"></a><span id="l23.157">  * This test should always be the last one as it removes our specially</span>
<a href="#l23.158"></a><span id="l23.158">  * created gPopAccount.</span>
<a href="#l23.159"></a><span id="l23.159">  */</span>
<a href="#l23.160"></a><span id="l23.160"> function test_selection_after_account_deletion() {</span>
<a href="#l23.161"></a><span id="l23.161" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l23.162"></a><span id="l23.162" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l23.163"></a><span id="l23.163" class="difflineplus">+    subtest_check_selection_after_account_deletion(amc);</span>
<a href="#l23.164"></a><span id="l23.164" class="difflineplus">+  });</span>
<a href="#l23.165"></a><span id="l23.165" class="difflineplus">+}</span>
<a href="#l23.166"></a><span id="l23.166" class="difflineplus">+</span>
<a href="#l23.167"></a><span id="l23.167" class="difflineplus">+/**</span>
<a href="#l23.168"></a><span id="l23.168" class="difflineplus">+ * Check if after deleting an account the next one is selected.</span>
<a href="#l23.169"></a><span id="l23.169" class="difflineplus">+ *</span>
<a href="#l23.170"></a><span id="l23.170" class="difflineplus">+ * @param amc           The account options controller.</span>
<a href="#l23.171"></a><span id="l23.171" class="difflineplus">+ */</span>
<a href="#l23.172"></a><span id="l23.172" class="difflineplus">+function subtest_check_selection_after_account_deletion(amc) {</span>
<a href="#l23.173"></a><span id="l23.173">   let accountList = [];</span>
<a href="#l23.174"></a><span id="l23.174" class="difflineminus">-  let accountTreeNode = content_tab_e(tab, &quot;account-tree-children&quot;);</span>
<a href="#l23.175"></a><span id="l23.175" class="difflineplus">+  let accountTreeNode = amc.e(&quot;account-tree-children&quot;);</span>
<a href="#l23.176"></a><span id="l23.176">   // Build the list of accounts in the account tree (order is important).</span>
<a href="#l23.177"></a><span id="l23.177">   for (let i = 0; i &lt; accountTreeNode.childNodes.length; i++) {</span>
<a href="#l23.178"></a><span id="l23.178">     if (&quot;_account&quot; in accountTreeNode.childNodes[i]) {</span>
<a href="#l23.179"></a><span id="l23.179">       let curAccount = accountTreeNode.childNodes[i]._account;</span>
<a href="#l23.180"></a><span id="l23.180">       if (!accountList.includes(curAccount))</span>
<a href="#l23.181"></a><span id="l23.181">         accountList.push(curAccount);</span>
<a href="#l23.182"></a><span id="l23.182">     }</span>
<a href="#l23.183"></a><span id="l23.183">   }</span>
<a href="#l23.184"></a><span id="l23.184"> </span>
<a href="#l23.185"></a><span id="l23.185">   // Get position of the current account in the account list.</span>
<a href="#l23.186"></a><span id="l23.186">   let accountIndex = accountList.indexOf(gPopAccount);</span>
<a href="#l23.187"></a><span id="l23.187"> </span>
<a href="#l23.188"></a><span id="l23.188">   // Remove our account.</span>
<a href="#l23.189"></a><span id="l23.189" class="difflineminus">-  remove_account(gPopAccount, tab);</span>
<a href="#l23.190"></a><span id="l23.190" class="difflineplus">+  remove_account(gPopAccount, amc);</span>
<a href="#l23.191"></a><span id="l23.191">   // Now there should be only the original accounts left.</span>
<a href="#l23.192"></a><span id="l23.192">   assert_equals(MailServices.accounts.allServers.length, gOriginalAccountCount);</span>
<a href="#l23.193"></a><span id="l23.193"> </span>
<a href="#l23.194"></a><span id="l23.194">   // See if the currently selected account is the one next in the account list.</span>
<a href="#l23.195"></a><span id="l23.195" class="difflineminus">-  let accountTree = content_tab_e(tab, &quot;accounttree&quot;);</span>
<a href="#l23.196"></a><span id="l23.196" class="difflineplus">+  let accountTree = amc.e(&quot;accounttree&quot;);</span>
<a href="#l23.197"></a><span id="l23.197">   let accountRow = accountTree.view.selection.currentIndex;</span>
<a href="#l23.198"></a><span id="l23.198" class="difflineminus">-  wait_for_account_tree_selection(tab, accountRow);</span>
<a href="#l23.199"></a><span id="l23.199">   assert_equals(accountTree.view.getItemAtIndex(accountRow)._account,</span>
<a href="#l23.200"></a><span id="l23.200">                 accountList[accountIndex + 1]);</span>
<a href="#l23.201"></a><span id="l23.201" class="difflineminus">-</span>
<a href="#l23.202"></a><span id="l23.202" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l23.203"></a><span id="l23.203"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-values.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-values.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -5,31 +5,27 @@</span>
<a href="#l24.4"></a><span id="l24.4"> /**</span>
<a href="#l24.5"></a><span id="l24.5">  * This test checks proper operation of the account settings panes</span>
<a href="#l24.6"></a><span id="l24.6">  * when certain special or invalid values are entered into the fields.</span>
<a href="#l24.7"></a><span id="l24.7">  */</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9"> &quot;use strict&quot;;</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11"> /* import-globals-from ../shared-modules/test-account-manager-helpers.js */</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-/* import-globals-from ../shared-modules/test-content-tab-helpers.js */</span>
<a href="#l24.13"></a><span id="l24.13"> /* import-globals-from ../shared-modules/test-folder-display-helpers.js */</span>
<a href="#l24.14"></a><span id="l24.14"> /* import-globals-from ../shared-modules/test-keyboard-helpers.js */</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-/* import-globals-from ../shared-modules/test-pref-window-helpers.js */</span>
<a href="#l24.16"></a><span id="l24.16"> /* import-globals-from ../shared-modules/test-window-helpers.js */</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18"> var MODULE_NAME = &quot;test-account-values&quot;;</span>
<a href="#l24.19"></a><span id="l24.19"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l24.20"></a><span id="l24.20"> var MODULE_REQUIRES = [</span>
<a href="#l24.21"></a><span id="l24.21">   &quot;folder-display-helpers&quot;,</span>
<a href="#l24.22"></a><span id="l24.22">   &quot;window-helpers&quot;,</span>
<a href="#l24.23"></a><span id="l24.23">   &quot;account-manager-helpers&quot;,</span>
<a href="#l24.24"></a><span id="l24.24">   &quot;keyboard-helpers&quot;,</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">-  &quot;content-tab-helpers&quot;,</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-  &quot;pref-window-helpers&quot;,</span>
<a href="#l24.27"></a><span id="l24.27"> ];</span>
<a href="#l24.28"></a><span id="l24.28"> </span>
<a href="#l24.29"></a><span id="l24.29"> var elib = ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.jsm&quot;);</span>
<a href="#l24.30"></a><span id="l24.30"> </span>
<a href="#l24.31"></a><span id="l24.31"> var gPopAccount, gOriginalAccountCount;</span>
<a href="#l24.32"></a><span id="l24.32"> </span>
<a href="#l24.33"></a><span id="l24.33"> function setupModule(module) {</span>
<a href="#l24.34"></a><span id="l24.34">   for (let lib of MODULE_REQUIRES) {</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineat">@@ -63,43 +59,53 @@ function teardownModule(module) {</span>
<a href="#l24.36"></a><span id="l24.36"> }</span>
<a href="#l24.37"></a><span id="l24.37"> </span>
<a href="#l24.38"></a><span id="l24.38"> /**</span>
<a href="#l24.39"></a><span id="l24.39">  * Bug 208628.</span>
<a href="#l24.40"></a><span id="l24.40">  * Check that if the CC field is empty, enabling CC will automatically</span>
<a href="#l24.41"></a><span id="l24.41">  * prefill the currently default email address.</span>
<a href="#l24.42"></a><span id="l24.42">  */</span>
<a href="#l24.43"></a><span id="l24.43"> function test_default_CC_address() {</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-copies.xul&quot;, tab);</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineplus">+    subtest_check_default_CC_address(amc);</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineplus">+  });</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineplus">+}</span>
<a href="#l24.51"></a><span id="l24.51"> </span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+/**</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+ * Check that if the CC field is empty, enabling CC will automatically</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineplus">+ * prefill the currently default email address.</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineplus">+ *</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+ * @param amc  the account options controller</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+ */</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineplus">+function subtest_check_default_CC_address(amc) {</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-copies.xul&quot;, amc);</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineplus">+</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineplus">+  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l24.64"></a><span id="l24.64"> </span>
<a href="#l24.65"></a><span id="l24.65">   let defaultAddress = iframe.contentDocument.getElementById(&quot;identity.email&quot;).value;</span>
<a href="#l24.66"></a><span id="l24.66">   let ccCheck = iframe.contentDocument.getElementById(&quot;identity.doCc&quot;);</span>
<a href="#l24.67"></a><span id="l24.67">   let ccAddress = iframe.contentDocument.getElementById(&quot;identity.doCcList&quot;);</span>
<a href="#l24.68"></a><span id="l24.68">   // The CC checkbox is not enabled and the address value is empty.</span>
<a href="#l24.69"></a><span id="l24.69">   assert_false(ccCheck.checked);</span>
<a href="#l24.70"></a><span id="l24.70">   assert_equals(ccAddress.value, &quot;&quot;);</span>
<a href="#l24.71"></a><span id="l24.71">   // After ticking the CC checkbox the default address should be prefilled.</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineminus">-  mc.check(new elib.Elem(ccCheck), true);</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineplus">+  amc.check(new elib.Elem(ccCheck), true);</span>
<a href="#l24.74"></a><span id="l24.74">   assert_equals(ccAddress.value, defaultAddress);</span>
<a href="#l24.75"></a><span id="l24.75"> </span>
<a href="#l24.76"></a><span id="l24.76">   let bccCheck = iframe.contentDocument.getElementById(&quot;identity.doBcc&quot;);</span>
<a href="#l24.77"></a><span id="l24.77">   let bccAddress = iframe.contentDocument.getElementById(&quot;identity.doBccList&quot;);</span>
<a href="#l24.78"></a><span id="l24.78">   // The BCC checkbox is not enabled but we set the address value to something.</span>
<a href="#l24.79"></a><span id="l24.79">   assert_false(bccCheck.checked);</span>
<a href="#l24.80"></a><span id="l24.80">   assert_equals(bccAddress.value, &quot;&quot;);</span>
<a href="#l24.81"></a><span id="l24.81">   let bccUserAddress = &quot;somebody@else.invalid&quot;;</span>
<a href="#l24.82"></a><span id="l24.82">   bccAddress.value = bccUserAddress;</span>
<a href="#l24.83"></a><span id="l24.83">   // After ticking the BCC checkbox the current value of the address should not change.</span>
<a href="#l24.84"></a><span id="l24.84" class="difflineminus">-  mc.check(new elib.Elem(bccCheck), true);</span>
<a href="#l24.85"></a><span id="l24.85" class="difflineplus">+  amc.check(new elib.Elem(bccCheck), true);</span>
<a href="#l24.86"></a><span id="l24.86">   assert_equals(bccAddress.value, bccUserAddress);</span>
<a href="#l24.87"></a><span id="l24.87" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l24.88"></a><span id="l24.88"> }</span>
<a href="#l24.89"></a><span id="l24.89"> </span>
<a href="#l24.90"></a><span id="l24.90"> /**</span>
<a href="#l24.91"></a><span id="l24.91">  * Bug 720199.</span>
<a href="#l24.92"></a><span id="l24.92">  * Check if the account name automatically changes when the user changes</span>
<a href="#l24.93"></a><span id="l24.93">  * the username or hostname.</span>
<a href="#l24.94"></a><span id="l24.94">  */</span>
<a href="#l24.95"></a><span id="l24.95"> function test_account_name() {</span>
<a href="#l24.96"></a><span id="l24.96" class="difflineat">@@ -122,69 +128,79 @@ function test_account_name() {</span>
<a href="#l24.97"></a><span id="l24.97">   // The automatic account name update works only if the name is</span>
<a href="#l24.98"></a><span id="l24.98">   // in the form of user@host.</span>
<a href="#l24.99"></a><span id="l24.99">   gPopAccount.incomingServer.prettyName = &quot;nobody@example.invalid&quot;;</span>
<a href="#l24.100"></a><span id="l24.100"> </span>
<a href="#l24.101"></a><span id="l24.101">   let newHost = &quot;some.host.invalid&quot;;</span>
<a href="#l24.102"></a><span id="l24.102">   let newUser = &quot;somebody&quot;;</span>
<a href="#l24.103"></a><span id="l24.103"> </span>
<a href="#l24.104"></a><span id="l24.104">   // On NNTP there is no user name so just set new hostname.</span>
<a href="#l24.105"></a><span id="l24.105" class="difflineminus">-  subtest_check_account_name(nntpAccount, newHost, null);</span>
<a href="#l24.106"></a><span id="l24.106" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.107"></a><span id="l24.107" class="difflineplus">+    subtest_check_account_name(nntpAccount, newHost, null, amc);</span>
<a href="#l24.108"></a><span id="l24.108" class="difflineplus">+  });</span>
<a href="#l24.109"></a><span id="l24.109"> </span>
<a href="#l24.110"></a><span id="l24.110">   // And see if the account name is updated to it.</span>
<a href="#l24.111"></a><span id="l24.111">   assert_equals(nntpAccount.incomingServer.prettyName, newHost);</span>
<a href="#l24.112"></a><span id="l24.112"> </span>
<a href="#l24.113"></a><span id="l24.113">   // On POP3 there is both user name and host name.</span>
<a href="#l24.114"></a><span id="l24.114">   // Set new host name first.</span>
<a href="#l24.115"></a><span id="l24.115" class="difflineminus">-  subtest_check_account_name(gPopAccount, newHost, null);</span>
<a href="#l24.116"></a><span id="l24.116" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.117"></a><span id="l24.117" class="difflineplus">+    subtest_check_account_name(gPopAccount, newHost, null, amc);</span>
<a href="#l24.118"></a><span id="l24.118" class="difflineplus">+  });</span>
<a href="#l24.119"></a><span id="l24.119"> </span>
<a href="#l24.120"></a><span id="l24.120">   // And see if in the account name the host part is updated to it.</span>
<a href="#l24.121"></a><span id="l24.121">   assert_equals(gPopAccount.incomingServer.prettyName, &quot;nobody@&quot; + newHost);</span>
<a href="#l24.122"></a><span id="l24.122"> </span>
<a href="#l24.123"></a><span id="l24.123">   // Set new host name first.</span>
<a href="#l24.124"></a><span id="l24.124" class="difflineminus">-  subtest_check_account_name(gPopAccount, null, newUser);</span>
<a href="#l24.125"></a><span id="l24.125" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.126"></a><span id="l24.126" class="difflineplus">+    subtest_check_account_name(gPopAccount, null, newUser, amc);</span>
<a href="#l24.127"></a><span id="l24.127" class="difflineplus">+  });</span>
<a href="#l24.128"></a><span id="l24.128"> </span>
<a href="#l24.129"></a><span id="l24.129">   // And see if in the account name the user part is updated.</span>
<a href="#l24.130"></a><span id="l24.130">   assert_equals(gPopAccount.incomingServer.prettyName, newUser + &quot;@&quot; + newHost);</span>
<a href="#l24.131"></a><span id="l24.131"> </span>
<a href="#l24.132"></a><span id="l24.132">   newHost = &quot;another.host.invalid&quot;;</span>
<a href="#l24.133"></a><span id="l24.133">   newUser = &quot;anotherbody&quot;;</span>
<a href="#l24.134"></a><span id="l24.134"> </span>
<a href="#l24.135"></a><span id="l24.135">   // Set user name and host name at once.</span>
<a href="#l24.136"></a><span id="l24.136" class="difflineminus">-  subtest_check_account_name(gPopAccount, newHost, newUser);</span>
<a href="#l24.137"></a><span id="l24.137" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.138"></a><span id="l24.138" class="difflineplus">+    subtest_check_account_name(gPopAccount, newHost, newUser, amc);</span>
<a href="#l24.139"></a><span id="l24.139" class="difflineplus">+  });</span>
<a href="#l24.140"></a><span id="l24.140"> </span>
<a href="#l24.141"></a><span id="l24.141">   // And see if in the account name the host part is updated to it.</span>
<a href="#l24.142"></a><span id="l24.142">   assert_equals(gPopAccount.incomingServer.prettyName, newUser + &quot;@&quot; + newHost);</span>
<a href="#l24.143"></a><span id="l24.143"> </span>
<a href="#l24.144"></a><span id="l24.144">   // Now have an account name where the name does not match the hostname.</span>
<a href="#l24.145"></a><span id="l24.145">   gPopAccount.incomingServer.prettyName = newUser + &quot;@example.invalid&quot;;</span>
<a href="#l24.146"></a><span id="l24.146"> </span>
<a href="#l24.147"></a><span id="l24.147">   newHost = &quot;third.host.invalid&quot;;</span>
<a href="#l24.148"></a><span id="l24.148">   // Set the host name again.</span>
<a href="#l24.149"></a><span id="l24.149" class="difflineminus">-  subtest_check_account_name(gPopAccount, newHost, null);</span>
<a href="#l24.150"></a><span id="l24.150" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.151"></a><span id="l24.151" class="difflineplus">+    subtest_check_account_name(gPopAccount, newHost, null, amc);</span>
<a href="#l24.152"></a><span id="l24.152" class="difflineplus">+  });</span>
<a href="#l24.153"></a><span id="l24.153"> </span>
<a href="#l24.154"></a><span id="l24.154">   // And the account name should not be touched.</span>
<a href="#l24.155"></a><span id="l24.155">   assert_equals(gPopAccount.incomingServer.prettyName, newUser + &quot;@example.invalid&quot;);</span>
<a href="#l24.156"></a><span id="l24.156"> </span>
<a href="#l24.157"></a><span id="l24.157">   MailServices.accounts.removeAccount(nntpAccount);</span>
<a href="#l24.158"></a><span id="l24.158"> }</span>
<a href="#l24.159"></a><span id="l24.159"> </span>
<a href="#l24.160"></a><span id="l24.160"> /**</span>
<a href="#l24.161"></a><span id="l24.161">  * Changes the user name and hostname to the supplied values.</span>
<a href="#l24.162"></a><span id="l24.162">  *</span>
<a href="#l24.163"></a><span id="l24.163">  * @param aAccount      the account to change</span>
<a href="#l24.164"></a><span id="l24.164">  * @param aNewHostname  the hostname value to set</span>
<a href="#l24.165"></a><span id="l24.165">  * @param aNewUsername  the username value to set</span>
<a href="#l24.166"></a><span id="l24.166" class="difflineplus">+ * @param amc           the account options controller</span>
<a href="#l24.167"></a><span id="l24.167">  */</span>
<a href="#l24.168"></a><span id="l24.168" class="difflineminus">-function subtest_check_account_name(aAccount, aNewHostname, aNewUsername) {</span>
<a href="#l24.169"></a><span id="l24.169" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l24.170"></a><span id="l24.170" class="difflineminus">-  let accountRow = get_account_tree_row(aAccount.key, &quot;am-server.xul&quot;, tab);</span>
<a href="#l24.171"></a><span id="l24.171" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l24.172"></a><span id="l24.172" class="difflineplus">+function subtest_check_account_name(aAccount, aNewHostname, aNewUsername, amc) {</span>
<a href="#l24.173"></a><span id="l24.173" class="difflineplus">+  let accountRow = get_account_tree_row(aAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l24.174"></a><span id="l24.174" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l24.175"></a><span id="l24.175"> </span>
<a href="#l24.176"></a><span id="l24.176" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l24.177"></a><span id="l24.177" class="difflineplus">+  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l24.178"></a><span id="l24.178"> </span>
<a href="#l24.179"></a><span id="l24.179">   if (aNewHostname) {</span>
<a href="#l24.180"></a><span id="l24.180">     let hostname = iframe.contentDocument.getElementById(&quot;server.realHostName&quot;);</span>
<a href="#l24.181"></a><span id="l24.181">     assert_equals(hostname.value, aAccount.incomingServer.realHostName);</span>
<a href="#l24.182"></a><span id="l24.182"> </span>
<a href="#l24.183"></a><span id="l24.183">     // Now change the server host name.</span>
<a href="#l24.184"></a><span id="l24.184">     hostname.value = aNewHostname;</span>
<a href="#l24.185"></a><span id="l24.185">   }</span>
<a href="#l24.186"></a><span id="l24.186" class="difflineat">@@ -199,155 +215,155 @@ function subtest_check_account_name(aAcc</span>
<a href="#l24.187"></a><span id="l24.187"> </span>
<a href="#l24.188"></a><span id="l24.188">   if (aNewUsername) {</span>
<a href="#l24.189"></a><span id="l24.189">     // If username has changed, we get a confirmation dialog.</span>
<a href="#l24.190"></a><span id="l24.190">     plan_for_modal_dialog(&quot;commonDialog&quot;, function(cdc) {</span>
<a href="#l24.191"></a><span id="l24.191">       // Just dismiss it.</span>
<a href="#l24.192"></a><span id="l24.192">       cdc.window.document.documentElement.acceptDialog();</span>
<a href="#l24.193"></a><span id="l24.193">     });</span>
<a href="#l24.194"></a><span id="l24.194">   }</span>
<a href="#l24.195"></a><span id="l24.195" class="difflineminus">-  // We really need to save the new values.</span>
<a href="#l24.196"></a><span id="l24.196" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l24.197"></a><span id="l24.197" class="difflineminus">-</span>
<a href="#l24.198"></a><span id="l24.198" class="difflineplus">+  // We really need to save the new values so click OK on the Account settings.</span>
<a href="#l24.199"></a><span id="l24.199" class="difflineplus">+  amc.window.document.documentElement.acceptDialog();</span>
<a href="#l24.200"></a><span id="l24.200">   if (aNewUsername)</span>
<a href="#l24.201"></a><span id="l24.201">     wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l24.202"></a><span id="l24.202"> }</span>
<a href="#l24.203"></a><span id="l24.203"> </span>
<a href="#l24.204"></a><span id="l24.204"> /**</span>
<a href="#l24.205"></a><span id="l24.205">  * Bug 536768.</span>
<a href="#l24.206"></a><span id="l24.206">  * Check if invalid junk target settings (folders) are fixed to sane values.</span>
<a href="#l24.207"></a><span id="l24.207">  */</span>
<a href="#l24.208"></a><span id="l24.208"> function test_invalid_junk_target() {</span>
<a href="#l24.209"></a><span id="l24.209">   // Set the junk target prefs to invalid values.</span>
<a href="#l24.210"></a><span id="l24.210">   let branch = Services.prefs.getBranch(&quot;mail.server.&quot; + gPopAccount.incomingServer.key + &quot;.&quot;);</span>
<a href="#l24.211"></a><span id="l24.211">   branch.setCharPref(&quot;spamActionTargetAccount&quot;, &quot;some random non-existent URI&quot;);</span>
<a href="#l24.212"></a><span id="l24.212">   branch.setCharPref(&quot;spamActionTargetFolder&quot;, &quot;some random non-existent URI&quot;);</span>
<a href="#l24.213"></a><span id="l24.213">   let moveOnSpam = true;</span>
<a href="#l24.214"></a><span id="l24.214">   branch.setBoolPref(&quot;moveOnSpam&quot;, moveOnSpam);</span>
<a href="#l24.215"></a><span id="l24.215" class="difflineminus">-  subtest_check_invalid_junk_target();</span>
<a href="#l24.216"></a><span id="l24.216" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.217"></a><span id="l24.217" class="difflineplus">+    subtest_check_invalid_junk_target(amc);</span>
<a href="#l24.218"></a><span id="l24.218" class="difflineplus">+  });</span>
<a href="#l24.219"></a><span id="l24.219"> </span>
<a href="#l24.220"></a><span id="l24.220">   // The pref has no default so its non-existence means it was cleared.</span>
<a href="#l24.221"></a><span id="l24.221">   moveOnSpam = branch.getBoolPref(&quot;moveOnSpam&quot;, false);</span>
<a href="#l24.222"></a><span id="l24.222">   assert_false(moveOnSpam);</span>
<a href="#l24.223"></a><span id="l24.223">   // The targets should point to the same pop account now.</span>
<a href="#l24.224"></a><span id="l24.224">   let targetAccount = branch.getCharPref(&quot;spamActionTargetAccount&quot;);</span>
<a href="#l24.225"></a><span id="l24.225">   assert_equals(targetAccount, gPopAccount.incomingServer.serverURI);</span>
<a href="#l24.226"></a><span id="l24.226">   let targetFolder = branch.getCharPref(&quot;spamActionTargetFolder&quot;);</span>
<a href="#l24.227"></a><span id="l24.227">   assert_equals(targetFolder, gPopAccount.incomingServer.serverURI + &quot;/Junk&quot;);</span>
<a href="#l24.228"></a><span id="l24.228"> }</span>
<a href="#l24.229"></a><span id="l24.229"> </span>
<a href="#l24.230"></a><span id="l24.230"> /**</span>
<a href="#l24.231"></a><span id="l24.231">  * Just show the Junk settings pane and let it fix the values.</span>
<a href="#l24.232"></a><span id="l24.232" class="difflineplus">+ *</span>
<a href="#l24.233"></a><span id="l24.233" class="difflineplus">+ * @param amc  the account options controller</span>
<a href="#l24.234"></a><span id="l24.234">  */</span>
<a href="#l24.235"></a><span id="l24.235" class="difflineminus">-function subtest_check_invalid_junk_target() {</span>
<a href="#l24.236"></a><span id="l24.236" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l24.237"></a><span id="l24.237" class="difflineminus">-  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l24.238"></a><span id="l24.238" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l24.239"></a><span id="l24.239" class="difflineplus">+function subtest_check_invalid_junk_target(amc) {</span>
<a href="#l24.240"></a><span id="l24.240" class="difflineplus">+  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l24.241"></a><span id="l24.241" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l24.242"></a><span id="l24.242"> </span>
<a href="#l24.243"></a><span id="l24.243" class="difflineminus">-  // We need to save the new fixed values.</span>
<a href="#l24.244"></a><span id="l24.244" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l24.245"></a><span id="l24.245" class="difflineplus">+  // We need to save the new fixed values so click OK on the Account settings.</span>
<a href="#l24.246"></a><span id="l24.246" class="difflineplus">+  amc.window.document.documentElement.acceptDialog();</span>
<a href="#l24.247"></a><span id="l24.247"> }</span>
<a href="#l24.248"></a><span id="l24.248"> </span>
<a href="#l24.249"></a><span id="l24.249"> /**</span>
<a href="#l24.250"></a><span id="l24.250">  * Bug 327812.</span>
<a href="#l24.251"></a><span id="l24.251">  * Checks if invalid server hostnames are not accepted.</span>
<a href="#l24.252"></a><span id="l24.252">  */</span>
<a href="#l24.253"></a><span id="l24.253" class="difflineminus">-test_invalid_hostname.__force_skip__ = true; // disabled temporarily, bug 1096006</span>
<a href="#l24.254"></a><span id="l24.254"> function test_invalid_hostname() {</span>
<a href="#l24.255"></a><span id="l24.255">   let branch = Services.prefs.getBranch(&quot;mail.server.&quot; + gPopAccount.incomingServer.key + &quot;.&quot;);</span>
<a href="#l24.256"></a><span id="l24.256">   let origHostname = branch.getCharPref(&quot;realhostname&quot;);</span>
<a href="#l24.257"></a><span id="l24.257"> </span>
<a href="#l24.258"></a><span id="l24.258" class="difflineminus">-  subtest_check_invalid_hostname(false, origHostname);</span>
<a href="#l24.259"></a><span id="l24.259" class="difflineminus">-  subtest_check_invalid_hostname(true, origHostname);</span>
<a href="#l24.260"></a><span id="l24.260" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.261"></a><span id="l24.261" class="difflineplus">+    subtest_check_invalid_hostname(amc, false, origHostname);</span>
<a href="#l24.262"></a><span id="l24.262" class="difflineplus">+  });</span>
<a href="#l24.263"></a><span id="l24.263" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.264"></a><span id="l24.264" class="difflineplus">+    subtest_check_invalid_hostname(amc, true, origHostname);</span>
<a href="#l24.265"></a><span id="l24.265" class="difflineplus">+  });</span>
<a href="#l24.266"></a><span id="l24.266"> </span>
<a href="#l24.267"></a><span id="l24.267">   // The new bad hostname should not have been saved.</span>
<a href="#l24.268"></a><span id="l24.268">   let newHostname = branch.getCharPref(&quot;realhostname&quot;);</span>
<a href="#l24.269"></a><span id="l24.269">   assert_equals(origHostname, newHostname);</span>
<a href="#l24.270"></a><span id="l24.270"> }</span>
<a href="#l24.271"></a><span id="l24.271"> </span>
<a href="#l24.272"></a><span id="l24.272"> /**</span>
<a href="#l24.273"></a><span id="l24.273">  * Set the hostname to an invalid value and check if it gets fixed.</span>
<a href="#l24.274"></a><span id="l24.274">  *</span>
<a href="#l24.275"></a><span id="l24.275" class="difflineplus">+ * @param amc                the account options controller</span>
<a href="#l24.276"></a><span id="l24.276">  * @param aExitSettings      Attempt to close the Account settings dialog.</span>
<a href="#l24.277"></a><span id="l24.277">  * @param aOriginalHostname  Original hostname of this server.</span>
<a href="#l24.278"></a><span id="l24.278">  */</span>
<a href="#l24.279"></a><span id="l24.279" class="difflineminus">-function subtest_check_invalid_hostname(aExitSettings, aOriginalHostname) {</span>
<a href="#l24.280"></a><span id="l24.280" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l24.281"></a><span id="l24.281" class="difflineminus">-  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, tab);</span>
<a href="#l24.282"></a><span id="l24.282" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l24.283"></a><span id="l24.283" class="difflineplus">+function subtest_check_invalid_hostname(amc, aExitSettings, aOriginalHostname) {</span>
<a href="#l24.284"></a><span id="l24.284" class="difflineplus">+  let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l24.285"></a><span id="l24.285" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l24.286"></a><span id="l24.286"> </span>
<a href="#l24.287"></a><span id="l24.287" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l24.288"></a><span id="l24.288" class="difflineplus">+  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l24.289"></a><span id="l24.289">   let hostname = iframe.contentDocument.getElementById(&quot;server.realHostName&quot;);</span>
<a href="#l24.290"></a><span id="l24.290">   assert_equals(hostname.value, aOriginalHostname);</span>
<a href="#l24.291"></a><span id="l24.291"> </span>
<a href="#l24.292"></a><span id="l24.292" class="difflineminus">-  delete_all_existing(mc, new elib.Elem(hostname));</span>
<a href="#l24.293"></a><span id="l24.293" class="difflineminus">-  input_value(mc, &quot;some_invalid+host&amp;domain*in&gt;invalid&quot;, new elib.Elem(hostname));</span>
<a href="#l24.294"></a><span id="l24.294" class="difflineminus">-</span>
<a href="#l24.295"></a><span id="l24.295" class="difflineminus">-  // As the hostname is bad, we should get a warning dialog.</span>
<a href="#l24.296"></a><span id="l24.296" class="difflineminus">-  plan_for_modal_dialog(&quot;commonDialog&quot;, function(cdc) {</span>
<a href="#l24.297"></a><span id="l24.297" class="difflineminus">-    // Just dismiss it.</span>
<a href="#l24.298"></a><span id="l24.298" class="difflineminus">-    cdc.window.document.documentElement.acceptDialog();</span>
<a href="#l24.299"></a><span id="l24.299" class="difflineminus">-  });</span>
<a href="#l24.300"></a><span id="l24.300" class="difflineplus">+  hostname.value = &quot;some_invalid+host&amp;domain*in&gt;invalid&quot;;</span>
<a href="#l24.301"></a><span id="l24.301"> </span>
<a href="#l24.302"></a><span id="l24.302">   if (!aExitSettings) {</span>
<a href="#l24.303"></a><span id="l24.303" class="difflineminus">-    let newAccountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, tab);</span>
<a href="#l24.304"></a><span id="l24.304" class="difflineminus">-    click_account_tree_row(tab, newAccountRow, false);</span>
<a href="#l24.305"></a><span id="l24.305" class="difflineminus">-    wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l24.306"></a><span id="l24.306" class="difflineminus">-    // The load of am-junk was prevented and we are back on the same pane.</span>
<a href="#l24.307"></a><span id="l24.307" class="difflineminus">-    mc.waitFor(() =&gt; tab.browser.contentWindow.pendingAccount == null,</span>
<a href="#l24.308"></a><span id="l24.308" class="difflineminus">-               &quot;Timeout waiting for pendingAccount to become null&quot;);</span>
<a href="#l24.309"></a><span id="l24.309" class="difflineplus">+    accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l24.310"></a><span id="l24.310" class="difflineplus">+    click_account_tree_row(amc, accountRow);</span>
<a href="#l24.311"></a><span id="l24.311" class="difflineplus">+</span>
<a href="#l24.312"></a><span id="l24.312" class="difflineplus">+    // The invalid hostname should be set back to previous value at this point...</span>
<a href="#l24.313"></a><span id="l24.313" class="difflineplus">+    accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l24.314"></a><span id="l24.314" class="difflineplus">+    click_account_tree_row(amc, accountRow);</span>
<a href="#l24.315"></a><span id="l24.315"> </span>
<a href="#l24.316"></a><span id="l24.316" class="difflineminus">-    let tree = content_tab_e(tab, &quot;accounttree&quot;);</span>
<a href="#l24.317"></a><span id="l24.317" class="difflineminus">-    wait_for_frame_load(content_tab_e(tab, &quot;contentFrame&quot;),</span>
<a href="#l24.318"></a><span id="l24.318" class="difflineminus">-      tab.browser.contentWindow.pageURL(tree.view.getItemAtIndex(accountRow)</span>
<a href="#l24.319"></a><span id="l24.319" class="difflineminus">-                               .getAttribute(&quot;PageTag&quot;)));</span>
<a href="#l24.320"></a><span id="l24.320" class="difflineminus">-    assert_equals(tab.browser.contentWindow.currentPageId, &quot;am-server.xul&quot;);</span>
<a href="#l24.321"></a><span id="l24.321" class="difflineminus">-    iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l24.322"></a><span id="l24.322" class="difflineminus">-    // Revert the changes to be able to close AM without warning.</span>
<a href="#l24.323"></a><span id="l24.323" class="difflineplus">+    // ...let's check that:</span>
<a href="#l24.324"></a><span id="l24.324" class="difflineplus">+    iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l24.325"></a><span id="l24.325">     hostname = iframe.contentDocument.getElementById(&quot;server.realHostName&quot;);</span>
<a href="#l24.326"></a><span id="l24.326" class="difflineminus">-    delete_all_existing(mc, new elib.Elem(hostname));</span>
<a href="#l24.327"></a><span id="l24.327" class="difflineminus">-    input_value(mc, aOriginalHostname, new elib.Elem(hostname));</span>
<a href="#l24.328"></a><span id="l24.328" class="difflineminus">-    close_advanced_settings(tab);</span>
<a href="#l24.329"></a><span id="l24.329" class="difflineplus">+    assert_equals(hostname.value, aOriginalHostname);</span>
<a href="#l24.330"></a><span id="l24.330">   } else {</span>
<a href="#l24.331"></a><span id="l24.331" class="difflineminus">-    // Close the tab to save the changes.</span>
<a href="#l24.332"></a><span id="l24.332" class="difflineminus">-    // The bad hostname should be automatically reverted.</span>
<a href="#l24.333"></a><span id="l24.333" class="difflineminus">-    close_advanced_settings(tab);</span>
<a href="#l24.334"></a><span id="l24.334" class="difflineplus">+    // If the hostname is bad, we should get a warning dialog.</span>
<a href="#l24.335"></a><span id="l24.335" class="difflineplus">+    plan_for_modal_dialog(&quot;commonDialog&quot;, function(cdc) {</span>
<a href="#l24.336"></a><span id="l24.336" class="difflineplus">+      // Just dismiss it.</span>
<a href="#l24.337"></a><span id="l24.337" class="difflineplus">+      cdc.window.document.documentElement.acceptDialog();</span>
<a href="#l24.338"></a><span id="l24.338" class="difflineplus">+    });</span>
<a href="#l24.339"></a><span id="l24.339" class="difflineplus">+</span>
<a href="#l24.340"></a><span id="l24.340" class="difflineplus">+    // Click OK on the Account settings.</span>
<a href="#l24.341"></a><span id="l24.341" class="difflineplus">+    amc.window.document.documentElement.acceptDialog();</span>
<a href="#l24.342"></a><span id="l24.342" class="difflineplus">+</span>
<a href="#l24.343"></a><span id="l24.343">     wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l24.344"></a><span id="l24.344">   }</span>
<a href="#l24.345"></a><span id="l24.345"> }</span>
<a href="#l24.346"></a><span id="l24.346"> </span>
<a href="#l24.347"></a><span id="l24.347"> /**</span>
<a href="#l24.348"></a><span id="l24.348">  * Bug 1426328.</span>
<a href="#l24.349"></a><span id="l24.349">  * Check that the AM will trim user added spaces around text values.</span>
<a href="#l24.350"></a><span id="l24.350">  */</span>
<a href="#l24.351"></a><span id="l24.351"> const badName = &quot;trailing  space &quot;;</span>
<a href="#l24.352"></a><span id="l24.352"> const badEmail = &quot; leading_space@example.com&quot;;</span>
<a href="#l24.353"></a><span id="l24.353"> </span>
<a href="#l24.354"></a><span id="l24.354"> function test_trailing_spaces() {</span>
<a href="#l24.355"></a><span id="l24.355" class="difflineminus">-  subtest_check_trailing_spaces();</span>
<a href="#l24.356"></a><span id="l24.356" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l24.357"></a><span id="l24.357" class="difflineplus">+    subtest_check_trailing_spaces(amc);</span>
<a href="#l24.358"></a><span id="l24.358" class="difflineplus">+  });</span>
<a href="#l24.359"></a><span id="l24.359">   assert_equals(gPopAccount.incomingServer.prettyName, badName.trim());</span>
<a href="#l24.360"></a><span id="l24.360">   assert_equals(gPopAccount.defaultIdentity.email, badEmail.trim());</span>
<a href="#l24.361"></a><span id="l24.361"> }</span>
<a href="#l24.362"></a><span id="l24.362"> </span>
<a href="#l24.363"></a><span id="l24.363"> /**</span>
<a href="#l24.364"></a><span id="l24.364">  * Check that the AM will trim user added spaces around text values</span>
<a href="#l24.365"></a><span id="l24.365">  * when storing them into the account.</span>
<a href="#l24.366"></a><span id="l24.366" class="difflineplus">+ *</span>
<a href="#l24.367"></a><span id="l24.367" class="difflineplus">+ * @param amc  the account options controller</span>
<a href="#l24.368"></a><span id="l24.368">  */</span>
<a href="#l24.369"></a><span id="l24.369" class="difflineminus">-function subtest_check_trailing_spaces() {</span>
<a href="#l24.370"></a><span id="l24.370" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l24.371"></a><span id="l24.371" class="difflineminus">-  let accountRow = get_account_tree_row(gPopAccount.key, null, tab);</span>
<a href="#l24.372"></a><span id="l24.372" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l24.373"></a><span id="l24.373" class="difflineplus">+function subtest_check_trailing_spaces(amc) {</span>
<a href="#l24.374"></a><span id="l24.374" class="difflineplus">+  let accountRow = get_account_tree_row(gPopAccount.key, null, amc);</span>
<a href="#l24.375"></a><span id="l24.375" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l24.376"></a><span id="l24.376"> </span>
<a href="#l24.377"></a><span id="l24.377" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l24.378"></a><span id="l24.378" class="difflineplus">+  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l24.379"></a><span id="l24.379"> </span>
<a href="#l24.380"></a><span id="l24.380">   let accountName = iframe.contentDocument.getElementById(&quot;server.prettyName&quot;);</span>
<a href="#l24.381"></a><span id="l24.381">   let defaultAddress = iframe.contentDocument.getElementById(&quot;identity.email&quot;);</span>
<a href="#l24.382"></a><span id="l24.382" class="difflineminus">-  delete_all_existing(mc, new elib.Elem(accountName));</span>
<a href="#l24.383"></a><span id="l24.383" class="difflineminus">-  delete_all_existing(mc, new elib.Elem(defaultAddress));</span>
<a href="#l24.384"></a><span id="l24.384" class="difflineminus">-  input_value(mc, badName, new elib.Elem(accountName));</span>
<a href="#l24.385"></a><span id="l24.385" class="difflineminus">-  input_value(mc, badEmail, new elib.Elem(defaultAddress));</span>
<a href="#l24.386"></a><span id="l24.386" class="difflineplus">+  delete_all_existing(amc, new elib.Elem(accountName));</span>
<a href="#l24.387"></a><span id="l24.387" class="difflineplus">+  delete_all_existing(amc, new elib.Elem(defaultAddress));</span>
<a href="#l24.388"></a><span id="l24.388" class="difflineplus">+  input_value(amc, badName, new elib.Elem(accountName));</span>
<a href="#l24.389"></a><span id="l24.389" class="difflineplus">+  input_value(amc, badEmail, new elib.Elem(defaultAddress));</span>
<a href="#l24.390"></a><span id="l24.390"> </span>
<a href="#l24.391"></a><span id="l24.391">   assert_equals(accountName.value, badName);</span>
<a href="#l24.392"></a><span id="l24.392">   assert_equals(defaultAddress.value, badEmail);</span>
<a href="#l24.393"></a><span id="l24.393"> </span>
<a href="#l24.394"></a><span id="l24.394" class="difflineminus">-  // We really need to save the new values.</span>
<a href="#l24.395"></a><span id="l24.395" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l24.396"></a><span id="l24.396" class="difflineplus">+  // We really need to save the new values so click OK on the Account settings.</span>
<a href="#l24.397"></a><span id="l24.397" class="difflineplus">+  amc.window.document.documentElement.acceptDialog();</span>
<a href="#l24.398"></a><span id="l24.398"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/test/mozmill/account/test-archive-options.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-archive-options.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -2,59 +2,53 @@</span>
<a href="#l25.4"></a><span id="l25.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l25.5"></a><span id="l25.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l25.6"></a><span id="l25.6"> </span>
<a href="#l25.7"></a><span id="l25.7"> &quot;use strict&quot;;</span>
<a href="#l25.8"></a><span id="l25.8"> </span>
<a href="#l25.9"></a><span id="l25.9"> /* import-globals-from ../shared-modules/test-account-manager-helpers.js */</span>
<a href="#l25.10"></a><span id="l25.10"> /* import-globals-from ../shared-modules/test-folder-display-helpers.js */</span>
<a href="#l25.11"></a><span id="l25.11"> /* import-globals-from ../shared-modules/test-window-helpers.js */</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-/* import-globals-from ../shared-modules/test-content-tab-helpers.js */</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-/* import-globals-from ../shared-modules/test-pref-window-helpers.js */</span>
<a href="#l25.14"></a><span id="l25.14"> </span>
<a href="#l25.15"></a><span id="l25.15"> var MODULE_NAME = &quot;test-archive-options&quot;;</span>
<a href="#l25.16"></a><span id="l25.16"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineminus">-var MODULE_REQUIRES = [</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">-  &quot;folder-display-helpers&quot;,</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineminus">-  &quot;window-helpers&quot;,</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">-  &quot;account-manager-helpers&quot;,</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineminus">-  &quot;content-tab-helpers&quot;,</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineminus">-  &quot;pref-window-helpers&quot;,</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineminus">-];</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineplus">+var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;window-helpers&quot;, &quot;account-manager-helpers&quot;];</span>
<a href="#l25.25"></a><span id="l25.25"> </span>
<a href="#l25.26"></a><span id="l25.26"> var mozmill = ChromeUtils.import(&quot;chrome://mozmill/content/modules/mozmill.jsm&quot;);</span>
<a href="#l25.27"></a><span id="l25.27"> var controller = ChromeUtils.import(&quot;chrome://mozmill/content/modules/controller.jsm&quot;);</span>
<a href="#l25.28"></a><span id="l25.28"> var elib = ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.jsm&quot;);</span>
<a href="#l25.29"></a><span id="l25.29"> </span>
<a href="#l25.30"></a><span id="l25.30"> var defaultIdentity;</span>
<a href="#l25.31"></a><span id="l25.31"> </span>
<a href="#l25.32"></a><span id="l25.32"> function setupModule(module) {</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineminus">-  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">-    collector.getModule(lib).installInto(module);</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineminus">-  }</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+  let wh = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+  wh.installInto(module);</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineplus">+  let fdh = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineplus">+  fdh.installInto(module);</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+  let amh = collector.getModule(&quot;account-manager-helpers&quot;);</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineplus">+  amh.installInto(module);</span>
<a href="#l25.42"></a><span id="l25.42"> </span>
<a href="#l25.43"></a><span id="l25.43">   defaultIdentity = MailServices.accounts.defaultAccount.defaultIdentity;</span>
<a href="#l25.44"></a><span id="l25.44"> }</span>
<a href="#l25.45"></a><span id="l25.45"> </span>
<a href="#l25.46"></a><span id="l25.46"> /**</span>
<a href="#l25.47"></a><span id="l25.47">  * Check that the archive options button is enabled or disabled appropriately.</span>
<a href="#l25.48"></a><span id="l25.48">  *</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineplus">+ * @param amc          the account options controller</span>
<a href="#l25.50"></a><span id="l25.50">  * @param aAccountKey  key of the account the check</span>
<a href="#l25.51"></a><span id="l25.51">  * @param isEnabled    true if the button should be enabled, false otherwise</span>
<a href="#l25.52"></a><span id="l25.52">  */</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineminus">-function subtest_check_archive_options_enabled(aAccountKey, isEnabled) {</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-  let accountRow = get_account_tree_row(aAccountKey, &quot;am-copies.xul&quot;, tab);</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineplus">+function subtest_check_archive_options_enabled(amc, aAccountKey, isEnabled) {</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineplus">+  let accountRow = get_account_tree_row(aAccountKey, &quot;am-copies.xul&quot;, amc);</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineplus">+  click_account_tree_row(amc, accountRow);</span>
<a href="#l25.60"></a><span id="l25.60"> </span>
<a href="#l25.61"></a><span id="l25.61" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineplus">+  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l25.63"></a><span id="l25.63">   let button = iframe.contentDocument.getElementById(&quot;archiveHierarchyButton&quot;);</span>
<a href="#l25.64"></a><span id="l25.64"> </span>
<a href="#l25.65"></a><span id="l25.65">   assert_equals(button.disabled, !isEnabled);</span>
<a href="#l25.66"></a><span id="l25.66" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l25.67"></a><span id="l25.67"> }</span>
<a href="#l25.68"></a><span id="l25.68"> </span>
<a href="#l25.69"></a><span id="l25.69"> function test_archive_options_enabled() {</span>
<a href="#l25.70"></a><span id="l25.70">   let defaultAccount = MailServices.accounts.defaultAccount;</span>
<a href="#l25.71"></a><span id="l25.71">   // First, create an IMAP server</span>
<a href="#l25.72"></a><span id="l25.72">   let imapServer = MailServices.accounts</span>
<a href="#l25.73"></a><span id="l25.73">     .createIncomingServer(&quot;nobody&quot;, &quot;example.com&quot;, &quot;imap&quot;)</span>
<a href="#l25.74"></a><span id="l25.74">     .QueryInterface(Ci.nsIImapIncomingServer);</span>
<a href="#l25.75"></a><span id="l25.75" class="difflineat">@@ -70,22 +64,30 @@ function test_archive_options_enabled() </span>
<a href="#l25.76"></a><span id="l25.76"> </span>
<a href="#l25.77"></a><span id="l25.77">   // Let the default identity archive to our IMAP folder, to ensure that the</span>
<a href="#l25.78"></a><span id="l25.78">   // archive folder's server is used to determine the enabled/disabled state</span>
<a href="#l25.79"></a><span id="l25.79">   // of the &quot;archive options&quot; button, *not* the incoming server for that</span>
<a href="#l25.80"></a><span id="l25.80">   // identity.</span>
<a href="#l25.81"></a><span id="l25.81">   defaultIdentity.archiveFolder = imapServer.rootFolder.URI;</span>
<a href="#l25.82"></a><span id="l25.82"> </span>
<a href="#l25.83"></a><span id="l25.83">   imapServer.isGMailServer = false;</span>
<a href="#l25.84"></a><span id="l25.84" class="difflineminus">-  subtest_check_archive_options_enabled(account.key, true);</span>
<a href="#l25.85"></a><span id="l25.85" class="difflineminus">-  subtest_check_archive_options_enabled(defaultAccount.key, true);</span>
<a href="#l25.86"></a><span id="l25.86" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l25.87"></a><span id="l25.87" class="difflineplus">+    subtest_check_archive_options_enabled(amc, account.key, true);</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineplus">+  });</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineplus">+    subtest_check_archive_options_enabled(amc, defaultAccount.key, true);</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineplus">+  });</span>
<a href="#l25.92"></a><span id="l25.92"> </span>
<a href="#l25.93"></a><span id="l25.93">   imapServer.isGMailServer = true;</span>
<a href="#l25.94"></a><span id="l25.94" class="difflineminus">-  subtest_check_archive_options_enabled(account.key, false);</span>
<a href="#l25.95"></a><span id="l25.95" class="difflineminus">-  subtest_check_archive_options_enabled(defaultAccount.key, false);</span>
<a href="#l25.96"></a><span id="l25.96" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l25.97"></a><span id="l25.97" class="difflineplus">+    subtest_check_archive_options_enabled(amc, account.key, false);</span>
<a href="#l25.98"></a><span id="l25.98" class="difflineplus">+  });</span>
<a href="#l25.99"></a><span id="l25.99" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l25.100"></a><span id="l25.100" class="difflineplus">+    subtest_check_archive_options_enabled(amc, defaultAccount.key, false);</span>
<a href="#l25.101"></a><span id="l25.101" class="difflineplus">+  });</span>
<a href="#l25.102"></a><span id="l25.102"> </span>
<a href="#l25.103"></a><span id="l25.103">   MailServices.accounts.removeAccount(account);</span>
<a href="#l25.104"></a><span id="l25.104"> }</span>
<a href="#l25.105"></a><span id="l25.105"> </span>
<a href="#l25.106"></a><span id="l25.106"> function subtest_initial_state(identity) {</span>
<a href="#l25.107"></a><span id="l25.107">   plan_for_modal_dialog(&quot;archive-options&quot;, function(ac) {</span>
<a href="#l25.108"></a><span id="l25.108">     assert_equals(ac.e(&quot;archiveGranularity&quot;).selectedIndex,</span>
<a href="#l25.109"></a><span id="l25.109">                   identity.archiveGranularity);</span>
<a href="#l25.110"></a><span id="l25.110" class="difflineat">@@ -124,51 +126,53 @@ function test_save_archive_options() {</span>
<a href="#l25.111"></a><span id="l25.111">   defaultIdentity.archiveGranularity = 0;</span>
<a href="#l25.112"></a><span id="l25.112">   defaultIdentity.archiveKeepFolderStructure = false;</span>
<a href="#l25.113"></a><span id="l25.113">   subtest_save_state(defaultIdentity, 1, true);</span>
<a href="#l25.114"></a><span id="l25.114"> </span>
<a href="#l25.115"></a><span id="l25.115">   assert_equals(defaultIdentity.archiveGranularity, 1);</span>
<a href="#l25.116"></a><span id="l25.116">   assert_equals(defaultIdentity.archiveKeepFolderStructure, true);</span>
<a href="#l25.117"></a><span id="l25.117"> }</span>
<a href="#l25.118"></a><span id="l25.118"> </span>
<a href="#l25.119"></a><span id="l25.119" class="difflineminus">-function subtest_check_archive_enabled(archiveEnabled) {</span>
<a href="#l25.120"></a><span id="l25.120" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l25.121"></a><span id="l25.121" class="difflineplus">+function subtest_check_archive_enabled(amc, archiveEnabled) {</span>
<a href="#l25.122"></a><span id="l25.122">   defaultIdentity.archiveEnabled = archiveEnabled;</span>
<a href="#l25.123"></a><span id="l25.123"> </span>
<a href="#l25.124"></a><span id="l25.124" class="difflineminus">-  click_account_tree_row(tab, 2);</span>
<a href="#l25.125"></a><span id="l25.125" class="difflineplus">+  click_account_tree_row(amc, 2);</span>
<a href="#l25.126"></a><span id="l25.126"> </span>
<a href="#l25.127"></a><span id="l25.127" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l25.128"></a><span id="l25.128" class="difflineplus">+  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l25.129"></a><span id="l25.129">   let checkbox = iframe.contentDocument.getElementById(&quot;identity.archiveEnabled&quot;);</span>
<a href="#l25.130"></a><span id="l25.130" class="difflineplus">+</span>
<a href="#l25.131"></a><span id="l25.131">   assert_equals(checkbox.checked, archiveEnabled);</span>
<a href="#l25.132"></a><span id="l25.132" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l25.133"></a><span id="l25.133"> }</span>
<a href="#l25.134"></a><span id="l25.134"> </span>
<a href="#l25.135"></a><span id="l25.135" class="difflineminus">-test_archive_enabled.__force_skip__ = true; // disabled temporarily, bug 1096006</span>
<a href="#l25.136"></a><span id="l25.136"> function test_archive_enabled() {</span>
<a href="#l25.137"></a><span id="l25.137" class="difflineminus">-  subtest_check_archive_enabled(true);</span>
<a href="#l25.138"></a><span id="l25.138" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l25.139"></a><span id="l25.139" class="difflineplus">+    subtest_check_archive_enabled(amc, true);</span>
<a href="#l25.140"></a><span id="l25.140" class="difflineplus">+  });</span>
<a href="#l25.141"></a><span id="l25.141"> </span>
<a href="#l25.142"></a><span id="l25.142" class="difflineminus">-  subtest_check_archive_enabled(false);</span>
<a href="#l25.143"></a><span id="l25.143" class="difflineplus">+  open_advanced_settings(function(amc) {</span>
<a href="#l25.144"></a><span id="l25.144" class="difflineplus">+    subtest_check_archive_enabled(amc, false);</span>
<a href="#l25.145"></a><span id="l25.145" class="difflineplus">+  });</span>
<a href="#l25.146"></a><span id="l25.146"> }</span>
<a href="#l25.147"></a><span id="l25.147"> </span>
<a href="#l25.148"></a><span id="l25.148" class="difflineminus">-test_disable_archive.__force_skip__ = true; // disabled temporarily, bug 1096006</span>
<a href="#l25.149"></a><span id="l25.149" class="difflineminus">-function test_disable_archive() {</span>
<a href="#l25.150"></a><span id="l25.150" class="difflineminus">-  let tab = open_advanced_settings();</span>
<a href="#l25.151"></a><span id="l25.151" class="difflineplus">+function subtest_disable_archive(amc) {</span>
<a href="#l25.152"></a><span id="l25.152">   defaultIdentity.archiveEnabled = true;</span>
<a href="#l25.153"></a><span id="l25.153" class="difflineminus">-  click_account_tree_row(tab, 2);</span>
<a href="#l25.154"></a><span id="l25.154" class="difflineplus">+  click_account_tree_row(amc, 2);</span>
<a href="#l25.155"></a><span id="l25.155"> </span>
<a href="#l25.156"></a><span id="l25.156" class="difflineminus">-  let iframe = content_tab_e(tab, &quot;contentFrame&quot;);</span>
<a href="#l25.157"></a><span id="l25.157" class="difflineplus">+  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l25.158"></a><span id="l25.158">   let checkbox = iframe.contentDocument.getElementById(&quot;identity.archiveEnabled&quot;);</span>
<a href="#l25.159"></a><span id="l25.159"> </span>
<a href="#l25.160"></a><span id="l25.160">   assert_true(checkbox.checked);</span>
<a href="#l25.161"></a><span id="l25.161">   assert_false(checkbox.disabled);</span>
<a href="#l25.162"></a><span id="l25.162" class="difflineminus">-  mc.click(new elib.Elem(checkbox));</span>
<a href="#l25.163"></a><span id="l25.163" class="difflineplus">+  amc.click(new elib.Elem(checkbox));</span>
<a href="#l25.164"></a><span id="l25.164">   utils.waitFor(() =&gt; !checkbox.checked, &quot;Archive checkbox didn't toggle to unchecked&quot;);</span>
<a href="#l25.165"></a><span id="l25.165" class="difflineminus">-  plan_for_window_close(mc);</span>
<a href="#l25.166"></a><span id="l25.166" class="difflineminus">-  mc.window.document.getElementById(&quot;accountManager&quot;).acceptDialog();</span>
<a href="#l25.167"></a><span id="l25.167" class="difflineplus">+  plan_for_window_close(amc);</span>
<a href="#l25.168"></a><span id="l25.168" class="difflineplus">+  amc.window.document.getElementById(&quot;accountManager&quot;).acceptDialog();</span>
<a href="#l25.169"></a><span id="l25.169">   wait_for_window_close();</span>
<a href="#l25.170"></a><span id="l25.170"> </span>
<a href="#l25.171"></a><span id="l25.171">   assert_false(defaultIdentity.archiveEnabled);</span>
<a href="#l25.172"></a><span id="l25.172" class="difflineminus">-  close_advanced_settings(tab);</span>
<a href="#l25.173"></a><span id="l25.173"> }</span>
<a href="#l25.174"></a><span id="l25.174"> </span>
<a href="#l25.175"></a><span id="l25.175" class="difflineplus">+function test_disable_archive() {</span>
<a href="#l25.176"></a><span id="l25.176" class="difflineplus">+  open_advanced_settings(subtest_disable_archive);</span>
<a href="#l25.177"></a><span id="l25.177" class="difflineplus">+}</span>
<a href="#l25.178"></a><span id="l25.178"> // Disable test on Windows since for some yet unknown reason clicking the checkbox</span>
<a href="#l25.179"></a><span id="l25.179"> // doesn't have the desired result. See bug 1461173 for details.</span>
<a href="#l25.180"></a><span id="l25.180" class="difflineminus">-// test_disable_archive.EXCLUDED_PLATFORMS = [&quot;winnt&quot;];</span>
<a href="#l25.181"></a><span id="l25.181" class="difflineplus">+test_disable_archive.EXCLUDED_PLATFORMS = [&quot;winnt&quot;];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/test/mozmill/account/test-mail-account-setup-wizard.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-mail-account-setup-wizard.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -33,18 +33,18 @@ var user = {</span>
<a href="#l26.4"></a><span id="l26.4"> </span>
<a href="#l26.5"></a><span id="l26.5"> function setupModule(module) {</span>
<a href="#l26.6"></a><span id="l26.6">   for (let lib of MODULE_REQUIRES) {</span>
<a href="#l26.7"></a><span id="l26.7">     collector.getModule(lib).installInto(module);</span>
<a href="#l26.8"></a><span id="l26.8">   }</span>
<a href="#l26.9"></a><span id="l26.9"> }</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11"> // Remove an account in the Account Manager, but not via the UI.</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-function remove_account_internal(tab, aAccount, aOutgoing) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  let win = tab.browser.contentWindow;</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+function remove_account_internal(amc, aAccount, aOutgoing) {</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+  let win = amc.window;</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17">   try {</span>
<a href="#l26.18"></a><span id="l26.18">     // Remove the account and incoming server</span>
<a href="#l26.19"></a><span id="l26.19">     let serverId = aAccount.incomingServer.serverURI;</span>
<a href="#l26.20"></a><span id="l26.20">     MailServices.accounts.removeAccount(aAccount);</span>
<a href="#l26.21"></a><span id="l26.21">     if (serverId in win.accountArray)</span>
<a href="#l26.22"></a><span id="l26.22">       delete win.accountArray[serverId];</span>
<a href="#l26.23"></a><span id="l26.23">     win.selectServer(null, null);</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineat">@@ -85,26 +85,27 @@ function test_mail_account_setup() {</span>
<a href="#l26.25"></a><span id="l26.25">     // XXX: This should probably use a notification, once we fix bug 561143.</span>
<a href="#l26.26"></a><span id="l26.26">     awc.waitFor(() =&gt; awc.window.gEmailConfigWizard._currentConfig != null,</span>
<a href="#l26.27"></a><span id="l26.27">                 &quot;Timeout waiting for current config to become non-null&quot;,</span>
<a href="#l26.28"></a><span id="l26.28">                 8000, 600);</span>
<a href="#l26.29"></a><span id="l26.29"> </span>
<a href="#l26.30"></a><span id="l26.30">     // Open the advanced settings (Account Manager) to create the account</span>
<a href="#l26.31"></a><span id="l26.31">     // immediately.  We use an invalid email/password so the setup will fail</span>
<a href="#l26.32"></a><span id="l26.32">     // anyway.</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-    let tab = open_advanced_settings_from_account_wizard(awc);</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">-    subtest_verify_account(tab);</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineplus">+    open_advanced_settings_from_account_wizard(subtest_verify_account, awc);</span>
<a href="#l26.36"></a><span id="l26.36"> </span>
<a href="#l26.37"></a><span id="l26.37">     // Clean up</span>
<a href="#l26.38"></a><span id="l26.38">     Services.prefs.clearUserPref(pref_name);</span>
<a href="#l26.39"></a><span id="l26.39">   });</span>
<a href="#l26.40"></a><span id="l26.40"> }</span>
<a href="#l26.41"></a><span id="l26.41"> </span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-function subtest_verify_account(tab) {</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineminus">-  let account = tab.browser.contentWindow.currentAccount;</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+function subtest_verify_account(amc) {</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineplus">+  amc.waitFor(() =&gt; amc.window.currentAccount != null,</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineplus">+              &quot;Timeout waiting for currentAccount to become non-null&quot;);</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineplus">+  let account = amc.window.currentAccount;</span>
<a href="#l26.48"></a><span id="l26.48">   let identity = account.defaultIdentity;</span>
<a href="#l26.49"></a><span id="l26.49">   let incoming = account.incomingServer;</span>
<a href="#l26.50"></a><span id="l26.50">   let outgoing = MailServices.smtp.getServerByKey(identity.smtpServerKey);</span>
<a href="#l26.51"></a><span id="l26.51"> </span>
<a href="#l26.52"></a><span id="l26.52">   let config = {</span>
<a href="#l26.53"></a><span id="l26.53">     &quot;incoming server username&quot;: {</span>
<a href="#l26.54"></a><span id="l26.54">       actual: incoming.username, expected: user.email.split(&quot;@&quot;)[0],</span>
<a href="#l26.55"></a><span id="l26.55">     },</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineat">@@ -126,17 +127,17 @@ function subtest_verify_account(tab) {</span>
<a href="#l26.57"></a><span id="l26.57">   try {</span>
<a href="#l26.58"></a><span id="l26.58">     for (let i in config) {</span>
<a href="#l26.59"></a><span id="l26.59">       if (config[i].actual != config[i].expected) {</span>
<a href="#l26.60"></a><span id="l26.60">         throw new Error(&quot;Configured &quot; + i + &quot; is &quot; + config[i].actual +</span>
<a href="#l26.61"></a><span id="l26.61">                         &quot;. It should be &quot; + config[i].expected + &quot;.&quot;);</span>
<a href="#l26.62"></a><span id="l26.62">       }</span>
<a href="#l26.63"></a><span id="l26.63">     }</span>
<a href="#l26.64"></a><span id="l26.64">   } finally {</span>
<a href="#l26.65"></a><span id="l26.65" class="difflineminus">-    remove_account_internal(tab, account, outgoing);</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineplus">+    remove_account_internal(amc, account, outgoing);</span>
<a href="#l26.67"></a><span id="l26.67">   }</span>
<a href="#l26.68"></a><span id="l26.68"> }</span>
<a href="#l26.69"></a><span id="l26.69"> </span>
<a href="#l26.70"></a><span id="l26.70"> /**</span>
<a href="#l26.71"></a><span id="l26.71">  * Make sure that we don't re-set the information we get from the config</span>
<a href="#l26.72"></a><span id="l26.72">  * file if the password is incorrect.</span>
<a href="#l26.73"></a><span id="l26.73">  */</span>
<a href="#l26.74"></a><span id="l26.74"> function test_bad_password_uses_old_settings() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/test/mozmill/account/test-retest-config.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-retest-config.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -96,8 +96,9 @@ function test_re_test_config() {</span>
<a href="#l27.4"></a><span id="l27.4">     assert_true(!awc.e(&quot;manual-edit_button&quot;).hidden,</span>
<a href="#l27.5"></a><span id="l27.5">       &quot;We're not back to the original state!&quot;);</span>
<a href="#l27.6"></a><span id="l27.6">     assert_true(awc.e(&quot;advanced-setup_button&quot;).hidden,</span>
<a href="#l27.7"></a><span id="l27.7">       &quot;We're not back to the original state!&quot;);</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9">     close_window(awc);</span>
<a href="#l27.10"></a><span id="l27.10">   });</span>
<a href="#l27.11"></a><span id="l27.11"> }</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-account-manager-helpers.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-account-manager-helpers.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1,104 +1,66 @@</span>
<a href="#l28.4"></a><span id="l28.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l28.5"></a><span id="l28.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l28.6"></a><span id="l28.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8"> &quot;use strict&quot;;</span>
<a href="#l28.9"></a><span id="l28.9"> </span>
<a href="#l28.10"></a><span id="l28.10"> var MODULE_NAME = &quot;account-manager-helpers&quot;;</span>
<a href="#l28.11"></a><span id="l28.11"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;window-helpers&quot;,</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-                       &quot;pref-window-helpers&quot;, &quot;content-tab-helpers&quot;];</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;window-helpers&quot;];</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16"> var utils = ChromeUtils.import(&quot;chrome://mozmill/content/modules/utils.jsm&quot;);</span>
<a href="#l28.17"></a><span id="l28.17"> var elib = ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.jsm&quot;);</span>
<a href="#l28.18"></a><span id="l28.18"> </span>
<a href="#l28.19"></a><span id="l28.19" class="difflineminus">-var wh, fdh, pwh, cth, mc;</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+var wh, fdh, mc;</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22"> function setupModule() {</span>
<a href="#l28.23"></a><span id="l28.23">   fdh = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l28.24"></a><span id="l28.24">   mc = fdh.mc;</span>
<a href="#l28.25"></a><span id="l28.25">   wh = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-  pwh = collector.getModule(&quot;pref-window-helpers&quot;);</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">-  cth = collector.getModule(&quot;content-tab-helpers&quot;);</span>
<a href="#l28.28"></a><span id="l28.28"> }</span>
<a href="#l28.29"></a><span id="l28.29"> </span>
<a href="#l28.30"></a><span id="l28.30"> function installInto(module) {</span>
<a href="#l28.31"></a><span id="l28.31">   setupModule();</span>
<a href="#l28.32"></a><span id="l28.32"> </span>
<a href="#l28.33"></a><span id="l28.33">   // Now copy helper functions</span>
<a href="#l28.34"></a><span id="l28.34">   module.open_advanced_settings = open_advanced_settings;</span>
<a href="#l28.35"></a><span id="l28.35">   module.open_advanced_settings_from_account_wizard =</span>
<a href="#l28.36"></a><span id="l28.36">     open_advanced_settings_from_account_wizard;</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineminus">-  module.close_advanced_settings = close_advanced_settings;</span>
<a href="#l28.38"></a><span id="l28.38">   module.open_mail_account_setup_wizard = open_mail_account_setup_wizard;</span>
<a href="#l28.39"></a><span id="l28.39">   module.click_account_tree_row = click_account_tree_row;</span>
<a href="#l28.40"></a><span id="l28.40">   module.get_account_tree_row = get_account_tree_row;</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineminus">-  module.wait_for_account_tree_load = wait_for_account_tree_load;</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineminus">-  module.wait_for_account_tree_selection = wait_for_account_tree_selection;</span>
<a href="#l28.43"></a><span id="l28.43">   module.remove_account = remove_account;</span>
<a href="#l28.44"></a><span id="l28.44"> }</span>
<a href="#l28.45"></a><span id="l28.45"> </span>
<a href="#l28.46"></a><span id="l28.46"> /**</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineminus">- * Waits until the Account Manager tree fully loads after first open.</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineminus">- */</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineminus">-function wait_for_account_tree_load(tab) {</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineminus">-  mc.waitFor(() =&gt; tab.browser.contentWindow.currentAccount != null,</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineminus">-              &quot;Timeout waiting for currentAccount to become non-null&quot;);</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineminus">-  var tree = cth.content_tab_e(tab, &quot;account-tree-children&quot;);</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineminus">-  mc.waitFor(() =&gt; tree.hasAttribute(&quot;tree-loaded&quot;),</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineminus">-              &quot;Timeout waiting for account tree build&quot;);</span>
<a href="#l28.55"></a><span id="l28.55" class="difflineminus">-}</span>
<a href="#l28.56"></a><span id="l28.56" class="difflineminus">-</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineminus">-/**</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">- * Ensure the page is fully loaded (e.g. onInit functions).</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineplus">+ * Opens the Account Manager.</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineplus">+ *</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineplus">+ * @param callback Callback for the modal dialog that is opened.</span>
<a href="#l28.62"></a><span id="l28.62">  */</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineminus">-function wait_for_account_tree_selection(tab, index = -1) {</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineminus">-  utils.waitFor(() =&gt; tab.browser.contentWindow.pendingAccount == null,</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineminus">-                &quot;Timeout waiting for pendingAccount to become null&quot;);</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineplus">+function open_advanced_settings(aCallback, aController) {</span>
<a href="#l28.67"></a><span id="l28.67" class="difflineplus">+  if (aController === undefined)</span>
<a href="#l28.68"></a><span id="l28.68" class="difflineplus">+    aController = mc;</span>
<a href="#l28.69"></a><span id="l28.69"> </span>
<a href="#l28.70"></a><span id="l28.70" class="difflineminus">-  var tree = cth.content_tab_e(tab, &quot;accounttree&quot;);</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineminus">-  if (index &lt; 0)</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineminus">-    index = tree.view.selection.currentIndex;</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineminus">-  wh.wait_for_frame_load(cth.content_tab_e(tab, &quot;contentFrame&quot;),</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineminus">-    tab.browser.contentWindow.pageURL(tree.view.getItemAtIndex(index)</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineminus">-                             .getAttribute(&quot;PageTag&quot;)));</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineminus">-}</span>
<a href="#l28.77"></a><span id="l28.77" class="difflineminus">-</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineminus">-/**</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineminus">- * Opens the Account Manager pane in pre Preferences tab.</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineminus">- */</span>
<a href="#l28.81"></a><span id="l28.81" class="difflineminus">-function open_advanced_settings() {</span>
<a href="#l28.82"></a><span id="l28.82" class="difflineminus">-  var tab = pwh.open_pref_tab(&quot;paneAccount&quot;);</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineminus">-  wait_for_account_tree_load(tab);</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineminus">-  return tab;</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineplus">+  wh.plan_for_modal_dialog(&quot;mailnews:accountmanager&quot;, aCallback);</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineplus">+  aController.click(mc.eid(&quot;menu_accountmgr&quot;));</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineplus">+  return wh.wait_for_modal_dialog(&quot;mailnews:accountmanager&quot;);</span>
<a href="#l28.88"></a><span id="l28.88"> }</span>
<a href="#l28.89"></a><span id="l28.89"> </span>
<a href="#l28.90"></a><span id="l28.90"> /**</span>
<a href="#l28.91"></a><span id="l28.91">  * Opens the Account Manager from the mail account setup wizard.</span>
<a href="#l28.92"></a><span id="l28.92">  *</span>
<a href="#l28.93"></a><span id="l28.93" class="difflineminus">- * @param aController Controller of the Account Wizard window.</span>
<a href="#l28.94"></a><span id="l28.94" class="difflineplus">+ * @param callback Callback for the modal dialog that is opened.</span>
<a href="#l28.95"></a><span id="l28.95">  */</span>
<a href="#l28.96"></a><span id="l28.96" class="difflineminus">-function open_advanced_settings_from_account_wizard(aController) {</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineplus">+function open_advanced_settings_from_account_wizard(aCallback, aController) {</span>
<a href="#l28.98"></a><span id="l28.98" class="difflineplus">+  wh.plan_for_modal_dialog(&quot;mailnews:accountmanager&quot;, aCallback);</span>
<a href="#l28.99"></a><span id="l28.99">   aController.e(&quot;manual-edit_button&quot;).click();</span>
<a href="#l28.100"></a><span id="l28.100">   aController.e(&quot;advanced-setup_button&quot;).click();</span>
<a href="#l28.101"></a><span id="l28.101" class="difflineminus">-  var tabmail = mc.e(&quot;tabmail&quot;);</span>
<a href="#l28.102"></a><span id="l28.102" class="difflineminus">-  tabmail.selectTabByMode(&quot;preferencesTab&quot;);</span>
<a href="#l28.103"></a><span id="l28.103" class="difflineminus">-  var tab;</span>
<a href="#l28.104"></a><span id="l28.104" class="difflineminus">-  mc.waitFor(</span>
<a href="#l28.105"></a><span id="l28.105" class="difflineminus">-    () =&gt; (tab = tabmail.getTabInfoForCurrentOrFirstModeInstance(</span>
<a href="#l28.106"></a><span id="l28.106" class="difflineminus">-           tabmail.tabModes.preferencesTab)) != null,</span>
<a href="#l28.107"></a><span id="l28.107" class="difflineminus">-             &quot;Couldn't find the Preferences tab with the Account manager&quot;);</span>
<a href="#l28.108"></a><span id="l28.108" class="difflineminus">-  wait_for_account_tree_load(tab);</span>
<a href="#l28.109"></a><span id="l28.109" class="difflineminus">-  return tab;</span>
<a href="#l28.110"></a><span id="l28.110" class="difflineminus">-}</span>
<a href="#l28.111"></a><span id="l28.111" class="difflineminus">-</span>
<a href="#l28.112"></a><span id="l28.112" class="difflineminus">-function close_advanced_settings(tab) {</span>
<a href="#l28.113"></a><span id="l28.113" class="difflineminus">-  pwh.close_pref_tab(tab);</span>
<a href="#l28.114"></a><span id="l28.114" class="difflineplus">+  return wh.wait_for_modal_dialog(&quot;mailnews:accountmanager&quot;);</span>
<a href="#l28.115"></a><span id="l28.115"> }</span>
<a href="#l28.116"></a><span id="l28.116"> </span>
<a href="#l28.117"></a><span id="l28.117"> /**</span>
<a href="#l28.118"></a><span id="l28.118">  * Use File &gt; New &gt; Mail Account to open the Mail Account Setup Wizard.</span>
<a href="#l28.119"></a><span id="l28.119">  *</span>
<a href="#l28.120"></a><span id="l28.120">  * @param aCallback  Function to run once the dialog is open. The function</span>
<a href="#l28.121"></a><span id="l28.121">  *                   gets the new window controller passed as first argument.</span>
<a href="#l28.122"></a><span id="l28.122">  */</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineat">@@ -106,51 +68,52 @@ function open_mail_account_setup_wizard(</span>
<a href="#l28.124"></a><span id="l28.124">   wh.plan_for_modal_dialog(&quot;mail:autoconfig&quot;, aCallback);</span>
<a href="#l28.125"></a><span id="l28.125">   mc.click(new elib.Elem(mc.menus.menu_File.menu_New.newMailAccountMenuItem));</span>
<a href="#l28.126"></a><span id="l28.126">   return wh.wait_for_modal_dialog(&quot;mail:autoconfig&quot;, 30000);</span>
<a href="#l28.127"></a><span id="l28.127"> }</span>
<a href="#l28.128"></a><span id="l28.128"> </span>
<a href="#l28.129"></a><span id="l28.129"> /**</span>
<a href="#l28.130"></a><span id="l28.130">  * Click a row in the account settings tree</span>
<a href="#l28.131"></a><span id="l28.131">  *</span>
<a href="#l28.132"></a><span id="l28.132" class="difflineminus">- * @param tab       the account settings tab</span>
<a href="#l28.133"></a><span id="l28.133" class="difflineminus">- * @param rowIndex  the row to click</span>
<a href="#l28.134"></a><span id="l28.134" class="difflineminus">- * @param wait      whether to wait for finishing the load</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineplus">+ * @param controller the Mozmill controller for the account settings dialog</span>
<a href="#l28.136"></a><span id="l28.136" class="difflineplus">+ * @param rowIndex the row to click</span>
<a href="#l28.137"></a><span id="l28.137">  */</span>
<a href="#l28.138"></a><span id="l28.138" class="difflineminus">-function click_account_tree_row(tab, rowIndex, wait = true) {</span>
<a href="#l28.139"></a><span id="l28.139" class="difflineminus">-  utils.waitFor(() =&gt; tab.browser.contentWindow.getCurrentAccount() != null,</span>
<a href="#l28.140"></a><span id="l28.140" class="difflineplus">+function click_account_tree_row(controller, rowIndex) {</span>
<a href="#l28.141"></a><span id="l28.141" class="difflineplus">+  utils.waitFor(() =&gt; controller.window.currentAccount != null,</span>
<a href="#l28.142"></a><span id="l28.142">                 &quot;Timeout waiting for currentAccount to become non-null&quot;);</span>
<a href="#l28.143"></a><span id="l28.143"> </span>
<a href="#l28.144"></a><span id="l28.144" class="difflineminus">-  let tree = cth.content_tab_e(tab, &quot;accounttree&quot;);</span>
<a href="#l28.145"></a><span id="l28.145" class="difflineplus">+  let tree = controller.window.document.getElementById(&quot;accounttree&quot;);</span>
<a href="#l28.146"></a><span id="l28.146"> </span>
<a href="#l28.147"></a><span id="l28.147" class="difflineminus">-  fdh.click_tree_row(tree, rowIndex, mc);</span>
<a href="#l28.148"></a><span id="l28.148" class="difflineplus">+  fdh.click_tree_row(tree, rowIndex, controller);</span>
<a href="#l28.149"></a><span id="l28.149"> </span>
<a href="#l28.150"></a><span id="l28.150" class="difflineminus">-  if (!wait)</span>
<a href="#l28.151"></a><span id="l28.151" class="difflineminus">-    return;</span>
<a href="#l28.152"></a><span id="l28.152" class="difflineplus">+  utils.waitFor(() =&gt; controller.window.pendingAccount == null,</span>
<a href="#l28.153"></a><span id="l28.153" class="difflineplus">+                &quot;Timeout waiting for pendingAccount to become null&quot;);</span>
<a href="#l28.154"></a><span id="l28.154"> </span>
<a href="#l28.155"></a><span id="l28.155" class="difflineminus">-  wait_for_account_tree_selection(tab, rowIndex);</span>
<a href="#l28.156"></a><span id="l28.156" class="difflineplus">+  // Ensure the page is fully loaded (e.g. onInit functions).</span>
<a href="#l28.157"></a><span id="l28.157" class="difflineplus">+  wh.wait_for_frame_load(controller.e(&quot;contentFrame&quot;),</span>
<a href="#l28.158"></a><span id="l28.158" class="difflineplus">+    controller.window.pageURL(tree.view.getItemAtIndex(rowIndex)</span>
<a href="#l28.159"></a><span id="l28.159" class="difflineplus">+                                              .getAttribute(&quot;PageTag&quot;)));</span>
<a href="#l28.160"></a><span id="l28.160"> }</span>
<a href="#l28.161"></a><span id="l28.161"> </span>
<a href="#l28.162"></a><span id="l28.162"> /**</span>
<a href="#l28.163"></a><span id="l28.163">  * Returns the index of the row in account tree corresponding to the wanted</span>
<a href="#l28.164"></a><span id="l28.164">  * account and its settings pane.</span>
<a href="#l28.165"></a><span id="l28.165">  *</span>
<a href="#l28.166"></a><span id="l28.166">  * @param aAccountKey  The key of the account to return.</span>
<a href="#l28.167"></a><span id="l28.167">  *                     If 'null', the SMTP pane is returned.</span>
<a href="#l28.168"></a><span id="l28.168">  * @param aPaneId      The ID of the account settings pane to select.</span>
<a href="#l28.169"></a><span id="l28.169" class="difflineminus">- * @param tab          the account settings tab</span>
<a href="#l28.170"></a><span id="l28.170">  *</span>
<a href="#l28.171"></a><span id="l28.171">  * @return  The row index of the account and pane. If it was not found return -1.</span>
<a href="#l28.172"></a><span id="l28.172">  *          Do not throw as callers may intentionally just check if a row exists.</span>
<a href="#l28.173"></a><span id="l28.173">  *          Just dump into the log so that a subsequent throw in</span>
<a href="#l28.174"></a><span id="l28.174">  *          click_account_tree_row has a useful context.</span>
<a href="#l28.175"></a><span id="l28.175">  */</span>
<a href="#l28.176"></a><span id="l28.176" class="difflineminus">-function get_account_tree_row(aAccountKey, aPaneId, tab) {</span>
<a href="#l28.177"></a><span id="l28.177" class="difflineplus">+function get_account_tree_row(aAccountKey, aPaneId, aController) {</span>
<a href="#l28.178"></a><span id="l28.178">   let rowIndex = 0;</span>
<a href="#l28.179"></a><span id="l28.179" class="difflineminus">-  let accountTreeNode = cth.content_tab_e(tab, &quot;account-tree-children&quot;);</span>
<a href="#l28.180"></a><span id="l28.180" class="difflineplus">+  let accountTreeNode = aController.e(&quot;account-tree-children&quot;);</span>
<a href="#l28.181"></a><span id="l28.181"> </span>
<a href="#l28.182"></a><span id="l28.182">   for (let i = 0; i &lt; accountTreeNode.childNodes.length; i++) {</span>
<a href="#l28.183"></a><span id="l28.183">     if (&quot;_account&quot; in accountTreeNode.childNodes[i]) {</span>
<a href="#l28.184"></a><span id="l28.184">       let accountHead = accountTreeNode.childNodes[i];</span>
<a href="#l28.185"></a><span id="l28.185">       if (aAccountKey == accountHead._account.key) {</span>
<a href="#l28.186"></a><span id="l28.186">         // If this is the wanted account, find the wanted settings pane.</span>
<a href="#l28.187"></a><span id="l28.187">         let accountBlock = accountHead.querySelectorAll(&quot;[PageTag]&quot;);</span>
<a href="#l28.188"></a><span id="l28.188">         // A null aPaneId means the main pane.</span>
<a href="#l28.189"></a><span id="l28.189" class="difflineat">@@ -180,43 +143,37 @@ function get_account_tree_row(aAccountKe</span>
<a href="#l28.190"></a><span id="l28.190">   dump(&quot;The treerow for account &quot; + aAccountKey + &quot; was not found!\n&quot;);</span>
<a href="#l28.191"></a><span id="l28.191">   return -1;</span>
<a href="#l28.192"></a><span id="l28.192"> }</span>
<a href="#l28.193"></a><span id="l28.193"> </span>
<a href="#l28.194"></a><span id="l28.194"> /**</span>
<a href="#l28.195"></a><span id="l28.195">  * Remove an account via the account manager UI.</span>
<a href="#l28.196"></a><span id="l28.196">  *</span>
<a href="#l28.197"></a><span id="l28.197">  * @param aAccount        The account to remove.</span>
<a href="#l28.198"></a><span id="l28.198" class="difflineminus">- * @param tab             The account settings tab.</span>
<a href="#l28.199"></a><span id="l28.199" class="difflineplus">+ * @param aController     The controller of the account manager window.</span>
<a href="#l28.200"></a><span id="l28.200">  * @param aRemoveAccount  Remove the account itself.</span>
<a href="#l28.201"></a><span id="l28.201">  * @param aRemoveData     Remove the message data of the account.</span>
<a href="#l28.202"></a><span id="l28.202">  */</span>
<a href="#l28.203"></a><span id="l28.203" class="difflineminus">-function remove_account(aAccount, tab, aRemoveAccount = true, aRemoveData = false) {</span>
<a href="#l28.204"></a><span id="l28.204" class="difflineminus">-  let accountRow = get_account_tree_row(aAccount.key, &quot;am-server.xul&quot;, tab);</span>
<a href="#l28.205"></a><span id="l28.205" class="difflineminus">-  click_account_tree_row(tab, accountRow);</span>
<a href="#l28.206"></a><span id="l28.206" class="difflineplus">+function remove_account(aAccount, aController, aRemoveAccount = true, aRemoveData = false) {</span>
<a href="#l28.207"></a><span id="l28.207" class="difflineplus">+  let accountRow = get_account_tree_row(aAccount.key, &quot;am-server.xul&quot;, aController);</span>
<a href="#l28.208"></a><span id="l28.208" class="difflineplus">+  click_account_tree_row(aController, accountRow);</span>
<a href="#l28.209"></a><span id="l28.209"> </span>
<a href="#l28.210"></a><span id="l28.210">   wh.plan_for_modal_dialog(&quot;removeAccountDialog&quot;, function(cdc) {</span>
<a href="#l28.211"></a><span id="l28.211">     // Account removal confirmation dialog. Select what to remove.</span>
<a href="#l28.212"></a><span id="l28.212">     if (aRemoveAccount)</span>
<a href="#l28.213"></a><span id="l28.213">       cdc.click(new elib.Elem(cdc.window.document.getElementById(&quot;removeAccount&quot;)));</span>
<a href="#l28.214"></a><span id="l28.214">     if (aRemoveData)</span>
<a href="#l28.215"></a><span id="l28.215">       cdc.click(new elib.Elem(cdc.window.document.getElementById(&quot;removeData&quot;)));</span>
<a href="#l28.216"></a><span id="l28.216"> </span>
<a href="#l28.217"></a><span id="l28.217">     cdc.window.document.documentElement.acceptDialog();</span>
<a href="#l28.218"></a><span id="l28.218">     cdc.waitFor(() =&gt; !cdc.window.document.documentElement.getButton(&quot;accept&quot;).disabled,</span>
<a href="#l28.219"></a><span id="l28.219">                 &quot;Timeout waiting for finish of account removal&quot;,</span>
<a href="#l28.220"></a><span id="l28.220">                 5000, 100);</span>
<a href="#l28.221"></a><span id="l28.221">     cdc.window.document.documentElement.acceptDialog();</span>
<a href="#l28.222"></a><span id="l28.222">   });</span>
<a href="#l28.223"></a><span id="l28.223"> </span>
<a href="#l28.224"></a><span id="l28.224" class="difflineminus">-  let treeBuilt = false;</span>
<a href="#l28.225"></a><span id="l28.225" class="difflineminus">-  cth.content_tab_e(tab, &quot;account-tree-children&quot;)</span>
<a href="#l28.226"></a><span id="l28.226" class="difflineminus">-     .addEventListener(&quot;account-tree-built&quot;, () =&gt; { treeBuilt = true; },</span>
<a href="#l28.227"></a><span id="l28.227" class="difflineminus">-                       {once: true});</span>
<a href="#l28.228"></a><span id="l28.228" class="difflineminus">-</span>
<a href="#l28.229"></a><span id="l28.229">   // Use the Remove item in the Account actions menu.</span>
<a href="#l28.230"></a><span id="l28.230" class="difflineminus">-  mc.click(cth.content_tab_eid(tab, &quot;accountActionsButton&quot;));</span>
<a href="#l28.231"></a><span id="l28.231" class="difflineminus">-  mc.click_menus_in_sequence(cth.content_tab_e(tab, &quot;accountActionsDropdown&quot;),</span>
<a href="#l28.232"></a><span id="l28.232" class="difflineplus">+  aController.click(aController.eid(&quot;accountActionsButton&quot;));</span>
<a href="#l28.233"></a><span id="l28.233" class="difflineplus">+  aController.click_menus_in_sequence(aController.e(&quot;accountActionsDropdown&quot;),</span>
<a href="#l28.234"></a><span id="l28.234">                                       [ {id: &quot;accountActionsDropdownRemove&quot;} ]);</span>
<a href="#l28.235"></a><span id="l28.235">   wh.wait_for_modal_dialog(&quot;removeAccountDialog&quot;);</span>
<a href="#l28.236"></a><span id="l28.236" class="difflineminus">-  mc.waitFor(() =&gt; treeBuilt, &quot;Timeout waiting for account tree rebuild&quot;);</span>
<a href="#l28.237"></a><span id="l28.237" class="difflineminus">-  wait_for_account_tree_selection(tab);</span>
<a href="#l28.238"></a><span id="l28.238" class="difflineplus">+  // TODO: For unknown reason this also closes the whole account manager.</span>
<a href="#l28.239"></a><span id="l28.239"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-pref-window-helpers.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-pref-window-helpers.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -47,11 +47,10 @@ function open_pref_tab(aPaneID) {</span>
<a href="#l29.4"></a><span id="l29.4"> }</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6"> /**</span>
<a href="#l29.7"></a><span id="l29.7">  * Close the preferences tab.</span>
<a href="#l29.8"></a><span id="l29.8">  *</span>
<a href="#l29.9"></a><span id="l29.9">  * @param aTab  The content tab to close.</span>
<a href="#l29.10"></a><span id="l29.10">  */</span>
<a href="#l29.11"></a><span id="l29.11"> function close_pref_tab(aTab) {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  fdh.assert_true(aTab, &quot;No Preferences tab specified for closing&quot;);</span>
<a href="#l29.13"></a><span id="l29.13">   fdh.mc.tabmail.closeTab(aTab);</span>
<a href="#l29.14"></a><span id="l29.14"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mail/themes/linux/mail/accountManage.css</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mail/themes/linux/mail/accountManage.css</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -2,31 +2,20 @@</span>
<a href="#l30.4"></a><span id="l30.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l30.5"></a><span id="l30.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l30.6"></a><span id="l30.6"> </span>
<a href="#l30.7"></a><span id="l30.7"> /* ===== accountManage.css ==============================================</span>
<a href="#l30.8"></a><span id="l30.8">   == Styles for the Mail Account Manager.</span>
<a href="#l30.9"></a><span id="l30.9">   ======================================================================= */</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11"> @import url(&quot;chrome://messenger/skin/&quot;);</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-@import url(&quot;chrome://global/skin/in-content/common.css&quot;);</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-@import url(&quot;chrome://messenger/skin/preferences/aboutPreferences.css&quot;);</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+@import url(&quot;chrome://messenger/content/bindings.css&quot;);</span>
<a href="#l30.15"></a><span id="l30.15"> </span>
<a href="#l30.16"></a><span id="l30.16"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l30.17"></a><span id="l30.17"> </span>
<a href="#l30.18"></a><span id="l30.18" class="difflineminus">-page {</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineminus">-  font-size: 0.95em;</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineminus">-  margin-inline-start: 4px;</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineminus">-}</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineminus">-</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineminus">-page groupbox {</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineminus">-  margin-left: 6px;</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineminus">-  margin-right: 6px;</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineminus">-}</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineminus">-</span>
<a href="#l30.28"></a><span id="l30.28"> /* ::::: account manager :::::: */</span>
<a href="#l30.29"></a><span id="l30.29"> </span>
<a href="#l30.30"></a><span id="l30.30"> .specialFolderPickerGrid {</span>
<a href="#l30.31"></a><span id="l30.31">   margin-inline-start: 20px;</span>
<a href="#l30.32"></a><span id="l30.32"> }</span>
<a href="#l30.33"></a><span id="l30.33"> </span>
<a href="#l30.34"></a><span id="l30.34"> .fccReplyFollowsParent {</span>
<a href="#l30.35"></a><span id="l30.35">   margin-inline-start: 20px;</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineat">@@ -53,54 +42,53 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l30.37"></a><span id="l30.37"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-im) {</span>
<a href="#l30.38"></a><span id="l30.38">   list-style-image: url(&quot;chrome://chat/skin/prpl-generic/icon.png&quot;);</span>
<a href="#l30.39"></a><span id="l30.39"> }</span>
<a href="#l30.40"></a><span id="l30.40"> </span>
<a href="#l30.41"></a><span id="l30.41"> #accounttree treechildren::-moz-tree-indentation {</span>
<a href="#l30.42"></a><span id="l30.42">   width: 1ch;</span>
<a href="#l30.43"></a><span id="l30.43"> }</span>
<a href="#l30.44"></a><span id="l30.44"> </span>
<a href="#l30.45"></a><span id="l30.45" class="difflineminus">-#accountActionsButton {</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineminus">-  margin-left: 0;</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineminus">-  margin-right: 0;</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineminus">-}</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineminus">-</span>
<a href="#l30.50"></a><span id="l30.50"> #accountActionsDropdown {</span>
<a href="#l30.51"></a><span id="l30.51">   min-width: 30ch;</span>
<a href="#l30.52"></a><span id="l30.52"> }</span>
<a href="#l30.53"></a><span id="l30.53"> </span>
<a href="#l30.54"></a><span id="l30.54"> /* ::::: SMTP Server Panel :::::: */</span>
<a href="#l30.55"></a><span id="l30.55"> </span>
<a href="#l30.56"></a><span id="l30.56" class="difflineminus">-#smtpList {</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineminus">-  margin-inline-start: 6px;</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineplus">+.smtpServerListItem {</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineplus">+  padding-inline-start: 3px;</span>
<a href="#l30.60"></a><span id="l30.60"> }</span>
<a href="#l30.61"></a><span id="l30.61"> </span>
<a href="#l30.62"></a><span id="l30.62"> #backgroundBox {</span>
<a href="#l30.63"></a><span id="l30.63" class="difflineminus">-  background-color: var(--in-content-box-background);</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineplus">+  background-color: #FFFFFF;</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+  opacity: 0.5;</span>
<a href="#l30.66"></a><span id="l30.66"> }</span>
<a href="#l30.67"></a><span id="l30.67"> </span>
<a href="#l30.68"></a><span id="l30.68"> #smtpServerInfoBox {</span>
<a href="#l30.69"></a><span id="l30.69" class="difflineminus">-  background-color: var(--in-content-box-background);</span>
<a href="#l30.70"></a><span id="l30.70" class="difflineminus">-  margin: 0 6px 5px;</span>
<a href="#l30.71"></a><span id="l30.71" class="difflineminus">-}</span>
<a href="#l30.72"></a><span id="l30.72" class="difflineminus">-</span>
<a href="#l30.73"></a><span id="l30.73" class="difflineminus">-#smtpServerInfoBox label {</span>
<a href="#l30.74"></a><span id="l30.74" class="difflineminus">-  height: 30px;</span>
<a href="#l30.75"></a><span id="l30.75" class="difflineminus">-  padding-top: 5px;</span>
<a href="#l30.76"></a><span id="l30.76" class="difflineminus">-  margin-top: 0;</span>
<a href="#l30.77"></a><span id="l30.77" class="difflineminus">-  margin-bottom: 0;</span>
<a href="#l30.78"></a><span id="l30.78" class="difflineplus">+  border: 1px solid ThreeDShadow;</span>
<a href="#l30.79"></a><span id="l30.79" class="difflineplus">+  border-right-color: ThreeDHighlight;</span>
<a href="#l30.80"></a><span id="l30.80" class="difflineplus">+  border-bottom-color: ThreeDHighlight;</span>
<a href="#l30.81"></a><span id="l30.81" class="difflineplus">+  margin: 0 5px 5px;</span>
<a href="#l30.82"></a><span id="l30.82"> }</span>
<a href="#l30.83"></a><span id="l30.83"> </span>
<a href="#l30.84"></a><span id="l30.84"> #smtpServerInfoBox textbox {</span>
<a href="#l30.85"></a><span id="l30.85" class="difflineminus">-  background-color: transparent !important;</span>
<a href="#l30.86"></a><span id="l30.86" class="difflineplus">+  background-color: transparent;</span>
<a href="#l30.87"></a><span id="l30.87" class="difflineplus">+}</span>
<a href="#l30.88"></a><span id="l30.88" class="difflineplus">+</span>
<a href="#l30.89"></a><span id="l30.89" class="difflineplus">+#archiveTree &gt; treechildren {</span>
<a href="#l30.90"></a><span id="l30.90" class="difflineplus">+  background-color: -moz-Field;</span>
<a href="#l30.91"></a><span id="l30.91"> }</span>
<a href="#l30.92"></a><span id="l30.92"> </span>
<a href="#l30.93"></a><span id="l30.93"> /* ::::: dialog header ::::: */</span>
<a href="#l30.94"></a><span id="l30.94"> </span>
<a href="#l30.95"></a><span id="l30.95" class="difflineplus">+.dialogheader {</span>
<a href="#l30.96"></a><span id="l30.96" class="difflineplus">+  margin: 0 5px 5px;</span>
<a href="#l30.97"></a><span id="l30.97" class="difflineplus">+  border: 1px solid ThreeDDarkShadow;</span>
<a href="#l30.98"></a><span id="l30.98" class="difflineplus">+  padding: 5px 8px;</span>
<a href="#l30.99"></a><span id="l30.99" class="difflineplus">+  background-color: Highlight;</span>
<a href="#l30.100"></a><span id="l30.100" class="difflineplus">+  color: HighlightText;</span>
<a href="#l30.101"></a><span id="l30.101" class="difflineplus">+}</span>
<a href="#l30.102"></a><span id="l30.102" class="difflineplus">+</span>
<a href="#l30.103"></a><span id="l30.103"> .dialogheader-title {</span>
<a href="#l30.104"></a><span id="l30.104" class="difflineminus">-  margin-top: 0;</span>
<a href="#l30.105"></a><span id="l30.105" class="difflineminus">-  margin-bottom: 8px;</span>
<a href="#l30.106"></a><span id="l30.106" class="difflineminus">-  margin-inline-start: 6px;</span>
<a href="#l30.107"></a><span id="l30.107" class="difflineminus">-  font-size: 1.46em;</span>
<a href="#l30.108"></a><span id="l30.108" class="difflineminus">-  font-weight: 300;</span>
<a href="#l30.109"></a><span id="l30.109" class="difflineminus">-  line-height: 1.3em;</span>
<a href="#l30.110"></a><span id="l30.110" class="difflineminus">-  color: var(--in-content-text-color);</span>
<a href="#l30.111"></a><span id="l30.111" class="difflineplus">+  margin: 0 !important;</span>
<a href="#l30.112"></a><span id="l30.112" class="difflineplus">+  font-size: larger;</span>
<a href="#l30.113"></a><span id="l30.113" class="difflineplus">+  font-weight: bold;</span>
<a href="#l30.114"></a><span id="l30.114"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/themes/linux/mail/preferences/aboutPreferences.css</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/themes/linux/mail/preferences/aboutPreferences.css</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -24,23 +24,16 @@ radio[pane] &gt; .radio-label-box {</span>
<a href="#l31.4"></a><span id="l31.4">   margin-inline-end: 8px;</span>
<a href="#l31.5"></a><span id="l31.5"> }</span>
<a href="#l31.6"></a><span id="l31.6"> </span>
<a href="#l31.7"></a><span id="l31.7"> menulist.actionsMenu &gt; .menulist-dropmarker {</span>
<a href="#l31.8"></a><span id="l31.8">   margin-top: 11px;</span>
<a href="#l31.9"></a><span id="l31.9">   margin-bottom: 11px;</span>
<a href="#l31.10"></a><span id="l31.10"> }</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-button[type=&quot;menu&quot;] &gt; .button-box &gt; .button-menu-dropmarker {</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-  margin-inline-end: 4px;</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/icons/arrow-dropdown-12.svg&quot;);</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-  -moz-context-properties: fill;</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-  fill: currentColor;</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">-}</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineminus">-</span>
<a href="#l31.19"></a><span id="l31.19"> html|input[type=&quot;number&quot;]::-moz-number-spin-up {</span>
<a href="#l31.20"></a><span id="l31.20">   min-height: 10px;</span>
<a href="#l31.21"></a><span id="l31.21"> }</span>
<a href="#l31.22"></a><span id="l31.22"> </span>
<a href="#l31.23"></a><span id="l31.23"> html|input[type=&quot;number&quot;]::-moz-number-spin-down {</span>
<a href="#l31.24"></a><span id="l31.24">   min-height: 11px;</span>
<a href="#l31.25"></a><span id="l31.25"> }</span>
<a href="#l31.26"></a><span id="l31.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/themes/osx/mail/accountManage.css</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/themes/osx/mail/accountManage.css</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -2,31 +2,20 @@</span>
<a href="#l32.4"></a><span id="l32.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l32.5"></a><span id="l32.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7"> /* ===== accountManage.css ==============================================</span>
<a href="#l32.8"></a><span id="l32.8">   == Styles for the Mail Account Manager.</span>
<a href="#l32.9"></a><span id="l32.9">   ======================================================================= */</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11"> @import url(&quot;chrome://messenger/skin/&quot;);</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-@import url(&quot;chrome://global/skin/in-content/common.css&quot;);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-@import url(&quot;chrome://messenger/skin/preferences/aboutPreferences.css&quot;);</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+@import url(&quot;chrome://messenger/content/bindings.css&quot;);</span>
<a href="#l32.15"></a><span id="l32.15"> </span>
<a href="#l32.16"></a><span id="l32.16"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l32.17"></a><span id="l32.17"> </span>
<a href="#l32.18"></a><span id="l32.18" class="difflineminus">-page {</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineminus">-  font-size: 0.95em;</span>
<a href="#l32.20"></a><span id="l32.20" class="difflineminus">-  margin-inline-start: 4px;</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineminus">-}</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineminus">-</span>
<a href="#l32.23"></a><span id="l32.23" class="difflineminus">-page groupbox {</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineminus">-  margin-left: 6px;</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineminus">-  margin-right: 6px;</span>
<a href="#l32.26"></a><span id="l32.26" class="difflineminus">-}</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineminus">-</span>
<a href="#l32.28"></a><span id="l32.28"> /* ::::: account manager :::::: */</span>
<a href="#l32.29"></a><span id="l32.29"> </span>
<a href="#l32.30"></a><span id="l32.30"> .specialFolderPickerGrid {</span>
<a href="#l32.31"></a><span id="l32.31">   margin-inline-start: 20px;</span>
<a href="#l32.32"></a><span id="l32.32"> }</span>
<a href="#l32.33"></a><span id="l32.33"> </span>
<a href="#l32.34"></a><span id="l32.34"> .fccReplyFollowsParent {</span>
<a href="#l32.35"></a><span id="l32.35">   margin-inline-start: 20px;</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineat">@@ -39,19 +28,18 @@ page groupbox {</span>
<a href="#l32.37"></a><span id="l32.37"> #am-main-title, .dialogheader {</span>
<a href="#l32.38"></a><span id="l32.38">   display: none;</span>
<a href="#l32.39"></a><span id="l32.39"> }</span>
<a href="#l32.40"></a><span id="l32.40"> </span>
<a href="#l32.41"></a><span id="l32.41"> .dialog-button[dlgtype=&quot;help&quot;] {</span>
<a href="#l32.42"></a><span id="l32.42">   display: none;</span>
<a href="#l32.43"></a><span id="l32.43"> }</span>
<a href="#l32.44"></a><span id="l32.44"> </span>
<a href="#l32.45"></a><span id="l32.45" class="difflineminus">-#accountActionsButton {</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineminus">-  margin-left: 0;</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineminus">-  margin-right: 0;</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineplus">+#accounttree {</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineplus">+  margin-inline-end: 8px;</span>
<a href="#l32.50"></a><span id="l32.50"> }</span>
<a href="#l32.51"></a><span id="l32.51"> </span>
<a href="#l32.52"></a><span id="l32.52"> #accountActionsDropdown {</span>
<a href="#l32.53"></a><span id="l32.53">   min-width: 30ch;</span>
<a href="#l32.54"></a><span id="l32.54"> }</span>
<a href="#l32.55"></a><span id="l32.55"> </span>
<a href="#l32.56"></a><span id="l32.56"> listitem[default=&quot;true&quot;],</span>
<a href="#l32.57"></a><span id="l32.57"> #identitiesList &gt; listitem:first-child,</span>
<a href="#l32.58"></a><span id="l32.58" class="difflineat">@@ -84,43 +72,40 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l32.59"></a><span id="l32.59">     list-style-image: url(&quot;chrome://chat/skin/prpl-generic/icon32.png&quot;);</span>
<a href="#l32.60"></a><span id="l32.60">   }</span>
<a href="#l32.61"></a><span id="l32.61"> }</span>
<a href="#l32.62"></a><span id="l32.62"> </span>
<a href="#l32.63"></a><span id="l32.63"> #accounttree treechildren::-moz-tree-indentation {</span>
<a href="#l32.64"></a><span id="l32.64">   width: 1ch;</span>
<a href="#l32.65"></a><span id="l32.65"> }</span>
<a href="#l32.66"></a><span id="l32.66"> </span>
<a href="#l32.67"></a><span id="l32.67" class="difflineplus">+button:not(.dialog-button) {</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineplus">+  min-height: 19px; /* aqua size for small buttons */</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineplus">+}</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+</span>
<a href="#l32.71"></a><span id="l32.71"> description {</span>
<a href="#l32.72"></a><span id="l32.72">   margin: 4px 4px 8px;</span>
<a href="#l32.73"></a><span id="l32.73"> }</span>
<a href="#l32.74"></a><span id="l32.74"> </span>
<a href="#l32.75"></a><span id="l32.75" class="difflineminus">-#smtpList {</span>
<a href="#l32.76"></a><span id="l32.76" class="difflineminus">-  margin-inline-start: 6px;</span>
<a href="#l32.77"></a><span id="l32.77" class="difflineminus">-}</span>
<a href="#l32.78"></a><span id="l32.78" class="difflineminus">-</span>
<a href="#l32.79"></a><span id="l32.79" class="difflineminus">-#backgroundBox {</span>
<a href="#l32.80"></a><span id="l32.80" class="difflineminus">-  background-color: var(--in-content-box-background);</span>
<a href="#l32.81"></a><span id="l32.81" class="difflineplus">+#archiveTree &gt; treechildren {</span>
<a href="#l32.82"></a><span id="l32.82" class="difflineplus">+  background-color: #FFFFFF;</span>
<a href="#l32.83"></a><span id="l32.83"> }</span>
<a href="#l32.84"></a><span id="l32.84"> </span>
<a href="#l32.85"></a><span id="l32.85"> #smtpServerInfoBox {</span>
<a href="#l32.86"></a><span id="l32.86" class="difflineminus">-  background-color: var(--in-content-box-background);</span>
<a href="#l32.87"></a><span id="l32.87" class="difflineminus">-  margin: 0 6px 5px;</span>
<a href="#l32.88"></a><span id="l32.88" class="difflineminus">-}</span>
<a href="#l32.89"></a><span id="l32.89" class="difflineminus">-</span>
<a href="#l32.90"></a><span id="l32.90" class="difflineminus">-#smtpServerInfoBox label {</span>
<a href="#l32.91"></a><span id="l32.91" class="difflineminus">-  height: 30px;</span>
<a href="#l32.92"></a><span id="l32.92" class="difflineminus">-  padding-top: 5px;</span>
<a href="#l32.93"></a><span id="l32.93" class="difflineminus">-  margin-top: 0;</span>
<a href="#l32.94"></a><span id="l32.94" class="difflineminus">-  margin-bottom: 0;</span>
<a href="#l32.95"></a><span id="l32.95" class="difflineplus">+  border: 1px solid ThreeDShadow;</span>
<a href="#l32.96"></a><span id="l32.96" class="difflineplus">+  border-right-color: ThreeDHighlight;</span>
<a href="#l32.97"></a><span id="l32.97" class="difflineplus">+  border-bottom-color: ThreeDHighlight;</span>
<a href="#l32.98"></a><span id="l32.98" class="difflineplus">+  margin: 0 5px 5px;</span>
<a href="#l32.99"></a><span id="l32.99"> }</span>
<a href="#l32.100"></a><span id="l32.100"> </span>
<a href="#l32.101"></a><span id="l32.101"> /* ::::: dialog header ::::: */</span>
<a href="#l32.102"></a><span id="l32.102"> </span>
<a href="#l32.103"></a><span id="l32.103" class="difflineplus">+.dialogheader {</span>
<a href="#l32.104"></a><span id="l32.104" class="difflineplus">+  margin: 0 5px 5px;</span>
<a href="#l32.105"></a><span id="l32.105" class="difflineplus">+  padding: 5px 8px;</span>
<a href="#l32.106"></a><span id="l32.106" class="difflineplus">+}</span>
<a href="#l32.107"></a><span id="l32.107" class="difflineplus">+</span>
<a href="#l32.108"></a><span id="l32.108"> .dialogheader-title {</span>
<a href="#l32.109"></a><span id="l32.109" class="difflineminus">-  margin-top: 0;</span>
<a href="#l32.110"></a><span id="l32.110" class="difflineminus">-  margin-bottom: 8px;</span>
<a href="#l32.111"></a><span id="l32.111" class="difflineminus">-  margin-inline-start: 6px;</span>
<a href="#l32.112"></a><span id="l32.112" class="difflineminus">-  font-size: 1.46em;</span>
<a href="#l32.113"></a><span id="l32.113" class="difflineminus">-  font-weight: 300;</span>
<a href="#l32.114"></a><span id="l32.114" class="difflineminus">-  line-height: 1.3em;</span>
<a href="#l32.115"></a><span id="l32.115" class="difflineminus">-  color: var(--in-content-text-color);</span>
<a href="#l32.116"></a><span id="l32.116" class="difflineplus">+  margin: 0 !important;</span>
<a href="#l32.117"></a><span id="l32.117" class="difflineplus">+  font-size: larger;</span>
<a href="#l32.118"></a><span id="l32.118" class="difflineplus">+  font-weight: bold;</span>
<a href="#l32.119"></a><span id="l32.119" class="difflineplus">+  display: none;</span>
<a href="#l32.120"></a><span id="l32.120"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/themes/osx/mail/preferences/aboutPreferences.css</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/themes/osx/mail/preferences/aboutPreferences.css</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -46,26 +46,16 @@ radio[pane][selected] {</span>
<a href="#l33.4"></a><span id="l33.4"> }</span>
<a href="#l33.5"></a><span id="l33.5"> </span>
<a href="#l33.6"></a><span id="l33.6"> .actionsMenu &gt; .menulist-label-box &gt; .menulist-icon {</span>
<a href="#l33.7"></a><span id="l33.7">   margin-top: 2px;</span>
<a href="#l33.8"></a><span id="l33.8">   margin-inline-start: 2px;</span>
<a href="#l33.9"></a><span id="l33.9">   margin-inline-end: 8px !important;</span>
<a href="#l33.10"></a><span id="l33.10"> }</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-button[type=&quot;menu&quot;] &gt; .button-box &gt; .button-menu-dropmarker {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">-  -moz-appearance: none;</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineminus">-  display: -moz-box;</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/icons/arrow-dropdown-12.svg&quot;);</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineminus">-  -moz-context-properties: fill;</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineminus">-  fill: currentColor;</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineminus">-  width: 12px;</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineminus">-  height: 12px;</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineminus">-}</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineminus">-</span>
<a href="#l33.22"></a><span id="l33.22"> .sidebar-footer-label {</span>
<a href="#l33.23"></a><span id="l33.23">   font-size: 1.224em;</span>
<a href="#l33.24"></a><span id="l33.24"> }</span>
<a href="#l33.25"></a><span id="l33.25"> </span>
<a href="#l33.26"></a><span id="l33.26"> tab:-moz-focusring &gt; .tab-middle &gt; .tab-text {</span>
<a href="#l33.27"></a><span id="l33.27">   outline: none;</span>
<a href="#l33.28"></a><span id="l33.28"> }</span>
<a href="#l33.29"></a><span id="l33.29"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/themes/shared/mail/incontentprefs/aboutPreferences.css</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/themes/shared/mail/incontentprefs/aboutPreferences.css</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -1,13 +1,12 @@</span>
<a href="#l34.4"></a><span id="l34.4"> /* - This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l34.5"></a><span id="l34.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l34.6"></a><span id="l34.6">    - You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8" class="difflineminus">-@import url(&quot;chrome://messenger/skin/folderPane.css&quot;);</span>
<a href="#l34.9"></a><span id="l34.9"> @namespace html &quot;http://www.w3.org/1999/xhtml&quot;;</span>
<a href="#l34.10"></a><span id="l34.10"> </span>
<a href="#l34.11"></a><span id="l34.11"> :root {</span>
<a href="#l34.12"></a><span id="l34.12">   --in-content-categories-background: #ebebef;</span>
<a href="#l34.13"></a><span id="l34.13">   --in-content-dialogtitle-background: #f1f1f1;</span>
<a href="#l34.14"></a><span id="l34.14">   --in-content-dialogtitle-border: #c1c1c1;</span>
<a href="#l34.15"></a><span id="l34.15">   --in-content-warning-container: var(--grey-20);</span>
<a href="#l34.16"></a><span id="l34.16"> }</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineat">@@ -45,42 +44,32 @@ html|h2 {</span>
<a href="#l34.18"></a><span id="l34.18"> }</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20"> html|h3 {</span>
<a href="#l34.21"></a><span id="l34.21">   font-size: 1em;</span>
<a href="#l34.22"></a><span id="l34.22">   font-weight: 600;</span>
<a href="#l34.23"></a><span id="l34.23">   margin: 4px 0 !important;</span>
<a href="#l34.24"></a><span id="l34.24"> }</span>
<a href="#l34.25"></a><span id="l34.25"> </span>
<a href="#l34.26"></a><span id="l34.26" class="difflineminus">-.header {</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineminus">-  margin-bottom: 0;</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineminus">-}</span>
<a href="#l34.29"></a><span id="l34.29" class="difflineminus">-</span>
<a href="#l34.30"></a><span id="l34.30"> #preferencesContainer {</span>
<a href="#l34.31"></a><span id="l34.31">   padding: 40px 28px;</span>
<a href="#l34.32"></a><span id="l34.32">   overflow: auto;</span>
<a href="#l34.33"></a><span id="l34.33"> }</span>
<a href="#l34.34"></a><span id="l34.34"> </span>
<a href="#l34.35"></a><span id="l34.35"> #MailPreferences prefpane {</span>
<a href="#l34.36"></a><span id="l34.36">   max-width: 800px;</span>
<a href="#l34.37"></a><span id="l34.37">   padding: 0;</span>
<a href="#l34.38"></a><span id="l34.38">   -moz-box-flex: 1;</span>
<a href="#l34.39"></a><span id="l34.39">   -moz-box-orient: vertical;</span>
<a href="#l34.40"></a><span id="l34.40"> }</span>
<a href="#l34.41"></a><span id="l34.41"> </span>
<a href="#l34.42"></a><span id="l34.42"> #MailPreferences prefpane:not([selected]) {</span>
<a href="#l34.43"></a><span id="l34.43">   display: none;</span>
<a href="#l34.44"></a><span id="l34.44"> }</span>
<a href="#l34.45"></a><span id="l34.45"> </span>
<a href="#l34.46"></a><span id="l34.46" class="difflineminus">-groupbox {</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineminus">-  -moz-appearance: none;</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineminus">-  margin: initial;</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineminus">-  padding: initial;</span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-}</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineminus">-</span>
<a href="#l34.52"></a><span id="l34.52"> tabpanel &gt; label,</span>
<a href="#l34.53"></a><span id="l34.53"> tabpanel &gt; description,</span>
<a href="#l34.54"></a><span id="l34.54"> tabpanel &gt; hbox &gt; description {</span>
<a href="#l34.55"></a><span id="l34.55">   margin-inline-start: 0;</span>
<a href="#l34.56"></a><span id="l34.56"> }</span>
<a href="#l34.57"></a><span id="l34.57"> </span>
<a href="#l34.58"></a><span id="l34.58"> /* Web search menulist */</span>
<a href="#l34.59"></a><span id="l34.59"> #defaultWebSearch &gt; .menulist-label-box &gt; .menulist-icon[src] {</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineat">@@ -319,59 +308,16 @@ separator.groove:not([orient=&quot;vertical&quot;]</span>
<a href="#l34.61"></a><span id="l34.61"> tab:-moz-focusring {</span>
<a href="#l34.62"></a><span id="l34.62">   outline: var(--in-content-category-outline-focus);</span>
<a href="#l34.63"></a><span id="l34.63"> }</span>
<a href="#l34.64"></a><span id="l34.64"> </span>
<a href="#l34.65"></a><span id="l34.65"> tab:-moz-focusring &gt; .tab-middle {</span>
<a href="#l34.66"></a><span id="l34.66">   outline: none;</span>
<a href="#l34.67"></a><span id="l34.67"> }</span>
<a href="#l34.68"></a><span id="l34.68"> </span>
<a href="#l34.69"></a><span id="l34.69" class="difflineminus">-/* Styles for the Account Actions button */</span>
<a href="#l34.70"></a><span id="l34.70" class="difflineminus">-button[type=&quot;menu&quot;] &gt; menupopup {</span>
<a href="#l34.71"></a><span id="l34.71" class="difflineminus">-  -moz-appearance: none;</span>
<a href="#l34.72"></a><span id="l34.72" class="difflineminus">-  border: 1px solid var(--in-content-box-border-color);</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineminus">-  border-radius: 2px;</span>
<a href="#l34.74"></a><span id="l34.74" class="difflineminus">-  background-color: var(--in-content-box-background);</span>
<a href="#l34.75"></a><span id="l34.75" class="difflineminus">-}</span>
<a href="#l34.76"></a><span id="l34.76" class="difflineminus">-</span>
<a href="#l34.77"></a><span id="l34.77" class="difflineminus">-button[type=&quot;menu&quot;] &gt; menupopup menuitem {</span>
<a href="#l34.78"></a><span id="l34.78" class="difflineminus">-  -moz-appearance: none;</span>
<a href="#l34.79"></a><span id="l34.79" class="difflineminus">-  font-size: 1em;</span>
<a href="#l34.80"></a><span id="l34.80" class="difflineminus">-  color: var(--in-content-text-color);</span>
<a href="#l34.81"></a><span id="l34.81" class="difflineminus">-  padding-top: 0.2em;</span>
<a href="#l34.82"></a><span id="l34.82" class="difflineminus">-  padding-bottom: 0.2em;</span>
<a href="#l34.83"></a><span id="l34.83" class="difflineminus">-  padding-inline-start: 10px;</span>
<a href="#l34.84"></a><span id="l34.84" class="difflineminus">-  padding-inline-end: 30px;</span>
<a href="#l34.85"></a><span id="l34.85" class="difflineminus">-}</span>
<a href="#l34.86"></a><span id="l34.86" class="difflineminus">-</span>
<a href="#l34.87"></a><span id="l34.87" class="difflineminus">-button[type=&quot;menu&quot;] &gt; menupopup &gt; menuitem:not([disabled=&quot;true&quot;])[_moz-menuactive=&quot;true&quot;] {</span>
<a href="#l34.88"></a><span id="l34.88" class="difflineminus">-  color: var(--in-content-text-color);</span>
<a href="#l34.89"></a><span id="l34.89" class="difflineminus">-  background-color: var(--in-content-item-hover);</span>
<a href="#l34.90"></a><span id="l34.90" class="difflineminus">-}</span>
<a href="#l34.91"></a><span id="l34.91" class="difflineminus">-</span>
<a href="#l34.92"></a><span id="l34.92" class="difflineminus">-button[type=&quot;menu&quot;] &gt; menupopup &gt; menuitem:not([disabled=&quot;true&quot;])[selected=&quot;true&quot;] {</span>
<a href="#l34.93"></a><span id="l34.93" class="difflineminus">-  color: var(--in-content-selected-text);</span>
<a href="#l34.94"></a><span id="l34.94" class="difflineminus">-  background-color: var(--in-content-item-selected);</span>
<a href="#l34.95"></a><span id="l34.95" class="difflineminus">-}</span>
<a href="#l34.96"></a><span id="l34.96" class="difflineminus">-</span>
<a href="#l34.97"></a><span id="l34.97" class="difflineminus">-button[type=&quot;menu&quot;] &gt; menupopup &gt; menuitem[disabled=&quot;true&quot;] {</span>
<a href="#l34.98"></a><span id="l34.98" class="difflineminus">-  color: #999;</span>
<a href="#l34.99"></a><span id="l34.99" class="difflineminus">-  /* override the [_moz-menuactive=&quot;true&quot;] background color from</span>
<a href="#l34.100"></a><span id="l34.100" class="difflineminus">-     global/menu.css */</span>
<a href="#l34.101"></a><span id="l34.101" class="difflineminus">-  background-color: transparent;</span>
<a href="#l34.102"></a><span id="l34.102" class="difflineminus">-}</span>
<a href="#l34.103"></a><span id="l34.103" class="difflineminus">-</span>
<a href="#l34.104"></a><span id="l34.104" class="difflineminus">-button[type=&quot;menu&quot;] &gt; menupopup menuseparator {</span>
<a href="#l34.105"></a><span id="l34.105" class="difflineminus">-  -moz-appearance: none;</span>
<a href="#l34.106"></a><span id="l34.106" class="difflineminus">-  margin: 0;</span>
<a href="#l34.107"></a><span id="l34.107" class="difflineminus">-  padding: 0;</span>
<a href="#l34.108"></a><span id="l34.108" class="difflineminus">-  border-top: 1px solid var(--in-content-box-border-color);</span>
<a href="#l34.109"></a><span id="l34.109" class="difflineminus">-  border-bottom: none;</span>
<a href="#l34.110"></a><span id="l34.110" class="difflineminus">-}</span>
<a href="#l34.111"></a><span id="l34.111" class="difflineminus">-</span>
<a href="#l34.112"></a><span id="l34.112"> #defaultWebSearchPopup &gt; menuitem &gt; .menu-iconic-left {</span>
<a href="#l34.113"></a><span id="l34.113">   display: -moz-box;</span>
<a href="#l34.114"></a><span id="l34.114"> }</span>
<a href="#l34.115"></a><span id="l34.115"> </span>
<a href="#l34.116"></a><span id="l34.116"> /* Applications Pane Styles */</span>
<a href="#l34.117"></a><span id="l34.117"> </span>
<a href="#l34.118"></a><span id="l34.118"> #applications-content {</span>
<a href="#l34.119"></a><span id="l34.119">   padding: 15px;</span>
<a href="#l34.120"></a><span id="l34.120" class="difflineat">@@ -565,17 +511,17 @@ richlistbox richlistitem {</span>
<a href="#l34.121"></a><span id="l34.121">   background-image: none;</span>
<a href="#l34.122"></a><span id="l34.122"> }</span>
<a href="#l34.123"></a><span id="l34.123"> </span>
<a href="#l34.124"></a><span id="l34.124"> richlistbox richlistitem:hover {</span>
<a href="#l34.125"></a><span id="l34.125">   background-color: var(--in-content-item-hover);</span>
<a href="#l34.126"></a><span id="l34.126"> }</span>
<a href="#l34.127"></a><span id="l34.127"> </span>
<a href="#l34.128"></a><span id="l34.128"> richlistbox:focus &gt; richlistitem[selected=&quot;true&quot;] {</span>
<a href="#l34.129"></a><span id="l34.129" class="difflineminus">-  background-color: var(--in-content-item-selected) !important;</span>
<a href="#l34.130"></a><span id="l34.130" class="difflineplus">+  background-color: var(--in-content-item-selected);</span>
<a href="#l34.131"></a><span id="l34.131">   color: var(--in-content-selected-text) !important;</span>
<a href="#l34.132"></a><span id="l34.132"> }</span>
<a href="#l34.133"></a><span id="l34.133"> </span>
<a href="#l34.134"></a><span id="l34.134"> #messengerLanguagesDialogPane {</span>
<a href="#l34.135"></a><span id="l34.135">   min-height: 360px;</span>
<a href="#l34.136"></a><span id="l34.136"> }</span>
<a href="#l34.137"></a><span id="l34.137"> </span>
<a href="#l34.138"></a><span id="l34.138"> #defaultMessengerLanguage {</span>
<a href="#l34.139"></a><span id="l34.139" class="difflineat">@@ -605,29 +551,16 @@ richlistbox:focus &gt; richlistitem[selecte</span>
<a href="#l34.140"></a><span id="l34.140">   margin-inline-start: 4px;</span>
<a href="#l34.141"></a><span id="l34.141"> }</span>
<a href="#l34.142"></a><span id="l34.142"> </span>
<a href="#l34.143"></a><span id="l34.143"> .action-button {</span>
<a href="#l34.144"></a><span id="l34.144">   margin-inline-end: 0;</span>
<a href="#l34.145"></a><span id="l34.145"> }</span>
<a href="#l34.146"></a><span id="l34.146"> </span>
<a href="#l34.147"></a><span id="l34.147"> /* Menulist styles */</span>
<a href="#l34.148"></a><span id="l34.148" class="difflineminus">-</span>
<a href="#l34.149"></a><span id="l34.149" class="difflineminus">-menulist menupopup[type=&quot;folder&quot;] {</span>
<a href="#l34.150"></a><span id="l34.150" class="difflineminus">-  -moz-appearance: none;</span>
<a href="#l34.151"></a><span id="l34.151" class="difflineminus">-  border: 1px solid var(--in-content-box-border-color);</span>
<a href="#l34.152"></a><span id="l34.152" class="difflineminus">-  border-radius: 2px;</span>
<a href="#l34.153"></a><span id="l34.153" class="difflineminus">-  background-color: var(--in-content-box-background);</span>
<a href="#l34.154"></a><span id="l34.154" class="difflineminus">-}</span>
<a href="#l34.155"></a><span id="l34.155" class="difflineminus">-</span>
<a href="#l34.156"></a><span id="l34.156" class="difflineminus">-menupopup[type=&quot;folder&quot;] &gt; .folderMenuItem[_moz-menuactive=&quot;true&quot;] {</span>
<a href="#l34.157"></a><span id="l34.157" class="difflineminus">-  color: var(--in-content-text-color);</span>
<a href="#l34.158"></a><span id="l34.158" class="difflineminus">-  background-color: var(--in-content-item-hover);</span>
<a href="#l34.159"></a><span id="l34.159" class="difflineminus">-}</span>
<a href="#l34.160"></a><span id="l34.160" class="difflineminus">-</span>
<a href="#l34.161"></a><span id="l34.161"> .label-item {</span>
<a href="#l34.162"></a><span id="l34.162">   font-size: .8em;</span>
<a href="#l34.163"></a><span id="l34.163"> }</span>
<a href="#l34.164"></a><span id="l34.164"> </span>
<a href="#l34.165"></a><span id="l34.165"> /**</span>
<a href="#l34.166"></a><span id="l34.166">  * Dialog</span>
<a href="#l34.167"></a><span id="l34.167">  */</span>
<a href="#l34.168"></a><span id="l34.168"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mail/themes/windows/mail/accountManage.css</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mail/themes/windows/mail/accountManage.css</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -2,31 +2,20 @@</span>
<a href="#l35.4"></a><span id="l35.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l35.5"></a><span id="l35.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l35.6"></a><span id="l35.6"> </span>
<a href="#l35.7"></a><span id="l35.7"> /* ===== accountManage.css ==============================================</span>
<a href="#l35.8"></a><span id="l35.8">   == Styles for the Mail Account Manager.</span>
<a href="#l35.9"></a><span id="l35.9">   ======================================================================= */</span>
<a href="#l35.10"></a><span id="l35.10"> </span>
<a href="#l35.11"></a><span id="l35.11"> @import url(&quot;chrome://messenger/skin/&quot;);</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-@import url(&quot;chrome://global/skin/in-content/common.css&quot;);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-@import url(&quot;chrome://messenger/skin/preferences/aboutPreferences.css&quot;);</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+@import url(&quot;chrome://messenger/content/bindings.css&quot;);</span>
<a href="#l35.15"></a><span id="l35.15"> </span>
<a href="#l35.16"></a><span id="l35.16"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l35.17"></a><span id="l35.17"> </span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">-page {</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineminus">-  font-size: 0.95em;</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineminus">-  margin-inline-start: 4px;</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineminus">-}</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineminus">-</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineminus">-page groupbox {</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineminus">-  margin-left: 6px;</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineminus">-  margin-right: 6px;</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineminus">-}</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineminus">-</span>
<a href="#l35.28"></a><span id="l35.28"> /* ::::: account manager :::::: */</span>
<a href="#l35.29"></a><span id="l35.29"> </span>
<a href="#l35.30"></a><span id="l35.30"> .specialFolderPickerGrid {</span>
<a href="#l35.31"></a><span id="l35.31">   margin-inline-start: 20px;</span>
<a href="#l35.32"></a><span id="l35.32"> }</span>
<a href="#l35.33"></a><span id="l35.33"> </span>
<a href="#l35.34"></a><span id="l35.34"> .fccReplyFollowsParent {</span>
<a href="#l35.35"></a><span id="l35.35">   margin-inline-start: 20px;</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineat">@@ -53,54 +42,53 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l35.37"></a><span id="l35.37"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-im) {</span>
<a href="#l35.38"></a><span id="l35.38">   list-style-image: url(&quot;chrome://chat/skin/prpl-generic/icon.png&quot;);</span>
<a href="#l35.39"></a><span id="l35.39"> }</span>
<a href="#l35.40"></a><span id="l35.40"> </span>
<a href="#l35.41"></a><span id="l35.41"> #accounttree treechildren::-moz-tree-indentation {</span>
<a href="#l35.42"></a><span id="l35.42">   width: 1ch;</span>
<a href="#l35.43"></a><span id="l35.43"> }</span>
<a href="#l35.44"></a><span id="l35.44"> </span>
<a href="#l35.45"></a><span id="l35.45" class="difflineminus">-#accountActionsButton {</span>
<a href="#l35.46"></a><span id="l35.46" class="difflineminus">-  margin-left: 0;</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineminus">-  margin-right: 0;</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineminus">-}</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineminus">-</span>
<a href="#l35.50"></a><span id="l35.50"> #accountActionsDropdown {</span>
<a href="#l35.51"></a><span id="l35.51">   min-width: 30ch;</span>
<a href="#l35.52"></a><span id="l35.52"> }</span>
<a href="#l35.53"></a><span id="l35.53"> </span>
<a href="#l35.54"></a><span id="l35.54"> /* ::::: SMTP Server Panel :::::: */</span>
<a href="#l35.55"></a><span id="l35.55"> </span>
<a href="#l35.56"></a><span id="l35.56" class="difflineminus">-#smtpList {</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineminus">-  margin-inline-start: 6px;</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+.smtpServerListItem {</span>
<a href="#l35.59"></a><span id="l35.59" class="difflineplus">+  padding-inline-start: 3px;</span>
<a href="#l35.60"></a><span id="l35.60"> }</span>
<a href="#l35.61"></a><span id="l35.61"> </span>
<a href="#l35.62"></a><span id="l35.62"> #backgroundBox {</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineminus">-  background-color: var(--in-content-box-background);</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineplus">+  background-color: #FFFFFF;</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineplus">+  opacity: 0.5;</span>
<a href="#l35.66"></a><span id="l35.66"> }</span>
<a href="#l35.67"></a><span id="l35.67"> </span>
<a href="#l35.68"></a><span id="l35.68"> #smtpServerInfoBox {</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineminus">-  background-color: var(--in-content-box-background);</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineminus">-  margin: 0 6px 5px;</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineminus">-}</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineminus">-</span>
<a href="#l35.73"></a><span id="l35.73" class="difflineminus">-#smtpServerInfoBox label {</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineminus">-  height: 30px;</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineminus">-  padding-top: 5px;</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineminus">-  margin-top: 0;</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineminus">-  margin-bottom: 0;</span>
<a href="#l35.78"></a><span id="l35.78" class="difflineplus">+  border: 1px solid ThreeDShadow;</span>
<a href="#l35.79"></a><span id="l35.79" class="difflineplus">+  border-right-color: ThreeDHighlight;</span>
<a href="#l35.80"></a><span id="l35.80" class="difflineplus">+  border-bottom-color: ThreeDHighlight;</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineplus">+  margin: 0 5px 5px;</span>
<a href="#l35.82"></a><span id="l35.82"> }</span>
<a href="#l35.83"></a><span id="l35.83"> </span>
<a href="#l35.84"></a><span id="l35.84"> #smtpServerInfoBox textbox {</span>
<a href="#l35.85"></a><span id="l35.85">   background-color: transparent;</span>
<a href="#l35.86"></a><span id="l35.86"> }</span>
<a href="#l35.87"></a><span id="l35.87"> </span>
<a href="#l35.88"></a><span id="l35.88" class="difflineplus">+#archiveTree &gt; treechildren {</span>
<a href="#l35.89"></a><span id="l35.89" class="difflineplus">+  background-color: -moz-Field;</span>
<a href="#l35.90"></a><span id="l35.90" class="difflineplus">+}</span>
<a href="#l35.91"></a><span id="l35.91" class="difflineplus">+</span>
<a href="#l35.92"></a><span id="l35.92"> /* ::::: dialog header ::::: */</span>
<a href="#l35.93"></a><span id="l35.93"> </span>
<a href="#l35.94"></a><span id="l35.94" class="difflineplus">+.dialogheader {</span>
<a href="#l35.95"></a><span id="l35.95" class="difflineplus">+  margin: 0 5px 5px;</span>
<a href="#l35.96"></a><span id="l35.96" class="difflineplus">+  border: 1px solid ThreeDDarkShadow;</span>
<a href="#l35.97"></a><span id="l35.97" class="difflineplus">+  padding: 5px 8px;</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineplus">+  background-color: Highlight;</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineplus">+  color: HighlightText;</span>
<a href="#l35.100"></a><span id="l35.100" class="difflineplus">+}</span>
<a href="#l35.101"></a><span id="l35.101" class="difflineplus">+</span>
<a href="#l35.102"></a><span id="l35.102"> .dialogheader-title {</span>
<a href="#l35.103"></a><span id="l35.103" class="difflineminus">-  margin-top: 0;</span>
<a href="#l35.104"></a><span id="l35.104" class="difflineminus">-  margin-bottom: 8px;</span>
<a href="#l35.105"></a><span id="l35.105" class="difflineminus">-  margin-inline-start: 6px;</span>
<a href="#l35.106"></a><span id="l35.106" class="difflineminus">-  font-size: 1.46em;</span>
<a href="#l35.107"></a><span id="l35.107" class="difflineminus">-  font-weight: 300;</span>
<a href="#l35.108"></a><span id="l35.108" class="difflineminus">-  line-height: 1.3em;</span>
<a href="#l35.109"></a><span id="l35.109" class="difflineminus">-  color: var(--in-content-text-color);</span>
<a href="#l35.110"></a><span id="l35.110" class="difflineplus">+  margin: 0 !important;</span>
<a href="#l35.111"></a><span id="l35.111" class="difflineplus">+  font-size: larger;</span>
<a href="#l35.112"></a><span id="l35.112" class="difflineplus">+  font-weight: bold;</span>
<a href="#l35.113"></a><span id="l35.113"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mail/themes/windows/mail/messenger.css</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mail/themes/windows/mail/messenger.css</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -897,16 +897,18 @@ findbar {</span>
<a href="#l36.4"></a><span id="l36.4">   border-top-color: var(--chrome-content-separator-color);</span>
<a href="#l36.5"></a><span id="l36.5">   color: var(--toolbar-color);</span>
<a href="#l36.6"></a><span id="l36.6"> }</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8"> /* ::::: groupbox ::::: */</span>
<a href="#l36.9"></a><span id="l36.9"> </span>
<a href="#l36.10"></a><span id="l36.10"> groupbox {</span>
<a href="#l36.11"></a><span id="l36.11">   -moz-appearance: groupbox;</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineplus">+  border: 2px groove ThreeDFace;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+  border-radius: 3px;</span>
<a href="#l36.14"></a><span id="l36.14">   margin: 3px;</span>
<a href="#l36.15"></a><span id="l36.15">   margin-top: 1em;</span>
<a href="#l36.16"></a><span id="l36.16">   padding: 3px 0 6px;</span>
<a href="#l36.17"></a><span id="l36.17"> }</span>
<a href="#l36.18"></a><span id="l36.18"> </span>
<a href="#l36.19"></a><span id="l36.19"> groupbox &gt; .groupbox-title &gt; .header {</span>
<a href="#l36.20"></a><span id="l36.20">   font-weight: normal;</span>
<a href="#l36.21"></a><span id="l36.21">   margin-top: -1em;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/base/prefs/content/AccountManager.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/base/prefs/content/AccountManager.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -32,26 +32,22 @@</span>
<a href="#l37.4"></a><span id="l37.4"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l37.5"></a><span id="l37.5"> var {BrowserUtils} = ChromeUtils.import(&quot;resource://gre/modules/BrowserUtils.jsm&quot;);</span>
<a href="#l37.6"></a><span id="l37.6"> var {Gloda} = ChromeUtils.import(&quot;resource:///modules/gloda/gloda.js&quot;);</span>
<a href="#l37.7"></a><span id="l37.7"> var {fixIterator} = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l37.8"></a><span id="l37.8"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l37.9"></a><span id="l37.9"> var {allAccountsSorted} = ChromeUtils.import(&quot;resource:///modules/folderUtils.jsm&quot;);</span>
<a href="#l37.10"></a><span id="l37.10"> var {cleanUpHostName, isLegalHostNameOrIP} = ChromeUtils.import(&quot;resource:///modules/hostnameUtils.jsm&quot;);</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-var inContent = !!document.getElementById(&quot;paneAccount&quot;);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-if (!inContent) {</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-  document.addEventListener(&quot;dialogcancel&quot;, onNotAccept);</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineminus">-  document.addEventListener(&quot;dialogaccept&quot;, (event) =&gt; {</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineminus">-    if (!onAccept(true)) {</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineminus">-      event.preventDefault();</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineminus">-    }</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineminus">-  });</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineminus">-}</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineplus">+document.addEventListener(&quot;dialogcancel&quot;, onNotAccept);</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineplus">+document.addEventListener(&quot;dialogaccept&quot;, (event) =&gt; {</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineplus">+  if (!onAccept(true)) {</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineplus">+    event.preventDefault();</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineplus">+  }</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineplus">+});</span>
<a href="#l37.28"></a><span id="l37.28"> </span>
<a href="#l37.29"></a><span id="l37.29"> // If Local directory has changed the app needs to restart. Once this is set</span>
<a href="#l37.30"></a><span id="l37.30"> // a restart will be attempted at each attempt to close the Account manager with OK.</span>
<a href="#l37.31"></a><span id="l37.31"> var gRestartNeeded = false;</span>
<a href="#l37.32"></a><span id="l37.32"> </span>
<a href="#l37.33"></a><span id="l37.33"> // This is a hash-map for every account we've touched in the pane. Each entry</span>
<a href="#l37.34"></a><span id="l37.34"> // has additional maps of attribute-value pairs that we're going to want to save</span>
<a href="#l37.35"></a><span id="l37.35"> // when the user hits OK.</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineat">@@ -119,79 +115,46 @@ function updateElementWithKeys(account, </span>
<a href="#l37.37"></a><span id="l37.37">       if (MailServices.smtp.defaultServer)</span>
<a href="#l37.38"></a><span id="l37.38">         element.serverkey = MailServices.smtp.defaultServer.key;</span>
<a href="#l37.39"></a><span id="l37.39">       break;</span>
<a href="#l37.40"></a><span id="l37.40">     default:</span>
<a href="#l37.41"></a><span id="l37.41"> //      dump(&quot;unknown element type! &quot;+type+&quot;\n&quot;);</span>
<a href="#l37.42"></a><span id="l37.42">   }</span>
<a href="#l37.43"></a><span id="l37.43"> }</span>
<a href="#l37.44"></a><span id="l37.44"> </span>
<a href="#l37.45"></a><span id="l37.45" class="difflineminus">-</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineminus">-</span>
<a href="#l37.47"></a><span id="l37.47" class="difflineminus">-</span>
<a href="#l37.48"></a><span id="l37.48"> // called when the whole document loads</span>
<a href="#l37.49"></a><span id="l37.49"> // perform initialization here</span>
<a href="#l37.50"></a><span id="l37.50"> function onLoad() {</span>
<a href="#l37.51"></a><span id="l37.51" class="difflineminus">-  accountArray = {};</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineminus">-  gGenericAttributeTypes = {};</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineminus">-</span>
<a href="#l37.54"></a><span id="l37.54" class="difflineminus">-  gAccountTree.load();</span>
<a href="#l37.55"></a><span id="l37.55" class="difflineminus">-</span>
<a href="#l37.56"></a><span id="l37.56" class="difflineminus">-  if (inContent) {</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineminus">-    setTimeout(() =&gt; {</span>
<a href="#l37.58"></a><span id="l37.58" class="difflineminus">-      // If we are in a preferences tab, we didn't get arguments via &quot;window&quot;,</span>
<a href="#l37.59"></a><span id="l37.59" class="difflineminus">-      // select the default server first.</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineminus">-      selectServer(null, null);</span>
<a href="#l37.61"></a><span id="l37.61" class="difflineminus">-      let accountTree = document.getElementById(&quot;account-tree-children&quot;);</span>
<a href="#l37.62"></a><span id="l37.62" class="difflineminus">-      accountTree.dispatchEvent(</span>
<a href="#l37.63"></a><span id="l37.63" class="difflineminus">-        new CustomEvent(&quot;account-tree-loaded&quot;, { bubbles: true, cancelable: false })</span>
<a href="#l37.64"></a><span id="l37.64" class="difflineminus">-      );</span>
<a href="#l37.65"></a><span id="l37.65" class="difflineminus">-      accountTree.setAttribute(&quot;tree-loaded&quot;, &quot;true&quot;);</span>
<a href="#l37.66"></a><span id="l37.66" class="difflineminus">-    }, 0);</span>
<a href="#l37.67"></a><span id="l37.67" class="difflineminus">-    return;</span>
<a href="#l37.68"></a><span id="l37.68" class="difflineminus">-  }</span>
<a href="#l37.69"></a><span id="l37.69" class="difflineminus">-</span>
<a href="#l37.70"></a><span id="l37.70">   var selectedServer;</span>
<a href="#l37.71"></a><span id="l37.71">   var selectPage = null;</span>
<a href="#l37.72"></a><span id="l37.72"> </span>
<a href="#l37.73"></a><span id="l37.73">   // Arguments can have two properties: (1) &quot;server,&quot; the nsIMsgIncomingServer</span>
<a href="#l37.74"></a><span id="l37.74">   // to select initially and (2) &quot;selectPage,&quot; the page for that server to that</span>
<a href="#l37.75"></a><span id="l37.75">   // should be selected.</span>
<a href="#l37.76"></a><span id="l37.76">   if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0]) {</span>
<a href="#l37.77"></a><span id="l37.77">     selectedServer = window.arguments[0].server;</span>
<a href="#l37.78"></a><span id="l37.78">     selectPage = window.arguments[0].selectPage;</span>
<a href="#l37.79"></a><span id="l37.79">   }</span>
<a href="#l37.80"></a><span id="l37.80"> </span>
<a href="#l37.81"></a><span id="l37.81" class="difflineplus">+  accountArray = {};</span>
<a href="#l37.82"></a><span id="l37.82" class="difflineplus">+  gGenericAttributeTypes = {};</span>
<a href="#l37.83"></a><span id="l37.83" class="difflineplus">+</span>
<a href="#l37.84"></a><span id="l37.84" class="difflineplus">+  gAccountTree.load();</span>
<a href="#l37.85"></a><span id="l37.85" class="difflineplus">+</span>
<a href="#l37.86"></a><span id="l37.86" class="difflineplus">+  setTimeout(selectServer, 0, selectedServer, selectPage);</span>
<a href="#l37.87"></a><span id="l37.87" class="difflineplus">+</span>
<a href="#l37.88"></a><span id="l37.88">   // Make sure the account manager window fits the screen.</span>
<a href="#l37.89"></a><span id="l37.89">   document.getElementById(&quot;accountManager&quot;).style.maxHeight =</span>
<a href="#l37.90"></a><span id="l37.90">     (window.screen.availHeight - 30) + &quot;px&quot;;</span>
<a href="#l37.91"></a><span id="l37.91" class="difflineminus">-  setTimeout(selectServer, 0, selectedServer, selectPage);</span>
<a href="#l37.92"></a><span id="l37.92"> }</span>
<a href="#l37.93"></a><span id="l37.93"> </span>
<a href="#l37.94"></a><span id="l37.94"> function onUnload() {</span>
<a href="#l37.95"></a><span id="l37.95">   gAccountTree.unload();</span>
<a href="#l37.96"></a><span id="l37.96"> }</span>
<a href="#l37.97"></a><span id="l37.97"> </span>
<a href="#l37.98"></a><span id="l37.98" class="difflineminus">-/**</span>
<a href="#l37.99"></a><span id="l37.99" class="difflineminus">- * Select a specific account in the account tree.</span>
<a href="#l37.100"></a><span id="l37.100" class="difflineminus">- *</span>
<a href="#l37.101"></a><span id="l37.101" class="difflineminus">- * @param serverKey     The server key of the account to select.</span>
<a href="#l37.102"></a><span id="l37.102" class="difflineminus">- * @param selectPageId  The xul file name of a page to select (a subpanel of the account).</span>
<a href="#l37.103"></a><span id="l37.103" class="difflineminus">- */</span>
<a href="#l37.104"></a><span id="l37.104" class="difflineminus">-function selectServerByKey(serverKey, selectPageId) {</span>
<a href="#l37.105"></a><span id="l37.105" class="difflineminus">-  let server = MailServices.accounts.getIncomingServer(serverKey);</span>
<a href="#l37.106"></a><span id="l37.106" class="difflineminus">-  selectServer(server, selectPageId);</span>
<a href="#l37.107"></a><span id="l37.107" class="difflineminus">-}</span>
<a href="#l37.108"></a><span id="l37.108" class="difflineminus">-</span>
<a href="#l37.109"></a><span id="l37.109" class="difflineminus">-/**</span>
<a href="#l37.110"></a><span id="l37.110" class="difflineminus">- * Select a specific account in the account tree.</span>
<a href="#l37.111"></a><span id="l37.111" class="difflineminus">- *</span>
<a href="#l37.112"></a><span id="l37.112" class="difflineminus">- * @param server        The nsIMsgServer of the account to select.</span>
<a href="#l37.113"></a><span id="l37.113" class="difflineminus">- * @param selectPageId  The xul file name of a page to select (a subpanel of the account).</span>
<a href="#l37.114"></a><span id="l37.114" class="difflineminus">- */</span>
<a href="#l37.115"></a><span id="l37.115"> function selectServer(server, selectPageId) {</span>
<a href="#l37.116"></a><span id="l37.116">   let childrenNode = document.getElementById(&quot;account-tree-children&quot;);</span>
<a href="#l37.117"></a><span id="l37.117"> </span>
<a href="#l37.118"></a><span id="l37.118">   // Default to showing the first account.</span>
<a href="#l37.119"></a><span id="l37.119">   let accountNode = childrenNode.firstChild;</span>
<a href="#l37.120"></a><span id="l37.120"> </span>
<a href="#l37.121"></a><span id="l37.121">   // Find the tree-node for the account we want to select</span>
<a href="#l37.122"></a><span id="l37.122">   if (server) {</span>
<a href="#l37.123"></a><span id="l37.123" class="difflineat">@@ -255,42 +218,50 @@ function replaceWithDefaultSmtpServer(de</span>
<a href="#l37.124"></a><span id="l37.124">                                           &quot;smtpServerKey&quot;, null, false);</span>
<a href="#l37.125"></a><span id="l37.125">       if (smtpServerKey == deletedSmtpServerKey)</span>
<a href="#l37.126"></a><span id="l37.126">         setAccountValue(accountValues, &quot;identity&quot;, &quot;smtpServerKey&quot;, &quot;&quot;);</span>
<a href="#l37.127"></a><span id="l37.127">     }</span>
<a href="#l37.128"></a><span id="l37.128">   }</span>
<a href="#l37.129"></a><span id="l37.129"> }</span>
<a href="#l37.130"></a><span id="l37.130"> </span>
<a href="#l37.131"></a><span id="l37.131"> /**</span>
<a href="#l37.132"></a><span id="l37.132" class="difflineminus">- * Called when all the changes should be really saved</span>
<a href="#l37.133"></a><span id="l37.133" class="difflineminus">- * (e.g. OK was clicked in the dialog, or the Preferences tab closed).</span>
<a href="#l37.134"></a><span id="l37.134" class="difflineplus">+ * Called when OK is clicked on the dialog.</span>
<a href="#l37.135"></a><span id="l37.135">  *</span>
<a href="#l37.136"></a><span id="l37.136" class="difflineminus">- * @param abortOnFailure  If true, return without saving if data checks didn't pass.</span>
<a href="#l37.137"></a><span id="l37.137" class="difflineplus">+ * @param aDoChecks  If true, execute checks on data, otherwise hope they</span>
<a href="#l37.138"></a><span id="l37.138" class="difflineplus">+ *                   were already done elsewhere and proceed directly to saving</span>
<a href="#l37.139"></a><span id="l37.139" class="difflineplus">+ *                   the data.</span>
<a href="#l37.140"></a><span id="l37.140">  */</span>
<a href="#l37.141"></a><span id="l37.141" class="difflineminus">-function onAccept(abortOnFailure) {</span>
<a href="#l37.142"></a><span id="l37.142" class="difflineplus">+function onAccept(aDoChecks) {</span>
<a href="#l37.143"></a><span id="l37.143" class="difflineplus">+  if (aDoChecks) {</span>
<a href="#l37.144"></a><span id="l37.144" class="difflineplus">+    // Check if user/host have been modified correctly.</span>
<a href="#l37.145"></a><span id="l37.145" class="difflineplus">+    if (!checkUserServerChanges(true))</span>
<a href="#l37.146"></a><span id="l37.146" class="difflineplus">+      return false;</span>
<a href="#l37.147"></a><span id="l37.147" class="difflineplus">+</span>
<a href="#l37.148"></a><span id="l37.148" class="difflineplus">+    if (!checkAccountNameIsValid())</span>
<a href="#l37.149"></a><span id="l37.149" class="difflineplus">+      return false;</span>
<a href="#l37.150"></a><span id="l37.150" class="difflineplus">+  }</span>
<a href="#l37.151"></a><span id="l37.151" class="difflineplus">+</span>
<a href="#l37.152"></a><span id="l37.152">   // Run checks as if the page was being left.</span>
<a href="#l37.153"></a><span id="l37.153" class="difflineminus">-  if (currentAccount &amp;&amp; (&quot;onLeave&quot; in top.frames.contentFrame)) {</span>
<a href="#l37.154"></a><span id="l37.154" class="difflineminus">-    if (!top.frames.contentFrame.onLeave(!abortOnFailure)) {</span>
<a href="#l37.155"></a><span id="l37.155" class="difflineplus">+  if (&quot;onLeave&quot; in top.frames.contentFrame) {</span>
<a href="#l37.156"></a><span id="l37.156" class="difflineplus">+    if (!top.frames.contentFrame.onLeave()) {</span>
<a href="#l37.157"></a><span id="l37.157">       // Prevent closing Account manager if user declined the changes.</span>
<a href="#l37.158"></a><span id="l37.158" class="difflineminus">-      if (abortOnFailure)</span>
<a href="#l37.159"></a><span id="l37.159" class="difflineminus">-        return false;</span>
<a href="#l37.160"></a><span id="l37.160" class="difflineplus">+      return false;</span>
<a href="#l37.161"></a><span id="l37.161">     }</span>
<a href="#l37.162"></a><span id="l37.162">   }</span>
<a href="#l37.163"></a><span id="l37.163"> </span>
<a href="#l37.164"></a><span id="l37.164" class="difflineminus">-  if (!onSave() &amp;&amp; abortOnFailure)</span>
<a href="#l37.165"></a><span id="l37.165" class="difflineplus">+  if (!onSave())</span>
<a href="#l37.166"></a><span id="l37.166">     return false;</span>
<a href="#l37.167"></a><span id="l37.167"> </span>
<a href="#l37.168"></a><span id="l37.168">   // hack hack - save the prefs file NOW in case we crash</span>
<a href="#l37.169"></a><span id="l37.169">   Services.prefs.savePrefFile(null);</span>
<a href="#l37.170"></a><span id="l37.170"> </span>
<a href="#l37.171"></a><span id="l37.171">   if (gRestartNeeded) {</span>
<a href="#l37.172"></a><span id="l37.172">     gRestartNeeded = !BrowserUtils.restartApplication();</span>
<a href="#l37.173"></a><span id="l37.173">     // returns false so that Account manager is not exited when restart failed</span>
<a href="#l37.174"></a><span id="l37.174" class="difflineminus">-    if (abortOnFailure)</span>
<a href="#l37.175"></a><span id="l37.175" class="difflineminus">-      return !gRestartNeeded;</span>
<a href="#l37.176"></a><span id="l37.176" class="difflineplus">+    return !gRestartNeeded;</span>
<a href="#l37.177"></a><span id="l37.177">   }</span>
<a href="#l37.178"></a><span id="l37.178"> </span>
<a href="#l37.179"></a><span id="l37.179">   return true;</span>
<a href="#l37.180"></a><span id="l37.180"> }</span>
<a href="#l37.181"></a><span id="l37.181"> </span>
<a href="#l37.182"></a><span id="l37.182"> /**</span>
<a href="#l37.183"></a><span id="l37.183">  * Runs when Cancel button is used.</span>
<a href="#l37.184"></a><span id="l37.184">  *</span>
<a href="#l37.185"></a><span id="l37.185" class="difflineat">@@ -507,20 +478,21 @@ function checkDirectoryIsUsable(aLocalPa</span>
<a href="#l37.186"></a><span id="l37.186">   }</span>
<a href="#l37.187"></a><span id="l37.187"> </span>
<a href="#l37.188"></a><span id="l37.188">   return true;</span>
<a href="#l37.189"></a><span id="l37.189"> }</span>
<a href="#l37.190"></a><span id="l37.190"> </span>
<a href="#l37.191"></a><span id="l37.191"> /**</span>
<a href="#l37.192"></a><span id="l37.192">  * Check if the user and/or host names have been changed and if so check</span>
<a href="#l37.193"></a><span id="l37.193">  * if the new names already exists for an account or are empty.</span>
<a href="#l37.194"></a><span id="l37.194" class="difflineplus">+ * Also check if the Local Directory path was changed.</span>
<a href="#l37.195"></a><span id="l37.195">  *</span>
<a href="#l37.196"></a><span id="l37.196" class="difflineminus">- * @param restoreValuesOnFailure  show and alert if a problem with the host / user name is found</span>
<a href="#l37.197"></a><span id="l37.197" class="difflineplus">+ * @param showAlert  show and alert if a problem with the host / user name is found</span>
<a href="#l37.198"></a><span id="l37.198">  */</span>
<a href="#l37.199"></a><span id="l37.199" class="difflineminus">-function checkUserServerChanges(restoreValuesOnFailure) {</span>
<a href="#l37.200"></a><span id="l37.200" class="difflineplus">+function checkUserServerChanges(showAlert) {</span>
<a href="#l37.201"></a><span id="l37.201">   const prefBundle = document.getElementById(&quot;bundle_prefs&quot;);</span>
<a href="#l37.202"></a><span id="l37.202">   const alertTitle = prefBundle.getString(&quot;prefPanel-server&quot;);</span>
<a href="#l37.203"></a><span id="l37.203">   var alertText = null;</span>
<a href="#l37.204"></a><span id="l37.204"> </span>
<a href="#l37.205"></a><span id="l37.205">   var accountValues = getValueArrayFor(currentAccount);</span>
<a href="#l37.206"></a><span id="l37.206">   if (!accountValues)</span>
<a href="#l37.207"></a><span id="l37.207">     return true;</span>
<a href="#l37.208"></a><span id="l37.208"> </span>
<a href="#l37.209"></a><span id="l37.209" class="difflineat">@@ -529,34 +501,31 @@ function checkUserServerChanges(restoreV</span>
<a href="#l37.210"></a><span id="l37.210">   // If this type doesn't exist (just removed) then return.</span>
<a href="#l37.211"></a><span id="l37.211">   if (!(&quot;server&quot; in accountValues) || !accountValues.server)</span>
<a href="#l37.212"></a><span id="l37.212">     return true;</span>
<a href="#l37.213"></a><span id="l37.213"> </span>
<a href="#l37.214"></a><span id="l37.214">   // Get the new username, hostname and type from the page.</span>
<a href="#l37.215"></a><span id="l37.215">   var typeElem = getPageFormElement(&quot;server.type&quot;);</span>
<a href="#l37.216"></a><span id="l37.216">   var hostElem = getPageFormElement(&quot;server.realHostName&quot;);</span>
<a href="#l37.217"></a><span id="l37.217">   var userElem = getPageFormElement(&quot;server.realUsername&quot;);</span>
<a href="#l37.218"></a><span id="l37.218" class="difflineminus">-  if (!typeElem || !userElem || !hostElem)</span>
<a href="#l37.219"></a><span id="l37.219" class="difflineminus">-    return true;</span>
<a href="#l37.220"></a><span id="l37.220" class="difflineminus">-</span>
<a href="#l37.221"></a><span id="l37.221" class="difflineplus">+  if (typeElem &amp;&amp; userElem &amp;&amp; hostElem) {</span>
<a href="#l37.222"></a><span id="l37.222">   var newType = getFormElementValue(typeElem);</span>
<a href="#l37.223"></a><span id="l37.223">   var oldHost = getAccountValue(currentAccount, accountValues, &quot;server&quot;, &quot;realHostName&quot;,</span>
<a href="#l37.224"></a><span id="l37.224">                                 null, false);</span>
<a href="#l37.225"></a><span id="l37.225">   var newHost = getFormElementValue(hostElem);</span>
<a href="#l37.226"></a><span id="l37.226">   var oldUser = getAccountValue(currentAccount, accountValues, &quot;server&quot;, &quot;realUsername&quot;,</span>
<a href="#l37.227"></a><span id="l37.227">                                 null, false);</span>
<a href="#l37.228"></a><span id="l37.228"> </span>
<a href="#l37.229"></a><span id="l37.229">   var newUser = getFormElementValue(userElem);</span>
<a href="#l37.230"></a><span id="l37.230">   var checkUser = true;</span>
<a href="#l37.231"></a><span id="l37.231">   // There is no username needed for e.g. news so reset it.</span>
<a href="#l37.232"></a><span id="l37.232">   if (currentServer &amp;&amp; !currentServer.protocolInfo.requiresUsername) {</span>
<a href="#l37.233"></a><span id="l37.233">     oldUser = newUser = &quot;&quot;;</span>
<a href="#l37.234"></a><span id="l37.234">     checkUser = false;</span>
<a href="#l37.235"></a><span id="l37.235">   }</span>
<a href="#l37.236"></a><span id="l37.236" class="difflineminus">-</span>
<a href="#l37.237"></a><span id="l37.237">   alertText = null;</span>
<a href="#l37.238"></a><span id="l37.238">   // If something is changed then check if the new user/host already exists.</span>
<a href="#l37.239"></a><span id="l37.239">   if ((oldUser != newUser) || (oldHost != newHost)) {</span>
<a href="#l37.240"></a><span id="l37.240">     newUser = newUser.trim();</span>
<a href="#l37.241"></a><span id="l37.241">     newHost = cleanUpHostName(newHost);</span>
<a href="#l37.242"></a><span id="l37.242">     if (checkUser &amp;&amp; (newUser == &quot;&quot;)) {</span>
<a href="#l37.243"></a><span id="l37.243">       alertText = prefBundle.getString(&quot;userNameEmpty&quot;);</span>
<a href="#l37.244"></a><span id="l37.244">     } else if (!isLegalHostNameOrIP(newHost)) {</span>
<a href="#l37.245"></a><span id="l37.245" class="difflineat">@@ -569,128 +538,107 @@ function checkUserServerChanges(restoreV</span>
<a href="#l37.246"></a><span id="l37.246">       } else {</span>
<a href="#l37.247"></a><span id="l37.247">         // New hostname passed all checks. We may have cleaned it up so set</span>
<a href="#l37.248"></a><span id="l37.248">         // the new value back into the input element.</span>
<a href="#l37.249"></a><span id="l37.249">         setFormElementValue(hostElem, newHost);</span>
<a href="#l37.250"></a><span id="l37.250">       }</span>
<a href="#l37.251"></a><span id="l37.251">     }</span>
<a href="#l37.252"></a><span id="l37.252"> </span>
<a href="#l37.253"></a><span id="l37.253">     if (alertText) {</span>
<a href="#l37.254"></a><span id="l37.254" class="difflineminus">-      Services.prompt.alert(window, alertTitle, alertText);</span>
<a href="#l37.255"></a><span id="l37.255" class="difflineminus">-      if (restoreValuesOnFailure) {</span>
<a href="#l37.256"></a><span id="l37.256" class="difflineminus">-        // Restore the old values before return</span>
<a href="#l37.257"></a><span id="l37.257" class="difflineminus">-        if (checkUser)</span>
<a href="#l37.258"></a><span id="l37.258" class="difflineminus">-          setFormElementValue(userElem, oldUser);</span>
<a href="#l37.259"></a><span id="l37.259" class="difflineminus">-        setFormElementValue(hostElem, oldHost);</span>
<a href="#l37.260"></a><span id="l37.260" class="difflineminus">-        // If no message is shown to the user, silently revert the values</span>
<a href="#l37.261"></a><span id="l37.261" class="difflineminus">-        // and consider the check a success.</span>
<a href="#l37.262"></a><span id="l37.262" class="difflineminus">-      }</span>
<a href="#l37.263"></a><span id="l37.263" class="difflineminus">-      return false;</span>
<a href="#l37.264"></a><span id="l37.264" class="difflineplus">+      if (showAlert)</span>
<a href="#l37.265"></a><span id="l37.265" class="difflineplus">+        Services.prompt.alert(window, alertTitle, alertText);</span>
<a href="#l37.266"></a><span id="l37.266" class="difflineplus">+      // Restore the old values before return</span>
<a href="#l37.267"></a><span id="l37.267" class="difflineplus">+      if (checkUser)</span>
<a href="#l37.268"></a><span id="l37.268" class="difflineplus">+        setFormElementValue(userElem, oldUser);</span>
<a href="#l37.269"></a><span id="l37.269" class="difflineplus">+      setFormElementValue(hostElem, oldHost);</span>
<a href="#l37.270"></a><span id="l37.270" class="difflineplus">+      // If no message is shown to the user, silently revert the values</span>
<a href="#l37.271"></a><span id="l37.271" class="difflineplus">+      // and consider the check a success.</span>
<a href="#l37.272"></a><span id="l37.272" class="difflineplus">+      return !showAlert;</span>
<a href="#l37.273"></a><span id="l37.273">     }</span>
<a href="#l37.274"></a><span id="l37.274"> </span>
<a href="#l37.275"></a><span id="l37.275">     // If username is changed remind users to change Your Name and Email Address.</span>
<a href="#l37.276"></a><span id="l37.276">     // If server name is changed and has defined filters then remind users</span>
<a href="#l37.277"></a><span id="l37.277">     // to edit rules.</span>
<a href="#l37.278"></a><span id="l37.278" class="difflineminus">-    let filterList;</span>
<a href="#l37.279"></a><span id="l37.279" class="difflineminus">-    if (currentServer &amp;&amp; checkUser) {</span>
<a href="#l37.280"></a><span id="l37.280" class="difflineminus">-      filterList = currentServer.getEditableFilterList(null);</span>
<a href="#l37.281"></a><span id="l37.281" class="difflineminus">-    }</span>
<a href="#l37.282"></a><span id="l37.282" class="difflineminus">-    let changeText = &quot;&quot;;</span>
<a href="#l37.283"></a><span id="l37.283" class="difflineminus">-    if ((oldHost != newHost) &amp;&amp;</span>
<a href="#l37.284"></a><span id="l37.284" class="difflineminus">-        (filterList != undefined) &amp;&amp; filterList.filterCount &gt; 0)</span>
<a href="#l37.285"></a><span id="l37.285" class="difflineminus">-      changeText = prefBundle.getString(&quot;serverNameChanged&quot;);</span>
<a href="#l37.286"></a><span id="l37.286" class="difflineminus">-    // In the event that oldHost == newHost or oldUser == newUser,</span>
<a href="#l37.287"></a><span id="l37.287" class="difflineminus">-    // the \n\n will be trimmed off before the message is shown.</span>
<a href="#l37.288"></a><span id="l37.288" class="difflineminus">-    if (oldUser != newUser)</span>
<a href="#l37.289"></a><span id="l37.289" class="difflineminus">-      changeText = changeText + &quot;\n\n&quot; + prefBundle.getString(&quot;userNameChanged&quot;);</span>
<a href="#l37.290"></a><span id="l37.290" class="difflineplus">+    if (showAlert) {</span>
<a href="#l37.291"></a><span id="l37.291" class="difflineplus">+      let filterList;</span>
<a href="#l37.292"></a><span id="l37.292" class="difflineplus">+      if (currentServer &amp;&amp; checkUser) {</span>
<a href="#l37.293"></a><span id="l37.293" class="difflineplus">+        filterList = currentServer.getEditableFilterList(null);</span>
<a href="#l37.294"></a><span id="l37.294" class="difflineplus">+      }</span>
<a href="#l37.295"></a><span id="l37.295" class="difflineplus">+      let changeText = &quot;&quot;;</span>
<a href="#l37.296"></a><span id="l37.296" class="difflineplus">+      if ((oldHost != newHost) &amp;&amp;</span>
<a href="#l37.297"></a><span id="l37.297" class="difflineplus">+          (filterList != undefined) &amp;&amp; filterList.filterCount)</span>
<a href="#l37.298"></a><span id="l37.298" class="difflineplus">+        changeText = prefBundle.getString(&quot;serverNameChanged&quot;);</span>
<a href="#l37.299"></a><span id="l37.299" class="difflineplus">+      // In the event that oldHost == newHost or oldUser == newUser,</span>
<a href="#l37.300"></a><span id="l37.300" class="difflineplus">+      // the \n\n will be trimmed off before the message is shown.</span>
<a href="#l37.301"></a><span id="l37.301" class="difflineplus">+      if (oldUser != newUser)</span>
<a href="#l37.302"></a><span id="l37.302" class="difflineplus">+        changeText = changeText + &quot;\n\n&quot; + prefBundle.getString(&quot;userNameChanged&quot;);</span>
<a href="#l37.303"></a><span id="l37.303"> </span>
<a href="#l37.304"></a><span id="l37.304" class="difflineminus">-    if (changeText != &quot;&quot;)</span>
<a href="#l37.305"></a><span id="l37.305" class="difflineminus">-      Services.prompt.alert(window, alertTitle, changeText.trim());</span>
<a href="#l37.306"></a><span id="l37.306" class="difflineplus">+      if (changeText != &quot;&quot;)</span>
<a href="#l37.307"></a><span id="l37.307" class="difflineplus">+        Services.prompt.alert(window, alertTitle, changeText.trim());</span>
<a href="#l37.308"></a><span id="l37.308" class="difflineplus">+    }</span>
<a href="#l37.309"></a><span id="l37.309">   }</span>
<a href="#l37.310"></a><span id="l37.310" class="difflineminus">-  return true;</span>
<a href="#l37.311"></a><span id="l37.311" class="difflineminus">-}</span>
<a href="#l37.312"></a><span id="l37.312" class="difflineminus">-</span>
<a href="#l37.313"></a><span id="l37.313" class="difflineminus">-/**</span>
<a href="#l37.314"></a><span id="l37.314" class="difflineminus">- * Check if the Local Directory path was changed.</span>
<a href="#l37.315"></a><span id="l37.315" class="difflineminus">- */</span>
<a href="#l37.316"></a><span id="l37.316" class="difflineminus">-function checkLocalPathChanges(restoreValuesOnFailure) {</span>
<a href="#l37.317"></a><span id="l37.317" class="difflineminus">-  var accountValues = getValueArrayFor(currentAccount);</span>
<a href="#l37.318"></a><span id="l37.318" class="difflineminus">-  if (!accountValues)</span>
<a href="#l37.319"></a><span id="l37.319" class="difflineminus">-    return true;</span>
<a href="#l37.320"></a><span id="l37.320" class="difflineplus">+  }</span>
<a href="#l37.321"></a><span id="l37.321"> </span>
<a href="#l37.322"></a><span id="l37.322">   // Check the new value of the server.localPath field for validity.</span>
<a href="#l37.323"></a><span id="l37.323">   var pathElem = getPageFormElement(&quot;server.localPath&quot;);</span>
<a href="#l37.324"></a><span id="l37.324">   if (!pathElem)</span>
<a href="#l37.325"></a><span id="l37.325">     return true;</span>
<a href="#l37.326"></a><span id="l37.326"> </span>
<a href="#l37.327"></a><span id="l37.327" class="difflineminus">-  const prefBundle = document.getElementById(&quot;bundle_prefs&quot;);</span>
<a href="#l37.328"></a><span id="l37.328" class="difflineminus">-  const alertTitle = prefBundle.getString(&quot;prefPanel-server&quot;);</span>
<a href="#l37.329"></a><span id="l37.329" class="difflineminus">-</span>
<a href="#l37.330"></a><span id="l37.330">   if (!checkDirectoryIsUsable(getFormElementValue(pathElem))) {</span>
<a href="#l37.331"></a><span id="l37.331"> //          return false; // Temporarily disable this. Just show warning but do not block. See bug 921371.</span>
<a href="#l37.332"></a><span id="l37.332" class="difflineminus">-    Cu.reportError(&quot;Local directory '&quot; +</span>
<a href="#l37.333"></a><span id="l37.333" class="difflineminus">-        getFormElementValue(pathElem).path + &quot;' of account &quot; +</span>
<a href="#l37.334"></a><span id="l37.334" class="difflineminus">-        currentAccount.key + &quot; is not safe to use. Consider changing it.&quot;);</span>
<a href="#l37.335"></a><span id="l37.335" class="difflineplus">+          Cu.reportError(&quot;Local directory '&quot; +</span>
<a href="#l37.336"></a><span id="l37.336" class="difflineplus">+            getFormElementValue(pathElem).path + &quot;' of account &quot; +</span>
<a href="#l37.337"></a><span id="l37.337" class="difflineplus">+            currentAccount.key + &quot; is not safe to use. Consider changing it.&quot;);</span>
<a href="#l37.338"></a><span id="l37.338">   }</span>
<a href="#l37.339"></a><span id="l37.339"> </span>
<a href="#l37.340"></a><span id="l37.340">   // Warn if the Local directory path was changed.</span>
<a href="#l37.341"></a><span id="l37.341">   // This can be removed once bug 2654 is fixed.</span>
<a href="#l37.342"></a><span id="l37.342">   let oldLocalDir = getAccountValue(currentAccount, accountValues, &quot;server&quot;, &quot;localPath&quot;,</span>
<a href="#l37.343"></a><span id="l37.343">                                     null, false); // both return nsIFile</span>
<a href="#l37.344"></a><span id="l37.344">   let newLocalDir = getFormElementValue(pathElem);</span>
<a href="#l37.345"></a><span id="l37.345">   if (oldLocalDir &amp;&amp; newLocalDir &amp;&amp; (oldLocalDir.path != newLocalDir.path)) {</span>
<a href="#l37.346"></a><span id="l37.346">     let brandName = document.getElementById(&quot;bundle_brand&quot;).getString(&quot;brandShortName&quot;);</span>
<a href="#l37.347"></a><span id="l37.347" class="difflineminus">-    let alertText = prefBundle.getFormattedString(&quot;localDirectoryChanged&quot;, [brandName]);</span>
<a href="#l37.348"></a><span id="l37.348" class="difflineplus">+    alertText = prefBundle.getFormattedString(&quot;localDirectoryChanged&quot;, [brandName]);</span>
<a href="#l37.349"></a><span id="l37.349"> </span>
<a href="#l37.350"></a><span id="l37.350">     let cancel = Services.prompt.confirmEx(window, alertTitle, alertText,</span>
<a href="#l37.351"></a><span id="l37.351">       (Services.prompt.BUTTON_POS_0 * Services.prompt.BUTTON_TITLE_IS_STRING) +</span>
<a href="#l37.352"></a><span id="l37.352">       (Services.prompt.BUTTON_POS_1 * Services.prompt.BUTTON_TITLE_CANCEL),</span>
<a href="#l37.353"></a><span id="l37.353">       prefBundle.getString(&quot;localDirectoryRestart&quot;), null, null, null, {});</span>
<a href="#l37.354"></a><span id="l37.354">     if (cancel) {</span>
<a href="#l37.355"></a><span id="l37.355">       setFormElementValue(pathElem, oldLocalDir);</span>
<a href="#l37.356"></a><span id="l37.356" class="difflineminus">-      return true;</span>
<a href="#l37.357"></a><span id="l37.357" class="difflineplus">+      return false;</span>
<a href="#l37.358"></a><span id="l37.358">     }</span>
<a href="#l37.359"></a><span id="l37.359">     gRestartNeeded = true;</span>
<a href="#l37.360"></a><span id="l37.360">   }</span>
<a href="#l37.361"></a><span id="l37.361"> </span>
<a href="#l37.362"></a><span id="l37.362">   return true;</span>
<a href="#l37.363"></a><span id="l37.363"> }</span>
<a href="#l37.364"></a><span id="l37.364"> </span>
<a href="#l37.365"></a><span id="l37.365"> /**</span>
<a href="#l37.366"></a><span id="l37.366">  * If account name is not valid, alert the user.</span>
<a href="#l37.367"></a><span id="l37.367">  */</span>
<a href="#l37.368"></a><span id="l37.368" class="difflineminus">-function checkAccountNameIsValid(restoreValuesOnFailure) {</span>
<a href="#l37.369"></a><span id="l37.369" class="difflineplus">+function checkAccountNameIsValid() {</span>
<a href="#l37.370"></a><span id="l37.370">   if (!currentAccount)</span>
<a href="#l37.371"></a><span id="l37.371">     return true;</span>
<a href="#l37.372"></a><span id="l37.372"> </span>
<a href="#l37.373"></a><span id="l37.373" class="difflineminus">-  let accountValues = getValueArrayFor(currentAccount);</span>
<a href="#l37.374"></a><span id="l37.374" class="difflineminus">-  if (!accountValues)</span>
<a href="#l37.375"></a><span id="l37.375" class="difflineminus">-    return true;</span>
<a href="#l37.376"></a><span id="l37.376" class="difflineminus">-</span>
<a href="#l37.377"></a><span id="l37.377">   const prefBundle = document.getElementById(&quot;bundle_prefs&quot;);</span>
<a href="#l37.378"></a><span id="l37.378">   let alertText = null;</span>
<a href="#l37.379"></a><span id="l37.379"> </span>
<a href="#l37.380"></a><span id="l37.380">   let serverNameElem = getPageFormElement(&quot;server.prettyName&quot;);</span>
<a href="#l37.381"></a><span id="l37.381">   if (serverNameElem) {</span>
<a href="#l37.382"></a><span id="l37.382">     let accountName = getFormElementValue(serverNameElem);</span>
<a href="#l37.383"></a><span id="l37.383" class="difflineminus">-    let oldName = getAccountValue(currentAccount, accountValues, &quot;server&quot;, &quot;prettyName&quot;,</span>
<a href="#l37.384"></a><span id="l37.384" class="difflineminus">-                                  null, false);</span>
<a href="#l37.385"></a><span id="l37.385"> </span>
<a href="#l37.386"></a><span id="l37.386">     if (!accountName)</span>
<a href="#l37.387"></a><span id="l37.387">       alertText = prefBundle.getString(&quot;accountNameEmpty&quot;);</span>
<a href="#l37.388"></a><span id="l37.388">     else if (accountNameExists(accountName, currentAccount.key))</span>
<a href="#l37.389"></a><span id="l37.389">       alertText = prefBundle.getString(&quot;accountNameExists&quot;);</span>
<a href="#l37.390"></a><span id="l37.390"> </span>
<a href="#l37.391"></a><span id="l37.391">     if (alertText) {</span>
<a href="#l37.392"></a><span id="l37.392">       const alertTitle = prefBundle.getString(&quot;accountWizard&quot;);</span>
<a href="#l37.393"></a><span id="l37.393">       Services.prompt.alert(window, alertTitle, alertText);</span>
<a href="#l37.394"></a><span id="l37.394" class="difflineminus">-      if (restoreValuesOnFailure) {</span>
<a href="#l37.395"></a><span id="l37.395" class="difflineminus">-        // Restore the old values before return.</span>
<a href="#l37.396"></a><span id="l37.396" class="difflineminus">-        setFormElementValue(serverNameElem, oldName);</span>
<a href="#l37.397"></a><span id="l37.397" class="difflineminus">-      }</span>
<a href="#l37.398"></a><span id="l37.398">       return false;</span>
<a href="#l37.399"></a><span id="l37.399">     }</span>
<a href="#l37.400"></a><span id="l37.400">   }</span>
<a href="#l37.401"></a><span id="l37.401"> </span>
<a href="#l37.402"></a><span id="l37.402">   return true;</span>
<a href="#l37.403"></a><span id="l37.403"> }</span>
<a href="#l37.404"></a><span id="l37.404"> </span>
<a href="#l37.405"></a><span id="l37.405"> function onSave() {</span>
<a href="#l37.406"></a><span id="l37.406" class="difflineat">@@ -1059,48 +1007,60 @@ function onAccountTreeSelect(pageId, acc</span>
<a href="#l37.407"></a><span id="l37.407">   if (!changeView) {</span>
<a href="#l37.408"></a><span id="l37.408">     if (tree.view.selection.count &lt; 1)</span>
<a href="#l37.409"></a><span id="l37.409">       return false;</span>
<a href="#l37.410"></a><span id="l37.410"> </span>
<a href="#l37.411"></a><span id="l37.411">     let node = tree.view.getItemAtIndex(tree.currentIndex);</span>
<a href="#l37.412"></a><span id="l37.412">     account = (&quot;_account&quot; in node) ? node._account : null;</span>
<a href="#l37.413"></a><span id="l37.413"> </span>
<a href="#l37.414"></a><span id="l37.414">     pageId = node.getAttribute(&quot;PageTag&quot;);</span>
<a href="#l37.415"></a><span id="l37.415" class="difflineminus">-    changeView = true;</span>
<a href="#l37.416"></a><span id="l37.416">   }</span>
<a href="#l37.417"></a><span id="l37.417"> </span>
<a href="#l37.418"></a><span id="l37.418">   if (pageId == currentPageId &amp;&amp; account == currentAccount)</span>
<a href="#l37.419"></a><span id="l37.419">     return true;</span>
<a href="#l37.420"></a><span id="l37.420"> </span>
<a href="#l37.421"></a><span id="l37.421" class="difflineplus">+  if (document.getElementById(&quot;contentFrame&quot;).contentDocument.getElementById(&quot;server.localPath&quot;)) {</span>
<a href="#l37.422"></a><span id="l37.422" class="difflineplus">+    // Check if user/host names have been changed or the Local Directory is invalid.</span>
<a href="#l37.423"></a><span id="l37.423" class="difflineplus">+    if (!checkUserServerChanges(false)) {</span>
<a href="#l37.424"></a><span id="l37.424" class="difflineplus">+      changeView = true;</span>
<a href="#l37.425"></a><span id="l37.425" class="difflineplus">+      account = currentAccount;</span>
<a href="#l37.426"></a><span id="l37.426" class="difflineplus">+      pageId = currentPageId;</span>
<a href="#l37.427"></a><span id="l37.427" class="difflineplus">+    }</span>
<a href="#l37.428"></a><span id="l37.428" class="difflineplus">+</span>
<a href="#l37.429"></a><span id="l37.429" class="difflineplus">+    if (gRestartNeeded)</span>
<a href="#l37.430"></a><span id="l37.430" class="difflineplus">+      onAccept(false);</span>
<a href="#l37.431"></a><span id="l37.431" class="difflineplus">+  }</span>
<a href="#l37.432"></a><span id="l37.432" class="difflineplus">+</span>
<a href="#l37.433"></a><span id="l37.433" class="difflineplus">+  if (document.getElementById(&quot;contentFrame&quot;).contentDocument.getElementById(&quot;server.prettyName&quot;)) {</span>
<a href="#l37.434"></a><span id="l37.434" class="difflineplus">+    // Check if account name is valid.</span>
<a href="#l37.435"></a><span id="l37.435" class="difflineplus">+    if (!checkAccountNameIsValid()) {</span>
<a href="#l37.436"></a><span id="l37.436" class="difflineplus">+      changeView = true;</span>
<a href="#l37.437"></a><span id="l37.437" class="difflineplus">+      account = currentAccount;</span>
<a href="#l37.438"></a><span id="l37.438" class="difflineplus">+      pageId = currentPageId;</span>
<a href="#l37.439"></a><span id="l37.439" class="difflineplus">+    }</span>
<a href="#l37.440"></a><span id="l37.440" class="difflineplus">+  }</span>
<a href="#l37.441"></a><span id="l37.441" class="difflineplus">+</span>
<a href="#l37.442"></a><span id="l37.442">   if (currentPageId) {</span>
<a href="#l37.443"></a><span id="l37.443">     // Change focus to the account tree first so that any 'onchange' handlers</span>
<a href="#l37.444"></a><span id="l37.444">     // on elements in the current page have a chance to run before the page</span>
<a href="#l37.445"></a><span id="l37.445">     // is saved and replaced by the new one.</span>
<a href="#l37.446"></a><span id="l37.446">     tree.focus();</span>
<a href="#l37.447"></a><span id="l37.447">   }</span>
<a href="#l37.448"></a><span id="l37.448"> </span>
<a href="#l37.449"></a><span id="l37.449" class="difflineminus">-  // Provide opportunity to do cleanups and checks when the current page is being left.</span>
<a href="#l37.450"></a><span id="l37.450" class="difflineminus">-  if (currentAccount &amp;&amp; (&quot;onLeave&quot; in top.frames.contentFrame)) {</span>
<a href="#l37.451"></a><span id="l37.451" class="difflineminus">-    if (!top.frames.contentFrame.onLeave()) {</span>
<a href="#l37.452"></a><span id="l37.452" class="difflineminus">-      changeView = false;</span>
<a href="#l37.453"></a><span id="l37.453" class="difflineminus">-    }</span>
<a href="#l37.454"></a><span id="l37.454" class="difflineminus">-  }</span>
<a href="#l37.455"></a><span id="l37.455" class="difflineminus">-</span>
<a href="#l37.456"></a><span id="l37.456" class="difflineminus">-  if (!changeView) {</span>
<a href="#l37.457"></a><span id="l37.457" class="difflineminus">-    selectServer(currentAccount.incomingServer, currentPageId);</span>
<a href="#l37.458"></a><span id="l37.458" class="difflineminus">-    return true;</span>
<a href="#l37.459"></a><span id="l37.459" class="difflineminus">-  }</span>
<a href="#l37.460"></a><span id="l37.460" class="difflineplus">+  // Provide opportunity to do cleanups or checks when the current page is being left.</span>
<a href="#l37.461"></a><span id="l37.461" class="difflineplus">+  if (&quot;onLeave&quot; in top.frames.contentFrame)</span>
<a href="#l37.462"></a><span id="l37.462" class="difflineplus">+    top.frames.contentFrame.onLeave();</span>
<a href="#l37.463"></a><span id="l37.463"> </span>
<a href="#l37.464"></a><span id="l37.464">   // save the previous page</span>
<a href="#l37.465"></a><span id="l37.465">   savePage(currentAccount);</span>
<a href="#l37.466"></a><span id="l37.466"> </span>
<a href="#l37.467"></a><span id="l37.467" class="difflineminus">-  if (gRestartNeeded)</span>
<a href="#l37.468"></a><span id="l37.468" class="difflineminus">-    onAccept(false);</span>
<a href="#l37.469"></a><span id="l37.469" class="difflineplus">+  let changeAccount = (account != currentAccount);</span>
<a href="#l37.470"></a><span id="l37.470"> </span>
<a href="#l37.471"></a><span id="l37.471" class="difflineminus">-  let changeAccount = (account != currentAccount);</span>
<a href="#l37.472"></a><span id="l37.472" class="difflineplus">+  if (changeView)</span>
<a href="#l37.473"></a><span id="l37.473" class="difflineplus">+    selectServer(account.incomingServer, pageId);</span>
<a href="#l37.474"></a><span id="l37.474"> </span>
<a href="#l37.475"></a><span id="l37.475">   if (pageId != currentPageId) {</span>
<a href="#l37.476"></a><span id="l37.476">     // loading a complete different page</span>
<a href="#l37.477"></a><span id="l37.477"> </span>
<a href="#l37.478"></a><span id="l37.478">     // prevent overwriting with bad stuff</span>
<a href="#l37.479"></a><span id="l37.479">     currentAccount = currentPageId = null;</span>
<a href="#l37.480"></a><span id="l37.480"> </span>
<a href="#l37.481"></a><span id="l37.481">     pendingAccount = account;</span>
<a href="#l37.482"></a><span id="l37.482" class="difflineat">@@ -1115,20 +1075,20 @@ function onAccountTreeSelect(pageId, acc</span>
<a href="#l37.483"></a><span id="l37.483">     updateButtons(tree, account);</span>
<a href="#l37.484"></a><span id="l37.484"> </span>
<a href="#l37.485"></a><span id="l37.485">   return true;</span>
<a href="#l37.486"></a><span id="l37.486"> }</span>
<a href="#l37.487"></a><span id="l37.487"> </span>
<a href="#l37.488"></a><span id="l37.488"> // page has loaded</span>
<a href="#l37.489"></a><span id="l37.489"> function onPanelLoaded(pageId) {</span>
<a href="#l37.490"></a><span id="l37.490">   if (pageId != pendingPageId) {</span>
<a href="#l37.491"></a><span id="l37.491" class="difflineminus">-    // If we're reloading the current page, we'll assume the</span>
<a href="#l37.492"></a><span id="l37.492" class="difflineplus">+    // if we're reloading the current page, we'll assume the</span>
<a href="#l37.493"></a><span id="l37.493">     // page has asked itself to be completely reloaded from</span>
<a href="#l37.494"></a><span id="l37.494" class="difflineminus">-    // the prefs. To do this, clear out the the old entry in</span>
<a href="#l37.495"></a><span id="l37.495" class="difflineminus">-    // the account data, and then restore the page.</span>
<a href="#l37.496"></a><span id="l37.496" class="difflineplus">+    // the prefs. to do this, clear out the the old entry in</span>
<a href="#l37.497"></a><span id="l37.497" class="difflineplus">+    // the account data, and then restore theh page</span>
<a href="#l37.498"></a><span id="l37.498">     if (pageId == currentPageId) {</span>
<a href="#l37.499"></a><span id="l37.499">       var serverId = currentAccount ?</span>
<a href="#l37.500"></a><span id="l37.500">                      currentAccount.incomingServer.serverURI :</span>
<a href="#l37.501"></a><span id="l37.501">                      &quot;global&quot;;</span>
<a href="#l37.502"></a><span id="l37.502">       delete accountArray[serverId];</span>
<a href="#l37.503"></a><span id="l37.503">       restorePage(currentPageId, currentAccount);</span>
<a href="#l37.504"></a><span id="l37.504">     }</span>
<a href="#l37.505"></a><span id="l37.505">   } else {</span>
<a href="#l37.506"></a><span id="l37.506" class="difflineat">@@ -1512,17 +1472,16 @@ var gAccountTree = {</span>
<a href="#l37.507"></a><span id="l37.507">                   {string: getString(&quot;prefPanel-diskspace&quot;), src: &quot;am-offline.xul&quot;},</span>
<a href="#l37.508"></a><span id="l37.508">                   {string: getString(&quot;prefPanel-addressing&quot;), src: &quot;am-addressing.xul&quot;},</span>
<a href="#l37.509"></a><span id="l37.509">                   {string: getString(&quot;prefPanel-junk&quot;), src: &quot;am-junk.xul&quot;}];</span>
<a href="#l37.510"></a><span id="l37.510"> </span>
<a href="#l37.511"></a><span id="l37.511">     let accounts = allAccountsSorted(false);</span>
<a href="#l37.512"></a><span id="l37.512"> </span>
<a href="#l37.513"></a><span id="l37.513">     let mainTree = document.getElementById(&quot;account-tree-children&quot;);</span>
<a href="#l37.514"></a><span id="l37.514">     // Clear off all children...</span>
<a href="#l37.515"></a><span id="l37.515" class="difflineminus">-    mainTree.removeAttribute(&quot;tree-built&quot;);</span>
<a href="#l37.516"></a><span id="l37.516">     while (mainTree.hasChildNodes())</span>
<a href="#l37.517"></a><span id="l37.517">       mainTree.lastChild.remove();</span>
<a href="#l37.518"></a><span id="l37.518"> </span>
<a href="#l37.519"></a><span id="l37.519">     for (let account of accounts) {</span>
<a href="#l37.520"></a><span id="l37.520">       let accountName = null;</span>
<a href="#l37.521"></a><span id="l37.521">       let accountKey = account.key;</span>
<a href="#l37.522"></a><span id="l37.522">       let amChrome = &quot;about:blank&quot;;</span>
<a href="#l37.523"></a><span id="l37.523">       let panelsToKeep = [];</span>
<a href="#l37.524"></a><span id="l37.524" class="difflineat">@@ -1645,17 +1604,10 @@ var gAccountTree = {</span>
<a href="#l37.525"></a><span id="l37.525">     let treerow = document.createXULElement(&quot;treerow&quot;);</span>
<a href="#l37.526"></a><span id="l37.526">     treeitem.appendChild(treerow);</span>
<a href="#l37.527"></a><span id="l37.527">     let treecell = document.createXULElement(&quot;treecell&quot;);</span>
<a href="#l37.528"></a><span id="l37.528">     treerow.appendChild(treecell);</span>
<a href="#l37.529"></a><span id="l37.529">     treecell.setAttribute(&quot;label&quot;, getString(&quot;prefPanel-smtp&quot;));</span>
<a href="#l37.530"></a><span id="l37.530">     treeitem.setAttribute(&quot;PageTag&quot;, &quot;am-smtp.xul&quot;);</span>
<a href="#l37.531"></a><span id="l37.531">     treecell.setAttribute(&quot;properties&quot;,</span>
<a href="#l37.532"></a><span id="l37.532">                           &quot;folderNameCol isServer-true serverType-smtp&quot;);</span>
<a href="#l37.533"></a><span id="l37.533" class="difflineminus">-</span>
<a href="#l37.534"></a><span id="l37.534" class="difflineminus">-    mainTree.setAttribute(&quot;tree-built&quot;, &quot;true&quot;);</span>
<a href="#l37.535"></a><span id="l37.535" class="difflineminus">-    // We need to notify the caller that the account tree is built so that</span>
<a href="#l37.536"></a><span id="l37.536" class="difflineminus">-    // it can now select a specific account if needed.</span>
<a href="#l37.537"></a><span id="l37.537" class="difflineminus">-    mainTree.dispatchEvent(</span>
<a href="#l37.538"></a><span id="l37.538" class="difflineminus">-      new CustomEvent(&quot;account-tree-built&quot;, { bubbles: true, cancelable: false })</span>
<a href="#l37.539"></a><span id="l37.539" class="difflineminus">-    );</span>
<a href="#l37.540"></a><span id="l37.540">   },</span>
<a href="#l37.541"></a><span id="l37.541"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/base/prefs/content/AccountManager.xul</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/base/prefs/content/AccountManager.xul</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1,54 +1,93 @@</span>
<a href="#l38.4"></a><span id="l38.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l38.5"></a><span id="l38.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l38.6"></a><span id="l38.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l38.7"></a><span id="l38.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l38.8"></a><span id="l38.8"> </span>
<a href="#l38.9"></a><span id="l38.9" class="difflineminus">-&lt;!-- This file is only used by Seamonkey.</span>
<a href="#l38.10"></a><span id="l38.10" class="difflineminus">-     If you make a change relevant to Thunderbird too, update</span>
<a href="#l38.11"></a><span id="l38.11" class="difflineminus">-     mail/components/preferences/AccountManager.inc.xul. --&gt;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-</span>
<a href="#l38.13"></a><span id="l38.13"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderPane.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l38.14"></a><span id="l38.14"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l38.15"></a><span id="l38.15"> </span>
<a href="#l38.16"></a><span id="l38.16"> &lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/AccountManager.dtd&quot;&gt;</span>
<a href="#l38.17"></a><span id="l38.17"> &lt;dialog id=&quot;accountManager&quot;</span>
<a href="#l38.18"></a><span id="l38.18">         windowtype=&quot;mailnews:accountmanager&quot;</span>
<a href="#l38.19"></a><span id="l38.19">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l38.20"></a><span id="l38.20">         title=&quot;&amp;accountManagerTitle.label;&quot;</span>
<a href="#l38.21"></a><span id="l38.21">         style=&quot;&amp;accountManager.size;&quot;</span>
<a href="#l38.22"></a><span id="l38.22">         persist=&quot;width height screenX screenY&quot;</span>
<a href="#l38.23"></a><span id="l38.23">         buttons=&quot;accept,cancel&quot;</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineminus">-        onload=&quot;onLoad();&quot;</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineplus">+        onload=&quot;onLoad(event);&quot;</span>
<a href="#l38.26"></a><span id="l38.26">         onunload=&quot;onUnload();&quot;&gt;</span>
<a href="#l38.27"></a><span id="l38.27"> &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l38.28"></a><span id="l38.28"> &lt;stringbundle id=&quot;bundle_prefs&quot; src=&quot;chrome://messenger/locale/prefs.properties&quot;/&gt;</span>
<a href="#l38.29"></a><span id="l38.29"> &lt;script src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l38.30"></a><span id="l38.30"> &lt;script src=&quot;chrome://messenger/content/am-prefs.js&quot;/&gt;</span>
<a href="#l38.31"></a><span id="l38.31"> &lt;script src=&quot;chrome://messenger/content/AccountManager.js&quot;/&gt;</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+#ifdef MOZ_SUITE</span>
<a href="#l38.33"></a><span id="l38.33"> &lt;script src=&quot;chrome://messenger/content/am-help.js&quot;/&gt;</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+#endif</span>
<a href="#l38.35"></a><span id="l38.35"> &lt;script src=&quot;chrome://messenger/content/amUtils.js&quot;/&gt;</span>
<a href="#l38.36"></a><span id="l38.36"> </span>
<a href="#l38.37"></a><span id="l38.37">   &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l38.38"></a><span id="l38.38">     &lt;vbox style=&quot;&amp;accountTree.width;&quot;&gt;</span>
<a href="#l38.39"></a><span id="l38.39">       &lt;tree flex=&quot;1&quot; onselect=&quot;onAccountTreeSelect(null, null);&quot; id=&quot;accounttree&quot;</span>
<a href="#l38.40"></a><span id="l38.40">             seltype=&quot;single&quot; hidecolumnpicker=&quot;true&quot;&gt;</span>
<a href="#l38.41"></a><span id="l38.41">         &lt;treecols&gt;</span>
<a href="#l38.42"></a><span id="l38.42">           &lt;treecol id=&quot;AccountCol&quot; flex=&quot;1&quot; primary=&quot;true&quot; hideheader=&quot;true&quot;/&gt;</span>
<a href="#l38.43"></a><span id="l38.43">         &lt;/treecols&gt;</span>
<a href="#l38.44"></a><span id="l38.44">         &lt;treechildren id=&quot;account-tree-children&quot;/&gt;</span>
<a href="#l38.45"></a><span id="l38.45">       &lt;/tree&gt;</span>
<a href="#l38.46"></a><span id="l38.46"> </span>
<a href="#l38.47"></a><span id="l38.47" class="difflineplus">+#ifdef MOZ_THUNDERBIRD</span>
<a href="#l38.48"></a><span id="l38.48" class="difflineplus">+      &lt;button id=&quot;accountActionsButton&quot; type=&quot;menu&quot;</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineplus">+              label=&quot;&amp;accountActionsButton.label;&quot;</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineplus">+              accesskey=&quot;&amp;accountActionsButton.accesskey;&quot;&gt;</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineplus">+        &lt;menupopup id=&quot;accountActionsDropdown&quot;</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineplus">+                   onpopupshowing=&quot;initAccountActionsButtons(this);&quot;&gt;</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineplus">+          &lt;menuitem id=&quot;accountActionsAddMailAccount&quot;</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineplus">+                    label=&quot;&amp;addMailAccountButton.label;&quot;</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineplus">+                    accesskey=&quot;&amp;addMailAccountButton.accesskey;&quot;</span>
<a href="#l38.56"></a><span id="l38.56" class="difflineplus">+                    prefstring=&quot;mail.disable_new_account_addition&quot;</span>
<a href="#l38.57"></a><span id="l38.57" class="difflineplus">+                    oncommand=&quot;AddMailAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineplus">+          &lt;menuitem id=&quot;accountActionsAddIMAccount&quot;</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineplus">+                    label=&quot;&amp;addIMAccountButton.label;&quot;</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineplus">+                    accesskey=&quot;&amp;addIMAccountButton.accesskey;&quot;</span>
<a href="#l38.61"></a><span id="l38.61" class="difflineplus">+                    prefstring=&quot;mail.disable_new_account_addition&quot;</span>
<a href="#l38.62"></a><span id="l38.62" class="difflineplus">+                    oncommand=&quot;AddIMAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l38.63"></a><span id="l38.63" class="difflineplus">+          &lt;menuitem id=&quot;accountActionsAddFeedAccount&quot;</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineplus">+                    label=&quot;&amp;addFeedAccountButton.label;&quot;</span>
<a href="#l38.65"></a><span id="l38.65" class="difflineplus">+                    accesskey=&quot;&amp;addFeedAccountButton.accesskey;&quot;</span>
<a href="#l38.66"></a><span id="l38.66" class="difflineplus">+                    prefstring=&quot;mail.disable_new_account_addition&quot;</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineplus">+                    oncommand=&quot;AddFeedAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineplus">+          &lt;menuitem id=&quot;accountActionsAddOtherAccount&quot;</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineplus">+                    label=&quot;&amp;addOtherAccountButton.label;&quot;</span>
<a href="#l38.70"></a><span id="l38.70" class="difflineplus">+                    accesskey=&quot;&amp;addOtherAccountButton.accesskey;&quot;</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineplus">+                    prefstring=&quot;mail.disable_new_account_addition&quot;</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineplus">+                    oncommand=&quot;onAddAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineplus">+          &lt;menuseparator id=&quot;accountActionsDropdownSep1&quot;/&gt;</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineplus">+          &lt;menuitem id=&quot;accountActionsDropdownSetDefault&quot;</span>
<a href="#l38.75"></a><span id="l38.75" class="difflineplus">+                    label=&quot;&amp;setDefaultButton.label;&quot;</span>
<a href="#l38.76"></a><span id="l38.76" class="difflineplus">+                    accesskey=&quot;&amp;setDefaultButton.accesskey;&quot;</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineplus">+                    prefstring=&quot;mail.disable_button.set_default_account&quot;</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineplus">+                    oncommand=&quot;onSetDefault(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l38.79"></a><span id="l38.79" class="difflineplus">+          &lt;menuitem id=&quot;accountActionsDropdownRemove&quot;</span>
<a href="#l38.80"></a><span id="l38.80" class="difflineplus">+                    label=&quot;&amp;removeButton.label;&quot;</span>
<a href="#l38.81"></a><span id="l38.81" class="difflineplus">+                    accesskey=&quot;&amp;removeButton.accesskey;&quot;</span>
<a href="#l38.82"></a><span id="l38.82" class="difflineplus">+                    prefstring=&quot;mail.disable_button.delete_account&quot;</span>
<a href="#l38.83"></a><span id="l38.83" class="difflineplus">+                    oncommand=&quot;onRemoveAccount(event); event.stopPropagation();&quot;/&gt;</span>
<a href="#l38.84"></a><span id="l38.84" class="difflineplus">+        &lt;/menupopup&gt;</span>
<a href="#l38.85"></a><span id="l38.85" class="difflineplus">+      &lt;/button&gt;</span>
<a href="#l38.86"></a><span id="l38.86" class="difflineplus">+#else</span>
<a href="#l38.87"></a><span id="l38.87">       &lt;button label=&quot;&amp;addAccountButton.label;&quot; oncommand=&quot;onAddAccount(event);&quot; id=&quot;addAccountButton&quot;</span>
<a href="#l38.88"></a><span id="l38.88">               prefstring=&quot;mail.disable_new_account_addition&quot;</span>
<a href="#l38.89"></a><span id="l38.89">               accesskey=&quot;&amp;addAccountButton.accesskey;&quot;/&gt;</span>
<a href="#l38.90"></a><span id="l38.90">       &lt;button label=&quot;&amp;setDefaultButton.label;&quot; oncommand=&quot;onSetDefault(event);&quot; disabled=&quot;true&quot; id=&quot;setDefaultButton&quot;</span>
<a href="#l38.91"></a><span id="l38.91">               prefstring=&quot;mail.disable_button.set_default_account&quot;</span>
<a href="#l38.92"></a><span id="l38.92">               accesskey=&quot;&amp;setDefaultButton.accesskey;&quot;/&gt;</span>
<a href="#l38.93"></a><span id="l38.93">       &lt;button disabled=&quot;true&quot; label=&quot;&amp;removeButton.label;&quot; oncommand=&quot;onRemoveAccount(event);&quot; id=&quot;removeButton&quot;</span>
<a href="#l38.94"></a><span id="l38.94">               prefstring=&quot;mail.disable_button.delete_account&quot;</span>
<a href="#l38.95"></a><span id="l38.95">               accesskey=&quot;&amp;removeButton.accesskey;&quot;/&gt;</span>
<a href="#l38.96"></a><span id="l38.96" class="difflineplus">+#endif</span>
<a href="#l38.97"></a><span id="l38.97">     &lt;/vbox&gt;</span>
<a href="#l38.98"></a><span id="l38.98"> </span>
<a href="#l38.99"></a><span id="l38.99">     &lt;iframe id=&quot;contentFrame&quot; name=&quot;contentFrame&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.100"></a><span id="l38.100">   &lt;/hbox&gt;</span>
<a href="#l38.101"></a><span id="l38.101"> &lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/base/prefs/content/AccountWizard.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/base/prefs/content/AccountWizard.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -47,16 +47,18 @@ var okCallback = null;</span>
<a href="#l39.4"></a><span id="l39.4"> </span>
<a href="#l39.5"></a><span id="l39.5">    where the accounttype determines which path to take</span>
<a href="#l39.6"></a><span id="l39.6">    (server vs. newsserver)</span>
<a href="#l39.7"></a><span id="l39.7"> */</span>
<a href="#l39.8"></a><span id="l39.8"> </span>
<a href="#l39.9"></a><span id="l39.9"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l39.10"></a><span id="l39.10"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineplus">+var contentWindow;</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+</span>
<a href="#l39.14"></a><span id="l39.14"> var gPageData;</span>
<a href="#l39.15"></a><span id="l39.15"> </span>
<a href="#l39.16"></a><span id="l39.16"> var nsIMsgIdentity = Ci.nsIMsgIdentity;</span>
<a href="#l39.17"></a><span id="l39.17"> var nsIMsgIncomingServer = Ci.nsIMsgIncomingServer;</span>
<a href="#l39.18"></a><span id="l39.18"> var gPrefsBundle, gMessengerBundle;</span>
<a href="#l39.19"></a><span id="l39.19"> </span>
<a href="#l39.20"></a><span id="l39.20"> // the current nsIMsgAccount</span>
<a href="#l39.21"></a><span id="l39.21"> var gCurrentAccount;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/base/prefs/content/SmtpServerEdit.xul</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/base/prefs/content/SmtpServerEdit.xul</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -1,19 +1,19 @@</span>
<a href="#l40.4"></a><span id="l40.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l40.5"></a><span id="l40.5" class="difflineminus">-&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l40.6"></a><span id="l40.6" class="difflineminus">-   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l40.7"></a><span id="l40.7" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l40.8"></a><span id="l40.8" class="difflineminus">-</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10"> #ifndef MOZ_SUITE</span>
<a href="#l40.11"></a><span id="l40.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/content/bindings.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l40.12"></a><span id="l40.12"> #endif</span>
<a href="#l40.13"></a><span id="l40.13"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l40.17"></a><span id="l40.17" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l40.19"></a><span id="l40.19" class="difflineplus">+</span>
<a href="#l40.20"></a><span id="l40.20"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/dialogs.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l40.21"></a><span id="l40.21"> </span>
<a href="#l40.22"></a><span id="l40.22"> &lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/smtpEditOverlay.dtd&quot;&gt;</span>
<a href="#l40.23"></a><span id="l40.23"> </span>
<a href="#l40.24"></a><span id="l40.24"> &lt;dialog title=&quot;&amp;smtpEditTitle.label;&quot;</span>
<a href="#l40.25"></a><span id="l40.25">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l40.26"></a><span id="l40.26">         onload=&quot;onLoad();&quot;&gt;</span>
<a href="#l40.27"></a><span id="l40.27">   &lt;stringbundle id=&quot;bundle_prefs&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/base/prefs/content/accountUtils.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/base/prefs/content/accountUtils.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l41.4"></a><span id="l41.4"> /* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l41.5"></a><span id="l41.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l41.6"></a><span id="l41.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l41.7"></a><span id="l41.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l41.8"></a><span id="l41.8"> </span>
<a href="#l41.9"></a><span id="l41.9"> /* import-globals-from AccountManager.js */</span>
<a href="#l41.10"></a><span id="l41.10"> /* globals SelectFolder */// From messageWindow.js or msgMail3PaneWindow.js.</span>
<a href="#l41.11"></a><span id="l41.11"> /* globals MsgGetMessage */// From mailWindowOverlay.js.</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-/* globals openPreferencesTab */// From utilityOverlay.js.</span>
<a href="#l41.13"></a><span id="l41.13"> </span>
<a href="#l41.14"></a><span id="l41.14"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l41.15"></a><span id="l41.15"> var {AppConstants} = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l41.16"></a><span id="l41.16"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l41.17"></a><span id="l41.17"> </span>
<a href="#l41.18"></a><span id="l41.18"> var gAnyValidIdentity = false; // If there are no valid identities for any account</span>
<a href="#l41.19"></a><span id="l41.19"> // returns the first account with an invalid server or identity</span>
<a href="#l41.20"></a><span id="l41.20"> </span>
<a href="#l41.21"></a><span id="l41.21" class="difflineat">@@ -222,52 +221,45 @@ function AddFeedAccount() {</span>
<a href="#l41.22"></a><span id="l41.22">   window.openDialog(&quot;chrome://messenger-newsblog/content/feedAccountWizard.xul&quot;,</span>
<a href="#l41.23"></a><span id="l41.23">                     &quot;&quot;, &quot;chrome,modal,titlebar,centerscreen&quot;);</span>
<a href="#l41.24"></a><span id="l41.24"> }</span>
<a href="#l41.25"></a><span id="l41.25"> </span>
<a href="#l41.26"></a><span id="l41.26"> /**</span>
<a href="#l41.27"></a><span id="l41.27">  * Opens the account settings window on the specified account</span>
<a href="#l41.28"></a><span id="l41.28">  * and page of settings. If the window is already open it is only focused.</span>
<a href="#l41.29"></a><span id="l41.29">  *</span>
<a href="#l41.30"></a><span id="l41.30" class="difflineminus">- * @param aSelectPage  The xul file name for the viewing page or</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">- *                     null for the account main page. Other pages are</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineminus">- *                     'am-server.xul', 'am-copies.xul', 'am-offline.xul',</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineminus">- *                     'am-addressing.xul', 'am-smtp.xul'</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineminus">- * @param aServer      The server of the account to select. Optional.</span>
<a href="#l41.35"></a><span id="l41.35" class="difflineplus">+ * @param selectPage  The xul file name for the viewing page or</span>
<a href="#l41.36"></a><span id="l41.36" class="difflineplus">+ *                    null for the account main page. Other pages are</span>
<a href="#l41.37"></a><span id="l41.37" class="difflineplus">+ *                    'am-server.xul', 'am-copies.xul', 'am-offline.xul',</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineplus">+ *                    'am-addressing.xul', 'am-smtp.xul'</span>
<a href="#l41.39"></a><span id="l41.39" class="difflineplus">+ * @param  aServer    The server of the account to select. Optional.</span>
<a href="#l41.40"></a><span id="l41.40">  */</span>
<a href="#l41.41"></a><span id="l41.41" class="difflineminus">-function MsgAccountManager(aSelectPage, aServer) {</span>
<a href="#l41.42"></a><span id="l41.42" class="difflineminus">-  if (!aServer) {</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineminus">-    if (typeof window.GetSelectedMsgFolders === &quot;function&quot;) {</span>
<a href="#l41.44"></a><span id="l41.44" class="difflineminus">-      let folders = window.GetSelectedMsgFolders();</span>
<a href="#l41.45"></a><span id="l41.45" class="difflineminus">-      if (folders.length &gt; 0)</span>
<a href="#l41.46"></a><span id="l41.46" class="difflineminus">-        aServer = folders[0].server;</span>
<a href="#l41.47"></a><span id="l41.47" class="difflineminus">-    }</span>
<a href="#l41.48"></a><span id="l41.48" class="difflineminus">-    if (!aServer &amp;&amp; (typeof window.GetDefaultAccountRootFolder === &quot;function&quot;)) {</span>
<a href="#l41.49"></a><span id="l41.49" class="difflineminus">-      let folder = window.GetDefaultAccountRootFolder();</span>
<a href="#l41.50"></a><span id="l41.50" class="difflineminus">-      if (folder instanceof Ci.nsIMsgFolder)</span>
<a href="#l41.51"></a><span id="l41.51" class="difflineminus">-        aServer = folder.server;</span>
<a href="#l41.52"></a><span id="l41.52" class="difflineplus">+function MsgAccountManager(selectPage, aServer) {</span>
<a href="#l41.53"></a><span id="l41.53" class="difflineplus">+  var existingAccountManager = Services.wm.getMostRecentWindow(&quot;mailnews:accountmanager&quot;);</span>
<a href="#l41.54"></a><span id="l41.54" class="difflineplus">+</span>
<a href="#l41.55"></a><span id="l41.55" class="difflineplus">+  if (existingAccountManager) {</span>
<a href="#l41.56"></a><span id="l41.56" class="difflineplus">+    existingAccountManager.focus();</span>
<a href="#l41.57"></a><span id="l41.57" class="difflineplus">+  } else {</span>
<a href="#l41.58"></a><span id="l41.58" class="difflineplus">+    if (!aServer) {</span>
<a href="#l41.59"></a><span id="l41.59" class="difflineplus">+      if (typeof window.GetSelectedMsgFolders === &quot;function&quot;) {</span>
<a href="#l41.60"></a><span id="l41.60" class="difflineplus">+        let folders = window.GetSelectedMsgFolders();</span>
<a href="#l41.61"></a><span id="l41.61" class="difflineplus">+        if (folders.length &gt; 0)</span>
<a href="#l41.62"></a><span id="l41.62" class="difflineplus">+          aServer = folders[0].server;</span>
<a href="#l41.63"></a><span id="l41.63" class="difflineplus">+      }</span>
<a href="#l41.64"></a><span id="l41.64" class="difflineplus">+      if (!aServer &amp;&amp; (typeof window.GetDefaultAccountRootFolder === &quot;function&quot;)) {</span>
<a href="#l41.65"></a><span id="l41.65" class="difflineplus">+        let folder = window.GetDefaultAccountRootFolder();</span>
<a href="#l41.66"></a><span id="l41.66" class="difflineplus">+        if (folder instanceof Ci.nsIMsgFolder)</span>
<a href="#l41.67"></a><span id="l41.67" class="difflineplus">+          aServer = folder.server;</span>
<a href="#l41.68"></a><span id="l41.68" class="difflineplus">+      }</span>
<a href="#l41.69"></a><span id="l41.69">     }</span>
<a href="#l41.70"></a><span id="l41.70" class="difflineminus">-  }</span>
<a href="#l41.71"></a><span id="l41.71"> </span>
<a href="#l41.72"></a><span id="l41.72" class="difflineminus">-  if (AppConstants.MOZ_APP_NAME == &quot;thunderbird&quot;) {</span>
<a href="#l41.73"></a><span id="l41.73" class="difflineminus">-    // Load the Account Manager in a tab.</span>
<a href="#l41.74"></a><span id="l41.74" class="difflineminus">-    openPreferencesTab(&quot;paneAccount&quot;, aServer ? aServer.key : null, aSelectPage);</span>
<a href="#l41.75"></a><span id="l41.75" class="difflineminus">-  } else {</span>
<a href="#l41.76"></a><span id="l41.76" class="difflineminus">-    // If the Account Manager is already running, just focus the right server.</span>
<a href="#l41.77"></a><span id="l41.77" class="difflineminus">-    let existingAccountManager = Services.wm.getMostRecentWindow(&quot;mailnews:accountmanager&quot;);</span>
<a href="#l41.78"></a><span id="l41.78" class="difflineminus">-    if (existingAccountManager) {</span>
<a href="#l41.79"></a><span id="l41.79" class="difflineminus">-      existingAccountManager.focus();</span>
<a href="#l41.80"></a><span id="l41.80" class="difflineminus">-      existingAccountManager.selectServer(aServer);</span>
<a href="#l41.81"></a><span id="l41.81" class="difflineminus">-    } else {</span>
<a href="#l41.82"></a><span id="l41.82" class="difflineminus">-      // Load the Account Manager in a standalone dialog.</span>
<a href="#l41.83"></a><span id="l41.83" class="difflineminus">-      window.openDialog(&quot;chrome://messenger/content/AccountManager.xul&quot;,</span>
<a href="#l41.84"></a><span id="l41.84" class="difflineminus">-                        &quot;AccountManager&quot;,</span>
<a href="#l41.85"></a><span id="l41.85" class="difflineminus">-                        &quot;chrome,centerscreen,modal,titlebar,resizable&quot;,</span>
<a href="#l41.86"></a><span id="l41.86" class="difflineminus">-                        { server: aServer, selectPage: aSelectPage });</span>
<a href="#l41.87"></a><span id="l41.87" class="difflineminus">-    }</span>
<a href="#l41.88"></a><span id="l41.88" class="difflineplus">+    window.openDialog(&quot;chrome://messenger/content/AccountManager.xul&quot;,</span>
<a href="#l41.89"></a><span id="l41.89" class="difflineplus">+                      &quot;AccountManager&quot;,</span>
<a href="#l41.90"></a><span id="l41.90" class="difflineplus">+                      &quot;chrome,centerscreen,modal,titlebar,resizable&quot;,</span>
<a href="#l41.91"></a><span id="l41.91" class="difflineplus">+                      { server: aServer, selectPage });</span>
<a href="#l41.92"></a><span id="l41.92">   }</span>
<a href="#l41.93"></a><span id="l41.93"> }</span>
<a href="#l41.94"></a><span id="l41.94"> </span>
<a href="#l41.95"></a><span id="l41.95"> function loadInboxForNewAccount() {</span>
<a href="#l41.96"></a><span id="l41.96">   // gNewAccountToLoad is set in the final screen of the Account Wizard if a POP account</span>
<a href="#l41.97"></a><span id="l41.97">   // was created, the download messages box is checked, and the wizard was opened from the 3pane</span>
<a href="#l41.98"></a><span id="l41.98">   if (gNewAccountToLoad) {</span>
<a href="#l41.99"></a><span id="l41.99">     var rootMsgFolder = gNewAccountToLoad.incomingServer.rootMsgFolder;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-addressing.xul</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-addressing.xul</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l42.4"></a><span id="l42.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l42.5"></a><span id="l42.5" class="difflineplus">+</span>
<a href="#l42.6"></a><span id="l42.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l42.7"></a><span id="l42.7">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l42.8"></a><span id="l42.8">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l42.9"></a><span id="l42.9"> </span>
<a href="#l42.10"></a><span id="l42.10" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/content/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l42.11"></a><span id="l42.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l42.12"></a><span id="l42.12"> </span>
<a href="#l42.13"></a><span id="l42.13"> &lt;!DOCTYPE page SYSTEM &quot;chrome://messenger/locale/am-addressing.dtd&quot;&gt;</span>
<a href="#l42.14"></a><span id="l42.14"> </span>
<a href="#l42.15"></a><span id="l42.15"> &lt;page xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l42.16"></a><span id="l42.16">       title=&quot;&amp;addressing.label;&quot;</span>
<a href="#l42.17"></a><span id="l42.17">       onload=&quot;onLoad();&quot;&gt;</span>
<a href="#l42.18"></a><span id="l42.18"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-archiveoptions.xul</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-archiveoptions.xul</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l43.4"></a><span id="l43.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l43.5"></a><span id="l43.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l43.6"></a><span id="l43.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l43.7"></a><span id="l43.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l43.8"></a><span id="l43.8"> </span>
<a href="#l43.9"></a><span id="l43.9" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l43.10"></a><span id="l43.10"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l43.11"></a><span id="l43.11" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l43.12"></a><span id="l43.12"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderPane.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l43.13"></a><span id="l43.13"> </span>
<a href="#l43.14"></a><span id="l43.14"> &lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/am-archiveoptions.dtd&quot; &gt;</span>
<a href="#l43.15"></a><span id="l43.15"> </span>
<a href="#l43.16"></a><span id="l43.16"> &lt;dialog xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l43.17"></a><span id="l43.17">         id=&quot;archive-options&quot;</span>
<a href="#l43.18"></a><span id="l43.18">         title=&quot;&amp;dialogTitle.label;&quot;</span>
<a href="#l43.19"></a><span id="l43.19">         width=&quot;350&quot; height=&quot;350&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-copies.xul</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-copies.xul</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -1,16 +1,15 @@</span>
<a href="#l44.4"></a><span id="l44.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l44.5"></a><span id="l44.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l44.6"></a><span id="l44.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l44.7"></a><span id="l44.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l44.8"></a><span id="l44.8"> </span>
<a href="#l44.9"></a><span id="l44.9" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l44.10"></a><span id="l44.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l44.11"></a><span id="l44.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l44.13"></a><span id="l44.13"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderMenus.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l44.14"></a><span id="l44.14"> </span>
<a href="#l44.15"></a><span id="l44.15"> &lt;!DOCTYPE page SYSTEM &quot;chrome://messenger/locale/am-copies.dtd&quot;&gt;</span>
<a href="#l44.16"></a><span id="l44.16"> </span>
<a href="#l44.17"></a><span id="l44.17"> &lt;page xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l44.18"></a><span id="l44.18">       title=&quot;&amp;copyAndFolderTitle.label;&quot;</span>
<a href="#l44.19"></a><span id="l44.19">       onload=&quot;parent.onPanelLoaded('am-copies.xul');&quot;&gt;</span>
<a href="#l44.20"></a><span id="l44.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identities-list.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identities-list.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -70,21 +70,17 @@ function refreshIdentityList(aSelectInde</span>
<a href="#l45.4"></a><span id="l45.4"> }</span>
<a href="#l45.5"></a><span id="l45.5"> </span>
<a href="#l45.6"></a><span id="l45.6"> /**</span>
<a href="#l45.7"></a><span id="l45.7">  * Opens the identity editor dialog.</span>
<a href="#l45.8"></a><span id="l45.8">  *</span>
<a href="#l45.9"></a><span id="l45.9">  * @param identity  the identity (if any) to load in the dialog</span>
<a href="#l45.10"></a><span id="l45.10">  */</span>
<a href="#l45.11"></a><span id="l45.11"> function openIdentityEditor(identity) {</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  let args = { identity,</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineminus">-               account: gAccount,</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineminus">-               width: window.arguments[0].width,</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineminus">-               height: window.arguments[0].height,</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineminus">-               result: false };</span>
<a href="#l45.17"></a><span id="l45.17" class="difflineplus">+  let args = { identity, account: gAccount, result: false };</span>
<a href="#l45.18"></a><span id="l45.18"> </span>
<a href="#l45.19"></a><span id="l45.19">   let indexToSelect = identity ? gIdentityListBox.selectedIndex :</span>
<a href="#l45.20"></a><span id="l45.20">                                  gIdentityListBox.itemCount;</span>
<a href="#l45.21"></a><span id="l45.21"> </span>
<a href="#l45.22"></a><span id="l45.22">   window.openDialog(&quot;am-identity-edit.xul&quot;, &quot;&quot;,</span>
<a href="#l45.23"></a><span id="l45.23">                     &quot;chrome,modal,resizable,centerscreen&quot;, args);</span>
<a href="#l45.24"></a><span id="l45.24"> </span>
<a href="#l45.25"></a><span id="l45.25">   if (args.result)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identities-list.xul</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identities-list.xul</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l46.4"></a><span id="l46.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l46.5"></a><span id="l46.5" class="difflineplus">+</span>
<a href="#l46.6"></a><span id="l46.6" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l46.7"></a><span id="l46.7" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l46.8"></a><span id="l46.8" class="difflineplus">+</span>
<a href="#l46.9"></a><span id="l46.9"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l46.10"></a><span id="l46.10">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l46.11"></a><span id="l46.11">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l46.12"></a><span id="l46.12"> </span>
<a href="#l46.13"></a><span id="l46.13" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineminus">-</span>
<a href="#l46.16"></a><span id="l46.16"> &lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/am-identities-list.dtd&quot;&gt;</span>
<a href="#l46.17"></a><span id="l46.17"> </span>
<a href="#l46.18"></a><span id="l46.18"> &lt;dialog</span>
<a href="#l46.19"></a><span id="l46.19">   xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l46.20"></a><span id="l46.20">   onload=&quot;onLoad();&quot;</span>
<a href="#l46.21"></a><span id="l46.21">   buttons=&quot;accept&quot;</span>
<a href="#l46.22"></a><span id="l46.22">   buttonlabelaccept=&quot;&amp;identitiesListClose.label;&quot;</span>
<a href="#l46.23"></a><span id="l46.23">   buttonaccesskeyaccept=&quot;&amp;identitiesListClose.accesskey;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identity-edit.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identity-edit.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -15,19 +15,26 @@ var gAccount = null;   // the account th</span>
<a href="#l47.4"></a><span id="l47.4"> document.addEventListener(&quot;dialogaccept&quot;, onOk);</span>
<a href="#l47.5"></a><span id="l47.5"> </span>
<a href="#l47.6"></a><span id="l47.6"> function onLoadIdentityProperties() {</span>
<a href="#l47.7"></a><span id="l47.7">   // extract the account</span>
<a href="#l47.8"></a><span id="l47.8">   gIdentity = window.arguments[0].identity;</span>
<a href="#l47.9"></a><span id="l47.9">   gAccount = window.arguments[0].account;</span>
<a href="#l47.10"></a><span id="l47.10">   let prefBundle = document.getElementById(&quot;bundle_prefs&quot;);</span>
<a href="#l47.11"></a><span id="l47.11"> </span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  // Make the dialog the same height and width of the main Account manager page.</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineminus">-  document.documentElement.style.width = window.arguments[0].width + &quot;px&quot;;</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineminus">-  document.documentElement.style.height = window.arguments[0].height + &quot;px&quot;;</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineplus">+  // Make the dialog the same height and 90% of the width of the main Account</span>
<a href="#l47.16"></a><span id="l47.16" class="difflineplus">+  // manager page when the Account manager is not maximized.</span>
<a href="#l47.17"></a><span id="l47.17" class="difflineplus">+  let accountDialog = Services.wm.getMostRecentWindow(&quot;mailnews:accountmanager&quot;)</span>
<a href="#l47.18"></a><span id="l47.18" class="difflineplus">+                              .document;</span>
<a href="#l47.19"></a><span id="l47.19" class="difflineplus">+  if (accountDialog.documentElement.getAttribute(&quot;sizemode&quot;) != &quot;maximized&quot;) {</span>
<a href="#l47.20"></a><span id="l47.20" class="difflineplus">+    document.getElementById(&quot;identityDialog&quot;).style.width =</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineplus">+      accountDialog.getElementById(&quot;accountManager&quot;).clientWidth * 0.9 + &quot;px&quot;;</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineplus">+    document.getElementById(&quot;identityDialog&quot;).style.height =</span>
<a href="#l47.23"></a><span id="l47.23" class="difflineplus">+      accountDialog.getElementById(&quot;accountManager&quot;).clientHeight + &quot;px&quot;;</span>
<a href="#l47.24"></a><span id="l47.24" class="difflineplus">+  }</span>
<a href="#l47.25"></a><span id="l47.25"> </span>
<a href="#l47.26"></a><span id="l47.26">   if (gIdentity) {</span>
<a href="#l47.27"></a><span id="l47.27">     let listName = gIdentity.identityName;</span>
<a href="#l47.28"></a><span id="l47.28">     document.title = prefBundle</span>
<a href="#l47.29"></a><span id="l47.29">                      .getFormattedString(&quot;identityDialogTitleEdit&quot;, [listName]);</span>
<a href="#l47.30"></a><span id="l47.30">   } else {</span>
<a href="#l47.31"></a><span id="l47.31">     document.title = prefBundle.getString(&quot;identityDialogTitleAdd&quot;);</span>
<a href="#l47.32"></a><span id="l47.32">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identity-edit.xul</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identity-edit.xul</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -1,15 +1,13 @@</span>
<a href="#l48.4"></a><span id="l48.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l48.5"></a><span id="l48.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l48.6"></a><span id="l48.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l48.7"></a><span id="l48.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l48.8"></a><span id="l48.8"> </span>
<a href="#l48.9"></a><span id="l48.9" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l48.10"></a><span id="l48.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l48.11"></a><span id="l48.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l48.12"></a><span id="l48.12"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderMenus.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l48.13"></a><span id="l48.13"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l48.14"></a><span id="l48.14"> </span>
<a href="#l48.15"></a><span id="l48.15"> &lt;!DOCTYPE dialog [</span>
<a href="#l48.16"></a><span id="l48.16"> &lt;!ENTITY % identityEditDTD SYSTEM &quot;chrome://messenger/locale/am-identity-edit.dtd&quot; &gt;</span>
<a href="#l48.17"></a><span id="l48.17"> %identityEditDTD;</span>
<a href="#l48.18"></a><span id="l48.18"> &lt;!ENTITY % identityDTD SYSTEM &quot;chrome://messenger/locale/am-main.dtd&quot; &gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-junk.xul</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-junk.xul</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l49.4"></a><span id="l49.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l49.5"></a><span id="l49.5" class="difflineplus">+</span>
<a href="#l49.6"></a><span id="l49.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l49.7"></a><span id="l49.7">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l49.8"></a><span id="l49.8" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l49.9"></a><span id="l49.9" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l49.10"></a><span id="l49.10" class="difflineplus">+--&gt;</span>
<a href="#l49.11"></a><span id="l49.11"> </span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l49.14"></a><span id="l49.14"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l49.16"></a><span id="l49.16"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderMenus.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l49.17"></a><span id="l49.17"> </span>
<a href="#l49.18"></a><span id="l49.18"> &lt;!DOCTYPE window [</span>
<a href="#l49.19"></a><span id="l49.19"> &lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot;&gt;</span>
<a href="#l49.20"></a><span id="l49.20"> %brandDTD;</span>
<a href="#l49.21"></a><span id="l49.21"> &lt;!ENTITY % junkMailDTD SYSTEM &quot;chrome://messenger/locale/am-junk.dtd&quot;&gt;</span>
<a href="#l49.22"></a><span id="l49.22"> %junkMailDTD;</span>
<a href="#l49.23"></a><span id="l49.23"> ]&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-main.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-main.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -24,35 +24,27 @@ function onInit(aPageId, aServerId) {</span>
<a href="#l50.4"></a><span id="l50.4">   setupSignatureItems();</span>
<a href="#l50.5"></a><span id="l50.5"> }</span>
<a href="#l50.6"></a><span id="l50.6"> </span>
<a href="#l50.7"></a><span id="l50.7"> function onPreInit(account, accountValues) {</span>
<a href="#l50.8"></a><span id="l50.8">   gAccount = account;</span>
<a href="#l50.9"></a><span id="l50.9">   loadSMTPServerList();</span>
<a href="#l50.10"></a><span id="l50.10"> }</span>
<a href="#l50.11"></a><span id="l50.11"> </span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-function onLeave(restoreValuesOnFailure) {</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineminus">-  return top.checkAccountNameIsValid(restoreValuesOnFailure);</span>
<a href="#l50.14"></a><span id="l50.14" class="difflineminus">-}</span>
<a href="#l50.15"></a><span id="l50.15" class="difflineminus">-</span>
<a href="#l50.16"></a><span id="l50.16"> function manageIdentities() {</span>
<a href="#l50.17"></a><span id="l50.17">   // We want to save the current identity information before bringing up the multiple identities</span>
<a href="#l50.18"></a><span id="l50.18">   // UI. This ensures that the changes are reflected in the identity list dialog</span>
<a href="#l50.19"></a><span id="l50.19">   // onSave();</span>
<a href="#l50.20"></a><span id="l50.20"> </span>
<a href="#l50.21"></a><span id="l50.21">   if (!gAccount)</span>
<a href="#l50.22"></a><span id="l50.22">     return;</span>
<a href="#l50.23"></a><span id="l50.23"> </span>
<a href="#l50.24"></a><span id="l50.24">   var accountName = document.getElementById(&quot;server.prettyName&quot;).value;</span>
<a href="#l50.25"></a><span id="l50.25"> </span>
<a href="#l50.26"></a><span id="l50.26" class="difflineminus">-  var args = { account: gAccount,</span>
<a href="#l50.27"></a><span id="l50.27" class="difflineminus">-               accountName,</span>
<a href="#l50.28"></a><span id="l50.28" class="difflineminus">-               width: document.documentElement.clientWidth,</span>
<a href="#l50.29"></a><span id="l50.29" class="difflineminus">-               height: document.documentElement.clientHeight,</span>
<a href="#l50.30"></a><span id="l50.30" class="difflineminus">-               result: false };</span>
<a href="#l50.31"></a><span id="l50.31" class="difflineplus">+  var args = { account: gAccount, accountName, result: false };</span>
<a href="#l50.32"></a><span id="l50.32"> </span>
<a href="#l50.33"></a><span id="l50.33">   // save the current identity settings so they show up correctly</span>
<a href="#l50.34"></a><span id="l50.34">   // if the user just changed them in the manage identities dialog</span>
<a href="#l50.35"></a><span id="l50.35">   var identity = gAccount.defaultIdentity;</span>
<a href="#l50.36"></a><span id="l50.36">   saveIdentitySettings(identity);</span>
<a href="#l50.37"></a><span id="l50.37"> </span>
<a href="#l50.38"></a><span id="l50.38">   window.openDialog(&quot;am-identities-list.xul&quot;, &quot;&quot;, &quot;chrome,modal,resizable=no,centerscreen&quot;, args);</span>
<a href="#l50.39"></a><span id="l50.39"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-main.xul</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-main.xul</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -1,18 +1,17 @@</span>
<a href="#l51.4"></a><span id="l51.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l51.5"></a><span id="l51.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l51.6"></a><span id="l51.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l51.7"></a><span id="l51.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l51.8"></a><span id="l51.8"> </span>
<a href="#l51.9"></a><span id="l51.9" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l51.10"></a><span id="l51.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l51.11"></a><span id="l51.11" class="difflineplus">+</span>
<a href="#l51.12"></a><span id="l51.12"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l51.13"></a><span id="l51.13"> </span>
<a href="#l51.14"></a><span id="l51.14" class="difflineminus">-&lt;!DOCTYPE page SYSTEM &quot;chrome://messenger/locale/am-main.dtd&quot;&gt;</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineplus">+&lt;!DOCTYPE page SYSTEM &quot;chrome://messenger/locale/am-main.dtd&quot; &gt;</span>
<a href="#l51.16"></a><span id="l51.16"> </span>
<a href="#l51.17"></a><span id="l51.17"> &lt;page xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l51.18"></a><span id="l51.18">       xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l51.19"></a><span id="l51.19">       onload=&quot;parent.onPanelLoaded('am-main.xul');&quot;&gt;</span>
<a href="#l51.20"></a><span id="l51.20"> </span>
<a href="#l51.21"></a><span id="l51.21">   &lt;vbox flex=&quot;1&quot; style=&quot;overflow: auto;&quot;&gt;</span>
<a href="#l51.22"></a><span id="l51.22">     &lt;stringbundle id=&quot;bundle_prefs&quot; src=&quot;chrome://messenger/locale/prefs.properties&quot;/&gt;</span>
<a href="#l51.23"></a><span id="l51.23">     &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-offline.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-offline.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -199,17 +199,17 @@ function onCancel() {</span>
<a href="#l52.4"></a><span id="l52.4">   // restore the offline flags for all folders</span>
<a href="#l52.5"></a><span id="l52.5">   restoreOfflineFolders(gOfflineMap);</span>
<a href="#l52.6"></a><span id="l52.6">   document.getElementById(&quot;offline.folders&quot;).checked = gOfflineFolders;</span>
<a href="#l52.7"></a><span id="l52.7"> }</span>
<a href="#l52.8"></a><span id="l52.8"> </span>
<a href="#l52.9"></a><span id="l52.9"> /**</span>
<a href="#l52.10"></a><span id="l52.10">  * Prompt to avoid unexpected folder sync changes.</span>
<a href="#l52.11"></a><span id="l52.11">  */</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-function onLeave(restoreValuesOnFailure) {</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+function onLeave() {</span>
<a href="#l52.14"></a><span id="l52.14">   let changed = false;</span>
<a href="#l52.15"></a><span id="l52.15">   if (gToggleOccurred) {</span>
<a href="#l52.16"></a><span id="l52.16">     let allFolders = gIncomingServer.rootFolder.descendants;</span>
<a href="#l52.17"></a><span id="l52.17">     for (let folder of fixIterator(allFolders, Ci.nsIMsgFolder)) {</span>
<a href="#l52.18"></a><span id="l52.18">       if (gOfflineMap[folder.folderURL] !=</span>
<a href="#l52.19"></a><span id="l52.19">           folder.getFlag(Ci.nsMsgFolderFlags.Offline)) {</span>
<a href="#l52.20"></a><span id="l52.20">         // A change to the Offline flag to a folder was made.</span>
<a href="#l52.21"></a><span id="l52.21">         changed = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-offline.xul</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-offline.xul</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -1,15 +1,13 @@</span>
<a href="#l53.4"></a><span id="l53.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l53.5"></a><span id="l53.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l53.6"></a><span id="l53.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l53.7"></a><span id="l53.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l53.8"></a><span id="l53.8"> </span>
<a href="#l53.9"></a><span id="l53.9" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l53.10"></a><span id="l53.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l53.11"></a><span id="l53.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l53.12"></a><span id="l53.12"> </span>
<a href="#l53.13"></a><span id="l53.13"> &lt;!DOCTYPE page SYSTEM &quot;chrome://messenger/locale/am-offline.dtd&quot;&gt;</span>
<a href="#l53.14"></a><span id="l53.14"> </span>
<a href="#l53.15"></a><span id="l53.15"> &lt;page xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l53.16"></a><span id="l53.16">       onload=&quot;parent.onPanelLoaded('am-offline.xul');&quot;&gt;</span>
<a href="#l53.17"></a><span id="l53.17"> </span>
<a href="#l53.18"></a><span id="l53.18">   &lt;vbox flex=&quot;1&quot; style=&quot;overflow: auto;&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server-advanced.xul</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server-advanced.xul</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l54.4"></a><span id="l54.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l54.5"></a><span id="l54.5" class="difflineplus">+</span>
<a href="#l54.6"></a><span id="l54.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l54.7"></a><span id="l54.7">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l54.8"></a><span id="l54.8">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l54.9"></a><span id="l54.9"> </span>
<a href="#l54.10"></a><span id="l54.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l54.11"></a><span id="l54.11" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l54.13"></a><span id="l54.13"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l54.14"></a><span id="l54.14" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l54.15"></a><span id="l54.15"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderMenus.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l54.16"></a><span id="l54.16"> </span>
<a href="#l54.17"></a><span id="l54.17"> &lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/am-server-advanced.dtd&quot;&gt;</span>
<a href="#l54.18"></a><span id="l54.18"> </span>
<a href="#l54.19"></a><span id="l54.19"> &lt;dialog</span>
<a href="#l54.20"></a><span id="l54.20">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l54.21"></a><span id="l54.21">         title=&quot;&amp;serverAdvanced.label;&quot;</span>
<a href="#l54.22"></a><span id="l54.22">         buttons=&quot;accept,cancel&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -115,21 +115,16 @@ function onPreInit(account, accountValue</span>
<a href="#l55.4"></a><span id="l55.4">   gServer = account.incomingServer;</span>
<a href="#l55.5"></a><span id="l55.5"> </span>
<a href="#l55.6"></a><span id="l55.6">   if (!account.incomingServer.canEmptyTrashOnExit) {</span>
<a href="#l55.7"></a><span id="l55.7">     document.getElementById(&quot;server.emptyTrashOnExit&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l55.8"></a><span id="l55.8">     document.getElementById(&quot;imap.deleteModel.box&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l55.9"></a><span id="l55.9">   }</span>
<a href="#l55.10"></a><span id="l55.10"> }</span>
<a href="#l55.11"></a><span id="l55.11"> </span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-function onLeave(restoreValuesOnFailure) {</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineminus">-  return (top.checkUserServerChanges(restoreValuesOnFailure) &amp;&amp;</span>
<a href="#l55.14"></a><span id="l55.14" class="difflineminus">-          top.checkLocalPathChanges(restoreValuesOnFailure));</span>
<a href="#l55.15"></a><span id="l55.15" class="difflineminus">-}</span>
<a href="#l55.16"></a><span id="l55.16" class="difflineminus">-</span>
<a href="#l55.17"></a><span id="l55.17"> function initServerType() {</span>
<a href="#l55.18"></a><span id="l55.18">   var serverType = document.getElementById(&quot;server.type&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l55.19"></a><span id="l55.19">   var propertyName = &quot;serverType-&quot; + serverType;</span>
<a href="#l55.20"></a><span id="l55.20"> </span>
<a href="#l55.21"></a><span id="l55.21">   var messengerBundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l55.22"></a><span id="l55.22">   var verboseName = messengerBundle.getString(propertyName);</span>
<a href="#l55.23"></a><span id="l55.23">   setDivText(&quot;servertype.verbose&quot;, verboseName);</span>
<a href="#l55.24"></a><span id="l55.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server.xul</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server.xul</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -1,16 +1,15 @@</span>
<a href="#l56.4"></a><span id="l56.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l56.5"></a><span id="l56.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l56.6"></a><span id="l56.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l56.7"></a><span id="l56.7">    - file, You can obtain one at https://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l56.8"></a><span id="l56.8"> </span>
<a href="#l56.9"></a><span id="l56.9" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l56.10"></a><span id="l56.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l56.11"></a><span id="l56.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l56.13"></a><span id="l56.13"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderMenus.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l56.14"></a><span id="l56.14"> &lt;?xml-stylesheet href=&quot;chrome://messenger/content/am-server.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l56.15"></a><span id="l56.15"> </span>
<a href="#l56.16"></a><span id="l56.16"> &lt;!DOCTYPE page [</span>
<a href="#l56.17"></a><span id="l56.17"> &lt;!ENTITY % trashDTD SYSTEM &quot;chrome://messenger/locale/am-server-top.dtd&quot;&gt;</span>
<a href="#l56.18"></a><span id="l56.18"> %trashDTD;</span>
<a href="#l56.19"></a><span id="l56.19"> ]&gt;</span>
<a href="#l56.20"></a><span id="l56.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-serverwithnoidentities.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-serverwithnoidentities.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -68,21 +68,16 @@ function onInit(aPageId, aServerId) {</span>
<a href="#l57.4"></a><span id="l57.4">   // Initialise 'gOriginalStoreType' to the item that was originally selected.</span>
<a href="#l57.5"></a><span id="l57.5">   gOriginalStoreType = storeTypeElement.value;</span>
<a href="#l57.6"></a><span id="l57.6"> }</span>
<a href="#l57.7"></a><span id="l57.7"> </span>
<a href="#l57.8"></a><span id="l57.8"> function onPreInit(account, accountValues) {</span>
<a href="#l57.9"></a><span id="l57.9">   gAccount = account;</span>
<a href="#l57.10"></a><span id="l57.10"> }</span>
<a href="#l57.11"></a><span id="l57.11"> </span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-function onLeave(restoreValuesOnFailure) {</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineminus">-  return (top.checkAccountNameIsValid(restoreValuesOnFailure) &amp;&amp;</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineminus">-          top.checkLocalPathChanges(restoreValuesOnFailure));</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineminus">-}</span>
<a href="#l57.16"></a><span id="l57.16" class="difflineminus">-</span>
<a href="#l57.17"></a><span id="l57.17"> function onSave() {</span>
<a href="#l57.18"></a><span id="l57.18">   let storeContractID = document.getElementById(&quot;server.storeTypeMenulist&quot;)</span>
<a href="#l57.19"></a><span id="l57.19">                                 .selectedItem</span>
<a href="#l57.20"></a><span id="l57.20">                                 .value;</span>
<a href="#l57.21"></a><span id="l57.21">   document.getElementById(&quot;server.storeContractID&quot;)</span>
<a href="#l57.22"></a><span id="l57.22">           .setAttribute(&quot;value&quot;, storeContractID);</span>
<a href="#l57.23"></a><span id="l57.23"> }</span>
<a href="#l57.24"></a><span id="l57.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-serverwithnoidentities.xul</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-serverwithnoidentities.xul</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l58.4"></a><span id="l58.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l58.5"></a><span id="l58.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l58.6"></a><span id="l58.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l58.7"></a><span id="l58.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l58.8"></a><span id="l58.8"> </span>
<a href="#l58.9"></a><span id="l58.9" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l58.10"></a><span id="l58.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l58.11"></a><span id="l58.11" class="difflineplus">+</span>
<a href="#l58.12"></a><span id="l58.12"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l58.13"></a><span id="l58.13"> </span>
<a href="#l58.14"></a><span id="l58.14"> &lt;!DOCTYPE page [</span>
<a href="#l58.15"></a><span id="l58.15"> &lt;!ENTITY % accountNoIdentDTD SYSTEM &quot;chrome://messenger/locale/am-serverwithnoidentities.dtd&quot; &gt;%accountNoIdentDTD;</span>
<a href="#l58.16"></a><span id="l58.16"> &lt;!ENTITY % accountServerTopDTD SYSTEM &quot;chrome://messenger/locale/am-server-top.dtd&quot;&gt;%accountServerTopDTD;</span>
<a href="#l58.17"></a><span id="l58.17"> ]&gt;</span>
<a href="#l58.18"></a><span id="l58.18"> </span>
<a href="#l58.19"></a><span id="l58.19"> &lt;page xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-smtp.xul</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-smtp.xul</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l59.4"></a><span id="l59.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l59.5"></a><span id="l59.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l59.6"></a><span id="l59.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l59.7"></a><span id="l59.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l59.8"></a><span id="l59.8"> </span>
<a href="#l59.9"></a><span id="l59.9" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l59.10"></a><span id="l59.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l59.11"></a><span id="l59.11" class="difflineplus">+</span>
<a href="#l59.12"></a><span id="l59.12"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l59.13"></a><span id="l59.13"> </span>
<a href="#l59.14"></a><span id="l59.14"> &lt;!DOCTYPE page SYSTEM &quot;chrome://messenger/locale/am-advanced.dtd&quot;&gt;</span>
<a href="#l59.15"></a><span id="l59.15"> </span>
<a href="#l59.16"></a><span id="l59.16"> &lt;page xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l59.17"></a><span id="l59.17">       title=&quot;&amp;smtpServer.label;&quot;</span>
<a href="#l59.18"></a><span id="l59.18">       onload=&quot;gSmtpServerListWindow.onLoad();&quot;&gt;</span>
<a href="#l59.19"></a><span id="l59.19">   &lt;script src=&quot;chrome://messenger/content/amUtils.js&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/extensions/mdn/content/am-mdn.xul</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/extensions/mdn/content/am-mdn.xul</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l60.4"></a><span id="l60.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l60.5"></a><span id="l60.5" class="difflineminus">-&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l60.6"></a><span id="l60.6" class="difflineplus">+</span>
<a href="#l60.7"></a><span id="l60.7" class="difflineplus">+&lt;!--</span>
<a href="#l60.8"></a><span id="l60.8" class="difflineplus">+</span>
<a href="#l60.9"></a><span id="l60.9" class="difflineplus">+ This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l60.10"></a><span id="l60.10">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l60.11"></a><span id="l60.11">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l60.12"></a><span id="l60.12"> </span>
<a href="#l60.13"></a><span id="l60.13" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l60.14"></a><span id="l60.14" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l60.15"></a><span id="l60.15"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l60.16"></a><span id="l60.16"> </span>
<a href="#l60.17"></a><span id="l60.17"> &lt;!DOCTYPE page SYSTEM &quot;chrome://messenger/locale/am-mdn.dtd&quot;&gt;</span>
<a href="#l60.18"></a><span id="l60.18"> </span>
<a href="#l60.19"></a><span id="l60.19"> &lt;page xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l60.20"></a><span id="l60.20">       title=&quot;&amp;pane.title;&quot;</span>
<a href="#l60.21"></a><span id="l60.21">       onload=&quot;parent.onPanelLoaded('am-mdn.xul');&quot;&gt;</span>
<a href="#l60.22"></a><span id="l60.22"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/am-newsblog.xul</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/am-newsblog.xul</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -1,15 +1,13 @@</span>
<a href="#l61.4"></a><span id="l61.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l61.5"></a><span id="l61.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l61.6"></a><span id="l61.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l61.7"></a><span id="l61.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l61.8"></a><span id="l61.8"> </span>
<a href="#l61.9"></a><span id="l61.9" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l61.10"></a><span id="l61.10" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot;?&gt;</span>
<a href="#l61.11"></a><span id="l61.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l61.12"></a><span id="l61.12"> &lt;?xml-stylesheet href=&quot;chrome://messenger-newsblog/skin/feed-subscriptions.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l61.13"></a><span id="l61.13"> </span>
<a href="#l61.14"></a><span id="l61.14"> &lt;!DOCTYPE page [</span>
<a href="#l61.15"></a><span id="l61.15"> &lt;!ENTITY %         newsblogDTD SYSTEM &quot;chrome://messenger-newsblog/locale/am-newsblog.dtd&quot; &gt;</span>
<a href="#l61.16"></a><span id="l61.16"> %newsblogDTD;</span>
<a href="#l61.17"></a><span id="l61.17"> &lt;!ENTITY %             feedDTD SYSTEM &quot;chrome://messenger-newsblog/locale/feed-subscriptions.dtd&quot; &gt;</span>
<a href="#l61.18"></a><span id="l61.18"> %feedDTD;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/extensions/smime/content/am-smime.inc.xul</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/am-smime.inc.xul</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -75,20 +75,18 @@</span>
<a href="#l62.4"></a><span id="l62.4"> </span>
<a href="#l62.5"></a><span id="l62.5">           &lt;radio id=&quot;encrypt_mail_always&quot; wsm_persist=&quot;true&quot; value=&quot;2&quot;</span>
<a href="#l62.6"></a><span id="l62.6">                  label=&quot;&amp;alwaysEncryptMessage.label;&quot;</span>
<a href="#l62.7"></a><span id="l62.7">                  accesskey=&quot;&amp;alwaysEncryptMessage.accesskey;&quot;/&gt;</span>
<a href="#l62.8"></a><span id="l62.8">         &lt;/radiogroup&gt;</span>
<a href="#l62.9"></a><span id="l62.9">       &lt;/groupbox&gt;</span>
<a href="#l62.10"></a><span id="l62.10"> </span>
<a href="#l62.11"></a><span id="l62.11">       &lt;!-- Certificate manager --&gt;</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-      &lt;groupbox id=&quot;smimeCertificateManager&quot;&gt;</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+      &lt;groupbox id=&quot;smimeCertificateManager&quot; orient=&quot;horizontal&quot;&gt;</span>
<a href="#l62.14"></a><span id="l62.14">         &lt;label class=&quot;header&quot;&gt;&amp;certificates.label;&lt;/label&gt;</span>
<a href="#l62.15"></a><span id="l62.15" class="difflineminus">-        &lt;hbox&gt;</span>
<a href="#l62.16"></a><span id="l62.16" class="difflineminus">-          &lt;button id=&quot;openCertManagerButton&quot; oncommand=&quot;openCertManager();&quot;</span>
<a href="#l62.17"></a><span id="l62.17" class="difflineminus">-                  label=&quot;&amp;manageCerts2.label;&quot; accesskey=&quot;&amp;manageCerts2.accesskey;&quot;</span>
<a href="#l62.18"></a><span id="l62.18" class="difflineminus">-                  prefstring=&quot;security.disable_button.openCertManager&quot;/&gt;</span>
<a href="#l62.19"></a><span id="l62.19" class="difflineminus">-          &lt;button id=&quot;openDeviceManagerButton&quot; oncommand=&quot;openDeviceManager();&quot;</span>
<a href="#l62.20"></a><span id="l62.20" class="difflineminus">-                  label=&quot;&amp;manageDevices.label;&quot; accesskey=&quot;&amp;manageDevices.accesskey;&quot;</span>
<a href="#l62.21"></a><span id="l62.21" class="difflineminus">-                  prefstring=&quot;security.disable_button.openDeviceManager&quot;/&gt;</span>
<a href="#l62.22"></a><span id="l62.22" class="difflineminus">-        &lt;/hbox&gt;</span>
<a href="#l62.23"></a><span id="l62.23" class="difflineplus">+        &lt;button id=&quot;openCertManagerButton&quot; oncommand=&quot;openCertManager();&quot;</span>
<a href="#l62.24"></a><span id="l62.24" class="difflineplus">+                label=&quot;&amp;manageCerts2.label;&quot; accesskey=&quot;&amp;manageCerts2.accesskey;&quot;</span>
<a href="#l62.25"></a><span id="l62.25" class="difflineplus">+                prefstring=&quot;security.disable_button.openCertManager&quot;/&gt;</span>
<a href="#l62.26"></a><span id="l62.26" class="difflineplus">+        &lt;button id=&quot;openDeviceManagerButton&quot; oncommand=&quot;openDeviceManager();&quot;</span>
<a href="#l62.27"></a><span id="l62.27" class="difflineplus">+                label=&quot;&amp;manageDevices.label;&quot; accesskey=&quot;&amp;manageDevices.accesskey;&quot;</span>
<a href="#l62.28"></a><span id="l62.28" class="difflineplus">+                prefstring=&quot;security.disable_button.openDeviceManager&quot;/&gt;</span>
<a href="#l62.29"></a><span id="l62.29">       &lt;/groupbox&gt;</span>
<a href="#l62.30"></a><span id="l62.30">     &lt;/vbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/jar.mn</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/jar.mn</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -10,19 +10,17 @@ messenger.jar:</span>
<a href="#l63.4"></a><span id="l63.4">     content/messenger/addressbook/abAddressBookNameDialog.js                   (addrbook/content/abAddressBookNameDialog.js)</span>
<a href="#l63.5"></a><span id="l63.5">     content/messenger/addressbook/abAddressBookNameDialog.xul                  (addrbook/content/abAddressBookNameDialog.xul)</span>
<a href="#l63.6"></a><span id="l63.6">     content/messenger/addressbook/abResultsPane.js                             (addrbook/content/abResultsPane.js)</span>
<a href="#l63.7"></a><span id="l63.7">     content/messenger/addressbook/addrbookWidgets.xml                          (addrbook/content/addrbookWidgets.xml)</span>
<a href="#l63.8"></a><span id="l63.8">     content/messenger/addressbook/abDragDrop.js                                (addrbook/content/abDragDrop.js)</span>
<a href="#l63.9"></a><span id="l63.9">     content/messenger/addressbook/abMailListDialog.js                          (addrbook/content/abMailListDialog.js)</span>
<a href="#l63.10"></a><span id="l63.10">     content/messenger/addressbook/map-list.js                                  (addrbook/content/map-list.js)</span>
<a href="#l63.11"></a><span id="l63.11">     content/messagebody/addressbook/print.css                                  (addrbook/content/print.css)</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-#ifdef MOZ_SUITE</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineminus">-    content/messenger/AccountManager.xul                                       (base/prefs/content/AccountManager.xul)</span>
<a href="#l63.14"></a><span id="l63.14" class="difflineminus">-#endif</span>
<a href="#l63.15"></a><span id="l63.15" class="difflineplus">+*   content/messenger/AccountManager.xul                                       (base/prefs/content/AccountManager.xul)</span>
<a href="#l63.16"></a><span id="l63.16">     content/messenger/AccountManager.js                                        (base/prefs/content/AccountManager.js)</span>
<a href="#l63.17"></a><span id="l63.17">     content/messenger/am-main.xul                                              (base/prefs/content/am-main.xul)</span>
<a href="#l63.18"></a><span id="l63.18">     content/messenger/am-main.js                                               (base/prefs/content/am-main.js)</span>
<a href="#l63.19"></a><span id="l63.19"> #ifdef MOZ_SUITE</span>
<a href="#l63.20"></a><span id="l63.20">     content/messenger/am-help.js                                               (base/prefs/content/am-help.js)</span>
<a href="#l63.21"></a><span id="l63.21"> #endif</span>
<a href="#l63.22"></a><span id="l63.22">     content/messenger/am-server.xul                                            (base/prefs/content/am-server.xul)</span>
<a href="#l63.23"></a><span id="l63.23">     content/messenger/am-serverwithnoidentities.xul                            (base/prefs/content/am-serverwithnoidentities.xul)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

