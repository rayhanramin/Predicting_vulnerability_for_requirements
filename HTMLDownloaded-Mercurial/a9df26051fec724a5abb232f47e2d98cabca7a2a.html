<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27861:a9df26051fec724a5abb232f47e2d98cabca7a2a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a9df26051fec724a5abb232f47e2d98cabca7a2a" />
<meta property="og:url" content="/comm-central/rev/a9df26051fec724a5abb232f47e2d98cabca7a2a" />
<meta property="og:description" content="Bug 1562158 - Remove xpidl [array] use from nsIMsgTagService. r=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a9df26051fec724a5abb232f47e2d98cabca7a2a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a9df26051fec724a5abb232f47e2d98cabca7a2a">shortlog</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a9df26051fec724a5abb232f47e2d98cabca7a2a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a">files</a> |
changeset |
<a href="/comm-central/raw-rev/a9df26051fec724a5abb232f47e2d98cabca7a2a">raw</a>  | <a href="/comm-central/archive/a9df26051fec724a5abb232f47e2d98cabca7a2a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1562158">Bug 1562158</a> - Remove xpidl [array] use from nsIMsgTagService. r=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#66;&#101;&#110;&#32;&#67;&#97;&#109;&#112;&#98;&#101;&#108;&#108;&#32;&#60;&#98;&#101;&#110;&#99;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 07 Oct 2019 10:30:15 +0200</td></tr>

<tr>
 <td>changeset 27861</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a9df26051fec724a5abb232f47e2d98cabca7a2a">a9df26051fec724a5abb232f47e2d98cabca7a2a</a></td>
</tr>



<tr>
<td>parent 27860</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/72b1cec1260e68511a8b99d0e72fd8b0cefd44dc">72b1cec1260e68511a8b99d0e72fd8b0cefd44dc</a>
</td>
</tr>

<tr>
<td>child 27862</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/471b8c1ca0f42fcf72ce060549f39c4b72ed5986">471b8c1ca0f42fcf72ce060549f39c4b72ed5986</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a9df26051fec724a5abb232f47e2d98cabca7a2a">16520</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 07 Oct 2019 09:27:27 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@bb1bd474fda9 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bb1bd474fda9e9c32990f9e86b28a36abb67e66a">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bb1bd474fda9e9c32990f9e86b28a36abb67e66a&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bb1bd474fda9e9c32990f9e86b28a36abb67e66a&newProject=comm-central&newRevision=a9df26051fec724a5abb232f47e2d98cabca7a2a&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bb1bd474fda9e9c32990f9e86b28a36abb67e66a&newProject=comm-central&newRevision=a9df26051fec724a5abb232f47e2d98cabca7a2a&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bb1bd474fda9e9c32990f9e86b28a36abb67e66a&newProject=comm-central&newRevision=a9df26051fec724a5abb232f47e2d98cabca7a2a&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1562158">1562158</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1562158">Bug 1562158</a> - Remove xpidl [array] use from nsIMsgTagService. r=jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/msgHdrView.js">mail/base/content/msgHdrView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/msgHdrView.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/msgHdrView.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/msgHdrView.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/msgHdrView.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/msgHdrView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/multimessageview.js">mail/base/content/multimessageview.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/multimessageview.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/multimessageview.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/multimessageview.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/multimessageview.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/content/multimessageview.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/QuickFilterManager.jsm">mail/base/modules/QuickFilterManager.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/QuickFilterManager.jsm">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/QuickFilterManager.jsm">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/QuickFilterManager.jsm">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/QuickFilterManager.jsm">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/QuickFilterManager.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/TagUtils.jsm">mail/base/modules/TagUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/TagUtils.jsm">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/TagUtils.jsm">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/TagUtils.jsm">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/TagUtils.jsm">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/base/modules/TagUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-mailTabs.js">mail/components/extensions/parent/ext-mailTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-mailTabs.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-mailTabs.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-mailTabs.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-mailTabs.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-mailTabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-messages.js">mail/components/extensions/parent/ext-messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-messages.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-messages.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-messages.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-messages.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/extensions/parent/ext-messages.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/preferences/general.js">mail/components/preferences/general.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/preferences/general.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/preferences/general.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/preferences/general.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/preferences/general.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/components/preferences/general.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/extensions/mailviews/content/msgViewPickerOverlay.js">mail/extensions/mailviews/content/msgViewPickerOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/extensions/mailviews/content/msgViewPickerOverlay.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/extensions/mailviews/content/msgViewPickerOverlay.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/extensions/mailviews/content/msgViewPickerOverlay.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/extensions/mailviews/content/msgViewPickerOverlay.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/extensions/mailviews/content/msgViewPickerOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/test/mozmill/folder-display/test-message-commands.js">mail/test/mozmill/folder-display/test-message-commands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/test/mozmill/folder-display/test-message-commands.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/test/mozmill/folder-display/test-message-commands.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/test/mozmill/folder-display/test-message-commands.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/test/mozmill/folder-display/test-message-commands.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mail/test/mozmill/folder-display/test-message-commands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/public/nsIMsgTagService.idl">mailnews/base/public/nsIMsgTagService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/public/nsIMsgTagService.idl">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/public/nsIMsgTagService.idl">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/public/nsIMsgTagService.idl">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/public/nsIMsgTagService.idl">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/public/nsIMsgTagService.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/search/content/searchWidgets.js">mailnews/base/search/content/searchWidgets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/search/content/searchWidgets.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/search/content/searchWidgets.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/search/content/searchWidgets.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/search/content/searchWidgets.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/search/content/searchWidgets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgTagService.cpp">mailnews/base/src/nsMsgTagService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgTagService.cpp">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgTagService.cpp">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgTagService.cpp">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgTagService.cpp">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/src/nsMsgTagService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_nsIMsgTagService.js">mailnews/base/test/unit/test_nsIMsgTagService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_nsIMsgTagService.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_nsIMsgTagService.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_nsIMsgTagService.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_nsIMsgTagService.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_nsIMsgTagService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_searchTag.js">mailnews/base/test/unit/test_searchTag.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_searchTag.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_searchTag.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_searchTag.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_searchTag.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/base/test/unit/test_searchTag.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/db/gloda/modules/noun_tag.js">mailnews/db/gloda/modules/noun_tag.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/db/gloda/modules/noun_tag.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/db/gloda/modules/noun_tag.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/db/gloda/modules/noun_tag.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/db/gloda/modules/noun_tag.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/mailnews/db/gloda/modules/noun_tag.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/components/prefs/content/pref-tags.js">suite/mailnews/components/prefs/content/pref-tags.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/components/prefs/content/pref-tags.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/components/prefs/content/pref-tags.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/components/prefs/content/pref-tags.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/components/prefs/content/pref-tags.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/components/prefs/content/pref-tags.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWidgets.xml">suite/mailnews/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWindowOverlay.js">suite/mailnews/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgHdrViewOverlay.js">suite/mailnews/content/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgViewPickerOverlay.js">suite/mailnews/content/msgViewPickerOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgViewPickerOverlay.js">file</a> |
<a href="/comm-central/annotate/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgViewPickerOverlay.js">annotate</a> |
<a href="/comm-central/diff/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgViewPickerOverlay.js">diff</a> |
<a href="/comm-central/comparison/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgViewPickerOverlay.js">comparison</a> |
<a href="/comm-central/log/a9df26051fec724a5abb232f47e2d98cabca7a2a/suite/mailnews/content/msgViewPickerOverlay.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1153,17 +1153,17 @@ function SetGetMsgButtonTooltip() {</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> function RemoveAllMessageTags() {</span>
<a href="#l1.6"></a><span id="l1.6">   var selectedMessages = gFolderDisplay.selectedMessages;</span>
<a href="#l1.7"></a><span id="l1.7">   if (!selectedMessages.length) {</span>
<a href="#l1.8"></a><span id="l1.8">     return;</span>
<a href="#l1.9"></a><span id="l1.9">   }</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">   var messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  let tagArray = MailServices.tags.getAllTags();</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15">   var allKeys = &quot;&quot;;</span>
<a href="#l1.16"></a><span id="l1.16">   for (var j = 0; j &lt; tagArray.length; ++j) {</span>
<a href="#l1.17"></a><span id="l1.17">     if (j) {</span>
<a href="#l1.18"></a><span id="l1.18">       allKeys += &quot; &quot;;</span>
<a href="#l1.19"></a><span id="l1.19">     }</span>
<a href="#l1.20"></a><span id="l1.20">     allKeys += tagArray[j].key;</span>
<a href="#l1.21"></a><span id="l1.21">   }</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -1201,17 +1201,17 @@ function RemoveAllMessageTags() {</span>
<a href="#l1.23"></a><span id="l1.23">  * @param keyNumber the number (1 through 9) associated with the tag</span>
<a href="#l1.24"></a><span id="l1.24">  */</span>
<a href="#l1.25"></a><span id="l1.25"> function ToggleMessageTagKey(keyNumber) {</span>
<a href="#l1.26"></a><span id="l1.26">   let msgHdr = gFolderDisplay.selectedMessage;</span>
<a href="#l1.27"></a><span id="l1.27">   if (!msgHdr) {</span>
<a href="#l1.28"></a><span id="l1.28">     return;</span>
<a href="#l1.29"></a><span id="l1.29">   }</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-  let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+  let tagArray = MailServices.tags.getAllTags();</span>
<a href="#l1.33"></a><span id="l1.33">   if (keyNumber &gt; tagArray.length) {</span>
<a href="#l1.34"></a><span id="l1.34">     return;</span>
<a href="#l1.35"></a><span id="l1.35">   }</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37">   let key = tagArray[keyNumber - 1].key;</span>
<a href="#l1.38"></a><span id="l1.38">   let curKeys = msgHdr.getStringProperty(&quot;keywords&quot;).split(&quot; &quot;);</span>
<a href="#l1.39"></a><span id="l1.39">   if (msgHdr.label) {</span>
<a href="#l1.40"></a><span id="l1.40">     curKeys.push(&quot;$label&quot; + msgHdr.label);</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineat">@@ -1310,17 +1310,17 @@ function SetMessageTagLabel(menuitem, in</span>
<a href="#l1.42"></a><span id="l1.42">  * Refresh the contents of the tag popup menu/panel.</span>
<a href="#l1.43"></a><span id="l1.43">  * Used for example for appmenu/Message/Tag panel.</span>
<a href="#l1.44"></a><span id="l1.44">  *</span>
<a href="#l1.45"></a><span id="l1.45">  * @param {Element} parent          Parent element that will contain the menu items.</span>
<a href="#l1.46"></a><span id="l1.46">  * @param {string} [elementName]    Type of menu item, e.g. &quot;menuitem&quot;, &quot;toolbarbutton&quot;.</span>
<a href="#l1.47"></a><span id="l1.47">  * @param {string} [classes]        Classes to set on the menu items.</span>
<a href="#l1.48"></a><span id="l1.48">  */</span>
<a href="#l1.49"></a><span id="l1.49"> function InitMessageTags(parent, elementName = &quot;menuitem&quot;, classes) {</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-  const tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+  const tagArray = MailServices.tags.getAllTags();</span>
<a href="#l1.52"></a><span id="l1.52">   const elementNameUpperCase = elementName.toUpperCase();</span>
<a href="#l1.53"></a><span id="l1.53"> </span>
<a href="#l1.54"></a><span id="l1.54">   // Remove any existing non-static items (clear tags list before rebuilding it).</span>
<a href="#l1.55"></a><span id="l1.55">   // There is a separator element above the dynamically added tag elements, so</span>
<a href="#l1.56"></a><span id="l1.56">   // remove dynamically added elements below the separator.</span>
<a href="#l1.57"></a><span id="l1.57">   while (parent.lastChild.tagName.toUpperCase() == elementNameUpperCase) {</span>
<a href="#l1.58"></a><span id="l1.58">     parent.lastChild.remove();</span>
<a href="#l1.59"></a><span id="l1.59">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/msgHdrView.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/msgHdrView.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -838,17 +838,17 @@ function SetTagHeader() {</span>
<a href="#l2.4"></a><span id="l2.4">   // It would be nice if we passed in the msgHdr from the back end.</span>
<a href="#l2.5"></a><span id="l2.5">   var msgHdr = gFolderDisplay.selectedMessage;</span>
<a href="#l2.6"></a><span id="l2.6">   if (!msgHdr) {</span>
<a href="#l2.7"></a><span id="l2.7">     // No msgHdr to add our tags to.</span>
<a href="#l2.8"></a><span id="l2.8">     return;</span>
<a href="#l2.9"></a><span id="l2.9">   }</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">   // get the list of known tags</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  var tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  var tagArray = MailServices.tags.getAllTags();</span>
<a href="#l2.14"></a><span id="l2.14">   var tagKeys = {};</span>
<a href="#l2.15"></a><span id="l2.15">   for (var tagInfo of tagArray) {</span>
<a href="#l2.16"></a><span id="l2.16">     if (tagInfo.tag) {</span>
<a href="#l2.17"></a><span id="l2.17">       tagKeys[tagInfo.key] = true;</span>
<a href="#l2.18"></a><span id="l2.18">     }</span>
<a href="#l2.19"></a><span id="l2.19">   }</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">   // extract the tag keys from the msgHdr</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/multimessageview.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/multimessageview.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -368,17 +368,17 @@ MultiMessageSummary.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4">    * messy work of understanding how tags are stored in nsIMsgDBHdrs.  It would</span>
<a href="#l3.5"></a><span id="l3.5">    * be a good candidate for a utility library.</span>
<a href="#l3.6"></a><span id="l3.6">    *</span>
<a href="#l3.7"></a><span id="l3.7">    * @param aMsgHdr The msgHdr whose tags we want.</span>
<a href="#l3.8"></a><span id="l3.8">    * @return An array of nsIMsgTag objects.</span>
<a href="#l3.9"></a><span id="l3.9">    */</span>
<a href="#l3.10"></a><span id="l3.10">   _getTagsForMsg(aMsgHdr) {</span>
<a href="#l3.11"></a><span id="l3.11">     let keywords = new Set(aMsgHdr.getStringProperty(&quot;keywords&quot;).split(&quot; &quot;));</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    let allTags = MailServices.tags.getAllTags({});</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    let allTags = MailServices.tags.getAllTags();</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15">     return allTags.filter(function(tag) {</span>
<a href="#l3.16"></a><span id="l3.16">       return keywords.has(tag.key);</span>
<a href="#l3.17"></a><span id="l3.17">     });</span>
<a href="#l3.18"></a><span id="l3.18">   },</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">   /**</span>
<a href="#l3.21"></a><span id="l3.21">    * Add a list of tags to a DOM node.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/modules/QuickFilterManager.jsm</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/modules/QuickFilterManager.jsm</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -802,17 +802,17 @@ var TagFacetingFilter = {</span>
<a href="#l4.4"></a><span id="l4.4">     // we are an async operation; if the user turned off the tag facet already,</span>
<a href="#l4.5"></a><span id="l4.5">     //  then leave that state intact...</span>
<a href="#l4.6"></a><span id="l4.6">     if (aCurState == null) {</span>
<a href="#l4.7"></a><span id="l4.7">       return [null, false, false];</span>
<a href="#l4.8"></a><span id="l4.8">     }</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">     // only propagate things that are actually tags though!</span>
<a href="#l4.11"></a><span id="l4.11">     let outKeyMap = { tags: {} };</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    let tags = MailServices.tags.getAllTags({});</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    let tags = MailServices.tags.getAllTags();</span>
<a href="#l4.14"></a><span id="l4.14">     let tagCount = tags.length;</span>
<a href="#l4.15"></a><span id="l4.15">     for (let iTag = 0; iTag &lt; tagCount; iTag++) {</span>
<a href="#l4.16"></a><span id="l4.16">       let tag = tags[iTag];</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">       if (tag.key in aKeywordMap) {</span>
<a href="#l4.19"></a><span id="l4.19">         outKeyMap.tags[tag.key] = aKeywordMap[tag.key];</span>
<a href="#l4.20"></a><span id="l4.20">       }</span>
<a href="#l4.21"></a><span id="l4.21">     }</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -919,17 +919,17 @@ var TagFacetingFilter = {</span>
<a href="#l4.23"></a><span id="l4.23">     // -- nuke existing exposed tags, but not the mode selector (which is first)</span>
<a href="#l4.24"></a><span id="l4.24">     while (tagbar.childNodes.length &gt; 1) {</span>
<a href="#l4.25"></a><span id="l4.25">       tagbar.lastChild.remove();</span>
<a href="#l4.26"></a><span id="l4.26">     }</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">     let addCount = 0;</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">     // -- create an element for each tag</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    let tags = MailServices.tags.getAllTags({});</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    let tags = MailServices.tags.getAllTags();</span>
<a href="#l4.33"></a><span id="l4.33">     let tagCount = tags.length;</span>
<a href="#l4.34"></a><span id="l4.34">     for (let iTag = 0; iTag &lt; tagCount; iTag++) {</span>
<a href="#l4.35"></a><span id="l4.35">       let tag = tags[iTag];</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37">       if (tag.key in keywordMap) {</span>
<a href="#l4.38"></a><span id="l4.38">         addCount++;</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40">         // Keep in mind that the XBL does not get built for dynamically created</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/modules/TagUtils.jsm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/modules/TagUtils.jsm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -13,17 +13,17 @@ var EXPORTED_SYMBOLS = [&quot;TagUtils&quot;];</span>
<a href="#l5.4"></a><span id="l5.4"> var TagUtils = {</span>
<a href="#l5.5"></a><span id="l5.5">   loadTagsIntoCSS,</span>
<a href="#l5.6"></a><span id="l5.6">   addTagToAllDocumentSheets,</span>
<a href="#l5.7"></a><span id="l5.7">   isColorContrastEnough,</span>
<a href="#l5.8"></a><span id="l5.8"> };</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10"> function loadTagsIntoCSS(aDocument) {</span>
<a href="#l5.11"></a><span id="l5.11">   let tagSheet = findTagColorSheet(aDocument);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  let tagArray = MailServices.tags.getAllTags();</span>
<a href="#l5.14"></a><span id="l5.14">   for (let tag of tagArray) {</span>
<a href="#l5.15"></a><span id="l5.15">     // tag.key is the internal key, like &quot;$label1&quot; for &quot;Important&quot;.</span>
<a href="#l5.16"></a><span id="l5.16">     // For user defined keys with non-ASCII characters, key is</span>
<a href="#l5.17"></a><span id="l5.17">     // the MUTF-7 encoded name.</span>
<a href="#l5.18"></a><span id="l5.18">     addTagToSheet(tag.key, tag.color, tagSheet);</span>
<a href="#l5.19"></a><span id="l5.19">   }</span>
<a href="#l5.20"></a><span id="l5.20"> }</span>
<a href="#l5.21"></a><span id="l5.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-mailTabs.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-mailTabs.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -322,17 +322,17 @@ this.mailTabs = class extends ExtensionA</span>
<a href="#l6.4"></a><span id="l6.4">             }</span>
<a href="#l6.5"></a><span id="l6.5">           }</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">           if (state.tags) {</span>
<a href="#l6.8"></a><span id="l6.8">             filterer.filterValues.tags = {</span>
<a href="#l6.9"></a><span id="l6.9">               mode: &quot;OR&quot;,</span>
<a href="#l6.10"></a><span id="l6.10">               tags: {},</span>
<a href="#l6.11"></a><span id="l6.11">             };</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-            for (let tag of MailServices.tags.getAllTags({})) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+            for (let tag of MailServices.tags.getAllTags()) {</span>
<a href="#l6.14"></a><span id="l6.14">               filterer.filterValues.tags[tag.key] = null;</span>
<a href="#l6.15"></a><span id="l6.15">             }</span>
<a href="#l6.16"></a><span id="l6.16">             if (typeof state.tags == &quot;object&quot;) {</span>
<a href="#l6.17"></a><span id="l6.17">               filterer.filterValues.tags.mode =</span>
<a href="#l6.18"></a><span id="l6.18">                 state.tags.mode == &quot;any&quot; ? &quot;OR&quot; : &quot;AND&quot;;</span>
<a href="#l6.19"></a><span id="l6.19">               for (let [key, value] of Object.entries(state.tags.tags)) {</span>
<a href="#l6.20"></a><span id="l6.20">                 filterer.filterValues.tags.tags[key] = value;</span>
<a href="#l6.21"></a><span id="l6.21">               }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-messages.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-messages.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -303,17 +303,17 @@ this.messages = class extends ExtensionA</span>
<a href="#l7.4"></a><span id="l7.4">           return new Promise(resolve =&gt; {</span>
<a href="#l7.5"></a><span id="l7.5">             let archiver = new MessageArchiver();</span>
<a href="#l7.6"></a><span id="l7.6">             archiver.oncomplete = resolve;</span>
<a href="#l7.7"></a><span id="l7.7">             archiver.archiveMessages(messages);</span>
<a href="#l7.8"></a><span id="l7.8">           });</span>
<a href="#l7.9"></a><span id="l7.9">         },</span>
<a href="#l7.10"></a><span id="l7.10">         async listTags() {</span>
<a href="#l7.11"></a><span id="l7.11">           return MailServices.tags</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-            .getAllTags({})</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+            .getAllTags()</span>
<a href="#l7.14"></a><span id="l7.14">             .map(({ key, tag, color, ordinal }) =&gt; {</span>
<a href="#l7.15"></a><span id="l7.15">               return {</span>
<a href="#l7.16"></a><span id="l7.16">                 key,</span>
<a href="#l7.17"></a><span id="l7.17">                 tag,</span>
<a href="#l7.18"></a><span id="l7.18">                 color,</span>
<a href="#l7.19"></a><span id="l7.19">                 ordinal,</span>
<a href="#l7.20"></a><span id="l7.20">               };</span>
<a href="#l7.21"></a><span id="l7.21">             });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/preferences/general.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/preferences/general.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1156,17 +1156,17 @@ var gGeneralPane = {</span>
<a href="#l8.4"></a><span id="l8.4">   // appends the tag to the tag list box</span>
<a href="#l8.5"></a><span id="l8.5">   appendTagItem(aTagName, aKey, aColor) {</span>
<a href="#l8.6"></a><span id="l8.6">     let item = this.mTagListBox.appendItem(aTagName, aKey);</span>
<a href="#l8.7"></a><span id="l8.7">     item.style.color = aColor;</span>
<a href="#l8.8"></a><span id="l8.8">     return item;</span>
<a href="#l8.9"></a><span id="l8.9">   },</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">   buildTagList() {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    let tagArray = MailServices.tags.getAllTags();</span>
<a href="#l8.14"></a><span id="l8.14">     for (let i = 0; i &lt; tagArray.length; ++i) {</span>
<a href="#l8.15"></a><span id="l8.15">       let taginfo = tagArray[i];</span>
<a href="#l8.16"></a><span id="l8.16">       this.appendTagItem(taginfo.tag, taginfo.key, taginfo.color);</span>
<a href="#l8.17"></a><span id="l8.17">     }</span>
<a href="#l8.18"></a><span id="l8.18">   },</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">   removeTag() {</span>
<a href="#l8.21"></a><span id="l8.21">     var index = this.mTagListBox.selectedIndex;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/extensions/mailviews/content/msgViewPickerOverlay.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/extensions/mailviews/content/msgViewPickerOverlay.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -260,17 +260,17 @@ function RefreshTagsPopup(parent, elemen</span>
<a href="#l9.4"></a><span id="l9.4">   }</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6">   // Create tag menu items.</span>
<a href="#l9.7"></a><span id="l9.7">   const currentTagKey =</span>
<a href="#l9.8"></a><span id="l9.8">     gFolderDisplay.view.mailViewIndex == kViewItemTags</span>
<a href="#l9.9"></a><span id="l9.9">       ? gFolderDisplay.view.mailViewData</span>
<a href="#l9.10"></a><span id="l9.10">       : &quot;&quot;;</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  const tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  const tagArray = MailServices.tags.getAllTags();</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15">   tagArray.forEach(tagInfo =&gt; {</span>
<a href="#l9.16"></a><span id="l9.16">     const item = document.createXULElement(elementName);</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">     item.setAttribute(&quot;label&quot;, tagInfo.tag);</span>
<a href="#l9.19"></a><span id="l9.19">     item.setAttribute(&quot;value&quot;, kViewTagMarker + tagInfo.key);</span>
<a href="#l9.20"></a><span id="l9.20">     item.setAttribute(&quot;type&quot;, &quot;radio&quot;);</span>
<a href="#l9.21"></a><span id="l9.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-message-commands.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-message-commands.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -70,17 +70,17 @@ var setupModule = function(module) {</span>
<a href="#l10.4"></a><span id="l10.4">   );</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">   // Create messages from 20 different months, which will mean 2 different</span>
<a href="#l10.7"></a><span id="l10.7">   // years as well.</span>
<a href="#l10.8"></a><span id="l10.8">   make_new_sets_in_folder(archiveSrcFolder, [</span>
<a href="#l10.9"></a><span id="l10.9">     { count: 20, age_incr: { weeks: 5 } },</span>
<a href="#l10.10"></a><span id="l10.10">   ]);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  tagArray = MailServices.tags.getAllTags();</span>
<a href="#l10.14"></a><span id="l10.14"> };</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> /**</span>
<a href="#l10.17"></a><span id="l10.17">  * Ensures that all messages have a particular read status</span>
<a href="#l10.18"></a><span id="l10.18">  * @param messages an array of nsIMsgDBHdrs to check</span>
<a href="#l10.19"></a><span id="l10.19">  * @param read true if the messages should be marked read, false otherwise</span>
<a href="#l10.20"></a><span id="l10.20">  */</span>
<a href="#l10.21"></a><span id="l10.21"> function check_read_status(messages, read) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgTagService.idl</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgTagService.idl</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -51,18 +51,17 @@ interface nsIMsgTagService : nsISupports</span>
<a href="#l11.4"></a><span id="l11.4">   ACString getColorForKey(in ACString key);</span>
<a href="#l11.5"></a><span id="l11.5">   AString getSelectorForKey(in ACString key);  // return wide string to avoid conversion</span>
<a href="#l11.6"></a><span id="l11.6">   void setColorForKey(in ACString key, in ACString color);</span>
<a href="#l11.7"></a><span id="l11.7">   ACString getOrdinalForKey(in ACString key);</span>
<a href="#l11.8"></a><span id="l11.8">   void setOrdinalForKey(in ACString key, in ACString ordinal);</span>
<a href="#l11.9"></a><span id="l11.9">   // delete a tag from the list of known tags (but not from any messages)</span>
<a href="#l11.10"></a><span id="l11.10">   void deleteKey(in ACString key);</span>
<a href="#l11.11"></a><span id="l11.11">   // get all known tags</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  void getAllTags(out unsigned long count,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-                  [retval, array, size_is(count)] out nsIMsgTag tagArray);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  Array&lt;nsIMsgTag&gt; getAllTags();</span>
<a href="#l11.15"></a><span id="l11.15">   /*</span>
<a href="#l11.16"></a><span id="l11.16">    * Determines if the token in aKey corresponds to a current valid tag</span>
<a href="#l11.17"></a><span id="l11.17">    *</span>
<a href="#l11.18"></a><span id="l11.18">    * @param aKey        The string to test</span>
<a href="#l11.19"></a><span id="l11.19">    * @return            True if aKey is a current token</span>
<a href="#l11.20"></a><span id="l11.20">    */</span>
<a href="#l11.21"></a><span id="l11.21">   boolean isValidKey(in ACString aKey);</span>
<a href="#l11.22"></a><span id="l11.22"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/search/content/searchWidgets.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/search/content/searchWidgets.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -33,17 +33,17 @@</span>
<a href="#l12.4"></a><span id="l12.4">     connectedCallback() {</span>
<a href="#l12.5"></a><span id="l12.5">       const menulist = document.createXULElement(&quot;menulist&quot;);</span>
<a href="#l12.6"></a><span id="l12.6">       const menuPopup = document.createXULElement(&quot;menupopup&quot;);</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8">       menulist.classList.add(&quot;ruleactionitem&quot;);</span>
<a href="#l12.9"></a><span id="l12.9">       menulist.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l12.10"></a><span id="l12.10">       menulist.appendChild(menuPopup);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-      for (let taginfo of MailServices.tags.getAllTags({})) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+      for (let taginfo of MailServices.tags.getAllTags()) {</span>
<a href="#l12.14"></a><span id="l12.14">         const newMenuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.15"></a><span id="l12.15">         newMenuItem.setAttribute(&quot;label&quot;, taginfo.tag);</span>
<a href="#l12.16"></a><span id="l12.16">         newMenuItem.setAttribute(&quot;value&quot;, taginfo.key);</span>
<a href="#l12.17"></a><span id="l12.17">         menuPopup.appendChild(newMenuItem);</span>
<a href="#l12.18"></a><span id="l12.18">       }</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20">       this.appendChild(menulist);</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -1175,17 +1175,17 @@</span>
<a href="#l12.23"></a><span id="l12.23">       this.internalValue = searchValue;</span>
<a href="#l12.24"></a><span id="l12.24">       this.save();</span>
<a href="#l12.25"></a><span id="l12.25">     }</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">     fillInTags() {</span>
<a href="#l12.28"></a><span id="l12.28">       let menulist = this.childNodes[5];</span>
<a href="#l12.29"></a><span id="l12.29">       // Force initialization of the menulist custom element first.</span>
<a href="#l12.30"></a><span id="l12.30">       customElements.upgrade(menulist);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-      let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+      let tagArray = MailServices.tags.getAllTags();</span>
<a href="#l12.33"></a><span id="l12.33">       for (let i = 0; i &lt; tagArray.length; i++) {</span>
<a href="#l12.34"></a><span id="l12.34">         const taginfo = tagArray[i];</span>
<a href="#l12.35"></a><span id="l12.35">         const newMenuItem = menulist.appendItem(taginfo.tag, taginfo.key);</span>
<a href="#l12.36"></a><span id="l12.36">         if (i == 0) {</span>
<a href="#l12.37"></a><span id="l12.37">           menulist.selectedItem = newMenuItem;</span>
<a href="#l12.38"></a><span id="l12.38">         }</span>
<a href="#l12.39"></a><span id="l12.39">       }</span>
<a href="#l12.40"></a><span id="l12.40">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -4013,18 +4013,17 @@ void nsMsgDBView::PushSort(const MsgView</span>
<a href="#l13.4"></a><span id="l13.4">   // there). This code should behave the same way.</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6">   // We don't expect to be passed sort type ::byNone,</span>
<a href="#l13.7"></a><span id="l13.7">   // but if we are it's safe to ignore it.</span>
<a href="#l13.8"></a><span id="l13.8">   if (newSort.mSortType == nsMsgViewSortType::byNone) return;</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10">   // byId is a unique key (misnamed as Order Received). If we are sorting byId,</span>
<a href="#l13.11"></a><span id="l13.11">   // we don't need to keep any secondary sort keys.</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  if (newSort.mSortType == nsMsgViewSortType::byId)</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-    m_sortColumns.Clear();</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  if (newSort.mSortType == nsMsgViewSortType::byId) m_sortColumns.Clear();</span>
<a href="#l13.15"></a><span id="l13.15"> </span>
<a href="#l13.16"></a><span id="l13.16">   m_sortColumns.RemoveElement(newSort);</span>
<a href="#l13.17"></a><span id="l13.17">   m_sortColumns.InsertElementAt(0, newSort);</span>
<a href="#l13.18"></a><span id="l13.18">   if (m_sortColumns.Length() &gt; kMaxNumSortColumns)</span>
<a href="#l13.19"></a><span id="l13.19">     m_sortColumns.RemoveElementAt(kMaxNumSortColumns);</span>
<a href="#l13.20"></a><span id="l13.20"> }</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22"> nsresult nsMsgDBView::GetCollationKey(nsIMsgDBHdr *msgHdr,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -18,43 +18,45 @@</span>
<a href="#l14.4"></a><span id="l14.4"> #include &quot;nsMemory.h&quot;</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> #define STRLEN(s) (sizeof(s) - 1)</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> #define TAG_PREF_VERSION &quot;version&quot;</span>
<a href="#l14.9"></a><span id="l14.9"> #define TAG_PREF_SUFFIX_TAG &quot;.tag&quot;</span>
<a href="#l14.10"></a><span id="l14.10"> #define TAG_PREF_SUFFIX_COLOR &quot;.color&quot;</span>
<a href="#l14.11"></a><span id="l14.11"> #define TAG_PREF_SUFFIX_ORDINAL &quot;.ordinal&quot;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-#define TAG_CMP_LESSER -1</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-#define TAG_CMP_EQUAL 0</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-#define TAG_CMP_GREATER 1</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> static bool gMigratingKeys = false;</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-static int CompareMsgTags(const void *aTagPref1, const void *aTagPref2) {</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-  // Sort nsMsgTag objects by ascending order, using their ordinal or key.</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-  // The &quot;smallest&quot; value will be first in the sorted array,</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-  // thus being the most important element.</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-  nsMsgTag *element1 = *(nsMsgTag **)aTagPref1;</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-  nsMsgTag *element2 = *(nsMsgTag **)aTagPref2;</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+// Comparator to set sort order in GetAllTags().</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+struct CompareMsgTags {</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+ private:</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+  int cmp(RefPtr&lt;nsIMsgTag&gt; element1, RefPtr&lt;nsIMsgTag&gt; element2) const {</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+    // Sort nsMsgTag objects by ascending order, using their ordinal or key.</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+    // The &quot;smallest&quot; value will be first in the sorted array,</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+    // thus being the most important element.</span>
<a href="#l14.31"></a><span id="l14.31"> </span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-  // if we have only one element, it wins</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-  if (!element1 &amp;&amp; !element2) return TAG_CMP_EQUAL;</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-  if (!element2) return TAG_CMP_LESSER;</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-  if (!element1) return TAG_CMP_GREATER;</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+    // Only use the key if the ordinal is not defined or empty.</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+    nsAutoCString value1, value2;</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+    element1-&gt;GetOrdinal(value1);</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+    if (value1.IsEmpty()) element1-&gt;GetKey(value1);</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+    element2-&gt;GetOrdinal(value2);</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+    if (value2.IsEmpty()) element2-&gt;GetKey(value2);</span>
<a href="#l14.42"></a><span id="l14.42"> </span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-  // only use the key if the ordinal is not defined or empty</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-  nsAutoCString value1, value2;</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-  element1-&gt;GetOrdinal(value1);</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-  if (value1.IsEmpty()) element1-&gt;GetKey(value1);</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-  element2-&gt;GetOrdinal(value2);</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-  if (value2.IsEmpty()) element2-&gt;GetKey(value2);</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+    return strcmp(value1.get(), value2.get());</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+  }</span>
<a href="#l14.51"></a><span id="l14.51"> </span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-  return strcmp(value1.get(), value2.get());</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-}</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+ public:</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+  bool Equals(RefPtr&lt;nsIMsgTag&gt; element1, RefPtr&lt;nsIMsgTag&gt; element2) const {</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+    return cmp(element1, element2) == 0;</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+  }</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+  bool LessThan(RefPtr&lt;nsIMsgTag&gt; element1, RefPtr&lt;nsIMsgTag&gt; element2) const {</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+    return cmp(element1, element2) &lt; 0;</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+  }</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+};</span>
<a href="#l14.62"></a><span id="l14.62"> </span>
<a href="#l14.63"></a><span id="l14.63"> //</span>
<a href="#l14.64"></a><span id="l14.64"> //  nsMsgTag</span>
<a href="#l14.65"></a><span id="l14.65"> //</span>
<a href="#l14.66"></a><span id="l14.66"> NS_IMPL_ISUPPORTS(nsMsgTag, nsIMsgTag)</span>
<a href="#l14.67"></a><span id="l14.67"> </span>
<a href="#l14.68"></a><span id="l14.68"> nsMsgTag::nsMsgTag(const nsACString &amp;aKey, const nsAString &amp;aTag,</span>
<a href="#l14.69"></a><span id="l14.69">                    const nsACString &amp;aColor, const nsACString &amp;aOrdinal)</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineat">@@ -320,45 +322,29 @@ NS_IMETHODIMP nsMsgTagService::DeleteKey</span>
<a href="#l14.71"></a><span id="l14.71">   // clear the associated prefs</span>
<a href="#l14.72"></a><span id="l14.72">   nsAutoCString prefName(key);</span>
<a href="#l14.73"></a><span id="l14.73">   if (!gMigratingKeys) ToLowerCase(prefName);</span>
<a href="#l14.74"></a><span id="l14.74">   nsresult rv = m_tagPrefBranch-&gt;DeleteBranch(prefName.get());</span>
<a href="#l14.75"></a><span id="l14.75">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.76"></a><span id="l14.76">   return RefreshKeyCache();</span>
<a href="#l14.77"></a><span id="l14.77"> }</span>
<a href="#l14.78"></a><span id="l14.78"> </span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-/* void getAllTags (out unsigned long count, [array, size_is (count), retval]</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">- * out nsIMsgTag tagArray); */</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-NS_IMETHODIMP nsMsgTagService::GetAllTags(uint32_t *aCount,</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-                                          nsIMsgTag ***aTagArray) {</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-  NS_ENSURE_ARG_POINTER(aCount);</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-  NS_ENSURE_ARG_POINTER(aTagArray);</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-  // preset harmless default values</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-  *aCount = 0;</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-  *aTagArray = nullptr;</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+/* Array&lt;nsIMsgTag&gt; getAllTags(); */</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+NS_IMETHODIMP nsMsgTagService::GetAllTags(</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+    nsTArray&lt;RefPtr&lt;nsIMsgTag&gt;&gt; &amp;aTagArray) {</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+  aTagArray.Clear();</span>
<a href="#l14.93"></a><span id="l14.93"> </span>
<a href="#l14.94"></a><span id="l14.94">   // get the actual tag definitions</span>
<a href="#l14.95"></a><span id="l14.95">   nsresult rv;</span>
<a href="#l14.96"></a><span id="l14.96">   nsTArray&lt;nsCString&gt; prefList;</span>
<a href="#l14.97"></a><span id="l14.97">   rv = m_tagPrefBranch-&gt;GetChildList(&quot;&quot;, prefList);</span>
<a href="#l14.98"></a><span id="l14.98">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.99"></a><span id="l14.99">   // sort them by key for ease of processing</span>
<a href="#l14.100"></a><span id="l14.100">   prefList.Sort();</span>
<a href="#l14.101"></a><span id="l14.101"> </span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-  // build an array of nsIMsgTag elements from the orderered list</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-  // it's at max the same size as the preflist, but usually only about half</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-  nsIMsgTag **tagArray =</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-      (nsIMsgTag **)moz_xmalloc(sizeof(nsIMsgTag *) * prefList.Length());</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-  if (!tagArray) {</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-  }</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-  uint32_t currentTagIndex = 0;</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-  nsMsgTag *newMsgTag;</span>
<a href="#l14.112"></a><span id="l14.112">   nsString tag;</span>
<a href="#l14.113"></a><span id="l14.113">   nsCString lastKey, color, ordinal;</span>
<a href="#l14.114"></a><span id="l14.114">   for (auto &amp;pref : mozilla::Reversed(prefList)) {</span>
<a href="#l14.115"></a><span id="l14.115">     // extract just the key from &lt;key&gt;.&lt;info=tag|color|ordinal&gt;</span>
<a href="#l14.116"></a><span id="l14.116">     int32_t dotLoc = pref.RFindChar('.');</span>
<a href="#l14.117"></a><span id="l14.117">     if (dotLoc != kNotFound) {</span>
<a href="#l14.118"></a><span id="l14.118">       auto &amp;key = Substring(pref, 0, dotLoc);</span>
<a href="#l14.119"></a><span id="l14.119">       if (key != lastKey) {</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineat">@@ -368,37 +354,26 @@ NS_IMETHODIMP nsMsgTagService::GetAllTag</span>
<a href="#l14.121"></a><span id="l14.121">           if (NS_SUCCEEDED(rv)) {</span>
<a href="#l14.122"></a><span id="l14.122">             // .color MAY exist</span>
<a href="#l14.123"></a><span id="l14.123">             color.Truncate();</span>
<a href="#l14.124"></a><span id="l14.124">             GetColorForKey(key, color);</span>
<a href="#l14.125"></a><span id="l14.125">             // .ordinal MAY exist</span>
<a href="#l14.126"></a><span id="l14.126">             rv = GetOrdinalForKey(key, ordinal);</span>
<a href="#l14.127"></a><span id="l14.127">             if (NS_FAILED(rv)) ordinal.Truncate();</span>
<a href="#l14.128"></a><span id="l14.128">             // store the tag info in our array</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineminus">-            newMsgTag = new nsMsgTag(key, tag, color, ordinal);</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineminus">-            if (!newMsgTag) {</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineminus">-              NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(currentTagIndex, tagArray);</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineminus">-              return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineminus">-            }</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineminus">-            NS_ADDREF(tagArray[currentTagIndex++] = newMsgTag);</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineplus">+            aTagArray.AppendElement(new nsMsgTag(key, tag, color, ordinal));</span>
<a href="#l14.136"></a><span id="l14.136">           }</span>
<a href="#l14.137"></a><span id="l14.137">         }</span>
<a href="#l14.138"></a><span id="l14.138">         lastKey = key;</span>
<a href="#l14.139"></a><span id="l14.139">       }</span>
<a href="#l14.140"></a><span id="l14.140">     }</span>
<a href="#l14.141"></a><span id="l14.141">   }</span>
<a href="#l14.142"></a><span id="l14.142"> </span>
<a href="#l14.143"></a><span id="l14.143">   // sort the non-null entries by ordinal</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineminus">-  qsort(tagArray, currentTagIndex, sizeof(nsMsgTag *), CompareMsgTags);</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineminus">-</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineminus">-  // All done, now return the values (the idl's size_is(count) parameter</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-  // ensures that the array is cut accordingly).</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineminus">-  *aCount = currentTagIndex;</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineminus">-  *aTagArray = tagArray;</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineminus">-</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineplus">+  aTagArray.Sort(CompareMsgTags());</span>
<a href="#l14.152"></a><span id="l14.152">   return NS_OK;</span>
<a href="#l14.153"></a><span id="l14.153"> }</span>
<a href="#l14.154"></a><span id="l14.154"> </span>
<a href="#l14.155"></a><span id="l14.155"> nsresult nsMsgTagService::SetUnicharPref(const char *prefName,</span>
<a href="#l14.156"></a><span id="l14.156">                                          const nsAString &amp;val) {</span>
<a href="#l14.157"></a><span id="l14.157">   nsresult rv = NS_OK;</span>
<a href="#l14.158"></a><span id="l14.158">   if (!val.IsEmpty()) {</span>
<a href="#l14.159"></a><span id="l14.159">     rv = m_tagPrefBranch-&gt;SetStringPref(prefName, NS_ConvertUTF16toUTF8(val));</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineat">@@ -422,32 +397,29 @@ nsresult nsMsgTagService::MigrateLabelsT</span>
<a href="#l14.161"></a><span id="l14.161"> </span>
<a href="#l14.162"></a><span id="l14.162">   int32_t prefVersion = 0;</span>
<a href="#l14.163"></a><span id="l14.163">   nsresult rv = m_tagPrefBranch-&gt;GetIntPref(TAG_PREF_VERSION, &amp;prefVersion);</span>
<a href="#l14.164"></a><span id="l14.164">   if (NS_SUCCEEDED(rv) &amp;&amp; prefVersion &gt; 1)</span>
<a href="#l14.165"></a><span id="l14.165">     return rv;</span>
<a href="#l14.166"></a><span id="l14.166">   else if (prefVersion == 1) {</span>
<a href="#l14.167"></a><span id="l14.167">     gMigratingKeys = true;</span>
<a href="#l14.168"></a><span id="l14.168">     // need to convert the keys to lower case</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineminus">-    nsIMsgTag **tagArray;</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineminus">-    uint32_t numTags;</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineminus">-    GetAllTags(&amp;numTags, &amp;tagArray);</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineminus">-    for (uint32_t tagIndex = 0; tagIndex &lt; numTags; tagIndex++) {</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineplus">+    nsTArray&lt;RefPtr&lt;nsIMsgTag&gt;&gt; tagArray;</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineplus">+    GetAllTags(tagArray);</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineplus">+    for (auto &amp;tag : tagArray) {</span>
<a href="#l14.176"></a><span id="l14.176">       nsAutoCString key, color, ordinal;</span>
<a href="#l14.177"></a><span id="l14.177">       nsAutoString tagStr;</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineminus">-      nsIMsgTag *tag = tagArray[tagIndex];</span>
<a href="#l14.179"></a><span id="l14.179">       tag-&gt;GetKey(key);</span>
<a href="#l14.180"></a><span id="l14.180">       tag-&gt;GetTag(tagStr);</span>
<a href="#l14.181"></a><span id="l14.181">       tag-&gt;GetOrdinal(ordinal);</span>
<a href="#l14.182"></a><span id="l14.182">       tag-&gt;GetColor(color);</span>
<a href="#l14.183"></a><span id="l14.183">       DeleteKey(key);</span>
<a href="#l14.184"></a><span id="l14.184">       ToLowerCase(key);</span>
<a href="#l14.185"></a><span id="l14.185">       AddTagForKey(key, tagStr, color, ordinal);</span>
<a href="#l14.186"></a><span id="l14.186">     }</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineminus">-    NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(numTags, tagArray);</span>
<a href="#l14.188"></a><span id="l14.188">     gMigratingKeys = false;</span>
<a href="#l14.189"></a><span id="l14.189">   } else {</span>
<a href="#l14.190"></a><span id="l14.190">     nsCOMPtr&lt;nsIPrefBranch&gt; prefRoot(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l14.191"></a><span id="l14.191">     nsCOMPtr&lt;nsIPrefLocalizedString&gt; pls;</span>
<a href="#l14.192"></a><span id="l14.192">     nsString ucsval;</span>
<a href="#l14.193"></a><span id="l14.193">     nsAutoCString labelKey(&quot;$label1&quot;);</span>
<a href="#l14.194"></a><span id="l14.194">     for (int32_t i = 0; i &lt; PREF_LABELS_MAX;) {</span>
<a href="#l14.195"></a><span id="l14.195">       prefString.Assign(PREF_LABELS_DESCRIPTION);</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineat">@@ -477,30 +449,25 @@ NS_IMETHODIMP nsMsgTagService::IsValidKe</span>
<a href="#l14.197"></a><span id="l14.197">                                           bool *aResult) {</span>
<a href="#l14.198"></a><span id="l14.198">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l14.199"></a><span id="l14.199">   *aResult = m_keys.Contains(aKey);</span>
<a href="#l14.200"></a><span id="l14.200">   return NS_OK;</span>
<a href="#l14.201"></a><span id="l14.201"> }</span>
<a href="#l14.202"></a><span id="l14.202"> </span>
<a href="#l14.203"></a><span id="l14.203"> // refresh the local tag key array m_keys from preferences</span>
<a href="#l14.204"></a><span id="l14.204"> nsresult nsMsgTagService::RefreshKeyCache() {</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineminus">-  nsIMsgTag **tagArray;</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineminus">-  uint32_t numTags;</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineminus">-  nsresult rv = GetAllTags(&amp;numTags, &amp;tagArray);</span>
<a href="#l14.208"></a><span id="l14.208" class="difflineplus">+  nsTArray&lt;RefPtr&lt;nsIMsgTag&gt;&gt; tagArray;</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineplus">+  nsresult rv = GetAllTags(tagArray);</span>
<a href="#l14.210"></a><span id="l14.210">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.211"></a><span id="l14.211">   m_keys.Clear();</span>
<a href="#l14.212"></a><span id="l14.212"> </span>
<a href="#l14.213"></a><span id="l14.213" class="difflineplus">+  uint32_t numTags = tagArray.Length();</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineplus">+  m_keys.SetCapacity(numTags);</span>
<a href="#l14.215"></a><span id="l14.215">   for (uint32_t tagIndex = 0; tagIndex &lt; numTags; tagIndex++) {</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineminus">-    nsIMsgTag *tag = tagArray[tagIndex];</span>
<a href="#l14.217"></a><span id="l14.217" class="difflineminus">-    if (!tag) {</span>
<a href="#l14.218"></a><span id="l14.218" class="difflineminus">-      rv = NS_ERROR_FAILURE;</span>
<a href="#l14.219"></a><span id="l14.219" class="difflineminus">-      break;</span>
<a href="#l14.220"></a><span id="l14.220" class="difflineminus">-    }</span>
<a href="#l14.221"></a><span id="l14.221">     nsAutoCString key;</span>
<a href="#l14.222"></a><span id="l14.222" class="difflineminus">-    tag-&gt;GetKey(key);</span>
<a href="#l14.223"></a><span id="l14.223" class="difflineplus">+    tagArray[tagIndex]-&gt;GetKey(key);</span>
<a href="#l14.224"></a><span id="l14.224">     if (!m_keys.InsertElementAt(tagIndex, key)) {</span>
<a href="#l14.225"></a><span id="l14.225">       rv = NS_ERROR_FAILURE;</span>
<a href="#l14.226"></a><span id="l14.226">       break;</span>
<a href="#l14.227"></a><span id="l14.227">     }</span>
<a href="#l14.228"></a><span id="l14.228">   }</span>
<a href="#l14.229"></a><span id="l14.229" class="difflineminus">-  NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(numTags, tagArray);</span>
<a href="#l14.230"></a><span id="l14.230">   return rv;</span>
<a href="#l14.231"></a><span id="l14.231"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsIMsgTagService.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsIMsgTagService.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -20,17 +20,17 @@ function run_test() {</span>
<a href="#l15.4"></a><span id="l15.4">   const tag2 = &quot;notistag&quot;;</span>
<a href="#l15.5"></a><span id="l15.5">   const tag3 = &quot;istagnot&quot;;</span>
<a href="#l15.6"></a><span id="l15.6">   const tag4 = &quot;istagtoo&quot;;</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">   // add a tag</span>
<a href="#l15.9"></a><span id="l15.9">   MailServices.tags.addTagForKey(tag1, tag1, null, null);</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11">   // delete any existing tags</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  let tagArray = MailServices.tags.getAllTags();</span>
<a href="#l15.14"></a><span id="l15.14">   for (var i = 0; i &lt; tagArray.length; i++) {</span>
<a href="#l15.15"></a><span id="l15.15">     MailServices.tags.deleteKey(tagArray[i].key);</span>
<a href="#l15.16"></a><span id="l15.16">   }</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18">   // make sure added tag is now gone</span>
<a href="#l15.19"></a><span id="l15.19">   Assert.ok(!MailServices.tags.isValidKey(tag1));</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21">   // add single tag, and check again</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -63,18 +63,51 @@ function run_test() {</span>
<a href="#l15.23"></a><span id="l15.23"> </span>
<a href="#l15.24"></a><span id="l15.24">   for (i = 0; i &lt; 100; i++) {</span>
<a href="#l15.25"></a><span id="l15.25">     Assert.ok(MailServices.tags.isValidKey(i));</span>
<a href="#l15.26"></a><span id="l15.26">     // make sure it knows the difference betweens tags and keys</span>
<a href="#l15.27"></a><span id="l15.27">     Assert.ok(!MailServices.tags.isValidKey(&quot;lotsatags&quot; + i));</span>
<a href="#l15.28"></a><span id="l15.28">     // are we confused by key at start of tag?</span>
<a href="#l15.29"></a><span id="l15.29">     Assert.ok(!MailServices.tags.isValidKey(i + &quot;lotsatags&quot;));</span>
<a href="#l15.30"></a><span id="l15.30">   }</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+  // Test sort ordering for getAllTags() without ordinal.</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+  for (let tag of MailServices.tags.getAllTags()) {</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+    MailServices.tags.deleteKey(tag.key);</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+  }</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+  MailServices.tags.addTag(&quot;grapefruit&quot;, null, null);</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+  MailServices.tags.addTag(&quot;orange&quot;, null, null);</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+  MailServices.tags.addTag(&quot;lime&quot;, null, null);</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+  MailServices.tags.addTag(&quot;lemon&quot;, null, null);</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+  // Should be sorted by tag name.</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+  let tagNames = MailServices.tags.getAllTags().map(t =&gt; t.tag);</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+  Assert.deepEqual(</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+    tagNames,</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+    [&quot;grapefruit&quot;, &quot;lemon&quot;, &quot;lime&quot;, &quot;orange&quot;],</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+    &quot;Sort without ordinals&quot;</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+  );</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineplus">+</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+  // Test sort ordering for getAllTags() with (some) ordinals.</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineplus">+  for (let tag of MailServices.tags.getAllTags()) {</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+    MailServices.tags.deleteKey(tag.key);</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+  }</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineplus">+  MailServices.tags.addTag(&quot;grapefruit&quot;, null, &quot;3&quot;);</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+  MailServices.tags.addTag(&quot;orange&quot;, null, &quot;1&quot;);</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineplus">+  MailServices.tags.addTag(&quot;lime&quot;, null, null);</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineplus">+  MailServices.tags.addTag(&quot;lemon&quot;, null, &quot;2&quot;);</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+  // Should be sorted by ordinal, then tag name.</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineplus">+  tagNames = MailServices.tags.getAllTags().map(t =&gt; t.tag);</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineplus">+  Assert.deepEqual(</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineplus">+    tagNames,</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineplus">+    [&quot;orange&quot;, &quot;lemon&quot;, &quot;grapefruit&quot;, &quot;lime&quot;],</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineplus">+    &quot;Sort with ordinals&quot;</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+  );</span>
<a href="#l15.65"></a><span id="l15.65"> }</span>
<a href="#l15.66"></a><span id="l15.66"> </span>
<a href="#l15.67"></a><span id="l15.67"> /*</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-  function printTags()</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-  {</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-    let tags = MailServices.tags.getAllTags({});</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-    for (var i = 0; i &lt; tags.length; i++)</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-      print(&quot;# &quot; + i + &quot; key [&quot; + tags[i].key + &quot;] tag [&quot; + tags[i].tag + &quot;]&quot;);</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineplus">+function printTags() {</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+  for (let tag of MailServices.tags.getAllTags()) {</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineplus">+    print(`# key [${tag.key}] tag [${tag.tag}] ordinal [${tag.ordinal}]`);</span>
<a href="#l15.76"></a><span id="l15.76">   }</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">- */</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+}</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+*/</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchTag.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchTag.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -429,17 +429,17 @@ function run_test() {</span>
<a href="#l16.4"></a><span id="l16.4">   testValidityTable(news, DoesntContain, Keywords, false);</span>
<a href="#l16.5"></a><span id="l16.5">   testValidityTable(news, Is, Keywords, false);</span>
<a href="#l16.6"></a><span id="l16.6">   testValidityTable(news, Isnt, Keywords, false);</span>
<a href="#l16.7"></a><span id="l16.7">   testValidityTable(news, IsEmpty, Keywords, false);</span>
<a href="#l16.8"></a><span id="l16.8">   testValidityTable(news, IsntEmpty, Keywords, false);</span>
<a href="#l16.9"></a><span id="l16.9">   testValidityTable(news, IsBefore, Keywords, false);</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">   // delete any existing tags</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  let tagArray = MailServices.tags.getAllTags();</span>
<a href="#l16.14"></a><span id="l16.14">   for (var i = 0; i &lt; tagArray.length; i++) {</span>
<a href="#l16.15"></a><span id="l16.15">     MailServices.tags.deleteKey(tagArray[i].key);</span>
<a href="#l16.16"></a><span id="l16.16">   }</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18">   // add as valid tags Tag1 and Tag4</span>
<a href="#l16.19"></a><span id="l16.19">   MailServices.tags.addTagForKey(Tag1, Tag1, null, null);</span>
<a href="#l16.20"></a><span id="l16.20">   MailServices.tags.addTagForKey(Tag4, Tag4, null, null);</span>
<a href="#l16.21"></a><span id="l16.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/db/gloda/modules/noun_tag.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/noun_tag.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -32,17 +32,17 @@ var TagNoun = {</span>
<a href="#l17.4"></a><span id="l17.4">     if (this._tagList == null) {</span>
<a href="#l17.5"></a><span id="l17.5">       this._updateTagMap();</span>
<a href="#l17.6"></a><span id="l17.6">     }</span>
<a href="#l17.7"></a><span id="l17.7">     return this._tagList;</span>
<a href="#l17.8"></a><span id="l17.8">   },</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10">   _updateTagMap() {</span>
<a href="#l17.11"></a><span id="l17.11">     this._tagMap = {};</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    let tagArray = (this._tagList = this._msgTagService.getAllTags({}));</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    let tagArray = (this._tagList = this._msgTagService.getAllTags());</span>
<a href="#l17.14"></a><span id="l17.14">     for (let iTag = 0; iTag &lt; tagArray.length; iTag++) {</span>
<a href="#l17.15"></a><span id="l17.15">       let tag = tagArray[iTag];</span>
<a href="#l17.16"></a><span id="l17.16">       this._tagMap[tag.key] = tag;</span>
<a href="#l17.17"></a><span id="l17.17">     }</span>
<a href="#l17.18"></a><span id="l17.18">   },</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">   comparator(a, b) {</span>
<a href="#l17.21"></a><span id="l17.21">     if (a == null) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/mailnews/components/prefs/content/pref-tags.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/mailnews/components/prefs/content/pref-tags.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -40,17 +40,17 @@ function Startup()</span>
<a href="#l18.4"></a><span id="l18.4">   if (!gInstantApply)</span>
<a href="#l18.5"></a><span id="l18.5">     window.addEventListener(&quot;dialogaccept&quot;, this.OnOK, true);</span>
<a href="#l18.6"></a><span id="l18.6">   UpdateButtonStates();</span>
<a href="#l18.7"></a><span id="l18.7"> }</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> function InitTagList()</span>
<a href="#l18.10"></a><span id="l18.10"> {</span>
<a href="#l18.11"></a><span id="l18.11">   // Read the tags from preferences via the tag service.</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  var tagArray = gTagService.getAllTags({});</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  var tagArray = gTagService.getAllTags();</span>
<a href="#l18.14"></a><span id="l18.14">   for (var i = 0; i &lt; tagArray.length; ++i)</span>
<a href="#l18.15"></a><span id="l18.15">   {</span>
<a href="#l18.16"></a><span id="l18.16">     var t = tagArray[i];</span>
<a href="#l18.17"></a><span id="l18.17">     var tagInfo = {tag:     t.tag,</span>
<a href="#l18.18"></a><span id="l18.18">                    key:     t.key,</span>
<a href="#l18.19"></a><span id="l18.19">                    color:   t.color,</span>
<a href="#l18.20"></a><span id="l18.20">                    ordinal: t.ordinal,</span>
<a href="#l18.21"></a><span id="l18.21">                    new:     false,  // not added in this run</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/mailnews/content/mailWidgets.xml</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/mailnews/content/mailWidgets.xml</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1484,17 +1484,17 @@</span>
<a href="#l19.4"></a><span id="l19.4">       &lt;/method&gt;</span>
<a href="#l19.5"></a><span id="l19.5">       &lt;method name=&quot;fillInTags&quot;&gt;</span>
<a href="#l19.6"></a><span id="l19.6">         &lt;body&gt;</span>
<a href="#l19.7"></a><span id="l19.7">           &lt;![CDATA[</span>
<a href="#l19.8"></a><span id="l19.8">             var children = document.getAnonymousNodes(this);</span>
<a href="#l19.9"></a><span id="l19.9">             var popupMenu = children[5].firstChild;</span>
<a href="#l19.10"></a><span id="l19.10">             var tagService = Cc[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l19.11"></a><span id="l19.11">                                .getService(Ci.nsIMsgTagService);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-            var tagArray = tagService.getAllTags({});</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+            var tagArray = tagService.getAllTags();</span>
<a href="#l19.14"></a><span id="l19.14">             for (var i = 0; i &lt; tagArray.length; ++i)</span>
<a href="#l19.15"></a><span id="l19.15">             {</span>
<a href="#l19.16"></a><span id="l19.16">               var taginfo = tagArray[i];</span>
<a href="#l19.17"></a><span id="l19.17">               var newMenuItem = document.createElement('menuitem');</span>
<a href="#l19.18"></a><span id="l19.18">               newMenuItem.setAttribute('label', taginfo.tag);</span>
<a href="#l19.19"></a><span id="l19.19">               newMenuItem.setAttribute('value', taginfo.key);</span>
<a href="#l19.20"></a><span id="l19.20">               popupMenu.appendChild(newMenuItem);</span>
<a href="#l19.21"></a><span id="l19.21">               if (!i)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/suite/mailnews/content/mailWindowOverlay.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/suite/mailnews/content/mailWindowOverlay.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -483,17 +483,17 @@ function RemoveAllMessageTags()</span>
<a href="#l20.4"></a><span id="l20.4">   var selectedMessages = gFolderDisplay.selectedMessages;</span>
<a href="#l20.5"></a><span id="l20.5">   if (!selectedMessages.length)</span>
<a href="#l20.6"></a><span id="l20.6">     return;</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8">   var messages = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l20.9"></a><span id="l20.9">                    .createInstance(Ci.nsIMutableArray);</span>
<a href="#l20.10"></a><span id="l20.10">   var tagService = Cc[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l20.11"></a><span id="l20.11">                      .getService(Ci.nsIMsgTagService);</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  var tagArray = tagService.getAllTags({});</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  var tagArray = tagService.getAllTags();</span>
<a href="#l20.14"></a><span id="l20.14"> </span>
<a href="#l20.15"></a><span id="l20.15">   var allKeys = &quot;&quot;;</span>
<a href="#l20.16"></a><span id="l20.16">   for (let j = 0; j &lt; tagArray.length; ++j)</span>
<a href="#l20.17"></a><span id="l20.17">   {</span>
<a href="#l20.18"></a><span id="l20.18">     if (j)</span>
<a href="#l20.19"></a><span id="l20.19">       allKeys += &quot; &quot;;</span>
<a href="#l20.20"></a><span id="l20.20">     allKeys += tagArray[j].key;</span>
<a href="#l20.21"></a><span id="l20.21">   }</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -578,17 +578,17 @@ function ToggleMessageTagKey(index)</span>
<a href="#l20.23"></a><span id="l20.23"> {</span>
<a href="#l20.24"></a><span id="l20.24">   // toggle the tag state based upon that of the first selected message</span>
<a href="#l20.25"></a><span id="l20.25">   var msgHdr = gFolderDisplay.selectedMessage;</span>
<a href="#l20.26"></a><span id="l20.26">   if (!msgHdr)</span>
<a href="#l20.27"></a><span id="l20.27">     return;</span>
<a href="#l20.28"></a><span id="l20.28"> </span>
<a href="#l20.29"></a><span id="l20.29">   var tagService = Cc[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l20.30"></a><span id="l20.30">                      .getService(Ci.nsIMsgTagService);</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-  var tagArray = tagService.getAllTags({});</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+  var tagArray = tagService.getAllTags();</span>
<a href="#l20.33"></a><span id="l20.33">   for (var i = 0; i &lt; tagArray.length; ++i)</span>
<a href="#l20.34"></a><span id="l20.34">   {</span>
<a href="#l20.35"></a><span id="l20.35">     var key = tagArray[i].key;</span>
<a href="#l20.36"></a><span id="l20.36">     if (!--index)</span>
<a href="#l20.37"></a><span id="l20.37">     {</span>
<a href="#l20.38"></a><span id="l20.38">       // found the key, now toggle its state</span>
<a href="#l20.39"></a><span id="l20.39">       var curKeys = msgHdr.getStringProperty(&quot;keywords&quot;);</span>
<a href="#l20.40"></a><span id="l20.40">       if (msgHdr.label)</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineat">@@ -660,17 +660,17 @@ function SetMessageTagLabel(menuitem, in</span>
<a href="#l20.42"></a><span id="l20.42">                                                   [accesskey, name]);</span>
<a href="#l20.43"></a><span id="l20.43">   menuitem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l20.44"></a><span id="l20.44"> }</span>
<a href="#l20.45"></a><span id="l20.45"> </span>
<a href="#l20.46"></a><span id="l20.46"> function InitMessageTags(menuPopup)</span>
<a href="#l20.47"></a><span id="l20.47"> {</span>
<a href="#l20.48"></a><span id="l20.48">   var tagService = Cc[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l20.49"></a><span id="l20.49">                      .getService(Ci.nsIMsgTagService);</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-  var tagArray = tagService.getAllTags({});</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+  var tagArray = tagService.getAllTags();</span>
<a href="#l20.52"></a><span id="l20.52">   var tagCount = tagArray.length;</span>
<a href="#l20.53"></a><span id="l20.53"> </span>
<a href="#l20.54"></a><span id="l20.54">   // remove any existing non-static entries...</span>
<a href="#l20.55"></a><span id="l20.55">   var menuseparator = menuPopup.lastChild.previousSibling;</span>
<a href="#l20.56"></a><span id="l20.56">   for (var i = menuPopup.childNodes.length; i &gt; 4; --i)</span>
<a href="#l20.57"></a><span id="l20.57">     menuseparator.previousSibling.remove();</span>
<a href="#l20.58"></a><span id="l20.58"> </span>
<a href="#l20.59"></a><span id="l20.59">   // hide double menuseparator</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/mailnews/content/msgHdrViewOverlay.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/mailnews/content/msgHdrViewOverlay.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -693,17 +693,17 @@ function SetTagHeader()</span>
<a href="#l21.4"></a><span id="l21.4">   catch (ex)</span>
<a href="#l21.5"></a><span id="l21.5">   {</span>
<a href="#l21.6"></a><span id="l21.6">     return; // no msgHdr to add our tags to</span>
<a href="#l21.7"></a><span id="l21.7">   }</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9">   // get the list of known tags</span>
<a href="#l21.10"></a><span id="l21.10">   var tagService = Cc[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l21.11"></a><span id="l21.11">                    .getService(Ci.nsIMsgTagService);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  var tagArray = tagService.getAllTags({});</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  var tagArray = tagService.getAllTags();</span>
<a href="#l21.14"></a><span id="l21.14">   var tagKeys = {};</span>
<a href="#l21.15"></a><span id="l21.15">   for (var tagInfo of tagArray)</span>
<a href="#l21.16"></a><span id="l21.16">     if (tagInfo.tag)</span>
<a href="#l21.17"></a><span id="l21.17">       tagKeys[tagInfo.key] = true;</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19">   // extract the tag keys from the msgHdr</span>
<a href="#l21.20"></a><span id="l21.20">   var msgKeyArray = msgHdr.getStringProperty(&quot;keywords&quot;).split(&quot; &quot;);</span>
<a href="#l21.21"></a><span id="l21.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/mailnews/content/msgViewPickerOverlay.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/mailnews/content/msgViewPickerOverlay.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -386,17 +386,17 @@ function RefreshTagsPopup(aMenupopup)</span>
<a href="#l22.4"></a><span id="l22.4">   // remove all menuitems</span>
<a href="#l22.5"></a><span id="l22.5">   while (aMenupopup.hasChildNodes())</span>
<a href="#l22.6"></a><span id="l22.6">     aMenupopup.lastChild.remove();</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">   // create tag menuitems</span>
<a href="#l22.9"></a><span id="l22.9">   var currentTagKey = isNaN(gCurrentViewValue) ? gCurrentViewValue.substr(kViewTagMarker.length) : &quot;&quot;;</span>
<a href="#l22.10"></a><span id="l22.10">   var tagService = Cc[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l22.11"></a><span id="l22.11">                      .getService(Ci.nsIMsgTagService);</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  var tagArray = tagService.getAllTags({});</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+  var tagArray = tagService.getAllTags();</span>
<a href="#l22.14"></a><span id="l22.14">   for (var i = 0; i &lt; tagArray.length; ++i)</span>
<a href="#l22.15"></a><span id="l22.15">   {</span>
<a href="#l22.16"></a><span id="l22.16">     var tagInfo = tagArray[i];</span>
<a href="#l22.17"></a><span id="l22.17">     var menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l22.18"></a><span id="l22.18">     menuitem.setAttribute(&quot;label&quot;, tagInfo.tag);</span>
<a href="#l22.19"></a><span id="l22.19">     menuitem.setAttribute(&quot;value&quot;, kViewTagMarker + tagInfo.key);</span>
<a href="#l22.20"></a><span id="l22.20">     menuitem.setAttribute(&quot;name&quot;, &quot;viewmessages&quot;);</span>
<a href="#l22.21"></a><span id="l22.21">     menuitem.setAttribute(&quot;type&quot;, &quot;radio&quot;);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

