<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25008:0399b6a574c66a074e65205d8b325d7b2bffd386</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0399b6a574c66a074e65205d8b325d7b2bffd386" />
<meta property="og:url" content="/comm-central/rev/0399b6a574c66a074e65205d8b325d7b2bffd386" />
<meta property="og:description" content="Bug 1496632 - Update XPI installation test for new UI; r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0399b6a574c66a074e65205d8b325d7b2bffd386 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0399b6a574c66a074e65205d8b325d7b2bffd386">shortlog</a> |
<a href="/comm-central/log/0399b6a574c66a074e65205d8b325d7b2bffd386">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0399b6a574c66a074e65205d8b325d7b2bffd386">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0399b6a574c66a074e65205d8b325d7b2bffd386">files</a> |
changeset |
<a href="/comm-central/raw-rev/0399b6a574c66a074e65205d8b325d7b2bffd386">raw</a>  | <a href="/comm-central/archive/0399b6a574c66a074e65205d8b325d7b2bffd386.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1496632">Bug 1496632</a> - Update XPI installation test for new UI; r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 19 Oct 2018 21:59:41 +1300</td></tr>

<tr>
 <td>changeset 25008</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0399b6a574c66a074e65205d8b325d7b2bffd386">0399b6a574c66a074e65205d8b325d7b2bffd386</a></td>
</tr>



<tr>
<td>parent 25007</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/92444675efe9ad1b9a6071ee76b67ad1bd911049">92444675efe9ad1b9a6071ee76b67ad1bd911049</a>
</td>
</tr>

<tr>
<td>child 25009</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/52e953facdcf2f57945f27550603d8b0cb72d796">52e953facdcf2f57945f27550603d8b0cb72d796</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0399b6a574c66a074e65205d8b325d7b2bffd386">15030</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Fri, 19 Oct 2018 09:00:25 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@52e953facdcf [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=52e953facdcf2f57945f27550603d8b0cb72d796">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=52e953facdcf2f57945f27550603d8b0cb72d796&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=52e953facdcf2f57945f27550603d8b0cb72d796&newProject=comm-central&newRevision=ba7329940979e5879434eda94842f528a1b06f93&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=52e953facdcf2f57945f27550603d8b0cb72d796&newProject=comm-central&newRevision=ba7329940979e5879434eda94842f528a1b06f93&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=52e953facdcf2f57945f27550603d8b0cb72d796&newProject=comm-central&newRevision=ba7329940979e5879434eda94842f528a1b06f93&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1496632">1496632</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1496632">Bug 1496632</a> - Update XPI installation test for new UI; r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/installxpi.html">mail/test/mozmill/content-tabs/html/installxpi.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/installxpi.html">file</a> |
<a href="/comm-central/annotate/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/installxpi.html">annotate</a> |
<a href="/comm-central/diff/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/installxpi.html">diff</a> |
<a href="/comm-central/comparison/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/installxpi.html">comparison</a> |
<a href="/comm-central/log/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/installxpi.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/webextension.xpi">mail/test/mozmill/content-tabs/html/webextension.xpi</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/webextension.xpi">file</a> |
<a href="/comm-central/annotate/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/webextension.xpi">annotate</a> |
<a href="/comm-central/diff/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/webextension.xpi">diff</a> |
<a href="/comm-central/comparison/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/webextension.xpi">comparison</a> |
<a href="/comm-central/log/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/html/webextension.xpi">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/test-install-xpi.js">mail/test/mozmill/content-tabs/test-install-xpi.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/test-install-xpi.js">file</a> |
<a href="/comm-central/annotate/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/test-install-xpi.js">annotate</a> |
<a href="/comm-central/diff/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/test-install-xpi.js">diff</a> |
<a href="/comm-central/comparison/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/test-install-xpi.js">comparison</a> |
<a href="/comm-central/log/0399b6a574c66a074e65205d8b325d7b2bffd386/mail/test/mozmill/content-tabs/test-install-xpi.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/html/installxpi.html</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/html/installxpi.html</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -2,11 +2,12 @@</span>
<a href="#l1.4"></a><span id="l1.4">   &lt;head&gt;</span>
<a href="#l1.5"></a><span id="l1.5">     &lt;title&gt;Test xpi installation&lt;/title&gt; </span>
<a href="#l1.6"></a><span id="l1.6">   &lt;/head&gt;</span>
<a href="#l1.7"></a><span id="l1.7">   &lt;body bgcolor=&quot;#FFFFFF&quot;&gt;</span>
<a href="#l1.8"></a><span id="l1.8">     &lt;h1&gt;Test xpi installation&lt;/h1&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">     &lt;a id=&quot;corruptlink&quot; href=&quot;corrupt.xpi&quot;&gt;Install this corrupt xpi&lt;/a&gt;</span>
<a href="#l1.11"></a><span id="l1.11">     &lt;a id=&quot;installlink&quot; href=&quot;installxpi.xpi&quot;&gt;Install this xpi&lt;/a&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    &lt;a id=&quot;installwebextlink&quot; href=&quot;webextension.xpi&quot;&gt;Install this webextension xpi&lt;/a&gt;</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14">   &lt;/body&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> &lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..d4e4f2750704b23af2218b9a8e10c32b370674bc</span>
<a href="#l2.3"></a><span id="l2.3">GIT binary patch
literal 323
zc$^FHW@Zs#U|`^2km&gt;RE{oS7!Ga1PH48*()G7Pzid6{Xc#U*-K#rb)mA)E}%&lt;(KwF
zcK~r|1vdjD%L`@(1~8G@=g4))fyedw++d!_?gifA_nciWnO$2jmv3?a_tJ86&lt;1m(1
zffJ|y+s~Z)U0{Q{MMXuB@8lo&gt;Ii{RX%TzOk+|M3hsY?DB_Tv9iW!1&gt;k-R1`+&lt;nJVy
zbw9ir!76L|{h@K_fw%7;J{GB5t-=+#F(TS4YRQ$&amp;C#1@ZQUXdmZUpX3U!0_SvrMl~
zjyYcU#i!cb_hR3f0=yZS&lt;d|{!O@aXg7=d_8BZ!6OQ&amp;xyi(R&gt;-;&amp;B_MR#&gt;fy1q;G)@
F0RSc6YBc}=</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/test-install-xpi.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/test-install-xpi.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -17,133 +17,87 @@ ChromeUtils.import(&quot;chrome://mozmill/con</span>
<a href="#l3.4"></a><span id="l3.4"> var mozmill = {};</span>
<a href="#l3.5"></a><span id="l3.5"> ChromeUtils.import(&quot;chrome://mozmill/content/modules/mozmill.js&quot;, mozmill);</span>
<a href="#l3.6"></a><span id="l3.6"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> // RELATIVE_ROOT messes with the collector, so we have to bring the path back</span>
<a href="#l3.9"></a><span id="l3.9"> // so we get the right path for the resources.</span>
<a href="#l3.10"></a><span id="l3.10"> var url = collector.addHttpResource('../content-tabs/html', 'content-tabs');</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+var gDocument;</span>
<a href="#l3.13"></a><span id="l3.13"> var gNewTab;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-var gNotificationBox;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-var ALERT_TIMEOUT = 50000;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-var AlertWatcher = {</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-  planForAlert: function(aController) {</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-    this.alerted = false;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-    aController.window.document.addEventListener(&quot;AlertActive&quot;,</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-                                                 this.alertActive);</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-  },</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-  waitForAlert: function(aController) {</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-    if (!this.alerted) {</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-      aController.waitFor(() =&gt; this.alerted, &quot;Timeout waiting for alert&quot;,</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-                          ALERT_TIMEOUT, 100);</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-    }</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-    aController.window.document.removeEventListener(&quot;AlertActive&quot;,</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-                                                    this.alertActive);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-  },</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-  alerted: false,</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-  alertActive: function() {</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-    AlertWatcher.alerted = true;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-  }</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-};</span>
<a href="#l3.37"></a><span id="l3.37"> </span>
<a href="#l3.38"></a><span id="l3.38"> var setupModule = function (module) {</span>
<a href="#l3.39"></a><span id="l3.39">   let wh = collector.getModule('window-helpers');</span>
<a href="#l3.40"></a><span id="l3.40">   wh.installInto(module);</span>
<a href="#l3.41"></a><span id="l3.41">   let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l3.42"></a><span id="l3.42">   fdh.installInto(module);</span>
<a href="#l3.43"></a><span id="l3.43">   let cth = collector.getModule('content-tab-helpers');</span>
<a href="#l3.44"></a><span id="l3.44">   cth.installInto(module);</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+  gDocument = mc.window.document;</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+  gNewTab = open_content_tab_with_url(url + &quot;installxpi.html&quot;,</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+      &quot;specialTabs.siteClickHandler(event, new RegExp('^&quot; + url + &quot;'));&quot;);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+};</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+var teardownModule = function(module) {</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+  mc.tabmail.closeTab(gNewTab);</span>
<a href="#l3.53"></a><span id="l3.53"> };</span>
<a href="#l3.54"></a><span id="l3.54"> </span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-function click_notification_box_action_in_current_tab() {</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-  let actionButton = gNotificationBox.currentNotification.querySelector(&quot;button&quot;);</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-  mc.click(new elib.Elem(actionButton));</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-}</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-function close_notification_box() {</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-  gNotificationBox.currentNotification.close();</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-}</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+function waitForNotification(id, buttonToClick, callback) {</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+  let path = `</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+    /id(&quot;messengerWindow&quot;)/id(&quot;mainPopupSet&quot;)/id(&quot;notification-popup&quot;)/id(&quot;${id}-notification&quot;)</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+  `.trim();</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+  let notification = new elib.Lookup(gDocument, path);</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+  let button = new elib.Lookup(gDocument, `${path}/anon({&quot;anonid&quot;:&quot;${buttonToClick}&quot;})`);</span>
<a href="#l3.69"></a><span id="l3.69"> </span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-function click_install_link_and_wait_for_alert(link) {</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-  // Clicking the link will bring up a notification box...</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-  AlertWatcher.planForAlert(mc);</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-  mc.click(new elib.Elem(mc.tabmail.getBrowserForSelectedTab().contentDocument</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-                           .getElementById(link)));</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-  AlertWatcher.waitForAlert(mc);</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-  // Just give other events time to clear</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-  mc.sleep(1000);</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-}</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-function test_setup() {</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-  gNewTab =</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-    open_content_tab_with_url(url + &quot;installxpi.html&quot;,</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-      &quot;specialTabs.siteClickHandler(event, new RegExp('^&quot; + url + &quot;'));&quot;);</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-  // make the animation only take one frame</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-  gNotificationBox =</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-    mc.tabmail.selectedTab.panel.querySelector(&quot;notificationbox&quot;);</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-  gNotificationBox.slideSteps = 1;</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+  mc.waitForElement(notification);</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+  // Give the UI some time to settle.</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+  mc.sleep(500);</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+  if (callback) {</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+    callback();</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+  }</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+  mc.click(button);</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+  mc.waitForElementNotPresent(notification);</span>
<a href="#l3.98"></a><span id="l3.98"> }</span>
<a href="#l3.99"></a><span id="l3.99"> </span>
<a href="#l3.100"></a><span id="l3.100"> function test_install_corrupt_xpi() {</span>
<a href="#l3.101"></a><span id="l3.101">   // This install with give us a corrupt xpi warning.</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-  click_install_link_and_wait_for_alert(&quot;corruptlink&quot;);</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-  // Clicking the install button will close the current notification and open</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-  // the corrupt notification.</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-  AlertWatcher.planForAlert(mc);</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-  click_notification_box_action_in_current_tab();</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-  AlertWatcher.waitForAlert(mc);</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineminus">-</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineminus">-  // Now check this matches, avoiding l10n issues for now.</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineminus">-  if (gNotificationBox.currentNotification.priority !=</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineminus">-      gNotificationBox.PRIORITY_CRITICAL_HIGH)</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineminus">-    throw new Error(&quot;Unexpected priority used for notification. Wrong Notification? Priority used was: &quot; + gNotificationBox.currentNotification.priority);</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineminus">-</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-  // We're done with this test, close the box.</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-  close_notification_box();</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+  mc.click(content_tab_eid(gNewTab, &quot;corruptlink&quot;));</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+  waitForNotification(&quot;addon-install-blocked&quot;, &quot;button&quot;);</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+  waitForNotification(&quot;addon-install-failed&quot;, &quot;button&quot;);</span>
<a href="#l3.120"></a><span id="l3.120"> }</span>
<a href="#l3.121"></a><span id="l3.121"> </span>
<a href="#l3.122"></a><span id="l3.122"> function test_install_xpi_offer() {</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-  click_install_link_and_wait_for_alert(&quot;installlink&quot;);</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineminus">-  // This brings up a second notification, which we ignore.</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-  AlertWatcher.planForAlert(mc);</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineminus">-  click_notification_box_action_in_current_tab();</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-  AlertWatcher.waitForAlert(mc);</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineminus">-  close_notification_box();</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineminus">-</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineminus">-  // After closing the dialog we need to give just a little extra time</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineminus">-  // before we do things.</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineminus">-  mc.sleep(100);</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+  mc.click(content_tab_eid(gNewTab, &quot;installlink&quot;));</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+  waitForNotification(&quot;addon-install-blocked&quot;, &quot;button&quot;);</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+  waitForNotification(&quot;addon-install-confirmation&quot;, &quot;secondarybutton&quot;);</span>
<a href="#l3.137"></a><span id="l3.137"> }</span>
<a href="#l3.138"></a><span id="l3.138"> </span>
<a href="#l3.139"></a><span id="l3.139"> function test_xpinstall_disabled() {</span>
<a href="#l3.140"></a><span id="l3.140">   Services.prefs.setBoolPref(&quot;xpinstall.enabled&quot;, false);</span>
<a href="#l3.141"></a><span id="l3.141"> </span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-  // Try installation again - this time we'll get an install has been disabled</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-  // message.</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineminus">-  click_install_link_and_wait_for_alert(&quot;installlink&quot;);</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+  // Try installation again - this time we'll get an install has been disabled message.</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+  mc.click(content_tab_eid(gNewTab, &quot;installlink&quot;));</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+  waitForNotification(&quot;xpinstall-disabled&quot;, &quot;secondarybutton&quot;);</span>
<a href="#l3.148"></a><span id="l3.148"> </span>
<a href="#l3.149"></a><span id="l3.149" class="difflineminus">-  // tell it to enable installation!</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineminus">-  click_notification_box_action_in_current_tab();</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+  Services.prefs.clearUserPref(&quot;xpinstall.enabled&quot;);</span>
<a href="#l3.152"></a><span id="l3.152"> }</span>
<a href="#l3.153"></a><span id="l3.153"> </span>
<a href="#l3.154"></a><span id="l3.154"> function test_xpinstall_actually_install() {</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineminus">-  click_install_link_and_wait_for_alert(&quot;installlink&quot;);</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineminus">-</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineminus">-  // This brings up a second notification, which we click on.</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineminus">-  AlertWatcher.planForAlert(mc);</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineminus">-  click_notification_box_action_in_current_tab();</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineminus">-  AlertWatcher.waitForAlert(mc);</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineplus">+  mc.click(content_tab_eid(gNewTab, &quot;installlink&quot;));</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineplus">+  waitForNotification(&quot;addon-install-blocked&quot;, &quot;button&quot;);</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineplus">+  waitForNotification(&quot;addon-install-confirmation&quot;, &quot;button&quot;);</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineplus">+  waitForNotification(&quot;addon-installed&quot;, &quot;button&quot;);</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+}</span>
<a href="#l3.166"></a><span id="l3.166"> </span>
<a href="#l3.167"></a><span id="l3.167" class="difflineminus">-  // This brings up a third notification, which we ignore.</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineminus">-  AlertWatcher.planForAlert(mc);</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineminus">-  click_notification_box_action_in_current_tab();</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineminus">-  AlertWatcher.waitForAlert(mc);</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineminus">-</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineminus">-  close_notification_box();</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineminus">-  close_tab(gNewTab);</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineplus">+function test_xpinstall_webext_actually_install() {</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+  mc.click(content_tab_eid(gNewTab, &quot;installwebextlink&quot;));</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+  waitForNotification(&quot;addon-install-blocked&quot;, &quot;button&quot;);</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineplus">+  waitForNotification(&quot;addon-webext-permissions&quot;, &quot;button&quot;, () =&gt; {</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+    let intro = new elib.ID(gDocument, &quot;addon-webext-perm-intro&quot;);</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineplus">+    mc.assertNotDOMProperty(intro, &quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+    let permissionList = new elib.ID(gDocument, &quot;addon-webext-perm-list&quot;);</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineplus">+    mc.assertNotDOMProperty(permissionList, &quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+    mc.assert(() =&gt; permissionList.getNode().childElementCount == 1);</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineplus">+  });</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineplus">+  waitForNotification(&quot;addon-installed&quot;, &quot;button&quot;);</span>
<a href="#l3.185"></a><span id="l3.185"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

