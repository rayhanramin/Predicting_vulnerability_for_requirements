<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8497:eb19b4c513e0900a3017127f13553cacedb7e756</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ eb19b4c513e0900a3017127f13553cacedb7e756" />
<meta property="og:url" content="/comm-central/rev/eb19b4c513e0900a3017127f13553cacedb7e756" />
<meta property="og:description" content="Bug 685480 - Also port Bug 584474, Bug 644987, and Bug 683875. r=Standard8 a=Callek for this CLOSED TREE." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / eb19b4c513e0900a3017127f13553cacedb7e756 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/eb19b4c513e0900a3017127f13553cacedb7e756">shortlog</a> |
<a href="/comm-central/log/eb19b4c513e0900a3017127f13553cacedb7e756">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/eb19b4c513e0900a3017127f13553cacedb7e756">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/eb19b4c513e0900a3017127f13553cacedb7e756">files</a> |
changeset |
<a href="/comm-central/raw-rev/eb19b4c513e0900a3017127f13553cacedb7e756">raw</a>  | <a href="/comm-central/archive/eb19b4c513e0900a3017127f13553cacedb7e756.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=685480">Bug 685480</a> - Also port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=584474">Bug 584474</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=644987">Bug 644987</a>, and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=683875">Bug 683875</a>. r=Standard8 a=Callek for this CLOSED TREE.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#105;&#107;&#101;&#32;&#72;&#111;&#109;&#109;&#101;&#121;&#32;&#60;&#109;&#104;&#43;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#103;&#108;&#97;&#110;&#100;&#105;&#117;&#109;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 15 Sep 2011 17:13:53 +0200</td></tr>

<tr>
 <td>changeset 8497</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/eb19b4c513e0900a3017127f13553cacedb7e756">eb19b4c513e0900a3017127f13553cacedb7e756</a></td>
</tr>



<tr>
<td>parent 8496</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5359e5422f12ea72ef9a2535f6c3cc35964c51fa">5359e5422f12ea72ef9a2535f6c3cc35964c51fa</a>
</td>
</tr>

<tr>
<td>child 8498</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8094d209fa88281c9f6bae1d02b205fdc163bf97">8094d209fa88281c9f6bae1d02b205fdc163bf97</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=eb19b4c513e0900a3017127f13553cacedb7e756">6524</a></td></tr>
<tr><td>push user</td><td>khuey@mozilla.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 16 Sep 2011 00:23:56 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@eb19b4c513e0 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=eb19b4c513e0900a3017127f13553cacedb7e756">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=eb19b4c513e0900a3017127f13553cacedb7e756&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=eb19b4c513e0900a3017127f13553cacedb7e756&newProject=comm-central&newRevision=5359e5422f12ea72ef9a2535f6c3cc35964c51fa&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=eb19b4c513e0900a3017127f13553cacedb7e756&newProject=comm-central&newRevision=5359e5422f12ea72ef9a2535f6c3cc35964c51fa&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=eb19b4c513e0900a3017127f13553cacedb7e756&newProject=comm-central&newRevision=5359e5422f12ea72ef9a2535f6c3cc35964c51fa&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a>, <a href="/comm-central/log?rev=reviewer%28Callek%29&revcount=50">Callek</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=685480">685480</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=584474">584474</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=644987">644987</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=683875">683875</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=685480">Bug 685480</a> - Also port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=584474">Bug 584474</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=644987">Bug 644987</a>, and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=683875">Bug 683875</a>. r=Standard8 a=Callek for this CLOSED TREE.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb19b4c513e0900a3017127f13553cacedb7e756/config/config.mk">config/config.mk</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb19b4c513e0900a3017127f13553cacedb7e756/config/config.mk">file</a> |
<a href="/comm-central/annotate/eb19b4c513e0900a3017127f13553cacedb7e756/config/config.mk">annotate</a> |
<a href="/comm-central/diff/eb19b4c513e0900a3017127f13553cacedb7e756/config/config.mk">diff</a> |
<a href="/comm-central/comparison/eb19b4c513e0900a3017127f13553cacedb7e756/config/config.mk">comparison</a> |
<a href="/comm-central/log/eb19b4c513e0900a3017127f13553cacedb7e756/config/config.mk">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb19b4c513e0900a3017127f13553cacedb7e756/config/rules.mk">config/rules.mk</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb19b4c513e0900a3017127f13553cacedb7e756/config/rules.mk">file</a> |
<a href="/comm-central/annotate/eb19b4c513e0900a3017127f13553cacedb7e756/config/rules.mk">annotate</a> |
<a href="/comm-central/diff/eb19b4c513e0900a3017127f13553cacedb7e756/config/rules.mk">diff</a> |
<a href="/comm-central/comparison/eb19b4c513e0900a3017127f13553cacedb7e756/config/rules.mk">comparison</a> |
<a href="/comm-central/log/eb19b4c513e0900a3017127f13553cacedb7e756/config/rules.mk">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb19b4c513e0900a3017127f13553cacedb7e756/configure.in">configure.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb19b4c513e0900a3017127f13553cacedb7e756/configure.in">file</a> |
<a href="/comm-central/annotate/eb19b4c513e0900a3017127f13553cacedb7e756/configure.in">annotate</a> |
<a href="/comm-central/diff/eb19b4c513e0900a3017127f13553cacedb7e756/configure.in">diff</a> |
<a href="/comm-central/comparison/eb19b4c513e0900a3017127f13553cacedb7e756/configure.in">comparison</a> |
<a href="/comm-central/log/eb19b4c513e0900a3017127f13553cacedb7e756/configure.in">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/config/config.mk</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/config/config.mk</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -260,20 +260,16 @@ endif</span>
<a href="#l1.4"></a><span id="l1.4"> endif</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> ifndef STATIC_LIBRARY_NAME</span>
<a href="#l1.7"></a><span id="l1.7"> ifdef LIBRARY_NAME</span>
<a href="#l1.8"></a><span id="l1.8"> STATIC_LIBRARY_NAME=$(LIBRARY_NAME)</span>
<a href="#l1.9"></a><span id="l1.9"> endif</span>
<a href="#l1.10"></a><span id="l1.10"> endif</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-ifeq (WINNT,$(OS_ARCH))</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-MOZ_FAKELIBS = 1</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-endif</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-</span>
<a href="#l1.16"></a><span id="l1.16"> # This comes from configure</span>
<a href="#l1.17"></a><span id="l1.17"> ifdef MOZ_PROFILE_GUIDED_OPTIMIZE_DISABLE</span>
<a href="#l1.18"></a><span id="l1.18"> NO_PROFILE_GUIDED_OPTIMIZE = 1</span>
<a href="#l1.19"></a><span id="l1.19"> endif</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21"> # Enable profile-based feedback</span>
<a href="#l1.22"></a><span id="l1.22"> ifndef NO_PROFILE_GUIDED_OPTIMIZE</span>
<a href="#l1.23"></a><span id="l1.23"> ifdef MOZ_PROFILE_GENERATE</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineat">@@ -595,17 +591,17 @@ endif</span>
<a href="#l1.25"></a><span id="l1.25"> ######################################################################</span>
<a href="#l1.26"></a><span id="l1.26"> # Now test variables that might have been set or overridden by $(MY_CONFIG).</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28"> DEFINES		+= -DOSTYPE=\&quot;$(OS_CONFIG)\&quot;</span>
<a href="#l1.29"></a><span id="l1.29"> DEFINES		+= -DOSARCH=$(OS_ARCH)</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31"> ######################################################################</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-GARBAGE		+= $(DEPENDENCIES) $(MKDEPENDENCIES) $(MKDEPENDENCIES).bak core $(wildcard core.[0-9]*) $(wildcard *.err) $(wildcard *.pure) $(wildcard *_pure_*.o) Templates.DB $(FAKE_LIBRARY)</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+GARBAGE		+= $(DEPENDENCIES) $(MKDEPENDENCIES) $(MKDEPENDENCIES).bak core $(wildcard core.[0-9]*) $(wildcard *.err) $(wildcard *.pure) $(wildcard *_pure_*.o) Templates.DB</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36"> ifeq ($(OS_ARCH),Darwin)</span>
<a href="#l1.37"></a><span id="l1.37"> ifndef NSDISTMODE</span>
<a href="#l1.38"></a><span id="l1.38"> NSDISTMODE=absolute_symlink</span>
<a href="#l1.39"></a><span id="l1.39"> endif</span>
<a href="#l1.40"></a><span id="l1.40"> PWD := $(CURDIR)</span>
<a href="#l1.41"></a><span id="l1.41"> endif</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43" class="difflineat">@@ -698,8 +694,18 @@ endif # ! WINCE</span>
<a href="#l1.44"></a><span id="l1.44"> ifdef TIERS</span>
<a href="#l1.45"></a><span id="l1.45"> DIRS += $(foreach tier,$(TIERS),$(tier_$(tier)_dirs))</span>
<a href="#l1.46"></a><span id="l1.46"> STATIC_DIRS += $(foreach tier,$(TIERS),$(tier_$(tier)_staticdirs))</span>
<a href="#l1.47"></a><span id="l1.47"> endif</span>
<a href="#l1.48"></a><span id="l1.48"> </span>
<a href="#l1.49"></a><span id="l1.49"> OPTIMIZE_JARS_CMD = $(PYTHON) $(call core_abspath,$(MOZILLA_SRCDIR)/config/optimizejars.py)</span>
<a href="#l1.50"></a><span id="l1.50"> </span>
<a href="#l1.51"></a><span id="l1.51"> CREATE_PRECOMPLETE_CMD = $(PYTHON) $(call core_abspath,$(MOZILLA_SRCDIR)/config/createprecomplete.py)</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+LIBS_DESC_SUFFIX = desc</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+EXPAND_LIBS = $(PYTHON) -I$(MOZDEPTH)/config $(MOZILLA_SRCDIR)/config/expandlibs.py</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+EXPAND_LIBS_EXEC = $(PYTHON) $(MOZILLA_SRCDIR)/config/pythonpath.py -I$(MOZDEPTH)/config $(MOZILLA_SRCDIR)/config/expandlibs_exec.py</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+EXPAND_LIBS_GEN = $(PYTHON) $(MOZILLA_SRCDIR)/config/pythonpath.py -I$(MOZDEPTH)/config $(MOZILLA_SRCDIR)/config/expandlibs_gen.py</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+EXPAND_AR = $(EXPAND_LIBS_EXEC) --extract -- $(AR)</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+EXPAND_CC = $(EXPAND_LIBS_EXEC) --uselist -- $(CC)</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+EXPAND_CCC = $(EXPAND_LIBS_EXEC) --uselist -- $(CCC)</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+EXPAND_LD = $(EXPAND_LIBS_EXEC) --uselist -- $(LD)</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+EXPAND_MKSHLIB = $(EXPAND_LIBS_EXEC) --uselist -- $(MKSHLIB)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/config/rules.mk</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/config/rules.mk</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -78,68 +78,44 @@ endif</span>
<a href="#l2.4"></a><span id="l2.4"> # ELOG prints out failed command when building silently (gmake -s).</span>
<a href="#l2.5"></a><span id="l2.5"> ifneq (,$(findstring -s,$(MAKEFLAGS)))</span>
<a href="#l2.6"></a><span id="l2.6">   ELOG := $(EXEC) sh $(BUILD_TOOLS)/print-failed-commands.sh</span>
<a href="#l2.7"></a><span id="l2.7"> else</span>
<a href="#l2.8"></a><span id="l2.8">   ELOG :=</span>
<a href="#l2.9"></a><span id="l2.9"> endif</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> ifeq (,$(filter-out WINNT WINCE,$(OS_ARCH)))</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-ifndef GNU_CC</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-_LIBNAME_RELATIVE_PATHS=1</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-endif</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-endif</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-ifeq (,$(filter-out WINNT WINCE,$(OS_ARCH)))</span>
<a href="#l2.18"></a><span id="l2.18"> _VPATH_SRCS = $(abspath $&lt;)</span>
<a href="#l2.19"></a><span id="l2.19"> else</span>
<a href="#l2.20"></a><span id="l2.20"> _VPATH_SRCS = $&lt;</span>
<a href="#l2.21"></a><span id="l2.21"> endif</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23"> # Add $(DIST)/lib to VPATH so that -lfoo dependencies are followed</span>
<a href="#l2.24"></a><span id="l2.24"> VPATH += $(DIST)/lib</span>
<a href="#l2.25"></a><span id="l2.25"> ifdef LIBXUL_SDK</span>
<a href="#l2.26"></a><span id="l2.26"> VPATH += $(LIBXUL_SDK)/lib</span>
<a href="#l2.27"></a><span id="l2.27"> endif</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29"> # EXPAND_LIBNAME - $(call EXPAND_LIBNAME,foo)</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-# expands to foo.lib on platforms with import libs and -lfoo otherwise</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+# expands to $(LIB_PREFIX)foo.$(LIB_SUFFIX) or -lfoo, depending on linker</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+# arguments syntax. Should only be used for system libraries</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34"> # EXPAND_LIBNAME_PATH - $(call EXPAND_LIBNAME_PATH,foo,dir)</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-# expands to dir/foo.lib on platforms with import libs and</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-# -Ldir -lfoo otherwise</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+# expands to dir/$(LIB_PREFIX)foo.$(LIB_SUFFIX)</span>
<a href="#l2.38"></a><span id="l2.38"> </span>
<a href="#l2.39"></a><span id="l2.39"> # EXPAND_MOZLIBNAME - $(call EXPAND_MOZLIBNAME,foo)</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-# expands to $(DIST)/lib/foo.lib on platforms with import libs and</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-# -lfoo otherwise</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+# expands to $(DIST)/lib/$(LIB_PREFIX)foo.$(LIB_SUFFIX)</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-ifdef _LIBNAME_RELATIVE_PATHS</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+ifdef GNU_CC</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+EXPAND_LIBNAME = $(addprefix -l,$(1))</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+else</span>
<a href="#l2.48"></a><span id="l2.48"> EXPAND_LIBNAME = $(foreach lib,$(1),$(LIB_PREFIX)$(lib).$(LIB_SUFFIX))</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+endif</span>
<a href="#l2.50"></a><span id="l2.50"> EXPAND_LIBNAME_PATH = $(foreach lib,$(1),$(2)/$(LIB_PREFIX)$(lib).$(LIB_SUFFIX))</span>
<a href="#l2.51"></a><span id="l2.51"> EXPAND_MOZLIBNAME = $(foreach lib,$(1),$(DIST)/lib/$(LIB_PREFIX)$(lib).$(LIB_SUFFIX))</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-else</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-EXPAND_LIBNAME = $(addprefix -l,$(1))</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-EXPAND_LIBNAME_PATH = -L$(2) $(addprefix -l,$(1))</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-EXPAND_MOZLIBNAME = $(addprefix -l,$(1))</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-endif</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-ifdef MOZ_FAKELIBS</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-# If a lib.fake is present, replace it with @lib.fake, otherwise just pass</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-# the library name through unchanged.</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-EXPAND_FAKELIBS = $(foreach f,$(1),$(if $(wildcard $(f).fake),@$(wildcard $(f).fake),$(f)))</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-# Also override EXPAND_LIBNAME_PATH and EXPAND_MOZLIBNAME on non-RELATIVE_PATH</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-# platforms, so we can shortcut linking -lfoo if we have foo.a.fake</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-ifndef _LIBNAME_RELATIVE_PATHS</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-EXPAND_LIBNAME_PATH = $(if $(wildcard $(2)/$(LIB_PREFIX)$(1).$(LIB_SUFFIX).fake),@$(2)/$(LIB_PREFIX)$(1).$(LIB_SUFFIX).fake,-L$(2) $(addprefix -l,$(1)))</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-EXPAND_MOZLIBNAME = $(if $(wildcard $(DIST)/lib/$(LIB_PREFIX)$(1).$(LIB_SUFFIX).fake),@$(DIST)/lib/$(LIB_PREFIX)$(1).$(LIB_SUFFIX).fake,$(addprefix -l,$(1)))</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-endif</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-else</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-EXPAND_FAKELIBS = $1</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-endif</span>
<a href="#l2.72"></a><span id="l2.72"> </span>
<a href="#l2.73"></a><span id="l2.73"> ifdef EXTRA_DSO_LIBS</span>
<a href="#l2.74"></a><span id="l2.74"> EXTRA_DSO_LIBS	:= $(call EXPAND_MOZLIBNAME,$(EXTRA_DSO_LIBS))</span>
<a href="#l2.75"></a><span id="l2.75"> endif</span>
<a href="#l2.76"></a><span id="l2.76"> </span>
<a href="#l2.77"></a><span id="l2.77"> ################################################################################</span>
<a href="#l2.78"></a><span id="l2.78"> # Testing frameworks support</span>
<a href="#l2.79"></a><span id="l2.79"> ################################################################################</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineat">@@ -240,22 +216,23 @@ endif # ENABLE_TESTS</span>
<a href="#l2.81"></a><span id="l2.81"> # Library rules</span>
<a href="#l2.82"></a><span id="l2.82"> #</span>
<a href="#l2.83"></a><span id="l2.83"> # If FORCE_STATIC_LIB is set, build a static library.</span>
<a href="#l2.84"></a><span id="l2.84"> # Otherwise, build a shared library.</span>
<a href="#l2.85"></a><span id="l2.85"> #</span>
<a href="#l2.86"></a><span id="l2.86"> </span>
<a href="#l2.87"></a><span id="l2.87"> ifndef LIBRARY</span>
<a href="#l2.88"></a><span id="l2.88"> ifdef STATIC_LIBRARY_NAME</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-LIBRARY			:= $(LIB_PREFIX)$(STATIC_LIBRARY_NAME).$(LIB_SUFFIX)</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-ifdef MOZ_FAKELIBS</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-ifndef SUPPRESS_FAKELIB</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-FAKE_LIBRARY = $(LIBRARY).fake</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-endif # SUPPRESS_FAKELIB</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-endif # MOZ_FAKELIBS</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+REAL_LIBRARY		:= $(LIB_PREFIX)$(STATIC_LIBRARY_NAME).$(LIB_SUFFIX)</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+# Only build actual library if it is installed in DIST/lib or SDK</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+ifeq (,$(SDK_LIBRARY)$(DIST_INSTALL)$(NO_EXPAND_LIBS))</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+LIBRARY			:= $(REAL_LIBRARY).$(LIBS_DESC_SUFFIX)</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+else</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+LIBRARY			:= $(REAL_LIBRARY) $(REAL_LIBRARY).$(LIBS_DESC_SUFFIX)</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+endif</span>
<a href="#l2.102"></a><span id="l2.102"> endif # STATIC_LIBRARY_NAME</span>
<a href="#l2.103"></a><span id="l2.103"> endif # LIBRARY</span>
<a href="#l2.104"></a><span id="l2.104"> </span>
<a href="#l2.105"></a><span id="l2.105"> ifndef HOST_LIBRARY</span>
<a href="#l2.106"></a><span id="l2.106"> ifdef HOST_LIBRARY_NAME</span>
<a href="#l2.107"></a><span id="l2.107"> HOST_LIBRARY		:= $(LIB_PREFIX)$(HOST_LIBRARY_NAME).$(LIB_SUFFIX)</span>
<a href="#l2.108"></a><span id="l2.108"> endif</span>
<a href="#l2.109"></a><span id="l2.109"> endif</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineat">@@ -529,26 +506,16 @@ TAG_PROGRAM		= xargs etags -a</span>
<a href="#l2.111"></a><span id="l2.111"> # (moved this from config.mk so that config.mk can be included </span>
<a href="#l2.112"></a><span id="l2.112"> #  before the CPPSRCS are defined)</span>
<a href="#l2.113"></a><span id="l2.113"> #</span>
<a href="#l2.114"></a><span id="l2.114"> ifneq ($(CPPSRCS)$(CMMSRCS),)</span>
<a href="#l2.115"></a><span id="l2.115"> CPP_PROG_LINK		= 1</span>
<a href="#l2.116"></a><span id="l2.116"> endif</span>
<a href="#l2.117"></a><span id="l2.117"> </span>
<a href="#l2.118"></a><span id="l2.118"> #</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineminus">-# Make sure to wrap static libs inside linker specific flags to turn on &amp; off</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineminus">-# inclusion of all symbols inside the static libs</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-#</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-ifndef NO_LD_ARCHIVE_FLAGS</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-ifdef SHARED_LIBRARY_LIBS</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-EXTRA_DSO_LDOPTS := $(MKSHLIB_FORCE_ALL) $(call EXPAND_FAKELIBS,$(SHARED_LIBRARY_LIBS)) $(MKSHLIB_UNFORCE_ALL) $(EXTRA_DSO_LDOPTS)</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-endif</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-endif</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineminus">-</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineminus">-#</span>
<a href="#l2.129"></a><span id="l2.129"> # This will strip out symbols that the component should not be </span>
<a href="#l2.130"></a><span id="l2.130"> # exporting from the .dynsym section.</span>
<a href="#l2.131"></a><span id="l2.131"> #</span>
<a href="#l2.132"></a><span id="l2.132"> ifdef IS_COMPONENT</span>
<a href="#l2.133"></a><span id="l2.133"> EXTRA_DSO_LDOPTS += $(MOZ_COMPONENTS_VERSION_SCRIPT_LDFLAGS)</span>
<a href="#l2.134"></a><span id="l2.134"> endif # IS_COMPONENT</span>
<a href="#l2.135"></a><span id="l2.135"> </span>
<a href="#l2.136"></a><span id="l2.136"> #</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineat">@@ -816,58 +783,55 @@ export::</span>
<a href="#l2.138"></a><span id="l2.138"> ifdef LIBRARY_NAME</span>
<a href="#l2.139"></a><span id="l2.139"> ifdef EXPORT_LIBRARY</span>
<a href="#l2.140"></a><span id="l2.140"> ifndef IS_COMPONENT</span>
<a href="#l2.141"></a><span id="l2.141"> 	$(PYTHON) $(MOZILLA_DIR)/config/buildlist.py $(FINAL_LINK_LIBS) $(STATIC_LIBRARY_NAME)</span>
<a href="#l2.142"></a><span id="l2.142"> endif # !IS_COMPONENT</span>
<a href="#l2.143"></a><span id="l2.143"> endif # EXPORT_LIBRARY</span>
<a href="#l2.144"></a><span id="l2.144"> endif # LIBRARY_NAME</span>
<a href="#l2.145"></a><span id="l2.145"> </span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-# Create dependencies on static (and shared EXTRA_DSO_LIBS) libraries</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-LIBS_DEPS = $(filter %.$(LIB_SUFFIX), $(LIBS))</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-HOST_LIBS_DEPS = $(filter %.$(LIB_SUFFIX), $(HOST_LIBS))</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-DSO_LDOPTS_DEPS = $(EXTRA_DSO_LIBS) $(filter %.$(LIB_SUFFIX), $(EXTRA_DSO_LDOPTS))</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-ifndef _LIBNAME_RELATIVE_PATHS</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineminus">-LIBS_DEPS += $(filter -l%, $(LIBS))</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineminus">-HOST_LIBS_DEPS += $(filter -l%, $(HOST_LIBS))</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineminus">-DSO_LDOPTS_DEPS += $(filter -l%, $(EXTRA_DSO_LDOPTS))</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineplus">+ifneq (,$(filter-out %.$(LIB_SUFFIX),$(SHARED_LIBRARY_LIBS)))</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+$(error SHARED_LIBRARY_LIBS must contain .$(LIB_SUFFIX) files only)</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineplus">+endif</span>
<a href="#l2.159"></a><span id="l2.159"> </span>
<a href="#l2.160"></a><span id="l2.160" class="difflineminus">-_LIBDIRS = $(patsubst -L%,%,$(filter -L%, $(LIBS) $(HOST_LIBS) $(EXTRA_DSO_LDOPTS)))</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineminus">-ifneq (,$(_LIBDIRS))</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineminus">-vpath $(LIB_PREFIX)%.$(LIB_SUFFIX) $(_LIBDIRS)</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineminus">-ifdef IMPORT_LIB_SUFFIX</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineminus">-vpath $(LIB_PREFIX)%.$(IMPORT_LIB_SUFFIX) $(_LIBDIRS)</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-endif # IMPORT_LIB_SUFFIX</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineminus">-vpath $(DLL_PREFIX)%$(DLL_SUFFIX) $(_LIBDIRS)</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineminus">-endif # _LIBDIRS</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineminus">-</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineminus">-endif # _LIBNAME_RELATIVE_PATHS</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineplus">+DO_EXPAND_LIBS = $(foreach f,$(1),$(if $(filter %.$(LIB_SUFFIX),$(f)),$(if $(wildcard $(f).$(LIBS_DESC_SUFFIX)),$(f).$(LIBS_DESC_SUFFIX),$(if $(wildcard $(f)),$(f)))))</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineplus">+LIBS_DEPS = $(call DO_EXPAND_LIBS,$(filter %.$(LIB_SUFFIX),$(LIBS)))</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+SHARED_LIBRARY_LIBS_DEPS = $(call DO_EXPAND_LIBS,$(SHARED_LIBRARY_LIBS))</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+HOST_LIBS_DEPS = $(filter %.$(LIB_SUFFIX),$(HOST_LIBS))</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineplus">+DSO_LDOPTS_DEPS = $(call DO_EXPAND_LIBS,$(EXTRA_DSO_LIBS) $(filter %.$(LIB_SUFFIX), $(EXTRA_DSO_LDOPTS)))</span>
<a href="#l2.175"></a><span id="l2.175"> </span>
<a href="#l2.176"></a><span id="l2.176"> # Dependencies which, if modified, should cause everything to rebuild</span>
<a href="#l2.177"></a><span id="l2.177"> GLOBAL_DEPS += Makefile Makefile.in $(DEPTH)/config/autoconf.mk $(topsrcdir)/config/config.mk</span>
<a href="#l2.178"></a><span id="l2.178"> </span>
<a href="#l2.179"></a><span id="l2.179"> ##############################################</span>
<a href="#l2.180"></a><span id="l2.180"> ifdef PARALLEL_DIRS</span>
<a href="#l2.181"></a><span id="l2.181"> libs:: $(PARALLEL_DIRS_libs)</span>
<a href="#l2.182"></a><span id="l2.182"> </span>
<a href="#l2.183"></a><span id="l2.183"> $(PARALLEL_DIRS_libs): %_libs: %/Makefile</span>
<a href="#l2.184"></a><span id="l2.184"> 	+@$(call SUBMAKE,libs,$*)</span>
<a href="#l2.185"></a><span id="l2.185"> endif</span>
<a href="#l2.186"></a><span id="l2.186"> </span>
<a href="#l2.187"></a><span id="l2.187" class="difflineplus">+ifdef EXPORT_LIBRARY</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+ifeq ($(EXPORT_LIBRARY),1)</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineplus">+ifdef IS_COMPONENT</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineplus">+EXPORT_LIBRARY = $(MOZDEPTH)/staticlib/components</span>
<a href="#l2.191"></a><span id="l2.191" class="difflineplus">+else</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineplus">+EXPORT_LIBRARY = $(MOZDEPTH)/staticlib</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineplus">+endif</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineplus">+else</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineplus">+# If EXPORT_LIBRARY has a value, we'll be installing there. We also need to cleanup there</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineplus">+GARBAGE += $(foreach lib,$(LIBRARY),$(EXPORT_LIBRARY)/$(lib))</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineplus">+endif</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineplus">+endif # EXPORT_LIBRARY</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineplus">+</span>
<a href="#l2.200"></a><span id="l2.200"> libs:: $(SUBMAKEFILES) $(MAKE_DIRS) $(HOST_LIBRARY) $(LIBRARY) $(SHARED_LIBRARY) $(IMPORT_LIBRARY) $(HOST_PROGRAM) $(PROGRAM) $(HOST_SIMPLE_PROGRAMS) $(SIMPLE_PROGRAMS)</span>
<a href="#l2.201"></a><span id="l2.201"> ifndef NO_DIST_INSTALL</span>
<a href="#l2.202"></a><span id="l2.202"> ifdef LIBRARY</span>
<a href="#l2.203"></a><span id="l2.203"> ifdef EXPORT_LIBRARY # Stage libs that will be linked into a static build</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineminus">-ifdef IS_COMPONENT</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineminus">-	$(INSTALL) $(IFLAGS1) $(LIBRARY) $(FAKE_LIBRARY) $(MOZDEPTH)/staticlib/components</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineminus">-else</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineminus">-	$(INSTALL) $(IFLAGS1) $(LIBRARY) $(FAKE_LIBRARY) $(MOZDEPTH)/staticlib</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineminus">-endif</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineplus">+	$(INSTALL) $(IFLAGS1) $(LIBRARY) $(EXPORT_LIBRARY)</span>
<a href="#l2.210"></a><span id="l2.210"> endif # EXPORT_LIBRARY</span>
<a href="#l2.211"></a><span id="l2.211"> ifdef DIST_INSTALL</span>
<a href="#l2.212"></a><span id="l2.212"> ifdef IS_COMPONENT</span>
<a href="#l2.213"></a><span id="l2.213"> 	$(error Shipping static component libs makes no sense.)</span>
<a href="#l2.214"></a><span id="l2.214"> else</span>
<a href="#l2.215"></a><span id="l2.215"> 	$(INSTALL) $(IFLAGS1) $(LIBRARY) $(DIST)/lib</span>
<a href="#l2.216"></a><span id="l2.216"> endif</span>
<a href="#l2.217"></a><span id="l2.217"> endif # DIST_INSTALL</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineat">@@ -978,20 +942,20 @@ alltags:</span>
<a href="#l2.219"></a><span id="l2.219"> </span>
<a href="#l2.220"></a><span id="l2.220"> #</span>
<a href="#l2.221"></a><span id="l2.221"> # PROGRAM = Foo</span>
<a href="#l2.222"></a><span id="l2.222"> # creates OBJS, links with LIBS to create Foo</span>
<a href="#l2.223"></a><span id="l2.223"> #</span>
<a href="#l2.224"></a><span id="l2.224"> $(PROGRAM): $(PROGOBJS) $(LIBS_DEPS) $(EXTRA_DEPS) $(EXE_DEF_FILE) $(RESFILE) $(GLOBAL_DEPS)</span>
<a href="#l2.225"></a><span id="l2.225"> 	@rm -f $@.manifest</span>
<a href="#l2.226"></a><span id="l2.226"> ifeq (WINCE,$(OS_ARCH))</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineminus">-	$(LD) -NOLOGO -OUT:$@ $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(PROGOBJS) $(RESFILE) $(call EXPAND_FAKELIBS,$(LIBS) $(EXTRA_LIBS) $(OS_LIBS))</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineplus">+	$(EXPAND_LD) -NOLOGO -OUT:$@ $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(PROGOBJS) $(RESFILE) $(LIBS) $(EXTRA_LIBS) $(OS_LIBS)</span>
<a href="#l2.229"></a><span id="l2.229"> else</span>
<a href="#l2.230"></a><span id="l2.230"> ifeq (_WINNT,$(GNU_CC)_$(OS_ARCH))</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineminus">-	$(LD) -NOLOGO -OUT:$@ -PDB:$(LINK_PDBFILE) $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(PROGOBJS) $(RESFILE) $(call EXPAND_FAKELIBS,$(LIBS) $(EXTRA_LIBS) $(OS_LIBS))</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineplus">+	$(EXPAND_LD) -NOLOGO -OUT:$@ -PDB:$(LINK_PDBFILE) $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(PROGOBJS) $(RESFILE) $(LIBS) $(EXTRA_LIBS) $(OS_LIBS)</span>
<a href="#l2.233"></a><span id="l2.233"> ifdef MSMANIFEST_TOOL</span>
<a href="#l2.234"></a><span id="l2.234"> 	@if test -f $@.manifest; then \</span>
<a href="#l2.235"></a><span id="l2.235"> 		if test -f &quot;$(srcdir)/$@.manifest&quot;; then \</span>
<a href="#l2.236"></a><span id="l2.236"> 			echo &quot;Embedding manifest from $(srcdir)/$@.manifest and $@.manifest&quot;; \</span>
<a href="#l2.237"></a><span id="l2.237"> 			mt.exe -NOLOGO -MANIFEST &quot;$(win_srcdir)/$@.manifest&quot; $@.manifest -OUTPUTRESOURCE:$@\;1; \</span>
<a href="#l2.238"></a><span id="l2.238"> 		else \</span>
<a href="#l2.239"></a><span id="l2.239"> 			echo &quot;Embedding manifest from $@.manifest&quot;; \</span>
<a href="#l2.240"></a><span id="l2.240"> 			mt.exe -NOLOGO -MANIFEST $@.manifest -OUTPUTRESOURCE:$@\;1; \</span>
<a href="#l2.241"></a><span id="l2.241" class="difflineat">@@ -1003,19 +967,19 @@ ifdef MSMANIFEST_TOOL</span>
<a href="#l2.242"></a><span id="l2.242"> endif	# MSVC with manifest tool</span>
<a href="#l2.243"></a><span id="l2.243"> ifdef MOZ_PROFILE_GENERATE</span>
<a href="#l2.244"></a><span id="l2.244"> # touch it a few seconds into the future to work around FAT's</span>
<a href="#l2.245"></a><span id="l2.245"> # 2-second granularity</span>
<a href="#l2.246"></a><span id="l2.246"> 	touch -t `date +%Y%m%d%H%M.%S -d &quot;now+5seconds&quot;` pgo.relink</span>
<a href="#l2.247"></a><span id="l2.247"> endif</span>
<a href="#l2.248"></a><span id="l2.248"> else # !WINNT || GNU_CC</span>
<a href="#l2.249"></a><span id="l2.249"> ifeq ($(CPP_PROG_LINK),1)</span>
<a href="#l2.250"></a><span id="l2.250" class="difflineminus">-	$(CCC) -o $@ $(CXXFLAGS) $(WRAP_MALLOC_CFLAGS) $(PROGOBJS) $(RESFILE) $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS_DIR) $(call EXPAND_FAKELIBS,$(LIBS) $(OS_LIBS) $(EXTRA_LIBS)) $(BIN_FLAGS) $(call EXPAND_FAKELIBS,$(WRAP_MALLOC_LIB)) $(EXE_DEF_FILE)</span>
<a href="#l2.251"></a><span id="l2.251" class="difflineplus">+	$(EXPAND_CCC) -o $@ $(CXXFLAGS) $(WRAP_MALLOC_CFLAGS) $(PROGOBJS) $(RESFILE) $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS_DIR) $(LIBS) $(OS_LIBS) $(EXTRA_LIBS) $(BIN_FLAGS) $(WRAP_MALLOC_LIB) $(EXE_DEF_FILE)</span>
<a href="#l2.252"></a><span id="l2.252"> else # ! CPP_PROG_LINK</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineminus">-	$(CC) -o $@ $(CFLAGS) $(PROGOBJS) $(RESFILE) $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS_DIR) $(call EXPAND_FAKELIBS,$(LIBS) $(OS_LIBS) $(EXTRA_LIBS)) $(BIN_FLAGS) $(EXE_DEF_FILE)</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineplus">+	$(EXPAND_CC) -o $@ $(CFLAGS) $(PROGOBJS) $(RESFILE) $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS_DIR) $(LIBS) $(OS_LIBS) $(EXTRA_LIBS) $(BIN_FLAGS) $(EXE_DEF_FILE)</span>
<a href="#l2.255"></a><span id="l2.255"> endif # CPP_PROG_LINK</span>
<a href="#l2.256"></a><span id="l2.256"> endif # WINNT &amp;&amp; !GNU_CC</span>
<a href="#l2.257"></a><span id="l2.257"> endif # WINCE</span>
<a href="#l2.258"></a><span id="l2.258"> </span>
<a href="#l2.259"></a><span id="l2.259"> ifdef ENABLE_STRIP</span>
<a href="#l2.260"></a><span id="l2.260"> 	$(STRIP) $@</span>
<a href="#l2.261"></a><span id="l2.261"> endif</span>
<a href="#l2.262"></a><span id="l2.262"> ifdef MOZ_POST_PROGRAM_COMMAND</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineat">@@ -1062,31 +1026,31 @@ endif</span>
<a href="#l2.264"></a><span id="l2.264"> # in one directory, it assumes everything to compile Foo is in</span>
<a href="#l2.265"></a><span id="l2.265"> # Foo.o (from either Foo.c or Foo.cpp).</span>
<a href="#l2.266"></a><span id="l2.266"> #</span>
<a href="#l2.267"></a><span id="l2.267"> # SIMPLE_PROGRAMS = Foo Bar</span>
<a href="#l2.268"></a><span id="l2.268"> # creates Foo.o Bar.o, links with LIBS to create Foo, Bar.</span>
<a href="#l2.269"></a><span id="l2.269"> #</span>
<a href="#l2.270"></a><span id="l2.270"> $(SIMPLE_PROGRAMS): %$(BIN_SUFFIX): %.$(OBJ_SUFFIX) $(LIBS_DEPS) $(EXTRA_DEPS) $(GLOBAL_DEPS)</span>
<a href="#l2.271"></a><span id="l2.271"> ifeq (WINCE,$(OS_ARCH))</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineminus">-	$(LD) -nologo  -entry:mainACRTStartup -out:$@ $&lt; $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(call EXPAND_FAKELIBS,$(LIBS) $(EXTRA_LIBS) $(OS_LIBS))</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineplus">+	$(EXPAND_LD) -nologo  -entry:mainACRTStartup -out:$@ $&lt; $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS) $(EXTRA_LIBS) $(OS_LIBS)</span>
<a href="#l2.274"></a><span id="l2.274"> else</span>
<a href="#l2.275"></a><span id="l2.275"> ifeq (_WINNT,$(GNU_CC)_$(OS_ARCH))</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineminus">-	$(LD) -nologo -out:$@ -pdb:$(LINK_PDBFILE) $&lt; $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(call EXPAND_FAKELIBS,$(LIBS) $(EXTRA_LIBS) $(OS_LIBS))</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineplus">+	$(EXPAND_LD) -nologo -out:$@ -pdb:$(LINK_PDBFILE) $&lt; $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS) $(EXTRA_LIBS) $(OS_LIBS)</span>
<a href="#l2.278"></a><span id="l2.278"> ifdef MSMANIFEST_TOOL</span>
<a href="#l2.279"></a><span id="l2.279"> 	@if test -f $@.manifest; then \</span>
<a href="#l2.280"></a><span id="l2.280"> 		mt.exe -NOLOGO -MANIFEST $@.manifest -OUTPUTRESOURCE:$@\;1; \</span>
<a href="#l2.281"></a><span id="l2.281"> 		rm -f $@.manifest; \</span>
<a href="#l2.282"></a><span id="l2.282"> 	fi</span>
<a href="#l2.283"></a><span id="l2.283"> endif	# MSVC with manifest tool</span>
<a href="#l2.284"></a><span id="l2.284"> else</span>
<a href="#l2.285"></a><span id="l2.285"> ifeq ($(CPP_PROG_LINK),1)</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineminus">-	$(CCC) $(WRAP_MALLOC_CFLAGS) $(CXXFLAGS) -o $@ $&lt; $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS_DIR) $(call EXPAND_FAKELIBS,$(LIBS) $(OS_LIBS) $(EXTRA_LIBS) $(WRAP_MALLOC_LIB)) $(BIN_FLAGS)</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineplus">+	$(EXPAND_CCC) $(WRAP_MALLOC_CFLAGS) $(CXXFLAGS) -o $@ $&lt; $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS_DIR) $(LIBS) $(OS_LIBS) $(EXTRA_LIBS) $(WRAP_MALLOC_LIB) $(BIN_FLAGS)</span>
<a href="#l2.288"></a><span id="l2.288"> else</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineminus">-	$(CC) $(WRAP_MALLOC_CFLAGS) $(CFLAGS) $(OUTOPTION)$@ $&lt; $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS_DIR) $(call EXPAND_FAKELIBS,$(LIBS) $(OS_LIBS) $(EXTRA_LIBS) $(WRAP_MALLOC_LIB)) $(BIN_FLAGS)</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineplus">+	$(EXPAND_CC) $(WRAP_MALLOC_CFLAGS) $(CFLAGS) $(OUTOPTION)$@ $&lt; $(WIN32_EXE_LDFLAGS) $(LDFLAGS) $(MOZ_UTILS_PROGRAM_LDFLAGS) $(LIBS_DIR) $(LIBS) $(OS_LIBS) $(EXTRA_LIBS) $(WRAP_MALLOC_LIB) $(BIN_FLAGS)</span>
<a href="#l2.291"></a><span id="l2.291"> endif # CPP_PROG_LINK</span>
<a href="#l2.292"></a><span id="l2.292"> endif # WINNT &amp;&amp; !GNU_CC</span>
<a href="#l2.293"></a><span id="l2.293"> endif # WINCE</span>
<a href="#l2.294"></a><span id="l2.294"> </span>
<a href="#l2.295"></a><span id="l2.295"> ifdef ENABLE_STRIP</span>
<a href="#l2.296"></a><span id="l2.296"> 	$(STRIP) $@</span>
<a href="#l2.297"></a><span id="l2.297"> endif</span>
<a href="#l2.298"></a><span id="l2.298"> ifdef MOZ_POST_PROGRAM_COMMAND</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineat">@@ -1128,83 +1092,29 @@ ifeq ($(CPP_PROG_LINK),1)</span>
<a href="#l2.300"></a><span id="l2.300"> 	$(QUANTIFY) $(CCC) -o $^.quantify $(CXXFLAGS) $(PROGOBJS) $(LDFLAGS) $(LIBS_DIR) $(LIBS) $(OS_LIBS) $(EXTRA_LIBS)</span>
<a href="#l2.301"></a><span id="l2.301"> else</span>
<a href="#l2.302"></a><span id="l2.302"> 	$(QUANTIFY) $(CC) -o $^.quantify $(CFLAGS) $(PROGOBJS) $(LDFLAGS) $(LIBS_DIR) $(LIBS) $(OS_LIBS) $(EXTRA_LIBS)</span>
<a href="#l2.303"></a><span id="l2.303"> endif</span>
<a href="#l2.304"></a><span id="l2.304"> ifndef NO_DIST_INSTALL</span>
<a href="#l2.305"></a><span id="l2.305"> 	$(INSTALL) $(IFLAGS2) $^.quantify $(FINAL_TARGET)</span>
<a href="#l2.306"></a><span id="l2.306"> endif</span>
<a href="#l2.307"></a><span id="l2.307"> </span>
<a href="#l2.308"></a><span id="l2.308" class="difflineminus">-#</span>
<a href="#l2.309"></a><span id="l2.309" class="difflineminus">-# This allows us to create static versions of the shared libraries</span>
<a href="#l2.310"></a><span id="l2.310" class="difflineminus">-# that are built using other static libraries.  Confused...?</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineminus">-#</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineminus">-ifdef SHARED_LIBRARY_LIBS</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineminus">-ifeq (,$(GNU_LD)$(filter-out OS2 WINNT WINCE, $(OS_ARCH)))</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineminus">-ifneq (,$(FORCE_STATIC_LIB))</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineminus">-LOBJS	+= $(SHARED_LIBRARY_LIBS)</span>
<a href="#l2.316"></a><span id="l2.316" class="difflineminus">-endif</span>
<a href="#l2.317"></a><span id="l2.317" class="difflineminus">-else</span>
<a href="#l2.318"></a><span id="l2.318" class="difflineminus">-NONFAKE_SHARED_LIBRARY_LIBS = $(filter-out %.fake,$(call EXPAND_FAKELIBS,$(SHARED_LIBRARY_LIBS)))</span>
<a href="#l2.319"></a><span id="l2.319" class="difflineminus">-ifeq (,$(NONFAKE_SHARED_LIBRARY_LIBS))</span>
<a href="#l2.320"></a><span id="l2.320" class="difflineminus">-# All of our SHARED_LIBRARY_LIBS have fake equivalents. Score!</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineminus">-# Just pass the original object files around.</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineminus">-# For shared libraries, these are already included in EXTRA_DSO_LDOPTS</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineminus">-# above.</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineminus">-ifndef SHARED_LIBRARY</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineminus">-LOBJS += $(shell cat $(addsuffix .fake,$(SHARED_LIBRARY_LIBS)))</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineminus">-endif</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineminus">-SKIP_SUB_LOBJS := 1</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineminus">-else</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineminus">-ifneq (,$(filter OSF1 BSD_OS FreeBSD NetBSD OpenBSD SunOS Darwin,$(OS_ARCH)))</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineminus">-CLEANUP1	:= | egrep -v '(________64ELEL_|__.SYMDEF)'</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineminus">-CLEANUP2	:= rm -f ________64ELEL_ __.SYMDEF</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineminus">-else</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineminus">-CLEANUP2	:= true</span>
<a href="#l2.334"></a><span id="l2.334" class="difflineminus">-endif</span>
<a href="#l2.335"></a><span id="l2.335" class="difflineminus">-SUB_LOBJS	= $(shell for lib in $(SHARED_LIBRARY_LIBS); do $(AR_LIST) $${lib} $(CLEANUP1); done;)</span>
<a href="#l2.336"></a><span id="l2.336" class="difflineminus">-endif # EXPAND_FAKELIBS</span>
<a href="#l2.337"></a><span id="l2.337" class="difflineminus">-endif # SHARED_LIBRARY_LIBS</span>
<a href="#l2.338"></a><span id="l2.338" class="difflineminus">-endif</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineminus">-ifdef MOZILLA_PROBE_LIBS</span>
<a href="#l2.340"></a><span id="l2.340" class="difflineminus">-PROBE_LOBJS	= $(shell for lib in $(MOZILLA_PROBE_LIBS); do $(AR_LIST) $${lib} $(CLEANUP1); done;)</span>
<a href="#l2.341"></a><span id="l2.341" class="difflineminus">-endif</span>
<a href="#l2.342"></a><span id="l2.342"> ifdef DTRACE_PROBE_OBJ</span>
<a href="#l2.343"></a><span id="l2.343"> EXTRA_DEPS += $(DTRACE_PROBE_OBJ)</span>
<a href="#l2.344"></a><span id="l2.344"> endif</span>
<a href="#l2.345"></a><span id="l2.345"> </span>
<a href="#l2.346"></a><span id="l2.346" class="difflineminus">-$(LIBRARY): $(OBJS) $(LOBJS) $(SHARED_LIBRARY_LIBS) $(EXTRA_DEPS) $(GLOBAL_DEPS)</span>
<a href="#l2.347"></a><span id="l2.347" class="difflineminus">-	rm -f $@</span>
<a href="#l2.348"></a><span id="l2.348" class="difflineminus">-ifndef SKIP_SUB_LOBJS</span>
<a href="#l2.349"></a><span id="l2.349" class="difflineminus">-ifneq (,$(GNU_LD)$(filter-out OS2 WINNT WINCE, $(OS_ARCH)))</span>
<a href="#l2.350"></a><span id="l2.350" class="difflineminus">-ifdef SHARED_LIBRARY_LIBS</span>
<a href="#l2.351"></a><span id="l2.351" class="difflineminus">-	@rm -f $(SUB_LOBJS)</span>
<a href="#l2.352"></a><span id="l2.352" class="difflineminus">-	@for lib in $(SHARED_LIBRARY_LIBS); do $(AR_EXTRACT) $${lib}; $(CLEANUP2); done</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineminus">-endif</span>
<a href="#l2.354"></a><span id="l2.354" class="difflineminus">-endif</span>
<a href="#l2.355"></a><span id="l2.355" class="difflineminus">-endif # SKIP_SUB_LOBJS</span>
<a href="#l2.356"></a><span id="l2.356" class="difflineminus">-	$(AR) $(AR_FLAGS) $(OBJS) $(LOBJS) $(SUB_LOBJS)</span>
<a href="#l2.357"></a><span id="l2.357" class="difflineplus">+$(filter %.$(LIB_SUFFIX),$(LIBRARY)): $(OBJS) $(LOBJS) $(SHARED_LIBRARY_LIBS_DEPS) $(EXTRA_DEPS) $(GLOBAL_DEPS)</span>
<a href="#l2.358"></a><span id="l2.358" class="difflineplus">+	rm -f $(LIBRARY)</span>
<a href="#l2.359"></a><span id="l2.359" class="difflineplus">+	$(EXPAND_AR) $(AR_FLAGS) $(OBJS) $(LOBJS) $(SHARED_LIBRARY_LIBS)</span>
<a href="#l2.360"></a><span id="l2.360"> 	$(RANLIB) $@</span>
<a href="#l2.361"></a><span id="l2.361" class="difflineminus">-ifndef MOZ_FAKELIBS</span>
<a href="#l2.362"></a><span id="l2.362" class="difflineminus">-# Don't clean these up if we're building a fake lib, because then</span>
<a href="#l2.363"></a><span id="l2.363" class="difflineminus">-# we'll reference nonexistent object files in our fake lib.</span>
<a href="#l2.364"></a><span id="l2.364" class="difflineminus">-	@rm -f foodummyfilefoo $(SUB_LOBJS)</span>
<a href="#l2.365"></a><span id="l2.365" class="difflineminus">-endif</span>
<a href="#l2.366"></a><span id="l2.366" class="difflineminus">-# Also produce a .fake file that just contains the names of the object files.</span>
<a href="#l2.367"></a><span id="l2.367" class="difflineminus">-# This can be used as a response file to the linker later instead of</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineminus">-# linking the actual static library.</span>
<a href="#l2.369"></a><span id="l2.369" class="difflineminus">-ifdef MOZ_FAKELIBS</span>
<a href="#l2.370"></a><span id="l2.370" class="difflineminus">-ifndef SUPPRESS_FAKELIB</span>
<a href="#l2.371"></a><span id="l2.371" class="difflineminus">-ifeq (WINNT_,$(HOST_OS_ARCH)_$(.PYMAKE))</span>
<a href="#l2.372"></a><span id="l2.372" class="difflineminus">-	echo &quot;$(strip $(foreach f,$(OBJS) $(SEPARATE_OBJS) $(LOBJS) $(SUB_LOBJS),$(subst \,\\,$(call core_winabspath,$(f))))) &quot; &gt; $@.fake</span>
<a href="#l2.373"></a><span id="l2.373" class="difflineminus">-else</span>
<a href="#l2.374"></a><span id="l2.374" class="difflineminus">-	echo &quot;$(strip $(foreach f,$(OBJS) $(SEPARATE_OBJS) $(LOBJS) $(SUB_LOBJS),$(call core_abspath,$(f)))) &quot; &gt; $@.fake</span>
<a href="#l2.375"></a><span id="l2.375" class="difflineminus">-endif</span>
<a href="#l2.376"></a><span id="l2.376" class="difflineminus">-endif</span>
<a href="#l2.377"></a><span id="l2.377" class="difflineminus">-endif</span>
<a href="#l2.378"></a><span id="l2.378" class="difflineplus">+</span>
<a href="#l2.379"></a><span id="l2.379" class="difflineplus">+$(filter-out %.$(LIB_SUFFIX),$(LIBRARY)): $(filter %.$(LIB_SUFFIX),$(LIBRARY)) $(OBJS) $(LOBJS) $(SHARED_LIBRARY_LIBS_DEPS) $(EXTRA_DEPS) $(GLOBAL_DEPS)</span>
<a href="#l2.380"></a><span id="l2.380" class="difflineplus">+# When we only build a library descriptor, blow out any existing library</span>
<a href="#l2.381"></a><span id="l2.381" class="difflineplus">+	$(if $(filter %.$(LIB_SUFFIX),$(LIBRARY)),,$(RM) $(REAL_LIBRARY) $(EXPORT_LIBRARY:%=%/$(REAL_LIBRARY)))</span>
<a href="#l2.382"></a><span id="l2.382" class="difflineplus">+	$(EXPAND_LIBS_GEN) $(OBJS) $(LOBJS) $(SHARED_LIBRARY_LIBS) &gt; $@</span>
<a href="#l2.383"></a><span id="l2.383"> </span>
<a href="#l2.384"></a><span id="l2.384"> ifeq (,$(filter-out WINNT WINCE, $(OS_ARCH)))</span>
<a href="#l2.385"></a><span id="l2.385"> $(IMPORT_LIBRARY): $(SHARED_LIBRARY)</span>
<a href="#l2.386"></a><span id="l2.386"> endif</span>
<a href="#l2.387"></a><span id="l2.387"> </span>
<a href="#l2.388"></a><span id="l2.388"> ifeq ($(OS_ARCH),OS2)</span>
<a href="#l2.389"></a><span id="l2.389"> $(DEF_FILE): $(OBJS) $(SHARED_LIBRARY_LIBS)</span>
<a href="#l2.390"></a><span id="l2.390"> 	rm -f $@</span>
<a href="#l2.391"></a><span id="l2.391" class="difflineat">@@ -1226,37 +1136,33 @@ endif</span>
<a href="#l2.392"></a><span id="l2.392"> 	$(RANLIB) $@</span>
<a href="#l2.393"></a><span id="l2.393"> endif # OS/2</span>
<a href="#l2.394"></a><span id="l2.394"> </span>
<a href="#l2.395"></a><span id="l2.395"> $(HOST_LIBRARY): $(HOST_OBJS) Makefile</span>
<a href="#l2.396"></a><span id="l2.396"> 	rm -f $@</span>
<a href="#l2.397"></a><span id="l2.397"> 	$(HOST_AR) $(HOST_AR_FLAGS) $(HOST_OBJS)</span>
<a href="#l2.398"></a><span id="l2.398"> 	$(HOST_RANLIB) $@</span>
<a href="#l2.399"></a><span id="l2.399"> </span>
<a href="#l2.400"></a><span id="l2.400" class="difflineminus">-ifdef NO_LD_ARCHIVE_FLAGS</span>
<a href="#l2.401"></a><span id="l2.401" class="difflineminus">-SUB_SHLOBJS = $(SUB_LOBJS)</span>
<a href="#l2.402"></a><span id="l2.402" class="difflineminus">-endif</span>
<a href="#l2.403"></a><span id="l2.403" class="difflineminus">-</span>
<a href="#l2.404"></a><span id="l2.404"> ifdef HAVE_DTRACE</span>
<a href="#l2.405"></a><span id="l2.405"> ifndef XP_MACOSX</span>
<a href="#l2.406"></a><span id="l2.406"> ifdef DTRACE_PROBE_OBJ</span>
<a href="#l2.407"></a><span id="l2.407"> ifndef DTRACE_LIB_DEPENDENT</span>
<a href="#l2.408"></a><span id="l2.408"> $(DTRACE_PROBE_OBJ): $(OBJS)</span>
<a href="#l2.409"></a><span id="l2.409"> 	dtrace -G -C -s $(MOZILLA_DTRACE_SRC) -o $(DTRACE_PROBE_OBJ) $(OBJS)</span>
<a href="#l2.410"></a><span id="l2.410"> endif</span>
<a href="#l2.411"></a><span id="l2.411"> endif</span>
<a href="#l2.412"></a><span id="l2.412"> endif</span>
<a href="#l2.413"></a><span id="l2.413"> endif</span>
<a href="#l2.414"></a><span id="l2.414"> </span>
<a href="#l2.415"></a><span id="l2.415"> # On Darwin (Mac OS X), dwarf2 debugging uses debug info left in .o files,</span>
<a href="#l2.416"></a><span id="l2.416"> # so instead of deleting .o files after repacking them into a dylib, we make</span>
<a href="#l2.417"></a><span id="l2.417"> # symlinks back to the originals. The symlinks are a no-op for stabs debugging,</span>
<a href="#l2.418"></a><span id="l2.418"> # so no need to conditionalize on OS version or debugging format.</span>
<a href="#l2.419"></a><span id="l2.419"> </span>
<a href="#l2.420"></a><span id="l2.420" class="difflineminus">-$(SHARED_LIBRARY): $(OBJS) $(LOBJS) $(DEF_FILE) $(RESFILE) $(SHARED_LIBRARY_LIBS) $(LIBRARY) $(EXTRA_DEPS) $(DSO_LDOPTS_DEPS) $(GLOBAL_DEPS)</span>
<a href="#l2.421"></a><span id="l2.421" class="difflineplus">+$(SHARED_LIBRARY): $(OBJS) $(LOBJS) $(DEF_FILE) $(RESFILE) $(SHARED_LIBRARY_LIBS_DEPS) $(LIBRARY) $(EXTRA_DEPS) $(DSO_LDOPTS_DEPS) $(GLOBAL_DEPS)</span>
<a href="#l2.422"></a><span id="l2.422"> ifndef INCREMENTAL_LINKER</span>
<a href="#l2.423"></a><span id="l2.423"> 	rm -f $@</span>
<a href="#l2.424"></a><span id="l2.424"> endif</span>
<a href="#l2.425"></a><span id="l2.425"> ifeq ($(OS_ARCH),OpenVMS)</span>
<a href="#l2.426"></a><span id="l2.426"> 	@if test ! -f $(VMS_SYMVEC_FILE); then \</span>
<a href="#l2.427"></a><span id="l2.427"> 	  if test -f $(VMS_SYMVEC_FILE_MODULE); then \</span>
<a href="#l2.428"></a><span id="l2.428"> 	    echo Creating specific component options file $(VMS_SYMVEC_FILE); \</span>
<a href="#l2.429"></a><span id="l2.429"> 	    cp $(VMS_SYMVEC_FILE_MODULE) $(VMS_SYMVEC_FILE); \</span>
<a href="#l2.430"></a><span id="l2.430" class="difflineat">@@ -1264,73 +1170,38 @@ ifeq ($(OS_ARCH),OpenVMS)</span>
<a href="#l2.431"></a><span id="l2.431"> 	fi</span>
<a href="#l2.432"></a><span id="l2.432"> ifdef IS_COMPONENT</span>
<a href="#l2.433"></a><span id="l2.433"> 	@if test ! -f $(VMS_SYMVEC_FILE); then \</span>
<a href="#l2.434"></a><span id="l2.434"> 	  echo Creating generic component options file $(VMS_SYMVEC_FILE); \</span>
<a href="#l2.435"></a><span id="l2.435"> 	  cp $(VMS_SYMVEC_FILE_COMP) $(VMS_SYMVEC_FILE); \</span>
<a href="#l2.436"></a><span id="l2.436"> 	fi</span>
<a href="#l2.437"></a><span id="l2.437"> endif</span>
<a href="#l2.438"></a><span id="l2.438"> endif # OpenVMS</span>
<a href="#l2.439"></a><span id="l2.439" class="difflineminus">-ifdef NO_LD_ARCHIVE_FLAGS</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineminus">-ifdef SHARED_LIBRARY_LIBS</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineminus">-	@rm -f $(SUB_SHLOBJS)</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineminus">-	@for lib in $(SHARED_LIBRARY_LIBS); do $(AR_EXTRACT) $${lib}; $(CLEANUP2); done</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineminus">-ifeq ($(OS_ARCH),Darwin)</span>
<a href="#l2.444"></a><span id="l2.444" class="difflineminus">-	@echo Making symlinks to the original object files in the archive libraries $(SHARED_LIBRARY_LIBS)</span>
<a href="#l2.445"></a><span id="l2.445" class="difflineminus">-	@for lib in $(SHARED_LIBRARY_LIBS); do \</span>
<a href="#l2.446"></a><span id="l2.446" class="difflineminus">-		libdir=`echo $$lib|sed -e 's,/[^/]*\.a,,'`; \</span>
<a href="#l2.447"></a><span id="l2.447" class="difflineminus">-		ofiles=`$(AR_LIST) $${lib}`; \</span>
<a href="#l2.448"></a><span id="l2.448" class="difflineminus">-		for ofile in $$ofiles; do \</span>
<a href="#l2.449"></a><span id="l2.449" class="difflineminus">-			if [ -f $$libdir/$$ofile ]; then \</span>
<a href="#l2.450"></a><span id="l2.450" class="difflineminus">-				rm -f $$ofile; \</span>
<a href="#l2.451"></a><span id="l2.451" class="difflineminus">-				ln -s $$libdir/$$ofile $$ofile; \</span>
<a href="#l2.452"></a><span id="l2.452" class="difflineminus">-			fi; \</span>
<a href="#l2.453"></a><span id="l2.453" class="difflineminus">-		done; \</span>
<a href="#l2.454"></a><span id="l2.454" class="difflineminus">-	done</span>
<a href="#l2.455"></a><span id="l2.455" class="difflineplus">+ifdef DTRACE_LIB_DEPENDENT</span>
<a href="#l2.456"></a><span id="l2.456" class="difflineplus">+ifndef XP_MACOSX</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineplus">+	dtrace -G -C -s $(MOZILLA_DTRACE_SRC) -o  $(DTRACE_PROBE_OBJ) $(shell $(EXPAND_LIBS) $(MOZILLA_PROBE_LIBS))</span>
<a href="#l2.458"></a><span id="l2.458"> endif</span>
<a href="#l2.459"></a><span id="l2.459" class="difflineminus">-endif # SHARED_LIBRARY_LIBS</span>
<a href="#l2.460"></a><span id="l2.460" class="difflineminus">-endif # NO_LD_ARCHIVE_FLAGS</span>
<a href="#l2.461"></a><span id="l2.461" class="difflineminus">-ifdef DTRACE_LIB_DEPENDENT</span>
<a href="#l2.462"></a><span id="l2.462" class="difflineminus">-	@rm -f $(PROBE_LOBJS)</span>
<a href="#l2.463"></a><span id="l2.463" class="difflineminus">-	@for lib in $(MOZILLA_PROBE_LIBS); do $(AR_EXTRACT) $${lib}; $(CLEANUP2); done</span>
<a href="#l2.464"></a><span id="l2.464" class="difflineminus">-ifndef XP_MACOSX</span>
<a href="#l2.465"></a><span id="l2.465" class="difflineminus">-	dtrace -G -C -s $(MOZILLA_DTRACE_SRC) -o  $(DTRACE_PROBE_OBJ) $(PROBE_LOBJS)</span>
<a href="#l2.466"></a><span id="l2.466" class="difflineminus">-endif</span>
<a href="#l2.467"></a><span id="l2.467" class="difflineminus">-	@for lib in $(MOZILLA_PROBE_LIBS); do \</span>
<a href="#l2.468"></a><span id="l2.468" class="difflineminus">-		ofiles=`$(AR_LIST) $${lib}`; \</span>
<a href="#l2.469"></a><span id="l2.469" class="difflineminus">-		$(AR_DELETE) $${lib} $$ofiles; \</span>
<a href="#l2.470"></a><span id="l2.470" class="difflineminus">-	done</span>
<a href="#l2.471"></a><span id="l2.471" class="difflineminus">-	$(MKSHLIB) $(SHLIB_LDSTARTFILE) $(OBJS) $(LOBJS) $(SUB_SHLOBJS) $(DTRACE_PROBE_OBJ) $(PROBE_LOBJS) $(RESFILE) $(LDFLAGS) $(MOZ_UTILS_LDFLAGS) $(EXTRA_DSO_LDOPTS) $(call EXPAND_FAKELIBS,$(OS_LIBS) $(EXTRA_LIBS)) $(DEF_FILE) $(SHLIB_LDENDFILE)</span>
<a href="#l2.472"></a><span id="l2.472" class="difflineminus">-	@rm -f $(PROBE_LOBJS)</span>
<a href="#l2.473"></a><span id="l2.473" class="difflineminus">-	@rm -f $(DTRACE_PROBE_OBJ)</span>
<a href="#l2.474"></a><span id="l2.474" class="difflineminus">-	@for lib in $(MOZILLA_PROBE_LIBS); do \</span>
<a href="#l2.475"></a><span id="l2.475" class="difflineminus">-		if [ -L $${lib} ]; then rm -f `readlink $${lib}`; fi; \</span>
<a href="#l2.476"></a><span id="l2.476" class="difflineminus">-	done</span>
<a href="#l2.477"></a><span id="l2.477" class="difflineminus">-	@rm -f $(MOZILLA_PROBE_LIBS)</span>
<a href="#l2.478"></a><span id="l2.478" class="difflineminus">-</span>
<a href="#l2.479"></a><span id="l2.479" class="difflineplus">+	$(EXPAND_MKSHLIB) $(SHLIB_LDSTARTFILE) $(OBJS) $(LOBJS) $(SUB_SHLOBJS) $(DTRACE_PROBE_OBJ) $(MOZILLA_PROBE_LIBS) $(RESFILE) $(LDFLAGS) $(MOZ_UTILS_LDFLAGS) $(SHARED_LIBRARY_LIBS) $(EXTRA_DSO_LDOPTS) $(OS_LIBS) $(EXTRA_LIBS) $(DEF_FILE) $(SHLIB_LDENDFILE)</span>
<a href="#l2.480"></a><span id="l2.480"> else # ! DTRACE_LIB_DEPENDENT</span>
<a href="#l2.481"></a><span id="l2.481" class="difflineminus">-	$(MKSHLIB) $(SHLIB_LDSTARTFILE) $(OBJS) $(DTRACE_PROBE_OBJ) $(LOBJS) $(SUB_SHLOBJS) $(RESFILE) $(LDFLAGS) $(MOZ_UTILS_LDFLAGS) $(EXTRA_DSO_LDOPTS) $(call EXPAND_FAKELIBS,$(OS_LIBS) $(EXTRA_LIBS)) $(DEF_FILE) $(SHLIB_LDENDFILE)</span>
<a href="#l2.482"></a><span id="l2.482" class="difflineplus">+	$(EXPAND_MKSHLIB) $(SHLIB_LDSTARTFILE) $(OBJS) $(DTRACE_PROBE_OBJ) $(LOBJS) $(SUB_SHLOBJS) $(RESFILE) $(LDFLAGS) $(MOZ_UTILS_LDFLAGS) $(SHARED_LIBRARY_LIBS) $(EXTRA_DSO_LDOPTS) $(OS_LIBS) $(EXTRA_LIBS) $(DEF_FILE) $(SHLIB_LDENDFILE)</span>
<a href="#l2.483"></a><span id="l2.483"> endif # DTRACE_LIB_DEPENDENT</span>
<a href="#l2.484"></a><span id="l2.484"> </span>
<a href="#l2.485"></a><span id="l2.485"> ifeq (_WINNT,$(GNU_CC)_$(OS_ARCH))</span>
<a href="#l2.486"></a><span id="l2.486"> ifdef MSMANIFEST_TOOL</span>
<a href="#l2.487"></a><span id="l2.487"> ifdef EMBED_MANIFEST_AT</span>
<a href="#l2.488"></a><span id="l2.488"> 	@if test -f $@.manifest; then \</span>
<a href="#l2.489"></a><span id="l2.489"> 		mt.exe -NOLOGO -MANIFEST $@.manifest -OUTPUTRESOURCE:$@\;$(EMBED_MANIFEST_AT); \</span>
<a href="#l2.490"></a><span id="l2.490"> 		rm -f $@.manifest; \</span>
<a href="#l2.491"></a><span id="l2.491"> 	fi</span>
<a href="#l2.492"></a><span id="l2.492"> endif   # EMBED_MANIFEST_AT</span>
<a href="#l2.493"></a><span id="l2.493"> endif	# MSVC with manifest tool</span>
<a href="#l2.494"></a><span id="l2.494"> ifdef MOZ_PROFILE_GENERATE</span>
<a href="#l2.495"></a><span id="l2.495"> 	touch -t `date +%Y%m%d%H%M.%S -d &quot;now+5seconds&quot;` pgo.relink</span>
<a href="#l2.496"></a><span id="l2.496"> endif</span>
<a href="#l2.497"></a><span id="l2.497"> endif	# WINNT &amp;&amp; !GCC</span>
<a href="#l2.498"></a><span id="l2.498" class="difflineminus">-ifneq ($(OS_ARCH),Darwin)</span>
<a href="#l2.499"></a><span id="l2.499" class="difflineminus">-	@rm -f $(SUB_SHLOBJS)</span>
<a href="#l2.500"></a><span id="l2.500" class="difflineminus">-endif # Darwin</span>
<a href="#l2.501"></a><span id="l2.501"> 	@rm -f foodummyfilefoo $(DELETE_AFTER_LINK)</span>
<a href="#l2.502"></a><span id="l2.502"> 	chmod +x $@</span>
<a href="#l2.503"></a><span id="l2.503"> ifdef ENABLE_STRIP</span>
<a href="#l2.504"></a><span id="l2.504"> 	$(STRIP) $@</span>
<a href="#l2.505"></a><span id="l2.505"> endif</span>
<a href="#l2.506"></a><span id="l2.506"> ifdef MOZ_POST_DSO_LIB_COMMAND</span>
<a href="#l2.507"></a><span id="l2.507"> 	$(MOZ_POST_DSO_LIB_COMMAND) $@</span>
<a href="#l2.508"></a><span id="l2.508"> endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/configure.in</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/configure.in</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -2100,17 +2100,17 @@ ia64*-hpux*)</span>
<a href="#l3.4"></a><span id="l3.4">     esac</span>
<a href="#l3.5"></a><span id="l3.5">     ;;</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> *-wince*|*-winmo*)</span>
<a href="#l3.8"></a><span id="l3.8">     TARGET_COMPILER_ABI=msvc</span>
<a href="#l3.9"></a><span id="l3.9">     MOZ_TOOLS_DIR=`cd $MOZ_TOOLS &amp;&amp; pwd -W`</span>
<a href="#l3.10"></a><span id="l3.10">     MOZ_BUILD_ROOT=`cd $MOZ_BUILD_ROOT &amp;&amp; pwd -W`</span>
<a href="#l3.11"></a><span id="l3.11">     AR_LIST=&quot;$AR -list&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    AR_EXTRACT=&quot;$AR -extract&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    AR_EXTRACT=</span>
<a href="#l3.14"></a><span id="l3.14">     AR_DELETE=&quot;$AR d&quot;</span>
<a href="#l3.15"></a><span id="l3.15">     AR_FLAGS='-OUT:&quot;$@&quot;'</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17">     if test &quot;$AS_BIN&quot;; then</span>
<a href="#l3.18"></a><span id="l3.18">         AS=&quot;$AS_BIN&quot;</span>
<a href="#l3.19"></a><span id="l3.19">     fi</span>
<a href="#l3.20"></a><span id="l3.20">     DSO_CFLAGS=</span>
<a href="#l3.21"></a><span id="l3.21">     DSO_PIC_CFLAGS=</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -2121,17 +2121,18 @@ ia64*-hpux*)</span>
<a href="#l3.23"></a><span id="l3.23">     fi</span>
<a href="#l3.24"></a><span id="l3.24">     # certain versions of cygwin's makedepend barf on the </span>
<a href="#l3.25"></a><span id="l3.25">     # #include &lt;string&gt; vs -I./dist/include/string issue so don't use it</span>
<a href="#l3.26"></a><span id="l3.26">     SYSTEM_MAKEDEPEND=</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28">     HOST_CC=cl</span>
<a href="#l3.29"></a><span id="l3.29">     HOST_CXX=cl</span>
<a href="#l3.30"></a><span id="l3.30">     HOST_LD=link</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-    HOST_AR='lib -OUT:$@'</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    HOST_AR='lib'</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+    HOST_AR_FLAGS='-OUT:$@'</span>
<a href="#l3.34"></a><span id="l3.34">     HOST_RANLIB='echo ranlib'</span>
<a href="#l3.35"></a><span id="l3.35">     HOST_CFLAGS=&quot;$HOST_CFLAGS -D_X86_&quot;</span>
<a href="#l3.36"></a><span id="l3.36">         </span>
<a href="#l3.37"></a><span id="l3.37">         </span>
<a href="#l3.38"></a><span id="l3.38">     WARNINGS_AS_ERRORS='-WX'</span>
<a href="#l3.39"></a><span id="l3.39">     MOZ_OPTIMIZE_FLAGS='-Ox'</span>
<a href="#l3.40"></a><span id="l3.40">     AR_FLAGS='-NOLOGO -OUT:&quot;$@&quot;'</span>
<a href="#l3.41"></a><span id="l3.41">     ASM_SUFFIX=asm</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineat">@@ -2225,18 +2226,19 @@ ia64*-hpux*)</span>
<a href="#l3.43"></a><span id="l3.43">     else</span>
<a href="#l3.44"></a><span id="l3.44">         TARGET_COMPILER_ABI=msvc</span>
<a href="#l3.45"></a><span id="l3.45">         HOST_CC='$(CC)'</span>
<a href="#l3.46"></a><span id="l3.46">         HOST_CXX='$(CXX)'</span>
<a href="#l3.47"></a><span id="l3.47">         HOST_LD='$(LD)'</span>
<a href="#l3.48"></a><span id="l3.48">         if test &quot;$AS_BIN&quot;; then</span>
<a href="#l3.49"></a><span id="l3.49">             AS=&quot;$(basename &quot;$AS_BIN&quot;)&quot;</span>
<a href="#l3.50"></a><span id="l3.50">         fi</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-        AR='lib -NOLOGO -OUT:&quot;$@&quot;'</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-        AR_FLAGS=</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+        AR='lib'</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+        AR_FLAGS='-NOLOGO -OUT:&quot;$@&quot;'</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+        AR_EXTRACT=</span>
<a href="#l3.56"></a><span id="l3.56">         RANLIB='echo not_ranlib'</span>
<a href="#l3.57"></a><span id="l3.57">         STRIP='echo not_strip'</span>
<a href="#l3.58"></a><span id="l3.58">         XARGS=xargs</span>
<a href="#l3.59"></a><span id="l3.59">         ZIP=zip</span>
<a href="#l3.60"></a><span id="l3.60">         UNZIP=unzip</span>
<a href="#l3.61"></a><span id="l3.61">         DOXYGEN=:</span>
<a href="#l3.62"></a><span id="l3.62">         GARBAGE='$(OBJDIR)/vc20.pdb $(OBJDIR)/vc40.pdb'</span>
<a href="#l3.63"></a><span id="l3.63">         ASM_SUFFIX=asm</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

