<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 10354:981ac3d7e71438e2c9bf9a8c030ded796c8fbd99</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 981ac3d7e71438e2c9bf9a8c030ded796c8fbd99" />
<meta property="og:url" content="/comm-central/rev/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99" />
<meta property="og:description" content="Part of Bug 758326 - Port bug 481815 - Provide a Windows service to update applications without asking Administrator password. r=Standard8,ui-review=bwinton" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 981ac3d7e71438e2c9bf9a8c030ded796c8fbd99 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99">shortlog</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99">files</a> |
changeset |
<a href="/comm-central/raw-rev/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99">raw</a>  | <a href="/comm-central/archive/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=758326">Bug 758326</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=481815">bug 481815</a> - Provide a Windows service to update applications without asking Administrator password. r=Standard8,ui-review=bwinton
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#78;&#111;&#109;&#105;&#115;&#49;&#48;&#49;&#64;&#119;&#101;&#98;&#46;&#100;&#101;</td></tr>
<tr><td></td><td class="date age">Mon, 04 Jun 2012 15:03:22 +0100</td></tr>

<tr>
 <td>changeset 10354</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99">981ac3d7e71438e2c9bf9a8c030ded796c8fbd99</a></td>
</tr>



<tr>
<td>parent 10353</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9b6d79b4c4cf20538bc05e432e72ed714f4d8ff5">9b6d79b4c4cf20538bc05e432e72ed714f4d8ff5</a>
</td>
</tr>

<tr>
<td>child 10355</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9db1e7ed1ad9844c226ff4fb11547e69cf8c375d">9db1e7ed1ad9844c226ff4fb11547e69cf8c375d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=981ac3d7e71438e2c9bf9a8c030ded796c8fbd99">7837</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 04 Jun 2012 14:04:41 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9db1e7ed1ad9 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9db1e7ed1ad9844c226ff4fb11547e69cf8c375d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9db1e7ed1ad9844c226ff4fb11547e69cf8c375d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9db1e7ed1ad9844c226ff4fb11547e69cf8c375d&newProject=comm-central&newRevision=981ac3d7e71438e2c9bf9a8c030ded796c8fbd99&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9db1e7ed1ad9844c226ff4fb11547e69cf8c375d&newProject=comm-central&newRevision=981ac3d7e71438e2c9bf9a8c030ded796c8fbd99&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9db1e7ed1ad9844c226ff4fb11547e69cf8c375d&newProject=comm-central&newRevision=981ac3d7e71438e2c9bf9a8c030ded796c8fbd99&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=758326">758326</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=481815">481815</a></td></tr>




</table></div>

<div class="page_body description">Part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=758326">Bug 758326</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=481815">bug 481815</a> - Provide a Windows service to update applications without asking Administrator password. r=Standard8,ui-review=bwinton</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/config/autoconf.mk.in">config/autoconf.mk.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/config/autoconf.mk.in">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/config/autoconf.mk.in">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/config/autoconf.mk.in">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/config/autoconf.mk.in">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/config/autoconf.mk.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/configure.in">configure.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/configure.in">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/configure.in">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/configure.in">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/configure.in">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/configure.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/Makefile.in">mail/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/Makefile.in">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/Makefile.in">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/Makefile.in">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/Makefile.in">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/app/profile/all-thunderbird.js">mail/app/profile/all-thunderbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/app/profile/all-thunderbird.js">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/app/profile/all-thunderbird.js">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/app/profile/all-thunderbird.js">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/app/profile/all-thunderbird.js">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/app/profile/all-thunderbird.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/base/content/aboutDialog.js">mail/base/content/aboutDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/base/content/aboutDialog.js">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/base/content/aboutDialog.js">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/base/content/aboutDialog.js">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/base/content/aboutDialog.js">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/base/content/aboutDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.js">mail/components/preferences/advanced.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.js">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.js">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.js">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.js">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.xul">mail/components/preferences/advanced.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.xul">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.xul">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.xul">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.xul">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/components/preferences/advanced.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/confvars.sh">mail/confvars.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/confvars.sh">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/confvars.sh">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/confvars.sh">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/confvars.sh">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/confvars.sh">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/package-manifest.in">mail/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/package-manifest.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/removed-files.in">mail/installer/removed-files.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/removed-files.in">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/removed-files.in">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/removed-files.in">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/removed-files.in">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/removed-files.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/Makefile.in">mail/installer/windows/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/Makefile.in">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/Makefile.in">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/Makefile.in">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/Makefile.in">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/defines.nsi.in">mail/installer/windows/nsis/defines.nsi.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/defines.nsi.in">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/defines.nsi.in">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/defines.nsi.in">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/defines.nsi.in">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/defines.nsi.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/installer.nsi">mail/installer/windows/nsis/installer.nsi</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/installer.nsi">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/installer.nsi">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/installer.nsi">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/installer.nsi">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/installer.nsi">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/maintenanceservice_installer.nsi">mail/installer/windows/nsis/maintenanceservice_installer.nsi</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/maintenanceservice_installer.nsi">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/maintenanceservice_installer.nsi">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/maintenanceservice_installer.nsi">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/maintenanceservice_installer.nsi">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/maintenanceservice_installer.nsi">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/shared.nsh">mail/installer/windows/nsis/shared.nsh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/shared.nsh">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/shared.nsh">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/shared.nsh">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/shared.nsh">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/shared.nsh">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/uninstaller.nsi">mail/installer/windows/nsis/uninstaller.nsi</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/uninstaller.nsi">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/uninstaller.nsi">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/uninstaller.nsi">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/uninstaller.nsi">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/installer/windows/nsis/uninstaller.nsi">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">mail/locales/en-US/chrome/messenger/preferences/advanced.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/installer/custom.properties">mail/locales/en-US/installer/custom.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/installer/custom.properties">file</a> |
<a href="/comm-central/annotate/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/installer/custom.properties">annotate</a> |
<a href="/comm-central/diff/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/installer/custom.properties">diff</a> |
<a href="/comm-central/comparison/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/installer/custom.properties">comparison</a> |
<a href="/comm-central/log/981ac3d7e71438e2c9bf9a8c030ded796c8fbd99/mail/locales/en-US/installer/custom.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/config/autoconf.mk.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/config/autoconf.mk.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -17,16 +17,18 @@ SUNBIRD_VERSION = @SUNBIRD_VERSION@</span>
<a href="#l1.4"></a><span id="l1.4"> SEAMONKEY_VERSION	= @SEAMONKEY_VERSION@</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> MOZ_BUILD_APP = @MOZ_BUILD_APP@</span>
<a href="#l1.7"></a><span id="l1.7"> MOZ_APP_NAME	= @MOZ_APP_NAME@</span>
<a href="#l1.8"></a><span id="l1.8"> MOZ_APP_DISPLAYNAME = @MOZ_APP_DISPLAYNAME@</span>
<a href="#l1.9"></a><span id="l1.9"> MOZ_APP_VERSION = @MOZ_APP_VERSION@</span>
<a href="#l1.10"></a><span id="l1.10"> MOZ_APP_MAXVERSION = @MOZ_APP_MAXVERSION@</span>
<a href="#l1.11"></a><span id="l1.11"> MOZ_MACBUNDLE_NAME= @MOZ_MACBUNDLE_NAME@</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+MAR_CHANNEL_ID = @MAR_CHANNEL_ID@</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+ACCEPTED_MAR_CHANNEL_IDS = @ACCEPTED_MAR_CHANNEL_IDS@</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15"> MOZ_PKG_SPECIAL = @MOZ_PKG_SPECIAL@</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> prefix		= @prefix@</span>
<a href="#l1.18"></a><span id="l1.18"> exec_prefix	= @exec_prefix@</span>
<a href="#l1.19"></a><span id="l1.19"> bindir		= @bindir@</span>
<a href="#l1.20"></a><span id="l1.20"> includedir	= @includedir@/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)</span>
<a href="#l1.21"></a><span id="l1.21"> libdir		= @libdir@</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -82,16 +84,18 @@ MOZ_CALENDAR	= @MOZ_CALENDAR@</span>
<a href="#l1.23"></a><span id="l1.23"> MOZ_PLAINTEXT_EDITOR_ONLY = @MOZ_PLAINTEXT_EDITOR_ONLY@</span>
<a href="#l1.24"></a><span id="l1.24"> MOZ_COMPOSER = @MOZ_COMPOSER@</span>
<a href="#l1.25"></a><span id="l1.25"> ENABLE_TESTS	= @ENABLE_TESTS@</span>
<a href="#l1.26"></a><span id="l1.26"> IBMBIDI = @IBMBIDI@</span>
<a href="#l1.27"></a><span id="l1.27"> MOZ_UNIVERSALCHARDET = @MOZ_UNIVERSALCHARDET@</span>
<a href="#l1.28"></a><span id="l1.28"> ACCESSIBILITY = @ACCESSIBILITY@</span>
<a href="#l1.29"></a><span id="l1.29"> MOZ_LDAP_XPCOM = @MOZ_LDAP_XPCOM@</span>
<a href="#l1.30"></a><span id="l1.30"> MOZ_BRANDING_DIRECTORY = @MOZ_BRANDING_DIRECTORY@</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+MOZ_MAINTENANCE_SERVICE	= @MOZ_MAINTENANCE_SERVICE@</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+MOZ_VERIFY_MAR_SIGNATURE	= @MOZ_VERIFY_MAR_SIGNATURE@</span>
<a href="#l1.33"></a><span id="l1.33"> MOZ_UPDATER	= @MOZ_UPDATER@</span>
<a href="#l1.34"></a><span id="l1.34"> MOZ_UPDATE_CHANNEL = @MOZ_UPDATE_CHANNEL@</span>
<a href="#l1.35"></a><span id="l1.35"> MOZ_UPDATE_PACKAGING	= @MOZ_UPDATE_PACKAGING@</span>
<a href="#l1.36"></a><span id="l1.36"> MOZ_NO_ACTIVEX_SUPPORT = @MOZ_NO_ACTIVEX_SUPPORT@</span>
<a href="#l1.37"></a><span id="l1.37"> MOZ_SPELLCHECK = @MOZ_SPELLCHECK@</span>
<a href="#l1.38"></a><span id="l1.38"> MOZ_PROFILELOCKING = @MOZ_PROFILELOCKING@</span>
<a href="#l1.39"></a><span id="l1.39"> MOZ_FEEDS = @MOZ_FEEDS@</span>
<a href="#l1.40"></a><span id="l1.40"> MOZ_PLACES = @MOZ_PLACES@</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/configure.in</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/configure.in</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -5331,16 +5331,50 @@ AC_MSG_RESULT([$TAR])</span>
<a href="#l2.4"></a><span id="l2.4"> AC_SUBST(TAR)</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> AC_MSG_CHECKING([for wget])</span>
<a href="#l2.7"></a><span id="l2.7"> AC_CHECK_PROGS(WGET, wget, &quot;&quot;)</span>
<a href="#l2.8"></a><span id="l2.8"> AC_MSG_RESULT([$WGET])</span>
<a href="#l2.9"></a><span id="l2.9"> AC_SUBST(WGET)</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> dnl ========================================================</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+dnl Maintenance Service</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+dnl ========================================================</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+MOZ_ARG_ENABLE_BOOL(maintenance-service,</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+[  --enable-maintenance-service       Enable building of maintenanceservice],</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+    MOZ_MAINTENANCE_SERVICE=1,</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+    MOZ_MAINTENANCE_SERVICE= )</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+if test -n &quot;$MOZ_MAINTENANCE_SERVICE&quot;; then</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+  if test &quot;$OS_ARCH&quot; = &quot;WINNT&quot;; then</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+    AC_DEFINE(MOZ_MAINTENANCE_SERVICE)</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+  else</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+    AC_MSG_ERROR([Can only build with --enable-maintenance-service with a Windows target])</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+  fi</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+fi</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+dnl ========================================================</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+dnl Verify MAR signatures</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+dnl ========================================================</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+MOZ_ARG_ENABLE_BOOL(verify-mar,</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+[  --enable-verify-mar     Enable verifying MAR signatures],</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+    MOZ_VERIFY_MAR_SIGNATURE=1,</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+    MOZ_VERIFY_MAR_SIGNATURE= )</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+if test -n &quot;$MOZ_VERIFY_MAR_SIGNATURE&quot;; then</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+  if test &quot;$OS_ARCH&quot; = &quot;WINNT&quot;; then</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+    AC_DEFINE(MOZ_VERIFY_MAR_SIGNATURE)</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+  else</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+    AC_MSG_ERROR([Can only build with --enable-verify-mar with a Windows target])</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+  fi</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+fi</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+dnl ========================================================</span>
<a href="#l2.46"></a><span id="l2.46"> dnl Updater</span>
<a href="#l2.47"></a><span id="l2.47"> dnl ========================================================</span>
<a href="#l2.48"></a><span id="l2.48"> </span>
<a href="#l2.49"></a><span id="l2.49"> MOZ_ARG_DISABLE_BOOL(updater,</span>
<a href="#l2.50"></a><span id="l2.50"> [  --disable-updater       Disable building of updater],</span>
<a href="#l2.51"></a><span id="l2.51">     MOZ_UPDATER=,</span>
<a href="#l2.52"></a><span id="l2.52">     MOZ_UPDATER=1 )</span>
<a href="#l2.53"></a><span id="l2.53"> AC_SUBST(MOZ_UPDATER)</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineat">@@ -6734,16 +6768,18 @@ AC_SUBST(MOZ_PROFILELOCKING)</span>
<a href="#l2.55"></a><span id="l2.55"> </span>
<a href="#l2.56"></a><span id="l2.56"> AC_SUBST(ENABLE_TESTS)</span>
<a href="#l2.57"></a><span id="l2.57"> AC_SUBST(IBMBIDI)</span>
<a href="#l2.58"></a><span id="l2.58"> AC_SUBST(MOZ_UNIVERSALCHARDET)</span>
<a href="#l2.59"></a><span id="l2.59"> AC_SUBST(ACCESSIBILITY)</span>
<a href="#l2.60"></a><span id="l2.60"> AC_SUBST(MOZ_SPELLCHECK)</span>
<a href="#l2.61"></a><span id="l2.61"> AC_SUBST(MOZ_USER_DIR)</span>
<a href="#l2.62"></a><span id="l2.62"> AC_SUBST(MOZ_CRASHREPORTER)</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+AC_SUBST(MOZ_MAINTENANCE_SERVICE)</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+AC_SUBST(MOZ_VERIFY_MAR_SIGNATURE)</span>
<a href="#l2.65"></a><span id="l2.65"> AC_SUBST(MOZ_ANGLE)</span>
<a href="#l2.66"></a><span id="l2.66"> AC_SUBST(MOZ_DIRECTX_SDK_PATH)</span>
<a href="#l2.67"></a><span id="l2.67"> AC_SUBST(MOZ_DIRECTX_SDK_CPU_SUFFIX)</span>
<a href="#l2.68"></a><span id="l2.68"> AC_SUBST(MOZ_D3DX9_VERSION)</span>
<a href="#l2.69"></a><span id="l2.69"> AC_SUBST(MOZ_D3DX9_CAB)</span>
<a href="#l2.70"></a><span id="l2.70"> AC_SUBST(MOZ_D3DCOMPILER_CAB)</span>
<a href="#l2.71"></a><span id="l2.71"> AC_SUBST(MOZ_D3DX9_DLL)</span>
<a href="#l2.72"></a><span id="l2.72"> AC_SUBST(MOZ_D3DCOMPILER_DLL)</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineat">@@ -6803,16 +6839,18 @@ if test -z &quot;$IS_ALPHA&quot;; then</span>
<a href="#l2.74"></a><span id="l2.74"> else</span>
<a href="#l2.75"></a><span id="l2.75">   MOZ_APP_MAXVERSION=$MOZ_APP_VERSION</span>
<a href="#l2.76"></a><span id="l2.76"> fi</span>
<a href="#l2.77"></a><span id="l2.77"> </span>
<a href="#l2.78"></a><span id="l2.78"> AC_SUBST(MOZ_APP_NAME)</span>
<a href="#l2.79"></a><span id="l2.79"> AC_SUBST(MOZ_APP_DISPLAYNAME)</span>
<a href="#l2.80"></a><span id="l2.80"> AC_SUBST(MOZ_APP_VERSION)</span>
<a href="#l2.81"></a><span id="l2.81"> AC_SUBST(MOZ_APP_MAXVERSION)</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+AC_SUBST(MAR_CHANNEL_ID)</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+AC_SUBST(ACCEPTED_MAR_CHANNEL_IDS)</span>
<a href="#l2.84"></a><span id="l2.84"> AC_SUBST(FIREFOX_VERSION)</span>
<a href="#l2.85"></a><span id="l2.85"> AC_SUBST(THUNDERBIRD_VERSION)</span>
<a href="#l2.86"></a><span id="l2.86"> AC_SUBST(SUNBIRD_VERSION)</span>
<a href="#l2.87"></a><span id="l2.87"> AC_SUBST(SEAMONKEY_VERSION)</span>
<a href="#l2.88"></a><span id="l2.88"> </span>
<a href="#l2.89"></a><span id="l2.89"> AC_SUBST(MOZ_PKG_SPECIAL)</span>
<a href="#l2.90"></a><span id="l2.90"> </span>
<a href="#l2.91"></a><span id="l2.91"> AC_SUBST(MAIL_PKG_SHARED)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/Makefile.in</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/Makefile.in</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -29,9 +29,12 @@ endif</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> include $(topsrcdir)/config/rules.mk</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l3.8"></a><span id="l3.8"> # For Windows build the uninstaller during the application build since the</span>
<a href="#l3.9"></a><span id="l3.9"> # uninstaller is included with the application for mar file generation.</span>
<a href="#l3.10"></a><span id="l3.10"> libs::</span>
<a href="#l3.11"></a><span id="l3.11"> 	$(MAKE) -C installer/windows uninstaller</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+	$(MAKE) -C installer/windows maintenanceservice_installer</span>
<a href="#l3.14"></a><span id="l3.14"> endif</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+endif</span>
<a href="#l3.16"></a><span id="l3.16">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/app/profile/all-thunderbird.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/app/profile/all-thunderbird.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -79,16 +79,21 @@ pref(&quot;app.update.idletime&quot;, 60);</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> // Whether or not we show a dialog box informing the user that the update was</span>
<a href="#l4.6"></a><span id="l4.6"> // successfully applied. This is off in Firefox by default since we show a </span>
<a href="#l4.7"></a><span id="l4.7"> // upgrade start page instead! Other apps may wish to show this UI, and supply</span>
<a href="#l4.8"></a><span id="l4.8"> // a whatsNewURL field in their brand.properties that contains a link to a page</span>
<a href="#l4.9"></a><span id="l4.9"> // which tells users what's new in this new update.</span>
<a href="#l4.10"></a><span id="l4.10"> pref(&quot;app.update.showInstalledUI&quot;, false);</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+// Whether or not to attempt using the service for updates.</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+#ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+pref(&quot;app.update.service.enabled&quot;, true);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+#endif</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+</span>
<a href="#l4.17"></a><span id="l4.17"> // Release notes URL</span>
<a href="#l4.18"></a><span id="l4.18"> pref(&quot;app.releaseNotesURL&quot;, &quot;http://live.mozillamessaging.com/%APP%/releasenotes?locale=%LOCALE%&amp;version=%VERSION%&amp;os=%OS%&amp;buildid=%APPBUILDID%&quot;);</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20"> // Base URL for web-based support pages.</span>
<a href="#l4.21"></a><span id="l4.21"> pref(&quot;app.support.baseURL&quot;, &quot;http://support.live.mozillamessaging.com/%LOCALE%/%APP%/%APPBUILDID%/&quot;);</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23"> // Controls enabling of the extension system logging (can reduce performance)</span>
<a href="#l4.24"></a><span id="l4.24"> pref(&quot;extensions.logging.enabled&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/aboutDialog.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/aboutDialog.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -169,19 +169,23 @@ function appUpdater()</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> appUpdater.prototype =</span>
<a href="#l5.6"></a><span id="l5.6"> {</span>
<a href="#l5.7"></a><span id="l5.7">   // true when there is an update check in progress.</span>
<a href="#l5.8"></a><span id="l5.8">   isChecking: false,</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">   // true when there is an update already staged / ready to be applied.</span>
<a href="#l5.11"></a><span id="l5.11">   get isPending() {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    if (this.update)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-      return this.update.state == &quot;pending&quot;;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-    return this.um.activeUpdate &amp;&amp; this.um.activeUpdate.state == &quot;pending&quot;;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+    if (this.update) {</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+      return this.update.state == &quot;pending&quot; || </span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+             this.update.state == &quot;pending-service&quot;;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+    }</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+    return this.um.activeUpdate &amp;&amp;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+           (this.um.activeUpdate.state == &quot;pending&quot; ||</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+            this.um.activeUpdate.state == &quot;pending-service&quot;);</span>
<a href="#l5.22"></a><span id="l5.22">   },</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">   // true when there is an update download in progress.</span>
<a href="#l5.25"></a><span id="l5.25">   get isDownloading() {</span>
<a href="#l5.26"></a><span id="l5.26">     if (this.update)</span>
<a href="#l5.27"></a><span id="l5.27">       return this.update.state == &quot;downloading&quot;;</span>
<a href="#l5.28"></a><span id="l5.28">     return this.um.activeUpdate &amp;&amp;</span>
<a href="#l5.29"></a><span id="l5.29">            this.um.activeUpdate.state == &quot;downloading&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/preferences/advanced.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/preferences/advanced.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -226,16 +226,36 @@ var gAdvancedPane = {</span>
<a href="#l6.4"></a><span id="l6.4">     var autoPref = document.getElementById(&quot;app.update.auto&quot;);</span>
<a href="#l6.5"></a><span id="l6.5">     var modePref = document.getElementById(&quot;app.update.mode&quot;);</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">     var warnIncompatible = document.getElementById(&quot;warnIncompatible&quot;);</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9">     var disable = enabledPref.locked || !enabledPref.value || autoPref.locked ||</span>
<a href="#l6.10"></a><span id="l6.10">                   !autoPref.value || modePref.locked;</span>
<a href="#l6.11"></a><span id="l6.11">     warnIncompatible.disabled = disable;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+#ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    // Check to see if the maintenance service is installed.</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    // If it is don't show the preference at all.</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+    var installed;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+    try {</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+      Components.utils.reportError(&quot;0&quot;);</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+      var wrk = Components.classes[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+                .createInstance(Components.interfaces.nsIWindowsRegKey);</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+      wrk.open(wrk.ROOT_KEY_LOCAL_MACHINE,</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+               &quot;SOFTWARE\\Mozilla\\MaintenanceService&quot;,</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+               wrk.ACCESS_READ | wrk.WOW64_64);</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+      installed = wrk.readIntValue(&quot;Installed&quot;);</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+      wrk.close();</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+    } catch(e) {</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+    }</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+    if (installed != 1) {</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+      document.getElementById(&quot;useService&quot;).hidden = true;</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+    }</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+#endif</span>
<a href="#l6.32"></a><span id="l6.32">   },</span>
<a href="#l6.33"></a><span id="l6.33"> </span>
<a href="#l6.34"></a><span id="l6.34">   /**</span>
<a href="#l6.35"></a><span id="l6.35">    * app.update.mode is a three state integer preference, and we have to </span>
<a href="#l6.36"></a><span id="l6.36">    * express all three values in a single checkbox:</span>
<a href="#l6.37"></a><span id="l6.37">    * &quot;Warn me if this will disable extensions or themes&quot;</span>
<a href="#l6.38"></a><span id="l6.38">    * Preference Value         Checkbox State    Meaning</span>
<a href="#l6.39"></a><span id="l6.39">    * 0                        Unchecked         Do not warn</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/preferences/advanced.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/preferences/advanced.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -91,16 +91,22 @@</span>
<a href="#l7.4"></a><span id="l7.4">                             gAdvancedPane.updateModeItems();&quot;/&gt;</span>
<a href="#l7.5"></a><span id="l7.5">       &lt;preference id=&quot;app.update.auto&quot; name=&quot;app.update.auto&quot; type=&quot;bool&quot;</span>
<a href="#l7.6"></a><span id="l7.6">                   onchange=&quot;gAdvancedPane.updateAutoItems(); gAdvancedPane.updateModeItems();&quot;/&gt;</span>
<a href="#l7.7"></a><span id="l7.7">       &lt;preference id=&quot;app.update.mode&quot; name=&quot;app.update.mode&quot; type=&quot;int&quot;</span>
<a href="#l7.8"></a><span id="l7.8">                   onchange=&quot;gAdvancedPane.updateModeItems();&quot;/&gt;</span>
<a href="#l7.9"></a><span id="l7.9">       &lt;preference id=&quot;app.update.disable_button.showUpdateHistory&quot;</span>
<a href="#l7.10"></a><span id="l7.10">                   name=&quot;app.update.disable_button.showUpdateHistory&quot;</span>
<a href="#l7.11"></a><span id="l7.11">                   type=&quot;bool&quot;/&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+#ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+      &lt;preference id=&quot;app.update.service.enabled&quot;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+                  name=&quot;app.update.service.enabled&quot;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+                  type=&quot;bool&quot;/&gt;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+#endif</span>
<a href="#l7.18"></a><span id="l7.18"> #endif</span>
<a href="#l7.19"></a><span id="l7.19">       &lt;preference id=&quot;extensions.update.enabled&quot; name=&quot;extensions.update.enabled&quot; type=&quot;bool&quot;</span>
<a href="#l7.20"></a><span id="l7.20">                   onchange=&quot;gAdvancedPane.updateAddonUpdateUI();&quot;/&gt;</span>
<a href="#l7.21"></a><span id="l7.21">       &lt;!-- Certificates tab --&gt;</span>
<a href="#l7.22"></a><span id="l7.22">       &lt;preference id=&quot;security.default_personal_cert&quot;</span>
<a href="#l7.23"></a><span id="l7.23">                   name=&quot;security.default_personal_cert&quot;</span>
<a href="#l7.24"></a><span id="l7.24">                   type=&quot;string&quot;/&gt;</span>
<a href="#l7.25"></a><span id="l7.25">       &lt;preference id=&quot;security.disable_button.openCertManager&quot;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineat">@@ -353,16 +359,23 @@</span>
<a href="#l7.27"></a><span id="l7.27">           &lt;/radiogroup&gt;</span>
<a href="#l7.28"></a><span id="l7.28">           &lt;separator/&gt;</span>
<a href="#l7.29"></a><span id="l7.29">           &lt;hbox&gt;</span>
<a href="#l7.30"></a><span id="l7.30">             &lt;button id=&quot;showUpdateHistory&quot;</span>
<a href="#l7.31"></a><span id="l7.31">                     label=&quot;&amp;showUpdates.label;&quot; accesskey=&quot;&amp;showUpdates.accesskey;&quot;</span>
<a href="#l7.32"></a><span id="l7.32">                     preference=&quot;app.update.disable_button.showUpdateHistory&quot;</span>
<a href="#l7.33"></a><span id="l7.33">                     oncommand=&quot;gAdvancedPane.showUpdates();&quot;/&gt;</span>
<a href="#l7.34"></a><span id="l7.34">           &lt;/hbox&gt;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+#ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+            &lt;checkbox id=&quot;useService&quot;</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+                      label=&quot;&amp;useService.label;&quot;</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+                      accesskey=&quot;&amp;useService.accesskey;&quot;</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+                      preference=&quot;app.update.service.enabled&quot;/&gt;</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+#endif</span>
<a href="#l7.42"></a><span id="l7.42"> #endif</span>
<a href="#l7.43"></a><span id="l7.43">         &lt;/tabpanel&gt;</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45">         &lt;!-- Certificates --&gt;</span>
<a href="#l7.46"></a><span id="l7.46">         &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l7.47"></a><span id="l7.47">           &lt;description id=&quot;CertSelectionDesc&quot; control=&quot;certSelection&quot;&gt;&amp;certSelection.description;&lt;/description&gt;</span>
<a href="#l7.48"></a><span id="l7.48"> </span>
<a href="#l7.49"></a><span id="l7.49">           &lt;!--</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/confvars.sh</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/confvars.sh</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -8,22 +8,35 @@ MOZ_UPDATER=1</span>
<a href="#l8.4"></a><span id="l8.4"> MOZ_THUNDERBIRD=1</span>
<a href="#l8.5"></a><span id="l8.5"> MOZ_CHROME_FILE_FORMAT=omni</span>
<a href="#l8.6"></a><span id="l8.6"> MOZ_NO_ACTIVEX_SUPPORT=1</span>
<a href="#l8.7"></a><span id="l8.7"> MOZ_ACTIVEX_SCRIPTING_SUPPORT=</span>
<a href="#l8.8"></a><span id="l8.8"> if [ &quot;$COMM_BUILD&quot; ]; then</span>
<a href="#l8.9"></a><span id="l8.9">   MOZ_LDAP_XPCOM=1</span>
<a href="#l8.10"></a><span id="l8.10"> fi</span>
<a href="#l8.11"></a><span id="l8.11"> MOZ_COMPOSER=1</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+if test &quot;$OS_ARCH&quot; = &quot;WINNT&quot;; then</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  if ! test &quot;$HAVE_64BIT_OS&quot;; then</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+    MOZ_VERIFY_MAR_SIGNATURE=1</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+    MOZ_MAINTENANCE_SERVICE=1</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+  fi</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+fi</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+</span>
<a href="#l8.19"></a><span id="l8.19"> MOZ_SAFE_BROWSING=1</span>
<a href="#l8.20"></a><span id="l8.20"> MOZ_MORK=1</span>
<a href="#l8.21"></a><span id="l8.21"> if test -z &quot;$MOZ_INCOMPLETE_EXTERNAL_LINKAGE&quot;; then</span>
<a href="#l8.22"></a><span id="l8.22"> MOZ_APP_COMPONENT_LIBS=&quot;xpautocomplete mailcomps $MAIL_COMPONENT $LDAP_COMPONENT $MORK_COMPONENT&quot;</span>
<a href="#l8.23"></a><span id="l8.23"> MOZ_APP_COMPONENT_MODULES=&quot;MODULE(xpAutoComplete) MODULE(nsMailCompsModule) $MAIL_MODULE $LDAP_MODULE $MORK_MODULE&quot;</span>
<a href="#l8.24"></a><span id="l8.24"> MOZ_APP_EXTRA_LIBS=&quot;$LDAP_LIBS&quot;</span>
<a href="#l8.25"></a><span id="l8.25"> fi</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27"> MOZ_APP_VERSION_TXT=${_topsrcdir}/$MOZ_BUILD_APP/config/version.txt</span>
<a href="#l8.28"></a><span id="l8.28"> MOZ_APP_VERSION=`cat $MOZ_APP_VERSION_TXT`</span>
<a href="#l8.29"></a><span id="l8.29"> THUNDERBIRD_VERSION=$MOZ_APP_VERSION</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31"> MOZ_BRANDING_DIRECTORY=mail/branding/nightly</span>
<a href="#l8.32"></a><span id="l8.32"> MOZ_OFFICIAL_BRANDING_DIRECTORY=other-licenses/branding/thunderbird</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+# This should usually be the same as the value MAR_CHANNEL_ID.</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+# If more than one ID is needed, then you should use a comma separated list</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+# of values.</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+ACCEPTED_MAR_CHANNEL_IDS=thunderbird-comm-central</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+# The MAR_CHANNEL_ID must not contain the following 3 characters: &quot;,\t &quot;</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+MAR_CHANNEL_ID=thunderbird-comm-central</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/installer/package-manifest.in</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/installer/package-manifest.in</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -109,16 +109,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> [mail]</span>
<a href="#l9.5"></a><span id="l9.5"> #ifndef XP_UNIX</span>
<a href="#l9.6"></a><span id="l9.6"> @BINPATH@/@MOZ_APP_NAME@.exe</span>
<a href="#l9.7"></a><span id="l9.7"> #else</span>
<a href="#l9.8"></a><span id="l9.8"> @BINPATH@/@MOZ_APP_NAME@-bin</span>
<a href="#l9.9"></a><span id="l9.9"> @BINPATH@/@MOZ_APP_NAME@</span>
<a href="#l9.10"></a><span id="l9.10"> #endif</span>
<a href="#l9.11"></a><span id="l9.11"> @BINPATH@/application.ini</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+@BINPATH@/update-settings.ini</span>
<a href="#l9.13"></a><span id="l9.13"> @BINPATH@/blocklist.xml</span>
<a href="#l9.14"></a><span id="l9.14"> @BINPATH@/platform.ini</span>
<a href="#l9.15"></a><span id="l9.15"> #ifdef XP_OS2</span>
<a href="#l9.16"></a><span id="l9.16"> @BINPATH@/@DLL_PREFIX@mozsqlt3@DLL_SUFFIX@</span>
<a href="#l9.17"></a><span id="l9.17"> #else</span>
<a href="#l9.18"></a><span id="l9.18"> @BINPATH@/@DLL_PREFIX@mozsqlite3@DLL_SUFFIX@</span>
<a href="#l9.19"></a><span id="l9.19"> #endif</span>
<a href="#l9.20"></a><span id="l9.20"> #ifdef UNIX_BUT_NOT_MAC</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineat">@@ -710,16 +711,23 @@</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23"> ; [Updater]</span>
<a href="#l9.24"></a><span id="l9.24"> #ifdef XP_MACOSX</span>
<a href="#l9.25"></a><span id="l9.25"> @BINPATH@/updater.app/</span>
<a href="#l9.26"></a><span id="l9.26"> #else</span>
<a href="#l9.27"></a><span id="l9.27"> @BINPATH@/updater@BIN_SUFFIX@</span>
<a href="#l9.28"></a><span id="l9.28"> #endif</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+; [MaintenanceService]</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+#ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+@BINPATH@/maintenanceservice.exe</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+@BINPATH@/maintenanceservice_installer.exe</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+#endif</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+</span>
<a href="#l9.37"></a><span id="l9.37"> ; [crash reporter]</span>
<a href="#l9.38"></a><span id="l9.38"> #ifdef XP_MACOSX</span>
<a href="#l9.39"></a><span id="l9.39"> @BINPATH@/crashreporter.app/</span>
<a href="#l9.40"></a><span id="l9.40"> #else</span>
<a href="#l9.41"></a><span id="l9.41"> #ifndef XP_OS2</span>
<a href="#l9.42"></a><span id="l9.42"> @BINPATH@/crashreporter@BIN_SUFFIX@</span>
<a href="#l9.43"></a><span id="l9.43"> @BINPATH@/crashreporter.ini</span>
<a href="#l9.44"></a><span id="l9.44"> #ifdef XP_UNIX</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/installer/removed-files.in</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/installer/removed-files.in</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1174,8 +1174,12 @@ components/xmlextras.xpt</span>
<a href="#l10.4"></a><span id="l10.4">     components/filepicker.xpt</span>
<a href="#l10.5"></a><span id="l10.5">     components/toolkitremote.xpt</span>
<a href="#l10.6"></a><span id="l10.6">     components/websrvcs.xpt</span>
<a href="#l10.7"></a><span id="l10.7">   #endif</span>
<a href="#l10.8"></a><span id="l10.8"> #endif</span>
<a href="#l10.9"></a><span id="l10.9"> # ****************************************************************************</span>
<a href="#l10.10"></a><span id="l10.10"> # * End of XPTs at the time we started linking them on Linux and Mac.        *</span>
<a href="#l10.11"></a><span id="l10.11"> # ****************************************************************************</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+#ifndef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+maintenanceservice.exe</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+maintenanceservice_installer.exe</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+#endif</span>
<a href="#l10.16"></a><span id="l10.16">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/installer/windows/Makefile.in</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/installer/windows/Makefile.in</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -24,16 +24,23 @@ endif</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> INSTALLER_FILES = \</span>
<a href="#l11.6"></a><span id="l11.6"> 	app.tag \</span>
<a href="#l11.7"></a><span id="l11.7"> 	nsis/installer.nsi \</span>
<a href="#l11.8"></a><span id="l11.8"> 	nsis/uninstaller.nsi \</span>
<a href="#l11.9"></a><span id="l11.9"> 	nsis/shared.nsh \</span>
<a href="#l11.10"></a><span id="l11.10"> 	$(NULL)</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+INSTALLER_FILES += \</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+	nsis/maintenanceservice_installer.nsi \</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+	$(NULL)</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+endif</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+</span>
<a href="#l11.19"></a><span id="l11.19"> BRANDING_FILES = \</span>
<a href="#l11.20"></a><span id="l11.20"> 	branding.nsi \</span>
<a href="#l11.21"></a><span id="l11.21"> 	wizHeader.bmp \</span>
<a href="#l11.22"></a><span id="l11.22"> 	wizHeaderRTL.bmp \</span>
<a href="#l11.23"></a><span id="l11.23"> 	wizWatermark.bmp \</span>
<a href="#l11.24"></a><span id="l11.24"> 	$(NULL)</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26"> DEFINES += \</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineat">@@ -56,16 +63,27 @@ uninstaller::</span>
<a href="#l11.28"></a><span id="l11.28"> 	$(INSTALL) $(addprefix $(srcdir)/,$(INSTALLER_FILES)) $(CONFIG_DIR)</span>
<a href="#l11.29"></a><span id="l11.29"> 	$(INSTALL) $(addprefix $(DIST)/branding/,$(BRANDING_FILES)) $(CONFIG_DIR)</span>
<a href="#l11.30"></a><span id="l11.30"> 	$(PYTHON) $(MOZILLA_SRCDIR)/config/Preprocessor.py -Fsubstitution $(DEFINES) $(ACDEFINES) \</span>
<a href="#l11.31"></a><span id="l11.31"> 	  $(srcdir)/nsis/defines.nsi.in &gt; $(CONFIG_DIR)/defines.nsi</span>
<a href="#l11.32"></a><span id="l11.32"> 	$(PYTHON) $(MOZILLA_SRCDIR)/toolkit/mozapps/installer/windows/nsis/preprocess-locale.py \</span>
<a href="#l11.33"></a><span id="l11.33"> 	  --preprocess-locale $(MOZILLA_SRCDIR) \</span>
<a href="#l11.34"></a><span id="l11.34"> 	  $(call EXPAND_LOCALE_SRCDIR,mail/locales)/installer $(AB_CD) $(CONFIG_DIR)</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+# For building the maintenanceservice installer</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+maintenanceservice_installer::</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+	$(INSTALL) $(addprefix $(srcdir)/,$(INSTALLER_FILES)) $(CONFIG_DIR)</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+	$(PYTHON) $(MOZILLA_SRCDIR)/config/Preprocessor.py -Fsubstitution $(DEFINES) $(ACDEFINES) \</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+	  $(srcdir)/nsis/defines.nsi.in &gt; $(CONFIG_DIR)/defines.nsi</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+	$(PYTHON) $(MOZILLA_SRCDIR)/toolkit/mozapps/installer/windows/nsis/preprocess-locale.py \</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+	  --preprocess-locale $(MOZILLA_SRCDIR) \</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+	  $(call EXPAND_LOCALE_SRCDIR,mail/locales)/installer $(AB_CD) $(CONFIG_DIR)</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+endif</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+</span>
<a href="#l11.47"></a><span id="l11.47"> $(CONFIG_DIR)/setup.exe::</span>
<a href="#l11.48"></a><span id="l11.48"> 	$(RM) -r $(CONFIG_DIR) &amp;&amp; mkdir $(CONFIG_DIR)</span>
<a href="#l11.49"></a><span id="l11.49"> 	$(INSTALL) $(addprefix $(srcdir)/,$(INSTALLER_FILES)) $(CONFIG_DIR)</span>
<a href="#l11.50"></a><span id="l11.50"> 	$(INSTALL) $(addprefix $(DIST)/branding/,$(BRANDING_FILES)) $(CONFIG_DIR)</span>
<a href="#l11.51"></a><span id="l11.51"> 	$(PYTHON) $(MOZILLA_SRCDIR)/config/Preprocessor.py -Fsubstitution $(DEFINES) $(ACDEFINES) \</span>
<a href="#l11.52"></a><span id="l11.52"> 	  $(srcdir)/nsis/defines.nsi.in &gt; $(CONFIG_DIR)/defines.nsi</span>
<a href="#l11.53"></a><span id="l11.53"> 	$(PYTHON) $(MOZILLA_SRCDIR)/toolkit/mozapps/installer/windows/nsis/preprocess-locale.py \</span>
<a href="#l11.54"></a><span id="l11.54"> 	  --preprocess-locale $(MOZILLA_SRCDIR) \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/installer/windows/nsis/defines.nsi.in</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/installer/windows/nsis/defines.nsi.in</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -18,16 +18,19 @@</span>
<a href="#l12.4"></a><span id="l12.4"> !define AppRegNameNews        &quot;Thunderbird (News)&quot;</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> !define ClientsRegName        &quot;Mozilla Thunderbird&quot;</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> !define BrandShortName        &quot;@MOZ_APP_DISPLAYNAME@&quot;</span>
<a href="#l12.9"></a><span id="l12.9"> !define PreReleaseSuffix      &quot;@PRE_RELEASE_SUFFIX@&quot;</span>
<a href="#l12.10"></a><span id="l12.10"> !define BrandFullName         &quot;${BrandFullNameInternal}${PreReleaseSuffix}&quot;</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+!define CERTIFICATE_NAME      &quot;Mozilla Corporation&quot;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+!define CERTIFICATE_ISSUER    &quot;Thawte Code Signing CA - G2&quot;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+</span>
<a href="#l12.15"></a><span id="l12.15"> # NO_INSTDIR_FROM_REG is defined for pre-releases which have a PreReleaseSuffix</span>
<a href="#l12.16"></a><span id="l12.16"> # (e.g. Alpha X, Beta X, etc.) to prevent finding a non-default installation</span>
<a href="#l12.17"></a><span id="l12.17"> # directory in the registry and using that as the default. This prevents</span>
<a href="#l12.18"></a><span id="l12.18"> # Beta releases built with official branding from finding an existing install</span>
<a href="#l12.19"></a><span id="l12.19"> # of an official release and defaulting to its installation directory.</span>
<a href="#l12.20"></a><span id="l12.20"> !if &quot;@PRE_RELEASE_SUFFIX@&quot; != &quot;&quot;</span>
<a href="#l12.21"></a><span id="l12.21"> !define NO_INSTDIR_FROM_REG</span>
<a href="#l12.22"></a><span id="l12.22"> !endif</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineat">@@ -38,16 +41,20 @@</span>
<a href="#l12.24"></a><span id="l12.24"> !define HAVE_64BIT_OS</span>
<a href="#l12.25"></a><span id="l12.25"> !define ARCH &quot;x64&quot;</span>
<a href="#l12.26"></a><span id="l12.26"> !define MinSupportedVer &quot;Microsoft Windows Vista x64&quot;</span>
<a href="#l12.27"></a><span id="l12.27"> #else</span>
<a href="#l12.28"></a><span id="l12.28"> !define ARCH &quot;x86&quot;</span>
<a href="#l12.29"></a><span id="l12.29"> !define MinSupportedVer &quot;Microsoft Windows XP SP2&quot;</span>
<a href="#l12.30"></a><span id="l12.30"> #endif</span>
<a href="#l12.31"></a><span id="l12.31"> </span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+#ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+!define MOZ_MAINTENANCE_SERVICE</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+#endif</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+</span>
<a href="#l12.36"></a><span id="l12.36"> # File details shared by both the installer and uninstaller</span>
<a href="#l12.37"></a><span id="l12.37"> VIProductVersion &quot;1.0.0.0&quot;</span>
<a href="#l12.38"></a><span id="l12.38"> VIAddVersionKey &quot;ProductName&quot;     &quot;${BrandShortName}&quot;</span>
<a href="#l12.39"></a><span id="l12.39"> VIAddVersionKey &quot;CompanyName&quot;     &quot;${CompanyName}&quot;</span>
<a href="#l12.40"></a><span id="l12.40"> #ifdef MOZ_OFFICIAL_BRANDING</span>
<a href="#l12.41"></a><span id="l12.41"> VIAddVersionKey &quot;LegalTrademarks&quot; &quot;${BrandShortName} is a Trademark of The Mozilla Foundation.&quot;</span>
<a href="#l12.42"></a><span id="l12.42"> #endif</span>
<a href="#l12.43"></a><span id="l12.43"> VIAddVersionKey &quot;LegalCopyright&quot;  &quot;${CompanyName}&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/installer/windows/nsis/installer.nsi</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/installer/windows/nsis/installer.nsi</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1,17 +1,19 @@</span>
<a href="#l13.4"></a><span id="l13.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.5"></a><span id="l13.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.6"></a><span id="l13.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> # Required Plugins:</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">-# AppAssocReg http://nsis.sourceforge.net/Application_Association_Registration_plug-in</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-# CityHash    http://mxr.mozilla.org/mozilla-central/source/other-licenses/nsis/Contrib/CityHash</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">-# ShellLink   http://nsis.sourceforge.net/ShellLink_plug-in</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-# UAC         http://nsis.sourceforge.net/UAC_plug-in</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+# AppAssocReg    http://nsis.sourceforge.net/Application_Association_Registration_plug-in</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+# ApplicationID  http://nsis.sourceforge.net/ApplicationID_plug-in</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+# CityHash       http://mxr.mozilla.org/mozilla-central/source/other-licenses/nsis/Contrib/CityHash</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+# ShellLink      http://nsis.sourceforge.net/ShellLink_plug-in</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+# UAC            http://nsis.sourceforge.net/UAC_plug-in</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+# ServicesHelper Mozilla specific plugin that is located in /other-licenses/nsis</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20"> ; Set verbosity to 3 (e.g. no script) to lessen the noise in the build logs</span>
<a href="#l13.21"></a><span id="l13.21"> !verbose 3</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23"> ; 7-Zip provides better compression than the lzma from NSIS so we add the files</span>
<a href="#l13.24"></a><span id="l13.24"> ; uncompressed and use 7-Zip to create a SFX archive of it</span>
<a href="#l13.25"></a><span id="l13.25"> SetDatablockOptimize on</span>
<a href="#l13.26"></a><span id="l13.26"> SetCompress off</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineat">@@ -21,16 +23,17 @@ RequestExecutionLevel user</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29"> !addplugindir ./</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31"> Var TmpVal</span>
<a href="#l13.32"></a><span id="l13.32"> Var InstallType</span>
<a href="#l13.33"></a><span id="l13.33"> Var AddStartMenuSC</span>
<a href="#l13.34"></a><span id="l13.34"> Var AddQuickLaunchSC</span>
<a href="#l13.35"></a><span id="l13.35"> Var AddDesktopSC</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+Var InstallMaintenanceService</span>
<a href="#l13.37"></a><span id="l13.37"> Var PageName</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39"> ; By defining NO_STARTMENU_DIR an installer that doesn't provide an option for</span>
<a href="#l13.40"></a><span id="l13.40"> ; an application's Start Menu PROGRAMS directory and doesn't define the</span>
<a href="#l13.41"></a><span id="l13.41"> ; StartMenuDir variable can use the common InstallOnInitCommon macro.</span>
<a href="#l13.42"></a><span id="l13.42"> !define NO_STARTMENU_DIR</span>
<a href="#l13.43"></a><span id="l13.43"> </span>
<a href="#l13.44"></a><span id="l13.44"> ; On Vista and above attempt to elevate Standard Users in addition to users that</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineat">@@ -70,16 +73,17 @@ VIAddVersionKey &quot;OriginalFilename&quot; &quot;setu</span>
<a href="#l13.46"></a><span id="l13.46"> !insertmacro ChangeMUIHeaderImage</span>
<a href="#l13.47"></a><span id="l13.47"> !insertmacro CheckForFilesInUse</span>
<a href="#l13.48"></a><span id="l13.48"> !insertmacro CleanUpdatesDir</span>
<a href="#l13.49"></a><span id="l13.49"> !insertmacro CopyFilesFromDir</span>
<a href="#l13.50"></a><span id="l13.50"> !insertmacro GetPathFromString</span>
<a href="#l13.51"></a><span id="l13.51"> !insertmacro GetParent</span>
<a href="#l13.52"></a><span id="l13.52"> !insertmacro InitHashAppModelId</span>
<a href="#l13.53"></a><span id="l13.53"> !insertmacro IsHandlerForInstallDir</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+!insertmacro IsUserAdmin</span>
<a href="#l13.55"></a><span id="l13.55"> !insertmacro LogDesktopShortcut</span>
<a href="#l13.56"></a><span id="l13.56"> !insertmacro LogQuickLaunchShortcut</span>
<a href="#l13.57"></a><span id="l13.57"> !insertmacro LogStartMenuShortcut</span>
<a href="#l13.58"></a><span id="l13.58"> !insertmacro ManualCloseAppPrompt</span>
<a href="#l13.59"></a><span id="l13.59"> !insertmacro RegCleanMain</span>
<a href="#l13.60"></a><span id="l13.60"> !insertmacro RegCleanUninstall</span>
<a href="#l13.61"></a><span id="l13.61"> !insertmacro SetBrandNameVars</span>
<a href="#l13.62"></a><span id="l13.62"> !insertmacro UpdateShortcutAppModelIDs</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineat">@@ -138,16 +142,21 @@ ShowInstDetails nevershow</span>
<a href="#l13.64"></a><span id="l13.64"> Page custom preOptions leaveOptions</span>
<a href="#l13.65"></a><span id="l13.65"> </span>
<a href="#l13.66"></a><span id="l13.66"> ; Select Install Directory Page</span>
<a href="#l13.67"></a><span id="l13.67"> !define MUI_PAGE_CUSTOMFUNCTION_PRE preDirectory</span>
<a href="#l13.68"></a><span id="l13.68"> !define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveDirectory</span>
<a href="#l13.69"></a><span id="l13.69"> !define MUI_DIRECTORYPAGE_VERIFYONLEAVE</span>
<a href="#l13.70"></a><span id="l13.70"> !insertmacro MUI_PAGE_DIRECTORY</span>
<a href="#l13.71"></a><span id="l13.71"> </span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+; Custom Components Page</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+!ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+Page custom preComponents leaveComponents</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+!endif</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+</span>
<a href="#l13.77"></a><span id="l13.77"> ; Custom Shortcuts Page</span>
<a href="#l13.78"></a><span id="l13.78"> Page custom preShortcuts leaveShortcuts</span>
<a href="#l13.79"></a><span id="l13.79"> </span>
<a href="#l13.80"></a><span id="l13.80"> ; Custom Summary Page</span>
<a href="#l13.81"></a><span id="l13.81"> Page custom preSummary leaveSummary</span>
<a href="#l13.82"></a><span id="l13.82"> </span>
<a href="#l13.83"></a><span id="l13.83"> ; Install Files Page</span>
<a href="#l13.84"></a><span id="l13.84"> !insertmacro MUI_PAGE_INSTFILES</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineat">@@ -349,16 +358,47 @@ Section &quot;-Application&quot; APP_IDX</span>
<a href="#l13.86"></a><span id="l13.86">     ${If} $AddQuickLaunchSC == 1</span>
<a href="#l13.87"></a><span id="l13.87">     ${OrIf} $AddDesktopSC == 1</span>
<a href="#l13.88"></a><span id="l13.88">       WriteRegDWORD HKLM &quot;$0&quot; &quot;IconsVisible&quot; 1</span>
<a href="#l13.89"></a><span id="l13.89">     ${Else}</span>
<a href="#l13.90"></a><span id="l13.90">       WriteRegDWORD HKLM &quot;$0&quot; &quot;IconsVisible&quot; 0</span>
<a href="#l13.91"></a><span id="l13.91">     ${EndIf}</span>
<a href="#l13.92"></a><span id="l13.92">   ${EndIf}</span>
<a href="#l13.93"></a><span id="l13.93"> </span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+!ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+  ; If the maintenance service page was displayed then a value was already </span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+  ; explicitly selected for installing the maintenance service and </span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+  ; and so InstallMaintenanceService will already be 0 or 1.</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+  ; If the maintenance service page was not displayed then </span>
<a href="#l13.99"></a><span id="l13.99" class="difflineplus">+  ; InstallMaintenanceService will be equal to &quot;&quot;.</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineplus">+  ${If} $InstallMaintenanceService == &quot;&quot;</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+    Call IsUserAdmin</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+    Pop $R0</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+    ${If} $R0 == &quot;true&quot;</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+    ; Only proceed if we have HKLM write access</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineplus">+    ${AndIf} $TmpVal == &quot;HKLM&quot;</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineplus">+    ; On Windows 2000 we do not install the maintenance service.</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineplus">+    ${AndIf} ${AtLeastWinXP}</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineplus">+      ; The user is an admin so we should default to install service yes</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineplus">+      StrCpy $InstallMaintenanceService &quot;1&quot;</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+    ${Else}</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineplus">+      ; The user is not admin so we should default to install service no</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+      StrCpy $InstallMaintenanceService &quot;0&quot;</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineplus">+    ${EndIf}</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineplus">+  ${EndIf}</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineplus">+  ${If} $InstallMaintenanceService == &quot;1&quot;</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineplus">+    ; The user wants to install the maintenance service, so execute</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineplus">+    ; the pre-packaged maintenance service installer. </span>
<a href="#l13.119"></a><span id="l13.119" class="difflineplus">+    ; This option can only be turned on if the user is an admin so there</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineplus">+    ; is no need to use ExecShell w/ verb runas to enforce elevated.</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineplus">+    nsExec::Exec &quot;$INSTDIR\maintenanceservice_installer.exe&quot; </span>
<a href="#l13.122"></a><span id="l13.122" class="difflineplus">+  ${EndIf}</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineplus">+!endif</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineplus">+</span>
<a href="#l13.125"></a><span id="l13.125">   ; These need special handling on uninstall since they may be overwritten by</span>
<a href="#l13.126"></a><span id="l13.126">   ; an install into a different location.</span>
<a href="#l13.127"></a><span id="l13.127">   StrCpy $0 &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\${FileMainEXE}&quot;</span>
<a href="#l13.128"></a><span id="l13.128">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l13.129"></a><span id="l13.129">   ${WriteRegStr2} $TmpVal &quot;$0&quot; &quot;Path&quot; &quot;$INSTDIR&quot; 0</span>
<a href="#l13.130"></a><span id="l13.130"> </span>
<a href="#l13.131"></a><span id="l13.131">   ; Create shortcuts</span>
<a href="#l13.132"></a><span id="l13.132">   ${LogHeader} &quot;Adding Shortcuts&quot;</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineat">@@ -392,17 +432,17 @@ Section &quot;-Application&quot; APP_IDX</span>
<a href="#l13.134"></a><span id="l13.134">   ; maintenance for the unelevated user context in case that is different than</span>
<a href="#l13.135"></a><span id="l13.135">   ; the current user.</span>
<a href="#l13.136"></a><span id="l13.136">   ClearErrors</span>
<a href="#l13.137"></a><span id="l13.137">   ${GetParameters} $0</span>
<a href="#l13.138"></a><span id="l13.138">   ${GetOptions} &quot;$0&quot; &quot;/UAC:&quot; $0</span>
<a href="#l13.139"></a><span id="l13.139">   ${Unless} ${Errors}</span>
<a href="#l13.140"></a><span id="l13.140">     GetFunctionAddress $0 FixShortcutAppModelIDs</span>
<a href="#l13.141"></a><span id="l13.141">     UAC::ExecCodeSegment $0</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineminus">-  ${EndIf}</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineplus">+  ${EndUnless}</span>
<a href="#l13.144"></a><span id="l13.144"> </span>
<a href="#l13.145"></a><span id="l13.145">   ; UAC only allows elevating to an Admin account so there is no need to add</span>
<a href="#l13.146"></a><span id="l13.146">   ; the Start Menu or Desktop shortcuts from the original unelevated process</span>
<a href="#l13.147"></a><span id="l13.147">   ; since this will either add it for the user if unelevated or All Users if</span>
<a href="#l13.148"></a><span id="l13.148">   ; elevated.</span>
<a href="#l13.149"></a><span id="l13.149">   ${If} $AddStartMenuSC == 1</span>
<a href="#l13.150"></a><span id="l13.150">     CreateShortCut &quot;$SMPROGRAMS\${BrandFullName}.lnk&quot; &quot;$INSTDIR\${FileMainEXE}&quot; \</span>
<a href="#l13.151"></a><span id="l13.151">                    &quot;&quot; &quot;$INSTDIR\${FileMainEXE}&quot; 0</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineat">@@ -440,16 +480,23 @@ Section &quot;-Application&quot; APP_IDX</span>
<a href="#l13.153"></a><span id="l13.153">       ; It is not possible to add a log entry from the unelevated process so</span>
<a href="#l13.154"></a><span id="l13.154">       ; add the log entry without the path since there is no simple way to know</span>
<a href="#l13.155"></a><span id="l13.155">       ; the correct full path.</span>
<a href="#l13.156"></a><span id="l13.156">       ${LogMsg} &quot;Added Quick Launch Shortcut: ${BrandFullName}.lnk&quot;</span>
<a href="#l13.157"></a><span id="l13.157">       GetFunctionAddress $0 AddQuickLaunchShortcut</span>
<a href="#l13.158"></a><span id="l13.158">       UAC::ExecCodeSegment $0</span>
<a href="#l13.159"></a><span id="l13.159">     ${EndIf}</span>
<a href="#l13.160"></a><span id="l13.160">   ${EndIf}</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineplus">+</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineplus">+!ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineplus">+  ${If} $TmpVal == &quot;HKLM&quot;</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineplus">+    ; Add the registry keys for allowed certificates.</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineplus">+    ${AddMaintCertKeys}</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineplus">+  ${EndIf}</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineplus">+!endif</span>
<a href="#l13.168"></a><span id="l13.168"> SectionEnd</span>
<a href="#l13.169"></a><span id="l13.169"> </span>
<a href="#l13.170"></a><span id="l13.170"> ; Cleanup operations to perform at the end of the installation.</span>
<a href="#l13.171"></a><span id="l13.171"> Section &quot;-InstallEndCleanup&quot;</span>
<a href="#l13.172"></a><span id="l13.172">   SetDetailsPrint both</span>
<a href="#l13.173"></a><span id="l13.173">   DetailPrint &quot;$(STATUS_CLEANUP)&quot;</span>
<a href="#l13.174"></a><span id="l13.174">   SetDetailsPrint none</span>
<a href="#l13.175"></a><span id="l13.175"> </span>
<a href="#l13.176"></a><span id="l13.176" class="difflineat">@@ -742,16 +789,68 @@ Function leaveShortcuts</span>
<a href="#l13.177"></a><span id="l13.177">   ${MUI_INSTALLOPTIONS_READ} $AddStartMenuSC &quot;shortcuts.ini&quot; &quot;Field 3&quot; &quot;State&quot;</span>
<a href="#l13.178"></a><span id="l13.178">   ${MUI_INSTALLOPTIONS_READ} $AddQuickLaunchSC &quot;shortcuts.ini&quot; &quot;Field 4&quot; &quot;State&quot;</span>
<a href="#l13.179"></a><span id="l13.179"> </span>
<a href="#l13.180"></a><span id="l13.180">   ${If} $InstallType == ${INSTALLTYPE_CUSTOM}</span>
<a href="#l13.181"></a><span id="l13.181">     Call CheckExistingInstall</span>
<a href="#l13.182"></a><span id="l13.182">   ${EndIf}</span>
<a href="#l13.183"></a><span id="l13.183"> FunctionEnd</span>
<a href="#l13.184"></a><span id="l13.184"> </span>
<a href="#l13.185"></a><span id="l13.185" class="difflineplus">+!ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineplus">+Function preComponents</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineplus">+  ; If the service already exists, don't show this page</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineplus">+  ServicesHelper::IsInstalled &quot;MozillaMaintenance&quot;</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineplus">+  Pop $R9</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineplus">+  ${If} $R9 == 1</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineplus">+    ; The service already exists so don't show this page.</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineplus">+    Abort</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineplus">+  ${EndIf}</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineplus">+</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineplus">+  ; On Windows 2000 we do not install the maintenance service.</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineplus">+  ${Unless} ${AtLeastWinXP}</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineplus">+    Abort</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineplus">+  ${EndUnless}</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineplus">+</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineplus">+  ; Don't show the custom components page if the</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineplus">+  ; user is not an admin</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineplus">+  Call IsUserAdmin</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineplus">+  Pop $R9</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineplus">+  ${If} $R9 != &quot;true&quot;</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineplus">+    Abort</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineplus">+  ${EndIf}</span>
<a href="#l13.207"></a><span id="l13.207" class="difflineplus">+</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineplus">+  ; Only show the maintenance service page if we have write access to HKLM</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineplus">+  ClearErrors</span>
<a href="#l13.210"></a><span id="l13.210" class="difflineplus">+  WriteRegStr HKLM &quot;Software\Mozilla&quot; \</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineplus">+              &quot;${BrandShortName}InstallerTest&quot; &quot;Write Test&quot;</span>
<a href="#l13.212"></a><span id="l13.212" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l13.213"></a><span id="l13.213" class="difflineplus">+    ClearErrors</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineplus">+    Abort</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineplus">+  ${Else}</span>
<a href="#l13.216"></a><span id="l13.216" class="difflineplus">+    DeleteRegValue HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l13.217"></a><span id="l13.217" class="difflineplus">+  ${EndIf}</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineplus">+</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineplus">+  StrCpy $PageName &quot;Components&quot;</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineplus">+  ${CheckCustomCommon}</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineplus">+  !insertmacro MUI_HEADER_TEXT &quot;$(COMPONENTS_PAGE_TITLE)&quot; &quot;$(COMPONENTS_PAGE_SUBTITLE)&quot;</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineplus">+  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;components.ini&quot;</span>
<a href="#l13.223"></a><span id="l13.223" class="difflineplus">+FunctionEnd</span>
<a href="#l13.224"></a><span id="l13.224" class="difflineplus">+</span>
<a href="#l13.225"></a><span id="l13.225" class="difflineplus">+Function leaveComponents</span>
<a href="#l13.226"></a><span id="l13.226" class="difflineplus">+  ${MUI_INSTALLOPTIONS_READ} $0 &quot;components.ini&quot; &quot;Settings&quot; &quot;State&quot;</span>
<a href="#l13.227"></a><span id="l13.227" class="difflineplus">+  ${If} $0 != 0</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineplus">+    Abort</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineplus">+  ${EndIf}</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineplus">+  ${MUI_INSTALLOPTIONS_READ} $InstallMaintenanceService &quot;components.ini&quot; &quot;Field 2&quot; &quot;State&quot;</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineplus">+  ${If} $InstallType == ${INSTALLTYPE_CUSTOM}</span>
<a href="#l13.232"></a><span id="l13.232" class="difflineplus">+    Call CheckExistingInstall</span>
<a href="#l13.233"></a><span id="l13.233" class="difflineplus">+  ${EndIf}</span>
<a href="#l13.234"></a><span id="l13.234" class="difflineplus">+FunctionEnd</span>
<a href="#l13.235"></a><span id="l13.235" class="difflineplus">+!endif</span>
<a href="#l13.236"></a><span id="l13.236" class="difflineplus">+</span>
<a href="#l13.237"></a><span id="l13.237"> Function preSummary</span>
<a href="#l13.238"></a><span id="l13.238">   StrCpy $PageName &quot;Summary&quot;</span>
<a href="#l13.239"></a><span id="l13.239">   ; Setup the summary.ini file for the Custom Summary Page</span>
<a href="#l13.240"></a><span id="l13.240">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Settings&quot; NumFields &quot;3&quot;</span>
<a href="#l13.241"></a><span id="l13.241"> </span>
<a href="#l13.242"></a><span id="l13.242">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 1&quot; Type   &quot;label&quot;</span>
<a href="#l13.243"></a><span id="l13.243">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 1&quot; Text   &quot;$(SUMMARY_INSTALLED_TO)&quot;</span>
<a href="#l13.244"></a><span id="l13.244">   WriteINIStr &quot;$PLUGINSDIR\summary.ini&quot; &quot;Field 1&quot; Left   &quot;0&quot;</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineat">@@ -849,16 +948,17 @@ Function .onInit</span>
<a href="#l13.246"></a><span id="l13.246">   StrCpy $PageName &quot;&quot;</span>
<a href="#l13.247"></a><span id="l13.247">   StrCpy $LANGUAGE 0</span>
<a href="#l13.248"></a><span id="l13.248">   ${SetBrandNameVars} &quot;$EXEDIR\core\distribution\setup.ini&quot;</span>
<a href="#l13.249"></a><span id="l13.249"> </span>
<a href="#l13.250"></a><span id="l13.250">   ${InstallOnInitCommon} &quot;$(WARN_MIN_SUPPORTED_OS_MSG)&quot;</span>
<a href="#l13.251"></a><span id="l13.251"> </span>
<a href="#l13.252"></a><span id="l13.252">   !insertmacro InitInstallOptionsFile &quot;options.ini&quot;</span>
<a href="#l13.253"></a><span id="l13.253">   !insertmacro InitInstallOptionsFile &quot;shortcuts.ini&quot;</span>
<a href="#l13.254"></a><span id="l13.254" class="difflineplus">+  !insertmacro InitInstallOptionsFile &quot;components.ini&quot;</span>
<a href="#l13.255"></a><span id="l13.255">   !insertmacro InitInstallOptionsFile &quot;summary.ini&quot;</span>
<a href="#l13.256"></a><span id="l13.256"> </span>
<a href="#l13.257"></a><span id="l13.257">   ClearErrors</span>
<a href="#l13.258"></a><span id="l13.258">   ${If} ${AtLeastWinVista}</span>
<a href="#l13.259"></a><span id="l13.259">     WriteRegStr HKLM &quot;Software\Mozilla&quot; &quot;${BrandShortName}InstallerTest&quot; &quot;Write Test&quot;</span>
<a href="#l13.260"></a><span id="l13.260">   ${EndIf}</span>
<a href="#l13.261"></a><span id="l13.261">   ${If} ${Errors}</span>
<a href="#l13.262"></a><span id="l13.262">     ; Setup the options.ini file for the Custom Options Page without the option</span>
<a href="#l13.263"></a><span id="l13.263" class="difflineat">@@ -884,80 +984,99 @@ Function .onInit</span>
<a href="#l13.264"></a><span id="l13.264">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 1&quot; Text   &quot;$(OPTIONS_SUMMARY)&quot;</span>
<a href="#l13.265"></a><span id="l13.265">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 1&quot; Left   &quot;0&quot;</span>
<a href="#l13.266"></a><span id="l13.266">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 1&quot; Right  &quot;-1&quot;</span>
<a href="#l13.267"></a><span id="l13.267">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 1&quot; Top    &quot;0&quot;</span>
<a href="#l13.268"></a><span id="l13.268">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 1&quot; Bottom &quot;10&quot;</span>
<a href="#l13.269"></a><span id="l13.269"> </span>
<a href="#l13.270"></a><span id="l13.270">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 2&quot; Type   &quot;RadioButton&quot;</span>
<a href="#l13.271"></a><span id="l13.271">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 2&quot; Text   &quot;$(OPTION_STANDARD_RADIO)&quot;</span>
<a href="#l13.272"></a><span id="l13.272" class="difflineminus">-  WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 2&quot; Left   &quot;15&quot;</span>
<a href="#l13.273"></a><span id="l13.273" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 2&quot; Left   &quot;0&quot;</span>
<a href="#l13.274"></a><span id="l13.274">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 2&quot; Right  &quot;-1&quot;</span>
<a href="#l13.275"></a><span id="l13.275">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 2&quot; Top    &quot;25&quot;</span>
<a href="#l13.276"></a><span id="l13.276">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 2&quot; Bottom &quot;35&quot;</span>
<a href="#l13.277"></a><span id="l13.277">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 2&quot; State  &quot;1&quot;</span>
<a href="#l13.278"></a><span id="l13.278">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 2&quot; Flags  &quot;GROUP&quot;</span>
<a href="#l13.279"></a><span id="l13.279"> </span>
<a href="#l13.280"></a><span id="l13.280">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 3&quot; Type   &quot;RadioButton&quot;</span>
<a href="#l13.281"></a><span id="l13.281">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 3&quot; Text   &quot;$(OPTION_CUSTOM_RADIO)&quot;</span>
<a href="#l13.282"></a><span id="l13.282" class="difflineminus">-  WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 3&quot; Left   &quot;15&quot;</span>
<a href="#l13.283"></a><span id="l13.283" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 3&quot; Left   &quot;0&quot;</span>
<a href="#l13.284"></a><span id="l13.284">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 3&quot; Right  &quot;-1&quot;</span>
<a href="#l13.285"></a><span id="l13.285">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 3&quot; Top    &quot;55&quot;</span>
<a href="#l13.286"></a><span id="l13.286">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 3&quot; Bottom &quot;65&quot;</span>
<a href="#l13.287"></a><span id="l13.287">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 3&quot; State  &quot;0&quot;</span>
<a href="#l13.288"></a><span id="l13.288"> </span>
<a href="#l13.289"></a><span id="l13.289">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 4&quot; Type   &quot;label&quot;</span>
<a href="#l13.290"></a><span id="l13.290">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 4&quot; Text   &quot;$(OPTION_STANDARD_DESC)&quot;</span>
<a href="#l13.291"></a><span id="l13.291" class="difflineminus">-  WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 4&quot; Left   &quot;30&quot;</span>
<a href="#l13.292"></a><span id="l13.292" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 4&quot; Left   &quot;15&quot;</span>
<a href="#l13.293"></a><span id="l13.293">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 4&quot; Right  &quot;-1&quot;</span>
<a href="#l13.294"></a><span id="l13.294">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 4&quot; Top    &quot;37&quot;</span>
<a href="#l13.295"></a><span id="l13.295">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 4&quot; Bottom &quot;57&quot;</span>
<a href="#l13.296"></a><span id="l13.296"> </span>
<a href="#l13.297"></a><span id="l13.297">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 5&quot; Type   &quot;label&quot;</span>
<a href="#l13.298"></a><span id="l13.298">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 5&quot; Text   &quot;$(OPTION_CUSTOM_DESC)&quot;</span>
<a href="#l13.299"></a><span id="l13.299" class="difflineminus">-  WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 5&quot; Left   &quot;30&quot;</span>
<a href="#l13.300"></a><span id="l13.300" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 5&quot; Left   &quot;15&quot;</span>
<a href="#l13.301"></a><span id="l13.301">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 5&quot; Right  &quot;-1&quot;</span>
<a href="#l13.302"></a><span id="l13.302">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 5&quot; Top    &quot;67&quot;</span>
<a href="#l13.303"></a><span id="l13.303">   WriteINIStr &quot;$PLUGINSDIR\options.ini&quot; &quot;Field 5&quot; Bottom &quot;87&quot;</span>
<a href="#l13.304"></a><span id="l13.304"> </span>
<a href="#l13.305"></a><span id="l13.305">   ; Setup the shortcuts.ini file for the Custom Shortcuts Page</span>
<a href="#l13.306"></a><span id="l13.306">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Settings&quot; NumFields &quot;4&quot;</span>
<a href="#l13.307"></a><span id="l13.307"> </span>
<a href="#l13.308"></a><span id="l13.308">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 1&quot; Type   &quot;label&quot;</span>
<a href="#l13.309"></a><span id="l13.309">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 1&quot; Text   &quot;$(CREATE_ICONS_DESC)&quot;</span>
<a href="#l13.310"></a><span id="l13.310">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 1&quot; Left   &quot;0&quot;</span>
<a href="#l13.311"></a><span id="l13.311">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 1&quot; Right  &quot;-1&quot;</span>
<a href="#l13.312"></a><span id="l13.312">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 1&quot; Top    &quot;5&quot;</span>
<a href="#l13.313"></a><span id="l13.313">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 1&quot; Bottom &quot;15&quot;</span>
<a href="#l13.314"></a><span id="l13.314"> </span>
<a href="#l13.315"></a><span id="l13.315">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 2&quot; Type   &quot;checkbox&quot;</span>
<a href="#l13.316"></a><span id="l13.316">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 2&quot; Text   &quot;$(ICONS_DESKTOP)&quot;</span>
<a href="#l13.317"></a><span id="l13.317" class="difflineminus">-  WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 2&quot; Left   &quot;15&quot;</span>
<a href="#l13.318"></a><span id="l13.318" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 2&quot; Left   &quot;0&quot;</span>
<a href="#l13.319"></a><span id="l13.319">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 2&quot; Right  &quot;-1&quot;</span>
<a href="#l13.320"></a><span id="l13.320">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 2&quot; Top    &quot;20&quot;</span>
<a href="#l13.321"></a><span id="l13.321">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 2&quot; Bottom &quot;30&quot;</span>
<a href="#l13.322"></a><span id="l13.322">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 2&quot; State  &quot;1&quot;</span>
<a href="#l13.323"></a><span id="l13.323">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 2&quot; Flags  &quot;GROUP&quot;</span>
<a href="#l13.324"></a><span id="l13.324"> </span>
<a href="#l13.325"></a><span id="l13.325">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 3&quot; Type   &quot;checkbox&quot;</span>
<a href="#l13.326"></a><span id="l13.326">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 3&quot; Text   &quot;$(ICONS_STARTMENU)&quot;</span>
<a href="#l13.327"></a><span id="l13.327" class="difflineminus">-  WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 3&quot; Left   &quot;15&quot;</span>
<a href="#l13.328"></a><span id="l13.328" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 3&quot; Left   &quot;0&quot;</span>
<a href="#l13.329"></a><span id="l13.329">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 3&quot; Right  &quot;-1&quot;</span>
<a href="#l13.330"></a><span id="l13.330">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 3&quot; Top    &quot;40&quot;</span>
<a href="#l13.331"></a><span id="l13.331">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 3&quot; Bottom &quot;50&quot;</span>
<a href="#l13.332"></a><span id="l13.332">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 3&quot; State  &quot;1&quot;</span>
<a href="#l13.333"></a><span id="l13.333"> </span>
<a href="#l13.334"></a><span id="l13.334">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Type   &quot;checkbox&quot;</span>
<a href="#l13.335"></a><span id="l13.335">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Text   &quot;$(ICONS_QUICKLAUNCH)&quot;</span>
<a href="#l13.336"></a><span id="l13.336" class="difflineminus">-  WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Left   &quot;15&quot;</span>
<a href="#l13.337"></a><span id="l13.337" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Left   &quot;0&quot;</span>
<a href="#l13.338"></a><span id="l13.338">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Right  &quot;-1&quot;</span>
<a href="#l13.339"></a><span id="l13.339">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Top    &quot;60&quot;</span>
<a href="#l13.340"></a><span id="l13.340">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; Bottom &quot;70&quot;</span>
<a href="#l13.341"></a><span id="l13.341">   WriteINIStr &quot;$PLUGINSDIR\shortcuts.ini&quot; &quot;Field 4&quot; State  &quot;1&quot;</span>
<a href="#l13.342"></a><span id="l13.342"> </span>
<a href="#l13.343"></a><span id="l13.343" class="difflineplus">+  ; Setup the components.ini file for the Components Page</span>
<a href="#l13.344"></a><span id="l13.344" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Settings&quot; NumFields &quot;2&quot;</span>
<a href="#l13.345"></a><span id="l13.345" class="difflineplus">+</span>
<a href="#l13.346"></a><span id="l13.346" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 1&quot; Type   &quot;label&quot;</span>
<a href="#l13.347"></a><span id="l13.347" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 1&quot; Text   &quot;$(OPTIONAL_COMPONENTS_DESC)&quot;</span>
<a href="#l13.348"></a><span id="l13.348" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 1&quot; Left   &quot;0&quot;</span>
<a href="#l13.349"></a><span id="l13.349" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 1&quot; Right  &quot;-1&quot;</span>
<a href="#l13.350"></a><span id="l13.350" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 1&quot; Top    &quot;5&quot;</span>
<a href="#l13.351"></a><span id="l13.351" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 1&quot; Bottom &quot;15&quot;</span>
<a href="#l13.352"></a><span id="l13.352" class="difflineplus">+</span>
<a href="#l13.353"></a><span id="l13.353" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 2&quot; Type   &quot;checkbox&quot;</span>
<a href="#l13.354"></a><span id="l13.354" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 2&quot; Text   &quot;$(MAINTENANCE_SERVICE_CHECKBOX_DESC)&quot;</span>
<a href="#l13.355"></a><span id="l13.355" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 2&quot; Left   &quot;0&quot;</span>
<a href="#l13.356"></a><span id="l13.356" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 2&quot; Right  &quot;-1&quot;</span>
<a href="#l13.357"></a><span id="l13.357" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 2&quot; Top    &quot;20&quot;</span>
<a href="#l13.358"></a><span id="l13.358" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 2&quot; Bottom &quot;30&quot;</span>
<a href="#l13.359"></a><span id="l13.359" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 2&quot; State  &quot;1&quot;</span>
<a href="#l13.360"></a><span id="l13.360" class="difflineplus">+  WriteINIStr &quot;$PLUGINSDIR\components.ini&quot; &quot;Field 2&quot; Flags  &quot;GROUP&quot;</span>
<a href="#l13.361"></a><span id="l13.361" class="difflineplus">+</span>
<a href="#l13.362"></a><span id="l13.362">   ; There must always be a core directory.</span>
<a href="#l13.363"></a><span id="l13.363">   ${GetSize} &quot;$EXEDIR\core\&quot; &quot;/S=0K&quot; $R5 $R7 $R8</span>
<a href="#l13.364"></a><span id="l13.364">   ; Add 1024 Kb to the diskspace requirement since the installer makes a copy</span>
<a href="#l13.365"></a><span id="l13.365">   ; of the MAPI dll's (around 20 Kb)... also, see Bug 434338.</span>
<a href="#l13.366"></a><span id="l13.366">   IntOp $R5 $R5 + 1024</span>
<a href="#l13.367"></a><span id="l13.367">   SectionSetSize ${APP_IDX} $R5</span>
<a href="#l13.368"></a><span id="l13.368"> </span>
<a href="#l13.369"></a><span id="l13.369">   ; Initialize $hHeaderBitmap to prevent redundant changing of the bitmap if</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/mail/installer/windows/nsis/maintenanceservice_installer.nsi</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,255 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineplus">+</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+; Set verbosity to 3 (e.g. no script) to lessen the noise in the build logs</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineplus">+!verbose 3</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+; 7-Zip provides better compression than the lzma from NSIS so we add the files</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+; uncompressed and use 7-Zip to create a SFX archive of it</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+SetDatablockOptimize on</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+SetCompress off</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+CRCCheck on</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+RequestExecutionLevel admin</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+!addplugindir ./</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+; Variables</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+Var TempMaintServiceName</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+Var BrandFullNameDA</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+Var BrandFullName</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+; Other included files may depend upon these includes!</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+; The following includes are provided by NSIS.</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+!include FileFunc.nsh</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+!include LogicLib.nsh</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+!include MUI.nsh</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+!include WinMessages.nsh</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+!include WinVer.nsh</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+!include WordFunc.nsh</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+!insertmacro GetOptions</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+!insertmacro GetParameters</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+!insertmacro GetSize</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+; The test slaves use this fallback key to run tests.</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+; And anyone that wants to run tests themselves should already have </span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+; this installed.</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+!define FallbackKey \</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+  &quot;SOFTWARE\Mozilla\MaintenanceService\3932ecacee736d366d6436db0f55bce4&quot;</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+!define CompanyName &quot;Mozilla Corporation&quot;</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+!define BrandFullNameInternal &quot;&quot;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+; The following includes are custom.</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+!include defines.nsi</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+; We keep defines.nsi defined so that we get other things like </span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+; the version number, but we redefine BrandFullName</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+!define MaintFullName &quot;Mozilla Maintenance Service&quot;</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+!undef BrandFullName</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+!define BrandFullName &quot;${MaintFullName}&quot;</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+!include common.nsh</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+!include locales.nsi</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+VIAddVersionKey &quot;FileDescription&quot; &quot;${MaintFullName} Installer&quot;</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+VIAddVersionKey &quot;OriginalFilename&quot; &quot;maintenanceservice_installer.exe&quot;</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+Name &quot;${MaintFullName}&quot;</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+OutFile &quot;maintenanceservice_installer.exe&quot;</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+; Get installation folder from registry if available</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+InstallDirRegKey HKLM &quot;Software\Mozilla\MaintenanceService&quot; &quot;&quot;</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+SetOverwrite on</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+!define MaintUninstallKey \</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+ &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MozillaMaintenanceService&quot;</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+; The HAVE_64BIT_OS define also means that we have an x64 build,</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+; not just an x64 OS.</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineplus">+!ifdef HAVE_64BIT_OS</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+  ; See below, we actually abort the install for x64 builds currently.</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+  InstallDir &quot;$PROGRAMFILES64\${MaintFullName}\&quot;</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+!else</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+  InstallDir &quot;$PROGRAMFILES32\${MaintFullName}\&quot;</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+!endif</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+ShowUnInstDetails nevershow</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+################################################################################</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+# Modern User Interface - MUI</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+!define MUI_ICON setup.ico</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+!define MUI_UNICON setup.ico</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+!define MUI_WELCOMEPAGE_TITLE_3LINES</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+!define MUI_UNWELCOMEFINISHPAGE_BITMAP wizWatermark.bmp</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+;Interface Settings</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+!define MUI_ABORTWARNING</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+; Uninstaller Pages</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+!insertmacro MUI_UNPAGE_CONFIRM</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineplus">+!insertmacro MUI_UNPAGE_INSTFILES</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineplus">+</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+################################################################################</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineplus">+# Language</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineplus">+</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineplus">+!insertmacro MOZ_MUI_LANGUAGE 'baseLocale'</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineplus">+!verbose push</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineplus">+!verbose 3</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineplus">+!include &quot;overrideLocale.nsh&quot;</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineplus">+!include &quot;customLocale.nsh&quot;</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineplus">+!verbose pop</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+; Set this after the locale files to override it if it is in the locale</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+; using &quot; &quot; for BrandingText will hide the &quot;Nullsoft Install System...&quot; branding</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineplus">+BrandingText &quot; &quot;</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineplus">+</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineplus">+Function .onInit</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineplus">+  SetSilent silent</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineplus">+!ifdef HAVE_64BIT_OS</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineplus">+  ; We plan to eventually enable 64bit native builds to use the maintenance</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineplus">+  ; service, but for the initial release, to reduce testing and development,</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineplus">+  ; 64-bit builds will not install the maintenanceservice.</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+  Abort</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+!endif</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineplus">+</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineplus">+  ; On Windows 2000 we do not install the maintenance service.</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineplus">+  ; We won't run this installer from the parent installer, but just in case </span>
<a href="#l14.123"></a><span id="l14.123" class="difflineplus">+  ; someone tries to execute it on Windows 2000...</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineplus">+  ${Unless} ${AtLeastWinXP}</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineplus">+    Abort</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineplus">+  ${EndUnless}</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineplus">+FunctionEnd</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineplus">+</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineplus">+Function un.onInit</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineplus">+  StrCpy $BrandFullNameDA &quot;${MaintFullName}&quot;</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineplus">+  StrCpy $BrandFullName &quot;${MaintFullName}&quot;</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineplus">+FunctionEnd</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineplus">+</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineplus">+Section &quot;MaintenanceService&quot;</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineplus">+  AllowSkipFiles off</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineplus">+</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineplus">+  CreateDirectory $INSTDIR</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineplus">+  SetOutPath $INSTDIR</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineplus">+</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineplus">+  ; If the service already exists, then it will be stopped when upgrading it</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineplus">+  ; via the maintenanceservice_tmp.exe command executed below.</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineplus">+  ; The maintenanceservice_tmp.exe command will rename the file to</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineplus">+  ; maintenanceservice.exe if maintenanceservice_tmp.exe is newer.</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineplus">+  ; If the service does not exist yet, we install it and drop the file on</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineplus">+  ; disk as maintenanceservice.exe directly.</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineplus">+  StrCpy $TempMaintServiceName &quot;maintenanceservice.exe&quot;</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineplus">+  IfFileExists &quot;$INSTDIR\maintenanceservice.exe&quot; 0 skipAlreadyExists</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineplus">+    StrCpy $TempMaintServiceName &quot;maintenanceservice_tmp.exe&quot;</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineplus">+  skipAlreadyExists:</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineplus">+</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineplus">+  ; We always write out a copy and then decide whether to install it or </span>
<a href="#l14.152"></a><span id="l14.152" class="difflineplus">+  ; not via calling its 'install' cmdline which works by version comparison.</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineplus">+  CopyFiles &quot;$EXEDIR\maintenanceservice.exe&quot; &quot;$INSTDIR\$TempMaintServiceName&quot;</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineplus">+</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineplus">+  ; The updater.ini file is only used when performing an install or upgrade,</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineplus">+  ; and only if that install or upgrade is successful.  If an old updater.ini</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineplus">+  ; happened to be copied into the maintenance service installation directory</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineplus">+  ; but the service was not newer, the updater.ini file would be unused.</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineplus">+  ; It is used to fill the description of the service on success.</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineplus">+  CopyFiles &quot;$EXEDIR\updater.ini&quot; &quot;$INSTDIR\updater.ini&quot;</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineplus">+</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineplus">+  ; Install the application maintenance service.</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineplus">+  ; If a service already exists, the command line parameter will stop the</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineplus">+  ; service and only install itself if it is newer than the already installed</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineplus">+  ; service.  If successful it will remove the old maintenanceservice.exe</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineplus">+  ; and replace it with maintenanceservice_tmp.exe.</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineplus">+  ClearErrors</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineplus">+  ${GetParameters} $0</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineplus">+  ${GetOptions} &quot;$0&quot; &quot;/Upgrade&quot; $0</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineplus">+    nsExec::Exec '&quot;$INSTDIR\$TempMaintServiceName&quot; install'</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineplus">+  ${Else}</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineplus">+    ; The upgrade cmdline is the same as install except</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineplus">+    ; It will fail if the service isn't already installed.</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineplus">+    nsExec::Exec '&quot;$INSTDIR\$TempMaintServiceName&quot; upgrade'</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineplus">+  ${EndIf}</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineplus">+</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineplus">+  WriteUninstaller &quot;$INSTDIR\Uninstall.exe&quot;</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineplus">+  WriteRegStr HKLM &quot;${MaintUninstallKey}&quot; &quot;DisplayName&quot; &quot;${MaintFullName}&quot;</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineplus">+  WriteRegStr HKLM &quot;${MaintUninstallKey}&quot; &quot;UninstallString&quot; \</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineplus">+                   '&quot;$INSTDIR\uninstall.exe&quot;'</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineplus">+  WriteRegStr HKLM &quot;${MaintUninstallKey}&quot; &quot;DisplayIcon&quot; \</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineplus">+                   &quot;$INSTDIR\Uninstall.exe,0&quot;</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineplus">+  WriteRegStr HKLM &quot;${MaintUninstallKey}&quot; &quot;DisplayVersion&quot; &quot;${AppVersion}&quot;</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineplus">+  WriteRegStr HKLM &quot;${MaintUninstallKey}&quot; &quot;Publisher&quot; &quot;Mozilla&quot;</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineplus">+  WriteRegStr HKLM &quot;${MaintUninstallKey}&quot; &quot;Comments&quot; \</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineplus">+                   &quot;${BrandFullName} ${AppVersion} (${ARCH} ${AB_CD})&quot;</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineplus">+  WriteRegDWORD HKLM &quot;${MaintUninstallKey}&quot; &quot;NoModify&quot; 1</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineplus">+  ${GetSize} &quot;$INSTDIR&quot; &quot;/S=0K&quot; $R2 $R3 $R4</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineplus">+  WriteRegDWORD HKLM &quot;${MaintUninstallKey}&quot; &quot;EstimatedSize&quot; $R2</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineplus">+</span>
<a href="#l14.192"></a><span id="l14.192" class="difflineplus">+  ; Write out that a maintenance service was attempted.</span>
<a href="#l14.193"></a><span id="l14.193" class="difflineplus">+  ; We do this because on upgrades we will check this value and we only</span>
<a href="#l14.194"></a><span id="l14.194" class="difflineplus">+  ; want to install once on the first upgrade to maintenance service.</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineplus">+  ; Also write out that we are currently installed, preferences will check</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineplus">+  ; this value to determine if we should show the service update pref.</span>
<a href="#l14.197"></a><span id="l14.197" class="difflineplus">+  ; Since the Maintenance service can be installed either x86 or x64,</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineplus">+  ; always use the 64-bit registry for checking if an attempt was made.</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineplus">+  ${If} ${RunningX64}</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineplus">+    SetRegView 64</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineplus">+  ${EndIf}</span>
<a href="#l14.202"></a><span id="l14.202" class="difflineplus">+  WriteRegDWORD HKLM &quot;Software\Mozilla\MaintenanceService&quot; &quot;Attempted&quot; 1</span>
<a href="#l14.203"></a><span id="l14.203" class="difflineplus">+  WriteRegDWORD HKLM &quot;Software\Mozilla\MaintenanceService&quot; &quot;Installed&quot; 1</span>
<a href="#l14.204"></a><span id="l14.204" class="difflineplus">+</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineplus">+  ; Included here for debug purposes only.  </span>
<a href="#l14.206"></a><span id="l14.206" class="difflineplus">+  ; These keys are used to bypass the installation dir is a valid installation</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineplus">+  ; check from the service so that tests can be run.</span>
<a href="#l14.208"></a><span id="l14.208" class="difflineplus">+  ; WriteRegStr HKLM &quot;${FallbackKey}\0&quot; &quot;name&quot; &quot;Mozilla Corporation&quot;</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineplus">+  ; WriteRegStr HKLM &quot;${FallbackKey}\0&quot; &quot;issuer&quot; &quot;Thawte Code Signing CA - G2&quot;</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineplus">+  ${If} ${RunningX64}</span>
<a href="#l14.211"></a><span id="l14.211" class="difflineplus">+    SetRegView lastused</span>
<a href="#l14.212"></a><span id="l14.212" class="difflineplus">+  ${EndIf}</span>
<a href="#l14.213"></a><span id="l14.213" class="difflineplus">+SectionEnd</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineplus">+</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineplus">+; By renaming before deleting we improve things slightly in case</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineplus">+; there is a file in use error. In this case a new install can happen.</span>
<a href="#l14.217"></a><span id="l14.217" class="difflineplus">+Function un.RenameDelete</span>
<a href="#l14.218"></a><span id="l14.218" class="difflineplus">+  Pop $9</span>
<a href="#l14.219"></a><span id="l14.219" class="difflineplus">+  ; If the .moz-delete file already exists previously, delete it</span>
<a href="#l14.220"></a><span id="l14.220" class="difflineplus">+  ; If it doesn't exist, the call is ignored.</span>
<a href="#l14.221"></a><span id="l14.221" class="difflineplus">+  ; We don't need to pass /REBOOTOK here since it was already marked that way</span>
<a href="#l14.222"></a><span id="l14.222" class="difflineplus">+  ; if it exists.</span>
<a href="#l14.223"></a><span id="l14.223" class="difflineplus">+  Delete &quot;$9.moz-delete&quot;</span>
<a href="#l14.224"></a><span id="l14.224" class="difflineplus">+  Rename &quot;$9&quot; &quot;$9.moz-delete&quot;</span>
<a href="#l14.225"></a><span id="l14.225" class="difflineplus">+  ${If} ${Errors}</span>
<a href="#l14.226"></a><span id="l14.226" class="difflineplus">+    Delete /REBOOTOK &quot;$9&quot;</span>
<a href="#l14.227"></a><span id="l14.227" class="difflineplus">+  ${Else} </span>
<a href="#l14.228"></a><span id="l14.228" class="difflineplus">+    Delete /REBOOTOK &quot;$9.moz-delete&quot;</span>
<a href="#l14.229"></a><span id="l14.229" class="difflineplus">+  ${EndIf}</span>
<a href="#l14.230"></a><span id="l14.230" class="difflineplus">+  ClearErrors</span>
<a href="#l14.231"></a><span id="l14.231" class="difflineplus">+FunctionEnd</span>
<a href="#l14.232"></a><span id="l14.232" class="difflineplus">+</span>
<a href="#l14.233"></a><span id="l14.233" class="difflineplus">+Section &quot;Uninstall&quot;</span>
<a href="#l14.234"></a><span id="l14.234" class="difflineplus">+  ; Delete the service so that no updates will be attempted</span>
<a href="#l14.235"></a><span id="l14.235" class="difflineplus">+  nsExec::Exec '&quot;$INSTDIR\maintenanceservice.exe&quot; uninstall'</span>
<a href="#l14.236"></a><span id="l14.236" class="difflineplus">+</span>
<a href="#l14.237"></a><span id="l14.237" class="difflineplus">+  Push &quot;$INSTDIR\updater.ini&quot;</span>
<a href="#l14.238"></a><span id="l14.238" class="difflineplus">+  Call un.RenameDelete</span>
<a href="#l14.239"></a><span id="l14.239" class="difflineplus">+  Push &quot;$INSTDIR\maintenanceservice.exe&quot;</span>
<a href="#l14.240"></a><span id="l14.240" class="difflineplus">+  Call un.RenameDelete</span>
<a href="#l14.241"></a><span id="l14.241" class="difflineplus">+  Push &quot;$INSTDIR\maintenanceservice_tmp.exe&quot;</span>
<a href="#l14.242"></a><span id="l14.242" class="difflineplus">+  Call un.RenameDelete</span>
<a href="#l14.243"></a><span id="l14.243" class="difflineplus">+  Push &quot;$INSTDIR\maintenanceservice.old&quot;</span>
<a href="#l14.244"></a><span id="l14.244" class="difflineplus">+  Call un.RenameDelete</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineplus">+  Push &quot;$INSTDIR\Uninstall.exe&quot;</span>
<a href="#l14.246"></a><span id="l14.246" class="difflineplus">+  Call un.RenameDelete</span>
<a href="#l14.247"></a><span id="l14.247" class="difflineplus">+  RMDir /REBOOTOK &quot;$INSTDIR&quot;</span>
<a href="#l14.248"></a><span id="l14.248" class="difflineplus">+</span>
<a href="#l14.249"></a><span id="l14.249" class="difflineplus">+  DeleteRegKey HKLM &quot;${MaintUninstallKey}&quot;</span>
<a href="#l14.250"></a><span id="l14.250" class="difflineplus">+</span>
<a href="#l14.251"></a><span id="l14.251" class="difflineplus">+  ${If} ${RunningX64}</span>
<a href="#l14.252"></a><span id="l14.252" class="difflineplus">+    SetRegView 64</span>
<a href="#l14.253"></a><span id="l14.253" class="difflineplus">+  ${EndIf}</span>
<a href="#l14.254"></a><span id="l14.254" class="difflineplus">+  DeleteRegValue HKLM &quot;Software\Mozilla\MaintenanceService&quot; &quot;Installed&quot;</span>
<a href="#l14.255"></a><span id="l14.255" class="difflineplus">+  DeleteRegKey HKLM &quot;${FallbackKey}\&quot;</span>
<a href="#l14.256"></a><span id="l14.256" class="difflineplus">+  ${If} ${RunningX64}</span>
<a href="#l14.257"></a><span id="l14.257" class="difflineplus">+    SetRegView lastused</span>
<a href="#l14.258"></a><span id="l14.258" class="difflineplus">+  ${EndIf}</span>
<a href="#l14.259"></a><span id="l14.259" class="difflineplus">+SectionEnd</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/installer/windows/nsis/shared.nsh</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/installer/windows/nsis/shared.nsh</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -78,16 +78,55 @@</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5">   ${SetAppKeys}</span>
<a href="#l15.6"></a><span id="l15.6">   ${SetUninstallKeys}</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">   ; Remove files that may be left behind by the application in the</span>
<a href="#l15.9"></a><span id="l15.9">   ; VirtualStore directory.</span>
<a href="#l15.10"></a><span id="l15.10">   ${CleanVirtualStore}</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+!ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  Call IsUserAdmin</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+  Pop $R0</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+  ${If} $R0 == &quot;true&quot;</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+  ; Only proceed if we have HKLM write access</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+  ${AndIf} $TmpVal == &quot;HKLM&quot;</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+  ; On Windows 2000 we do not install the maintenance service.</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+  ${AndIf} ${AtLeastWinXP}</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+    ; Add the registry keys for allowed certificates.</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+    ${AddMaintCertKeys}</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+    ; We check to see if the maintenance service install was already attempted.</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+    ; Since the Maintenance service can be installed either x86 or x64,</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+    ; always use the 64-bit registry for checking if an attempt was made.</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+    SetRegView 64</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+    ReadRegDWORD $5 HKLM &quot;Software\Mozilla\MaintenanceService&quot; &quot;Attempted&quot;</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineplus">+    ClearErrors</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+    SetRegView lastused</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+    ; If the maintenance service is already installed, do nothing.</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+    ; The maintenance service will launch:</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+    ; maintenanceservice_installer.exe /Upgrade to upgrade the maintenance</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+    ; service if necessary.   If the update was done from updater.exe without </span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+    ; the service (i.e. service is failing), updater.exe will do the update of </span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+    ; the service.  The reasons we do not do it here is because we don't want </span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+    ; to have to prompt for limited user accounts when the service isn't used </span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+    ; and we currently call the PostUpdate twice, once for the user and once</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+    ; for the SYSTEM account.  Also, this would stop the maintenance service</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+    ; and we need a return result back to the service when run that way.</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+    ${If} $5 == &quot;&quot;</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+      ; An install of maintenance service was never attempted.</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+      ; We call ExecShell (which is ShellExecute) with the verb &quot;runas&quot;</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+      ; to ask for elevation if the user isn't already elevated.  If the user </span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+      ; is already elevated it will just launch the program.</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+      ExecShell &quot;runas&quot; &quot;$INSTDIR\maintenanceservice_installer.exe&quot;</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+    ${EndIf}</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineplus">+  ${EndIf}</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+!endif</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineplus">+</span>
<a href="#l15.51"></a><span id="l15.51">   ; Remove talkback if it is present (remove after bug 386760 is fixed)</span>
<a href="#l15.52"></a><span id="l15.52">   ${If} ${FileExists} &quot;$INSTDIR\extensions\talkback@mozilla.org\&quot;</span>
<a href="#l15.53"></a><span id="l15.53">     RmDir /r &quot;$INSTDIR\extensions\talkback@mozilla.org\&quot;</span>
<a href="#l15.54"></a><span id="l15.54">   ${EndIf}</span>
<a href="#l15.55"></a><span id="l15.55"> !macroend</span>
<a href="#l15.56"></a><span id="l15.56"> !define PostUpdate &quot;!insertmacro PostUpdate&quot;</span>
<a href="#l15.57"></a><span id="l15.57"> </span>
<a href="#l15.58"></a><span id="l15.58"> !macro SetAsDefaultAppGlobal</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineat">@@ -395,48 +434,62 @@</span>
<a href="#l15.60"></a><span id="l15.60"> !macroend</span>
<a href="#l15.61"></a><span id="l15.61"> !define SetAppKeys &quot;!insertmacro SetAppKeys&quot;</span>
<a href="#l15.62"></a><span id="l15.62"> </span>
<a href="#l15.63"></a><span id="l15.63"> ; Add uninstall registry entries. This macro tests for write access to determine</span>
<a href="#l15.64"></a><span id="l15.64"> ; if the uninstall keys should be added to HKLM or HKCU.</span>
<a href="#l15.65"></a><span id="l15.65"> !macro SetUninstallKeys</span>
<a href="#l15.66"></a><span id="l15.66">   StrCpy $0 &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${BrandFullNameInternal} ${AppVersion} (${ARCH} ${AB_CD})&quot;</span>
<a href="#l15.67"></a><span id="l15.67"> </span>
<a href="#l15.68"></a><span id="l15.68" class="difflineplus">+  StrCpy $2 &quot;&quot;</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+  ClearErrors</span>
<a href="#l15.70"></a><span id="l15.70">   WriteRegStr HKLM &quot;$0&quot; &quot;${BrandShortName}InstallerTest&quot; &quot;Write Test&quot;</span>
<a href="#l15.71"></a><span id="l15.71">   ${If} ${Errors}</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-    StrCpy $1 &quot;HKCU&quot;</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-    SetShellVarContext current  ; Set SHCTX to the current user (e.g. HKCU)</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+    ; If the uninstall keys already exist in HKLM don't create them in HKCU</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineplus">+    ClearErrors</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineplus">+    ReadRegStr $2 &quot;HKLM&quot; $0 &quot;DisplayName&quot;</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineplus">+    ${If} $2 == &quot;&quot;</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+      ; Otherwise we don't have any keys for this product in HKLM so proceeed</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+      ; to create them in HKCU.  Better handling for this will be done in:</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+      ; Bug 711044 - Better handling for 2 uninstall icons</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+      StrCpy $1 &quot;HKCU&quot;</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+      SetShellVarContext current  ; Set SHCTX to the current user (e.g. HKCU)</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+    ${EndIf}</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+    ClearErrors</span>
<a href="#l15.85"></a><span id="l15.85">   ${Else}</span>
<a href="#l15.86"></a><span id="l15.86">     StrCpy $1 &quot;HKLM&quot;</span>
<a href="#l15.87"></a><span id="l15.87">     SetShellVarContext all     ; Set SHCTX to all users (e.g. HKLM)</span>
<a href="#l15.88"></a><span id="l15.88">     DeleteRegValue HKLM &quot;$0&quot; &quot;${BrandShortName}InstallerTest&quot;</span>
<a href="#l15.89"></a><span id="l15.89">   ${EndIf}</span>
<a href="#l15.90"></a><span id="l15.90"> </span>
<a href="#l15.91"></a><span id="l15.91" class="difflineminus">-  ${GetLongPath} &quot;$INSTDIR&quot; $8</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+  ${If} $2 == &quot;&quot;</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineplus">+    ${GetLongPath} &quot;$INSTDIR&quot; $8</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineplus">+</span>
<a href="#l15.95"></a><span id="l15.95"> </span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-  ; Write the uninstall registry keys</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-  ${WriteRegStr2} $1 &quot;$0&quot; &quot;Comments&quot; &quot;${BrandFullNameInternal} ${AppVersion} (${ARCH} ${AB_CD})&quot; 0</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineminus">-  ${WriteRegStr2} $1 &quot;$0&quot; &quot;DisplayIcon&quot; &quot;$8\${FileMainEXE},0&quot; 0</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-  ${WriteRegStr2} $1 &quot;$0&quot; &quot;DisplayName&quot; &quot;${BrandFullNameInternal} ${AppVersion} (${ARCH} ${AB_CD})&quot; 0</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-  ${WriteRegStr2} $1 &quot;$0&quot; &quot;DisplayVersion&quot; &quot;${AppVersion}&quot; 0</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-  ${WriteRegStr2} $1 &quot;$0&quot; &quot;InstallLocation&quot; &quot;$8&quot; 0</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-  ${WriteRegStr2} $1 &quot;$0&quot; &quot;Publisher&quot; &quot;Mozilla&quot; 0</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-  ${WriteRegStr2} $1 &quot;$0&quot; &quot;UninstallString&quot; &quot;$8\uninstall\helper.exe&quot; 0</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-  ${WriteRegStr2} $1 &quot;$0&quot; &quot;URLInfoAbout&quot; &quot;${URLInfoAbout}&quot; 0</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineminus">-  ${WriteRegStr2} $1 &quot;$0&quot; &quot;URLUpdateInfo&quot; &quot;${URLUpdateInfo}&quot; 0</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineminus">-  ${WriteRegDWORD2} $1 &quot;$0&quot; &quot;NoModify&quot; 1 0</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-  ${WriteRegDWORD2} $1 &quot;$0&quot; &quot;NoRepair&quot; 1 0</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineplus">+    ; Write the uninstall registry keys</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineplus">+    ${WriteRegStr2} $1 &quot;$0&quot; &quot;Comments&quot; &quot;${BrandFullNameInternal} ${AppVersion} (${ARCH} ${AB_CD})&quot; 0</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineplus">+    ${WriteRegStr2} $1 &quot;$0&quot; &quot;DisplayIcon&quot; &quot;$8\${FileMainEXE},0&quot; 0</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineplus">+    ${WriteRegStr2} $1 &quot;$0&quot; &quot;DisplayName&quot; &quot;${BrandFullNameInternal} ${AppVersion} (${ARCH} ${AB_CD})&quot; 0</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineplus">+    ${WriteRegStr2} $1 &quot;$0&quot; &quot;DisplayVersion&quot; &quot;${AppVersion}&quot; 0</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineplus">+    ${WriteRegStr2} $1 &quot;$0&quot; &quot;InstallLocation&quot; &quot;$8&quot; 0</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineplus">+    ${WriteRegStr2} $1 &quot;$0&quot; &quot;Publisher&quot; &quot;Mozilla&quot; 0</span>
<a href="#l15.115"></a><span id="l15.115" class="difflineplus">+    ${WriteRegStr2} $1 &quot;$0&quot; &quot;UninstallString&quot; &quot;$8\uninstall\helper.exe&quot; 0</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineplus">+    ${WriteRegStr2} $1 &quot;$0&quot; &quot;URLInfoAbout&quot; &quot;${URLInfoAbout}&quot; 0</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineplus">+    ${WriteRegStr2} $1 &quot;$0&quot; &quot;URLUpdateInfo&quot; &quot;${URLUpdateInfo}&quot; 0</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineplus">+    ${WriteRegDWORD2} $1 &quot;$0&quot; &quot;NoModify&quot; 1 0</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineplus">+    ${WriteRegDWORD2} $1 &quot;$0&quot; &quot;NoRepair&quot; 1 0</span>
<a href="#l15.120"></a><span id="l15.120"> </span>
<a href="#l15.121"></a><span id="l15.121" class="difflineminus">-  ${GetSize} &quot;$8&quot; &quot;/S=0K&quot; $R2 $R3 $R4</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineminus">-  ${WriteRegDWORD2} $1 &quot;$0&quot; &quot;EstimatedSize&quot; $R2 0</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+    ${GetSize} &quot;$8&quot; &quot;/S=0K&quot; $R2 $R3 $R4</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+    ${WriteRegDWORD2} $1 &quot;$0&quot; &quot;EstimatedSize&quot; $R2 0</span>
<a href="#l15.125"></a><span id="l15.125"> </span>
<a href="#l15.126"></a><span id="l15.126" class="difflineminus">-  ${If} &quot;$TmpVal&quot; == &quot;HKLM&quot;</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineminus">-    SetShellVarContext all     ; Set SHCTX to all users (e.g. HKLM)</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineminus">-  ${Else}</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineminus">-    SetShellVarContext current  ; Set SHCTX to the current user (e.g. HKCU)</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineplus">+    ${If} &quot;$TmpVal&quot; == &quot;HKLM&quot;</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineplus">+      SetShellVarContext all     ; Set SHCTX to all users (e.g. HKLM)</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineplus">+    ${Else}</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineplus">+      SetShellVarContext current  ; Set SHCTX to the current user (e.g. HKCU)</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineplus">+    ${EndIf}</span>
<a href="#l15.135"></a><span id="l15.135">   ${EndIf}</span>
<a href="#l15.136"></a><span id="l15.136"> !macroend</span>
<a href="#l15.137"></a><span id="l15.137"> !define SetUninstallKeys &quot;!insertmacro SetUninstallKeys&quot;</span>
<a href="#l15.138"></a><span id="l15.138"> </span>
<a href="#l15.139"></a><span id="l15.139"> ; Updates protocol handlers if their registry open command value is for this</span>
<a href="#l15.140"></a><span id="l15.140"> ; install location (uses SHCTX)</span>
<a href="#l15.141"></a><span id="l15.141"> !macro UpdateProtocolHandlers</span>
<a href="#l15.142"></a><span id="l15.142">   ; Store the command to open the app with an url in a register for easy access.</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineat">@@ -483,16 +536,45 @@</span>
<a href="#l15.144"></a><span id="l15.144"> </span>
<a href="#l15.145"></a><span id="l15.145">   ${IsHandlerForInstallDir} &quot;nntp&quot; $R9</span>
<a href="#l15.146"></a><span id="l15.146">   ${If} &quot;$R9&quot; == &quot;true&quot;</span>
<a href="#l15.147"></a><span id="l15.147">     ${AddHandlerValues} &quot;SOFTWARE\Classes\nntp&quot; &quot;$2&quot; &quot;$8,0&quot; &quot;&quot; &quot;&quot; &quot;&quot;</span>
<a href="#l15.148"></a><span id="l15.148">   ${EndIf}</span>
<a href="#l15.149"></a><span id="l15.149"> !macroend</span>
<a href="#l15.150"></a><span id="l15.150"> !define UpdateProtocolHandlers &quot;!insertmacro UpdateProtocolHandlers&quot;</span>
<a href="#l15.151"></a><span id="l15.151"> </span>
<a href="#l15.152"></a><span id="l15.152" class="difflineplus">+!ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l15.153"></a><span id="l15.153" class="difflineplus">+; Adds maintenance service certificate keys for the install dir.</span>
<a href="#l15.154"></a><span id="l15.154" class="difflineplus">+; For the cert to work, it must also be signed by a trusted cert for the user.</span>
<a href="#l15.155"></a><span id="l15.155" class="difflineplus">+!macro AddMaintCertKeys</span>
<a href="#l15.156"></a><span id="l15.156" class="difflineplus">+  Push $R0</span>
<a href="#l15.157"></a><span id="l15.157" class="difflineplus">+  ; Allow main Mozilla cert information for updates</span>
<a href="#l15.158"></a><span id="l15.158" class="difflineplus">+  ; This call will push the needed key on the stack</span>
<a href="#l15.159"></a><span id="l15.159" class="difflineplus">+  ServicesHelper::PathToUniqueRegistryPath &quot;$INSTDIR&quot;</span>
<a href="#l15.160"></a><span id="l15.160" class="difflineplus">+  Pop $R0</span>
<a href="#l15.161"></a><span id="l15.161" class="difflineplus">+  ${If} $R0 != &quot;&quot;</span>
<a href="#l15.162"></a><span id="l15.162" class="difflineplus">+    ; More than one certificate can be specified in a different subfolder</span>
<a href="#l15.163"></a><span id="l15.163" class="difflineplus">+    ; for example: $R0\1, but each individual binary can be signed</span>
<a href="#l15.164"></a><span id="l15.164" class="difflineplus">+    ; with at most one certificate.  A fallback certificate can only be used</span>
<a href="#l15.165"></a><span id="l15.165" class="difflineplus">+    ; if the binary is replaced with a different certificate.</span>
<a href="#l15.166"></a><span id="l15.166" class="difflineplus">+    ; We always use the 64bit registry for certs.</span>
<a href="#l15.167"></a><span id="l15.167" class="difflineplus">+    ; This call is ignored on 32-bit systems.</span>
<a href="#l15.168"></a><span id="l15.168" class="difflineplus">+    SetRegView 64</span>
<a href="#l15.169"></a><span id="l15.169" class="difflineplus">+    DeleteRegKey HKLM &quot;$R0&quot;</span>
<a href="#l15.170"></a><span id="l15.170" class="difflineplus">+    WriteRegStr HKLM &quot;$R0\0&quot; &quot;name&quot; &quot;${CERTIFICATE_NAME}&quot;</span>
<a href="#l15.171"></a><span id="l15.171" class="difflineplus">+    WriteRegStr HKLM &quot;$R0\0&quot; &quot;issuer&quot; &quot;${CERTIFICATE_ISSUER}&quot;</span>
<a href="#l15.172"></a><span id="l15.172" class="difflineplus">+    SetRegView lastused</span>
<a href="#l15.173"></a><span id="l15.173" class="difflineplus">+    ClearErrors</span>
<a href="#l15.174"></a><span id="l15.174" class="difflineplus">+  ${EndIf} </span>
<a href="#l15.175"></a><span id="l15.175" class="difflineplus">+  ; Restore the previously used value back</span>
<a href="#l15.176"></a><span id="l15.176" class="difflineplus">+  Pop $R0</span>
<a href="#l15.177"></a><span id="l15.177" class="difflineplus">+!macroend</span>
<a href="#l15.178"></a><span id="l15.178" class="difflineplus">+!define AddMaintCertKeys &quot;!insertmacro AddMaintCertKeys&quot;</span>
<a href="#l15.179"></a><span id="l15.179" class="difflineplus">+!endif</span>
<a href="#l15.180"></a><span id="l15.180" class="difflineplus">+</span>
<a href="#l15.181"></a><span id="l15.181"> ; Removes various registry entries for reasons noted below (does not use SHCTX).</span>
<a href="#l15.182"></a><span id="l15.182"> !macro RemoveDeprecatedKeys</span>
<a href="#l15.183"></a><span id="l15.183">   StrCpy $0 &quot;SOFTWARE\Classes&quot;</span>
<a href="#l15.184"></a><span id="l15.184"> </span>
<a href="#l15.185"></a><span id="l15.185">   ; remove DI and SOC from the .eml class if it exists and contains</span>
<a href="#l15.186"></a><span id="l15.186">   ; thunderbird.exe</span>
<a href="#l15.187"></a><span id="l15.187">   ClearErrors</span>
<a href="#l15.188"></a><span id="l15.188">   ReadRegStr $1 HKLM &quot;$0\.eml\shell\open\command&quot; &quot;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/installer/windows/nsis/uninstaller.nsi</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/installer/windows/nsis/uninstaller.nsi</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -24,16 +24,17 @@ RequestExecutionLevel user</span>
<a href="#l16.4"></a><span id="l16.4"> ; On Vista and above attempt to elevate Standard Users in addition to users that</span>
<a href="#l16.5"></a><span id="l16.5"> ; are a member of the Administrators group.</span>
<a href="#l16.6"></a><span id="l16.6"> !define NONADMIN_ELEVATE</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> ; prevents compiling of the reg write logging.</span>
<a href="#l16.9"></a><span id="l16.9"> !define NO_LOG</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11"> Var TmpVal</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+Var MaintCertKey</span>
<a href="#l16.13"></a><span id="l16.13"> </span>
<a href="#l16.14"></a><span id="l16.14"> ; Other included files may depend upon these includes!</span>
<a href="#l16.15"></a><span id="l16.15"> ; The following includes are provided by NSIS.</span>
<a href="#l16.16"></a><span id="l16.16"> !include FileFunc.nsh</span>
<a href="#l16.17"></a><span id="l16.17"> !include LogicLib.nsh</span>
<a href="#l16.18"></a><span id="l16.18"> !include MUI.nsh</span>
<a href="#l16.19"></a><span id="l16.19"> !include WinMessages.nsh</span>
<a href="#l16.20"></a><span id="l16.20"> !include WinVer.nsh</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineat">@@ -63,16 +64,17 @@ VIAddVersionKey &quot;OriginalFilename&quot; &quot;help</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23"> !insertmacro AddHandlerValues</span>
<a href="#l16.24"></a><span id="l16.24"> !insertmacro CleanVirtualStore</span>
<a href="#l16.25"></a><span id="l16.25"> !insertmacro ElevateUAC</span>
<a href="#l16.26"></a><span id="l16.26"> !insertmacro GetLongPath</span>
<a href="#l16.27"></a><span id="l16.27"> !insertmacro GetPathFromString</span>
<a href="#l16.28"></a><span id="l16.28"> !insertmacro InitHashAppModelId</span>
<a href="#l16.29"></a><span id="l16.29"> !insertmacro IsHandlerForInstallDir</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+!insertmacro IsUserAdmin</span>
<a href="#l16.31"></a><span id="l16.31"> !insertmacro LogDesktopShortcut</span>
<a href="#l16.32"></a><span id="l16.32"> !insertmacro LogQuickLaunchShortcut</span>
<a href="#l16.33"></a><span id="l16.33"> !insertmacro LogStartMenuShortcut</span>
<a href="#l16.34"></a><span id="l16.34"> !insertmacro RegCleanMain</span>
<a href="#l16.35"></a><span id="l16.35"> !insertmacro RegCleanUninstall</span>
<a href="#l16.36"></a><span id="l16.36"> !insertmacro SetBrandNameVars</span>
<a href="#l16.37"></a><span id="l16.37"> !insertmacro UnloadUAC</span>
<a href="#l16.38"></a><span id="l16.38"> !insertmacro UpdateShortcutAppModelIDs</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineat">@@ -337,16 +339,31 @@ Section &quot;Uninstall&quot;</span>
<a href="#l16.40"></a><span id="l16.40">       FileClose $0</span>
<a href="#l16.41"></a><span id="l16.41">     ${EndUnless}</span>
<a href="#l16.42"></a><span id="l16.42">   ${EndIf}</span>
<a href="#l16.43"></a><span id="l16.43"> </span>
<a href="#l16.44"></a><span id="l16.44">   ; Refresh desktop icons otherwise the start menu internet item won't be</span>
<a href="#l16.45"></a><span id="l16.45">   ; removed and other ugly things will happen like recreation of the app's</span>
<a href="#l16.46"></a><span id="l16.46">   ; clients registry key by the OS under some conditions.</span>
<a href="#l16.47"></a><span id="l16.47">   System::Call &quot;shell32::SHChangeNotify(i, i, i, i) v (0x08000000, 0, 0, 0)&quot;</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineplus">+!ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+  ; Get the path the allowed cert is at and remove it</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+  ; Keep this block of code last since it modfies the reg view</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+  ServicesHelper::PathToUniqueRegistryPath &quot;$INSTDIR&quot;</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+  Pop $MaintCertKey</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+  ${If} $MaintCertKey != &quot;&quot;</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+    ; We always use the 64bit registry for certs</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+    ; This call is ignored on 32-bit systems.</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+    SetRegView 64</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+    DeleteRegKey HKLM &quot;$MaintCertKey\&quot;</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+    SetRegView lastused</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineplus">+  ${EndIf}</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineplus">+!endif</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+</span>
<a href="#l16.63"></a><span id="l16.63"> SectionEnd</span>
<a href="#l16.64"></a><span id="l16.64"> </span>
<a href="#l16.65"></a><span id="l16.65"> ################################################################################</span>
<a href="#l16.66"></a><span id="l16.66"> # Helper Functions</span>
<a href="#l16.67"></a><span id="l16.67"> </span>
<a href="#l16.68"></a><span id="l16.68"> ; Don't setup the survey controls, functions, etc. when the application has</span>
<a href="#l16.69"></a><span id="l16.69"> ; defined NO_UNINSTALL_SURVEY</span>
<a href="#l16.70"></a><span id="l16.70"> !ifndef NO_UNINSTALL_SURVEY</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -66,16 +66,19 @@</span>
<a href="#l17.4"></a><span id="l17.4"> &lt;!ENTITY modeAskMe.accesskey            &quot;m&quot;&gt;</span>
<a href="#l17.5"></a><span id="l17.5"> &lt;!ENTITY modeAutomatic.label            &quot;Automatically download and install the update&quot;&gt;</span>
<a href="#l17.6"></a><span id="l17.6"> &lt;!ENTITY modeAutomatic.accesskey        &quot;d&quot;&gt;</span>
<a href="#l17.7"></a><span id="l17.7"> &lt;!ENTITY modeAutoAddonWarn.label        &quot;Warn me if this will disable any of my add-ons&quot;&gt;</span>
<a href="#l17.8"></a><span id="l17.8"> &lt;!ENTITY modeAutoAddonWarn.accesskey    &quot;W&quot;&gt;</span>
<a href="#l17.9"></a><span id="l17.9"> &lt;!ENTITY showUpdates.label              &quot;Show Update History&quot;&gt;</span>
<a href="#l17.10"></a><span id="l17.10"> &lt;!ENTITY showUpdates.accesskey          &quot;S&quot;&gt;</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+&lt;!ENTITY useService.label                &quot;Use a background service to install updates&quot;&gt;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+&lt;!ENTITY useService.accesskey            &quot;b&quot;&gt;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+</span>
<a href="#l17.15"></a><span id="l17.15"> &lt;!-- Networking and Disk Space --&gt;</span>
<a href="#l17.16"></a><span id="l17.16"> &lt;!ENTITY showSettings.label            &quot;Settings&quot;&gt;</span>
<a href="#l17.17"></a><span id="l17.17"> &lt;!ENTITY showSettings.accesskey        &quot;S&quot;&gt;</span>
<a href="#l17.18"></a><span id="l17.18"> &lt;!ENTITY proxiesConfigure.label        &quot;Configure how &amp;brandShortName; connects to the Internet&quot;&gt;</span>
<a href="#l17.19"></a><span id="l17.19"> &lt;!ENTITY connectionsInfo.caption       &quot;Connection&quot;&gt;</span>
<a href="#l17.20"></a><span id="l17.20"> &lt;!ENTITY offlineInfo.caption           &quot;Offline&quot;&gt;</span>
<a href="#l17.21"></a><span id="l17.21"> &lt;!ENTITY offlineInfo.label             &quot;Configure offline settings&quot;&gt;</span>
<a href="#l17.22"></a><span id="l17.22"> &lt;!ENTITY showOffline.label             &quot;Offline&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/locales/en-US/installer/custom.properties</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/locales/en-US/installer/custom.properties</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -21,16 +21,20 @@</span>
<a href="#l18.4"></a><span id="l18.4"> REG_APP_DESC=$BrandShortName is a full-featured email application. $BrandShortName supports IMAP and POP mail protocols, as well as HTML mail formatting. Built-in junk mail controls, RSS capabilities, powerful quick search, spell check as you type, global inbox, and advanced message filtering round out $BrandShortName's modern feature set.</span>
<a href="#l18.5"></a><span id="l18.5"> CONTEXT_OPTIONS=$BrandShortName &amp;Options</span>
<a href="#l18.6"></a><span id="l18.6"> CONTEXT_SAFE_MODE=$BrandShortName &amp;Safe Mode</span>
<a href="#l18.7"></a><span id="l18.7"> OPTIONS_PAGE_TITLE=Setup Type</span>
<a href="#l18.8"></a><span id="l18.8"> OPTIONS_PAGE_SUBTITLE=Choose setup options</span>
<a href="#l18.9"></a><span id="l18.9"> OPTIONS_MAKE_DEFAULT=&amp;Use $BrandShortName as my default mail application</span>
<a href="#l18.10"></a><span id="l18.10"> SHORTCUTS_PAGE_TITLE=Set Up Shortcuts</span>
<a href="#l18.11"></a><span id="l18.11"> SHORTCUTS_PAGE_SUBTITLE=Create Program Icons</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+COMPONENTS_PAGE_TITLE=Set Up Optional Components</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+COMPONENTS_PAGE_SUBTITLE=Optional Recommended Components</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+OPTIONAL_COMPONENTS_DESC=The Maintenance Service will allow you to update $BrandShortName silently in the background.</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+MAINTENANCE_SERVICE_CHECKBOX_DESC=Install &amp;Maintenance Service</span>
<a href="#l18.16"></a><span id="l18.16"> SUMMARY_PAGE_TITLE=Summary</span>
<a href="#l18.17"></a><span id="l18.17"> SUMMARY_PAGE_SUBTITLE=Ready to start installing $BrandShortName</span>
<a href="#l18.18"></a><span id="l18.18"> SUMMARY_INSTALLED_TO=$BrandShortName will be installed to the following location:</span>
<a href="#l18.19"></a><span id="l18.19"> SUMMARY_REBOOT_REQUIRED_INSTALL=A restart of your computer may be required to complete the installation.</span>
<a href="#l18.20"></a><span id="l18.20"> SUMMARY_REBOOT_REQUIRED_UNINSTALL=A restart of your computer may be required to complete the uninstall.</span>
<a href="#l18.21"></a><span id="l18.21"> SUMMARY_MAKE_DEFAULT=$BrandShortName will be set as your default mail application.</span>
<a href="#l18.22"></a><span id="l18.22"> SUMMARY_CLICK=Click Install to continue.</span>
<a href="#l18.23"></a><span id="l18.23"> SURVEY_TEXT=&amp;Tell us what you thought of $BrandShortName</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

