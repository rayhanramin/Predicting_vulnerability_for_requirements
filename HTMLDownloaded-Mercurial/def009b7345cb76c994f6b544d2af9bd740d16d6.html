<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 530:def009b7345cb76c994f6b544d2af9bd740d16d6</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ def009b7345cb76c994f6b544d2af9bd740d16d6" />
<meta property="og:url" content="/comm-central/rev/def009b7345cb76c994f6b544d2af9bd740d16d6" />
<meta property="og:description" content="Bug 400931: Enable predefined  IMAP settings for Gmail. r+sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / def009b7345cb76c994f6b544d2af9bd740d16d6 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/def009b7345cb76c994f6b544d2af9bd740d16d6">shortlog</a> |
<a href="/comm-central/log/def009b7345cb76c994f6b544d2af9bd740d16d6">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/def009b7345cb76c994f6b544d2af9bd740d16d6">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/def009b7345cb76c994f6b544d2af9bd740d16d6">files</a> |
changeset |
<a href="/comm-central/raw-rev/def009b7345cb76c994f6b544d2af9bd740d16d6">raw</a>  | <a href="/comm-central/archive/def009b7345cb76c994f6b544d2af9bd740d16d6.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=400931">Bug 400931</a>: Enable predefined  IMAP settings for Gmail. r+sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#103;&#110;&#117;&#115;&#32;&#77;&#101;&#108;&#105;&#110;&#32;&#60;&#109;&#107;&#109;&#101;&#108;&#105;&#110;&#64;&#105;&#107;&#105;&#46;&#102;&#105;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 06 Oct 2008 20:06:39 +0300</td></tr>

<tr>
 <td>changeset 530</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/def009b7345cb76c994f6b544d2af9bd740d16d6">def009b7345cb76c994f6b544d2af9bd740d16d6</a></td>
</tr>



<tr>
<td>parent 529</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/70420d2ee44cbf67502237a2adf13757f767b497">70420d2ee44cbf67502237a2adf13757f767b497</a>
</td>
</tr>

<tr>
<td>child 531</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f2fa0b9fa8669417a5bed3025fb043b77fcb66b3">f2fa0b9fa8669417a5bed3025fb043b77fcb66b3</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=def009b7345cb76c994f6b544d2af9bd740d16d6">467</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Mon, 06 Oct 2008 17:07:21 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@def009b7345c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=def009b7345cb76c994f6b544d2af9bd740d16d6">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=def009b7345cb76c994f6b544d2af9bd740d16d6&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=def009b7345cb76c994f6b544d2af9bd740d16d6&newProject=comm-central&newRevision=def009b7345cb76c994f6b544d2af9bd740d16d6&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=def009b7345cb76c994f6b544d2af9bd740d16d6&newProject=comm-central&newRevision=def009b7345cb76c994f6b544d2af9bd740d16d6&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=def009b7345cb76c994f6b544d2af9bd740d16d6&newProject=comm-central&newRevision=def009b7345cb76c994f6b544d2af9bd740d16d6&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=400931">400931</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=400931">Bug 400931</a>: Enable predefined  IMAP settings for Gmail. r+sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/gmail.rdf">mailnews/base/ispdata/gmail.rdf</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/gmail.rdf">file</a> |
<a href="/comm-central/annotate/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/gmail.rdf">annotate</a> |
<a href="/comm-central/diff/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/gmail.rdf">diff</a> |
<a href="/comm-central/comparison/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/gmail.rdf">comparison</a> |
<a href="/comm-central/log/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/gmail.rdf">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/googlemail.rdf">mailnews/base/ispdata/googlemail.rdf</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/googlemail.rdf">file</a> |
<a href="/comm-central/annotate/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/googlemail.rdf">annotate</a> |
<a href="/comm-central/diff/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/googlemail.rdf">diff</a> |
<a href="/comm-central/comparison/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/googlemail.rdf">comparison</a> |
<a href="/comm-central/log/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/ispdata/googlemail.rdf">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/AccountWizard.js">mailnews/base/prefs/resources/content/AccountWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/AccountWizard.js">file</a> |
<a href="/comm-central/annotate/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/AccountWizard.js">annotate</a> |
<a href="/comm-central/diff/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/AccountWizard.js">diff</a> |
<a href="/comm-central/comparison/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/AccountWizard.js">comparison</a> |
<a href="/comm-central/log/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/AccountWizard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/ispUtils.js">mailnews/base/prefs/resources/content/ispUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/ispUtils.js">file</a> |
<a href="/comm-central/annotate/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/ispUtils.js">annotate</a> |
<a href="/comm-central/diff/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/ispUtils.js">diff</a> |
<a href="/comm-central/comparison/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/ispUtils.js">comparison</a> |
<a href="/comm-central/log/def009b7345cb76c994f6b544d2af9bd740d16d6/mailnews/base/prefs/resources/content/ispUtils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/ispdata/gmail.rdf</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/ispdata/gmail.rdf</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,17 +1,78 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> &lt;!DOCTYPE RDF&gt;</span>
<a href="#l1.6"></a><span id="l1.6"> &lt;RDF:RDF</span>
<a href="#l1.7"></a><span id="l1.7">     xmlns:NC=&quot;http://home.netscape.com/NC-rdf#&quot;</span>
<a href="#l1.8"></a><span id="l1.8">     xmlns:RDF=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">   &lt;RDF:Description about=&quot;NC:ispinfo&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11">     &lt;NC:providers&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      &lt;NC:nsIMsgAccount about=&quot;domain:gmail.com&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      &lt;!-- Gmail IMAP access --&gt;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      &lt;NC:nsIMsgAccount about=&quot;domain:gmail.com?type=imap&quot;&gt;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+        &lt;!-- IMAP server info --&gt;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+        &lt;NC:incomingServer&gt;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+          &lt;NC:nsIMsgIncomingServer&gt;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+            &lt;NC:prettyName&gt;Gmail&lt;/NC:prettyName&gt;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+            &lt;NC:hostName&gt;imap.gmail.com&lt;/NC:hostName&gt;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+            &lt;NC:type&gt;imap&lt;/NC:type&gt;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+            &lt;NC:ServerType-imap&gt;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+              &lt;NC:nsIImapIncomingServer&gt;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+                &lt;NC:usingSubscription&gt;false&lt;/NC:usingSubscription&gt;</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+                &lt;!-- IMAP delete model: &quot;remove it immediately&quot;. --&gt;</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+                &lt;NC:deleteModel&gt;2&lt;/NC:deleteModel&gt;</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+                &lt;NC:trashFolderName&gt;[Gmail]/Trash&lt;/NC:trashFolderName&gt;</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+              &lt;/NC:nsIImapIncomingServer&gt;</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+            &lt;/NC:ServerType-imap&gt;</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+            &lt;NC:loginAtStartUp&gt;true&lt;/NC:loginAtStartUp&gt;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+            &lt;NC:rememberPassword&gt;true&lt;/NC:rememberPassword&gt;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+            &lt;NC:port&gt;993&lt;/NC:port&gt;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+            &lt;NC:socketType&gt;3&lt;/NC:socketType&gt;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+          &lt;/NC:nsIMsgIncomingServer&gt;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+        &lt;/NC:incomingServer&gt;</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+        &lt;!-- SMTP server info --&gt;</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+        &lt;NC:smtp&gt;</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+          &lt;NC:nsISmtpServer&gt;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+            &lt;NC:hostname&gt;smtp.gmail.com&lt;/NC:hostname&gt;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+            &lt;NC:port&gt;587&lt;/NC:port&gt;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+            &lt;NC:trySSL&gt;2&lt;/NC:trySSL&gt;</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+            &lt;NC:description&gt;Gmail SMTP&lt;/NC:description&gt;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+          &lt;/NC:nsISmtpServer&gt;</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+        &lt;/NC:smtp&gt;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+        &lt;NC:smtpRequiresUsername&gt;true&lt;/NC:smtpRequiresUsername&gt;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+        &lt;NC:smtpCreateNewServer&gt;true&lt;/NC:smtpCreateNewServer&gt;</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+        &lt;NC:smtpUsePreferredServer&gt;true&lt;/NC:smtpUsePreferredServer&gt;</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+        &lt;!-- identity defaults --&gt;</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+        &lt;NC:identity&gt;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+          &lt;NC:nsIMsgIdentity&gt;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+            &lt;!-- Don't store sent mail in a Sent folder, as Gmail will show it</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+                 in [Gmail]/Sent Mail anyway. --&gt;</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+            &lt;NC:doFcc&gt;false&lt;/NC:doFcc&gt;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+            &lt;NC:FccFolder&gt;[Gmail]/Sent Mail&lt;/NC:FccFolder&gt;</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+            &lt;NC:DraftFolder&gt;[Gmail]/Drafts&lt;/NC:DraftFolder&gt;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+          &lt;/NC:nsIMsgIdentity&gt;</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+        &lt;/NC:identity&gt;</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+        &lt;!-- other options --&gt;</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+        &lt;NC:wizardSkipPanels&gt;true&lt;/NC:wizardSkipPanels&gt;</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+        &lt;NC:wizardShortName&gt;Gmail&lt;/NC:wizardShortName&gt;</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+        &lt;NC:wizardLongName&gt;Gmail IMAP&lt;/NC:wizardLongName&gt;</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+        &lt;NC:wizardLongNameAccesskey&gt;M&lt;/NC:wizardLongNameAccesskey&gt;</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+        &lt;NC:wizardShow&gt;true&lt;/NC:wizardShow&gt;</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+        &lt;NC:wizardPromote&gt;true&lt;/NC:wizardPromote&gt;</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+        &lt;NC:emailProviderName&gt;Gmail&lt;/NC:emailProviderName&gt;</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+        &lt;NC:sampleEmail&gt;example@gmail.com&lt;/NC:sampleEmail&gt;</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+        &lt;NC:sampleUserName&gt;example&lt;/NC:sampleUserName&gt;</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+        &lt;NC:emailIDDescription&gt;Gmail Username:&lt;/NC:emailIDDescription&gt;</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+        &lt;NC:showServerDetailsOnWizardSummary&gt;true&lt;/NC:showServerDetailsOnWizardSummary&gt;</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+      &lt;/NC:nsIMsgAccount&gt;</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+      &lt;NC:nsIMsgAccount about=&quot;domain:gmail.com?type=pop3&quot;&gt;</span>
<a href="#l1.75"></a><span id="l1.75">         &lt;!-- pop3 server info --&gt;</span>
<a href="#l1.76"></a><span id="l1.76">         &lt;NC:incomingServer&gt;</span>
<a href="#l1.77"></a><span id="l1.77">           &lt;NC:nsIMsgIncomingServer&gt;</span>
<a href="#l1.78"></a><span id="l1.78">             &lt;NC:prettyName&gt;Gmail&lt;/NC:prettyName&gt;</span>
<a href="#l1.79"></a><span id="l1.79">             &lt;NC:hostName&gt;pop.gmail.com&lt;/NC:hostName&gt;</span>
<a href="#l1.80"></a><span id="l1.80">             &lt;NC:type&gt;pop3&lt;/NC:type&gt;</span>
<a href="#l1.81"></a><span id="l1.81">             &lt;NC:ServerType-pop3&gt;</span>
<a href="#l1.82"></a><span id="l1.82">               &lt;NC:nsIPopIncomingServer&gt;</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineat">@@ -44,17 +105,17 @@</span>
<a href="#l1.84"></a><span id="l1.84">         &lt;NC:identity&gt;</span>
<a href="#l1.85"></a><span id="l1.85">           &lt;NC:nsIMsgIdentity&gt;</span>
<a href="#l1.86"></a><span id="l1.86">           &lt;/NC:nsIMsgIdentity&gt;</span>
<a href="#l1.87"></a><span id="l1.87">         &lt;/NC:identity&gt;</span>
<a href="#l1.88"></a><span id="l1.88"> </span>
<a href="#l1.89"></a><span id="l1.89">         &lt;!-- other options --&gt;</span>
<a href="#l1.90"></a><span id="l1.90">         &lt;NC:wizardSkipPanels&gt;true&lt;/NC:wizardSkipPanels&gt;</span>
<a href="#l1.91"></a><span id="l1.91">         &lt;NC:wizardShortName&gt;Gmail&lt;/NC:wizardShortName&gt;</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineminus">-        &lt;NC:wizardLongName&gt;Gmail&lt;/NC:wizardLongName&gt;</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+        &lt;NC:wizardLongName&gt;Gmail POP&lt;/NC:wizardLongName&gt;</span>
<a href="#l1.94"></a><span id="l1.94">         &lt;NC:wizardLongNameAccesskey&gt;G&lt;/NC:wizardLongNameAccesskey&gt;</span>
<a href="#l1.95"></a><span id="l1.95">         &lt;NC:wizardShow&gt;true&lt;/NC:wizardShow&gt;</span>
<a href="#l1.96"></a><span id="l1.96">         &lt;NC:wizardPromote&gt;true&lt;/NC:wizardPromote&gt;</span>
<a href="#l1.97"></a><span id="l1.97">         &lt;NC:emailProviderName&gt;Gmail&lt;/NC:emailProviderName&gt;</span>
<a href="#l1.98"></a><span id="l1.98">         &lt;NC:sampleEmail&gt;example@gmail.com&lt;/NC:sampleEmail&gt;</span>
<a href="#l1.99"></a><span id="l1.99">         &lt;NC:sampleUserName&gt;example&lt;/NC:sampleUserName&gt;</span>
<a href="#l1.100"></a><span id="l1.100">         &lt;NC:emailIDDescription&gt;Gmail Username:&lt;/NC:emailIDDescription&gt;</span>
<a href="#l1.101"></a><span id="l1.101">         &lt;NC:showServerDetailsOnWizardSummary&gt;true&lt;/NC:showServerDetailsOnWizardSummary&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/ispdata/googlemail.rdf</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/ispdata/googlemail.rdf</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,17 +1,78 @@</span>
<a href="#l2.4"></a><span id="l2.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> &lt;!DOCTYPE RDF&gt;</span>
<a href="#l2.6"></a><span id="l2.6"> &lt;RDF:RDF</span>
<a href="#l2.7"></a><span id="l2.7">     xmlns:NC=&quot;http://home.netscape.com/NC-rdf#&quot;</span>
<a href="#l2.8"></a><span id="l2.8">     xmlns:RDF=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;&gt;</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">   &lt;RDF:Description about=&quot;NC:ispinfo&quot;&gt;</span>
<a href="#l2.11"></a><span id="l2.11">     &lt;NC:providers&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-      &lt;NC:nsIMsgAccount about=&quot;domain:googlemail.com&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+      &lt;!-- Google Mail IMAP access --&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+      &lt;NC:nsIMsgAccount about=&quot;domain:googlemail.com?type=imap&quot;&gt;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+        &lt;!-- IMAP server info --&gt;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+        &lt;NC:incomingServer&gt;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+          &lt;NC:nsIMsgIncomingServer&gt;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+            &lt;NC:prettyName&gt;Google Mail&lt;/NC:prettyName&gt;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+            &lt;NC:hostName&gt;imap.googlemail.com&lt;/NC:hostName&gt;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+            &lt;NC:type&gt;imap&lt;/NC:type&gt;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+            &lt;NC:ServerType-imap&gt;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+              &lt;NC:nsIImapIncomingServer&gt;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+                &lt;NC:usingSubscription&gt;false&lt;/NC:usingSubscription&gt;</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+                &lt;!-- IMAP delete model: &quot;remove it immediately&quot;. --&gt;</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+                &lt;NC:deleteModel&gt;2&lt;/NC:deleteModel&gt;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+                &lt;NC:trashFolderName&gt;[Google Mail]/Trash&lt;/NC:trashFolderName&gt;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+              &lt;/NC:nsIImapIncomingServer&gt;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+            &lt;/NC:ServerType-imap&gt;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+            &lt;NC:loginAtStartUp&gt;true&lt;/NC:loginAtStartUp&gt;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+            &lt;NC:rememberPassword&gt;true&lt;/NC:rememberPassword&gt;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+            &lt;NC:port&gt;993&lt;/NC:port&gt;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+            &lt;NC:socketType&gt;3&lt;/NC:socketType&gt;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+          &lt;/NC:nsIMsgIncomingServer&gt;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+        &lt;/NC:incomingServer&gt;</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+        &lt;!-- SMTP server info --&gt;</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+        &lt;NC:smtp&gt;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+          &lt;NC:nsISmtpServer&gt;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+            &lt;NC:hostname&gt;smtp.googlemail.com&lt;/NC:hostname&gt;</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+            &lt;NC:port&gt;587&lt;/NC:port&gt;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+            &lt;NC:trySSL&gt;2&lt;/NC:trySSL&gt;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+            &lt;NC:description&gt;Google Mail SMTP&lt;/NC:description&gt;</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+          &lt;/NC:nsISmtpServer&gt;</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+        &lt;/NC:smtp&gt;</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+        &lt;NC:smtpRequiresUsername&gt;true&lt;/NC:smtpRequiresUsername&gt;</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+        &lt;NC:smtpCreateNewServer&gt;true&lt;/NC:smtpCreateNewServer&gt;</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+        &lt;NC:smtpUsePreferredServer&gt;true&lt;/NC:smtpUsePreferredServer&gt;</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+        &lt;!-- identity defaults --&gt;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+        &lt;NC:identity&gt;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+          &lt;NC:nsIMsgIdentity&gt;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+            &lt;!-- Don't store sent mail in a Sent folder, as Google Mail will show it</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+                 in [Google Mail]/Sent Mail anyway. --&gt;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+            &lt;NC:doFcc&gt;false&lt;/NC:doFcc&gt;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+            &lt;NC:FccFolder&gt;[Google Mail]/Sent Mail&lt;/NC:FccFolder&gt;</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+            &lt;NC:DraftFolder&gt;[Google Mail]/Drafts&lt;/NC:DraftFolder&gt;</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+          &lt;/NC:nsIMsgIdentity&gt;</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+        &lt;/NC:identity&gt;</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+        &lt;!-- other options --&gt;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+        &lt;NC:wizardSkipPanels&gt;true&lt;/NC:wizardSkipPanels&gt;</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+        &lt;NC:wizardShortName&gt;Google Mail&lt;/NC:wizardShortName&gt;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+        &lt;NC:wizardLongName&gt;Google Mail IMAP&lt;/NC:wizardLongName&gt;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+        &lt;NC:wizardLongNameAccesskey&gt;M&lt;/NC:wizardLongNameAccesskey&gt;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+        &lt;NC:wizardShow&gt;true&lt;/NC:wizardShow&gt;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+        &lt;NC:wizardPromote&gt;true&lt;/NC:wizardPromote&gt;</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+        &lt;NC:emailProviderName&gt;Google Mail&lt;/NC:emailProviderName&gt;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+        &lt;NC:sampleEmail&gt;example@googlemail.com&lt;/NC:sampleEmail&gt;</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+        &lt;NC:sampleUserName&gt;example&lt;/NC:sampleUserName&gt;</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+        &lt;NC:emailIDDescription&gt;Google Mail Username:&lt;/NC:emailIDDescription&gt;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+        &lt;NC:showServerDetailsOnWizardSummary&gt;true&lt;/NC:showServerDetailsOnWizardSummary&gt;</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+      &lt;/NC:nsIMsgAccount&gt;</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+      &lt;NC:nsIMsgAccount about=&quot;domain:googlemail.com?type=pop3&quot;&gt;</span>
<a href="#l2.75"></a><span id="l2.75">         &lt;!-- pop3 server info --&gt;</span>
<a href="#l2.76"></a><span id="l2.76">         &lt;NC:incomingServer&gt;</span>
<a href="#l2.77"></a><span id="l2.77">           &lt;NC:nsIMsgIncomingServer&gt;</span>
<a href="#l2.78"></a><span id="l2.78">             &lt;NC:prettyName&gt;Google Mail&lt;/NC:prettyName&gt;</span>
<a href="#l2.79"></a><span id="l2.79">             &lt;NC:hostName&gt;pop.googlemail.com&lt;/NC:hostName&gt;</span>
<a href="#l2.80"></a><span id="l2.80">             &lt;NC:type&gt;pop3&lt;/NC:type&gt;</span>
<a href="#l2.81"></a><span id="l2.81">             &lt;NC:ServerType-pop3&gt;</span>
<a href="#l2.82"></a><span id="l2.82">               &lt;NC:nsIPopIncomingServer&gt;</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineat">@@ -44,17 +105,18 @@</span>
<a href="#l2.84"></a><span id="l2.84">         &lt;NC:identity&gt;</span>
<a href="#l2.85"></a><span id="l2.85">           &lt;NC:nsIMsgIdentity&gt;</span>
<a href="#l2.86"></a><span id="l2.86">           &lt;/NC:nsIMsgIdentity&gt;</span>
<a href="#l2.87"></a><span id="l2.87">         &lt;/NC:identity&gt;</span>
<a href="#l2.88"></a><span id="l2.88"> </span>
<a href="#l2.89"></a><span id="l2.89">         &lt;!-- other options --&gt;</span>
<a href="#l2.90"></a><span id="l2.90">         &lt;NC:wizardSkipPanels&gt;true&lt;/NC:wizardSkipPanels&gt;</span>
<a href="#l2.91"></a><span id="l2.91">         &lt;NC:wizardShortName&gt;Google Mail&lt;/NC:wizardShortName&gt;</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-        &lt;NC:wizardLongName&gt;Google Mail&lt;/NC:wizardLongName&gt;</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+        &lt;NC:wizardLongName&gt;Google Mail POP&lt;/NC:wizardLongName&gt;</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+        &lt;NC:wizardLongNameAccesskey&gt;G&lt;/NC:wizardLongNameAccesskey&gt;</span>
<a href="#l2.95"></a><span id="l2.95">         &lt;NC:wizardShow&gt;true&lt;/NC:wizardShow&gt;</span>
<a href="#l2.96"></a><span id="l2.96">         &lt;NC:wizardPromote&gt;true&lt;/NC:wizardPromote&gt;</span>
<a href="#l2.97"></a><span id="l2.97">         &lt;NC:emailProviderName&gt;Google Mail&lt;/NC:emailProviderName&gt;</span>
<a href="#l2.98"></a><span id="l2.98">         &lt;NC:sampleEmail&gt;example@googlemail.com&lt;/NC:sampleEmail&gt;</span>
<a href="#l2.99"></a><span id="l2.99">         &lt;NC:sampleUserName&gt;example&lt;/NC:sampleUserName&gt;</span>
<a href="#l2.100"></a><span id="l2.100">         &lt;NC:emailIDDescription&gt;Google Mail Username:&lt;/NC:emailIDDescription&gt;</span>
<a href="#l2.101"></a><span id="l2.101">         &lt;NC:showServerDetailsOnWizardSummary&gt;true&lt;/NC:showServerDetailsOnWizardSummary&gt;</span>
<a href="#l2.102"></a><span id="l2.102">       &lt;/NC:nsIMsgAccount&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/prefs/resources/content/AccountWizard.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/prefs/resources/content/AccountWizard.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -555,31 +555,31 @@ function finishAccount(account, accountD</span>
<a href="#l3.4"></a><span id="l3.4">      }</span>
<a href="#l3.5"></a><span id="l3.5"> }</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> // Helper method used by copyObjectToInterface which attempts to set dest[attribute] as a generic</span>
<a href="#l3.8"></a><span id="l3.8"> // attribute on the xpconnect object, src.</span>
<a href="#l3.9"></a><span id="l3.9"> // This routine skips any attribute that begins with ServerType- </span>
<a href="#l3.10"></a><span id="l3.10"> function setGenericAttribute(dest, src, attribute)</span>
<a href="#l3.11"></a><span id="l3.11"> {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  if (!(/^ServerType-/i.test(attribute)))</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  if (!(/^ServerType-/i.test(attribute)) &amp;&amp; src[attribute])</span>
<a href="#l3.14"></a><span id="l3.14">   {</span>
<a href="#l3.15"></a><span id="l3.15">     switch (typeof src[attribute])</span>
<a href="#l3.16"></a><span id="l3.16">     {</span>
<a href="#l3.17"></a><span id="l3.17">       case &quot;string&quot;:</span>
<a href="#l3.18"></a><span id="l3.18">         dest.setUnicharAttribute(attribute, src[attribute]);</span>
<a href="#l3.19"></a><span id="l3.19">         break;</span>
<a href="#l3.20"></a><span id="l3.20">       case &quot;boolean&quot;:</span>
<a href="#l3.21"></a><span id="l3.21">         dest.setBoolAttribute(attribute, src[attribute]);</span>
<a href="#l3.22"></a><span id="l3.22">         break;</span>
<a href="#l3.23"></a><span id="l3.23">       case &quot;number&quot;:</span>
<a href="#l3.24"></a><span id="l3.24">         dest.setIntAttribute(attribute, src[attribute]);</span>
<a href="#l3.25"></a><span id="l3.25">         break;</span>
<a href="#l3.26"></a><span id="l3.26">       default:</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-        dump('Error: No Generic attribute found for: ' +  typeof src[attribute] + '\n');</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+        dump(&quot;Error: No Generic attribute &quot; + attribute + &quot; found for: &quot; + dest + &quot;\n&quot;);</span>
<a href="#l3.29"></a><span id="l3.29">         break;</span>
<a href="#l3.30"></a><span id="l3.30">     }</span>
<a href="#l3.31"></a><span id="l3.31">   }</span>
<a href="#l3.32"></a><span id="l3.32"> }</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34"> // copy over all attributes from dest into src that already exist in src</span>
<a href="#l3.35"></a><span id="l3.35"> // the assumption is that src is an XPConnect interface full of attributes</span>
<a href="#l3.36"></a><span id="l3.36"> // @param useGenericFallback if we can't set an attribute directly on src, then fall back</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineat">@@ -658,23 +658,23 @@ function setupCopiesAndFoldersServer(acc</span>
<a href="#l3.38"></a><span id="l3.38">     {</span>
<a href="#l3.39"></a><span id="l3.39">       if (!am.localFoldersServer) </span>
<a href="#l3.40"></a><span id="l3.40">       {</span>
<a href="#l3.41"></a><span id="l3.41">         dump(&quot;error!  we should have a local mail server at this point\n&quot;);</span>
<a href="#l3.42"></a><span id="l3.42">         return false;</span>
<a href="#l3.43"></a><span id="l3.43">       }</span>
<a href="#l3.44"></a><span id="l3.44">       copiesAndFoldersServer = am.localFoldersServer;</span>
<a href="#l3.45"></a><span id="l3.45">     }</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-	  </span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+</span>
<a href="#l3.48"></a><span id="l3.48">     setDefaultCopiesAndFoldersPrefs(identity, copiesAndFoldersServer, accountData);</span>
<a href="#l3.49"></a><span id="l3.49"> </span>
<a href="#l3.50"></a><span id="l3.50">   } catch (ex) {</span>
<a href="#l3.51"></a><span id="l3.51">     // return false (meaning we did not setupCopiesAndFoldersServer)</span>
<a href="#l3.52"></a><span id="l3.52">     // on any error</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-    dump(&quot;Error setupCopiesAndFoldersServer&quot; + ex + &quot;\n&quot;);</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+    dump(&quot;Error in setupCopiesAndFoldersServer: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l3.55"></a><span id="l3.55">     return false;</span>
<a href="#l3.56"></a><span id="l3.56">   }</span>
<a href="#l3.57"></a><span id="l3.57">   return true;</span>
<a href="#l3.58"></a><span id="l3.58"> }</span>
<a href="#l3.59"></a><span id="l3.59"> </span>
<a href="#l3.60"></a><span id="l3.60"> function setDefaultCopiesAndFoldersPrefs(identity, server, accountData)</span>
<a href="#l3.61"></a><span id="l3.61"> {</span>
<a href="#l3.62"></a><span id="l3.62">   var rootFolder = server.rootFolder;</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineat">@@ -691,45 +691,51 @@ function setDefaultCopiesAndFoldersPrefs</span>
<a href="#l3.64"></a><span id="l3.64"> 	// this since we are creating the server, it obviously hasn't been</span>
<a href="#l3.65"></a><span id="l3.65">   // opened, or in rdf.</span>
<a href="#l3.66"></a><span id="l3.66">   //</span>
<a href="#l3.67"></a><span id="l3.67">   // this makes the assumption that the server's draft, stationery fcc folder</span>
<a href="#l3.68"></a><span id="l3.68">   // are at the top level (ie subfolders of the root folder.)  this works</span>
<a href="#l3.69"></a><span id="l3.69">   // because we happen to be doing things that way, and if the user changes</span>
<a href="#l3.70"></a><span id="l3.70">   // that, it will work because to change the folder, it must be in rdf,</span>
<a href="#l3.71"></a><span id="l3.71">   // coming from the folder cache, in the worst case.</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-  var folders = rootFolder.GetSubFolders();</span>
<a href="#l3.73"></a><span id="l3.73">   var msgFolder = rootFolder.QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l3.74"></a><span id="l3.74"> </span>
<a href="#l3.75"></a><span id="l3.75">   /** </span>
<a href="#l3.76"></a><span id="l3.76">    * When a new account is created, folders 'Sent', 'Drafts'</span>
<a href="#l3.77"></a><span id="l3.77">    * and 'Templates' are not created then, but created on demand at runtime. </span>
<a href="#l3.78"></a><span id="l3.78">    * But we do need to present them as possible choices in the Copies and Folders </span>
<a href="#l3.79"></a><span id="l3.79">    * UI. To do that, folder URIs have to be created and stored in the prefs file. </span>
<a href="#l3.80"></a><span id="l3.80">    * So, if there is a need to build special folders, append the special folder </span>
<a href="#l3.81"></a><span id="l3.81">    * names and create right URIs.</span>
<a href="#l3.82"></a><span id="l3.82">    */</span>
<a href="#l3.83"></a><span id="l3.83">   var folderDelim = &quot;/&quot;;</span>
<a href="#l3.84"></a><span id="l3.84"> </span>
<a href="#l3.85"></a><span id="l3.85">   /* we use internal names known to everyone like Sent, Templates and Drafts */</span>
<a href="#l3.86"></a><span id="l3.86">   /* if folder names were already given in isp rdf, we use them,</span>
<a href="#l3.87"></a><span id="l3.87">      otherwise we use internal names known to everyone like Sent, Templates and Drafts */</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-  </span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-  var draftFolder = (accountData.identity &amp;&amp; accountData.identity.draftFolder ? accountData.identity.draftFolder : &quot;Drafts&quot;);</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineminus">-  var stationeryFolder = (accountData.identity &amp;&amp; accountData.identity.stationeryFolder ? accountData.identity.stationeryFolder : &quot;Templates&quot;);</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineminus">-  var fccFolder = (accountData.identity &amp;&amp; accountData.identity.fccFolder ? accountData.identity.fccFolder : &quot;Sent&quot;);</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+  // Note the capital F, D and S!</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+  var draftFolder = (accountData.identity &amp;&amp; accountData.identity.DraftFolder ?</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+    accountData.identity.DraftFolder : &quot;Drafts&quot;);</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+  var stationeryFolder = (accountData.identity &amp;&amp; accountData.identity.StationeryFolder ?</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+    accountData.identity.StationeryFolder : &quot;Templates&quot;);</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+  var fccFolder = (accountData.identity &amp;&amp; accountData.identity.FccFolder ?</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+    accountData.identity.FccFolder : &quot;Sent&quot;);</span>
<a href="#l3.100"></a><span id="l3.100"> </span>
<a href="#l3.101"></a><span id="l3.101">   identity.draftFolder = msgFolder.server.serverURI+ folderDelim + draftFolder;</span>
<a href="#l3.102"></a><span id="l3.102">   identity.stationeryFolder = msgFolder.server.serverURI+ folderDelim + stationeryFolder;</span>
<a href="#l3.103"></a><span id="l3.103">   identity.fccFolder = msgFolder.server.serverURI+ folderDelim + fccFolder;</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-          </span>
<a href="#l3.105"></a><span id="l3.105"> </span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-  identity.fccFolderPickerMode = (accountData.identity &amp;&amp; accountData.identity.fccFolder ? 1 : gDefaultSpecialFolderPickerMode);</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-  identity.draftsFolderPickerMode = (accountData.identity &amp;&amp; accountData.identity.draftFolder ? 1 : gDefaultSpecialFolderPickerMode);</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-  identity.tmplFolderPickerMode = (accountData.identity &amp;&amp; accountData.identity.stationeryFolder ? 1 : gDefaultSpecialFolderPickerMode);</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+  // Note the capital F, D and S!</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+  identity.fccFolderPickerMode = (accountData.identity &amp;&amp;</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+    accountData.identity.FccFolder ? 1 : gDefaultSpecialFolderPickerMode);</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+  identity.draftsFolderPickerMode = (accountData.identity &amp;&amp;</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+    accountData.identity.DraftFolder ? 1 : gDefaultSpecialFolderPickerMode);</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+  identity.tmplFolderPickerMode = (accountData.identity &amp;&amp;</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+    accountData.identity.StationeryFolder ? 1 : gDefaultSpecialFolderPickerMode);</span>
<a href="#l3.116"></a><span id="l3.116"> }</span>
<a href="#l3.117"></a><span id="l3.117"> </span>
<a href="#l3.118"></a><span id="l3.118"> function AccountExists(userName,hostName,serverType)</span>
<a href="#l3.119"></a><span id="l3.119"> {</span>
<a href="#l3.120"></a><span id="l3.120">   var accountExists = false;</span>
<a href="#l3.121"></a><span id="l3.121">   var accountManager = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;].getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l3.122"></a><span id="l3.122">   try {</span>
<a href="#l3.123"></a><span id="l3.123">         var server = accountManager.findRealServer(userName,hostName,serverType,0);</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineat">@@ -740,20 +746,21 @@ function AccountExists(userName,hostName</span>
<a href="#l3.125"></a><span id="l3.125">   catch (ex) {</span>
<a href="#l3.126"></a><span id="l3.126">         accountExists = false;</span>
<a href="#l3.127"></a><span id="l3.127">   }</span>
<a href="#l3.128"></a><span id="l3.128">   return accountExists;</span>
<a href="#l3.129"></a><span id="l3.129"> }</span>
<a href="#l3.130"></a><span id="l3.130"> </span>
<a href="#l3.131"></a><span id="l3.131"> function getFirstInvalidAccount()</span>
<a href="#l3.132"></a><span id="l3.132"> {</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineminus">-    am = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;].getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+    var am = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+                       .getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l3.136"></a><span id="l3.136"> </span>
<a href="#l3.137"></a><span id="l3.137">     var invalidAccounts = getInvalidAccounts(am.accounts);</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineminus">-  </span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+</span>
<a href="#l3.140"></a><span id="l3.140">     if (invalidAccounts.length &gt; 0)</span>
<a href="#l3.141"></a><span id="l3.141">         return invalidAccounts[0];</span>
<a href="#l3.142"></a><span id="l3.142">     else</span>
<a href="#l3.143"></a><span id="l3.143">         return null;</span>
<a href="#l3.144"></a><span id="l3.144"> }</span>
<a href="#l3.145"></a><span id="l3.145"> </span>
<a href="#l3.146"></a><span id="l3.146"> function checkForInvalidAccounts()</span>
<a href="#l3.147"></a><span id="l3.147"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/prefs/resources/content/ispUtils.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/prefs/resources/content/ispUtils.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -56,35 +56,40 @@ var nsIRDFLiteral = Components.interface</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> var ispRoot = rdf.GetResource(&quot;NC:ispinfo&quot;);</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> // given an ISP's domain URI, look up all relevant information about it</span>
<a href="#l4.8"></a><span id="l4.8"> function getIspDefaultsForUri(domainURI)</span>
<a href="#l4.9"></a><span id="l4.9"> {</span>
<a href="#l4.10"></a><span id="l4.10">     if (!ispDefaults) </span>
<a href="#l4.11"></a><span id="l4.11">         ispDefaults = rdf.GetDataSource(&quot;rdf:ispdefaults&quot;);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    </span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+</span>
<a href="#l4.14"></a><span id="l4.14">     var domainRes = rdf.GetResource(domainURI);</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">     var result = dataSourceToObject(ispDefaults, domainRes);</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">     if (!result) return null;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-    </span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+</span>
<a href="#l4.21"></a><span id="l4.21">     // The domainURI should be in the format domain:aol.com. (Where </span>
<a href="#l4.22"></a><span id="l4.22">     // aol.com is the domain name to use for all email addresses). If</span>
<a href="#l4.23"></a><span id="l4.23">     // it does not match this pattern, then it is possible no domain</span>
<a href="#l4.24"></a><span id="l4.24">     // has been specified, so we should leave it uninitialized.</span>
<a href="#l4.25"></a><span id="l4.25">     if (/^domain:/.test(domainURI)) {</span>
<a href="#l4.26"></a><span id="l4.26">         // add this extra attribute which is the domain itself</span>
<a href="#l4.27"></a><span id="l4.27">         var domainData = domainURI.split(':');</span>
<a href="#l4.28"></a><span id="l4.28">         if (domainData.length &gt; 1) {</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-            result.domain = domainData[1];</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+          // To faciltate distributing two different account types for one ISP,</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+          // it's possible to add parameters to the domain URI </span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+          // - e.g. domain:gmail.com?type=imap.</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+          // This is necessary so RDF doesn't think they're the same.</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+          // Save the domain, but only the part up to the (possible) question mark.</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+          result.domain = /[^?]*/.exec(domainData[1]);</span>
<a href="#l4.37"></a><span id="l4.37">         }</span>
<a href="#l4.38"></a><span id="l4.38">     }</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-    </span>
<a href="#l4.40"></a><span id="l4.40">     return result;</span>
<a href="#l4.41"></a><span id="l4.41"> }</span>
<a href="#l4.42"></a><span id="l4.42"> </span>
<a href="#l4.43"></a><span id="l4.43"> // construct an ISP's domain URI based on it's domain</span>
<a href="#l4.44"></a><span id="l4.44"> // (i.e. turns isp.com -&gt; domain:isp.com)</span>
<a href="#l4.45"></a><span id="l4.45"> function getIspDefaultsForDomain(domain) {</span>
<a href="#l4.46"></a><span id="l4.46">     domainURI = &quot;domain:&quot; + domain;</span>
<a href="#l4.47"></a><span id="l4.47">     return getIspDefaultsForUri(domainURI);</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineat">@@ -103,26 +108,26 @@ function getIspDefaultsForEmail(email) {</span>
<a href="#l4.49"></a><span id="l4.49"> </span>
<a href="#l4.50"></a><span id="l4.50">     return ispData;</span>
<a href="#l4.51"></a><span id="l4.51"> }</span>
<a href="#l4.52"></a><span id="l4.52"> </span>
<a href="#l4.53"></a><span id="l4.53"> // given an email address, split it into username and domain</span>
<a href="#l4.54"></a><span id="l4.54"> // return in an associative array</span>
<a href="#l4.55"></a><span id="l4.55"> function getEmailInfo(email) {</span>
<a href="#l4.56"></a><span id="l4.56">     if (!email) return null;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-    </span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+</span>
<a href="#l4.59"></a><span id="l4.59">     var result = new Object;</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-    </span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+</span>
<a href="#l4.62"></a><span id="l4.62">     var emailData = email.split('@');</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-    </span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+</span>
<a href="#l4.65"></a><span id="l4.65">     if (emailData.length != 2) {</span>
<a href="#l4.66"></a><span id="l4.66">         dump(&quot;bad e-mail address!\n&quot;);</span>
<a href="#l4.67"></a><span id="l4.67">         return null;</span>
<a href="#l4.68"></a><span id="l4.68">     }</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-    </span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+</span>
<a href="#l4.71"></a><span id="l4.71">     // all the variables we'll be returning</span>
<a href="#l4.72"></a><span id="l4.72">     result.username = emailData[0];</span>
<a href="#l4.73"></a><span id="l4.73">     result.domain = emailData[1];</span>
<a href="#l4.74"></a><span id="l4.74"> </span>
<a href="#l4.75"></a><span id="l4.75">     return result;</span>
<a href="#l4.76"></a><span id="l4.76"> }</span>
<a href="#l4.77"></a><span id="l4.77"> </span>
<a href="#l4.78"></a><span id="l4.78"> function prefillIspData(ispData, email, fullName) {</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineat">@@ -139,17 +144,16 @@ function prefillIspData(ispData, email, </span>
<a href="#l4.80"></a><span id="l4.80">     var emailData = getEmailInfo(email);</span>
<a href="#l4.81"></a><span id="l4.81">     if (emailData) {</span>
<a href="#l4.82"></a><span id="l4.82"> </span>
<a href="#l4.83"></a><span id="l4.83">         // fill in the username (assuming the ISP doesn't prevent it)</span>
<a href="#l4.84"></a><span id="l4.84">         if (!ispData.incomingServer.userName &amp;&amp;</span>
<a href="#l4.85"></a><span id="l4.85">             !ispData.incomingServer.noDefaultUsername)</span>
<a href="#l4.86"></a><span id="l4.86">             ispData.incomingServer.username = emailData.username;</span>
<a href="#l4.87"></a><span id="l4.87">     }</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-    </span>
<a href="#l4.89"></a><span id="l4.89"> }</span>
<a href="#l4.90"></a><span id="l4.90"> </span>
<a href="#l4.91"></a><span id="l4.91"> // this function will extract an entire datasource into a giant</span>
<a href="#l4.92"></a><span id="l4.92"> // associative array for easy retrieval from JS</span>
<a href="#l4.93"></a><span id="l4.93"> var NClength = NC.length;</span>
<a href="#l4.94"></a><span id="l4.94"> function dataSourceToObject(datasource, root)</span>
<a href="#l4.95"></a><span id="l4.95"> {</span>
<a href="#l4.96"></a><span id="l4.96">     var result = null;</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineat">@@ -157,19 +161,19 @@ function dataSourceToObject(datasource, </span>
<a href="#l4.98"></a><span id="l4.98"> </span>
<a href="#l4.99"></a><span id="l4.99">     while (arcs.hasMoreElements()) {</span>
<a href="#l4.100"></a><span id="l4.100">         var arc = arcs.getNext().QueryInterface(nsIRDFResource);</span>
<a href="#l4.101"></a><span id="l4.101"> </span>
<a href="#l4.102"></a><span id="l4.102">         var arcName = arc.Value;</span>
<a href="#l4.103"></a><span id="l4.103">         arcName = arcName.substring(NClength, arcName.length);</span>
<a href="#l4.104"></a><span id="l4.104"> </span>
<a href="#l4.105"></a><span id="l4.105">         if (!result) result = new Object;</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-        </span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+</span>
<a href="#l4.108"></a><span id="l4.108">         var target = datasource.GetTarget(root, arc, true);</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-        </span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+</span>
<a href="#l4.111"></a><span id="l4.111">         var value;</span>
<a href="#l4.112"></a><span id="l4.112">         var targetHasChildren = false;</span>
<a href="#l4.113"></a><span id="l4.113">         try {</span>
<a href="#l4.114"></a><span id="l4.114">             target = target.QueryInterface(nsIRDFResource);</span>
<a href="#l4.115"></a><span id="l4.115">             targetHasChildren = true;</span>
<a href="#l4.116"></a><span id="l4.116">         } catch (ex) {</span>
<a href="#l4.117"></a><span id="l4.117">             target = target.QueryInterface(nsIRDFLiteral);</span>
<a href="#l4.118"></a><span id="l4.118">         }</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineat">@@ -182,15 +186,14 @@ function dataSourceToObject(datasource, </span>
<a href="#l4.120"></a><span id="l4.120">             // fixup booleans/numbers/etc</span>
<a href="#l4.121"></a><span id="l4.121">             if (value == &quot;true&quot;) value = true;</span>
<a href="#l4.122"></a><span id="l4.122">             else if (value == &quot;false&quot;) value = false;</span>
<a href="#l4.123"></a><span id="l4.123">             else {</span>
<a href="#l4.124"></a><span id="l4.124">                 var num = Number(value);</span>
<a href="#l4.125"></a><span id="l4.125">                 if (!isNaN(num)) value = num;</span>
<a href="#l4.126"></a><span id="l4.126">             }</span>
<a href="#l4.127"></a><span id="l4.127">         }</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-            </span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-        </span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+</span>
<a href="#l4.131"></a><span id="l4.131">         // add this value</span>
<a href="#l4.132"></a><span id="l4.132">         result[arcName] = value;</span>
<a href="#l4.133"></a><span id="l4.133">     }</span>
<a href="#l4.134"></a><span id="l4.134">     return result;</span>
<a href="#l4.135"></a><span id="l4.135"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

