<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 21521:edc74844fc0aa021de8276df7305ed1e445f5768</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ edc74844fc0aa021de8276df7305ed1e445f5768" />
<meta property="og:url" content="/comm-central/rev/edc74844fc0aa021de8276df7305ed1e445f5768" />
<meta property="og:description" content="Bug 1360117 - Improve detection of servers requiring additional IMAP select. r=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / edc74844fc0aa021de8276df7305ed1e445f5768 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/edc74844fc0aa021de8276df7305ed1e445f5768">shortlog</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/edc74844fc0aa021de8276df7305ed1e445f5768">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768">files</a> |
changeset |
<a href="/comm-central/raw-rev/edc74844fc0aa021de8276df7305ed1e445f5768">raw</a>  | <a href="/comm-central/archive/edc74844fc0aa021de8276df7305ed1e445f5768.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1360117">Bug 1360117</a> - Improve detection of servers requiring additional IMAP select. r=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#110;&#101;&#32;&#83;&#109;&#105;&#116;&#104;&#32;&#60;&#103;&#100;&#115;&#64;&#99;&#104;&#97;&#114;&#116;&#101;&#114;&#116;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 04 May 2017 02:20:02 -0400</td></tr>

<tr>
 <td>changeset 21521</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/edc74844fc0aa021de8276df7305ed1e445f5768">edc74844fc0aa021de8276df7305ed1e445f5768</a></td>
</tr>



<tr>
<td>parent 21520</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a4cdf9a9fe666b2b1e045d6fae82406130ea1398">a4cdf9a9fe666b2b1e045d6fae82406130ea1398</a>
</td>
</tr>

<tr>
<td>child 21522</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/34153f64820674523909b789c68f58e8f0c1af01">34153f64820674523909b789c68f58e8f0c1af01</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=edc74844fc0aa021de8276df7305ed1e445f5768">13102</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 04 May 2017 07:14:06 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@34153f648206 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=34153f64820674523909b789c68f58e8f0c1af01">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=34153f64820674523909b789c68f58e8f0c1af01&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=34153f64820674523909b789c68f58e8f0c1af01&newProject=comm-central&newRevision=edc74844fc0aa021de8276df7305ed1e445f5768&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=34153f64820674523909b789c68f58e8f0c1af01&newProject=comm-central&newRevision=edc74844fc0aa021de8276df7305ed1e445f5768&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=34153f64820674523909b789c68f58e8f0c1af01&newProject=comm-central&newRevision=edc74844fc0aa021de8276df7305ed1e445f5768&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1360117">1360117</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1360117">Bug 1360117</a> - Improve detection of servers requiring additional IMAP select. r=jorgk
Removes advance server option to force IMAP select and allows automatic
detection based on identifier string in the IMAP ID response from
servers. All control is now done via config editor: force an extra
select for server, preclude extra select for server, or automatically
decide based on configured strings compared to ID response.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">mail/locales/en-US/chrome/messenger/am-server-advanced.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server-advanced.xul">mailnews/base/prefs/content/am-server-advanced.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server-advanced.xul">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server-advanced.xul">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server-advanced.xul">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server-advanced.xul">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server-advanced.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.js">mailnews/base/prefs/content/am-server.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.js">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.js">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.js">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.js">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.xul">mailnews/base/prefs/content/am-server.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.xul">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.xul">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.xul">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.xul">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/base/prefs/content/am-server.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapIncomingServer.idl">mailnews/imap/public/nsIImapIncomingServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapIncomingServer.idl">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapIncomingServer.idl">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapIncomingServer.idl">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapIncomingServer.idl">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapIncomingServer.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapServerSink.idl">mailnews/imap/public/nsIImapServerSink.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapServerSink.idl">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapServerSink.idl">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapServerSink.idl">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapServerSink.idl">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/public/nsIImapServerSink.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.h">mailnews/imap/src/nsImapProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.h">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.h">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.h">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.h">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsImapProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsSyncRunnableHelpers.cpp">mailnews/imap/src/nsSyncRunnableHelpers.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsSyncRunnableHelpers.cpp">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsSyncRunnableHelpers.cpp">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsSyncRunnableHelpers.cpp">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsSyncRunnableHelpers.cpp">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/imap/src/nsSyncRunnableHelpers.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/mailnews.js">mailnews/mailnews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/mailnews.js">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/mailnews.js">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/mailnews.js">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/mailnews.js">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/mailnews/mailnews.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/edc74844fc0aa021de8276df7305ed1e445f5768/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">file</a> |
<a href="/comm-central/annotate/edc74844fc0aa021de8276df7305ed1e445f5768/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">annotate</a> |
<a href="/comm-central/diff/edc74844fc0aa021de8276df7305ed1e445f5768/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">diff</a> |
<a href="/comm-central/comparison/edc74844fc0aa021de8276df7305ed1e445f5768/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">comparison</a> |
<a href="/comm-central/log/edc74844fc0aa021de8276df7305ed1e445f5768/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -7,19 +7,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;!ENTITY serverDirectory.label &quot;IMAP server directory:&quot;&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> &lt;!ENTITY serverDirectory.accesskey &quot;d&quot;&gt;</span>
<a href="#l1.6"></a><span id="l1.6"> &lt;!ENTITY usingSubscription.label &quot;Show only subscribed folders&quot;&gt;</span>
<a href="#l1.7"></a><span id="l1.7"> &lt;!ENTITY usingSubscription.accesskey &quot;w&quot;&gt;</span>
<a href="#l1.8"></a><span id="l1.8"> &lt;!ENTITY dualUseFolders.label &quot;Server supports folders that contain sub-folders and messages&quot;&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> &lt;!ENTITY dualUseFolders.accesskey &quot;f&quot;&gt;</span>
<a href="#l1.10"></a><span id="l1.10"> &lt;!ENTITY maximumConnectionsNumber.label &quot;Maximum number of server connections to cache&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> &lt;!ENTITY maximumConnectionsNumber.accesskey &quot;M&quot;&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-&lt;!ENTITY forceSelect.label &quot;Send IMAP select to server when checking for new mail&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-&lt;!ENTITY forceSelect.tooltip &quot;Some servers need an additional IMAP select so new email is reliably received, or is shown as read after it has been read on another device. Selecting this option will cause some increased network traffic.&quot;&gt;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-&lt;!ENTITY forceSelect.accesskey &quot;S&quot;&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> &lt;!-- LOCALIZATION NOTE (namespaceDesc.label): Do not translate &quot;IMAP&quot; --&gt;</span>
<a href="#l1.16"></a><span id="l1.16"> &lt;!ENTITY namespaceDesc.label &quot;These preferences specify the namespaces on your IMAP server&quot;&gt;</span>
<a href="#l1.17"></a><span id="l1.17"> &lt;!ENTITY personalNamespace.label &quot;Personal namespace:&quot;&gt;</span>
<a href="#l1.18"></a><span id="l1.18"> &lt;!ENTITY personalNamespace.accesskey &quot;P&quot;&gt;</span>
<a href="#l1.19"></a><span id="l1.19"> &lt;!ENTITY publicNamespace.label &quot;Public (shared):&quot;&gt;</span>
<a href="#l1.20"></a><span id="l1.20"> &lt;!ENTITY publicNamespace.accesskey &quot;u&quot;&gt;</span>
<a href="#l1.21"></a><span id="l1.21"> &lt;!ENTITY otherUsersNamespace.label &quot;Other Users:&quot;&gt;</span>
<a href="#l1.22"></a><span id="l1.22"> &lt;!ENTITY otherUsersNamespace.accesskey &quot;O&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server-advanced.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server-advanced.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -92,22 +92,16 @@</span>
<a href="#l2.4"></a><span id="l2.4">           &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l2.5"></a><span id="l2.5">             &lt;separator class=&quot;indent&quot;/&gt;</span>
<a href="#l2.6"></a><span id="l2.6">             &lt;checkbox amsa_persist=&quot;true&quot; id=&quot;overrideNamespaces&quot;</span>
<a href="#l2.7"></a><span id="l2.7">                       label=&quot;&amp;overrideNamespaces.label;&quot;</span>
<a href="#l2.8"></a><span id="l2.8">                       accesskey=&quot;&amp;overrideNamespaces.accesskey;&quot;/&gt;</span>
<a href="#l2.9"></a><span id="l2.9">           &lt;/row&gt;</span>
<a href="#l2.10"></a><span id="l2.10">         &lt;/rows&gt;</span>
<a href="#l2.11"></a><span id="l2.11">       &lt;/grid&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-      &lt;separator class=&quot;groove&quot;/&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-      &lt;checkbox amsa_persist=&quot;true&quot; id=&quot;forceSelect&quot;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                label=&quot;&amp;forceSelect.label;&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-                tooltiptext=&quot;&amp;forceSelect.tooltip;&quot;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-                accesskey=&quot;&amp;forceSelect.accesskey;&quot;/&gt;</span>
<a href="#l2.18"></a><span id="l2.18">     &lt;/vbox&gt;</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">     &lt;!-- POP3 Panel --&gt;</span>
<a href="#l2.22"></a><span id="l2.22">     &lt;vbox id=&quot;pop3Panel&quot;&gt;</span>
<a href="#l2.23"></a><span id="l2.23">       &lt;label flex=&quot;1&quot; control=&quot;folderStorage&quot;&gt;&amp;pop3DeferringDesc.label;&lt;/label&gt;</span>
<a href="#l2.24"></a><span id="l2.24">       &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.25"></a><span id="l2.25">         &lt;radiogroup id=&quot;folderStorage&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -128,17 +128,16 @@ function onAdvanced()</span>
<a href="#l3.4"></a><span id="l3.4">   serverSettings.serverPrettyName = gServer.prettyName;</span>
<a href="#l3.5"></a><span id="l3.5">   serverSettings.account = top.getCurrentAccount();</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7">   if (serverType == &quot;imap&quot;)</span>
<a href="#l3.8"></a><span id="l3.8">   {</span>
<a href="#l3.9"></a><span id="l3.9">     serverSettings.dualUseFolders = document.getElementById(&quot;imap.dualUseFolders&quot;).checked;</span>
<a href="#l3.10"></a><span id="l3.10">     serverSettings.usingSubscription = document.getElementById(&quot;imap.usingSubscription&quot;).checked;</span>
<a href="#l3.11"></a><span id="l3.11">     serverSettings.maximumConnectionsNumber = document.getElementById(&quot;imap.maximumConnectionsNumber&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    serverSettings.forceSelect = document.getElementById(&quot;imap.forceSelect&quot;).checked;</span>
<a href="#l3.13"></a><span id="l3.13">     // string prefs</span>
<a href="#l3.14"></a><span id="l3.14">     serverSettings.personalNamespace = document.getElementById(&quot;imap.personalNamespace&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.15"></a><span id="l3.15">     serverSettings.publicNamespace = document.getElementById(&quot;imap.publicNamespace&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.16"></a><span id="l3.16">     serverSettings.serverDirectory = document.getElementById(&quot;imap.serverDirectory&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.17"></a><span id="l3.17">     serverSettings.otherUsersNamespace = document.getElementById(&quot;imap.otherUsersNamespace&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.18"></a><span id="l3.18">     serverSettings.overrideNamespaces = document.getElementById(&quot;imap.overrideNamespaces&quot;).checked;</span>
<a href="#l3.19"></a><span id="l3.19">   }</span>
<a href="#l3.20"></a><span id="l3.20">   else if (serverType == &quot;pop3&quot;)</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -150,17 +149,16 @@ function onAdvanced()</span>
<a href="#l3.22"></a><span id="l3.22">   window.openDialog(&quot;chrome://messenger/content/am-server-advanced.xul&quot;,</span>
<a href="#l3.23"></a><span id="l3.23">                     &quot;_blank&quot;, &quot;chrome,modal,titlebar&quot;, serverSettings);</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25">   if (serverType == &quot;imap&quot;)</span>
<a href="#l3.26"></a><span id="l3.26">   {</span>
<a href="#l3.27"></a><span id="l3.27">     document.getElementById(&quot;imap.dualUseFolders&quot;).checked = serverSettings.dualUseFolders;</span>
<a href="#l3.28"></a><span id="l3.28">     document.getElementById(&quot;imap.usingSubscription&quot;).checked = serverSettings.usingSubscription;</span>
<a href="#l3.29"></a><span id="l3.29">     document.getElementById(&quot;imap.maximumConnectionsNumber&quot;).setAttribute(&quot;value&quot;, serverSettings.maximumConnectionsNumber);</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-    document.getElementById(&quot;imap.forceSelect&quot;).checked = serverSettings.forceSelect;</span>
<a href="#l3.31"></a><span id="l3.31">     // string prefs</span>
<a href="#l3.32"></a><span id="l3.32">     document.getElementById(&quot;imap.personalNamespace&quot;).setAttribute(&quot;value&quot;, serverSettings.personalNamespace);</span>
<a href="#l3.33"></a><span id="l3.33">     document.getElementById(&quot;imap.publicNamespace&quot;).setAttribute(&quot;value&quot;, serverSettings.publicNamespace);</span>
<a href="#l3.34"></a><span id="l3.34">     document.getElementById(&quot;imap.serverDirectory&quot;).setAttribute(&quot;value&quot;, serverSettings.serverDirectory);</span>
<a href="#l3.35"></a><span id="l3.35">     document.getElementById(&quot;imap.otherUsersNamespace&quot;).setAttribute(&quot;value&quot;, serverSettings.otherUsersNamespace);</span>
<a href="#l3.36"></a><span id="l3.36">     document.getElementById(&quot;imap.overrideNamespaces&quot;).checked = serverSettings.overrideNamespaces;</span>
<a href="#l3.37"></a><span id="l3.37">   }</span>
<a href="#l3.38"></a><span id="l3.38">   else if (serverType == &quot;pop3&quot;)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -323,19 +323,16 @@</span>
<a href="#l4.4"></a><span id="l4.4">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.maximumConnectionsNumber&quot;/&gt;</span>
<a href="#l4.5"></a><span id="l4.5">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.personalNamespace&quot;/&gt;</span>
<a href="#l4.6"></a><span id="l4.6">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.publicNamespace&quot;/&gt;</span>
<a href="#l4.7"></a><span id="l4.7">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.otherUsersNamespace&quot;/&gt;</span>
<a href="#l4.8"></a><span id="l4.8">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.serverDirectory&quot;/&gt;</span>
<a href="#l4.9"></a><span id="l4.9">       &lt;checkbox hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.overrideNamespaces&quot;</span>
<a href="#l4.10"></a><span id="l4.10">                 prefattribute=&quot;value&quot;</span>
<a href="#l4.11"></a><span id="l4.11">                 prefstring=&quot;mail.server.%serverkey%.override_namespaces&quot;/&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      &lt;checkbox hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.forceSelect&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                prefattribute=&quot;value&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-                prefstring=&quot;mail.server.%serverkey%.forceSelect&quot;/&gt;</span>
<a href="#l4.15"></a><span id="l4.15">     &lt;/hbox&gt;</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">     &lt;!-- NNTP --&gt;</span>
<a href="#l4.18"></a><span id="l4.18">     &lt;hbox hidefor=&quot;pop3,imap,movemail&quot; align=&quot;center&quot;&gt;</span>
<a href="#l4.19"></a><span id="l4.19">       &lt;checkbox wsm_persist=&quot;true&quot; id=&quot;nntp.notifyOn&quot;</span>
<a href="#l4.20"></a><span id="l4.20">                 label=&quot;&amp;maxMessagesStart.label;&quot;</span>
<a href="#l4.21"></a><span id="l4.21">                 accesskey=&quot;&amp;maxMessagesStart.accesskey;&quot;</span>
<a href="#l4.22"></a><span id="l4.22">                 oncommand=&quot;onCheckItem('nntp.maxArticles', [this.id]);&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/imap/public/nsIImapIncomingServer.idl</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/imap/public/nsIImapIncomingServer.idl</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -20,17 +20,17 @@ interface nsMsgImapDeleteModels</span>
<a href="#l5.4"></a><span id="l5.4">   const long MoveToTrash = 1;   /* delete moves message to the trash */</span>
<a href="#l5.5"></a><span id="l5.5">   const long DeleteNoTrash = 2; /* delete is shift delete - don't create or use trash */</span>
<a href="#l5.6"></a><span id="l5.6"> };</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> [scriptable, uuid(ea6a0765-07b8-40df-924c-9004ed707251)]</span>
<a href="#l5.9"></a><span id="l5.9"> interface nsIImapIncomingServer : nsISupports {</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">   attribute long maximumConnectionsNumber;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  attribute boolean forceSelect;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  attribute ACString forceSelect;</span>
<a href="#l5.14"></a><span id="l5.14">   attribute long timeOutLimits;</span>
<a href="#l5.15"></a><span id="l5.15">   attribute ACString adminUrl;</span>
<a href="#l5.16"></a><span id="l5.16">   attribute ACString serverDirectory;</span>
<a href="#l5.17"></a><span id="l5.17">   /// RFC 2971 ID response stored as a pref</span>
<a href="#l5.18"></a><span id="l5.18">   attribute ACString serverIDPref;</span>
<a href="#l5.19"></a><span id="l5.19">   attribute boolean cleanupInboxOnExit;</span>
<a href="#l5.20"></a><span id="l5.20">   attribute nsMsgImapDeleteModel deleteModel;</span>
<a href="#l5.21"></a><span id="l5.21">   attribute boolean dualUseFolders;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/imap/public/nsIImapServerSink.idl</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/imap/public/nsIImapServerSink.idl</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -159,9 +159,11 @@ interface nsIImapServerSink : nsISupport</span>
<a href="#l6.4"></a><span id="l6.4">   /// remove a connection to the server</span>
<a href="#l6.5"></a><span id="l6.5">   void removeServerConnection(in nsIImapProtocol aProtocol);</span>
<a href="#l6.6"></a><span id="l6.6">   /// is the imap server shutting down?</span>
<a href="#l6.7"></a><span id="l6.7">   readonly attribute boolean serverShuttingDown;</span>
<a href="#l6.8"></a><span id="l6.8">   /// reset the connection for a particular folder</span>
<a href="#l6.9"></a><span id="l6.9">   void resetServerConnection(in ACString aFolderName);</span>
<a href="#l6.10"></a><span id="l6.10">   /// tell the server if listing using lsub command</span>
<a href="#l6.11"></a><span id="l6.11">   void setServerDoingLsub(in boolean aDoingLsub);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+  /// set force select string</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  void SetServerForceSelect(in ACString forceSelect);</span>
<a href="#l6.14"></a><span id="l6.14"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -271,18 +271,18 @@ nsImapIncomingServer::GetMaximumConnecti</span>
<a href="#l7.4"></a><span id="l7.4"> }</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> NS_IMETHODIMP</span>
<a href="#l7.7"></a><span id="l7.7"> nsImapIncomingServer::SetMaximumConnectionsNumber(int32_t aMaxConnections)</span>
<a href="#l7.8"></a><span id="l7.8"> {</span>
<a href="#l7.9"></a><span id="l7.9">   return SetIntValue(&quot;max_cached_connections&quot;, aMaxConnections);</span>
<a href="#l7.10"></a><span id="l7.10"> }</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, ForceSelect,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                        &quot;forceSelect&quot;)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+NS_IMPL_SERVERPREF_STR(nsImapIncomingServer, ForceSelect,</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+                       &quot;force_select&quot;)</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, DualUseFolders,</span>
<a href="#l7.18"></a><span id="l7.18">                         &quot;dual_use_folders&quot;)</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> NS_IMPL_SERVERPREF_STR(nsImapIncomingServer, AdminUrl,</span>
<a href="#l7.21"></a><span id="l7.21">                        &quot;admin_url&quot;)</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23"> NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, CleanupInboxOnExit,</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -3374,8 +3374,14 @@ nsImapIncomingServer::ResetServerConnect</span>
<a href="#l7.25"></a><span id="l7.25">   return ResetConnection(aFolderName);</span>
<a href="#l7.26"></a><span id="l7.26"> }</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28"> NS_IMETHODIMP</span>
<a href="#l7.29"></a><span id="l7.29"> nsImapIncomingServer::SetServerDoingLsub(bool aDoingLsub)</span>
<a href="#l7.30"></a><span id="l7.30"> {</span>
<a href="#l7.31"></a><span id="l7.31">   return SetDoingLsub(aDoingLsub);</span>
<a href="#l7.32"></a><span id="l7.32"> }</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+nsImapIncomingServer::SetServerForceSelect(const nsACString &amp;aForceSelect)</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+{</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+  return SetForceSelect(aForceSelect);</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -316,16 +316,18 @@ static bool gFetchByChunks = true;</span>
<a href="#l8.4"></a><span id="l8.4"> static bool gInitialized = false;</span>
<a href="#l8.5"></a><span id="l8.5"> static bool gHideUnusedNamespaces = true;</span>
<a href="#l8.6"></a><span id="l8.6"> static bool gHideOtherUsersFromList = false;</span>
<a href="#l8.7"></a><span id="l8.7"> static bool gUseEnvelopeCmd = false;</span>
<a href="#l8.8"></a><span id="l8.8"> static bool gUseLiteralPlus = true;</span>
<a href="#l8.9"></a><span id="l8.9"> static bool gExpungeAfterDelete = false;</span>
<a href="#l8.10"></a><span id="l8.10"> static bool gCheckDeletedBeforeExpunge = false; //bug 235004</span>
<a href="#l8.11"></a><span id="l8.11"> static int32_t gResponseTimeout = 60;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+static nsCString gForceSelectDetect;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+static nsTArray&lt;nsCString&gt; gForceSelectServersArray;</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15"> // let delete model control expunging, i.e., don't ever expunge when the</span>
<a href="#l8.16"></a><span id="l8.16"> // user chooses the imap delete model, otherwise, expunge when over the</span>
<a href="#l8.17"></a><span id="l8.17"> // threshhold. This is the normal TB behavior.</span>
<a href="#l8.18"></a><span id="l8.18"> static const int32_t kAutoExpungeDeleteModel = 0;</span>
<a href="#l8.19"></a><span id="l8.19"> // Expunge whenever the folder is opened</span>
<a href="#l8.20"></a><span id="l8.20"> static const int32_t kAutoExpungeAlways = 1;</span>
<a href="#l8.21"></a><span id="l8.21"> // Expunge when over the threshhold, independent of the delete model.</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -360,16 +362,20 @@ nsresult nsImapProtocol::GlobalInitializ</span>
<a href="#l8.23"></a><span id="l8.23">     aPrefBranch-&gt;GetBoolPref(&quot;mail.imap.expunge_after_delete&quot;,</span>
<a href="#l8.24"></a><span id="l8.24">                              &amp;gExpungeAfterDelete);</span>
<a href="#l8.25"></a><span id="l8.25">     aPrefBranch-&gt;GetBoolPref(&quot;mail.imap.check_deleted_before_expunge&quot;,</span>
<a href="#l8.26"></a><span id="l8.26">                              &amp;gCheckDeletedBeforeExpunge);</span>
<a href="#l8.27"></a><span id="l8.27">     aPrefBranch-&gt;GetIntPref(&quot;mail.imap.expunge_option&quot;, &amp;gExpungeOption);</span>
<a href="#l8.28"></a><span id="l8.28">     aPrefBranch-&gt;GetIntPref(&quot;mail.imap.expunge_threshold_number&quot;,</span>
<a href="#l8.29"></a><span id="l8.29">                             &amp;gExpungeThreshold);</span>
<a href="#l8.30"></a><span id="l8.30">     aPrefBranch-&gt;GetIntPref(&quot;mailnews.tcptimeout&quot;, &amp;gResponseTimeout);</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+    aPrefBranch-&gt;GetCharPref(&quot;mail.imap.force_select_detect&quot;,</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+                             getter_Copies(gForceSelectDetect));</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+    ParseString(gForceSelectDetect, ';', gForceSelectServersArray);</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+</span>
<a href="#l8.35"></a><span id="l8.35">     nsCOMPtr&lt;nsIXULAppInfo&gt; appInfo(do_GetService(XULAPPINFO_SERVICE_CONTRACTID));</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">     if (appInfo)</span>
<a href="#l8.38"></a><span id="l8.38">     {</span>
<a href="#l8.39"></a><span id="l8.39">       nsCString appName, appVersion;</span>
<a href="#l8.40"></a><span id="l8.40">       appInfo-&gt;GetName(appName);</span>
<a href="#l8.41"></a><span id="l8.41">       appInfo-&gt;GetVersion(appVersion);</span>
<a href="#l8.42"></a><span id="l8.42">       PL_strncpyz(gAppName, appName.get(), kAppBufSize);</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineat">@@ -501,16 +507,17 @@ nsImapProtocol::nsImapProtocol() : nsMsg</span>
<a href="#l8.44"></a><span id="l8.44">   m_autoUnsubscribe = true;</span>
<a href="#l8.45"></a><span id="l8.45">   m_autoSubscribeOnOpen = true;</span>
<a href="#l8.46"></a><span id="l8.46">   m_deletableChildren = nullptr;</span>
<a href="#l8.47"></a><span id="l8.47"> </span>
<a href="#l8.48"></a><span id="l8.48">   mFolderLastModSeq = 0;</span>
<a href="#l8.49"></a><span id="l8.49"> </span>
<a href="#l8.50"></a><span id="l8.50">   Configure(gTooFastTime, gIdealTime, gChunkAddSize, gChunkSize,</span>
<a href="#l8.51"></a><span id="l8.51">                     gChunkThreshold, gFetchByChunks);</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+  m_forceSelect = false;</span>
<a href="#l8.53"></a><span id="l8.53"> }</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55"> nsresult nsImapProtocol::Configure(int32_t TooFastTime, int32_t IdealTime,</span>
<a href="#l8.56"></a><span id="l8.56">                   int32_t ChunkAddSize, int32_t ChunkSize, int32_t ChunkThreshold,</span>
<a href="#l8.57"></a><span id="l8.57">                   bool FetchByChunks)</span>
<a href="#l8.58"></a><span id="l8.58"> {</span>
<a href="#l8.59"></a><span id="l8.59">   m_tooFastTime = TooFastTime;    // secs we read too little too fast</span>
<a href="#l8.60"></a><span id="l8.60">   m_idealTime = IdealTime;    // secs we read enough in good time</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineat">@@ -535,17 +542,17 @@ nsImapProtocol::Initialize(nsIImapHostSe</span>
<a href="#l8.62"></a><span id="l8.62">   nsresult rv = m_downloadLineCache-&gt;GrowBuffer(kDownLoadCacheSize);</span>
<a href="#l8.63"></a><span id="l8.63">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.64"></a><span id="l8.64"> </span>
<a href="#l8.65"></a><span id="l8.65">   m_flagState = new nsImapFlagAndUidState(kImapFlagAndUidStateSize);</span>
<a href="#l8.66"></a><span id="l8.66">   if (!m_flagState)</span>
<a href="#l8.67"></a><span id="l8.67">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l8.68"></a><span id="l8.68"> </span>
<a href="#l8.69"></a><span id="l8.69">   aServer-&gt;GetUseIdle(&amp;m_useIdle);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-  aServer-&gt;GetForceSelect(&amp;m_forceSelect);</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+  aServer-&gt;GetForceSelect(m_forceSelectValue);</span>
<a href="#l8.72"></a><span id="l8.72">   aServer-&gt;GetUseCondStore(&amp;m_useCondStore);</span>
<a href="#l8.73"></a><span id="l8.73">   aServer-&gt;GetUseCompressDeflate(&amp;m_useCompressDeflate);</span>
<a href="#l8.74"></a><span id="l8.74">   NS_ADDREF(m_flagState);</span>
<a href="#l8.75"></a><span id="l8.75"> </span>
<a href="#l8.76"></a><span id="l8.76">   m_hostSessionList = aHostSessionList; // no ref count...host session list has life time &gt; connection</span>
<a href="#l8.77"></a><span id="l8.77">   m_parser.SetHostSessionList(aHostSessionList);</span>
<a href="#l8.78"></a><span id="l8.78">   m_parser.SetFlagState(m_flagState);</span>
<a href="#l8.79"></a><span id="l8.79"> </span>
<a href="#l8.80"></a><span id="l8.80" class="difflineat">@@ -7767,16 +7774,60 @@ bool nsImapProtocol::GetListSubscribedIs</span>
<a href="#l8.81"></a><span id="l8.81">     Version eightZeroThree(&quot;8.0.3_&quot;);</span>
<a href="#l8.82"></a><span id="l8.82">     if ((serverVersion &lt; sevenTwoThree) ||</span>
<a href="#l8.83"></a><span id="l8.83">         ((serverVersion &gt;= eightZeroZero) &amp;&amp; (serverVersion &lt; eightZeroThree)))</span>
<a href="#l8.84"></a><span id="l8.84">       return true;</span>
<a href="#l8.85"></a><span id="l8.85">   }</span>
<a href="#l8.86"></a><span id="l8.86">   return false;</span>
<a href="#l8.87"></a><span id="l8.87"> }</span>
<a href="#l8.88"></a><span id="l8.88"> </span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+// This identifies servers that require an extra imap SELECT to detect new</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+// email in a mailbox. Servers requiring this are found by comparing their</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineplus">+// ID string, returned with imap ID command, to strings entered in</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineplus">+// mail.imap.force_select_detect. Only openwave servers used by</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineplus">+// Charter/Spectrum ISP returning an ID containing the strings &quot;&quot;name&quot; &quot;Email Mx&quot;&quot;</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineplus">+// and &quot;&quot;vendor&quot; &quot;Openwave Messaging&quot;&quot; are now known to have this issue. The</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineplus">+// compared strings can be modified with the config editor if necessary</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineplus">+// (e.g., a &quot;version&quot; substring could be added). Also, additional servers</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineplus">+// having a different set of strings can be added if ever needed.</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineplus">+// The mail.imap.force_select_detect uses semicolon delimiter between</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineplus">+// servers and within a server substrings to compare are comma delimited.</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineplus">+// This example force_select_detect value shows how two servers types</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineplus">+// could be detected:</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineplus">+// &quot;name&quot; &quot;Email Mx&quot;,&quot;vendor&quot; &quot;Openwave Messaging&quot;;&quot;vendor&quot; &quot;Yahoo! Inc.&quot;,&quot;name&quot; &quot;Y!IMAP&quot;;</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineplus">+bool nsImapProtocol::IsExtraSelectNeeded()</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+{</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineplus">+  bool retVal;</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineplus">+  for (uint32_t i = 0; i &lt; gForceSelectServersArray.Length(); i++)</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineplus">+  {</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+    retVal = true;</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineplus">+    nsTArray&lt;nsCString&gt; forceSelectStringsArray;</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineplus">+    ParseString(gForceSelectServersArray[i], ',', forceSelectStringsArray);</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineplus">+    for (uint32_t j = 0; j &lt; forceSelectStringsArray.Length(); j++)</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineplus">+    {</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineplus">+      // Each substring within the server string must be contained in ID string.</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineplus">+      // First un-escape any comma (%2c) or semicolon (%3b) within the substring.</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineplus">+      nsAutoCString unescapedString;</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineplus">+      MsgUnescapeString(forceSelectStringsArray[j], 0, unescapedString);</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineplus">+      if (GetServerStateParser().GetServerID()</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+          .Find(unescapedString, CaseInsensitiveCompare) == kNotFound)</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineplus">+      {</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineplus">+        retVal = false;</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineplus">+        break;</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineplus">+      }</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineplus">+    }</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineplus">+    // Matches found for all substrings for the server.</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineplus">+    if (retVal)</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineplus">+      return true;</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineplus">+  }</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineplus">+</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineplus">+  // If reached, no substrings match for any server.</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineplus">+  return false;</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineplus">+}</span>
<a href="#l8.132"></a><span id="l8.132" class="difflineplus">+</span>
<a href="#l8.133"></a><span id="l8.133"> void nsImapProtocol::Lsub(const char *mailboxPattern, bool addDirectoryIfNecessary)</span>
<a href="#l8.134"></a><span id="l8.134"> {</span>
<a href="#l8.135"></a><span id="l8.135">   ProgressEventFunctionUsingName(&quot;imapStatusLookingForMailbox&quot;);</span>
<a href="#l8.136"></a><span id="l8.136"> </span>
<a href="#l8.137"></a><span id="l8.137">   IncrementCommandTagNumber();</span>
<a href="#l8.138"></a><span id="l8.138"> </span>
<a href="#l8.139"></a><span id="l8.139">   char *boxnameWithOnlineDirectory = nullptr;</span>
<a href="#l8.140"></a><span id="l8.140">   if (addDirectoryIfNecessary)</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineat">@@ -8194,22 +8245,88 @@ void nsImapProtocol::ProcessAfterAuthent</span>
<a href="#l8.142"></a><span id="l8.142">   // backend.  If we enable compression early the proxy</span>
<a href="#l8.143"></a><span id="l8.143">   // will be confused.</span>
<a href="#l8.144"></a><span id="l8.144">   if (UseCompressDeflate())</span>
<a href="#l8.145"></a><span id="l8.145">     StartCompressDeflate();</span>
<a href="#l8.146"></a><span id="l8.146"> </span>
<a href="#l8.147"></a><span id="l8.147">   if ((GetServerStateParser().GetCapabilityFlag() &amp; kHasEnableCapability) &amp;&amp;</span>
<a href="#l8.148"></a><span id="l8.148">        UseCondStore())</span>
<a href="#l8.149"></a><span id="l8.149">     EnableCondStore();</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineplus">+</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineplus">+  bool haveIdResponse = false;</span>
<a href="#l8.152"></a><span id="l8.152">   if ((GetServerStateParser().GetCapabilityFlag() &amp; kHasIDCapability) &amp;&amp;</span>
<a href="#l8.153"></a><span id="l8.153">        m_sendID)</span>
<a href="#l8.154"></a><span id="l8.154">   {</span>
<a href="#l8.155"></a><span id="l8.155">     ID();</span>
<a href="#l8.156"></a><span id="l8.156">     if (m_imapServerSink &amp;&amp; !GetServerStateParser().GetServerID().IsEmpty())</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineplus">+    {</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineplus">+      haveIdResponse = true;</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineplus">+      // Determine value for m_forceSelect based on config editor</span>
<a href="#l8.160"></a><span id="l8.160" class="difflineplus">+      // entries and comparison to imap ID string returned by the server.</span>
<a href="#l8.161"></a><span id="l8.161">       m_imapServerSink-&gt;SetServerID(GetServerStateParser().GetServerID());</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineplus">+      switch (m_forceSelectValue.get()[0])</span>
<a href="#l8.163"></a><span id="l8.163" class="difflineplus">+      {</span>
<a href="#l8.164"></a><span id="l8.164" class="difflineplus">+      // Yes: Set to always force even if imap server doesn't need it.</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineplus">+      case 'y':</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineplus">+      case 'Y':</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineplus">+        m_forceSelect = true;</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineplus">+        break;</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineplus">+</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineplus">+      // No: Set to never force a select for this imap server.</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineplus">+      case 'n':</span>
<a href="#l8.172"></a><span id="l8.172" class="difflineplus">+      case 'N':</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineplus">+        m_forceSelect = false;</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineplus">+        break;</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineplus">+</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineplus">+      // Auto: Set to force only if imap server requires it.</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineplus">+      default:</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineplus">+        nsAutoCString statusString;</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineplus">+        m_forceSelect = IsExtraSelectNeeded();</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineplus">+        // Setting to &quot;yes-auto&quot; or &quot;no-auto&quot; avoids doing redundant calls to</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineplus">+        // IsExtraSelectNeeded() on subsequent ID() occurrences. It also</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineplus">+        // provides feedback to the user regarding the detection status.</span>
<a href="#l8.183"></a><span id="l8.183" class="difflineplus">+        if (m_forceSelect)</span>
<a href="#l8.184"></a><span id="l8.184" class="difflineplus">+        {</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineplus">+          // Set preference value to &quot;yes-auto&quot;.</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineplus">+          statusString.Assign(&quot;yes-auto&quot;);</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineplus">+        }</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineplus">+        else</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineplus">+        {</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineplus">+          // Set preference value to &quot;no-auto&quot;.</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineplus">+          statusString.Assign(&quot;no-auto&quot;);</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineplus">+        }</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineplus">+        m_imapServerSink-&gt;SetServerForceSelect(statusString);</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineplus">+        break;</span>
<a href="#l8.195"></a><span id="l8.195" class="difflineplus">+      }</span>
<a href="#l8.196"></a><span id="l8.196" class="difflineplus">+    }</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineplus">+  }</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineplus">+</span>
<a href="#l8.199"></a><span id="l8.199" class="difflineplus">+  // If no ID capability or empty ID response, user may still want to</span>
<a href="#l8.200"></a><span id="l8.200" class="difflineplus">+  // change &quot;force select&quot;.</span>
<a href="#l8.201"></a><span id="l8.201" class="difflineplus">+  if (!haveIdResponse)</span>
<a href="#l8.202"></a><span id="l8.202" class="difflineplus">+  {</span>
<a href="#l8.203"></a><span id="l8.203" class="difflineplus">+    switch (m_forceSelectValue.get()[0])</span>
<a href="#l8.204"></a><span id="l8.204" class="difflineplus">+    {</span>
<a href="#l8.205"></a><span id="l8.205" class="difflineplus">+    case 'a':</span>
<a href="#l8.206"></a><span id="l8.206" class="difflineplus">+      {</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineplus">+        // If default &quot;auto&quot;, set to &quot;no-auto&quot; so visible in config editor</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineplus">+        // and set/keep m_forceSelect false.</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineplus">+        nsAutoCString statusString;</span>
<a href="#l8.210"></a><span id="l8.210" class="difflineplus">+        statusString.Assign(&quot;no-auto&quot;);</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineplus">+        m_imapServerSink-&gt;SetServerForceSelect(statusString);</span>
<a href="#l8.212"></a><span id="l8.212" class="difflineplus">+        m_forceSelect = false;</span>
<a href="#l8.213"></a><span id="l8.213" class="difflineplus">+      }</span>
<a href="#l8.214"></a><span id="l8.214" class="difflineplus">+      break;</span>
<a href="#l8.215"></a><span id="l8.215" class="difflineplus">+    case 'y':</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineplus">+    case 'Y':</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineplus">+      m_forceSelect = true;</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineplus">+      break;</span>
<a href="#l8.219"></a><span id="l8.219" class="difflineplus">+    default:</span>
<a href="#l8.220"></a><span id="l8.220" class="difflineplus">+      m_forceSelect = false;</span>
<a href="#l8.221"></a><span id="l8.221" class="difflineplus">+    }</span>
<a href="#l8.222"></a><span id="l8.222">   }</span>
<a href="#l8.223"></a><span id="l8.223"> }</span>
<a href="#l8.224"></a><span id="l8.224"> </span>
<a href="#l8.225"></a><span id="l8.225"> void nsImapProtocol::SetupMessageFlagsString(nsCString&amp; flagString,</span>
<a href="#l8.226"></a><span id="l8.226">                                              imapMessageFlagsType flags,</span>
<a href="#l8.227"></a><span id="l8.227">                                              uint16_t userFlags)</span>
<a href="#l8.228"></a><span id="l8.228"> {</span>
<a href="#l8.229"></a><span id="l8.229">     if (flags &amp; kImapMsgSeenFlag)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -551,16 +551,17 @@ private:</span>
<a href="#l9.4"></a><span id="l9.4">   bool FolderNeedsACLInitialized(const char *folderName);</span>
<a href="#l9.5"></a><span id="l9.5">   void DiscoverMailboxList();</span>
<a href="#l9.6"></a><span id="l9.6">   void DiscoverAllAndSubscribedBoxes();</span>
<a href="#l9.7"></a><span id="l9.7">   void MailboxDiscoveryFinished();</span>
<a href="#l9.8"></a><span id="l9.8">   void NthLevelChildList(const char *onlineMailboxPrefix, int32_t depth);</span>
<a href="#l9.9"></a><span id="l9.9">   // LIST SUBSCRIBED command (from RFC 5258) crashes some servers. so we need to</span>
<a href="#l9.10"></a><span id="l9.10">   // identify those servers</span>
<a href="#l9.11"></a><span id="l9.11">   bool GetListSubscribedIsBrokenOnServer();</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+  bool IsExtraSelectNeeded();</span>
<a href="#l9.13"></a><span id="l9.13">   void Lsub(const char *mailboxPattern, bool addDirectoryIfNecessary);</span>
<a href="#l9.14"></a><span id="l9.14">   void List(const char *mailboxPattern, bool addDirectoryIfNecessary,</span>
<a href="#l9.15"></a><span id="l9.15">             bool useXLIST = false);</span>
<a href="#l9.16"></a><span id="l9.16">   void Subscribe(const char *mailboxName);</span>
<a href="#l9.17"></a><span id="l9.17">   void Unsubscribe(const char *mailboxName);</span>
<a href="#l9.18"></a><span id="l9.18">   void Idle();</span>
<a href="#l9.19"></a><span id="l9.19">   void EndIdle(bool waitForResponse = true);</span>
<a href="#l9.20"></a><span id="l9.20">   // Some imap servers include the mailboxName following the dir-separator in the list of</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineat">@@ -658,16 +659,17 @@ private:</span>
<a href="#l9.22"></a><span id="l9.22">   bool m_needNoop;</span>
<a href="#l9.23"></a><span id="l9.23">   bool m_idle;</span>
<a href="#l9.24"></a><span id="l9.24">   bool m_useIdle;</span>
<a href="#l9.25"></a><span id="l9.25">   int32_t m_noopCount;</span>
<a href="#l9.26"></a><span id="l9.26">   bool    m_autoSubscribe, m_autoUnsubscribe, m_autoSubscribeOnOpen;</span>
<a href="#l9.27"></a><span id="l9.27">   bool m_closeNeededBeforeSelect;</span>
<a href="#l9.28"></a><span id="l9.28">   bool m_retryUrlOnError;</span>
<a href="#l9.29"></a><span id="l9.29">   bool m_preferPlainText;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+  nsCString m_forceSelectValue;</span>
<a href="#l9.31"></a><span id="l9.31">   bool m_forceSelect;</span>
<a href="#l9.32"></a><span id="l9.32"> </span>
<a href="#l9.33"></a><span id="l9.33">   int32_t m_uidValidity; // stored uid validity for the selected folder.</span>
<a href="#l9.34"></a><span id="l9.34"> </span>
<a href="#l9.35"></a><span id="l9.35">   enum EMailboxHierarchyNameState {</span>
<a href="#l9.36"></a><span id="l9.36">     kNoOperationInProgress,</span>
<a href="#l9.37"></a><span id="l9.37">       kDiscoverBaseFolderInProgress,</span>
<a href="#l9.38"></a><span id="l9.38">       kDiscoverTrashFolderInProgress,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -450,16 +450,17 @@ NS_SYNCRUNNABLEMETHOD1(ImapServerSink, G</span>
<a href="#l10.4"></a><span id="l10.4"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, UpdateTrySTARTTLSPref, bool)</span>
<a href="#l10.5"></a><span id="l10.5"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, GetOriginalUsername, nsACString &amp;)</span>
<a href="#l10.6"></a><span id="l10.6"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, GetServerKey, nsACString &amp;)</span>
<a href="#l10.7"></a><span id="l10.7"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, GetServerPassword, nsACString &amp;)</span>
<a href="#l10.8"></a><span id="l10.8"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, RemoveServerConnection, nsIImapProtocol *)</span>
<a href="#l10.9"></a><span id="l10.9"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, GetServerShuttingDown, bool *)</span>
<a href="#l10.10"></a><span id="l10.10"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, ResetServerConnection, const nsACString &amp;)</span>
<a href="#l10.11"></a><span id="l10.11"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, SetServerDoingLsub, bool)</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+NS_SYNCRUNNABLEMETHOD1(ImapServerSink, SetServerForceSelect, const nsACString &amp;)</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15"> namespace mozilla {</span>
<a href="#l10.16"></a><span id="l10.16"> namespace mailnews {</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> NS_IMPL_ISUPPORTS(OAuth2ThreadHelper, msgIOAuth2ModuleListener)</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> OAuth2ThreadHelper::OAuth2ThreadHelper(nsIMsgIncomingServer *aServer)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/mailnews.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/mailnews.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -495,21 +495,35 @@ pref(&quot;mail.server.default.serverFilterNa</span>
<a href="#l11.4"></a><span id="l11.4"> pref(&quot;mail.server.default.serverFilterTrustFlags&quot;, 1); // 1 == trust positives, 2 == trust negatives, 3 == trust both</span>
<a href="#l11.5"></a><span id="l11.5"> pref(&quot;mail.server.default.purgeSpam&quot;, false);</span>
<a href="#l11.6"></a><span id="l11.6"> pref(&quot;mail.server.default.purgeSpamInterval&quot;, 14); // 14 days</span>
<a href="#l11.7"></a><span id="l11.7"> pref(&quot;mail.server.default.check_all_folders_for_new&quot;, false);</span>
<a href="#l11.8"></a><span id="l11.8"> // should we inhibit whitelisting of the email addresses for a server's identities?</span>
<a href="#l11.9"></a><span id="l11.9"> pref(&quot;mail.server.default.inhibitWhiteListingIdentityUser&quot;, true);</span>
<a href="#l11.10"></a><span id="l11.10"> // should we inhibit whitelisting of the domain for a server's identities?</span>
<a href="#l11.11"></a><span id="l11.11"> pref(&quot;mail.server.default.inhibitWhiteListingIdentityDomain&quot;, false);</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-// When forceSelect is true, sends extra/redundant imap SELECT when checking for</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-// new mail. Needed by some imap servers. Also, if server does not support IDLE,</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-// this can help insure messages are marked as &quot;read&quot; after being read in other</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-// email clients.</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-pref(&quot;mail.server.default.forceSelect&quot;, false);</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+// When force_select is &quot;auto&quot; the ID response for the server will be compared to</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+// force_select_detect below and, if they compare, an extra imap select will</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+// be sent when checking for new mail. If force_select is &quot;no&quot;, the extra</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+// select will never occur, and, if &quot;yes&quot; it will always occur when checking for</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+// new email (both regardless of the ID response string).</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+// The extra select insures that new emails are automatically detected by servers</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+// requiring it. Also, if a server does not support IDLE, setting this to &quot;yes&quot;</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+// can insure messages are marked as &quot;read&quot; after being read in other email clients.</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+pref(&quot;mail.server.default.force_select&quot;, &quot;auto&quot;);</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+// Specify imap ID response substrings that must occur to cause the extra/forced</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+// imap select for server(s).  Substrings are comma separated within a given server</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+// (all substrings within a server must be found in the ID response string) and</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+// servers are semicolon separated. Currently only 1 server type is known</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+// to require the extra select -- Openwave server used by Charter-Spectrum ISP.</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+pref(&quot;mail.imap.force_select_detect&quot;, &quot;\&quot;name\&quot; \&quot;Email Mx\&quot;,\&quot;vendor\&quot; \&quot;Openwave Messaging\&quot;&quot;);</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+// Example if ever another server requires the extra select (ID substrings from Yahoo! added):</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+//pref(&quot;mail.imap.force_select_detect&quot;, &quot;\&quot;name\&quot; \&quot;Email Mx\&quot;,\&quot;vendor\&quot; \&quot;Openwave Messaging\&quot;;\&quot;vendor\&quot; \&quot;Yahoo! Inc.\&quot;,\&quot;name\&quot; \&quot;Y!IMAP\&quot;;&quot;);</span>
<a href="#l11.36"></a><span id="l11.36"> </span>
<a href="#l11.37"></a><span id="l11.37"> // to activate auto-sync feature (preemptive message download for imap) by default</span>
<a href="#l11.38"></a><span id="l11.38"> pref(&quot;mail.server.default.autosync_offline_stores&quot;,true);</span>
<a href="#l11.39"></a><span id="l11.39"> pref(&quot;mail.server.default.offline_download&quot;,true);</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41"> // -1 means no limit, no purging of offline stores.</span>
<a href="#l11.42"></a><span id="l11.42"> pref(&quot;mail.server.default.autosync_max_age_days&quot;, -1);</span>
<a href="#l11.43"></a><span id="l11.43"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -7,19 +7,16 @@</span>
<a href="#l12.4"></a><span id="l12.4"> &lt;!ENTITY serverDirectory.label &quot;IMAP server directory:&quot;&gt;</span>
<a href="#l12.5"></a><span id="l12.5"> &lt;!ENTITY serverDirectory.accesskey &quot;d&quot;&gt;</span>
<a href="#l12.6"></a><span id="l12.6"> &lt;!ENTITY usingSubscription.label &quot;Show only subscribed folders&quot;&gt;</span>
<a href="#l12.7"></a><span id="l12.7"> &lt;!ENTITY usingSubscription.accesskey &quot;w&quot;&gt;</span>
<a href="#l12.8"></a><span id="l12.8"> &lt;!ENTITY dualUseFolders.label &quot;Server supports folders that contain sub-folders and messages&quot;&gt;</span>
<a href="#l12.9"></a><span id="l12.9"> &lt;!ENTITY dualUseFolders.accesskey &quot;f&quot;&gt;</span>
<a href="#l12.10"></a><span id="l12.10"> &lt;!ENTITY maximumConnectionsNumber.label &quot;Maximum number of server connections to cache&quot;&gt;</span>
<a href="#l12.11"></a><span id="l12.11"> &lt;!ENTITY maximumConnectionsNumber.accesskey &quot;M&quot;&gt;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-&lt;!ENTITY forceSelect.label &quot;Send IMAP select to server when checking for new mail&quot;&gt;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-&lt;!ENTITY forceSelect.tooltip &quot;Some servers need an additional IMAP select so new email is reliably received, or is shown as read after it has been read on another device. Selecting this option will cause some increased network traffic.&quot;&gt;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-&lt;!ENTITY forceSelect.accesskey &quot;S&quot;&gt;</span>
<a href="#l12.15"></a><span id="l12.15"> &lt;!-- LOCALIZATION NOTE (namespaceDesc.label): DONT_TRANSLATE &quot;IMAP&quot; --&gt;</span>
<a href="#l12.16"></a><span id="l12.16"> &lt;!ENTITY namespaceDesc.label &quot;These preferences specify the namespaces on your IMAP server&quot;&gt;</span>
<a href="#l12.17"></a><span id="l12.17"> &lt;!ENTITY personalNamespace.label &quot;Personal namespace:&quot;&gt;</span>
<a href="#l12.18"></a><span id="l12.18"> &lt;!ENTITY personalNamespace.accesskey &quot;P&quot;&gt;</span>
<a href="#l12.19"></a><span id="l12.19"> &lt;!ENTITY publicNamespace.label &quot;Public (shared):&quot;&gt;</span>
<a href="#l12.20"></a><span id="l12.20"> &lt;!ENTITY publicNamespace.accesskey &quot;u&quot;&gt;</span>
<a href="#l12.21"></a><span id="l12.21"> &lt;!ENTITY otherUsersNamespace.label &quot;Other Users:&quot;&gt;</span>
<a href="#l12.22"></a><span id="l12.22"> &lt;!ENTITY otherUsersNamespace.accesskey &quot;O&quot;&gt;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

