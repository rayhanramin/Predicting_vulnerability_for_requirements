<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29667:b987d3619e0c7b358bce18acdd18a0bc0c0ef947</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b987d3619e0c7b358bce18acdd18a0bc0c0ef947" />
<meta property="og:url" content="/comm-central/rev/b987d3619e0c7b358bce18acdd18a0bc0c0ef947" />
<meta property="og:description" content="Port bug 1641245 - Make string comparators not virtual. rs=bustage-fix" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b987d3619e0c7b358bce18acdd18a0bc0c0ef947 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b987d3619e0c7b358bce18acdd18a0bc0c0ef947">shortlog</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b987d3619e0c7b358bce18acdd18a0bc0c0ef947">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947">files</a> |
changeset |
<a href="/comm-central/raw-rev/b987d3619e0c7b358bce18acdd18a0bc0c0ef947">raw</a>  | <a href="/comm-central/archive/b987d3619e0c7b358bce18acdd18a0bc0c0ef947.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1641245">bug 1641245</a> - Make string comparators not virtual. rs=bustage-fix
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 28 May 2020 16:11:57 +1200</td></tr>

<tr>
 <td>changeset 29667</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b987d3619e0c7b358bce18acdd18a0bc0c0ef947">b987d3619e0c7b358bce18acdd18a0bc0c0ef947</a></td>
</tr>



<tr>
<td>parent 29666</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f9483cb3c96a2a0618bc2e06ce3bedde451655ed">f9483cb3c96a2a0618bc2e06ce3bedde451655ed</a>
</td>
</tr>

<tr>
<td>child 29668</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c89c7c44e8a3f335bc1e7c7ae8220d075b01c4cc">c89c7c44e8a3f335bc1e7c7ae8220d075b01c4cc</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b987d3619e0c7b358bce18acdd18a0bc0c0ef947">17481</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Thu, 28 May 2020 05:13:38 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@c89c7c44e8a3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c89c7c44e8a3f335bc1e7c7ae8220d075b01c4cc">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c89c7c44e8a3f335bc1e7c7ae8220d075b01c4cc&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c89c7c44e8a3f335bc1e7c7ae8220d075b01c4cc&newProject=comm-central&newRevision=b987d3619e0c7b358bce18acdd18a0bc0c0ef947&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c89c7c44e8a3f335bc1e7c7ae8220d075b01c4cc&newProject=comm-central&newRevision=b987d3619e0c7b358bce18acdd18a0bc0c0ef947&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c89c7c44e8a3f335bc1e7c7ae8220d075b01c4cc&newProject=comm-central&newRevision=b987d3619e0c7b358bce18acdd18a0bc0c0ef947&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bustage-fix%29&revcount=50">bustage-fix</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1641245">1641245</a></td></tr>




</table></div>

<div class="page_body description">Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1641245">bug 1641245</a> - Make string comparators not virtual. rs=bustage-fix</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/ldap/xpcom/src/nsLDAPURL.cpp">ldap/xpcom/src/nsLDAPURL.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/ldap/xpcom/src/nsLDAPURL.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/ldap/xpcom/src/nsLDAPURL.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/ldap/xpcom/src/nsLDAPURL.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/ldap/xpcom/src/nsLDAPURL.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/ldap/xpcom/src/nsLDAPURL.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mail/components/shell/nsWindowsShellService.cpp">mail/components/shell/nsWindowsShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mail/components/shell/nsWindowsShellService.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mail/components/shell/nsWindowsShellService.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mail/components/shell/nsWindowsShellService.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mail/components/shell/nsWindowsShellService.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mail/components/shell/nsWindowsShellService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbCardProperty.cpp">mailnews/addrbook/src/nsAbCardProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbCardProperty.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbCardProperty.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbCardProperty.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbCardProperty.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbCardProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">mailnews/addrbook/src/nsAbDirectoryQuery.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbOSXDirectory.mm">mailnews/addrbook/src/nsAbOSXDirectory.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbOSXDirectory.mm">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbOSXDirectory.mm">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbOSXDirectory.mm">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbOSXDirectory.mm">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/addrbook/src/nsAbOSXDirectory.mm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgFilterList.cpp">mailnews/base/search/src/nsMsgFilterList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgFilterList.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgFilterList.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgFilterList.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgFilterList.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgFilterList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgI18N.cpp">mailnews/base/util/nsMsgI18N.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgI18N.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgI18N.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgI18N.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgI18N.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgI18N.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgAttachmentHandler.cpp">mailnews/compose/src/nsMsgAttachmentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgAttachmentHandler.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgAttachmentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgAttachmentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgAttachmentHandler.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgAttachmentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompUtils.cpp">mailnews/compose/src/nsMsgCompUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompUtils.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompUtils.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompUtils.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompUtils.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpServer.cpp">mailnews/compose/src/nsSmtpServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpServer.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpServer.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpServer.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpServer.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpService.cpp">mailnews/compose/src/nsSmtpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpService.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpService.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpService.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpService.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/compose/src/nsSmtpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/db/msgdb/src/nsMailDatabase.cpp">mailnews/db/msgdb/src/nsMailDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/db/msgdb/src/nsMailDatabase.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/db/msgdb/src/nsMailDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/db/msgdb/src/nsMailDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/db/msgdb/src/nsMailDatabase.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/db/msgdb/src/nsMailDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsIMAPHostSessionList.cpp">mailnews/imap/src/nsIMAPHostSessionList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsIMAPHostSessionList.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsIMAPHostSessionList.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsIMAPHostSessionList.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsIMAPHostSessionList.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsIMAPHostSessionList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapServerResponseParser.cpp">mailnews/imap/src/nsImapServerResponseParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapServerResponseParser.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapServerResponseParser.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapServerResponseParser.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapServerResponseParser.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/imap/src/nsImapServerResponseParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/import/outlook/src/MapiApi.cpp">mailnews/import/outlook/src/MapiApi.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/import/outlook/src/MapiApi.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/import/outlook/src/MapiApi.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/import/outlook/src/MapiApi.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/import/outlook/src/MapiApi.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/import/outlook/src/MapiApi.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/intl/nsCharsetAlias.cpp">mailnews/intl/nsCharsetAlias.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/intl/nsCharsetAlias.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/intl/nsCharsetAlias.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/intl/nsCharsetAlias.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/intl/nsCharsetAlias.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/intl/nsCharsetAlias.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsPop3Sink.cpp">mailnews/local/src/nsPop3Sink.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsPop3Sink.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsPop3Sink.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsPop3Sink.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsPop3Sink.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/local/src/nsPop3Sink.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/mime/src/mimemoz2.cpp">mailnews/mime/src/mimemoz2.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/mime/src/mimemoz2.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/mime/src/mimemoz2.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/mime/src/mimemoz2.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/mime/src/mimemoz2.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/mime/src/mimemoz2.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNNTPProtocol.cpp">mailnews/news/src/nsNNTPProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNNTPProtocol.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNNTPProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNNTPProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNNTPProtocol.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNNTPProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/b987d3619e0c7b358bce18acdd18a0bc0c0ef947/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPURL.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPURL.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -157,20 +157,19 @@ NS_IMETHODIMP nsLDAPURL::GetScheme(nsACS</span>
<a href="#l1.4"></a><span id="l1.4">   if (!mBaseURL) return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">   return mBaseURL-&gt;GetScheme(_retval);</span>
<a href="#l1.7"></a><span id="l1.7"> }</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> nsresult nsLDAPURL::SetScheme(const nsACString &amp;aScheme) {</span>
<a href="#l1.10"></a><span id="l1.10">   if (!mBaseURL) return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  if (aScheme.Equals(LDAP_SCHEME, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  if (aScheme.Equals(LDAP_SCHEME, nsCaseInsensitiveCStringComparator))</span>
<a href="#l1.14"></a><span id="l1.14">     mOptions &amp;= !OPT_SECURE;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-  else if (aScheme.Equals(LDAP_SSL_SCHEME,</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-                          nsCaseInsensitiveCStringComparator()))</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+  else if (aScheme.Equals(LDAP_SSL_SCHEME, nsCaseInsensitiveCStringComparator))</span>
<a href="#l1.18"></a><span id="l1.18">     mOptions |= OPT_SECURE;</span>
<a href="#l1.19"></a><span id="l1.19">   else</span>
<a href="#l1.20"></a><span id="l1.20">     return NS_ERROR_MALFORMED_URI;</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">   return NS_MutateURI(mBaseURL).SetScheme(aScheme).Finalize(mBaseURL);</span>
<a href="#l1.23"></a><span id="l1.23"> }</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25"> NS_IMETHODIMP</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineat">@@ -444,17 +443,17 @@ NS_IMETHODIMP nsLDAPURL::RemoveAttribute</span>
<a href="#l1.27"></a><span id="l1.27">   if (!mBaseURL) return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29">   if (mAttributes.IsEmpty()) return NS_OK;</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31">   nsAutoCString findAttribute(&quot;,&quot;);</span>
<a href="#l1.32"></a><span id="l1.32">   findAttribute.Append(aAttribute);</span>
<a href="#l1.33"></a><span id="l1.33">   findAttribute.Append(',');</span>
<a href="#l1.34"></a><span id="l1.34"> </span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-  if (mAttributes.Equals(findAttribute, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+  if (mAttributes.Equals(findAttribute, nsCaseInsensitiveCStringComparator))</span>
<a href="#l1.37"></a><span id="l1.37">     mAttributes.Truncate();</span>
<a href="#l1.38"></a><span id="l1.38">   else {</span>
<a href="#l1.39"></a><span id="l1.39">     int32_t pos = mAttributes.Find(findAttribute, /* ignoreCase = */ true);</span>
<a href="#l1.40"></a><span id="l1.40">     if (pos == -1) return NS_OK;</span>
<a href="#l1.41"></a><span id="l1.41"> </span>
<a href="#l1.42"></a><span id="l1.42">     mAttributes.Cut(pos, findAttribute.Length() - 1);</span>
<a href="#l1.43"></a><span id="l1.43">   }</span>
<a href="#l1.44"></a><span id="l1.44"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/shell/nsWindowsShellService.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/shell/nsWindowsShellService.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -253,17 +253,17 @@ bool nsWindowsShellService::TestForDefau</span>
<a href="#l2.4"></a><span id="l2.4">     }</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6">     DWORD len = sizeof currValue;</span>
<a href="#l2.7"></a><span id="l2.7">     DWORD result = ::RegQueryValueExW(theKey, value.get(), NULL, NULL,</span>
<a href="#l2.8"></a><span id="l2.8">                                       (LPBYTE)currValue, &amp;len);</span>
<a href="#l2.9"></a><span id="l2.9">     // Close the key we opened.</span>
<a href="#l2.10"></a><span id="l2.10">     ::RegCloseKey(theKey);</span>
<a href="#l2.11"></a><span id="l2.11">     if (REG_FAILED(result) ||</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        !dataLongPath.Equals(currValue, nsCaseInsensitiveStringComparator())) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+        !dataLongPath.Equals(currValue, nsCaseInsensitiveStringComparator)) {</span>
<a href="#l2.14"></a><span id="l2.14">       // Key wasn't set, or was set to something else (something else became the</span>
<a href="#l2.15"></a><span id="l2.15">       // default client)</span>
<a href="#l2.16"></a><span id="l2.16">       isDefault = false;</span>
<a href="#l2.17"></a><span id="l2.17">       break;</span>
<a href="#l2.18"></a><span id="l2.18">     }</span>
<a href="#l2.19"></a><span id="l2.19">   }  // for each registry key we want to look at</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">   return isDefault;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -428,25 +428,24 @@ NS_IMETHODIMP nsAbCardProperty::HasEmail</span>
<a href="#l3.4"></a><span id="l3.4">                                                 bool *aResult) {</span>
<a href="#l3.5"></a><span id="l3.5">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7">   *aResult = false;</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">   nsCString emailAddress;</span>
<a href="#l3.10"></a><span id="l3.10">   nsresult rv = GetPropertyAsAUTF8String(kPriEmailProperty, emailAddress);</span>
<a href="#l3.11"></a><span id="l3.11">   if (rv != NS_ERROR_NOT_AVAILABLE &amp;&amp;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-      emailAddress.Equals(aEmailAddress,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                          nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+      emailAddress.Equals(aEmailAddress, nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l3.15"></a><span id="l3.15">     *aResult = true;</span>
<a href="#l3.16"></a><span id="l3.16">     return NS_OK;</span>
<a href="#l3.17"></a><span id="l3.17">   }</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">   rv = GetPropertyAsAUTF8String(k2ndEmailProperty, emailAddress);</span>
<a href="#l3.20"></a><span id="l3.20">   if (rv != NS_ERROR_NOT_AVAILABLE &amp;&amp;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-      emailAddress.Equals(aEmailAddress, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+      emailAddress.Equals(aEmailAddress, nsCaseInsensitiveCStringComparator))</span>
<a href="#l3.23"></a><span id="l3.23">     *aResult = true;</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25">   return NS_OK;</span>
<a href="#l3.26"></a><span id="l3.26"> }</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28"> // This function may be overridden by derived classes for</span>
<a href="#l3.29"></a><span id="l3.29"> // nsAb*Card specific implementations.</span>
<a href="#l3.30"></a><span id="l3.30"> NS_IMETHODIMP nsAbCardProperty::Copy(nsIAbCard *srcCard) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbDirectoryQuery.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbDirectoryQuery.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -408,38 +408,37 @@ nsresult nsAbDirectoryQuery::matchCardCo</span>
<a href="#l4.4"></a><span id="l4.4">       break;</span>
<a href="#l4.5"></a><span id="l4.5">     case nsIAbBooleanConditionTypes::Contains:</span>
<a href="#l4.6"></a><span id="l4.6">       *matchFound = CaseInsensitiveFindInReadable(matchValue, value);</span>
<a href="#l4.7"></a><span id="l4.7">       break;</span>
<a href="#l4.8"></a><span id="l4.8">     case nsIAbBooleanConditionTypes::DoesNotContain:</span>
<a href="#l4.9"></a><span id="l4.9">       *matchFound = !CaseInsensitiveFindInReadable(matchValue, value);</span>
<a href="#l4.10"></a><span id="l4.10">       break;</span>
<a href="#l4.11"></a><span id="l4.11">     case nsIAbBooleanConditionTypes::Is:</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      *matchFound =</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-          value.Equals(matchValue, nsCaseInsensitiveStringComparator());</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+      *matchFound = value.Equals(matchValue, nsCaseInsensitiveStringComparator);</span>
<a href="#l4.15"></a><span id="l4.15">       break;</span>
<a href="#l4.16"></a><span id="l4.16">     case nsIAbBooleanConditionTypes::IsNot:</span>
<a href="#l4.17"></a><span id="l4.17">       *matchFound =</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-          !value.Equals(matchValue, nsCaseInsensitiveStringComparator());</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+          !value.Equals(matchValue, nsCaseInsensitiveStringComparator);</span>
<a href="#l4.20"></a><span id="l4.20">       break;</span>
<a href="#l4.21"></a><span id="l4.21">     case nsIAbBooleanConditionTypes::BeginsWith:</span>
<a href="#l4.22"></a><span id="l4.22">       *matchFound = StringBeginsWith(value, matchValue,</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-                                     nsCaseInsensitiveStringComparator());</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+                                     nsCaseInsensitiveStringComparator);</span>
<a href="#l4.25"></a><span id="l4.25">       break;</span>
<a href="#l4.26"></a><span id="l4.26">     case nsIAbBooleanConditionTypes::LessThan:</span>
<a href="#l4.27"></a><span id="l4.27">       *matchFound =</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-          Compare(value, matchValue, nsCaseInsensitiveStringComparator()) &lt; 0;</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+          Compare(value, matchValue, nsCaseInsensitiveStringComparator) &lt; 0;</span>
<a href="#l4.30"></a><span id="l4.30">       break;</span>
<a href="#l4.31"></a><span id="l4.31">     case nsIAbBooleanConditionTypes::GreaterThan:</span>
<a href="#l4.32"></a><span id="l4.32">       *matchFound =</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-          Compare(value, matchValue, nsCaseInsensitiveStringComparator()) &gt; 0;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+          Compare(value, matchValue, nsCaseInsensitiveStringComparator) &gt; 0;</span>
<a href="#l4.35"></a><span id="l4.35">       break;</span>
<a href="#l4.36"></a><span id="l4.36">     case nsIAbBooleanConditionTypes::EndsWith:</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-      *matchFound = StringEndsWith(value, matchValue,</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-                                   nsCaseInsensitiveStringComparator());</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+      *matchFound =</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+          StringEndsWith(value, matchValue, nsCaseInsensitiveStringComparator);</span>
<a href="#l4.41"></a><span id="l4.41">       break;</span>
<a href="#l4.42"></a><span id="l4.42">     case nsIAbBooleanConditionTypes::SoundsLike:</span>
<a href="#l4.43"></a><span id="l4.43">     case nsIAbBooleanConditionTypes::RegExp:</span>
<a href="#l4.44"></a><span id="l4.44">       *matchFound = false;</span>
<a href="#l4.45"></a><span id="l4.45">       break;</span>
<a href="#l4.46"></a><span id="l4.46">     default:</span>
<a href="#l4.47"></a><span id="l4.47">       *matchFound = false;</span>
<a href="#l4.48"></a><span id="l4.48">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbOSXDirectory.mm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbOSXDirectory.mm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -705,19 +705,18 @@ nsAbOSXDirectory::GetCardFromProperty(co</span>
<a href="#l5.4"></a><span id="l5.4">   nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l5.5"></a><span id="l5.5">   nsAutoCString cardValue;</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7">   for (uint32_t i = 0; i &lt; length &amp;&amp; !*aResult; ++i) {</span>
<a href="#l5.8"></a><span id="l5.8">     card = do_QueryElementAt(list, i, &amp;rv);</span>
<a href="#l5.9"></a><span id="l5.9">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.10"></a><span id="l5.10">       rv = card-&gt;GetPropertyAsAUTF8String(aProperty, cardValue);</span>
<a href="#l5.11"></a><span id="l5.11">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-        bool equal = aCaseSensitive</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                         ? cardValue.Equals(aValue)</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-                         : cardValue.Equals(aValue, nsCaseInsensitiveCStringComparator());</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+        bool equal = aCaseSensitive ? cardValue.Equals(aValue)</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+                                    : cardValue.Equals(aValue, nsCaseInsensitiveCStringComparator);</span>
<a href="#l5.17"></a><span id="l5.17">         if (equal) NS_IF_ADDREF(*aResult = card);</span>
<a href="#l5.18"></a><span id="l5.18">       }</span>
<a href="#l5.19"></a><span id="l5.19">     }</span>
<a href="#l5.20"></a><span id="l5.20">   }</span>
<a href="#l5.21"></a><span id="l5.21">   return NS_OK;</span>
<a href="#l5.22"></a><span id="l5.22"> }</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24"> NS_IMETHODIMP</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineat">@@ -741,19 +740,18 @@ nsAbOSXDirectory::GetCardsFromProperty(c</span>
<a href="#l5.26"></a><span id="l5.26">   nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l5.27"></a><span id="l5.27">   nsAutoCString cardValue;</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29">   for (uint32_t i = 0; i &lt; length; ++i) {</span>
<a href="#l5.30"></a><span id="l5.30">     card = do_QueryElementAt(list, i, &amp;rv);</span>
<a href="#l5.31"></a><span id="l5.31">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.32"></a><span id="l5.32">       rv = card-&gt;GetPropertyAsAUTF8String(aProperty, cardValue);</span>
<a href="#l5.33"></a><span id="l5.33">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-        bool equal = aCaseSensitive</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-                         ? cardValue.Equals(aValue)</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-                         : cardValue.Equals(aValue, nsCaseInsensitiveCStringComparator());</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+        bool equal = aCaseSensitive ? cardValue.Equals(aValue)</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+                                    : cardValue.Equals(aValue, nsCaseInsensitiveCStringComparator);</span>
<a href="#l5.39"></a><span id="l5.39">         if (equal) resultArray.AppendObject(card);</span>
<a href="#l5.40"></a><span id="l5.40">       }</span>
<a href="#l5.41"></a><span id="l5.41">     }</span>
<a href="#l5.42"></a><span id="l5.42">   }</span>
<a href="#l5.43"></a><span id="l5.43"> </span>
<a href="#l5.44"></a><span id="l5.44">   return NS_NewArrayEnumerator(aResult, resultArray, NS_GET_IID(nsIAbCard));</span>
<a href="#l5.45"></a><span id="l5.45"> }</span>
<a href="#l5.46"></a><span id="l5.46"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1057,19 +1057,18 @@ NS_IMETHODIMP nsMsgFilterList::MatchOrCh</span>
<a href="#l6.4"></a><span id="l6.4">       if (NS_FAILED(filterAction-&gt;GetType(&amp;actionType))) continue;</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6">       if (actionType == nsMsgFilterAction::MoveToFolder ||</span>
<a href="#l6.7"></a><span id="l6.7">           actionType == nsMsgFilterAction::CopyToFolder) {</span>
<a href="#l6.8"></a><span id="l6.8">         rv = filterAction-&gt;GetTargetFolderUri(folderUri);</span>
<a href="#l6.9"></a><span id="l6.9">         if (NS_SUCCEEDED(rv) &amp;&amp; !folderUri.IsEmpty()) {</span>
<a href="#l6.10"></a><span id="l6.10">           bool matchFound = false;</span>
<a href="#l6.11"></a><span id="l6.11">           if (caseInsensitive) {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-            if (folderUri.Equals(</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                    oldFolderUri,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                    nsCaseInsensitiveCStringComparator()))  // local</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+            if (folderUri.Equals(oldFolderUri,</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+                                 nsCaseInsensitiveCStringComparator))  // local</span>
<a href="#l6.17"></a><span id="l6.17">               matchFound = true;</span>
<a href="#l6.18"></a><span id="l6.18">           } else {</span>
<a href="#l6.19"></a><span id="l6.19">             if (folderUri.Equals(oldFolderUri))  // imap</span>
<a href="#l6.20"></a><span id="l6.20">               matchFound = true;</span>
<a href="#l6.21"></a><span id="l6.21">           }</span>
<a href="#l6.22"></a><span id="l6.22">           if (matchFound) {</span>
<a href="#l6.23"></a><span id="l6.23">             *found = true;</span>
<a href="#l6.24"></a><span id="l6.24">             // if we just want to match the uri's, newFolderUri will be null</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -721,17 +721,17 @@ nsresult nsMsgSearchTerm::MatchArbitrary</span>
<a href="#l7.4"></a><span id="l7.4">     // If the line starts with whitespace, then we use the current header.</span>
<a href="#l7.5"></a><span id="l7.5">     if (!isContinuationHeader) {</span>
<a href="#l7.6"></a><span id="l7.6">       // Here we start a new header.</span>
<a href="#l7.7"></a><span id="l7.7">       uint32_t colonPos = buf.FindChar(':');</span>
<a href="#l7.8"></a><span id="l7.8">       curMsgHeader = StringHead(buf, colonPos);</span>
<a href="#l7.9"></a><span id="l7.9">     }</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">     if (curMsgHeader.Equals(m_arbitraryHeader,</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-                            nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+                            nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l7.14"></a><span id="l7.14">       // Process the value:</span>
<a href="#l7.15"></a><span id="l7.15">       // Value occurs after the header name or whitespace continuation char.</span>
<a href="#l7.16"></a><span id="l7.16">       const char *headerValue =</span>
<a href="#l7.17"></a><span id="l7.17">           buf.get() + (isContinuationHeader ? 1 : headerLength);</span>
<a href="#l7.18"></a><span id="l7.18">       if (headerValue &lt; buf_end &amp;&amp;</span>
<a href="#l7.19"></a><span id="l7.19">           headerValue[0] ==</span>
<a href="#l7.20"></a><span id="l7.20">               ':')  // + 1 to account for the colon which is MANDATORY</span>
<a href="#l7.21"></a><span id="l7.21">         headerValue++;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -1012,37 +1012,37 @@ nsresult nsMsgSearchTerm::MatchString(co</span>
<a href="#l7.23"></a><span id="l7.23">     case nsMsgSearchOp::Contains:</span>
<a href="#l7.24"></a><span id="l7.24">       if (CaseInsensitiveFindInReadable(needle, utf16StrToMatch)) result = true;</span>
<a href="#l7.25"></a><span id="l7.25">       break;</span>
<a href="#l7.26"></a><span id="l7.26">     case nsMsgSearchOp::DoesntContain:</span>
<a href="#l7.27"></a><span id="l7.27">       if (!CaseInsensitiveFindInReadable(needle, utf16StrToMatch))</span>
<a href="#l7.28"></a><span id="l7.28">         result = true;</span>
<a href="#l7.29"></a><span id="l7.29">       break;</span>
<a href="#l7.30"></a><span id="l7.30">     case nsMsgSearchOp::Is:</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-      if (needle.Equals(utf16StrToMatch, nsCaseInsensitiveStringComparator()))</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+      if (needle.Equals(utf16StrToMatch, nsCaseInsensitiveStringComparator))</span>
<a href="#l7.33"></a><span id="l7.33">         result = true;</span>
<a href="#l7.34"></a><span id="l7.34">       break;</span>
<a href="#l7.35"></a><span id="l7.35">     case nsMsgSearchOp::Isnt:</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-      if (!needle.Equals(utf16StrToMatch, nsCaseInsensitiveStringComparator()))</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+      if (!needle.Equals(utf16StrToMatch, nsCaseInsensitiveStringComparator))</span>
<a href="#l7.38"></a><span id="l7.38">         result = true;</span>
<a href="#l7.39"></a><span id="l7.39">       break;</span>
<a href="#l7.40"></a><span id="l7.40">     case nsMsgSearchOp::IsEmpty:</span>
<a href="#l7.41"></a><span id="l7.41">       if (utf16StrToMatch.IsEmpty()) result = true;</span>
<a href="#l7.42"></a><span id="l7.42">       break;</span>
<a href="#l7.43"></a><span id="l7.43">     case nsMsgSearchOp::IsntEmpty:</span>
<a href="#l7.44"></a><span id="l7.44">       if (!utf16StrToMatch.IsEmpty()) result = true;</span>
<a href="#l7.45"></a><span id="l7.45">       break;</span>
<a href="#l7.46"></a><span id="l7.46">     case nsMsgSearchOp::BeginsWith:</span>
<a href="#l7.47"></a><span id="l7.47">       if (StringBeginsWith(utf16StrToMatch, needle,</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-                           nsCaseInsensitiveStringComparator()))</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+                           nsCaseInsensitiveStringComparator))</span>
<a href="#l7.50"></a><span id="l7.50">         result = true;</span>
<a href="#l7.51"></a><span id="l7.51">       break;</span>
<a href="#l7.52"></a><span id="l7.52">     case nsMsgSearchOp::EndsWith:</span>
<a href="#l7.53"></a><span id="l7.53">       if (StringEndsWith(utf16StrToMatch, needle,</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-                         nsCaseInsensitiveStringComparator()))</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+                         nsCaseInsensitiveStringComparator))</span>
<a href="#l7.56"></a><span id="l7.56">         result = true;</span>
<a href="#l7.57"></a><span id="l7.57">       break;</span>
<a href="#l7.58"></a><span id="l7.58">     default:</span>
<a href="#l7.59"></a><span id="l7.59">       rv = NS_ERROR_FAILURE;</span>
<a href="#l7.60"></a><span id="l7.60">       NS_ERROR(&quot;invalid compare op for matching search results&quot;);</span>
<a href="#l7.61"></a><span id="l7.61">   }</span>
<a href="#l7.62"></a><span id="l7.62"> </span>
<a href="#l7.63"></a><span id="l7.63">   *pResult = result;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -949,24 +949,24 @@ nsMessenger::SaveAs(const nsACString &amp;aU</span>
<a href="#l8.4"></a><span id="l8.4">                          getter_AddRefs(saveAsFile));</span>
<a href="#l8.5"></a><span id="l8.5">       // A null saveAsFile means that the user canceled the save as</span>
<a href="#l8.6"></a><span id="l8.6">       if (NS_FAILED(rv) || !saveAsFile) goto done;</span>
<a href="#l8.7"></a><span id="l8.7">     } else {</span>
<a href="#l8.8"></a><span id="l8.8">       saveAsFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l8.9"></a><span id="l8.9">       rv = saveAsFile-&gt;InitWithPath(aMsgFilename);</span>
<a href="#l8.10"></a><span id="l8.10">       if (NS_FAILED(rv)) goto done;</span>
<a href="#l8.11"></a><span id="l8.11">       if (StringEndsWith(aMsgFilename, NS_LITERAL_STRING(TEXT_FILE_EXTENSION),</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-                         nsCaseInsensitiveStringComparator()))</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                         nsCaseInsensitiveStringComparator))</span>
<a href="#l8.14"></a><span id="l8.14">         saveAsFileType = TEXT_FILE_TYPE;</span>
<a href="#l8.15"></a><span id="l8.15">       else if ((StringEndsWith(aMsgFilename,</span>
<a href="#l8.16"></a><span id="l8.16">                                NS_LITERAL_STRING(HTML_FILE_EXTENSION),</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-                               nsCaseInsensitiveStringComparator())) ||</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+                               nsCaseInsensitiveStringComparator)) ||</span>
<a href="#l8.19"></a><span id="l8.19">                (StringEndsWith(aMsgFilename,</span>
<a href="#l8.20"></a><span id="l8.20">                                NS_LITERAL_STRING(HTML_FILE_EXTENSION2),</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-                               nsCaseInsensitiveStringComparator())))</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+                               nsCaseInsensitiveStringComparator)))</span>
<a href="#l8.23"></a><span id="l8.23">         saveAsFileType = HTML_FILE_TYPE;</span>
<a href="#l8.24"></a><span id="l8.24">       else</span>
<a href="#l8.25"></a><span id="l8.25">         saveAsFileType = EML_FILE_TYPE;</span>
<a href="#l8.26"></a><span id="l8.26">     }</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">     rv = AdjustFileIfNameTooLong(saveAsFile);</span>
<a href="#l8.29"></a><span id="l8.29">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31" class="difflineat">@@ -1156,22 +1156,22 @@ nsresult nsMessenger::GetSaveAsFile(cons</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">   // If All Files was selected, look at the extension</span>
<a href="#l8.34"></a><span id="l8.34">   if (selectedSaveAsFileType == ANY_FILE_TYPE) {</span>
<a href="#l8.35"></a><span id="l8.35">     nsAutoString fileName;</span>
<a href="#l8.36"></a><span id="l8.36">     rv = localFile-&gt;GetLeafName(fileName);</span>
<a href="#l8.37"></a><span id="l8.37">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39">     if (StringEndsWith(fileName, NS_LITERAL_STRING(HTML_FILE_EXTENSION),</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-                       nsCaseInsensitiveStringComparator()) ||</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+                       nsCaseInsensitiveStringComparator) ||</span>
<a href="#l8.42"></a><span id="l8.42">         StringEndsWith(fileName, NS_LITERAL_STRING(HTML_FILE_EXTENSION2),</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-                       nsCaseInsensitiveStringComparator()))</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+                       nsCaseInsensitiveStringComparator))</span>
<a href="#l8.45"></a><span id="l8.45">       *aSaveAsFileType = HTML_FILE_TYPE;</span>
<a href="#l8.46"></a><span id="l8.46">     else if (StringEndsWith(fileName, NS_LITERAL_STRING(TEXT_FILE_EXTENSION),</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-                            nsCaseInsensitiveStringComparator()))</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+                            nsCaseInsensitiveStringComparator))</span>
<a href="#l8.49"></a><span id="l8.49">       *aSaveAsFileType = TEXT_FILE_TYPE;</span>
<a href="#l8.50"></a><span id="l8.50">     else</span>
<a href="#l8.51"></a><span id="l8.51">       // The default is .eml</span>
<a href="#l8.52"></a><span id="l8.52">       *aSaveAsFileType = EML_FILE_TYPE;</span>
<a href="#l8.53"></a><span id="l8.53">   } else {</span>
<a href="#l8.54"></a><span id="l8.54">     *aSaveAsFileType = selectedSaveAsFileType;</span>
<a href="#l8.55"></a><span id="l8.55">   }</span>
<a href="#l8.56"></a><span id="l8.56"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1758,17 +1758,17 @@ nsresult nsMsgAccountManager::findServer</span>
<a href="#l9.4"></a><span id="l9.4">         continue;</span>
<a href="#l9.5"></a><span id="l9.5">       }</span>
<a href="#l9.6"></a><span id="l9.6">     }</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">     // treat &quot;&quot; as a wild card, so if the caller passed in &quot;&quot; for the desired</span>
<a href="#l9.9"></a><span id="l9.9">     // attribute treat it as a match</span>
<a href="#l9.10"></a><span id="l9.10">     if ((type.IsEmpty() || thisType.Equals(type)) &amp;&amp;</span>
<a href="#l9.11"></a><span id="l9.11">         (hostname.IsEmpty() ||</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-         thisHostname.Equals(hostname, nsCaseInsensitiveCStringComparator())) &amp;&amp;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+         thisHostname.Equals(hostname, nsCaseInsensitiveCStringComparator)) &amp;&amp;</span>
<a href="#l9.14"></a><span id="l9.14">         (!(port != 0) || (port == thisPort)) &amp;&amp;</span>
<a href="#l9.15"></a><span id="l9.15">         (username.IsEmpty() || thisUsername.Equals(username))) {</span>
<a href="#l9.16"></a><span id="l9.16">       // stop on first find; cache for next time</span>
<a href="#l9.17"></a><span id="l9.17">       if (!aRealFlag)</span>
<a href="#l9.18"></a><span id="l9.18">         SetLastServerFound(server, hostname, username, port, type);</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20">       NS_ADDREF(*aResult = server);  // Was populated from member variable.</span>
<a href="#l9.21"></a><span id="l9.21">       return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -761,17 +761,17 @@ NS_IMETHODIMP nsSpamSettings::CheckWhite</span>
<a href="#l10.4"></a><span id="l10.4">   ExtractEmail(EncodedHeader(author), authorEmailAddress);</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">   if (authorEmailAddress.IsEmpty()) return NS_OK;</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">   // should we skip whitelisting for the identity email?</span>
<a href="#l10.9"></a><span id="l10.9">   if (mInhibitWhiteListingIdentityUser) {</span>
<a href="#l10.10"></a><span id="l10.10">     for (uint32_t i = 0; i &lt; mEmails.Length(); ++i) {</span>
<a href="#l10.11"></a><span id="l10.11">       if (mEmails[i].Equals(authorEmailAddress,</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))</span>
<a href="#l10.14"></a><span id="l10.14">         return NS_OK;</span>
<a href="#l10.15"></a><span id="l10.15">     }</span>
<a href="#l10.16"></a><span id="l10.16">   }</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18">   if (!mTrustedMailDomains.IsEmpty() || mInhibitWhiteListingIdentityDomain) {</span>
<a href="#l10.19"></a><span id="l10.19">     nsAutoCString domain;</span>
<a href="#l10.20"></a><span id="l10.20">     int32_t atPos = authorEmailAddress.FindChar('@');</span>
<a href="#l10.21"></a><span id="l10.21">     if (atPos &gt;= 0) domain = Substring(authorEmailAddress, atPos + 1);</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -784,17 +784,17 @@ NS_IMETHODIMP nsSpamSettings::CheckWhite</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24">       if (mInhibitWhiteListingIdentityDomain) {</span>
<a href="#l10.25"></a><span id="l10.25">         for (uint32_t i = 0; i &lt; mEmails.Length(); ++i) {</span>
<a href="#l10.26"></a><span id="l10.26">           nsAutoCString identityDomain;</span>
<a href="#l10.27"></a><span id="l10.27">           int32_t atPos = mEmails[i].FindChar('@');</span>
<a href="#l10.28"></a><span id="l10.28">           if (atPos &gt;= 0) {</span>
<a href="#l10.29"></a><span id="l10.29">             identityDomain = Substring(mEmails[i], atPos + 1);</span>
<a href="#l10.30"></a><span id="l10.30">             if (identityDomain.Equals(domain,</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-                                      nsCaseInsensitiveCStringComparator()))</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+                                      nsCaseInsensitiveCStringComparator))</span>
<a href="#l10.33"></a><span id="l10.33">               return NS_OK;  // don't whitelist</span>
<a href="#l10.34"></a><span id="l10.34">           }</span>
<a href="#l10.35"></a><span id="l10.35">         }</span>
<a href="#l10.36"></a><span id="l10.36">       }</span>
<a href="#l10.37"></a><span id="l10.37">     }</span>
<a href="#l10.38"></a><span id="l10.38">   }</span>
<a href="#l10.39"></a><span id="l10.39"> </span>
<a href="#l10.40"></a><span id="l10.40">   if (mWhiteListDirArray.Count()) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -3194,17 +3194,17 @@ nsMsgDBFolder::GetChildNamed(const nsASt</span>
<a href="#l11.4"></a><span id="l11.4">   *aChild = nullptr;</span>
<a href="#l11.5"></a><span id="l11.5">   int32_t count = mSubFolders.Count();</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7">   for (int32_t i = 0; i &lt; count; i++) {</span>
<a href="#l11.8"></a><span id="l11.8">     nsString folderName;</span>
<a href="#l11.9"></a><span id="l11.9">     nsresult rv = mSubFolders[i]-&gt;GetName(folderName);</span>
<a href="#l11.10"></a><span id="l11.10">     // case-insensitive compare is probably LCD across OS filesystems</span>
<a href="#l11.11"></a><span id="l11.11">     if (NS_SUCCEEDED(rv) &amp;&amp;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-        folderName.Equals(aName, nsCaseInsensitiveStringComparator())) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+        folderName.Equals(aName, nsCaseInsensitiveStringComparator)) {</span>
<a href="#l11.14"></a><span id="l11.14">       NS_ADDREF(*aChild = mSubFolders[i]);</span>
<a href="#l11.15"></a><span id="l11.15">       return NS_OK;</span>
<a href="#l11.16"></a><span id="l11.16">     }</span>
<a href="#l11.17"></a><span id="l11.17">   }</span>
<a href="#l11.18"></a><span id="l11.18">   // don't return NS_OK if we didn't find the folder</span>
<a href="#l11.19"></a><span id="l11.19">   // see http://bugzilla.mozilla.org/show_bug.cgi?id=210089#c15</span>
<a href="#l11.20"></a><span id="l11.20">   // and http://bugzilla.mozilla.org/show_bug.cgi?id=210089#c17</span>
<a href="#l11.21"></a><span id="l11.21">   return NS_ERROR_FAILURE;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -3227,17 +3227,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetChildWit</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">     nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(item));</span>
<a href="#l11.25"></a><span id="l11.25">     if (folder) {</span>
<a href="#l11.26"></a><span id="l11.26">       nsCString folderURI;</span>
<a href="#l11.27"></a><span id="l11.27">       rv = folder-&gt;GetURI(folderURI);</span>
<a href="#l11.28"></a><span id="l11.28">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.29"></a><span id="l11.29">       bool equal =</span>
<a href="#l11.30"></a><span id="l11.30">           (caseInsensitive</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-               ? uri.Equals(folderURI, nsCaseInsensitiveCStringComparator())</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+               ? uri.Equals(folderURI, nsCaseInsensitiveCStringComparator)</span>
<a href="#l11.33"></a><span id="l11.33">                : uri.Equals(folderURI));</span>
<a href="#l11.34"></a><span id="l11.34">       if (equal) {</span>
<a href="#l11.35"></a><span id="l11.35">         folder.forget(child);</span>
<a href="#l11.36"></a><span id="l11.36">         return NS_OK;</span>
<a href="#l11.37"></a><span id="l11.37">       }</span>
<a href="#l11.38"></a><span id="l11.38">       if (deep) {</span>
<a href="#l11.39"></a><span id="l11.39">         rv = folder-&gt;GetChildWithURI(uri, deep, caseInsensitive, child);</span>
<a href="#l11.40"></a><span id="l11.40">         if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineat">@@ -3503,17 +3503,17 @@ nsresult nsMsgDBFolder::CheckIfFolderExi</span>
<a href="#l11.42"></a><span id="l11.42">     rv = subFolders-&gt;GetNext(getter_AddRefs(item));</span>
<a href="#l11.43"></a><span id="l11.43"> </span>
<a href="#l11.44"></a><span id="l11.44">     nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder(do_QueryInterface(item));</span>
<a href="#l11.45"></a><span id="l11.45">     if (!msgFolder) break;</span>
<a href="#l11.46"></a><span id="l11.46"> </span>
<a href="#l11.47"></a><span id="l11.47">     nsString folderName;</span>
<a href="#l11.48"></a><span id="l11.48"> </span>
<a href="#l11.49"></a><span id="l11.49">     msgFolder-&gt;GetName(folderName);</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-    if (folderName.Equals(newFolderName, nsCaseInsensitiveStringComparator())) {</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+    if (folderName.Equals(newFolderName, nsCaseInsensitiveStringComparator)) {</span>
<a href="#l11.52"></a><span id="l11.52">       ThrowAlertMsg(&quot;folderExists&quot;, msgWindow);</span>
<a href="#l11.53"></a><span id="l11.53">       return NS_MSG_FOLDER_EXISTS;</span>
<a href="#l11.54"></a><span id="l11.54">     }</span>
<a href="#l11.55"></a><span id="l11.55">   }</span>
<a href="#l11.56"></a><span id="l11.56">   return NS_OK;</span>
<a href="#l11.57"></a><span id="l11.57"> }</span>
<a href="#l11.58"></a><span id="l11.58"> </span>
<a href="#l11.59"></a><span id="l11.59"> bool nsMsgDBFolder::ConfirmAutoFolderRename(nsIMsgWindow *msgWindow,</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineat">@@ -3680,17 +3680,17 @@ NS_IMETHODIMP nsMsgDBFolder::Rename(cons</span>
<a href="#l11.61"></a><span id="l11.61">   nsCOMPtr&lt;nsIFile&gt; dirFile;</span>
<a href="#l11.62"></a><span id="l11.62">   int32_t count = mSubFolders.Count();</span>
<a href="#l11.63"></a><span id="l11.63"> </span>
<a href="#l11.64"></a><span id="l11.64">   if (count &gt; 0) rv = CreateDirectoryForFolder(getter_AddRefs(dirFile));</span>
<a href="#l11.65"></a><span id="l11.65"> </span>
<a href="#l11.66"></a><span id="l11.66">   nsAutoString newDiskName(aNewName);</span>
<a href="#l11.67"></a><span id="l11.67">   NS_MsgHashIfNecessary(newDiskName);</span>
<a href="#l11.68"></a><span id="l11.68"> </span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-  if (mName.Equals(aNewName, nsCaseInsensitiveStringComparator())) {</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+  if (mName.Equals(aNewName, nsCaseInsensitiveStringComparator)) {</span>
<a href="#l11.71"></a><span id="l11.71">     rv = ThrowAlertMsg(&quot;folderExists&quot;, msgWindow);</span>
<a href="#l11.72"></a><span id="l11.72">     return NS_MSG_FOLDER_EXISTS;</span>
<a href="#l11.73"></a><span id="l11.73">   } else {</span>
<a href="#l11.74"></a><span id="l11.74">     nsCOMPtr&lt;nsIFile&gt; parentPathFile;</span>
<a href="#l11.75"></a><span id="l11.75">     parentFolder-&gt;GetFilePath(getter_AddRefs(parentPathFile));</span>
<a href="#l11.76"></a><span id="l11.76">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.77"></a><span id="l11.77">     bool isDirectory = false;</span>
<a href="#l11.78"></a><span id="l11.78">     parentPathFile-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineat">@@ -5001,34 +5001,34 @@ NS_IMETHODIMP nsMsgDBFolder::GetMsgTextF</span>
<a href="#l11.80"></a><span id="l11.80">     else</span>
<a href="#l11.81"></a><span id="l11.81">       mimeHdrParam-&gt;GetParameter(contentTypeHdr, nullptr, EmptyCString(), false,</span>
<a href="#l11.82"></a><span id="l11.82">                                  nullptr, contentType);</span>
<a href="#l11.83"></a><span id="l11.83"> </span>
<a href="#l11.84"></a><span id="l11.84">     justPassedEndBoundary = false;</span>
<a href="#l11.85"></a><span id="l11.85"> </span>
<a href="#l11.86"></a><span id="l11.86">     // If we are multipart, then we need to get the boundary</span>
<a href="#l11.87"></a><span id="l11.87">     if (StringBeginsWith(contentType, NS_LITERAL_STRING(&quot;multipart/&quot;),</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineminus">-                         nsCaseInsensitiveStringComparator())) {</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+                         nsCaseInsensitiveStringComparator)) {</span>
<a href="#l11.90"></a><span id="l11.90">       nsAutoString boundaryParam;</span>
<a href="#l11.91"></a><span id="l11.91">       mimeHdrParam-&gt;GetParameter(contentTypeHdr, &quot;boundary&quot;, EmptyCString(),</span>
<a href="#l11.92"></a><span id="l11.92">                                  false, nullptr, boundaryParam);</span>
<a href="#l11.93"></a><span id="l11.93">       if (!boundaryParam.IsEmpty()) {</span>
<a href="#l11.94"></a><span id="l11.94">         nsAutoCString boundary(NS_LITERAL_CSTRING(&quot;--&quot;));</span>
<a href="#l11.95"></a><span id="l11.95">         boundary.Append(NS_ConvertUTF16toUTF8(boundaryParam));</span>
<a href="#l11.96"></a><span id="l11.96">         boundaryStack.AppendElement(boundary);</span>
<a href="#l11.97"></a><span id="l11.97">       }</span>
<a href="#l11.98"></a><span id="l11.98">     }</span>
<a href="#l11.99"></a><span id="l11.99"> </span>
<a href="#l11.100"></a><span id="l11.100">     // If we are message/rfc822, then there's another header block coming up</span>
<a href="#l11.101"></a><span id="l11.101">     else if (contentType.LowerCaseEqualsLiteral(&quot;message/rfc822&quot;))</span>
<a href="#l11.102"></a><span id="l11.102">       continue;</span>
<a href="#l11.103"></a><span id="l11.103"> </span>
<a href="#l11.104"></a><span id="l11.104">     // If we are a text part, then we want it</span>
<a href="#l11.105"></a><span id="l11.105">     else if (StringBeginsWith(contentType, NS_LITERAL_STRING(&quot;text/&quot;),</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineminus">-                              nsCaseInsensitiveStringComparator())) {</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+                              nsCaseInsensitiveStringComparator)) {</span>
<a href="#l11.108"></a><span id="l11.108">       inMsgBody = true;</span>
<a href="#l11.109"></a><span id="l11.109"> </span>
<a href="#l11.110"></a><span id="l11.110">       if (contentType.LowerCaseEqualsLiteral(&quot;text/html&quot;)) msgBodyIsHtml = true;</span>
<a href="#l11.111"></a><span id="l11.111"> </span>
<a href="#l11.112"></a><span id="l11.112">       // Also get the charset if required</span>
<a href="#l11.113"></a><span id="l11.113">       if (charset.IsEmpty()) {</span>
<a href="#l11.114"></a><span id="l11.114">         nsAutoString charsetW;</span>
<a href="#l11.115"></a><span id="l11.115">         mimeHdrParam-&gt;GetParameter(contentTypeHdr, &quot;charset&quot;, EmptyCString(),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -71,31 +71,31 @@ nsresult nsMsgI18NConvertToUnicode(const</span>
<a href="#l12.4"></a><span id="l12.4">     return NS_OK;</span>
<a href="#l12.5"></a><span id="l12.5">   }</span>
<a href="#l12.6"></a><span id="l12.6">   if (aCharset.IsEmpty()) {</span>
<a href="#l12.7"></a><span id="l12.7">     // Despite its name, it also works for Latin-1.</span>
<a href="#l12.8"></a><span id="l12.8">     CopyASCIItoUTF16(inString, outString);</span>
<a href="#l12.9"></a><span id="l12.9">     return NS_OK;</span>
<a href="#l12.10"></a><span id="l12.10">   }</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  if (aCharset.Equals(&quot;UTF-8&quot;, nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  if (aCharset.Equals(&quot;UTF-8&quot;, nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l12.14"></a><span id="l12.14">     return UTF_8_ENCODING-&gt;DecodeWithBOMRemoval(inString, outString);</span>
<a href="#l12.15"></a><span id="l12.15">   }</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17">   // Look up Thunderbird's special aliases from charsetalias.properties.</span>
<a href="#l12.18"></a><span id="l12.18">   nsresult rv;</span>
<a href="#l12.19"></a><span id="l12.19">   nsCOMPtr&lt;nsICharsetConverterManager&gt; ccm =</span>
<a href="#l12.20"></a><span id="l12.20">       do_GetService(NS_CHARSETCONVERTERMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l12.21"></a><span id="l12.21">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23">   nsCString newCharset;</span>
<a href="#l12.24"></a><span id="l12.24">   rv = ccm-&gt;GetCharsetAlias(PromiseFlatCString(aCharset).get(), newCharset);</span>
<a href="#l12.25"></a><span id="l12.25">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-  if (newCharset.Equals(&quot;UTF-7&quot;, nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+  if (newCharset.Equals(&quot;UTF-7&quot;, nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l12.29"></a><span id="l12.29">     // Special treatment for decoding UTF-7 since it's not handled by</span>
<a href="#l12.30"></a><span id="l12.30">     // encoding_rs.</span>
<a href="#l12.31"></a><span id="l12.31">     return CopyUTF7toUTF16(inString, outString);</span>
<a href="#l12.32"></a><span id="l12.32">   }</span>
<a href="#l12.33"></a><span id="l12.33"> </span>
<a href="#l12.34"></a><span id="l12.34">   auto encoding = mozilla::Encoding::ForLabelNoReplacement(newCharset);</span>
<a href="#l12.35"></a><span id="l12.35">   if (!encoding) return NS_ERROR_UCONV_NOCONV;</span>
<a href="#l12.36"></a><span id="l12.36">   return encoding-&gt;DecodeWithoutBOMHandling(inString, outString);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -910,17 +910,17 @@ nsMsgIncomingServer::Equals(nsIMsgIncomi</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5">   rv = GetKey(key1);</span>
<a href="#l13.6"></a><span id="l13.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8">   rv = server-&gt;GetKey(key2);</span>
<a href="#l13.9"></a><span id="l13.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">   // compare the server keys</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  *_retval = key1.Equals(key2, nsCaseInsensitiveCStringComparator());</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  *_retval = key1.Equals(key2, nsCaseInsensitiveCStringComparator);</span>
<a href="#l13.14"></a><span id="l13.14"> </span>
<a href="#l13.15"></a><span id="l13.15">   return rv;</span>
<a href="#l13.16"></a><span id="l13.16"> }</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18"> NS_IMETHODIMP</span>
<a href="#l13.19"></a><span id="l13.19"> nsMsgIncomingServer::ClearAllValues() {</span>
<a href="#l13.20"></a><span id="l13.20">   if (!mPrefBranch) return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -1174,17 +1174,17 @@ nsMsgIncomingServer::SetHostName(const n</span>
<a href="#l13.23"></a><span id="l13.23"> NS_IMETHODIMP</span>
<a href="#l13.24"></a><span id="l13.24"> nsMsgIncomingServer::SetRealHostName(const nsACString &amp;aHostname) {</span>
<a href="#l13.25"></a><span id="l13.25">   nsCString oldName;</span>
<a href="#l13.26"></a><span id="l13.26">   nsresult rv = GetRealHostName(oldName);</span>
<a href="#l13.27"></a><span id="l13.27">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.28"></a><span id="l13.28">   rv = InternalSetHostName(aHostname, &quot;realhostname&quot;);</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">   // A few things to take care of if we're changing the hostname.</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-  if (!aHostname.Equals(oldName, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+  if (!aHostname.Equals(oldName, nsCaseInsensitiveCStringComparator))</span>
<a href="#l13.33"></a><span id="l13.33">     rv = OnUserOrHostNameChanged(oldName, aHostname, true);</span>
<a href="#l13.34"></a><span id="l13.34">   return rv;</span>
<a href="#l13.35"></a><span id="l13.35"> }</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37"> NS_IMETHODIMP</span>
<a href="#l13.38"></a><span id="l13.38"> nsMsgIncomingServer::GetHostName(nsACString &amp;aResult) {</span>
<a href="#l13.39"></a><span id="l13.39">   nsresult rv;</span>
<a href="#l13.40"></a><span id="l13.40">   rv = GetCharValue(&quot;hostname&quot;, aResult);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -348,19 +348,19 @@ nsresult nsMsgAttachmentHandler::PickEnc</span>
<a href="#l14.4"></a><span id="l14.4">       // blow up.</span>
<a href="#l14.5"></a><span id="l14.5">       encode_p = true;</span>
<a href="#l14.6"></a><span id="l14.6">     } else {</span>
<a href="#l14.7"></a><span id="l14.7">       encode_p = false;</span>
<a href="#l14.8"></a><span id="l14.8">     }</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">     // MIME requires a special case that these types never be encoded.</span>
<a href="#l14.11"></a><span id="l14.11">     if (StringBeginsWith(m_type, NS_LITERAL_CSTRING(&quot;message&quot;),</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-                         nsCaseInsensitiveCStringComparator()) ||</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+                         nsCaseInsensitiveCStringComparator) ||</span>
<a href="#l14.14"></a><span id="l14.14">         StringBeginsWith(m_type, NS_LITERAL_CSTRING(&quot;multipart&quot;),</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-                         nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+                         nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l14.17"></a><span id="l14.17">       encode_p = false;</span>
<a href="#l14.18"></a><span id="l14.18">       if (m_desiredType.LowerCaseEqualsLiteral(TEXT_PLAIN))</span>
<a href="#l14.19"></a><span id="l14.19">         m_desiredType.Truncate();</span>
<a href="#l14.20"></a><span id="l14.20">     }</span>
<a href="#l14.21"></a><span id="l14.21"> </span>
<a href="#l14.22"></a><span id="l14.22">     // If the Mail charset is multibyte, we force it to use Base64 for</span>
<a href="#l14.23"></a><span id="l14.23">     // attachments.</span>
<a href="#l14.24"></a><span id="l14.24">     if ((!mMainBody &amp;&amp; charset &amp;&amp; nsMsgI18Nmultibyte_charset(charset)) &amp;&amp;</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineat">@@ -449,17 +449,17 @@ DONE:</span>
<a href="#l14.26"></a><span id="l14.26">       m_type = TEXT_PLAIN;</span>
<a href="#l14.27"></a><span id="l14.27">   }</span>
<a href="#l14.28"></a><span id="l14.28">   return NS_OK;</span>
<a href="#l14.29"></a><span id="l14.29"> }</span>
<a href="#l14.30"></a><span id="l14.30"> </span>
<a href="#l14.31"></a><span id="l14.31"> nsresult nsMsgAttachmentHandler::PickCharset() {</span>
<a href="#l14.32"></a><span id="l14.32">   if (!m_charset.IsEmpty() ||</span>
<a href="#l14.33"></a><span id="l14.33">       !StringBeginsWith(m_type, NS_LITERAL_CSTRING(&quot;text/&quot;),</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-                        nsCaseInsensitiveCStringComparator()))</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+                        nsCaseInsensitiveCStringComparator))</span>
<a href="#l14.36"></a><span id="l14.36">     return NS_OK;</span>
<a href="#l14.37"></a><span id="l14.37"> </span>
<a href="#l14.38"></a><span id="l14.38">   if (!mTmpFile) return NS_OK;</span>
<a href="#l14.39"></a><span id="l14.39"> </span>
<a href="#l14.40"></a><span id="l14.40">   return MsgDetectCharsetFromFile(mTmpFile, m_charset);</span>
<a href="#l14.41"></a><span id="l14.41"> }</span>
<a href="#l14.42"></a><span id="l14.42"> </span>
<a href="#l14.43"></a><span id="l14.43"> static nsresult FetcherURLDoneCallback(nsresult aStatus,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1178,27 +1178,27 @@ void msg_pick_real_name(nsMsgAttachmentH</span>
<a href="#l15.4"></a><span id="l15.4">     if (NS_FAILED(rv)) return;</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6">     s = url.get();</span>
<a href="#l15.7"></a><span id="l15.7">     s2 = PL_strchr(s, ':');</span>
<a href="#l15.8"></a><span id="l15.8">     if (s2) s = s2 + 1;</span>
<a href="#l15.9"></a><span id="l15.9">     // If we know the URL doesn't have a sensible file name in it,</span>
<a href="#l15.10"></a><span id="l15.10">     // don't bother emitting a content-disposition.</span>
<a href="#l15.11"></a><span id="l15.11">     if (StringBeginsWith(url, NS_LITERAL_CSTRING(&quot;news:&quot;),</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-                         nsCaseInsensitiveCStringComparator()) ||</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+                         nsCaseInsensitiveCStringComparator) ||</span>
<a href="#l15.14"></a><span id="l15.14">         StringBeginsWith(url, NS_LITERAL_CSTRING(&quot;snews:&quot;),</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-                         nsCaseInsensitiveCStringComparator()) ||</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+                         nsCaseInsensitiveCStringComparator) ||</span>
<a href="#l15.17"></a><span id="l15.17">         StringBeginsWith(url, NS_LITERAL_CSTRING(&quot;IMAP:&quot;),</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-                         nsCaseInsensitiveCStringComparator()) ||</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+                         nsCaseInsensitiveCStringComparator) ||</span>
<a href="#l15.20"></a><span id="l15.20">         StringBeginsWith(url, NS_LITERAL_CSTRING(&quot;mailbox:&quot;),</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-                         nsCaseInsensitiveCStringComparator()))</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+                         nsCaseInsensitiveCStringComparator))</span>
<a href="#l15.23"></a><span id="l15.23">       return;</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25">     if (StringBeginsWith(url, NS_LITERAL_CSTRING(&quot;data:&quot;),</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-                         nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+                         nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l15.28"></a><span id="l15.28">       int32_t endNonData = url.FindChar(',');</span>
<a href="#l15.29"></a><span id="l15.29">       if (endNonData == -1) return;</span>
<a href="#l15.30"></a><span id="l15.30">       nsCString nonDataPart(Substring(url, 5, endNonData - 5));</span>
<a href="#l15.31"></a><span id="l15.31">       int32_t filenamePos = nonDataPart.Find(&quot;filename=&quot;);</span>
<a href="#l15.32"></a><span id="l15.32">       if (filenamePos != -1) {</span>
<a href="#l15.33"></a><span id="l15.33">         filenamePos += 9;</span>
<a href="#l15.34"></a><span id="l15.34">         int32_t endFilename = nonDataPart.FindChar(';', filenamePos);</span>
<a href="#l15.35"></a><span id="l15.35">         if (endFilename == -1) endFilename = endNonData;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -251,23 +251,23 @@ bool nsMsgCompose::IsEmbeddedObjectSafe(</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5">   if (!objURL.IsEmpty()) {</span>
<a href="#l16.6"></a><span id="l16.6">     nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l16.7"></a><span id="l16.7">     rv = NS_NewURI(getter_AddRefs(uri), objURL);</span>
<a href="#l16.8"></a><span id="l16.8">     if (NS_SUCCEEDED(rv) &amp;&amp; uri) {</span>
<a href="#l16.9"></a><span id="l16.9">       nsAutoCString scheme;</span>
<a href="#l16.10"></a><span id="l16.10">       rv = uri-&gt;GetScheme(scheme);</span>
<a href="#l16.11"></a><span id="l16.11">       if (NS_SUCCEEDED(rv) &amp;&amp;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-          scheme.Equals(originalScheme, nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+          scheme.Equals(originalScheme, nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l16.14"></a><span id="l16.14">         nsAutoCString host;</span>
<a href="#l16.15"></a><span id="l16.15">         rv = uri-&gt;GetAsciiHost(host);</span>
<a href="#l16.16"></a><span id="l16.16">         // mailbox url don't have a host therefore don't be too strict.</span>
<a href="#l16.17"></a><span id="l16.17">         if (NS_SUCCEEDED(rv) &amp;&amp;</span>
<a href="#l16.18"></a><span id="l16.18">             (host.IsEmpty() || originalHost ||</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">-             host.Equals(originalHost, nsCaseInsensitiveCStringComparator()))) {</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+             host.Equals(originalHost, nsCaseInsensitiveCStringComparator))) {</span>
<a href="#l16.21"></a><span id="l16.21">           nsAutoCString path;</span>
<a href="#l16.22"></a><span id="l16.22">           rv = uri-&gt;GetPathQueryRef(path);</span>
<a href="#l16.23"></a><span id="l16.23">           if (NS_SUCCEEDED(rv)) {</span>
<a href="#l16.24"></a><span id="l16.24">             nsAutoCString orgPath(originalPath);</span>
<a href="#l16.25"></a><span id="l16.25">             MsgRemoveQueryPart(orgPath);</span>
<a href="#l16.26"></a><span id="l16.26">             MsgRemoveQueryPart(path);</span>
<a href="#l16.27"></a><span id="l16.27">             // mailbox: and JS Account URLs have a message number in</span>
<a href="#l16.28"></a><span id="l16.28">             // the query part of &quot;path query ref&quot;. We removed this so</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineat">@@ -276,17 +276,17 @@ bool nsMsgCompose::IsEmbeddedObjectSafe(</span>
<a href="#l16.30"></a><span id="l16.30">             // MsgComposeCommands.js that deals with unblocking images) will</span>
<a href="#l16.31"></a><span id="l16.31">             // prompt if a part of another message is referenced.</span>
<a href="#l16.32"></a><span id="l16.32">             // A saved message opened for reply or forwarding has a</span>
<a href="#l16.33"></a><span id="l16.33">             // mailbox: URL.</span>
<a href="#l16.34"></a><span id="l16.34">             // imap: URLs don't have the message number in the query, so we do</span>
<a href="#l16.35"></a><span id="l16.35">             // compare it here.</span>
<a href="#l16.36"></a><span id="l16.36">             // news: URLs use group and key in the query, but it's OK to compare</span>
<a href="#l16.37"></a><span id="l16.37">             // without them.</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-            return path.Equals(orgPath, nsCaseInsensitiveCStringComparator());</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+            return path.Equals(orgPath, nsCaseInsensitiveCStringComparator);</span>
<a href="#l16.40"></a><span id="l16.40">           }</span>
<a href="#l16.41"></a><span id="l16.41">         }</span>
<a href="#l16.42"></a><span id="l16.42">       }</span>
<a href="#l16.43"></a><span id="l16.43">     }</span>
<a href="#l16.44"></a><span id="l16.44">   }</span>
<a href="#l16.45"></a><span id="l16.45"> </span>
<a href="#l16.46"></a><span id="l16.46">   return false;</span>
<a href="#l16.47"></a><span id="l16.47"> }</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineat">@@ -2498,17 +2498,17 @@ QuotingOutputStreamListener::OnStopReque</span>
<a href="#l16.49"></a><span id="l16.49">           selfIdentity = lookupIdentity;</span>
<a href="#l16.50"></a><span id="l16.50"> </span>
<a href="#l16.51"></a><span id="l16.51">           nsCString curIdentityEmail;</span>
<a href="#l16.52"></a><span id="l16.52">           lookupIdentity-&gt;GetEmail(curIdentityEmail);</span>
<a href="#l16.53"></a><span id="l16.53"> </span>
<a href="#l16.54"></a><span id="l16.54">           // See if it's a reply to own message, but not a reply between</span>
<a href="#l16.55"></a><span id="l16.55">           // identities.</span>
<a href="#l16.56"></a><span id="l16.56">           if (curIdentityEmail.Equals(fromEmailAddress,</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-                                      nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+                                      nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l16.59"></a><span id="l16.59">             isReplyToSelf = true;</span>
<a href="#l16.60"></a><span id="l16.60">             // For a true reply-to-self, none of your identities are normally in</span>
<a href="#l16.61"></a><span id="l16.61">             // To or Cc. We need to avoid doing a reply-to-self for people that</span>
<a href="#l16.62"></a><span id="l16.62">             // have multiple identities set and sometimes *uses* the other</span>
<a href="#l16.63"></a><span id="l16.63">             // identity and sometimes *mails* the other identity.</span>
<a href="#l16.64"></a><span id="l16.64">             // E.g. husband+wife or own-email+company-role-mail.</span>
<a href="#l16.65"></a><span id="l16.65">             for (auto lookupIdentity2 : identities) {</span>
<a href="#l16.66"></a><span id="l16.66">               nsCString curIdentityEmail2;</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineat">@@ -2926,23 +2926,22 @@ bool IsInDomainList(const nsAString &amp;aDo</span>
<a href="#l16.68"></a><span id="l16.68">   // Check plain text domains.</span>
<a href="#l16.69"></a><span id="l16.69">   int32_t left = 0;</span>
<a href="#l16.70"></a><span id="l16.70">   int32_t right = 0;</span>
<a href="#l16.71"></a><span id="l16.71">   while (right != (int32_t)aDomainList.Length()) {</span>
<a href="#l16.72"></a><span id="l16.72">     right = aDomainList.FindChar(',', left);</span>
<a href="#l16.73"></a><span id="l16.73">     if (right == kNotFound) right = aDomainList.Length();</span>
<a href="#l16.74"></a><span id="l16.74">     nsDependentSubstring domain = Substring(aDomainList, left, right);</span>
<a href="#l16.75"></a><span id="l16.75"> </span>
<a href="#l16.76"></a><span id="l16.76" class="difflineminus">-    if (aDomain.Equals(domain, nsCaseInsensitiveStringComparator()))</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineminus">-      return true;</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+    if (aDomain.Equals(domain, nsCaseInsensitiveStringComparator)) return true;</span>
<a href="#l16.79"></a><span id="l16.79"> </span>
<a href="#l16.80"></a><span id="l16.80">     nsAutoString dotDomain;</span>
<a href="#l16.81"></a><span id="l16.81">     dotDomain.Assign(u'.');</span>
<a href="#l16.82"></a><span id="l16.82">     dotDomain.Append(domain);</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineminus">-    if (StringEndsWith(aDomain, dotDomain, nsCaseInsensitiveStringComparator()))</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+    if (StringEndsWith(aDomain, dotDomain, nsCaseInsensitiveStringComparator))</span>
<a href="#l16.85"></a><span id="l16.85">       return true;</span>
<a href="#l16.86"></a><span id="l16.86"> </span>
<a href="#l16.87"></a><span id="l16.87">     left = right + 1;</span>
<a href="#l16.88"></a><span id="l16.88">   }</span>
<a href="#l16.89"></a><span id="l16.89">   return false;</span>
<a href="#l16.90"></a><span id="l16.90"> }</span>
<a href="#l16.91"></a><span id="l16.91"> </span>
<a href="#l16.92"></a><span id="l16.92"> NS_IMPL_ISUPPORTS(QuotingOutputStreamListener,</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineat">@@ -4072,20 +4071,20 @@ nsresult nsMsgCompose::ProcessSignature(</span>
<a href="#l16.94"></a><span id="l16.94">             nsresult rv2;  // don't want to clobber the other rv</span>
<a href="#l16.95"></a><span id="l16.95">             nsCOMPtr&lt;nsIMIMEService&gt; mimeFinder(</span>
<a href="#l16.96"></a><span id="l16.96">                 do_GetService(NS_MIMESERVICE_CONTRACTID, &amp;rv2));</span>
<a href="#l16.97"></a><span id="l16.97">             if (NS_SUCCEEDED(rv2)) {</span>
<a href="#l16.98"></a><span id="l16.98">               rv2 = mimeFinder-&gt;GetTypeFromFile(sigFile, sigContentType);</span>
<a href="#l16.99"></a><span id="l16.99">               if (NS_SUCCEEDED(rv2)) {</span>
<a href="#l16.100"></a><span id="l16.100">                 if (StringBeginsWith(sigContentType,</span>
<a href="#l16.101"></a><span id="l16.101">                                      NS_LITERAL_CSTRING(&quot;image/&quot;),</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineminus">-                                     nsCaseInsensitiveCStringComparator()))</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+                                     nsCaseInsensitiveCStringComparator))</span>
<a href="#l16.104"></a><span id="l16.104">                   imageSig = true;</span>
<a href="#l16.105"></a><span id="l16.105">                 else if (sigContentType.Equals(</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineminus">-                             TEXT_HTML, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineplus">+                             TEXT_HTML, nsCaseInsensitiveCStringComparator))</span>
<a href="#l16.108"></a><span id="l16.108">                   htmlSig = true;</span>
<a href="#l16.109"></a><span id="l16.109">               }</span>
<a href="#l16.110"></a><span id="l16.110">             }</span>
<a href="#l16.111"></a><span id="l16.111">           }</span>
<a href="#l16.112"></a><span id="l16.112">         }</span>
<a href="#l16.113"></a><span id="l16.113">       }</span>
<a href="#l16.114"></a><span id="l16.114">     }</span>
<a href="#l16.115"></a><span id="l16.115">   }</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineat">@@ -4517,38 +4516,38 @@ struct nsMsgMailListComparator {</span>
<a href="#l16.117"></a><span id="l16.117">   //  1) &quot;mName &lt;mDescription&gt;&quot; when the list has a description</span>
<a href="#l16.118"></a><span id="l16.118">   //  2) &quot;mName &lt;mName&gt;&quot; when the list lacks description</span>
<a href="#l16.119"></a><span id="l16.119">   // A recipient is of the form &quot;mName &lt;mEmail&gt;&quot; - for equality the list</span>
<a href="#l16.120"></a><span id="l16.120">   // name must be the same. The recipient &quot;email&quot; must match the list name for</span>
<a href="#l16.121"></a><span id="l16.121">   // case 1, and the list description for case 2.</span>
<a href="#l16.122"></a><span id="l16.122">   bool Equals(const nsMsgMailList &amp;mailList,</span>
<a href="#l16.123"></a><span id="l16.123">               const nsMsgRecipient &amp;recipient) const {</span>
<a href="#l16.124"></a><span id="l16.124">     if (!mailList.mName.Equals(recipient.mName,</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineminus">-                               nsCaseInsensitiveStringComparator()))</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineplus">+                               nsCaseInsensitiveStringComparator))</span>
<a href="#l16.127"></a><span id="l16.127">       return false;</span>
<a href="#l16.128"></a><span id="l16.128">     return mailList.mDescription.IsEmpty()</span>
<a href="#l16.129"></a><span id="l16.129">                ? mailList.mName.Equals(recipient.mEmail,</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineminus">-                                       nsCaseInsensitiveStringComparator())</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineplus">+                                       nsCaseInsensitiveStringComparator)</span>
<a href="#l16.132"></a><span id="l16.132">                : mailList.mDescription.Equals(</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineminus">-                     recipient.mEmail, nsCaseInsensitiveStringComparator());</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineplus">+                     recipient.mEmail, nsCaseInsensitiveStringComparator);</span>
<a href="#l16.135"></a><span id="l16.135">   }</span>
<a href="#l16.136"></a><span id="l16.136"> };</span>
<a href="#l16.137"></a><span id="l16.137"> </span>
<a href="#l16.138"></a><span id="l16.138"> /**</span>
<a href="#l16.139"></a><span id="l16.139">  * Comparator for use with nsTArray::IndexOf to find a recipient.</span>
<a href="#l16.140"></a><span id="l16.140">  */</span>
<a href="#l16.141"></a><span id="l16.141"> struct nsMsgRecipientComparator {</span>
<a href="#l16.142"></a><span id="l16.142">   bool Equals(const nsMsgRecipient &amp;recipient,</span>
<a href="#l16.143"></a><span id="l16.143">               const nsMsgRecipient &amp;recipientToFind) const {</span>
<a href="#l16.144"></a><span id="l16.144">     if (!recipient.mEmail.Equals(recipientToFind.mEmail,</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineminus">-                                 nsCaseInsensitiveStringComparator()))</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineplus">+                                 nsCaseInsensitiveStringComparator))</span>
<a href="#l16.147"></a><span id="l16.147">       return false;</span>
<a href="#l16.148"></a><span id="l16.148"> </span>
<a href="#l16.149"></a><span id="l16.149">     if (!recipient.mName.Equals(recipientToFind.mName,</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineminus">-                                nsCaseInsensitiveStringComparator()))</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineplus">+                                nsCaseInsensitiveStringComparator))</span>
<a href="#l16.152"></a><span id="l16.152">       return false;</span>
<a href="#l16.153"></a><span id="l16.153"> </span>
<a href="#l16.154"></a><span id="l16.154">     return true;</span>
<a href="#l16.155"></a><span id="l16.155">   }</span>
<a href="#l16.156"></a><span id="l16.156"> };</span>
<a href="#l16.157"></a><span id="l16.157"> </span>
<a href="#l16.158"></a><span id="l16.158"> /**</span>
<a href="#l16.159"></a><span id="l16.159">  * This function recursively resolves a mailing list and returns individual</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineat">@@ -5008,17 +5007,17 @@ void nsMsgCompose::TagConvertible(Elemen</span>
<a href="#l16.161"></a><span id="l16.161"> </span>
<a href="#l16.162"></a><span id="l16.162">   // moz-* classes are used internally by the editor and mail composition</span>
<a href="#l16.163"></a><span id="l16.163">   // (like moz-cite-prefix or moz-signature). Those can be discarded.</span>
<a href="#l16.164"></a><span id="l16.164">   // But any other ones are unconvertible. Style can be attached to them or any</span>
<a href="#l16.165"></a><span id="l16.165">   // other context (e.g. in microformats).</span>
<a href="#l16.166"></a><span id="l16.166">   node-&gt;GetAttribute(NS_LITERAL_STRING(&quot;class&quot;), attribValue);</span>
<a href="#l16.167"></a><span id="l16.167">   if (!attribValue.IsEmpty()) {</span>
<a href="#l16.168"></a><span id="l16.168">     if (StringBeginsWith(attribValue, NS_LITERAL_STRING(&quot;moz-&quot;),</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineminus">-                         nsCaseInsensitiveStringComparator())) {</span>
<a href="#l16.170"></a><span id="l16.170" class="difflineplus">+                         nsCaseInsensitiveStringComparator)) {</span>
<a href="#l16.171"></a><span id="l16.171">       // We assume that anything with a moz-* class is convertible regardless of</span>
<a href="#l16.172"></a><span id="l16.172">       // the tag, because we add, for example, class=&quot;moz-signature&quot; to HTML</span>
<a href="#l16.173"></a><span id="l16.173">       // messages and we still want to be able to downgrade them.</span>
<a href="#l16.174"></a><span id="l16.174">       *_retval = nsIMsgCompConvertible::Plain;</span>
<a href="#l16.175"></a><span id="l16.175">     } else {</span>
<a href="#l16.176"></a><span id="l16.176">       *_retval = nsIMsgCompConvertible::No;</span>
<a href="#l16.177"></a><span id="l16.177">     }</span>
<a href="#l16.178"></a><span id="l16.178"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -860,17 +860,17 @@ nsresult nsSmtpProtocol::SendEhloRespons</span>
<a href="#l17.4"></a><span id="l17.4">       SetFlag(SMTP_EHLO_STARTTLS_ENABLED);</span>
<a href="#l17.5"></a><span id="l17.5">     } else if (responseLine.LowerCaseEqualsLiteral(&quot;dsn&quot;)) {</span>
<a href="#l17.6"></a><span id="l17.6">       SetFlag(SMTP_EHLO_DSN_ENABLED);</span>
<a href="#l17.7"></a><span id="l17.7">     } else if (responseLine.LowerCaseEqualsLiteral(&quot;clientid&quot;)) {</span>
<a href="#l17.8"></a><span id="l17.8">       SetFlag(SMTP_EHLO_CLIENTID_ENABLED);</span>
<a href="#l17.9"></a><span id="l17.9">       // If we have &quot;clientid&quot; in the ehlo response, then TLS must be present.</span>
<a href="#l17.10"></a><span id="l17.10">       if (m_prefSocketType == nsMsgSocketType::SSL) m_tlsEnabled = true;</span>
<a href="#l17.11"></a><span id="l17.11">     } else if (StringBeginsWith(responseLine, NS_LITERAL_CSTRING(&quot;AUTH&quot;),</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-                                nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+                                nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l17.14"></a><span id="l17.14">       SetFlag(SMTP_AUTH);</span>
<a href="#l17.15"></a><span id="l17.15"> </span>
<a href="#l17.16"></a><span id="l17.16">       if (responseLine.Find(NS_LITERAL_CSTRING(&quot;GSSAPI&quot;),</span>
<a href="#l17.17"></a><span id="l17.17">                             /* ignoreCase = */ true) &gt;= 0)</span>
<a href="#l17.18"></a><span id="l17.18">         SetFlag(SMTP_AUTH_GSSAPI_ENABLED);</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">       if (responseLine.Find(NS_LITERAL_CSTRING(&quot;CRAM-MD5&quot;),</span>
<a href="#l17.21"></a><span id="l17.21">                             /* ignoreCase = */ true) &gt;= 0)</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -895,22 +895,22 @@ nsresult nsSmtpProtocol::SendEhloRespons</span>
<a href="#l17.23"></a><span id="l17.23">       if (responseLine.Find(NS_LITERAL_CSTRING(&quot;EXTERNAL&quot;),</span>
<a href="#l17.24"></a><span id="l17.24">                             /* ignoreCase = */ true) &gt;= 0)</span>
<a href="#l17.25"></a><span id="l17.25">         SetFlag(SMTP_AUTH_EXTERNAL_ENABLED);</span>
<a href="#l17.26"></a><span id="l17.26"> </span>
<a href="#l17.27"></a><span id="l17.27">       if (responseLine.Find(NS_LITERAL_CSTRING(&quot;XOAUTH2&quot;),</span>
<a href="#l17.28"></a><span id="l17.28">                             /* ignoreCase = */ true) &gt;= 0)</span>
<a href="#l17.29"></a><span id="l17.29">         SetFlag(SMTP_AUTH_OAUTH2_ENABLED);</span>
<a href="#l17.30"></a><span id="l17.30">     } else if (StringBeginsWith(responseLine, NS_LITERAL_CSTRING(&quot;SIZE&quot;),</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-                                nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+                                nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l17.33"></a><span id="l17.33">       SetFlag(SMTP_EHLO_SIZE_ENABLED);</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35">       m_sizelimit = atol((responseLine.get()) + 4);</span>
<a href="#l17.36"></a><span id="l17.36">     } else if (StringBeginsWith(responseLine, NS_LITERAL_CSTRING(&quot;8BITMIME&quot;),</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-                                nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+                                nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l17.39"></a><span id="l17.39">       SetFlag(SMTP_EHLO_8BIT_ENABLED);</span>
<a href="#l17.40"></a><span id="l17.40">     }</span>
<a href="#l17.41"></a><span id="l17.41"> </span>
<a href="#l17.42"></a><span id="l17.42">     startPos = endPos + 1;</span>
<a href="#l17.43"></a><span id="l17.43">   } while (endPos &gt;= 0);</span>
<a href="#l17.44"></a><span id="l17.44"> </span>
<a href="#l17.45"></a><span id="l17.45">   if (TestFlag(SMTP_EHLO_SIZE_ENABLED) &amp;&amp; m_sizelimit &gt; 0 &amp;&amp;</span>
<a href="#l17.46"></a><span id="l17.46">       (int32_t)m_totalMessageSize &gt; m_sizelimit) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -131,17 +131,17 @@ nsSmtpServer::GetHostname(nsACString &amp;aH</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5"> NS_IMETHODIMP</span>
<a href="#l18.6"></a><span id="l18.6"> nsSmtpServer::SetHostname(const nsACString &amp;aHostname) {</span>
<a href="#l18.7"></a><span id="l18.7">   nsCString oldName;</span>
<a href="#l18.8"></a><span id="l18.8">   nsresult rv = GetHostname(oldName);</span>
<a href="#l18.9"></a><span id="l18.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">   // A few things to take care of if we're changing the hostname.</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  if (!oldName.Equals(aHostname, nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  if (!oldName.Equals(aHostname, nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l18.14"></a><span id="l18.14">     rv = OnUserOrHostNameChanged(oldName, aHostname, true);</span>
<a href="#l18.15"></a><span id="l18.15">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.16"></a><span id="l18.16">   }</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18">   if (!aHostname.IsEmpty())</span>
<a href="#l18.19"></a><span id="l18.19">     return mPrefBranch-&gt;SetCharPref(&quot;hostname&quot;, aHostname);</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21">   // If the pref value is already empty, ClearUserPref will return</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -663,21 +663,20 @@ bool nsSmtpService::findServerByHostname</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5">   nsCString username;</span>
<a href="#l19.6"></a><span id="l19.6">   rv = aServer-&gt;GetUsername(username);</span>
<a href="#l19.7"></a><span id="l19.7">   if (NS_FAILED(rv)) return true;</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">   bool checkHostname = !entry-&gt;hostname.IsEmpty();</span>
<a href="#l19.10"></a><span id="l19.10">   bool checkUsername = !entry-&gt;username.IsEmpty();</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  if ((!checkHostname ||</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-       (entry-&gt;hostname.Equals(hostname,</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-                               nsCaseInsensitiveCStringComparator()))) &amp;&amp;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-      (!checkUsername || entry-&gt;username.Equals(</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-                             username, nsCaseInsensitiveCStringComparator()))) {</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+  if ((!checkHostname || (entry-&gt;hostname.Equals(</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+                             hostname, nsCaseInsensitiveCStringComparator))) &amp;&amp;</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+      (!checkUsername ||</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+       entry-&gt;username.Equals(username, nsCaseInsensitiveCStringComparator))) {</span>
<a href="#l19.21"></a><span id="l19.21">     entry-&gt;server = aServer;</span>
<a href="#l19.22"></a><span id="l19.22">     return false;  // stop when found</span>
<a href="#l19.23"></a><span id="l19.23">   }</span>
<a href="#l19.24"></a><span id="l19.24">   return true;</span>
<a href="#l19.25"></a><span id="l19.25"> }</span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27"> NS_IMETHODIMP</span>
<a href="#l19.28"></a><span id="l19.28"> nsSmtpService::FindServer(const char *aUsername, const char *aHostname,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMailDatabase.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMailDatabase.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -37,17 +37,17 @@ nsMailDatabase::~nsMailDatabase() {}</span>
<a href="#l20.4"></a><span id="l20.4"> // of date. If so, they'll extract out the interesting info from the db, close</span>
<a href="#l20.5"></a><span id="l20.5"> // it, delete it, and then try to open the db again, prior to reparsing.</span>
<a href="#l20.6"></a><span id="l20.6"> nsresult nsMailDatabase::Open(nsMsgDBService *aDBService, nsIFile *aSummaryFile,</span>
<a href="#l20.7"></a><span id="l20.7">                               bool aCreate, bool aUpgrading) {</span>
<a href="#l20.8"></a><span id="l20.8"> #ifdef DEBUG</span>
<a href="#l20.9"></a><span id="l20.9">   nsString leafName;</span>
<a href="#l20.10"></a><span id="l20.10">   aSummaryFile-&gt;GetLeafName(leafName);</span>
<a href="#l20.11"></a><span id="l20.11">   if (!StringEndsWith(leafName, NS_LITERAL_STRING(SUMMARY_SUFFIX),</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-                      nsCaseInsensitiveStringComparator()))</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+                      nsCaseInsensitiveStringComparator))</span>
<a href="#l20.14"></a><span id="l20.14">     NS_ERROR(&quot;non summary file passed into open&quot;);</span>
<a href="#l20.15"></a><span id="l20.15"> #endif</span>
<a href="#l20.16"></a><span id="l20.16">   return nsMsgDatabase::Open(aDBService, aSummaryFile, aCreate, aUpgrading);</span>
<a href="#l20.17"></a><span id="l20.17"> }</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19"> NS_IMETHODIMP nsMailDatabase::ForceClosed() {</span>
<a href="#l20.20"></a><span id="l20.20">   m_mdbAllOfflineOpsTable = nullptr;</span>
<a href="#l20.21"></a><span id="l20.21">   return nsMsgDatabase::ForceClosed();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -91,18 +91,17 @@ NS_IMETHODIMP nsIMAPHostSessionList::Obs</span>
<a href="#l21.4"></a><span id="l21.4">   return NS_OK;</span>
<a href="#l21.5"></a><span id="l21.5"> }</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7"> nsIMAPHostInfo *nsIMAPHostSessionList::FindHost(const char *serverKey) {</span>
<a href="#l21.8"></a><span id="l21.8">   nsIMAPHostInfo *host;</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10">   // ### should also check userName here, if NON NULL</span>
<a href="#l21.11"></a><span id="l21.11">   for (host = fHostInfoList; host; host = host-&gt;fNextHost) {</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    if (host-&gt;fServerKey.Equals(serverKey,</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-                                nsCaseInsensitiveCStringComparator()))</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+    if (host-&gt;fServerKey.Equals(serverKey, nsCaseInsensitiveCStringComparator))</span>
<a href="#l21.15"></a><span id="l21.15">       return host;</span>
<a href="#l21.16"></a><span id="l21.16">   }</span>
<a href="#l21.17"></a><span id="l21.17">   return host;</span>
<a href="#l21.18"></a><span id="l21.18"> }</span>
<a href="#l21.19"></a><span id="l21.19"> </span>
<a href="#l21.20"></a><span id="l21.20"> // reset any cached connection info - delete the lot of 'em</span>
<a href="#l21.21"></a><span id="l21.21"> NS_IMETHODIMP nsIMAPHostSessionList::ResetAll() {</span>
<a href="#l21.22"></a><span id="l21.22">   PR_EnterMonitor(gCachedHostInfoMonitor);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -266,17 +266,17 @@ nsresult nsImapMailFolder::AddDirectoryS</span>
<a href="#l22.4"></a><span id="l22.4">     path-&gt;SetLeafName(leafName);</span>
<a href="#l22.5"></a><span id="l22.5">   }</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7">   return NS_OK;</span>
<a href="#l22.8"></a><span id="l22.8"> }</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10"> static bool nsShouldIgnoreFile(nsString &amp;name) {</span>
<a href="#l22.11"></a><span id="l22.11">   if (StringEndsWith(name, NS_LITERAL_STRING(SUMMARY_SUFFIX),</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-                     nsCaseInsensitiveStringComparator())) {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+                     nsCaseInsensitiveStringComparator)) {</span>
<a href="#l22.14"></a><span id="l22.14">     name.SetLength(name.Length() -</span>
<a href="#l22.15"></a><span id="l22.15">                    SUMMARY_SUFFIX_LENGTH);  // truncate the string</span>
<a href="#l22.16"></a><span id="l22.16">     return false;</span>
<a href="#l22.17"></a><span id="l22.17">   }</span>
<a href="#l22.18"></a><span id="l22.18">   return true;</span>
<a href="#l22.19"></a><span id="l22.19"> }</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21"> nsresult nsImapMailFolder::CreateChildFromURI(const nsCString &amp;uri,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -2354,20 +2354,20 @@ NS_IMETHODIMP nsImapProtocol::CanHandleU</span>
<a href="#l23.4"></a><span id="l23.4">     nsCString urlUserName;</span>
<a href="#l23.5"></a><span id="l23.5">     rv = server-&gt;GetHostName(urlHostName);</span>
<a href="#l23.6"></a><span id="l23.6">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.7"></a><span id="l23.7">     rv = server-&gt;GetUsername(urlUserName);</span>
<a href="#l23.8"></a><span id="l23.8">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10">     if ((GetImapHostName().IsEmpty() ||</span>
<a href="#l23.11"></a><span id="l23.11">          urlHostName.Equals(GetImapHostName(),</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-                            nsCaseInsensitiveCStringComparator())) &amp;&amp;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+                            nsCaseInsensitiveCStringComparator)) &amp;&amp;</span>
<a href="#l23.14"></a><span id="l23.14">         (GetImapUserName().IsEmpty() ||</span>
<a href="#l23.15"></a><span id="l23.15">          urlUserName.Equals(GetImapUserName(),</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))) {</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))) {</span>
<a href="#l23.18"></a><span id="l23.18">       if (isSelectedStateUrl) {</span>
<a href="#l23.19"></a><span id="l23.19">         if (inSelectedState) {</span>
<a href="#l23.20"></a><span id="l23.20">           // *** jt - in selected state can only run url with</span>
<a href="#l23.21"></a><span id="l23.21">           // matching foldername</span>
<a href="#l23.22"></a><span id="l23.22">           char *folderNameForProposedUrl = nullptr;</span>
<a href="#l23.23"></a><span id="l23.23">           rv = aImapUrl-&gt;CreateServerSourceFolderPathString(</span>
<a href="#l23.24"></a><span id="l23.24">               &amp;folderNameForProposedUrl);</span>
<a href="#l23.25"></a><span id="l23.25">           if (NS_SUCCEEDED(rv) &amp;&amp; folderNameForProposedUrl) {</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineat">@@ -4894,28 +4894,28 @@ void nsImapProtocol::DiscoverMailboxSpec</span>
<a href="#l23.27"></a><span id="l23.27">         }</span>
<a href="#l23.28"></a><span id="l23.28"> </span>
<a href="#l23.29"></a><span id="l23.29">         // Don't set the Trash flag if not using the Trash model</span>
<a href="#l23.30"></a><span id="l23.30">         if (GetDeleteIsMoveToTrash() &amp;&amp; !onlineTrashFolderExists &amp;&amp;</span>
<a href="#l23.31"></a><span id="l23.31">             adoptedBoxSpec-&gt;mAllocatedPathName.Find(</span>
<a href="#l23.32"></a><span id="l23.32">                 m_trashFolderPath, /* ignoreCase = */ true) != -1) {</span>
<a href="#l23.33"></a><span id="l23.33">           bool trashExists = false;</span>
<a href="#l23.34"></a><span id="l23.34">           if (StringBeginsWith(m_trashFolderPath, NS_LITERAL_CSTRING(&quot;INBOX/&quot;),</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">-                               nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineplus">+                               nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l23.37"></a><span id="l23.37">             nsAutoCString pathName(adoptedBoxSpec-&gt;mAllocatedPathName.get() +</span>
<a href="#l23.38"></a><span id="l23.38">                                    6);</span>
<a href="#l23.39"></a><span id="l23.39">             trashExists =</span>
<a href="#l23.40"></a><span id="l23.40">                 StringBeginsWith(</span>
<a href="#l23.41"></a><span id="l23.41">                     adoptedBoxSpec-&gt;mAllocatedPathName, m_trashFolderPath,</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineminus">-                    nsCaseInsensitiveCStringComparator()) &amp;&amp; /* &quot;INBOX/&quot; */</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineplus">+                    nsCaseInsensitiveCStringComparator) &amp;&amp; /* &quot;INBOX/&quot; */</span>
<a href="#l23.44"></a><span id="l23.44">                 pathName.Equals(Substring(m_trashFolderPath, 6),</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineminus">-                                nsCaseInsensitiveCStringComparator());</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineplus">+                                nsCaseInsensitiveCStringComparator);</span>
<a href="#l23.47"></a><span id="l23.47">           } else</span>
<a href="#l23.48"></a><span id="l23.48">             trashExists = adoptedBoxSpec-&gt;mAllocatedPathName.Equals(</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineminus">-                m_trashFolderPath, nsCaseInsensitiveCStringComparator());</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineplus">+                m_trashFolderPath, nsCaseInsensitiveCStringComparator);</span>
<a href="#l23.51"></a><span id="l23.51"> </span>
<a href="#l23.52"></a><span id="l23.52">           if (m_hostSessionList)</span>
<a href="#l23.53"></a><span id="l23.53">             m_hostSessionList-&gt;SetOnlineTrashFolderExistsForHost(</span>
<a href="#l23.54"></a><span id="l23.54">                 GetImapServerKey(), trashExists);</span>
<a href="#l23.55"></a><span id="l23.55"> </span>
<a href="#l23.56"></a><span id="l23.56">           if (trashExists) adoptedBoxSpec-&gt;mBoxFlags |= kImapTrash;</span>
<a href="#l23.57"></a><span id="l23.57">         }</span>
<a href="#l23.58"></a><span id="l23.58">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -1923,101 +1923,96 @@ void nsImapServerResponseParser::capabil</span>
<a href="#l24.4"></a><span id="l24.4">   fCapabilityFlag = kCapabilityDefined | kHasAuthOldLoginCapability;</span>
<a href="#l24.5"></a><span id="l24.5">   do {</span>
<a href="#l24.6"></a><span id="l24.6">     AdvanceToNextToken();</span>
<a href="#l24.7"></a><span id="l24.7">     if (fNextToken) {</span>
<a href="#l24.8"></a><span id="l24.8">       nsCString token(fNextToken);</span>
<a href="#l24.9"></a><span id="l24.9">       endToken = token.FindChar(']');</span>
<a href="#l24.10"></a><span id="l24.10">       if (endToken &gt;= 0) token.SetLength(endToken);</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-      if (token.Equals(&quot;AUTH=LOGIN&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+      if (token.Equals(&quot;AUTH=LOGIN&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.14"></a><span id="l24.14">         fCapabilityFlag |= kHasAuthLoginCapability;</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-      else if (token.Equals(&quot;AUTH=PLAIN&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+      else if (token.Equals(&quot;AUTH=PLAIN&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.17"></a><span id="l24.17">         fCapabilityFlag |= kHasAuthPlainCapability;</span>
<a href="#l24.18"></a><span id="l24.18">       else if (token.Equals(&quot;AUTH=CRAM-MD5&quot;,</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.21"></a><span id="l24.21">         fCapabilityFlag |= kHasCRAMCapability;</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-      else if (token.Equals(&quot;AUTH=NTLM&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+      else if (token.Equals(&quot;AUTH=NTLM&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.24"></a><span id="l24.24">         fCapabilityFlag |= kHasAuthNTLMCapability;</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">-      else if (token.Equals(&quot;AUTH=GSSAPI&quot;,</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineplus">+      else if (token.Equals(&quot;AUTH=GSSAPI&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.28"></a><span id="l24.28">         fCapabilityFlag |= kHasAuthGssApiCapability;</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">-      else if (token.Equals(&quot;AUTH=MSN&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+      else if (token.Equals(&quot;AUTH=MSN&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.31"></a><span id="l24.31">         fCapabilityFlag |= kHasAuthMSNCapability;</span>
<a href="#l24.32"></a><span id="l24.32">       else if (token.Equals(&quot;AUTH=EXTERNAL&quot;,</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.35"></a><span id="l24.35">         fCapabilityFlag |= kHasAuthExternalCapability;</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-      else if (token.Equals(&quot;AUTH=XOAUTH2&quot;,</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+      else if (token.Equals(&quot;AUTH=XOAUTH2&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.39"></a><span id="l24.39">         fCapabilityFlag |= kHasXOAuth2Capability;</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-      else if (token.Equals(&quot;STARTTLS&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+      else if (token.Equals(&quot;STARTTLS&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.42"></a><span id="l24.42">         fCapabilityFlag |= kHasStartTLSCapability;</span>
<a href="#l24.43"></a><span id="l24.43">       else if (token.Equals(&quot;LOGINDISABLED&quot;,</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.46"></a><span id="l24.46">         fCapabilityFlag &amp;= ~kHasAuthOldLoginCapability;  // remove flag</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineminus">-      else if (token.Equals(&quot;XSENDER&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineplus">+      else if (token.Equals(&quot;XSENDER&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.49"></a><span id="l24.49">         fCapabilityFlag |= kHasXSenderCapability;</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-      else if (token.Equals(&quot;IMAP4&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+      else if (token.Equals(&quot;IMAP4&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.52"></a><span id="l24.52">         fCapabilityFlag |= kIMAP4Capability;</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-      else if (token.Equals(&quot;IMAP4rev1&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+      else if (token.Equals(&quot;IMAP4rev1&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.55"></a><span id="l24.55">         fCapabilityFlag |= kIMAP4rev1Capability;</span>
<a href="#l24.56"></a><span id="l24.56">       else if (Substring(token, 0, 5)</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineminus">-                   .Equals(&quot;IMAP4&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+                   .Equals(&quot;IMAP4&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.59"></a><span id="l24.59">         fCapabilityFlag |= kIMAP4other;</span>
<a href="#l24.60"></a><span id="l24.60">       else if (token.Equals(&quot;X-NO-ATOMIC-RENAME&quot;,</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.63"></a><span id="l24.63">         fCapabilityFlag |= kNoHierarchyRename;</span>
<a href="#l24.64"></a><span id="l24.64">       else if (token.Equals(&quot;X-NON-HIERARCHICAL-RENAME&quot;,</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.67"></a><span id="l24.67">         fCapabilityFlag |= kNoHierarchyRename;</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineminus">-      else if (token.Equals(&quot;NAMESPACE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineplus">+      else if (token.Equals(&quot;NAMESPACE&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.70"></a><span id="l24.70">         fCapabilityFlag |= kNamespaceCapability;</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineminus">-      else if (token.Equals(&quot;ID&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineplus">+      else if (token.Equals(&quot;ID&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.73"></a><span id="l24.73">         fCapabilityFlag |= kHasIDCapability;</span>
<a href="#l24.74"></a><span id="l24.74" class="difflineminus">-      else if (token.Equals(&quot;ACL&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.75"></a><span id="l24.75" class="difflineplus">+      else if (token.Equals(&quot;ACL&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.76"></a><span id="l24.76">         fCapabilityFlag |= kACLCapability;</span>
<a href="#l24.77"></a><span id="l24.77" class="difflineminus">-      else if (token.Equals(&quot;XSERVERINFO&quot;,</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineplus">+      else if (token.Equals(&quot;XSERVERINFO&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.80"></a><span id="l24.80">         fCapabilityFlag |= kXServerInfoCapability;</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineminus">-      else if (token.Equals(&quot;UIDPLUS&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.82"></a><span id="l24.82" class="difflineplus">+      else if (token.Equals(&quot;UIDPLUS&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.83"></a><span id="l24.83">         fCapabilityFlag |= kUidplusCapability;</span>
<a href="#l24.84"></a><span id="l24.84" class="difflineminus">-      else if (token.Equals(&quot;LITERAL+&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.85"></a><span id="l24.85" class="difflineplus">+      else if (token.Equals(&quot;LITERAL+&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.86"></a><span id="l24.86">         fCapabilityFlag |= kLiteralPlusCapability;</span>
<a href="#l24.87"></a><span id="l24.87" class="difflineminus">-      else if (token.Equals(&quot;XAOL-OPTION&quot;,</span>
<a href="#l24.88"></a><span id="l24.88" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.89"></a><span id="l24.89" class="difflineplus">+      else if (token.Equals(&quot;XAOL-OPTION&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.90"></a><span id="l24.90">         fCapabilityFlag |= kAOLImapCapability;</span>
<a href="#l24.91"></a><span id="l24.91" class="difflineminus">-      else if (token.Equals(&quot;X-GM-EXT-1&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.92"></a><span id="l24.92" class="difflineplus">+      else if (token.Equals(&quot;X-GM-EXT-1&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.93"></a><span id="l24.93">         fCapabilityFlag |= kGmailImapCapability;</span>
<a href="#l24.94"></a><span id="l24.94" class="difflineminus">-      else if (token.Equals(&quot;QUOTA&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.95"></a><span id="l24.95" class="difflineplus">+      else if (token.Equals(&quot;QUOTA&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.96"></a><span id="l24.96">         fCapabilityFlag |= kQuotaCapability;</span>
<a href="#l24.97"></a><span id="l24.97" class="difflineminus">-      else if (token.Equals(&quot;LANGUAGE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.98"></a><span id="l24.98" class="difflineplus">+      else if (token.Equals(&quot;LANGUAGE&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.99"></a><span id="l24.99">         fCapabilityFlag |= kHasLanguageCapability;</span>
<a href="#l24.100"></a><span id="l24.100" class="difflineminus">-      else if (token.Equals(&quot;IDLE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.101"></a><span id="l24.101" class="difflineplus">+      else if (token.Equals(&quot;IDLE&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.102"></a><span id="l24.102">         fCapabilityFlag |= kHasIdleCapability;</span>
<a href="#l24.103"></a><span id="l24.103" class="difflineminus">-      else if (token.Equals(&quot;CONDSTORE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.104"></a><span id="l24.104" class="difflineplus">+      else if (token.Equals(&quot;CONDSTORE&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.105"></a><span id="l24.105">         fCapabilityFlag |= kHasCondStoreCapability;</span>
<a href="#l24.106"></a><span id="l24.106" class="difflineminus">-      else if (token.Equals(&quot;ENABLE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.107"></a><span id="l24.107" class="difflineplus">+      else if (token.Equals(&quot;ENABLE&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.108"></a><span id="l24.108">         fCapabilityFlag |= kHasEnableCapability;</span>
<a href="#l24.109"></a><span id="l24.109">       else if (token.Equals(&quot;LIST-EXTENDED&quot;,</span>
<a href="#l24.110"></a><span id="l24.110" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.111"></a><span id="l24.111" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.112"></a><span id="l24.112">         fCapabilityFlag |= kHasListExtendedCapability;</span>
<a href="#l24.113"></a><span id="l24.113" class="difflineminus">-      else if (token.Equals(&quot;XLIST&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.114"></a><span id="l24.114" class="difflineplus">+      else if (token.Equals(&quot;XLIST&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.115"></a><span id="l24.115">         fCapabilityFlag |= kHasXListCapability;</span>
<a href="#l24.116"></a><span id="l24.116" class="difflineminus">-      else if (token.Equals(&quot;SPECIAL-USE&quot;,</span>
<a href="#l24.117"></a><span id="l24.117" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.118"></a><span id="l24.118" class="difflineplus">+      else if (token.Equals(&quot;SPECIAL-USE&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.119"></a><span id="l24.119">         fCapabilityFlag |= kHasSpecialUseCapability;</span>
<a href="#l24.120"></a><span id="l24.120">       else if (token.Equals(&quot;COMPRESS=DEFLATE&quot;,</span>
<a href="#l24.121"></a><span id="l24.121" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.122"></a><span id="l24.122" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.123"></a><span id="l24.123">         fCapabilityFlag |= kHasCompressDeflateCapability;</span>
<a href="#l24.124"></a><span id="l24.124" class="difflineminus">-      else if (token.Equals(&quot;MOVE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.125"></a><span id="l24.125" class="difflineplus">+      else if (token.Equals(&quot;MOVE&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.126"></a><span id="l24.126">         fCapabilityFlag |= kHasMoveCapability;</span>
<a href="#l24.127"></a><span id="l24.127">       else if (token.Equals(&quot;HIGHESTMODSEQ&quot;,</span>
<a href="#l24.128"></a><span id="l24.128" class="difflineminus">-                            nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.129"></a><span id="l24.129" class="difflineplus">+                            nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.130"></a><span id="l24.130">         fCapabilityFlag |= kHasHighestModSeqCapability;</span>
<a href="#l24.131"></a><span id="l24.131" class="difflineminus">-      else if (token.Equals(&quot;CLIENTID&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l24.132"></a><span id="l24.132" class="difflineplus">+      else if (token.Equals(&quot;CLIENTID&quot;, nsCaseInsensitiveCStringComparator))</span>
<a href="#l24.133"></a><span id="l24.133">         fCapabilityFlag |= kHasClientIDCapability;</span>
<a href="#l24.134"></a><span id="l24.134">     }</span>
<a href="#l24.135"></a><span id="l24.135">   } while (fNextToken &amp;&amp; endToken &lt; 0 &amp;&amp; !fAtEndOfLine &amp;&amp; ContinueParse());</span>
<a href="#l24.136"></a><span id="l24.136"> </span>
<a href="#l24.137"></a><span id="l24.137">   nsImapProtocol *navCon = &amp;fServerConnection;</span>
<a href="#l24.138"></a><span id="l24.138">   NS_ASSERTION(navCon,</span>
<a href="#l24.139"></a><span id="l24.139">                &quot;null imap protocol connection while parsing capability &quot;</span>
<a href="#l24.140"></a><span id="l24.140">                &quot;response&quot;);  // we should always have this</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -1518,17 +1518,17 @@ void CMapiFolderList::EnsureUniqueName(C</span>
<a href="#l25.4"></a><span id="l25.4">   pFolder-&gt;GetDisplayName(name);</span>
<a href="#l25.5"></a><span id="l25.5">   do {</span>
<a href="#l25.6"></a><span id="l25.6">     done = TRUE;</span>
<a href="#l25.7"></a><span id="l25.7">     i = m_array.Length() - 1;</span>
<a href="#l25.8"></a><span id="l25.8">     while (i &gt;= 0) {</span>
<a href="#l25.9"></a><span id="l25.9">       pCurrent = GetAt(i);</span>
<a href="#l25.10"></a><span id="l25.10">       if (pCurrent-&gt;GetDepth() == pFolder-&gt;GetDepth()) {</span>
<a href="#l25.11"></a><span id="l25.11">         pCurrent-&gt;GetDisplayName(cName);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        if (cName.Equals(name, nsCaseInsensitiveStringComparator())) {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+        if (cName.Equals(name, nsCaseInsensitiveStringComparator)) {</span>
<a href="#l25.14"></a><span id="l25.14">           ChangeName(name);</span>
<a href="#l25.15"></a><span id="l25.15">           pFolder-&gt;SetDisplayName(name.get());</span>
<a href="#l25.16"></a><span id="l25.16">           done = FALSE;</span>
<a href="#l25.17"></a><span id="l25.17">           break;</span>
<a href="#l25.18"></a><span id="l25.18">         }</span>
<a href="#l25.19"></a><span id="l25.19">       } else if (pCurrent-&gt;GetDepth() &lt; pFolder-&gt;GetDepth())</span>
<a href="#l25.20"></a><span id="l25.20">         break;</span>
<a href="#l25.21"></a><span id="l25.21">       i--;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/intl/nsCharsetAlias.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/intl/nsCharsetAlias.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -57,17 +57,17 @@ nsresult nsCharsetAlias::GetPreferred(co</span>
<a href="#l26.4"></a><span id="l26.4"> }</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6"> //--------------------------------------------------------------</span>
<a href="#l26.7"></a><span id="l26.7"> // static</span>
<a href="#l26.8"></a><span id="l26.8"> nsresult nsCharsetAlias::Equals(const nsACString&amp; aCharset1,</span>
<a href="#l26.9"></a><span id="l26.9">                                 const nsACString&amp; aCharset2, bool* oResult) {</span>
<a href="#l26.10"></a><span id="l26.10">   nsresult res = NS_OK;</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  if (aCharset1.Equals(aCharset2, nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+  if (aCharset1.Equals(aCharset2, nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l26.14"></a><span id="l26.14">     *oResult = true;</span>
<a href="#l26.15"></a><span id="l26.15">     return res;</span>
<a href="#l26.16"></a><span id="l26.16">   }</span>
<a href="#l26.17"></a><span id="l26.17"> </span>
<a href="#l26.18"></a><span id="l26.18">   if (aCharset1.IsEmpty() || aCharset2.IsEmpty()) {</span>
<a href="#l26.19"></a><span id="l26.19">     *oResult = false;</span>
<a href="#l26.20"></a><span id="l26.20">     return res;</span>
<a href="#l26.21"></a><span id="l26.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1905,17 +1905,17 @@ NS_IMETHODIMP nsParseNewMailState::Apply</span>
<a href="#l27.4"></a><span id="l27.4">           msgIsNew = false;</span>
<a href="#l27.5"></a><span id="l27.5">         }</span>
<a href="#l27.6"></a><span id="l27.6">           // FALLTHROUGH</span>
<a href="#l27.7"></a><span id="l27.7">           [[fallthrough]];</span>
<a href="#l27.8"></a><span id="l27.8">         case nsMsgFilterAction::MoveToFolder: {</span>
<a href="#l27.9"></a><span id="l27.9">           // if moving to a different file, do it.</span>
<a href="#l27.10"></a><span id="l27.10">           if (!actionTargetFolderUri.IsEmpty() &amp;&amp;</span>
<a href="#l27.11"></a><span id="l27.11">               !m_inboxUri.Equals(actionTargetFolderUri,</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-                                 nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+                                 nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l27.14"></a><span id="l27.14">             nsCOMPtr&lt;nsIMsgFolder&gt; destIFolder;</span>
<a href="#l27.15"></a><span id="l27.15">             // XXX TODO: why do we create the folder here, while we do not in</span>
<a href="#l27.16"></a><span id="l27.16">             // the Copy action?</span>
<a href="#l27.17"></a><span id="l27.17">             rv = GetOrCreateFolder(actionTargetFolderUri,</span>
<a href="#l27.18"></a><span id="l27.18">                                    getter_AddRefs(destIFolder));</span>
<a href="#l27.19"></a><span id="l27.19">             if (NS_FAILED(rv)) {</span>
<a href="#l27.20"></a><span id="l27.20">               MOZ_LOG(FILTERLOGMODULE, LogLevel::Error,</span>
<a href="#l27.21"></a><span id="l27.21">                       (&quot;(Local) Target Folder for Move action does not exist&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -128,17 +128,17 @@ nsresult nsPop3Sink::FindPartialMessages</span>
<a href="#l28.4"></a><span id="l28.4">       }</span>
<a href="#l28.5"></a><span id="l28.5">       rv = localFolder-&gt;GetUidlFromFolder(&amp;folderScanState, msgDBHdr);</span>
<a href="#l28.6"></a><span id="l28.6">       if (!NS_SUCCEEDED(rv)) break;</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8">       // If we got the uidl, see if this partial message belongs to this</span>
<a href="#l28.9"></a><span id="l28.9">       // account. Add it to the array if so...</span>
<a href="#l28.10"></a><span id="l28.10">       if (folderScanState.m_uidl &amp;&amp;</span>
<a href="#l28.11"></a><span id="l28.11">           m_accountKey.Equals(folderScanState.m_accountKey,</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-                              nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+                              nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l28.14"></a><span id="l28.14">         partialRecord *partialMsg = new partialRecord();</span>
<a href="#l28.15"></a><span id="l28.15">         if (partialMsg) {</span>
<a href="#l28.16"></a><span id="l28.16">           partialMsg-&gt;m_uidl = folderScanState.m_uidl;</span>
<a href="#l28.17"></a><span id="l28.17">           partialMsg-&gt;m_msgDBHdr = msgDBHdr;</span>
<a href="#l28.18"></a><span id="l28.18">           m_partialMsgsArray.AppendElement(partialMsg);</span>
<a href="#l28.19"></a><span id="l28.19">         }</span>
<a href="#l28.20"></a><span id="l28.20">       }</span>
<a href="#l28.21"></a><span id="l28.21">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -134,17 +134,17 @@ nsresult ProcessBodyAsAttachment(MimeObj</span>
<a href="#l29.4"></a><span id="l29.4">       tmp-&gt;m_realName = &quot;AttachedMessage.eml&quot;;</span>
<a href="#l29.5"></a><span id="l29.5">     }</span>
<a href="#l29.6"></a><span id="l29.6">   }</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8">   tmp-&gt;m_hasFilename = !tmp-&gt;m_realName.IsEmpty();</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10">   if (tmp-&gt;m_realName.IsEmpty() &amp;&amp;</span>
<a href="#l29.11"></a><span id="l29.11">       StringBeginsWith(tmp-&gt;m_realType, NS_LITERAL_CSTRING(&quot;text&quot;),</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-                       nsCaseInsensitiveCStringComparator()))</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+                       nsCaseInsensitiveCStringComparator))</span>
<a href="#l29.14"></a><span id="l29.14">     ValidateRealName(tmp, child-&gt;headers);</span>
<a href="#l29.15"></a><span id="l29.15"> </span>
<a href="#l29.16"></a><span id="l29.16">   tmp-&gt;m_displayableInline =</span>
<a href="#l29.17"></a><span id="l29.17">       obj-&gt;clazz-&gt;displayable_inline_p(obj-&gt;clazz, obj-&gt;headers);</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19">   char *tmpURL = nullptr;</span>
<a href="#l29.20"></a><span id="l29.20">   char *id = nullptr;</span>
<a href="#l29.21"></a><span id="l29.21">   char *id_imap = nullptr;</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineat">@@ -214,17 +214,17 @@ void ValidateRealName(nsMsgAttachmentDat</span>
<a href="#l29.23"></a><span id="l29.23">   if (!aAttach) return;</span>
<a href="#l29.24"></a><span id="l29.24"> </span>
<a href="#l29.25"></a><span id="l29.25">   // Do we need to validate?</span>
<a href="#l29.26"></a><span id="l29.26">   if (!aAttach-&gt;m_realName.IsEmpty()) return;</span>
<a href="#l29.27"></a><span id="l29.27"> </span>
<a href="#l29.28"></a><span id="l29.28">   // Internal MIME structures need not be named!</span>
<a href="#l29.29"></a><span id="l29.29">   if (aAttach-&gt;m_realType.IsEmpty() ||</span>
<a href="#l29.30"></a><span id="l29.30">       StringBeginsWith(aAttach-&gt;m_realType, NS_LITERAL_CSTRING(&quot;multipart&quot;),</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-                       nsCaseInsensitiveCStringComparator()))</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+                       nsCaseInsensitiveCStringComparator))</span>
<a href="#l29.33"></a><span id="l29.33">     return;</span>
<a href="#l29.34"></a><span id="l29.34"> </span>
<a href="#l29.35"></a><span id="l29.35">   //</span>
<a href="#l29.36"></a><span id="l29.36">   // Now validate any other name we have for the attachment!</span>
<a href="#l29.37"></a><span id="l29.37">   //</span>
<a href="#l29.38"></a><span id="l29.38">   if (aAttach-&gt;m_realName.IsEmpty()) {</span>
<a href="#l29.39"></a><span id="l29.39">     aAttach-&gt;m_realName = &quot;attachment&quot;;</span>
<a href="#l29.40"></a><span id="l29.40">     nsresult rv = NS_OK;</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineat">@@ -297,17 +297,17 @@ nsresult GenerateAttachmentData(MimeObje</span>
<a href="#l29.42"></a><span id="l29.42">   nsMsgAttachmentData *tmp = &amp;(aAttachData[attIndex++]);</span>
<a href="#l29.43"></a><span id="l29.43"> </span>
<a href="#l29.44"></a><span id="l29.44">   tmp-&gt;m_realType = object-&gt;content_type;</span>
<a href="#l29.45"></a><span id="l29.45">   tmp-&gt;m_realEncoding = object-&gt;encoding;</span>
<a href="#l29.46"></a><span id="l29.46">   tmp-&gt;m_isExternalAttachment = isExternalAttachment;</span>
<a href="#l29.47"></a><span id="l29.47">   tmp-&gt;m_isExternalLinkAttachment =</span>
<a href="#l29.48"></a><span id="l29.48">       (isExternalAttachment &amp;&amp;</span>
<a href="#l29.49"></a><span id="l29.49">        StringBeginsWith(urlString, NS_LITERAL_CSTRING(&quot;http&quot;),</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-                        nsCaseInsensitiveCStringComparator()));</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineplus">+                        nsCaseInsensitiveCStringComparator));</span>
<a href="#l29.52"></a><span id="l29.52">   tmp-&gt;m_size = attSize;</span>
<a href="#l29.53"></a><span id="l29.53">   tmp-&gt;m_sizeExternalStr = &quot;-1&quot;;</span>
<a href="#l29.54"></a><span id="l29.54">   tmp-&gt;m_disposition.Adopt(MimeHeaders_get(</span>
<a href="#l29.55"></a><span id="l29.55">       object-&gt;headers, HEADER_CONTENT_DISPOSITION, true, false));</span>
<a href="#l29.56"></a><span id="l29.56">   tmp-&gt;m_displayableInline =</span>
<a href="#l29.57"></a><span id="l29.57">       object-&gt;clazz-&gt;displayable_inline_p(object-&gt;clazz, object-&gt;headers);</span>
<a href="#l29.58"></a><span id="l29.58"> </span>
<a href="#l29.59"></a><span id="l29.59">   char *part_addr = mime_imap_part_address(object);</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineat">@@ -426,17 +426,17 @@ nsresult GenerateAttachmentData(MimeObje</span>
<a href="#l29.61"></a><span id="l29.61">     nsAutoCString aResult;</span>
<a href="#l29.62"></a><span id="l29.62">     if (NS_SUCCEEDED(MsgEscapeString(tmp-&gt;m_realName,</span>
<a href="#l29.63"></a><span id="l29.63">                                      nsINetUtil::ESCAPE_XALPHAS, aResult)))</span>
<a href="#l29.64"></a><span id="l29.64">       urlString.Append(aResult);</span>
<a href="#l29.65"></a><span id="l29.65">     else</span>
<a href="#l29.66"></a><span id="l29.66">       urlString.Append(tmp-&gt;m_realName);</span>
<a href="#l29.67"></a><span id="l29.67">     if (tmp-&gt;m_realType.EqualsLiteral(&quot;message/rfc822&quot;) &amp;&amp;</span>
<a href="#l29.68"></a><span id="l29.68">         !StringEndsWith(urlString, NS_LITERAL_CSTRING(&quot;.eml&quot;),</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineminus">-                        nsCaseInsensitiveCStringComparator()))</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineplus">+                        nsCaseInsensitiveCStringComparator))</span>
<a href="#l29.71"></a><span id="l29.71">       urlString.AppendLiteral(&quot;.eml&quot;);</span>
<a href="#l29.72"></a><span id="l29.72">   } else if (tmp-&gt;m_isExternalAttachment) {</span>
<a href="#l29.73"></a><span id="l29.73">     // Allows the JS mime emitter to figure out the part information.</span>
<a href="#l29.74"></a><span id="l29.74">     urlString.AppendLiteral(&quot;?part=&quot;);</span>
<a href="#l29.75"></a><span id="l29.75">     urlString.Append(part);</span>
<a href="#l29.76"></a><span id="l29.76">   } else if (tmp-&gt;m_realType.LowerCaseEqualsLiteral(MESSAGE_RFC822)) {</span>
<a href="#l29.77"></a><span id="l29.77">     // Special case...if this is a enclosed RFC822 message, give it a nice</span>
<a href="#l29.78"></a><span id="l29.78">     // name.</span>
<a href="#l29.79"></a><span id="l29.79" class="difflineat">@@ -766,17 +766,17 @@ int ConvertToUTF8(const char *stringToUs</span>
<a href="#l29.80"></a><span id="l29.80">   nsCOMPtr&lt;nsICharsetConverterManager&gt; ccm =</span>
<a href="#l29.81"></a><span id="l29.81">       do_GetService(NS_CHARSETCONVERTERMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l29.82"></a><span id="l29.82">   NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l29.83"></a><span id="l29.83"> </span>
<a href="#l29.84"></a><span id="l29.84">   nsCString newCharset;</span>
<a href="#l29.85"></a><span id="l29.85">   rv = ccm-&gt;GetCharsetAlias(input_charset, newCharset);</span>
<a href="#l29.86"></a><span id="l29.86">   NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l29.87"></a><span id="l29.87"> </span>
<a href="#l29.88"></a><span id="l29.88" class="difflineminus">-  if (newCharset.Equals(&quot;UTF-7&quot;, nsCaseInsensitiveCStringComparator())) {</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineplus">+  if (newCharset.Equals(&quot;UTF-7&quot;, nsCaseInsensitiveCStringComparator)) {</span>
<a href="#l29.90"></a><span id="l29.90">     nsAutoString utf16;</span>
<a href="#l29.91"></a><span id="l29.91">     rv = CopyUTF7toUTF16(nsDependentCSubstring(stringToUse, inLength), utf16);</span>
<a href="#l29.92"></a><span id="l29.92">     if (NS_FAILED(rv)) return -1;</span>
<a href="#l29.93"></a><span id="l29.93">     CopyUTF16toUTF8(utf16, outString);</span>
<a href="#l29.94"></a><span id="l29.94">     return 0;</span>
<a href="#l29.95"></a><span id="l29.95">   }</span>
<a href="#l29.96"></a><span id="l29.96"> </span>
<a href="#l29.97"></a><span id="l29.97">   auto encoding = mozilla::Encoding::ForLabel(newCharset);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -3293,17 +3293,17 @@ void nsNNTPProtocol::CheckIfAuthor(nsIMs</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5">   nsCString us;</span>
<a href="#l30.6"></a><span id="l30.6">   nsCString them;</span>
<a href="#l30.7"></a><span id="l30.7">   ExtractEmail(EncodedHeader(from), us);</span>
<a href="#l30.8"></a><span id="l30.8">   ExtractEmail(EncodedHeader(aOldFrom), them);</span>
<a href="#l30.9"></a><span id="l30.9"> </span>
<a href="#l30.10"></a><span id="l30.10">   MOZ_LOG(NNTP, LogLevel::Info, (&quot;us = %s, them = %s&quot;, us.get(), them.get()));</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  if (us.Equals(them, nsCaseInsensitiveCStringComparator())) aFrom = from;</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+  if (us.Equals(them, nsCaseInsensitiveCStringComparator)) aFrom = from;</span>
<a href="#l30.14"></a><span id="l30.14"> }</span>
<a href="#l30.15"></a><span id="l30.15"> </span>
<a href="#l30.16"></a><span id="l30.16"> nsresult nsNNTPProtocol::DoCancel() {</span>
<a href="#l30.17"></a><span id="l30.17">   int32_t status = 0;</span>
<a href="#l30.18"></a><span id="l30.18">   bool failure = false;</span>
<a href="#l30.19"></a><span id="l30.19">   nsresult rv = NS_OK;</span>
<a href="#l30.20"></a><span id="l30.20">   bool requireConfirmationForCancel = true;</span>
<a href="#l30.21"></a><span id="l30.21">   bool showAlertAfterCancel = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -64,21 +64,21 @@</span>
<a href="#l31.4"></a><span id="l31.4"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6"> /**</span>
<a href="#l31.7"></a><span id="l31.7">  * A comparator class to do cases insensitive comparisons for nsTArray.Sort()</span>
<a href="#l31.8"></a><span id="l31.8">  */</span>
<a href="#l31.9"></a><span id="l31.9"> class nsCStringLowerCaseComparator {</span>
<a href="#l31.10"></a><span id="l31.10">  public:</span>
<a href="#l31.11"></a><span id="l31.11">   bool Equals(const nsCString &amp;a, const nsCString &amp;b) const {</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    return a.Equals(b, nsCaseInsensitiveCStringComparator());</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+    return a.Equals(b, nsCaseInsensitiveCStringComparator);</span>
<a href="#l31.14"></a><span id="l31.14">   }</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16">   bool LessThan(const nsCString &amp;a, const nsCString &amp;b) const {</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">-    return Compare(a, b, nsCaseInsensitiveCStringComparator()) &lt; 0;</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineplus">+    return Compare(a, b, nsCaseInsensitiveCStringComparator) &lt; 0;</span>
<a href="#l31.19"></a><span id="l31.19">   }</span>
<a href="#l31.20"></a><span id="l31.20"> };</span>
<a href="#l31.21"></a><span id="l31.21"> </span>
<a href="#l31.22"></a><span id="l31.22"> static NS_DEFINE_CID(kSubscribableServerCID, NS_SUBSCRIBABLESERVER_CID);</span>
<a href="#l31.23"></a><span id="l31.23"> </span>
<a href="#l31.24"></a><span id="l31.24"> NS_IMPL_ADDREF_INHERITED(nsNntpIncomingServer, nsMsgIncomingServer)</span>
<a href="#l31.25"></a><span id="l31.25"> NS_IMPL_RELEASE_INHERITED(nsNntpIncomingServer, nsMsgIncomingServer)</span>
<a href="#l31.26"></a><span id="l31.26"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

