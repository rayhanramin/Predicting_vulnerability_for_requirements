<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8982:30263aa049c5a5ffe8236518fde4fb222574868b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 30263aa049c5a5ffe8236518fde4fb222574868b" />
<meta property="og:url" content="/comm-central/rev/30263aa049c5a5ffe8236518fde4fb222574868b" />
<meta property="og:description" content="Bug 709737. Fix some issues in Thunderbird's test pilot - get notifications working, make sure test pilot looks and builds the same on all channels, remove the unnecessary preferences button. r+ui-review=bwinton" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 30263aa049c5a5ffe8236518fde4fb222574868b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/30263aa049c5a5ffe8236518fde4fb222574868b">shortlog</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/30263aa049c5a5ffe8236518fde4fb222574868b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/30263aa049c5a5ffe8236518fde4fb222574868b">files</a> |
changeset |
<a href="/comm-central/raw-rev/30263aa049c5a5ffe8236518fde4fb222574868b">raw</a>  | <a href="/comm-central/archive/30263aa049c5a5ffe8236518fde4fb222574868b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=709737">Bug 709737</a>. Fix some issues in Thunderbird's test pilot - get notifications working, make sure test pilot looks and builds the same on all channels, remove the unnecessary preferences button. r+ui-review=bwinton
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 15 Dec 2011 00:14:49 +0000</td></tr>

<tr>
 <td>changeset 8982</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/30263aa049c5a5ffe8236518fde4fb222574868b">30263aa049c5a5ffe8236518fde4fb222574868b</a></td>
</tr>



<tr>
<td>parent 8981</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5d1ce217c59310534f7ffa3751f6211aa17ec0b0">5d1ce217c59310534f7ffa3751f6211aa17ec0b0</a>
</td>
</tr>

<tr>
<td>child 8983</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d8c25e08ba23acd6fd66c8f4d057af33d615f6d1">d8c25e08ba23acd6fd66c8f4d057af33d615f6d1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=30263aa049c5a5ffe8236518fde4fb222574868b">6887</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 15 Dec 2011 00:33:50 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d8c25e08ba23 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d8c25e08ba23acd6fd66c8f4d057af33d615f6d1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d8c25e08ba23acd6fd66c8f4d057af33d615f6d1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d8c25e08ba23acd6fd66c8f4d057af33d615f6d1&newProject=comm-central&newRevision=30263aa049c5a5ffe8236518fde4fb222574868b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d8c25e08ba23acd6fd66c8f4d057af33d615f6d1&newProject=comm-central&newRevision=30263aa049c5a5ffe8236518fde4fb222574868b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d8c25e08ba23acd6fd66c8f4d057af33d615f6d1&newProject=comm-central&newRevision=30263aa049c5a5ffe8236518fde4fb222574868b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=709737">709737</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=709737">Bug 709737</a>. Fix some issues in Thunderbird's test pilot - get notifications working, make sure test pilot looks and builds the same on all channels, remove the unnecessary preferences button. r+ui-review=bwinton</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/Makefile.in">mail/app/profile/extensions/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/Makefile.in">file</a> |
<a href="/comm-central/annotate/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/Makefile.in">annotate</a> |
<a href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/Makefile.in">diff</a> |
<a href="/comm-central/comparison/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/Makefile.in">comparison</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/experiment-page.js">mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/content/experiment-page.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/experiment-page.js">file</a> |
<a href="/comm-central/annotate/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/experiment-page.js">annotate</a> |
<a href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/experiment-page.js">diff</a> |
<a href="/comm-central/comparison/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/experiment-page.js">comparison</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/experiment-page.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/tp-browser-customNotifications.xul">mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/content/tp-browser-customNotifications.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/tp-browser-customNotifications.xul">file</a> |
<a href="/comm-central/annotate/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/tp-browser-customNotifications.xul">annotate</a> |
<a href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/tp-browser-customNotifications.xul">diff</a> |
<a href="/comm-central/comparison/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/tp-browser-customNotifications.xul">comparison</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/content/tp-browser-customNotifications.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/install.rdf.in">mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/install.rdf.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/install.rdf.in">file</a> |
<a href="/comm-central/annotate/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/install.rdf.in">annotate</a> |
<a href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/install.rdf.in">diff</a> |
<a href="/comm-central/comparison/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/install.rdf.in">comparison</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/install.rdf.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js">mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/interface.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js">file</a> |
<a href="/comm-central/annotate/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js">annotate</a> |
<a href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js">diff</a> |
<a href="/comm-central/comparison/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js">comparison</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js.orig">mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/interface.js.orig</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js.orig">diff</a> |
<a href="/comm-central/comparison/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js.orig">comparison</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/interface.js.orig">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/notifications.js">mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/notifications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/notifications.js">file</a> |
<a href="/comm-central/annotate/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/notifications.js">annotate</a> |
<a href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/notifications.js">diff</a> |
<a href="/comm-central/comparison/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/notifications.js">comparison</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/notifications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/tasks.js">mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/tasks.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/tasks.js">file</a> |
<a href="/comm-central/annotate/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/tasks.js">annotate</a> |
<a href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/tasks.js">diff</a> |
<a href="/comm-central/comparison/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/tasks.js">comparison</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/modules/tasks.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/skin/all/notification-tail-down.png">mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/skin/all/notification-tail-down.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/skin/all/notification-tail-down.png">file</a> |
<a href="/comm-central/annotate/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/skin/all/notification-tail-down.png">annotate</a> |
<a href="/comm-central/diff/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/skin/all/notification-tail-down.png">diff</a> |
<a href="/comm-central/comparison/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/skin/all/notification-tail-down.png">comparison</a> |
<a href="/comm-central/log/30263aa049c5a5ffe8236518fde4fb222574868b/mail/app/profile/extensions/tbtestpilot%40labs.mozilla.com/skin/all/notification-tail-down.png">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/app/profile/extensions/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/app/profile/extensions/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -41,17 +41,16 @@ srcdir		= @srcdir@</span>
<a href="#l1.4"></a><span id="l1.4"> VPATH		= @srcdir@</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> DISTROEXT = $(call core_abspath,$(DIST))/bin/distribution/extensions</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> include $(topsrcdir)/config/rules.mk</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-ifneq (,$(filter nightly aurora beta,$(MOZ_UPDATE_CHANNEL)))</span>
<a href="#l1.13"></a><span id="l1.13"> EXTENSIONS = \</span>
<a href="#l1.14"></a><span id="l1.14">   tbtestpilot@labs.mozilla.com \</span>
<a href="#l1.15"></a><span id="l1.15">   $(NULL)</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> DEFINES += -DTHUNDERBIRD_VERSION=$(THUNDERBIRD_VERSION)</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> define _INSTALL_EXTENSION</span>
<a href="#l1.20"></a><span id="l1.20"> $(NSINSTALL) -D $(dir) &amp;&amp; \</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -61,9 +60,8 @@ define _INSTALL_EXTENSION</span>
<a href="#l1.22"></a><span id="l1.22">   cd $(call core_abspath,$(srcdir)/$(dir)) &amp;&amp; \</span>
<a href="#l1.23"></a><span id="l1.23">   $(ZIP) -r9XD $(DISTROEXT)/$(dir).xpi * -x install.rdf.in</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25"> endef # do not remove the blank line!</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27"> libs::</span>
<a href="#l1.28"></a><span id="l1.28"> 	$(NSINSTALL) -D $(DISTROEXT)</span>
<a href="#l1.29"></a><span id="l1.29"> 	$(foreach dir,$(EXTENSIONS),$(_INSTALL_EXTENSION))</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/content/experiment-page.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/content/experiment-page.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -197,25 +197,34 @@ var stringBundle;</span>
<a href="#l2.4"></a><span id="l2.4">         converter.init(foStream, &quot;UTF-8&quot;, 0, 0);</span>
<a href="#l2.5"></a><span id="l2.5">         converter.writeString(csvString);</span>
<a href="#l2.6"></a><span id="l2.6">         converter.close();</span>
<a href="#l2.7"></a><span id="l2.7">       });</span>
<a href="#l2.8"></a><span id="l2.8">     }</span>
<a href="#l2.9"></a><span id="l2.9">   }</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">   function openLink(url) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    // open the link in the chromeless window</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    let wm = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-                       .getService(Components.interfaces.nsIWindowMediator);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-    let recentWindow = wm.getMostRecentWindow(&quot;navigator:browser&quot;);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+    const THUNDERBIRD_APP_ID = &quot;{3550f703-e582-4d05-9a08-453d09bdfdc6}&quot;;</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-    if (recentWindow) {</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-      recentWindow.TestPilotWindowUtils.openInTab(url);</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-    } else {</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-      window.open(url);</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+    if (Application.id == THUNDERBIRD_APP_ID) {</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+      Components.classes[&quot;@mozilla.org/messenger;1&quot;]</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+                .createInstance(Components.interfaces.nsIMessenger)</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+                .launchExternalURL(url);</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+    }</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+    else {</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+      // open the link in the chromeless window</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+      let wm = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+                         .getService(Components.interfaces.nsIWindowMediator);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+      let recentWindow = wm.getMostRecentWindow(&quot;navigator:browser&quot;);</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+      if (recentWindow) {</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+        recentWindow.TestPilotWindowUtils.openInTab(url);</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+      } else {</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+        window.open(url);</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+      } </span>
<a href="#l2.38"></a><span id="l2.38">     }</span>
<a href="#l2.39"></a><span id="l2.39">   }</span>
<a href="#l2.40"></a><span id="l2.40"> </span>
<a href="#l2.41"></a><span id="l2.41">   function getTestEndingDate(experimentId) {</span>
<a href="#l2.42"></a><span id="l2.42">     Components.utils.import(&quot;resource://testpilot/modules/setup.js&quot;);</span>
<a href="#l2.43"></a><span id="l2.43">     var task = TestPilotSetup.getTaskById(experimentId);</span>
<a href="#l2.44"></a><span id="l2.44">     var endDate = new Date(task.endDate);</span>
<a href="#l2.45"></a><span id="l2.45">     var diff = (endDate - Date.now());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/content/tp-browser-customNotifications.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/content/tp-browser-customNotifications.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -49,25 +49,18 @@</span>
<a href="#l3.4"></a><span id="l3.4">     &lt;/menu&gt;</span>
<a href="#l3.5"></a><span id="l3.5">     &lt;menuitem label=&quot;&amp;testpilot.allYourStudies.label;&quot;</span>
<a href="#l3.6"></a><span id="l3.6">               oncommand=&quot;TestPilotWindowUtils.openAllStudiesWindow();&quot;/&gt;</span>
<a href="#l3.7"></a><span id="l3.7">     &lt;menuitem label=&quot;&amp;testpilot.about.label;&quot;</span>
<a href="#l3.8"></a><span id="l3.8">               oncommand=&quot;TestPilotWindowUtils.openHomepage();&quot;/&gt;</span>
<a href="#l3.9"></a><span id="l3.9">   &lt;/menupopup&gt;</span>
<a href="#l3.10"></a><span id="l3.10"> &lt;/menu&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-&lt;statusbar id=&quot;status-bar&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-  &lt;statusbarpanel id=&quot;pilot-notifications-button&quot;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                  class=&quot;statusbarpanel-iconic&quot;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-                  insertbefore=&quot;security-button&quot;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-                  onmousedown=&quot;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-                    event.preventDefault();</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-                    TestPilotMenuUtils.onMenuButtonMouseDown();&quot;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-                  image=&quot;chrome://testpilot/skin/testpilot_16x16.png&quot;/&gt;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+// XXX Thunderbird uses the toolbar rather than the status panel.</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+&lt;toolbar id=&quot;mail-bar3&quot;&gt;</span>
<a href="#l3.23"></a><span id="l3.23">   &lt;panel id=&quot;pilot-notification-popup&quot; hidden=&quot;true&quot; noautofocus=&quot;true&quot;</span>
<a href="#l3.24"></a><span id="l3.24">     level=&quot;parent&quot; position=&quot;after_start&quot;&gt;</span>
<a href="#l3.25"></a><span id="l3.25">     &lt;vbox class=&quot;pilot-notification-popup-container&quot;&gt;</span>
<a href="#l3.26"></a><span id="l3.26">       &lt;hbox class=&quot;pilot-notification-toprow&quot;&gt;</span>
<a href="#l3.27"></a><span id="l3.27">         &lt;image id=&quot;pilot-notification-icon&quot; /&gt;</span>
<a href="#l3.28"></a><span id="l3.28">         &lt;vbox pack=&quot;center&quot;&gt;</span>
<a href="#l3.29"></a><span id="l3.29">           &lt;label id=&quot;pilot-notification-title&quot; class=&quot;pilot-title&quot; /&gt;</span>
<a href="#l3.30"></a><span id="l3.30">         &lt;/vbox&gt;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineat">@@ -84,10 +77,10 @@</span>
<a href="#l3.32"></a><span id="l3.32">           label=&quot;&amp;testpilot.settings.alwaysSubmitData.shortLabel;&quot; /&gt;</span>
<a href="#l3.33"></a><span id="l3.33">         &lt;spacer flex=&quot;1&quot; /&gt;</span>
<a href="#l3.34"></a><span id="l3.34">       &lt;/hbox&gt;</span>
<a href="#l3.35"></a><span id="l3.35">       &lt;hbox align=&quot;right&quot;&gt;</span>
<a href="#l3.36"></a><span id="l3.36">         &lt;button id=&quot;pilot-notification-submit&quot; /&gt;</span>
<a href="#l3.37"></a><span id="l3.37">       &lt;/hbox&gt;</span>
<a href="#l3.38"></a><span id="l3.38">     &lt;/vbox&gt;</span>
<a href="#l3.39"></a><span id="l3.39">   &lt;/panel&gt;</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-&lt;/statusbar&gt;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+&lt;/toolbar&gt;</span>
<a href="#l3.42"></a><span id="l3.42"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/install.rdf.in</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/install.rdf.in</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> #filter substitution</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> &lt;RDF xmlns=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l4.9"></a><span id="l4.9">      xmlns:em=&quot;http://www.mozilla.org/2004/em-rdf#&quot;&gt;</span>
<a href="#l4.10"></a><span id="l4.10">   &lt;Description about=&quot;urn:mozilla:install-manifest&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11">     &lt;em:id&gt;tbtestpilot@labs.mozilla.com&lt;/em:id&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    &lt;em:version&gt;1.3.1&lt;/em:version&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    &lt;em:version&gt;1.3.2&lt;/em:version&gt;</span>
<a href="#l4.14"></a><span id="l4.14">     &lt;em:type&gt;2&lt;/em:type&gt;</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">     &lt;!-- Target Application this extension can install into, </span>
<a href="#l4.17"></a><span id="l4.17">          with minimum and maximum supported versions. --&gt; </span>
<a href="#l4.18"></a><span id="l4.18">     &lt;em:targetApplication&gt;</span>
<a href="#l4.19"></a><span id="l4.19">       &lt;Description&gt;</span>
<a href="#l4.20"></a><span id="l4.20">         &lt;em:id&gt;{3550f703-e582-4d05-9a08-453d09bdfdc6}&lt;/em:id&gt; &lt;!-- Thunderbird --&gt;</span>
<a href="#l4.21"></a><span id="l4.21">         &lt;em:minVersion&gt;@THUNDERBIRD_VERSION@&lt;/em:minVersion&gt;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -20,11 +20,10 @@</span>
<a href="#l4.23"></a><span id="l4.23">     &lt;/em:targetApplication&gt;</span>
<a href="#l4.24"></a><span id="l4.24">    </span>
<a href="#l4.25"></a><span id="l4.25">     &lt;!-- Front End MetaData --&gt;</span>
<a href="#l4.26"></a><span id="l4.26">     &lt;em:name&gt;Test Pilot for Thunderbird&lt;/em:name&gt;</span>
<a href="#l4.27"></a><span id="l4.27">     &lt;em:description&gt;Help make Thunderbird better by running user studies.&lt;/em:description&gt;</span>
<a href="#l4.28"></a><span id="l4.28">     &lt;em:creator&gt;Mozilla Corporation&lt;/em:creator&gt;</span>
<a href="#l4.29"></a><span id="l4.29">     &lt;em:homepageURL&gt;http://testpilot.mozillalabs.com/&lt;/em:homepageURL&gt;</span>
<a href="#l4.30"></a><span id="l4.30">     &lt;em:iconURL&gt;chrome://testpilot/skin/testpilot_32x32.png&lt;/em:iconURL&gt;</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    &lt;em:optionsURL&gt;chrome://testpilot/content/options.xul&lt;/em:optionsURL&gt;</span>
<a href="#l4.32"></a><span id="l4.32">   &lt;/Description&gt;</span>
<a href="#l4.33"></a><span id="l4.33"> &lt;/RDF&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/interface.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/interface.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -148,19 +148,22 @@ var TestPilotUIBuilder = {</span>
<a href="#l5.4"></a><span id="l5.4">       let happy = window.document.getElementById(&quot;feedback-menu-happy-button&quot;);</span>
<a href="#l5.5"></a><span id="l5.5">       let sad = window.document.getElementById(&quot;feedback-menu-sad-button&quot;);</span>
<a href="#l5.6"></a><span id="l5.6">       happy.setAttribute(&quot;label&quot;, happy.getAttribute(&quot;thunderbirdLabel&quot;));</span>
<a href="#l5.7"></a><span id="l5.7">       sad.setAttribute(&quot;label&quot;, sad.getAttribute(&quot;thunderbirdLabel&quot;));</span>
<a href="#l5.8"></a><span id="l5.8">     }</span>
<a href="#l5.9"></a><span id="l5.9">   },</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">   channelUsesFeedback: function() {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+    // Thunderbird ships on all channels, so just return false.</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    return false;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+    </span>
<a href="#l5.15"></a><span id="l5.15">     // Beta and aurora channels use feedback interface; nightly and release channels don't.</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-    let channel = this._prefDefaultBranch.getCharPref(UPDATE_CHANNEL_PREF);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-    return (channel == &quot;beta&quot;) || (channel == &quot;betatest&quot;) || (channel == &quot;aurora&quot;);</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+//    let channel = this._prefDefaultBranch.getCharPref(UPDATE_CHANNEL_PREF);</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+//    return (channel == &quot;beta&quot;) || (channel == &quot;betatest&quot;) || (channel == &quot;aurora&quot;);</span>
<a href="#l5.20"></a><span id="l5.20">   },</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22">   hasDoorhangerNotifications: function() {</span>
<a href="#l5.23"></a><span id="l5.23">     // Thunderbird doesn't use the add-on bar (it uses the plain old status</span>
<a href="#l5.24"></a><span id="l5.24">     // bar), and so the doorhanger UI doesn't quite work.</span>
<a href="#l5.25"></a><span id="l5.25">     if (this._appID == THUNDERBIRD_APP_ID)</span>
<a href="#l5.26"></a><span id="l5.26">       return false;</span>
<a href="#l5.27"></a><span id="l5.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">deleted file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- a/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/interface.js.orig</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ /dev/null</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -1,234 +0,0 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">- *</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">- *</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">- * License.</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">- *</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">- * The Original Code is Test Pilot.</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">- *</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">- * The Initial Developer of the Original Code is Mozilla.</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">- *</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">- * Contributor(s):</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">- *   Jono X &lt;jono@mozilla.com&gt;</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">- *</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">- *</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-/* Choose correct overlay to apply based on user's update channel setting;</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">- * do any other tweaking to UI needed to work correctly with user's version.</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">- * 1. Fx 3.*, default update channel -&gt; TP icon menu in status bar</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">- * 2. beta update channel -&gt; Feedback button in toolbar, customizable</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">- * 3. Fx 4.*, default update channel -&gt; TP icon in toolbar, doorhanger notifications</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">- */</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-// A lot of the stuff that's currently in browser.js can get moved here.</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-EXPORTED_SYMBOLS = [&quot;TestPilotUIBuilder&quot;];</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-const Cc = Components.classes;</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-const Ci = Components.interfaces;</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-const Cu = Components.utils;</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-const UPDATE_CHANNEL_PREF = &quot;app.update.channel&quot;;</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-const POPUP_SHOW_ON_NEW = &quot;extensions.testpilot.popup.showOnNewStudy&quot;;</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-const POPUP_CHECK_INTERVAL = &quot;extensions.testpilot.popup.delayAfterStartup&quot;;</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-const FENNEC_APP_ID = &quot;{a23983c0-fd0e-11dc-95ff-0800200c9a66}&quot;;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-const THUNDERBIRD_APP_ID = &quot;{3550f703-e582-4d05-9a08-453d09bdfdc6}&quot;;</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-var TestPilotUIBuilder = {</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-  get _prefs() {</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-    delete this._prefs;</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-    return this._prefs = Cc[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-      .getService(Ci.nsIPrefBranch);</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-  },</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-  get _prefDefaultBranch() {</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-    delete this._prefDefaultBranch;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-    return this._prefDefaultBranch = Cc[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-      .getService(Ci.nsIPrefService).getDefaultBranch(&quot;&quot;);</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-  },</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-  get _comparator() {</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-    delete this._comparator;</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-    return this._comparator = Cc[&quot;@mozilla.org/xpcom/version-comparator;1&quot;]</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">-      .getService(Ci.nsIVersionComparator);</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-  },</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-  get _appVersion() {</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-    delete this._appVersion;</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-    return this._appVersion = Cc[&quot;@mozilla.org/xre/app-info;1&quot;]</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-      .getService(Ci.nsIXULAppInfo).version;</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-  },</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-  get _appID() {</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-    delete this._appID;</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-    return this._appID = Cc[&quot;@mozilla.org/xre/app-info;1&quot;]</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineminus">-      .getService(Ci.nsIXULAppInfo).ID;</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineminus">-  },</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineminus">-</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineminus">-  buildTestPilotInterface: function(window) {</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-    // Don't need Feedback button: remove it</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-    let feedbackButton = window.document.getElementById(&quot;feedback-menu-button&quot;);</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-    if (!feedbackButton) {</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineminus">-      let toolbox = window.document.getElementById(&quot;mail-toolbox&quot;);</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineminus">-      let palette = toolbox.palette;</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineminus">-      feedbackButton = palette.getElementsByAttribute(&quot;id&quot;, &quot;feedback-menu-button&quot;).item(0);</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineminus">-    }</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineminus">-    feedbackButton.parentNode.removeChild(feedbackButton);</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineminus">-</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-    /* Default prefs for test pilot version - default to NOT notifying user about new</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-     * studies starting. Note we're setting default values, not current values -- we</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineminus">-     * want these to be overridden by any user set values!!*/</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineminus">-    this._prefDefaultBranch.setBoolPref(POPUP_SHOW_ON_NEW, false);</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineminus">-    this._prefDefaultBranch.setIntPref(POPUP_CHECK_INTERVAL, 180000);</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineminus">-  },</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineminus">-</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-  buildFeedbackInterface: function(window) {</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineminus">-    /* If this is first run, and it's ffx4 beta version, and the feedback</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-     * button is not in the expected place, put it there!</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineminus">-     * (copied from MozReporterButtons extension) */</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineminus">-</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineminus">-    /* Check if we've already done this customization -- if not, don't do it</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineminus">-     * again  (don't want to put it back in after user explicitly takes it out-</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineminus">-     * bug 577243 )*/</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineminus">-</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineminus">-    let mainToolbar;</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineminus">-    if (this._appID == THUNDERBIRD_APP_ID)</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineminus">-      mainToolbar = window.document.getElementById(&quot;mail-bar3&quot;);</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineminus">-    else</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineminus">-      mainToolbar = window.document.getElementById(&quot;nav-bar&quot;);</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineminus">-    let pref = &quot;extensions.testpilot.alreadyCustomizedToolbar&quot;;</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineminus">-    let alreadyCustomized = this._prefs.getBoolPref(pref);</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineminus">-    let curSet = mainToolbar.currentSet;</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineminus">-</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineminus">-    if (!alreadyCustomized &amp;&amp; (-1 == curSet.indexOf(&quot;feedback-menu-button&quot;))) {</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineminus">-      // place the buttons after the search box.</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineminus">-      let newSet = curSet + &quot;,feedback-menu-button&quot;;</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineminus">-      mainToolbar.setAttribute(&quot;currentset&quot;, newSet);</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineminus">-      mainToolbar.currentSet = newSet;</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineminus">-      window.document.persist(mainToolbar.id, &quot;currentset&quot;);</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineminus">-      this._prefs.setBoolPref(pref, true);</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineminus">-      // if you don't do the following call, funny things happen.</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineminus">-      try {</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineminus">-        window.BrowserToolboxCustomizeDone(true);</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineminus">-      } catch (e) {</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineminus">-      }</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineminus">-    }</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineminus">-</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineminus">-    /* Pref defaults for Feedback version: default to notifying user about new</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineminus">-     * studies starting. Note we're setting default values, not current values -- we</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineminus">-     * want these to be overridden by any user set values!!*/</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineminus">-    this._prefDefaultBranch.setBoolPref(POPUP_SHOW_ON_NEW, true);</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineminus">-    this._prefDefaultBranch.setIntPref(POPUP_CHECK_INTERVAL, 600000);</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineminus">-</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineminus">-    // Change the happy/sad labels if necessary</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineminus">-    if (this._appID == THUNDERBIRD_APP_ID) {</span>
<a href="#l6.149"></a><span id="l6.149" class="difflineminus">-      let happy = window.document.getElementById(&quot;feedback-menu-happy-button&quot;);</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineminus">-      let sad = window.document.getElementById(&quot;feedback-menu-sad-button&quot;);</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineminus">-      happy.setAttribute(&quot;label&quot;, happy.getAttribute(&quot;thunderbirdLabel&quot;));</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineminus">-      sad.setAttribute(&quot;label&quot;, sad.getAttribute(&quot;thunderbirdLabel&quot;));</span>
<a href="#l6.153"></a><span id="l6.153" class="difflineminus">-    }</span>
<a href="#l6.154"></a><span id="l6.154" class="difflineminus">-  },</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineminus">-</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineminus">-  channelUsesFeedback: function() {</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineminus">-    // Beta and aurora channels use feedback interface; nightly and release channels don't.</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineminus">-    let channel = this._prefDefaultBranch.getCharPref(UPDATE_CHANNEL_PREF);</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineminus">-    return (channel == &quot;beta&quot;) || (channel == &quot;betatest&quot;) || (channel == &quot;aurora&quot;);</span>
<a href="#l6.160"></a><span id="l6.160" class="difflineminus">-  },</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineminus">-</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineminus">-  hasDoorhangerNotifications: function() {</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineminus">-    try {</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineminus">-      let popupModule = {};</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineminus">-      Components.utils.import(&quot;resource://gre/modules/PopupNotifications.jsm&quot;, popupModule);</span>
<a href="#l6.166"></a><span id="l6.166" class="difflineminus">-      return true;</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineminus">-    } catch (e) {</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineminus">-      return false;</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineminus">-    }</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineminus">-  },</span>
<a href="#l6.171"></a><span id="l6.171" class="difflineminus">-</span>
<a href="#l6.172"></a><span id="l6.172" class="difflineminus">-  buildCorrectInterface: function(window) {</span>
<a href="#l6.173"></a><span id="l6.173" class="difflineminus">-    /* Apply no overlay to Fennec: */</span>
<a href="#l6.174"></a><span id="l6.174" class="difflineminus">-    if (this._appID == FENNEC_APP_ID) {</span>
<a href="#l6.175"></a><span id="l6.175" class="difflineminus">-      return;</span>
<a href="#l6.176"></a><span id="l6.176" class="difflineminus">-    }</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineminus">-    else if (this._appID == THUNDERBIRD_APP_ID) {</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineminus">-      // TODO: do something special here, probably</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineminus">-    }</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineminus">-    else {</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineminus">-      let firefoxnav = window.document.getElementById(&quot;nav-bar&quot;);</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineminus">-      /* This is sometimes called for windows that don't have a navbar - in</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineminus">-       * that case, do nothing. TODO maybe this should be in onWindowLoad?*/</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineminus">-      if (!firefoxnav) {</span>
<a href="#l6.185"></a><span id="l6.185" class="difflineminus">-        return;</span>
<a href="#l6.186"></a><span id="l6.186" class="difflineminus">-      }</span>
<a href="#l6.187"></a><span id="l6.187" class="difflineminus">-    }</span>
<a href="#l6.188"></a><span id="l6.188" class="difflineminus">-</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineminus">-    /* Overlay Feedback XUL if we're in the beta update channel, Test Pilot XUL otherwise.</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineminus">-     * Once the overlay is complete, call buildFeedbackInterface() or buildTestPilotInterface(). */</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineminus">-    let self = this;</span>
<a href="#l6.192"></a><span id="l6.192" class="difflineminus">-    if (this.channelUsesFeedback()) {</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineminus">-      window.document.loadOverlay(&quot;chrome://testpilot/content/feedback-browser.xul&quot;,</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineminus">-                                  {observe: function(subject, topic, data) {</span>
<a href="#l6.195"></a><span id="l6.195" class="difflineminus">-                                     if (topic == &quot;xul-overlay-merged&quot;) {</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineminus">-                                       self.buildFeedbackInterface(window);</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineminus">-                                     }</span>
<a href="#l6.198"></a><span id="l6.198" class="difflineminus">-                                   }});</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineminus">-    } else {</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-      let testPilotOverlay = (this.hasDoorhangerNotifications() ?</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineminus">-                              &quot;chrome://testpilot/content/tp-browser-popupNotifications.xul&quot; :</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineminus">-                              &quot;chrome://testpilot/content/tp-browser-customNotifications.xul&quot;);</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineminus">-      window.document.loadOverlay(testPilotOverlay,</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineminus">-                                  {observe: function(subject, topic, data) {</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineminus">-                                     if (topic == &quot;xul-overlay-merged&quot;) {</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineminus">-                                       self.buildTestPilotInterface(window);</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineminus">-                                     }</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineminus">-                                  }});</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineminus">-    }</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineminus">-  },</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineminus">-</span>
<a href="#l6.212"></a><span id="l6.212" class="difflineminus">-  getNotificationManager: function() {</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineminus">-    // If we're on Android, use the Android notification manager!</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineminus">-    let ntfnModule = {};</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineminus">-    Cu.import(&quot;resource://testpilot/modules/notifications.js&quot;, ntfnModule);</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineminus">-    Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.217"></a><span id="l6.217" class="difflineminus">-</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineminus">-    Services.console.logStringMessage(&quot;appID is &quot; + this._appID);</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineminus">-    if (this._appID == FENNEC_APP_ID) {</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineminus">-      Services.console.logStringMessage(&quot;making Android Notfn Manager..&quot;);</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineminus">-      return new ntfnModule.AndroidNotificationManager();</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineminus">-    }</span>
<a href="#l6.223"></a><span id="l6.223" class="difflineminus">-</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-    // Use custom notifications anchored to the Feedback button, if there is a Feedback button</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineminus">-    if (this.channelUsesFeedback()) {</span>
<a href="#l6.226"></a><span id="l6.226" class="difflineminus">-      Services.console.logStringMessage(&quot;making Custom Notfn Manager..&quot;);</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-      return new ntfnModule.CustomNotificationManager(true);</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineminus">-    }</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineminus">-    // If no feedback button, and popup notifications available, use those</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineminus">-    if (this.hasDoorhangerNotifications()) {</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-      Services.console.logStringMessage(&quot;making Popup Notfn Manager..&quot;);</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineminus">-      return new ntfnModule.PopupNotificationManager();</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineminus">-    }</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineminus">-    // If neither one is available, use custom notifications anchored to Test Pilot status icon</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineminus">-    Services.console.logStringMessage(&quot;making Custom Notfn Manager..&quot;);</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineminus">-    return new ntfnModule.CustomNotificationManager(false);</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineminus">-  }</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/notifications.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/notifications.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -97,17 +97,20 @@ CustomNotificationManager.prototype = {</span>
<a href="#l7.4"></a><span id="l7.4">     let anchor;</span>
<a href="#l7.5"></a><span id="l7.5">     if (this._anchorToFeedback) {</span>
<a href="#l7.6"></a><span id="l7.6">       /* If we're in the Ffx4Beta version, popups come down from feedback</span>
<a href="#l7.7"></a><span id="l7.7">        * button, but if we're in the standalone extension version, they</span>
<a href="#l7.8"></a><span id="l7.8">        * come up from status bar icon. */</span>
<a href="#l7.9"></a><span id="l7.9">       anchor = doc.getElementById(&quot;feedback-menu-button&quot;);</span>
<a href="#l7.10"></a><span id="l7.10">       popup.setAttribute(&quot;class&quot;, &quot;tail-up&quot;);</span>
<a href="#l7.11"></a><span id="l7.11">     } else {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      anchor = doc.getElementById(&quot;pilot-notifications-button&quot;);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+      // XXX Thunderbird doesn't have the pilot-notifications-button, so we anchor</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+      // to the toolbar instead</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+      // anchor = doc.getElementById(&quot;pilot-notifications-button&quot;);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+      anchor = doc.getElementById(&quot;mail-bar3&quot;);</span>
<a href="#l7.17"></a><span id="l7.17">       popup.setAttribute(&quot;class&quot;, &quot;tail-down&quot;);</span>
<a href="#l7.18"></a><span id="l7.18">     }</span>
<a href="#l7.19"></a><span id="l7.19">     let textLabel = doc.getElementById(&quot;pilot-notification-text&quot;);</span>
<a href="#l7.20"></a><span id="l7.20">     let titleLabel = doc.getElementById(&quot;pilot-notification-title&quot;);</span>
<a href="#l7.21"></a><span id="l7.21">     let icon = doc.getElementById(&quot;pilot-notification-icon&quot;);</span>
<a href="#l7.22"></a><span id="l7.22">     let submitBtn = doc.getElementById(&quot;pilot-notification-submit&quot;);</span>
<a href="#l7.23"></a><span id="l7.23">     let closeBtn = doc.getElementById(&quot;pilot-notification-close&quot;);</span>
<a href="#l7.24"></a><span id="l7.24">     let link = doc.getElementById(&quot;pilot-notification-link&quot;);</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineat">@@ -181,17 +184,18 @@ CustomNotificationManager.prototype = {</span>
<a href="#l7.26"></a><span id="l7.26">       if (options.closeCallback) {</span>
<a href="#l7.27"></a><span id="l7.27">         options.closeCallback();</span>
<a href="#l7.28"></a><span id="l7.28">       }</span>
<a href="#l7.29"></a><span id="l7.29">     };</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31">     // Show the popup:</span>
<a href="#l7.32"></a><span id="l7.32">     popup.hidden = false;</span>
<a href="#l7.33"></a><span id="l7.33">     popup.setAttribute(&quot;open&quot;, &quot;true&quot;);</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-    popup.openPopup( anchor, &quot;after_end&quot;);</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+    // XXX Thunderbird needs after_start for now.</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+    popup.openPopup( anchor, &quot;after_start&quot;);//&quot;after_end&quot;);</span>
<a href="#l7.37"></a><span id="l7.37">   },</span>
<a href="#l7.38"></a><span id="l7.38"> </span>
<a href="#l7.39"></a><span id="l7.39">   hideNotification: function TP_OldNotfn_hideNotification(window) {</span>
<a href="#l7.40"></a><span id="l7.40">     let popup = window.document.getElementById(&quot;pilot-notification-popup&quot;);</span>
<a href="#l7.41"></a><span id="l7.41">     popup.removeAttribute(&quot;open&quot;);</span>
<a href="#l7.42"></a><span id="l7.42">     popup.hidePopup();</span>
<a href="#l7.43"></a><span id="l7.43">   }</span>
<a href="#l7.44"></a><span id="l7.44"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/tasks.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/app/profile/extensions/tbtestpilot@labs.mozilla.com/modules/tasks.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -372,17 +372,17 @@ TestPilotExperiment.prototype = {</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5">   get dataStore() {</span>
<a href="#l8.6"></a><span id="l8.6">     return this._dataStore;</span>
<a href="#l8.7"></a><span id="l8.7">   },</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9">   get currentStatusUrl() {</span>
<a href="#l8.10"></a><span id="l8.10">     // TODO chose status.html or status_mobile.html depending on platform...</span>
<a href="#l8.11"></a><span id="l8.11">     let param = &quot;?eid=&quot; + this._id;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    return &quot;chrome://testpilot/content/status_mobile.html&quot; + param;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    return &quot;chrome://testpilot/content/status.html&quot; + param;</span>
<a href="#l8.14"></a><span id="l8.14">   },</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16">   get defaultUrl() {</span>
<a href="#l8.17"></a><span id="l8.17">     return this.currentStatusUrl;</span>
<a href="#l8.18"></a><span id="l8.18">   },</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">   get recurPref() {</span>
<a href="#l8.21"></a><span id="l8.21">     let prefName = RECUR_PREF_PREFIX + this._id;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">index bf7a00ff4c3836bc7f822e7bf678c40e0ceeed98..27628ce1c2aa2e57200a5d179310b6a86b5e5ca7</span>
<a href="#l9.2"></a><span id="l9.2">GIT binary patch
literal 4437
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/span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

