<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20931:68809f0c899a4bdd1dfeca59367b562759263ab2</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 68809f0c899a4bdd1dfeca59367b562759263ab2" />
<meta property="og:url" content="/comm-central/rev/68809f0c899a4bdd1dfeca59367b562759263ab2" />
<meta property="og:description" content="Bug 1308776 - Add choosing of default addressbook from preferences dialog and a context menu. ui-r=Paenglab, r=mkmelin,jorgk,frgrahl a=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 68809f0c899a4bdd1dfeca59367b562759263ab2 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/68809f0c899a4bdd1dfeca59367b562759263ab2">shortlog</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/68809f0c899a4bdd1dfeca59367b562759263ab2">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2">files</a> |
changeset |
<a href="/comm-central/raw-rev/68809f0c899a4bdd1dfeca59367b562759263ab2">raw</a>  | <a href="/comm-central/archive/68809f0c899a4bdd1dfeca59367b562759263ab2.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1308776">Bug 1308776</a> - Add choosing of default addressbook from preferences dialog and a context menu. ui-r=Paenglab, r=mkmelin,jorgk,frgrahl a=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 23 Nov 2016 22:30:39 +0200</td></tr>

<tr>
 <td>changeset 20931</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/68809f0c899a4bdd1dfeca59367b562759263ab2">68809f0c899a4bdd1dfeca59367b562759263ab2</a></td>
</tr>



<tr>
<td>parent 20930</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0b370e34182fc18c65d098a50b35b76803d08203">0b370e34182fc18c65d098a50b35b76803d08203</a>
</td>
</tr>

<tr>
<td>child 20932</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/be757587e6f0e5b23f54e8a3582aa64a393148dd">be757587e6f0e5b23f54e8a3582aa64a393148dd</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=68809f0c899a4bdd1dfeca59367b562759263ab2">12686</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 28 Dec 2016 08:39:12 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@68809f0c899a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=68809f0c899a4bdd1dfeca59367b562759263ab2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=68809f0c899a4bdd1dfeca59367b562759263ab2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68809f0c899a4bdd1dfeca59367b562759263ab2&newProject=comm-central&newRevision=fab8072d8a6c14c4efb485e12c652142bce685c5&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68809f0c899a4bdd1dfeca59367b562759263ab2&newProject=comm-central&newRevision=fab8072d8a6c14c4efb485e12c652142bce685c5&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68809f0c899a4bdd1dfeca59367b562759263ab2&newProject=comm-central&newRevision=fab8072d8a6c14c4efb485e12c652142bce685c5&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Paenglab%29&revcount=50">Paenglab</a>, <a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a>, <a href="/comm-central/log?rev=reviewer%28frgrahl%29&revcount=50">frgrahl</a>, <a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1308776">1308776</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1308776">Bug 1308776</a> - Add choosing of default addressbook from preferences dialog and a context menu. ui-r=Paenglab, r=mkmelin,jorgk,frgrahl a=jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/abCommon.js">mail/components/addrbook/content/abCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/abCommon.js">file</a> |
<a href="/comm-central/annotate/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/abCommon.js">annotate</a> |
<a href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/abCommon.js">diff</a> |
<a href="/comm-central/comparison/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/abCommon.js">comparison</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/abCommon.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.js">mail/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.xul">mail/components/addrbook/content/addressbook.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.xul">file</a> |
<a href="/comm-central/annotate/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.xul">annotate</a> |
<a href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.xul">diff</a> |
<a href="/comm-central/comparison/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.xul">comparison</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/addrbook/content/addressbook.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.js">mail/components/preferences/compose.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.js">file</a> |
<a href="/comm-central/annotate/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.js">annotate</a> |
<a href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.js">diff</a> |
<a href="/comm-central/comparison/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.js">comparison</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.xul">mail/components/preferences/compose.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.xul">file</a> |
<a href="/comm-central/annotate/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.xul">annotate</a> |
<a href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.xul">diff</a> |
<a href="/comm-central/comparison/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.xul">comparison</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/components/preferences/compose.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">file</a> |
<a href="/comm-central/annotate/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">annotate</a> |
<a href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">diff</a> |
<a href="/comm-central/comparison/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">comparison</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/preferences/compose.dtd">mail/locales/en-US/chrome/messenger/preferences/compose.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/preferences/compose.dtd">file</a> |
<a href="/comm-central/annotate/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/preferences/compose.dtd">annotate</a> |
<a href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/preferences/compose.dtd">diff</a> |
<a href="/comm-central/comparison/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/preferences/compose.dtd">comparison</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/locales/en-US/chrome/messenger/preferences/compose.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/themes/shared/mail/messenger.css">mail/themes/shared/mail/messenger.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/themes/shared/mail/messenger.css">file</a> |
<a href="/comm-central/annotate/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/themes/shared/mail/messenger.css">annotate</a> |
<a href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/themes/shared/mail/messenger.css">diff</a> |
<a href="/comm-central/comparison/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/themes/shared/mail/messenger.css">comparison</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2/mail/themes/shared/mail/messenger.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mailnews/addrbook/content/addrbookWidgets.xml">mailnews/addrbook/content/addrbookWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68809f0c899a4bdd1dfeca59367b562759263ab2/mailnews/addrbook/content/addrbookWidgets.xml">file</a> |
<a href="/comm-central/annotate/68809f0c899a4bdd1dfeca59367b562759263ab2/mailnews/addrbook/content/addrbookWidgets.xml">annotate</a> |
<a href="/comm-central/diff/68809f0c899a4bdd1dfeca59367b562759263ab2/mailnews/addrbook/content/addrbookWidgets.xml">diff</a> |
<a href="/comm-central/comparison/68809f0c899a4bdd1dfeca59367b562759263ab2/mailnews/addrbook/content/addrbookWidgets.xml">comparison</a> |
<a href="/comm-central/log/68809f0c899a4bdd1dfeca59367b562759263ab2/mailnews/addrbook/content/addrbookWidgets.xml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/addrbook/content/abCommon.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCommon.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -40,16 +40,17 @@ var DirPaneController =</span>
<a href="#l1.4"></a><span id="l1.4"> {</span>
<a href="#l1.5"></a><span id="l1.5">   supportsCommand: function(command)</span>
<a href="#l1.6"></a><span id="l1.6">   {</span>
<a href="#l1.7"></a><span id="l1.7">     switch (command) {</span>
<a href="#l1.8"></a><span id="l1.8">       case &quot;cmd_selectAll&quot;:</span>
<a href="#l1.9"></a><span id="l1.9">       case &quot;cmd_delete&quot;:</span>
<a href="#l1.10"></a><span id="l1.10">       case &quot;button_delete&quot;:</span>
<a href="#l1.11"></a><span id="l1.11">       case &quot;cmd_properties&quot;:</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+      case &quot;cmd_abToggleStartupDir&quot;:</span>
<a href="#l1.13"></a><span id="l1.13">       case &quot;cmd_printcard&quot;:</span>
<a href="#l1.14"></a><span id="l1.14">       case &quot;cmd_printcardpreview&quot;:</span>
<a href="#l1.15"></a><span id="l1.15">       case &quot;cmd_newlist&quot;:</span>
<a href="#l1.16"></a><span id="l1.16">       case &quot;cmd_newCard&quot;:</span>
<a href="#l1.17"></a><span id="l1.17">         return true;</span>
<a href="#l1.18"></a><span id="l1.18">       default:</span>
<a href="#l1.19"></a><span id="l1.19">         return false;</span>
<a href="#l1.20"></a><span id="l1.20">     }</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -131,16 +132,18 @@ var DirPaneController =</span>
<a href="#l1.22"></a><span id="l1.22">         goSetLabelAccesskeyTooltiptext(&quot;cmd_properties-button&quot;, null, null,</span>
<a href="#l1.23"></a><span id="l1.23">           tooltipTextAttr);</span>
<a href="#l1.24"></a><span id="l1.24">         goSetLabelAccesskeyTooltiptext(&quot;cmd_properties-contextMenu&quot;,</span>
<a href="#l1.25"></a><span id="l1.25">           labelAttr, accKeyAttr);</span>
<a href="#l1.26"></a><span id="l1.26">         goSetLabelAccesskeyTooltiptext(&quot;cmd_properties-menu&quot;,</span>
<a href="#l1.27"></a><span id="l1.27">           labelAttr, accKeyAttr);</span>
<a href="#l1.28"></a><span id="l1.28">         return (selectedDir != null);</span>
<a href="#l1.29"></a><span id="l1.29">       }</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+      case &quot;cmd_abToggleStartupDir&quot;:</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+        return !!getSelectedDirectoryURI();</span>
<a href="#l1.32"></a><span id="l1.32">       case &quot;cmd_newlist&quot;:</span>
<a href="#l1.33"></a><span id="l1.33">       case &quot;cmd_newCard&quot;:</span>
<a href="#l1.34"></a><span id="l1.34">         return true;</span>
<a href="#l1.35"></a><span id="l1.35">       default:</span>
<a href="#l1.36"></a><span id="l1.36">         return false;</span>
<a href="#l1.37"></a><span id="l1.37">     }</span>
<a href="#l1.38"></a><span id="l1.38">   },</span>
<a href="#l1.39"></a><span id="l1.39"> </span>
<a href="#l1.40"></a><span id="l1.40" class="difflineat">@@ -155,16 +158,19 @@ var DirPaneController =</span>
<a href="#l1.41"></a><span id="l1.41">       case &quot;cmd_delete&quot;:</span>
<a href="#l1.42"></a><span id="l1.42">       case &quot;button_delete&quot;:</span>
<a href="#l1.43"></a><span id="l1.43">         if (gDirTree)</span>
<a href="#l1.44"></a><span id="l1.44">           AbDeleteSelectedDirectory();</span>
<a href="#l1.45"></a><span id="l1.45">         break;</span>
<a href="#l1.46"></a><span id="l1.46">       case &quot;cmd_properties&quot;:</span>
<a href="#l1.47"></a><span id="l1.47">         AbEditSelectedDirectory();</span>
<a href="#l1.48"></a><span id="l1.48">         break;</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+      case &quot;cmd_abToggleStartupDir&quot;:</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+        abToggleSelectedDirStartup();</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+        break;</span>
<a href="#l1.52"></a><span id="l1.52">       case &quot;cmd_newlist&quot;:</span>
<a href="#l1.53"></a><span id="l1.53">         AbNewList();</span>
<a href="#l1.54"></a><span id="l1.54">         break;</span>
<a href="#l1.55"></a><span id="l1.55">       case &quot;cmd_newCard&quot;:</span>
<a href="#l1.56"></a><span id="l1.56">         AbNewCard();</span>
<a href="#l1.57"></a><span id="l1.57">         break;</span>
<a href="#l1.58"></a><span id="l1.58">     }</span>
<a href="#l1.59"></a><span id="l1.59">   },</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineat">@@ -213,16 +219,51 @@ function AbEditSelectedDirectory()</span>
<a href="#l1.61"></a><span id="l1.61">   } else {</span>
<a href="#l1.62"></a><span id="l1.62">     window.openDialog(selectedDir.propertiesChromeURI,</span>
<a href="#l1.63"></a><span id="l1.63">                       &quot;&quot;,</span>
<a href="#l1.64"></a><span id="l1.64">                       &quot;chrome,modal,resizable=no,centerscreen&quot;,</span>
<a href="#l1.65"></a><span id="l1.65">                       {selectedDirectory: selectedDir});</span>
<a href="#l1.66"></a><span id="l1.66">   }</span>
<a href="#l1.67"></a><span id="l1.67"> }</span>
<a href="#l1.68"></a><span id="l1.68"> </span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+function updateDirTreeContext() {</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+  let startupItem = document.getElementById(&quot;dirTreeContext-startupDir&quot;);</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+  if (Services.prefs.getBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;)) {</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+    let startupURI = Services.prefs.getCharPref(&quot;mail.addr_book.view.startupURI&quot;);</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+    let selectedDirURI = getSelectedDirectoryURI();</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+    startupItem.setAttribute(&quot;checked&quot;, (startupURI == selectedDirURI));</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+  } else {</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+    startupItem.setAttribute(&quot;checked&quot;, &quot;false&quot;);</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+  }</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+}</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+function abToggleSelectedDirStartup()</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+{</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+  let selectedDirURI = getSelectedDirectoryURI();</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+  if (!selectedDirURI)</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+    return;</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+  let isDefault = Services.prefs.getBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;);</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+  let startupURI = Services.prefs.getCharPref(&quot;mail.addr_book.view.startupURI&quot;);</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+  if (isDefault &amp;&amp; (startupURI == selectedDirURI)) {</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+    // The current directory has been the default startup view directory;</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+    // toggle that off now. So there's no default startup view directory any more.</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+    Services.prefs.setBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;, false);</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+  } else {</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+    // The current directory will now be the default view</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+    // when starting up the main AB window.</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+    Services.prefs.setCharPref(&quot;mail.addr_book.view.startupURI&quot;, selectedDirURI);</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+    Services.prefs.setBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;, true);</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+  }</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+  // Update the checkbox in the menuitem.</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+  goUpdateCommand(&quot;cmd_abToggleStartupDir&quot;);</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+}</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+</span>
<a href="#l1.104"></a><span id="l1.104"> function AbDeleteSelectedDirectory()</span>
<a href="#l1.105"></a><span id="l1.105"> {</span>
<a href="#l1.106"></a><span id="l1.106">   let selectedDirURI = getSelectedDirectoryURI();</span>
<a href="#l1.107"></a><span id="l1.107">   if (!selectedDirURI)</span>
<a href="#l1.108"></a><span id="l1.108">     return;</span>
<a href="#l1.109"></a><span id="l1.109"> </span>
<a href="#l1.110"></a><span id="l1.110">   AbDeleteDirectory(selectedDirURI);</span>
<a href="#l1.111"></a><span id="l1.111"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -287,16 +287,17 @@ function onOSXFileMenuInit()</span>
<a href="#l2.4"></a><span id="l2.4">           .setAttribute(&quot;checked&quot;, AbOSXAddressBookExists());</span>
<a href="#l2.5"></a><span id="l2.5"> }</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> function CommandUpdate_AddressBook()</span>
<a href="#l2.8"></a><span id="l2.8"> {</span>
<a href="#l2.9"></a><span id="l2.9">   goUpdateCommand('cmd_delete');</span>
<a href="#l2.10"></a><span id="l2.10">   goUpdateCommand('button_delete');</span>
<a href="#l2.11"></a><span id="l2.11">   goUpdateCommand('cmd_properties');</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  goUpdateCommand(&quot;cmd_abToggleStartupDir&quot;);</span>
<a href="#l2.13"></a><span id="l2.13">   goUpdateCommand('cmd_newlist');</span>
<a href="#l2.14"></a><span id="l2.14">   goUpdateCommand('cmd_newCard');</span>
<a href="#l2.15"></a><span id="l2.15">   goUpdateCommand('cmd_chatWithCard');</span>
<a href="#l2.16"></a><span id="l2.16"> }</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> function ResultsPaneSelectionChanged()</span>
<a href="#l2.19"></a><span id="l2.19"> {</span>
<a href="#l2.20"></a><span id="l2.20">   UpdateCardView();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -195,26 +195,32 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #ifdef XP_MACOSX</span>
<a href="#l3.5"></a><span id="l3.5">   &lt;!-- Mac Window keys --&gt;</span>
<a href="#l3.6"></a><span id="l3.6">   &lt;key id=&quot;key_minimizeWindow&quot; command=&quot;minimizeWindow&quot; key=&quot;&amp;minimizeWindow.key;&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l3.7"></a><span id="l3.7"> #endif</span>
<a href="#l3.8"></a><span id="l3.8"> &lt;/keyset&gt;</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10"> &lt;keyset id=&quot;baseMenuKeyset&quot;/&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-&lt;menupopup id=&quot;dirTreeContext&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+&lt;menupopup id=&quot;dirTreeContext&quot; onpopupshowing=&quot;updateDirTreeContext();&quot;&gt;</span>
<a href="#l3.14"></a><span id="l3.14">   &lt;menuitem id=&quot;dirTreeContext-properties&quot;</span>
<a href="#l3.15"></a><span id="l3.15">             command=&quot;cmd_properties-contextMenu&quot;/&gt;</span>
<a href="#l3.16"></a><span id="l3.16">   &lt;menuseparator/&gt;</span>
<a href="#l3.17"></a><span id="l3.17">   &lt;menuitem id=&quot;dirTreeContext-newcard&quot; label=&quot;&amp;newContactButton.label;&quot;</span>
<a href="#l3.18"></a><span id="l3.18">             accesskey=&quot;&amp;newContactButton.accesskey;&quot; command=&quot;cmd_newCard&quot;/&gt;</span>
<a href="#l3.19"></a><span id="l3.19">   &lt;menuitem id=&quot;dirTreeContext-newlist&quot;</span>
<a href="#l3.20"></a><span id="l3.20">             label=&quot;&amp;newlistButton.label;&quot;</span>
<a href="#l3.21"></a><span id="l3.21">             accesskey=&quot;&amp;newlistButton.accesskey;&quot;</span>
<a href="#l3.22"></a><span id="l3.22">             command=&quot;cmd_newlist&quot;/&gt;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+  &lt;menuitem id=&quot;dirTreeContext-startupDir&quot;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+            label=&quot;&amp;showAsDefault.label;&quot;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+            accesskey=&quot;&amp;showAsDefault.accesskey;&quot;</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+            type=&quot;checkbox&quot;</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+            checked=&quot;false&quot;</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+            oncommand=&quot;goDoCommand('cmd_abToggleStartupDir');&quot;/&gt;</span>
<a href="#l3.29"></a><span id="l3.29">   &lt;menuseparator/&gt;</span>
<a href="#l3.30"></a><span id="l3.30">   &lt;menuitem id=&quot;dirTreeContext-delete&quot;</span>
<a href="#l3.31"></a><span id="l3.31">             label=&quot;&amp;deleteButton2.label;&quot;</span>
<a href="#l3.32"></a><span id="l3.32">             accesskey=&quot;&amp;deleteButton2.accesskey;&quot;</span>
<a href="#l3.33"></a><span id="l3.33">             observes=&quot;button_delete&quot;</span>
<a href="#l3.34"></a><span id="l3.34">             oncommand=&quot;goDoCommand('button_delete');&quot;/&gt;</span>
<a href="#l3.35"></a><span id="l3.35"> &lt;/menupopup&gt;</span>
<a href="#l3.36"></a><span id="l3.36"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/preferences/compose.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/preferences/compose.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -21,16 +21,18 @@ var gComposePane = {</span>
<a href="#l4.4"></a><span id="l4.4">     this.populateFonts();</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6">     this.updateAutosave();</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">     this.updateAttachmentCheck();</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">     this.updateEmailCollection();</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+    this.initAbDefaultStartupDir();</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+</span>
<a href="#l4.14"></a><span id="l4.14">     if (!((&quot;arguments&quot; in window) &amp;&amp; window.arguments[1])) {</span>
<a href="#l4.15"></a><span id="l4.15">       // If no tab was specified, select the last used tab.</span>
<a href="#l4.16"></a><span id="l4.16">       let preference = document.getElementById(&quot;mail.preferences.compose.selectedTabIndex&quot;);</span>
<a href="#l4.17"></a><span id="l4.17">       if (preference.value)</span>
<a href="#l4.18"></a><span id="l4.18">         document.getElementById(&quot;composePrefs&quot;).selectedIndex = preference.value;</span>
<a href="#l4.19"></a><span id="l4.19">     }</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">     if (this._loadInContent) {</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -111,16 +113,50 @@ var gComposePane = {</span>
<a href="#l4.23"></a><span id="l4.23">     if (this._loadInContent) {</span>
<a href="#l4.24"></a><span id="l4.24">       gSubDialog.open(&quot;chrome://messenger/content/addressbook/pref-editdirectories.xul&quot;);</span>
<a href="#l4.25"></a><span id="l4.25">     } else {</span>
<a href="#l4.26"></a><span id="l4.26">       window.openDialog(&quot;chrome://messenger/content/addressbook/pref-editdirectories.xul&quot;,</span>
<a href="#l4.27"></a><span id="l4.27">                         &quot;editDirectories&quot;, &quot;chrome,modal=yes,resizable=no&quot;, null);</span>
<a href="#l4.28"></a><span id="l4.28">     }</span>
<a href="#l4.29"></a><span id="l4.29">   },</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+  initAbDefaultStartupDir: function() {</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    if (!this.startupDirListener.inited)</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+      this.startupDirListener.load();</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+    let dirList = document.getElementById(&quot;defaultStartupDirList&quot;);</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;)) {</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+      // Some directory is the default.</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+      let startupURI = Services.prefs.getCharPref(&quot;mail.addr_book.view.startupURI&quot;);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+      let dirItem = dirList.menupopup.querySelector('[value=&quot;' + startupURI + '&quot;]');</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+      // It may happen that the stored URI is not in the list.</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+      // In that case select the &quot;none&quot; value and let the AB code clear out</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+      // the invalid value, unless the user selects something here.</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+      if (dirItem)</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+        dirList.selectedItem = dirItem;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+      else</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+        dirList.value = &quot;&quot;;</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+    } else {</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+      // Choose item meaning there is no default startup directory any more.</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+      dirList.value = &quot;&quot;;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+    }</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+  },</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+  setDefaultStartupDir: function(aDirURI) {</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+    if (aDirURI) {</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+      // Some AB directory was selected. Set prefs to make this directory</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+      // the default view when starting up the main AB.</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+      Services.prefs.setCharPref(&quot;mail.addr_book.view.startupURI&quot;, aDirURI);</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+      Services.prefs.setBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;, true);</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+    } else {</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+      // Set pref that there's no default startup view directory any more.</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+      Services.prefs.setBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;, false);</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+    }</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+  },</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+</span>
<a href="#l4.65"></a><span id="l4.65">   initLanguageMenu: function ()</span>
<a href="#l4.66"></a><span id="l4.66">   {</span>
<a href="#l4.67"></a><span id="l4.67">     var languageMenuList = document.getElementById(&quot;languageMenuList&quot;);</span>
<a href="#l4.68"></a><span id="l4.68">     this.mSpellChecker = Components.classes['@mozilla.org/spellchecker/engine;1'].getService(Components.interfaces.mozISpellCheckingEngine);</span>
<a href="#l4.69"></a><span id="l4.69">     var o1 = {};</span>
<a href="#l4.70"></a><span id="l4.70">     var o2 = {};</span>
<a href="#l4.71"></a><span id="l4.71"> </span>
<a href="#l4.72"></a><span id="l4.72">     // Get the list of dictionaries from</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineat">@@ -170,17 +206,17 @@ var gComposePane = {</span>
<a href="#l4.74"></a><span id="l4.74">             localFonts[i] != &quot;sans-serif&quot; &amp;&amp; localFonts[i] != &quot;monospace&quot;)</span>
<a href="#l4.75"></a><span id="l4.75">           fontsList.appendItem(localFonts[i], localFonts[i]);</span>
<a href="#l4.76"></a><span id="l4.76">       }</span>
<a href="#l4.77"></a><span id="l4.77">     }</span>
<a href="#l4.78"></a><span id="l4.78">     catch(e) { }</span>
<a href="#l4.79"></a><span id="l4.79">     // Choose the item after the list is completely generated.</span>
<a href="#l4.80"></a><span id="l4.80">     var preference = document.getElementById(fontsList.getAttribute(&quot;preference&quot;));</span>
<a href="#l4.81"></a><span id="l4.81">     fontsList.value = preference.value;</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-   },</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+  },</span>
<a href="#l4.84"></a><span id="l4.84"> </span>
<a href="#l4.85"></a><span id="l4.85">    restoreHTMLDefaults: function()</span>
<a href="#l4.86"></a><span id="l4.86">    {</span>
<a href="#l4.87"></a><span id="l4.87">      // reset throws an exception if the pref value is already the default so</span>
<a href="#l4.88"></a><span id="l4.88">      // work around that with some try/catch exception handling</span>
<a href="#l4.89"></a><span id="l4.89">      try {</span>
<a href="#l4.90"></a><span id="l4.90">        document.getElementById('msgcompose.font_face').reset();</span>
<a href="#l4.91"></a><span id="l4.91">      } catch (ex) {}</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineat">@@ -191,10 +227,35 @@ var gComposePane = {</span>
<a href="#l4.93"></a><span id="l4.93"> </span>
<a href="#l4.94"></a><span id="l4.94">      try {</span>
<a href="#l4.95"></a><span id="l4.95">        document.getElementById('msgcompose.text_color').reset();</span>
<a href="#l4.96"></a><span id="l4.96">      } catch (ex) {}</span>
<a href="#l4.97"></a><span id="l4.97"> </span>
<a href="#l4.98"></a><span id="l4.98">      try {</span>
<a href="#l4.99"></a><span id="l4.99">        document.getElementById('msgcompose.background_color').reset();</span>
<a href="#l4.100"></a><span id="l4.100">      } catch (ex) {}</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-   }</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+  },</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineplus">+</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineplus">+  startupDirListener: {</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+    inited: false,</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineplus">+    domain: &quot;mail.addr_book.view.startupURI&quot;,</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+    observe: function(subject, topic, prefName) {</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+      if (topic != &quot;nsPref:changed&quot;)</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+        return;</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+      // If the default startup directory prefs have changed,</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+      // reinitialize the default startup dir picker to show the new value.</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+      gComposePane.initAbDefaultStartupDir();</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+    },</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineplus">+    load: function() {</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineplus">+      // Observe changes of our prefs.</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+      Services.prefs.addObserver(this.domain, this, false);</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+      // Unload the pref observer when preferences window is closed.</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineplus">+      window.addEventListener(&quot;unload&quot;, this.unload, true);</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+      this.inited = true;</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+    },</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineplus">+</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineplus">+    unload: function(event) {</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineplus">+      Services.prefs.removeObserver(gComposePane.startupDirListener.domain,</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineplus">+                                    gComposePane.startupDirListener);</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+    }</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+  }</span>
<a href="#l4.128"></a><span id="l4.128"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/preferences/compose.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/preferences/compose.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -214,16 +214,27 @@</span>
<a href="#l5.4"></a><span id="l5.4">                         oncommand=&quot;gComposePane.updateEmailCollection();&quot;/&gt;</span>
<a href="#l5.5"></a><span id="l5.5">               &lt;menulist id=&quot;localDirectoriesList&quot; flex=&quot;1&quot;</span>
<a href="#l5.6"></a><span id="l5.6">                         preference=&quot;mail.collect_addressbook&quot;</span>
<a href="#l5.7"></a><span id="l5.7">                         aria-labelledby=&quot;emailCollectionOutgoing&quot;&gt;</span>
<a href="#l5.8"></a><span id="l5.8">                 &lt;menupopup id=&quot;abPopup-menupopup&quot; class=&quot;addrbooksPopup&quot;</span>
<a href="#l5.9"></a><span id="l5.9">                            localonly=&quot;true&quot; writable=&quot;true&quot;/&gt;</span>
<a href="#l5.10"></a><span id="l5.10">               &lt;/menulist&gt;</span>
<a href="#l5.11"></a><span id="l5.11">             &lt;/hbox&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+           &lt;hbox align=&quot;center&quot; pack=&quot;start&quot;&gt;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+             &lt;label value=&quot;&amp;showAsDefault.label;&quot; accesskey=&quot;&amp;showAsDefault.accesskey;&quot;/&gt;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+             &lt;menulist id=&quot;defaultStartupDirList&quot; flex=&quot;1&quot;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+                       oncommand=&quot;gComposePane.setDefaultStartupDir(this.value);&quot;&gt;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+               &lt;menupopup class=&quot;addrbooksPopup&quot;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+                          none=&quot;&amp;showAsDefaultLast.label;&quot;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+                          alladdressbooks=&quot;true&quot;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+                          mailinglists=&quot;true&quot;/&gt;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+             &lt;/menulist&gt;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+           &lt;/hbox&gt;</span>
<a href="#l5.23"></a><span id="l5.23">          &lt;/tabpanel&gt;</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25">          &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l5.26"></a><span id="l5.26">             &lt;hbox&gt;</span>
<a href="#l5.27"></a><span id="l5.27">               &lt;checkbox id=&quot;spellCheckBeforeSend&quot;</span>
<a href="#l5.28"></a><span id="l5.28">                         label=&quot;&amp;spellCheck.label;&quot;</span>
<a href="#l5.29"></a><span id="l5.29">                         preference=&quot;mail.SpellCheckBeforeSend&quot;</span>
<a href="#l5.30"></a><span id="l5.30">                         accesskey=&quot;&amp;spellCheck.accesskey;&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -135,16 +135,18 @@ because displayed names don't have the c</span>
<a href="#l6.4"></a><span id="l6.4"> &lt;!ENTITY preferencesCmdUnix.label                       &quot;Preferences&quot;&gt;</span>
<a href="#l6.5"></a><span id="l6.5"> &lt;!ENTITY preferencesCmdUnix.accesskey                   &quot;n&quot;&gt;</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7"> &lt;!-- Address Book Toolbar and Context Menus --&gt;</span>
<a href="#l6.8"></a><span id="l6.8"> &lt;!ENTITY newContactButton.label                         &quot;New Contact&quot;&gt;</span>
<a href="#l6.9"></a><span id="l6.9"> &lt;!ENTITY newContactButton.accesskey                     &quot;C&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10"> &lt;!ENTITY newlistButton.label                            &quot;New List&quot;&gt;</span>
<a href="#l6.11"></a><span id="l6.11"> &lt;!ENTITY newlistButton.accesskey                        &quot;L&quot;&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+&lt;!ENTITY showAsDefault.label                            &quot;Default startup directory&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+&lt;!ENTITY showAsDefault.accesskey                        &quot;S&quot;&gt;</span>
<a href="#l6.14"></a><span id="l6.14"> &lt;!ENTITY editPropertiesButton.label                     &quot;Edit&quot;&gt;</span>
<a href="#l6.15"></a><span id="l6.15"> &lt;!ENTITY propertiesContext.label                        &quot;Properties&quot;&gt;</span>
<a href="#l6.16"></a><span id="l6.16"> &lt;!ENTITY propertiesContext.accesskey                    &quot;i&quot;&gt;</span>
<a href="#l6.17"></a><span id="l6.17"> &lt;!ENTITY abPropertiesContext.label                      &quot;Properties&quot;&gt;</span>
<a href="#l6.18"></a><span id="l6.18"> &lt;!ENTITY abPropertiesContext.accesskey                  &quot;i&quot;&gt;</span>
<a href="#l6.19"></a><span id="l6.19"> &lt;!ENTITY editContactContext.label                       &quot;Edit Contact&quot;&gt;</span>
<a href="#l6.20"></a><span id="l6.20"> &lt;!ENTITY editContactContext.accesskey                   &quot;E&quot;&gt;</span>
<a href="#l6.21"></a><span id="l6.21"> &lt;!ENTITY editMailingListContext.label                   &quot;Edit List&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/compose.dtd</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/compose.dtd</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -49,16 +49,19 @@</span>
<a href="#l7.4"></a><span id="l7.4"> &lt;!ENTITY autocompleteText.label                &quot;When addressing messages, look for matching entries in:&quot;&gt;</span>
<a href="#l7.5"></a><span id="l7.5"> &lt;!ENTITY addressingEnable.label                &quot;Local Address Books&quot;&gt;</span>
<a href="#l7.6"></a><span id="l7.6"> &lt;!ENTITY addressingEnable.accesskey            &quot;L&quot;&gt;</span>
<a href="#l7.7"></a><span id="l7.7"> &lt;!ENTITY directories.label                     &quot;Directory Server:&quot;&gt;</span>
<a href="#l7.8"></a><span id="l7.8"> &lt;!ENTITY directories.accesskey                 &quot;D&quot;&gt;</span>
<a href="#l7.9"></a><span id="l7.9"> &lt;!ENTITY directoriesNone.label                 &quot;None&quot;&gt;</span>
<a href="#l7.10"></a><span id="l7.10"> &lt;!ENTITY editDirectories.label                 &quot;Edit Directories…&quot;&gt;</span>
<a href="#l7.11"></a><span id="l7.11"> &lt;!ENTITY editDirectories.accesskey             &quot;E&quot;&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+&lt;!ENTITY showAsDefault.label                   &quot;Default startup directory in the address book window:&quot;&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+&lt;!ENTITY showAsDefault.accesskey               &quot;S&quot;&gt;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+&lt;!ENTITY showAsDefaultLast.label               &quot;Last used directory&quot;&gt;</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16"> &lt;!ENTITY sendOptionsDescription.label          &quot;Configure text format behavior&quot;&gt;</span>
<a href="#l7.17"></a><span id="l7.17"> &lt;!ENTITY sendOptions.label                     &quot;Send Options…&quot;&gt;</span>
<a href="#l7.18"></a><span id="l7.18"> &lt;!ENTITY sendOptions.accesskey                 &quot;S&quot;&gt;</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> &lt;!ENTITY attachmentReminder.label              &quot;Check for missing attachments&quot;&gt;</span>
<a href="#l7.21"></a><span id="l7.21"> &lt;!ENTITY attachmentReminder.accesskey          &quot;m&quot;&gt;</span>
<a href="#l7.22"></a><span id="l7.22"> &lt;!ENTITY attachmentReminderOptions.label       &quot;Keywords…&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/themes/shared/mail/messenger.css</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/themes/shared/mail/messenger.css</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -77,8 +77,26 @@ notification[value=&quot;addon-install-failed</span>
<a href="#l8.4"></a><span id="l8.4"> @keyframes highlight {</span>
<a href="#l8.5"></a><span id="l8.5">   from { background-color: Highlight; }</span>
<a href="#l8.6"></a><span id="l8.6">   to { background-color: transparent; }</span>
<a href="#l8.7"></a><span id="l8.7"> }</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> #findbar-beforeReplaceSeparator {</span>
<a href="#l8.10"></a><span id="l8.10">   height: 16px;</span>
<a href="#l8.11"></a><span id="l8.11"> }</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+/* ::::: Address Book menuitem icons ::::: */</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+.abMenuItem[AddrBook=&quot;true&quot;] {</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/addressbook/icons/addrbook.png&quot;);</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+}</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+.abMenuItem[MailList=&quot;true&quot;] {</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/addressbook/icons/ablist.png&quot;);</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+}</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+.abMenuItem[AddrBook=&quot;true&quot;][IsRemote=&quot;true&quot;] {</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/addressbook/icons/remote-addrbook.png&quot;);</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+}</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+.abMenuItem[AddrBook=&quot;true&quot;][IsRemote=&quot;true&quot;][IsSecure=&quot;true&quot;] {</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/addressbook/icons/secure-remote-addrbook.png&quot;);</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/addrbook/content/addrbookWidgets.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/addrbook/content/addrbookWidgets.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -13,134 +13,181 @@</span>
<a href="#l9.4"></a><span id="l9.4">     &lt;implementation implements=&quot;nsIAbListener&quot;&gt;</span>
<a href="#l9.5"></a><span id="l9.5">       &lt;!-- A cache of nsIAbDirectory objects. --&gt;</span>
<a href="#l9.6"></a><span id="l9.6">       &lt;field name=&quot;_directories&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">       &lt;!-- Represents the nsIAbDirectory attribute used as the value of the</span>
<a href="#l9.9"></a><span id="l9.9">            parent menulist. Defaults to URI but can be e.g. dirPrefId --&gt;</span>
<a href="#l9.10"></a><span id="l9.10">       &lt;field name=&quot;_value&quot;&gt;this.getAttribute(&quot;value&quot;) || &quot;URI&quot;&lt;/field&gt;</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+      &lt;field name=&quot;_stringBundle&quot;&gt;null&lt;/field&gt;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+</span>
<a href="#l9.14"></a><span id="l9.14">       &lt;constructor&gt;</span>
<a href="#l9.15"></a><span id="l9.15">         &lt;![CDATA[</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-          Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-          // Init the address book cache.</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-          const nsIAbDirectory = Components.interfaces.nsIAbDirectory;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-          let directories = MailServices.ab.directories;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-          while (directories &amp;&amp; directories.hasMoreElements()) {</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-            var ab = directories.getNext();</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-            if (ab instanceof nsIAbDirectory &amp;&amp; this._matches(ab))</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-              this._directories.push(ab);</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-          }</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-          this._directories.sort(this._compare);</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+          Components.utils.import(&quot;resource:///modules/mailServices.js&quot;, this);</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+          Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;, this);</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+          Components.utils.import(&quot;resource:///modules/StringBundle.js&quot;, this);</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+          this._stringBundle = new this</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+              .StringBundle(&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;);</span>
<a href="#l9.32"></a><span id="l9.32"> </span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-          // Now create menuitems for all displayed directories.</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">-          var menulist = this.parentNode;</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-          var value = this._value;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-          this._directories.forEach(function (ab) {</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-            menulist.appendItem(ab.dirName, ab[value]);</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-          });</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-          if (this.hasAttribute(&quot;none&quot;)) {</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-            // Create a dummy menuitem representing no selection.</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-            this._directories.unshift(null);</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-            menulist.insertItemAt(0, this.getAttribute(&quot;none&quot;), &quot;&quot;);</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-          }</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineminus">-</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-          // Attempt to select the persisted or otherwise first directory.</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-          menulist.value = menulist.value;</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-          if (!menulist.selectedItem &amp;&amp; this.hasChildNodes())</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">-            menulist.selectedIndex = 0;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+          this._rebuild();</span>
<a href="#l9.51"></a><span id="l9.51">           const nsIAbListener = Components.interfaces.nsIAbListener;</span>
<a href="#l9.52"></a><span id="l9.52">           // Add a listener so we can update correctly if the list should change</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-          MailServices.ab.addAddressBookListener(this,</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-                                                 nsIAbListener.itemAdded |</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-                                                 nsIAbListener.directoryRemoved |</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-                                                 nsIAbListener.itemChanged);</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+          this.MailServices.ab</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+              .addAddressBookListener(this,</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+                                      nsIAbListener.itemAdded |</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+                                      nsIAbListener.directoryItemRemoved |</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+                                      nsIAbListener.directoryRemoved |</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+                                      nsIAbListener.itemChanged);</span>
<a href="#l9.63"></a><span id="l9.63">         ]]&gt;</span>
<a href="#l9.64"></a><span id="l9.64">       &lt;/constructor&gt;</span>
<a href="#l9.65"></a><span id="l9.65"> </span>
<a href="#l9.66"></a><span id="l9.66">       &lt;destructor&gt;</span>
<a href="#l9.67"></a><span id="l9.67">         &lt;![CDATA[</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-          Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-          MailServices.ab.removeAddressBookListener(this);</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+          this.MailServices.ab.removeAddressBookListener(this);</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+          this._teardown();</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+        ]]&gt;</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+      &lt;/destructor&gt;</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+      &lt;method name=&quot;_rebuild&quot;&gt;</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+        &lt;parameter name=&quot;aSelectValue&quot;/&gt;</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+          // Init the address book cache.</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+          this._directories.length = 0;</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+          const nsIAbDirectory = Components.interfaces.nsIAbDirectory;</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+          let directories = this.MailServices.ab.directories;</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+          while (directories &amp;&amp; directories.hasMoreElements()) {</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+            let ab = directories.getNext();</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+            if ((ab instanceof nsIAbDirectory) &amp;&amp; this._matches(ab)) {</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+              this._directories.push(ab);</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+              if (this.getAttribute(&quot;mailinglists&quot;) == &quot;true&quot;) {</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+                // Also append contained mailinglists.</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+                for (let list of this.fixIterator(ab.childNodes, Components.interfaces.nsIAbDirectory)) {</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+                  if (this._matches(list))</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+                    this._directories.push(list);</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+                }</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+              }</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+            }</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+          }</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+          this._sort();</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineplus">+          this._teardown();</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineplus">+</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineplus">+          // Now create menuitems for all displayed directories.</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineplus">+          let menulist = this.parentNode;</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineplus">+          let value = this._value;</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineplus">+          for (let ab of this._directories) {</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+            let listItem = menulist.appendItem(ab.dirName, ab[value]);</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+            listItem.setAttribute(&quot;class&quot;, &quot;menuitem-iconic abMenuItem&quot;);</span>
<a href="#l9.107"></a><span id="l9.107"> </span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+            // Style the items by type.</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineplus">+            if (ab.isMailList)</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineplus">+              listItem.setAttribute(&quot;MailList&quot;, &quot;true&quot;);</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineplus">+            else</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineplus">+              listItem.setAttribute(&quot;AddrBook&quot;, &quot;true&quot;);</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineplus">+</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineplus">+            if (ab.isRemote)</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineplus">+              listItem.setAttribute(&quot;IsRemote&quot;, &quot;true&quot;);</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineplus">+            if (ab.isSecure)</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineplus">+              listItem.setAttribute(&quot;IsSecure&quot;, &quot;true&quot;);</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineplus">+          }</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineplus">+</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineplus">+          if (this.hasAttribute(&quot;alladdressbooks&quot;)) {</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineplus">+            // Insert a menuitem representing All addressbooks.</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineplus">+            let allABLabel = this.getAttribute(&quot;alladdressbooks&quot;);</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineplus">+            if (allABLabel == &quot;true&quot;)</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineplus">+              allABLabel = this._stringBundle.getString(&quot;allAddressBooks&quot;);</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+            const allABURI = &quot;moz-abdirectory://?&quot;;</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+            this._directories.unshift(null);</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+            let listItem = menulist.insertItemAt(0, allABLabel, allABURI);</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineplus">+            listItem.setAttribute(&quot;class&quot;, &quot;menuitem-iconic abMenuItem&quot;);</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineplus">+            listItem.setAttribute(&quot;AddrBook&quot;, &quot;true&quot;);</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineplus">+            listItem.setAttribute(&quot;IsAllAB&quot;, &quot;true&quot;);</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineplus">+          }</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineplus">+          if (this.hasAttribute(&quot;none&quot;)) {</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineplus">+            // Create a dummy menuitem representing no selection.</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineplus">+            this._directories.unshift(null);</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineplus">+            let listItem = menulist.insertItemAt(0, this.getAttribute(&quot;none&quot;), &quot;&quot;);</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineplus">+            listItem.setAttribute(&quot;class&quot;, &quot;menuitem-iconic abMenuItem&quot;);</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+            listItem.setAttribute(&quot;IsNone&quot;, &quot;true&quot;);</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineplus">+          }</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineplus">+</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineplus">+          // Attempt to select the persisted or otherwise first directory.</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineplus">+          menulist.value = aSelectValue || this.parentNode.value;</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineplus">+          if (!menulist.selectedItem &amp;&amp; this.hasChildNodes())</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineplus">+            menulist.selectedIndex = 0;</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineplus">+</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineplus">+      &lt;method name=&quot;_teardown&quot;&gt;</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.150"></a><span id="l9.150">           // Empty out anything in the list.</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+          // (Don't use menulist.removeAllItems() as it would remove</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineplus">+          // the menupopup with our special attributes too.)</span>
<a href="#l9.153"></a><span id="l9.153">           while (this.hasChildNodes())</span>
<a href="#l9.154"></a><span id="l9.154">             this.lastChild.remove();</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineminus">-        ]]&gt;</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineminus">-      &lt;/destructor&gt;</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l9.159"></a><span id="l9.159"> </span>
<a href="#l9.160"></a><span id="l9.160">       &lt;!-- nsIAbListener methods --&gt;</span>
<a href="#l9.161"></a><span id="l9.161">       &lt;method name=&quot;onItemAdded&quot;&gt;</span>
<a href="#l9.162"></a><span id="l9.162">         &lt;parameter name=&quot;aParentDir&quot;/&gt;</span>
<a href="#l9.163"></a><span id="l9.163">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l9.164"></a><span id="l9.164">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.165"></a><span id="l9.165">           // Are we interested in this new directory?</span>
<a href="#l9.166"></a><span id="l9.166">           if (aItem instanceof Components.interfaces.nsIAbDirectory &amp;&amp;</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineminus">-              !aItem.isMailList &amp;&amp; this._matches(aItem)) {</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineminus">-            this._directories.push(aItem);</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineminus">-            this._directories.sort(this._compare);</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineminus">-            // Insert the new menuitem at the position to which it was sorted.</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineminus">-            this.parentNode.insertItemAt(this._directories.indexOf(aItem),</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineminus">-                                         aItem.dirName, aItem[this._value]);</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+              this._matches(aItem)) {</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+            this._rebuild();</span>
<a href="#l9.175"></a><span id="l9.175">           }</span>
<a href="#l9.176"></a><span id="l9.176">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.177"></a><span id="l9.177">       &lt;/method&gt;</span>
<a href="#l9.178"></a><span id="l9.178"> </span>
<a href="#l9.179"></a><span id="l9.179">       &lt;method name=&quot;onItemRemoved&quot;&gt;</span>
<a href="#l9.180"></a><span id="l9.180">         &lt;parameter name=&quot;aParentDir&quot;/&gt;</span>
<a href="#l9.181"></a><span id="l9.181">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l9.182"></a><span id="l9.182">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineminus">-          if (aItem instanceof Components.interfaces.nsIAbDirectory &amp;&amp;</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineminus">-              !aItem.isMailList) {</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineminus">-            // Find the item in the list to remove</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineminus">-            // We can't use indexOf here because we need loose equality</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineplus">+          if (aItem instanceof Components.interfaces.nsIAbDirectory) {</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineplus">+            // Find the item in the list to remove.</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineplus">+            // We can't use indexOf here because we need loose equality.</span>
<a href="#l9.190"></a><span id="l9.190">             for (var index = this._directories.length; --index &gt;= 0; )</span>
<a href="#l9.191"></a><span id="l9.191">               if (this._directories[index] == aItem)</span>
<a href="#l9.192"></a><span id="l9.192">                 break;</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineminus">-            if (index != -1)</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineplus">+            if (index != -1) {</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineplus">+              this._directories.splice(index, 1);</span>
<a href="#l9.196"></a><span id="l9.196">               // Are we removing the selected directory?</span>
<a href="#l9.197"></a><span id="l9.197">               if (this.parentNode.selectedItem ==</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineminus">-                  this.removeChild(this.childNodes[index]))</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineplus">+                  this.removeChild(this.childNodes[index])) {</span>
<a href="#l9.200"></a><span id="l9.200">                 // If so, try to select the first directory, if available.</span>
<a href="#l9.201"></a><span id="l9.201">                 if (this.hasChildNodes())</span>
<a href="#l9.202"></a><span id="l9.202">                   this.firstChild.doCommand();</span>
<a href="#l9.203"></a><span id="l9.203">                 else</span>
<a href="#l9.204"></a><span id="l9.204">                   this.parentNode.selectedItem = null;</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineplus">+              }</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineplus">+            }</span>
<a href="#l9.207"></a><span id="l9.207">           }</span>
<a href="#l9.208"></a><span id="l9.208">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.209"></a><span id="l9.209">       &lt;/method&gt;</span>
<a href="#l9.210"></a><span id="l9.210"> </span>
<a href="#l9.211"></a><span id="l9.211">       &lt;method name=&quot;onItemPropertyChanged&quot;&gt;</span>
<a href="#l9.212"></a><span id="l9.212">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l9.213"></a><span id="l9.213">         &lt;parameter name=&quot;aProperty&quot;/&gt;</span>
<a href="#l9.214"></a><span id="l9.214">         &lt;parameter name=&quot;aOldValue&quot;/&gt;</span>
<a href="#l9.215"></a><span id="l9.215">         &lt;parameter name=&quot;aNewValue&quot;/&gt;</span>
<a href="#l9.216"></a><span id="l9.216">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineminus">-          if (aItem instanceof Components.interfaces.nsIAbDirectory &amp;&amp;</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineminus">-              !aItem.isMailList) {</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineplus">+          if (aItem instanceof Components.interfaces.nsIAbDirectory) {</span>
<a href="#l9.220"></a><span id="l9.220">             // Find the item in the list to rename.</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineminus">-            // We can't use indexOf here because we need loose equality</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineplus">+            // We can't use indexOf here because we need loose equality.</span>
<a href="#l9.223"></a><span id="l9.223">             for (var oldIndex = this._directories.length; --oldIndex &gt;= 0; )</span>
<a href="#l9.224"></a><span id="l9.224">               if (this._directories[oldIndex] == aItem)</span>
<a href="#l9.225"></a><span id="l9.225">                 break;</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineminus">-            if (oldIndex != -1) {</span>
<a href="#l9.227"></a><span id="l9.227" class="difflineminus">-              // Cache the matching item so that we can use indexOf next time.</span>
<a href="#l9.228"></a><span id="l9.228" class="difflineminus">-              aItem = this._directories[oldIndex];</span>
<a href="#l9.229"></a><span id="l9.229" class="difflineminus">-              var child = this.childNodes[oldIndex];</span>
<a href="#l9.230"></a><span id="l9.230" class="difflineminus">-              child.label = aItem.dirName;</span>
<a href="#l9.231"></a><span id="l9.231" class="difflineminus">-              this._directories.sort(this._compare);</span>
<a href="#l9.232"></a><span id="l9.232" class="difflineminus">-              // Reorder the menuitems if renaming changed the directory index.</span>
<a href="#l9.233"></a><span id="l9.233" class="difflineminus">-              var newIndex = this._directories.indexOf(aItem);</span>
<a href="#l9.234"></a><span id="l9.234" class="difflineminus">-              if (newIndex &lt; oldIndex)</span>
<a href="#l9.235"></a><span id="l9.235" class="difflineminus">-                this.insertBefore(child, this.childNodes[newIndex]);</span>
<a href="#l9.236"></a><span id="l9.236" class="difflineminus">-              else if (newIndex &gt; oldIndex)</span>
<a href="#l9.237"></a><span id="l9.237" class="difflineminus">-                this.insertBefore(child, this.childNodes[newIndex].nextSibling);</span>
<a href="#l9.238"></a><span id="l9.238" class="difflineminus">-            }</span>
<a href="#l9.239"></a><span id="l9.239" class="difflineplus">+            if (oldIndex != -1)</span>
<a href="#l9.240"></a><span id="l9.240" class="difflineplus">+              this._rebuild();</span>
<a href="#l9.241"></a><span id="l9.241">           }</span>
<a href="#l9.242"></a><span id="l9.242">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.243"></a><span id="l9.243">       &lt;/method&gt;</span>
<a href="#l9.244"></a><span id="l9.244"> </span>
<a href="#l9.245"></a><span id="l9.245">       &lt;!-- Private methods --&gt;</span>
<a href="#l9.246"></a><span id="l9.246">       &lt;!-- Tests to see whether this directory should display in the list. --&gt;</span>
<a href="#l9.247"></a><span id="l9.247">       &lt;method name=&quot;_matches&quot;&gt;</span>
<a href="#l9.248"></a><span id="l9.248">         &lt;parameter name=&quot;ab&quot;/&gt;</span>
<a href="#l9.249"></a><span id="l9.249" class="difflineat">@@ -153,16 +200,53 @@</span>
<a href="#l9.250"></a><span id="l9.250">           if (this.getAttribute(&quot;supportsmaillists&quot;) == &quot;true&quot; &amp;&amp;</span>
<a href="#l9.251"></a><span id="l9.251">               !ab.supportsMailingLists)</span>
<a href="#l9.252"></a><span id="l9.252">             return false;</span>
<a href="#l9.253"></a><span id="l9.253"> </span>
<a href="#l9.254"></a><span id="l9.254">           return this.getAttribute(ab.isRemote ? &quot;localonly&quot; : &quot;remoteonly&quot;) != &quot;true&quot;;</span>
<a href="#l9.255"></a><span id="l9.255">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.256"></a><span id="l9.256">       &lt;/method&gt;</span>
<a href="#l9.257"></a><span id="l9.257"> </span>
<a href="#l9.258"></a><span id="l9.258" class="difflineplus">+      &lt;!-- Sort all our directories. --&gt;</span>
<a href="#l9.259"></a><span id="l9.259" class="difflineplus">+      &lt;method name=&quot;_sort&quot;&gt;</span>
<a href="#l9.260"></a><span id="l9.260" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.261"></a><span id="l9.261" class="difflineplus">+          let lists = {};</span>
<a href="#l9.262"></a><span id="l9.262" class="difflineplus">+          let lastAB;</span>
<a href="#l9.263"></a><span id="l9.263" class="difflineplus">+          // If there are any mailing lists, pull them out of the array temporarily.</span>
<a href="#l9.264"></a><span id="l9.264" class="difflineplus">+          for (let d = 0; d &lt; this._directories.length; d++) {</span>
<a href="#l9.265"></a><span id="l9.265" class="difflineplus">+            if (this._directories[d].isMailList) {</span>
<a href="#l9.266"></a><span id="l9.266" class="difflineplus">+              let [list] = this._directories.splice(d, 1);</span>
<a href="#l9.267"></a><span id="l9.267" class="difflineplus">+              if (!(lastAB in lists))</span>
<a href="#l9.268"></a><span id="l9.268" class="difflineplus">+                lists[lastAB] = [];</span>
<a href="#l9.269"></a><span id="l9.269" class="difflineplus">+              lists[lastAB].push(list);</span>
<a href="#l9.270"></a><span id="l9.270" class="difflineplus">+              d--;</span>
<a href="#l9.271"></a><span id="l9.271" class="difflineplus">+            } else {</span>
<a href="#l9.272"></a><span id="l9.272" class="difflineplus">+              lastAB = this._directories[d].URI;</span>
<a href="#l9.273"></a><span id="l9.273" class="difflineplus">+            }</span>
<a href="#l9.274"></a><span id="l9.274" class="difflineplus">+          }</span>
<a href="#l9.275"></a><span id="l9.275" class="difflineplus">+</span>
<a href="#l9.276"></a><span id="l9.276" class="difflineplus">+          this._directories.sort(this._compare);</span>
<a href="#l9.277"></a><span id="l9.277" class="difflineplus">+</span>
<a href="#l9.278"></a><span id="l9.278" class="difflineplus">+          // Push mailing lists back appending them after their respective</span>
<a href="#l9.279"></a><span id="l9.279" class="difflineplus">+          // containing addressbook.</span>
<a href="#l9.280"></a><span id="l9.280" class="difflineplus">+          for (let d = this._directories.length - 1; d &gt;= 0; d--) {</span>
<a href="#l9.281"></a><span id="l9.281" class="difflineplus">+            let abURI = this._directories[d].URI;</span>
<a href="#l9.282"></a><span id="l9.282" class="difflineplus">+            if (abURI in lists) {</span>
<a href="#l9.283"></a><span id="l9.283" class="difflineplus">+              lists[abURI].sort(function(a,b) { return a.dirName.localeCompare(b.dirName); });</span>
<a href="#l9.284"></a><span id="l9.284" class="difflineplus">+              let listIndex = d;</span>
<a href="#l9.285"></a><span id="l9.285" class="difflineplus">+              for (let list of lists[abURI]) {</span>
<a href="#l9.286"></a><span id="l9.286" class="difflineplus">+                listIndex++;</span>
<a href="#l9.287"></a><span id="l9.287" class="difflineplus">+                this._directories.splice(listIndex, 0, list);</span>
<a href="#l9.288"></a><span id="l9.288" class="difflineplus">+              }</span>
<a href="#l9.289"></a><span id="l9.289" class="difflineplus">+              delete lists[abURI];</span>
<a href="#l9.290"></a><span id="l9.290" class="difflineplus">+            }</span>
<a href="#l9.291"></a><span id="l9.291" class="difflineplus">+          }</span>
<a href="#l9.292"></a><span id="l9.292" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l9.293"></a><span id="l9.293" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l9.294"></a><span id="l9.294" class="difflineplus">+</span>
<a href="#l9.295"></a><span id="l9.295">       &lt;!-- Used to sort directories in order --&gt;</span>
<a href="#l9.296"></a><span id="l9.296">       &lt;method name=&quot;_compare&quot;&gt;</span>
<a href="#l9.297"></a><span id="l9.297">         &lt;parameter name=&quot;a&quot;/&gt;</span>
<a href="#l9.298"></a><span id="l9.298">         &lt;parameter name=&quot;b&quot;/&gt;</span>
<a href="#l9.299"></a><span id="l9.299">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.300"></a><span id="l9.300">           // Null at the very top.</span>
<a href="#l9.301"></a><span id="l9.301">           if (!a)</span>
<a href="#l9.302"></a><span id="l9.302">             return -1;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

