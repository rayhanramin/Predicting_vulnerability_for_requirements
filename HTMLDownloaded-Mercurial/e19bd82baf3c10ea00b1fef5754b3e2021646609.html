<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25214:e19bd82baf3c10ea00b1fef5754b3e2021646609</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ e19bd82baf3c10ea00b1fef5754b3e2021646609" />
<meta property="og:url" content="/comm-central/rev/e19bd82baf3c10ea00b1fef5754b3e2021646609" />
<meta property="og:description" content="Bug 1507001 - Remove command controller from outgoing attachments pane. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / e19bd82baf3c10ea00b1fef5754b3e2021646609 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/e19bd82baf3c10ea00b1fef5754b3e2021646609">shortlog</a> |
<a href="/comm-central/log/e19bd82baf3c10ea00b1fef5754b3e2021646609">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/e19bd82baf3c10ea00b1fef5754b3e2021646609">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/e19bd82baf3c10ea00b1fef5754b3e2021646609">files</a> |
changeset |
<a href="/comm-central/raw-rev/e19bd82baf3c10ea00b1fef5754b3e2021646609">raw</a>  | <a href="/comm-central/archive/e19bd82baf3c10ea00b1fef5754b3e2021646609.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1507001">Bug 1507001</a> - Remove command controller from outgoing attachments pane. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 14 Nov 2018 20:36:53 +1300</td></tr>

<tr>
 <td>changeset 25214</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/e19bd82baf3c10ea00b1fef5754b3e2021646609">e19bd82baf3c10ea00b1fef5754b3e2021646609</a></td>
</tr>



<tr>
<td>parent 25213</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/465c90ec3466efeac4e52f3696d889069f23ca2a">465c90ec3466efeac4e52f3696d889069f23ca2a</a>
</td>
</tr>

<tr>
<td>child 25215</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8ca96cbae03df48764aae6ab431b91164f16fd9b">8ca96cbae03df48764aae6ab431b91164f16fd9b</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=e19bd82baf3c10ea00b1fef5754b3e2021646609">15135</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 16 Nov 2018 22:21:35 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@fa82003e8d33 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=fa82003e8d33fd5e1759a7b183fc65c18ebb207f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=fa82003e8d33fd5e1759a7b183fc65c18ebb207f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fa82003e8d33fd5e1759a7b183fc65c18ebb207f&newProject=comm-central&newRevision=1a1cb39d41c20a8e8a0c5a3dee4c583c7ef35a04&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fa82003e8d33fd5e1759a7b183fc65c18ebb207f&newProject=comm-central&newRevision=1a1cb39d41c20a8e8a0c5a3dee4c583c7ef35a04&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fa82003e8d33fd5e1759a7b183fc65c18ebb207f&newProject=comm-central&newRevision=1a1cb39d41c20a8e8a0c5a3dee4c583c7ef35a04&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1507001">1507001</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1507001">Bug 1507001</a> - Remove command controller from outgoing attachments pane. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.inc.xul">mail/components/preferences/applications.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.inc.xul">file</a> |
<a href="/comm-central/annotate/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.inc.xul">annotate</a> |
<a href="/comm-central/diff/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.inc.xul">diff</a> |
<a href="/comm-central/comparison/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.inc.xul">comparison</a> |
<a href="/comm-central/log/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.js">mail/components/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/e19bd82baf3c10ea00b1fef5754b3e2021646609/mail/components/preferences/applications.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/preferences/applications.inc.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/preferences/applications.inc.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -52,30 +52,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">     &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l1.5"></a><span id="l1.5">             src=&quot;chrome://messenger/content/preferences/applications.js&quot;/&gt;</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">     &lt;commandset id=&quot;appPaneCommandSet&quot;&gt;</span>
<a href="#l1.8"></a><span id="l1.8">       &lt;command id=&quot;cmd_delete&quot;</span>
<a href="#l1.9"></a><span id="l1.9">                oncommand=&quot;gApplicationsPane.onDelete();&quot;/&gt;</span>
<a href="#l1.10"></a><span id="l1.10">     &lt;/commandset&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    &lt;commandset id=&quot;cloudFileCommandSet&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-      &lt;commandset id=&quot;cloudFileCommandSetUpdate&quot;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-                  commandupdater=&quot;true&quot;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-                  events=&quot;focus&quot;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-                  oncommandupdate=&quot;CommandUpdate_CloudFile()&quot;/&gt;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-      &lt;command id=&quot;cmd_addCloudfileAccount&quot;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-               oncommand=&quot;goDoCommand('cmd_addCloudfileAccount');&quot;/&gt;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-      &lt;command id=&quot;cmd_removeCloudfileAccount&quot;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-               oncommand=&quot;goDoCommand('cmd_removeCloudfileAccount');&quot;/&gt;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-      &lt;command id=&quot;cmd_reauthCloudfileAccount&quot;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-               oncommand=&quot;goDoCommand('cmd_reauthCloudfileAccount');&quot;/&gt;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-    &lt;/commandset&gt;</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-</span>
<a href="#l1.26"></a><span id="l1.26">     &lt;keyset id=&quot;appPaneKeyset&quot;&gt;</span>
<a href="#l1.27"></a><span id="l1.27">       &lt;key keycode=&quot;VK_BACK&quot; modifiers=&quot;any&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l1.28"></a><span id="l1.28">       &lt;key keycode=&quot;VK_DELETE&quot; modifiers=&quot;any&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l1.29"></a><span id="l1.29">     &lt;/keyset&gt;</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31">     &lt;keyset&gt;</span>
<a href="#l1.32"></a><span id="l1.32">       &lt;key key=&quot;&amp;focusSearch1.key;&quot; modifiers=&quot;accel&quot;</span>
<a href="#l1.33"></a><span id="l1.33">            oncommand=&quot;gApplicationsPane.focusFilterBox();&quot;/&gt;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineat">@@ -171,23 +157,27 @@</span>
<a href="#l1.35"></a><span id="l1.35">             &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l1.36"></a><span id="l1.36">               &lt;vbox id=&quot;provider-listing&quot;&gt;</span>
<a href="#l1.37"></a><span id="l1.37">                 &lt;richlistbox id=&quot;cloudFileView&quot; orient=&quot;vertical&quot; flex=&quot;1&quot;</span>
<a href="#l1.38"></a><span id="l1.38">                              seltype=&quot;single&quot;</span>
<a href="#l1.39"></a><span id="l1.39">                              onselect=&quot;gCloudFileTab.onSelectionChanged();&quot;&gt;</span>
<a href="#l1.40"></a><span id="l1.40">                 &lt;/richlistbox&gt;</span>
<a href="#l1.41"></a><span id="l1.41">                 &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l1.42"></a><span id="l1.42">                 &lt;hbox&gt;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-                  &lt;button id=&quot;addCloudFileAccount&quot; flex=&quot;1&quot; label=&quot;&amp;addCloudFileAccount1.label;&quot;</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+                  &lt;button id=&quot;addCloudFileAccount&quot;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+                          flex=&quot;1&quot;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+                          label=&quot;&amp;addCloudFileAccount1.label;&quot;</span>
<a href="#l1.47"></a><span id="l1.47">                           accesskey=&quot;&amp;addCloudFileAccount1.accesskey;&quot;</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-                          command=&quot;cmd_addCloudfileAccount&quot;/&gt;</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-                  &lt;button id=&quot;removeCloudFileAccount&quot; flex=&quot;1&quot;</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+                          oncommand=&quot;gCloudFileTab.addCloudFileAccount();&quot;/&gt;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+                  &lt;button id=&quot;removeCloudFileAccount&quot;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+                          flex=&quot;1&quot;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+                          disabled=&quot;true&quot;</span>
<a href="#l1.54"></a><span id="l1.54">                           label=&quot;&amp;removeCloudFileAccount.label;&quot;</span>
<a href="#l1.55"></a><span id="l1.55">                           accesskey=&quot;&amp;removeCloudFileAccount.accesskey;&quot;</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-                          command=&quot;cmd_removeCloudfileAccount&quot;/&gt;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+                          oncommand=&quot;gCloudFileTab.removeCloudFileAccount();&quot;/&gt;</span>
<a href="#l1.58"></a><span id="l1.58">                 &lt;/hbox&gt;</span>
<a href="#l1.59"></a><span id="l1.59">               &lt;/vbox&gt;</span>
<a href="#l1.60"></a><span id="l1.60">               &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l1.61"></a><span id="l1.61">                 &lt;deck id=&quot;cloudFileSettingsDeck&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l1.62"></a><span id="l1.62">                   &lt;vbox id=&quot;cloudFileDefaultPanel&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l1.63"></a><span id="l1.63">                     &lt;description&gt;&amp;addCloudFileAccount.description;&lt;/description&gt;</span>
<a href="#l1.64"></a><span id="l1.64">                   &lt;/vbox&gt;</span>
<a href="#l1.65"></a><span id="l1.65">                   &lt;vbox id=&quot;cloudFileSettingsWrapper&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineat">@@ -204,17 +194,20 @@</span>
<a href="#l1.67"></a><span id="l1.67">                     &lt;hbox&gt;</span>
<a href="#l1.68"></a><span id="l1.68">                       &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l1.69"></a><span id="l1.69">                         &lt;image id=&quot;authImage&quot;/&gt;</span>
<a href="#l1.70"></a><span id="l1.70">                       &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l1.71"></a><span id="l1.71">                     &lt;/hbox&gt;</span>
<a href="#l1.72"></a><span id="l1.72">                     &lt;description id=&quot;authMessage&quot;&gt;&amp;authRequired.description;&lt;/description&gt;</span>
<a href="#l1.73"></a><span id="l1.73">                     &lt;hbox&gt;</span>
<a href="#l1.74"></a><span id="l1.74">                       &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-                        &lt;button command=&quot;cmd_reauthCloudfileAccount&quot; label=&quot;&amp;authRequired.button.label;&quot; accesskey=&quot;&amp;authRequired.button.accesskey;&quot;/&gt;</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+                        &lt;button id=&quot;reauthCloudFileAccount&quot;</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+                                label=&quot;&amp;authRequired.button.label;&quot;</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+                                accesskey=&quot;&amp;authRequired.button.accesskey;&quot;</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+                                oncommand=&quot;gCloudFileTab.authSelected();&quot;/&gt;</span>
<a href="#l1.80"></a><span id="l1.80">                       &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l1.81"></a><span id="l1.81">                      &lt;/hbox&gt;</span>
<a href="#l1.82"></a><span id="l1.82">                     &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l1.83"></a><span id="l1.83">                   &lt;/vbox&gt;</span>
<a href="#l1.84"></a><span id="l1.84">                 &lt;/deck&gt;</span>
<a href="#l1.85"></a><span id="l1.85">               &lt;/vbox&gt;</span>
<a href="#l1.86"></a><span id="l1.86">             &lt;/hbox&gt;</span>
<a href="#l1.87"></a><span id="l1.87">           &lt;/vbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/preferences/applications.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/preferences/applications.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -2,18 +2,16 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> // applications.inc.xul</span>
<a href="#l2.9"></a><span id="l2.9"> /* globals ICON_URL_APP */</span>
<a href="#l2.10"></a><span id="l2.10"> // mail/base/content/contentAreaClick.js</span>
<a href="#l2.11"></a><span id="l2.11"> /* globals openLinkExternally */</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-// toolkit/content/globalOverlay.js</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-/* globals goUpdateCommand */</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15"> // ------------------------------</span>
<a href="#l2.16"></a><span id="l2.16"> // Constants &amp; Enumeration Values</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> var PREF_DISABLED_PLUGIN_TYPES = &quot;plugin.disable_full_page_plugin_for_types&quot;;</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> // Preferences that affect which entries to show in the list.</span>
<a href="#l2.21"></a><span id="l2.21"> var PREF_SHOW_PLUGINS_IN_LIST = &quot;browser.download.show_plugins_in_list&quot;;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -39,17 +37,16 @@ ChromeUtils.import(&quot;resource://gre/modul</span>
<a href="#l2.23"></a><span id="l2.23"> ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> XPCOMUtils.defineLazyServiceGetters(this, {</span>
<a href="#l2.26"></a><span id="l2.26">   gCategoryManager: [&quot;@mozilla.org/categorymanager;1&quot;, &quot;nsICategoryManager&quot;],</span>
<a href="#l2.27"></a><span id="l2.27">   gHandlerService: [&quot;@mozilla.org/uriloader/handler-service;1&quot;, &quot;nsIHandlerService&quot;],</span>
<a href="#l2.28"></a><span id="l2.28">   gMIMEService: [&quot;@mozilla.org/mime;1&quot;, &quot;nsIMIMEService&quot;],</span>
<a href="#l2.29"></a><span id="l2.29"> });</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-</span>
<a href="#l2.32"></a><span id="l2.32"> // ---------</span>
<a href="#l2.33"></a><span id="l2.33"> // Utilities</span>
<a href="#l2.34"></a><span id="l2.34"> </span>
<a href="#l2.35"></a><span id="l2.35"> function getDisplayNameForFile(aFile) {</span>
<a href="#l2.36"></a><span id="l2.36">   if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l2.37"></a><span id="l2.37">     if (aFile instanceof Ci.nsILocalFileWin) {</span>
<a href="#l2.38"></a><span id="l2.38">       try {</span>
<a href="#l2.39"></a><span id="l2.39">         return aFile.getVersionInfoField(&quot;FileDescription&quot;);</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineat">@@ -555,77 +552,16 @@ var gApplicationsTabController = {</span>
<a href="#l2.41"></a><span id="l2.41">     if (this.mInitialized)</span>
<a href="#l2.42"></a><span id="l2.42">       document.getElementById(&quot;mail.preferences.applications.selectedTabIndex&quot;)</span>
<a href="#l2.43"></a><span id="l2.43">               .valueFromPreferences = document.getElementById(&quot;attachmentPrefs&quot;)</span>
<a href="#l2.44"></a><span id="l2.44">               .selectedIndex;</span>
<a href="#l2.45"></a><span id="l2.45">   },</span>
<a href="#l2.46"></a><span id="l2.46"> </span>
<a href="#l2.47"></a><span id="l2.47"> };</span>
<a href="#l2.48"></a><span id="l2.48"> </span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-var gCloudFileController = {</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-  commands: {</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-    cmd_addCloudfileAccount: {</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-      isEnabled() {</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-        return true;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-      },</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-      doCommand() {</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-        gCloudFileTab.addCloudFileAccount();</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-      },</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-    },</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-    cmd_removeCloudfileAccount: {</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-      isEnabled() {</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-        let listbox = document.getElementById(&quot;cloudFileView&quot;);</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-        return listbox.selectedCount &gt; 0;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-      },</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-      doCommand() {</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-        gCloudFileTab.removeCloudFileAccount();</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-      },</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-    },</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-    cmd_reauthCloudfileAccount: {</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-      isEnabled() {</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-        return true;</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-      },</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-      doCommand() {</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-        gCloudFileTab.authSelected();</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-      },</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-    },</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-  },</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-  supportsCommand(aCommand) {</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-    return (aCommand in this.commands);</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-  },</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-  isCommandEnabled(aCommand) {</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-    if (!this.supportsCommand(aCommand))</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-      return false;</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-    return this.commands[aCommand].isEnabled();</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-  },</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-  doCommand(aCommand) {</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-    if (!this.supportsCommand(aCommand))</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-      return;</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">-    let cmd = this.commands[aCommand];</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineminus">-</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">-    if (!cmd.isEnabled())</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineminus">-      return;</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-    cmd.doCommand();</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-  },</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineminus">-  onEvent(event) {},</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineminus">-};</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-function CommandUpdate_CloudFile() {</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-  goUpdateCommand(&quot;cmd_removeCloudfileAccount&quot;);</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-  goUpdateCommand(&quot;cmd_addCloudfileAccount&quot;);</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-}</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-</span>
<a href="#l2.110"></a><span id="l2.110"> var gCloudFileTab = {</span>
<a href="#l2.111"></a><span id="l2.111">   _initialized: false,</span>
<a href="#l2.112"></a><span id="l2.112">   _list: null,</span>
<a href="#l2.113"></a><span id="l2.113">   _settings: null,</span>
<a href="#l2.114"></a><span id="l2.114">   _settingsDeck: null,</span>
<a href="#l2.115"></a><span id="l2.115">   _tabpanel: null,</span>
<a href="#l2.116"></a><span id="l2.116">   _accountCache: {},</span>
<a href="#l2.117"></a><span id="l2.117">   _settingsPanelWrap: null,</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineat">@@ -638,47 +574,42 @@ var gCloudFileTab = {</span>
<a href="#l2.119"></a><span id="l2.119">                    .createBundle(&quot;chrome://messenger/locale/preferences/applications.properties&quot;);</span>
<a href="#l2.120"></a><span id="l2.120">   },</span>
<a href="#l2.121"></a><span id="l2.121"> </span>
<a href="#l2.122"></a><span id="l2.122">   init() {</span>
<a href="#l2.123"></a><span id="l2.123">     if (this._initialized)</span>
<a href="#l2.124"></a><span id="l2.124">       return;</span>
<a href="#l2.125"></a><span id="l2.125"> </span>
<a href="#l2.126"></a><span id="l2.126">     this._list = document.getElementById(&quot;cloudFileView&quot;);</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+    this._removeAccountButton = document.getElementById(&quot;removeCloudFileAccount&quot;);</span>
<a href="#l2.128"></a><span id="l2.128">     this._settingsDeck = document.getElementById(&quot;cloudFileSettingsDeck&quot;);</span>
<a href="#l2.129"></a><span id="l2.129">     this._defaultPanel = document.getElementById(&quot;cloudFileDefaultPanel&quot;);</span>
<a href="#l2.130"></a><span id="l2.130">     this._settingsPanelWrap = document.getElementById(&quot;cloudFileSettingsWrapper&quot;);</span>
<a href="#l2.131"></a><span id="l2.131">     this._loadingPanel = document.getElementById(&quot;cloudFileLoadingPanel&quot;);</span>
<a href="#l2.132"></a><span id="l2.132">     this._authErrorPanel = document.getElementById(&quot;cloudFileAuthErrorPanel&quot;);</span>
<a href="#l2.133"></a><span id="l2.133"> </span>
<a href="#l2.134"></a><span id="l2.134" class="difflineminus">-    top.controllers.appendController(gCloudFileController);</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineminus">-</span>
<a href="#l2.136"></a><span id="l2.136">     this.rebuildView();</span>
<a href="#l2.137"></a><span id="l2.137"> </span>
<a href="#l2.138"></a><span id="l2.138" class="difflineminus">-    if (this._list.itemCount &gt; 0)</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+    if (this._list.itemCount &gt; 0) {</span>
<a href="#l2.140"></a><span id="l2.140">       this._list.selectedIndex = 0;</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+      this._removeAccountButton.disabled = false;</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineplus">+    }</span>
<a href="#l2.143"></a><span id="l2.143"> </span>
<a href="#l2.144"></a><span id="l2.144">     window.addEventListener(&quot;unload&quot;, this, {capture: false, once: true});</span>
<a href="#l2.145"></a><span id="l2.145"> </span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-    // We need to defer the command updating a bit otherwise it will happen too early.</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-    window.addEventListener(&quot;load&quot;, () =&gt; {</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-      setTimeout(CommandUpdate_CloudFile, 0);</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-    }, {capture: false, once: true});</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-</span>
<a href="#l2.151"></a><span id="l2.151">     this.updateThreshold();</span>
<a href="#l2.152"></a><span id="l2.152"> </span>
<a href="#l2.153"></a><span id="l2.153">     this._initialized = true;</span>
<a href="#l2.154"></a><span id="l2.154">   },</span>
<a href="#l2.155"></a><span id="l2.155"> </span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">-  destroy: function CFT_destroy() {</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+  destroy() {</span>
<a href="#l2.158"></a><span id="l2.158">     // Remove any controllers or observers here.</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-    top.controllers.removeController(gCloudFileController);</span>
<a href="#l2.160"></a><span id="l2.160">   },</span>
<a href="#l2.161"></a><span id="l2.161"> </span>
<a href="#l2.162"></a><span id="l2.162" class="difflineminus">-  makeRichListItemForAccount: function CFT_makeRichListItemForAccount(aAccount) {</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineplus">+  makeRichListItemForAccount(aAccount) {</span>
<a href="#l2.164"></a><span id="l2.164">     let rli = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l2.165"></a><span id="l2.165">     rli.value = aAccount.accountKey;</span>
<a href="#l2.166"></a><span id="l2.166">     rli.setAttribute(&quot;value&quot;, aAccount.accountKey);</span>
<a href="#l2.167"></a><span id="l2.167">     rli.setAttribute(&quot;class&quot;, &quot;cloudfileAccount&quot;);</span>
<a href="#l2.168"></a><span id="l2.168">     rli.setAttribute(&quot;state&quot;, &quot;waiting-to-connect&quot;);</span>
<a href="#l2.169"></a><span id="l2.169"> </span>
<a href="#l2.170"></a><span id="l2.170">     if (aAccount.iconClass)</span>
<a href="#l2.171"></a><span id="l2.171">       rli.style.listStyleImage = &quot;url('&quot; + aAccount.iconClass + &quot;')&quot;;</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineat">@@ -698,23 +629,23 @@ var gCloudFileTab = {</span>
<a href="#l2.173"></a><span id="l2.173">       let result = this._accountCache[aAccount.accountKey].result;</span>
<a href="#l2.174"></a><span id="l2.174">       this._mapResultToState(rli, result);</span>
<a href="#l2.175"></a><span id="l2.175">       this._accountCache[aAccount.accountKey].listItem = rli;</span>
<a href="#l2.176"></a><span id="l2.176">     }</span>
<a href="#l2.177"></a><span id="l2.177"> </span>
<a href="#l2.178"></a><span id="l2.178">     return rli;</span>
<a href="#l2.179"></a><span id="l2.179">   },</span>
<a href="#l2.180"></a><span id="l2.180"> </span>
<a href="#l2.181"></a><span id="l2.181" class="difflineminus">-  clearEntries: function CFT_clearEntries() {</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineplus">+  clearEntries() {</span>
<a href="#l2.183"></a><span id="l2.183">     // Clear the list of entries.</span>
<a href="#l2.184"></a><span id="l2.184">     while (this._list.hasChildNodes())</span>
<a href="#l2.185"></a><span id="l2.185">       this._list.lastChild.remove();</span>
<a href="#l2.186"></a><span id="l2.186">   },</span>
<a href="#l2.187"></a><span id="l2.187"> </span>
<a href="#l2.188"></a><span id="l2.188" class="difflineminus">-  rebuildView: function CFT_rebuildView() {</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineplus">+  rebuildView() {</span>
<a href="#l2.190"></a><span id="l2.190">     this.clearEntries();</span>
<a href="#l2.191"></a><span id="l2.191">     let accounts = cloudFileAccounts.accounts;</span>
<a href="#l2.192"></a><span id="l2.192"> </span>
<a href="#l2.193"></a><span id="l2.193">     // Sort the accounts by displayName.</span>
<a href="#l2.194"></a><span id="l2.194">     function sortAccounts(a, b) {</span>
<a href="#l2.195"></a><span id="l2.195">       let aName = cloudFileAccounts.getDisplayName(a.accountKey)</span>
<a href="#l2.196"></a><span id="l2.196">                                    .toLowerCase();</span>
<a href="#l2.197"></a><span id="l2.197">       let bName = cloudFileAccounts.getDisplayName(b.accountKey)</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineat">@@ -732,17 +663,17 @@ var gCloudFileTab = {</span>
<a href="#l2.199"></a><span id="l2.199">     for (let account of accounts) {</span>
<a href="#l2.200"></a><span id="l2.200">       let rli = this.makeRichListItemForAccount(account);</span>
<a href="#l2.201"></a><span id="l2.201">       this._list.appendChild(rli);</span>
<a href="#l2.202"></a><span id="l2.202">       if (!(account.accountKey in this._accountCache))</span>
<a href="#l2.203"></a><span id="l2.203">         this.requestUserInfoForItem(rli, false);</span>
<a href="#l2.204"></a><span id="l2.204">     }</span>
<a href="#l2.205"></a><span id="l2.205">   },</span>
<a href="#l2.206"></a><span id="l2.206"> </span>
<a href="#l2.207"></a><span id="l2.207" class="difflineminus">-  requestUserInfoForItem: function CFT_requestUserInfoForItem(aItem, aWithUI) {</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineplus">+  requestUserInfoForItem(aItem, aWithUI) {</span>
<a href="#l2.209"></a><span id="l2.209">     let accountKey = aItem.value;</span>
<a href="#l2.210"></a><span id="l2.210">     let account = cloudFileAccounts.getAccount(accountKey);</span>
<a href="#l2.211"></a><span id="l2.211"> </span>
<a href="#l2.212"></a><span id="l2.212">     let observer = {</span>
<a href="#l2.213"></a><span id="l2.213">       onStopRequest(aRequest, aContext, aStatusCode) {</span>
<a href="#l2.214"></a><span id="l2.214">         gCloudFileTab._accountCache[accountKey].result = aStatusCode;</span>
<a href="#l2.215"></a><span id="l2.215">         gCloudFileTab.onUserInfoRequestDone(accountKey);</span>
<a href="#l2.216"></a><span id="l2.216">       },</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineat">@@ -758,143 +689,141 @@ var gCloudFileTab = {</span>
<a href="#l2.218"></a><span id="l2.218">     };</span>
<a href="#l2.219"></a><span id="l2.219"> </span>
<a href="#l2.220"></a><span id="l2.220">     this._accountCache[accountKey] = accountInfo;</span>
<a href="#l2.221"></a><span id="l2.221"> </span>
<a href="#l2.222"></a><span id="l2.222">     this._settingsDeck.selectedPanel = this._loadingPanel;</span>
<a href="#l2.223"></a><span id="l2.223">     account.refreshUserInfo(aWithUI, observer);</span>
<a href="#l2.224"></a><span id="l2.224">   },</span>
<a href="#l2.225"></a><span id="l2.225"> </span>
<a href="#l2.226"></a><span id="l2.226" class="difflineminus">-  onUserInfoRequestDone: function CFT_onUserInfoRequestDone(aAccountKey) {</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineplus">+  onUserInfoRequestDone(aAccountKey) {</span>
<a href="#l2.228"></a><span id="l2.228">     this.updateRichListItem(aAccountKey);</span>
<a href="#l2.229"></a><span id="l2.229"> </span>
<a href="#l2.230"></a><span id="l2.230">     if (this._list.selectedItem &amp;&amp;</span>
<a href="#l2.231"></a><span id="l2.231">         this._list.selectedItem.value == aAccountKey)</span>
<a href="#l2.232"></a><span id="l2.232">       this._showAccountInfo(aAccountKey);</span>
<a href="#l2.233"></a><span id="l2.233">   },</span>
<a href="#l2.234"></a><span id="l2.234"> </span>
<a href="#l2.235"></a><span id="l2.235" class="difflineminus">-  updateRichListItem: function CFT_updateRichListItem(aAccountKey) {</span>
<a href="#l2.236"></a><span id="l2.236" class="difflineplus">+  updateRichListItem(aAccountKey) {</span>
<a href="#l2.237"></a><span id="l2.237">     let accountInfo = this._accountCache[aAccountKey];</span>
<a href="#l2.238"></a><span id="l2.238">     if (!accountInfo)</span>
<a href="#l2.239"></a><span id="l2.239">       return;</span>
<a href="#l2.240"></a><span id="l2.240"> </span>
<a href="#l2.241"></a><span id="l2.241">     let item = accountInfo.listItem;</span>
<a href="#l2.242"></a><span id="l2.242">     let result = accountInfo.result;</span>
<a href="#l2.243"></a><span id="l2.243">     this._mapResultToState(item, result);</span>
<a href="#l2.244"></a><span id="l2.244">   },</span>
<a href="#l2.245"></a><span id="l2.245"> </span>
<a href="#l2.246"></a><span id="l2.246" class="difflineminus">-  _mapResultToState: function CFT__mapResultToState(aItem, aResult) {</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineplus">+  _mapResultToState(aItem, aResult) {</span>
<a href="#l2.248"></a><span id="l2.248">     let itemState = &quot;no-connection&quot;;</span>
<a href="#l2.249"></a><span id="l2.249"> </span>
<a href="#l2.250"></a><span id="l2.250">     if (aResult == Cr.NS_OK)</span>
<a href="#l2.251"></a><span id="l2.251">       itemState = &quot;connected&quot;;</span>
<a href="#l2.252"></a><span id="l2.252">     else if (aResult == Ci.nsIMsgCloudFileProvider.authErr)</span>
<a href="#l2.253"></a><span id="l2.253">       itemState = &quot;auth-error&quot;;</span>
<a href="#l2.254"></a><span id="l2.254">     else if (aResult == Cr.NS_ERROR_NOT_AVAILABLE)</span>
<a href="#l2.255"></a><span id="l2.255">       itemState = &quot;no-connection&quot;;</span>
<a href="#l2.256"></a><span id="l2.256">     // TODO: What other states are there?</span>
<a href="#l2.257"></a><span id="l2.257"> </span>
<a href="#l2.258"></a><span id="l2.258">     aItem.setAttribute(&quot;state&quot;, itemState);</span>
<a href="#l2.259"></a><span id="l2.259">   },</span>
<a href="#l2.260"></a><span id="l2.260"> </span>
<a href="#l2.261"></a><span id="l2.261" class="difflineminus">-</span>
<a href="#l2.262"></a><span id="l2.262" class="difflineminus">-  onSelectionChanged: function CFT_onSelectionChanged() {</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineplus">+  onSelectionChanged() {</span>
<a href="#l2.264"></a><span id="l2.264">     // Get the selected item</span>
<a href="#l2.265"></a><span id="l2.265">     let selection = this._list.selectedItem;</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineplus">+    this._removeAccountButton.disabled = !selection;</span>
<a href="#l2.267"></a><span id="l2.267">     if (!selection)</span>
<a href="#l2.268"></a><span id="l2.268">       return;</span>
<a href="#l2.269"></a><span id="l2.269"> </span>
<a href="#l2.270"></a><span id="l2.270">     // The selection tells us the key.  We need the actual</span>
<a href="#l2.271"></a><span id="l2.271">     // provider here.</span>
<a href="#l2.272"></a><span id="l2.272">     let accountKey = selection.value;</span>
<a href="#l2.273"></a><span id="l2.273">     this._showAccountInfo(accountKey);</span>
<a href="#l2.274"></a><span id="l2.274">   },</span>
<a href="#l2.275"></a><span id="l2.275"> </span>
<a href="#l2.276"></a><span id="l2.276" class="difflineminus">-  _showAccountInfo: function CFT__showAccountInfo(aAccountKey) {</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineplus">+  _showAccountInfo(aAccountKey) {</span>
<a href="#l2.278"></a><span id="l2.278">     let account = this._accountCache[aAccountKey].account;</span>
<a href="#l2.279"></a><span id="l2.279">     let result = this._accountCache[aAccountKey].result;</span>
<a href="#l2.280"></a><span id="l2.280"> </span>
<a href="#l2.281"></a><span id="l2.281" class="difflineminus">-    if (result == Cr.NS_ERROR_NOT_AVAILABLE)</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineplus">+    if (result == Cr.NS_ERROR_NOT_AVAILABLE) {</span>
<a href="#l2.283"></a><span id="l2.283">       this._settingsDeck.selectedPanel = this._loadingPanel;</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineminus">-    else if (result == Cr.NS_OK) {</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineplus">+    } else if (result == Cr.NS_OK) {</span>
<a href="#l2.286"></a><span id="l2.286">       this._settingsDeck.selectedPanel = this._settingsPanelWrap;</span>
<a href="#l2.287"></a><span id="l2.287">       this._showAccountManagement(account);</span>
<a href="#l2.288"></a><span id="l2.288">     } else if (result == Ci.nsIMsgCloudFileProvider.authErr) {</span>
<a href="#l2.289"></a><span id="l2.289">       this._settingsDeck.selectedPanel = this._authErrorPanel;</span>
<a href="#l2.290"></a><span id="l2.290">     } else {</span>
<a href="#l2.291"></a><span id="l2.291">       Cu.reportError(&quot;Unexpected connection error.&quot;);</span>
<a href="#l2.292"></a><span id="l2.292">     }</span>
<a href="#l2.293"></a><span id="l2.293">   },</span>
<a href="#l2.294"></a><span id="l2.294"> </span>
<a href="#l2.295"></a><span id="l2.295" class="difflineminus">-  _showAccountManagement: function CFT__showAccountManagement(aProvider) {</span>
<a href="#l2.296"></a><span id="l2.296" class="difflineplus">+  _showAccountManagement(aProvider) {</span>
<a href="#l2.297"></a><span id="l2.297">     let iframe = document.createElement(&quot;iframe&quot;);</span>
<a href="#l2.298"></a><span id="l2.298"> </span>
<a href="#l2.299"></a><span id="l2.299">     iframe.setAttribute(&quot;src&quot;, aProvider.managementURL);</span>
<a href="#l2.300"></a><span id="l2.300">     iframe.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l2.301"></a><span id="l2.301"> </span>
<a href="#l2.302"></a><span id="l2.302">     // If we have a past iframe, we replace it. Else append</span>
<a href="#l2.303"></a><span id="l2.303">     // to the wrapper.</span>
<a href="#l2.304"></a><span id="l2.304">     if (this._settings)</span>
<a href="#l2.305"></a><span id="l2.305">       this._settings.remove();</span>
<a href="#l2.306"></a><span id="l2.306"> </span>
<a href="#l2.307"></a><span id="l2.307">     this._settingsPanelWrap.appendChild(iframe);</span>
<a href="#l2.308"></a><span id="l2.308">     this._settings = iframe;</span>
<a href="#l2.309"></a><span id="l2.309"> </span>
<a href="#l2.310"></a><span id="l2.310">     // When the iframe loads, populate it with the provider.</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineminus">-    this._settings.contentWindow.addEventListener(&quot;load&quot;,</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineminus">-      function loadProvider() {</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineminus">-        try {</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineminus">-          iframe.contentWindow</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineminus">-                .wrappedJSObject</span>
<a href="#l2.316"></a><span id="l2.316" class="difflineminus">-                .onLoadProvider(aProvider);</span>
<a href="#l2.317"></a><span id="l2.317" class="difflineminus">-        } catch (e) {</span>
<a href="#l2.318"></a><span id="l2.318" class="difflineminus">-          Cu.reportError(e);</span>
<a href="#l2.319"></a><span id="l2.319" class="difflineminus">-        }</span>
<a href="#l2.320"></a><span id="l2.320" class="difflineminus">-      }, {capture: false, once: true});</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineplus">+    this._settings.contentWindow.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineplus">+      try {</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineplus">+        iframe.contentWindow</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineplus">+              .wrappedJSObject</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineplus">+              .onLoadProvider(aProvider);</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineplus">+      } catch (e) {</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineplus">+        Cu.reportError(e);</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineplus">+      }</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineplus">+    }, {capture: false, once: true});</span>
<a href="#l2.330"></a><span id="l2.330"> </span>
<a href="#l2.331"></a><span id="l2.331">     // When the iframe (or any subcontent) fires the DOMContentLoaded event,</span>
<a href="#l2.332"></a><span id="l2.332">     // attach the _onClickLink handler to any anchor elements that we can find.</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineminus">-    this._settings.contentWindow.addEventListener(&quot;DOMContentLoaded&quot;,</span>
<a href="#l2.334"></a><span id="l2.334" class="difflineminus">-      function addClickListeners(e) {</span>
<a href="#l2.335"></a><span id="l2.335" class="difflineminus">-        let doc = e.originalTarget;</span>
<a href="#l2.336"></a><span id="l2.336" class="difflineminus">-        let links = doc.getElementsByTagName(&quot;a&quot;);</span>
<a href="#l2.337"></a><span id="l2.337" class="difflineplus">+    this._settings.contentWindow.addEventListener(&quot;DOMContentLoaded&quot;, function(e) {</span>
<a href="#l2.338"></a><span id="l2.338" class="difflineplus">+      let doc = e.originalTarget;</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineplus">+      let links = doc.getElementsByTagName(&quot;a&quot;);</span>
<a href="#l2.340"></a><span id="l2.340"> </span>
<a href="#l2.341"></a><span id="l2.341" class="difflineminus">-        for (let link of links)</span>
<a href="#l2.342"></a><span id="l2.342" class="difflineminus">-          link.addEventListener(&quot;click&quot;, gCloudFileTab._onClickLink);</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineminus">-      }, {capture: false, once: true});</span>
<a href="#l2.344"></a><span id="l2.344" class="difflineminus">-</span>
<a href="#l2.345"></a><span id="l2.345" class="difflineminus">-    CommandUpdate_CloudFile();</span>
<a href="#l2.346"></a><span id="l2.346" class="difflineplus">+      for (let link of links) {</span>
<a href="#l2.347"></a><span id="l2.347" class="difflineplus">+        link.addEventListener(&quot;click&quot;, gCloudFileTab._onClickLink);</span>
<a href="#l2.348"></a><span id="l2.348" class="difflineplus">+      }</span>
<a href="#l2.349"></a><span id="l2.349" class="difflineplus">+    }, {capture: false, once: true});</span>
<a href="#l2.350"></a><span id="l2.350">   },</span>
<a href="#l2.351"></a><span id="l2.351"> </span>
<a href="#l2.352"></a><span id="l2.352" class="difflineminus">-  _onClickLink: function CFT__onClickLink(aEvent) {</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineplus">+  _onClickLink(aEvent) {</span>
<a href="#l2.354"></a><span id="l2.354">     aEvent.preventDefault();</span>
<a href="#l2.355"></a><span id="l2.355">     let href = aEvent.target.getAttribute(&quot;href&quot;);</span>
<a href="#l2.356"></a><span id="l2.356">     openLinkExternally(href);</span>
<a href="#l2.357"></a><span id="l2.357">   },</span>
<a href="#l2.358"></a><span id="l2.358"> </span>
<a href="#l2.359"></a><span id="l2.359" class="difflineminus">-  authSelected: function CFT_authSelected() {</span>
<a href="#l2.360"></a><span id="l2.360" class="difflineplus">+  authSelected() {</span>
<a href="#l2.361"></a><span id="l2.361">     let item = this._list.selectedItem;</span>
<a href="#l2.362"></a><span id="l2.362"> </span>
<a href="#l2.363"></a><span id="l2.363">     if (!item)</span>
<a href="#l2.364"></a><span id="l2.364">       return;</span>
<a href="#l2.365"></a><span id="l2.365"> </span>
<a href="#l2.366"></a><span id="l2.366">     this.requestUserInfoForItem(item, true);</span>
<a href="#l2.367"></a><span id="l2.367">   },</span>
<a href="#l2.368"></a><span id="l2.368"> </span>
<a href="#l2.369"></a><span id="l2.369" class="difflineminus">-  addCloudFileAccount: function CFT_addCloudFileAccount() {</span>
<a href="#l2.370"></a><span id="l2.370" class="difflineplus">+  addCloudFileAccount() {</span>
<a href="#l2.371"></a><span id="l2.371">     let accountKey = cloudFileAccounts.addAccountDialog();</span>
<a href="#l2.372"></a><span id="l2.372">     if (!accountKey)</span>
<a href="#l2.373"></a><span id="l2.373">       return;</span>
<a href="#l2.374"></a><span id="l2.374"> </span>
<a href="#l2.375"></a><span id="l2.375">     this.rebuildView();</span>
<a href="#l2.376"></a><span id="l2.376">     let newItem = this._list.querySelector(&quot;richlistitem[value='&quot; + accountKey + &quot;']&quot;);</span>
<a href="#l2.377"></a><span id="l2.377">     this._list.selectItem(newItem);</span>
<a href="#l2.378"></a><span id="l2.378" class="difflineplus">+    this._removeAccountButton.disabled = false;</span>
<a href="#l2.379"></a><span id="l2.379">   },</span>
<a href="#l2.380"></a><span id="l2.380"> </span>
<a href="#l2.381"></a><span id="l2.381" class="difflineminus">-  removeCloudFileAccount: function CFT_removeCloudFileAccount() {</span>
<a href="#l2.382"></a><span id="l2.382" class="difflineplus">+  removeCloudFileAccount() {</span>
<a href="#l2.383"></a><span id="l2.383">     // Get the selected account key</span>
<a href="#l2.384"></a><span id="l2.384">     let selection = this._list.selectedItem;</span>
<a href="#l2.385"></a><span id="l2.385">     if (!selection)</span>
<a href="#l2.386"></a><span id="l2.386">       return;</span>
<a href="#l2.387"></a><span id="l2.387"> </span>
<a href="#l2.388"></a><span id="l2.388">     let accountKey = selection.value;</span>
<a href="#l2.389"></a><span id="l2.389">     let accountName = cloudFileAccounts.getDisplayName(accountKey);</span>
<a href="#l2.390"></a><span id="l2.390">     // Does the user really want to remove this account?</span>
<a href="#l2.391"></a><span id="l2.391" class="difflineat">@@ -903,39 +832,38 @@ var gCloudFileTab = {</span>
<a href="#l2.392"></a><span id="l2.392">                                                    [accountName], 1);</span>
<a href="#l2.393"></a><span id="l2.393"> </span>
<a href="#l2.394"></a><span id="l2.394">     if (Services.prompt.confirm(null, &quot;&quot;, confirmMessage)) {</span>
<a href="#l2.395"></a><span id="l2.395">       this._list.clearSelection();</span>
<a href="#l2.396"></a><span id="l2.396">       cloudFileAccounts.removeAccount(accountKey);</span>
<a href="#l2.397"></a><span id="l2.397">       this.rebuildView();</span>
<a href="#l2.398"></a><span id="l2.398">       this._settingsDeck.selectedPanel = this._defaultPanel;</span>
<a href="#l2.399"></a><span id="l2.399">       delete this._accountCache[accountKey];</span>
<a href="#l2.400"></a><span id="l2.400" class="difflineminus">-      // For some reason, the focus event isn't fired, so I think</span>
<a href="#l2.401"></a><span id="l2.401" class="difflineminus">-      // we have to update the buttons manually...</span>
<a href="#l2.402"></a><span id="l2.402" class="difflineminus">-      CommandUpdate_CloudFile();</span>
<a href="#l2.403"></a><span id="l2.403" class="difflineplus">+</span>
<a href="#l2.404"></a><span id="l2.404" class="difflineplus">+      this._removeAccountButton.disabled = (this._list.selectedCount == 0);</span>
<a href="#l2.405"></a><span id="l2.405">     }</span>
<a href="#l2.406"></a><span id="l2.406">   },</span>
<a href="#l2.407"></a><span id="l2.407"> </span>
<a href="#l2.408"></a><span id="l2.408" class="difflineminus">-  handleEvent: function CFT_handleEvent(aEvent) {</span>
<a href="#l2.409"></a><span id="l2.409" class="difflineplus">+  handleEvent(aEvent) {</span>
<a href="#l2.410"></a><span id="l2.410">     if (aEvent.type == &quot;unload&quot;)</span>
<a href="#l2.411"></a><span id="l2.411">       this.destroy();</span>
<a href="#l2.412"></a><span id="l2.412">   },</span>
<a href="#l2.413"></a><span id="l2.413"> </span>
<a href="#l2.414"></a><span id="l2.414" class="difflineminus">-  readThreshold: function CFT_readThreshold() {</span>
<a href="#l2.415"></a><span id="l2.415" class="difflineplus">+  readThreshold() {</span>
<a href="#l2.416"></a><span id="l2.416">     let pref = document.getElementById(&quot;mail.compose.big_attachments.threshold_kb&quot;);</span>
<a href="#l2.417"></a><span id="l2.417">     return pref.value / 1024;</span>
<a href="#l2.418"></a><span id="l2.418">   },</span>
<a href="#l2.419"></a><span id="l2.419"> </span>
<a href="#l2.420"></a><span id="l2.420" class="difflineminus">-  writeThreshold: function CFT_writeThreshold() {</span>
<a href="#l2.421"></a><span id="l2.421" class="difflineplus">+  writeThreshold() {</span>
<a href="#l2.422"></a><span id="l2.422">     let threshold = document.getElementById(&quot;cloudFileThreshold&quot;);</span>
<a href="#l2.423"></a><span id="l2.423">     let intValue = parseInt(threshold.value, 10);</span>
<a href="#l2.424"></a><span id="l2.424">     return isNaN(intValue) ? 0 : intValue * 1024;</span>
<a href="#l2.425"></a><span id="l2.425">   },</span>
<a href="#l2.426"></a><span id="l2.426"> </span>
<a href="#l2.427"></a><span id="l2.427" class="difflineminus">-  updateThreshold: function CFT_updateThreshold() {</span>
<a href="#l2.428"></a><span id="l2.428" class="difflineplus">+  updateThreshold() {</span>
<a href="#l2.429"></a><span id="l2.429">     document.getElementById(&quot;cloudFileThreshold&quot;).disabled =</span>
<a href="#l2.430"></a><span id="l2.430">     !document.getElementById(&quot;enableThreshold&quot;).checked;</span>
<a href="#l2.431"></a><span id="l2.431">   },</span>
<a href="#l2.432"></a><span id="l2.432"> </span>
<a href="#l2.433"></a><span id="l2.433">   QueryInterface: ChromeUtils.generateQI([&quot;nsIObserver&quot;,</span>
<a href="#l2.434"></a><span id="l2.434">                                           &quot;nsISupportsWeakReference&quot;]),</span>
<a href="#l2.435"></a><span id="l2.435"> };</span>
<a href="#l2.436"></a><span id="l2.436"> </span>
<a href="#l2.437"></a><span id="l2.437" class="difflineat">@@ -957,17 +885,16 @@ var gApplicationsPane = {</span>
<a href="#l2.438"></a><span id="l2.438">   _visibleTypes: [],</span>
<a href="#l2.439"></a><span id="l2.439"> </span>
<a href="#l2.440"></a><span id="l2.440">   // Map whose keys are string descriptions and values are references to the</span>
<a href="#l2.441"></a><span id="l2.441">   // first visible HandlerInfoWrapper that has this description. We use this</span>
<a href="#l2.442"></a><span id="l2.442">   // to determine whether or not to annotate descriptions with their types to</span>
<a href="#l2.443"></a><span id="l2.443">   // distinguish duplicate descriptions from each other.</span>
<a href="#l2.444"></a><span id="l2.444">   _visibleDescriptions: new Map(),</span>
<a href="#l2.445"></a><span id="l2.445"> </span>
<a href="#l2.446"></a><span id="l2.446" class="difflineminus">-</span>
<a href="#l2.447"></a><span id="l2.447">   // -----------------------------------</span>
<a href="#l2.448"></a><span id="l2.448">   // Convenience &amp; Performance Shortcuts</span>
<a href="#l2.449"></a><span id="l2.449"> </span>
<a href="#l2.450"></a><span id="l2.450">   // These get defined by init().</span>
<a href="#l2.451"></a><span id="l2.451">   _brandShortName: null,</span>
<a href="#l2.452"></a><span id="l2.452">   _prefsBundle: null,</span>
<a href="#l2.453"></a><span id="l2.453">   _list: null,</span>
<a href="#l2.454"></a><span id="l2.454">   _filter: null,</span>
<a href="#l2.455"></a><span id="l2.455" class="difflineat">@@ -1681,19 +1608,19 @@ var gApplicationsPane = {</span>
<a href="#l2.456"></a><span id="l2.456">       });</span>
<a href="#l2.457"></a><span id="l2.457">     }</span>
<a href="#l2.458"></a><span id="l2.458">   },</span>
<a href="#l2.459"></a><span id="l2.459"> </span>
<a href="#l2.460"></a><span id="l2.460">   confirmDelete(aEvent) {</span>
<a href="#l2.461"></a><span id="l2.461">     aEvent.stopPropagation();</span>
<a href="#l2.462"></a><span id="l2.462">     if (Services.prompt.confirm(null,</span>
<a href="#l2.463"></a><span id="l2.463">                                 this._prefsBundle.getString(&quot;confirmDeleteTitle&quot;),</span>
<a href="#l2.464"></a><span id="l2.464" class="difflineminus">-                                this._prefsBundle.getString(&quot;confirmDeleteText&quot;)))</span>
<a href="#l2.465"></a><span id="l2.465" class="difflineplus">+                                this._prefsBundle.getString(&quot;confirmDeleteText&quot;))) {</span>
<a href="#l2.466"></a><span id="l2.466">       this.onDelete(aEvent);</span>
<a href="#l2.467"></a><span id="l2.467" class="difflineminus">-    else {</span>
<a href="#l2.468"></a><span id="l2.468" class="difflineplus">+    } else {</span>
<a href="#l2.469"></a><span id="l2.469">       // They hit cancel, so return them to the previously selected item.</span>
<a href="#l2.470"></a><span id="l2.470">       let menu = document.getAnonymousElementByAttribute(this._list.selectedItem,</span>
<a href="#l2.471"></a><span id="l2.471">                                                          &quot;class&quot;, &quot;actionsMenu&quot;);</span>
<a href="#l2.472"></a><span id="l2.472">       menu.selectedItem = menu.previousSelectedItem;</span>
<a href="#l2.473"></a><span id="l2.473">     }</span>
<a href="#l2.474"></a><span id="l2.474">   },</span>
<a href="#l2.475"></a><span id="l2.475"> </span>
<a href="#l2.476"></a><span id="l2.476">   onDelete(aEvent) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

