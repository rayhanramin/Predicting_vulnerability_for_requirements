<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 13566:9eb3e41bab9bff569c7c6b939e593b390c67c287</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9eb3e41bab9bff569c7c6b939e593b390c67c287" />
<meta property="og:url" content="/comm-central/rev/9eb3e41bab9bff569c7c6b939e593b390c67c287" />
<meta property="og:description" content="Bug 956493 - Replace PRUnichar with char16_t; r=roc landed on a CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9eb3e41bab9bff569c7c6b939e593b390c67c287 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9eb3e41bab9bff569c7c6b939e593b390c67c287">shortlog</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9eb3e41bab9bff569c7c6b939e593b390c67c287">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287">files</a> |
changeset |
<a href="/comm-central/raw-rev/9eb3e41bab9bff569c7c6b939e593b390c67c287">raw</a>  | <a href="/comm-central/archive/9eb3e41bab9bff569c7c6b939e593b390c67c287.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=956493">Bug 956493</a> - Replace PRUnichar with char16_t; r=roc landed on a CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#69;&#104;&#115;&#97;&#110;&#32;&#65;&#107;&#104;&#103;&#97;&#114;&#105;&#32;&#60;&#101;&#104;&#115;&#97;&#110;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 04 Jan 2014 10:16:34 -0500</td></tr>

<tr>
 <td>changeset 13566</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9eb3e41bab9bff569c7c6b939e593b390c67c287">9eb3e41bab9bff569c7c6b939e593b390c67c287</a></td>
</tr>



<tr>
<td>parent 13565</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/117ad84fb83e393e9cec56347c13e634c7c5d454">117ad84fb83e393e9cec56347c13e634c7c5d454</a>
</td>
</tr>

<tr>
<td>child 13567</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0c8f6b80f939225e0a94bbc4d39cf8652042b020">0c8f6b80f939225e0a94bbc4d39cf8652042b020</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9eb3e41bab9bff569c7c6b939e593b390c67c287">9758</a></td></tr>
<tr><td>push user</td><td>eakhgari@mozilla.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 06 Jan 2014 18:54:19 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9eb3e41bab9b [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9eb3e41bab9bff569c7c6b939e593b390c67c287">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9eb3e41bab9bff569c7c6b939e593b390c67c287&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9eb3e41bab9bff569c7c6b939e593b390c67c287&newProject=comm-central&newRevision=9eb3e41bab9bff569c7c6b939e593b390c67c287&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9eb3e41bab9bff569c7c6b939e593b390c67c287&newProject=comm-central&newRevision=9eb3e41bab9bff569c7c6b939e593b390c67c287&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9eb3e41bab9bff569c7c6b939e593b390c67c287&newProject=comm-central&newRevision=9eb3e41bab9bff569c7c6b939e593b390c67c287&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28roc%29&revcount=50">roc</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=956493">956493</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=956493">Bug 956493</a> - Replace PRUnichar with char16_t; r=roc landed on a CLOSED TREE

This patch was automatically generated by the following script:

#!/bin/bash
# Command to convert PRUnichar to char16_t

function convert() {
echo &quot;Converting $1 to $2...&quot;
find . ! -wholename &quot;*nsprpub*&quot; \
       ! -wholename &quot;*security/nss*&quot; \
       ! -wholename &quot;*modules/libmar*&quot; \
       ! -wholename &quot;*/.hg*&quot; \
       ! -wholename &quot;obj-ff-dbg*&quot; \
       ! -name prtypes.h \
       ! -name Char16.h \
         -type f \
      \( -iname &quot;*.cpp&quot; \
         -o -iname &quot;*.h&quot; \
         -o -iname &quot;*.c&quot; \
         -o -iname &quot;*.cc&quot; \
         -o -iname &quot;*.idl&quot; \
         -o -iname &quot;*.ipdl&quot; \
         -o -iname &quot;*.ipdlh&quot; \
         -o -iname &quot;*.mm&quot; \) | \
    xargs -n 1 sed -i -e &quot;s/\b$1\b/$2/g&quot;
}

convert PRUnichar char16_t</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.cpp">calendar/base/backend/libical/calUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.h">calendar/base/backend/libical/calUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/calendar/base/backend/libical/calUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPConnection.cpp">ldap/xpcom/src/nsLDAPConnection.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPConnection.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPConnection.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPConnection.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPConnection.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPConnection.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPMessage.cpp">ldap/xpcom/src/nsLDAPMessage.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPMessage.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPMessage.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPMessage.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPMessage.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPMessage.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPServer.cpp">ldap/xpcom/src/nsLDAPServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPServer.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPServer.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPServer.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPServer.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPService.cpp">ldap/xpcom/src/nsLDAPService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPService.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPService.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPService.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPService.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPSyncQuery.cpp">ldap/xpcom/src/nsLDAPSyncQuery.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPSyncQuery.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPSyncQuery.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPSyncQuery.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPSyncQuery.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/ldap/xpcom/src/nsLDAPSyncQuery.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/app/nsMailApp.cpp">mail/app/nsMailApp.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/app/nsMailApp.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/app/nsMailApp.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/app/nsMailApp.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/app/nsMailApp.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/app/nsMailApp.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsEudoraProfileMigrator.cpp">mail/components/migration/src/nsEudoraProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsEudoraProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsEudoraProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsEudoraProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsEudoraProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsEudoraProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsMailProfileMigratorUtils.h">mail/components/migration/src/nsMailProfileMigratorUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsMailProfileMigratorUtils.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsMailProfileMigratorUtils.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsMailProfileMigratorUtils.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsMailProfileMigratorUtils.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsMailProfileMigratorUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOEProfileMigrator.cpp">mail/components/migration/src/nsOEProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOEProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOEProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOEProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOEProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOEProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOutlookProfileMigrator.cpp">mail/components/migration/src/nsOutlookProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOutlookProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOutlookProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOutlookProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOutlookProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsOutlookProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsProfileMigratorBase.cpp">mail/components/migration/src/nsProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.h">mail/components/migration/src/nsSeamonkeyProfileMigrator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/migration/src/nsSeamonkeyProfileMigrator.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/shell/nsMailWinIntegration.cpp">mail/components/shell/nsMailWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/shell/nsMailWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/shell/nsMailWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/shell/nsMailWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/shell/nsMailWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mail/components/shell/nsMailWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbAddressCollector.cpp">mailnews/addrbook/src/nsAbAddressCollector.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbAddressCollector.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbAddressCollector.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbAddressCollector.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbAddressCollector.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbAddressCollector.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbBooleanExpression.cpp">mailnews/addrbook/src/nsAbBooleanExpression.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbBooleanExpression.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbBooleanExpression.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbBooleanExpression.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbBooleanExpression.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbBooleanExpression.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbCardProperty.cpp">mailnews/addrbook/src/nsAbCardProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbCardProperty.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbCardProperty.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbCardProperty.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbCardProperty.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbCardProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">mailnews/addrbook/src/nsAbDirectoryQuery.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.h">mailnews/addrbook/src/nsAbDirectoryQuery.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbDirectoryQuery.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.cpp">mailnews/addrbook/src/nsAbMDBDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.h">mailnews/addrbook/src/nsAbMDBDirectory.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbMDBDirectory.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.cpp">mailnews/addrbook/src/nsAbManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.h">mailnews/addrbook/src/nsAbManager.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbManager.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOSXUtils.mm">mailnews/addrbook/src/nsAbOSXUtils.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOSXUtils.mm">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOSXUtils.mm">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOSXUtils.mm">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOSXUtils.mm">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOSXUtils.mm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">mailnews/addrbook/src/nsAbOutlookDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbUtils.h">mailnews/addrbook/src/nsAbUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbUtils.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbUtils.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbUtils.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbUtils.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.cpp">mailnews/addrbook/src/nsAbView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.h">mailnews/addrbook/src/nsAbView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.cpp">mailnews/addrbook/src/nsAbWinHelper.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.h">mailnews/addrbook/src/nsAbWinHelper.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAbWinHelper.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.cpp">mailnews/addrbook/src/nsAddrDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.h">mailnews/addrbook/src/nsAddrDatabase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsAddrDatabase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsDirPrefs.cpp">mailnews/addrbook/src/nsDirPrefs.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsDirPrefs.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsDirPrefs.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsDirPrefs.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsDirPrefs.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/addrbook/src/nsDirPrefs.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/public/nsMsgSearchAdapter.h">mailnews/base/search/public/nsMsgSearchAdapter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/public/nsMsgSearchAdapter.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/public/nsMsgSearchAdapter.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/public/nsMsgSearchAdapter.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/public/nsMsgSearchAdapter.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/public/nsMsgSearchAdapter.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilter.cpp">mailnews/base/search/src/nsMsgFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilter.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilter.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilter.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilter.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterList.cpp">mailnews/base/search/src/nsMsgFilterList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterList.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterList.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterList.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterList.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.cpp">mailnews/base/search/src/nsMsgFilterService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.h">mailnews/base/search/src/nsMsgFilterService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgFilterService.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgImapSearch.cpp">mailnews/base/search/src/nsMsgImapSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgImapSearch.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgImapSearch.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgImapSearch.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgImapSearch.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgImapSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchAdapter.cpp">mailnews/base/search/src/nsMsgSearchAdapter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchAdapter.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchAdapter.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchAdapter.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchAdapter.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchAdapter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchImap.h">mailnews/base/search/src/nsMsgSearchImap.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchImap.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchImap.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchImap.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchImap.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchImap.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.cpp">mailnews/base/search/src/nsMsgSearchNews.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.h">mailnews/base/search/src/nsMsgSearchNews.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/search/src/nsMsgSearchNews.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOS2Integration.cpp">mailnews/base/src/nsMessengerOS2Integration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOS2Integration.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOS2Integration.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOS2Integration.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOS2Integration.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOS2Integration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.h">mailnews/base/src/nsMessengerOSXIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.mm">mailnews/base/src/nsMessengerOSXIntegration.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.mm">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.mm">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.mm">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.mm">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerOSXIntegration.mm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerUnixIntegration.cpp">mailnews/base/src/nsMessengerUnixIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerUnixIntegration.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerUnixIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerUnixIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerUnixIntegration.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerUnixIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManagerDS.cpp">mailnews/base/src/nsMsgAccountManagerDS.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManagerDS.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManagerDS.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManagerDS.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManagerDS.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgAccountManagerDS.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgBiffManager.cpp">mailnews/base/src/nsMsgBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgContentPolicy.cpp">mailnews/base/src/nsMsgContentPolicy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgContentPolicy.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgContentPolicy.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgContentPolicy.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgContentPolicy.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgContentPolicy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.h">mailnews/base/src/nsMsgDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgDBView.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.cpp">mailnews/base/src/nsMsgGroupView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.h">mailnews/base/src/nsMsgGroupView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgGroupView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgMailSession.cpp">mailnews/base/src/nsMsgMailSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgMailSession.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgMailSession.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgMailSession.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgMailSession.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgMailSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgOfflineManager.cpp">mailnews/base/src/nsMsgOfflineManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgOfflineManager.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgOfflineManager.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgOfflineManager.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgOfflineManager.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgOfflineManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.cpp">mailnews/base/src/nsMsgPrintEngine.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.h">mailnews/base/src/nsMsgPrintEngine.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgPrintEngine.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgProgress.cpp">mailnews/base/src/nsMsgProgress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgProgress.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgProgress.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgProgress.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgProgress.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgProgress.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFDataSource.cpp">mailnews/base/src/nsMsgRDFDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFDataSource.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFDataSource.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.cpp">mailnews/base/src/nsMsgRDFUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.h">mailnews/base/src/nsMsgRDFUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgRDFUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgStatusFeedback.cpp">mailnews/base/src/nsMsgStatusFeedback.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgStatusFeedback.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgStatusFeedback.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgStatusFeedback.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgStatusFeedback.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsMsgStatusFeedback.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsStatusBarBiffManager.cpp">mailnews/base/src/nsStatusBarBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsStatusBarBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsStatusBarBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsStatusBarBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsStatusBarBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsStatusBarBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.cpp">mailnews/base/src/nsSubscribableServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.h">mailnews/base/src/nsSubscribableServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/src/nsSubscribableServer.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/Services.cpp">mailnews/base/util/Services.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/Services.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/Services.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/Services.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/Services.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/Services.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.h">mailnews/base/util/nsMsgDBFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgDBFolder.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.cpp">mailnews/base/util/nsMsgI18N.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.h">mailnews/base/util/nsMsgI18N.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgI18N.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgMailNewsUrl.cpp">mailnews/base/util/nsMsgMailNewsUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgMailNewsUrl.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgMailNewsUrl.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgMailNewsUrl.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgMailNewsUrl.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgMailNewsUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgProtocol.cpp">mailnews/base/util/nsMsgProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgProtocol.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgProtocol.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/public/nsIURLFetcher.idl">mailnews/compose/public/nsIURLFetcher.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/public/nsIURLFetcher.idl">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/public/nsIURLFetcher.idl">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/public/nsIURLFetcher.idl">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/public/nsIURLFetcher.idl">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/public/nsIURLFetcher.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.cpp">mailnews/compose/src/nsMsgAttachmentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.h">mailnews/compose/src/nsMsgAttachmentHandler.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgAttachmentHandler.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompFields.cpp">mailnews/compose/src/nsMsgCompFields.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompFields.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompFields.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompFields.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompFields.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompFields.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.cpp">mailnews/compose/src/nsMsgCompUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.h">mailnews/compose/src/nsMsgCompUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.h">mailnews/compose/src/nsMsgCompose.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgCompose.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeProgressParams.cpp">mailnews/compose/src/nsMsgComposeProgressParams.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeProgressParams.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeProgressParams.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeProgressParams.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeProgressParams.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeProgressParams.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.cpp">mailnews/compose/src/nsMsgPrompts.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.h">mailnews/compose/src/nsMsgPrompts.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgPrompts.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.h">mailnews/compose/src/nsMsgSend.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSend.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.cpp">mailnews/compose/src/nsMsgSendLater.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.h">mailnews/compose/src/nsMsgSendLater.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendLater.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendReport.cpp">mailnews/compose/src/nsMsgSendReport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendReport.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendReport.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendReport.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendReport.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsMsgSendReport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.h">mailnews/compose/src/nsSmtpProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpServer.cpp">mailnews/compose/src/nsSmtpServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpServer.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpServer.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpServer.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpServer.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsSmtpServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsURLFetcher.cpp">mailnews/compose/src/nsURLFetcher.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsURLFetcher.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsURLFetcher.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsURLFetcher.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsURLFetcher.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/compose/src/nsURLFetcher.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">mailnews/db/msgdb/src/nsDBFolderInfo.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">mailnews/extensions/mdn/src/nsMsgMdnGenerator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.h">mailnews/extensions/smime/src/nsMsgComposeSecure.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsMsgComposeSecure.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">mailnews/extensions/smime/src/nsSMimeJSHelper.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsAutoSyncManager.cpp">mailnews/imap/src/nsAutoSyncManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsAutoSyncManager.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsAutoSyncManager.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsAutoSyncManager.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsAutoSyncManager.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsAutoSyncManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsIMAPHostSessionList.cpp">mailnews/imap/src/nsIMAPHostSessionList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsIMAPHostSessionList.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsIMAPHostSessionList.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsIMAPHostSessionList.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsIMAPHostSessionList.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsIMAPHostSessionList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapCore.h">mailnews/imap/src/nsImapCore.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapCore.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapCore.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapCore.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapCore.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapCore.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.h">mailnews/imap/src/nsImapIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapIncomingServer.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.h">mailnews/imap/src/nsImapProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapServerResponseParser.cpp">mailnews/imap/src/nsImapServerResponseParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapServerResponseParser.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapServerResponseParser.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapServerResponseParser.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapServerResponseParser.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapServerResponseParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.cpp">mailnews/imap/src/nsImapStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.h">mailnews/imap/src/nsImapStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsImapStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsSyncRunnableHelpers.cpp">mailnews/imap/src/nsSyncRunnableHelpers.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsSyncRunnableHelpers.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsSyncRunnableHelpers.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsSyncRunnableHelpers.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsSyncRunnableHelpers.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/imap/src/nsSyncRunnableHelpers.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.cpp">mailnews/import/applemail/src/nsAppleMailImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.h">mailnews/import/applemail/src/nsAppleMailImport.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/applemail/src/nsAppleMailImport.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.cpp">mailnews/import/eudora/src/nsEudoraAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.h">mailnews/import/eudora/src/nsEudoraAddress.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraAddress.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraCompose.cpp">mailnews/import/eudora/src/nsEudoraCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraCompose.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraCompose.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraCompose.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraCompose.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraFilters.cpp">mailnews/import/eudora/src/nsEudoraFilters.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraFilters.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraFilters.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraFilters.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraFilters.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraFilters.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraImport.cpp">mailnews/import/eudora/src/nsEudoraImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraImport.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraImport.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraImport.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraImport.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMac.cpp">mailnews/import/eudora/src/nsEudoraMac.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMac.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMac.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMac.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMac.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMac.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.cpp">mailnews/import/eudora/src/nsEudoraMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.h">mailnews/import/eudora/src/nsEudoraMailbox.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraMailbox.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraSettings.cpp">mailnews/import/eudora/src/nsEudoraSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraSettings.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraSettings.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraSettings.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraSettings.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">mailnews/import/eudora/src/nsEudoraStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.h">mailnews/import/eudora/src/nsEudoraStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.cpp">mailnews/import/eudora/src/nsEudoraWin32.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.h">mailnews/import/eudora/src/nsEudoraWin32.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/eudora/src/nsEudoraWin32.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.cpp">mailnews/import/oexpress/WabObject.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.h">mailnews/import/oexpress/WabObject.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/WabObject.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.cpp">mailnews/import/oexpress/nsOEAddressIterator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.h">mailnews/import/oexpress/nsOEAddressIterator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEAddressIterator.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEImport.cpp">mailnews/import/oexpress/nsOEImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEImport.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEImport.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEImport.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEImport.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEScanBoxes.cpp">mailnews/import/oexpress/nsOEScanBoxes.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEScanBoxes.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEScanBoxes.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEScanBoxes.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEScanBoxes.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEScanBoxes.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOESettings.cpp">mailnews/import/oexpress/nsOESettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOESettings.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOESettings.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOESettings.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOESettings.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOESettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.cpp">mailnews/import/oexpress/nsOEStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.h">mailnews/import/oexpress/nsOEStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/oexpress/nsOEStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.cpp">mailnews/import/outlook/src/MapiApi.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.h">mailnews/import/outlook/src/MapiApi.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/MapiApi.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookCompose.cpp">mailnews/import/outlook/src/nsOutlookCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookCompose.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookCompose.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookCompose.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookCompose.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookImport.cpp">mailnews/import/outlook/src/nsOutlookImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookImport.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookImport.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookImport.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookImport.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.cpp">mailnews/import/outlook/src/nsOutlookMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.h">mailnews/import/outlook/src/nsOutlookMail.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookMail.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookSettings.cpp">mailnews/import/outlook/src/nsOutlookSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookSettings.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookSettings.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookSettings.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookSettings.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">mailnews/import/outlook/src/nsOutlookStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.h">mailnews/import/outlook/src/nsOutlookStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/outlook/src/nsOutlookStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportAddressBooks.cpp">mailnews/import/src/nsImportAddressBooks.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportAddressBooks.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportAddressBooks.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportAddressBooks.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportAddressBooks.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportAddressBooks.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportFieldMap.cpp">mailnews/import/src/nsImportFieldMap.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportFieldMap.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportFieldMap.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportFieldMap.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportFieldMap.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportFieldMap.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMail.cpp">mailnews/import/src/nsImportMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMail.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMail.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMail.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMail.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMailboxDescriptor.h">mailnews/import/src/nsImportMailboxDescriptor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMailboxDescriptor.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMailboxDescriptor.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMailboxDescriptor.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMailboxDescriptor.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportMailboxDescriptor.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.cpp">mailnews/import/src/nsImportService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.h">mailnews/import/src/nsImportService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.cpp">mailnews/import/src/nsImportStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.h">mailnews/import/src/nsImportStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/src/nsImportStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.cpp">mailnews/import/text/src/nsTextAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.h">mailnews/import/text/src/nsTextAddress.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextAddress.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextImport.cpp">mailnews/import/text/src/nsTextImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextImport.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextImport.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextImport.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextImport.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/text/src/nsTextImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.cpp">mailnews/import/vcard/src/nsVCardAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.h">mailnews/import/vcard/src/nsVCardAddress.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardAddress.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardImport.cpp">mailnews/import/vcard/src/nsVCardImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardImport.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardImport.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardImport.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardImport.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/vcard/src/nsVCardImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMImport.cpp">mailnews/import/winlivemail/nsWMImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMImport.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMImport.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMImport.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMImport.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMSettings.cpp">mailnews/import/winlivemail/nsWMSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMSettings.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMSettings.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMSettings.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMSettings.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.cpp">mailnews/import/winlivemail/nsWMStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.h">mailnews/import/winlivemail/nsWMStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/import/winlivemail/nsWMStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalUndoTxn.cpp">mailnews/local/src/nsLocalUndoTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalUndoTxn.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalUndoTxn.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalUndoTxn.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalUndoTxn.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsLocalUndoTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.cpp">mailnews/local/src/nsMovemailService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.h">mailnews/local/src/nsMovemailService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMovemailService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMsgLocalStoreUtils.cpp">mailnews/local/src/nsMsgLocalStoreUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMsgLocalStoreUtils.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMsgLocalStoreUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMsgLocalStoreUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMsgLocalStoreUtils.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsMsgLocalStoreUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.h">mailnews/local/src/nsPop3Protocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Protocol.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Service.cpp">mailnews/local/src/nsPop3Service.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Service.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Service.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Service.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Service.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Service.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Sink.cpp">mailnews/local/src/nsPop3Sink.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Sink.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Sink.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Sink.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Sink.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/local/src/nsPop3Sink.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.cpp">mailnews/mapi/mapihook/src/msgMapiHook.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.h">mailnews/mapi/mapihook/src/msgMapiHook.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiHook.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.cpp">mailnews/mapi/mapihook/src/msgMapiMain.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.h">mailnews/mapi/mapihook/src/msgMapiMain.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiMain.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">mailnews/mapi/mapihook/src/msgMapiSupport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">mailnews/mime/emitters/nsMimeBaseEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/MimeHeaderParser.cpp">mailnews/mime/src/MimeHeaderParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/MimeHeaderParser.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/MimeHeaderParser.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/MimeHeaderParser.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/MimeHeaderParser.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/MimeHeaderParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/comi18n.cpp">mailnews/mime/src/comi18n.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/comi18n.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/comi18n.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/comi18n.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/comi18n.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/comi18n.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.cpp">mailnews/mime/src/mimemoz2.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.h">mailnews/mime/src/mimemoz2.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimemoz2.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimetpfl.cpp">mailnews/mime/src/mimetpfl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimetpfl.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimetpfl.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimetpfl.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimetpfl.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/mimetpfl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/nsMsgHeaderParser.cpp">mailnews/mime/src/nsMsgHeaderParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/nsMsgHeaderParser.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/nsMsgHeaderParser.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/nsMsgHeaderParser.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/nsMsgHeaderParser.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/mime/src/nsMsgHeaderParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.cpp">mailnews/news/src/nsNNTPNewsgroupList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.h">mailnews/news/src/nsNNTPNewsgroupList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPNewsgroupList.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.cpp">mailnews/news/src/nsNNTPProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.h">mailnews/news/src/nsNNTPProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNNTPProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.cpp">mailnews/news/src/nsNewsDownloader.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.h">mailnews/news/src/nsNewsDownloader.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsDownloader.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">suite/profile/migration/src/nsNetscapeProfileMigratorBase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">suite/profile/migration/src/nsSuiteProfileMigratorUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">suite/profile/migration/src/nsThunderbirdProfileMigrator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsMacShellService.cpp">suite/shell/src/nsMacShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsMacShellService.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsMacShellService.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsMacShellService.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsMacShellService.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsMacShellService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsWindowsShellService.cpp">suite/shell/src/nsWindowsShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsWindowsShellService.cpp">file</a> |
<a href="/comm-central/annotate/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsWindowsShellService.cpp">annotate</a> |
<a href="/comm-central/diff/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsWindowsShellService.cpp">diff</a> |
<a href="/comm-central/comparison/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsWindowsShellService.cpp">comparison</a> |
<a href="/comm-central/log/9eb3e41bab9bff569c7c6b939e593b390c67c287/suite/shell/src/nsWindowsShellService.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/backend/libical/calUtils.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/backend/libical/calUtils.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -23,17 +23,17 @@ nsresult logError(const nsAString&amp; msg) </span>
<a href="#l1.4"></a><span id="l1.4"> nsresult logWarning(const nsAString&amp; msg) {</span>
<a href="#l1.5"></a><span id="l1.5">     nsresult rc;</span>
<a href="#l1.6"></a><span id="l1.6">     nsCOMPtr&lt;nsIScriptError&gt; const scriptError(do_CreateInstance(&quot;@mozilla.org/scripterror;1&quot;, &amp;rc));</span>
<a href="#l1.7"></a><span id="l1.7">     NS_ENSURE_SUCCESS(rc, rc);</span>
<a href="#l1.8"></a><span id="l1.8">     rc = scriptError-&gt;Init(msg, EmptyString(), EmptyString(), 0, 0, nsIScriptError::warningFlag, &quot;calendar&quot;);</span>
<a href="#l1.9"></a><span id="l1.9">     return getConsoleService()-&gt;LogMessage(scriptError);</span>
<a href="#l1.10"></a><span id="l1.10"> }</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-nsresult log(PRUnichar const* msg) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+nsresult log(char16_t const* msg) {</span>
<a href="#l1.14"></a><span id="l1.14">     return getConsoleService()-&gt;LogStringMessage(msg);</span>
<a href="#l1.15"></a><span id="l1.15"> }</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> nsCOMPtr&lt;calITimezone&gt; detectTimezone(icaltimetype const&amp; icalt,</span>
<a href="#l1.18"></a><span id="l1.18">                                       calITimezoneProvider * tzProvider)</span>
<a href="#l1.19"></a><span id="l1.19"> {</span>
<a href="#l1.20"></a><span id="l1.20">     if (icalt.is_utc) {</span>
<a href="#l1.21"></a><span id="l1.21">         return UTC();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/backend/libical/calUtils.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/backend/libical/calUtils.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -83,17 +83,17 @@ inline nsresult logWarning(char const* m</span>
<a href="#l2.4"></a><span id="l2.4"> }</span>
<a href="#l2.5"></a><span id="l2.5"> inline nsresult logWarning(nsACString const&amp; msg) {</span>
<a href="#l2.6"></a><span id="l2.6">     return logWarning(NS_ConvertASCIItoUTF16(msg));</span>
<a href="#l2.7"></a><span id="l2.7"> }</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> /**</span>
<a href="#l2.10"></a><span id="l2.10">  * Just logs.</span>
<a href="#l2.11"></a><span id="l2.11">  */</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-nsresult log(PRUnichar const* msg);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+nsresult log(char16_t const* msg);</span>
<a href="#l2.14"></a><span id="l2.14"> inline nsresult log(char const* msg) {</span>
<a href="#l2.15"></a><span id="l2.15">     return log(NS_ConvertASCIItoUTF16(msg).get());</span>
<a href="#l2.16"></a><span id="l2.16"> }</span>
<a href="#l2.17"></a><span id="l2.17"> inline nsresult log(nsACString const&amp; msg) {</span>
<a href="#l2.18"></a><span id="l2.18">     return log(NS_ConvertASCIItoUTF16(msg).get());</span>
<a href="#l2.19"></a><span id="l2.19"> }</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21"> // some timezone helpers</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPConnection.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPConnection.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -216,17 +216,17 @@ GetListOfPendingOperations(const uint32_</span>
<a href="#l3.4"></a><span id="l3.4"> {</span>
<a href="#l3.5"></a><span id="l3.5">   nsTArray&lt;nsILDAPOperation*&gt;* pending_operations = static_cast&lt;nsTArray&lt;nsILDAPOperation*&gt;* &gt;(userArg);</span>
<a href="#l3.6"></a><span id="l3.6">   pending_operations-&gt;AppendElement(op);</span>
<a href="#l3.7"></a><span id="l3.7">   return PL_DHASH_NEXT;</span>
<a href="#l3.8"></a><span id="l3.8"> }</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10"> NS_IMETHODIMP</span>
<a href="#l3.11"></a><span id="l3.11"> nsLDAPConnection::Observe(nsISupports *aSubject, const char *aTopic,</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-                          const PRUnichar *aData)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                          const char16_t *aData)</span>
<a href="#l3.14"></a><span id="l3.14"> {</span>
<a href="#l3.15"></a><span id="l3.15">   if (!strcmp(aTopic, &quot;profile-change-net-teardown&quot;)) {</span>
<a href="#l3.16"></a><span id="l3.16">     // Abort all ldap requests.</span>
<a href="#l3.17"></a><span id="l3.17">     /* We cannot use enumerate function to abort operations because</span>
<a href="#l3.18"></a><span id="l3.18">      * nsILDAPOperation::AbandonExt() is modifying list of operations</span>
<a href="#l3.19"></a><span id="l3.19">      * and this leads to starvation.</span>
<a href="#l3.20"></a><span id="l3.20">      * We have to do a copy of pending operations.</span>
<a href="#l3.21"></a><span id="l3.21">      */</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -292,17 +292,17 @@ nsLDAPConnection::GetLdErrno(nsACString&amp;</span>
<a href="#l3.23"></a><span id="l3.23"> }</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25"> // return the error string corresponding to GetLdErrno.</span>
<a href="#l3.26"></a><span id="l3.26"> //</span>
<a href="#l3.27"></a><span id="l3.27"> // XXX - deal with optional params</span>
<a href="#l3.28"></a><span id="l3.28"> // XXX - how does ldap_perror know to look at the global errno?</span>
<a href="#l3.29"></a><span id="l3.29"> //</span>
<a href="#l3.30"></a><span id="l3.30"> NS_IMETHODIMP</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-nsLDAPConnection::GetErrorString(PRUnichar **_retval)</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+nsLDAPConnection::GetErrorString(char16_t **_retval)</span>
<a href="#l3.33"></a><span id="l3.33"> {</span>
<a href="#l3.34"></a><span id="l3.34">     NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l3.35"></a><span id="l3.35"> </span>
<a href="#l3.36"></a><span id="l3.36">     // get the error string</span>
<a href="#l3.37"></a><span id="l3.37">     //</span>
<a href="#l3.38"></a><span id="l3.38">     char *rv = ldap_err2string(ldap_get_lderrno(mConnectionHandle, 0, 0));</span>
<a href="#l3.39"></a><span id="l3.39">     if (!rv) {</span>
<a href="#l3.40"></a><span id="l3.40">         return NS_ERROR_OUT_OF_MEMORY;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPMessage.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPMessage.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -444,17 +444,17 @@ NS_IMETHODIMP nsLDAPMessage::GetDn(nsACS</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">     return NS_OK;</span>
<a href="#l4.6"></a><span id="l4.6"> }</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> // wrapper for ldap_get_values()</span>
<a href="#l4.9"></a><span id="l4.9"> //</span>
<a href="#l4.10"></a><span id="l4.10"> NS_IMETHODIMP</span>
<a href="#l4.11"></a><span id="l4.11"> nsLDAPMessage::GetValues(const char *aAttr, uint32_t *aCount, </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                         PRUnichar ***aValues)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                         char16_t ***aValues)</span>
<a href="#l4.14"></a><span id="l4.14"> {</span>
<a href="#l4.15"></a><span id="l4.15">     char **values;</span>
<a href="#l4.16"></a><span id="l4.16">     </span>
<a href="#l4.17"></a><span id="l4.17"> #if defined(DEBUG)</span>
<a href="#l4.18"></a><span id="l4.18">     // We only want this being logged for debug builds so as not to affect performance too much.</span>
<a href="#l4.19"></a><span id="l4.19">     PR_LOG(gLDAPLogModule, PR_LOG_DEBUG,</span>
<a href="#l4.20"></a><span id="l4.20">            (&quot;nsLDAPMessage::GetValues(): called with aAttr = '%s'&quot;, aAttr));</span>
<a href="#l4.21"></a><span id="l4.21"> #endif</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -486,17 +486,17 @@ nsLDAPMessage::GetValues(const char *aAt</span>
<a href="#l4.23"></a><span id="l4.23">     }</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">     // count the values</span>
<a href="#l4.26"></a><span id="l4.26">     //</span>
<a href="#l4.27"></a><span id="l4.27">     uint32_t numVals = ldap_count_values(values);</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">     // create an array of the appropriate size</span>
<a href="#l4.30"></a><span id="l4.30">     //</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    *aValues = static_cast&lt;PRUnichar **&gt;(nsMemory::Alloc(numVals * sizeof(PRUnichar *)));</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    *aValues = static_cast&lt;char16_t **&gt;(nsMemory::Alloc(numVals * sizeof(char16_t *)));</span>
<a href="#l4.33"></a><span id="l4.33">     if (!*aValues) {</span>
<a href="#l4.34"></a><span id="l4.34">         ldap_value_free(values);</span>
<a href="#l4.35"></a><span id="l4.35">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l4.36"></a><span id="l4.36">     }</span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38">     // clone the array (except for the trailing NULL entry) using the </span>
<a href="#l4.39"></a><span id="l4.39">     // shared allocator for XPCOM correctness</span>
<a href="#l4.40"></a><span id="l4.40">     //</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineat">@@ -623,17 +623,17 @@ NS_IMETHODIMP nsLDAPMessage::GetOperatio</span>
<a href="#l4.42"></a><span id="l4.42">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l4.43"></a><span id="l4.43">     }</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45">     NS_IF_ADDREF(*_retval = mOperation);</span>
<a href="#l4.46"></a><span id="l4.46">     return NS_OK;</span>
<a href="#l4.47"></a><span id="l4.47"> }</span>
<a href="#l4.48"></a><span id="l4.48"> </span>
<a href="#l4.49"></a><span id="l4.49"> NS_IMETHODIMP</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-nsLDAPMessage::ToUnicode(PRUnichar* *aString)</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+nsLDAPMessage::ToUnicode(char16_t* *aString)</span>
<a href="#l4.52"></a><span id="l4.52"> {</span>
<a href="#l4.53"></a><span id="l4.53">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l4.54"></a><span id="l4.54"> }</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56"> NS_IMETHODIMP</span>
<a href="#l4.57"></a><span id="l4.57"> nsLDAPMessage::GetErrorMessage(nsACString &amp; aErrorMessage)</span>
<a href="#l4.58"></a><span id="l4.58"> {</span>
<a href="#l4.59"></a><span id="l4.59">     aErrorMessage.Assign(mErrorMessage);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPServer.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPServer.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -14,31 +14,31 @@ nsLDAPServer::nsLDAPServer()</span>
<a href="#l5.4"></a><span id="l5.4"> {</span>
<a href="#l5.5"></a><span id="l5.5"> }</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> nsLDAPServer::~nsLDAPServer()</span>
<a href="#l5.8"></a><span id="l5.8"> {</span>
<a href="#l5.9"></a><span id="l5.9"> }</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> // attribute wstring key;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-NS_IMETHODIMP nsLDAPServer::GetKey(PRUnichar **_retval)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+NS_IMETHODIMP nsLDAPServer::GetKey(char16_t **_retval)</span>
<a href="#l5.14"></a><span id="l5.14"> {</span>
<a href="#l5.15"></a><span id="l5.15">     if (!_retval) {</span>
<a href="#l5.16"></a><span id="l5.16">         NS_ERROR(&quot;nsLDAPServer::GetKey: null pointer &quot;);</span>
<a href="#l5.17"></a><span id="l5.17">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l5.18"></a><span id="l5.18">     }</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20">     *_retval = ToNewUnicode(mKey);</span>
<a href="#l5.21"></a><span id="l5.21">     if (!*_retval) {</span>
<a href="#l5.22"></a><span id="l5.22">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l5.23"></a><span id="l5.23">     }</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25">     return NS_OK;</span>
<a href="#l5.26"></a><span id="l5.26"> }</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-NS_IMETHODIMP nsLDAPServer::SetKey(const PRUnichar *aKey)</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+NS_IMETHODIMP nsLDAPServer::SetKey(const char16_t *aKey)</span>
<a href="#l5.29"></a><span id="l5.29"> {</span>
<a href="#l5.30"></a><span id="l5.30">     mKey = aKey;</span>
<a href="#l5.31"></a><span id="l5.31">     return NS_OK;</span>
<a href="#l5.32"></a><span id="l5.32"> }</span>
<a href="#l5.33"></a><span id="l5.33"> </span>
<a href="#l5.34"></a><span id="l5.34"> // attribute AUTF8String username;</span>
<a href="#l5.35"></a><span id="l5.35"> NS_IMETHODIMP nsLDAPServer::GetUsername(nsACString&amp; _retval)</span>
<a href="#l5.36"></a><span id="l5.36"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPService.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPService.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -255,17 +255,17 @@ NS_IMETHODIMP nsLDAPService::AddServer(n</span>
<a href="#l6.4"></a><span id="l6.4">         mServers.Put(key, entry);</span>
<a href="#l6.5"></a><span id="l6.5">     }</span>
<a href="#l6.6"></a><span id="l6.6">     NS_ADDREF(aServer);</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">     return NS_OK;</span>
<a href="#l6.9"></a><span id="l6.9"> }</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11"> // void deleteServer (in wstring aKey);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-NS_IMETHODIMP nsLDAPService::DeleteServer(const PRUnichar *aKey)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+NS_IMETHODIMP nsLDAPService::DeleteServer(const char16_t *aKey)</span>
<a href="#l6.14"></a><span id="l6.14"> {</span>
<a href="#l6.15"></a><span id="l6.15">     nsLDAPServiceEntry *entry;</span>
<a href="#l6.16"></a><span id="l6.16">     MutexAutoLock lock(mLock);</span>
<a href="#l6.17"></a><span id="l6.17">         </span>
<a href="#l6.18"></a><span id="l6.18">     // We should probably rename the key for this entry now that it's</span>
<a href="#l6.19"></a><span id="l6.19">     // &quot;deleted&quot;, so that we can add in a new one with the same ID.</span>
<a href="#l6.20"></a><span id="l6.20">     // This is bug #77669.</span>
<a href="#l6.21"></a><span id="l6.21">     //</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -280,17 +280,17 @@ NS_IMETHODIMP nsLDAPService::DeleteServe</span>
<a href="#l6.23"></a><span id="l6.23">         //</span>
<a href="#l6.24"></a><span id="l6.24">         return NS_ERROR_FAILURE;</span>
<a href="#l6.25"></a><span id="l6.25">     }</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27">     return NS_OK;</span>
<a href="#l6.28"></a><span id="l6.28"> }</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30"> // nsILDAPServer getServer (in wstring aKey);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-NS_IMETHODIMP nsLDAPService::GetServer(const PRUnichar *aKey,</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+NS_IMETHODIMP nsLDAPService::GetServer(const char16_t *aKey,</span>
<a href="#l6.33"></a><span id="l6.33">                                        nsILDAPServer **_retval)</span>
<a href="#l6.34"></a><span id="l6.34"> {</span>
<a href="#l6.35"></a><span id="l6.35">     nsLDAPServiceEntry *entry;</span>
<a href="#l6.36"></a><span id="l6.36">     MutexAutoLock lock(mLock);</span>
<a href="#l6.37"></a><span id="l6.37"> </span>
<a href="#l6.38"></a><span id="l6.38">     if (!_retval) {</span>
<a href="#l6.39"></a><span id="l6.39">         NS_ERROR(&quot;nsLDAPService::GetServer: null pointer &quot;);</span>
<a href="#l6.40"></a><span id="l6.40">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineat">@@ -304,17 +304,17 @@ NS_IMETHODIMP nsLDAPService::GetServer(c</span>
<a href="#l6.42"></a><span id="l6.42">         return NS_ERROR_FAILURE;</span>
<a href="#l6.43"></a><span id="l6.43">     }</span>
<a href="#l6.44"></a><span id="l6.44"> </span>
<a href="#l6.45"></a><span id="l6.45">     return NS_OK;</span>
<a href="#l6.46"></a><span id="l6.46"> }</span>
<a href="#l6.47"></a><span id="l6.47"> </span>
<a href="#l6.48"></a><span id="l6.48"> //void requestConnection (in wstring aKey,</span>
<a href="#l6.49"></a><span id="l6.49"> //                        in nsILDAPMessageListener aMessageListener);</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-NS_IMETHODIMP nsLDAPService::RequestConnection(const PRUnichar *aKey,</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+NS_IMETHODIMP nsLDAPService::RequestConnection(const char16_t *aKey,</span>
<a href="#l6.52"></a><span id="l6.52">                                  nsILDAPMessageListener *aListener)</span>
<a href="#l6.53"></a><span id="l6.53"> {</span>
<a href="#l6.54"></a><span id="l6.54">     nsLDAPServiceEntry *entry;</span>
<a href="#l6.55"></a><span id="l6.55">     nsCOMPtr&lt;nsILDAPConnection&gt; conn;</span>
<a href="#l6.56"></a><span id="l6.56">     nsCOMPtr&lt;nsILDAPMessage&gt; message;</span>
<a href="#l6.57"></a><span id="l6.57">     nsresult rv;</span>
<a href="#l6.58"></a><span id="l6.58"> </span>
<a href="#l6.59"></a><span id="l6.59">     if (!aListener) {</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineat">@@ -365,17 +365,17 @@ NS_IMETHODIMP nsLDAPService::RequestConn</span>
<a href="#l6.61"></a><span id="l6.61">             return NS_ERROR_FAILURE;</span>
<a href="#l6.62"></a><span id="l6.62">         }</span>
<a href="#l6.63"></a><span id="l6.63">     }</span>
<a href="#l6.64"></a><span id="l6.64"> </span>
<a href="#l6.65"></a><span id="l6.65">     return NS_OK;</span>
<a href="#l6.66"></a><span id="l6.66"> }</span>
<a href="#l6.67"></a><span id="l6.67"> </span>
<a href="#l6.68"></a><span id="l6.68"> // nsILDAPConnection getConnection (in wstring aKey);</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-NS_IMETHODIMP nsLDAPService::GetConnection(const PRUnichar *aKey,</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+NS_IMETHODIMP nsLDAPService::GetConnection(const char16_t *aKey,</span>
<a href="#l6.71"></a><span id="l6.71">                                            nsILDAPConnection **_retval)</span>
<a href="#l6.72"></a><span id="l6.72"> {</span>
<a href="#l6.73"></a><span id="l6.73">     nsLDAPServiceEntry *entry;</span>
<a href="#l6.74"></a><span id="l6.74">     MutexAutoLock lock(mLock);</span>
<a href="#l6.75"></a><span id="l6.75"> </span>
<a href="#l6.76"></a><span id="l6.76">     if (!_retval) {</span>
<a href="#l6.77"></a><span id="l6.77">         NS_ERROR(&quot;nsLDAPService::GetConnection: null pointer &quot;);</span>
<a href="#l6.78"></a><span id="l6.78">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineat">@@ -390,17 +390,17 @@ NS_IMETHODIMP nsLDAPService::GetConnecti</span>
<a href="#l6.80"></a><span id="l6.80">     if (!(*_retval = entry-&gt;GetConnection().get())){</span>
<a href="#l6.81"></a><span id="l6.81">         return NS_ERROR_FAILURE;</span>
<a href="#l6.82"></a><span id="l6.82">     }</span>
<a href="#l6.83"></a><span id="l6.83"> </span>
<a href="#l6.84"></a><span id="l6.84">     return NS_OK;</span>
<a href="#l6.85"></a><span id="l6.85"> }</span>
<a href="#l6.86"></a><span id="l6.86"> </span>
<a href="#l6.87"></a><span id="l6.87"> // void releaseConnection (in wstring aKey);</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-NS_IMETHODIMP nsLDAPService::ReleaseConnection(const PRUnichar *aKey)</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+NS_IMETHODIMP nsLDAPService::ReleaseConnection(const char16_t *aKey)</span>
<a href="#l6.90"></a><span id="l6.90"> {</span>
<a href="#l6.91"></a><span id="l6.91">     nsLDAPServiceEntry *entry;</span>
<a href="#l6.92"></a><span id="l6.92">     MutexAutoLock lock(mLock);</span>
<a href="#l6.93"></a><span id="l6.93"> </span>
<a href="#l6.94"></a><span id="l6.94">     if (!mServers.Get(nsDependentString(aKey), &amp;entry)) {</span>
<a href="#l6.95"></a><span id="l6.95">         return NS_ERROR_FAILURE;</span>
<a href="#l6.96"></a><span id="l6.96">     }</span>
<a href="#l6.97"></a><span id="l6.97"> </span>
<a href="#l6.98"></a><span id="l6.98" class="difflineat">@@ -412,17 +412,17 @@ NS_IMETHODIMP nsLDAPService::ReleaseConn</span>
<a href="#l6.99"></a><span id="l6.99">         //</span>
<a href="#l6.100"></a><span id="l6.100">     }</span>
<a href="#l6.101"></a><span id="l6.101"> </span>
<a href="#l6.102"></a><span id="l6.102">     return NS_OK;</span>
<a href="#l6.103"></a><span id="l6.103"> }</span>
<a href="#l6.104"></a><span id="l6.104"> </span>
<a href="#l6.105"></a><span id="l6.105"> // void reconnectConnection (in wstring aKey,</span>
<a href="#l6.106"></a><span id="l6.106"> //                           in nsILDAPMessageListener aMessageListener);</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineminus">-NS_IMETHODIMP nsLDAPService::ReconnectConnection(const PRUnichar *aKey,</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineplus">+NS_IMETHODIMP nsLDAPService::ReconnectConnection(const char16_t *aKey,</span>
<a href="#l6.109"></a><span id="l6.109">                                  nsILDAPMessageListener *aListener)</span>
<a href="#l6.110"></a><span id="l6.110"> {</span>
<a href="#l6.111"></a><span id="l6.111">     nsLDAPServiceEntry *entry;</span>
<a href="#l6.112"></a><span id="l6.112">     nsresult rv;</span>
<a href="#l6.113"></a><span id="l6.113"> </span>
<a href="#l6.114"></a><span id="l6.114">     if (!aListener) {</span>
<a href="#l6.115"></a><span id="l6.115">         NS_ERROR(&quot;nsLDAPService::ReconnectConnection: null pointer &quot;);</span>
<a href="#l6.116"></a><span id="l6.116">         return NS_ERROR_NULL_POINTER;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPSyncQuery.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPSyncQuery.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -167,35 +167,35 @@ nsLDAPSyncQuery::OnLDAPSearchEntry(nsILD</span>
<a href="#l7.4"></a><span id="l7.4">                &quot;aMessage-&gt;GetAttributes() failed&quot;);</span>
<a href="#l7.5"></a><span id="l7.5">     FinishLDAPQuery();</span>
<a href="#l7.6"></a><span id="l7.6">     return rv;</span>
<a href="#l7.7"></a><span id="l7.7">   }</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">   // Iterate through the attributes received in this message</span>
<a href="#l7.10"></a><span id="l7.10">   for (uint32_t i = 0; i &lt; attrCount; i++)</span>
<a href="#l7.11"></a><span id="l7.11">   {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    PRUnichar **vals;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    char16_t **vals;</span>
<a href="#l7.14"></a><span id="l7.14">     uint32_t valueCount;</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">     // Get the values of this attribute.</span>
<a href="#l7.17"></a><span id="l7.17">     // XXX better failure handling</span>
<a href="#l7.18"></a><span id="l7.18">     rv = aMessage-&gt;GetValues(attributes[i], &amp;valueCount, &amp;vals);</span>
<a href="#l7.19"></a><span id="l7.19">     if (NS_FAILED(rv))</span>
<a href="#l7.20"></a><span id="l7.20">     {</span>
<a href="#l7.21"></a><span id="l7.21">       NS_WARNING(&quot;nsLDAPSyncQuery:OnLDAPSearchEntry(): &quot;</span>
<a href="#l7.22"></a><span id="l7.22">                  &quot;aMessage-&gt;GetValues() failed\n&quot;);</span>
<a href="#l7.23"></a><span id="l7.23">       FinishLDAPQuery();</span>
<a href="#l7.24"></a><span id="l7.24">       break;</span>
<a href="#l7.25"></a><span id="l7.25">     }</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">     // Store all values of this attribute in the mResults.</span>
<a href="#l7.28"></a><span id="l7.28">     for (uint32_t j = 0; j &lt; valueCount; j++) {</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-      mResults.Append(PRUnichar('\n'));</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+      mResults.Append(char16_t('\n'));</span>
<a href="#l7.31"></a><span id="l7.31">       mResults.AppendASCII(attributes[i]);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-      mResults.Append(PRUnichar('='));</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+      mResults.Append(char16_t('='));</span>
<a href="#l7.34"></a><span id="l7.34">       mResults.Append(vals[j]);</span>
<a href="#l7.35"></a><span id="l7.35">     }</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37">     NS_FREE_XPCOM_ALLOCATED_POINTER_ARRAY(valueCount, vals);</span>
<a href="#l7.38"></a><span id="l7.38">   }</span>
<a href="#l7.39"></a><span id="l7.39">   NS_FREE_XPCOM_ALLOCATED_POINTER_ARRAY(attrCount, attributes);</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41">   return rv;</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineat">@@ -334,17 +334,17 @@ nsLDAPSyncQuery::FinishLDAPQuery()</span>
<a href="#l7.43"></a><span id="l7.43">     mOperation = 0;</span>
<a href="#l7.44"></a><span id="l7.44">     mServerURL = 0;</span>
<a href="#l7.45"></a><span id="l7.45">  </span>
<a href="#l7.46"></a><span id="l7.46"> }</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48"> /* wstring getQueryResults (in nsILDAPURL aServerURL, in unsigned long aVersion); */</span>
<a href="#l7.49"></a><span id="l7.49"> NS_IMETHODIMP nsLDAPSyncQuery::GetQueryResults(nsILDAPURL *aServerURL,</span>
<a href="#l7.50"></a><span id="l7.50">                                                uint32_t aProtocolVersion,</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-                                               PRUnichar **_retval)</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+                                               char16_t **_retval)</span>
<a href="#l7.53"></a><span id="l7.53"> {</span>
<a href="#l7.54"></a><span id="l7.54">     nsresult rv;</span>
<a href="#l7.55"></a><span id="l7.55">     </span>
<a href="#l7.56"></a><span id="l7.56">     if (!aServerURL) {</span>
<a href="#l7.57"></a><span id="l7.57">         NS_ERROR(&quot;nsLDAPSyncQuery::GetQueryResults() called without LDAP URL&quot;);</span>
<a href="#l7.58"></a><span id="l7.58">         return NS_ERROR_FAILURE;</span>
<a href="#l7.59"></a><span id="l7.59">     }</span>
<a href="#l7.60"></a><span id="l7.60">     mServerURL = aServerURL;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/app/nsMailApp.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/app/nsMailApp.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -37,17 +37,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #include &quot;mozilla/Telemetry.h&quot;</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> static void Output(const char *fmt, ... )</span>
<a href="#l8.7"></a><span id="l8.7"> {</span>
<a href="#l8.8"></a><span id="l8.8">   va_list ap;</span>
<a href="#l8.9"></a><span id="l8.9">   va_start(ap, fmt);</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11"> #if defined(XP_WIN) &amp;&amp; !MOZ_WINCONSOLE</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  PRUnichar msg[2048];</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  char16_t msg[2048];</span>
<a href="#l8.14"></a><span id="l8.14">   _vsnwprintf(msg, sizeof(msg)/sizeof(msg[0]), NS_ConvertUTF8toUTF16(fmt).get(), ap);</span>
<a href="#l8.15"></a><span id="l8.15">   MessageBoxW(NULL, msg, L&quot;XULRunner&quot;, MB_OK | MB_ICONERROR);</span>
<a href="#l8.16"></a><span id="l8.16"> #else</span>
<a href="#l8.17"></a><span id="l8.17">   vfprintf(stderr, fmt, ap);</span>
<a href="#l8.18"></a><span id="l8.18"> #endif</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">   va_end(ap);</span>
<a href="#l8.21"></a><span id="l8.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/migration/src/nsEudoraProfileMigrator.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/migration/src/nsEudoraProfileMigrator.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -66,17 +66,17 @@ nsEudoraProfileMigrator::Notify(nsITimer</span>
<a href="#l9.4"></a><span id="l9.4">   }</span>
<a href="#l9.5"></a><span id="l9.5">   return NS_OK;</span>
<a href="#l9.6"></a><span id="l9.6"> }</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l9.9"></a><span id="l9.9"> // nsIMailProfileMigrator</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11"> NS_IMETHODIMP</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-nsEudoraProfileMigrator::Migrate(uint16_t aItems, nsIProfileStartup* aStartup, const PRUnichar* aProfile)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+nsEudoraProfileMigrator::Migrate(uint16_t aItems, nsIProfileStartup* aStartup, const char16_t* aProfile)</span>
<a href="#l9.14"></a><span id="l9.14"> {</span>
<a href="#l9.15"></a><span id="l9.15">   nsresult rv = NS_OK;</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">   if (aStartup)</span>
<a href="#l9.18"></a><span id="l9.18">   {</span>
<a href="#l9.19"></a><span id="l9.19">     rv = aStartup-&gt;DoStartup();</span>
<a href="#l9.20"></a><span id="l9.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.21"></a><span id="l9.21">   }</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -89,17 +89,17 @@ nsEudoraProfileMigrator::Migrate(uint16_</span>
<a href="#l9.23"></a><span id="l9.23">   // the final migration step, copying the mail folders over.</span>
<a href="#l9.24"></a><span id="l9.24">   rv = ImportAddressBook(mImportModule);</span>
<a href="#l9.25"></a><span id="l9.25"> </span>
<a href="#l9.26"></a><span id="l9.26">   // don't broadcast an on end migration here. We aren't done until our asynch import process says we are done.</span>
<a href="#l9.27"></a><span id="l9.27">   return rv;</span>
<a href="#l9.28"></a><span id="l9.28"> }</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30"> NS_IMETHODIMP</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-nsEudoraProfileMigrator::GetMigrateData(const PRUnichar* aProfile,</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+nsEudoraProfileMigrator::GetMigrateData(const char16_t* aProfile,</span>
<a href="#l9.33"></a><span id="l9.33">                                            bool aReplace,</span>
<a href="#l9.34"></a><span id="l9.34">                                            uint16_t* aResult)</span>
<a href="#l9.35"></a><span id="l9.35"> {</span>
<a href="#l9.36"></a><span id="l9.36">   // There's no harm in assuming everything is available.</span>
<a href="#l9.37"></a><span id="l9.37">   *aResult = nsIMailProfileMigrator::ACCOUNT_SETTINGS | nsIMailProfileMigrator::ADDRESSBOOK_DATA |</span>
<a href="#l9.38"></a><span id="l9.38">              nsIMailProfileMigrator::MAILDATA | nsIMailProfileMigrator::FILTERS;</span>
<a href="#l9.39"></a><span id="l9.39">   return NS_OK;</span>
<a href="#l9.40"></a><span id="l9.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/migration/src/nsMailProfileMigratorUtils.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/migration/src/nsMailProfileMigratorUtils.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -31,17 +31,17 @@</span>
<a href="#l10.4"></a><span id="l10.4"> class nsIProfileStartup;</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> // Proxy utilities shared by the Opera and IE migrators</span>
<a href="#l10.7"></a><span id="l10.7"> void ParseOverrideServers(const char* aServers, nsIPrefBranch* aBranch);</span>
<a href="#l10.8"></a><span id="l10.8"> void SetProxyPref(const nsACString&amp; aHostPort, const char* aPref, </span>
<a href="#l10.9"></a><span id="l10.9">                   const char* aPortPref, nsIPrefBranch* aPrefs);</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11"> struct MigrationData { </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  PRUnichar* fileName; </span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  char16_t* fileName; </span>
<a href="#l10.14"></a><span id="l10.14">   uint32_t sourceFlag;</span>
<a href="#l10.15"></a><span id="l10.15">   bool replaceOnly;</span>
<a href="#l10.16"></a><span id="l10.16"> };</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> class nsIFile;</span>
<a href="#l10.19"></a><span id="l10.19"> void GetMigrateDataFromArray(MigrationData* aDataArray, </span>
<a href="#l10.20"></a><span id="l10.20">                              int32_t aDataArrayLength,</span>
<a href="#l10.21"></a><span id="l10.21">                              bool aReplace,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/migration/src/nsOEProfileMigrator.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/migration/src/nsOEProfileMigrator.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -63,17 +63,17 @@ nsOEProfileMigrator::Notify(nsITimer *ti</span>
<a href="#l11.4"></a><span id="l11.4">   }</span>
<a href="#l11.5"></a><span id="l11.5">   return NS_OK;</span>
<a href="#l11.6"></a><span id="l11.6"> }</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.9"></a><span id="l11.9"> // nsIMailProfileMigrator</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11"> NS_IMETHODIMP</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-nsOEProfileMigrator::Migrate(uint16_t aItems, nsIProfileStartup* aStartup, const PRUnichar* aProfile)</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+nsOEProfileMigrator::Migrate(uint16_t aItems, nsIProfileStartup* aStartup, const char16_t* aProfile)</span>
<a href="#l11.14"></a><span id="l11.14"> {</span>
<a href="#l11.15"></a><span id="l11.15">   nsresult rv = NS_OK;</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">   if (aStartup)</span>
<a href="#l11.18"></a><span id="l11.18">   {</span>
<a href="#l11.19"></a><span id="l11.19">     rv = aStartup-&gt;DoStartup();</span>
<a href="#l11.20"></a><span id="l11.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.21"></a><span id="l11.21">   }</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -86,17 +86,17 @@ nsOEProfileMigrator::Migrate(uint16_t aI</span>
<a href="#l11.23"></a><span id="l11.23">   // the final migration step, copying the mail folders over.</span>
<a href="#l11.24"></a><span id="l11.24">   rv = ImportAddressBook(mImportModule);</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">   // don't broadcast an on end migration here. We aren't done until our asynch import process says we are done.</span>
<a href="#l11.27"></a><span id="l11.27">   return rv;</span>
<a href="#l11.28"></a><span id="l11.28"> }</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30"> NS_IMETHODIMP</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-nsOEProfileMigrator::GetMigrateData(const PRUnichar* aProfile,</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+nsOEProfileMigrator::GetMigrateData(const char16_t* aProfile,</span>
<a href="#l11.33"></a><span id="l11.33">                                            bool aReplace,</span>
<a href="#l11.34"></a><span id="l11.34">                                            uint16_t* aResult)</span>
<a href="#l11.35"></a><span id="l11.35"> {</span>
<a href="#l11.36"></a><span id="l11.36">   // There's no harm in assuming everything is available.</span>
<a href="#l11.37"></a><span id="l11.37">   *aResult = nsIMailProfileMigrator::ACCOUNT_SETTINGS | nsIMailProfileMigrator::ADDRESSBOOK_DATA |</span>
<a href="#l11.38"></a><span id="l11.38">              nsIMailProfileMigrator::MAILDATA;</span>
<a href="#l11.39"></a><span id="l11.39">   return NS_OK;</span>
<a href="#l11.40"></a><span id="l11.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/migration/src/nsOutlookProfileMigrator.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/migration/src/nsOutlookProfileMigrator.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -58,17 +58,17 @@ nsOutlookProfileMigrator::Notify(nsITime</span>
<a href="#l12.4"></a><span id="l12.4">   }</span>
<a href="#l12.5"></a><span id="l12.5">   return NS_OK;</span>
<a href="#l12.6"></a><span id="l12.6"> }</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l12.9"></a><span id="l12.9"> // nsIMailProfileMigrator</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> NS_IMETHODIMP</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-nsOutlookProfileMigrator::Migrate(uint16_t aItems, nsIProfileStartup* aStartup, const PRUnichar* aProfile)</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+nsOutlookProfileMigrator::Migrate(uint16_t aItems, nsIProfileStartup* aStartup, const char16_t* aProfile)</span>
<a href="#l12.14"></a><span id="l12.14"> {</span>
<a href="#l12.15"></a><span id="l12.15">   nsresult rv = NS_OK;</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17">   if (aStartup)</span>
<a href="#l12.18"></a><span id="l12.18">   {</span>
<a href="#l12.19"></a><span id="l12.19">     rv = aStartup-&gt;DoStartup();</span>
<a href="#l12.20"></a><span id="l12.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.21"></a><span id="l12.21">   }</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -82,17 +82,17 @@ nsOutlookProfileMigrator::Migrate(uint16</span>
<a href="#l12.23"></a><span id="l12.23">   // the final migration step, copying the mail folders over.</span>
<a href="#l12.24"></a><span id="l12.24">   rv = ImportAddressBook(mImportModule);</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26">   // don't broadcast an on end migration here. We aren't done until our asynch import process says we are done.</span>
<a href="#l12.27"></a><span id="l12.27">   return rv;</span>
<a href="#l12.28"></a><span id="l12.28"> }</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30"> NS_IMETHODIMP</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-nsOutlookProfileMigrator::GetMigrateData(const PRUnichar* aProfile, bool aReplace, uint16_t* aResult)</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+nsOutlookProfileMigrator::GetMigrateData(const char16_t* aProfile, bool aReplace, uint16_t* aResult)</span>
<a href="#l12.33"></a><span id="l12.33"> {</span>
<a href="#l12.34"></a><span id="l12.34">   // There's no harm in assuming everything is available.</span>
<a href="#l12.35"></a><span id="l12.35">   *aResult = nsIMailProfileMigrator::ACCOUNT_SETTINGS | nsIMailProfileMigrator::ADDRESSBOOK_DATA |</span>
<a href="#l12.36"></a><span id="l12.36">              nsIMailProfileMigrator::MAILDATA;</span>
<a href="#l12.37"></a><span id="l12.37">   return NS_OK;</span>
<a href="#l12.38"></a><span id="l12.38"> }</span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigratorBase.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigratorBase.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -142,17 +142,17 @@ nsresult nsProfileMigratorBase::ImportFi</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5">   if (NS_SUCCEEDED(rv2))</span>
<a href="#l13.6"></a><span id="l13.6">   {</span>
<a href="#l13.7"></a><span id="l13.7">     nsAutoString index;</span>
<a href="#l13.8"></a><span id="l13.8">     index.AppendInt(nsIMailProfileMigrator::FILTERS);</span>
<a href="#l13.9"></a><span id="l13.9">     NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get());</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">     bool importedFilters = false;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    PRUnichar* error;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    char16_t* error;</span>
<a href="#l13.14"></a><span id="l13.14"> </span>
<a href="#l13.15"></a><span id="l13.15">     rv = importFilters-&gt;Import(&amp;error, &amp;importedFilters);</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">     NOTIFY_OBSERVERS(MIGRATION_ITEMAFTERMIGRATE, index.get());</span>
<a href="#l13.18"></a><span id="l13.18">   }</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20">   // migration is now done...notify the UI.</span>
<a href="#l13.21"></a><span id="l13.21">   NOTIFY_OBSERVERS(MIGRATION_ENDED, nullptr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -35,17 +35,17 @@</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> struct PrefBranchStruct {</span>
<a href="#l14.6"></a><span id="l14.6">   char*         prefName;</span>
<a href="#l14.7"></a><span id="l14.7">   int32_t       type;</span>
<a href="#l14.8"></a><span id="l14.8">   union {</span>
<a href="#l14.9"></a><span id="l14.9">     char*       stringValue;</span>
<a href="#l14.10"></a><span id="l14.10">     int32_t     intValue;</span>
<a href="#l14.11"></a><span id="l14.11">     bool        boolValue;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    PRUnichar*  wstringValue;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+    char16_t*  wstringValue;</span>
<a href="#l14.14"></a><span id="l14.14">   };</span>
<a href="#l14.15"></a><span id="l14.15"> };</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17"> NS_IMPL_ISUPPORTS2(nsSeamonkeyProfileMigrator, nsIMailProfileMigrator, nsITimerCallback)</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20"> nsSeamonkeyProfileMigrator::nsSeamonkeyProfileMigrator()</span>
<a href="#l14.21"></a><span id="l14.21"> {</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -54,17 +54,17 @@ nsSeamonkeyProfileMigrator::nsSeamonkeyP</span>
<a href="#l14.23"></a><span id="l14.23"> nsSeamonkeyProfileMigrator::~nsSeamonkeyProfileMigrator()</span>
<a href="#l14.24"></a><span id="l14.24"> {</span>
<a href="#l14.25"></a><span id="l14.25"> }</span>
<a href="#l14.26"></a><span id="l14.26"> </span>
<a href="#l14.27"></a><span id="l14.27"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l14.28"></a><span id="l14.28"> // nsIMailProfileMigrator</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30"> NS_IMETHODIMP</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-nsSeamonkeyProfileMigrator::Migrate(uint16_t aItems, nsIProfileStartup* aStartup, const PRUnichar* aProfile)</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+nsSeamonkeyProfileMigrator::Migrate(uint16_t aItems, nsIProfileStartup* aStartup, const char16_t* aProfile)</span>
<a href="#l14.33"></a><span id="l14.33"> {</span>
<a href="#l14.34"></a><span id="l14.34">   nsresult rv = NS_OK;</span>
<a href="#l14.35"></a><span id="l14.35">   bool aReplace = aStartup ? true : false;</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37">   if (!mTargetProfile) {</span>
<a href="#l14.38"></a><span id="l14.38">     GetProfilePath(aStartup, mTargetProfile);</span>
<a href="#l14.39"></a><span id="l14.39">     if (!mTargetProfile) return NS_ERROR_FAILURE;</span>
<a href="#l14.40"></a><span id="l14.40">   }</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineat">@@ -105,17 +105,17 @@ nsSeamonkeyProfileMigrator::Migrate(uint</span>
<a href="#l14.42"></a><span id="l14.42">   }</span>
<a href="#l14.43"></a><span id="l14.43"> </span>
<a href="#l14.44"></a><span id="l14.44">   CopyNextFolder();</span>
<a href="#l14.45"></a><span id="l14.45"> </span>
<a href="#l14.46"></a><span id="l14.46">   return rv;</span>
<a href="#l14.47"></a><span id="l14.47"> }</span>
<a href="#l14.48"></a><span id="l14.48"> </span>
<a href="#l14.49"></a><span id="l14.49"> NS_IMETHODIMP</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-nsSeamonkeyProfileMigrator::GetMigrateData(const PRUnichar* aProfile,</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+nsSeamonkeyProfileMigrator::GetMigrateData(const char16_t* aProfile,</span>
<a href="#l14.52"></a><span id="l14.52">                                            bool aReplace,</span>
<a href="#l14.53"></a><span id="l14.53">                                            uint16_t* aResult)</span>
<a href="#l14.54"></a><span id="l14.54"> {</span>
<a href="#l14.55"></a><span id="l14.55">   *aResult = 0;</span>
<a href="#l14.56"></a><span id="l14.56"> </span>
<a href="#l14.57"></a><span id="l14.57">   if (!mSourceProfile) {</span>
<a href="#l14.58"></a><span id="l14.58">     GetSourceProfile(aProfile);</span>
<a href="#l14.59"></a><span id="l14.59">     if (!mSourceProfile)</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineat">@@ -180,17 +180,17 @@ nsSeamonkeyProfileMigrator::GetSourcePro</span>
<a href="#l14.61"></a><span id="l14.61">   NS_IF_ADDREF(*aResult = mProfileNames);</span>
<a href="#l14.62"></a><span id="l14.62">   return NS_OK;</span>
<a href="#l14.63"></a><span id="l14.63"> }</span>
<a href="#l14.64"></a><span id="l14.64"> </span>
<a href="#l14.65"></a><span id="l14.65"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l14.66"></a><span id="l14.66"> // nsSeamonkeyProfileMigrator</span>
<a href="#l14.67"></a><span id="l14.67"> </span>
<a href="#l14.68"></a><span id="l14.68"> nsresult</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-nsSeamonkeyProfileMigrator::GetSourceProfile(const PRUnichar* aProfile)</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+nsSeamonkeyProfileMigrator::GetSourceProfile(const char16_t* aProfile)</span>
<a href="#l14.71"></a><span id="l14.71"> {</span>
<a href="#l14.72"></a><span id="l14.72">   uint32_t count;</span>
<a href="#l14.73"></a><span id="l14.73">   mProfileNames-&gt;GetLength(&amp;count);</span>
<a href="#l14.74"></a><span id="l14.74">   for (uint32_t i = 0; i &lt; count; ++i) {</span>
<a href="#l14.75"></a><span id="l14.75">     nsCOMPtr&lt;nsISupportsString&gt; str(do_QueryElementAt(mProfileNames, i));</span>
<a href="#l14.76"></a><span id="l14.76">     nsString profileName;</span>
<a href="#l14.77"></a><span id="l14.77">     str-&gt;GetData(profileName);</span>
<a href="#l14.78"></a><span id="l14.78">     if (profileName.Equals(aProfile)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/migration/src/nsSeamonkeyProfileMigrator.h</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/migration/src/nsSeamonkeyProfileMigrator.h</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -18,24 +18,24 @@ class nsSeamonkeyProfileMigrator : publi</span>
<a href="#l15.4"></a><span id="l15.4"> public:</span>
<a href="#l15.5"></a><span id="l15.5">   NS_DECL_ISUPPORTS</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7">   nsSeamonkeyProfileMigrator();</span>
<a href="#l15.8"></a><span id="l15.8">   virtual ~nsSeamonkeyProfileMigrator();</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">   // nsIMailProfileMigrator methods</span>
<a href="#l15.11"></a><span id="l15.11">   NS_IMETHOD Migrate(uint16_t aItems, nsIProfileStartup* aStartup,</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-                        const PRUnichar* aProfile);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  NS_IMETHOD GetMigrateData(const PRUnichar* aProfile, bool aReplace,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+                        const char16_t* aProfile);</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+  NS_IMETHOD GetMigrateData(const char16_t* aProfile, bool aReplace,</span>
<a href="#l15.16"></a><span id="l15.16">                             uint16_t* aResult);</span>
<a href="#l15.17"></a><span id="l15.17">   NS_IMETHOD GetSourceProfiles(nsIArray** aResult);</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19"> protected:</span>
<a href="#l15.20"></a><span id="l15.20">   nsresult FillProfileDataFromSeamonkeyRegistry();</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-  nsresult GetSourceProfile(const PRUnichar* aProfile);</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+  nsresult GetSourceProfile(const char16_t* aProfile);</span>
<a href="#l15.23"></a><span id="l15.23"> </span>
<a href="#l15.24"></a><span id="l15.24">   nsresult CopyPreferences(bool aReplace);</span>
<a href="#l15.25"></a><span id="l15.25">   nsresult TransformPreferences(const nsAString&amp; aSourcePrefFileName,</span>
<a href="#l15.26"></a><span id="l15.26">                                 const nsAString&amp; aTargetPrefFileName);</span>
<a href="#l15.27"></a><span id="l15.27"> </span>
<a href="#l15.28"></a><span id="l15.28">   nsresult DummyCopyRoutine(bool aReplace);</span>
<a href="#l15.29"></a><span id="l15.29">   nsresult CopyJunkTraining(bool aReplace);  </span>
<a href="#l15.30"></a><span id="l15.30">   nsresult CopyPasswords(bool aReplace);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/components/shell/nsMailWinIntegration.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/components/shell/nsMailWinIntegration.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -229,17 +229,17 @@ nsWindowsShellService::ShortcutMaintenan</span>
<a href="#l16.4"></a><span id="l16.4">   params.AssignLiteral(&quot; /UpdateShortcutAppUserModelIds&quot;);</span>
<a href="#l16.5"></a><span id="l16.5">   return LaunchHelper(appHelperPath, params);</span>
<a href="#l16.6"></a><span id="l16.6"> }</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> nsresult nsWindowsShellService::Init()</span>
<a href="#l16.9"></a><span id="l16.9"> {</span>
<a href="#l16.10"></a><span id="l16.10">   nsresult rv;</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  PRUnichar appPath[MAX_BUF];</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  char16_t appPath[MAX_BUF];</span>
<a href="#l16.14"></a><span id="l16.14">   if (!::GetModuleFileNameW(0, appPath, MAX_BUF))</span>
<a href="#l16.15"></a><span id="l16.15">     return NS_ERROR_FAILURE;</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17">   // Convert the path to a long path since GetModuleFileNameW returns the path</span>
<a href="#l16.18"></a><span id="l16.18">   // that was used to launch the app which is not necessarily a long path.</span>
<a href="#l16.19"></a><span id="l16.19">   if (!::GetLongPathNameW(appPath, appPath, MAX_BUF))</span>
<a href="#l16.20"></a><span id="l16.20">     return NS_ERROR_FAILURE;</span>
<a href="#l16.21"></a><span id="l16.21"> </span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -335,17 +335,17 @@ nsWindowsShellService::SetShouldCheckDef</span>
<a href="#l16.23"></a><span id="l16.23">   return prefs-&gt;SetBoolPref(&quot;mail.shell.checkDefaultClient&quot;, aShouldCheck);</span>
<a href="#l16.24"></a><span id="l16.24"> }</span>
<a href="#l16.25"></a><span id="l16.25"> </span>
<a href="#l16.26"></a><span id="l16.26"> /* helper routine. Iterate over the passed in settings object. */</span>
<a href="#l16.27"></a><span id="l16.27"> bool</span>
<a href="#l16.28"></a><span id="l16.28"> nsWindowsShellService::TestForDefault(SETTING aSettings[], int32_t aSize)</span>
<a href="#l16.29"></a><span id="l16.29"> {</span>
<a href="#l16.30"></a><span id="l16.30">   bool isDefault = true;</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-  PRUnichar currValue[MAX_BUF];</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+  char16_t currValue[MAX_BUF];</span>
<a href="#l16.33"></a><span id="l16.33">   SETTING* end = aSettings + aSize;</span>
<a href="#l16.34"></a><span id="l16.34">   for (SETTING * settings = aSettings; settings &lt; end; ++settings)</span>
<a href="#l16.35"></a><span id="l16.35">   {</span>
<a href="#l16.36"></a><span id="l16.36">     NS_ConvertUTF8toUTF16 dataLongPath(settings-&gt;valueData);</span>
<a href="#l16.37"></a><span id="l16.37">     NS_ConvertUTF8toUTF16 key(settings-&gt;keyName);</span>
<a href="#l16.38"></a><span id="l16.38">     NS_ConvertUTF8toUTF16 value(settings-&gt;valueName);</span>
<a href="#l16.39"></a><span id="l16.39">     if (settings-&gt;flags &amp; APP_PATH_SUBSTITUTION)</span>
<a href="#l16.40"></a><span id="l16.40">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbAddressCollector.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbAddressCollector.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -272,17 +272,17 @@ nsAbAddressCollector::SplitFullName(cons</span>
<a href="#l17.4"></a><span id="l17.4">     aLastName = Substring(aFullName, index + 1);</span>
<a href="#l17.5"></a><span id="l17.5">     aFirstName = Substring(aFullName, 0, index);</span>
<a href="#l17.6"></a><span id="l17.6">   }</span>
<a href="#l17.7"></a><span id="l17.7"> }</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9"> // Observes the collected address book pref in case it changes.</span>
<a href="#l17.10"></a><span id="l17.10"> NS_IMETHODIMP</span>
<a href="#l17.11"></a><span id="l17.11"> nsAbAddressCollector::Observe(nsISupports *aSubject, const char *aTopic,</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-                              const PRUnichar *aData)</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+                              const char16_t *aData)</span>
<a href="#l17.14"></a><span id="l17.14"> {</span>
<a href="#l17.15"></a><span id="l17.15">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_QueryInterface(aSubject);</span>
<a href="#l17.16"></a><span id="l17.16">   if (!prefBranch) {</span>
<a href="#l17.17"></a><span id="l17.17">     NS_ASSERTION(prefBranch, &quot;failed to get prefs&quot;);</span>
<a href="#l17.18"></a><span id="l17.18">     return NS_OK;</span>
<a href="#l17.19"></a><span id="l17.19">   }</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21">   SetUpAbFromPrefs(prefBranch);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbBooleanExpression.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbBooleanExpression.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -51,26 +51,26 @@ NS_IMETHODIMP nsAbBooleanConditionString</span>
<a href="#l18.4"></a><span id="l18.4">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">     mName = aName;</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8">     return NS_OK;</span>
<a href="#l18.9"></a><span id="l18.9"> }</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11"> /* attribute wstring value; */</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-NS_IMETHODIMP nsAbBooleanConditionString::GetValue(PRUnichar** aValue)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+NS_IMETHODIMP nsAbBooleanConditionString::GetValue(char16_t** aValue)</span>
<a href="#l18.14"></a><span id="l18.14"> {</span>
<a href="#l18.15"></a><span id="l18.15">     if (!aValue)</span>
<a href="#l18.16"></a><span id="l18.16">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18">     *aValue = ToNewUnicode(mValue);</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20">     return NS_OK;</span>
<a href="#l18.21"></a><span id="l18.21"> }</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">-NS_IMETHODIMP nsAbBooleanConditionString::SetValue(const PRUnichar * aValue)</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+NS_IMETHODIMP nsAbBooleanConditionString::SetValue(const char16_t * aValue)</span>
<a href="#l18.24"></a><span id="l18.24"> {</span>
<a href="#l18.25"></a><span id="l18.25">     if (!aValue)</span>
<a href="#l18.26"></a><span id="l18.26">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28">     mValue = aValue;</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30">     return NS_OK;</span>
<a href="#l18.31"></a><span id="l18.31"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -495,17 +495,17 @@ NS_IMETHODIMP nsAbCardProperty::Translat</span>
<a href="#l19.4"></a><span id="l19.4">     return NS_OK;</span>
<a href="#l19.5"></a><span id="l19.5">   }</span>
<a href="#l19.6"></a><span id="l19.6">   else if (type.EqualsLiteral(&quot;vcard&quot;))</span>
<a href="#l19.7"></a><span id="l19.7">     return ConvertToEscapedVCard(result);</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">   return NS_ERROR_ILLEGAL_VALUE;</span>
<a href="#l19.10"></a><span id="l19.10"> }</span>
<a href="#l19.11"></a><span id="l19.11"> //</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-static VObject* myAddPropValue(VObject *o, const char *propName, const PRUnichar *propValue, bool *aCardHasData)</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+static VObject* myAddPropValue(VObject *o, const char *propName, const char16_t *propValue, bool *aCardHasData)</span>
<a href="#l19.14"></a><span id="l19.14"> {</span>
<a href="#l19.15"></a><span id="l19.15">     if (aCardHasData)</span>
<a href="#l19.16"></a><span id="l19.16">         *aCardHasData = true;</span>
<a href="#l19.17"></a><span id="l19.17">     return addPropValue(o, propName, NS_ConvertUTF16toUTF8(propValue).get());</span>
<a href="#l19.18"></a><span id="l19.18"> }</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20"> nsresult nsAbCardProperty::ConvertToEscapedVCard(nsACString &amp;aResult)</span>
<a href="#l19.21"></a><span id="l19.21"> {</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -953,29 +953,29 @@ nsresult nsAbCardProperty::AppendLine(co</span>
<a href="#l19.23"></a><span id="l19.23">   NS_ENSURE_ARG_POINTER(aConv);</span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25">   nsString attrValue;</span>
<a href="#l19.26"></a><span id="l19.26">   nsresult rv = GetPropertyAsAString(aItem.mColumn, attrValue);</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">   if (NS_FAILED(rv) || attrValue.IsEmpty())</span>
<a href="#l19.29"></a><span id="l19.29">     return NS_OK;</span>
<a href="#l19.30"></a><span id="l19.30"> </span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-  aResult.Append(PRUnichar('&lt;'));</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+  aResult.Append(char16_t('&lt;'));</span>
<a href="#l19.33"></a><span id="l19.33">   aResult.Append(NS_ConvertUTF8toUTF16(aItem.mColumn));</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-  aResult.Append(PRUnichar('&gt;'));</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+  aResult.Append(char16_t('&gt;'));</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37">   // use ScanTXT to convert &lt; &gt; &amp; to safe values.</span>
<a href="#l19.38"></a><span id="l19.38">   nsString safeText;</span>
<a href="#l19.39"></a><span id="l19.39">   rv = aConv-&gt;ScanTXT(attrValue.get(), mozITXTToHTMLConv::kEntities, getter_Copies(safeText));</span>
<a href="#l19.40"></a><span id="l19.40">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.41"></a><span id="l19.41">   aResult.Append(safeText);</span>
<a href="#l19.42"></a><span id="l19.42"> </span>
<a href="#l19.43"></a><span id="l19.43">   aResult.AppendLiteral(&quot;&lt;/&quot;);</span>
<a href="#l19.44"></a><span id="l19.44">   aResult.Append(NS_ConvertUTF8toUTF16(aItem.mColumn));</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineminus">-  aResult.Append(PRUnichar('&gt;'));</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+  aResult.Append(char16_t('&gt;'));</span>
<a href="#l19.47"></a><span id="l19.47"> </span>
<a href="#l19.48"></a><span id="l19.48">   return NS_OK;</span>
<a href="#l19.49"></a><span id="l19.49"> }</span>
<a href="#l19.50"></a><span id="l19.50"> </span>
<a href="#l19.51"></a><span id="l19.51"> nsresult nsAbCardProperty::AppendLabel(const AppendItem &amp;aItem,</span>
<a href="#l19.52"></a><span id="l19.52">                                        nsIStringBundle *aBundle,</span>
<a href="#l19.53"></a><span id="l19.53">                                        mozITXTToHTMLConv *aConv,</span>
<a href="#l19.54"></a><span id="l19.54">                                        nsString &amp;aResult)</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineat">@@ -1040,28 +1040,28 @@ nsresult nsAbCardProperty::AppendCitySta</span>
<a href="#l19.56"></a><span id="l19.56">   item.mColumn = zipPropName;</span>
<a href="#l19.57"></a><span id="l19.57"> </span>
<a href="#l19.58"></a><span id="l19.58">   rv = AppendLine(item, aConv, zipResult);</span>
<a href="#l19.59"></a><span id="l19.59">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.60"></a><span id="l19.60"> </span>
<a href="#l19.61"></a><span id="l19.61">   nsString formattedString;</span>
<a href="#l19.62"></a><span id="l19.62"> </span>
<a href="#l19.63"></a><span id="l19.63">   if (!cityResult.IsEmpty() &amp;&amp; !stateResult.IsEmpty() &amp;&amp; !zipResult.IsEmpty()) {</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineminus">-    const PRUnichar *formatStrings[] = { cityResult.get(), stateResult.get(), zipResult.get() };</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineplus">+    const char16_t *formatStrings[] = { cityResult.get(), stateResult.get(), zipResult.get() };</span>
<a href="#l19.66"></a><span id="l19.66">     rv = aBundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;cityAndStateAndZip&quot;), formatStrings, ArrayLength(formatStrings), getter_Copies(formattedString));</span>
<a href="#l19.67"></a><span id="l19.67">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.68"></a><span id="l19.68">   }</span>
<a href="#l19.69"></a><span id="l19.69">   else if (!cityResult.IsEmpty() &amp;&amp; !stateResult.IsEmpty() &amp;&amp; zipResult.IsEmpty()) {</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineminus">-    const PRUnichar *formatStrings[] = { cityResult.get(), stateResult.get() };</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineplus">+    const char16_t *formatStrings[] = { cityResult.get(), stateResult.get() };</span>
<a href="#l19.72"></a><span id="l19.72">     rv = aBundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;cityAndStateNoZip&quot;), formatStrings, ArrayLength(formatStrings), getter_Copies(formattedString));</span>
<a href="#l19.73"></a><span id="l19.73">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.74"></a><span id="l19.74">   }</span>
<a href="#l19.75"></a><span id="l19.75">   else if ((!cityResult.IsEmpty() &amp;&amp; stateResult.IsEmpty() &amp;&amp; !zipResult.IsEmpty()) ||</span>
<a href="#l19.76"></a><span id="l19.76">           (cityResult.IsEmpty() &amp;&amp; !stateResult.IsEmpty() &amp;&amp; !zipResult.IsEmpty())) {</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineminus">-    const PRUnichar *formatStrings[] = { cityResult.IsEmpty() ? stateResult.get() : cityResult.get(), zipResult.get() };</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineplus">+    const char16_t *formatStrings[] = { cityResult.IsEmpty() ? stateResult.get() : cityResult.get(), zipResult.get() };</span>
<a href="#l19.79"></a><span id="l19.79">     rv = aBundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;cityOrStateAndZip&quot;), formatStrings, ArrayLength(formatStrings), getter_Copies(formattedString));</span>
<a href="#l19.80"></a><span id="l19.80">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.81"></a><span id="l19.81">   }</span>
<a href="#l19.82"></a><span id="l19.82">   else {</span>
<a href="#l19.83"></a><span id="l19.83">     if (!cityResult.IsEmpty())</span>
<a href="#l19.84"></a><span id="l19.84">       formattedString = cityResult;</span>
<a href="#l19.85"></a><span id="l19.85">     else if (!stateResult.IsEmpty())</span>
<a href="#l19.86"></a><span id="l19.86">       formattedString = stateResult;</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineat">@@ -1104,23 +1104,23 @@ NS_IMETHODIMP nsAbCardProperty::Generate</span>
<a href="#l19.88"></a><span id="l19.88">       rv = stringBundleService-&gt;CreateBundle(sAddrbookProperties,</span>
<a href="#l19.89"></a><span id="l19.89">                                              getter_AddRefs(bundle));</span>
<a href="#l19.90"></a><span id="l19.90">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.91"></a><span id="l19.91">     }</span>
<a href="#l19.92"></a><span id="l19.92"> </span>
<a href="#l19.93"></a><span id="l19.93">     nsString result;</span>
<a href="#l19.94"></a><span id="l19.94"> </span>
<a href="#l19.95"></a><span id="l19.95">     if (aGenerateFormat == GENERATE_LAST_FIRST_ORDER) {</span>
<a href="#l19.96"></a><span id="l19.96" class="difflineminus">-      const PRUnichar *stringParams[2] = {lastName.get(), firstName.get()};</span>
<a href="#l19.97"></a><span id="l19.97" class="difflineplus">+      const char16_t *stringParams[2] = {lastName.get(), firstName.get()};</span>
<a href="#l19.98"></a><span id="l19.98"> </span>
<a href="#l19.99"></a><span id="l19.99">       rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;lastFirstFormat&quot;),</span>
<a href="#l19.100"></a><span id="l19.100">                                         stringParams, 2, getter_Copies(result));</span>
<a href="#l19.101"></a><span id="l19.101">     }</span>
<a href="#l19.102"></a><span id="l19.102">     else {</span>
<a href="#l19.103"></a><span id="l19.103" class="difflineminus">-      const PRUnichar *stringParams[2] = {firstName.get(), lastName.get()};</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineplus">+      const char16_t *stringParams[2] = {firstName.get(), lastName.get()};</span>
<a href="#l19.105"></a><span id="l19.105"> </span>
<a href="#l19.106"></a><span id="l19.106">       rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;firstLastFormat&quot;),</span>
<a href="#l19.107"></a><span id="l19.107">                                         stringParams, 2, getter_Copies(result));</span>
<a href="#l19.108"></a><span id="l19.108">     }</span>
<a href="#l19.109"></a><span id="l19.109">     NS_ENSURE_SUCCESS(rv, rv); </span>
<a href="#l19.110"></a><span id="l19.110"> </span>
<a href="#l19.111"></a><span id="l19.111">     aResult.Assign(result);</span>
<a href="#l19.112"></a><span id="l19.112">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbDirectoryQuery.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbDirectoryQuery.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -159,17 +159,17 @@ NS_IMETHODIMP nsAbDirectoryQueryArgument</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> NS_IMPL_ISUPPORTS1(nsAbDirectoryQueryPropertyValue, nsIAbDirectoryQueryPropertyValue)</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> nsAbDirectoryQueryPropertyValue::nsAbDirectoryQueryPropertyValue()</span>
<a href="#l20.8"></a><span id="l20.8"> {</span>
<a href="#l20.9"></a><span id="l20.9"> }</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11"> nsAbDirectoryQueryPropertyValue::nsAbDirectoryQueryPropertyValue(const char* aName,</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-      const PRUnichar* aValue)</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+      const char16_t* aValue)</span>
<a href="#l20.14"></a><span id="l20.14"> {</span>
<a href="#l20.15"></a><span id="l20.15">     mName = aName;</span>
<a href="#l20.16"></a><span id="l20.16">     mValue = aValue;</span>
<a href="#l20.17"></a><span id="l20.17"> }</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19"> nsAbDirectoryQueryPropertyValue::nsAbDirectoryQueryPropertyValue(const char* aName,</span>
<a href="#l20.20"></a><span id="l20.20">       nsISupports* aValueISupports)</span>
<a href="#l20.21"></a><span id="l20.21"> {</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -185,17 +185,17 @@ nsAbDirectoryQueryPropertyValue::~nsAbDi</span>
<a href="#l20.23"></a><span id="l20.23"> NS_IMETHODIMP nsAbDirectoryQueryPropertyValue::GetName(char*  *aName)</span>
<a href="#l20.24"></a><span id="l20.24"> {</span>
<a href="#l20.25"></a><span id="l20.25">     *aName = mName.IsEmpty() ? 0 : ToNewCString(mName);</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27">     return NS_OK;</span>
<a href="#l20.28"></a><span id="l20.28"> }</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30"> /* read only attribute wstring value; */</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-NS_IMETHODIMP nsAbDirectoryQueryPropertyValue::GetValue(PRUnichar*  *aValue)</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+NS_IMETHODIMP nsAbDirectoryQueryPropertyValue::GetValue(char16_t*  *aValue)</span>
<a href="#l20.33"></a><span id="l20.33"> {</span>
<a href="#l20.34"></a><span id="l20.34">     *aValue = ToNewUnicode(mValue);</span>
<a href="#l20.35"></a><span id="l20.35">     if (!(*aValue)) </span>
<a href="#l20.36"></a><span id="l20.36">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l20.37"></a><span id="l20.37">     else</span>
<a href="#l20.38"></a><span id="l20.38">         return NS_OK;</span>
<a href="#l20.39"></a><span id="l20.39"> }</span>
<a href="#l20.40"></a><span id="l20.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbDirectoryQuery.h</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbDirectoryQuery.h</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -48,17 +48,17 @@ protected:</span>
<a href="#l21.4"></a><span id="l21.4"> class nsAbDirectoryQueryPropertyValue : public nsIAbDirectoryQueryPropertyValue</span>
<a href="#l21.5"></a><span id="l21.5"> {</span>
<a href="#l21.6"></a><span id="l21.6"> public:</span>
<a href="#l21.7"></a><span id="l21.7">     NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l21.8"></a><span id="l21.8">     NS_DECL_NSIABDIRECTORYQUERYPROPERTYVALUE</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10">     nsAbDirectoryQueryPropertyValue();</span>
<a href="#l21.11"></a><span id="l21.11">     nsAbDirectoryQueryPropertyValue(const char* aName,</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-          const PRUnichar* aValue);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+          const char16_t* aValue);</span>
<a href="#l21.14"></a><span id="l21.14">     nsAbDirectoryQueryPropertyValue(const char* aName,</span>
<a href="#l21.15"></a><span id="l21.15">           nsISupports* aValueISupports);</span>
<a href="#l21.16"></a><span id="l21.16">     virtual ~nsAbDirectoryQueryPropertyValue();</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18"> protected:</span>
<a href="#l21.19"></a><span id="l21.19">     nsCString mName;</span>
<a href="#l21.20"></a><span id="l21.20">     nsString mValue;</span>
<a href="#l21.21"></a><span id="l21.21">     nsCOMPtr&lt;nsISupports&gt; mValueISupports;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -123,24 +123,24 @@ NS_IMETHODIMP nsAbLDAPListenerBase::OnLD</span>
<a href="#l22.4"></a><span id="l22.4">       return rv;</span>
<a href="#l22.5"></a><span id="l22.5">     }</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7">     // hostTemp is only necessary to work around a code-generation </span>
<a href="#l22.8"></a><span id="l22.8">     // bug in egcs 1.1.2 (the version of gcc that comes with Red Hat 6.2),</span>
<a href="#l22.9"></a><span id="l22.9">     // which is the default compiler for Mozilla on linux at the moment.</span>
<a href="#l22.10"></a><span id="l22.10">     //</span>
<a href="#l22.11"></a><span id="l22.11">     NS_ConvertASCIItoUTF16 hostTemp(host);</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    const PRUnichar *hostArray[1] = { hostTemp.get() };</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+    const char16_t *hostArray[1] = { hostTemp.get() };</span>
<a href="#l22.14"></a><span id="l22.14"> </span>
<a href="#l22.15"></a><span id="l22.15">     // format the hostname into the authprompt text string</span>
<a href="#l22.16"></a><span id="l22.16">     //</span>
<a href="#l22.17"></a><span id="l22.17">     nsString authPromptText;</span>
<a href="#l22.18"></a><span id="l22.18">     rv = ldapBundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;authPromptText&quot;),</span>
<a href="#l22.19"></a><span id="l22.19">                                           hostArray,</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-                                          sizeof(hostArray) / sizeof(const PRUnichar *),</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+                                          sizeof(hostArray) / sizeof(const char16_t *),</span>
<a href="#l22.22"></a><span id="l22.22">                                           getter_Copies(authPromptText));</span>
<a href="#l22.23"></a><span id="l22.23">     if (NS_FAILED(rv))</span>
<a href="#l22.24"></a><span id="l22.24">     {</span>
<a href="#l22.25"></a><span id="l22.25">       NS_ERROR(&quot;nsAbLDAPListenerBase::OnLDAPInit():&quot;</span>
<a href="#l22.26"></a><span id="l22.26">                &quot;error getting 'authPromptText' string from bundle &quot;</span>
<a href="#l22.27"></a><span id="l22.27">                &quot;chrome://mozldap/locale/ldap.properties&quot;);</span>
<a href="#l22.28"></a><span id="l22.28">       InitFailed();</span>
<a href="#l22.29"></a><span id="l22.29">       return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -210,17 +210,17 @@ nsresult nsAbMDBDirectory::NotifyItemCha</span>
<a href="#l23.4"></a><span id="l23.4">   nsCOMPtr&lt;nsIAbManager&gt; abManager = do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l23.5"></a><span id="l23.5">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7">   rv = abManager-&gt;NotifyItemPropertyChanged(item, nullptr, nullptr, nullptr);</span>
<a href="#l23.8"></a><span id="l23.8">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.9"></a><span id="l23.9">   return rv;</span>
<a href="#l23.10"></a><span id="l23.10"> }</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-nsresult nsAbMDBDirectory::NotifyPropertyChanged(nsIAbDirectory *list, const char *property, const PRUnichar* oldValue, const PRUnichar* newValue)</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+nsresult nsAbMDBDirectory::NotifyPropertyChanged(nsIAbDirectory *list, const char *property, const char16_t* oldValue, const char16_t* newValue)</span>
<a href="#l23.14"></a><span id="l23.14"> {</span>
<a href="#l23.15"></a><span id="l23.15">   nsresult rv;</span>
<a href="#l23.16"></a><span id="l23.16">   nsCOMPtr&lt;nsISupports&gt; supports = do_QueryInterface(list, &amp;rv);</span>
<a href="#l23.17"></a><span id="l23.17">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19">   nsCOMPtr&lt;nsIAbManager&gt; abManager = do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l23.20"></a><span id="l23.20">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.21"></a><span id="l23.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.h</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.h</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -78,17 +78,17 @@ public:</span>
<a href="#l24.4"></a><span id="l24.4"> </span>
<a href="#l24.5"></a><span id="l24.5">   // nsIAbDirectorySearch methods</span>
<a href="#l24.6"></a><span id="l24.6">   NS_DECL_NSIABDIRECTORYSEARCH</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8">   // nsIAbDirSearchListener methods</span>
<a href="#l24.9"></a><span id="l24.9">   NS_DECL_NSIABDIRSEARCHLISTENER</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11"> protected:</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  nsresult NotifyPropertyChanged(nsIAbDirectory *list, const char *property, const PRUnichar* oldValue, const PRUnichar* newValue);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+  nsresult NotifyPropertyChanged(nsIAbDirectory *list, const char *property, const char16_t* oldValue, const char16_t* newValue);</span>
<a href="#l24.14"></a><span id="l24.14">   nsresult NotifyItemAdded(nsISupports *item);</span>
<a href="#l24.15"></a><span id="l24.15">   nsresult NotifyItemDeleted(nsISupports *item);</span>
<a href="#l24.16"></a><span id="l24.16">   nsresult NotifyItemChanged(nsISupports *item);</span>
<a href="#l24.17"></a><span id="l24.17">   nsresult RemoveCardFromAddressList(nsIAbCard* card);</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19">   nsresult GetAbDatabase();</span>
<a href="#l24.20"></a><span id="l24.20">   nsCOMPtr&lt;nsIAddrDatabase&gt; mDatabase;  </span>
<a href="#l24.21"></a><span id="l24.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -145,17 +145,17 @@ nsresult nsAbManager::Init()</span>
<a href="#l25.4"></a><span id="l25.4">   rv = observerService-&gt;AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID,</span>
<a href="#l25.5"></a><span id="l25.5">                                     false);</span>
<a href="#l25.6"></a><span id="l25.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8">   return NS_OK;</span>
<a href="#l25.9"></a><span id="l25.9"> }</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11"> NS_IMETHODIMP nsAbManager::Observe(nsISupports *aSubject, const char *aTopic,</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-                                   const PRUnichar *someData)</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+                                   const char16_t *someData)</span>
<a href="#l25.14"></a><span id="l25.14"> {</span>
<a href="#l25.15"></a><span id="l25.15">   // The nsDirPrefs code caches all the directories that it got</span>
<a href="#l25.16"></a><span id="l25.16">   // from the first profiles prefs.js.</span>
<a href="#l25.17"></a><span id="l25.17">   // When we profile switch, we need to force it to shut down.</span>
<a href="#l25.18"></a><span id="l25.18">   // We'll re-load all the directories from the second profiles prefs.js</span>
<a href="#l25.19"></a><span id="l25.19">   // that happens in nsAbBSDirectory::GetChildNodes()</span>
<a href="#l25.20"></a><span id="l25.20">   // when we call DIR_GetDirectories().</span>
<a href="#l25.21"></a><span id="l25.21">   if (!strcmp(aTopic, &quot;profile-do-change&quot;))</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -382,18 +382,18 @@ NS_IMETHODIMP nsAbManager::RemoveAddress</span>
<a href="#l25.23"></a><span id="l25.23">     const abListener &amp;abL = iter.GetNext();                            \</span>
<a href="#l25.24"></a><span id="l25.24">     if (abL.mNotifyFlags &amp; nsIAbListener::propertyflag_)               \</span>
<a href="#l25.25"></a><span id="l25.25">       abL.mListener-&gt;propertyfunc_ params_;                            \</span>
<a href="#l25.26"></a><span id="l25.26">   }                                                                    \</span>
<a href="#l25.27"></a><span id="l25.27">   PR_END_MACRO</span>
<a href="#l25.28"></a><span id="l25.28"> </span>
<a href="#l25.29"></a><span id="l25.29"> NS_IMETHODIMP nsAbManager::NotifyItemPropertyChanged(nsISupports *aItem,</span>
<a href="#l25.30"></a><span id="l25.30">                                                      const char *aProperty,</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-                                                     const PRUnichar* aOldValue,</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-                                                     const PRUnichar* aNewValue)</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+                                                     const char16_t* aOldValue,</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+                                                     const char16_t* aNewValue)</span>
<a href="#l25.35"></a><span id="l25.35"> {</span>
<a href="#l25.36"></a><span id="l25.36">   NOTIFY_AB_LISTENERS(itemChanged, OnItemPropertyChanged,</span>
<a href="#l25.37"></a><span id="l25.37">                       (aItem, aProperty, aOldValue, aNewValue));</span>
<a href="#l25.38"></a><span id="l25.38">   return NS_OK;</span>
<a href="#l25.39"></a><span id="l25.39"> }</span>
<a href="#l25.40"></a><span id="l25.40"> </span>
<a href="#l25.41"></a><span id="l25.41"> NS_IMETHODIMP nsAbManager::NotifyDirectoryItemAdded(nsIAbDirectory *aParentDirectory,</span>
<a href="#l25.42"></a><span id="l25.42">                                                     nsISupports *aItem)</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineat">@@ -428,17 +428,17 @@ NS_IMETHODIMP nsAbManager::GetUserProfil</span>
<a href="#l25.44"></a><span id="l25.44">   nsAutoCString pathBuf;</span>
<a href="#l25.45"></a><span id="l25.45"> </span>
<a href="#l25.46"></a><span id="l25.46">   rv = NS_GetSpecialDirectory(NS_APP_USER_PROFILE_50_DIR, getter_AddRefs(profileDir));</span>
<a href="#l25.47"></a><span id="l25.47">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.48"></a><span id="l25.48"> </span>
<a href="#l25.49"></a><span id="l25.49">   return CallQueryInterface(profileDir, userDir);</span>
<a href="#l25.50"></a><span id="l25.50"> }</span>
<a href="#l25.51"></a><span id="l25.51"> </span>
<a href="#l25.52"></a><span id="l25.52" class="difflineminus">-NS_IMETHODIMP nsAbManager::MailListNameExists(const PRUnichar *name, bool *exist)</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineplus">+NS_IMETHODIMP nsAbManager::MailListNameExists(const char16_t *name, bool *exist)</span>
<a href="#l25.54"></a><span id="l25.54"> {</span>
<a href="#l25.55"></a><span id="l25.55">   nsresult rv;</span>
<a href="#l25.56"></a><span id="l25.56">   NS_ENSURE_ARG_POINTER(exist);</span>
<a href="#l25.57"></a><span id="l25.57"> </span>
<a href="#l25.58"></a><span id="l25.58">   *exist = false;</span>
<a href="#l25.59"></a><span id="l25.59"> </span>
<a href="#l25.60"></a><span id="l25.60">   // now get the top-level book</span>
<a href="#l25.61"></a><span id="l25.61">   nsCOMPtr&lt;nsIAbDirectory&gt; topDirectory;</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineat">@@ -1053,38 +1053,38 @@ nsresult nsAbManager::AppendBasicLDIFFor</span>
<a href="#l25.63"></a><span id="l25.63">     &quot;objectclass: top&quot; MSG_LINEBREAK \</span>
<a href="#l25.64"></a><span id="l25.64">     &quot;objectclass: person&quot; MSG_LINEBREAK \</span>
<a href="#l25.65"></a><span id="l25.65">     &quot;objectclass: organizationalPerson&quot; MSG_LINEBREAK \</span>
<a href="#l25.66"></a><span id="l25.66">     &quot;objectclass: inetOrgPerson&quot; MSG_LINEBREAK \</span>
<a href="#l25.67"></a><span id="l25.67">     &quot;objectclass: &quot; MOZ_AB_OBJECTCLASS MSG_LINEBREAK;</span>
<a href="#l25.68"></a><span id="l25.68">   return rv;</span>
<a href="#l25.69"></a><span id="l25.69"> }</span>
<a href="#l25.70"></a><span id="l25.70"> </span>
<a href="#l25.71"></a><span id="l25.71" class="difflineminus">-bool nsAbManager::IsSafeLDIFString(const PRUnichar *aStr)</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineplus">+bool nsAbManager::IsSafeLDIFString(const char16_t *aStr)</span>
<a href="#l25.73"></a><span id="l25.73"> {</span>
<a href="#l25.74"></a><span id="l25.74">   // follow RFC 2849 to determine if something is safe &quot;as is&quot; for LDIF</span>
<a href="#l25.75"></a><span id="l25.75" class="difflineminus">-  if (aStr[0] == PRUnichar(' ') ||</span>
<a href="#l25.76"></a><span id="l25.76" class="difflineminus">-      aStr[0] == PRUnichar(':') ||</span>
<a href="#l25.77"></a><span id="l25.77" class="difflineminus">-      aStr[0] == PRUnichar('&lt;'))</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineplus">+  if (aStr[0] == char16_t(' ') ||</span>
<a href="#l25.79"></a><span id="l25.79" class="difflineplus">+      aStr[0] == char16_t(':') ||</span>
<a href="#l25.80"></a><span id="l25.80" class="difflineplus">+      aStr[0] == char16_t('&lt;'))</span>
<a href="#l25.81"></a><span id="l25.81">     return false;</span>
<a href="#l25.82"></a><span id="l25.82"> </span>
<a href="#l25.83"></a><span id="l25.83">   uint32_t i;</span>
<a href="#l25.84"></a><span id="l25.84">   uint32_t len = NS_strlen(aStr);</span>
<a href="#l25.85"></a><span id="l25.85">   for (i=0; i&lt;len; i++) {</span>
<a href="#l25.86"></a><span id="l25.86">     // If string contains CR or LF, it is not safe for LDIF</span>
<a href="#l25.87"></a><span id="l25.87">     // and MUST be base64 encoded</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineminus">-    if ((aStr[i] == PRUnichar('\n')) ||</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineminus">-        (aStr[i] == PRUnichar('\r')) ||</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineplus">+    if ((aStr[i] == char16_t('\n')) ||</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineplus">+        (aStr[i] == char16_t('\r')) ||</span>
<a href="#l25.92"></a><span id="l25.92">         (!NS_IsAscii(aStr[i])))</span>
<a href="#l25.93"></a><span id="l25.93">       return false;</span>
<a href="#l25.94"></a><span id="l25.94">   }</span>
<a href="#l25.95"></a><span id="l25.95">   return true;</span>
<a href="#l25.96"></a><span id="l25.96"> }</span>
<a href="#l25.97"></a><span id="l25.97"> </span>
<a href="#l25.98"></a><span id="l25.98" class="difflineminus">-nsresult nsAbManager::AppendProperty(const char *aProperty, const PRUnichar *aValue, nsACString &amp;aResult)</span>
<a href="#l25.99"></a><span id="l25.99" class="difflineplus">+nsresult nsAbManager::AppendProperty(const char *aProperty, const char16_t *aValue, nsACString &amp;aResult)</span>
<a href="#l25.100"></a><span id="l25.100"> {</span>
<a href="#l25.101"></a><span id="l25.101">   NS_ENSURE_ARG_POINTER(aValue);</span>
<a href="#l25.102"></a><span id="l25.102"> </span>
<a href="#l25.103"></a><span id="l25.103">   aResult += aProperty;</span>
<a href="#l25.104"></a><span id="l25.104"> </span>
<a href="#l25.105"></a><span id="l25.105">   // if the string is not safe &quot;as is&quot;, base64 encode it</span>
<a href="#l25.106"></a><span id="l25.106">   if (IsSafeLDIFString(aValue)) {</span>
<a href="#l25.107"></a><span id="l25.107">     aResult.AppendLiteral(&quot;: &quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.h</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.h</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -35,18 +35,18 @@ public:</span>
<a href="#l26.4"></a><span id="l26.4"> </span>
<a href="#l26.5"></a><span id="l26.5"> private:</span>
<a href="#l26.6"></a><span id="l26.6">   nsresult GetRootDirectory(nsIAbDirectory **aResult);</span>
<a href="#l26.7"></a><span id="l26.7">   nsresult ExportDirectoryToDelimitedText(nsIAbDirectory *aDirectory, const char *aDelim, uint32_t aDelimLen, nsIFile *aLocalFile);</span>
<a href="#l26.8"></a><span id="l26.8">   nsresult ExportDirectoryToLDIF(nsIAbDirectory *aDirectory, nsIFile *aLocalFile);</span>
<a href="#l26.9"></a><span id="l26.9">   nsresult AppendLDIFForMailList(nsIAbCard *aCard, nsIAbLDAPAttributeMap *aAttrMap, nsACString &amp;aResult);</span>
<a href="#l26.10"></a><span id="l26.10">   nsresult AppendDNForCard(const char *aProperty, nsIAbCard *aCard, nsIAbLDAPAttributeMap *aAttrMap, nsACString &amp;aResult);</span>
<a href="#l26.11"></a><span id="l26.11">   nsresult AppendBasicLDIFForCard(nsIAbCard *aCard, nsIAbLDAPAttributeMap *aAttrMap, nsACString &amp;aResult);</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  nsresult AppendProperty(const char *aProperty, const PRUnichar *aValue, nsACString &amp;aResult);</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  bool IsSafeLDIFString(const PRUnichar *aStr);</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+  nsresult AppendProperty(const char *aProperty, const char16_t *aValue, nsACString &amp;aResult);</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+  bool IsSafeLDIFString(const char16_t *aStr);</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17">   struct abListener {</span>
<a href="#l26.18"></a><span id="l26.18">     nsCOMPtr&lt;nsIAbListener&gt; mListener;</span>
<a href="#l26.19"></a><span id="l26.19">     uint32_t mNotifyFlags;</span>
<a href="#l26.20"></a><span id="l26.20"> </span>
<a href="#l26.21"></a><span id="l26.21">     abListener(nsIAbListener *aListener, uint32_t aNotifyFlags)</span>
<a href="#l26.22"></a><span id="l26.22">       : mListener(aListener), mNotifyFlags(aNotifyFlags) {}</span>
<a href="#l26.23"></a><span id="l26.23">     abListener(const abListener &amp;aListener)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbOSXUtils.mm</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbOSXUtils.mm</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -11,17 +11,17 @@</span>
<a href="#l27.4"></a><span id="l27.4"> using namespace mozilla;</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6"> #include &lt;AddressBook/AddressBook.h&gt;</span>
<a href="#l27.7"></a><span id="l27.7"> #define kABDepartmentProperty (kABDepartmentProperty ? kABDepartmentProperty : @&quot;ABDepartment&quot;)</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9"> NSString*</span>
<a href="#l27.10"></a><span id="l27.10"> WrapString(const nsString &amp;aString)</span>
<a href="#l27.11"></a><span id="l27.11"> {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    unichar* chars = reinterpret_cast&lt;unichar*&gt;(const_cast&lt;PRUnichar*&gt;(aString.get()));</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+    unichar* chars = reinterpret_cast&lt;unichar*&gt;(const_cast&lt;char16_t*&gt;(aString.get()));</span>
<a href="#l27.14"></a><span id="l27.14"> </span>
<a href="#l27.15"></a><span id="l27.15">     return [NSString stringWithCharacters:chars</span>
<a href="#l27.16"></a><span id="l27.16">                                    length:aString.Length()];</span>
<a href="#l27.17"></a><span id="l27.17"> }</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19"> void</span>
<a href="#l27.20"></a><span id="l27.20"> AppendToString(const NSString *aString, nsString &amp;aResult)</span>
<a href="#l27.21"></a><span id="l27.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1248,17 +1248,17 @@ nsresult nsAbOutlookDirectory::CreateCar</span>
<a href="#l28.4"></a><span id="l28.4">         retCode = ModifyCard(newCard) ;</span>
<a href="#l28.5"></a><span id="l28.5">         NS_ENSURE_SUCCESS(retCode, retCode) ;</span>
<a href="#l28.6"></a><span id="l28.6">     }</span>
<a href="#l28.7"></a><span id="l28.7">     *aNewCard = newCard ;</span>
<a href="#l28.8"></a><span id="l28.8">     NS_ADDREF(*aNewCard) ;</span>
<a href="#l28.9"></a><span id="l28.9">     return retCode ;</span>
<a href="#l28.10"></a><span id="l28.10"> }</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-static void UnicodeToWord(const PRUnichar *aUnicode, WORD&amp; aWord)</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+static void UnicodeToWord(const char16_t *aUnicode, WORD&amp; aWord)</span>
<a href="#l28.14"></a><span id="l28.14"> {</span>
<a href="#l28.15"></a><span id="l28.15">     aWord = 0 ;</span>
<a href="#l28.16"></a><span id="l28.16">     if (aUnicode == nullptr || *aUnicode == 0) { return ; }</span>
<a href="#l28.17"></a><span id="l28.17">     nsresult errorCode = NS_OK;</span>
<a href="#l28.18"></a><span id="l28.18">     nsAutoString unichar (aUnicode) ;</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20">     aWord = static_cast&lt;WORD&gt;(unichar.ToInteger(&amp;errorCode));</span>
<a href="#l28.21"></a><span id="l28.21">     if (NS_FAILED(errorCode)) {</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -1417,21 +1417,21 @@ NS_IMETHODIMP nsAbOutlookDirectory::UseF</span>
<a href="#l28.23"></a><span id="l28.23"> </span>
<a href="#l28.24"></a><span id="l28.24"> static void splitString(nsString&amp; aSource, nsString&amp; aTarget)</span>
<a href="#l28.25"></a><span id="l28.25"> {</span>
<a href="#l28.26"></a><span id="l28.26">   aTarget.Truncate();</span>
<a href="#l28.27"></a><span id="l28.27">   int32_t offset = aSource.FindChar('\n');</span>
<a href="#l28.28"></a><span id="l28.28"> </span>
<a href="#l28.29"></a><span id="l28.29">   if (offset &gt;= 0)</span>
<a href="#l28.30"></a><span id="l28.30">   {</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-    const PRUnichar *source = aSource.get() + offset + 1;</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+    const char16_t *source = aSource.get() + offset + 1;</span>
<a href="#l28.33"></a><span id="l28.33">     while (*source)</span>
<a href="#l28.34"></a><span id="l28.34">     {</span>
<a href="#l28.35"></a><span id="l28.35">       if (*source == '\n' || *source == '\r')</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">-        aTarget.Append(PRUnichar(' '));</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+        aTarget.Append(char16_t(' '));</span>
<a href="#l28.38"></a><span id="l28.38">       else</span>
<a href="#l28.39"></a><span id="l28.39">         aTarget.Append(*source);</span>
<a href="#l28.40"></a><span id="l28.40">       ++source;</span>
<a href="#l28.41"></a><span id="l28.41">     }</span>
<a href="#l28.42"></a><span id="l28.42">     aSource.SetLength(offset);</span>
<a href="#l28.43"></a><span id="l28.43">   }</span>
<a href="#l28.44"></a><span id="l28.44"> }</span>
<a href="#l28.45"></a><span id="l28.45"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbUtils.h</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbUtils.h</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -70,63 +70,63 @@ private:</span>
<a href="#l29.4"></a><span id="l29.4">         {</span>
<a href="#l29.5"></a><span id="l29.5">           nsMemory::Free(mArray);</span>
<a href="#l29.6"></a><span id="l29.6">         }</span>
<a href="#l29.7"></a><span id="l29.7">     }</span>
<a href="#l29.8"></a><span id="l29.8"> };</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10"> /*</span>
<a href="#l29.11"></a><span id="l29.11">  * Wrapper class to automatically free an array of</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">- * PRUnichar* when class goes out of scope</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+ * char16_t* when class goes out of scope</span>
<a href="#l29.14"></a><span id="l29.14">  */</span>
<a href="#l29.15"></a><span id="l29.15"> class PRUnicharPtrArrayGuard</span>
<a href="#l29.16"></a><span id="l29.16"> {</span>
<a href="#l29.17"></a><span id="l29.17"> public:</span>
<a href="#l29.18"></a><span id="l29.18">     PRUnicharPtrArrayGuard (bool freeElements = true) :</span>
<a href="#l29.19"></a><span id="l29.19">         mFreeElements (freeElements),</span>
<a href="#l29.20"></a><span id="l29.20">         mArray (0),</span>
<a href="#l29.21"></a><span id="l29.21">         mSize (0)</span>
<a href="#l29.22"></a><span id="l29.22">     {</span>
<a href="#l29.23"></a><span id="l29.23">     }</span>
<a href="#l29.24"></a><span id="l29.24"> </span>
<a href="#l29.25"></a><span id="l29.25">     ~PRUnicharPtrArrayGuard ()</span>
<a href="#l29.26"></a><span id="l29.26">     {</span>
<a href="#l29.27"></a><span id="l29.27">         Free ();</span>
<a href="#l29.28"></a><span id="l29.28">     }</span>
<a href="#l29.29"></a><span id="l29.29"> </span>
<a href="#l29.30"></a><span id="l29.30" class="difflineminus">-    PRUnichar* operator[](int i)</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineplus">+    char16_t* operator[](int i)</span>
<a href="#l29.32"></a><span id="l29.32">     {</span>
<a href="#l29.33"></a><span id="l29.33">         return mArray[i];</span>
<a href="#l29.34"></a><span id="l29.34">     }</span>
<a href="#l29.35"></a><span id="l29.35"> </span>
<a href="#l29.36"></a><span id="l29.36">     uint32_t* GetSizeAddr(void)</span>
<a href="#l29.37"></a><span id="l29.37">     {</span>
<a href="#l29.38"></a><span id="l29.38">         return &amp;mSize;</span>
<a href="#l29.39"></a><span id="l29.39">     }</span>
<a href="#l29.40"></a><span id="l29.40"> </span>
<a href="#l29.41"></a><span id="l29.41">     uint32_t GetSize(void)</span>
<a href="#l29.42"></a><span id="l29.42">     {</span>
<a href="#l29.43"></a><span id="l29.43">         return mSize;</span>
<a href="#l29.44"></a><span id="l29.44">     }</span>
<a href="#l29.45"></a><span id="l29.45"> </span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-    PRUnichar*** GetArrayAddr(void)</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineplus">+    char16_t*** GetArrayAddr(void)</span>
<a href="#l29.48"></a><span id="l29.48">     {</span>
<a href="#l29.49"></a><span id="l29.49">         return &amp;mArray;</span>
<a href="#l29.50"></a><span id="l29.50">     }</span>
<a href="#l29.51"></a><span id="l29.51"> </span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-    const PRUnichar** GetArray(void)</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineplus">+    const char16_t** GetArray(void)</span>
<a href="#l29.54"></a><span id="l29.54">     {</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-        return (const PRUnichar** ) mArray;</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineplus">+        return (const char16_t** ) mArray;</span>
<a href="#l29.57"></a><span id="l29.57">     }</span>
<a href="#l29.58"></a><span id="l29.58"> </span>
<a href="#l29.59"></a><span id="l29.59"> public:</span>
<a href="#l29.60"></a><span id="l29.60"> </span>
<a href="#l29.61"></a><span id="l29.61"> private:</span>
<a href="#l29.62"></a><span id="l29.62">     bool mFreeElements;</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineminus">-    PRUnichar **mArray;</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineplus">+    char16_t **mArray;</span>
<a href="#l29.65"></a><span id="l29.65">     uint32_t mSize;</span>
<a href="#l29.66"></a><span id="l29.66">     void Free ()</span>
<a href="#l29.67"></a><span id="l29.67">     {</span>
<a href="#l29.68"></a><span id="l29.68">         if (!mArray)</span>
<a href="#l29.69"></a><span id="l29.69">             return;</span>
<a href="#l29.70"></a><span id="l29.70"> </span>
<a href="#l29.71"></a><span id="l29.71">         if (mFreeElements)</span>
<a href="#l29.72"></a><span id="l29.72">           NS_FREE_XPCOM_ALLOCATED_POINTER_ARRAY(mSize, mArray);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -300,20 +300,20 @@ NS_IMETHODIMP nsAbView::GetRowProperties</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5"> NS_IMETHODIMP nsAbView::GetCellProperties(int32_t row, nsITreeColumn* col, nsAString&amp; properties)</span>
<a href="#l30.6"></a><span id="l30.6"> {</span>
<a href="#l30.7"></a><span id="l30.7">   NS_ENSURE_TRUE(row &gt;= 0, NS_ERROR_UNEXPECTED);</span>
<a href="#l30.8"></a><span id="l30.8"> </span>
<a href="#l30.9"></a><span id="l30.9">   if (mCards.Count() &lt;= row)</span>
<a href="#l30.10"></a><span id="l30.10">     return NS_OK;</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  const PRUnichar* colID;</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+  const char16_t* colID;</span>
<a href="#l30.14"></a><span id="l30.14">   col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l30.15"></a><span id="l30.15">   // &quot;G&quot; == &quot;GeneratedName&quot;</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineminus">-  if (colID[0] != PRUnichar('G'))</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+  if (colID[0] != char16_t('G'))</span>
<a href="#l30.18"></a><span id="l30.18">     return NS_OK;</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20">   nsIAbCard *card = ((AbCard *)(mCards.ElementAt(row)))-&gt;card;</span>
<a href="#l30.21"></a><span id="l30.21"> </span>
<a href="#l30.22"></a><span id="l30.22">   bool isMailList;</span>
<a href="#l30.23"></a><span id="l30.23">   nsresult rv = card-&gt;GetIsMailList(&amp;isMailList);</span>
<a href="#l30.24"></a><span id="l30.24">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l30.25"></a><span id="l30.25"> </span>
<a href="#l30.26"></a><span id="l30.26" class="difflineat">@@ -397,25 +397,25 @@ NS_IMETHODIMP nsAbView::GetProgressMode(</span>
<a href="#l30.27"></a><span id="l30.27">   return NS_OK;</span>
<a href="#l30.28"></a><span id="l30.28"> }</span>
<a href="#l30.29"></a><span id="l30.29"> </span>
<a href="#l30.30"></a><span id="l30.30"> NS_IMETHODIMP nsAbView::GetCellValue(int32_t row, nsITreeColumn* col, nsAString&amp; _retval)</span>
<a href="#l30.31"></a><span id="l30.31"> {</span>
<a href="#l30.32"></a><span id="l30.32">   return NS_OK;</span>
<a href="#l30.33"></a><span id="l30.33"> }</span>
<a href="#l30.34"></a><span id="l30.34"> </span>
<a href="#l30.35"></a><span id="l30.35" class="difflineminus">-nsresult nsAbView::GetCardValue(nsIAbCard *card, const PRUnichar *colID,</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+nsresult nsAbView::GetCardValue(nsIAbCard *card, const char16_t *colID,</span>
<a href="#l30.37"></a><span id="l30.37">                                 nsAString &amp;_retval)</span>
<a href="#l30.38"></a><span id="l30.38"> {</span>
<a href="#l30.39"></a><span id="l30.39">   // &quot;G&quot; == &quot;GeneratedName&quot;, &quot;_P&quot; == &quot;_PhoneticName&quot;</span>
<a href="#l30.40"></a><span id="l30.40">   // else, standard column (like PrimaryEmail and _AimScreenName)</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineminus">-  if (colID[0] == PRUnichar('G'))</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineplus">+  if (colID[0] == char16_t('G'))</span>
<a href="#l30.43"></a><span id="l30.43">     return card-&gt;GenerateName(mGeneratedNameFormat, mABBundle, _retval);</span>
<a href="#l30.44"></a><span id="l30.44"> </span>
<a href="#l30.45"></a><span id="l30.45" class="difflineminus">-  if (colID[0] == PRUnichar('_') &amp;&amp; colID[1] == PRUnichar('P'))</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+  if (colID[0] == char16_t('_') &amp;&amp; colID[1] == char16_t('P'))</span>
<a href="#l30.47"></a><span id="l30.47">     // Use LN/FN order for the phonetic name</span>
<a href="#l30.48"></a><span id="l30.48">     return card-&gt;GeneratePhoneticName(true, _retval);</span>
<a href="#l30.49"></a><span id="l30.49"> </span>
<a href="#l30.50"></a><span id="l30.50">   if (!NS_strcmp(colID, MOZ_UTF16(&quot;ChatName&quot;)))</span>
<a href="#l30.51"></a><span id="l30.51">     return card-&gt;GenerateChatName(_retval);</span>
<a href="#l30.52"></a><span id="l30.52"> </span>
<a href="#l30.53"></a><span id="l30.53">   nsresult rv = card-&gt;GetPropertyAsAString(NS_ConvertUTF16toUTF8(colID).get(), _retval);</span>
<a href="#l30.54"></a><span id="l30.54">   if (rv == NS_ERROR_NOT_AVAILABLE) {</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineat">@@ -462,17 +462,17 @@ nsresult nsAbView::RefreshTree()</span>
<a href="#l30.56"></a><span id="l30.56">   return rv;</span>
<a href="#l30.57"></a><span id="l30.57"> }</span>
<a href="#l30.58"></a><span id="l30.58"> </span>
<a href="#l30.59"></a><span id="l30.59"> NS_IMETHODIMP nsAbView::GetCellText(int32_t row, nsITreeColumn* col, nsAString&amp; _retval)</span>
<a href="#l30.60"></a><span id="l30.60"> {</span>
<a href="#l30.61"></a><span id="l30.61">   NS_ENSURE_TRUE(row &gt;= 0 &amp;&amp; row &lt; mCards.Count(), NS_ERROR_UNEXPECTED);</span>
<a href="#l30.62"></a><span id="l30.62"> </span>
<a href="#l30.63"></a><span id="l30.63">   nsIAbCard *card = ((AbCard *)(mCards.ElementAt(row)))-&gt;card;</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineminus">-  const PRUnichar* colID;</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+  const char16_t* colID;</span>
<a href="#l30.66"></a><span id="l30.66">   col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l30.67"></a><span id="l30.67">   return GetCardValue(card, colID, _retval);</span>
<a href="#l30.68"></a><span id="l30.68"> }</span>
<a href="#l30.69"></a><span id="l30.69"> </span>
<a href="#l30.70"></a><span id="l30.70"> NS_IMETHODIMP nsAbView::SetTree(nsITreeBoxObject *tree)</span>
<a href="#l30.71"></a><span id="l30.71"> {</span>
<a href="#l30.72"></a><span id="l30.72">   mTree = tree;</span>
<a href="#l30.73"></a><span id="l30.73">   return NS_OK;</span>
<a href="#l30.74"></a><span id="l30.74" class="difflineat">@@ -528,27 +528,27 @@ NS_IMETHODIMP nsAbView::SetCellValue(int</span>
<a href="#l30.75"></a><span id="l30.75">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l30.76"></a><span id="l30.76"> }</span>
<a href="#l30.77"></a><span id="l30.77"> </span>
<a href="#l30.78"></a><span id="l30.78"> NS_IMETHODIMP nsAbView::SetCellText(int32_t row, nsITreeColumn* col, const nsAString&amp; value)</span>
<a href="#l30.79"></a><span id="l30.79"> {</span>
<a href="#l30.80"></a><span id="l30.80">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l30.81"></a><span id="l30.81"> }</span>
<a href="#l30.82"></a><span id="l30.82"> </span>
<a href="#l30.83"></a><span id="l30.83" class="difflineminus">-NS_IMETHODIMP nsAbView::PerformAction(const PRUnichar *action)</span>
<a href="#l30.84"></a><span id="l30.84" class="difflineplus">+NS_IMETHODIMP nsAbView::PerformAction(const char16_t *action)</span>
<a href="#l30.85"></a><span id="l30.85"> {</span>
<a href="#l30.86"></a><span id="l30.86">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l30.87"></a><span id="l30.87"> }</span>
<a href="#l30.88"></a><span id="l30.88"> </span>
<a href="#l30.89"></a><span id="l30.89" class="difflineminus">-NS_IMETHODIMP nsAbView::PerformActionOnRow(const PRUnichar *action, int32_t row)</span>
<a href="#l30.90"></a><span id="l30.90" class="difflineplus">+NS_IMETHODIMP nsAbView::PerformActionOnRow(const char16_t *action, int32_t row)</span>
<a href="#l30.91"></a><span id="l30.91"> {</span>
<a href="#l30.92"></a><span id="l30.92">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l30.93"></a><span id="l30.93"> }</span>
<a href="#l30.94"></a><span id="l30.94"> </span>
<a href="#l30.95"></a><span id="l30.95" class="difflineminus">-NS_IMETHODIMP nsAbView::PerformActionOnCell(const PRUnichar *action, int32_t row, nsITreeColumn* col)</span>
<a href="#l30.96"></a><span id="l30.96" class="difflineplus">+NS_IMETHODIMP nsAbView::PerformActionOnCell(const char16_t *action, int32_t row, nsITreeColumn* col)</span>
<a href="#l30.97"></a><span id="l30.97"> {</span>
<a href="#l30.98"></a><span id="l30.98">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l30.99"></a><span id="l30.99"> }</span>
<a href="#l30.100"></a><span id="l30.100"> </span>
<a href="#l30.101"></a><span id="l30.101"> NS_IMETHODIMP nsAbView::GetCardFromRow(int32_t row, nsIAbCard **aCard)</span>
<a href="#l30.102"></a><span id="l30.102"> {</span>
<a href="#l30.103"></a><span id="l30.103">   *aCard = nullptr;  </span>
<a href="#l30.104"></a><span id="l30.104">   if (mCards.Count() &lt;= row) {</span>
<a href="#l30.105"></a><span id="l30.105" class="difflineat">@@ -565,17 +565,17 @@ NS_IMETHODIMP nsAbView::GetCardFromRow(i</span>
<a href="#l30.106"></a><span id="l30.106">   return NS_OK;</span>
<a href="#l30.107"></a><span id="l30.107"> }</span>
<a href="#l30.108"></a><span id="l30.108"> </span>
<a href="#l30.109"></a><span id="l30.109"> #define DESCENDING_SORT_FACTOR -1</span>
<a href="#l30.110"></a><span id="l30.110"> #define ASCENDING_SORT_FACTOR 1</span>
<a href="#l30.111"></a><span id="l30.111"> </span>
<a href="#l30.112"></a><span id="l30.112"> typedef struct SortClosure</span>
<a href="#l30.113"></a><span id="l30.113"> {</span>
<a href="#l30.114"></a><span id="l30.114" class="difflineminus">-  const PRUnichar *colID;</span>
<a href="#l30.115"></a><span id="l30.115" class="difflineplus">+  const char16_t *colID;</span>
<a href="#l30.116"></a><span id="l30.116">   int32_t factor;</span>
<a href="#l30.117"></a><span id="l30.117">   nsAbView *abView;</span>
<a href="#l30.118"></a><span id="l30.118"> } SortClosure;</span>
<a href="#l30.119"></a><span id="l30.119"> </span>
<a href="#l30.120"></a><span id="l30.120"> static int</span>
<a href="#l30.121"></a><span id="l30.121"> inplaceSortCallback(const void *data1, const void *data2, void *privateData)</span>
<a href="#l30.122"></a><span id="l30.122"> {</span>
<a href="#l30.123"></a><span id="l30.123">   AbCard *card1 = (AbCard *)data1;</span>
<a href="#l30.124"></a><span id="l30.124" class="difflineat">@@ -584,46 +584,46 @@ inplaceSortCallback(const void *data1, c</span>
<a href="#l30.125"></a><span id="l30.125">   SortClosure *closure = (SortClosure *) privateData;</span>
<a href="#l30.126"></a><span id="l30.126">   </span>
<a href="#l30.127"></a><span id="l30.127">   int32_t sortValue;</span>
<a href="#l30.128"></a><span id="l30.128">   </span>
<a href="#l30.129"></a><span id="l30.129">   // If we are sorting the &quot;PrimaryEmail&quot;, swap the collation keys, as the secondary is always the</span>
<a href="#l30.130"></a><span id="l30.130">   // PrimaryEmail. Use the last primary key as the secondary key.</span>
<a href="#l30.131"></a><span id="l30.131">   //</span>
<a href="#l30.132"></a><span id="l30.132">   // &quot;Pr&quot; to distinguish &quot;PrimaryEmail&quot; from &quot;PagerNumber&quot;</span>
<a href="#l30.133"></a><span id="l30.133" class="difflineminus">-  if (closure-&gt;colID[0] == PRUnichar('P') &amp;&amp; closure-&gt;colID[1] == PRUnichar('r')) {</span>
<a href="#l30.134"></a><span id="l30.134" class="difflineplus">+  if (closure-&gt;colID[0] == char16_t('P') &amp;&amp; closure-&gt;colID[1] == char16_t('r')) {</span>
<a href="#l30.135"></a><span id="l30.135">     sortValue = closure-&gt;abView-&gt;CompareCollationKeys(card1-&gt;secondaryCollationKey,card1-&gt;secondaryCollationKeyLen,card2-&gt;secondaryCollationKey,card2-&gt;secondaryCollationKeyLen);</span>
<a href="#l30.136"></a><span id="l30.136">     if (sortValue)</span>
<a href="#l30.137"></a><span id="l30.137">       return sortValue * closure-&gt;factor;</span>
<a href="#l30.138"></a><span id="l30.138">     else</span>
<a href="#l30.139"></a><span id="l30.139">       return closure-&gt;abView-&gt;CompareCollationKeys(card1-&gt;primaryCollationKey,card1-&gt;primaryCollationKeyLen,card2-&gt;primaryCollationKey,card2-&gt;primaryCollationKeyLen) * (closure-&gt;factor);</span>
<a href="#l30.140"></a><span id="l30.140">   }</span>
<a href="#l30.141"></a><span id="l30.141">   else {</span>
<a href="#l30.142"></a><span id="l30.142">     sortValue = closure-&gt;abView-&gt;CompareCollationKeys(card1-&gt;primaryCollationKey,card1-&gt;primaryCollationKeyLen,card2-&gt;primaryCollationKey,card2-&gt;primaryCollationKeyLen);</span>
<a href="#l30.143"></a><span id="l30.143">     if (sortValue)</span>
<a href="#l30.144"></a><span id="l30.144">       return sortValue * (closure-&gt;factor);</span>
<a href="#l30.145"></a><span id="l30.145">     else</span>
<a href="#l30.146"></a><span id="l30.146">       return closure-&gt;abView-&gt;CompareCollationKeys(card1-&gt;secondaryCollationKey,card1-&gt;secondaryCollationKeyLen,card2-&gt;secondaryCollationKey,card2-&gt;secondaryCollationKeyLen) * (closure-&gt;factor);</span>
<a href="#l30.147"></a><span id="l30.147">   }</span>
<a href="#l30.148"></a><span id="l30.148"> }</span>
<a href="#l30.149"></a><span id="l30.149"> </span>
<a href="#l30.150"></a><span id="l30.150" class="difflineminus">-static void SetSortClosure(const PRUnichar *sortColumn, const PRUnichar *sortDirection, nsAbView *abView, SortClosure *closure)</span>
<a href="#l30.151"></a><span id="l30.151" class="difflineplus">+static void SetSortClosure(const char16_t *sortColumn, const char16_t *sortDirection, nsAbView *abView, SortClosure *closure)</span>
<a href="#l30.152"></a><span id="l30.152"> {</span>
<a href="#l30.153"></a><span id="l30.153">   closure-&gt;colID = sortColumn;</span>
<a href="#l30.154"></a><span id="l30.154">   </span>
<a href="#l30.155"></a><span id="l30.155">   if (sortDirection &amp;&amp; !NS_strcmp(sortDirection, MOZ_UTF16(&quot;descending&quot;)))</span>
<a href="#l30.156"></a><span id="l30.156">     closure-&gt;factor = DESCENDING_SORT_FACTOR;</span>
<a href="#l30.157"></a><span id="l30.157">   else </span>
<a href="#l30.158"></a><span id="l30.158">     closure-&gt;factor = ASCENDING_SORT_FACTOR;</span>
<a href="#l30.159"></a><span id="l30.159"> </span>
<a href="#l30.160"></a><span id="l30.160">   closure-&gt;abView = abView;</span>
<a href="#l30.161"></a><span id="l30.161">   return;</span>
<a href="#l30.162"></a><span id="l30.162"> }</span>
<a href="#l30.163"></a><span id="l30.163"> </span>
<a href="#l30.164"></a><span id="l30.164" class="difflineminus">-NS_IMETHODIMP nsAbView::SortBy(const PRUnichar *colID, const PRUnichar *sortDir)</span>
<a href="#l30.165"></a><span id="l30.165" class="difflineplus">+NS_IMETHODIMP nsAbView::SortBy(const char16_t *colID, const char16_t *sortDir)</span>
<a href="#l30.166"></a><span id="l30.166"> {</span>
<a href="#l30.167"></a><span id="l30.167">   nsresult rv;</span>
<a href="#l30.168"></a><span id="l30.168"> </span>
<a href="#l30.169"></a><span id="l30.169">   int32_t count = mCards.Count();</span>
<a href="#l30.170"></a><span id="l30.170"> </span>
<a href="#l30.171"></a><span id="l30.171">   nsAutoString sortColumn;</span>
<a href="#l30.172"></a><span id="l30.172">   if (!colID) </span>
<a href="#l30.173"></a><span id="l30.173">     sortColumn = NS_LITERAL_STRING(GENERATED_NAME_COLUMN_ID).get();  // default sort</span>
<a href="#l30.174"></a><span id="l30.174" class="difflineat">@@ -715,17 +715,17 @@ int32_t nsAbView::CompareCollationKeys(u</span>
<a href="#l30.175"></a><span id="l30.175"> </span>
<a href="#l30.176"></a><span id="l30.176">   nsresult rv = mCollationKeyGenerator-&gt;CompareRawSortKey(key1,len1,key2,len2,&amp;result);</span>
<a href="#l30.177"></a><span id="l30.177">   NS_ASSERTION(NS_SUCCEEDED(rv), &quot;key compare failed&quot;);</span>
<a href="#l30.178"></a><span id="l30.178">   if (NS_FAILED(rv))</span>
<a href="#l30.179"></a><span id="l30.179">     result = 0;</span>
<a href="#l30.180"></a><span id="l30.180">   return result;</span>
<a href="#l30.181"></a><span id="l30.181"> }</span>
<a href="#l30.182"></a><span id="l30.182"> </span>
<a href="#l30.183"></a><span id="l30.183" class="difflineminus">-nsresult nsAbView::GenerateCollationKeysForCard(const PRUnichar *colID, AbCard *abcard)</span>
<a href="#l30.184"></a><span id="l30.184" class="difflineplus">+nsresult nsAbView::GenerateCollationKeysForCard(const char16_t *colID, AbCard *abcard)</span>
<a href="#l30.185"></a><span id="l30.185"> {</span>
<a href="#l30.186"></a><span id="l30.186">   nsresult rv;</span>
<a href="#l30.187"></a><span id="l30.187">   nsString value;</span>
<a href="#l30.188"></a><span id="l30.188"> </span>
<a href="#l30.189"></a><span id="l30.189">   if (!mCollationKeyGenerator)</span>
<a href="#l30.190"></a><span id="l30.190">   {</span>
<a href="#l30.191"></a><span id="l30.191">     nsCOMPtr&lt;nsILocaleService&gt; localeSvc = do_GetService(NS_LOCALESERVICE_CONTRACTID,&amp;rv); </span>
<a href="#l30.192"></a><span id="l30.192">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.193"></a><span id="l30.193" class="difflineat">@@ -785,17 +785,17 @@ NS_IMETHODIMP nsAbView::OnItemAdded(nsIS</span>
<a href="#l30.194"></a><span id="l30.194">       int32_t index;</span>
<a href="#l30.195"></a><span id="l30.195">       rv = AddCard(abcard, false /* select card */, &amp;index);</span>
<a href="#l30.196"></a><span id="l30.196">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l30.197"></a><span id="l30.197">     }</span>
<a href="#l30.198"></a><span id="l30.198">   }</span>
<a href="#l30.199"></a><span id="l30.199">   return rv;</span>
<a href="#l30.200"></a><span id="l30.200"> }</span>
<a href="#l30.201"></a><span id="l30.201"> </span>
<a href="#l30.202"></a><span id="l30.202" class="difflineminus">-NS_IMETHODIMP nsAbView::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData)</span>
<a href="#l30.203"></a><span id="l30.203" class="difflineplus">+NS_IMETHODIMP nsAbView::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *someData)</span>
<a href="#l30.204"></a><span id="l30.204"> {</span>
<a href="#l30.205"></a><span id="l30.205">   if (!strcmp(aTopic, NS_PREFBRANCH_PREFCHANGE_TOPIC_ID)) {</span>
<a href="#l30.206"></a><span id="l30.206">     if (nsDependentString(someData).EqualsLiteral(PREF_MAIL_ADDR_BOOK_LASTNAMEFIRST)) {</span>
<a href="#l30.207"></a><span id="l30.207">       nsresult rv = SetGeneratedNameFormatFromPrefs();</span>
<a href="#l30.208"></a><span id="l30.208">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.209"></a><span id="l30.209"> </span>
<a href="#l30.210"></a><span id="l30.210">       rv = RefreshTree();</span>
<a href="#l30.211"></a><span id="l30.211">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.212"></a><span id="l30.212" class="difflineat">@@ -934,17 +934,17 @@ int32_t nsAbView::FindIndexForCard(nsIAb</span>
<a href="#l30.213"></a><span id="l30.213">     nsresult rv = card-&gt;Equals(abcard-&gt;card, &amp;equals);</span>
<a href="#l30.214"></a><span id="l30.214">     if (NS_SUCCEEDED(rv) &amp;&amp; equals) {</span>
<a href="#l30.215"></a><span id="l30.215">       return i;</span>
<a href="#l30.216"></a><span id="l30.216">     }</span>
<a href="#l30.217"></a><span id="l30.217">   }</span>
<a href="#l30.218"></a><span id="l30.218">   return CARD_NOT_FOUND;</span>
<a href="#l30.219"></a><span id="l30.219"> }</span>
<a href="#l30.220"></a><span id="l30.220"> </span>
<a href="#l30.221"></a><span id="l30.221" class="difflineminus">-NS_IMETHODIMP nsAbView::OnItemPropertyChanged(nsISupports *item, const char *property, const PRUnichar *oldValue, const PRUnichar *newValue)</span>
<a href="#l30.222"></a><span id="l30.222" class="difflineplus">+NS_IMETHODIMP nsAbView::OnItemPropertyChanged(nsISupports *item, const char *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l30.223"></a><span id="l30.223"> {</span>
<a href="#l30.224"></a><span id="l30.224">   nsresult rv;</span>
<a href="#l30.225"></a><span id="l30.225"> </span>
<a href="#l30.226"></a><span id="l30.226">   nsCOMPtr &lt;nsIAbCard&gt; card = do_QueryInterface(item);</span>
<a href="#l30.227"></a><span id="l30.227">   if (!card)</span>
<a href="#l30.228"></a><span id="l30.228">     return NS_OK;</span>
<a href="#l30.229"></a><span id="l30.229"> </span>
<a href="#l30.230"></a><span id="l30.230">   int32_t index = FindIndexForCard(card);</span>
<a href="#l30.231"></a><span id="l30.231" class="difflineat">@@ -1200,18 +1200,18 @@ NS_IMETHODIMP nsAbView::SwapFirstNameLas</span>
<a href="#l30.232"></a><span id="l30.232">           abCard-&gt;SetLastName(fn);</span>
<a href="#l30.233"></a><span id="l30.233"> </span>
<a href="#l30.234"></a><span id="l30.234">           // Generate display name using the new order</span>
<a href="#l30.235"></a><span id="l30.235">           if (displayNameAutoGeneration &amp;&amp;</span>
<a href="#l30.236"></a><span id="l30.236">               !fn.IsEmpty() &amp;&amp; !ln.IsEmpty())</span>
<a href="#l30.237"></a><span id="l30.237">           {</span>
<a href="#l30.238"></a><span id="l30.238">             nsString dnLnFn;</span>
<a href="#l30.239"></a><span id="l30.239">             nsString dnFnLn;</span>
<a href="#l30.240"></a><span id="l30.240" class="difflineminus">-            const PRUnichar *nameString[2];</span>
<a href="#l30.241"></a><span id="l30.241" class="difflineminus">-            const PRUnichar *formatString;</span>
<a href="#l30.242"></a><span id="l30.242" class="difflineplus">+            const char16_t *nameString[2];</span>
<a href="#l30.243"></a><span id="l30.243" class="difflineplus">+            const char16_t *formatString;</span>
<a href="#l30.244"></a><span id="l30.244"> </span>
<a href="#l30.245"></a><span id="l30.245">             // The format should stays the same before/after we swap the names</span>
<a href="#l30.246"></a><span id="l30.246">             formatString = displayNameLastnamefirst ?</span>
<a href="#l30.247"></a><span id="l30.247">                               MOZ_UTF16(&quot;lastFirstFormat&quot;) :</span>
<a href="#l30.248"></a><span id="l30.248">                               MOZ_UTF16(&quot;firstLastFormat&quot;);</span>
<a href="#l30.249"></a><span id="l30.249"> </span>
<a href="#l30.250"></a><span id="l30.250">             // Generate both ln/fn and fn/ln combination since we need both later</span>
<a href="#l30.251"></a><span id="l30.251">             // to check to see if the current display name was edited</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbView.h</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbView.h</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -46,26 +46,26 @@ public:</span>
<a href="#l31.4"></a><span id="l31.4">   NS_DECL_NSIOBSERVER</span>
<a href="#l31.5"></a><span id="l31.5">   </span>
<a href="#l31.6"></a><span id="l31.6">   int32_t CompareCollationKeys(uint8_t *key1, uint32_t len1, uint8_t *key2, uint32_t len2);</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8"> private:</span>
<a href="#l31.9"></a><span id="l31.9">   nsresult Initialize();</span>
<a href="#l31.10"></a><span id="l31.10">   int32_t FindIndexForInsert(AbCard *abcard);</span>
<a href="#l31.11"></a><span id="l31.11">   int32_t FindIndexForCard(nsIAbCard *card);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  nsresult GenerateCollationKeysForCard(const PRUnichar *colID, AbCard *abcard);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+  nsresult GenerateCollationKeysForCard(const char16_t *colID, AbCard *abcard);</span>
<a href="#l31.14"></a><span id="l31.14">   nsresult InvalidateTree(int32_t row);</span>
<a href="#l31.15"></a><span id="l31.15">   nsresult RemoveCardAt(int32_t row);</span>
<a href="#l31.16"></a><span id="l31.16">   nsresult AddCard(AbCard *abcard, bool selectCardAfterAdding, int32_t *index);</span>
<a href="#l31.17"></a><span id="l31.17">   nsresult RemoveCardAndSelectNextCard(nsISupports *item);</span>
<a href="#l31.18"></a><span id="l31.18">   nsresult EnumerateCards();</span>
<a href="#l31.19"></a><span id="l31.19">   nsresult SetGeneratedNameFormatFromPrefs();</span>
<a href="#l31.20"></a><span id="l31.20">   nsresult GetSelectedCards(nsCOMPtr&lt;nsIMutableArray&gt; &amp;aSelectedCards);</span>
<a href="#l31.21"></a><span id="l31.21">   nsresult ReselectCards(nsIArray *aCards, nsIAbCard *aIndexCard);</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineminus">-  nsresult GetCardValue(nsIAbCard *card, const PRUnichar *colID, nsAString &amp;_retval);</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineplus">+  nsresult GetCardValue(nsIAbCard *card, const char16_t *colID, nsAString &amp;_retval);</span>
<a href="#l31.24"></a><span id="l31.24">   nsresult RefreshTree();</span>
<a href="#l31.25"></a><span id="l31.25"> </span>
<a href="#l31.26"></a><span id="l31.26">   nsCOMPtr&lt;nsITreeBoxObject&gt; mTree;</span>
<a href="#l31.27"></a><span id="l31.27">   nsCOMPtr&lt;nsITreeSelection&gt; mTreeSelection;</span>
<a href="#l31.28"></a><span id="l31.28">   nsCOMPtr &lt;nsIAbDirectory&gt; mDirectory;</span>
<a href="#l31.29"></a><span id="l31.29">   nsVoidArray mCards;</span>
<a href="#l31.30"></a><span id="l31.30">   nsString mSortColumn;</span>
<a href="#l31.31"></a><span id="l31.31">   nsString mSortDirection;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbWinHelper.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbWinHelper.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -505,17 +505,17 @@ BOOL nsAbWinHelper::DeleteEntry(const ns</span>
<a href="#l32.4"></a><span id="l32.4">     if (HR_FAILED(mLastError)) {</span>
<a href="#l32.5"></a><span id="l32.5">         PRINTF((&quot;Cannot delete entry %08x.\n&quot;, mLastError)) ;</span>
<a href="#l32.6"></a><span id="l32.6">         return FALSE ;</span>
<a href="#l32.7"></a><span id="l32.7">     }</span>
<a href="#l32.8"></a><span id="l32.8">     return TRUE ;</span>
<a href="#l32.9"></a><span id="l32.9"> }</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11"> BOOL nsAbWinHelper::SetPropertyUString(const nsMapiEntry&amp; aObject, ULONG aPropertyTag, </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-                                       const PRUnichar *aValue)</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+                                       const char16_t *aValue)</span>
<a href="#l32.14"></a><span id="l32.14"> {</span>
<a href="#l32.15"></a><span id="l32.15">     SPropValue value ;</span>
<a href="#l32.16"></a><span id="l32.16">     nsAutoCString alternativeValue ;</span>
<a href="#l32.17"></a><span id="l32.17"> </span>
<a href="#l32.18"></a><span id="l32.18">     value.ulPropTag = aPropertyTag ;</span>
<a href="#l32.19"></a><span id="l32.19">     if (PROP_TYPE(aPropertyTag) == PT_UNICODE) {</span>
<a href="#l32.20"></a><span id="l32.20">         value.Value.lpszW = const_cast&lt;WCHAR *&gt;(aValue) ;</span>
<a href="#l32.21"></a><span id="l32.21">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbWinHelper.h</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbWinHelper.h</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -71,17 +71,17 @@ public:</span>
<a href="#l33.4"></a><span id="l33.4">     // Get the value of a MAPI property of type BIN</span>
<a href="#l33.5"></a><span id="l33.5">     BOOL GetPropertyBin(const nsMapiEntry&amp; aObject, ULONG aPropertyTag, nsMapiEntry&amp; aValue) ;</span>
<a href="#l33.6"></a><span id="l33.6">     // Tests if a container contains an entry</span>
<a href="#l33.7"></a><span id="l33.7">     BOOL TestOpenEntry(const nsMapiEntry&amp; aContainer, const nsMapiEntry&amp; aEntry) ;</span>
<a href="#l33.8"></a><span id="l33.8">     // Delete an entry in the address book</span>
<a href="#l33.9"></a><span id="l33.9">     BOOL DeleteEntry(const nsMapiEntry&amp; aContainer, const nsMapiEntry&amp; aEntry) ;</span>
<a href="#l33.10"></a><span id="l33.10">     // Set the value of a MAPI property of type string in unicode</span>
<a href="#l33.11"></a><span id="l33.11">     BOOL SetPropertyUString (const nsMapiEntry&amp; aObject, ULONG aPropertyTag, </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-                             const PRUnichar *aValue) ;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+                             const char16_t *aValue) ;</span>
<a href="#l33.14"></a><span id="l33.14">     // Same as previous, but with a bunch of properties in one call</span>
<a href="#l33.15"></a><span id="l33.15">     BOOL SetPropertiesUString(const nsMapiEntry&amp; aObject, const ULONG *aPropertiesTag,</span>
<a href="#l33.16"></a><span id="l33.16">                               ULONG aNbProperties, nsString *aValues) ;</span>
<a href="#l33.17"></a><span id="l33.17">     // Set the value of a MAPI property of type SYSTIME</span>
<a href="#l33.18"></a><span id="l33.18">     BOOL SetPropertyDate(const nsMapiEntry&amp; aObject, ULONG aPropertyTag, </span>
<a href="#l33.19"></a><span id="l33.19">                          WORD aYear, WORD aMonth, WORD aDay) ;</span>
<a href="#l33.20"></a><span id="l33.20">     // Create entry in the address book</span>
<a href="#l33.21"></a><span id="l33.21">     BOOL CreateEntry(const nsMapiEntry&amp; aParent, nsMapiEntry&amp; aNewEntry) ;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -397,17 +397,17 @@ NS_IMETHODIMP nsAddrDatabase::Open</span>
<a href="#l34.4"></a><span id="l34.4">         (void)AlertAboutCorruptMabFile(originalMabFileName.get(),</span>
<a href="#l34.5"></a><span id="l34.5">           NS_ConvertASCIItoUTF16(backupMabFileName).get());</span>
<a href="#l34.6"></a><span id="l34.6">       }</span>
<a href="#l34.7"></a><span id="l34.7">     }</span>
<a href="#l34.8"></a><span id="l34.8">   }</span>
<a href="#l34.9"></a><span id="l34.9">   return rv;</span>
<a href="#l34.10"></a><span id="l34.10"> }</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-nsresult nsAddrDatabase::DisplayAlert(const PRUnichar *titleName, const PRUnichar *alertStringName, const PRUnichar **formatStrings, int32_t numFormatStrings)</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+nsresult nsAddrDatabase::DisplayAlert(const char16_t *titleName, const char16_t *alertStringName, const char16_t **formatStrings, int32_t numFormatStrings)</span>
<a href="#l34.14"></a><span id="l34.14"> {</span>
<a href="#l34.15"></a><span id="l34.15">   nsresult rv;</span>
<a href="#l34.16"></a><span id="l34.16">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l34.17"></a><span id="l34.17">     mozilla::services::GetStringBundleService();</span>
<a href="#l34.18"></a><span id="l34.18">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l34.21"></a><span id="l34.21">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -424,26 +424,26 @@ nsresult nsAddrDatabase::DisplayAlert(co</span>
<a href="#l34.23"></a><span id="l34.23"> </span>
<a href="#l34.24"></a><span id="l34.24">   nsCOMPtr&lt;nsIPromptService&gt; prompter =</span>
<a href="#l34.25"></a><span id="l34.25">       do_GetService(NS_PROMPTSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l34.26"></a><span id="l34.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.27"></a><span id="l34.27"> </span>
<a href="#l34.28"></a><span id="l34.28">   return prompter-&gt;Alert(nullptr /* we don't know the parent window */, alertTitle.get(), alertMessage.get());</span>
<a href="#l34.29"></a><span id="l34.29"> }</span>
<a href="#l34.30"></a><span id="l34.30"> </span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-nsresult nsAddrDatabase::AlertAboutCorruptMabFile(const PRUnichar *aOldFileName, const PRUnichar *aNewFileName)</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+nsresult nsAddrDatabase::AlertAboutCorruptMabFile(const char16_t *aOldFileName, const char16_t *aNewFileName)</span>
<a href="#l34.33"></a><span id="l34.33"> {</span>
<a href="#l34.34"></a><span id="l34.34" class="difflineminus">-  const PRUnichar *formatStrings[] = { aOldFileName, aOldFileName, aNewFileName };</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineplus">+  const char16_t *formatStrings[] = { aOldFileName, aOldFileName, aNewFileName };</span>
<a href="#l34.36"></a><span id="l34.36">   return DisplayAlert(MOZ_UTF16(&quot;corruptMabFileTitle&quot;),</span>
<a href="#l34.37"></a><span id="l34.37">     MOZ_UTF16(&quot;corruptMabFileAlert&quot;), formatStrings, 3);</span>
<a href="#l34.38"></a><span id="l34.38"> }</span>
<a href="#l34.39"></a><span id="l34.39"> </span>
<a href="#l34.40"></a><span id="l34.40" class="difflineminus">-nsresult nsAddrDatabase::AlertAboutLockedMabFile(const PRUnichar *aFileName)</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineplus">+nsresult nsAddrDatabase::AlertAboutLockedMabFile(const char16_t *aFileName)</span>
<a href="#l34.42"></a><span id="l34.42"> {</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineminus">-  const PRUnichar *formatStrings[] = { aFileName };</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineplus">+  const char16_t *formatStrings[] = { aFileName };</span>
<a href="#l34.45"></a><span id="l34.45">   return DisplayAlert(MOZ_UTF16(&quot;lockedMabFileTitle&quot;),</span>
<a href="#l34.46"></a><span id="l34.46">     MOZ_UTF16(&quot;lockedMabFileAlert&quot;), formatStrings, 1);</span>
<a href="#l34.47"></a><span id="l34.47"> }</span>
<a href="#l34.48"></a><span id="l34.48"> </span>
<a href="#l34.49"></a><span id="l34.49"> nsresult</span>
<a href="#l34.50"></a><span id="l34.50"> nsAddrDatabase::OpenInternal(nsIFile *aMabFile, bool aCreate, nsIAddrDatabase** pAddrDB)</span>
<a href="#l34.51"></a><span id="l34.51"> {</span>
<a href="#l34.52"></a><span id="l34.52">   nsAddrDatabase *pAddressBookDB = new nsAddrDatabase();</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineat">@@ -1008,17 +1008,17 @@ nsresult nsAddrDatabase::ConvertAndAddLo</span>
<a href="#l34.54"></a><span id="l34.54">     if (!colString.IsEmpty())</span>
<a href="#l34.55"></a><span id="l34.55">     {</span>
<a href="#l34.56"></a><span id="l34.56">         rv = AddLowercaseColumn(row, toCol, NS_ConvertUTF16toUTF8(colString).get());</span>
<a href="#l34.57"></a><span id="l34.57">     }</span>
<a href="#l34.58"></a><span id="l34.58">     return rv;</span>
<a href="#l34.59"></a><span id="l34.59"> }</span>
<a href="#l34.60"></a><span id="l34.60"> </span>
<a href="#l34.61"></a><span id="l34.61"> // Change the unicode string to lowercase, then convert to UTF8 string to store in db</span>
<a href="#l34.62"></a><span id="l34.62" class="difflineminus">-nsresult nsAddrDatabase::AddUnicodeToColumn(nsIMdbRow * row, mdb_token aColToken, mdb_token aLowerCaseColToken, const PRUnichar* aUnicodeStr)</span>
<a href="#l34.63"></a><span id="l34.63" class="difflineplus">+nsresult nsAddrDatabase::AddUnicodeToColumn(nsIMdbRow * row, mdb_token aColToken, mdb_token aLowerCaseColToken, const char16_t* aUnicodeStr)</span>
<a href="#l34.64"></a><span id="l34.64"> {</span>
<a href="#l34.65"></a><span id="l34.65">   nsresult rv = AddCharStringColumn(row, aColToken, NS_ConvertUTF16toUTF8(aUnicodeStr).get());</span>
<a href="#l34.66"></a><span id="l34.66">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l34.67"></a><span id="l34.67"> </span>
<a href="#l34.68"></a><span id="l34.68">   rv = AddLowercaseColumn(row, aLowerCaseColToken, NS_ConvertUTF16toUTF8(aUnicodeStr).get());</span>
<a href="#l34.69"></a><span id="l34.69">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l34.70"></a><span id="l34.70">   return rv;</span>
<a href="#l34.71"></a><span id="l34.71"> }</span>
<a href="#l34.72"></a><span id="l34.72" class="difflineat">@@ -1716,17 +1716,17 @@ NS_IMETHODIMP nsAddrDatabase::DeleteCard</span>
<a href="#l34.73"></a><span id="l34.73">   err = DeleteCardFromListRow(pListRow, cardRowID);</span>
<a href="#l34.74"></a><span id="l34.74">   if (NS_SUCCEEDED(err) &amp;&amp; aNotify) {</span>
<a href="#l34.75"></a><span id="l34.75">     NotifyCardEntryChange(AB_NotifyDeleted, card, mailList);</span>
<a href="#l34.76"></a><span id="l34.76">   }</span>
<a href="#l34.77"></a><span id="l34.77">   NS_RELEASE(pListRow);</span>
<a href="#l34.78"></a><span id="l34.78">   return NS_OK;</span>
<a href="#l34.79"></a><span id="l34.79"> }</span>
<a href="#l34.80"></a><span id="l34.80"> </span>
<a href="#l34.81"></a><span id="l34.81" class="difflineminus">-NS_IMETHODIMP nsAddrDatabase::SetCardValue(nsIAbCard *card, const char *name, const PRUnichar *value, bool notify)</span>
<a href="#l34.82"></a><span id="l34.82" class="difflineplus">+NS_IMETHODIMP nsAddrDatabase::SetCardValue(nsIAbCard *card, const char *name, const char16_t *value, bool notify)</span>
<a href="#l34.83"></a><span id="l34.83"> {</span>
<a href="#l34.84"></a><span id="l34.84">   NS_ENSURE_ARG_POINTER(card);</span>
<a href="#l34.85"></a><span id="l34.85">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l34.86"></a><span id="l34.86">   NS_ENSURE_ARG_POINTER(value);</span>
<a href="#l34.87"></a><span id="l34.87">   if (!m_mdbStore || !m_mdbEnv)</span>
<a href="#l34.88"></a><span id="l34.88">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l34.89"></a><span id="l34.89"> </span>
<a href="#l34.90"></a><span id="l34.90">   nsresult rv = NS_OK;</span>
<a href="#l34.91"></a><span id="l34.91" class="difflineat">@@ -1747,17 +1747,17 @@ NS_IMETHODIMP nsAddrDatabase::SetCardVal</span>
<a href="#l34.92"></a><span id="l34.92"> </span>
<a href="#l34.93"></a><span id="l34.93">   mdb_token token;</span>
<a href="#l34.94"></a><span id="l34.94">   rv = m_mdbStore-&gt;StringToToken(m_mdbEnv, name, &amp;token);</span>
<a href="#l34.95"></a><span id="l34.95">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.96"></a><span id="l34.96"> </span>
<a href="#l34.97"></a><span id="l34.97">   return AddCharStringColumn(cardRow, token, NS_ConvertUTF16toUTF8(value).get());</span>
<a href="#l34.98"></a><span id="l34.98"> }</span>
<a href="#l34.99"></a><span id="l34.99"> </span>
<a href="#l34.100"></a><span id="l34.100" class="difflineminus">-NS_IMETHODIMP nsAddrDatabase::GetCardValue(nsIAbCard *card, const char *name, PRUnichar **value)</span>
<a href="#l34.101"></a><span id="l34.101" class="difflineplus">+NS_IMETHODIMP nsAddrDatabase::GetCardValue(nsIAbCard *card, const char *name, char16_t **value)</span>
<a href="#l34.102"></a><span id="l34.102"> {</span>
<a href="#l34.103"></a><span id="l34.103">   if (!m_mdbStore || !card || !name || !value || !m_mdbEnv)</span>
<a href="#l34.104"></a><span id="l34.104">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l34.105"></a><span id="l34.105"> </span>
<a href="#l34.106"></a><span id="l34.106">   nsresult rv = NS_OK;</span>
<a href="#l34.107"></a><span id="l34.107"> </span>
<a href="#l34.108"></a><span id="l34.108">   nsCOMPtr &lt;nsIMdbRow&gt; cardRow;</span>
<a href="#l34.109"></a><span id="l34.109">   mdbOid rowOid;</span>
<a href="#l34.110"></a><span id="l34.110" class="difflineat">@@ -3145,17 +3145,17 @@ NS_IMETHODIMP nsAddrDatabase::AddListDir</span>
<a href="#l34.111"></a><span id="l34.111">         if(NS_SUCCEEDED(rv))</span>
<a href="#l34.112"></a><span id="l34.112">           dbparentDir-&gt;NotifyDirItemAdded(mailList);</span>
<a href="#l34.113"></a><span id="l34.113">       }</span>
<a href="#l34.114"></a><span id="l34.114">     }</span>
<a href="#l34.115"></a><span id="l34.115">   }</span>
<a href="#l34.116"></a><span id="l34.116">   return rv;</span>
<a href="#l34.117"></a><span id="l34.117"> }</span>
<a href="#l34.118"></a><span id="l34.118"> </span>
<a href="#l34.119"></a><span id="l34.119" class="difflineminus">-NS_IMETHODIMP nsAddrDatabase::FindMailListbyUnicodeName(const PRUnichar *listName, bool *exist)</span>
<a href="#l34.120"></a><span id="l34.120" class="difflineplus">+NS_IMETHODIMP nsAddrDatabase::FindMailListbyUnicodeName(const char16_t *listName, bool *exist)</span>
<a href="#l34.121"></a><span id="l34.121"> {</span>
<a href="#l34.122"></a><span id="l34.122">   nsAutoString unicodeString(listName);</span>
<a href="#l34.123"></a><span id="l34.123">   ToLowerCase(unicodeString);</span>
<a href="#l34.124"></a><span id="l34.124"> </span>
<a href="#l34.125"></a><span id="l34.125">   nsCOMPtr &lt;nsIMdbRow&gt; listRow;</span>
<a href="#l34.126"></a><span id="l34.126">   nsresult rv = GetRowForCharColumn(unicodeString.get(),</span>
<a href="#l34.127"></a><span id="l34.127">                                     m_LowerListNameColumnToken, false,</span>
<a href="#l34.128"></a><span id="l34.128">                                     false, getter_AddRefs(listRow), nullptr);</span>
<a href="#l34.129"></a><span id="l34.129" class="difflineat">@@ -3170,17 +3170,17 @@ NS_IMETHODIMP nsAddrDatabase::GetCardCou</span>
<a href="#l34.130"></a><span id="l34.130">     rv = m_mdbPabTable-&gt;GetCount(m_mdbEnv, &amp;c);</span>
<a href="#l34.131"></a><span id="l34.131">     if (NS_SUCCEEDED(rv))</span>
<a href="#l34.132"></a><span id="l34.132">         *count = c - 1;  // Don't count LastRecordKey</span>
<a href="#l34.133"></a><span id="l34.133"> </span>
<a href="#l34.134"></a><span id="l34.134">     return rv;</span>
<a href="#l34.135"></a><span id="l34.135"> }</span>
<a href="#l34.136"></a><span id="l34.136"> </span>
<a href="#l34.137"></a><span id="l34.137"> bool</span>
<a href="#l34.138"></a><span id="l34.138" class="difflineminus">-nsAddrDatabase::HasRowButDeletedForCharColumn(const PRUnichar *unicodeStr, mdb_column findColumn, bool aIsCard, nsIMdbRow **aFindRow)</span>
<a href="#l34.139"></a><span id="l34.139" class="difflineplus">+nsAddrDatabase::HasRowButDeletedForCharColumn(const char16_t *unicodeStr, mdb_column findColumn, bool aIsCard, nsIMdbRow **aFindRow)</span>
<a href="#l34.140"></a><span id="l34.140"> {</span>
<a href="#l34.141"></a><span id="l34.141">   if (!m_mdbStore || !aFindRow || !m_mdbEnv)</span>
<a href="#l34.142"></a><span id="l34.142">     return false;</span>
<a href="#l34.143"></a><span id="l34.143"> </span>
<a href="#l34.144"></a><span id="l34.144">   mdbYarn    sourceYarn;</span>
<a href="#l34.145"></a><span id="l34.145"> </span>
<a href="#l34.146"></a><span id="l34.146">   NS_ConvertUTF16toUTF8 UTF8String(unicodeStr);</span>
<a href="#l34.147"></a><span id="l34.147">   sourceYarn.mYarn_Buf = (void *) UTF8String.get();</span>
<a href="#l34.148"></a><span id="l34.148" class="difflineat">@@ -3220,17 +3220,17 @@ nsAddrDatabase::HasRowButDeletedForCharC</span>
<a href="#l34.149"></a><span id="l34.149">   return (NS_SUCCEEDED(rv) &amp;&amp; *aFindRow);</span>
<a href="#l34.150"></a><span id="l34.150"> }</span>
<a href="#l34.151"></a><span id="l34.151"> </span>
<a href="#l34.152"></a><span id="l34.152"> /* @param aRowPos Contains the row position for multiple calls. Should be</span>
<a href="#l34.153"></a><span id="l34.153">  *                instantiated to -1 on the first call. Or can be null</span>
<a href="#l34.154"></a><span id="l34.154">  *                if you are not making multiple calls.</span>
<a href="#l34.155"></a><span id="l34.155">  */</span>
<a href="#l34.156"></a><span id="l34.156"> nsresult</span>
<a href="#l34.157"></a><span id="l34.157" class="difflineminus">-nsAddrDatabase::GetRowForCharColumn(const PRUnichar *unicodeStr,</span>
<a href="#l34.158"></a><span id="l34.158" class="difflineplus">+nsAddrDatabase::GetRowForCharColumn(const char16_t *unicodeStr,</span>
<a href="#l34.159"></a><span id="l34.159">                                     mdb_column findColumn, bool aIsCard,</span>
<a href="#l34.160"></a><span id="l34.160">                                     bool aCaseInsensitive,</span>
<a href="#l34.161"></a><span id="l34.161">                                     nsIMdbRow **aFindRow,</span>
<a href="#l34.162"></a><span id="l34.162">                                     mdb_pos *aRowPos)</span>
<a href="#l34.163"></a><span id="l34.163"> {</span>
<a href="#l34.164"></a><span id="l34.164">   NS_ENSURE_ARG_POINTER(unicodeStr);</span>
<a href="#l34.165"></a><span id="l34.165">   NS_ENSURE_ARG_POINTER(aFindRow);</span>
<a href="#l34.166"></a><span id="l34.166">   NS_ENSURE_TRUE(m_mdbEnv &amp;&amp; m_mdbPabTable, NS_ERROR_NULL_POINTER);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.h</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.h</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -237,22 +237,22 @@ public:</span>
<a href="#l35.4"></a><span id="l35.4">   { return AddCharStringColumn(row, m_ListNickNameColumnToken, value); }</span>
<a href="#l35.5"></a><span id="l35.5"> </span>
<a href="#l35.6"></a><span id="l35.6">   NS_IMETHOD AddListDescription(nsIMdbRow * row, const char * value) MOZ_OVERRIDE</span>
<a href="#l35.7"></a><span id="l35.7">   { return AddCharStringColumn(row, m_ListDescriptionColumnToken, value); }</span>
<a href="#l35.8"></a><span id="l35.8"> </span>
<a href="#l35.9"></a><span id="l35.9"> </span>
<a href="#l35.10"></a><span id="l35.10">   NS_IMETHOD AddListDirNode(nsIMdbRow * listRow) MOZ_OVERRIDE;</span>
<a href="#l35.11"></a><span id="l35.11"> </span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-  NS_IMETHOD FindMailListbyUnicodeName(const PRUnichar *listName, bool *exist) MOZ_OVERRIDE;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+  NS_IMETHOD FindMailListbyUnicodeName(const char16_t *listName, bool *exist) MOZ_OVERRIDE;</span>
<a href="#l35.14"></a><span id="l35.14"> </span>
<a href="#l35.15"></a><span id="l35.15">   NS_IMETHOD GetCardCount(uint32_t *count) MOZ_OVERRIDE;</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17" class="difflineminus">-  NS_IMETHOD SetCardValue(nsIAbCard *card, const char *name, const PRUnichar *value, bool notify) MOZ_OVERRIDE;</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">-  NS_IMETHOD GetCardValue(nsIAbCard *card, const char *name, PRUnichar **value) MOZ_OVERRIDE;</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+  NS_IMETHOD SetCardValue(nsIAbCard *card, const char *name, const char16_t *value, bool notify) MOZ_OVERRIDE;</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+  NS_IMETHOD GetCardValue(nsIAbCard *card, const char *name, char16_t **value) MOZ_OVERRIDE;</span>
<a href="#l35.21"></a><span id="l35.21">   // nsAddrDatabase methods:</span>
<a href="#l35.22"></a><span id="l35.22"> </span>
<a href="#l35.23"></a><span id="l35.23">   nsAddrDatabase();</span>
<a href="#l35.24"></a><span id="l35.24">   virtual ~nsAddrDatabase();</span>
<a href="#l35.25"></a><span id="l35.25"> </span>
<a href="#l35.26"></a><span id="l35.26">   void GetMDBFactory(nsIMdbFactory ** aMdbFactory);</span>
<a href="#l35.27"></a><span id="l35.27">   nsIMdbEnv    *GetEnv() {return m_mdbEnv;}</span>
<a href="#l35.28"></a><span id="l35.28">   uint32_t    GetCurVersion();</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineat">@@ -328,17 +328,17 @@ protected:</span>
<a href="#l35.30"></a><span id="l35.30"> </span>
<a href="#l35.31"></a><span id="l35.31">   nsresult      InitLastRecorKey();</span>
<a href="#l35.32"></a><span id="l35.32">   nsresult      GetDataRow(nsIMdbRow **pDataRow);</span>
<a href="#l35.33"></a><span id="l35.33">   nsresult      GetLastRecordKey();</span>
<a href="#l35.34"></a><span id="l35.34">   nsresult      UpdateLastRecordKey();</span>
<a href="#l35.35"></a><span id="l35.35">   nsresult      CheckAndUpdateRecordKey();</span>
<a href="#l35.36"></a><span id="l35.36">   nsresult      UpdateLowercaseEmailListName();</span>
<a href="#l35.37"></a><span id="l35.37">   nsresult      ConvertAndAddLowercaseColumn(nsIMdbRow * row, mdb_token fromCol, mdb_token toCol);</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineminus">-  nsresult      AddUnicodeToColumn(nsIMdbRow * row, mdb_token colToken, mdb_token lowerCaseColToken, const PRUnichar* pUnicodeStr);</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineplus">+  nsresult      AddUnicodeToColumn(nsIMdbRow * row, mdb_token colToken, mdb_token lowerCaseColToken, const char16_t* pUnicodeStr);</span>
<a href="#l35.40"></a><span id="l35.40"> </span>
<a href="#l35.41"></a><span id="l35.41">   nsresult      DeleteRow(nsIMdbTable* dbTable, nsIMdbRow* dbRow);</span>
<a href="#l35.42"></a><span id="l35.42"> </span>
<a href="#l35.43"></a><span id="l35.43">   nsIMdbEnv   *m_mdbEnv;  // to be used in all the db calls.</span>
<a href="#l35.44"></a><span id="l35.44">   nsIMdbStore *m_mdbStore;</span>
<a href="#l35.45"></a><span id="l35.45">   nsIMdbTable *m_mdbPabTable;</span>
<a href="#l35.46"></a><span id="l35.46">   nsIMdbTable *m_mdbDeletedCardsTable;</span>
<a href="#l35.47"></a><span id="l35.47">   nsCOMPtr&lt;nsIFile&gt; m_dbName;</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineat">@@ -423,21 +423,21 @@ protected:</span>
<a href="#l35.49"></a><span id="l35.49">   mdb_token      m_ListTotalColumnToken;</span>
<a href="#l35.50"></a><span id="l35.50">   mdb_token      m_LowerListNameColumnToken;</span>
<a href="#l35.51"></a><span id="l35.51"> </span>
<a href="#l35.52"></a><span id="l35.52">   uint32_t      m_LastRecordKey;</span>
<a href="#l35.53"></a><span id="l35.53">   nsWeakPtr m_dbDirectory;</span>
<a href="#l35.54"></a><span id="l35.54">   nsCOMPtr&lt;nsIMdbFactory&gt; mMdbFactory;</span>
<a href="#l35.55"></a><span id="l35.55"> </span>
<a href="#l35.56"></a><span id="l35.56"> private:</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineminus">-  nsresult GetRowForCharColumn(const PRUnichar *unicodeStr,</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+  nsresult GetRowForCharColumn(const char16_t *unicodeStr,</span>
<a href="#l35.59"></a><span id="l35.59">                                mdb_column findColumn, bool bIsCard,</span>
<a href="#l35.60"></a><span id="l35.60">                                bool aCaseInsensitive, nsIMdbRow **findRow,</span>
<a href="#l35.61"></a><span id="l35.61">                                mdb_pos *aRowPos);</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineminus">-  bool HasRowButDeletedForCharColumn(const PRUnichar *unicodeStr, mdb_column findColumn, bool aIsCard, nsIMdbRow **aFindRow);</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineplus">+  bool HasRowButDeletedForCharColumn(const char16_t *unicodeStr, mdb_column findColumn, bool aIsCard, nsIMdbRow **aFindRow);</span>
<a href="#l35.64"></a><span id="l35.64">   nsresult OpenInternal(nsIFile *aMabFile, bool aCreate, nsIAddrDatabase **pCardDB);</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineminus">-  nsresult AlertAboutCorruptMabFile(const PRUnichar *aOldFileName, const PRUnichar *aNewFileName);</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineminus">-  nsresult AlertAboutLockedMabFile(const PRUnichar *aFileName);</span>
<a href="#l35.67"></a><span id="l35.67" class="difflineminus">-  nsresult DisplayAlert(const PRUnichar *titleName, const PRUnichar *alertStringName,</span>
<a href="#l35.68"></a><span id="l35.68" class="difflineminus">-                        const PRUnichar **formatStrings, int32_t numFormatStrings);</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineplus">+  nsresult AlertAboutCorruptMabFile(const char16_t *aOldFileName, const char16_t *aNewFileName);</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineplus">+  nsresult AlertAboutLockedMabFile(const char16_t *aFileName);</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineplus">+  nsresult DisplayAlert(const char16_t *titleName, const char16_t *alertStringName,</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineplus">+                        const char16_t **formatStrings, int32_t numFormatStrings);</span>
<a href="#l35.73"></a><span id="l35.73"> };</span>
<a href="#l35.74"></a><span id="l35.74"> </span>
<a href="#l35.75"></a><span id="l35.75"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -78,17 +78,17 @@ class DirPrefObserver : public nsSupport</span>
<a href="#l36.4"></a><span id="l36.4"> {</span>
<a href="#l36.5"></a><span id="l36.5"> public:</span>
<a href="#l36.6"></a><span id="l36.6">   NS_DECL_ISUPPORTS</span>
<a href="#l36.7"></a><span id="l36.7">   NS_DECL_NSIOBSERVER</span>
<a href="#l36.8"></a><span id="l36.8"> };</span>
<a href="#l36.9"></a><span id="l36.9"> </span>
<a href="#l36.10"></a><span id="l36.10"> NS_IMPL_ISUPPORTS2(DirPrefObserver, nsISupportsWeakReference, nsIObserver)</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-NS_IMETHODIMP DirPrefObserver::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *aData)</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+NS_IMETHODIMP DirPrefObserver::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *aData)</span>
<a href="#l36.14"></a><span id="l36.14"> {</span>
<a href="#l36.15"></a><span id="l36.15">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_QueryInterface(aSubject));</span>
<a href="#l36.16"></a><span id="l36.16">   nsCString strPrefName;</span>
<a href="#l36.17"></a><span id="l36.17">   strPrefName.Assign(NS_ConvertUTF16toUTF8(aData));</span>
<a href="#l36.18"></a><span id="l36.18">   const char *prefname = strPrefName.get();</span>
<a href="#l36.19"></a><span id="l36.19"> </span>
<a href="#l36.20"></a><span id="l36.20">   DIR_PrefId id = DIR_AtomizePrefName(prefname);</span>
<a href="#l36.21"></a><span id="l36.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchAdapter.h</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchAdapter.h</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -39,26 +39,26 @@ public:</span>
<a href="#l37.4"></a><span id="l37.4">   nsCOMPtr&lt;nsISupportsArray&gt;  m_searchTerms;       /* linked list of criteria terms */</span>
<a href="#l37.5"></a><span id="l37.5"> </span>
<a href="#l37.6"></a><span id="l37.6">   bool m_abortCalled;</span>
<a href="#l37.7"></a><span id="l37.7">   nsString  m_defaultCharset;</span>
<a href="#l37.8"></a><span id="l37.8">   bool m_forceAsciiSearch;</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10">   static nsresult EncodeImap (char **ppEncoding,</span>
<a href="#l37.11"></a><span id="l37.11">            nsISupportsArray *searchTerms,</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-           const PRUnichar *srcCharset,</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-           const PRUnichar *destCharset,</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineplus">+           const char16_t *srcCharset,</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+           const char16_t *destCharset,</span>
<a href="#l37.16"></a><span id="l37.16">            bool reallyDredd = false);</span>
<a href="#l37.17"></a><span id="l37.17"> </span>
<a href="#l37.18"></a><span id="l37.18">   static nsresult EncodeImapValue(char *encoding, const char *value, bool useQuotes, bool reallyDredd);</span>
<a href="#l37.19"></a><span id="l37.19"> </span>
<a href="#l37.20"></a><span id="l37.20" class="difflineminus">-  static char *GetImapCharsetParam(const PRUnichar *destCharset);</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineminus">-  static PRUnichar *EscapeSearchUrl (const PRUnichar *nntpCommand);</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineminus">-  static PRUnichar *EscapeImapSearchProtocol(const PRUnichar *imapCommand);</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineminus">-  static PRUnichar *EscapeQuoteImapSearchProtocol(const PRUnichar *imapCommand);</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineplus">+  static char *GetImapCharsetParam(const char16_t *destCharset);</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineplus">+  static char16_t *EscapeSearchUrl (const char16_t *nntpCommand);</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineplus">+  static char16_t *EscapeImapSearchProtocol(const char16_t *imapCommand);</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineplus">+  static char16_t *EscapeQuoteImapSearchProtocol(const char16_t *imapCommand);</span>
<a href="#l37.28"></a><span id="l37.28">   static char *UnEscapeSearchUrl (const char *commandSpecificData);</span>
<a href="#l37.29"></a><span id="l37.29">   // This stuff lives in the base class because the IMAP search syntax</span>
<a href="#l37.30"></a><span id="l37.30">   // is used by the Dredd SEARCH command as well as IMAP itself</span>
<a href="#l37.31"></a><span id="l37.31">   static const char *m_kImapBefore;</span>
<a href="#l37.32"></a><span id="l37.32">   static const char *m_kImapBody;</span>
<a href="#l37.33"></a><span id="l37.33">   static const char *m_kImapCC;</span>
<a href="#l37.34"></a><span id="l37.34">   static const char *m_kImapFrom;</span>
<a href="#l37.35"></a><span id="l37.35">   static const char *m_kImapNot;</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineat">@@ -89,17 +89,17 @@ protected:</span>
<a href="#l37.37"></a><span id="l37.37">     kOverwrite,    /* &quot;John Doe&quot; -&gt; &quot;John*Doe&quot;,   simple contains   */</span>
<a href="#l37.38"></a><span id="l37.38">     kInsert,       /* &quot;John Doe&quot; -&gt; &quot;John* Doe&quot;,  name completion   */</span>
<a href="#l37.39"></a><span id="l37.39">     kSurround      /* &quot;John Doe&quot; -&gt; &quot;John* *Doe&quot;, advanced contains */</span>
<a href="#l37.40"></a><span id="l37.40">   } msg_TransformType;</span>
<a href="#l37.41"></a><span id="l37.41"> </span>
<a href="#l37.42"></a><span id="l37.42">   char *TransformSpacesToStars (const char *, msg_TransformType transformType);</span>
<a href="#l37.43"></a><span id="l37.43">   nsresult OpenNewsResultInUnknownGroup (nsMsgResultElement*);</span>
<a href="#l37.44"></a><span id="l37.44"> </span>
<a href="#l37.45"></a><span id="l37.45" class="difflineminus">-  static nsresult EncodeImapTerm (nsIMsgSearchTerm *, bool reallyDredd, const PRUnichar *srcCharset, const PRUnichar *destCharset, char **ppOutTerm);</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineplus">+  static nsresult EncodeImapTerm (nsIMsgSearchTerm *, bool reallyDredd, const char16_t *srcCharset, const char16_t *destCharset, char **ppOutTerm);</span>
<a href="#l37.47"></a><span id="l37.47"> };</span>
<a href="#l37.48"></a><span id="l37.48"> </span>
<a href="#l37.49"></a><span id="l37.49"> //-----------------------------------------------------------------------------</span>
<a href="#l37.50"></a><span id="l37.50"> // Validity checking for attrib/op pairs. We need to know what operations are</span>
<a href="#l37.51"></a><span id="l37.51"> // legal in three places:</span>
<a href="#l37.52"></a><span id="l37.52"> //   1. when the FE brings up the dialog box and needs to know how to build</span>
<a href="#l37.53"></a><span id="l37.53"> //      the menus and enable their items</span>
<a href="#l37.54"></a><span id="l37.54"> //   2. when the FE fires off a search, we need to check their lists for</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -528,17 +528,17 @@ NS_IMETHODIMP nsMsgFilter::LogRuleHit(ns</span>
<a href="#l38.4"></a><span id="l38.4">       mozilla::services::GetStringBundleService();</span>
<a href="#l38.5"></a><span id="l38.5">     NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l38.6"></a><span id="l38.6"> </span>
<a href="#l38.7"></a><span id="l38.7">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l38.8"></a><span id="l38.8">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/filter.properties&quot;,</span>
<a href="#l38.9"></a><span id="l38.9">       getter_AddRefs(bundle));</span>
<a href="#l38.10"></a><span id="l38.10">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    const PRUnichar *filterLogDetectFormatStrings[4] = { filterName.get(), authorValue.get(), subjectValue.get(), dateValue.get() };</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+    const char16_t *filterLogDetectFormatStrings[4] = { filterName.get(), authorValue.get(), subjectValue.get(), dateValue.get() };</span>
<a href="#l38.14"></a><span id="l38.14">     nsString filterLogDetectStr;</span>
<a href="#l38.15"></a><span id="l38.15">     rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l38.16"></a><span id="l38.16">       MOZ_UTF16(&quot;filterLogDetectStr&quot;),</span>
<a href="#l38.17"></a><span id="l38.17">       filterLogDetectFormatStrings, 4,</span>
<a href="#l38.18"></a><span id="l38.18">       getter_Copies(filterLogDetectStr));</span>
<a href="#l38.19"></a><span id="l38.19">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.20"></a><span id="l38.20"> </span>
<a href="#l38.21"></a><span id="l38.21">     buffer += NS_ConvertUTF16toUTF8(filterLogDetectStr);</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineat">@@ -550,17 +550,17 @@ NS_IMETHODIMP nsMsgFilter::LogRuleHit(ns</span>
<a href="#l38.23"></a><span id="l38.23">       nsCString actionFolderUri;</span>
<a href="#l38.24"></a><span id="l38.24">       aFilterAction-&gt;GetTargetFolderUri(actionFolderUri);</span>
<a href="#l38.25"></a><span id="l38.25">       NS_ConvertASCIItoUTF16 actionFolderUriValue(actionFolderUri);</span>
<a href="#l38.26"></a><span id="l38.26"> </span>
<a href="#l38.27"></a><span id="l38.27">       nsCString msgId;</span>
<a href="#l38.28"></a><span id="l38.28">       aMsgHdr-&gt;GetMessageId(getter_Copies(msgId));</span>
<a href="#l38.29"></a><span id="l38.29">       NS_ConvertASCIItoUTF16 msgIdValue(msgId);</span>
<a href="#l38.30"></a><span id="l38.30"> </span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-      const PRUnichar *logMoveFormatStrings[2] = { msgIdValue.get(), actionFolderUriValue.get() };</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+      const char16_t *logMoveFormatStrings[2] = { msgIdValue.get(), actionFolderUriValue.get() };</span>
<a href="#l38.33"></a><span id="l38.33">       nsString logMoveStr;</span>
<a href="#l38.34"></a><span id="l38.34">       rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l38.35"></a><span id="l38.35">         (actionType == nsMsgFilterAction::MoveToFolder) ?</span>
<a href="#l38.36"></a><span id="l38.36">           MOZ_UTF16(&quot;logMoveStr&quot;) : MOZ_UTF16(&quot;logCopyStr&quot;),</span>
<a href="#l38.37"></a><span id="l38.37">         logMoveFormatStrings, 2,</span>
<a href="#l38.38"></a><span id="l38.38">         getter_Copies(logMoveStr));</span>
<a href="#l38.39"></a><span id="l38.39">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.40"></a><span id="l38.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -20,20 +20,20 @@</span>
<a href="#l39.4"></a><span id="l39.4"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l39.5"></a><span id="l39.5"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l39.6"></a><span id="l39.6"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l39.7"></a><span id="l39.7"> #include &quot;nsMemory.h&quot;</span>
<a href="#l39.8"></a><span id="l39.8"> #include &quot;prmem.h&quot;</span>
<a href="#l39.9"></a><span id="l39.9"> #include &lt;ctype.h&gt;</span>
<a href="#l39.10"></a><span id="l39.10"> </span>
<a href="#l39.11"></a><span id="l39.11"> // unicode &quot;%s&quot; format string</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-static const PRUnichar unicodeFormatter[] = {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">-    (PRUnichar)'%',</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineminus">-    (PRUnichar)'s',</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineminus">-    (PRUnichar)0,</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineplus">+static const char16_t unicodeFormatter[] = {</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineplus">+    (char16_t)'%',</span>
<a href="#l39.18"></a><span id="l39.18" class="difflineplus">+    (char16_t)'s',</span>
<a href="#l39.19"></a><span id="l39.19" class="difflineplus">+    (char16_t)0,</span>
<a href="#l39.20"></a><span id="l39.20"> };</span>
<a href="#l39.21"></a><span id="l39.21"> </span>
<a href="#l39.22"></a><span id="l39.22"> </span>
<a href="#l39.23"></a><span id="l39.23"> nsMsgFilterList::nsMsgFilterList() :</span>
<a href="#l39.24"></a><span id="l39.24">     m_fileVersion(0)</span>
<a href="#l39.25"></a><span id="l39.25"> {</span>
<a href="#l39.26"></a><span id="l39.26">   m_loggingEnabled = false;</span>
<a href="#l39.27"></a><span id="l39.27">   m_startWritingToBuffer = false;</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineat">@@ -571,17 +571,17 @@ nsresult nsMsgFilterList::LoadTextFilter</span>
<a href="#l39.29"></a><span id="l39.29">           if (NS_FAILED(err))</span>
<a href="#l39.30"></a><span id="l39.30">               break;</span>
<a href="#l39.31"></a><span id="l39.31"> </span>
<a href="#l39.32"></a><span id="l39.32">           filter-&gt;SetFilterName(unicodeStr);</span>
<a href="#l39.33"></a><span id="l39.33">         }</span>
<a href="#l39.34"></a><span id="l39.34">         else</span>
<a href="#l39.35"></a><span id="l39.35">         {</span>
<a href="#l39.36"></a><span id="l39.36">           // ### fix me - this is silly.</span>
<a href="#l39.37"></a><span id="l39.37" class="difflineminus">-          PRUnichar *unicodeString =</span>
<a href="#l39.38"></a><span id="l39.38" class="difflineplus">+          char16_t *unicodeString =</span>
<a href="#l39.39"></a><span id="l39.39">             nsTextFormatter::smprintf(unicodeFormatter, value.get());</span>
<a href="#l39.40"></a><span id="l39.40">           filter-&gt;SetFilterName(nsDependentString(unicodeString));</span>
<a href="#l39.41"></a><span id="l39.41">           nsTextFormatter::smprintf_free(unicodeString);</span>
<a href="#l39.42"></a><span id="l39.42">         }</span>
<a href="#l39.43"></a><span id="l39.43">         m_curFilter = filter;</span>
<a href="#l39.44"></a><span id="l39.44">         m_filters.AppendElement(filter);</span>
<a href="#l39.45"></a><span id="l39.45">       }</span>
<a href="#l39.46"></a><span id="l39.46">       break;</span>
<a href="#l39.47"></a><span id="l39.47" class="difflineat">@@ -855,17 +855,17 @@ nsMsgFilterList::WriteStrAttr(nsMsgFilte</span>
<a href="#l39.48"></a><span id="l39.48"> </span>
<a href="#l39.49"></a><span id="l39.49"> nsresult nsMsgFilterList::WriteBoolAttr(nsMsgFilterFileAttribValue attrib, bool boolVal, nsIOutputStream *aStream)</span>
<a href="#l39.50"></a><span id="l39.50"> {</span>
<a href="#l39.51"></a><span id="l39.51">   return WriteStrAttr(attrib, (boolVal) ? &quot;yes&quot; : &quot;no&quot;, aStream);</span>
<a href="#l39.52"></a><span id="l39.52"> }</span>
<a href="#l39.53"></a><span id="l39.53"> </span>
<a href="#l39.54"></a><span id="l39.54"> nsresult</span>
<a href="#l39.55"></a><span id="l39.55"> nsMsgFilterList::WriteWstrAttr(nsMsgFilterFileAttribValue attrib,</span>
<a href="#l39.56"></a><span id="l39.56" class="difflineminus">-                               const PRUnichar *aFilterName, nsIOutputStream *aStream)</span>
<a href="#l39.57"></a><span id="l39.57" class="difflineplus">+                               const char16_t *aFilterName, nsIOutputStream *aStream)</span>
<a href="#l39.58"></a><span id="l39.58"> {</span>
<a href="#l39.59"></a><span id="l39.59">     WriteStrAttr(attrib, NS_ConvertUTF16toUTF8(aFilterName).get(), aStream);</span>
<a href="#l39.60"></a><span id="l39.60">     return NS_OK;</span>
<a href="#l39.61"></a><span id="l39.61"> }</span>
<a href="#l39.62"></a><span id="l39.62"> </span>
<a href="#l39.63"></a><span id="l39.63"> nsresult nsMsgFilterList::SaveTextFilters(nsIOutputStream *aStream)</span>
<a href="#l39.64"></a><span id="l39.64"> {</span>
<a href="#l39.65"></a><span id="l39.65">   uint32_t   filterCount = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -171,17 +171,17 @@ nsresult nsMsgFilterService::BackUpFilte</span>
<a href="#l40.4"></a><span id="l40.4"> }</span>
<a href="#l40.5"></a><span id="l40.5"> </span>
<a href="#l40.6"></a><span id="l40.6"> nsresult nsMsgFilterService::AlertBackingUpFilterFile(nsIMsgWindow *aMsgWindow)</span>
<a href="#l40.7"></a><span id="l40.7"> {</span>
<a href="#l40.8"></a><span id="l40.8">   return ThrowAlertMsg(&quot;filterListBackUpMsg&quot;, aMsgWindow);</span>
<a href="#l40.9"></a><span id="l40.9"> }</span>
<a href="#l40.10"></a><span id="l40.10"> </span>
<a href="#l40.11"></a><span id="l40.11"> nsresult //Do not use this routine if you have to call it very often because it creates a new bundle each time</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-nsMsgFilterService::GetStringFromBundle(const char *aMsgName, PRUnichar **aResult)</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+nsMsgFilterService::GetStringFromBundle(const char *aMsgName, char16_t **aResult)</span>
<a href="#l40.14"></a><span id="l40.14"> {</span>
<a href="#l40.15"></a><span id="l40.15">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l40.16"></a><span id="l40.16"> </span>
<a href="#l40.17"></a><span id="l40.17">   nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l40.18"></a><span id="l40.18">   nsresult rv = GetFilterStringBundle(getter_AddRefs(bundle));</span>
<a href="#l40.19"></a><span id="l40.19">   if (NS_SUCCEEDED(rv) &amp;&amp; bundle)</span>
<a href="#l40.20"></a><span id="l40.20">     rv = bundle-&gt;GetStringFromName(NS_ConvertASCIItoUTF16(aMsgName).get(), aResult);</span>
<a href="#l40.21"></a><span id="l40.21">   return rv;</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineat">@@ -252,17 +252,17 @@ public:</span>
<a href="#l40.23"></a><span id="l40.23">   NS_DECL_NSIMSGCOPYSERVICELISTENER</span>
<a href="#l40.24"></a><span id="l40.24"> </span>
<a href="#l40.25"></a><span id="l40.25">   nsresult  AdvanceToNextFolder();  // kicks off the process</span>
<a href="#l40.26"></a><span id="l40.26"> protected:</span>
<a href="#l40.27"></a><span id="l40.27">   virtual   nsresult  RunNextFilter();</span>
<a href="#l40.28"></a><span id="l40.28">   nsresult  ApplyFilter(bool *aApplyMore = nullptr);</span>
<a href="#l40.29"></a><span id="l40.29">   nsresult  OnEndExecution(nsresult executionStatus); // do what we have to do to cleanup.</span>
<a href="#l40.30"></a><span id="l40.30">   bool      ContinueExecutionPrompt();</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-  nsresult  DisplayConfirmationPrompt(nsIMsgWindow *msgWindow, const PRUnichar *confirmString, bool *confirmed);</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+  nsresult  DisplayConfirmationPrompt(nsIMsgWindow *msgWindow, const char16_t *confirmString, bool *confirmed);</span>
<a href="#l40.33"></a><span id="l40.33">   nsCOMPtr&lt;nsIMsgWindow&gt;      m_msgWindow;</span>
<a href="#l40.34"></a><span id="l40.34">   nsCOMPtr&lt;nsIMsgFilterList&gt;  m_filters;</span>
<a href="#l40.35"></a><span id="l40.35">   nsCOMPtr&lt;nsIArray&gt;          m_folders;</span>
<a href="#l40.36"></a><span id="l40.36">   nsCOMPtr&lt;nsIMsgFolder&gt;      m_curFolder;</span>
<a href="#l40.37"></a><span id="l40.37">   nsCOMPtr&lt;nsIMsgDatabase&gt;    m_curFolderDB;</span>
<a href="#l40.38"></a><span id="l40.38">   nsCOMPtr&lt;nsIMsgFilter&gt;      m_curFilter;</span>
<a href="#l40.39"></a><span id="l40.39">   uint32_t                    m_curFilterIndex;</span>
<a href="#l40.40"></a><span id="l40.40">   uint32_t                    m_curFolderIndex;</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineat">@@ -1050,31 +1050,31 @@ bool nsMsgFilterAfterTheFact::ContinueEx</span>
<a href="#l40.42"></a><span id="l40.42">   bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/filter.properties&quot;,</span>
<a href="#l40.43"></a><span id="l40.43">                               getter_AddRefs(bundle));</span>
<a href="#l40.44"></a><span id="l40.44">   if (!bundle)</span>
<a href="#l40.45"></a><span id="l40.45">     return false;</span>
<a href="#l40.46"></a><span id="l40.46">   nsString filterName;</span>
<a href="#l40.47"></a><span id="l40.47">   m_curFilter-&gt;GetFilterName(filterName);</span>
<a href="#l40.48"></a><span id="l40.48">   nsString formatString;</span>
<a href="#l40.49"></a><span id="l40.49">   nsString confirmText;</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-  const PRUnichar *formatStrings[] =</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineplus">+  const char16_t *formatStrings[] =</span>
<a href="#l40.52"></a><span id="l40.52">   {</span>
<a href="#l40.53"></a><span id="l40.53">     filterName.get()</span>
<a href="#l40.54"></a><span id="l40.54">   };</span>
<a href="#l40.55"></a><span id="l40.55">   nsresult rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;continueFilterExecution&quot;),</span>
<a href="#l40.56"></a><span id="l40.56">                                              formatStrings, 1, getter_Copies(confirmText));</span>
<a href="#l40.57"></a><span id="l40.57">   if (NS_FAILED(rv))</span>
<a href="#l40.58"></a><span id="l40.58">     return false;</span>
<a href="#l40.59"></a><span id="l40.59">   bool returnVal = false;</span>
<a href="#l40.60"></a><span id="l40.60">   (void) DisplayConfirmationPrompt(m_msgWindow, confirmText.get(), &amp;returnVal);</span>
<a href="#l40.61"></a><span id="l40.61">   return returnVal;</span>
<a href="#l40.62"></a><span id="l40.62"> }</span>
<a href="#l40.63"></a><span id="l40.63"> </span>
<a href="#l40.64"></a><span id="l40.64"> nsresult</span>
<a href="#l40.65"></a><span id="l40.65" class="difflineminus">-nsMsgFilterAfterTheFact::DisplayConfirmationPrompt(nsIMsgWindow *msgWindow, const PRUnichar *confirmString, bool *confirmed)</span>
<a href="#l40.66"></a><span id="l40.66" class="difflineplus">+nsMsgFilterAfterTheFact::DisplayConfirmationPrompt(nsIMsgWindow *msgWindow, const char16_t *confirmString, bool *confirmed)</span>
<a href="#l40.67"></a><span id="l40.67"> {</span>
<a href="#l40.68"></a><span id="l40.68">   if (msgWindow)</span>
<a href="#l40.69"></a><span id="l40.69">   {</span>
<a href="#l40.70"></a><span id="l40.70">     nsCOMPtr &lt;nsIDocShell&gt; docShell;</span>
<a href="#l40.71"></a><span id="l40.71">     msgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l40.72"></a><span id="l40.72">     if (docShell)</span>
<a href="#l40.73"></a><span id="l40.73">     {</span>
<a href="#l40.74"></a><span id="l40.74">       nsCOMPtr&lt;nsIPrompt&gt; dialog(do_GetInterface(docShell));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.h</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.h</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -27,17 +27,17 @@ public:</span>
<a href="#l41.4"></a><span id="l41.4">   NS_DECL_NSIMSGFILTERSERVICE</span>
<a href="#l41.5"></a><span id="l41.5"> /* clients call OpenFilterList to get a handle to a FilterList, of existing nsMsgFilter *.</span>
<a href="#l41.6"></a><span id="l41.6">   These are manipulated by the front end as a result of user interaction</span>
<a href="#l41.7"></a><span id="l41.7">    with dialog boxes. To apply the new list call MSG_CloseFilterList.</span>
<a href="#l41.8"></a><span id="l41.8"> */</span>
<a href="#l41.9"></a><span id="l41.9">   nsresult BackUpFilterFile(nsIFile *aFilterFile, nsIMsgWindow *aMsgWindow);</span>
<a href="#l41.10"></a><span id="l41.10">   nsresult AlertBackingUpFilterFile(nsIMsgWindow *aMsgWindow);</span>
<a href="#l41.11"></a><span id="l41.11">   nsresult ThrowAlertMsg(const char*aMsgName, nsIMsgWindow *aMsgWindow);</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-  nsresult GetStringFromBundle(const char *aMsgName, PRUnichar **aResult);</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+  nsresult GetStringFromBundle(const char *aMsgName, char16_t **aResult);</span>
<a href="#l41.14"></a><span id="l41.14">   nsresult GetFilterStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l41.15"></a><span id="l41.15"> </span>
<a href="#l41.16"></a><span id="l41.16"> protected:</span>
<a href="#l41.17"></a><span id="l41.17">   nsCOMArray&lt;nsIMsgFilterCustomAction&gt; mCustomActions; // defined custom action list</span>
<a href="#l41.18"></a><span id="l41.18">   nsCOMArray&lt;nsIMsgSearchCustomTerm&gt; mCustomTerms; // defined custom term list</span>
<a href="#l41.19"></a><span id="l41.19"> </span>
<a href="#l41.20"></a><span id="l41.20"> };</span>
<a href="#l41.21"></a><span id="l41.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -72,17 +72,17 @@ nsresult nsMsgSearchOnlineMail::Search (</span>
<a href="#l42.4"></a><span id="l42.4">     // folder.  We might for an offline IMAP folder.</span>
<a href="#l42.5"></a><span id="l42.5">     nsresult err = NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l42.6"></a><span id="l42.6"> </span>
<a href="#l42.7"></a><span id="l42.7">     return err;</span>
<a href="#l42.8"></a><span id="l42.8"> }</span>
<a href="#l42.9"></a><span id="l42.9"> </span>
<a href="#l42.10"></a><span id="l42.10"> nsresult nsMsgSearchOnlineMail::Encode (nsCString&amp; pEncoding,</span>
<a href="#l42.11"></a><span id="l42.11">                                         nsISupportsArray *searchTerms,</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-                                        const PRUnichar *destCharset)</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+                                        const char16_t *destCharset)</span>
<a href="#l42.14"></a><span id="l42.14"> {</span>
<a href="#l42.15"></a><span id="l42.15">   nsCString imapTerms;</span>
<a href="#l42.16"></a><span id="l42.16">   </span>
<a href="#l42.17"></a><span id="l42.17">   //check if searchTerms are ascii only</span>
<a href="#l42.18"></a><span id="l42.18">   bool asciiOnly = true;</span>
<a href="#l42.19"></a><span id="l42.19">   // ### what's this mean in the NWO?????</span>
<a href="#l42.20"></a><span id="l42.20">   </span>
<a href="#l42.21"></a><span id="l42.21">   if (true) // !(srcCharset &amp; CODESET_MASK == STATEFUL || srcCharset &amp; CODESET_MASK == WIDECHAR) )   //assume all single/multiple bytes charset has ascii as subset</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -144,58 +144,58 @@ NS_IMETHODIMP nsMsgSearchAdapter::AddRes</span>
<a href="#l43.4"></a><span id="l43.4"> NS_IMETHODIMP nsMsgSearchAdapter::AddHit(nsMsgKey key)</span>
<a href="#l43.5"></a><span id="l43.5"> {</span>
<a href="#l43.6"></a><span id="l43.6">   NS_ASSERTION(false, &quot;shouldn't call this base class impl&quot;);</span>
<a href="#l43.7"></a><span id="l43.7">   return NS_ERROR_FAILURE;</span>
<a href="#l43.8"></a><span id="l43.8"> }</span>
<a href="#l43.9"></a><span id="l43.9"> </span>
<a href="#l43.10"></a><span id="l43.10"> </span>
<a href="#l43.11"></a><span id="l43.11"> char *</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-nsMsgSearchAdapter::GetImapCharsetParam(const PRUnichar *destCharset)</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+nsMsgSearchAdapter::GetImapCharsetParam(const char16_t *destCharset)</span>
<a href="#l43.14"></a><span id="l43.14"> {</span>
<a href="#l43.15"></a><span id="l43.15">   char *result = nullptr;</span>
<a href="#l43.16"></a><span id="l43.16"> </span>
<a href="#l43.17"></a><span id="l43.17">   // Specify a character set unless we happen to be US-ASCII.</span>
<a href="#l43.18"></a><span id="l43.18">   if (NS_strcmp(destCharset, MOZ_UTF16(&quot;us-ascii&quot;)))</span>
<a href="#l43.19"></a><span id="l43.19">       result = PR_smprintf(&quot;%s%s&quot;, nsMsgSearchAdapter::m_kImapCharset, NS_ConvertUTF16toUTF8(destCharset).get());</span>
<a href="#l43.20"></a><span id="l43.20"> </span>
<a href="#l43.21"></a><span id="l43.21">   return result;</span>
<a href="#l43.22"></a><span id="l43.22"> }</span>
<a href="#l43.23"></a><span id="l43.23"> </span>
<a href="#l43.24"></a><span id="l43.24"> /*</span>
<a href="#l43.25"></a><span id="l43.25">    09/21/2000 - taka@netscape.com</span>
<a href="#l43.26"></a><span id="l43.26" class="difflineminus">-   This method is bogus. Escape must be done against char * not PRUnichar *</span>
<a href="#l43.27"></a><span id="l43.27" class="difflineplus">+   This method is bogus. Escape must be done against char * not char16_t *</span>
<a href="#l43.28"></a><span id="l43.28">    should be rewritten later.</span>
<a href="#l43.29"></a><span id="l43.29">    for now, just duplicate the string.</span>
<a href="#l43.30"></a><span id="l43.30"> */</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-PRUnichar *nsMsgSearchAdapter::EscapeSearchUrl (const PRUnichar *nntpCommand)</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+char16_t *nsMsgSearchAdapter::EscapeSearchUrl (const char16_t *nntpCommand)</span>
<a href="#l43.33"></a><span id="l43.33"> {</span>
<a href="#l43.34"></a><span id="l43.34">   return nntpCommand ? NS_strdup(nntpCommand) : nullptr;</span>
<a href="#l43.35"></a><span id="l43.35"> }</span>
<a href="#l43.36"></a><span id="l43.36"> </span>
<a href="#l43.37"></a><span id="l43.37"> /*</span>
<a href="#l43.38"></a><span id="l43.38">    09/21/2000 - taka@netscape.com</span>
<a href="#l43.39"></a><span id="l43.39" class="difflineminus">-   This method is bogus. Escape must be done against char * not PRUnichar *</span>
<a href="#l43.40"></a><span id="l43.40" class="difflineplus">+   This method is bogus. Escape must be done against char * not char16_t *</span>
<a href="#l43.41"></a><span id="l43.41">    should be rewritten later.</span>
<a href="#l43.42"></a><span id="l43.42">    for now, just duplicate the string.</span>
<a href="#l43.43"></a><span id="l43.43"> */</span>
<a href="#l43.44"></a><span id="l43.44" class="difflineminus">-PRUnichar *</span>
<a href="#l43.45"></a><span id="l43.45" class="difflineminus">-nsMsgSearchAdapter::EscapeImapSearchProtocol(const PRUnichar *imapCommand)</span>
<a href="#l43.46"></a><span id="l43.46" class="difflineplus">+char16_t *</span>
<a href="#l43.47"></a><span id="l43.47" class="difflineplus">+nsMsgSearchAdapter::EscapeImapSearchProtocol(const char16_t *imapCommand)</span>
<a href="#l43.48"></a><span id="l43.48"> {</span>
<a href="#l43.49"></a><span id="l43.49">   return imapCommand ? NS_strdup(imapCommand) : nullptr;</span>
<a href="#l43.50"></a><span id="l43.50"> }</span>
<a href="#l43.51"></a><span id="l43.51"> </span>
<a href="#l43.52"></a><span id="l43.52"> /*</span>
<a href="#l43.53"></a><span id="l43.53">    09/21/2000 - taka@netscape.com</span>
<a href="#l43.54"></a><span id="l43.54" class="difflineminus">-   This method is bogus. Escape must be done against char * not PRUnichar *</span>
<a href="#l43.55"></a><span id="l43.55" class="difflineplus">+   This method is bogus. Escape must be done against char * not char16_t *</span>
<a href="#l43.56"></a><span id="l43.56">    should be rewritten later.</span>
<a href="#l43.57"></a><span id="l43.57">    for now, just duplicate the string.</span>
<a href="#l43.58"></a><span id="l43.58"> */</span>
<a href="#l43.59"></a><span id="l43.59" class="difflineminus">-PRUnichar *</span>
<a href="#l43.60"></a><span id="l43.60" class="difflineminus">-nsMsgSearchAdapter::EscapeQuoteImapSearchProtocol(const PRUnichar *imapCommand)</span>
<a href="#l43.61"></a><span id="l43.61" class="difflineplus">+char16_t *</span>
<a href="#l43.62"></a><span id="l43.62" class="difflineplus">+nsMsgSearchAdapter::EscapeQuoteImapSearchProtocol(const char16_t *imapCommand)</span>
<a href="#l43.63"></a><span id="l43.63"> {</span>
<a href="#l43.64"></a><span id="l43.64">   return imapCommand ? NS_strdup(imapCommand) : nullptr;</span>
<a href="#l43.65"></a><span id="l43.65"> }</span>
<a href="#l43.66"></a><span id="l43.66"> </span>
<a href="#l43.67"></a><span id="l43.67"> char *nsMsgSearchAdapter::UnEscapeSearchUrl (const char *commandSpecificData)</span>
<a href="#l43.68"></a><span id="l43.68"> {</span>
<a href="#l43.69"></a><span id="l43.69">   char *result = (char*) PR_Malloc (strlen(commandSpecificData) + 1);</span>
<a href="#l43.70"></a><span id="l43.70">   if (result)</span>
<a href="#l43.71"></a><span id="l43.71" class="difflineat">@@ -286,17 +286,17 @@ nsMsgSearchAdapter::GetSearchCharsets(ns</span>
<a href="#l43.72"></a><span id="l43.72">     // source text to US-ASCII. (Not for now.)</span>
<a href="#l43.73"></a><span id="l43.73">     // if ((dst_csid == CS_LATIN1) || (dst_csid == CS_MAC_ROMAN))</span>
<a href="#l43.74"></a><span id="l43.74">     dstCharset.AssignLiteral(&quot;us-ascii&quot;);</span>
<a href="#l43.75"></a><span id="l43.75">   }</span>
<a href="#l43.76"></a><span id="l43.76"> </span>
<a href="#l43.77"></a><span id="l43.77">   return NS_OK;</span>
<a href="#l43.78"></a><span id="l43.78"> }</span>
<a href="#l43.79"></a><span id="l43.79"> </span>
<a href="#l43.80"></a><span id="l43.80" class="difflineminus">-nsresult nsMsgSearchAdapter::EncodeImapTerm (nsIMsgSearchTerm *term, bool reallyDredd, const PRUnichar *srcCharset, const PRUnichar *destCharset, char **ppOutTerm)</span>
<a href="#l43.81"></a><span id="l43.81" class="difflineplus">+nsresult nsMsgSearchAdapter::EncodeImapTerm (nsIMsgSearchTerm *term, bool reallyDredd, const char16_t *srcCharset, const char16_t *destCharset, char **ppOutTerm)</span>
<a href="#l43.82"></a><span id="l43.82"> {</span>
<a href="#l43.83"></a><span id="l43.83">   NS_ENSURE_ARG_POINTER(term);</span>
<a href="#l43.84"></a><span id="l43.84">   NS_ENSURE_ARG_POINTER(ppOutTerm);</span>
<a href="#l43.85"></a><span id="l43.85"> </span>
<a href="#l43.86"></a><span id="l43.86">   nsresult err = NS_OK;</span>
<a href="#l43.87"></a><span id="l43.87">   bool useNot = false;</span>
<a href="#l43.88"></a><span id="l43.88">   bool useQuotes = false;</span>
<a href="#l43.89"></a><span id="l43.89">   bool ignoreValue = false;</span>
<a href="#l43.90"></a><span id="l43.90" class="difflineat">@@ -519,34 +519,34 @@ nsresult nsMsgSearchAdapter::EncodeImapT</span>
<a href="#l43.91"></a><span id="l43.91"> </span>
<a href="#l43.92"></a><span id="l43.92">         value = ToNewCString(searchTermValue);</span>
<a href="#l43.93"></a><span id="l43.93">         valueWasAllocated = true;</span>
<a href="#l43.94"></a><span id="l43.94">       }</span>
<a href="#l43.95"></a><span id="l43.95">       else</span>
<a href="#l43.96"></a><span id="l43.96"> </span>
<a href="#l43.97"></a><span id="l43.97">       if (IS_STRING_ATTRIBUTE(attrib))</span>
<a href="#l43.98"></a><span id="l43.98">       {</span>
<a href="#l43.99"></a><span id="l43.99" class="difflineminus">-        PRUnichar *convertedValue; // = reallyDredd ? MSG_EscapeSearchUrl (term-&gt;m_value.u.string) : msg_EscapeImapSearchProtocol(term-&gt;m_value.u.string);</span>
<a href="#l43.100"></a><span id="l43.100" class="difflineplus">+        char16_t *convertedValue; // = reallyDredd ? MSG_EscapeSearchUrl (term-&gt;m_value.u.string) : msg_EscapeImapSearchProtocol(term-&gt;m_value.u.string);</span>
<a href="#l43.101"></a><span id="l43.101">         nsString searchTermValue;</span>
<a href="#l43.102"></a><span id="l43.102">         searchValue-&gt;GetStr(searchTermValue);</span>
<a href="#l43.103"></a><span id="l43.103">         // Ugly switch for Korean mail/news charsets.</span>
<a href="#l43.104"></a><span id="l43.104">         // We want to do this here because here is where</span>
<a href="#l43.105"></a><span id="l43.105">         // we know what charset we want to use.</span>
<a href="#l43.106"></a><span id="l43.106"> #ifdef DOING_CHARSET</span>
<a href="#l43.107"></a><span id="l43.107">         if (reallyDredd)</span>
<a href="#l43.108"></a><span id="l43.108">           dest_csid = INTL_DefaultNewsCharSetID(dest_csid);</span>
<a href="#l43.109"></a><span id="l43.109">         else</span>
<a href="#l43.110"></a><span id="l43.110">           dest_csid = INTL_DefaultMailCharSetID(dest_csid);</span>
<a href="#l43.111"></a><span id="l43.111"> #endif</span>
<a href="#l43.112"></a><span id="l43.112"> </span>
<a href="#l43.113"></a><span id="l43.113">         // do all sorts of crazy escaping</span>
<a href="#l43.114"></a><span id="l43.114">         convertedValue = reallyDredd ? EscapeSearchUrl (searchTermValue.get()) :</span>
<a href="#l43.115"></a><span id="l43.115">         EscapeImapSearchProtocol(searchTermValue.get());</span>
<a href="#l43.116"></a><span id="l43.116">         useQuotes = ((!reallyDredd ||</span>
<a href="#l43.117"></a><span id="l43.117" class="difflineminus">-                    (nsDependentString(convertedValue).FindChar(PRUnichar(' ')) != -1)) &amp;&amp;</span>
<a href="#l43.118"></a><span id="l43.118" class="difflineplus">+                    (nsDependentString(convertedValue).FindChar(char16_t(' ')) != -1)) &amp;&amp;</span>
<a href="#l43.119"></a><span id="l43.119">            (attrib != nsMsgSearchAttrib::Keywords));</span>
<a href="#l43.120"></a><span id="l43.120">         // now convert to char* and escape quoted_specials</span>
<a href="#l43.121"></a><span id="l43.121">         nsAutoCString valueStr;</span>
<a href="#l43.122"></a><span id="l43.122">         nsresult rv = ConvertFromUnicode(NS_LossyConvertUTF16toASCII(destCharset).get(),</span>
<a href="#l43.123"></a><span id="l43.123">           nsDependentString(convertedValue), valueStr);</span>
<a href="#l43.124"></a><span id="l43.124">         if (NS_SUCCEEDED(rv))</span>
<a href="#l43.125"></a><span id="l43.125">         {</span>
<a href="#l43.126"></a><span id="l43.126">           const char *vptr = valueStr.get();</span>
<a href="#l43.127"></a><span id="l43.127" class="difflineat">@@ -652,17 +652,17 @@ nsresult nsMsgSearchAdapter::EncodeImapV</span>
<a href="#l43.128"></a><span id="l43.128">   PL_strcat (encoding, value);</span>
<a href="#l43.129"></a><span id="l43.129">   if (useQuotes)</span>
<a href="#l43.130"></a><span id="l43.130">     PL_strcat(encoding, &quot;\&quot;&quot;);</span>
<a href="#l43.131"></a><span id="l43.131"> </span>
<a href="#l43.132"></a><span id="l43.132">   return NS_OK;</span>
<a href="#l43.133"></a><span id="l43.133"> }</span>
<a href="#l43.134"></a><span id="l43.134"> </span>
<a href="#l43.135"></a><span id="l43.135"> </span>
<a href="#l43.136"></a><span id="l43.136" class="difflineminus">-nsresult nsMsgSearchAdapter::EncodeImap (char **ppOutEncoding, nsISupportsArray *searchTerms, const PRUnichar *srcCharset, const PRUnichar *destCharset, bool reallyDredd)</span>
<a href="#l43.137"></a><span id="l43.137" class="difflineplus">+nsresult nsMsgSearchAdapter::EncodeImap (char **ppOutEncoding, nsISupportsArray *searchTerms, const char16_t *srcCharset, const char16_t *destCharset, bool reallyDredd)</span>
<a href="#l43.138"></a><span id="l43.138"> {</span>
<a href="#l43.139"></a><span id="l43.139">   // i've left the old code (before using CBoolExpression for debugging purposes to make sure that</span>
<a href="#l43.140"></a><span id="l43.140">   // the new code generates the same encoding string as the old code.....</span>
<a href="#l43.141"></a><span id="l43.141"> </span>
<a href="#l43.142"></a><span id="l43.142">   nsresult err = NS_OK;</span>
<a href="#l43.143"></a><span id="l43.143">   *ppOutEncoding = nullptr;</span>
<a href="#l43.144"></a><span id="l43.144"> </span>
<a href="#l43.145"></a><span id="l43.145">   uint32_t termCount;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchImap.h</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchImap.h</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -19,17 +19,17 @@ public:</span>
<a href="#l44.4"></a><span id="l44.4"> </span>
<a href="#l44.5"></a><span id="l44.5">   NS_IMETHOD ValidateTerms () MOZ_OVERRIDE;</span>
<a href="#l44.6"></a><span id="l44.6">   NS_IMETHOD Search (bool *aDone) MOZ_OVERRIDE;</span>
<a href="#l44.7"></a><span id="l44.7">   NS_IMETHOD GetEncoding (char **result) MOZ_OVERRIDE;</span>
<a href="#l44.8"></a><span id="l44.8">   NS_IMETHOD AddResultElement (nsIMsgDBHdr *) MOZ_OVERRIDE;</span>
<a href="#l44.9"></a><span id="l44.9"> </span>
<a href="#l44.10"></a><span id="l44.10">   static nsresult Encode (nsCString&amp; ppEncoding,</span>
<a href="#l44.11"></a><span id="l44.11">                             nsISupportsArray *searchTerms,</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-                            const PRUnichar *destCharset);</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+                            const char16_t *destCharset);</span>
<a href="#l44.14"></a><span id="l44.14"> </span>
<a href="#l44.15"></a><span id="l44.15"> </span>
<a href="#l44.16"></a><span id="l44.16"> protected:</span>
<a href="#l44.17"></a><span id="l44.17">   nsCString m_encoding;</span>
<a href="#l44.18"></a><span id="l44.18"> };</span>
<a href="#l44.19"></a><span id="l44.19"> </span>
<a href="#l44.20"></a><span id="l44.20"> </span>
<a href="#l44.21"></a><span id="l44.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchNews.cpp</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchNews.cpp</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -57,34 +57,34 @@ nsresult nsMsgSearchNews::ValidateTerms </span>
<a href="#l45.4"></a><span id="l45.4"> </span>
<a href="#l45.5"></a><span id="l45.5"> nsresult nsMsgSearchNews::Search (bool *aDone)</span>
<a href="#l45.6"></a><span id="l45.6"> {</span>
<a href="#l45.7"></a><span id="l45.7">   // the state machine runs in the news: handler</span>
<a href="#l45.8"></a><span id="l45.8">   nsresult err = NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l45.9"></a><span id="l45.9">   return err;</span>
<a href="#l45.10"></a><span id="l45.10"> }</span>
<a href="#l45.11"></a><span id="l45.11"> </span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-PRUnichar *nsMsgSearchNews::EncodeToWildmat (const PRUnichar *value)</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+char16_t *nsMsgSearchNews::EncodeToWildmat (const char16_t *value)</span>
<a href="#l45.14"></a><span id="l45.14"> {</span>
<a href="#l45.15"></a><span id="l45.15">   // Here we take advantage of XPAT's use of the wildmat format, which allows</span>
<a href="#l45.16"></a><span id="l45.16">   // a case-insensitive match by specifying each case possibility for each character</span>
<a href="#l45.17"></a><span id="l45.17">   // So, &quot;FooBar&quot; is encoded as &quot;[Ff][Oo][Bb][Aa][Rr]&quot;</span>
<a href="#l45.18"></a><span id="l45.18"> </span>
<a href="#l45.19"></a><span id="l45.19" class="difflineminus">-  PRUnichar *caseInsensitiveValue = (PRUnichar*) nsMemory::Alloc(sizeof(PRUnichar) * ((4 * NS_strlen(value)) + 1));</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineplus">+  char16_t *caseInsensitiveValue = (char16_t*) nsMemory::Alloc(sizeof(char16_t) * ((4 * NS_strlen(value)) + 1));</span>
<a href="#l45.21"></a><span id="l45.21">   if (caseInsensitiveValue)</span>
<a href="#l45.22"></a><span id="l45.22">   {</span>
<a href="#l45.23"></a><span id="l45.23" class="difflineminus">-    PRUnichar *walkValue = caseInsensitiveValue;</span>
<a href="#l45.24"></a><span id="l45.24" class="difflineplus">+    char16_t *walkValue = caseInsensitiveValue;</span>
<a href="#l45.25"></a><span id="l45.25">     while (*value)</span>
<a href="#l45.26"></a><span id="l45.26">     {</span>
<a href="#l45.27"></a><span id="l45.27">       if (isalpha(*value))</span>
<a href="#l45.28"></a><span id="l45.28">       {</span>
<a href="#l45.29"></a><span id="l45.29" class="difflineminus">-        *walkValue++ = (PRUnichar)'[';</span>
<a href="#l45.30"></a><span id="l45.30" class="difflineminus">-        *walkValue++ = ToUpperCase((PRUnichar)*value);</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-        *walkValue++ = ToLowerCase((PRUnichar)*value);</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineminus">-        *walkValue++ = (PRUnichar)']';</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineplus">+        *walkValue++ = (char16_t)'[';</span>
<a href="#l45.34"></a><span id="l45.34" class="difflineplus">+        *walkValue++ = ToUpperCase((char16_t)*value);</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineplus">+        *walkValue++ = ToLowerCase((char16_t)*value);</span>
<a href="#l45.36"></a><span id="l45.36" class="difflineplus">+        *walkValue++ = (char16_t)']';</span>
<a href="#l45.37"></a><span id="l45.37">       }</span>
<a href="#l45.38"></a><span id="l45.38">       else</span>
<a href="#l45.39"></a><span id="l45.39">         *walkValue++ = *value;</span>
<a href="#l45.40"></a><span id="l45.40">       value++;</span>
<a href="#l45.41"></a><span id="l45.41">     }</span>
<a href="#l45.42"></a><span id="l45.42">     *walkValue = 0;</span>
<a href="#l45.43"></a><span id="l45.43">   }</span>
<a href="#l45.44"></a><span id="l45.44">   return caseInsensitiveValue;</span>
<a href="#l45.45"></a><span id="l45.45" class="difflineat">@@ -165,35 +165,35 @@ char *nsMsgSearchNews::EncodeTerm (nsIMs</span>
<a href="#l45.46"></a><span id="l45.46">     return nullptr;</span>
<a href="#l45.47"></a><span id="l45.47"> </span>
<a href="#l45.48"></a><span id="l45.48"> </span>
<a href="#l45.49"></a><span id="l45.49">   nsString intlNonRFC1522Value;</span>
<a href="#l45.50"></a><span id="l45.50">   rv = searchValue-&gt;GetStr(intlNonRFC1522Value);</span>
<a href="#l45.51"></a><span id="l45.51">   if (NS_FAILED(rv) || intlNonRFC1522Value.IsEmpty())</span>
<a href="#l45.52"></a><span id="l45.52">     return nullptr;</span>
<a href="#l45.53"></a><span id="l45.53"> </span>
<a href="#l45.54"></a><span id="l45.54" class="difflineminus">-  PRUnichar *caseInsensitiveValue = EncodeToWildmat (intlNonRFC1522Value.get());</span>
<a href="#l45.55"></a><span id="l45.55" class="difflineplus">+  char16_t *caseInsensitiveValue = EncodeToWildmat (intlNonRFC1522Value.get());</span>
<a href="#l45.56"></a><span id="l45.56">   if (!caseInsensitiveValue)</span>
<a href="#l45.57"></a><span id="l45.57">     return nullptr;</span>
<a href="#l45.58"></a><span id="l45.58"> </span>
<a href="#l45.59"></a><span id="l45.59">   // TO DO: Do INTL_FormatNNTPXPATInRFC1522Format trick for non-ASCII string</span>
<a href="#l45.60"></a><span id="l45.60">   // Unfortunately, we currently do not handle xxx or xxx search in XPAT</span>
<a href="#l45.61"></a><span id="l45.61">   // Need to add the INTL_FormatNNTPXPATInRFC1522Format call after we can do that</span>
<a href="#l45.62"></a><span id="l45.62">   // so we should search a string in either RFC1522 format and non-RFC1522 format</span>
<a href="#l45.63"></a><span id="l45.63"> </span>
<a href="#l45.64"></a><span id="l45.64" class="difflineminus">-  PRUnichar *escapedValue = EscapeSearchUrl (caseInsensitiveValue);</span>
<a href="#l45.65"></a><span id="l45.65" class="difflineplus">+  char16_t *escapedValue = EscapeSearchUrl (caseInsensitiveValue);</span>
<a href="#l45.66"></a><span id="l45.66">   nsMemory::Free(caseInsensitiveValue);</span>
<a href="#l45.67"></a><span id="l45.67">   if (!escapedValue)</span>
<a href="#l45.68"></a><span id="l45.68">     return nullptr;</span>
<a href="#l45.69"></a><span id="l45.69"> </span>
<a href="#l45.70"></a><span id="l45.70"> #if 0</span>
<a href="#l45.71"></a><span id="l45.71">   // We also need to apply NET_Escape to it since we have to pass 8-bits data</span>
<a href="#l45.72"></a><span id="l45.72">   // And sometimes % in the 7-bit doulbe byte JIS</span>
<a href="#l45.73"></a><span id="l45.73">   //</span>
<a href="#l45.74"></a><span id="l45.74" class="difflineminus">-  PRUnichar * urlEncoded = nsEscape(escapedValue, url_Path);</span>
<a href="#l45.75"></a><span id="l45.75" class="difflineplus">+  char16_t * urlEncoded = nsEscape(escapedValue, url_Path);</span>
<a href="#l45.76"></a><span id="l45.76">   NS_Free(escapedValue);</span>
<a href="#l45.77"></a><span id="l45.77"> </span>
<a href="#l45.78"></a><span id="l45.78">   if (! urlEncoded)</span>
<a href="#l45.79"></a><span id="l45.79">     return nullptr;</span>
<a href="#l45.80"></a><span id="l45.80"> </span>
<a href="#l45.81"></a><span id="l45.81">   char *pattern = new char [NS_strlen(urlEncoded) + overhead];</span>
<a href="#l45.82"></a><span id="l45.82">   if (!pattern)</span>
<a href="#l45.83"></a><span id="l45.83">     return nullptr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchNews.h</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchNews.h</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -21,17 +21,17 @@ public:</span>
<a href="#l46.4"></a><span id="l46.4">   NS_IMETHOD ValidateTerms () MOZ_OVERRIDE;</span>
<a href="#l46.5"></a><span id="l46.5">   NS_IMETHOD Search (bool *aDone) MOZ_OVERRIDE;</span>
<a href="#l46.6"></a><span id="l46.6">   NS_IMETHOD GetEncoding (char **result) MOZ_OVERRIDE;</span>
<a href="#l46.7"></a><span id="l46.7">   NS_IMETHOD AddHit(nsMsgKey key) MOZ_OVERRIDE;</span>
<a href="#l46.8"></a><span id="l46.8">   NS_IMETHOD CurrentUrlDone(nsresult exitCode) MOZ_OVERRIDE;</span>
<a href="#l46.9"></a><span id="l46.9"> </span>
<a href="#l46.10"></a><span id="l46.10">   virtual nsresult Encode (nsCString *outEncoding);</span>
<a href="#l46.11"></a><span id="l46.11">   virtual char *EncodeTerm (nsIMsgSearchTerm *);</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-  PRUnichar *EncodeToWildmat (const PRUnichar *);</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+  char16_t *EncodeToWildmat (const char16_t *);</span>
<a href="#l46.14"></a><span id="l46.14"> </span>
<a href="#l46.15"></a><span id="l46.15">   void ReportHits ();</span>
<a href="#l46.16"></a><span id="l46.16">     void CollateHits ();</span>
<a href="#l46.17"></a><span id="l46.17">     void ReportHit (nsIMsgDBHdr *pHeaders, nsIMsgFolder *folder);</span>
<a href="#l46.18"></a><span id="l46.18"> </span>
<a href="#l46.19"></a><span id="l46.19"> protected:</span>
<a href="#l46.20"></a><span id="l46.20">   nsCString m_encoding;</span>
<a href="#l46.21"></a><span id="l46.21">   bool m_ORSearch; // set to true if any of the search terms contains an OR for a boolean operator.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -322,17 +322,17 @@ nsMessenger::PromptIfFileExists(nsIFile </span>
<a href="#l47.4"></a><span id="l47.4">   {</span>
<a href="#l47.5"></a><span id="l47.5">     nsCOMPtr&lt;nsIPrompt&gt; dialog(do_GetInterface(mDocShell));</span>
<a href="#l47.6"></a><span id="l47.6">     if (!dialog) return rv;</span>
<a href="#l47.7"></a><span id="l47.7">     nsAutoString path;</span>
<a href="#l47.8"></a><span id="l47.8">     bool dialogResult = false;</span>
<a href="#l47.9"></a><span id="l47.9">     nsString errorMessage;</span>
<a href="#l47.10"></a><span id="l47.10"> </span>
<a href="#l47.11"></a><span id="l47.11">     file-&gt;GetPath(path);</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-    const PRUnichar *pathFormatStrings[] = { path.get() };</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+    const char16_t *pathFormatStrings[] = { path.get() };</span>
<a href="#l47.14"></a><span id="l47.14"> </span>
<a href="#l47.15"></a><span id="l47.15">     if (!mStringBundle)</span>
<a href="#l47.16"></a><span id="l47.16">     {</span>
<a href="#l47.17"></a><span id="l47.17">       rv = InitStringBundle();</span>
<a href="#l47.18"></a><span id="l47.18">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.19"></a><span id="l47.19">     }</span>
<a href="#l47.20"></a><span id="l47.20">     rv = mStringBundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;fileExists&quot;),</span>
<a href="#l47.21"></a><span id="l47.21">                                              pathFormatStrings, 1,</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineat">@@ -1260,17 +1260,17 @@ nsMessenger::GetSaveToDir(nsIFile **aSav</span>
<a href="#l47.23"></a><span id="l47.23"> </span>
<a href="#l47.24"></a><span id="l47.24">   *aSaveDir = nullptr;</span>
<a href="#l47.25"></a><span id="l47.25">   dir.swap(*aSaveDir);</span>
<a href="#l47.26"></a><span id="l47.26">   return NS_OK;</span>
<a href="#l47.27"></a><span id="l47.27"> }</span>
<a href="#l47.28"></a><span id="l47.28"> </span>
<a href="#l47.29"></a><span id="l47.29"> NS_IMETHODIMP</span>
<a href="#l47.30"></a><span id="l47.30"> nsMessenger::SaveMessages(uint32_t aCount,</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-                          const PRUnichar **aFilenameArray,</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineplus">+                          const char16_t **aFilenameArray,</span>
<a href="#l47.33"></a><span id="l47.33">                           const char **aMessageUriArray)</span>
<a href="#l47.34"></a><span id="l47.34"> {</span>
<a href="#l47.35"></a><span id="l47.35">   NS_ENSURE_ARG_MIN(aCount, 1);</span>
<a href="#l47.36"></a><span id="l47.36">   NS_ENSURE_ARG_POINTER(aFilenameArray);</span>
<a href="#l47.37"></a><span id="l47.37">   NS_ENSURE_ARG_POINTER(aMessageUriArray);</span>
<a href="#l47.38"></a><span id="l47.38"> </span>
<a href="#l47.39"></a><span id="l47.39">   nsresult rv;</span>
<a href="#l47.40"></a><span id="l47.40"> </span>
<a href="#l47.41"></a><span id="l47.41" class="difflineat">@@ -2174,17 +2174,17 @@ NS_IMETHODIMP nsMessenger::OnItemIntProp</span>
<a href="#l47.42"></a><span id="l47.42"> </span>
<a href="#l47.43"></a><span id="l47.43"> /* void OnItemBoolPropertyChanged (in nsIMsgFolder item, in nsIAtom property, in boolean oldValue, in boolean newValue); */</span>
<a href="#l47.44"></a><span id="l47.44"> NS_IMETHODIMP nsMessenger::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l47.45"></a><span id="l47.45"> {</span>
<a href="#l47.46"></a><span id="l47.46">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l47.47"></a><span id="l47.47"> }</span>
<a href="#l47.48"></a><span id="l47.48"> </span>
<a href="#l47.49"></a><span id="l47.49"> /* void OnItemUnicharPropertyChanged (in nsIMsgFolder item, in nsIAtom property, in wstring oldValue, in wstring newValue); */</span>
<a href="#l47.50"></a><span id="l47.50" class="difflineminus">-NS_IMETHODIMP nsMessenger::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const PRUnichar *oldValue, const PRUnichar *newValue)</span>
<a href="#l47.51"></a><span id="l47.51" class="difflineplus">+NS_IMETHODIMP nsMessenger::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l47.52"></a><span id="l47.52"> {</span>
<a href="#l47.53"></a><span id="l47.53">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l47.54"></a><span id="l47.54"> }</span>
<a href="#l47.55"></a><span id="l47.55"> </span>
<a href="#l47.56"></a><span id="l47.56"> /* void OnItemPropertyFlagChanged (in nsIMsgDBHdr item, in nsIAtom property, in unsigned long oldFlag, in unsigned long newFlag); */</span>
<a href="#l47.57"></a><span id="l47.57"> NS_IMETHODIMP nsMessenger::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l47.58"></a><span id="l47.58"> {</span>
<a href="#l47.59"></a><span id="l47.59">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l47.60"></a><span id="l47.60" class="difflineat">@@ -2954,23 +2954,23 @@ nsMessenger::PromptIfDeleteAttachments(b</span>
<a href="#l47.61"></a><span id="l47.61"> </span>
<a href="#l47.62"></a><span id="l47.62">   // create the list of attachments we are removing</span>
<a href="#l47.63"></a><span id="l47.63">   nsString displayString;</span>
<a href="#l47.64"></a><span id="l47.64">   nsString attachmentList;</span>
<a href="#l47.65"></a><span id="l47.65">   for (uint32_t u = 0; u &lt; aCount; ++u)</span>
<a href="#l47.66"></a><span id="l47.66">   {</span>
<a href="#l47.67"></a><span id="l47.67">     ConvertAndSanitizeFileName(aDisplayNameArray[u], displayString);</span>
<a href="#l47.68"></a><span id="l47.68">     attachmentList.Append(displayString);</span>
<a href="#l47.69"></a><span id="l47.69" class="difflineminus">-    attachmentList.Append(PRUnichar('\n'));</span>
<a href="#l47.70"></a><span id="l47.70" class="difflineplus">+    attachmentList.Append(char16_t('\n'));</span>
<a href="#l47.71"></a><span id="l47.71">   }</span>
<a href="#l47.72"></a><span id="l47.72" class="difflineminus">-  const PRUnichar *formatStrings[] = { attachmentList.get() };</span>
<a href="#l47.73"></a><span id="l47.73" class="difflineplus">+  const char16_t *formatStrings[] = { attachmentList.get() };</span>
<a href="#l47.74"></a><span id="l47.74"> </span>
<a href="#l47.75"></a><span id="l47.75">   // format the message and display</span>
<a href="#l47.76"></a><span id="l47.76">   nsString promptMessage;</span>
<a href="#l47.77"></a><span id="l47.77" class="difflineminus">-  const PRUnichar * propertyName = aSaveFirst ?</span>
<a href="#l47.78"></a><span id="l47.78" class="difflineplus">+  const char16_t * propertyName = aSaveFirst ?</span>
<a href="#l47.79"></a><span id="l47.79">     MOZ_UTF16(&quot;detachAttachments&quot;) : MOZ_UTF16(&quot;deleteAttachments&quot;);</span>
<a href="#l47.80"></a><span id="l47.80">   rv = mStringBundle-&gt;FormatStringFromName(propertyName, formatStrings, 1,getter_Copies(promptMessage));</span>
<a href="#l47.81"></a><span id="l47.81">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.82"></a><span id="l47.82"> </span>
<a href="#l47.83"></a><span id="l47.83">   bool dialogResult = false;</span>
<a href="#l47.84"></a><span id="l47.84">   rv = dialog-&gt;Confirm(nullptr, promptMessage.get(), &amp;dialogResult);</span>
<a href="#l47.85"></a><span id="l47.85">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.86"></a><span id="l47.86"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOS2Integration.cpp</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOS2Integration.cpp</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -75,17 +75,17 @@ nsMessengerOS2Integration::Init()</span>
<a href="#l48.4"></a><span id="l48.4"> </span>
<a href="#l48.5"></a><span id="l48.5"> NS_IMETHODIMP</span>
<a href="#l48.6"></a><span id="l48.6"> nsMessengerOS2Integration::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l48.7"></a><span id="l48.7"> {</span>
<a href="#l48.8"></a><span id="l48.8">   return NS_OK;</span>
<a href="#l48.9"></a><span id="l48.9"> }</span>
<a href="#l48.10"></a><span id="l48.10"> </span>
<a href="#l48.11"></a><span id="l48.11"> NS_IMETHODIMP</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-nsMessengerOS2Integration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const PRUnichar *, const PRUnichar *)</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+nsMessengerOS2Integration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const char16_t *, const char16_t *)</span>
<a href="#l48.14"></a><span id="l48.14"> {</span>
<a href="#l48.15"></a><span id="l48.15">   return NS_OK;</span>
<a href="#l48.16"></a><span id="l48.16"> }</span>
<a href="#l48.17"></a><span id="l48.17"> </span>
<a href="#l48.18"></a><span id="l48.18"> NS_IMETHODIMP</span>
<a href="#l48.19"></a><span id="l48.19"> nsMessengerOS2Integration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l48.20"></a><span id="l48.20"> {</span>
<a href="#l48.21"></a><span id="l48.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -38,17 +38,17 @@ public:</span>
<a href="#l49.4"></a><span id="l49.4">   NS_DECL_NSIOBSERVER</span>
<a href="#l49.5"></a><span id="l49.5">   NS_DECL_MOZINEWMAILLISTENER</span>
<a href="#l49.6"></a><span id="l49.6"> </span>
<a href="#l49.7"></a><span id="l49.7"> private:</span>
<a href="#l49.8"></a><span id="l49.8">   nsCOMPtr&lt;nsIAtom&gt; mBiffStateAtom;</span>
<a href="#l49.9"></a><span id="l49.9">   nsCOMPtr&lt;nsIAtom&gt; mNewMailReceivedAtom;</span>
<a href="#l49.10"></a><span id="l49.10">   nsresult ShowAlertMessage(const nsAString&amp; aAlertTitle, const nsAString&amp; aAlertText, const nsACString&amp; aFolderURI);</span>
<a href="#l49.11"></a><span id="l49.11">   nsresult OnAlertFinished();</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  nsresult OnAlertClicked(const PRUnichar * aAlertCookie);</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+  nsresult OnAlertClicked(const char16_t * aAlertCookie);</span>
<a href="#l49.14"></a><span id="l49.14"> #ifdef MOZ_SUITE</span>
<a href="#l49.15"></a><span id="l49.15">   nsresult OnAlertClickedSimple();</span>
<a href="#l49.16"></a><span id="l49.16"> #endif</span>
<a href="#l49.17"></a><span id="l49.17">   nsresult GetStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l49.18"></a><span id="l49.18">   void FillToolTipInfo(nsIMsgFolder *aFolder, int32_t aNewCount);</span>
<a href="#l49.19"></a><span id="l49.19">   nsresult GetFirstFolderWithNewMail(nsIMsgFolder* aFolder, nsCString&amp; aFolderURI);</span>
<a href="#l49.20"></a><span id="l49.20">   nsresult BadgeDockIcon();</span>
<a href="#l49.21"></a><span id="l49.21">   nsresult RestoreDockIcon();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -193,29 +193,29 @@ nsMessengerOSXIntegration::Init()</span>
<a href="#l50.4"></a><span id="l50.4"> </span>
<a href="#l50.5"></a><span id="l50.5"> NS_IMETHODIMP</span>
<a href="#l50.6"></a><span id="l50.6"> nsMessengerOSXIntegration::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l50.7"></a><span id="l50.7"> {</span>
<a href="#l50.8"></a><span id="l50.8">   return NS_OK;</span>
<a href="#l50.9"></a><span id="l50.9"> }</span>
<a href="#l50.10"></a><span id="l50.10"> </span>
<a href="#l50.11"></a><span id="l50.11"> NS_IMETHODIMP</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-nsMessengerOSXIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const PRUnichar *, const PRUnichar *)</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+nsMessengerOSXIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const char16_t *, const char16_t *)</span>
<a href="#l50.14"></a><span id="l50.14"> {</span>
<a href="#l50.15"></a><span id="l50.15">   return NS_OK;</span>
<a href="#l50.16"></a><span id="l50.16"> }</span>
<a href="#l50.17"></a><span id="l50.17"> </span>
<a href="#l50.18"></a><span id="l50.18"> NS_IMETHODIMP</span>
<a href="#l50.19"></a><span id="l50.19"> nsMessengerOSXIntegration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l50.20"></a><span id="l50.20"> {</span>
<a href="#l50.21"></a><span id="l50.21">   return NS_OK;</span>
<a href="#l50.22"></a><span id="l50.22"> }</span>
<a href="#l50.23"></a><span id="l50.23"> </span>
<a href="#l50.24"></a><span id="l50.24"> NS_IMETHODIMP</span>
<a href="#l50.25"></a><span id="l50.25" class="difflineminus">-nsMessengerOSXIntegration::Observe(nsISupports* aSubject, const char* aTopic, const PRUnichar* aData)</span>
<a href="#l50.26"></a><span id="l50.26" class="difflineplus">+nsMessengerOSXIntegration::Observe(nsISupports* aSubject, const char* aTopic, const char16_t* aData)</span>
<a href="#l50.27"></a><span id="l50.27"> {</span>
<a href="#l50.28"></a><span id="l50.28">   if (!strcmp(aTopic, &quot;alertfinished&quot;))</span>
<a href="#l50.29"></a><span id="l50.29">     return OnAlertFinished();</span>
<a href="#l50.30"></a><span id="l50.30"> </span>
<a href="#l50.31"></a><span id="l50.31">   if (!strcmp(aTopic, &quot;alertclickcallback&quot;))</span>
<a href="#l50.32"></a><span id="l50.32">     return OnAlertClicked(aData);</span>
<a href="#l50.33"></a><span id="l50.33"> </span>
<a href="#l50.34"></a><span id="l50.34"> #ifdef MOZ_SUITE</span>
<a href="#l50.35"></a><span id="l50.35" class="difflineat">@@ -327,25 +327,25 @@ nsMessengerOSXIntegration::FillToolTipIn</span>
<a href="#l50.36"></a><span id="l50.36">       nsString finalText;</span>
<a href="#l50.37"></a><span id="l50.37">       nsCString uri;</span>
<a href="#l50.38"></a><span id="l50.38">       aFolder-&gt;GetURI(uri);</span>
<a href="#l50.39"></a><span id="l50.39"> </span>
<a href="#l50.40"></a><span id="l50.40">       if (numNotDisplayed &gt; 0)</span>
<a href="#l50.41"></a><span id="l50.41">       {</span>
<a href="#l50.42"></a><span id="l50.42">         nsAutoString numNotDisplayedText;</span>
<a href="#l50.43"></a><span id="l50.43">         numNotDisplayedText.AppendInt(numNotDisplayed);</span>
<a href="#l50.44"></a><span id="l50.44" class="difflineminus">-        const PRUnichar *formatStrings[3] = { numNewMsgsText.get(), authors.get(), numNotDisplayedText.get() };</span>
<a href="#l50.45"></a><span id="l50.45" class="difflineplus">+        const char16_t *formatStrings[3] = { numNewMsgsText.get(), authors.get(), numNotDisplayedText.get() };</span>
<a href="#l50.46"></a><span id="l50.46">         bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;macBiffNotification_messages_extra&quot;),</span>
<a href="#l50.47"></a><span id="l50.47">                                      formatStrings,</span>
<a href="#l50.48"></a><span id="l50.48">                                      3,</span>
<a href="#l50.49"></a><span id="l50.49">                                      getter_Copies(finalText));</span>
<a href="#l50.50"></a><span id="l50.50">       }</span>
<a href="#l50.51"></a><span id="l50.51">       else</span>
<a href="#l50.52"></a><span id="l50.52">       {</span>
<a href="#l50.53"></a><span id="l50.53" class="difflineminus">-        const PRUnichar *formatStrings[2] = { numNewMsgsText.get(), authors.get() };</span>
<a href="#l50.54"></a><span id="l50.54" class="difflineplus">+        const char16_t *formatStrings[2] = { numNewMsgsText.get(), authors.get() };</span>
<a href="#l50.55"></a><span id="l50.55"> </span>
<a href="#l50.56"></a><span id="l50.56">         if (aNewCount == 1)</span>
<a href="#l50.57"></a><span id="l50.57">         {</span>
<a href="#l50.58"></a><span id="l50.58">           bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;macBiffNotification_message&quot;),</span>
<a href="#l50.59"></a><span id="l50.59">                                        formatStrings,</span>
<a href="#l50.60"></a><span id="l50.60">                                        2,</span>
<a href="#l50.61"></a><span id="l50.61">                                        getter_Copies(finalText));</span>
<a href="#l50.62"></a><span id="l50.62">           // Since there is only 1 message, use the most recent mail's URI instead of the folder's</span>
<a href="#l50.63"></a><span id="l50.63" class="difflineat">@@ -446,17 +446,17 @@ nsMessengerOSXIntegration::OnItemIntProp</span>
<a href="#l50.64"></a><span id="l50.64">   else if (mNewMailReceivedAtom == aProperty)</span>
<a href="#l50.65"></a><span id="l50.65">   {</span>
<a href="#l50.66"></a><span id="l50.66">     FillToolTipInfo(aFolder, aNewValue);</span>
<a href="#l50.67"></a><span id="l50.67">   }</span>
<a href="#l50.68"></a><span id="l50.68">   return NS_OK;</span>
<a href="#l50.69"></a><span id="l50.69"> }</span>
<a href="#l50.70"></a><span id="l50.70"> </span>
<a href="#l50.71"></a><span id="l50.71"> nsresult</span>
<a href="#l50.72"></a><span id="l50.72" class="difflineminus">-nsMessengerOSXIntegration::OnAlertClicked(const PRUnichar* aAlertCookie)</span>
<a href="#l50.73"></a><span id="l50.73" class="difflineplus">+nsMessengerOSXIntegration::OnAlertClicked(const char16_t* aAlertCookie)</span>
<a href="#l50.74"></a><span id="l50.74"> {</span>
<a href="#l50.75"></a><span id="l50.75">   openMailWindow(NS_ConvertUTF16toUTF8(aAlertCookie));</span>
<a href="#l50.76"></a><span id="l50.76">   return NS_OK;</span>
<a href="#l50.77"></a><span id="l50.77"> }</span>
<a href="#l50.78"></a><span id="l50.78"> </span>
<a href="#l50.79"></a><span id="l50.79"> #ifdef MOZ_SUITE</span>
<a href="#l50.80"></a><span id="l50.80"> nsresult</span>
<a href="#l50.81"></a><span id="l50.81"> nsMessengerOSXIntegration::OnAlertClickedSimple()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -123,17 +123,17 @@ nsMessengerUnixIntegration::Init()</span>
<a href="#l51.4"></a><span id="l51.4"> </span>
<a href="#l51.5"></a><span id="l51.5"> NS_IMETHODIMP</span>
<a href="#l51.6"></a><span id="l51.6"> nsMessengerUnixIntegration::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l51.7"></a><span id="l51.7"> {</span>
<a href="#l51.8"></a><span id="l51.8">   return NS_OK;</span>
<a href="#l51.9"></a><span id="l51.9"> }</span>
<a href="#l51.10"></a><span id="l51.10"> </span>
<a href="#l51.11"></a><span id="l51.11"> NS_IMETHODIMP</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-nsMessengerUnixIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const PRUnichar *, const PRUnichar *)</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+nsMessengerUnixIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const char16_t *, const char16_t *)</span>
<a href="#l51.14"></a><span id="l51.14"> {</span>
<a href="#l51.15"></a><span id="l51.15">   return NS_OK;</span>
<a href="#l51.16"></a><span id="l51.16"> }</span>
<a href="#l51.17"></a><span id="l51.17"> </span>
<a href="#l51.18"></a><span id="l51.18"> NS_IMETHODIMP</span>
<a href="#l51.19"></a><span id="l51.19"> nsMessengerUnixIntegration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l51.20"></a><span id="l51.20"> {</span>
<a href="#l51.21"></a><span id="l51.21">   return NS_OK;</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineat">@@ -162,17 +162,17 @@ nsMessengerUnixIntegration::BuildNotific</span>
<a href="#l51.23"></a><span id="l51.23">   aFolder-&gt;GetNumNewMessages(true, &amp;numNewMessages);</span>
<a href="#l51.24"></a><span id="l51.24"> </span>
<a href="#l51.25"></a><span id="l51.25">   if (!numNewMessages)</span>
<a href="#l51.26"></a><span id="l51.26">     return false;</span>
<a href="#l51.27"></a><span id="l51.27"> </span>
<a href="#l51.28"></a><span id="l51.28">   nsAutoString numNewMsgsText;</span>
<a href="#l51.29"></a><span id="l51.29">   numNewMsgsText.AppendInt(numNewMessages);</span>
<a href="#l51.30"></a><span id="l51.30"> </span>
<a href="#l51.31"></a><span id="l51.31" class="difflineminus">-  const PRUnichar *formatStrings[] =</span>
<a href="#l51.32"></a><span id="l51.32" class="difflineplus">+  const char16_t *formatStrings[] =</span>
<a href="#l51.33"></a><span id="l51.33">   {</span>
<a href="#l51.34"></a><span id="l51.34">     accountName.get(), numNewMsgsText.get()</span>
<a href="#l51.35"></a><span id="l51.35">   };</span>
<a href="#l51.36"></a><span id="l51.36"> </span>
<a href="#l51.37"></a><span id="l51.37">   aBundle-&gt;FormatStringFromName(numNewMessages == 1 ?</span>
<a href="#l51.38"></a><span id="l51.38">                                   MOZ_UTF16(&quot;newMailNotification_message&quot;) :</span>
<a href="#l51.39"></a><span id="l51.39">                                   MOZ_UTF16(&quot;newMailNotification_messages&quot;),</span>
<a href="#l51.40"></a><span id="l51.40">                                 formatStrings, 2, getter_Copies(aTitle));</span>
<a href="#l51.41"></a><span id="l51.41" class="difflineat">@@ -283,17 +283,17 @@ nsMessengerUnixIntegration::BuildNotific</span>
<a href="#l51.42"></a><span id="l51.42">       return false;</span>
<a href="#l51.43"></a><span id="l51.43"> </span>
<a href="#l51.44"></a><span id="l51.44">     ExtractName(DecodedHeader(fullHeader), author);</span>
<a href="#l51.45"></a><span id="l51.45">   }</span>
<a href="#l51.46"></a><span id="l51.46"> </span>
<a href="#l51.47"></a><span id="l51.47">   if (showSubject &amp;&amp; showSender)</span>
<a href="#l51.48"></a><span id="l51.48">   {</span>
<a href="#l51.49"></a><span id="l51.49">     nsString msgTitle;</span>
<a href="#l51.50"></a><span id="l51.50" class="difflineminus">-    const PRUnichar *formatStrings[] =</span>
<a href="#l51.51"></a><span id="l51.51" class="difflineplus">+    const char16_t *formatStrings[] =</span>
<a href="#l51.52"></a><span id="l51.52">     {</span>
<a href="#l51.53"></a><span id="l51.53">       subject.get(), author.get()</span>
<a href="#l51.54"></a><span id="l51.54">     };</span>
<a href="#l51.55"></a><span id="l51.55">     aBundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;newMailNotification_messagetitle&quot;),</span>
<a href="#l51.56"></a><span id="l51.56">         formatStrings, 2, getter_Copies(msgTitle));</span>
<a href="#l51.57"></a><span id="l51.57">     alertBody.Append(msgTitle);</span>
<a href="#l51.58"></a><span id="l51.58">   }</span>
<a href="#l51.59"></a><span id="l51.59">   else if (showSubject)</span>
<a href="#l51.60"></a><span id="l51.60" class="difflineat">@@ -427,17 +427,17 @@ nsresult nsMessengerUnixIntegration::Ale</span>
<a href="#l51.61"></a><span id="l51.61"> {</span>
<a href="#l51.62"></a><span id="l51.62">   nsCString folderURI;</span>
<a href="#l51.63"></a><span id="l51.63">   GetFirstFolderWithNewMail(folderURI);</span>
<a href="#l51.64"></a><span id="l51.64">   openMailWindow(folderURI);</span>
<a href="#l51.65"></a><span id="l51.65">   return NS_OK;</span>
<a href="#l51.66"></a><span id="l51.66"> }</span>
<a href="#l51.67"></a><span id="l51.67"> </span>
<a href="#l51.68"></a><span id="l51.68"> NS_IMETHODIMP</span>
<a href="#l51.69"></a><span id="l51.69" class="difflineminus">-nsMessengerUnixIntegration::Observe(nsISupports* aSubject, const char* aTopic, const PRUnichar* aData)</span>
<a href="#l51.70"></a><span id="l51.70" class="difflineplus">+nsMessengerUnixIntegration::Observe(nsISupports* aSubject, const char* aTopic, const char16_t* aData)</span>
<a href="#l51.71"></a><span id="l51.71"> {</span>
<a href="#l51.72"></a><span id="l51.72">   if (strcmp(aTopic, &quot;alertfinished&quot;) == 0)</span>
<a href="#l51.73"></a><span id="l51.73">     return AlertFinished();</span>
<a href="#l51.74"></a><span id="l51.74">   if (strcmp(aTopic, &quot;alertclickcallback&quot;) == 0)</span>
<a href="#l51.75"></a><span id="l51.75">     return AlertClicked();</span>
<a href="#l51.76"></a><span id="l51.76"> </span>
<a href="#l51.77"></a><span id="l51.77">   return NS_OK;</span>
<a href="#l51.78"></a><span id="l51.78"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -369,32 +369,32 @@ nsMessengerWinIntegration::Init()</span>
<a href="#l52.4"></a><span id="l52.4">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l52.5"></a><span id="l52.5"> </span>
<a href="#l52.6"></a><span id="l52.6">   rv = profilePath-&gt;GetPath(mProfilePath);</span>
<a href="#l52.7"></a><span id="l52.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.8"></a><span id="l52.8"> </span>
<a href="#l52.9"></a><span id="l52.9">   // get application path</span>
<a href="#l52.10"></a><span id="l52.10">   WCHAR appPath[_MAX_PATH] = {0};</span>
<a href="#l52.11"></a><span id="l52.11">   ::GetModuleFileNameW(nullptr, appPath, sizeof(appPath));</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  mAppName.Assign((PRUnichar *)appPath);</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  mAppName.Assign((char16_t *)appPath);</span>
<a href="#l52.14"></a><span id="l52.14"> </span>
<a href="#l52.15"></a><span id="l52.15">   rv = ResetCurrent();</span>
<a href="#l52.16"></a><span id="l52.16">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l52.17"></a><span id="l52.17"> </span>
<a href="#l52.18"></a><span id="l52.18">   return NS_OK;</span>
<a href="#l52.19"></a><span id="l52.19"> }</span>
<a href="#l52.20"></a><span id="l52.20"> </span>
<a href="#l52.21"></a><span id="l52.21"> NS_IMETHODIMP</span>
<a href="#l52.22"></a><span id="l52.22"> nsMessengerWinIntegration::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l52.23"></a><span id="l52.23"> {</span>
<a href="#l52.24"></a><span id="l52.24">   return NS_OK;</span>
<a href="#l52.25"></a><span id="l52.25"> }</span>
<a href="#l52.26"></a><span id="l52.26"> </span>
<a href="#l52.27"></a><span id="l52.27"> NS_IMETHODIMP</span>
<a href="#l52.28"></a><span id="l52.28" class="difflineminus">-nsMessengerWinIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const PRUnichar *, const PRUnichar *)</span>
<a href="#l52.29"></a><span id="l52.29" class="difflineplus">+nsMessengerWinIntegration::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const char16_t *, const char16_t *)</span>
<a href="#l52.30"></a><span id="l52.30"> {</span>
<a href="#l52.31"></a><span id="l52.31">   return NS_OK;</span>
<a href="#l52.32"></a><span id="l52.32"> }</span>
<a href="#l52.33"></a><span id="l52.33"> </span>
<a href="#l52.34"></a><span id="l52.34"> NS_IMETHODIMP</span>
<a href="#l52.35"></a><span id="l52.35"> nsMessengerWinIntegration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l52.36"></a><span id="l52.36"> {</span>
<a href="#l52.37"></a><span id="l52.37">   return NS_OK;</span>
<a href="#l52.38"></a><span id="l52.38" class="difflineat">@@ -641,17 +641,17 @@ nsresult nsMessengerWinIntegration::Aler</span>
<a href="#l52.39"></a><span id="l52.39"> nsresult nsMessengerWinIntegration::AlertClickedSimple()</span>
<a href="#l52.40"></a><span id="l52.40"> {</span>
<a href="#l52.41"></a><span id="l52.41">   mSuppressBiffIcon = true;</span>
<a href="#l52.42"></a><span id="l52.42">   return NS_OK;</span>
<a href="#l52.43"></a><span id="l52.43"> }</span>
<a href="#l52.44"></a><span id="l52.44"> #endif MOZ_SUITE</span>
<a href="#l52.45"></a><span id="l52.45"> </span>
<a href="#l52.46"></a><span id="l52.46"> NS_IMETHODIMP</span>
<a href="#l52.47"></a><span id="l52.47" class="difflineminus">-nsMessengerWinIntegration::Observe(nsISupports* aSubject, const char* aTopic, const PRUnichar* aData)</span>
<a href="#l52.48"></a><span id="l52.48" class="difflineplus">+nsMessengerWinIntegration::Observe(nsISupports* aSubject, const char* aTopic, const char16_t* aData)</span>
<a href="#l52.49"></a><span id="l52.49"> {</span>
<a href="#l52.50"></a><span id="l52.50">   if (strcmp(aTopic, &quot;alertfinished&quot;) == 0)</span>
<a href="#l52.51"></a><span id="l52.51">       return AlertFinished();</span>
<a href="#l52.52"></a><span id="l52.52"> </span>
<a href="#l52.53"></a><span id="l52.53">   if (strcmp(aTopic, &quot;alertclickcallback&quot;) == 0)</span>
<a href="#l52.54"></a><span id="l52.54">       return AlertClicked();</span>
<a href="#l52.55"></a><span id="l52.55"> </span>
<a href="#l52.56"></a><span id="l52.56"> #ifdef MOZ_SUITE</span>
<a href="#l52.57"></a><span id="l52.57" class="difflineat">@@ -719,17 +719,17 @@ void nsMessengerWinIntegration::FillTool</span>
<a href="#l52.58"></a><span id="l52.58">       folder-&gt;GetNumNewMessages(true, &amp;numNewMessages);</span>
<a href="#l52.59"></a><span id="l52.59">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l52.60"></a><span id="l52.60">       GetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l52.61"></a><span id="l52.61">       if (bundle)</span>
<a href="#l52.62"></a><span id="l52.62">       {</span>
<a href="#l52.63"></a><span id="l52.63">         nsAutoString numNewMsgsText;</span>
<a href="#l52.64"></a><span id="l52.64">         numNewMsgsText.AppendInt(numNewMessages);</span>
<a href="#l52.65"></a><span id="l52.65"> </span>
<a href="#l52.66"></a><span id="l52.66" class="difflineminus">-        const PRUnichar *formatStrings[] =</span>
<a href="#l52.67"></a><span id="l52.67" class="difflineplus">+        const char16_t *formatStrings[] =</span>
<a href="#l52.68"></a><span id="l52.68">         {</span>
<a href="#l52.69"></a><span id="l52.69">           numNewMsgsText.get(),</span>
<a href="#l52.70"></a><span id="l52.70">         };</span>
<a href="#l52.71"></a><span id="l52.71"> </span>
<a href="#l52.72"></a><span id="l52.72">         nsString finalText;</span>
<a href="#l52.73"></a><span id="l52.73">         if (numNewMessages == 1)</span>
<a href="#l52.74"></a><span id="l52.74">           bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;biffNotification_message&quot;), formatStrings, 1, getter_Copies(finalText));</span>
<a href="#l52.75"></a><span id="l52.75">         else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -232,17 +232,17 @@ nsMsgAccountManager::GetUserNeedsToAuthe</span>
<a href="#l53.4"></a><span id="l53.4"> </span>
<a href="#l53.5"></a><span id="l53.5"> NS_IMETHODIMP</span>
<a href="#l53.6"></a><span id="l53.6"> nsMsgAccountManager::SetUserNeedsToAuthenticate(bool aUserNeedsToAuthenticate)</span>
<a href="#l53.7"></a><span id="l53.7"> {</span>
<a href="#l53.8"></a><span id="l53.8">   m_userAuthenticated = !aUserNeedsToAuthenticate;</span>
<a href="#l53.9"></a><span id="l53.9">   return NS_OK;</span>
<a href="#l53.10"></a><span id="l53.10"> }</span>
<a href="#l53.11"></a><span id="l53.11"> </span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-NS_IMETHODIMP nsMsgAccountManager::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData)</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+NS_IMETHODIMP nsMsgAccountManager::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *someData)</span>
<a href="#l53.14"></a><span id="l53.14"> {</span>
<a href="#l53.15"></a><span id="l53.15">   if(!strcmp(aTopic,NS_XPCOM_SHUTDOWN_OBSERVER_ID))</span>
<a href="#l53.16"></a><span id="l53.16">   {</span>
<a href="#l53.17"></a><span id="l53.17">     Shutdown();</span>
<a href="#l53.18"></a><span id="l53.18">     return NS_OK;</span>
<a href="#l53.19"></a><span id="l53.19">   }</span>
<a href="#l53.20"></a><span id="l53.20">   if (!strcmp(aTopic, &quot;quit-application-granted&quot;))</span>
<a href="#l53.21"></a><span id="l53.21">   {</span>
<a href="#l53.22"></a><span id="l53.22" class="difflineat">@@ -3658,17 +3658,17 @@ nsMsgAccountManager::RemoveFolderFromSma</span>
<a href="#l53.23"></a><span id="l53.23">   return NS_OK;</span>
<a href="#l53.24"></a><span id="l53.24"> }</span>
<a href="#l53.25"></a><span id="l53.25"> </span>
<a href="#l53.26"></a><span id="l53.26"> NS_IMETHODIMP nsMsgAccountManager::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l53.27"></a><span id="l53.27"> {</span>
<a href="#l53.28"></a><span id="l53.28">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l53.29"></a><span id="l53.29"> }</span>
<a href="#l53.30"></a><span id="l53.30"> </span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-NS_IMETHODIMP nsMsgAccountManager::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const PRUnichar *oldValue, const PRUnichar *newValue)</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineplus">+NS_IMETHODIMP nsMsgAccountManager::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l53.33"></a><span id="l53.33"> {</span>
<a href="#l53.34"></a><span id="l53.34">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l53.35"></a><span id="l53.35"> }</span>
<a href="#l53.36"></a><span id="l53.36"> </span>
<a href="#l53.37"></a><span id="l53.37"> </span>
<a href="#l53.38"></a><span id="l53.38"> NS_IMETHODIMP nsMsgAccountManager::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l53.39"></a><span id="l53.39"> {</span>
<a href="#l53.40"></a><span id="l53.40">   return NS_ERROR_NOT_IMPLEMENTED;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -1119,17 +1119,17 @@ nsMsgAccountManagerDataSource::OnServerC</span>
<a href="#l54.4"></a><span id="l54.4"> </span>
<a href="#l54.5"></a><span id="l54.5"> nsresult</span>
<a href="#l54.6"></a><span id="l54.6"> nsMsgAccountManagerDataSource::OnItemPropertyChanged(nsIMsgFolder *, nsIAtom *, char const *, char const *)</span>
<a href="#l54.7"></a><span id="l54.7"> {</span>
<a href="#l54.8"></a><span id="l54.8">   return NS_OK;</span>
<a href="#l54.9"></a><span id="l54.9"> }</span>
<a href="#l54.10"></a><span id="l54.10"> </span>
<a href="#l54.11"></a><span id="l54.11"> nsresult</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const PRUnichar *, const PRUnichar *)</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+nsMsgAccountManagerDataSource::OnItemUnicharPropertyChanged(nsIMsgFolder *, nsIAtom *, const char16_t *, const char16_t *)</span>
<a href="#l54.14"></a><span id="l54.14"> {</span>
<a href="#l54.15"></a><span id="l54.15">   return NS_OK;</span>
<a href="#l54.16"></a><span id="l54.16"> }</span>
<a href="#l54.17"></a><span id="l54.17"> </span>
<a href="#l54.18"></a><span id="l54.18"> nsresult</span>
<a href="#l54.19"></a><span id="l54.19"> nsMsgAccountManagerDataSource::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l54.20"></a><span id="l54.20"> {</span>
<a href="#l54.21"></a><span id="l54.21">   return NS_OK;</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineat">@@ -1169,14 +1169,14 @@ nsMsgAccountManagerDataSource::OnItemEve</span>
<a href="#l54.23"></a><span id="l54.23"> </span>
<a href="#l54.24"></a><span id="l54.24"> nsresult</span>
<a href="#l54.25"></a><span id="l54.25"> nsMsgAccountManagerDataSource::OnItemIntPropertyChanged(nsIMsgFolder *, nsIAtom *, int32_t, int32_t)</span>
<a href="#l54.26"></a><span id="l54.26"> {</span>
<a href="#l54.27"></a><span id="l54.27">   return NS_OK;</span>
<a href="#l54.28"></a><span id="l54.28"> }</span>
<a href="#l54.29"></a><span id="l54.29"> </span>
<a href="#l54.30"></a><span id="l54.30"> NS_IMETHODIMP</span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-nsMsgAccountManagerDataSource::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *aData)</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineplus">+nsMsgAccountManagerDataSource::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *aData)</span>
<a href="#l54.33"></a><span id="l54.33"> {</span>
<a href="#l54.34"></a><span id="l54.34">   nsMsgRDFDataSource::Observe(aSubject, aTopic, aData);</span>
<a href="#l54.35"></a><span id="l54.35"> </span>
<a href="#l54.36"></a><span id="l54.36">   return NS_OK;</span>
<a href="#l54.37"></a><span id="l54.37"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -113,17 +113,17 @@ NS_IMETHODIMP nsMsgBiffManager::Shutdown</span>
<a href="#l55.4"></a><span id="l55.4">   if (NS_SUCCEEDED(rv))</span>
<a href="#l55.5"></a><span id="l55.5">     accountManager-&gt;RemoveIncomingServerListener(this);</span>
<a href="#l55.6"></a><span id="l55.6"> </span>
<a href="#l55.7"></a><span id="l55.7">   mHaveShutdown = true;</span>
<a href="#l55.8"></a><span id="l55.8">   mInited = false;</span>
<a href="#l55.9"></a><span id="l55.9">   return NS_OK;</span>
<a href="#l55.10"></a><span id="l55.10"> }</span>
<a href="#l55.11"></a><span id="l55.11"> </span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-NS_IMETHODIMP nsMsgBiffManager::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData)</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+NS_IMETHODIMP nsMsgBiffManager::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *someData)</span>
<a href="#l55.14"></a><span id="l55.14"> {</span>
<a href="#l55.15"></a><span id="l55.15">   if (!strcmp(aTopic, &quot;sleep_notification&quot;) &amp;&amp; mBiffTimer)</span>
<a href="#l55.16"></a><span id="l55.16">   {</span>
<a href="#l55.17"></a><span id="l55.17">     mBiffTimer-&gt;Cancel();</span>
<a href="#l55.18"></a><span id="l55.18">     mBiffTimer = nullptr;</span>
<a href="#l55.19"></a><span id="l55.19">   }</span>
<a href="#l55.20"></a><span id="l55.20">   else if (!strcmp(aTopic, &quot;wake_notification&quot;))</span>
<a href="#l55.21"></a><span id="l55.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -776,17 +776,17 @@ nsMsgContentPolicy::ShouldProcess(uint32</span>
<a href="#l56.4"></a><span id="l56.4">   // think that ShouldLoad is going to catch all possible cases (i.e. that</span>
<a href="#l56.5"></a><span id="l56.5">   // everything we use to make decisions is going to be available at </span>
<a href="#l56.6"></a><span id="l56.6">   // ShouldLoad time, and not only become available in time for ShouldProcess).</span>
<a href="#l56.7"></a><span id="l56.7">   // Do we think that's actually the case?</span>
<a href="#l56.8"></a><span id="l56.8">   *aDecision = nsIContentPolicy::ACCEPT;</span>
<a href="#l56.9"></a><span id="l56.9">   return NS_OK;</span>
<a href="#l56.10"></a><span id="l56.10"> }</span>
<a href="#l56.11"></a><span id="l56.11"> </span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-NS_IMETHODIMP nsMsgContentPolicy::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *aData)</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+NS_IMETHODIMP nsMsgContentPolicy::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *aData)</span>
<a href="#l56.14"></a><span id="l56.14"> {</span>
<a href="#l56.15"></a><span id="l56.15">   if (!strcmp(NS_PREFBRANCH_PREFCHANGE_TOPIC_ID, aTopic)) </span>
<a href="#l56.16"></a><span id="l56.16">   {</span>
<a href="#l56.17"></a><span id="l56.17">     NS_LossyConvertUTF16toASCII pref(aData);</span>
<a href="#l56.18"></a><span id="l56.18"> </span>
<a href="#l56.19"></a><span id="l56.19">     nsresult rv;</span>
<a href="#l56.20"></a><span id="l56.20"> </span>
<a href="#l56.21"></a><span id="l56.21">     nsCOMPtr&lt;nsIPrefBranch&gt; prefBranchInt = do_QueryInterface(aSubject, &amp;rv);</span>
<a href="#l56.22"></a><span id="l56.22" class="difflineat">@@ -875,17 +875,17 @@ nsMsgContentPolicy::OnLocationChange(nsI</span>
<a href="#l56.23"></a><span id="l56.23">   }</span>
<a href="#l56.24"></a><span id="l56.24"> </span>
<a href="#l56.25"></a><span id="l56.25">   return NS_OK;</span>
<a href="#l56.26"></a><span id="l56.26"> }</span>
<a href="#l56.27"></a><span id="l56.27"> </span>
<a href="#l56.28"></a><span id="l56.28"> NS_IMETHODIMP</span>
<a href="#l56.29"></a><span id="l56.29"> nsMsgContentPolicy::OnStatusChange(nsIWebProgress *aWebProgress,</span>
<a href="#l56.30"></a><span id="l56.30">                                    nsIRequest *aRequest, nsresult aStatus,</span>
<a href="#l56.31"></a><span id="l56.31" class="difflineminus">-                                   const PRUnichar *aMessage)</span>
<a href="#l56.32"></a><span id="l56.32" class="difflineplus">+                                   const char16_t *aMessage)</span>
<a href="#l56.33"></a><span id="l56.33"> {</span>
<a href="#l56.34"></a><span id="l56.34">   return NS_OK;</span>
<a href="#l56.35"></a><span id="l56.35"> }</span>
<a href="#l56.36"></a><span id="l56.36"> </span>
<a href="#l56.37"></a><span id="l56.37"> NS_IMETHODIMP</span>
<a href="#l56.38"></a><span id="l56.38"> nsMsgContentPolicy::OnSecurityChange(nsIWebProgress *aWebProgress,</span>
<a href="#l56.39"></a><span id="l56.39">                                      nsIRequest *aRequest, uint32_t aState)</span>
<a href="#l56.40"></a><span id="l56.40"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -53,25 +53,25 @@</span>
<a href="#l57.4"></a><span id="l57.4"> #include &lt;algorithm&gt;</span>
<a href="#l57.5"></a><span id="l57.5"> </span>
<a href="#l57.6"></a><span id="l57.6"> using namespace mozilla::mailnews;</span>
<a href="#l57.7"></a><span id="l57.7"> nsrefcnt nsMsgDBView::gInstanceCount  = 0;</span>
<a href="#l57.8"></a><span id="l57.8"> </span>
<a href="#l57.9"></a><span id="l57.9"> nsIAtom * nsMsgDBView::kJunkMsgAtom = nullptr;</span>
<a href="#l57.10"></a><span id="l57.10"> nsIAtom * nsMsgDBView::kNotJunkMsgAtom = nullptr;</span>
<a href="#l57.11"></a><span id="l57.11"> </span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-PRUnichar * nsMsgDBView::kHighestPriorityString = nullptr;</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineminus">-PRUnichar * nsMsgDBView::kHighPriorityString = nullptr;</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineminus">-PRUnichar * nsMsgDBView::kLowestPriorityString = nullptr;</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineminus">-PRUnichar * nsMsgDBView::kLowPriorityString = nullptr;</span>
<a href="#l57.16"></a><span id="l57.16" class="difflineminus">-PRUnichar * nsMsgDBView::kNormalPriorityString = nullptr;</span>
<a href="#l57.17"></a><span id="l57.17" class="difflineminus">-PRUnichar * nsMsgDBView::kReadString = nullptr;</span>
<a href="#l57.18"></a><span id="l57.18" class="difflineminus">-PRUnichar * nsMsgDBView::kRepliedString = nullptr;</span>
<a href="#l57.19"></a><span id="l57.19" class="difflineminus">-PRUnichar * nsMsgDBView::kForwardedString = nullptr;</span>
<a href="#l57.20"></a><span id="l57.20" class="difflineminus">-PRUnichar * nsMsgDBView::kNewString = nullptr;</span>
<a href="#l57.21"></a><span id="l57.21" class="difflineplus">+char16_t * nsMsgDBView::kHighestPriorityString = nullptr;</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineplus">+char16_t * nsMsgDBView::kHighPriorityString = nullptr;</span>
<a href="#l57.23"></a><span id="l57.23" class="difflineplus">+char16_t * nsMsgDBView::kLowestPriorityString = nullptr;</span>
<a href="#l57.24"></a><span id="l57.24" class="difflineplus">+char16_t * nsMsgDBView::kLowPriorityString = nullptr;</span>
<a href="#l57.25"></a><span id="l57.25" class="difflineplus">+char16_t * nsMsgDBView::kNormalPriorityString = nullptr;</span>
<a href="#l57.26"></a><span id="l57.26" class="difflineplus">+char16_t * nsMsgDBView::kReadString = nullptr;</span>
<a href="#l57.27"></a><span id="l57.27" class="difflineplus">+char16_t * nsMsgDBView::kRepliedString = nullptr;</span>
<a href="#l57.28"></a><span id="l57.28" class="difflineplus">+char16_t * nsMsgDBView::kForwardedString = nullptr;</span>
<a href="#l57.29"></a><span id="l57.29" class="difflineplus">+char16_t * nsMsgDBView::kNewString = nullptr;</span>
<a href="#l57.30"></a><span id="l57.30"> </span>
<a href="#l57.31"></a><span id="l57.31"> nsDateFormatSelector  nsMsgDBView::m_dateFormatDefault = kDateFormatShort;</span>
<a href="#l57.32"></a><span id="l57.32"> nsDateFormatSelector  nsMsgDBView::m_dateFormatThisWeek = kDateFormatShort;</span>
<a href="#l57.33"></a><span id="l57.33"> nsDateFormatSelector  nsMsgDBView::m_dateFormatToday = kDateFormatNone;</span>
<a href="#l57.34"></a><span id="l57.34"> </span>
<a href="#l57.35"></a><span id="l57.35"> static const uint32_t kMaxNumSortColumns = 2;</span>
<a href="#l57.36"></a><span id="l57.36"> </span>
<a href="#l57.37"></a><span id="l57.37"> static void GetCachedName(const nsCString&amp; unparsedString,</span>
<a href="#l57.38"></a><span id="l57.38" class="difflineat">@@ -202,20 +202,20 @@ nsresult nsMsgDBView::InitLabelStrings()</span>
<a href="#l57.39"></a><span id="l57.39">     prefString.Assign(PREF_LABELS_DESCRIPTION);</span>
<a href="#l57.40"></a><span id="l57.40">     prefString.AppendInt(i + 1);</span>
<a href="#l57.41"></a><span id="l57.41">     rv = GetPrefLocalizedString(prefString.get(), mLabelPrefDescriptions[i]);</span>
<a href="#l57.42"></a><span id="l57.42">   }</span>
<a href="#l57.43"></a><span id="l57.43">   return rv;</span>
<a href="#l57.44"></a><span id="l57.44"> }</span>
<a href="#l57.45"></a><span id="l57.45"> </span>
<a href="#l57.46"></a><span id="l57.46"> // helper function used to fetch strings from the messenger string bundle</span>
<a href="#l57.47"></a><span id="l57.47" class="difflineminus">-PRUnichar * nsMsgDBView::GetString(const PRUnichar *aStringName)</span>
<a href="#l57.48"></a><span id="l57.48" class="difflineplus">+char16_t * nsMsgDBView::GetString(const char16_t *aStringName)</span>
<a href="#l57.49"></a><span id="l57.49"> {</span>
<a href="#l57.50"></a><span id="l57.50">   nsresult    res = NS_ERROR_UNEXPECTED;</span>
<a href="#l57.51"></a><span id="l57.51" class="difflineminus">-  PRUnichar   *ptrv = nullptr;</span>
<a href="#l57.52"></a><span id="l57.52" class="difflineplus">+  char16_t   *ptrv = nullptr;</span>
<a href="#l57.53"></a><span id="l57.53"> </span>
<a href="#l57.54"></a><span id="l57.54">   if (!mMessengerStringBundle)</span>
<a href="#l57.55"></a><span id="l57.55">   {</span>
<a href="#l57.56"></a><span id="l57.56">     static const char propertyURL[] = MESSENGER_STRING_URL;</span>
<a href="#l57.57"></a><span id="l57.57">     nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l57.58"></a><span id="l57.58">       mozilla::services::GetStringBundleService();</span>
<a href="#l57.59"></a><span id="l57.59">     if (sBundleService)</span>
<a href="#l57.60"></a><span id="l57.60">       res = sBundleService-&gt;CreateBundle(propertyURL, getter_AddRefs(mMessengerStringBundle));</span>
<a href="#l57.61"></a><span id="l57.61" class="difflineat">@@ -788,17 +788,17 @@ nsresult nsMsgDBView::FetchTags(nsIMsgDB</span>
<a href="#l57.62"></a><span id="l57.62">   nsAutoString tag;</span>
<a href="#l57.63"></a><span id="l57.63"> </span>
<a href="#l57.64"></a><span id="l57.64">   for (uint32_t i = 0; i &lt; keywordsArray.Length(); i++)</span>
<a href="#l57.65"></a><span id="l57.65">   {</span>
<a href="#l57.66"></a><span id="l57.66">     rv = mTagService-&gt;GetTagForKey(keywordsArray[i], tag);</span>
<a href="#l57.67"></a><span id="l57.67">     if (NS_SUCCEEDED(rv) &amp;&amp; !tag.IsEmpty())</span>
<a href="#l57.68"></a><span id="l57.68">     {</span>
<a href="#l57.69"></a><span id="l57.69">       if (!tags.IsEmpty())</span>
<a href="#l57.70"></a><span id="l57.70" class="difflineminus">-        tags.Append((PRUnichar) ' ');</span>
<a href="#l57.71"></a><span id="l57.71" class="difflineplus">+        tags.Append((char16_t) ' ');</span>
<a href="#l57.72"></a><span id="l57.72">       tags.Append(tag);</span>
<a href="#l57.73"></a><span id="l57.73">     }</span>
<a href="#l57.74"></a><span id="l57.74">   }</span>
<a href="#l57.75"></a><span id="l57.75"> </span>
<a href="#l57.76"></a><span id="l57.76">   aTagString = tags;</span>
<a href="#l57.77"></a><span id="l57.77">   return NS_OK;</span>
<a href="#l57.78"></a><span id="l57.78"> }</span>
<a href="#l57.79"></a><span id="l57.79"> </span>
<a href="#l57.80"></a><span id="l57.80" class="difflineat">@@ -951,17 +951,17 @@ nsresult nsMsgDBView::CycleThreadedColum</span>
<a href="#l57.81"></a><span id="l57.81">   return NS_OK;</span>
<a href="#l57.82"></a><span id="l57.82"> }</span>
<a href="#l57.83"></a><span id="l57.83"> </span>
<a href="#l57.84"></a><span id="l57.84"> NS_IMETHODIMP nsMsgDBView::IsEditable(int32_t row, nsITreeColumn* col, bool* _retval)</span>
<a href="#l57.85"></a><span id="l57.85"> {</span>
<a href="#l57.86"></a><span id="l57.86">   NS_ENSURE_ARG_POINTER(col);</span>
<a href="#l57.87"></a><span id="l57.87">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l57.88"></a><span id="l57.88">   //attempt to retreive a custom column handler. If it exists call it and return</span>
<a href="#l57.89"></a><span id="l57.89" class="difflineminus">-  const PRUnichar* colID;</span>
<a href="#l57.90"></a><span id="l57.90" class="difflineplus">+  const char16_t* colID;</span>
<a href="#l57.91"></a><span id="l57.91">   col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l57.92"></a><span id="l57.92"> </span>
<a href="#l57.93"></a><span id="l57.93">   nsIMsgCustomColumnHandler* colHandler = GetColumnHandler(colID);</span>
<a href="#l57.94"></a><span id="l57.94"> </span>
<a href="#l57.95"></a><span id="l57.95">   if (colHandler)</span>
<a href="#l57.96"></a><span id="l57.96">   {</span>
<a href="#l57.97"></a><span id="l57.97">     colHandler-&gt;IsEditable(row, col, _retval);</span>
<a href="#l57.98"></a><span id="l57.98">     return NS_OK;</span>
<a href="#l57.99"></a><span id="l57.99" class="difflineat">@@ -1315,17 +1315,17 @@ NS_IMETHODIMP nsMsgDBView::GetCellProper</span>
<a href="#l57.100"></a><span id="l57.100">   rv = GetMsgHdrForViewIndex(aRow, getter_AddRefs(msgHdr));</span>
<a href="#l57.101"></a><span id="l57.101"> </span>
<a href="#l57.102"></a><span id="l57.102">   if (NS_FAILED(rv) || !msgHdr)</span>
<a href="#l57.103"></a><span id="l57.103">   {</span>
<a href="#l57.104"></a><span id="l57.104">     ClearHdrCache();</span>
<a href="#l57.105"></a><span id="l57.105">     return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l57.106"></a><span id="l57.106">   }</span>
<a href="#l57.107"></a><span id="l57.107"> </span>
<a href="#l57.108"></a><span id="l57.108" class="difflineminus">-  const PRUnichar* colID;</span>
<a href="#l57.109"></a><span id="l57.109" class="difflineplus">+  const char16_t* colID;</span>
<a href="#l57.110"></a><span id="l57.110">   col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l57.111"></a><span id="l57.111">   nsIMsgCustomColumnHandler* colHandler = GetColumnHandler(colID);</span>
<a href="#l57.112"></a><span id="l57.112">   if (colHandler != nullptr)</span>
<a href="#l57.113"></a><span id="l57.113">     colHandler-&gt;GetCellProperties(aRow, col, properties);</span>
<a href="#l57.114"></a><span id="l57.114"> </span>
<a href="#l57.115"></a><span id="l57.115">   if (!properties.IsEmpty())</span>
<a href="#l57.116"></a><span id="l57.116">     properties.Append(' ');</span>
<a href="#l57.117"></a><span id="l57.117"> </span>
<a href="#l57.118"></a><span id="l57.118" class="difflineat">@@ -1641,17 +1641,17 @@ nsresult nsMsgDBView::GetDBForViewIndex(</span>
<a href="#l57.119"></a><span id="l57.119">   NS_IF_ADDREF(*db = m_db);</span>
<a href="#l57.120"></a><span id="l57.120">   return NS_OK;</span>
<a href="#l57.121"></a><span id="l57.121"> }</span>
<a href="#l57.122"></a><span id="l57.122"> </span>
<a href="#l57.123"></a><span id="l57.123"> NS_IMETHODIMP nsMsgDBView::GetImageSrc(int32_t aRow, nsITreeColumn* aCol, nsAString&amp; aValue)</span>
<a href="#l57.124"></a><span id="l57.124"> {</span>
<a href="#l57.125"></a><span id="l57.125">   NS_ENSURE_ARG_POINTER(aCol);</span>
<a href="#l57.126"></a><span id="l57.126">   //attempt to retreive a custom column handler. If it exists call it and return</span>
<a href="#l57.127"></a><span id="l57.127" class="difflineminus">-  const PRUnichar* colID;</span>
<a href="#l57.128"></a><span id="l57.128" class="difflineplus">+  const char16_t* colID;</span>
<a href="#l57.129"></a><span id="l57.129">   aCol-&gt;GetIdConst(&amp;colID);</span>
<a href="#l57.130"></a><span id="l57.130"> </span>
<a href="#l57.131"></a><span id="l57.131">   nsIMsgCustomColumnHandler* colHandler = GetColumnHandler(colID);</span>
<a href="#l57.132"></a><span id="l57.132"> </span>
<a href="#l57.133"></a><span id="l57.133">   if (colHandler)</span>
<a href="#l57.134"></a><span id="l57.134">   {</span>
<a href="#l57.135"></a><span id="l57.135">     colHandler-&gt;GetImageSrc(aRow, aCol, aValue);</span>
<a href="#l57.136"></a><span id="l57.136">     return NS_OK;</span>
<a href="#l57.137"></a><span id="l57.137" class="difflineat">@@ -1675,17 +1675,17 @@ NS_IMETHODIMP nsMsgDBView::GetCellValue(</span>
<a href="#l57.138"></a><span id="l57.138">   nsresult rv = GetMsgHdrForViewIndex(aRow, getter_AddRefs(msgHdr));</span>
<a href="#l57.139"></a><span id="l57.139"> </span>
<a href="#l57.140"></a><span id="l57.140">   if (NS_FAILED(rv) || !msgHdr)</span>
<a href="#l57.141"></a><span id="l57.141">   {</span>
<a href="#l57.142"></a><span id="l57.142">     ClearHdrCache();</span>
<a href="#l57.143"></a><span id="l57.143">     return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l57.144"></a><span id="l57.144">   }</span>
<a href="#l57.145"></a><span id="l57.145"> </span>
<a href="#l57.146"></a><span id="l57.146" class="difflineminus">-  const PRUnichar* colID;</span>
<a href="#l57.147"></a><span id="l57.147" class="difflineplus">+  const char16_t* colID;</span>
<a href="#l57.148"></a><span id="l57.148">   aCol-&gt;GetIdConst(&amp;colID);</span>
<a href="#l57.149"></a><span id="l57.149"> </span>
<a href="#l57.150"></a><span id="l57.150">   uint32_t flags;</span>
<a href="#l57.151"></a><span id="l57.151">   msgHdr-&gt;GetFlags(&amp;flags);</span>
<a href="#l57.152"></a><span id="l57.152"> </span>
<a href="#l57.153"></a><span id="l57.153">   aValue.Truncate();</span>
<a href="#l57.154"></a><span id="l57.154">   // provide a string &quot;value&quot; for cells that do not normally have text.</span>
<a href="#l57.155"></a><span id="l57.155">   // use empty string for the normal states &quot;Read&quot;, &quot;Not Starred&quot;, &quot;No Attachment&quot; and &quot;Not Junk&quot;</span>
<a href="#l57.156"></a><span id="l57.156" class="difflineat">@@ -1866,33 +1866,33 @@ NS_IMETHODIMP nsMsgDBView::GetCurCustomC</span>
<a href="#l57.157"></a><span id="l57.157">   m_db-&gt;GetDBFolderInfo(getter_AddRefs(dbInfo));</span>
<a href="#l57.158"></a><span id="l57.158"> </span>
<a href="#l57.159"></a><span id="l57.159">   if (!dbInfo)</span>
<a href="#l57.160"></a><span id="l57.160">     return NS_ERROR_FAILURE;</span>
<a href="#l57.161"></a><span id="l57.161"> </span>
<a href="#l57.162"></a><span id="l57.162">   return dbInfo-&gt;GetProperty(&quot;customSortCol&quot;, result);</span>
<a href="#l57.163"></a><span id="l57.163"> }</span>
<a href="#l57.164"></a><span id="l57.164"> </span>
<a href="#l57.165"></a><span id="l57.165" class="difflineminus">-nsIMsgCustomColumnHandler* nsMsgDBView::GetColumnHandler(const PRUnichar *colID)</span>
<a href="#l57.166"></a><span id="l57.166" class="difflineplus">+nsIMsgCustomColumnHandler* nsMsgDBView::GetColumnHandler(const char16_t *colID)</span>
<a href="#l57.167"></a><span id="l57.167"> {</span>
<a href="#l57.168"></a><span id="l57.168">   int32_t index = m_customColumnHandlerIDs.IndexOf(nsDependentString(colID));</span>
<a href="#l57.169"></a><span id="l57.169">   return (index &gt; -1) ? m_customColumnHandlers[index] : nullptr;</span>
<a href="#l57.170"></a><span id="l57.170"> }</span>
<a href="#l57.171"></a><span id="l57.171"> </span>
<a href="#l57.172"></a><span id="l57.172"> NS_IMETHODIMP nsMsgDBView::GetColumnHandler(const nsAString&amp; aColID, nsIMsgCustomColumnHandler** aHandler)</span>
<a href="#l57.173"></a><span id="l57.173"> {</span>
<a href="#l57.174"></a><span id="l57.174">   NS_ENSURE_ARG_POINTER(aHandler);</span>
<a href="#l57.175"></a><span id="l57.175">   nsAutoString column(aColID);</span>
<a href="#l57.176"></a><span id="l57.176">   NS_IF_ADDREF(*aHandler = GetColumnHandler(column.get()));</span>
<a href="#l57.177"></a><span id="l57.177">   return (*aHandler) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l57.178"></a><span id="l57.178"> }</span>
<a href="#l57.179"></a><span id="l57.179"> </span>
<a href="#l57.180"></a><span id="l57.180"> NS_IMETHODIMP nsMsgDBView::GetCellText(int32_t aRow, nsITreeColumn* aCol, nsAString&amp; aValue)</span>
<a href="#l57.181"></a><span id="l57.181"> {</span>
<a href="#l57.182"></a><span id="l57.182" class="difflineminus">-  const PRUnichar* colID;</span>
<a href="#l57.183"></a><span id="l57.183" class="difflineplus">+  const char16_t* colID;</span>
<a href="#l57.184"></a><span id="l57.184">   aCol-&gt;GetIdConst(&amp;colID);</span>
<a href="#l57.185"></a><span id="l57.185"> </span>
<a href="#l57.186"></a><span id="l57.186">   if (!IsValidIndex(aRow))</span>
<a href="#l57.187"></a><span id="l57.187">     return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l57.188"></a><span id="l57.188"> </span>
<a href="#l57.189"></a><span id="l57.189">   aValue.Truncate();</span>
<a href="#l57.190"></a><span id="l57.190"> </span>
<a href="#l57.191"></a><span id="l57.191">   //attempt to retreive a custom column handler. If it exists call it and return</span>
<a href="#l57.192"></a><span id="l57.192" class="difflineat">@@ -1903,17 +1903,17 @@ NS_IMETHODIMP nsMsgDBView::GetCellText(i</span>
<a href="#l57.193"></a><span id="l57.193">     colHandler-&gt;GetCellText(aRow, aCol, aValue);</span>
<a href="#l57.194"></a><span id="l57.194">     return NS_OK;</span>
<a href="#l57.195"></a><span id="l57.195">   }</span>
<a href="#l57.196"></a><span id="l57.196"> </span>
<a href="#l57.197"></a><span id="l57.197">   return CellTextForColumn(aRow, colID, aValue);</span>
<a href="#l57.198"></a><span id="l57.198"> }</span>
<a href="#l57.199"></a><span id="l57.199"> </span>
<a href="#l57.200"></a><span id="l57.200"> NS_IMETHODIMP nsMsgDBView::CellTextForColumn(int32_t aRow,</span>
<a href="#l57.201"></a><span id="l57.201" class="difflineminus">-                                             const PRUnichar *aColumnName,</span>
<a href="#l57.202"></a><span id="l57.202" class="difflineplus">+                                             const char16_t *aColumnName,</span>
<a href="#l57.203"></a><span id="l57.203">                                              nsAString &amp;aValue)</span>
<a href="#l57.204"></a><span id="l57.204"> {</span>
<a href="#l57.205"></a><span id="l57.205">   nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l57.206"></a><span id="l57.206">   nsresult rv = GetMsgHdrForViewIndex(aRow, getter_AddRefs(msgHdr));</span>
<a href="#l57.207"></a><span id="l57.207"> </span>
<a href="#l57.208"></a><span id="l57.208">   if (NS_FAILED(rv) || !msgHdr)</span>
<a href="#l57.209"></a><span id="l57.209">   {</span>
<a href="#l57.210"></a><span id="l57.210">     ClearHdrCache();</span>
<a href="#l57.211"></a><span id="l57.211" class="difflineat">@@ -2040,17 +2040,17 @@ NS_IMETHODIMP nsMsgDBView::CycleHeader(n</span>
<a href="#l57.212"></a><span id="l57.212">     return NS_OK;</span>
<a href="#l57.213"></a><span id="l57.213"> }</span>
<a href="#l57.214"></a><span id="l57.214"> </span>
<a href="#l57.215"></a><span id="l57.215"> NS_IMETHODIMP nsMsgDBView::CycleCell(int32_t row, nsITreeColumn* col)</span>
<a href="#l57.216"></a><span id="l57.216"> {</span>
<a href="#l57.217"></a><span id="l57.217">   if (!IsValidIndex(row))</span>
<a href="#l57.218"></a><span id="l57.218">     return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l57.219"></a><span id="l57.219"> </span>
<a href="#l57.220"></a><span id="l57.220" class="difflineminus">-  const PRUnichar* colID;</span>
<a href="#l57.221"></a><span id="l57.221" class="difflineplus">+  const char16_t* colID;</span>
<a href="#l57.222"></a><span id="l57.222">   col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l57.223"></a><span id="l57.223"> </span>
<a href="#l57.224"></a><span id="l57.224">   //attempt to retreive a custom column handler. If it exists call it and return</span>
<a href="#l57.225"></a><span id="l57.225">   nsIMsgCustomColumnHandler* colHandler = GetColumnHandler(colID);</span>
<a href="#l57.226"></a><span id="l57.226"> </span>
<a href="#l57.227"></a><span id="l57.227">   if (colHandler)</span>
<a href="#l57.228"></a><span id="l57.228">   {</span>
<a href="#l57.229"></a><span id="l57.229">     colHandler-&gt;CycleCell(row, col);</span>
<a href="#l57.230"></a><span id="l57.230" class="difflineat">@@ -2106,27 +2106,27 @@ NS_IMETHODIMP nsMsgDBView::CycleCell(int</span>
<a href="#l57.231"></a><span id="l57.231">     break;</span>
<a href="#l57.232"></a><span id="l57.232">   default:</span>
<a href="#l57.233"></a><span id="l57.233">     break;</span>
<a href="#l57.234"></a><span id="l57.234"> </span>
<a href="#l57.235"></a><span id="l57.235">   }</span>
<a href="#l57.236"></a><span id="l57.236">   return NS_OK;</span>
<a href="#l57.237"></a><span id="l57.237"> }</span>
<a href="#l57.238"></a><span id="l57.238"> </span>
<a href="#l57.239"></a><span id="l57.239" class="difflineminus">-NS_IMETHODIMP nsMsgDBView::PerformAction(const PRUnichar *action)</span>
<a href="#l57.240"></a><span id="l57.240" class="difflineplus">+NS_IMETHODIMP nsMsgDBView::PerformAction(const char16_t *action)</span>
<a href="#l57.241"></a><span id="l57.241"> {</span>
<a href="#l57.242"></a><span id="l57.242">   return NS_OK;</span>
<a href="#l57.243"></a><span id="l57.243"> }</span>
<a href="#l57.244"></a><span id="l57.244"> </span>
<a href="#l57.245"></a><span id="l57.245" class="difflineminus">-NS_IMETHODIMP nsMsgDBView::PerformActionOnRow(const PRUnichar *action, int32_t row)</span>
<a href="#l57.246"></a><span id="l57.246" class="difflineplus">+NS_IMETHODIMP nsMsgDBView::PerformActionOnRow(const char16_t *action, int32_t row)</span>
<a href="#l57.247"></a><span id="l57.247"> {</span>
<a href="#l57.248"></a><span id="l57.248">   return NS_OK;</span>
<a href="#l57.249"></a><span id="l57.249"> }</span>
<a href="#l57.250"></a><span id="l57.250"> </span>
<a href="#l57.251"></a><span id="l57.251" class="difflineminus">-NS_IMETHODIMP nsMsgDBView::PerformActionOnCell(const PRUnichar *action, int32_t row, nsITreeColumn* col)</span>
<a href="#l57.252"></a><span id="l57.252" class="difflineplus">+NS_IMETHODIMP nsMsgDBView::PerformActionOnCell(const char16_t *action, int32_t row, nsITreeColumn* col)</span>
<a href="#l57.253"></a><span id="l57.253"> {</span>
<a href="#l57.254"></a><span id="l57.254">   return NS_OK;</span>
<a href="#l57.255"></a><span id="l57.255"> }</span>
<a href="#l57.256"></a><span id="l57.256"> </span>
<a href="#l57.257"></a><span id="l57.257"> ///////////////////////////////////////////////////////////////////////////</span>
<a href="#l57.258"></a><span id="l57.258"> // end nsITreeView Implementation Methods</span>
<a href="#l57.259"></a><span id="l57.259"> ///////////////////////////////////////////////////////////////////////////</span>
<a href="#l57.260"></a><span id="l57.260"> </span>
<a href="#l57.261"></a><span id="l57.261" class="difflineat">@@ -3995,25 +3995,25 @@ nsresult nsMsgDBView::EncodeColumnSort(n</span>
<a href="#l57.262"></a><span id="l57.262">   for (uint32_t i = 0; i &lt; m_sortColumns.Length(); i++)</span>
<a href="#l57.263"></a><span id="l57.263">   {</span>
<a href="#l57.264"></a><span id="l57.264">     MsgViewSortColumnInfo &amp;sortInfo = m_sortColumns[i];</span>
<a href="#l57.265"></a><span id="l57.265">     columnSortString.Append((char) sortInfo.mSortType);</span>
<a href="#l57.266"></a><span id="l57.266">     columnSortString.Append((char) sortInfo.mSortOrder + '0');</span>
<a href="#l57.267"></a><span id="l57.267">     if (sortInfo.mSortType == nsMsgViewSortType::byCustom)</span>
<a href="#l57.268"></a><span id="l57.268">     {</span>
<a href="#l57.269"></a><span id="l57.269">       columnSortString.Append(sortInfo.mCustomColumnName);</span>
<a href="#l57.270"></a><span id="l57.270" class="difflineminus">-      columnSortString.Append((PRUnichar) '\r');</span>
<a href="#l57.271"></a><span id="l57.271" class="difflineplus">+      columnSortString.Append((char16_t) '\r');</span>
<a href="#l57.272"></a><span id="l57.272">     }</span>
<a href="#l57.273"></a><span id="l57.273">   }</span>
<a href="#l57.274"></a><span id="l57.274">   return NS_OK;</span>
<a href="#l57.275"></a><span id="l57.275"> }</span>
<a href="#l57.276"></a><span id="l57.276"> </span>
<a href="#l57.277"></a><span id="l57.277"> nsresult nsMsgDBView::DecodeColumnSort(nsString &amp;columnSortString)</span>
<a href="#l57.278"></a><span id="l57.278"> {</span>
<a href="#l57.279"></a><span id="l57.279" class="difflineminus">-  const PRUnichar *stringPtr = columnSortString.BeginReading();</span>
<a href="#l57.280"></a><span id="l57.280" class="difflineplus">+  const char16_t *stringPtr = columnSortString.BeginReading();</span>
<a href="#l57.281"></a><span id="l57.281">   while (*stringPtr)</span>
<a href="#l57.282"></a><span id="l57.282">   {</span>
<a href="#l57.283"></a><span id="l57.283">     MsgViewSortColumnInfo sortColumnInfo;</span>
<a href="#l57.284"></a><span id="l57.284">     sortColumnInfo.mSortType = (nsMsgViewSortTypeValue) *stringPtr++;</span>
<a href="#l57.285"></a><span id="l57.285">     sortColumnInfo.mSortOrder = (nsMsgViewSortOrderValue) (*stringPtr++) - '0';</span>
<a href="#l57.286"></a><span id="l57.286">     if (sortColumnInfo.mSortType == nsMsgViewSortType::byCustom)</span>
<a href="#l57.287"></a><span id="l57.287">     {</span>
<a href="#l57.288"></a><span id="l57.288">       while (*stringPtr &amp;&amp; *stringPtr != '\r')</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -111,29 +111,29 @@ public:</span>
<a href="#l58.4"></a><span id="l58.4">                                         nsMsgViewSortOrderValue sortOrder,</span>
<a href="#l58.5"></a><span id="l58.5">                                         nsMsgViewSortTypeValue sortType);</span>
<a href="#l58.6"></a><span id="l58.6">   int32_t  SecondarySort(nsMsgKey key1, nsISupports *folder1, nsMsgKey key2, nsISupports *folder2,</span>
<a href="#l58.7"></a><span id="l58.7">                          class viewSortInfo *comparisonContext);</span>
<a href="#l58.8"></a><span id="l58.8"> </span>
<a href="#l58.9"></a><span id="l58.9"> protected:</span>
<a href="#l58.10"></a><span id="l58.10">   static nsrefcnt gInstanceCount;</span>
<a href="#l58.11"></a><span id="l58.11"> </span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-  static PRUnichar* kHighestPriorityString;</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineminus">-  static PRUnichar* kHighPriorityString;</span>
<a href="#l58.14"></a><span id="l58.14" class="difflineminus">-  static PRUnichar* kLowestPriorityString;</span>
<a href="#l58.15"></a><span id="l58.15" class="difflineminus">-  static PRUnichar* kLowPriorityString;</span>
<a href="#l58.16"></a><span id="l58.16" class="difflineminus">-  static PRUnichar* kNormalPriorityString;</span>
<a href="#l58.17"></a><span id="l58.17" class="difflineplus">+  static char16_t* kHighestPriorityString;</span>
<a href="#l58.18"></a><span id="l58.18" class="difflineplus">+  static char16_t* kHighPriorityString;</span>
<a href="#l58.19"></a><span id="l58.19" class="difflineplus">+  static char16_t* kLowestPriorityString;</span>
<a href="#l58.20"></a><span id="l58.20" class="difflineplus">+  static char16_t* kLowPriorityString;</span>
<a href="#l58.21"></a><span id="l58.21" class="difflineplus">+  static char16_t* kNormalPriorityString;</span>
<a href="#l58.22"></a><span id="l58.22"> </span>
<a href="#l58.23"></a><span id="l58.23">   static nsIAtom* kJunkMsgAtom;</span>
<a href="#l58.24"></a><span id="l58.24">   static nsIAtom* kNotJunkMsgAtom;</span>
<a href="#l58.25"></a><span id="l58.25"> </span>
<a href="#l58.26"></a><span id="l58.26" class="difflineminus">-  static PRUnichar* kReadString;</span>
<a href="#l58.27"></a><span id="l58.27" class="difflineminus">-  static PRUnichar* kRepliedString;</span>
<a href="#l58.28"></a><span id="l58.28" class="difflineminus">-  static PRUnichar* kForwardedString;</span>
<a href="#l58.29"></a><span id="l58.29" class="difflineminus">-  static PRUnichar* kNewString;</span>
<a href="#l58.30"></a><span id="l58.30" class="difflineplus">+  static char16_t* kReadString;</span>
<a href="#l58.31"></a><span id="l58.31" class="difflineplus">+  static char16_t* kRepliedString;</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineplus">+  static char16_t* kForwardedString;</span>
<a href="#l58.33"></a><span id="l58.33" class="difflineplus">+  static char16_t* kNewString;</span>
<a href="#l58.34"></a><span id="l58.34"> </span>
<a href="#l58.35"></a><span id="l58.35">   nsCOMPtr&lt;nsITreeBoxObject&gt; mTree;</span>
<a href="#l58.36"></a><span id="l58.36">   nsCOMPtr&lt;nsITreeSelection&gt; mTreeSelection;</span>
<a href="#l58.37"></a><span id="l58.37">   uint32_t mNumSelectedRows; // we cache this to determine when to push command status notifications.</span>
<a href="#l58.38"></a><span id="l58.38">   bool           mSuppressMsgDisplay; // set when the message pane is collapsed</span>
<a href="#l58.39"></a><span id="l58.39">   bool           mSuppressCommandUpdating;</span>
<a href="#l58.40"></a><span id="l58.40">   bool           mRemovingRow; // set when we're telling the outline a row is being removed. used to suppress msg loading.</span>
<a href="#l58.41"></a><span id="l58.41">                         // during delete/move operations.</span>
<a href="#l58.42"></a><span id="l58.42" class="difflineat">@@ -339,17 +339,17 @@ protected:</span>
<a href="#l58.43"></a><span id="l58.43">   nsresult FindPrevFlagged(nsMsgViewIndex startIndex, nsMsgViewIndex *pResultIndex);</span>
<a href="#l58.44"></a><span id="l58.44">   nsresult MarkThreadOfMsgRead(nsMsgKey msgId, nsMsgViewIndex msgIndex, nsTArray&lt;nsMsgKey&gt; &amp;idsMarkedRead, bool bRead);</span>
<a href="#l58.45"></a><span id="l58.45">   nsresult MarkThreadRead(nsIMsgThread *threadHdr, nsMsgViewIndex threadIndex, nsTArray&lt;nsMsgKey&gt; &amp;idsMarkedRead, bool bRead);</span>
<a href="#l58.46"></a><span id="l58.46">   bool IsValidIndex(nsMsgViewIndex index);</span>
<a href="#l58.47"></a><span id="l58.47">   nsresult ToggleIgnored(nsMsgViewIndex * indices, int32_t numIndices, nsMsgViewIndex *resultIndex, bool *resultToggleState);</span>
<a href="#l58.48"></a><span id="l58.48">   nsresult ToggleMessageKilled(nsMsgViewIndex * indices, int32_t numIndices, nsMsgViewIndex *resultIndex, bool *resultToggleState);</span>
<a href="#l58.49"></a><span id="l58.49">   bool OfflineMsgSelected(nsMsgViewIndex * indices, int32_t numIndices);</span>
<a href="#l58.50"></a><span id="l58.50">   bool NonDummyMsgSelected(nsMsgViewIndex * indices, int32_t numIndices);</span>
<a href="#l58.51"></a><span id="l58.51" class="difflineminus">-  PRUnichar * GetString(const PRUnichar *aStringName);</span>
<a href="#l58.52"></a><span id="l58.52" class="difflineplus">+  char16_t * GetString(const char16_t *aStringName);</span>
<a href="#l58.53"></a><span id="l58.53">   nsresult GetPrefLocalizedString(const char *aPrefName, nsString&amp; aResult);</span>
<a href="#l58.54"></a><span id="l58.54">   nsresult GetLabelPrefStringAndAtom(const char *aPrefName, nsString&amp; aColor, nsIAtom** aColorAtom);</span>
<a href="#l58.55"></a><span id="l58.55">   nsresult AppendKeywordProperties(const nsACString&amp; keywords, nsAString&amp; properties, bool addSelectedTextProperty);</span>
<a href="#l58.56"></a><span id="l58.56">   nsresult InitLabelStrings(void);</span>
<a href="#l58.57"></a><span id="l58.57">   nsresult CopyDBView(nsMsgDBView *aNewMsgDBView, nsIMessenger *aMessengerInstance, nsIMsgWindow *aMsgWindow, nsIMsgDBViewCommandUpdater *aCmdUpdater);</span>
<a href="#l58.58"></a><span id="l58.58">   void InitializeAtomsAndLiterals();</span>
<a href="#l58.59"></a><span id="l58.59">   virtual int32_t FindLevelInThread(nsIMsgDBHdr *msgHdr, nsMsgViewIndex startOfThread, nsMsgViewIndex viewIndex);</span>
<a href="#l58.60"></a><span id="l58.60">   nsresult GetImapDeleteModel(nsIMsgFolder *folder);</span>
<a href="#l58.61"></a><span id="l58.61" class="difflineat">@@ -439,17 +439,17 @@ protected:</span>
<a href="#l58.62"></a><span id="l58.62">   uint32_t mRecentlyDeletedArrayIndex;</span>
<a href="#l58.63"></a><span id="l58.63">   void RememberDeletedMsgHdr(nsIMsgDBHdr *msgHdr);</span>
<a href="#l58.64"></a><span id="l58.64">   bool WasHdrRecentlyDeleted(nsIMsgDBHdr *msgHdr);</span>
<a href="#l58.65"></a><span id="l58.65">   </span>
<a href="#l58.66"></a><span id="l58.66">   //these hold pointers (and IDs) for the nsIMsgCustomColumnHandler object that constitutes the custom column handler</span>
<a href="#l58.67"></a><span id="l58.67">   nsCOMArray &lt;nsIMsgCustomColumnHandler&gt; m_customColumnHandlers;</span>
<a href="#l58.68"></a><span id="l58.68">   nsTArray&lt;nsString&gt; m_customColumnHandlerIDs;</span>
<a href="#l58.69"></a><span id="l58.69">   </span>
<a href="#l58.70"></a><span id="l58.70" class="difflineminus">-  nsIMsgCustomColumnHandler* GetColumnHandler(const PRUnichar*);</span>
<a href="#l58.71"></a><span id="l58.71" class="difflineplus">+  nsIMsgCustomColumnHandler* GetColumnHandler(const char16_t*);</span>
<a href="#l58.72"></a><span id="l58.72">   nsIMsgCustomColumnHandler* GetCurColumnHandlerFromDBInfo();</span>
<a href="#l58.73"></a><span id="l58.73"> </span>
<a href="#l58.74"></a><span id="l58.74"> #ifdef DEBUG_David_Bienvenu</span>
<a href="#l58.75"></a><span id="l58.75"> void InitEntryInfoForIndex(nsMsgViewIndex i, IdKeyPtr &amp;EntryInfo);</span>
<a href="#l58.76"></a><span id="l58.76"> void ValidateSort();</span>
<a href="#l58.77"></a><span id="l58.77"> #endif</span>
<a href="#l58.78"></a><span id="l58.78"> </span>
<a href="#l58.79"></a><span id="l58.79"> protected:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -829,18 +829,18 @@ nsMsgFolderDataSource::OnItemIntProperty</span>
<a href="#l59.4"></a><span id="l59.4">     NotifyPropertyChanged(resource, kNC_BiffState, biffNode);</span>
<a href="#l59.5"></a><span id="l59.5">   }</span>
<a href="#l59.6"></a><span id="l59.6">   return NS_OK;</span>
<a href="#l59.7"></a><span id="l59.7"> }</span>
<a href="#l59.8"></a><span id="l59.8"> </span>
<a href="#l59.9"></a><span id="l59.9"> NS_IMETHODIMP</span>
<a href="#l59.10"></a><span id="l59.10"> nsMsgFolderDataSource::OnItemUnicharPropertyChanged(nsIMsgFolder *folder,</span>
<a href="#l59.11"></a><span id="l59.11">                                                     nsIAtom *property,</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-                                                    const PRUnichar *oldValue,</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineminus">-                                                    const PRUnichar *newValue)</span>
<a href="#l59.14"></a><span id="l59.14" class="difflineplus">+                                                    const char16_t *oldValue,</span>
<a href="#l59.15"></a><span id="l59.15" class="difflineplus">+                                                    const char16_t *newValue)</span>
<a href="#l59.16"></a><span id="l59.16"> {</span>
<a href="#l59.17"></a><span id="l59.17">   nsCOMPtr&lt;nsIRDFResource&gt; resource(do_QueryInterface(folder));</span>
<a href="#l59.18"></a><span id="l59.18">   if (kNameAtom == property)</span>
<a href="#l59.19"></a><span id="l59.19">   {</span>
<a href="#l59.20"></a><span id="l59.20">     int32_t numUnread;</span>
<a href="#l59.21"></a><span id="l59.21">     folder-&gt;GetNumUnread(false, &amp;numUnread);</span>
<a href="#l59.22"></a><span id="l59.22">     NotifyFolderTreeNameChanged(folder, resource, numUnread);</span>
<a href="#l59.23"></a><span id="l59.23">     NotifyFolderTreeSimpleNameChanged(folder, resource);</span>
<a href="#l59.24"></a><span id="l59.24" class="difflineat">@@ -1492,17 +1492,17 @@ nsMsgFolderDataSource::createBiffStateNo</span>
<a href="#l59.25"></a><span id="l59.25">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l59.26"></a><span id="l59.26"> </span>
<a href="#l59.27"></a><span id="l59.27">   return NS_OK;</span>
<a href="#l59.28"></a><span id="l59.28"> }</span>
<a href="#l59.29"></a><span id="l59.29"> </span>
<a href="#l59.30"></a><span id="l59.30"> nsresult</span>
<a href="#l59.31"></a><span id="l59.31"> nsMsgFolderDataSource::createBiffStateNodeFromFlag(uint32_t flag, nsIRDFNode **target)</span>
<a href="#l59.32"></a><span id="l59.32"> {</span>
<a href="#l59.33"></a><span id="l59.33" class="difflineminus">-  const PRUnichar *biffStateStr;</span>
<a href="#l59.34"></a><span id="l59.34" class="difflineplus">+  const char16_t *biffStateStr;</span>
<a href="#l59.35"></a><span id="l59.35"> </span>
<a href="#l59.36"></a><span id="l59.36">   switch (flag) {</span>
<a href="#l59.37"></a><span id="l59.37">     case nsIMsgFolder::nsMsgBiffState_NewMail:</span>
<a href="#l59.38"></a><span id="l59.38">       biffStateStr = MOZ_UTF16(&quot;NewMail&quot;);</span>
<a href="#l59.39"></a><span id="l59.39">       break;</span>
<a href="#l59.40"></a><span id="l59.40">     case nsIMsgFolder::nsMsgBiffState_NoMail:</span>
<a href="#l59.41"></a><span id="l59.41">       biffStateStr = MOZ_UTF16(&quot;NoMail&quot;);</span>
<a href="#l59.42"></a><span id="l59.42">       break;</span>
<a href="#l59.43"></a><span id="l59.43" class="difflineat">@@ -2006,17 +2006,17 @@ nsresult nsMsgFolderDataSource::DoFolder</span>
<a href="#l59.44"></a><span id="l59.44"> {</span>
<a href="#l59.45"></a><span id="l59.45">   nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l59.46"></a><span id="l59.46"> </span>
<a href="#l59.47"></a><span id="l59.47">   if (kNC_Charset == property)</span>
<a href="#l59.48"></a><span id="l59.48">   {</span>
<a href="#l59.49"></a><span id="l59.49">     nsCOMPtr&lt;nsIRDFLiteral&gt; literal(do_QueryInterface(target));</span>
<a href="#l59.50"></a><span id="l59.50">     if(literal)</span>
<a href="#l59.51"></a><span id="l59.51">     {</span>
<a href="#l59.52"></a><span id="l59.52" class="difflineminus">-      const PRUnichar* value;</span>
<a href="#l59.53"></a><span id="l59.53" class="difflineplus">+      const char16_t* value;</span>
<a href="#l59.54"></a><span id="l59.54">       rv = literal-&gt;GetValueConst(&amp;value);</span>
<a href="#l59.55"></a><span id="l59.55">       if(NS_SUCCEEDED(rv))</span>
<a href="#l59.56"></a><span id="l59.56">         rv = folder-&gt;SetCharset(NS_LossyConvertUTF16toASCII(value));</span>
<a href="#l59.57"></a><span id="l59.57">     }</span>
<a href="#l59.58"></a><span id="l59.58">     else</span>
<a href="#l59.59"></a><span id="l59.59">       rv = NS_ERROR_FAILURE;</span>
<a href="#l59.60"></a><span id="l59.60">   }</span>
<a href="#l59.61"></a><span id="l59.61">   else if (kNC_Open == property &amp;&amp; target == kTrueLiteral)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -713,17 +713,17 @@ NS_IMETHODIMP nsMsgGroupView::GetCellPro</span>
<a href="#l60.4"></a><span id="l60.4">     aProperties.AssignLiteral(&quot;dummy&quot;);</span>
<a href="#l60.5"></a><span id="l60.5">     return NS_OK;</span>
<a href="#l60.6"></a><span id="l60.6">   }</span>
<a href="#l60.7"></a><span id="l60.7"> </span>
<a href="#l60.8"></a><span id="l60.8">   return nsMsgDBView::GetCellProperties(aRow, aCol, aProperties);</span>
<a href="#l60.9"></a><span id="l60.9"> }</span>
<a href="#l60.10"></a><span id="l60.10"> </span>
<a href="#l60.11"></a><span id="l60.11"> NS_IMETHODIMP nsMsgGroupView::CellTextForColumn(int32_t aRow,</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-                                                const PRUnichar *aColumnName,</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+                                                const char16_t *aColumnName,</span>
<a href="#l60.14"></a><span id="l60.14">                                                 nsAString &amp;aValue) {</span>
<a href="#l60.15"></a><span id="l60.15">   if (!IsValidIndex(aRow))</span>
<a href="#l60.16"></a><span id="l60.16">     return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l60.17"></a><span id="l60.17"> </span>
<a href="#l60.18"></a><span id="l60.18">   if (m_flags[aRow] &amp; MSG_VIEW_FLAG_DUMMY &amp;&amp; aColumnName[0] != 'u')</span>
<a href="#l60.19"></a><span id="l60.19">   {</span>
<a href="#l60.20"></a><span id="l60.20">     nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l60.21"></a><span id="l60.21">     nsresult rv = GetMsgHdrForViewIndex(aRow, getter_AddRefs(msgHdr));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupView.h</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupView.h</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -33,17 +33,17 @@ public:</span>
<a href="#l61.4"></a><span id="l61.4">   NS_IMETHOD OnHdrDeleted(nsIMsgDBHdr *aHdrDeleted, nsMsgKey aParentKey, int32_t aFlags, </span>
<a href="#l61.5"></a><span id="l61.5">                             nsIDBChangeListener *aInstigator) MOZ_OVERRIDE;</span>
<a href="#l61.6"></a><span id="l61.6">   NS_IMETHOD OnHdrFlagsChanged(nsIMsgDBHdr *aHdrChanged, uint32_t aOldFlags, </span>
<a href="#l61.7"></a><span id="l61.7">                                       uint32_t aNewFlags, nsIDBChangeListener *aInstigator) MOZ_OVERRIDE;</span>
<a href="#l61.8"></a><span id="l61.8"> </span>
<a href="#l61.9"></a><span id="l61.9">   NS_IMETHOD LoadMessageByViewIndex(nsMsgViewIndex aViewIndex);</span>
<a href="#l61.10"></a><span id="l61.10">   NS_IMETHOD GetCellProperties(int32_t aRow, nsITreeColumn *aCol, nsAString&amp; aProperties) MOZ_OVERRIDE;</span>
<a href="#l61.11"></a><span id="l61.11">   NS_IMETHOD GetRowProperties(int32_t aRow, nsAString&amp; aProperties) MOZ_OVERRIDE;</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-  NS_IMETHOD CellTextForColumn(int32_t aRow, const PRUnichar *aColumnName,</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+  NS_IMETHOD CellTextForColumn(int32_t aRow, const char16_t *aColumnName,</span>
<a href="#l61.14"></a><span id="l61.14">                                nsAString &amp;aValue);</span>
<a href="#l61.15"></a><span id="l61.15">   NS_IMETHOD GetThreadContainingMsgHdr(nsIMsgDBHdr *msgHdr, nsIMsgThread **pThread);</span>
<a href="#l61.16"></a><span id="l61.16"> </span>
<a href="#l61.17"></a><span id="l61.17"> protected:</span>
<a href="#l61.18"></a><span id="l61.18">   virtual void InternalClose();</span>
<a href="#l61.19"></a><span id="l61.19">   nsMsgGroupThread *AddHdrToThread(nsIMsgDBHdr *msgHdr, bool *pNewThread);</span>
<a href="#l61.20"></a><span id="l61.20">   virtual nsresult HashHdr(nsIMsgDBHdr *msgHdr, nsString&amp; aHashKey);</span>
<a href="#l61.21"></a><span id="l61.21">   nsresult GetAgeBucketValue(nsIMsgDBHdr *aMsgHdr, uint32_t * aAgeBucket, bool rcvDate = false); // helper function to get the age bucket for a hdr, useful when grouped by date</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -106,18 +106,18 @@ nsMsgMailSession::OnItemPropertyChanged(</span>
<a href="#l62.4"></a><span id="l62.4">   NOTIFY_FOLDER_LISTENERS(propertyChanged, OnItemPropertyChanged,</span>
<a href="#l62.5"></a><span id="l62.5">                           (aItem, aProperty, aOldValue, aNewValue));</span>
<a href="#l62.6"></a><span id="l62.6">   return NS_OK;</span>
<a href="#l62.7"></a><span id="l62.7"> }</span>
<a href="#l62.8"></a><span id="l62.8"> </span>
<a href="#l62.9"></a><span id="l62.9"> NS_IMETHODIMP</span>
<a href="#l62.10"></a><span id="l62.10"> nsMsgMailSession::OnItemUnicharPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l62.11"></a><span id="l62.11">                                                nsIAtom *aProperty,</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-                                               const PRUnichar* aOldValue,</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineminus">-                                               const PRUnichar* aNewValue)</span>
<a href="#l62.14"></a><span id="l62.14" class="difflineplus">+                                               const char16_t* aOldValue,</span>
<a href="#l62.15"></a><span id="l62.15" class="difflineplus">+                                               const char16_t* aNewValue)</span>
<a href="#l62.16"></a><span id="l62.16"> {</span>
<a href="#l62.17"></a><span id="l62.17">   NOTIFY_FOLDER_LISTENERS(unicharPropertyChanged, OnItemUnicharPropertyChanged,</span>
<a href="#l62.18"></a><span id="l62.18">                           (aItem, aProperty, aOldValue, aNewValue));</span>
<a href="#l62.19"></a><span id="l62.19">   return NS_OK;</span>
<a href="#l62.20"></a><span id="l62.20"> }</span>
<a href="#l62.21"></a><span id="l62.21"> </span>
<a href="#l62.22"></a><span id="l62.22"> NS_IMETHODIMP</span>
<a href="#l62.23"></a><span id="l62.23"> nsMsgMailSession::OnItemIntPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l62.24"></a><span id="l62.24" class="difflineat">@@ -595,17 +595,17 @@ NS_IMETHODIMP nsMsgShutdownService::SetS</span>
<a href="#l62.25"></a><span id="l62.25"> {</span>
<a href="#l62.26"></a><span id="l62.26">   NS_ENSURE_TRUE(mMsgProgress, NS_ERROR_FAILURE);</span>
<a href="#l62.27"></a><span id="l62.27">   mMsgProgress-&gt;RegisterListener(inListener);</span>
<a href="#l62.28"></a><span id="l62.28">   return NS_OK;</span>
<a href="#l62.29"></a><span id="l62.29"> }</span>
<a href="#l62.30"></a><span id="l62.30"> </span>
<a href="#l62.31"></a><span id="l62.31"> NS_IMETHODIMP nsMsgShutdownService::Observe(nsISupports *aSubject,</span>
<a href="#l62.32"></a><span id="l62.32">                                             const char *aTopic,</span>
<a href="#l62.33"></a><span id="l62.33" class="difflineminus">-                                            const PRUnichar *aData)</span>
<a href="#l62.34"></a><span id="l62.34" class="difflineplus">+                                            const char16_t *aData)</span>
<a href="#l62.35"></a><span id="l62.35"> {</span>
<a href="#l62.36"></a><span id="l62.36">   // Due to bug 459376 we don't always get quit-application-requested and</span>
<a href="#l62.37"></a><span id="l62.37">   // quit-application-granted. quit-application-requested is preferred, but if</span>
<a href="#l62.38"></a><span id="l62.38">   // we don't then we have to hook onto quit-application, but we don't want</span>
<a href="#l62.39"></a><span id="l62.39">   // to do the checking twice so we set some flags to prevent that.</span>
<a href="#l62.40"></a><span id="l62.40">   if (!strcmp(aTopic, &quot;quit-application-granted&quot;))</span>
<a href="#l62.41"></a><span id="l62.41">   {</span>
<a href="#l62.42"></a><span id="l62.42">     // Quit application has been requested and granted, therefore we will shut</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/base/src/nsMsgOfflineManager.cpp</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgOfflineManager.cpp</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -337,17 +337,17 @@ NS_IMETHODIMP</span>
<a href="#l63.4"></a><span id="l63.4"> nsMsgOfflineManager::OnStopRunningUrl(nsIURI * aUrl, nsresult aExitCode)</span>
<a href="#l63.5"></a><span id="l63.5"> {</span>
<a href="#l63.6"></a><span id="l63.6">   mOfflineImapSync = nullptr;</span>
<a href="#l63.7"></a><span id="l63.7"> </span>
<a href="#l63.8"></a><span id="l63.8">   AdvanceToNextState(aExitCode);</span>
<a href="#l63.9"></a><span id="l63.9">   return NS_OK;</span>
<a href="#l63.10"></a><span id="l63.10"> }</span>
<a href="#l63.11"></a><span id="l63.11"> </span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-NS_IMETHODIMP nsMsgOfflineManager::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData)</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+NS_IMETHODIMP nsMsgOfflineManager::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *someData)</span>
<a href="#l63.14"></a><span id="l63.14"> {</span>
<a href="#l63.15"></a><span id="l63.15">   return NS_OK;</span>
<a href="#l63.16"></a><span id="l63.16"> }</span>
<a href="#l63.17"></a><span id="l63.17"> </span>
<a href="#l63.18"></a><span id="l63.18"> // nsIMsgSendLaterListener implementation </span>
<a href="#l63.19"></a><span id="l63.19"> NS_IMETHODIMP</span>
<a href="#l63.20"></a><span id="l63.20"> nsMsgOfflineManager::OnStartSending(uint32_t aTotalMessageCount)</span>
<a href="#l63.21"></a><span id="l63.21"> {</span>
<a href="#l63.22"></a><span id="l63.22" class="difflineat">@@ -375,24 +375,24 @@ nsMsgOfflineManager::OnMessageSendProgre</span>
<a href="#l63.23"></a><span id="l63.23"> </span>
<a href="#l63.24"></a><span id="l63.24">   return NS_OK;</span>
<a href="#l63.25"></a><span id="l63.25"> }</span>
<a href="#l63.26"></a><span id="l63.26"> </span>
<a href="#l63.27"></a><span id="l63.27"> NS_IMETHODIMP</span>
<a href="#l63.28"></a><span id="l63.28"> nsMsgOfflineManager::OnMessageSendError(uint32_t aCurrentMessage,</span>
<a href="#l63.29"></a><span id="l63.29">                                         nsIMsgDBHdr *aMessageHeader,</span>
<a href="#l63.30"></a><span id="l63.30">                                         nsresult aStatus,</span>
<a href="#l63.31"></a><span id="l63.31" class="difflineminus">-                                        const PRUnichar *aMsg)</span>
<a href="#l63.32"></a><span id="l63.32" class="difflineplus">+                                        const char16_t *aMsg)</span>
<a href="#l63.33"></a><span id="l63.33"> {</span>
<a href="#l63.34"></a><span id="l63.34">   return NS_OK;</span>
<a href="#l63.35"></a><span id="l63.35"> }</span>
<a href="#l63.36"></a><span id="l63.36"> </span>
<a href="#l63.37"></a><span id="l63.37"> NS_IMETHODIMP</span>
<a href="#l63.38"></a><span id="l63.38"> nsMsgOfflineManager::OnStopSending(nsresult aStatus,</span>
<a href="#l63.39"></a><span id="l63.39" class="difflineminus">-                                   const PRUnichar *aMsg, uint32_t aTotalTried, </span>
<a href="#l63.40"></a><span id="l63.40" class="difflineplus">+                                   const char16_t *aMsg, uint32_t aTotalTried, </span>
<a href="#l63.41"></a><span id="l63.41">                                    uint32_t aSuccessful)</span>
<a href="#l63.42"></a><span id="l63.42"> {</span>
<a href="#l63.43"></a><span id="l63.43"> #ifdef NS_DEBUG</span>
<a href="#l63.44"></a><span id="l63.44">   if (NS_SUCCEEDED(aStatus))</span>
<a href="#l63.45"></a><span id="l63.45">     printf(&quot;SendLaterListener::OnStopSending: Tried to send %d messages. %d successful.\n&quot;,</span>
<a href="#l63.46"></a><span id="l63.46">             aTotalTried, aSuccessful);</span>
<a href="#l63.47"></a><span id="l63.47"> #endif</span>
<a href="#l63.48"></a><span id="l63.48">   return AdvanceToNextState(aStatus);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -191,17 +191,17 @@ nsMsgPrintEngine::OnLocationChange(nsIWe</span>
<a href="#l64.4"></a><span id="l64.4">     return NS_OK;</span>
<a href="#l64.5"></a><span id="l64.5"> }</span>
<a href="#l64.6"></a><span id="l64.6"> </span>
<a href="#l64.7"></a><span id="l64.7"> </span>
<a href="#l64.8"></a><span id="l64.8"> NS_IMETHODIMP</span>
<a href="#l64.9"></a><span id="l64.9"> nsMsgPrintEngine::OnStatusChange(nsIWebProgress* aWebProgress,</span>
<a href="#l64.10"></a><span id="l64.10">                     nsIRequest* aRequest,</span>
<a href="#l64.11"></a><span id="l64.11">                     nsresult aStatus,</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-                    const PRUnichar* aMessage)</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+                    const char16_t* aMessage)</span>
<a href="#l64.14"></a><span id="l64.14"> {</span>
<a href="#l64.15"></a><span id="l64.15">     return NS_OK;</span>
<a href="#l64.16"></a><span id="l64.16"> }</span>
<a href="#l64.17"></a><span id="l64.17"> </span>
<a href="#l64.18"></a><span id="l64.18"> </span>
<a href="#l64.19"></a><span id="l64.19"> NS_IMETHODIMP</span>
<a href="#l64.20"></a><span id="l64.20"> nsMsgPrintEngine::OnSecurityChange(nsIWebProgress *aWebProgress, </span>
<a href="#l64.21"></a><span id="l64.21">                       nsIRequest *aRequest, </span>
<a href="#l64.22"></a><span id="l64.22" class="difflineat">@@ -289,17 +289,17 @@ nsMsgPrintEngine::ShowWindow(bool aShow)</span>
<a href="#l64.23"></a><span id="l64.23"> </span>
<a href="#l64.24"></a><span id="l64.24">     // hide or show the window</span>
<a href="#l64.25"></a><span id="l64.25">     baseWindow-&gt;SetVisibility(aShow);</span>
<a href="#l64.26"></a><span id="l64.26">   }</span>
<a href="#l64.27"></a><span id="l64.27">   return rv;</span>
<a href="#l64.28"></a><span id="l64.28"> }</span>
<a href="#l64.29"></a><span id="l64.29"> </span>
<a href="#l64.30"></a><span id="l64.30"> NS_IMETHODIMP</span>
<a href="#l64.31"></a><span id="l64.31" class="difflineminus">-nsMsgPrintEngine::AddPrintURI(const PRUnichar *aMsgURI)</span>
<a href="#l64.32"></a><span id="l64.32" class="difflineplus">+nsMsgPrintEngine::AddPrintURI(const char16_t *aMsgURI)</span>
<a href="#l64.33"></a><span id="l64.33"> {</span>
<a href="#l64.34"></a><span id="l64.34">   NS_ENSURE_ARG_POINTER(aMsgURI);</span>
<a href="#l64.35"></a><span id="l64.35"> </span>
<a href="#l64.36"></a><span id="l64.36">   mURIArray.AppendElement(nsDependentString(aMsgURI));</span>
<a href="#l64.37"></a><span id="l64.37">   return NS_OK;</span>
<a href="#l64.38"></a><span id="l64.38"> }</span>
<a href="#l64.39"></a><span id="l64.39"> </span>
<a href="#l64.40"></a><span id="l64.40"> NS_IMETHODIMP</span>
<a href="#l64.41"></a><span id="l64.41" class="difflineat">@@ -556,17 +556,17 @@ nsMsgPrintEngine::SetStatusMessage(const</span>
<a href="#l64.42"></a><span id="l64.42"> </span>
<a href="#l64.43"></a><span id="l64.43">   mFeedback-&gt;ShowStatusString(aMsgString);</span>
<a href="#l64.44"></a><span id="l64.44">   return NS_OK;</span>
<a href="#l64.45"></a><span id="l64.45"> }</span>
<a href="#l64.46"></a><span id="l64.46"> </span>
<a href="#l64.47"></a><span id="l64.47"> #define MESSENGER_STRING_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l64.48"></a><span id="l64.48"> </span>
<a href="#l64.49"></a><span id="l64.49"> void</span>
<a href="#l64.50"></a><span id="l64.50" class="difflineminus">-nsMsgPrintEngine::GetString(const PRUnichar *aStringName, nsString&amp; outStr)</span>
<a href="#l64.51"></a><span id="l64.51" class="difflineplus">+nsMsgPrintEngine::GetString(const char16_t *aStringName, nsString&amp; outStr)</span>
<a href="#l64.52"></a><span id="l64.52"> {</span>
<a href="#l64.53"></a><span id="l64.53">   outStr.Truncate();</span>
<a href="#l64.54"></a><span id="l64.54"> </span>
<a href="#l64.55"></a><span id="l64.55">   if (!mStringBundle)</span>
<a href="#l64.56"></a><span id="l64.56">   {</span>
<a href="#l64.57"></a><span id="l64.57">     static const char propertyURL[] = MESSENGER_STRING_URL;</span>
<a href="#l64.58"></a><span id="l64.58"> </span>
<a href="#l64.59"></a><span id="l64.59">     nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService = </span>
<a href="#l64.60"></a><span id="l64.60" class="difflineat">@@ -733,12 +733,12 @@ NS_IMETHODIMP nsMsgPrintEngine::SetMsgTy</span>
<a href="#l64.61"></a><span id="l64.61">   {</span>
<a href="#l64.62"></a><span id="l64.62">     mMsgInx = aMsgType;</span>
<a href="#l64.63"></a><span id="l64.63">     return NS_OK;</span>
<a href="#l64.64"></a><span id="l64.64">   }</span>
<a href="#l64.65"></a><span id="l64.65">   return NS_ERROR_FAILURE;</span>
<a href="#l64.66"></a><span id="l64.66"> }</span>
<a href="#l64.67"></a><span id="l64.67"> </span>
<a href="#l64.68"></a><span id="l64.68"> /*=============== nsIObserver Interface ======================*/</span>
<a href="#l64.69"></a><span id="l64.69" class="difflineminus">-NS_IMETHODIMP nsMsgPrintEngine::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *aData)</span>
<a href="#l64.70"></a><span id="l64.70" class="difflineplus">+NS_IMETHODIMP nsMsgPrintEngine::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *aData)</span>
<a href="#l64.71"></a><span id="l64.71"> {</span>
<a href="#l64.72"></a><span id="l64.72">   return FireThatLoadOperation(mLoadURI);</span>
<a href="#l64.73"></a><span id="l64.73"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.h</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.h</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -56,17 +56,17 @@ protected:</span>
<a href="#l65.4"></a><span id="l65.4"> </span>
<a href="#l65.5"></a><span id="l65.5">   bool        FirePrintEvent();</span>
<a href="#l65.6"></a><span id="l65.6">   nsresult    FireStartNextEvent();</span>
<a href="#l65.7"></a><span id="l65.7">   nsresult    FireThatLoadOperationStartup(const nsString&amp; uri);</span>
<a href="#l65.8"></a><span id="l65.8">   nsresult    FireThatLoadOperation(const nsString&amp; uri);</span>
<a href="#l65.9"></a><span id="l65.9">   void        InitializeDisplayCharset();</span>
<a href="#l65.10"></a><span id="l65.10">   void        SetupObserver();</span>
<a href="#l65.11"></a><span id="l65.11">   nsresult    SetStatusMessage(const nsString&amp; aMsgString);</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-  void GetString(const PRUnichar *aStringName, nsString&amp; aOutString);</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+  void GetString(const char16_t *aStringName, nsString&amp; aOutString);</span>
<a href="#l65.14"></a><span id="l65.14">   nsresult    ShowProgressDialog(bool aIsForPrinting, bool&amp; aDoNotify);</span>
<a href="#l65.15"></a><span id="l65.15"> </span>
<a href="#l65.16"></a><span id="l65.16">   nsCOMPtr&lt;nsIDocShell&gt;       mDocShell;</span>
<a href="#l65.17"></a><span id="l65.17">   nsCOMPtr&lt;nsIDOMWindow&gt;      mWindow;</span>
<a href="#l65.18"></a><span id="l65.18">   nsCOMPtr&lt;nsIDOMWindow&gt;      mParentWindow;</span>
<a href="#l65.19"></a><span id="l65.19">   int32_t                     mURICount;</span>
<a href="#l65.20"></a><span id="l65.20">   nsTArray&lt;nsString&gt;          mURIArray;</span>
<a href="#l65.21"></a><span id="l65.21">   int32_t                     mCurrentlyPrintingURI;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -157,17 +157,17 @@ NS_IMETHODIMP nsMsgProgress::OnProgressC</span>
<a href="#l66.4"></a><span id="l66.4"> </span>
<a href="#l66.5"></a><span id="l66.5"> /* void onLocationChange (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in nsIURI location, in unsigned long aFlags); */</span>
<a href="#l66.6"></a><span id="l66.6"> NS_IMETHODIMP nsMsgProgress::OnLocationChange(nsIWebProgress *aWebProgress, nsIRequest *aRequest, nsIURI *location, uint32_t aFlags)</span>
<a href="#l66.7"></a><span id="l66.7"> {</span>
<a href="#l66.8"></a><span id="l66.8">   return NS_OK;</span>
<a href="#l66.9"></a><span id="l66.9"> }</span>
<a href="#l66.10"></a><span id="l66.10"> </span>
<a href="#l66.11"></a><span id="l66.11"> /* void onStatusChange (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in nsresult aStatus, in wstring aMessage); */</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-NS_IMETHODIMP nsMsgProgress::OnStatusChange(nsIWebProgress *aWebProgress, nsIRequest *aRequest, nsresult aStatus, const PRUnichar *aMessage)</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+NS_IMETHODIMP nsMsgProgress::OnStatusChange(nsIWebProgress *aWebProgress, nsIRequest *aRequest, nsresult aStatus, const char16_t *aMessage)</span>
<a href="#l66.14"></a><span id="l66.14"> {</span>
<a href="#l66.15"></a><span id="l66.15">   if (aMessage &amp;&amp; *aMessage)</span>
<a href="#l66.16"></a><span id="l66.16">     m_pendingStatus = aMessage;</span>
<a href="#l66.17"></a><span id="l66.17">   for (int32_t i = m_listenerList.Count() - 1; i &gt;= 0; i --)</span>
<a href="#l66.18"></a><span id="l66.18">     m_listenerList[i]-&gt;OnStatusChange(aWebProgress, aRequest, aStatus, aMessage);</span>
<a href="#l66.19"></a><span id="l66.19">   return NS_OK;</span>
<a href="#l66.20"></a><span id="l66.20"> }</span>
<a href="#l66.21"></a><span id="l66.21"> </span>
<a href="#l66.22"></a><span id="l66.22" class="difflineat">@@ -239,17 +239,17 @@ NS_IMETHODIMP nsMsgProgress::OnProgress(</span>
<a href="#l66.23"></a><span id="l66.23"> {</span>
<a href="#l66.24"></a><span id="l66.24">   // XXX: What should the nsIWebProgress be?</span>
<a href="#l66.25"></a><span id="l66.25">   // XXX: This truncates 64-bit to 32-bit</span>
<a href="#l66.26"></a><span id="l66.26">   return OnProgressChange(nullptr, request, int32_t(aProgress), int32_t(aProgressMax),</span>
<a href="#l66.27"></a><span id="l66.27">                           int32_t(aProgress) /* current total progress */, int32_t(aProgressMax) /* max total progress */);</span>
<a href="#l66.28"></a><span id="l66.28"> }</span>
<a href="#l66.29"></a><span id="l66.29"> </span>
<a href="#l66.30"></a><span id="l66.30"> NS_IMETHODIMP nsMsgProgress::OnStatus(nsIRequest *request, nsISupports* ctxt,</span>
<a href="#l66.31"></a><span id="l66.31" class="difflineminus">-                                      nsresult aStatus, const PRUnichar* aStatusArg)</span>
<a href="#l66.32"></a><span id="l66.32" class="difflineplus">+                                      nsresult aStatus, const char16_t* aStatusArg)</span>
<a href="#l66.33"></a><span id="l66.33"> {</span>
<a href="#l66.34"></a><span id="l66.34">   nsresult rv;</span>
<a href="#l66.35"></a><span id="l66.35">   nsCOMPtr&lt;nsIStringBundleService&gt; sbs =</span>
<a href="#l66.36"></a><span id="l66.36">     mozilla::services::GetStringBundleService();</span>
<a href="#l66.37"></a><span id="l66.37">   NS_ENSURE_TRUE(sbs, NS_ERROR_UNEXPECTED);</span>
<a href="#l66.38"></a><span id="l66.38">   nsString str;</span>
<a href="#l66.39"></a><span id="l66.39">   rv = sbs-&gt;FormatStatusMessage(aStatus, aStatusArg, getter_Copies(str));</span>
<a href="#l66.40"></a><span id="l66.40">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/base/src/nsMsgRDFDataSource.cpp</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgRDFDataSource.cpp</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -264,17 +264,17 @@ NS_IMETHODIMP</span>
<a href="#l67.4"></a><span id="l67.4"> nsMsgRDFDataSource::EndUpdateBatch()</span>
<a href="#l67.5"></a><span id="l67.5"> {</span>
<a href="#l67.6"></a><span id="l67.6">     return NS_OK;</span>
<a href="#l67.7"></a><span id="l67.7"> }</span>
<a href="#l67.8"></a><span id="l67.8"> </span>
<a href="#l67.9"></a><span id="l67.9"> </span>
<a href="#l67.10"></a><span id="l67.10"> /* XPCOM Shutdown observer */</span>
<a href="#l67.11"></a><span id="l67.11"> NS_IMETHODIMP</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-nsMsgRDFDataSource::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData )</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+nsMsgRDFDataSource::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *someData )</span>
<a href="#l67.14"></a><span id="l67.14"> {</span>
<a href="#l67.15"></a><span id="l67.15">   if (!strcmp(aTopic, NS_XPCOM_SHUTDOWN_OBSERVER_ID)) {</span>
<a href="#l67.16"></a><span id="l67.16">     m_shuttingDown = true;</span>
<a href="#l67.17"></a><span id="l67.17">     Cleanup();</span>
<a href="#l67.18"></a><span id="l67.18">   }</span>
<a href="#l67.19"></a><span id="l67.19">   return NS_OK;</span>
<a href="#l67.20"></a><span id="l67.20"> }</span>
<a href="#l67.21"></a><span id="l67.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/base/src/nsMsgRDFUtils.cpp</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgRDFUtils.cpp</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l68.4"></a><span id="l68.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l68.5"></a><span id="l68.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l68.6"></a><span id="l68.6"> #include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l68.7"></a><span id="l68.7"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l68.8"></a><span id="l68.8"> #include &quot;prprf.h&quot;</span>
<a href="#l68.9"></a><span id="l68.9"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l68.10"></a><span id="l68.10"> #include &quot;nsMemory.h&quot;</span>
<a href="#l68.11"></a><span id="l68.11"> </span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-nsresult createNode(const PRUnichar *str, nsIRDFNode **node, nsIRDFService *rdfService)</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+nsresult createNode(const char16_t *str, nsIRDFNode **node, nsIRDFService *rdfService)</span>
<a href="#l68.14"></a><span id="l68.14"> {</span>
<a href="#l68.15"></a><span id="l68.15">   nsresult rv;</span>
<a href="#l68.16"></a><span id="l68.16">   nsCOMPtr&lt;nsIRDFLiteral&gt; value;</span>
<a href="#l68.17"></a><span id="l68.17"> </span>
<a href="#l68.18"></a><span id="l68.18">   NS_ASSERTION(rdfService, &quot;rdfService is null&quot;);</span>
<a href="#l68.19"></a><span id="l68.19">   if (!rdfService) return NS_OK;</span>
<a href="#l68.20"></a><span id="l68.20"> </span>
<a href="#l68.21"></a><span id="l68.21">   if (str) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/base/src/nsMsgRDFUtils.h</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgRDFUtils.h</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -84,17 +84,17 @@ typedef struct _nsMsgRDFNotification {</span>
<a href="#l69.4"></a><span id="l69.4"> #define NC_RDF_MOVEFOLDER			NC_NAMESPACE_URI &quot;MoveFolder&quot;</span>
<a href="#l69.5"></a><span id="l69.5"> #define NC_RDF_MARKALLMESSAGESREAD  NC_NAMESPACE_URI &quot;MarkAllMessagesRead&quot;</span>
<a href="#l69.6"></a><span id="l69.6"> #define NC_RDF_COMPACT				NC_NAMESPACE_URI &quot;Compact&quot;</span>
<a href="#l69.7"></a><span id="l69.7"> #define NC_RDF_COMPACTALL			NC_NAMESPACE_URI &quot;CompactAll&quot;</span>
<a href="#l69.8"></a><span id="l69.8"> #define NC_RDF_RENAME				NC_NAMESPACE_URI &quot;Rename&quot;</span>
<a href="#l69.9"></a><span id="l69.9"> #define NC_RDF_EMPTYTRASH   NC_NAMESPACE_URI &quot;EmptyTrash&quot;</span>
<a href="#l69.10"></a><span id="l69.10"> </span>
<a href="#l69.11"></a><span id="l69.11"> </span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-nsresult createNode(const PRUnichar *str, nsIRDFNode **, nsIRDFService *rdfService);</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+nsresult createNode(const char16_t *str, nsIRDFNode **, nsIRDFService *rdfService);</span>
<a href="#l69.14"></a><span id="l69.14"> </span>
<a href="#l69.15"></a><span id="l69.15"> //Given an int32_t creates an nsIRDFNode that is really an int literal.</span>
<a href="#l69.16"></a><span id="l69.16"> nsresult createIntNode(int32_t value, nsIRDFNode **node, nsIRDFService *rdfService);</span>
<a href="#l69.17"></a><span id="l69.17"> </span>
<a href="#l69.18"></a><span id="l69.18"> //Given an nsIRDFBlob creates an nsIRDFNode that is really an blob literal.</span>
<a href="#l69.19"></a><span id="l69.19"> nsresult createBlobNode(uint8_t *value, uint32_t &amp;length,  nsIRDFNode **node, nsIRDFService *rdfService);</span>
<a href="#l69.20"></a><span id="l69.20"> </span>
<a href="#l69.21"></a><span id="l69.21"> //s Assertion for a datasource that will just call GetTarget on property.  When all of our </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -160,17 +160,17 @@ void nsMsgSearchDBView::InternalClose()</span>
<a href="#l70.4"></a><span id="l70.4">   m_folders.Clear();</span>
<a href="#l70.5"></a><span id="l70.5"> }</span>
<a href="#l70.6"></a><span id="l70.6"> </span>
<a href="#l70.7"></a><span id="l70.7"> NS_IMETHODIMP nsMsgSearchDBView::GetCellText(int32_t aRow, nsITreeColumn* aCol, nsAString&amp; aValue)</span>
<a href="#l70.8"></a><span id="l70.8"> {</span>
<a href="#l70.9"></a><span id="l70.9">   NS_ENSURE_TRUE(IsValidIndex(aRow), NS_MSG_INVALID_DBVIEW_INDEX);</span>
<a href="#l70.10"></a><span id="l70.10">   NS_ENSURE_ARG_POINTER(aCol);</span>
<a href="#l70.11"></a><span id="l70.11"> </span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-  const PRUnichar* colID;</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+  const char16_t* colID;</span>
<a href="#l70.14"></a><span id="l70.14">   aCol-&gt;GetIdConst(&amp;colID);</span>
<a href="#l70.15"></a><span id="l70.15">   // the only thing we contribute is location; dummy rows have no location, so</span>
<a href="#l70.16"></a><span id="l70.16">   //  bail in that case.  otherwise, check if we are dealing with 'location'.</span>
<a href="#l70.17"></a><span id="l70.17">   // location, need to check for &quot;lo&quot; not just &quot;l&quot; to avoid &quot;label&quot; column</span>
<a href="#l70.18"></a><span id="l70.18">   if (!(m_flags[aRow] &amp; MSG_VIEW_FLAG_DUMMY) &amp;&amp;</span>
<a href="#l70.19"></a><span id="l70.19">       colID[0] == 'l' &amp;&amp; colID[1] == 'o')</span>
<a href="#l70.20"></a><span id="l70.20">     return FetchLocation(aRow, aValue);</span>
<a href="#l70.21"></a><span id="l70.21">   else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -157,17 +157,17 @@ NS_IMETHODIMP nsMsgStatusFeedback::OnLoc</span>
<a href="#l71.4"></a><span id="l71.4"> {</span>
<a href="#l71.5"></a><span id="l71.5">    return NS_OK;</span>
<a href="#l71.6"></a><span id="l71.6"> }</span>
<a href="#l71.7"></a><span id="l71.7"> </span>
<a href="#l71.8"></a><span id="l71.8"> NS_IMETHODIMP </span>
<a href="#l71.9"></a><span id="l71.9"> nsMsgStatusFeedback::OnStatusChange(nsIWebProgress* aWebProgress,</span>
<a href="#l71.10"></a><span id="l71.10">                                     nsIRequest* aRequest,</span>
<a href="#l71.11"></a><span id="l71.11">                                     nsresult aStatus,</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-                                    const PRUnichar* aMessage)</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+                                    const char16_t* aMessage)</span>
<a href="#l71.14"></a><span id="l71.14"> {</span>
<a href="#l71.15"></a><span id="l71.15">     return NS_OK;</span>
<a href="#l71.16"></a><span id="l71.16"> }</span>
<a href="#l71.17"></a><span id="l71.17"> </span>
<a href="#l71.18"></a><span id="l71.18"> </span>
<a href="#l71.19"></a><span id="l71.19"> NS_IMETHODIMP </span>
<a href="#l71.20"></a><span id="l71.20"> nsMsgStatusFeedback::OnSecurityChange(nsIWebProgress *aWebProgress, </span>
<a href="#l71.21"></a><span id="l71.21">                                     nsIRequest *aRequest, </span>
<a href="#l71.22"></a><span id="l71.22" class="difflineat">@@ -250,17 +250,17 @@ NS_IMETHODIMP nsMsgStatusFeedback::OnPro</span>
<a href="#l71.23"></a><span id="l71.23"> {</span>
<a href="#l71.24"></a><span id="l71.24">   // XXX: What should the nsIWebProgress be?</span>
<a href="#l71.25"></a><span id="l71.25">   // XXX: this truncates 64-bit to 32-bit</span>
<a href="#l71.26"></a><span id="l71.26">   return OnProgressChange(nullptr, request, int32_t(aProgress), int32_t(aProgressMax), </span>
<a href="#l71.27"></a><span id="l71.27">                           int32_t(aProgress) /* current total progress */, int32_t(aProgressMax) /* max total progress */);</span>
<a href="#l71.28"></a><span id="l71.28"> }</span>
<a href="#l71.29"></a><span id="l71.29"> </span>
<a href="#l71.30"></a><span id="l71.30"> NS_IMETHODIMP nsMsgStatusFeedback::OnStatus(nsIRequest *request, nsISupports* ctxt, </span>
<a href="#l71.31"></a><span id="l71.31" class="difflineminus">-                                            nsresult aStatus, const PRUnichar* aStatusArg)</span>
<a href="#l71.32"></a><span id="l71.32" class="difflineplus">+                                            nsresult aStatus, const char16_t* aStatusArg)</span>
<a href="#l71.33"></a><span id="l71.33"> {</span>
<a href="#l71.34"></a><span id="l71.34">   nsresult rv;</span>
<a href="#l71.35"></a><span id="l71.35">   nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l71.36"></a><span id="l71.36">   nsString accountName;</span>
<a href="#l71.37"></a><span id="l71.37">   // fetching account name from nsIRequest</span>
<a href="#l71.38"></a><span id="l71.38">   nsCOMPtr&lt;nsIChannel&gt; aChannel = do_QueryInterface(request);</span>
<a href="#l71.39"></a><span id="l71.39">   rv = aChannel-&gt;GetURI(getter_AddRefs(uri));</span>
<a href="#l71.40"></a><span id="l71.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l71.41"></a><span id="l71.41" class="difflineat">@@ -283,17 +283,17 @@ NS_IMETHODIMP nsMsgStatusFeedback::OnSta</span>
<a href="#l71.42"></a><span id="l71.42"> </span>
<a href="#l71.43"></a><span id="l71.43">   // prefixing the account name to the status message if status message isn't blank</span>
<a href="#l71.44"></a><span id="l71.44">   // and doesn't already contain the account name.</span>
<a href="#l71.45"></a><span id="l71.45">   nsString statusMessage;</span>
<a href="#l71.46"></a><span id="l71.46">   if (!str.IsEmpty() &amp;&amp; str.Find(accountName) == kNotFound)</span>
<a href="#l71.47"></a><span id="l71.47">   {</span>
<a href="#l71.48"></a><span id="l71.48">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l71.49"></a><span id="l71.49">     rv = sbs-&gt;CreateBundle(MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l71.50"></a><span id="l71.50" class="difflineminus">-    const PRUnichar *params[] = { accountName.get(),</span>
<a href="#l71.51"></a><span id="l71.51" class="difflineplus">+    const char16_t *params[] = { accountName.get(),</span>
<a href="#l71.52"></a><span id="l71.52">                                   str.get() };</span>
<a href="#l71.53"></a><span id="l71.53">     rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l71.54"></a><span id="l71.54">       MOZ_UTF16(&quot;statusMessage&quot;),</span>
<a href="#l71.55"></a><span id="l71.55">       params, 2, getter_Copies(statusMessage));</span>
<a href="#l71.56"></a><span id="l71.56">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l71.57"></a><span id="l71.57">   }</span>
<a href="#l71.58"></a><span id="l71.58">   else</span>
<a href="#l71.59"></a><span id="l71.59">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -676,17 +676,17 @@ NS_IMETHODIMP nsSpamSettings::LogJunkHit</span>
<a href="#l72.4"></a><span id="l72.4">     mozilla::services::GetStringBundleService();</span>
<a href="#l72.5"></a><span id="l72.5">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l72.6"></a><span id="l72.6"> </span>
<a href="#l72.7"></a><span id="l72.7">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l72.8"></a><span id="l72.8">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/filter.properties&quot;,</span>
<a href="#l72.9"></a><span id="l72.9">     getter_AddRefs(bundle));</span>
<a href="#l72.10"></a><span id="l72.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.11"></a><span id="l72.11"> </span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-  const PRUnichar *junkLogDetectFormatStrings[3] = { authorValue.get(), subjectValue.get(), dateValue.get() };</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+  const char16_t *junkLogDetectFormatStrings[3] = { authorValue.get(), subjectValue.get(), dateValue.get() };</span>
<a href="#l72.14"></a><span id="l72.14">   nsString junkLogDetectStr;</span>
<a href="#l72.15"></a><span id="l72.15">   rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l72.16"></a><span id="l72.16">     MOZ_UTF16(&quot;junkLogDetectStr&quot;),</span>
<a href="#l72.17"></a><span id="l72.17">     junkLogDetectFormatStrings, 3,</span>
<a href="#l72.18"></a><span id="l72.18">     getter_Copies(junkLogDetectStr));</span>
<a href="#l72.19"></a><span id="l72.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.20"></a><span id="l72.20"> </span>
<a href="#l72.21"></a><span id="l72.21">   buffer += NS_ConvertUTF16toUTF8(junkLogDetectStr);</span>
<a href="#l72.22"></a><span id="l72.22" class="difflineat">@@ -698,17 +698,17 @@ NS_IMETHODIMP nsSpamSettings::LogJunkHit</span>
<a href="#l72.23"></a><span id="l72.23"> </span>
<a href="#l72.24"></a><span id="l72.24">     nsCString junkFolderURI;</span>
<a href="#l72.25"></a><span id="l72.25">     rv = GetSpamFolderURI(getter_Copies(junkFolderURI));</span>
<a href="#l72.26"></a><span id="l72.26">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.27"></a><span id="l72.27"> </span>
<a href="#l72.28"></a><span id="l72.28">     NS_ConvertASCIItoUTF16 msgIdValue(msgId);</span>
<a href="#l72.29"></a><span id="l72.29">     NS_ConvertASCIItoUTF16 junkFolderURIValue(junkFolderURI);</span>
<a href="#l72.30"></a><span id="l72.30"> </span>
<a href="#l72.31"></a><span id="l72.31" class="difflineminus">-    const PRUnichar *logMoveFormatStrings[2] = { msgIdValue.get(), junkFolderURIValue.get() };</span>
<a href="#l72.32"></a><span id="l72.32" class="difflineplus">+    const char16_t *logMoveFormatStrings[2] = { msgIdValue.get(), junkFolderURIValue.get() };</span>
<a href="#l72.33"></a><span id="l72.33">     nsString logMoveStr;</span>
<a href="#l72.34"></a><span id="l72.34">     rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l72.35"></a><span id="l72.35">       MOZ_UTF16(&quot;logMoveStr&quot;),</span>
<a href="#l72.36"></a><span id="l72.36">       logMoveFormatStrings, 2,</span>
<a href="#l72.37"></a><span id="l72.37">       getter_Copies(logMoveStr));</span>
<a href="#l72.38"></a><span id="l72.38">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.39"></a><span id="l72.39"> </span>
<a href="#l72.40"></a><span id="l72.40">     buffer += NS_ConvertUTF16toUTF8(logMoveStr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -195,17 +195,17 @@ nsStatusBarBiffManager::OnItemIntPropert</span>
<a href="#l73.4"></a><span id="l73.4"> </span>
<a href="#l73.5"></a><span id="l73.5"> NS_IMETHODIMP </span>
<a href="#l73.6"></a><span id="l73.6"> nsStatusBarBiffManager::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l73.7"></a><span id="l73.7"> {</span>
<a href="#l73.8"></a><span id="l73.8">   return NS_OK;</span>
<a href="#l73.9"></a><span id="l73.9"> }</span>
<a href="#l73.10"></a><span id="l73.10"> </span>
<a href="#l73.11"></a><span id="l73.11"> NS_IMETHODIMP </span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-nsStatusBarBiffManager::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const PRUnichar *oldValue, const PRUnichar *newValue)</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+nsStatusBarBiffManager::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l73.14"></a><span id="l73.14"> {</span>
<a href="#l73.15"></a><span id="l73.15">   return NS_OK;</span>
<a href="#l73.16"></a><span id="l73.16"> }</span>
<a href="#l73.17"></a><span id="l73.17"> </span>
<a href="#l73.18"></a><span id="l73.18"> NS_IMETHODIMP </span>
<a href="#l73.19"></a><span id="l73.19"> nsStatusBarBiffManager::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l73.20"></a><span id="l73.20"> {</span>
<a href="#l73.21"></a><span id="l73.21">   return NS_OK;</span>
<a href="#l73.22"></a><span id="l73.22" class="difflineat">@@ -216,17 +216,17 @@ nsStatusBarBiffManager::OnItemEvent(nsIM</span>
<a href="#l73.23"></a><span id="l73.23"> {</span>
<a href="#l73.24"></a><span id="l73.24">   return NS_OK;</span>
<a href="#l73.25"></a><span id="l73.25"> }</span>
<a href="#l73.26"></a><span id="l73.26"> </span>
<a href="#l73.27"></a><span id="l73.27"> // nsIObserver implementation</span>
<a href="#l73.28"></a><span id="l73.28"> NS_IMETHODIMP</span>
<a href="#l73.29"></a><span id="l73.29"> nsStatusBarBiffManager::Observe(nsISupports *aSubject,</span>
<a href="#l73.30"></a><span id="l73.30">                                 const char *aTopic,</span>
<a href="#l73.31"></a><span id="l73.31" class="difflineminus">-                                const PRUnichar *aData)</span>
<a href="#l73.32"></a><span id="l73.32" class="difflineplus">+                                const char16_t *aData)</span>
<a href="#l73.33"></a><span id="l73.33"> {</span>
<a href="#l73.34"></a><span id="l73.34">   nsresult rv;</span>
<a href="#l73.35"></a><span id="l73.35">   nsCOMPtr&lt;nsIPrefBranch&gt; pref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l73.36"></a><span id="l73.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l73.37"></a><span id="l73.37"> </span>
<a href="#l73.38"></a><span id="l73.38">   bool playSound = false;</span>
<a href="#l73.39"></a><span id="l73.39">   rv = pref-&gt;GetBoolPref(PREF_CHAT_PLAY_SOUND, &amp;playSound);</span>
<a href="#l73.40"></a><span id="l73.40">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -370,24 +370,24 @@ nsSubscribableServer::StopPopulating(nsI</span>
<a href="#l74.4"></a><span id="l74.4"> NS_IMETHODIMP</span>
<a href="#l74.5"></a><span id="l74.5"> nsSubscribableServer::UpdateSubscribed()</span>
<a href="#l74.6"></a><span id="l74.6"> {</span>
<a href="#l74.7"></a><span id="l74.7"> 	NS_ASSERTION(false,&quot;override this.&quot;);</span>
<a href="#l74.8"></a><span id="l74.8"> 	return NS_ERROR_FAILURE;</span>
<a href="#l74.9"></a><span id="l74.9"> }</span>
<a href="#l74.10"></a><span id="l74.10"> </span>
<a href="#l74.11"></a><span id="l74.11"> NS_IMETHODIMP</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-nsSubscribableServer::Subscribe(const PRUnichar *aName)</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+nsSubscribableServer::Subscribe(const char16_t *aName)</span>
<a href="#l74.14"></a><span id="l74.14"> {</span>
<a href="#l74.15"></a><span id="l74.15"> 	NS_ASSERTION(false,&quot;override this.&quot;);</span>
<a href="#l74.16"></a><span id="l74.16"> 	return NS_ERROR_FAILURE;</span>
<a href="#l74.17"></a><span id="l74.17"> }</span>
<a href="#l74.18"></a><span id="l74.18"> </span>
<a href="#l74.19"></a><span id="l74.19"> NS_IMETHODIMP</span>
<a href="#l74.20"></a><span id="l74.20" class="difflineminus">-nsSubscribableServer::Unsubscribe(const PRUnichar *aName)</span>
<a href="#l74.21"></a><span id="l74.21" class="difflineplus">+nsSubscribableServer::Unsubscribe(const char16_t *aName)</span>
<a href="#l74.22"></a><span id="l74.22"> {</span>
<a href="#l74.23"></a><span id="l74.23"> 	NS_ASSERTION(false,&quot;override this.&quot;);</span>
<a href="#l74.24"></a><span id="l74.24"> 	return NS_ERROR_FAILURE;</span>
<a href="#l74.25"></a><span id="l74.25"> }</span>
<a href="#l74.26"></a><span id="l74.26"> </span>
<a href="#l74.27"></a><span id="l74.27"> NS_IMETHODIMP</span>
<a href="#l74.28"></a><span id="l74.28"> nsSubscribableServer::SetShowFullName(bool showFullName)</span>
<a href="#l74.29"></a><span id="l74.29"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/base/src/nsSubscribableServer.h</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/base/src/nsSubscribableServer.h</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -18,17 +18,17 @@ typedef struct _subscribeTreeNode {</span>
<a href="#l75.4"></a><span id="l75.4">   bool isSubscribed;</span>
<a href="#l75.5"></a><span id="l75.5">   struct _subscribeTreeNode *prevSibling;</span>
<a href="#l75.6"></a><span id="l75.6">   struct _subscribeTreeNode *nextSibling;</span>
<a href="#l75.7"></a><span id="l75.7">   struct _subscribeTreeNode *firstChild;</span>
<a href="#l75.8"></a><span id="l75.8">   struct _subscribeTreeNode *lastChild;</span>
<a href="#l75.9"></a><span id="l75.9">   struct _subscribeTreeNode *parent;</span>
<a href="#l75.10"></a><span id="l75.10">   struct _subscribeTreeNode *cachedChild;</span>
<a href="#l75.11"></a><span id="l75.11"> #ifdef HAVE_SUBSCRIBE_DESCRIPTION</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-  PRUnichar *description;</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+  char16_t *description;</span>
<a href="#l75.14"></a><span id="l75.14"> #endif</span>
<a href="#l75.15"></a><span id="l75.15"> #ifdef HAVE_SUBSCRIBE_MESSAGES</span>
<a href="#l75.16"></a><span id="l75.16">   uint32_t messages;</span>
<a href="#l75.17"></a><span id="l75.17"> #endif</span>
<a href="#l75.18"></a><span id="l75.18">   bool isSubscribable;</span>
<a href="#l75.19"></a><span id="l75.19"> } SubscribeTreeNode;</span>
<a href="#l75.20"></a><span id="l75.20"> </span>
<a href="#l75.21"></a><span id="l75.21"> #if defined(DEBUG_sspitzer) || defined(DEBUG_seth)</span>
<a href="#l75.22"></a><span id="l75.22" class="difflineat">@@ -42,17 +42,17 @@ class nsSubscribableServer : public nsIS</span>
<a href="#l75.23"></a><span id="l75.23">   virtual ~nsSubscribableServer();</span>
<a href="#l75.24"></a><span id="l75.24"> </span>
<a href="#l75.25"></a><span id="l75.25">   nsresult Init();</span>
<a href="#l75.26"></a><span id="l75.26"> </span>
<a href="#l75.27"></a><span id="l75.27">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l75.28"></a><span id="l75.28">   NS_DECL_NSISUBSCRIBABLESERVER</span>
<a href="#l75.29"></a><span id="l75.29">   </span>
<a href="#l75.30"></a><span id="l75.30"> private:</span>
<a href="#l75.31"></a><span id="l75.31" class="difflineminus">-  nsresult ConvertNameToUnichar(const char *inStr, PRUnichar **outStr);</span>
<a href="#l75.32"></a><span id="l75.32" class="difflineplus">+  nsresult ConvertNameToUnichar(const char *inStr, char16_t **outStr);</span>
<a href="#l75.33"></a><span id="l75.33">   nsCOMPtr &lt;nsISubscribeListener&gt; mSubscribeListener;</span>
<a href="#l75.34"></a><span id="l75.34">   nsCOMPtr &lt;nsIMsgIncomingServer&gt; mIncomingServer;</span>
<a href="#l75.35"></a><span id="l75.35">   nsCOMPtr &lt;nsISubscribeDataSource&gt; mSubscribeDS;</span>
<a href="#l75.36"></a><span id="l75.36">   char mDelimiter;</span>
<a href="#l75.37"></a><span id="l75.37">   bool mShowFullName;</span>
<a href="#l75.38"></a><span id="l75.38">   bool mStopped;</span>
<a href="#l75.39"></a><span id="l75.39"> </span>
<a href="#l75.40"></a><span id="l75.40">   nsCOMPtr &lt;nsIRDFResource&gt;      kNC_Child;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/mailnews/base/util/Services.cpp</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/mailnews/base/util/Services.cpp</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -64,17 +64,17 @@ ShutdownObserver *ShutdownObserver::sShu</span>
<a href="#l76.4"></a><span id="l76.4">     return ret.forget(); \</span>
<a href="#l76.5"></a><span id="l76.5">   }</span>
<a href="#l76.6"></a><span id="l76.6"> #include &quot;mozilla/mailnews/ServiceList.h&quot;</span>
<a href="#l76.7"></a><span id="l76.7"> #undef MOZ_SERVICE</span>
<a href="#l76.8"></a><span id="l76.8"> </span>
<a href="#l76.9"></a><span id="l76.9"> NS_IMPL_ISUPPORTS1(ShutdownObserver, nsIObserver)</span>
<a href="#l76.10"></a><span id="l76.10"> </span>
<a href="#l76.11"></a><span id="l76.11"> NS_IMETHODIMP ShutdownObserver::Observe(nsISupports *aSubject,</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-    const char *aTopic, const PRUnichar *aData)</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+    const char *aTopic, const char16_t *aData)</span>
<a href="#l76.14"></a><span id="l76.14"> {</span>
<a href="#l76.15"></a><span id="l76.15">   if (!strcmp(aTopic, &quot;xpcom-shutdown-threads&quot;))</span>
<a href="#l76.16"></a><span id="l76.16">     ShutdownServices();</span>
<a href="#l76.17"></a><span id="l76.17">   return NS_OK;</span>
<a href="#l76.18"></a><span id="l76.18"> }</span>
<a href="#l76.19"></a><span id="l76.19"> </span>
<a href="#l76.20"></a><span id="l76.20"> void ShutdownObserver::EnsureInitialized()</span>
<a href="#l76.21"></a><span id="l76.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -83,26 +83,26 @@ static PRTime gtimeOfLastPurgeCheck;    </span>
<a href="#l77.4"></a><span id="l77.4"> </span>
<a href="#l77.5"></a><span id="l77.5"> const char *kUseServerRetentionProp = &quot;useServerRetention&quot;;</span>
<a href="#l77.6"></a><span id="l77.6"> </span>
<a href="#l77.7"></a><span id="l77.7"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l77.8"></a><span id="l77.8"> static NS_DEFINE_CID(kCMailDB, NS_MAILDB_CID);</span>
<a href="#l77.9"></a><span id="l77.9"> </span>
<a href="#l77.10"></a><span id="l77.10"> nsICollation * nsMsgDBFolder::gCollationKeyGenerator = nullptr;</span>
<a href="#l77.11"></a><span id="l77.11"> </span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-PRUnichar *nsMsgDBFolder::kLocalizedInboxName;</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineminus">-PRUnichar *nsMsgDBFolder::kLocalizedTrashName;</span>
<a href="#l77.14"></a><span id="l77.14" class="difflineminus">-PRUnichar *nsMsgDBFolder::kLocalizedSentName;</span>
<a href="#l77.15"></a><span id="l77.15" class="difflineminus">-PRUnichar *nsMsgDBFolder::kLocalizedDraftsName;</span>
<a href="#l77.16"></a><span id="l77.16" class="difflineminus">-PRUnichar *nsMsgDBFolder::kLocalizedTemplatesName;</span>
<a href="#l77.17"></a><span id="l77.17" class="difflineminus">-PRUnichar *nsMsgDBFolder::kLocalizedUnsentName;</span>
<a href="#l77.18"></a><span id="l77.18" class="difflineminus">-PRUnichar *nsMsgDBFolder::kLocalizedJunkName;</span>
<a href="#l77.19"></a><span id="l77.19" class="difflineminus">-PRUnichar *nsMsgDBFolder::kLocalizedArchivesName;</span>
<a href="#l77.20"></a><span id="l77.20" class="difflineminus">-</span>
<a href="#l77.21"></a><span id="l77.21" class="difflineminus">-PRUnichar *nsMsgDBFolder::kLocalizedBrandShortName;</span>
<a href="#l77.22"></a><span id="l77.22" class="difflineplus">+char16_t *nsMsgDBFolder::kLocalizedInboxName;</span>
<a href="#l77.23"></a><span id="l77.23" class="difflineplus">+char16_t *nsMsgDBFolder::kLocalizedTrashName;</span>
<a href="#l77.24"></a><span id="l77.24" class="difflineplus">+char16_t *nsMsgDBFolder::kLocalizedSentName;</span>
<a href="#l77.25"></a><span id="l77.25" class="difflineplus">+char16_t *nsMsgDBFolder::kLocalizedDraftsName;</span>
<a href="#l77.26"></a><span id="l77.26" class="difflineplus">+char16_t *nsMsgDBFolder::kLocalizedTemplatesName;</span>
<a href="#l77.27"></a><span id="l77.27" class="difflineplus">+char16_t *nsMsgDBFolder::kLocalizedUnsentName;</span>
<a href="#l77.28"></a><span id="l77.28" class="difflineplus">+char16_t *nsMsgDBFolder::kLocalizedJunkName;</span>
<a href="#l77.29"></a><span id="l77.29" class="difflineplus">+char16_t *nsMsgDBFolder::kLocalizedArchivesName;</span>
<a href="#l77.30"></a><span id="l77.30" class="difflineplus">+</span>
<a href="#l77.31"></a><span id="l77.31" class="difflineplus">+char16_t *nsMsgDBFolder::kLocalizedBrandShortName;</span>
<a href="#l77.32"></a><span id="l77.32"> </span>
<a href="#l77.33"></a><span id="l77.33"> nsrefcnt nsMsgDBFolder::mInstanceCount=0;</span>
<a href="#l77.34"></a><span id="l77.34"> </span>
<a href="#l77.35"></a><span id="l77.35"> NS_IMPL_ISUPPORTS_INHERITED6(nsMsgDBFolder, nsRDFResource, </span>
<a href="#l77.36"></a><span id="l77.36">                              nsISupportsWeakReference, nsIMsgFolder,</span>
<a href="#l77.37"></a><span id="l77.37">                              nsIDBChangeListener, nsIUrlListener,</span>
<a href="#l77.38"></a><span id="l77.38">                              nsIJunkMailClassificationListener,</span>
<a href="#l77.39"></a><span id="l77.39">                              nsIMsgTraitClassificationListener)</span>
<a href="#l77.40"></a><span id="l77.40" class="difflineat">@@ -5153,17 +5153,17 @@ NS_IMETHODIMP</span>
<a href="#l77.41"></a><span id="l77.41"> nsMsgDBFolder::GetStringWithFolderNameFromBundle(const char * msgName, nsAString&amp; aResult)</span>
<a href="#l77.42"></a><span id="l77.42"> {</span>
<a href="#l77.43"></a><span id="l77.43">   nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l77.44"></a><span id="l77.44">   nsresult rv = GetBaseStringBundle(getter_AddRefs(bundle));</span>
<a href="#l77.45"></a><span id="l77.45">   if (NS_SUCCEEDED(rv) &amp;&amp; bundle)</span>
<a href="#l77.46"></a><span id="l77.46">   {</span>
<a href="#l77.47"></a><span id="l77.47">     nsString folderName;</span>
<a href="#l77.48"></a><span id="l77.48">     GetName(folderName);</span>
<a href="#l77.49"></a><span id="l77.49" class="difflineminus">-    const PRUnichar *formatStrings[] =</span>
<a href="#l77.50"></a><span id="l77.50" class="difflineplus">+    const char16_t *formatStrings[] =</span>
<a href="#l77.51"></a><span id="l77.51">     {</span>
<a href="#l77.52"></a><span id="l77.52">       folderName.get(),</span>
<a href="#l77.53"></a><span id="l77.53">       kLocalizedBrandShortName</span>
<a href="#l77.54"></a><span id="l77.54">     };</span>
<a href="#l77.55"></a><span id="l77.55"> </span>
<a href="#l77.56"></a><span id="l77.56">     nsString resultStr;</span>
<a href="#l77.57"></a><span id="l77.57">     rv = bundle-&gt;FormatStringFromName(NS_ConvertASCIItoUTF16(msgName).get(),</span>
<a href="#l77.58"></a><span id="l77.58">                                       formatStrings, 2, getter_Copies(resultStr));</span>
<a href="#l77.59"></a><span id="l77.59" class="difflineat">@@ -5626,31 +5626,31 @@ void nsMsgDBFolder::compressQuotesInMsgS</span>
<a href="#l77.60"></a><span id="l77.60">       const nsAString&amp; currentLine = Substring(aMsgSnippet, offset, lineFeedPos - offset);</span>
<a href="#l77.61"></a><span id="l77.61">       // this catches quoted text (&quot;&gt; &quot;), nested quotes of any level (&quot;&gt;&gt; &quot;, &quot;&gt;&gt;&gt; &quot;, ...)</span>
<a href="#l77.62"></a><span id="l77.62">       // it also catches empty line quoted text (&quot;&gt;&quot;). It might be over agressive and require</span>
<a href="#l77.63"></a><span id="l77.63">       // tweaking later.</span>
<a href="#l77.64"></a><span id="l77.64">       // Try to strip the citation. If the current line ends with a ':' and the next line</span>
<a href="#l77.65"></a><span id="l77.65">       // looks like a quoted reply (starts with a &quot;&gt;&quot;) skip the current line</span>
<a href="#l77.66"></a><span id="l77.66">       if (StringBeginsWith(currentLine, NS_LITERAL_STRING(&quot;&gt;&quot;)) ||</span>
<a href="#l77.67"></a><span id="l77.67">           (lineFeedPos + 1 &lt; msgBodyStrLen  &amp;&amp; lineFeedPos</span>
<a href="#l77.68"></a><span id="l77.68" class="difflineminus">-          &amp;&amp; aMsgSnippet[lineFeedPos - 1] == PRUnichar(':')</span>
<a href="#l77.69"></a><span id="l77.69" class="difflineminus">-          &amp;&amp; aMsgSnippet[lineFeedPos + 1] == PRUnichar('&gt;')))</span>
<a href="#l77.70"></a><span id="l77.70" class="difflineplus">+          &amp;&amp; aMsgSnippet[lineFeedPos - 1] == char16_t(':')</span>
<a href="#l77.71"></a><span id="l77.71" class="difflineplus">+          &amp;&amp; aMsgSnippet[lineFeedPos + 1] == char16_t('&gt;')))</span>
<a href="#l77.72"></a><span id="l77.72">       {</span>
<a href="#l77.73"></a><span id="l77.73">         lastLineWasAQuote = true;</span>
<a href="#l77.74"></a><span id="l77.74">       }</span>
<a href="#l77.75"></a><span id="l77.75">       else if (!currentLine.IsEmpty())</span>
<a href="#l77.76"></a><span id="l77.76">       {</span>
<a href="#l77.77"></a><span id="l77.77">         if (lastLineWasAQuote)</span>
<a href="#l77.78"></a><span id="l77.78">         {</span>
<a href="#l77.79"></a><span id="l77.79">           aCompressedQuotes += NS_LITERAL_STRING(&quot; ... &quot;);</span>
<a href="#l77.80"></a><span id="l77.80">           lastLineWasAQuote = false;</span>
<a href="#l77.81"></a><span id="l77.81">         }</span>
<a href="#l77.82"></a><span id="l77.82"> </span>
<a href="#l77.83"></a><span id="l77.83">         aCompressedQuotes += currentLine;</span>
<a href="#l77.84"></a><span id="l77.84" class="difflineminus">-        aCompressedQuotes += PRUnichar(' '); // don't forget to substitute a space for the line feed</span>
<a href="#l77.85"></a><span id="l77.85" class="difflineplus">+        aCompressedQuotes += char16_t(' '); // don't forget to substitute a space for the line feed</span>
<a href="#l77.86"></a><span id="l77.86">       }</span>
<a href="#l77.87"></a><span id="l77.87"> </span>
<a href="#l77.88"></a><span id="l77.88">       offset = lineFeedPos + 1;</span>
<a href="#l77.89"></a><span id="l77.89">     }</span>
<a href="#l77.90"></a><span id="l77.90">     else</span>
<a href="#l77.91"></a><span id="l77.91">     {</span>
<a href="#l77.92"></a><span id="l77.92">       aCompressedQuotes.Append(Substring(aMsgSnippet, offset, msgBodyStrLen - offset));</span>
<a href="#l77.93"></a><span id="l77.93">       break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.h</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.h</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -232,26 +232,26 @@ protected:</span>
<a href="#l78.4"></a><span id="l78.4">   bool mInVFEditSearchScope ; // non persistant state used by the virtual folder UI</span>
<a href="#l78.5"></a><span id="l78.5"> </span>
<a href="#l78.6"></a><span id="l78.6">   // static stuff for cross-instance objects like atoms</span>
<a href="#l78.7"></a><span id="l78.7">   static NS_MSG_BASE_STATIC_MEMBER_(nsrefcnt) gInstanceCount;</span>
<a href="#l78.8"></a><span id="l78.8"> </span>
<a href="#l78.9"></a><span id="l78.9">   static nsresult initializeStrings();</span>
<a href="#l78.10"></a><span id="l78.10">   static nsresult createCollationKeyGenerator();</span>
<a href="#l78.11"></a><span id="l78.11"> </span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-  static NS_MSG_BASE_STATIC_MEMBER_(PRUnichar*) kLocalizedInboxName;</span>
<a href="#l78.13"></a><span id="l78.13" class="difflineminus">-  static NS_MSG_BASE_STATIC_MEMBER_(PRUnichar*) kLocalizedTrashName;</span>
<a href="#l78.14"></a><span id="l78.14" class="difflineminus">-  static NS_MSG_BASE_STATIC_MEMBER_(PRUnichar*) kLocalizedSentName;</span>
<a href="#l78.15"></a><span id="l78.15" class="difflineminus">-  static NS_MSG_BASE_STATIC_MEMBER_(PRUnichar*) kLocalizedDraftsName;</span>
<a href="#l78.16"></a><span id="l78.16" class="difflineminus">-  static NS_MSG_BASE_STATIC_MEMBER_(PRUnichar*) kLocalizedTemplatesName;</span>
<a href="#l78.17"></a><span id="l78.17" class="difflineminus">-  static NS_MSG_BASE_STATIC_MEMBER_(PRUnichar*) kLocalizedUnsentName;</span>
<a href="#l78.18"></a><span id="l78.18" class="difflineminus">-  static NS_MSG_BASE_STATIC_MEMBER_(PRUnichar*) kLocalizedJunkName;</span>
<a href="#l78.19"></a><span id="l78.19" class="difflineminus">-  static NS_MSG_BASE_STATIC_MEMBER_(PRUnichar*) kLocalizedArchivesName;</span>
<a href="#l78.20"></a><span id="l78.20" class="difflineplus">+  static NS_MSG_BASE_STATIC_MEMBER_(char16_t*) kLocalizedInboxName;</span>
<a href="#l78.21"></a><span id="l78.21" class="difflineplus">+  static NS_MSG_BASE_STATIC_MEMBER_(char16_t*) kLocalizedTrashName;</span>
<a href="#l78.22"></a><span id="l78.22" class="difflineplus">+  static NS_MSG_BASE_STATIC_MEMBER_(char16_t*) kLocalizedSentName;</span>
<a href="#l78.23"></a><span id="l78.23" class="difflineplus">+  static NS_MSG_BASE_STATIC_MEMBER_(char16_t*) kLocalizedDraftsName;</span>
<a href="#l78.24"></a><span id="l78.24" class="difflineplus">+  static NS_MSG_BASE_STATIC_MEMBER_(char16_t*) kLocalizedTemplatesName;</span>
<a href="#l78.25"></a><span id="l78.25" class="difflineplus">+  static NS_MSG_BASE_STATIC_MEMBER_(char16_t*) kLocalizedUnsentName;</span>
<a href="#l78.26"></a><span id="l78.26" class="difflineplus">+  static NS_MSG_BASE_STATIC_MEMBER_(char16_t*) kLocalizedJunkName;</span>
<a href="#l78.27"></a><span id="l78.27" class="difflineplus">+  static NS_MSG_BASE_STATIC_MEMBER_(char16_t*) kLocalizedArchivesName;</span>
<a href="#l78.28"></a><span id="l78.28"> </span>
<a href="#l78.29"></a><span id="l78.29" class="difflineminus">-  static NS_MSG_BASE_STATIC_MEMBER_(PRUnichar*) kLocalizedBrandShortName;</span>
<a href="#l78.30"></a><span id="l78.30" class="difflineplus">+  static NS_MSG_BASE_STATIC_MEMBER_(char16_t*) kLocalizedBrandShortName;</span>
<a href="#l78.31"></a><span id="l78.31">   </span>
<a href="#l78.32"></a><span id="l78.32"> #define MSGDBFOLDER_ATOM(name_, value) static NS_MSG_BASE_STATIC_MEMBER_(nsIAtom*) name_;</span>
<a href="#l78.33"></a><span id="l78.33"> #include &quot;nsMsgDBFolderAtomList.h&quot;</span>
<a href="#l78.34"></a><span id="l78.34"> #undef MSGDBFOLDER_ATOM</span>
<a href="#l78.35"></a><span id="l78.35"> </span>
<a href="#l78.36"></a><span id="l78.36">   static NS_MSG_BASE_STATIC_MEMBER_(nsICollation*) gCollationKeyGenerator;</span>
<a href="#l78.37"></a><span id="l78.37"> </span>
<a href="#l78.38"></a><span id="l78.38">   static const NS_MSG_BASE_STATIC_MEMBER_(nsStaticAtom) folder_atoms[];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -60,18 +60,18 @@ nsresult nsMsgI18NConvertFromUnicode(con</span>
<a href="#l79.4"></a><span id="l79.4">   if (aIsCharsetCanonical)  // optimize for modified UTF-7 used by IMAP</span>
<a href="#l79.5"></a><span id="l79.5">     rv = ccm-&gt;GetUnicodeEncoderRaw(aCharset, getter_AddRefs(encoder));</span>
<a href="#l79.6"></a><span id="l79.6">   else</span>
<a href="#l79.7"></a><span id="l79.7">     rv = ccm-&gt;GetUnicodeEncoder(aCharset, getter_AddRefs(encoder));</span>
<a href="#l79.8"></a><span id="l79.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.9"></a><span id="l79.9">   rv = encoder-&gt;SetOutputErrorBehavior(nsIUnicodeEncoder::kOnError_Replace, nullptr, '?');</span>
<a href="#l79.10"></a><span id="l79.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.11"></a><span id="l79.11"> </span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-  const PRUnichar *originalSrcPtr = inString.get();</span>
<a href="#l79.13"></a><span id="l79.13" class="difflineminus">-  const PRUnichar *currentSrcPtr = originalSrcPtr;</span>
<a href="#l79.14"></a><span id="l79.14" class="difflineplus">+  const char16_t *originalSrcPtr = inString.get();</span>
<a href="#l79.15"></a><span id="l79.15" class="difflineplus">+  const char16_t *currentSrcPtr = originalSrcPtr;</span>
<a href="#l79.16"></a><span id="l79.16">   int32_t originalUnicharLength = inString.Length();</span>
<a href="#l79.17"></a><span id="l79.17">   int32_t srcLength;</span>
<a href="#l79.18"></a><span id="l79.18">   int32_t dstLength;</span>
<a href="#l79.19"></a><span id="l79.19">   char localbuf[512];</span>
<a href="#l79.20"></a><span id="l79.20">   int32_t consumedLen = 0;</span>
<a href="#l79.21"></a><span id="l79.21"> </span>
<a href="#l79.22"></a><span id="l79.22">   outString.Truncate();</span>
<a href="#l79.23"></a><span id="l79.23">   // convert</span>
<a href="#l79.24"></a><span id="l79.24" class="difflineat">@@ -106,17 +106,17 @@ nsresult nsMsgI18NConvertToUnicode(const</span>
<a href="#l79.25"></a><span id="l79.25">     // Despite its name, it also works for Latin-1.</span>
<a href="#l79.26"></a><span id="l79.26">     CopyASCIItoUTF16(inString, outString);</span>
<a href="#l79.27"></a><span id="l79.27">     return NS_OK;</span>
<a href="#l79.28"></a><span id="l79.28">   }</span>
<a href="#l79.29"></a><span id="l79.29">   else if (!PL_strcasecmp(aCharset, &quot;UTF-8&quot;)) {</span>
<a href="#l79.30"></a><span id="l79.30">     if (MsgIsUTF8(inString)) {</span>
<a href="#l79.31"></a><span id="l79.31">       nsAutoString tmp;</span>
<a href="#l79.32"></a><span id="l79.32">       CopyUTF8toUTF16(inString, tmp);</span>
<a href="#l79.33"></a><span id="l79.33" class="difflineminus">-      if (!tmp.IsEmpty() &amp;&amp; tmp.get()[0] == PRUnichar(0xFEFF))</span>
<a href="#l79.34"></a><span id="l79.34" class="difflineplus">+      if (!tmp.IsEmpty() &amp;&amp; tmp.get()[0] == char16_t(0xFEFF))</span>
<a href="#l79.35"></a><span id="l79.35">         tmp.Cut(0, 1);</span>
<a href="#l79.36"></a><span id="l79.36">       outString.Assign(tmp);</span>
<a href="#l79.37"></a><span id="l79.37">       return NS_OK;</span>
<a href="#l79.38"></a><span id="l79.38">     }</span>
<a href="#l79.39"></a><span id="l79.39">     NS_WARNING(&quot;Invalid UTF-8 string&quot;);</span>
<a href="#l79.40"></a><span id="l79.40">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l79.41"></a><span id="l79.41">   }</span>
<a href="#l79.42"></a><span id="l79.42"> </span>
<a href="#l79.43"></a><span id="l79.43" class="difflineat">@@ -133,17 +133,17 @@ nsresult nsMsgI18NConvertToUnicode(const</span>
<a href="#l79.44"></a><span id="l79.44">     rv = ccm-&gt;GetUnicodeDecoderInternal(aCharset, getter_AddRefs(decoder));</span>
<a href="#l79.45"></a><span id="l79.45">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.46"></a><span id="l79.46"> </span>
<a href="#l79.47"></a><span id="l79.47">   const char *originalSrcPtr = inString.get();</span>
<a href="#l79.48"></a><span id="l79.48">   const char *currentSrcPtr = originalSrcPtr;</span>
<a href="#l79.49"></a><span id="l79.49">   int32_t originalLength = inString.Length();</span>
<a href="#l79.50"></a><span id="l79.50">   int32_t srcLength;</span>
<a href="#l79.51"></a><span id="l79.51">   int32_t dstLength;</span>
<a href="#l79.52"></a><span id="l79.52" class="difflineminus">-  PRUnichar localbuf[512];</span>
<a href="#l79.53"></a><span id="l79.53" class="difflineplus">+  char16_t localbuf[512];</span>
<a href="#l79.54"></a><span id="l79.54">   int32_t consumedLen = 0;</span>
<a href="#l79.55"></a><span id="l79.55"> </span>
<a href="#l79.56"></a><span id="l79.56">   outString.Truncate();</span>
<a href="#l79.57"></a><span id="l79.57"> </span>
<a href="#l79.58"></a><span id="l79.58">   // convert</span>
<a href="#l79.59"></a><span id="l79.59">   while (consumedLen &lt; originalLength) {</span>
<a href="#l79.60"></a><span id="l79.60">     srcLength = originalLength - consumedLen;  </span>
<a href="#l79.61"></a><span id="l79.61">     dstLength = 512;</span>
<a href="#l79.62"></a><span id="l79.62" class="difflineat">@@ -237,35 +237,35 @@ bool nsMsgI18Nmultibyte_charset(const ch</span>
<a href="#l79.63"></a><span id="l79.63">     if (NS_SUCCEEDED(res)) {</span>
<a href="#l79.64"></a><span id="l79.64">       result = charsetData.LowerCaseEqualsLiteral(&quot;true&quot;);</span>
<a href="#l79.65"></a><span id="l79.65">     }</span>
<a href="#l79.66"></a><span id="l79.66">   }</span>
<a href="#l79.67"></a><span id="l79.67"> </span>
<a href="#l79.68"></a><span id="l79.68">   return result;</span>
<a href="#l79.69"></a><span id="l79.69"> }</span>
<a href="#l79.70"></a><span id="l79.70"> </span>
<a href="#l79.71"></a><span id="l79.71" class="difflineminus">-bool nsMsgI18Ncheck_data_in_charset_range(const char *charset, const PRUnichar* inString, char **fallbackCharset)</span>
<a href="#l79.72"></a><span id="l79.72" class="difflineplus">+bool nsMsgI18Ncheck_data_in_charset_range(const char *charset, const char16_t* inString, char **fallbackCharset)</span>
<a href="#l79.73"></a><span id="l79.73"> {</span>
<a href="#l79.74"></a><span id="l79.74">   if (!charset || !*charset || !inString || !*inString)</span>
<a href="#l79.75"></a><span id="l79.75">     return true;</span>
<a href="#l79.76"></a><span id="l79.76"> </span>
<a href="#l79.77"></a><span id="l79.77">   nsresult res;</span>
<a href="#l79.78"></a><span id="l79.78">   bool result = true;</span>
<a href="#l79.79"></a><span id="l79.79">   </span>
<a href="#l79.80"></a><span id="l79.80">   nsCOMPtr &lt;nsICharsetConverterManager&gt; ccm = do_GetService(NS_CHARSETCONVERTERMANAGER_CONTRACTID, &amp;res);</span>
<a href="#l79.81"></a><span id="l79.81"> </span>
<a href="#l79.82"></a><span id="l79.82">   if (NS_SUCCEEDED(res)) {</span>
<a href="#l79.83"></a><span id="l79.83">     nsCOMPtr &lt;nsIUnicodeEncoder&gt; encoder;</span>
<a href="#l79.84"></a><span id="l79.84"> </span>
<a href="#l79.85"></a><span id="l79.85">     // get an unicode converter</span>
<a href="#l79.86"></a><span id="l79.86">     res = ccm-&gt;GetUnicodeEncoderRaw(charset, getter_AddRefs(encoder));</span>
<a href="#l79.87"></a><span id="l79.87">     if(NS_SUCCEEDED(res)) {</span>
<a href="#l79.88"></a><span id="l79.88" class="difflineminus">-      const PRUnichar *originalPtr = inString;</span>
<a href="#l79.89"></a><span id="l79.89" class="difflineplus">+      const char16_t *originalPtr = inString;</span>
<a href="#l79.90"></a><span id="l79.90">       int32_t originalLen = NS_strlen(inString);</span>
<a href="#l79.91"></a><span id="l79.91" class="difflineminus">-      const PRUnichar *currentSrcPtr = originalPtr;</span>
<a href="#l79.92"></a><span id="l79.92" class="difflineplus">+      const char16_t *currentSrcPtr = originalPtr;</span>
<a href="#l79.93"></a><span id="l79.93">       char localBuff[512];</span>
<a href="#l79.94"></a><span id="l79.94">       int32_t consumedLen = 0;</span>
<a href="#l79.95"></a><span id="l79.95">       int32_t srcLen;</span>
<a href="#l79.96"></a><span id="l79.96">       int32_t dstLength;</span>
<a href="#l79.97"></a><span id="l79.97"> </span>
<a href="#l79.98"></a><span id="l79.98">       // convert from unicode</span>
<a href="#l79.99"></a><span id="l79.99">       while (consumedLen &lt; originalLen) {</span>
<a href="#l79.100"></a><span id="l79.100">         srcLen = originalLen - consumedLen;</span>
<a href="#l79.101"></a><span id="l79.101" class="difflineat">@@ -358,17 +358,17 @@ nsMsgI18NParseMetaCharset(nsIFile* file)</span>
<a href="#l79.102"></a><span id="l79.102">       } </span>
<a href="#l79.103"></a><span id="l79.103">     } </span>
<a href="#l79.104"></a><span id="l79.104">   } </span>
<a href="#l79.105"></a><span id="l79.105"> </span>
<a href="#l79.106"></a><span id="l79.106">   return charset; </span>
<a href="#l79.107"></a><span id="l79.107"> } </span>
<a href="#l79.108"></a><span id="l79.108"> </span>
<a href="#l79.109"></a><span id="l79.109"> nsresult nsMsgI18NSaveAsCharset(const char* contentType, const char *charset, </span>
<a href="#l79.110"></a><span id="l79.110" class="difflineminus">-                                const PRUnichar* inString, char** outString, </span>
<a href="#l79.111"></a><span id="l79.111" class="difflineplus">+                                const char16_t* inString, char** outString, </span>
<a href="#l79.112"></a><span id="l79.112">                                 char **fallbackCharset, bool *isAsciiOnly)</span>
<a href="#l79.113"></a><span id="l79.113"> {</span>
<a href="#l79.114"></a><span id="l79.114">   NS_ENSURE_ARG_POINTER(contentType);</span>
<a href="#l79.115"></a><span id="l79.115">   NS_ENSURE_ARG_POINTER(charset);</span>
<a href="#l79.116"></a><span id="l79.116">   NS_ENSURE_ARG_POINTER(inString);</span>
<a href="#l79.117"></a><span id="l79.117">   NS_ENSURE_ARG_POINTER(outString);</span>
<a href="#l79.118"></a><span id="l79.118"> </span>
<a href="#l79.119"></a><span id="l79.119">   *outString = nullptr;</span>
<a href="#l79.120"></a><span id="l79.120" class="difflineat">@@ -405,17 +405,17 @@ nsresult nsMsgI18NSaveAsCharset(const ch</span>
<a href="#l79.121"></a><span id="l79.121"> </span>
<a href="#l79.122"></a><span id="l79.122">   // First try to transliterate, if that fails use '?' for &quot;bad&quot; chars.</span>
<a href="#l79.123"></a><span id="l79.123">   res = conv-&gt;Init(charsetName.get(),</span>
<a href="#l79.124"></a><span id="l79.124">                    nsISaveAsCharset::attr_FallbackQuestionMark +</span>
<a href="#l79.125"></a><span id="l79.125">                      nsISaveAsCharset::attr_EntityNone,</span>
<a href="#l79.126"></a><span id="l79.126">                    nsIEntityConverter::transliterate);</span>
<a href="#l79.127"></a><span id="l79.127">   NS_ENSURE_SUCCESS(res, res);</span>
<a href="#l79.128"></a><span id="l79.128"> </span>
<a href="#l79.129"></a><span id="l79.129" class="difflineminus">-  const PRUnichar *input = inString;</span>
<a href="#l79.130"></a><span id="l79.130" class="difflineplus">+  const char16_t *input = inString;</span>
<a href="#l79.131"></a><span id="l79.131"> </span>
<a href="#l79.132"></a><span id="l79.132">   // Convert to charset</span>
<a href="#l79.133"></a><span id="l79.133">   res = conv-&gt;Convert(input, outString);</span>
<a href="#l79.134"></a><span id="l79.134"> </span>
<a href="#l79.135"></a><span id="l79.135">   // If the converer cannot encode to the charset,</span>
<a href="#l79.136"></a><span id="l79.136">   // then fallback to pref sepcified charsets.</span>
<a href="#l79.137"></a><span id="l79.137">   if (NS_ERROR_UENC_NOMAPPING == res &amp;&amp; !bTEXT_HTML &amp;&amp; fallbackCharset) {</span>
<a href="#l79.138"></a><span id="l79.138">     nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;res));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.h</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.h</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -47,17 +47,17 @@ NS_MSG_BASE bool nsMsgI18Nmultibyte_char</span>
<a href="#l80.4"></a><span id="l80.4">  * @param inString    [IN] Input unicode string to be examined.</span>
<a href="#l80.5"></a><span id="l80.5">  * @param fallbackCharset [OUT]</span>
<a href="#l80.6"></a><span id="l80.6">  *                         null if fallback charset is not needed.</span>
<a href="#l80.7"></a><span id="l80.7">  *                         Otherwise, a fallback charset name may be set if that was used for the conversion. </span>
<a href="#l80.8"></a><span id="l80.8">  *                         Caller is responsible for freeing the memory.</span>
<a href="#l80.9"></a><span id="l80.9">  * @return            True if the string can be converted within the charset range.</span>
<a href="#l80.10"></a><span id="l80.10">  *                    False if one or more characters cannot be converted to the target charset.</span>
<a href="#l80.11"></a><span id="l80.11">  */</span>
<a href="#l80.12"></a><span id="l80.12" class="difflineminus">-NS_MSG_BASE bool      nsMsgI18Ncheck_data_in_charset_range(const char *charset, const PRUnichar* inString,</span>
<a href="#l80.13"></a><span id="l80.13" class="difflineplus">+NS_MSG_BASE bool      nsMsgI18Ncheck_data_in_charset_range(const char *charset, const char16_t* inString,</span>
<a href="#l80.14"></a><span id="l80.14">                                                            char **fallbackCharset=nullptr);</span>
<a href="#l80.15"></a><span id="l80.15"> </span>
<a href="#l80.16"></a><span id="l80.16"> /**</span>
<a href="#l80.17"></a><span id="l80.17">  * Return charset name of file system (OS dependent).</span>
<a href="#l80.18"></a><span id="l80.18">  *</span>
<a href="#l80.19"></a><span id="l80.19">  * @return            File system charset name.</span>
<a href="#l80.20"></a><span id="l80.20">  */</span>
<a href="#l80.21"></a><span id="l80.21"> NS_MSG_BASE const char * nsMsgI18NFileSystemCharset(void);</span>
<a href="#l80.22"></a><span id="l80.22" class="difflineat">@@ -115,17 +115,17 @@ NS_MSG_BASE const char *nsMsgI18NParseMe</span>
<a href="#l80.23"></a><span id="l80.23">  *                         Otherwise, a fallback charset name may be set if that was used for the conversion. </span>
<a href="#l80.24"></a><span id="l80.24">  *                         Caller is responsible for freeing the memory.</span>
<a href="#l80.25"></a><span id="l80.25">  * @param isAsciiOnly [OUT]</span>
<a href="#l80.26"></a><span id="l80.26">  *                         null if non ASCII info is not needed.</span>
<a href="#l80.27"></a><span id="l80.27">  *                         Otherwise, true is set if the input data is ASCII only false otherwise. </span>
<a href="#l80.28"></a><span id="l80.28">  * @return            nsresult.</span>
<a href="#l80.29"></a><span id="l80.29">  */</span>
<a href="#l80.30"></a><span id="l80.30"> NS_MSG_BASE nsresult nsMsgI18NSaveAsCharset(const char* contentType, const char* charset, </span>
<a href="#l80.31"></a><span id="l80.31" class="difflineminus">-                                            const PRUnichar* inString, char** outString, </span>
<a href="#l80.32"></a><span id="l80.32" class="difflineplus">+                                            const char16_t* inString, char** outString, </span>
<a href="#l80.33"></a><span id="l80.33">                                             char **fallbackCharset=nullptr, bool *isAsciiOnly=nullptr);</span>
<a href="#l80.34"></a><span id="l80.34"> </span>
<a href="#l80.35"></a><span id="l80.35"> /**</span>
<a href="#l80.36"></a><span id="l80.36">  * Shrink the aStr to aMaxLength bytes. Note that this doesn't check whether</span>
<a href="#l80.37"></a><span id="l80.37">  * the aUTF8Str is valid UTF-8 string.</span>
<a href="#l80.38"></a><span id="l80.38">  *</span>
<a href="#l80.39"></a><span id="l80.39">  * @param inString   [IN] Input UTF-8 string (it must be valid UTF-8 string)</span>
<a href="#l80.40"></a><span id="l80.40">  * @param aMaxLength [IN] Shrink to this length (it means bytes)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -779,17 +779,17 @@ nsMsgIncomingServer::GetPasswordWithUI(c</span>
<a href="#l81.4"></a><span id="l81.4">       rv = GetHostName(temp);</span>
<a href="#l81.5"></a><span id="l81.5">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.6"></a><span id="l81.6"> </span>
<a href="#l81.7"></a><span id="l81.7">       serverUri.Append(temp);</span>
<a href="#l81.8"></a><span id="l81.8"> </span>
<a href="#l81.9"></a><span id="l81.9">       // we pass in the previously used password, if any, into PromptPassword</span>
<a href="#l81.10"></a><span id="l81.10">       // so that it will appear as ******. This means we can't use an nsString</span>
<a href="#l81.11"></a><span id="l81.11">       // and getter_Copies.</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-      PRUnichar *uniPassword = nullptr;</span>
<a href="#l81.13"></a><span id="l81.13" class="difflineplus">+      char16_t *uniPassword = nullptr;</span>
<a href="#l81.14"></a><span id="l81.14">       if (!aPassword.IsEmpty())</span>
<a href="#l81.15"></a><span id="l81.15">         uniPassword = ToNewUnicode(NS_ConvertASCIItoUTF16(aPassword));</span>
<a href="#l81.16"></a><span id="l81.16"> </span>
<a href="#l81.17"></a><span id="l81.17">       bool okayValue = true;</span>
<a href="#l81.18"></a><span id="l81.18">       rv = dialog-&gt;PromptPassword(PromiseFlatString(aPromptTitle).get(),</span>
<a href="#l81.19"></a><span id="l81.19">                                   PromiseFlatString(aPromptMessage).get(),</span>
<a href="#l81.20"></a><span id="l81.20">                                   NS_ConvertASCIItoUTF16(serverUri).get(),</span>
<a href="#l81.21"></a><span id="l81.21">                                   nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -615,17 +615,17 @@ NS_IMETHODIMP nsMsgMailNewsUrl::SetFileB</span>
<a href="#l82.4"></a><span id="l82.4"> {</span>
<a href="#l82.5"></a><span id="l82.5">   return m_baseURL-&gt;SetFileBaseName(aFileBaseName);</span>
<a href="#l82.6"></a><span id="l82.6"> }</span>
<a href="#l82.7"></a><span id="l82.7"> </span>
<a href="#l82.8"></a><span id="l82.8"> NS_IMETHODIMP nsMsgMailNewsUrl::GetFileExtension(nsACString &amp;aFileExtension)</span>
<a href="#l82.9"></a><span id="l82.9"> {</span>
<a href="#l82.10"></a><span id="l82.10">   if (!mAttachmentFileName.IsEmpty())</span>
<a href="#l82.11"></a><span id="l82.11">   {</span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-    int32_t pos = mAttachmentFileName.RFindChar(PRUnichar('.'));</span>
<a href="#l82.13"></a><span id="l82.13" class="difflineplus">+    int32_t pos = mAttachmentFileName.RFindChar(char16_t('.'));</span>
<a href="#l82.14"></a><span id="l82.14">     if (pos &gt; 0)</span>
<a href="#l82.15"></a><span id="l82.15">       aFileExtension = Substring(mAttachmentFileName, pos + 1 /* skip the '.' */);</span>
<a href="#l82.16"></a><span id="l82.16">     return NS_OK;</span>
<a href="#l82.17"></a><span id="l82.17">   }</span>
<a href="#l82.18"></a><span id="l82.18">   return m_baseURL-&gt;GetFileExtension(aFileExtension);</span>
<a href="#l82.19"></a><span id="l82.19"> }</span>
<a href="#l82.20"></a><span id="l82.20"> </span>
<a href="#l82.21"></a><span id="l82.21"> NS_IMETHODIMP nsMsgMailNewsUrl::SetFileExtension(const nsACString &amp;aFileExtension)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -41,17 +41,17 @@</span>
<a href="#l83.4"></a><span id="l83.4"> </span>
<a href="#l83.5"></a><span id="l83.5"> #undef PostMessage // avoid to collision with WinUser.h</span>
<a href="#l83.6"></a><span id="l83.6"> </span>
<a href="#l83.7"></a><span id="l83.7"> using namespace mozilla;</span>
<a href="#l83.8"></a><span id="l83.8"> </span>
<a href="#l83.9"></a><span id="l83.9"> NS_IMPL_ISUPPORTS5(nsMsgProtocol, nsIChannel, nsIStreamListener,</span>
<a href="#l83.10"></a><span id="l83.10">   nsIRequestObserver, nsIRequest, nsITransportEventSink)</span>
<a href="#l83.11"></a><span id="l83.11"> </span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-static PRUnichar *FormatStringWithHostNameByID(int32_t stringID, nsIMsgMailNewsUrl *msgUri);</span>
<a href="#l83.13"></a><span id="l83.13" class="difflineplus">+static char16_t *FormatStringWithHostNameByID(int32_t stringID, nsIMsgMailNewsUrl *msgUri);</span>
<a href="#l83.14"></a><span id="l83.14"> </span>
<a href="#l83.15"></a><span id="l83.15"> </span>
<a href="#l83.16"></a><span id="l83.16"> nsMsgProtocol::nsMsgProtocol(nsIURI * aURL)</span>
<a href="#l83.17"></a><span id="l83.17"> {</span>
<a href="#l83.18"></a><span id="l83.18">   m_flags = 0;</span>
<a href="#l83.19"></a><span id="l83.19">   m_readCount = 0;</span>
<a href="#l83.20"></a><span id="l83.20">   mLoadFlags = 0;</span>
<a href="#l83.21"></a><span id="l83.21">   m_socketIsOpen = false;</span>
<a href="#l83.22"></a><span id="l83.22" class="difflineat">@@ -1526,41 +1526,41 @@ void nsMsgAsyncWriteProtocol::UpdateProg</span>
<a href="#l83.23"></a><span id="l83.23"> }</span>
<a href="#l83.24"></a><span id="l83.24"> </span>
<a href="#l83.25"></a><span id="l83.25"> nsresult nsMsgAsyncWriteProtocol::SendData(const char * dataBuffer, bool aSuppressLogging)</span>
<a href="#l83.26"></a><span id="l83.26"> {</span>
<a href="#l83.27"></a><span id="l83.27">   this-&gt;mAsyncBuffer.Append(dataBuffer);</span>
<a href="#l83.28"></a><span id="l83.28">   return mAsyncOutStream-&gt;AsyncWait(mProvider, 0, 0, mProviderThread);</span>
<a href="#l83.29"></a><span id="l83.29"> }</span>
<a href="#l83.30"></a><span id="l83.30"> </span>
<a href="#l83.31"></a><span id="l83.31" class="difflineminus">-PRUnichar *FormatStringWithHostNameByID(int32_t stringID, nsIMsgMailNewsUrl *msgUri)</span>
<a href="#l83.32"></a><span id="l83.32" class="difflineplus">+char16_t *FormatStringWithHostNameByID(int32_t stringID, nsIMsgMailNewsUrl *msgUri)</span>
<a href="#l83.33"></a><span id="l83.33"> {</span>
<a href="#l83.34"></a><span id="l83.34">   if (!msgUri)</span>
<a href="#l83.35"></a><span id="l83.35">     return nullptr;</span>
<a href="#l83.36"></a><span id="l83.36"> </span>
<a href="#l83.37"></a><span id="l83.37">   nsresult rv;</span>
<a href="#l83.38"></a><span id="l83.38"> </span>
<a href="#l83.39"></a><span id="l83.39">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l83.40"></a><span id="l83.40">     mozilla::services::GetStringBundleService();</span>
<a href="#l83.41"></a><span id="l83.41">   NS_ENSURE_TRUE(sBundleService, nullptr);</span>
<a href="#l83.42"></a><span id="l83.42"> </span>
<a href="#l83.43"></a><span id="l83.43">   nsCOMPtr&lt;nsIStringBundle&gt; sBundle;</span>
<a href="#l83.44"></a><span id="l83.44">   rv = sBundleService-&gt;CreateBundle(MSGS_URL, getter_AddRefs(sBundle));</span>
<a href="#l83.45"></a><span id="l83.45">   NS_ENSURE_SUCCESS(rv, nullptr);</span>
<a href="#l83.46"></a><span id="l83.46"> </span>
<a href="#l83.47"></a><span id="l83.47" class="difflineminus">-  PRUnichar *ptrv = nullptr;</span>
<a href="#l83.48"></a><span id="l83.48" class="difflineplus">+  char16_t *ptrv = nullptr;</span>
<a href="#l83.49"></a><span id="l83.49">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l83.50"></a><span id="l83.50">   rv = msgUri-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l83.51"></a><span id="l83.51">   NS_ENSURE_SUCCESS(rv, nullptr);</span>
<a href="#l83.52"></a><span id="l83.52"> </span>
<a href="#l83.53"></a><span id="l83.53">   nsCString hostName;</span>
<a href="#l83.54"></a><span id="l83.54">   rv = server-&gt;GetRealHostName(hostName);</span>
<a href="#l83.55"></a><span id="l83.55">   NS_ENSURE_SUCCESS(rv, nullptr);</span>
<a href="#l83.56"></a><span id="l83.56"> </span>
<a href="#l83.57"></a><span id="l83.57">   NS_ConvertASCIItoUTF16 hostStr(hostName);</span>
<a href="#l83.58"></a><span id="l83.58" class="difflineminus">-  const PRUnichar *params[] = { hostStr.get() };</span>
<a href="#l83.59"></a><span id="l83.59" class="difflineplus">+  const char16_t *params[] = { hostStr.get() };</span>
<a href="#l83.60"></a><span id="l83.60">   rv = sBundle-&gt;FormatStringFromID(stringID, params, 1, &amp;ptrv);</span>
<a href="#l83.61"></a><span id="l83.61">   NS_ENSURE_SUCCESS(rv, nullptr);</span>
<a href="#l83.62"></a><span id="l83.62"> </span>
<a href="#l83.63"></a><span id="l83.63">   return ptrv;</span>
<a href="#l83.64"></a><span id="l83.64"> }</span>
<a href="#l83.65"></a><span id="l83.65"> </span>
<a href="#l83.66"></a><span id="l83.66"> // vim: ts=2 sw=2</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -333,17 +333,17 @@ MsgFindCharInSet(const nsCString &amp;aStrin</span>
<a href="#l84.4"></a><span id="l84.4"> </span>
<a href="#l84.5"></a><span id="l84.5"> int32_t</span>
<a href="#l84.6"></a><span id="l84.6"> MsgFindCharInSet(const nsString &amp;aString,</span>
<a href="#l84.7"></a><span id="l84.7">                  const char* aChars, uint32_t aOffset)</span>
<a href="#l84.8"></a><span id="l84.8"> {</span>
<a href="#l84.9"></a><span id="l84.9"> #ifdef MOZILLA_INTERNAL_API</span>
<a href="#l84.10"></a><span id="l84.10">   return aString.FindCharInSet(aChars, aOffset);</span>
<a href="#l84.11"></a><span id="l84.11"> #else</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-  const PRUnichar *str;</span>
<a href="#l84.13"></a><span id="l84.13" class="difflineplus">+  const char16_t *str;</span>
<a href="#l84.14"></a><span id="l84.14">   uint32_t len = aString.BeginReading(&amp;str);</span>
<a href="#l84.15"></a><span id="l84.15">   int filter = GetFindInSetFilter(aChars);</span>
<a href="#l84.16"></a><span id="l84.16">   for (uint32_t index = aOffset; index &lt; len; index++) {</span>
<a href="#l84.17"></a><span id="l84.17">     if (!(str[index] &amp; filter) &amp;&amp; strchr(aChars, str[index]))</span>
<a href="#l84.18"></a><span id="l84.18">       return index;</span>
<a href="#l84.19"></a><span id="l84.19">   }</span>
<a href="#l84.20"></a><span id="l84.20">   return -1;</span>
<a href="#l84.21"></a><span id="l84.21"> #endif</span>
<a href="#l84.22"></a><span id="l84.22" class="difflineat">@@ -474,17 +474,17 @@ nsresult NS_MsgHashIfNecessary(nsAutoStr</span>
<a href="#l84.23"></a><span id="l84.23"> </span>
<a href="#l84.24"></a><span id="l84.24"> nsresult FormatFileSize(uint64_t size, bool useKB, nsAString &amp;formattedSize)</span>
<a href="#l84.25"></a><span id="l84.25"> {</span>
<a href="#l84.26"></a><span id="l84.26">   NS_NAMED_LITERAL_STRING(byteAbbr, &quot;byteAbbreviation2&quot;);</span>
<a href="#l84.27"></a><span id="l84.27">   NS_NAMED_LITERAL_STRING(kbAbbr,   &quot;kiloByteAbbreviation2&quot;);</span>
<a href="#l84.28"></a><span id="l84.28">   NS_NAMED_LITERAL_STRING(mbAbbr,   &quot;megaByteAbbreviation2&quot;);</span>
<a href="#l84.29"></a><span id="l84.29">   NS_NAMED_LITERAL_STRING(gbAbbr,   &quot;gigaByteAbbreviation2&quot;);</span>
<a href="#l84.30"></a><span id="l84.30"> </span>
<a href="#l84.31"></a><span id="l84.31" class="difflineminus">-  const PRUnichar *sizeAbbrNames[] = {</span>
<a href="#l84.32"></a><span id="l84.32" class="difflineplus">+  const char16_t *sizeAbbrNames[] = {</span>
<a href="#l84.33"></a><span id="l84.33">     byteAbbr.get(), kbAbbr.get(), mbAbbr.get(), gbAbbr.get()</span>
<a href="#l84.34"></a><span id="l84.34">   };</span>
<a href="#l84.35"></a><span id="l84.35"> </span>
<a href="#l84.36"></a><span id="l84.36">   nsresult rv;</span>
<a href="#l84.37"></a><span id="l84.37"> </span>
<a href="#l84.38"></a><span id="l84.38">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleSvc =</span>
<a href="#l84.39"></a><span id="l84.39">     mozilla::services::GetStringBundleService();</span>
<a href="#l84.40"></a><span id="l84.40">   NS_ENSURE_TRUE(bundleSvc, NS_ERROR_UNEXPECTED);</span>
<a href="#l84.41"></a><span id="l84.41" class="difflineat">@@ -1791,33 +1791,33 @@ NS_MSG_BASE char *MsgEscapeHTML(const ch</span>
<a href="#l84.42"></a><span id="l84.42">         *ptr++ = *string;</span>
<a href="#l84.43"></a><span id="l84.43">       }</span>
<a href="#l84.44"></a><span id="l84.44">     }</span>
<a href="#l84.45"></a><span id="l84.45">     *ptr = '\0';</span>
<a href="#l84.46"></a><span id="l84.46">   }</span>
<a href="#l84.47"></a><span id="l84.47">   return(rv);</span>
<a href="#l84.48"></a><span id="l84.48"> }</span>
<a href="#l84.49"></a><span id="l84.49"> </span>
<a href="#l84.50"></a><span id="l84.50" class="difflineminus">-NS_MSG_BASE PRUnichar *MsgEscapeHTML2(const PRUnichar *aSourceBuffer,</span>
<a href="#l84.51"></a><span id="l84.51" class="difflineplus">+NS_MSG_BASE char16_t *MsgEscapeHTML2(const char16_t *aSourceBuffer,</span>
<a href="#l84.52"></a><span id="l84.52">                                       int32_t aSourceBufferLen)</span>
<a href="#l84.53"></a><span id="l84.53"> {</span>
<a href="#l84.54"></a><span id="l84.54">   // if the caller didn't calculate the length</span>
<a href="#l84.55"></a><span id="l84.55">   if (aSourceBufferLen == -1) {</span>
<a href="#l84.56"></a><span id="l84.56">     aSourceBufferLen = NS_strlen(aSourceBuffer); // ...then I will</span>
<a href="#l84.57"></a><span id="l84.57">   }</span>
<a href="#l84.58"></a><span id="l84.58"> </span>
<a href="#l84.59"></a><span id="l84.59">   /* XXX Hardcoded max entity len. */</span>
<a href="#l84.60"></a><span id="l84.60">   if (aSourceBufferLen &gt;=</span>
<a href="#l84.61"></a><span id="l84.61" class="difflineminus">-    ((PR_UINT32_MAX - sizeof(PRUnichar)) / (6 * sizeof(PRUnichar))) )</span>
<a href="#l84.62"></a><span id="l84.62" class="difflineplus">+    ((PR_UINT32_MAX - sizeof(char16_t)) / (6 * sizeof(char16_t))) )</span>
<a href="#l84.63"></a><span id="l84.63">       return nullptr;</span>
<a href="#l84.64"></a><span id="l84.64"> </span>
<a href="#l84.65"></a><span id="l84.65" class="difflineminus">-  PRUnichar *resultBuffer = (PRUnichar *)nsMemory::Alloc(aSourceBufferLen *</span>
<a href="#l84.66"></a><span id="l84.66" class="difflineminus">-                            6 * sizeof(PRUnichar) + sizeof(PRUnichar('\0')));</span>
<a href="#l84.67"></a><span id="l84.67" class="difflineplus">+  char16_t *resultBuffer = (char16_t *)nsMemory::Alloc(aSourceBufferLen *</span>
<a href="#l84.68"></a><span id="l84.68" class="difflineplus">+                            6 * sizeof(char16_t) + sizeof(char16_t('\0')));</span>
<a href="#l84.69"></a><span id="l84.69">                                                         </span>
<a href="#l84.70"></a><span id="l84.70" class="difflineminus">-  PRUnichar *ptr = resultBuffer;</span>
<a href="#l84.71"></a><span id="l84.71" class="difflineplus">+  char16_t *ptr = resultBuffer;</span>
<a href="#l84.72"></a><span id="l84.72"> </span>
<a href="#l84.73"></a><span id="l84.73">   if (resultBuffer) {</span>
<a href="#l84.74"></a><span id="l84.74">     int32_t i;</span>
<a href="#l84.75"></a><span id="l84.75"> </span>
<a href="#l84.76"></a><span id="l84.76">     for(i = 0; i &lt; aSourceBufferLen; i++) {</span>
<a href="#l84.77"></a><span id="l84.77">       if(aSourceBuffer[i] == '&lt;') {</span>
<a href="#l84.78"></a><span id="l84.78">         *ptr++ = '&amp;';</span>
<a href="#l84.79"></a><span id="l84.79">         *ptr++ = 'l';</span>
<a href="#l84.80"></a><span id="l84.80" class="difflineat">@@ -1889,19 +1889,19 @@ NS_MSG_BASE void MsgCompressWhitespace(n</span>
<a href="#l84.81"></a><span id="l84.81">       *m = *(m + wlen);</span>
<a href="#l84.82"></a><span id="l84.82">     }</span>
<a href="#l84.83"></a><span id="l84.83">   }</span>
<a href="#l84.84"></a><span id="l84.84"> </span>
<a href="#l84.85"></a><span id="l84.85">   // Set the new length.</span>
<a href="#l84.86"></a><span id="l84.86">   aString.SetLength(end - start);</span>
<a href="#l84.87"></a><span id="l84.87"> }</span>
<a href="#l84.88"></a><span id="l84.88"> </span>
<a href="#l84.89"></a><span id="l84.89" class="difflineminus">-NS_MSG_BASE void MsgReplaceChar(nsString&amp; str, const char *set, const PRUnichar replacement)</span>
<a href="#l84.90"></a><span id="l84.90" class="difflineplus">+NS_MSG_BASE void MsgReplaceChar(nsString&amp; str, const char *set, const char16_t replacement)</span>
<a href="#l84.91"></a><span id="l84.91"> {</span>
<a href="#l84.92"></a><span id="l84.92" class="difflineminus">-  PRUnichar *c_str = str.BeginWriting();</span>
<a href="#l84.93"></a><span id="l84.93" class="difflineplus">+  char16_t *c_str = str.BeginWriting();</span>
<a href="#l84.94"></a><span id="l84.94">   while (*set) {</span>
<a href="#l84.95"></a><span id="l84.95">     int32_t pos = 0;</span>
<a href="#l84.96"></a><span id="l84.96">     while ((pos = str.FindChar(*set, pos)) != -1) {</span>
<a href="#l84.97"></a><span id="l84.97">       c_str[pos++] = replacement;</span>
<a href="#l84.98"></a><span id="l84.98">     }</span>
<a href="#l84.99"></a><span id="l84.99">     set++;</span>
<a href="#l84.100"></a><span id="l84.100">   }</span>
<a href="#l84.101"></a><span id="l84.101"> }</span>
<a href="#l84.102"></a><span id="l84.102" class="difflineat">@@ -1932,17 +1932,17 @@ NS_MSG_BASE nsIAtom* MsgNewPermanentAtom</span>
<a href="#l84.103"></a><span id="l84.103"> </span>
<a href="#l84.104"></a><span id="l84.104">   if (atomService)</span>
<a href="#l84.105"></a><span id="l84.105">     atomService-&gt;GetPermanentAtomUTF8(aString, &amp;atom);</span>
<a href="#l84.106"></a><span id="l84.106">   return atom;</span>
<a href="#l84.107"></a><span id="l84.107"> }</span>
<a href="#l84.108"></a><span id="l84.108"> </span>
<a href="#l84.109"></a><span id="l84.109"> NS_MSG_BASE void MsgReplaceSubstring(nsAString &amp;str, const nsAString &amp;what, const nsAString &amp;replacement)</span>
<a href="#l84.110"></a><span id="l84.110"> {</span>
<a href="#l84.111"></a><span id="l84.111" class="difflineminus">-  const PRUnichar* replacement_str;</span>
<a href="#l84.112"></a><span id="l84.112" class="difflineplus">+  const char16_t* replacement_str;</span>
<a href="#l84.113"></a><span id="l84.113">   uint32_t replacementLength = replacement.BeginReading(&amp;replacement_str);</span>
<a href="#l84.114"></a><span id="l84.114">   uint32_t whatLength = what.Length();</span>
<a href="#l84.115"></a><span id="l84.115">   int32_t i = 0;</span>
<a href="#l84.116"></a><span id="l84.116"> </span>
<a href="#l84.117"></a><span id="l84.117">   while ((i = str.Find(what, i)) != kNotFound)</span>
<a href="#l84.118"></a><span id="l84.118">   {</span>
<a href="#l84.119"></a><span id="l84.119">     str.Replace(i, whatLength, replacement_str, replacementLength);</span>
<a href="#l84.120"></a><span id="l84.120">     i += replacementLength;</span>
<a href="#l84.121"></a><span id="l84.121" class="difflineat">@@ -2126,17 +2126,17 @@ NS_MSG_BASE nsresult MsgPromptLoginFaile</span>
<a href="#l84.122"></a><span id="l84.122"> </span>
<a href="#l84.123"></a><span id="l84.123">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l84.124"></a><span id="l84.124">   rv = bundleSvc-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l84.125"></a><span id="l84.125">                                getter_AddRefs(bundle));</span>
<a href="#l84.126"></a><span id="l84.126">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.127"></a><span id="l84.127"> </span>
<a href="#l84.128"></a><span id="l84.128">   nsString message;</span>
<a href="#l84.129"></a><span id="l84.129">   NS_ConvertUTF8toUTF16 hostNameUTF16(aHostname);</span>
<a href="#l84.130"></a><span id="l84.130" class="difflineminus">-  const PRUnichar *formatStrings[] = { hostNameUTF16.get() };</span>
<a href="#l84.131"></a><span id="l84.131" class="difflineplus">+  const char16_t *formatStrings[] = { hostNameUTF16.get() };</span>
<a href="#l84.132"></a><span id="l84.132"> </span>
<a href="#l84.133"></a><span id="l84.133">   rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;mailServerLoginFailed&quot;),</span>
<a href="#l84.134"></a><span id="l84.134">                                     formatStrings, 1,</span>
<a href="#l84.135"></a><span id="l84.135">                                     getter_Copies(message));</span>
<a href="#l84.136"></a><span id="l84.136">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.137"></a><span id="l84.137"> </span>
<a href="#l84.138"></a><span id="l84.138">   nsString title;</span>
<a href="#l84.139"></a><span id="l84.139">   rv = bundle-&gt;GetStringFromName(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -423,33 +423,33 @@ inline int32_t MsgFind(nsACString &amp;str, </span>
<a href="#l85.4"></a><span id="l85.4"> /// Equivalent of RFindChar(ch, len)</span>
<a href="#l85.5"></a><span id="l85.5"> #define MsgRFindChar(str, ch, len) \</span>
<a href="#l85.6"></a><span id="l85.6">         StringHead(str, len).RFindChar(ch)</span>
<a href="#l85.7"></a><span id="l85.7"> /// Equivalent of aString.CompressWhitespace()</span>
<a href="#l85.8"></a><span id="l85.8"> NS_MSG_BASE void MsgCompressWhitespace(nsCString&amp; aString);</span>
<a href="#l85.9"></a><span id="l85.9"> /// Equivalent of nsEscapeHTML(aString)</span>
<a href="#l85.10"></a><span id="l85.10"> NS_MSG_BASE char *MsgEscapeHTML(const char *aString);</span>
<a href="#l85.11"></a><span id="l85.11"> /// Equivalent of nsEscapeHTML2(aBuffer, aLen)</span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-NS_MSG_BASE PRUnichar *MsgEscapeHTML2(const PRUnichar *aBuffer, int32_t aLen);</span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+NS_MSG_BASE char16_t *MsgEscapeHTML2(const char16_t *aBuffer, int32_t aLen);</span>
<a href="#l85.14"></a><span id="l85.14"> // Existing replacement for IsUTF8</span>
<a href="#l85.15"></a><span id="l85.15"> NS_MSG_BASE bool MsgIsUTF8(const nsACString&amp; aString);</span>
<a href="#l85.16"></a><span id="l85.16"> /// Equivalent of NS_NewAtom(aUTF8String)</span>
<a href="#l85.17"></a><span id="l85.17"> NS_MSG_BASE already_AddRefed&lt;nsIAtom&gt; MsgNewAtom(const char* aString);</span>
<a href="#l85.18"></a><span id="l85.18"> /// Replacement of NS_RegisterStaticAtoms</span>
<a href="#l85.19"></a><span id="l85.19"> NS_MSG_BASE nsIAtom* MsgNewPermanentAtom(const char* aString);</span>
<a href="#l85.20"></a><span id="l85.20"> /// Equivalent of do_GetAtom(aUTF8String)</span>
<a href="#l85.21"></a><span id="l85.21"> inline already_AddRefed&lt;nsIAtom&gt; MsgGetAtom(const char* aUTF8String)</span>
<a href="#l85.22"></a><span id="l85.22"> {</span>
<a href="#l85.23"></a><span id="l85.23">   return MsgNewAtom(aUTF8String);</span>
<a href="#l85.24"></a><span id="l85.24"> }</span>
<a href="#l85.25"></a><span id="l85.25"> /// Equivalent of ns(C)String::ReplaceSubstring(what, replacement)</span>
<a href="#l85.26"></a><span id="l85.26"> NS_MSG_BASE void MsgReplaceSubstring(nsAString &amp;str, const nsAString &amp;what, const nsAString &amp;replacement);</span>
<a href="#l85.27"></a><span id="l85.27"> NS_MSG_BASE void MsgReplaceSubstring(nsACString &amp;str, const char *what, const char *replacement);</span>
<a href="#l85.28"></a><span id="l85.28"> /// Equivalent of ns(C)String::ReplaceChar(what, replacement)</span>
<a href="#l85.29"></a><span id="l85.29" class="difflineminus">-NS_MSG_BASE void MsgReplaceChar(nsString&amp; str, const char *set, const PRUnichar replacement);</span>
<a href="#l85.30"></a><span id="l85.30" class="difflineplus">+NS_MSG_BASE void MsgReplaceChar(nsString&amp; str, const char *set, const char16_t replacement);</span>
<a href="#l85.31"></a><span id="l85.31"> NS_MSG_BASE void MsgReplaceChar(nsCString&amp; str, const char needle, const char replacement);</span>
<a href="#l85.32"></a><span id="l85.32"> // Equivalent of NS_NewInterfaceRequestorAggregation(aFirst, aSecond, aResult)</span>
<a href="#l85.33"></a><span id="l85.33"> NS_MSG_BASE nsresult MsgNewInterfaceRequestorAggregation(nsIInterfaceRequestor *aFirst,</span>
<a href="#l85.34"></a><span id="l85.34">                                                          nsIInterfaceRequestor *aSecond,</span>
<a href="#l85.35"></a><span id="l85.35">                                                          nsIInterfaceRequestor **aResult);</span>
<a href="#l85.36"></a><span id="l85.36"> </span>
<a href="#l85.37"></a><span id="l85.37"> /**</span>
<a href="#l85.38"></a><span id="l85.38">  * This function is based on NS_NewNotificationCallbacksAggregation from</span>
<a href="#l85.39"></a><span id="l85.39" class="difflineat">@@ -499,33 +499,33 @@ do_QueryElementAt( nsISupportsArray* arr</span>
<a href="#l85.40"></a><span id="l85.40"> {</span>
<a href="#l85.41"></a><span id="l85.41">     return MsgQueryElementAt(array, aIndex, aErrorPtr);</span>
<a href="#l85.42"></a><span id="l85.42"> }</span>
<a href="#l85.43"></a><span id="l85.43"> /**</span>
<a href="#l85.44"></a><span id="l85.44">  * Count occurences of specified character in string.</span>
<a href="#l85.45"></a><span id="l85.45">  *</span>
<a href="#l85.46"></a><span id="l85.46">  */</span>
<a href="#l85.47"></a><span id="l85.47"> inline</span>
<a href="#l85.48"></a><span id="l85.48" class="difflineminus">-uint32_t MsgCountChar(nsACString &amp;aString, PRUnichar aChar) {</span>
<a href="#l85.49"></a><span id="l85.49" class="difflineplus">+uint32_t MsgCountChar(nsACString &amp;aString, char16_t aChar) {</span>
<a href="#l85.50"></a><span id="l85.50">   const char *begin, *end;</span>
<a href="#l85.51"></a><span id="l85.51">   uint32_t num_chars = 0;</span>
<a href="#l85.52"></a><span id="l85.52">   aString.BeginReading(&amp;begin, &amp;end);</span>
<a href="#l85.53"></a><span id="l85.53">   for (const char *current = begin; current &lt; end; ++current) {</span>
<a href="#l85.54"></a><span id="l85.54">       if (*current == aChar)</span>
<a href="#l85.55"></a><span id="l85.55">         ++num_chars;</span>
<a href="#l85.56"></a><span id="l85.56">   }</span>
<a href="#l85.57"></a><span id="l85.57">   return num_chars;</span>
<a href="#l85.58"></a><span id="l85.58"> }</span>
<a href="#l85.59"></a><span id="l85.59"> </span>
<a href="#l85.60"></a><span id="l85.60"> inline</span>
<a href="#l85.61"></a><span id="l85.61" class="difflineminus">-uint32_t MsgCountChar(nsAString &amp;aString, PRUnichar aChar) {</span>
<a href="#l85.62"></a><span id="l85.62" class="difflineminus">-  const PRUnichar *begin, *end;</span>
<a href="#l85.63"></a><span id="l85.63" class="difflineplus">+uint32_t MsgCountChar(nsAString &amp;aString, char16_t aChar) {</span>
<a href="#l85.64"></a><span id="l85.64" class="difflineplus">+  const char16_t *begin, *end;</span>
<a href="#l85.65"></a><span id="l85.65">   uint32_t num_chars = 0;</span>
<a href="#l85.66"></a><span id="l85.66">   aString.BeginReading(&amp;begin, &amp;end);</span>
<a href="#l85.67"></a><span id="l85.67" class="difflineminus">-  for (const PRUnichar *current = begin; current &lt; end; ++current) {</span>
<a href="#l85.68"></a><span id="l85.68" class="difflineplus">+  for (const char16_t *current = begin; current &lt; end; ++current) {</span>
<a href="#l85.69"></a><span id="l85.69">       if (*current == aChar)</span>
<a href="#l85.70"></a><span id="l85.70">         ++num_chars;</span>
<a href="#l85.71"></a><span id="l85.71">   }</span>
<a href="#l85.72"></a><span id="l85.72">   return num_chars;</span>
<a href="#l85.73"></a><span id="l85.73"> }</span>
<a href="#l85.74"></a><span id="l85.74"> </span>
<a href="#l85.75"></a><span id="l85.75"> #endif</span>
<a href="#l85.76"></a><span id="l85.76"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/mailnews/compose/public/nsIURLFetcher.idl</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/mailnews/compose/public/nsIURLFetcher.idl</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -12,17 +12,17 @@</span>
<a href="#l86.4"></a><span id="l86.4"> </span>
<a href="#l86.5"></a><span id="l86.5"> //</span>
<a href="#l86.6"></a><span id="l86.6"> // Callback declarations for URL completion</span>
<a href="#l86.7"></a><span id="l86.7"> //</span>
<a href="#l86.8"></a><span id="l86.8"> // For completion of send/message creation operations...</span>
<a href="#l86.9"></a><span id="l86.9"> typedef nsresult (*nsAttachSaveCompletionCallback) (nsresult aStatus,</span>
<a href="#l86.10"></a><span id="l86.10">                                                     const nsACString &amp;aContentType,</span>
<a href="#l86.11"></a><span id="l86.11">                                                     const nsACString &amp;aCharset,</span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-                                                    int32_t totalSize, const PRUnichar* aMsg, </span>
<a href="#l86.13"></a><span id="l86.13" class="difflineplus">+                                                    int32_t totalSize, const char16_t* aMsg, </span>
<a href="#l86.14"></a><span id="l86.14">                                                     void *tagData);</span>
<a href="#l86.15"></a><span id="l86.15"> </span>
<a href="#l86.16"></a><span id="l86.16"> class nsMsgAttachmentHandler;</span>
<a href="#l86.17"></a><span id="l86.17"> %}</span>
<a href="#l86.18"></a><span id="l86.18"> </span>
<a href="#l86.19"></a><span id="l86.19"> native nsAttachSaveCompletionCallback(nsAttachSaveCompletionCallback);</span>
<a href="#l86.20"></a><span id="l86.20"> [ptr] native nsMsgAttachmentHandler(nsMsgAttachmentHandler);</span>
<a href="#l86.21"></a><span id="l86.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -436,17 +436,17 @@ nsMsgAttachmentHandler::PickCharset()</span>
<a href="#l87.4"></a><span id="l87.4">   return MsgDetectCharsetFromFile(tmpFile, m_charset);</span>
<a href="#l87.5"></a><span id="l87.5"> }</span>
<a href="#l87.6"></a><span id="l87.6">     </span>
<a href="#l87.7"></a><span id="l87.7"> static nsresult</span>
<a href="#l87.8"></a><span id="l87.8"> FetcherURLDoneCallback(nsresult aStatus,</span>
<a href="#l87.9"></a><span id="l87.9">                        const nsACString &amp;aContentType,</span>
<a href="#l87.10"></a><span id="l87.10">                        const nsACString &amp;aCharset,</span>
<a href="#l87.11"></a><span id="l87.11">                        int32_t totalSize,</span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-                       const PRUnichar* aMsg, void *tagData)</span>
<a href="#l87.13"></a><span id="l87.13" class="difflineplus">+                       const char16_t* aMsg, void *tagData)</span>
<a href="#l87.14"></a><span id="l87.14"> {</span>
<a href="#l87.15"></a><span id="l87.15">   nsMsgAttachmentHandler *ma = (nsMsgAttachmentHandler *) tagData;</span>
<a href="#l87.16"></a><span id="l87.16">   NS_ASSERTION(ma != nullptr, &quot;not-null mime attachment&quot;);</span>
<a href="#l87.17"></a><span id="l87.17"> </span>
<a href="#l87.18"></a><span id="l87.18">   if (ma != nullptr)</span>
<a href="#l87.19"></a><span id="l87.19">   {</span>
<a href="#l87.20"></a><span id="l87.20">     ma-&gt;m_size = totalSize;</span>
<a href="#l87.21"></a><span id="l87.21">     if (!aContentType.IsEmpty())</span>
<a href="#l87.22"></a><span id="l87.22" class="difflineat">@@ -980,17 +980,17 @@ nsMsgAttachmentHandler::Abort()</span>
<a href="#l87.23"></a><span id="l87.23">       m_mime_delivery_state-&gt;SetStatus(NS_ERROR_ABORT);</span>
<a href="#l87.24"></a><span id="l87.24">       m_mime_delivery_state-&gt;NotifyListenerOnStopSending(nullptr, NS_ERROR_ABORT, 0, nullptr);</span>
<a href="#l87.25"></a><span id="l87.25">     }</span>
<a href="#l87.26"></a><span id="l87.26">   return NS_OK;</span>
<a href="#l87.27"></a><span id="l87.27"> </span>
<a href="#l87.28"></a><span id="l87.28"> }</span>
<a href="#l87.29"></a><span id="l87.29"> </span>
<a href="#l87.30"></a><span id="l87.30"> nsresult</span>
<a href="#l87.31"></a><span id="l87.31" class="difflineminus">-nsMsgAttachmentHandler::UrlExit(nsresult status, const PRUnichar* aMsg)</span>
<a href="#l87.32"></a><span id="l87.32" class="difflineplus">+nsMsgAttachmentHandler::UrlExit(nsresult status, const char16_t* aMsg)</span>
<a href="#l87.33"></a><span id="l87.33"> {</span>
<a href="#l87.34"></a><span id="l87.34">   NS_ASSERTION(m_mime_delivery_state != nullptr, &quot;not-null m_mime_delivery_state&quot;);</span>
<a href="#l87.35"></a><span id="l87.35"> </span>
<a href="#l87.36"></a><span id="l87.36">   // Close the file, but don't delete the disk file (or the file spec.)</span>
<a href="#l87.37"></a><span id="l87.37">   if (mOutFile)</span>
<a href="#l87.38"></a><span id="l87.38">   {</span>
<a href="#l87.39"></a><span id="l87.39">     mOutFile-&gt;Close();</span>
<a href="#l87.40"></a><span id="l87.40">     mOutFile = nullptr;</span>
<a href="#l87.41"></a><span id="l87.41" class="difflineat">@@ -1025,17 +1025,17 @@ nsMsgAttachmentHandler::UrlExit(nsresult</span>
<a href="#l87.42"></a><span id="l87.42">   if (NS_FAILED(status) &amp;&amp; status != NS_ERROR_ABORT &amp;&amp; NS_SUCCEEDED(mimeDeliveryStatus))</span>
<a href="#l87.43"></a><span id="l87.43">   {</span>
<a href="#l87.44"></a><span id="l87.44">     // At this point, we should probably ask a question to the user</span>
<a href="#l87.45"></a><span id="l87.45">     // if we should continue without this attachment.</span>
<a href="#l87.46"></a><span id="l87.46">     //</span>
<a href="#l87.47"></a><span id="l87.47">     bool              keepOnGoing = true;</span>
<a href="#l87.48"></a><span id="l87.48">     nsCString    turl;</span>
<a href="#l87.49"></a><span id="l87.49">     nsString     msg;</span>
<a href="#l87.50"></a><span id="l87.50" class="difflineminus">-    PRUnichar         *printfString = nullptr;</span>
<a href="#l87.51"></a><span id="l87.51" class="difflineplus">+    char16_t         *printfString = nullptr;</span>
<a href="#l87.52"></a><span id="l87.52">     nsresult rv;</span>
<a href="#l87.53"></a><span id="l87.53">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l87.54"></a><span id="l87.54">       mozilla::services::GetStringBundleService();</span>
<a href="#l87.55"></a><span id="l87.55">     NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l87.56"></a><span id="l87.56">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l87.57"></a><span id="l87.57">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l87.58"></a><span id="l87.58">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l87.59"></a><span id="l87.59">     nsMsgDeliverMode mode = nsIMsgSend::nsMsgDeliverNow;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.h</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.h</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -72,17 +72,17 @@ public:</span>
<a href="#l88.4"></a><span id="l88.4"> public:</span>
<a href="#l88.5"></a><span id="l88.5">   nsresult              SnarfAttachment(nsMsgCompFields *compFields);</span>
<a href="#l88.6"></a><span id="l88.6">   nsresult              PickEncoding(const char *charset, nsIMsgSend* mime_delivery_state);</span>
<a href="#l88.7"></a><span id="l88.7">   nsresult              PickCharset();</span>
<a href="#l88.8"></a><span id="l88.8">   void                  AnalyzeSnarfedFile ();      // Analyze a previously-snarfed file.</span>
<a href="#l88.9"></a><span id="l88.9">                                                     // (Currently only used for plaintext</span>
<a href="#l88.10"></a><span id="l88.10">                                                     // converted from HTML.) </span>
<a href="#l88.11"></a><span id="l88.11">   nsresult              Abort();</span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-  nsresult              UrlExit(nsresult status, const PRUnichar* aMsg);</span>
<a href="#l88.13"></a><span id="l88.13" class="difflineplus">+  nsresult              UrlExit(nsresult status, const char16_t* aMsg);</span>
<a href="#l88.14"></a><span id="l88.14">   </span>
<a href="#l88.15"></a><span id="l88.15">   // if there's an intermediate temp file left, takes care to remove it from disk.</span>
<a href="#l88.16"></a><span id="l88.16">   //</span>
<a href="#l88.17"></a><span id="l88.17">   // NOTE: this takes care of the mEncodedWorkingFile temp file, but not mTmpFile which seems</span>
<a href="#l88.18"></a><span id="l88.18">   // to be used by lots of other classes at the moment.</span>
<a href="#l88.19"></a><span id="l88.19">   void                  CleanupTempFile();</span>
<a href="#l88.20"></a><span id="l88.20"> </span>
<a href="#l88.21"></a><span id="l88.21"> private:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -502,33 +502,33 @@ NS_IMETHODIMP nsMsgCompFields::RemoveAtt</span>
<a href="#l89.4"></a><span id="l89.4"> }</span>
<a href="#l89.5"></a><span id="l89.5"> </span>
<a href="#l89.6"></a><span id="l89.6"> </span>
<a href="#l89.7"></a><span id="l89.7"> // This method is called during the creation of a new window.</span>
<a href="#l89.8"></a><span id="l89.8"> NS_IMETHODIMP</span>
<a href="#l89.9"></a><span id="l89.9"> nsMsgCompFields::SplitRecipients(const nsAString &amp;aRecipients,</span>
<a href="#l89.10"></a><span id="l89.10">                                  bool aEmailAddressOnly,</span>
<a href="#l89.11"></a><span id="l89.11">                                  uint32_t *aLength,</span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-                                 PRUnichar*** aResult)</span>
<a href="#l89.13"></a><span id="l89.13" class="difflineplus">+                                 char16_t*** aResult)</span>
<a href="#l89.14"></a><span id="l89.14"> {</span>
<a href="#l89.15"></a><span id="l89.15">   NS_ENSURE_ARG_POINTER(aLength);</span>
<a href="#l89.16"></a><span id="l89.16">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l89.17"></a><span id="l89.17"> </span>
<a href="#l89.18"></a><span id="l89.18">   *aLength = 0;</span>
<a href="#l89.19"></a><span id="l89.19">   *aResult = nullptr;</span>
<a href="#l89.20"></a><span id="l89.20"> </span>
<a href="#l89.21"></a><span id="l89.21">   ParsedHeader header(EncodedHeader(NS_ConvertUTF16toUTF8(aRecipients)));</span>
<a href="#l89.22"></a><span id="l89.22">   nsTArray&lt;nsString&gt; results;</span>
<a href="#l89.23"></a><span id="l89.23">   if (aEmailAddressOnly)</span>
<a href="#l89.24"></a><span id="l89.24">     ExtractEmails(header, results);</span>
<a href="#l89.25"></a><span id="l89.25">   else</span>
<a href="#l89.26"></a><span id="l89.26">     ExtractDisplayAddresses(header, results);</span>
<a href="#l89.27"></a><span id="l89.27">   </span>
<a href="#l89.28"></a><span id="l89.28">   uint32_t count = results.Length();</span>
<a href="#l89.29"></a><span id="l89.29" class="difflineminus">-  PRUnichar **result = (PRUnichar **)NS_Alloc(sizeof(PRUnichar *) * count);</span>
<a href="#l89.30"></a><span id="l89.30" class="difflineplus">+  char16_t **result = (char16_t **)NS_Alloc(sizeof(char16_t *) * count);</span>
<a href="#l89.31"></a><span id="l89.31">   for (uint32_t i = 0; i &lt; count; ++i)</span>
<a href="#l89.32"></a><span id="l89.32">     result[i] = ToNewUnicode(results[i]);</span>
<a href="#l89.33"></a><span id="l89.33"> </span>
<a href="#l89.34"></a><span id="l89.34">   *aResult = result;</span>
<a href="#l89.35"></a><span id="l89.35">   *aLength = count;</span>
<a href="#l89.36"></a><span id="l89.36">   return NS_OK;</span>
<a href="#l89.37"></a><span id="l89.37"> }</span>
<a href="#l89.38"></a><span id="l89.38"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -1578,17 +1578,17 @@ msg_make_filename_qtext(const char *srcT</span>
<a href="#l90.4"></a><span id="l90.4">   *d = 0;</span>
<a href="#l90.5"></a><span id="l90.5"> </span>
<a href="#l90.6"></a><span id="l90.6">   return newString;</span>
<a href="#l90.7"></a><span id="l90.7"> }</span>
<a href="#l90.8"></a><span id="l90.8"> </span>
<a href="#l90.9"></a><span id="l90.9"> /* Rip apart the URL and extract a reasonable value for the `real_name' slot.</span>
<a href="#l90.10"></a><span id="l90.10">  */</span>
<a href="#l90.11"></a><span id="l90.11"> void</span>
<a href="#l90.12"></a><span id="l90.12" class="difflineminus">-msg_pick_real_name (nsMsgAttachmentHandler *attachment, const PRUnichar *proposedName, const char *charset)</span>
<a href="#l90.13"></a><span id="l90.13" class="difflineplus">+msg_pick_real_name (nsMsgAttachmentHandler *attachment, const char16_t *proposedName, const char *charset)</span>
<a href="#l90.14"></a><span id="l90.14"> {</span>
<a href="#l90.15"></a><span id="l90.15">   const char *s, *s2;</span>
<a href="#l90.16"></a><span id="l90.16"> </span>
<a href="#l90.17"></a><span id="l90.17">   if (!attachment-&gt;m_realName.IsEmpty())</span>
<a href="#l90.18"></a><span id="l90.18">     return;</span>
<a href="#l90.19"></a><span id="l90.19"> </span>
<a href="#l90.20"></a><span id="l90.20">   if (proposedName &amp;&amp; *proposedName)</span>
<a href="#l90.21"></a><span id="l90.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.h</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.h</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -102,17 +102,17 @@ char        *mime_fix_addr_header (const</span>
<a href="#l91.4"></a><span id="l91.4"> char        *mime_fix_news_header (const char *string);</span>
<a href="#l91.5"></a><span id="l91.5"> </span>
<a href="#l91.6"></a><span id="l91.6"> bool        mime_type_requires_b64_p (const char *type);</span>
<a href="#l91.7"></a><span id="l91.7"> bool        mime_type_needs_charset (const char *type);</span>
<a href="#l91.8"></a><span id="l91.8"> </span>
<a href="#l91.9"></a><span id="l91.9"> char        *msg_make_filename_qtext(const char *srcText, bool stripCRLFs);</span>
<a href="#l91.10"></a><span id="l91.10"> </span>
<a href="#l91.11"></a><span id="l91.11"> // Rip apart the URL and extract a reasonable value for the `real_name' slot.</span>
<a href="#l91.12"></a><span id="l91.12" class="difflineminus">-void        msg_pick_real_name (nsMsgAttachmentHandler *attachment, const PRUnichar *proposedName, const char *charset);</span>
<a href="#l91.13"></a><span id="l91.13" class="difflineplus">+void        msg_pick_real_name (nsMsgAttachmentHandler *attachment, const char16_t *proposedName, const char *charset);</span>
<a href="#l91.14"></a><span id="l91.14"> </span>
<a href="#l91.15"></a><span id="l91.15"> //</span>
<a href="#l91.16"></a><span id="l91.16"> // Informational calls...</span>
<a href="#l91.17"></a><span id="l91.17"> //</span>
<a href="#l91.18"></a><span id="l91.18"> void        nsMsgMIMESetConformToStandard (bool conform_p);</span>
<a href="#l91.19"></a><span id="l91.19"> bool        nsMsgMIMEGetConformToStandard (void);</span>
<a href="#l91.20"></a><span id="l91.20"> </span>
<a href="#l91.21"></a><span id="l91.21"> //</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -103,20 +103,20 @@ static void GetReplyHeaderInfo(int32_t* </span>
<a href="#l92.4"></a><span id="l92.4">     NS_GetUnicharPreferenceWithDefault(prefBranch, &quot;mailnews.reply_header_separator&quot;, NS_LITERAL_STRING(&quot;, &quot;), reply_header_separator);</span>
<a href="#l92.5"></a><span id="l92.5">     NS_GetUnicharPreferenceWithDefault(prefBranch, &quot;mailnews.reply_header_colon&quot;, NS_LITERAL_STRING(&quot;:&quot;), reply_header_colon);</span>
<a href="#l92.6"></a><span id="l92.6">     NS_GetLocalizedUnicharPreferenceWithDefault(prefBranch, &quot;mailnews.reply_header_originalmessage&quot;, NS_LITERAL_STRING(&quot;--- Original Message ---&quot;), reply_header_originalmessage);</span>
<a href="#l92.7"></a><span id="l92.7">   }</span>
<a href="#l92.8"></a><span id="l92.8"> }</span>
<a href="#l92.9"></a><span id="l92.9"> </span>
<a href="#l92.10"></a><span id="l92.10"> static void TranslateLineEnding(nsString&amp; data)</span>
<a href="#l92.11"></a><span id="l92.11"> {</span>
<a href="#l92.12"></a><span id="l92.12" class="difflineminus">-  PRUnichar* rPtr;   //Read pointer</span>
<a href="#l92.13"></a><span id="l92.13" class="difflineminus">-  PRUnichar* wPtr;   //Write pointer</span>
<a href="#l92.14"></a><span id="l92.14" class="difflineminus">-  PRUnichar* sPtr;   //Start data pointer</span>
<a href="#l92.15"></a><span id="l92.15" class="difflineminus">-  PRUnichar* ePtr;   //End data pointer</span>
<a href="#l92.16"></a><span id="l92.16" class="difflineplus">+  char16_t* rPtr;   //Read pointer</span>
<a href="#l92.17"></a><span id="l92.17" class="difflineplus">+  char16_t* wPtr;   //Write pointer</span>
<a href="#l92.18"></a><span id="l92.18" class="difflineplus">+  char16_t* sPtr;   //Start data pointer</span>
<a href="#l92.19"></a><span id="l92.19" class="difflineplus">+  char16_t* ePtr;   //End data pointer</span>
<a href="#l92.20"></a><span id="l92.20"> </span>
<a href="#l92.21"></a><span id="l92.21">   rPtr = wPtr = sPtr = data.BeginWriting();</span>
<a href="#l92.22"></a><span id="l92.22">   ePtr = rPtr + data.Length();</span>
<a href="#l92.23"></a><span id="l92.23"> </span>
<a href="#l92.24"></a><span id="l92.24">   while (rPtr &lt; ePtr)</span>
<a href="#l92.25"></a><span id="l92.25">   {</span>
<a href="#l92.26"></a><span id="l92.26">     if (*rPtr == nsCRT::CR) {</span>
<a href="#l92.27"></a><span id="l92.27">       *wPtr = nsCRT::LF;</span>
<a href="#l92.28"></a><span id="l92.28" class="difflineat">@@ -2254,17 +2254,17 @@ QuotingOutputStreamListener::QuotingOutp</span>
<a href="#l92.29"></a><span id="l92.29">                                                  kDateFormatShort,</span>
<a href="#l92.30"></a><span id="l92.30">                                                  kTimeFormatNoSeconds,</span>
<a href="#l92.31"></a><span id="l92.31">                                                  originalMsgDate,</span>
<a href="#l92.32"></a><span id="l92.32">                                                  formattedDateString);</span>
<a href="#l92.33"></a><span id="l92.33"> </span>
<a href="#l92.34"></a><span id="l92.34">                 if (NS_SUCCEEDED(rv))</span>
<a href="#l92.35"></a><span id="l92.35">                 {</span>
<a href="#l92.36"></a><span id="l92.36">                   // take care &quot;On %s&quot;</span>
<a href="#l92.37"></a><span id="l92.37" class="difflineminus">-                  PRUnichar *formatedString = nullptr;</span>
<a href="#l92.38"></a><span id="l92.38" class="difflineplus">+                  char16_t *formatedString = nullptr;</span>
<a href="#l92.39"></a><span id="l92.39">                   formatedString = nsTextFormatter::smprintf(replyHeaderOndate.get(),</span>
<a href="#l92.40"></a><span id="l92.40">                                                              NS_ConvertUTF16toUTF8(formattedDateString.get()).get());</span>
<a href="#l92.41"></a><span id="l92.41">                   if (formatedString)</span>
<a href="#l92.42"></a><span id="l92.42">                   {</span>
<a href="#l92.43"></a><span id="l92.43">                     citePrefixDate.Assign(formatedString);</span>
<a href="#l92.44"></a><span id="l92.44">                     nsTextFormatter::smprintf_free(formatedString);</span>
<a href="#l92.45"></a><span id="l92.45">                   }</span>
<a href="#l92.46"></a><span id="l92.46">                 }</span>
<a href="#l92.47"></a><span id="l92.47" class="difflineat">@@ -2277,17 +2277,17 @@ QuotingOutputStreamListener::QuotingOutp</span>
<a href="#l92.48"></a><span id="l92.48">         nsAutoCString author;</span>
<a href="#l92.49"></a><span id="l92.49">         rv = originalMsgHdr-&gt;GetAuthor(getter_Copies(author));</span>
<a href="#l92.50"></a><span id="l92.50"> </span>
<a href="#l92.51"></a><span id="l92.51">         if (NS_SUCCEEDED(rv))</span>
<a href="#l92.52"></a><span id="l92.52">         {</span>
<a href="#l92.53"></a><span id="l92.53">           nsAutoCString authorName;</span>
<a href="#l92.54"></a><span id="l92.54">           ExtractName(EncodedHeader(author), authorName);</span>
<a href="#l92.55"></a><span id="l92.55"> </span>
<a href="#l92.56"></a><span id="l92.56" class="difflineminus">-          PRUnichar *formattedString = nullptr;</span>
<a href="#l92.57"></a><span id="l92.57" class="difflineplus">+          char16_t *formattedString = nullptr;</span>
<a href="#l92.58"></a><span id="l92.58">           formattedString = nsTextFormatter::smprintf(</span>
<a href="#l92.59"></a><span id="l92.59">             replyHeaderAuthorwrote.get(), authorName.get());</span>
<a href="#l92.60"></a><span id="l92.60">           if (formattedString)</span>
<a href="#l92.61"></a><span id="l92.61">           {</span>
<a href="#l92.62"></a><span id="l92.62">             citePrefixAuthor.Assign(formattedString);</span>
<a href="#l92.63"></a><span id="l92.63">             nsTextFormatter::smprintf_free(formattedString);</span>
<a href="#l92.64"></a><span id="l92.64">           }</span>
<a href="#l92.65"></a><span id="l92.65">         }</span>
<a href="#l92.66"></a><span id="l92.66" class="difflineat">@@ -2693,17 +2693,17 @@ NS_IMETHODIMP QuotingOutputStreamListene</span>
<a href="#l92.67"></a><span id="l92.67">           if (type == nsIMsgCompType::Reply)</span>
<a href="#l92.68"></a><span id="l92.68">           {</span>
<a href="#l92.69"></a><span id="l92.69">             compFields-&gt;SetTo(EmptyString());</span>
<a href="#l92.70"></a><span id="l92.70">           }</span>
<a href="#l92.71"></a><span id="l92.71">         }</span>
<a href="#l92.72"></a><span id="l92.72">       }</span>
<a href="#l92.73"></a><span id="l92.73"> </span>
<a href="#l92.74"></a><span id="l92.74">       if (!references.IsEmpty())</span>
<a href="#l92.75"></a><span id="l92.75" class="difflineminus">-        references.Append(PRUnichar(' '));</span>
<a href="#l92.76"></a><span id="l92.76" class="difflineplus">+        references.Append(char16_t(' '));</span>
<a href="#l92.77"></a><span id="l92.77">       references += messageId;</span>
<a href="#l92.78"></a><span id="l92.78">       compFields-&gt;SetReferences(NS_LossyConvertUTF16toASCII(references).get());</span>
<a href="#l92.79"></a><span id="l92.79"> </span>
<a href="#l92.80"></a><span id="l92.80">       nsAutoCString resultStr;</span>
<a href="#l92.81"></a><span id="l92.81"> </span>
<a href="#l92.82"></a><span id="l92.82">       // Cast interface to concrete class that has direct field getters etc.</span>
<a href="#l92.83"></a><span id="l92.83">       nsMsgCompFields* _compFields = static_cast&lt;nsMsgCompFields*&gt;(compFields.get());</span>
<a href="#l92.84"></a><span id="l92.84"> </span>
<a href="#l92.85"></a><span id="l92.85" class="difflineat">@@ -2861,57 +2861,57 @@ NS_IMETHODIMP QuotingOutputStreamListene</span>
<a href="#l92.86"></a><span id="l92.86">     {</span>
<a href="#l92.87"></a><span id="l92.87">       int32_t unicharLength;</span>
<a href="#l92.88"></a><span id="l92.88">       int32_t inputLength = inStr.Length();</span>
<a href="#l92.89"></a><span id="l92.89">       rv = mUnicodeDecoder-&gt;GetMaxLength(inStr.get(), inStr.Length(), &amp;unicharLength);</span>
<a href="#l92.90"></a><span id="l92.90">       if (NS_SUCCEEDED(rv))</span>
<a href="#l92.91"></a><span id="l92.91">       {</span>
<a href="#l92.92"></a><span id="l92.92">         // Use this local buffer if possible.</span>
<a href="#l92.93"></a><span id="l92.93">         const int32_t kLocalBufSize = 4096;</span>
<a href="#l92.94"></a><span id="l92.94" class="difflineminus">-        PRUnichar localBuf[kLocalBufSize];</span>
<a href="#l92.95"></a><span id="l92.95" class="difflineminus">-        PRUnichar *unichars = localBuf;</span>
<a href="#l92.96"></a><span id="l92.96" class="difflineplus">+        char16_t localBuf[kLocalBufSize];</span>
<a href="#l92.97"></a><span id="l92.97" class="difflineplus">+        char16_t *unichars = localBuf;</span>
<a href="#l92.98"></a><span id="l92.98"> </span>
<a href="#l92.99"></a><span id="l92.99">         if (unicharLength &gt; kLocalBufSize)</span>
<a href="#l92.100"></a><span id="l92.100">         {</span>
<a href="#l92.101"></a><span id="l92.101">           // Otherwise, use the buffer of the class.</span>
<a href="#l92.102"></a><span id="l92.102">           if (!mUnicodeConversionBuffer ||</span>
<a href="#l92.103"></a><span id="l92.103">               unicharLength &gt; mUnicodeBufferCharacterLength)</span>
<a href="#l92.104"></a><span id="l92.104">           {</span>
<a href="#l92.105"></a><span id="l92.105">             if (mUnicodeConversionBuffer)</span>
<a href="#l92.106"></a><span id="l92.106">               nsMemory::Free(mUnicodeConversionBuffer);</span>
<a href="#l92.107"></a><span id="l92.107" class="difflineminus">-            mUnicodeConversionBuffer = (PRUnichar *) nsMemory::Alloc(unicharLength * sizeof(PRUnichar));</span>
<a href="#l92.108"></a><span id="l92.108" class="difflineplus">+            mUnicodeConversionBuffer = (char16_t *) nsMemory::Alloc(unicharLength * sizeof(char16_t));</span>
<a href="#l92.109"></a><span id="l92.109">             if (!mUnicodeConversionBuffer)</span>
<a href="#l92.110"></a><span id="l92.110">             {</span>
<a href="#l92.111"></a><span id="l92.111">               mUnicodeBufferCharacterLength = 0;</span>
<a href="#l92.112"></a><span id="l92.112">               return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l92.113"></a><span id="l92.113">             }</span>
<a href="#l92.114"></a><span id="l92.114">             mUnicodeBufferCharacterLength = unicharLength;</span>
<a href="#l92.115"></a><span id="l92.115">           }</span>
<a href="#l92.116"></a><span id="l92.116">           unichars = mUnicodeConversionBuffer;</span>
<a href="#l92.117"></a><span id="l92.117">         }</span>
<a href="#l92.118"></a><span id="l92.118"> </span>
<a href="#l92.119"></a><span id="l92.119">         int32_t consumedInputLength = 0;</span>
<a href="#l92.120"></a><span id="l92.120">         int32_t originalInputLength = inputLength;</span>
<a href="#l92.121"></a><span id="l92.121">         const char *inputBuffer = inStr.get();</span>
<a href="#l92.122"></a><span id="l92.122">         int32_t convertedOutputLength = 0;</span>
<a href="#l92.123"></a><span id="l92.123">         int32_t outputBufferLength = unicharLength;</span>
<a href="#l92.124"></a><span id="l92.124" class="difflineminus">-        PRUnichar *originalOutputBuffer = unichars;</span>
<a href="#l92.125"></a><span id="l92.125" class="difflineplus">+        char16_t *originalOutputBuffer = unichars;</span>
<a href="#l92.126"></a><span id="l92.126">         do</span>
<a href="#l92.127"></a><span id="l92.127">         {</span>
<a href="#l92.128"></a><span id="l92.128">           rv = mUnicodeDecoder-&gt;Convert(inputBuffer, &amp;inputLength, unichars, &amp;unicharLength);</span>
<a href="#l92.129"></a><span id="l92.129">           if (NS_SUCCEEDED(rv))</span>
<a href="#l92.130"></a><span id="l92.130">           {</span>
<a href="#l92.131"></a><span id="l92.131">             convertedOutputLength += unicharLength;</span>
<a href="#l92.132"></a><span id="l92.132">             break;</span>
<a href="#l92.133"></a><span id="l92.133">           }</span>
<a href="#l92.134"></a><span id="l92.134"> </span>
<a href="#l92.135"></a><span id="l92.135">           // if we failed, we consume one byte, replace it with a question mark</span>
<a href="#l92.136"></a><span id="l92.136">           // and try the conversion again.</span>
<a href="#l92.137"></a><span id="l92.137">           unichars += unicharLength;</span>
<a href="#l92.138"></a><span id="l92.138" class="difflineminus">-          *unichars = (PRUnichar)'?';</span>
<a href="#l92.139"></a><span id="l92.139" class="difflineplus">+          *unichars = (char16_t)'?';</span>
<a href="#l92.140"></a><span id="l92.140">           unichars++;</span>
<a href="#l92.141"></a><span id="l92.141">           unicharLength++;</span>
<a href="#l92.142"></a><span id="l92.142"> </span>
<a href="#l92.143"></a><span id="l92.143">           mUnicodeDecoder-&gt;Reset();</span>
<a href="#l92.144"></a><span id="l92.144"> </span>
<a href="#l92.145"></a><span id="l92.145">           inputBuffer += ++inputLength;</span>
<a href="#l92.146"></a><span id="l92.146">           consumedInputLength += inputLength;</span>
<a href="#l92.147"></a><span id="l92.147">           inputLength = originalInputLength - consumedInputLength;  // update input length to convert</span>
<a href="#l92.148"></a><span id="l92.148" class="difflineat">@@ -3130,17 +3130,17 @@ nsMsgCompose::QuoteOriginalMessage() // </span>
<a href="#l92.149"></a><span id="l92.149"> </span>
<a href="#l92.150"></a><span id="l92.150"> //CleanUpRecipient will remove un-necessary &quot;&lt;&gt;&quot; when a recipient as an address without name</span>
<a href="#l92.151"></a><span id="l92.151"> void nsMsgCompose::CleanUpRecipients(nsString&amp; recipients)</span>
<a href="#l92.152"></a><span id="l92.152"> {</span>
<a href="#l92.153"></a><span id="l92.153">   uint16_t i;</span>
<a href="#l92.154"></a><span id="l92.154">   bool startANewRecipient = true;</span>
<a href="#l92.155"></a><span id="l92.155">   bool removeBracket = false;</span>
<a href="#l92.156"></a><span id="l92.156">   nsAutoString newRecipient;</span>
<a href="#l92.157"></a><span id="l92.157" class="difflineminus">-  PRUnichar aChar;</span>
<a href="#l92.158"></a><span id="l92.158" class="difflineplus">+  char16_t aChar;</span>
<a href="#l92.159"></a><span id="l92.159"> </span>
<a href="#l92.160"></a><span id="l92.160">   for (i = 0; i &lt; recipients.Length(); i ++)</span>
<a href="#l92.161"></a><span id="l92.161">   {</span>
<a href="#l92.162"></a><span id="l92.162">     aChar = recipients[i];</span>
<a href="#l92.163"></a><span id="l92.163">     switch (aChar)</span>
<a href="#l92.164"></a><span id="l92.164">     {</span>
<a href="#l92.165"></a><span id="l92.165">       case '&lt;'  :</span>
<a href="#l92.166"></a><span id="l92.166">         if (startANewRecipient)</span>
<a href="#l92.167"></a><span id="l92.167" class="difflineat">@@ -3338,30 +3338,30 @@ NS_IMETHODIMP nsMsgCompose::OnProgress(c</span>
<a href="#l92.168"></a><span id="l92.168">   while (iter.HasMore())</span>
<a href="#l92.169"></a><span id="l92.169">   {</span>
<a href="#l92.170"></a><span id="l92.170">     externalSendListener = iter.GetNext();</span>
<a href="#l92.171"></a><span id="l92.171">     externalSendListener-&gt;OnProgress(aMsgID, aProgress, aProgressMax);</span>
<a href="#l92.172"></a><span id="l92.172">   }</span>
<a href="#l92.173"></a><span id="l92.173">   return NS_OK;</span>
<a href="#l92.174"></a><span id="l92.174"> }</span>
<a href="#l92.175"></a><span id="l92.175"> </span>
<a href="#l92.176"></a><span id="l92.176" class="difflineminus">-NS_IMETHODIMP nsMsgCompose::OnStatus(const char *aMsgID, const PRUnichar *aMsg)</span>
<a href="#l92.177"></a><span id="l92.177" class="difflineplus">+NS_IMETHODIMP nsMsgCompose::OnStatus(const char *aMsgID, const char16_t *aMsg)</span>
<a href="#l92.178"></a><span id="l92.178"> {</span>
<a href="#l92.179"></a><span id="l92.179">   nsTObserverArray&lt;nsCOMPtr&lt;nsIMsgSendListener&gt; &gt;::ForwardIterator iter(mExternalSendListeners);</span>
<a href="#l92.180"></a><span id="l92.180">   nsCOMPtr&lt;nsIMsgSendListener&gt; externalSendListener;</span>
<a href="#l92.181"></a><span id="l92.181"> </span>
<a href="#l92.182"></a><span id="l92.182">   while (iter.HasMore())</span>
<a href="#l92.183"></a><span id="l92.183">   {</span>
<a href="#l92.184"></a><span id="l92.184">     externalSendListener = iter.GetNext();</span>
<a href="#l92.185"></a><span id="l92.185">     externalSendListener-&gt;OnStatus(aMsgID, aMsg);</span>
<a href="#l92.186"></a><span id="l92.186">   }</span>
<a href="#l92.187"></a><span id="l92.187">   return NS_OK;</span>
<a href="#l92.188"></a><span id="l92.188"> }</span>
<a href="#l92.189"></a><span id="l92.189"> </span>
<a href="#l92.190"></a><span id="l92.190" class="difflineminus">-NS_IMETHODIMP nsMsgCompose::OnStopSending(const char *aMsgID, nsresult aStatus, const PRUnichar *aMsg,</span>
<a href="#l92.191"></a><span id="l92.191" class="difflineplus">+NS_IMETHODIMP nsMsgCompose::OnStopSending(const char *aMsgID, nsresult aStatus, const char16_t *aMsg,</span>
<a href="#l92.192"></a><span id="l92.192">                                       nsIFile *returnFile)</span>
<a href="#l92.193"></a><span id="l92.193"> {</span>
<a href="#l92.194"></a><span id="l92.194">   nsTObserverArray&lt;nsCOMPtr&lt;nsIMsgSendListener&gt; &gt;::ForwardIterator iter(mExternalSendListeners);</span>
<a href="#l92.195"></a><span id="l92.195">   nsCOMPtr&lt;nsIMsgSendListener&gt; externalSendListener;</span>
<a href="#l92.196"></a><span id="l92.196"> </span>
<a href="#l92.197"></a><span id="l92.197">   while (iter.HasMore())</span>
<a href="#l92.198"></a><span id="l92.198">   {</span>
<a href="#l92.199"></a><span id="l92.199">     externalSendListener = iter.GetNext();</span>
<a href="#l92.200"></a><span id="l92.200" class="difflineat">@@ -3459,17 +3459,17 @@ nsMsgComposeSendListener::OnProgress(con</span>
<a href="#l92.201"></a><span id="l92.201">   nsresult rv;</span>
<a href="#l92.202"></a><span id="l92.202">   nsCOMPtr&lt;nsIMsgSendListener&gt; composeSendListener = do_QueryReferent(mWeakComposeObj, &amp;rv);</span>
<a href="#l92.203"></a><span id="l92.203">   if (NS_SUCCEEDED(rv) &amp;&amp; composeSendListener)</span>
<a href="#l92.204"></a><span id="l92.204">     composeSendListener-&gt;OnProgress(aMsgID, aProgress, aProgressMax);</span>
<a href="#l92.205"></a><span id="l92.205">   return NS_OK;</span>
<a href="#l92.206"></a><span id="l92.206"> }</span>
<a href="#l92.207"></a><span id="l92.207"> </span>
<a href="#l92.208"></a><span id="l92.208"> nsresult</span>
<a href="#l92.209"></a><span id="l92.209" class="difflineminus">-nsMsgComposeSendListener::OnStatus(const char *aMsgID, const PRUnichar *aMsg)</span>
<a href="#l92.210"></a><span id="l92.210" class="difflineplus">+nsMsgComposeSendListener::OnStatus(const char *aMsgID, const char16_t *aMsg)</span>
<a href="#l92.211"></a><span id="l92.211"> {</span>
<a href="#l92.212"></a><span id="l92.212">   nsresult rv;</span>
<a href="#l92.213"></a><span id="l92.213">   nsCOMPtr&lt;nsIMsgSendListener&gt; composeSendListener = do_QueryReferent(mWeakComposeObj, &amp;rv);</span>
<a href="#l92.214"></a><span id="l92.214">   if (NS_SUCCEEDED(rv) &amp;&amp; composeSendListener)</span>
<a href="#l92.215"></a><span id="l92.215">     composeSendListener-&gt;OnStatus(aMsgID, aMsg);</span>
<a href="#l92.216"></a><span id="l92.216">   return NS_OK;</span>
<a href="#l92.217"></a><span id="l92.217"> }</span>
<a href="#l92.218"></a><span id="l92.218"> </span>
<a href="#l92.219"></a><span id="l92.219" class="difflineat">@@ -3487,17 +3487,17 @@ nsresult nsMsgComposeSendListener::OnSen</span>
<a href="#l92.220"></a><span id="l92.220">   nsCOMPtr&lt;nsIMsgSendListener&gt; composeSendListener = do_QueryReferent(mWeakComposeObj, &amp;rv);</span>
<a href="#l92.221"></a><span id="l92.221">   if (NS_SUCCEEDED(rv) &amp;&amp; composeSendListener)</span>
<a href="#l92.222"></a><span id="l92.222">     composeSendListener-&gt;OnSendNotPerformed(aMsgID, aStatus);</span>
<a href="#l92.223"></a><span id="l92.223"> </span>
<a href="#l92.224"></a><span id="l92.224">   return rv;</span>
<a href="#l92.225"></a><span id="l92.225"> }</span>
<a href="#l92.226"></a><span id="l92.226"> </span>
<a href="#l92.227"></a><span id="l92.227"> nsresult nsMsgComposeSendListener::OnStopSending(const char *aMsgID, nsresult aStatus,</span>
<a href="#l92.228"></a><span id="l92.228" class="difflineminus">-                                                 const PRUnichar *aMsg, nsIFile *returnFile)</span>
<a href="#l92.229"></a><span id="l92.229" class="difflineplus">+                                                 const char16_t *aMsg, nsIFile *returnFile)</span>
<a href="#l92.230"></a><span id="l92.230"> {</span>
<a href="#l92.231"></a><span id="l92.231">   nsresult rv = NS_OK;</span>
<a href="#l92.232"></a><span id="l92.232"> </span>
<a href="#l92.233"></a><span id="l92.233">   nsCOMPtr&lt;nsIMsgCompose&gt; msgCompose = do_QueryReferent(mWeakComposeObj, &amp;rv);</span>
<a href="#l92.234"></a><span id="l92.234">   if (msgCompose)</span>
<a href="#l92.235"></a><span id="l92.235">   {</span>
<a href="#l92.236"></a><span id="l92.236">     nsCOMPtr&lt;nsIMsgProgress&gt; progress;</span>
<a href="#l92.237"></a><span id="l92.237">     msgCompose-&gt;GetProgress(getter_AddRefs(progress));</span>
<a href="#l92.238"></a><span id="l92.238" class="difflineat">@@ -3878,17 +3878,17 @@ NS_IMETHODIMP nsMsgComposeSendListener::</span>
<a href="#l92.239"></a><span id="l92.239"> /* void onLocationChange (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in nsIURI location, in unsigned long aFlags); */</span>
<a href="#l92.240"></a><span id="l92.240"> NS_IMETHODIMP nsMsgComposeSendListener::OnLocationChange(nsIWebProgress *aWebProgress, nsIRequest *aRequest, nsIURI *location, uint32_t aFlags)</span>
<a href="#l92.241"></a><span id="l92.241"> {</span>
<a href="#l92.242"></a><span id="l92.242">   /* Ignore this call */</span>
<a href="#l92.243"></a><span id="l92.243">   return NS_OK;</span>
<a href="#l92.244"></a><span id="l92.244"> }</span>
<a href="#l92.245"></a><span id="l92.245"> </span>
<a href="#l92.246"></a><span id="l92.246"> /* void onStatusChange (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in nsresult aStatus, in wstring aMessage); */</span>
<a href="#l92.247"></a><span id="l92.247" class="difflineminus">-NS_IMETHODIMP nsMsgComposeSendListener::OnStatusChange(nsIWebProgress *aWebProgress, nsIRequest *aRequest, nsresult aStatus, const PRUnichar *aMessage)</span>
<a href="#l92.248"></a><span id="l92.248" class="difflineplus">+NS_IMETHODIMP nsMsgComposeSendListener::OnStatusChange(nsIWebProgress *aWebProgress, nsIRequest *aRequest, nsresult aStatus, const char16_t *aMessage)</span>
<a href="#l92.249"></a><span id="l92.249"> {</span>
<a href="#l92.250"></a><span id="l92.250">   /* Ignore this call */</span>
<a href="#l92.251"></a><span id="l92.251">   return NS_OK;</span>
<a href="#l92.252"></a><span id="l92.252"> }</span>
<a href="#l92.253"></a><span id="l92.253"> </span>
<a href="#l92.254"></a><span id="l92.254"> /* void onSecurityChange (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in unsigned long state); */</span>
<a href="#l92.255"></a><span id="l92.255"> NS_IMETHODIMP nsMsgComposeSendListener::OnSecurityChange(nsIWebProgress *aWebProgress, nsIRequest *aRequest, uint32_t state)</span>
<a href="#l92.256"></a><span id="l92.256"> {</span>
<a href="#l92.257"></a><span id="l92.257" class="difflineat">@@ -3917,17 +3917,17 @@ nsMsgCompose::ConvertTextToHTML(nsIFile </span>
<a href="#l92.258"></a><span id="l92.258"> </span>
<a href="#l92.259"></a><span id="l92.259">   rv = LoadDataFromFile(aSigFile, origBuf);</span>
<a href="#l92.260"></a><span id="l92.260">   if (NS_FAILED(rv))</span>
<a href="#l92.261"></a><span id="l92.261">     return rv;</span>
<a href="#l92.262"></a><span id="l92.262"> </span>
<a href="#l92.263"></a><span id="l92.263">   // Ok, once we are here, we need to escape the data to make sure that</span>
<a href="#l92.264"></a><span id="l92.264">   // we don't do HTML stuff with plain text sigs.</span>
<a href="#l92.265"></a><span id="l92.265">   //</span>
<a href="#l92.266"></a><span id="l92.266" class="difflineminus">-  PRUnichar *escaped = MsgEscapeHTML2(origBuf.get(), origBuf.Length());</span>
<a href="#l92.267"></a><span id="l92.267" class="difflineplus">+  char16_t *escaped = MsgEscapeHTML2(origBuf.get(), origBuf.Length());</span>
<a href="#l92.268"></a><span id="l92.268">   if (escaped)</span>
<a href="#l92.269"></a><span id="l92.269">   {</span>
<a href="#l92.270"></a><span id="l92.270">     aSigData.Append(escaped);</span>
<a href="#l92.271"></a><span id="l92.271">     NS_Free(escaped);</span>
<a href="#l92.272"></a><span id="l92.272">   }</span>
<a href="#l92.273"></a><span id="l92.273">   else</span>
<a href="#l92.274"></a><span id="l92.274">     aSigData.Append(origBuf);</span>
<a href="#l92.275"></a><span id="l92.275">   return NS_OK;</span>
<a href="#l92.276"></a><span id="l92.276" class="difflineat">@@ -4194,17 +4194,17 @@ nsMsgCompose::ProcessSignature(nsIMsgIde</span>
<a href="#l92.277"></a><span id="l92.277">       if (htmlSig)</span>
<a href="#l92.278"></a><span id="l92.278">         ConvertBufToPlainText(prefSigText, false, true);</span>
<a href="#l92.279"></a><span id="l92.279">       sigData.Append(prefSigText);</span>
<a href="#l92.280"></a><span id="l92.280">     }</span>
<a href="#l92.281"></a><span id="l92.281">     else</span>
<a href="#l92.282"></a><span id="l92.282">     {</span>
<a href="#l92.283"></a><span id="l92.283">       if (!htmlSig)</span>
<a href="#l92.284"></a><span id="l92.284">       {</span>
<a href="#l92.285"></a><span id="l92.285" class="difflineminus">-        PRUnichar* escaped = MsgEscapeHTML2(prefSigText.get(), prefSigText.Length());</span>
<a href="#l92.286"></a><span id="l92.286" class="difflineplus">+        char16_t* escaped = MsgEscapeHTML2(prefSigText.get(), prefSigText.Length());</span>
<a href="#l92.287"></a><span id="l92.287">         if (escaped)</span>
<a href="#l92.288"></a><span id="l92.288">         {</span>
<a href="#l92.289"></a><span id="l92.289">           sigData.Append(escaped);</span>
<a href="#l92.290"></a><span id="l92.290">           NS_Free(escaped);</span>
<a href="#l92.291"></a><span id="l92.291">         }</span>
<a href="#l92.292"></a><span id="l92.292">         else</span>
<a href="#l92.293"></a><span id="l92.293">           sigData.Append(prefSigText);</span>
<a href="#l92.294"></a><span id="l92.294">       }</span>
<a href="#l92.295"></a><span id="l92.295" class="difflineat">@@ -4718,17 +4718,17 @@ nsMsgCompose::CheckAndPopulateRecipients</span>
<a href="#l92.296"></a><span id="l92.296">                       {</span>
<a href="#l92.297"></a><span id="l92.297">                         if (!newRecipient.mEmail.IsEmpty())</span>
<a href="#l92.298"></a><span id="l92.298">                           newRecipient.mAddress += newRecipient.mEmail;</span>
<a href="#l92.299"></a><span id="l92.299">                         else</span>
<a href="#l92.300"></a><span id="l92.300">                           newRecipient.mAddress += pDisplayName;</span>
<a href="#l92.301"></a><span id="l92.301">                       }</span>
<a href="#l92.302"></a><span id="l92.302">                       else</span>
<a href="#l92.303"></a><span id="l92.303">                         newRecipient.mAddress += newRecipient.mEmail;</span>
<a href="#l92.304"></a><span id="l92.304" class="difflineminus">-                      newRecipient.mAddress.Append(PRUnichar('&gt;'));</span>
<a href="#l92.305"></a><span id="l92.305" class="difflineplus">+                      newRecipient.mAddress.Append(char16_t('&gt;'));</span>
<a href="#l92.306"></a><span id="l92.306">                     }</span>
<a href="#l92.307"></a><span id="l92.307"> </span>
<a href="#l92.308"></a><span id="l92.308">                     if (newRecipient.mAddress.IsEmpty())</span>
<a href="#l92.309"></a><span id="l92.309">                       continue;</span>
<a href="#l92.310"></a><span id="l92.310"> </span>
<a href="#l92.311"></a><span id="l92.311">                     // Now we need to insert the new address into the list of</span>
<a href="#l92.312"></a><span id="l92.312">                     // recipient</span>
<a href="#l92.313"></a><span id="l92.313">                     if (bIsMailList)</span>
<a href="#l92.314"></a><span id="l92.314" class="difflineat">@@ -4880,25 +4880,25 @@ nsMsgCompose::CheckAndPopulateRecipients</span>
<a href="#l92.315"></a><span id="l92.315">       default: // nsIAbPreferMailFormat::unknown</span>
<a href="#l92.316"></a><span id="l92.316">         atLeastOneRecipientPrefersUnknown = true;</span>
<a href="#l92.317"></a><span id="l92.317">         break;</span>
<a href="#l92.318"></a><span id="l92.318">       }</span>
<a href="#l92.319"></a><span id="l92.319"> </span>
<a href="#l92.320"></a><span id="l92.320">       if (aPopulateMailList)</span>
<a href="#l92.321"></a><span id="l92.321">       {</span>
<a href="#l92.322"></a><span id="l92.322">         if (!recipientsStr.IsEmpty())</span>
<a href="#l92.323"></a><span id="l92.323" class="difflineminus">-          recipientsStr.Append(PRUnichar(','));</span>
<a href="#l92.324"></a><span id="l92.324" class="difflineplus">+          recipientsStr.Append(char16_t(','));</span>
<a href="#l92.325"></a><span id="l92.325">         recipientsStr.Append(recipient.mAddress);</span>
<a href="#l92.326"></a><span id="l92.326">       }</span>
<a href="#l92.327"></a><span id="l92.327"> </span>
<a href="#l92.328"></a><span id="l92.328">       if (aReturnNonHTMLRecipients &amp;&amp;</span>
<a href="#l92.329"></a><span id="l92.329">           recipient.mPreferFormat != nsIAbPreferMailFormat::html)</span>
<a href="#l92.330"></a><span id="l92.330">       {</span>
<a href="#l92.331"></a><span id="l92.331">         if (!nonHtmlRecipientsStr.IsEmpty())</span>
<a href="#l92.332"></a><span id="l92.332" class="difflineminus">-          nonHtmlRecipientsStr.Append(PRUnichar(','));</span>
<a href="#l92.333"></a><span id="l92.333" class="difflineplus">+          nonHtmlRecipientsStr.Append(char16_t(','));</span>
<a href="#l92.334"></a><span id="l92.334">         nonHtmlRecipientsStr.Append(recipient.mEmail);</span>
<a href="#l92.335"></a><span id="l92.335">       }</span>
<a href="#l92.336"></a><span id="l92.336">     }</span>
<a href="#l92.337"></a><span id="l92.337"> </span>
<a href="#l92.338"></a><span id="l92.338">     if (aPopulateMailList)</span>
<a href="#l92.339"></a><span id="l92.339">     {</span>
<a href="#l92.340"></a><span id="l92.340">       switch (i)</span>
<a href="#l92.341"></a><span id="l92.341">       {</span>
<a href="#l92.342"></a><span id="l92.342" class="difflineat">@@ -5372,13 +5372,13 @@ nsMsgMailList::nsMsgMailList(nsIAbDirect</span>
<a href="#l92.343"></a><span id="l92.343">   {</span>
<a href="#l92.344"></a><span id="l92.344">       //oops, parser problem! I will try to do my best...</span>
<a href="#l92.345"></a><span id="l92.345">       mFullName = listName;</span>
<a href="#l92.346"></a><span id="l92.346">       mFullName.AppendLiteral(&quot; &lt;&quot;);</span>
<a href="#l92.347"></a><span id="l92.347">       if (listDescription.IsEmpty())</span>
<a href="#l92.348"></a><span id="l92.348">         mFullName += listName;</span>
<a href="#l92.349"></a><span id="l92.349">       else</span>
<a href="#l92.350"></a><span id="l92.350">         mFullName += listDescription;</span>
<a href="#l92.351"></a><span id="l92.351" class="difflineminus">-      mFullName.Append(PRUnichar('&gt;'));</span>
<a href="#l92.352"></a><span id="l92.352" class="difflineplus">+      mFullName.Append(char16_t('&gt;'));</span>
<a href="#l92.353"></a><span id="l92.353">   }</span>
<a href="#l92.354"></a><span id="l92.354"> </span>
<a href="#l92.355"></a><span id="l92.355">   mDirectory = directory;</span>
<a href="#l92.356"></a><span id="l92.356"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.h</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.h</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -169,17 +169,17 @@ private:</span>
<a href="#l93.4"></a><span id="l93.4">     bool						        mHeadersOnly;</span>
<a href="#l93.5"></a><span id="l93.5">     nsCOMPtr&lt;nsIMimeHeaders&gt;	mHeaders;</span>
<a href="#l93.6"></a><span id="l93.6">     nsCOMPtr&lt;nsIMsgIdentity&gt;  mIdentity;</span>
<a href="#l93.7"></a><span id="l93.7">     nsCOMPtr&lt;nsIMsgDBHdr&gt;     mOrigMsgHdr;</span>
<a href="#l93.8"></a><span id="l93.8">     nsString                  mCiteReference;</span>
<a href="#l93.9"></a><span id="l93.9">     nsCOMPtr&lt;nsIMimeConverter&gt; mMimeConverter;</span>
<a href="#l93.10"></a><span id="l93.10">     nsCOMPtr&lt;nsIUnicodeDecoder&gt; mUnicodeDecoder;</span>
<a href="#l93.11"></a><span id="l93.11">     int32_t                   mUnicodeBufferCharacterLength;</span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-    PRUnichar*                mUnicodeConversionBuffer;</span>
<a href="#l93.13"></a><span id="l93.13" class="difflineplus">+    char16_t*                mUnicodeConversionBuffer;</span>
<a href="#l93.14"></a><span id="l93.14">     bool                      mQuoteOriginal;</span>
<a href="#l93.15"></a><span id="l93.15">     nsCString                 mHtmlToQuote;</span>
<a href="#l93.16"></a><span id="l93.16"> };</span>
<a href="#l93.17"></a><span id="l93.17"> </span>
<a href="#l93.18"></a><span id="l93.18"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l93.19"></a><span id="l93.19"> // This is the listener class for the send operation. We have to create this class </span>
<a href="#l93.20"></a><span id="l93.20"> // to listen for message send completion and eventually notify the caller</span>
<a href="#l93.21"></a><span id="l93.21"> ////////////////////////////////////////////////////////////////////////////////////</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeProgressParams.cpp</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeProgressParams.cpp</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -13,24 +13,24 @@ nsMsgComposeProgressParams::nsMsgCompose</span>
<a href="#l94.4"></a><span id="l94.4"> {</span>
<a href="#l94.5"></a><span id="l94.5"> }</span>
<a href="#l94.6"></a><span id="l94.6"> </span>
<a href="#l94.7"></a><span id="l94.7"> nsMsgComposeProgressParams::~nsMsgComposeProgressParams()</span>
<a href="#l94.8"></a><span id="l94.8"> {</span>
<a href="#l94.9"></a><span id="l94.9"> }</span>
<a href="#l94.10"></a><span id="l94.10"> </span>
<a href="#l94.11"></a><span id="l94.11"> /* attribute wstring subject; */</span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">-NS_IMETHODIMP nsMsgComposeProgressParams::GetSubject(PRUnichar * *aSubject)</span>
<a href="#l94.13"></a><span id="l94.13" class="difflineplus">+NS_IMETHODIMP nsMsgComposeProgressParams::GetSubject(char16_t * *aSubject)</span>
<a href="#l94.14"></a><span id="l94.14"> {</span>
<a href="#l94.15"></a><span id="l94.15">   NS_ENSURE_ARG(aSubject);</span>
<a href="#l94.16"></a><span id="l94.16">   </span>
<a href="#l94.17"></a><span id="l94.17">   *aSubject = ToNewUnicode(m_subject);</span>
<a href="#l94.18"></a><span id="l94.18">   return NS_OK;</span>
<a href="#l94.19"></a><span id="l94.19"> }</span>
<a href="#l94.20"></a><span id="l94.20" class="difflineminus">-NS_IMETHODIMP nsMsgComposeProgressParams::SetSubject(const PRUnichar * aSubject)</span>
<a href="#l94.21"></a><span id="l94.21" class="difflineplus">+NS_IMETHODIMP nsMsgComposeProgressParams::SetSubject(const char16_t * aSubject)</span>
<a href="#l94.22"></a><span id="l94.22"> {</span>
<a href="#l94.23"></a><span id="l94.23">   m_subject = aSubject;</span>
<a href="#l94.24"></a><span id="l94.24">   return NS_OK;</span>
<a href="#l94.25"></a><span id="l94.25"> }</span>
<a href="#l94.26"></a><span id="l94.26"> </span>
<a href="#l94.27"></a><span id="l94.27"> /* attribute MSG_DeliverMode deliveryMode; */</span>
<a href="#l94.28"></a><span id="l94.28"> NS_IMETHODIMP nsMsgComposeProgressParams::GetDeliveryMode(MSG_DeliverMode *aDeliveryMode)</span>
<a href="#l94.29"></a><span id="l94.29"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l95.1"></a><span id="l95.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l95.2"></a><span id="l95.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l95.3"></a><span id="l95.3" class="difflineat">@@ -320,17 +320,17 @@ void nsMsgComposeService::CloseHiddenCac</span>
<a href="#l95.4"></a><span id="l95.4">           }</span>
<a href="#l95.5"></a><span id="l95.5">         }</span>
<a href="#l95.6"></a><span id="l95.6">       }</span>
<a href="#l95.7"></a><span id="l95.7">     }</span>
<a href="#l95.8"></a><span id="l95.8">   }</span>
<a href="#l95.9"></a><span id="l95.9"> }</span>
<a href="#l95.10"></a><span id="l95.10"> </span>
<a href="#l95.11"></a><span id="l95.11"> NS_IMETHODIMP</span>
<a href="#l95.12"></a><span id="l95.12" class="difflineminus">-nsMsgComposeService::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData)</span>
<a href="#l95.13"></a><span id="l95.13" class="difflineplus">+nsMsgComposeService::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *someData)</span>
<a href="#l95.14"></a><span id="l95.14"> {</span>
<a href="#l95.15"></a><span id="l95.15">   if (!strcmp(aTopic, &quot;profile-do-change&quot;) || !strcmp(aTopic, &quot;quit-application&quot;))</span>
<a href="#l95.16"></a><span id="l95.16">   {</span>
<a href="#l95.17"></a><span id="l95.17">     DeleteCachedWindows();</span>
<a href="#l95.18"></a><span id="l95.18">     return NS_OK;</span>
<a href="#l95.19"></a><span id="l95.19">   }</span>
<a href="#l95.20"></a><span id="l95.20"> </span>
<a href="#l95.21"></a><span id="l95.21">   if (!strcmp(aTopic, NS_PREFBRANCH_PREFCHANGE_TOPIC_ID))</span>
<a href="#l95.22"></a><span id="l95.22" class="difflineat">@@ -447,25 +447,25 @@ nsMsgComposeService::GetOrigWindowSelect</span>
<a href="#l95.23"></a><span id="l95.23">       if (selPlain.IsEmpty())</span>
<a href="#l95.24"></a><span id="l95.24">         return NS_ERROR_ABORT;</span>
<a href="#l95.25"></a><span id="l95.25"> </span>
<a href="#l95.26"></a><span id="l95.26">       nsCOMPtr&lt;nsILineBreaker&gt; lineBreaker = do_GetService(NS_LBRK_CONTRACTID, &amp;rv);</span>
<a href="#l95.27"></a><span id="l95.27"> </span>
<a href="#l95.28"></a><span id="l95.28">       if (NS_SUCCEEDED(rv))</span>
<a href="#l95.29"></a><span id="l95.29">       {</span>
<a href="#l95.30"></a><span id="l95.30">         const uint32_t length = selPlain.Length();</span>
<a href="#l95.31"></a><span id="l95.31" class="difflineminus">-        const PRUnichar* unicodeStr = selPlain.get();</span>
<a href="#l95.32"></a><span id="l95.32" class="difflineplus">+        const char16_t* unicodeStr = selPlain.get();</span>
<a href="#l95.33"></a><span id="l95.33">         int32_t endWordPos = lineBreaker-&gt;Next(unicodeStr, length, 0);</span>
<a href="#l95.34"></a><span id="l95.34">         </span>
<a href="#l95.35"></a><span id="l95.35">         // If there's not even one word, then there's not multiple words</span>
<a href="#l95.36"></a><span id="l95.36">         if (endWordPos == NS_LINEBREAKER_NEED_MORE_TEXT)</span>
<a href="#l95.37"></a><span id="l95.37">           return NS_ERROR_ABORT;</span>
<a href="#l95.38"></a><span id="l95.38"> </span>
<a href="#l95.39"></a><span id="l95.39">         // If after the first word is only space, then there's not multiple words</span>
<a href="#l95.40"></a><span id="l95.40" class="difflineminus">-        const PRUnichar* end;</span>
<a href="#l95.41"></a><span id="l95.41" class="difflineplus">+        const char16_t* end;</span>
<a href="#l95.42"></a><span id="l95.42">         for (end = unicodeStr + endWordPos; NS_IsSpace(*end); end++)</span>
<a href="#l95.43"></a><span id="l95.43">           ;</span>
<a href="#l95.44"></a><span id="l95.44">         if (!*end)</span>
<a href="#l95.45"></a><span id="l95.45">           return NS_ERROR_ABORT;</span>
<a href="#l95.46"></a><span id="l95.46">       }</span>
<a href="#l95.47"></a><span id="l95.47">     }</span>
<a href="#l95.48"></a><span id="l95.48"> </span>
<a href="#l95.49"></a><span id="l95.49">     if (!charsOnlyIf.IsEmpty())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l96.1"></a><span id="l96.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgPrompts.cpp</span>
<a href="#l96.2"></a><span id="l96.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgPrompts.cpp</span>
<a href="#l96.3"></a><span id="l96.3" class="difflineat">@@ -42,65 +42,65 @@ nsMsgGetMessageByName(const nsString &amp;aN</span>
<a href="#l96.4"></a><span id="l96.4">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l96.5"></a><span id="l96.5">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l96.6"></a><span id="l96.6"> </span>
<a href="#l96.7"></a><span id="l96.7">   return bundle-&gt;GetStringFromName(aName.get(),</span>
<a href="#l96.8"></a><span id="l96.8">                                    getter_Copies(aResult));</span>
<a href="#l96.9"></a><span id="l96.9"> }</span>
<a href="#l96.10"></a><span id="l96.10"> </span>
<a href="#l96.11"></a><span id="l96.11"> static nsresult</span>
<a href="#l96.12"></a><span id="l96.12" class="difflineminus">-nsMsgBuildMessageByName(const PRUnichar *aName, nsIFile *aFile, nsString&amp; aResult)</span>
<a href="#l96.13"></a><span id="l96.13" class="difflineplus">+nsMsgBuildMessageByName(const char16_t *aName, nsIFile *aFile, nsString&amp; aResult)</span>
<a href="#l96.14"></a><span id="l96.14"> {</span>
<a href="#l96.15"></a><span id="l96.15">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l96.16"></a><span id="l96.16">   nsresult rv;</span>
<a href="#l96.17"></a><span id="l96.17">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l96.18"></a><span id="l96.18">     mozilla::services::GetStringBundleService();</span>
<a href="#l96.19"></a><span id="l96.19">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l96.20"></a><span id="l96.20"> </span>
<a href="#l96.21"></a><span id="l96.21">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l96.22"></a><span id="l96.22">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l96.23"></a><span id="l96.23">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l96.24"></a><span id="l96.24"> </span>
<a href="#l96.25"></a><span id="l96.25">   nsString path;</span>
<a href="#l96.26"></a><span id="l96.26">   aFile-&gt;GetPath(path);</span>
<a href="#l96.27"></a><span id="l96.27"> </span>
<a href="#l96.28"></a><span id="l96.28" class="difflineminus">-  const PRUnichar *params[1] = {path.get()};</span>
<a href="#l96.29"></a><span id="l96.29" class="difflineplus">+  const char16_t *params[1] = {path.get()};</span>
<a href="#l96.30"></a><span id="l96.30">   return bundle-&gt;FormatStringFromName(aName, params, 1, getter_Copies(aResult));</span>
<a href="#l96.31"></a><span id="l96.31"> }</span>
<a href="#l96.32"></a><span id="l96.32"> </span>
<a href="#l96.33"></a><span id="l96.33"> nsresult</span>
<a href="#l96.34"></a><span id="l96.34"> nsMsgBuildMessageWithFile(nsIFile *aFile, nsString&amp; aResult)</span>
<a href="#l96.35"></a><span id="l96.35"> {</span>
<a href="#l96.36"></a><span id="l96.36">   return nsMsgBuildMessageByName(MOZ_UTF16(&quot;unableToOpenFile&quot;), aFile, aResult);</span>
<a href="#l96.37"></a><span id="l96.37"> }</span>
<a href="#l96.38"></a><span id="l96.38"> </span>
<a href="#l96.39"></a><span id="l96.39"> nsresult</span>
<a href="#l96.40"></a><span id="l96.40"> nsMsgBuildMessageWithTmpFile(nsIFile *aFile, nsString&amp; aResult)</span>
<a href="#l96.41"></a><span id="l96.41"> {</span>
<a href="#l96.42"></a><span id="l96.42">   return nsMsgBuildMessageByName(MOZ_UTF16(&quot;unableToOpenTmpFile&quot;), aFile, aResult);</span>
<a href="#l96.43"></a><span id="l96.43"> }</span>
<a href="#l96.44"></a><span id="l96.44"> </span>
<a href="#l96.45"></a><span id="l96.45"> nsresult</span>
<a href="#l96.46"></a><span id="l96.46" class="difflineminus">-nsMsgDisplayMessageByID(nsIPrompt * aPrompt, nsresult msgID, const PRUnichar * windowTitle)</span>
<a href="#l96.47"></a><span id="l96.47" class="difflineplus">+nsMsgDisplayMessageByID(nsIPrompt * aPrompt, nsresult msgID, const char16_t * windowTitle)</span>
<a href="#l96.48"></a><span id="l96.48"> {</span>
<a href="#l96.49"></a><span id="l96.49">   nsString msg;</span>
<a href="#l96.50"></a><span id="l96.50">   nsMsgGetMessageByID(msgID, msg);</span>
<a href="#l96.51"></a><span id="l96.51">   return nsMsgDisplayMessageByString(aPrompt, msg.get(), windowTitle);</span>
<a href="#l96.52"></a><span id="l96.52"> }</span>
<a href="#l96.53"></a><span id="l96.53"> </span>
<a href="#l96.54"></a><span id="l96.54"> nsresult</span>
<a href="#l96.55"></a><span id="l96.55" class="difflineminus">-nsMsgDisplayMessageByName(nsIPrompt *aPrompt, const nsString &amp;aName, const PRUnichar *windowTitle)</span>
<a href="#l96.56"></a><span id="l96.56" class="difflineplus">+nsMsgDisplayMessageByName(nsIPrompt *aPrompt, const nsString &amp;aName, const char16_t *windowTitle)</span>
<a href="#l96.57"></a><span id="l96.57"> {</span>
<a href="#l96.58"></a><span id="l96.58">   nsString msg;</span>
<a href="#l96.59"></a><span id="l96.59">   nsMsgGetMessageByName(aName, msg);</span>
<a href="#l96.60"></a><span id="l96.60">   return nsMsgDisplayMessageByString(aPrompt, msg.get(), windowTitle);</span>
<a href="#l96.61"></a><span id="l96.61"> }</span>
<a href="#l96.62"></a><span id="l96.62"> </span>
<a href="#l96.63"></a><span id="l96.63"> nsresult</span>
<a href="#l96.64"></a><span id="l96.64" class="difflineminus">-nsMsgDisplayMessageByString(nsIPrompt * aPrompt, const PRUnichar * msg, const PRUnichar * windowTitle)</span>
<a href="#l96.65"></a><span id="l96.65" class="difflineplus">+nsMsgDisplayMessageByString(nsIPrompt * aPrompt, const char16_t * msg, const char16_t * windowTitle)</span>
<a href="#l96.66"></a><span id="l96.66"> {</span>
<a href="#l96.67"></a><span id="l96.67">   NS_ENSURE_ARG_POINTER(msg);</span>
<a href="#l96.68"></a><span id="l96.68"> </span>
<a href="#l96.69"></a><span id="l96.69">   nsresult rv = NS_OK;</span>
<a href="#l96.70"></a><span id="l96.70">   nsCOMPtr&lt;nsIPrompt&gt; prompt = aPrompt;</span>
<a href="#l96.71"></a><span id="l96.71"> </span>
<a href="#l96.72"></a><span id="l96.72">   if (!prompt)</span>
<a href="#l96.73"></a><span id="l96.73">   {</span>
<a href="#l96.74"></a><span id="l96.74" class="difflineat">@@ -111,17 +111,17 @@ nsMsgDisplayMessageByString(nsIPrompt * </span>
<a href="#l96.75"></a><span id="l96.75"> </span>
<a href="#l96.76"></a><span id="l96.76">   if (prompt)</span>
<a href="#l96.77"></a><span id="l96.77">     rv = prompt-&gt;Alert(windowTitle, msg);</span>
<a href="#l96.78"></a><span id="l96.78"> </span>
<a href="#l96.79"></a><span id="l96.79">   return rv;</span>
<a href="#l96.80"></a><span id="l96.80"> }</span>
<a href="#l96.81"></a><span id="l96.81"> </span>
<a href="#l96.82"></a><span id="l96.82"> nsresult</span>
<a href="#l96.83"></a><span id="l96.83" class="difflineminus">-nsMsgAskBooleanQuestionByString(nsIPrompt * aPrompt, const PRUnichar * msg, bool *answer, const PRUnichar * windowTitle)</span>
<a href="#l96.84"></a><span id="l96.84" class="difflineplus">+nsMsgAskBooleanQuestionByString(nsIPrompt * aPrompt, const char16_t * msg, bool *answer, const char16_t * windowTitle)</span>
<a href="#l96.85"></a><span id="l96.85"> {</span>
<a href="#l96.86"></a><span id="l96.86">   NS_ENSURE_TRUE(msg &amp;&amp; *msg, NS_ERROR_INVALID_ARG);</span>
<a href="#l96.87"></a><span id="l96.87"> </span>
<a href="#l96.88"></a><span id="l96.88">   nsresult rv = NS_OK;</span>
<a href="#l96.89"></a><span id="l96.89">   nsCOMPtr&lt;nsIPrompt&gt; dialog = aPrompt;</span>
<a href="#l96.90"></a><span id="l96.90"> </span>
<a href="#l96.91"></a><span id="l96.91">   if (!dialog)</span>
<a href="#l96.92"></a><span id="l96.92">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l97.1"></a><span id="l97.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgPrompts.h</span>
<a href="#l97.2"></a><span id="l97.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgPrompts.h</span>
<a href="#l97.3"></a><span id="l97.3" class="difflineat">@@ -11,14 +11,14 @@</span>
<a href="#l97.4"></a><span id="l97.4"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l97.5"></a><span id="l97.5"> </span>
<a href="#l97.6"></a><span id="l97.6"> class nsIPrompt;</span>
<a href="#l97.7"></a><span id="l97.7"> </span>
<a href="#l97.8"></a><span id="l97.8"> nsresult      nsMsgGetMessageByID(nsresult aMsgID, nsString&amp; aResult);</span>
<a href="#l97.9"></a><span id="l97.9"> nsresult      nsMsgGetMessageByName(const nsString &amp;aName, nsString&amp; aResult);</span>
<a href="#l97.10"></a><span id="l97.10"> nsresult      nsMsgBuildMessageWithFile(nsIFile * aFile, nsString&amp; aResult);</span>
<a href="#l97.11"></a><span id="l97.11"> nsresult      nsMsgBuildMessageWithTmpFile(nsIFile * aFile, nsString&amp; aResult);</span>
<a href="#l97.12"></a><span id="l97.12" class="difflineminus">-nsresult      nsMsgDisplayMessageByID(nsIPrompt * aPrompt, nsresult msgID, const PRUnichar * windowTitle = nullptr);</span>
<a href="#l97.13"></a><span id="l97.13" class="difflineminus">-nsresult      nsMsgDisplayMessageByName(nsIPrompt *aPrompt, const nsString &amp;aName, const PRUnichar *windowTitle = nullptr);</span>
<a href="#l97.14"></a><span id="l97.14" class="difflineminus">-nsresult      nsMsgDisplayMessageByString(nsIPrompt * aPrompt, const PRUnichar * msg, const PRUnichar * windowTitle = nullptr);</span>
<a href="#l97.15"></a><span id="l97.15" class="difflineminus">-nsresult      nsMsgAskBooleanQuestionByString(nsIPrompt * aPrompt, const PRUnichar * msg, bool *answer, const PRUnichar * windowTitle = nullptr);</span>
<a href="#l97.16"></a><span id="l97.16" class="difflineplus">+nsresult      nsMsgDisplayMessageByID(nsIPrompt * aPrompt, nsresult msgID, const char16_t * windowTitle = nullptr);</span>
<a href="#l97.17"></a><span id="l97.17" class="difflineplus">+nsresult      nsMsgDisplayMessageByName(nsIPrompt *aPrompt, const nsString &amp;aName, const char16_t *windowTitle = nullptr);</span>
<a href="#l97.18"></a><span id="l97.18" class="difflineplus">+nsresult      nsMsgDisplayMessageByString(nsIPrompt * aPrompt, const char16_t * msg, const char16_t * windowTitle = nullptr);</span>
<a href="#l97.19"></a><span id="l97.19" class="difflineplus">+nsresult      nsMsgAskBooleanQuestionByString(nsIPrompt * aPrompt, const char16_t * msg, bool *answer, const char16_t * windowTitle = nullptr);</span>
<a href="#l97.20"></a><span id="l97.20"> </span>
<a href="#l97.21"></a><span id="l97.21"> #endif /* _nsMsgPrompts_H_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l98.1"></a><span id="l98.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l98.2"></a><span id="l98.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l98.3"></a><span id="l98.3" class="difflineat">@@ -1522,19 +1522,19 @@ nsMsgComposeAndSend::GetBodyFromEditor()</span>
<a href="#l98.4"></a><span id="l98.4">   // member variable after doing the necessary charset conversion.</span>
<a href="#l98.5"></a><span id="l98.5">   //</span>
<a href="#l98.6"></a><span id="l98.6"> </span>
<a href="#l98.7"></a><span id="l98.7">   //</span>
<a href="#l98.8"></a><span id="l98.8">   // Query the editor, get the body of HTML!</span>
<a href="#l98.9"></a><span id="l98.9">   //</span>
<a href="#l98.10"></a><span id="l98.10">   uint32_t  flags = nsIDocumentEncoder::OutputFormatted  | nsIDocumentEncoder::OutputNoFormattingInPre;</span>
<a href="#l98.11"></a><span id="l98.11">   nsAutoString bodyStr;</span>
<a href="#l98.12"></a><span id="l98.12" class="difflineminus">-  PRUnichar* bodyText = nullptr;</span>
<a href="#l98.13"></a><span id="l98.13" class="difflineplus">+  char16_t* bodyText = nullptr;</span>
<a href="#l98.14"></a><span id="l98.14">   nsresult rv;</span>
<a href="#l98.15"></a><span id="l98.15" class="difflineminus">-  PRUnichar *origHTMLBody = nullptr;</span>
<a href="#l98.16"></a><span id="l98.16" class="difflineplus">+  char16_t *origHTMLBody = nullptr;</span>
<a href="#l98.17"></a><span id="l98.17"> </span>
<a href="#l98.18"></a><span id="l98.18">   // Ok, get the body...the DOM should have been whacked with</span>
<a href="#l98.19"></a><span id="l98.19">   // Content ID's already</span>
<a href="#l98.20"></a><span id="l98.20">   if (mEditor)</span>
<a href="#l98.21"></a><span id="l98.21">     mEditor-&gt;OutputToString(NS_LITERAL_STRING(TEXT_HTML), flags, bodyStr);</span>
<a href="#l98.22"></a><span id="l98.22">   else</span>
<a href="#l98.23"></a><span id="l98.23">     bodyStr = NS_ConvertASCIItoUTF16(m_attachment1_body);</span>
<a href="#l98.24"></a><span id="l98.24"> </span>
<a href="#l98.25"></a><span id="l98.25" class="difflineat">@@ -1563,17 +1563,17 @@ nsMsgComposeAndSend::GetBodyFromEditor()</span>
<a href="#l98.26"></a><span id="l98.26">       nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l98.27"></a><span id="l98.27">       if (pPrefBranch)</span>
<a href="#l98.28"></a><span id="l98.28">       {</span>
<a href="#l98.29"></a><span id="l98.29">         rv = pPrefBranch-&gt;GetBoolPref(PREF_MAIL_SEND_STRUCT, &amp;enable_structs);</span>
<a href="#l98.30"></a><span id="l98.30">         if (enable_structs)</span>
<a href="#l98.31"></a><span id="l98.31">           whattodo = whattodo | mozITXTToHTMLConv::kStructPhrase;</span>
<a href="#l98.32"></a><span id="l98.32">       }</span>
<a href="#l98.33"></a><span id="l98.33"> </span>
<a href="#l98.34"></a><span id="l98.34" class="difflineminus">-      PRUnichar* wresult;</span>
<a href="#l98.35"></a><span id="l98.35" class="difflineplus">+      char16_t* wresult;</span>
<a href="#l98.36"></a><span id="l98.36">       rv = conv-&gt;ScanHTML(bodyText, whattodo, &amp;wresult);</span>
<a href="#l98.37"></a><span id="l98.37">       if (NS_SUCCEEDED(rv))</span>
<a href="#l98.38"></a><span id="l98.38">       {</span>
<a href="#l98.39"></a><span id="l98.39">         // Save the original body for possible attachment as plain text</span>
<a href="#l98.40"></a><span id="l98.40">         // We should have what the user typed in stored in mOriginalHTMLBody</span>
<a href="#l98.41"></a><span id="l98.41">         origHTMLBody = bodyText;</span>
<a href="#l98.42"></a><span id="l98.42">         bodyText = wresult;</span>
<a href="#l98.43"></a><span id="l98.43">       }</span>
<a href="#l98.44"></a><span id="l98.44" class="difflineat">@@ -1596,17 +1596,17 @@ nsMsgComposeAndSend::GetBodyFromEditor()</span>
<a href="#l98.45"></a><span id="l98.45">       isAsciiOnly = false;</span>
<a href="#l98.46"></a><span id="l98.46"> </span>
<a href="#l98.47"></a><span id="l98.47">     mCompFields-&gt;SetBodyIsAsciiOnly(isAsciiOnly);</span>
<a href="#l98.48"></a><span id="l98.48"> </span>
<a href="#l98.49"></a><span id="l98.49">     // If the body contains characters outside the current mail charset,</span>
<a href="#l98.50"></a><span id="l98.50">     // convert to UTF-8.</span>
<a href="#l98.51"></a><span id="l98.51">     if (NS_ERROR_UENC_NOMAPPING == rv) {</span>
<a href="#l98.52"></a><span id="l98.52">       // if nbsp then replace it by sp and try again</span>
<a href="#l98.53"></a><span id="l98.53" class="difflineminus">-      PRUnichar *bodyTextPtr = bodyText;</span>
<a href="#l98.54"></a><span id="l98.54" class="difflineplus">+      char16_t *bodyTextPtr = bodyText;</span>
<a href="#l98.55"></a><span id="l98.55">       while (*bodyTextPtr) {</span>
<a href="#l98.56"></a><span id="l98.56">         if (0x00A0 == *bodyTextPtr)</span>
<a href="#l98.57"></a><span id="l98.57">           *bodyTextPtr = 0x0020;</span>
<a href="#l98.58"></a><span id="l98.58">         bodyTextPtr++;</span>
<a href="#l98.59"></a><span id="l98.59">       }</span>
<a href="#l98.60"></a><span id="l98.60"> </span>
<a href="#l98.61"></a><span id="l98.61">       nsCString fallbackCharset;</span>
<a href="#l98.62"></a><span id="l98.62">       rv = nsMsgI18NSaveAsCharset(mCompFields-&gt;GetForcePlainText() ? TEXT_PLAIN : TEXT_HTML,</span>
<a href="#l98.63"></a><span id="l98.63" class="difflineat">@@ -1651,32 +1651,32 @@ nsMsgComposeAndSend::GetBodyFromEditor()</span>
<a href="#l98.64"></a><span id="l98.64">     if (origHTMLBody)</span>
<a href="#l98.65"></a><span id="l98.65">     {</span>
<a href="#l98.66"></a><span id="l98.66">       char      *newBody = nullptr;</span>
<a href="#l98.67"></a><span id="l98.67">       rv = nsMsgI18NSaveAsCharset(mCompFields-&gt;GetUseMultipartAlternative() ? TEXT_PLAIN : TEXT_HTML,</span>
<a href="#l98.68"></a><span id="l98.68">                                   aCharset, origHTMLBody, &amp;newBody);</span>
<a href="#l98.69"></a><span id="l98.69">       if (NS_SUCCEEDED(rv))</span>
<a href="#l98.70"></a><span id="l98.70">       {</span>
<a href="#l98.71"></a><span id="l98.71">         PR_FREEIF(origHTMLBody);</span>
<a href="#l98.72"></a><span id="l98.72" class="difflineminus">-        origHTMLBody = (PRUnichar *)newBody;</span>
<a href="#l98.73"></a><span id="l98.73" class="difflineplus">+        origHTMLBody = (char16_t *)newBody;</span>
<a href="#l98.74"></a><span id="l98.74">       }</span>
<a href="#l98.75"></a><span id="l98.75">     }</span>
<a href="#l98.76"></a><span id="l98.76"> </span>
<a href="#l98.77"></a><span id="l98.77">     NS_Free(bodyText);    //Don't need it anymore</span>
<a href="#l98.78"></a><span id="l98.78">   }</span>
<a href="#l98.79"></a><span id="l98.79">   else</span>
<a href="#l98.80"></a><span id="l98.80">     return NS_ERROR_FAILURE;</span>
<a href="#l98.81"></a><span id="l98.81"> </span>
<a href="#l98.82"></a><span id="l98.82">   // If our holder for the original body text is STILL null, then just</span>
<a href="#l98.83"></a><span id="l98.83">   // just copy what we have as the original body text.</span>
<a href="#l98.84"></a><span id="l98.84"> </span>
<a href="#l98.85"></a><span id="l98.85">   if (!origHTMLBody)</span>
<a href="#l98.86"></a><span id="l98.86">     mOriginalHTMLBody = ToNewCString(attachment1_body);</span>
<a href="#l98.87"></a><span id="l98.87">   else</span>
<a href="#l98.88"></a><span id="l98.88" class="difflineminus">-    mOriginalHTMLBody = (char *)origHTMLBody; // Whoa, origHTMLBody is declared as a PRUnichar *, what's going on here?</span>
<a href="#l98.89"></a><span id="l98.89" class="difflineplus">+    mOriginalHTMLBody = (char *)origHTMLBody; // Whoa, origHTMLBody is declared as a char16_t *, what's going on here?</span>
<a href="#l98.90"></a><span id="l98.90"> </span>
<a href="#l98.91"></a><span id="l98.91">   rv = SnarfAndCopyBody(attachment1_body, TEXT_HTML);</span>
<a href="#l98.92"></a><span id="l98.92"> </span>
<a href="#l98.93"></a><span id="l98.93">   return rv;</span>
<a href="#l98.94"></a><span id="l98.94"> }</span>
<a href="#l98.95"></a><span id="l98.95"> </span>
<a href="#l98.96"></a><span id="l98.96"> // for SMTP, 16k</span>
<a href="#l98.97"></a><span id="l98.97"> // for our internal protocol buffers, 4k</span>
<a href="#l98.98"></a><span id="l98.98" class="difflineat">@@ -2573,17 +2573,17 @@ nsMsgComposeAndSend::HackAttachments(nsI</span>
<a href="#l98.99"></a><span id="l98.99">       }</span>
<a href="#l98.100"></a><span id="l98.100"> </span>
<a href="#l98.101"></a><span id="l98.101">       //</span>
<a href="#l98.102"></a><span id="l98.102">       // This only returns a failure code if NET_GetURL was not called</span>
<a href="#l98.103"></a><span id="l98.103">       // (and thus no exit routine was or will be called.)</span>
<a href="#l98.104"></a><span id="l98.104">       //</span>
<a href="#l98.105"></a><span id="l98.105"> </span>
<a href="#l98.106"></a><span id="l98.106">       // Display some feedback to user...</span>
<a href="#l98.107"></a><span id="l98.107" class="difflineminus">-      PRUnichar     *printfString = nullptr;</span>
<a href="#l98.108"></a><span id="l98.108" class="difflineplus">+      char16_t     *printfString = nullptr;</span>
<a href="#l98.109"></a><span id="l98.109">       nsString msg;</span>
<a href="#l98.110"></a><span id="l98.110">       mComposeBundle-&gt;GetStringFromID(NS_MSG_GATHERING_ATTACHMENT, getter_Copies(msg));</span>
<a href="#l98.111"></a><span id="l98.111"> </span>
<a href="#l98.112"></a><span id="l98.112">       printfString = nsTextFormatter::smprintf(msg.get(), m_attachments[i]-&gt;m_realName.get());</span>
<a href="#l98.113"></a><span id="l98.113"> </span>
<a href="#l98.114"></a><span id="l98.114">       if (printfString)</span>
<a href="#l98.115"></a><span id="l98.115">       {</span>
<a href="#l98.116"></a><span id="l98.116">         SetStatusMessage(nsDependentString(printfString));</span>
<a href="#l98.117"></a><span id="l98.117" class="difflineat">@@ -2599,17 +2599,17 @@ nsMsgComposeAndSend::HackAttachments(nsI</span>
<a href="#l98.118"></a><span id="l98.118">       if (NS_FAILED(status))</span>
<a href="#l98.119"></a><span id="l98.119">       {</span>
<a href="#l98.120"></a><span id="l98.120">         nsString errorMsg;</span>
<a href="#l98.121"></a><span id="l98.121">         nsAutoString attachmentFileName;</span>
<a href="#l98.122"></a><span id="l98.122">         nsresult rv = ConvertToUnicode(nsMsgI18NFileSystemCharset(), m_attachments[i]-&gt;m_realName, attachmentFileName);</span>
<a href="#l98.123"></a><span id="l98.123">         if (NS_SUCCEEDED(rv))</span>
<a href="#l98.124"></a><span id="l98.124">         {</span>
<a href="#l98.125"></a><span id="l98.125">           nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l98.126"></a><span id="l98.126" class="difflineminus">-          const PRUnichar *params[] = { attachmentFileName.get() };</span>
<a href="#l98.127"></a><span id="l98.127" class="difflineplus">+          const char16_t *params[] = { attachmentFileName.get() };</span>
<a href="#l98.128"></a><span id="l98.128">           mComposeBundle-&gt;FormatStringFromID(NS_ERROR_GET_CODE(NS_MSG_ERROR_ATTACHING_FILE), params, 1, getter_Copies(errorMsg));</span>
<a href="#l98.129"></a><span id="l98.129">           mSendReport-&gt;SetMessage(nsIMsgSendReport::process_Current, errorMsg.get(), false);</span>
<a href="#l98.130"></a><span id="l98.130">           mSendReport-&gt;SetError(nsIMsgSendReport::process_Current,</span>
<a href="#l98.131"></a><span id="l98.131">               // XXX The following applies NS_ERROR_GENERATE_FAILURE twice,</span>
<a href="#l98.132"></a><span id="l98.132">               // which doesn't make sense.  Just NS_MSG_ERROR_ATTACHING_FILE is</span>
<a href="#l98.133"></a><span id="l98.133">               // surely what was intended.</span>
<a href="#l98.134"></a><span id="l98.134">               NS_ERROR_GENERATE_FAILURE(</span>
<a href="#l98.135"></a><span id="l98.135">                 NS_ERROR_MODULE_MAILNEWS,</span>
<a href="#l98.136"></a><span id="l98.136" class="difflineat">@@ -3395,17 +3395,17 @@ nsMsgComposeAndSend::DeliverMessage()</span>
<a href="#l98.137"></a><span id="l98.137">   if ((mMessageWarningSize &gt; 0) &amp;&amp; (fileSize &gt; mMessageWarningSize) &amp;&amp; (mGUINotificationEnabled))</span>
<a href="#l98.138"></a><span id="l98.138">   {</span>
<a href="#l98.139"></a><span id="l98.139">     bool abortTheSend = false;</span>
<a href="#l98.140"></a><span id="l98.140">     nsString msg;</span>
<a href="#l98.141"></a><span id="l98.141">     mComposeBundle-&gt;GetStringFromID(NS_MSG_LARGE_MESSAGE_WARNING, getter_Copies(msg));</span>
<a href="#l98.142"></a><span id="l98.142"> </span>
<a href="#l98.143"></a><span id="l98.143">     if (!msg.IsEmpty())</span>
<a href="#l98.144"></a><span id="l98.144">     {</span>
<a href="#l98.145"></a><span id="l98.145" class="difflineminus">-      PRUnichar *printfString = nsTextFormatter::smprintf(msg.get(), fileSize);</span>
<a href="#l98.146"></a><span id="l98.146" class="difflineplus">+      char16_t *printfString = nsTextFormatter::smprintf(msg.get(), fileSize);</span>
<a href="#l98.147"></a><span id="l98.147"> </span>
<a href="#l98.148"></a><span id="l98.148">       if (printfString)</span>
<a href="#l98.149"></a><span id="l98.149">       {</span>
<a href="#l98.150"></a><span id="l98.150">         nsCOMPtr&lt;nsIPrompt&gt; prompt;</span>
<a href="#l98.151"></a><span id="l98.151">         GetDefaultPrompt(getter_AddRefs(prompt));</span>
<a href="#l98.152"></a><span id="l98.152"> </span>
<a href="#l98.153"></a><span id="l98.153">         nsMsgAskBooleanQuestionByString(prompt, printfString, &amp;abortTheSend);</span>
<a href="#l98.154"></a><span id="l98.154">         if (!abortTheSend)</span>
<a href="#l98.155"></a><span id="l98.155" class="difflineat">@@ -3630,17 +3630,17 @@ nsMsgComposeAndSend::DeliverFileAsNews()</span>
<a href="#l98.156"></a><span id="l98.156">                                   deliveryListener, msgWindow, nullptr);</span>
<a href="#l98.157"></a><span id="l98.157">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l98.158"></a><span id="l98.158">   }</span>
<a href="#l98.159"></a><span id="l98.159"> </span>
<a href="#l98.160"></a><span id="l98.160">   return rv;</span>
<a href="#l98.161"></a><span id="l98.161"> }</span>
<a href="#l98.162"></a><span id="l98.162"> </span>
<a href="#l98.163"></a><span id="l98.163"> NS_IMETHODIMP</span>
<a href="#l98.164"></a><span id="l98.164" class="difflineminus">-nsMsgComposeAndSend::Fail(nsresult aFailureCode, const PRUnichar *aErrorMsg,</span>
<a href="#l98.165"></a><span id="l98.165" class="difflineplus">+nsMsgComposeAndSend::Fail(nsresult aFailureCode, const char16_t *aErrorMsg,</span>
<a href="#l98.166"></a><span id="l98.166">                           nsresult *aResult)</span>
<a href="#l98.167"></a><span id="l98.167"> {</span>
<a href="#l98.168"></a><span id="l98.168">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l98.169"></a><span id="l98.169">   *aResult = aFailureCode;</span>
<a href="#l98.170"></a><span id="l98.170"> </span>
<a href="#l98.171"></a><span id="l98.171">   if (NS_FAILED(aFailureCode))</span>
<a href="#l98.172"></a><span id="l98.172">   {</span>
<a href="#l98.173"></a><span id="l98.173">     nsCOMPtr&lt;nsIPrompt&gt; prompt;</span>
<a href="#l98.174"></a><span id="l98.174" class="difflineat">@@ -3670,34 +3670,34 @@ nsMsgComposeAndSend::Fail(nsresult aFail</span>
<a href="#l98.175"></a><span id="l98.175"> </span>
<a href="#l98.176"></a><span id="l98.176">   //Stop any pending process...</span>
<a href="#l98.177"></a><span id="l98.177">   Abort();</span>
<a href="#l98.178"></a><span id="l98.178"> </span>
<a href="#l98.179"></a><span id="l98.179">   return NS_OK;</span>
<a href="#l98.180"></a><span id="l98.180"> }</span>
<a href="#l98.181"></a><span id="l98.181"> </span>
<a href="#l98.182"></a><span id="l98.182"> nsresult</span>
<a href="#l98.183"></a><span id="l98.183" class="difflineminus">-nsMsgComposeAndSend::FormatStringWithSMTPHostNameByID(nsresult aMsgId, PRUnichar **aString)</span>
<a href="#l98.184"></a><span id="l98.184" class="difflineplus">+nsMsgComposeAndSend::FormatStringWithSMTPHostNameByID(nsresult aMsgId, char16_t **aString)</span>
<a href="#l98.185"></a><span id="l98.185"> {</span>
<a href="#l98.186"></a><span id="l98.186">   NS_ENSURE_ARG(aString);</span>
<a href="#l98.187"></a><span id="l98.187"> </span>
<a href="#l98.188"></a><span id="l98.188">   nsresult rv;</span>
<a href="#l98.189"></a><span id="l98.189">   nsCOMPtr&lt;nsISmtpService&gt; smtpService(do_GetService(NS_SMTPSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l98.190"></a><span id="l98.190">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l98.191"></a><span id="l98.191"> </span>
<a href="#l98.192"></a><span id="l98.192">   // Get the smtp hostname and format the string.</span>
<a href="#l98.193"></a><span id="l98.193">   nsCString smtpHostName;</span>
<a href="#l98.194"></a><span id="l98.194">   nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l98.195"></a><span id="l98.195">   rv = smtpService-&gt;GetServerByIdentity(mUserIdentity, getter_AddRefs(smtpServer));</span>
<a href="#l98.196"></a><span id="l98.196">   if (NS_SUCCEEDED(rv))</span>
<a href="#l98.197"></a><span id="l98.197">     smtpServer-&gt;GetHostname(smtpHostName);</span>
<a href="#l98.198"></a><span id="l98.198"> </span>
<a href="#l98.199"></a><span id="l98.199">   nsAutoString hostStr;</span>
<a href="#l98.200"></a><span id="l98.200">   CopyASCIItoUTF16(smtpHostName, hostStr);</span>
<a href="#l98.201"></a><span id="l98.201" class="difflineminus">-  const PRUnichar *params[] = { hostStr.get() };</span>
<a href="#l98.202"></a><span id="l98.202" class="difflineplus">+  const char16_t *params[] = { hostStr.get() };</span>
<a href="#l98.203"></a><span id="l98.203">   if (NS_SUCCEEDED(rv))</span>
<a href="#l98.204"></a><span id="l98.204">     mComposeBundle-&gt;FormatStringFromID(NS_ERROR_GET_CODE(aMsgId), params, 1, aString);</span>
<a href="#l98.205"></a><span id="l98.205">   return rv;</span>
<a href="#l98.206"></a><span id="l98.206"> }</span>
<a href="#l98.207"></a><span id="l98.207"> </span>
<a href="#l98.208"></a><span id="l98.208"> void</span>
<a href="#l98.209"></a><span id="l98.209"> nsMsgComposeAndSend::DoDeliveryExitProcessing(nsIURI * aUri, nsresult aExitCode, bool aCheckForMail)</span>
<a href="#l98.210"></a><span id="l98.210"> {</span>
<a href="#l98.211"></a><span id="l98.211" class="difflineat">@@ -3866,26 +3866,26 @@ nsMsgComposeAndSend::NotifyListenerOnPro</span>
<a href="#l98.212"></a><span id="l98.212"> {</span>
<a href="#l98.213"></a><span id="l98.213">   if (mListener)</span>
<a href="#l98.214"></a><span id="l98.214">     mListener-&gt;OnProgress(aMsgID, aProgress, aProgressMax);</span>
<a href="#l98.215"></a><span id="l98.215"> </span>
<a href="#l98.216"></a><span id="l98.216">   return NS_OK;</span>
<a href="#l98.217"></a><span id="l98.217"> }</span>
<a href="#l98.218"></a><span id="l98.218"> </span>
<a href="#l98.219"></a><span id="l98.219"> NS_IMETHODIMP</span>
<a href="#l98.220"></a><span id="l98.220" class="difflineminus">-nsMsgComposeAndSend::NotifyListenerOnStatus(const char *aMsgID, const PRUnichar *aMsg)</span>
<a href="#l98.221"></a><span id="l98.221" class="difflineplus">+nsMsgComposeAndSend::NotifyListenerOnStatus(const char *aMsgID, const char16_t *aMsg)</span>
<a href="#l98.222"></a><span id="l98.222"> {</span>
<a href="#l98.223"></a><span id="l98.223">   if (mListener)</span>
<a href="#l98.224"></a><span id="l98.224">     mListener-&gt;OnStatus(aMsgID, aMsg);</span>
<a href="#l98.225"></a><span id="l98.225"> </span>
<a href="#l98.226"></a><span id="l98.226">   return NS_OK;</span>
<a href="#l98.227"></a><span id="l98.227"> }</span>
<a href="#l98.228"></a><span id="l98.228"> </span>
<a href="#l98.229"></a><span id="l98.229"> NS_IMETHODIMP</span>
<a href="#l98.230"></a><span id="l98.230" class="difflineminus">-nsMsgComposeAndSend::NotifyListenerOnStopSending(const char *aMsgID, nsresult aStatus, const PRUnichar *aMsg,</span>
<a href="#l98.231"></a><span id="l98.231" class="difflineplus">+nsMsgComposeAndSend::NotifyListenerOnStopSending(const char *aMsgID, nsresult aStatus, const char16_t *aMsg,</span>
<a href="#l98.232"></a><span id="l98.232">                                                   nsIFile *returnFile)</span>
<a href="#l98.233"></a><span id="l98.233"> {</span>
<a href="#l98.234"></a><span id="l98.234">   if (mListener != nullptr)</span>
<a href="#l98.235"></a><span id="l98.235">     mListener-&gt;OnStopSending(aMsgID, aStatus, aMsg, returnFile);</span>
<a href="#l98.236"></a><span id="l98.236"> </span>
<a href="#l98.237"></a><span id="l98.237">   return NS_OK;</span>
<a href="#l98.238"></a><span id="l98.238"> }</span>
<a href="#l98.239"></a><span id="l98.239"> </span>
<a href="#l98.240"></a><span id="l98.240" class="difflineat">@@ -3982,17 +3982,17 @@ nsMsgComposeAndSend::NotifyListenerOnSto</span>
<a href="#l98.241"></a><span id="l98.241">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l98.242"></a><span id="l98.242">       mozilla::services::GetStringBundleService();</span>
<a href="#l98.243"></a><span id="l98.243">     NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l98.244"></a><span id="l98.244">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l98.245"></a><span id="l98.245">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l98.246"></a><span id="l98.246">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l98.247"></a><span id="l98.247"> </span>
<a href="#l98.248"></a><span id="l98.248">     nsString msg;</span>
<a href="#l98.249"></a><span id="l98.249" class="difflineminus">-    const PRUnichar *formatStrings[] = { mSavedToFolderName.get() };</span>
<a href="#l98.250"></a><span id="l98.250" class="difflineplus">+    const char16_t *formatStrings[] = { mSavedToFolderName.get() };</span>
<a href="#l98.251"></a><span id="l98.251"> </span>
<a href="#l98.252"></a><span id="l98.252">     rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;errorSavingMsg&quot;),</span>
<a href="#l98.253"></a><span id="l98.253">                                       formatStrings, 1,</span>
<a href="#l98.254"></a><span id="l98.254">                                       getter_Copies(msg));</span>
<a href="#l98.255"></a><span id="l98.255">     if (NS_SUCCEEDED(rv))</span>
<a href="#l98.256"></a><span id="l98.256">     {</span>
<a href="#l98.257"></a><span id="l98.257">       bool retry = false;</span>
<a href="#l98.258"></a><span id="l98.258">       nsMsgAskBooleanQuestionByString(prompt, msg.get(), &amp;retry, nullptr);</span>
<a href="#l98.259"></a><span id="l98.259" class="difflineat">@@ -4317,17 +4317,17 @@ nsMsgComposeAndSend::MimeDoFCC(nsIFile  </span>
<a href="#l98.260"></a><span id="l98.260"> {</span>
<a href="#l98.261"></a><span id="l98.261">   nsresult      status = NS_OK;</span>
<a href="#l98.262"></a><span id="l98.262">   char          *ibuffer = 0;</span>
<a href="#l98.263"></a><span id="l98.263">   int32_t       ibuffer_size = TEN_K;</span>
<a href="#l98.264"></a><span id="l98.264">   char          *obuffer = 0;</span>
<a href="#l98.265"></a><span id="l98.265">   uint32_t      n;</span>
<a href="#l98.266"></a><span id="l98.266">   bool          folderIsLocal = true;</span>
<a href="#l98.267"></a><span id="l98.267">   nsCString     turi;</span>
<a href="#l98.268"></a><span id="l98.268" class="difflineminus">-  PRUnichar     *printfString = nullptr;</span>
<a href="#l98.269"></a><span id="l98.269" class="difflineplus">+  char16_t     *printfString = nullptr;</span>
<a href="#l98.270"></a><span id="l98.270">   nsString msg;</span>
<a href="#l98.271"></a><span id="l98.271">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l98.272"></a><span id="l98.272"> </span>
<a href="#l98.273"></a><span id="l98.273">   // Before continuing, just check the user has not cancel the operation</span>
<a href="#l98.274"></a><span id="l98.274">   if (mSendProgress)</span>
<a href="#l98.275"></a><span id="l98.275">   {</span>
<a href="#l98.276"></a><span id="l98.276">     bool canceled = false;</span>
<a href="#l98.277"></a><span id="l98.277">     mSendProgress-&gt;GetProcessCanceledByUser(&amp;canceled);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l99.1"></a><span id="l99.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.h</span>
<a href="#l99.2"></a><span id="l99.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.h</span>
<a href="#l99.3"></a><span id="l99.3" class="difflineat">@@ -175,17 +175,17 @@ public:</span>
<a href="#l99.4"></a><span id="l99.4">   virtual     ~nsMsgComposeAndSend();</span>
<a href="#l99.5"></a><span id="l99.5"> </span>
<a href="#l99.6"></a><span id="l99.6"> </span>
<a href="#l99.7"></a><span id="l99.7">   // Delivery and completion callback routines...</span>
<a href="#l99.8"></a><span id="l99.8">   NS_IMETHOD  DeliverMessage();</span>
<a href="#l99.9"></a><span id="l99.9">   NS_IMETHOD  DeliverFileAsMail();</span>
<a href="#l99.10"></a><span id="l99.10">   NS_IMETHOD  DeliverFileAsNews();</span>
<a href="#l99.11"></a><span id="l99.11">   void        DoDeliveryExitProcessing(nsIURI * aUrl, nsresult aExitCode, bool aCheckForMail);</span>
<a href="#l99.12"></a><span id="l99.12" class="difflineminus">-  nsresult    FormatStringWithSMTPHostNameByID(nsresult aMsgId, PRUnichar **aString);</span>
<a href="#l99.13"></a><span id="l99.13" class="difflineplus">+  nsresult    FormatStringWithSMTPHostNameByID(nsresult aMsgId, char16_t **aString);</span>
<a href="#l99.14"></a><span id="l99.14"> </span>
<a href="#l99.15"></a><span id="l99.15">   nsresult    DoFcc();</span>
<a href="#l99.16"></a><span id="l99.16">   nsresult    StartMessageCopyOperation(nsIFile          *aFileSpec,</span>
<a href="#l99.17"></a><span id="l99.17">                                         nsMsgDeliverMode mode,</span>
<a href="#l99.18"></a><span id="l99.18">                                         const nsCString&amp; dest_uri);</span>
<a href="#l99.19"></a><span id="l99.19"> </span>
<a href="#l99.20"></a><span id="l99.20"> </span>
<a href="#l99.21"></a><span id="l99.21">   nsresult SendToMagicFolder(nsMsgDeliverMode flag);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l100.1"></a><span id="l100.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l100.2"></a><span id="l100.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l100.3"></a><span id="l100.3" class="difflineat">@@ -125,17 +125,17 @@ nsMsgSendLater::Init()</span>
<a href="#l100.4"></a><span id="l100.4"> </span>
<a href="#l100.5"></a><span id="l100.5">   // XXX may want to send messages X seconds after startup if there are any.</span>
<a href="#l100.6"></a><span id="l100.6"> </span>
<a href="#l100.7"></a><span id="l100.7">   return NS_OK;</span>
<a href="#l100.8"></a><span id="l100.8"> }</span>
<a href="#l100.9"></a><span id="l100.9"> </span>
<a href="#l100.10"></a><span id="l100.10"> NS_IMETHODIMP</span>
<a href="#l100.11"></a><span id="l100.11"> nsMsgSendLater::Observe(nsISupports *aSubject, const char* aTopic,</span>
<a href="#l100.12"></a><span id="l100.12" class="difflineminus">-                        const PRUnichar *aData)</span>
<a href="#l100.13"></a><span id="l100.13" class="difflineplus">+                        const char16_t *aData)</span>
<a href="#l100.14"></a><span id="l100.14"> {</span>
<a href="#l100.15"></a><span id="l100.15">   if (aSubject == mTimer &amp;&amp; !strcmp(aTopic, &quot;timer-callback&quot;))</span>
<a href="#l100.16"></a><span id="l100.16">   {</span>
<a href="#l100.17"></a><span id="l100.17">     if (mTimer)</span>
<a href="#l100.18"></a><span id="l100.18">       mTimer-&gt;Cancel();</span>
<a href="#l100.19"></a><span id="l100.19">     else</span>
<a href="#l100.20"></a><span id="l100.20">       NS_ERROR(&quot;mTimer was null in nsMsgSendLater::Observe&quot;);</span>
<a href="#l100.21"></a><span id="l100.21"> </span>
<a href="#l100.22"></a><span id="l100.22" class="difflineat">@@ -430,33 +430,33 @@ SendOperationListener::OnProgress(const </span>
<a href="#l100.23"></a><span id="l100.23"> {</span>
<a href="#l100.24"></a><span id="l100.24"> #ifdef NS_DEBUG</span>
<a href="#l100.25"></a><span id="l100.25">   printf(&quot;SendOperationListener::OnProgress()\n&quot;);</span>
<a href="#l100.26"></a><span id="l100.26"> #endif</span>
<a href="#l100.27"></a><span id="l100.27">   return NS_OK;</span>
<a href="#l100.28"></a><span id="l100.28"> }</span>
<a href="#l100.29"></a><span id="l100.29"> </span>
<a href="#l100.30"></a><span id="l100.30"> NS_IMETHODIMP</span>
<a href="#l100.31"></a><span id="l100.31" class="difflineminus">-SendOperationListener::OnStatus(const char *aMsgID, const PRUnichar *aMsg)</span>
<a href="#l100.32"></a><span id="l100.32" class="difflineplus">+SendOperationListener::OnStatus(const char *aMsgID, const char16_t *aMsg)</span>
<a href="#l100.33"></a><span id="l100.33"> {</span>
<a href="#l100.34"></a><span id="l100.34"> #ifdef NS_DEBUG</span>
<a href="#l100.35"></a><span id="l100.35">   printf(&quot;SendOperationListener::OnStatus()\n&quot;);</span>
<a href="#l100.36"></a><span id="l100.36"> #endif</span>
<a href="#l100.37"></a><span id="l100.37"> </span>
<a href="#l100.38"></a><span id="l100.38">   return NS_OK;</span>
<a href="#l100.39"></a><span id="l100.39"> }</span>
<a href="#l100.40"></a><span id="l100.40"> </span>
<a href="#l100.41"></a><span id="l100.41"> NS_IMETHODIMP</span>
<a href="#l100.42"></a><span id="l100.42"> SendOperationListener::OnSendNotPerformed(const char *aMsgID, nsresult aStatus)</span>
<a href="#l100.43"></a><span id="l100.43"> {</span>
<a href="#l100.44"></a><span id="l100.44">   return NS_OK;</span>
<a href="#l100.45"></a><span id="l100.45"> }</span>
<a href="#l100.46"></a><span id="l100.46">   </span>
<a href="#l100.47"></a><span id="l100.47"> NS_IMETHODIMP</span>
<a href="#l100.48"></a><span id="l100.48" class="difflineminus">-SendOperationListener::OnStopSending(const char *aMsgID, nsresult aStatus, const PRUnichar *aMsg, </span>
<a href="#l100.49"></a><span id="l100.49" class="difflineplus">+SendOperationListener::OnStopSending(const char *aMsgID, nsresult aStatus, const char16_t *aMsg, </span>
<a href="#l100.50"></a><span id="l100.50">                                      nsIFile *returnFile)</span>
<a href="#l100.51"></a><span id="l100.51"> {</span>
<a href="#l100.52"></a><span id="l100.52">   if (mSendLater &amp;&amp; !mSendLater-&gt;OnSendStepFinished(aStatus))</span>
<a href="#l100.53"></a><span id="l100.53">       NS_RELEASE(mSendLater);</span>
<a href="#l100.54"></a><span id="l100.54"> </span>
<a href="#l100.55"></a><span id="l100.55">   return NS_OK;</span>
<a href="#l100.56"></a><span id="l100.56"> }</span>
<a href="#l100.57"></a><span id="l100.57"> </span>
<a href="#l100.58"></a><span id="l100.58" class="difflineat">@@ -1323,28 +1323,28 @@ nsMsgSendLater::NotifyListenersOnProgres</span>
<a href="#l100.59"></a><span id="l100.59"> {</span>
<a href="#l100.60"></a><span id="l100.60">   NOTIFY_LISTENERS(OnMessageSendProgress, (aCurrentMessage, aTotalMessage,</span>
<a href="#l100.61"></a><span id="l100.61">                                            aSendPercent, aCopyPercent));</span>
<a href="#l100.62"></a><span id="l100.62"> }</span>
<a href="#l100.63"></a><span id="l100.63"> </span>
<a href="#l100.64"></a><span id="l100.64"> void</span>
<a href="#l100.65"></a><span id="l100.65"> nsMsgSendLater::NotifyListenersOnMessageSendError(uint32_t aCurrentMessage,</span>
<a href="#l100.66"></a><span id="l100.66">                                                   nsresult aStatus,</span>
<a href="#l100.67"></a><span id="l100.67" class="difflineminus">-                                                  const PRUnichar *aMsg)</span>
<a href="#l100.68"></a><span id="l100.68" class="difflineplus">+                                                  const char16_t *aMsg)</span>
<a href="#l100.69"></a><span id="l100.69"> {</span>
<a href="#l100.70"></a><span id="l100.70">   NOTIFY_LISTENERS(OnMessageSendError, (aCurrentMessage, mMessage,</span>
<a href="#l100.71"></a><span id="l100.71">                                         aStatus, aMsg));</span>
<a href="#l100.72"></a><span id="l100.72"> }</span>
<a href="#l100.73"></a><span id="l100.73"> </span>
<a href="#l100.74"></a><span id="l100.74"> /**</span>
<a href="#l100.75"></a><span id="l100.75">  * This function is called to end sending of messages, it resets the send later</span>
<a href="#l100.76"></a><span id="l100.76">  * system and notifies the relevant parties that we have finished.</span>
<a href="#l100.77"></a><span id="l100.77">  */</span>
<a href="#l100.78"></a><span id="l100.78"> void</span>
<a href="#l100.79"></a><span id="l100.79" class="difflineminus">-nsMsgSendLater::EndSendMessages(nsresult aStatus, const PRUnichar *aMsg,</span>
<a href="#l100.80"></a><span id="l100.80" class="difflineplus">+nsMsgSendLater::EndSendMessages(nsresult aStatus, const char16_t *aMsg,</span>
<a href="#l100.81"></a><span id="l100.81">                                 uint32_t aTotalTried, uint32_t aSuccessful)</span>
<a href="#l100.82"></a><span id="l100.82"> {</span>
<a href="#l100.83"></a><span id="l100.83">   // Catch-all, we may have had an issue sending, so we may not be calling</span>
<a href="#l100.84"></a><span id="l100.84">   // StartNextMailFileSend to fully finish the sending. Therefore set</span>
<a href="#l100.85"></a><span id="l100.85">   // mSendingMessages to false here so that we don't think we're still trying</span>
<a href="#l100.86"></a><span id="l100.86">   // to send messages</span>
<a href="#l100.87"></a><span id="l100.87">   mSendingMessages = false;</span>
<a href="#l100.88"></a><span id="l100.88"> </span>
<a href="#l100.89"></a><span id="l100.89" class="difflineat">@@ -1521,18 +1521,18 @@ nsMsgSendLater::OnItemBoolPropertyChange</span>
<a href="#l100.90"></a><span id="l100.90">                                           bool aOldValue, bool aNewValue)</span>
<a href="#l100.91"></a><span id="l100.91"> {</span>
<a href="#l100.92"></a><span id="l100.92">   return NS_OK;</span>
<a href="#l100.93"></a><span id="l100.93"> }</span>
<a href="#l100.94"></a><span id="l100.94"> </span>
<a href="#l100.95"></a><span id="l100.95"> NS_IMETHODIMP</span>
<a href="#l100.96"></a><span id="l100.96"> nsMsgSendLater::OnItemUnicharPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l100.97"></a><span id="l100.97">                                              nsIAtom *aProperty,</span>
<a href="#l100.98"></a><span id="l100.98" class="difflineminus">-                                             const PRUnichar* aOldValue,</span>
<a href="#l100.99"></a><span id="l100.99" class="difflineminus">-                                             const PRUnichar* aNewValue)</span>
<a href="#l100.100"></a><span id="l100.100" class="difflineplus">+                                             const char16_t* aOldValue,</span>
<a href="#l100.101"></a><span id="l100.101" class="difflineplus">+                                             const char16_t* aNewValue)</span>
<a href="#l100.102"></a><span id="l100.102"> {</span>
<a href="#l100.103"></a><span id="l100.103">   return NS_OK;</span>
<a href="#l100.104"></a><span id="l100.104"> }</span>
<a href="#l100.105"></a><span id="l100.105"> </span>
<a href="#l100.106"></a><span id="l100.106"> NS_IMETHODIMP</span>
<a href="#l100.107"></a><span id="l100.107"> nsMsgSendLater::OnItemPropertyFlagChanged(nsIMsgDBHdr *aItem, nsIAtom *aProperty,</span>
<a href="#l100.108"></a><span id="l100.108">                                           uint32_t aOldValue, uint32_t aNewValue)</span>
<a href="#l100.109"></a><span id="l100.109"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l101.1"></a><span id="l101.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.h</span>
<a href="#l101.2"></a><span id="l101.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.h</span>
<a href="#l101.3"></a><span id="l101.3" class="difflineat">@@ -77,18 +77,18 @@ public:</span>
<a href="#l101.4"></a><span id="l101.4">                                             uint32_t aTotalMessage,</span>
<a href="#l101.5"></a><span id="l101.5">                                             nsIMsgIdentity *aIdentity);</span>
<a href="#l101.6"></a><span id="l101.6">   void NotifyListenersOnProgress(uint32_t aCurrentMessage,</span>
<a href="#l101.7"></a><span id="l101.7">                                  uint32_t aTotalMessage,</span>
<a href="#l101.8"></a><span id="l101.8">                                  uint32_t aSendPercent,</span>
<a href="#l101.9"></a><span id="l101.9">                                  uint32_t aCopyPercent);</span>
<a href="#l101.10"></a><span id="l101.10">   void NotifyListenersOnMessageSendError(uint32_t aCurrentMessage,</span>
<a href="#l101.11"></a><span id="l101.11">                                          nsresult aStatus,</span>
<a href="#l101.12"></a><span id="l101.12" class="difflineminus">-                                         const PRUnichar *aMsg);</span>
<a href="#l101.13"></a><span id="l101.13" class="difflineminus">-  void EndSendMessages(nsresult aStatus, const PRUnichar *aMsg, </span>
<a href="#l101.14"></a><span id="l101.14" class="difflineplus">+                                         const char16_t *aMsg);</span>
<a href="#l101.15"></a><span id="l101.15" class="difflineplus">+  void EndSendMessages(nsresult aStatus, const char16_t *aMsg, </span>
<a href="#l101.16"></a><span id="l101.16">                        uint32_t aTotalTried, uint32_t aSuccessful);</span>
<a href="#l101.17"></a><span id="l101.17"> </span>
<a href="#l101.18"></a><span id="l101.18">   bool OnSendStepFinished(nsresult aStatus);</span>
<a href="#l101.19"></a><span id="l101.19">   void OnCopyStepFinished(nsresult aStatus);</span>
<a href="#l101.20"></a><span id="l101.20"> </span>
<a href="#l101.21"></a><span id="l101.21">   // counters and things for enumeration </span>
<a href="#l101.22"></a><span id="l101.22">   uint32_t                  mTotalSentSuccessfully;</span>
<a href="#l101.23"></a><span id="l101.23">   uint32_t                  mTotalSendCount;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l102.1"></a><span id="l102.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendReport.cpp</span>
<a href="#l102.2"></a><span id="l102.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendReport.cpp</span>
<a href="#l102.3"></a><span id="l102.3" class="difflineat">@@ -48,23 +48,23 @@ NS_IMETHODIMP nsMsgProcessReport::GetErr</span>
<a href="#l102.4"></a><span id="l102.4"> }</span>
<a href="#l102.5"></a><span id="l102.5"> NS_IMETHODIMP nsMsgProcessReport::SetError(nsresult aError)</span>
<a href="#l102.6"></a><span id="l102.6"> {</span>
<a href="#l102.7"></a><span id="l102.7">   mError = aError;</span>
<a href="#l102.8"></a><span id="l102.8">   return NS_OK;</span>
<a href="#l102.9"></a><span id="l102.9"> }</span>
<a href="#l102.10"></a><span id="l102.10"> </span>
<a href="#l102.11"></a><span id="l102.11"> /* attribute wstring message; */</span>
<a href="#l102.12"></a><span id="l102.12" class="difflineminus">-NS_IMETHODIMP nsMsgProcessReport::GetMessage(PRUnichar * *aMessage)</span>
<a href="#l102.13"></a><span id="l102.13" class="difflineplus">+NS_IMETHODIMP nsMsgProcessReport::GetMessage(char16_t * *aMessage)</span>
<a href="#l102.14"></a><span id="l102.14"> {</span>
<a href="#l102.15"></a><span id="l102.15">   NS_ENSURE_ARG_POINTER(aMessage);</span>
<a href="#l102.16"></a><span id="l102.16">   *aMessage = ToNewUnicode(mMessage);</span>
<a href="#l102.17"></a><span id="l102.17">   return NS_OK;</span>
<a href="#l102.18"></a><span id="l102.18"> }</span>
<a href="#l102.19"></a><span id="l102.19" class="difflineminus">-NS_IMETHODIMP nsMsgProcessReport::SetMessage(const PRUnichar * aMessage)</span>
<a href="#l102.20"></a><span id="l102.20" class="difflineplus">+NS_IMETHODIMP nsMsgProcessReport::SetMessage(const char16_t * aMessage)</span>
<a href="#l102.21"></a><span id="l102.21"> {</span>
<a href="#l102.22"></a><span id="l102.22">   mMessage = aMessage;</span>
<a href="#l102.23"></a><span id="l102.23">   return NS_OK;</span>
<a href="#l102.24"></a><span id="l102.24"> }</span>
<a href="#l102.25"></a><span id="l102.25"> </span>
<a href="#l102.26"></a><span id="l102.26"> /* void Reset (); */</span>
<a href="#l102.27"></a><span id="l102.27"> NS_IMETHODIMP nsMsgProcessReport::Reset()</span>
<a href="#l102.28"></a><span id="l102.28"> {</span>
<a href="#l102.29"></a><span id="l102.29" class="difflineat">@@ -178,17 +178,17 @@ NS_IMETHODIMP nsMsgSendReport::SetError(</span>
<a href="#l102.30"></a><span id="l102.30">   mProcessReport[process]-&gt;GetError(&amp;currError);</span>
<a href="#l102.31"></a><span id="l102.31">   if (overwriteError || NS_SUCCEEDED(currError))</span>
<a href="#l102.32"></a><span id="l102.32">     return mProcessReport[process]-&gt;SetError(newError);</span>
<a href="#l102.33"></a><span id="l102.33">   else</span>
<a href="#l102.34"></a><span id="l102.34">     return NS_OK;</span>
<a href="#l102.35"></a><span id="l102.35"> }</span>
<a href="#l102.36"></a><span id="l102.36"> </span>
<a href="#l102.37"></a><span id="l102.37"> /* void setMessage (in long process, in wstring message, in boolean overwriteMessage); */</span>
<a href="#l102.38"></a><span id="l102.38" class="difflineminus">-NS_IMETHODIMP nsMsgSendReport::SetMessage(int32_t process, const PRUnichar *message, bool overwriteMessage)</span>
<a href="#l102.39"></a><span id="l102.39" class="difflineplus">+NS_IMETHODIMP nsMsgSendReport::SetMessage(int32_t process, const char16_t *message, bool overwriteMessage)</span>
<a href="#l102.40"></a><span id="l102.40"> {</span>
<a href="#l102.41"></a><span id="l102.41">   if (process &lt; process_Current || process &gt; SEND_LAST_PROCESS)</span>
<a href="#l102.42"></a><span id="l102.42">     return NS_ERROR_ILLEGAL_VALUE;</span>
<a href="#l102.43"></a><span id="l102.43"> </span>
<a href="#l102.44"></a><span id="l102.44">   if (process == process_Current)</span>
<a href="#l102.45"></a><span id="l102.45">   {</span>
<a href="#l102.46"></a><span id="l102.46">     if (mCurrentProcess == process_Current)</span>
<a href="#l102.47"></a><span id="l102.47">       // We don't know what we're currently trying to do</span>
<a href="#l102.48"></a><span id="l102.48" class="difflineat">@@ -343,17 +343,17 @@ NS_IMETHODIMP nsMsgSendReport::DisplayRe</span>
<a href="#l102.49"></a><span id="l102.49">     }</span>
<a href="#l102.50"></a><span id="l102.50"> </span>
<a href="#l102.51"></a><span id="l102.51">     if (!currMessage.IsEmpty())</span>
<a href="#l102.52"></a><span id="l102.52">     {</span>
<a href="#l102.53"></a><span id="l102.53">       //Don't need to repeat ourself!</span>
<a href="#l102.54"></a><span id="l102.54">       if (!currMessage.Equals(dialogMessage))</span>
<a href="#l102.55"></a><span id="l102.55">       {</span>
<a href="#l102.56"></a><span id="l102.56">         if (!dialogMessage.IsEmpty())</span>
<a href="#l102.57"></a><span id="l102.57" class="difflineminus">-          dialogMessage.Append(PRUnichar('\n'));</span>
<a href="#l102.58"></a><span id="l102.58" class="difflineplus">+          dialogMessage.Append(char16_t('\n'));</span>
<a href="#l102.59"></a><span id="l102.59">         dialogMessage.Append(currMessage);</span>
<a href="#l102.60"></a><span id="l102.60">       }</span>
<a href="#l102.61"></a><span id="l102.61">     }</span>
<a href="#l102.62"></a><span id="l102.62"> </span>
<a href="#l102.63"></a><span id="l102.63">     if (askToGoBackToCompose)</span>
<a href="#l102.64"></a><span id="l102.64">     {</span>
<a href="#l102.65"></a><span id="l102.65">       bool oopsGiveMeBackTheComposeWindow = true;</span>
<a href="#l102.66"></a><span id="l102.66">       nsString text1;</span>
<a href="#l102.67"></a><span id="l102.67" class="difflineat">@@ -407,17 +407,17 @@ NS_IMETHODIMP nsMsgSendReport::DisplayRe</span>
<a href="#l102.68"></a><span id="l102.68">     {</span>
<a href="#l102.69"></a><span id="l102.69">       //we don't have an error description but we can put a generic explanation</span>
<a href="#l102.70"></a><span id="l102.70">       bundle-&gt;GetStringFromID(NS_MSG_GENERIC_FAILURE_EXPLANATION, getter_Copies(currMessage));</span>
<a href="#l102.71"></a><span id="l102.71">     }</span>
<a href="#l102.72"></a><span id="l102.72"> </span>
<a href="#l102.73"></a><span id="l102.73">     if (!currMessage.IsEmpty())</span>
<a href="#l102.74"></a><span id="l102.74">     {</span>
<a href="#l102.75"></a><span id="l102.75">       if (!dialogMessage.IsEmpty())</span>
<a href="#l102.76"></a><span id="l102.76" class="difflineminus">-        dialogMessage.Append(PRUnichar('\n'));</span>
<a href="#l102.77"></a><span id="l102.77" class="difflineplus">+        dialogMessage.Append(char16_t('\n'));</span>
<a href="#l102.78"></a><span id="l102.78">       dialogMessage.Append(currMessage);</span>
<a href="#l102.79"></a><span id="l102.79">     }</span>
<a href="#l102.80"></a><span id="l102.80">     nsMsgDisplayMessageByString(prompt, dialogMessage.get(), dialogTitle.get());</span>
<a href="#l102.81"></a><span id="l102.81">   }</span>
<a href="#l102.82"></a><span id="l102.82"> </span>
<a href="#l102.83"></a><span id="l102.83">   mAlreadyDisplayReport = true;</span>
<a href="#l102.84"></a><span id="l102.84">   return NS_OK;</span>
<a href="#l102.85"></a><span id="l102.85"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l103.1"></a><span id="l103.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l103.2"></a><span id="l103.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l103.3"></a><span id="l103.3" class="difflineat">@@ -78,17 +78,17 @@ nsresult nsExplainErrorDetails(nsISmtpUr</span>
<a href="#l103.4"></a><span id="l103.4">   NS_ENSURE_ARG(aSmtpUrl);</span>
<a href="#l103.5"></a><span id="l103.5"> </span>
<a href="#l103.6"></a><span id="l103.6">   va_list args;</span>
<a href="#l103.7"></a><span id="l103.7"> </span>
<a href="#l103.8"></a><span id="l103.8">   nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l103.9"></a><span id="l103.9">   aSmtpUrl-&gt;GetPrompt(getter_AddRefs(dialog));</span>
<a href="#l103.10"></a><span id="l103.10">   NS_ENSURE_TRUE(dialog, NS_ERROR_FAILURE);</span>
<a href="#l103.11"></a><span id="l103.11"> </span>
<a href="#l103.12"></a><span id="l103.12" class="difflineminus">-  PRUnichar *  msg;</span>
<a href="#l103.13"></a><span id="l103.13" class="difflineplus">+  char16_t *  msg;</span>
<a href="#l103.14"></a><span id="l103.14">   nsString eMsg;</span>
<a href="#l103.15"></a><span id="l103.15">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l103.16"></a><span id="l103.16">     mozilla::services::GetStringBundleService();</span>
<a href="#l103.17"></a><span id="l103.17">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l103.18"></a><span id="l103.18">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l103.19"></a><span id="l103.19">   nsresult rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l103.20"></a><span id="l103.20">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l103.21"></a><span id="l103.21"> </span>
<a href="#l103.22"></a><span id="l103.22" class="difflineat">@@ -442,17 +442,17 @@ void nsSmtpProtocol::UpdateStatus(int32_</span>
<a href="#l103.23"></a><span id="l103.23">     nsresult rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l103.24"></a><span id="l103.24">     if (NS_FAILED(rv)) return;</span>
<a href="#l103.25"></a><span id="l103.25">     nsString msg;</span>
<a href="#l103.26"></a><span id="l103.26">     bundle-&gt;GetStringFromID(aStatusID, getter_Copies(msg));</span>
<a href="#l103.27"></a><span id="l103.27">     UpdateStatusWithString(msg.get());</span>
<a href="#l103.28"></a><span id="l103.28">   }</span>
<a href="#l103.29"></a><span id="l103.29"> }</span>
<a href="#l103.30"></a><span id="l103.30"> </span>
<a href="#l103.31"></a><span id="l103.31" class="difflineminus">-void nsSmtpProtocol::UpdateStatusWithString(const PRUnichar * aStatusString)</span>
<a href="#l103.32"></a><span id="l103.32" class="difflineplus">+void nsSmtpProtocol::UpdateStatusWithString(const char16_t * aStatusString)</span>
<a href="#l103.33"></a><span id="l103.33"> {</span>
<a href="#l103.34"></a><span id="l103.34">   if (m_statusFeedback &amp;&amp; aStatusString)</span>
<a href="#l103.35"></a><span id="l103.35">     m_statusFeedback-&gt;ShowStatusString(nsDependentString(aStatusString));</span>
<a href="#l103.36"></a><span id="l103.36"> }</span>
<a href="#l103.37"></a><span id="l103.37"> </span>
<a href="#l103.38"></a><span id="l103.38"> /////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l103.39"></a><span id="l103.39"> // Begin protocol state machine functions...</span>
<a href="#l103.40"></a><span id="l103.40"> //////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l103.41"></a><span id="l103.41" class="difflineat">@@ -2014,33 +2014,33 @@ nsSmtpProtocol::GetPassword(nsCString &amp;a</span>
<a href="#l103.42"></a><span id="l103.42"> </span>
<a href="#l103.43"></a><span id="l103.43">     nsCString hostname;</span>
<a href="#l103.44"></a><span id="l103.44">     rv = smtpServer-&gt;GetHostname(hostname);</span>
<a href="#l103.45"></a><span id="l103.45">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l103.46"></a><span id="l103.46"> </span>
<a href="#l103.47"></a><span id="l103.47">     nsAutoString hostnameUTF16;</span>
<a href="#l103.48"></a><span id="l103.48">     CopyASCIItoUTF16(hostname, hostnameUTF16);</span>
<a href="#l103.49"></a><span id="l103.49"> </span>
<a href="#l103.50"></a><span id="l103.50" class="difflineminus">-    const PRUnichar *formatStrings[] =</span>
<a href="#l103.51"></a><span id="l103.51" class="difflineplus">+    const char16_t *formatStrings[] =</span>
<a href="#l103.52"></a><span id="l103.52">     {</span>
<a href="#l103.53"></a><span id="l103.53">       hostnameUTF16.get(),</span>
<a href="#l103.54"></a><span id="l103.54">       usernameUTF16.get()</span>
<a href="#l103.55"></a><span id="l103.55">     };</span>
<a href="#l103.56"></a><span id="l103.56"> </span>
<a href="#l103.57"></a><span id="l103.57">     rv = PromptForPassword(smtpServer, smtpUrl, formatStrings, aPassword);</span>
<a href="#l103.58"></a><span id="l103.58">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l103.59"></a><span id="l103.59">     return rv;</span>
<a href="#l103.60"></a><span id="l103.60"> }</span>
<a href="#l103.61"></a><span id="l103.61"> </span>
<a href="#l103.62"></a><span id="l103.62"> /**</span>
<a href="#l103.63"></a><span id="l103.63">  * formatStrings is an array for the prompts, item 0 is the hostname, item 1</span>
<a href="#l103.64"></a><span id="l103.64">  * is the username.</span>
<a href="#l103.65"></a><span id="l103.65">  */</span>
<a href="#l103.66"></a><span id="l103.66"> nsresult</span>
<a href="#l103.67"></a><span id="l103.67" class="difflineminus">-nsSmtpProtocol::PromptForPassword(nsISmtpServer *aSmtpServer, nsISmtpUrl *aSmtpUrl, const PRUnichar **formatStrings, nsACString &amp;aPassword)</span>
<a href="#l103.68"></a><span id="l103.68" class="difflineplus">+nsSmtpProtocol::PromptForPassword(nsISmtpServer *aSmtpServer, nsISmtpUrl *aSmtpUrl, const char16_t **formatStrings, nsACString &amp;aPassword)</span>
<a href="#l103.69"></a><span id="l103.69"> {</span>
<a href="#l103.70"></a><span id="l103.70">   nsCOMPtr&lt;nsIStringBundleService&gt; stringService =</span>
<a href="#l103.71"></a><span id="l103.71">     mozilla::services::GetStringBundleService();</span>
<a href="#l103.72"></a><span id="l103.72">   NS_ENSURE_TRUE(stringService, NS_ERROR_UNEXPECTED);</span>
<a href="#l103.73"></a><span id="l103.73"> </span>
<a href="#l103.74"></a><span id="l103.74">   nsCOMPtr&lt;nsIStringBundle&gt; composeStringBundle;</span>
<a href="#l103.75"></a><span id="l103.75">   nsresult rv = stringService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(composeStringBundle));</span>
<a href="#l103.76"></a><span id="l103.76">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l103.77"></a><span id="l103.77" class="difflineat">@@ -2098,17 +2098,17 @@ nsSmtpProtocol::GetUsernamePassword(nsAC</span>
<a href="#l103.78"></a><span id="l103.78">     // empty password</span>
<a href="#l103.79"></a><span id="l103.79"> </span>
<a href="#l103.80"></a><span id="l103.80">     aPassword.Truncate();</span>
<a href="#l103.81"></a><span id="l103.81"> </span>
<a href="#l103.82"></a><span id="l103.82">     nsCString hostname;</span>
<a href="#l103.83"></a><span id="l103.83">     rv = smtpServer-&gt;GetHostname(hostname);</span>
<a href="#l103.84"></a><span id="l103.84">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l103.85"></a><span id="l103.85"> </span>
<a href="#l103.86"></a><span id="l103.86" class="difflineminus">-    const PRUnichar *formatStrings[] =</span>
<a href="#l103.87"></a><span id="l103.87" class="difflineplus">+    const char16_t *formatStrings[] =</span>
<a href="#l103.88"></a><span id="l103.88">     {</span>
<a href="#l103.89"></a><span id="l103.89">       NS_ConvertASCIItoUTF16(hostname).get(),</span>
<a href="#l103.90"></a><span id="l103.90">       nullptr</span>
<a href="#l103.91"></a><span id="l103.91">     };</span>
<a href="#l103.92"></a><span id="l103.92"> </span>
<a href="#l103.93"></a><span id="l103.93">     rv = PromptForPassword(smtpServer, smtpUrl, formatStrings, aPassword);</span>
<a href="#l103.94"></a><span id="l103.94">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l103.95"></a><span id="l103.95">     return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l104.1"></a><span id="l104.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.h</span>
<a href="#l104.2"></a><span id="l104.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.h</span>
<a href="#l104.3"></a><span id="l104.3" class="difflineat">@@ -145,17 +145,17 @@ private:</span>
<a href="#l104.4"></a><span id="l104.4">     virtual nsresult ProcessProtocolState(nsIURI * url, nsIInputStream * inputStream, </span>
<a href="#l104.5"></a><span id="l104.5">                                           uint64_t sourceOffset, uint32_t length) MOZ_OVERRIDE;</span>
<a href="#l104.6"></a><span id="l104.6"> </span>
<a href="#l104.7"></a><span id="l104.7">     ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l104.8"></a><span id="l104.8">     // Communication methods --&gt; Reading and writing protocol</span>
<a href="#l104.9"></a><span id="l104.9">     ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l104.10"></a><span id="l104.10"> </span>
<a href="#l104.11"></a><span id="l104.11">     void UpdateStatus(int32_t aStatusID);</span>
<a href="#l104.12"></a><span id="l104.12" class="difflineminus">-    void UpdateStatusWithString(const PRUnichar * aStatusString);</span>
<a href="#l104.13"></a><span id="l104.13" class="difflineplus">+    void UpdateStatusWithString(const char16_t * aStatusString);</span>
<a href="#l104.14"></a><span id="l104.14"> </span>
<a href="#l104.15"></a><span id="l104.15">     ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l104.16"></a><span id="l104.16">     // Protocol Methods --&gt; This protocol is state driven so each protocol method is </span>
<a href="#l104.17"></a><span id="l104.17">     //						designed to re-act to the current &quot;state&quot;. I've attempted to </span>
<a href="#l104.18"></a><span id="l104.18">     //						group them together based on functionality. </span>
<a href="#l104.19"></a><span id="l104.19">     ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l104.20"></a><span id="l104.20"> </span>
<a href="#l104.21"></a><span id="l104.21">     nsresult SmtpResponse(nsIInputStream * inputStream, uint32_t length); </span>
<a href="#l104.22"></a><span id="l104.22" class="difflineat">@@ -186,17 +186,17 @@ private:</span>
<a href="#l104.23"></a><span id="l104.23">     ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l104.24"></a><span id="l104.24"> </span>
<a href="#l104.25"></a><span id="l104.25">     void SendMessageInFile();</span>
<a href="#l104.26"></a><span id="l104.26"> </span>
<a href="#l104.27"></a><span id="l104.27">     void AppendHelloArgument(nsACString&amp; aResult);</span>
<a href="#l104.28"></a><span id="l104.28">     nsresult GetPassword(nsCString &amp;aPassword);</span>
<a href="#l104.29"></a><span id="l104.29">     nsresult GetUsernamePassword(nsACString &amp;aUsername, nsACString &amp;aPassword);</span>
<a href="#l104.30"></a><span id="l104.30">     nsresult PromptForPassword(nsISmtpServer *aSmtpServer, nsISmtpUrl *aSmtpUrl, </span>
<a href="#l104.31"></a><span id="l104.31" class="difflineminus">-                               const PRUnichar **formatStrings, </span>
<a href="#l104.32"></a><span id="l104.32" class="difflineplus">+                               const char16_t **formatStrings, </span>
<a href="#l104.33"></a><span id="l104.33">                                nsACString &amp;aPassword);</span>
<a href="#l104.34"></a><span id="l104.34"> </span>
<a href="#l104.35"></a><span id="l104.35">     void    InitPrefAuthMethods(int32_t authMethodPrefValue);</span>
<a href="#l104.36"></a><span id="l104.36">     nsresult ChooseAuthMethod();</span>
<a href="#l104.37"></a><span id="l104.37">     void    MarkAuthMethodAsFailed(int32_t failedAuthMethod);</span>
<a href="#l104.38"></a><span id="l104.38">     void    ResetAuthMethods();</span>
<a href="#l104.39"></a><span id="l104.39"> </span>
<a href="#l104.40"></a><span id="l104.40">     virtual const char* GetType() MOZ_OVERRIDE {return &quot;smtp&quot;;}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l105.1"></a><span id="l105.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l105.2"></a><span id="l105.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l105.3"></a><span id="l105.3" class="difflineat">@@ -411,18 +411,18 @@ nsSmtpServer::GetPasswordWithoutUI()</span>
<a href="#l105.4"></a><span id="l105.4">       }</span>
<a href="#l105.5"></a><span id="l105.5">     }</span>
<a href="#l105.6"></a><span id="l105.6">   }</span>
<a href="#l105.7"></a><span id="l105.7">   NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(numLogins, logins);</span>
<a href="#l105.8"></a><span id="l105.8">   return NS_OK;</span>
<a href="#l105.9"></a><span id="l105.9"> }</span>
<a href="#l105.10"></a><span id="l105.10"> </span>
<a href="#l105.11"></a><span id="l105.11"> NS_IMETHODIMP</span>
<a href="#l105.12"></a><span id="l105.12" class="difflineminus">-nsSmtpServer::GetPasswordWithUI(const PRUnichar *aPromptMessage,</span>
<a href="#l105.13"></a><span id="l105.13" class="difflineminus">-                                const PRUnichar *aPromptTitle,</span>
<a href="#l105.14"></a><span id="l105.14" class="difflineplus">+nsSmtpServer::GetPasswordWithUI(const char16_t *aPromptMessage,</span>
<a href="#l105.15"></a><span id="l105.15" class="difflineplus">+                                const char16_t *aPromptTitle,</span>
<a href="#l105.16"></a><span id="l105.16">                                 nsIAuthPrompt* aDialog,</span>
<a href="#l105.17"></a><span id="l105.17">                                 nsACString &amp;aPassword)</span>
<a href="#l105.18"></a><span id="l105.18"> {</span>
<a href="#l105.19"></a><span id="l105.19">   if (!m_password.IsEmpty())</span>
<a href="#l105.20"></a><span id="l105.20">     return GetPassword(aPassword);</span>
<a href="#l105.21"></a><span id="l105.21"> </span>
<a href="#l105.22"></a><span id="l105.22">   // We need to get a password, but see if we can get it from the password</span>
<a href="#l105.23"></a><span id="l105.23">   // manager without requiring a prompt.</span>
<a href="#l105.24"></a><span id="l105.24" class="difflineat">@@ -464,18 +464,18 @@ nsSmtpServer::GetPasswordWithUI(const PR</span>
<a href="#l105.25"></a><span id="l105.25">   rv = SetPassword(password);</span>
<a href="#l105.26"></a><span id="l105.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l105.27"></a><span id="l105.27"> </span>
<a href="#l105.28"></a><span id="l105.28">   aPassword = password;</span>
<a href="#l105.29"></a><span id="l105.29">   return NS_OK;</span>
<a href="#l105.30"></a><span id="l105.30"> }</span>
<a href="#l105.31"></a><span id="l105.31"> </span>
<a href="#l105.32"></a><span id="l105.32"> NS_IMETHODIMP</span>
<a href="#l105.33"></a><span id="l105.33" class="difflineminus">-nsSmtpServer::GetUsernamePasswordWithUI(const PRUnichar * aPromptMessage, const</span>
<a href="#l105.34"></a><span id="l105.34" class="difflineminus">-                                PRUnichar *aPromptTitle,</span>
<a href="#l105.35"></a><span id="l105.35" class="difflineplus">+nsSmtpServer::GetUsernamePasswordWithUI(const char16_t * aPromptMessage, const</span>
<a href="#l105.36"></a><span id="l105.36" class="difflineplus">+                                char16_t *aPromptTitle,</span>
<a href="#l105.37"></a><span id="l105.37">                                 nsIAuthPrompt* aDialog,</span>
<a href="#l105.38"></a><span id="l105.38">                                 nsACString &amp;aUsername,</span>
<a href="#l105.39"></a><span id="l105.39">                                 nsACString &amp;aPassword)</span>
<a href="#l105.40"></a><span id="l105.40"> {</span>
<a href="#l105.41"></a><span id="l105.41">   nsresult rv;</span>
<a href="#l105.42"></a><span id="l105.42">   if (!m_password.IsEmpty())</span>
<a href="#l105.43"></a><span id="l105.43">   {</span>
<a href="#l105.44"></a><span id="l105.44">     rv = GetUsername(aUsername);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l106.1"></a><span id="l106.1" class="difflineminus">--- a/mailnews/compose/src/nsURLFetcher.cpp</span>
<a href="#l106.2"></a><span id="l106.2" class="difflineplus">+++ b/mailnews/compose/src/nsURLFetcher.cpp</span>
<a href="#l106.3"></a><span id="l106.3" class="difflineat">@@ -378,17 +378,17 @@ nsURLFetcher::OnLocationChange(nsIWebPro</span>
<a href="#l106.4"></a><span id="l106.4">   NS_NOTREACHED(&quot;notification excluded in AddProgressListener(...)&quot;);</span>
<a href="#l106.5"></a><span id="l106.5">   return NS_OK;</span>
<a href="#l106.6"></a><span id="l106.6"> }</span>
<a href="#l106.7"></a><span id="l106.7"> </span>
<a href="#l106.8"></a><span id="l106.8"> NS_IMETHODIMP </span>
<a href="#l106.9"></a><span id="l106.9"> nsURLFetcher::OnStatusChange(nsIWebProgress* aWebProgress,</span>
<a href="#l106.10"></a><span id="l106.10">                              nsIRequest* aRequest,</span>
<a href="#l106.11"></a><span id="l106.11">                              nsresult aStatus,</span>
<a href="#l106.12"></a><span id="l106.12" class="difflineminus">-                             const PRUnichar* aMessage)</span>
<a href="#l106.13"></a><span id="l106.13" class="difflineplus">+                             const char16_t* aMessage)</span>
<a href="#l106.14"></a><span id="l106.14"> {</span>
<a href="#l106.15"></a><span id="l106.15">   NS_NOTREACHED(&quot;notification excluded in AddProgressListener(...)&quot;);</span>
<a href="#l106.16"></a><span id="l106.16">   return NS_OK;</span>
<a href="#l106.17"></a><span id="l106.17"> }</span>
<a href="#l106.18"></a><span id="l106.18"> </span>
<a href="#l106.19"></a><span id="l106.19"> NS_IMETHODIMP </span>
<a href="#l106.20"></a><span id="l106.20"> nsURLFetcher::OnSecurityChange(nsIWebProgress *aWebProgress, </span>
<a href="#l106.21"></a><span id="l106.21">                                nsIRequest *aRequest, </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l107.1"></a><span id="l107.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l107.2"></a><span id="l107.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l107.3"></a><span id="l107.3" class="difflineat">@@ -58,17 +58,17 @@ public:</span>
<a href="#l107.4"></a><span id="l107.4">   NS_DECL_NSIOBSERVER</span>
<a href="#l107.5"></a><span id="l107.5"> </span>
<a href="#l107.6"></a><span id="l107.6">   nsFolderCharsetObserver() { }</span>
<a href="#l107.7"></a><span id="l107.7">   virtual ~nsFolderCharsetObserver() {}</span>
<a href="#l107.8"></a><span id="l107.8"> };</span>
<a href="#l107.9"></a><span id="l107.9"> </span>
<a href="#l107.10"></a><span id="l107.10"> NS_IMPL_ISUPPORTS1(nsFolderCharsetObserver, nsIObserver)</span>
<a href="#l107.11"></a><span id="l107.11"> </span>
<a href="#l107.12"></a><span id="l107.12" class="difflineminus">-NS_IMETHODIMP nsFolderCharsetObserver::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData)</span>
<a href="#l107.13"></a><span id="l107.13" class="difflineplus">+NS_IMETHODIMP nsFolderCharsetObserver::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *someData)</span>
<a href="#l107.14"></a><span id="l107.14"> {</span>
<a href="#l107.15"></a><span id="l107.15">   nsresult rv;</span>
<a href="#l107.16"></a><span id="l107.16"> </span>
<a href="#l107.17"></a><span id="l107.17">   nsCOMPtr&lt;nsIPrefService&gt; prefs = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l107.18"></a><span id="l107.18">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l107.19"></a><span id="l107.19"> </span>
<a href="#l107.20"></a><span id="l107.20">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch;</span>
<a href="#l107.21"></a><span id="l107.21">   rv = prefs-&gt;GetBranch(nullptr, getter_AddRefs(prefBranch));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l108.1"></a><span id="l108.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l108.2"></a><span id="l108.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l108.3"></a><span id="l108.3" class="difflineat">@@ -689,17 +689,17 @@ enum char_class{</span>
<a href="#l108.4"></a><span id="l108.4">     kanji,</span>
<a href="#l108.5"></a><span id="l108.5">     kuten,</span>
<a href="#l108.6"></a><span id="l108.6">     touten,</span>
<a href="#l108.7"></a><span id="l108.7">     kigou,</span>
<a href="#l108.8"></a><span id="l108.8">     fwlatain,</span>
<a href="#l108.9"></a><span id="l108.9">     ascii</span>
<a href="#l108.10"></a><span id="l108.10"> };</span>
<a href="#l108.11"></a><span id="l108.11"> </span>
<a href="#l108.12"></a><span id="l108.12" class="difflineminus">-static char_class getCharClass(PRUnichar c)</span>
<a href="#l108.13"></a><span id="l108.13" class="difflineplus">+static char_class getCharClass(char16_t c)</span>
<a href="#l108.14"></a><span id="l108.14"> {</span>
<a href="#l108.15"></a><span id="l108.15">   char_class charClass = others;</span>
<a href="#l108.16"></a><span id="l108.16"> </span>
<a href="#l108.17"></a><span id="l108.17">   if(IS_JA_HIRAGANA(c))</span>
<a href="#l108.18"></a><span id="l108.18">     charClass = hiragana;</span>
<a href="#l108.19"></a><span id="l108.19">   else if(IS_JA_KATAKANA(c))</span>
<a href="#l108.20"></a><span id="l108.20">     charClass = katakana;</span>
<a href="#l108.21"></a><span id="l108.21">   else if(IS_JA_KANJI(c))</span>
<a href="#l108.22"></a><span id="l108.22" class="difflineat">@@ -712,44 +712,44 @@ static char_class getCharClass(PRUnichar</span>
<a href="#l108.23"></a><span id="l108.23">     charClass = fwlatain;</span>
<a href="#l108.24"></a><span id="l108.24"> </span>
<a href="#l108.25"></a><span id="l108.25">   return charClass;</span>
<a href="#l108.26"></a><span id="l108.26"> }</span>
<a href="#l108.27"></a><span id="l108.27"> </span>
<a href="#l108.28"></a><span id="l108.28"> static bool isJapanese(const char* word)</span>
<a href="#l108.29"></a><span id="l108.29"> {</span>
<a href="#l108.30"></a><span id="l108.30">   nsString text = NS_ConvertUTF8toUTF16(word);</span>
<a href="#l108.31"></a><span id="l108.31" class="difflineminus">-  PRUnichar* p = (PRUnichar*)text.get();</span>
<a href="#l108.32"></a><span id="l108.32" class="difflineminus">-  PRUnichar c;</span>
<a href="#l108.33"></a><span id="l108.33" class="difflineplus">+  char16_t* p = (char16_t*)text.get();</span>
<a href="#l108.34"></a><span id="l108.34" class="difflineplus">+  char16_t c;</span>
<a href="#l108.35"></a><span id="l108.35"> </span>
<a href="#l108.36"></a><span id="l108.36">   // it is japanese chunk if it contains any hiragana or katakana.</span>
<a href="#l108.37"></a><span id="l108.37">   while((c = *p++))</span>
<a href="#l108.38"></a><span id="l108.38">     if( IS_JAPANESE_SPECIFIC(c))</span>
<a href="#l108.39"></a><span id="l108.39">       return true;</span>
<a href="#l108.40"></a><span id="l108.40"> </span>
<a href="#l108.41"></a><span id="l108.41">   return false;</span>
<a href="#l108.42"></a><span id="l108.42"> }</span>
<a href="#l108.43"></a><span id="l108.43"> </span>
<a href="#l108.44"></a><span id="l108.44" class="difflineminus">-static bool isFWNumeral(const PRUnichar* p1, const PRUnichar* p2)</span>
<a href="#l108.45"></a><span id="l108.45" class="difflineplus">+static bool isFWNumeral(const char16_t* p1, const char16_t* p2)</span>
<a href="#l108.46"></a><span id="l108.46"> {</span>
<a href="#l108.47"></a><span id="l108.47">   for(;p1&lt;p2;p1++)</span>
<a href="#l108.48"></a><span id="l108.48">     if(!IS_JA_FWNUMERAL(*p1))</span>
<a href="#l108.49"></a><span id="l108.49">       return false;</span>
<a href="#l108.50"></a><span id="l108.50"> </span>
<a href="#l108.51"></a><span id="l108.51">   return true;</span>
<a href="#l108.52"></a><span id="l108.52"> }</span>
<a href="#l108.53"></a><span id="l108.53"> </span>
<a href="#l108.54"></a><span id="l108.54"> // The japanese tokenizer was added as part of Bug #277354</span>
<a href="#l108.55"></a><span id="l108.55"> void Tokenizer::tokenize_japanese_word(char* chunk)</span>
<a href="#l108.56"></a><span id="l108.56"> {</span>
<a href="#l108.57"></a><span id="l108.57">   PR_LOG(BayesianFilterLogModule, PR_LOG_DEBUG, (&quot;entering tokenize_japanese_word(%s)&quot;, chunk));</span>
<a href="#l108.58"></a><span id="l108.58"> </span>
<a href="#l108.59"></a><span id="l108.59">   nsString srcStr = NS_ConvertUTF8toUTF16(chunk);</span>
<a href="#l108.60"></a><span id="l108.60" class="difflineminus">-  const PRUnichar* p1 = srcStr.get();</span>
<a href="#l108.61"></a><span id="l108.61" class="difflineminus">-  const PRUnichar* p2 = p1;</span>
<a href="#l108.62"></a><span id="l108.62" class="difflineplus">+  const char16_t* p1 = srcStr.get();</span>
<a href="#l108.63"></a><span id="l108.63" class="difflineplus">+  const char16_t* p2 = p1;</span>
<a href="#l108.64"></a><span id="l108.64">   if(!*p2) return;</span>
<a href="#l108.65"></a><span id="l108.65"> </span>
<a href="#l108.66"></a><span id="l108.66">   char_class cc = getCharClass(*p2);</span>
<a href="#l108.67"></a><span id="l108.67">   while(*(++p2))</span>
<a href="#l108.68"></a><span id="l108.68">   {</span>
<a href="#l108.69"></a><span id="l108.69">     if(cc == getCharClass(*p2))</span>
<a href="#l108.70"></a><span id="l108.70">       continue;</span>
<a href="#l108.71"></a><span id="l108.71"> </span>
<a href="#l108.72"></a><span id="l108.72" class="difflineat">@@ -801,18 +801,18 @@ void Tokenizer::tokenize(const char* aTe</span>
<a href="#l108.73"></a><span id="l108.73">                         NS_LITERAL_STRING(&quot;&lt;div&quot;));</span>
<a href="#l108.74"></a><span id="l108.74">     MsgReplaceSubstring(text, NS_LITERAL_STRING(&quot;/iframe&gt;&quot;),</span>
<a href="#l108.75"></a><span id="l108.75">                         NS_LITERAL_STRING(&quot;/div&gt;&quot;));</span>
<a href="#l108.76"></a><span id="l108.76">   }</span>
<a href="#l108.77"></a><span id="l108.77"> </span>
<a href="#l108.78"></a><span id="l108.78">   stripHTML(text, strippedUCS2);</span>
<a href="#l108.79"></a><span id="l108.79"> </span>
<a href="#l108.80"></a><span id="l108.80">   // convert 0x3000(full width space) into 0x0020</span>
<a href="#l108.81"></a><span id="l108.81" class="difflineminus">-  PRUnichar * substr_start = strippedUCS2.BeginWriting();</span>
<a href="#l108.82"></a><span id="l108.82" class="difflineminus">-  PRUnichar * substr_end = strippedUCS2.EndWriting();</span>
<a href="#l108.83"></a><span id="l108.83" class="difflineplus">+  char16_t * substr_start = strippedUCS2.BeginWriting();</span>
<a href="#l108.84"></a><span id="l108.84" class="difflineplus">+  char16_t * substr_end = strippedUCS2.EndWriting();</span>
<a href="#l108.85"></a><span id="l108.85">   while (substr_start != substr_end) {</span>
<a href="#l108.86"></a><span id="l108.86">     if (*substr_start == 0x3000)</span>
<a href="#l108.87"></a><span id="l108.87">         *substr_start = 0x0020;</span>
<a href="#l108.88"></a><span id="l108.88">     ++substr_start;</span>
<a href="#l108.89"></a><span id="l108.89">   }</span>
<a href="#l108.90"></a><span id="l108.90"> </span>
<a href="#l108.91"></a><span id="l108.91">   nsCString strippedStr = NS_ConvertUTF16toUTF8(strippedUCS2);</span>
<a href="#l108.92"></a><span id="l108.92">   char * strippedText = strippedStr.BeginWriting();</span>
<a href="#l108.93"></a><span id="l108.93" class="difflineat">@@ -837,17 +837,17 @@ void Tokenizer::tokenize(const char* aTe</span>
<a href="#l108.94"></a><span id="l108.94">                 return;</span>
<a href="#l108.95"></a><span id="l108.95">             }</span>
<a href="#l108.96"></a><span id="l108.96">         }</span>
<a href="#l108.97"></a><span id="l108.97">         if (mScanner) {</span>
<a href="#l108.98"></a><span id="l108.98">             mScanner-&gt;Start(&quot;UTF-8&quot;);</span>
<a href="#l108.99"></a><span id="l108.99">             // convert this word from UTF-8 into UCS2.</span>
<a href="#l108.100"></a><span id="l108.100">             NS_ConvertUTF8toUTF16 uword(word);</span>
<a href="#l108.101"></a><span id="l108.101">             ToLowerCase(uword);</span>
<a href="#l108.102"></a><span id="l108.102" class="difflineminus">-            const PRUnichar* utext = uword.get();</span>
<a href="#l108.103"></a><span id="l108.103" class="difflineplus">+            const char16_t* utext = uword.get();</span>
<a href="#l108.104"></a><span id="l108.104">             int32_t len = uword.Length(), pos = 0, begin, end;</span>
<a href="#l108.105"></a><span id="l108.105">             bool gotUnit;</span>
<a href="#l108.106"></a><span id="l108.106">             while (pos &lt; len) {</span>
<a href="#l108.107"></a><span id="l108.107">                 rv = mScanner-&gt;Next(utext, len, pos, true, &amp;begin, &amp;end, &amp;gotUnit);</span>
<a href="#l108.108"></a><span id="l108.108">                 if (NS_SUCCEEDED(rv) &amp;&amp; gotUnit) {</span>
<a href="#l108.109"></a><span id="l108.109">                     NS_ConvertUTF16toUTF8 utfUnit(utext + begin, end - begin);</span>
<a href="#l108.110"></a><span id="l108.110">                     add(utfUnit.get());</span>
<a href="#l108.111"></a><span id="l108.111">                     // advance to end of current unit.</span>
<a href="#l108.112"></a><span id="l108.112" class="difflineat">@@ -988,17 +988,17 @@ TokenStreamListener::~TokenStreamListene</span>
<a href="#l108.113"></a><span id="l108.113"> NS_IMPL_ISUPPORTS3(TokenStreamListener, nsIRequestObserver, nsIStreamListener, nsIMsgHeaderSink)</span>
<a href="#l108.114"></a><span id="l108.114"> </span>
<a href="#l108.115"></a><span id="l108.115"> NS_IMETHODIMP TokenStreamListener::ProcessHeaders(nsIUTF8StringEnumerator *aHeaderNames, nsIUTF8StringEnumerator *aHeaderValues, bool dontCollectAddress)</span>
<a href="#l108.116"></a><span id="l108.116"> {</span>
<a href="#l108.117"></a><span id="l108.117">     mTokenizer.tokenizeHeaders(aHeaderNames, aHeaderValues);</span>
<a href="#l108.118"></a><span id="l108.118">     return NS_OK;</span>
<a href="#l108.119"></a><span id="l108.119"> }</span>
<a href="#l108.120"></a><span id="l108.120"> </span>
<a href="#l108.121"></a><span id="l108.121" class="difflineminus">-NS_IMETHODIMP TokenStreamListener::HandleAttachment(const char *contentType, const char *url, const PRUnichar *displayName, const char *uri, bool aIsExternalAttachment)</span>
<a href="#l108.122"></a><span id="l108.122" class="difflineplus">+NS_IMETHODIMP TokenStreamListener::HandleAttachment(const char *contentType, const char *url, const char16_t *displayName, const char *uri, bool aIsExternalAttachment)</span>
<a href="#l108.123"></a><span id="l108.123"> {</span>
<a href="#l108.124"></a><span id="l108.124">     mTokenizer.tokenizeAttachment(contentType, NS_ConvertUTF16toUTF8(displayName).get());</span>
<a href="#l108.125"></a><span id="l108.125">     return NS_OK;</span>
<a href="#l108.126"></a><span id="l108.126"> }</span>
<a href="#l108.127"></a><span id="l108.127"> </span>
<a href="#l108.128"></a><span id="l108.128"> NS_IMETHODIMP TokenStreamListener::AddAttachmentField(const char *field, const char *value)</span>
<a href="#l108.129"></a><span id="l108.129"> {</span>
<a href="#l108.130"></a><span id="l108.130">     return NS_OK;</span>
<a href="#l108.131"></a><span id="l108.131" class="difflineat">@@ -1686,17 +1686,17 @@ void nsBayesianFilter::classifyMessage(</span>
<a href="#l108.132"></a><span id="l108.132">       else</span>
<a href="#l108.133"></a><span id="l108.133">           prob = 0.5;</span>
<a href="#l108.134"></a><span id="l108.134"> </span>
<a href="#l108.135"></a><span id="l108.135">       if (aDetailListener)</span>
<a href="#l108.136"></a><span id="l108.136">       {</span>
<a href="#l108.137"></a><span id="l108.137">         // Prepare output arrays</span>
<a href="#l108.138"></a><span id="l108.138">         nsTArray&lt;uint32_t&gt; tokenPercents(usedTokenCount);</span>
<a href="#l108.139"></a><span id="l108.139">         nsTArray&lt;uint32_t&gt; runningPercents(usedTokenCount);</span>
<a href="#l108.140"></a><span id="l108.140" class="difflineminus">-        nsTArray&lt;PRUnichar*&gt; tokenStrings(usedTokenCount);</span>
<a href="#l108.141"></a><span id="l108.141" class="difflineplus">+        nsTArray&lt;char16_t*&gt; tokenStrings(usedTokenCount);</span>
<a href="#l108.142"></a><span id="l108.142"> </span>
<a href="#l108.143"></a><span id="l108.143">         double clueCount = 1.0;</span>
<a href="#l108.144"></a><span id="l108.144">         for (uint32_t tokenIndex = 0; tokenIndex &lt; usedTokenCount; tokenIndex++)</span>
<a href="#l108.145"></a><span id="l108.145">         {</span>
<a href="#l108.146"></a><span id="l108.146">           TraitAnalysis&amp; ta = traitAnalyses[last - 1 - tokenIndex];</span>
<a href="#l108.147"></a><span id="l108.147">           double S, H;</span>
<a href="#l108.148"></a><span id="l108.148">           int32_t chi_error;</span>
<a href="#l108.149"></a><span id="l108.149">           S = chi2P(-2.0 * sArray[tokenIndex], 2.0 * clueCount, &amp;chi_error);</span>
<a href="#l108.150"></a><span id="l108.150" class="difflineat">@@ -1712,17 +1712,17 @@ void nsBayesianFilter::classifyMessage(</span>
<a href="#l108.151"></a><span id="l108.151">               100. + .5));</span>
<a href="#l108.152"></a><span id="l108.152">           tokenPercents.AppendElement(static_cast&lt;uint32_t&gt;(ta.mProbability *</span>
<a href="#l108.153"></a><span id="l108.153">               100. + .5));</span>
<a href="#l108.154"></a><span id="l108.154">           tokenStrings.AppendElement(ToNewUnicode(NS_ConvertUTF8toUTF16(</span>
<a href="#l108.155"></a><span id="l108.155">               tokens[ta.mTokenIndex].mWord)));</span>
<a href="#l108.156"></a><span id="l108.156">         }</span>
<a href="#l108.157"></a><span id="l108.157"> </span>
<a href="#l108.158"></a><span id="l108.158">         aDetailListener-&gt;OnMessageTraitDetails(messageURI, aProTraits[traitIndex],</span>
<a href="#l108.159"></a><span id="l108.159" class="difflineminus">-            usedTokenCount, (const PRUnichar**)tokenStrings.Elements(),</span>
<a href="#l108.160"></a><span id="l108.160" class="difflineplus">+            usedTokenCount, (const char16_t**)tokenStrings.Elements(),</span>
<a href="#l108.161"></a><span id="l108.161">             tokenPercents.Elements(), runningPercents.Elements());</span>
<a href="#l108.162"></a><span id="l108.162">         for (uint32_t tokenIndex = 0; tokenIndex &lt; usedTokenCount; tokenIndex++)</span>
<a href="#l108.163"></a><span id="l108.163">           NS_Free(tokenStrings[tokenIndex]);</span>
<a href="#l108.164"></a><span id="l108.164">       }</span>
<a href="#l108.165"></a><span id="l108.165"> </span>
<a href="#l108.166"></a><span id="l108.166">       uint32_t proPercent = static_cast&lt;uint32_t&gt;(prob*100. + .5);</span>
<a href="#l108.167"></a><span id="l108.167"> </span>
<a href="#l108.168"></a><span id="l108.168">       // directly classify junk to maintain backwards compatibility</span>
<a href="#l108.169"></a><span id="l108.169" class="difflineat">@@ -1792,17 +1792,17 @@ void nsBayesianFilter::classifyMessage(</span>
<a href="#l108.170"></a><span id="l108.170">   proTraits.AppendElement(kJunkTrait);</span>
<a href="#l108.171"></a><span id="l108.171">   antiTraits.AppendElement(kGoodTrait);</span>
<a href="#l108.172"></a><span id="l108.172">   classifyMessage(tokens, messageURI, proTraits, antiTraits,</span>
<a href="#l108.173"></a><span id="l108.173">     aJunkListener, nullptr, nullptr);</span>
<a href="#l108.174"></a><span id="l108.174"> }</span>
<a href="#l108.175"></a><span id="l108.175"> </span>
<a href="#l108.176"></a><span id="l108.176"> NS_IMETHODIMP</span>
<a href="#l108.177"></a><span id="l108.177"> nsBayesianFilter::Observe(nsISupports *aSubject, const char *aTopic,</span>
<a href="#l108.178"></a><span id="l108.178" class="difflineminus">-                          const PRUnichar *someData)</span>
<a href="#l108.179"></a><span id="l108.179" class="difflineplus">+                          const char16_t *someData)</span>
<a href="#l108.180"></a><span id="l108.180"> {</span>
<a href="#l108.181"></a><span id="l108.181">   if (!strcmp(aTopic, &quot;profile-before-change&quot;))</span>
<a href="#l108.182"></a><span id="l108.182">     Shutdown();</span>
<a href="#l108.183"></a><span id="l108.183">   return NS_OK;</span>
<a href="#l108.184"></a><span id="l108.184"> }</span>
<a href="#l108.185"></a><span id="l108.185"> </span>
<a href="#l108.186"></a><span id="l108.186"> /* void shutdown (); */</span>
<a href="#l108.187"></a><span id="l108.187"> NS_IMETHODIMP nsBayesianFilter::Shutdown()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l109.1"></a><span id="l109.1" class="difflineminus">--- a/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</span>
<a href="#l109.2"></a><span id="l109.2" class="difflineplus">+++ b/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</span>
<a href="#l109.3"></a><span id="l109.3" class="difflineat">@@ -33,31 +33,31 @@ NS_IMPL_RELEASE(nsMsgMailView)</span>
<a href="#l109.4"></a><span id="l109.4"> NS_IMPL_QUERY_INTERFACE1(nsMsgMailView, nsIMsgMailView)</span>
<a href="#l109.5"></a><span id="l109.5"> </span>
<a href="#l109.6"></a><span id="l109.6"> nsMsgMailView::~nsMsgMailView()</span>
<a href="#l109.7"></a><span id="l109.7"> {</span>
<a href="#l109.8"></a><span id="l109.8">     if (mViewSearchTerms)</span>
<a href="#l109.9"></a><span id="l109.9">         mViewSearchTerms-&gt;Clear();</span>
<a href="#l109.10"></a><span id="l109.10"> }</span>
<a href="#l109.11"></a><span id="l109.11"> </span>
<a href="#l109.12"></a><span id="l109.12" class="difflineminus">-NS_IMETHODIMP nsMsgMailView::GetMailViewName(PRUnichar ** aMailViewName)</span>
<a href="#l109.13"></a><span id="l109.13" class="difflineplus">+NS_IMETHODIMP nsMsgMailView::GetMailViewName(char16_t ** aMailViewName)</span>
<a href="#l109.14"></a><span id="l109.14"> {</span>
<a href="#l109.15"></a><span id="l109.15">     NS_ENSURE_ARG_POINTER(aMailViewName);</span>
<a href="#l109.16"></a><span id="l109.16"> </span>
<a href="#l109.17"></a><span id="l109.17">     *aMailViewName = ToNewUnicode(mName);</span>
<a href="#l109.18"></a><span id="l109.18">     return NS_OK;</span>
<a href="#l109.19"></a><span id="l109.19"> }</span>
<a href="#l109.20"></a><span id="l109.20"> </span>
<a href="#l109.21"></a><span id="l109.21" class="difflineminus">-NS_IMETHODIMP nsMsgMailView::SetMailViewName(const PRUnichar * aMailViewName)</span>
<a href="#l109.22"></a><span id="l109.22" class="difflineplus">+NS_IMETHODIMP nsMsgMailView::SetMailViewName(const char16_t * aMailViewName)</span>
<a href="#l109.23"></a><span id="l109.23"> {</span>
<a href="#l109.24"></a><span id="l109.24">     mName = aMailViewName;</span>
<a href="#l109.25"></a><span id="l109.25">     return NS_OK;</span>
<a href="#l109.26"></a><span id="l109.26"> }</span>
<a href="#l109.27"></a><span id="l109.27"> </span>
<a href="#l109.28"></a><span id="l109.28" class="difflineminus">-NS_IMETHODIMP nsMsgMailView::GetPrettyName(PRUnichar ** aMailViewName)</span>
<a href="#l109.29"></a><span id="l109.29" class="difflineplus">+NS_IMETHODIMP nsMsgMailView::GetPrettyName(char16_t ** aMailViewName)</span>
<a href="#l109.30"></a><span id="l109.30"> {</span>
<a href="#l109.31"></a><span id="l109.31">     NS_ENSURE_ARG_POINTER(aMailViewName);</span>
<a href="#l109.32"></a><span id="l109.32"> </span>
<a href="#l109.33"></a><span id="l109.33">     nsresult rv = NS_OK;</span>
<a href="#l109.34"></a><span id="l109.34">     if (!mBundle)</span>
<a href="#l109.35"></a><span id="l109.35">     {</span>
<a href="#l109.36"></a><span id="l109.36">         nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l109.37"></a><span id="l109.37">           mozilla::services::GetStringBundleService();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l110.1"></a><span id="l110.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l110.2"></a><span id="l110.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l110.3"></a><span id="l110.3" class="difflineat">@@ -93,40 +93,40 @@ nsMsgMdnGenerator::nsMsgMdnGenerator()</span>
<a href="#l110.4"></a><span id="l110.4">     m_outsideDomainOp = eNeverSendOp;</span>
<a href="#l110.5"></a><span id="l110.5">     m_otherOp = eNeverSendOp;</span>
<a href="#l110.6"></a><span id="l110.6"> }</span>
<a href="#l110.7"></a><span id="l110.7"> </span>
<a href="#l110.8"></a><span id="l110.8"> nsMsgMdnGenerator::~nsMsgMdnGenerator()</span>
<a href="#l110.9"></a><span id="l110.9"> {</span>
<a href="#l110.10"></a><span id="l110.10"> }</span>
<a href="#l110.11"></a><span id="l110.11"> </span>
<a href="#l110.12"></a><span id="l110.12" class="difflineminus">-nsresult nsMsgMdnGenerator::FormatStringFromName(const PRUnichar *aName,</span>
<a href="#l110.13"></a><span id="l110.13" class="difflineminus">-                                                 const PRUnichar *aString,</span>
<a href="#l110.14"></a><span id="l110.14" class="difflineminus">-                                                 PRUnichar **aResultString)</span>
<a href="#l110.15"></a><span id="l110.15" class="difflineplus">+nsresult nsMsgMdnGenerator::FormatStringFromName(const char16_t *aName,</span>
<a href="#l110.16"></a><span id="l110.16" class="difflineplus">+                                                 const char16_t *aString,</span>
<a href="#l110.17"></a><span id="l110.17" class="difflineplus">+                                                 char16_t **aResultString)</span>
<a href="#l110.18"></a><span id="l110.18"> {</span>
<a href="#l110.19"></a><span id="l110.19">     DEBUG_MDN(&quot;nsMsgMdnGenerator::FormatStringFromName&quot;);</span>
<a href="#l110.20"></a><span id="l110.20"> </span>
<a href="#l110.21"></a><span id="l110.21">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l110.22"></a><span id="l110.22">       mozilla::services::GetStringBundleService();</span>
<a href="#l110.23"></a><span id="l110.23">     NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l110.24"></a><span id="l110.24"> </span>
<a href="#l110.25"></a><span id="l110.25">     nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l110.26"></a><span id="l110.26">     nsresult rv = bundleService-&gt;CreateBundle(MDN_STRINGBUNDLE_URL,</span>
<a href="#l110.27"></a><span id="l110.27">                                               getter_AddRefs(bundle));</span>
<a href="#l110.28"></a><span id="l110.28">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l110.29"></a><span id="l110.29"> </span>
<a href="#l110.30"></a><span id="l110.30" class="difflineminus">-    const PRUnichar *formatStrings[1] = { aString };</span>
<a href="#l110.31"></a><span id="l110.31" class="difflineplus">+    const char16_t *formatStrings[1] = { aString };</span>
<a href="#l110.32"></a><span id="l110.32">     rv = bundle-&gt;FormatStringFromName(aName,</span>
<a href="#l110.33"></a><span id="l110.33">                     formatStrings, 1, aResultString);</span>
<a href="#l110.34"></a><span id="l110.34">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l110.35"></a><span id="l110.35">     return rv;</span>
<a href="#l110.36"></a><span id="l110.36"> }</span>
<a href="#l110.37"></a><span id="l110.37"> </span>
<a href="#l110.38"></a><span id="l110.38" class="difflineminus">-nsresult nsMsgMdnGenerator::GetStringFromName(const PRUnichar *aName,</span>
<a href="#l110.39"></a><span id="l110.39" class="difflineminus">-                                               PRUnichar **aResultString)</span>
<a href="#l110.40"></a><span id="l110.40" class="difflineplus">+nsresult nsMsgMdnGenerator::GetStringFromName(const char16_t *aName,</span>
<a href="#l110.41"></a><span id="l110.41" class="difflineplus">+                                               char16_t **aResultString)</span>
<a href="#l110.42"></a><span id="l110.42"> {</span>
<a href="#l110.43"></a><span id="l110.43">     DEBUG_MDN(&quot;nsMsgMdnGenerator::GetStringFromName&quot;);</span>
<a href="#l110.44"></a><span id="l110.44"> </span>
<a href="#l110.45"></a><span id="l110.45">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l110.46"></a><span id="l110.46">       mozilla::services::GetStringBundleService();</span>
<a href="#l110.47"></a><span id="l110.47">     NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l110.48"></a><span id="l110.48"> </span>
<a href="#l110.49"></a><span id="l110.49">     nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l110.50"></a><span id="l110.50" class="difflineat">@@ -1109,17 +1109,17 @@ NS_IMETHODIMP nsMsgMdnGenerator::OnStopR</span>
<a href="#l110.51"></a><span id="l110.51">     nsCString smtpHostName;</span>
<a href="#l110.52"></a><span id="l110.52">     nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l110.53"></a><span id="l110.53">     rv = smtpService-&gt;GetServerByIdentity(m_identity, getter_AddRefs(smtpServer));</span>
<a href="#l110.54"></a><span id="l110.54">     if (NS_SUCCEEDED(rv)) </span>
<a href="#l110.55"></a><span id="l110.55">       smtpServer-&gt;GetHostname(smtpHostName);</span>
<a href="#l110.56"></a><span id="l110.56">      </span>
<a href="#l110.57"></a><span id="l110.57">     nsAutoString hostStr;</span>
<a href="#l110.58"></a><span id="l110.58">     CopyASCIItoUTF16(smtpHostName, hostStr);</span>
<a href="#l110.59"></a><span id="l110.59" class="difflineminus">-    const PRUnichar *params[] = { hostStr.get() };</span>
<a href="#l110.60"></a><span id="l110.60" class="difflineplus">+    const char16_t *params[] = { hostStr.get() };</span>
<a href="#l110.61"></a><span id="l110.61"> </span>
<a href="#l110.62"></a><span id="l110.62">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l110.63"></a><span id="l110.63">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l110.64"></a><span id="l110.64">       mozilla::services::GetStringBundleService();</span>
<a href="#l110.65"></a><span id="l110.65">     NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l110.66"></a><span id="l110.66"> </span>
<a href="#l110.67"></a><span id="l110.67">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l110.68"></a><span id="l110.68">     NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l111.1"></a><span id="l111.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h</span>
<a href="#l111.2"></a><span id="l111.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h</span>
<a href="#l111.3"></a><span id="l111.3" class="difflineat">@@ -46,20 +46,20 @@ private:</span>
<a href="#l111.4"></a><span id="l111.4"> </span>
<a href="#l111.5"></a><span id="l111.5">   nsresult CreateMdnMsg();</span>
<a href="#l111.6"></a><span id="l111.6">   nsresult CreateFirstPart();</span>
<a href="#l111.7"></a><span id="l111.7">   nsresult CreateSecondPart();</span>
<a href="#l111.8"></a><span id="l111.8">   nsresult CreateThirdPart();</span>
<a href="#l111.9"></a><span id="l111.9">   nsresult SendMdnMsg();</span>
<a href="#l111.10"></a><span id="l111.10"> </span>
<a href="#l111.11"></a><span id="l111.11">   // string bundle helper methods</span>
<a href="#l111.12"></a><span id="l111.12" class="difflineminus">-  nsresult GetStringFromName(const PRUnichar *aName, PRUnichar **aResultString);</span>
<a href="#l111.13"></a><span id="l111.13" class="difflineminus">-  nsresult FormatStringFromName(const PRUnichar *aName,</span>
<a href="#l111.14"></a><span id="l111.14" class="difflineminus">-                                const PRUnichar *aString,</span>
<a href="#l111.15"></a><span id="l111.15" class="difflineminus">-                                PRUnichar **aResultString);</span>
<a href="#l111.16"></a><span id="l111.16" class="difflineplus">+  nsresult GetStringFromName(const char16_t *aName, char16_t **aResultString);</span>
<a href="#l111.17"></a><span id="l111.17" class="difflineplus">+  nsresult FormatStringFromName(const char16_t *aName,</span>
<a href="#l111.18"></a><span id="l111.18" class="difflineplus">+                                const char16_t *aString,</span>
<a href="#l111.19"></a><span id="l111.19" class="difflineplus">+                                char16_t **aResultString);</span>
<a href="#l111.20"></a><span id="l111.20"> </span>
<a href="#l111.21"></a><span id="l111.21">   // other helper methods</span>
<a href="#l111.22"></a><span id="l111.22">   nsresult InitAndProcess(bool *needToAskUser);</span>
<a href="#l111.23"></a><span id="l111.23">   nsresult OutputAllHeaders();</span>
<a href="#l111.24"></a><span id="l111.24">   nsresult WriteString(const char *str);</span>
<a href="#l111.25"></a><span id="l111.25"> </span>
<a href="#l111.26"></a><span id="l111.26"> private:</span>
<a href="#l111.27"></a><span id="l111.27">   EDisposeType m_disposeType;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l112.1"></a><span id="l112.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l112.2"></a><span id="l112.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l112.3"></a><span id="l112.3" class="difflineat">@@ -165,34 +165,34 @@ NS_IMETHODIMP nsMsgComposeSecure::Requir</span>
<a href="#l112.4"></a><span id="l112.4"> </span>
<a href="#l112.5"></a><span id="l112.5">   if (alwaysEncryptMessages || signMessage)</span>
<a href="#l112.6"></a><span id="l112.6">     *aRequiresEncryptionWork = true;</span>
<a href="#l112.7"></a><span id="l112.7"> </span>
<a href="#l112.8"></a><span id="l112.8">   return NS_OK;</span>
<a href="#l112.9"></a><span id="l112.9"> }</span>
<a href="#l112.10"></a><span id="l112.10"> </span>
<a href="#l112.11"></a><span id="l112.11"> </span>
<a href="#l112.12"></a><span id="l112.12" class="difflineminus">-nsresult nsMsgComposeSecure::GetSMIMEBundleString(const PRUnichar *name,</span>
<a href="#l112.13"></a><span id="l112.13" class="difflineminus">-                                                  PRUnichar **outString)</span>
<a href="#l112.14"></a><span id="l112.14" class="difflineplus">+nsresult nsMsgComposeSecure::GetSMIMEBundleString(const char16_t *name,</span>
<a href="#l112.15"></a><span id="l112.15" class="difflineplus">+                                                  char16_t **outString)</span>
<a href="#l112.16"></a><span id="l112.16"> {</span>
<a href="#l112.17"></a><span id="l112.17">   *outString = nullptr;</span>
<a href="#l112.18"></a><span id="l112.18"> </span>
<a href="#l112.19"></a><span id="l112.19">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l112.20"></a><span id="l112.20"> </span>
<a href="#l112.21"></a><span id="l112.21">   NS_ENSURE_TRUE(InitializeSMIMEBundle(), NS_ERROR_FAILURE);</span>
<a href="#l112.22"></a><span id="l112.22"> </span>
<a href="#l112.23"></a><span id="l112.23">   return mSMIMEBundle-&gt;GetStringFromName(name, outString);</span>
<a href="#l112.24"></a><span id="l112.24"> }</span>
<a href="#l112.25"></a><span id="l112.25"> </span>
<a href="#l112.26"></a><span id="l112.26"> nsresult</span>
<a href="#l112.27"></a><span id="l112.27"> nsMsgComposeSecure::</span>
<a href="#l112.28"></a><span id="l112.28" class="difflineminus">-SMIMEBundleFormatStringFromName(const PRUnichar *name,</span>
<a href="#l112.29"></a><span id="l112.29" class="difflineminus">-                                const PRUnichar **params,</span>
<a href="#l112.30"></a><span id="l112.30" class="difflineplus">+SMIMEBundleFormatStringFromName(const char16_t *name,</span>
<a href="#l112.31"></a><span id="l112.31" class="difflineplus">+                                const char16_t **params,</span>
<a href="#l112.32"></a><span id="l112.32">                                 uint32_t numParams,</span>
<a href="#l112.33"></a><span id="l112.33" class="difflineminus">-                                PRUnichar **outString)</span>
<a href="#l112.34"></a><span id="l112.34" class="difflineplus">+                                char16_t **outString)</span>
<a href="#l112.35"></a><span id="l112.35"> {</span>
<a href="#l112.36"></a><span id="l112.36">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l112.37"></a><span id="l112.37"> </span>
<a href="#l112.38"></a><span id="l112.38">   if (!InitializeSMIMEBundle())</span>
<a href="#l112.39"></a><span id="l112.39">     return NS_ERROR_FAILURE;</span>
<a href="#l112.40"></a><span id="l112.40"> </span>
<a href="#l112.41"></a><span id="l112.41">   return mSMIMEBundle-&gt;FormatStringFromName(name, params,</span>
<a href="#l112.42"></a><span id="l112.42">                                             numParams, outString);</span>
<a href="#l112.43"></a><span id="l112.43" class="difflineat">@@ -207,17 +207,17 @@ bool nsMsgComposeSecure::InitializeSMIME</span>
<a href="#l112.44"></a><span id="l112.44">     mozilla::services::GetStringBundleService();</span>
<a href="#l112.45"></a><span id="l112.45">   nsresult rv = bundleService-&gt;CreateBundle(SMIME_STRBUNDLE_URL,</span>
<a href="#l112.46"></a><span id="l112.46">                                             getter_AddRefs(mSMIMEBundle));</span>
<a href="#l112.47"></a><span id="l112.47">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l112.48"></a><span id="l112.48"> </span>
<a href="#l112.49"></a><span id="l112.49">   return true;</span>
<a href="#l112.50"></a><span id="l112.50"> }</span>
<a href="#l112.51"></a><span id="l112.51"> </span>
<a href="#l112.52"></a><span id="l112.52" class="difflineminus">-void nsMsgComposeSecure::SetError(nsIMsgSendReport *sendReport, const PRUnichar *bundle_string)</span>
<a href="#l112.53"></a><span id="l112.53" class="difflineplus">+void nsMsgComposeSecure::SetError(nsIMsgSendReport *sendReport, const char16_t *bundle_string)</span>
<a href="#l112.54"></a><span id="l112.54"> {</span>
<a href="#l112.55"></a><span id="l112.55">   if (!sendReport || !bundle_string)</span>
<a href="#l112.56"></a><span id="l112.56">     return;</span>
<a href="#l112.57"></a><span id="l112.57"> </span>
<a href="#l112.58"></a><span id="l112.58">   if (mErrorAlreadyReported)</span>
<a href="#l112.59"></a><span id="l112.59">     return;</span>
<a href="#l112.60"></a><span id="l112.60"> </span>
<a href="#l112.61"></a><span id="l112.61">   mErrorAlreadyReported = true;</span>
<a href="#l112.62"></a><span id="l112.62" class="difflineat">@@ -231,29 +231,29 @@ void nsMsgComposeSecure::SetError(nsIMsg</span>
<a href="#l112.63"></a><span id="l112.63">   if (NS_SUCCEEDED(res) &amp;&amp; !errorString.IsEmpty())</span>
<a href="#l112.64"></a><span id="l112.64">   {</span>
<a href="#l112.65"></a><span id="l112.65">     sendReport-&gt;SetMessage(nsIMsgSendReport::process_Current,</span>
<a href="#l112.66"></a><span id="l112.66">                            errorString.get(),</span>
<a href="#l112.67"></a><span id="l112.67">                            true);</span>
<a href="#l112.68"></a><span id="l112.68">   }</span>
<a href="#l112.69"></a><span id="l112.69"> }</span>
<a href="#l112.70"></a><span id="l112.70"> </span>
<a href="#l112.71"></a><span id="l112.71" class="difflineminus">-void nsMsgComposeSecure::SetErrorWithParam(nsIMsgSendReport *sendReport, const PRUnichar *bundle_string, const char *param)</span>
<a href="#l112.72"></a><span id="l112.72" class="difflineplus">+void nsMsgComposeSecure::SetErrorWithParam(nsIMsgSendReport *sendReport, const char16_t *bundle_string, const char *param)</span>
<a href="#l112.73"></a><span id="l112.73"> {</span>
<a href="#l112.74"></a><span id="l112.74">   if (!sendReport || !bundle_string || !param)</span>
<a href="#l112.75"></a><span id="l112.75">     return;</span>
<a href="#l112.76"></a><span id="l112.76"> </span>
<a href="#l112.77"></a><span id="l112.77">   if (mErrorAlreadyReported)</span>
<a href="#l112.78"></a><span id="l112.78">     return;</span>
<a href="#l112.79"></a><span id="l112.79"> </span>
<a href="#l112.80"></a><span id="l112.80">   mErrorAlreadyReported = true;</span>
<a href="#l112.81"></a><span id="l112.81">   </span>
<a href="#l112.82"></a><span id="l112.82">   nsString errorString;</span>
<a href="#l112.83"></a><span id="l112.83">   nsresult res;</span>
<a href="#l112.84"></a><span id="l112.84" class="difflineminus">-  const PRUnichar *params[1];</span>
<a href="#l112.85"></a><span id="l112.85" class="difflineplus">+  const char16_t *params[1];</span>
<a href="#l112.86"></a><span id="l112.86"> </span>
<a href="#l112.87"></a><span id="l112.87">   NS_ConvertASCIItoUTF16 ucs2(param);</span>
<a href="#l112.88"></a><span id="l112.88">   params[0]= ucs2.get();</span>
<a href="#l112.89"></a><span id="l112.89"> </span>
<a href="#l112.90"></a><span id="l112.90">   res = SMIMEBundleFormatStringFromName(bundle_string,</span>
<a href="#l112.91"></a><span id="l112.91">                                         params,</span>
<a href="#l112.92"></a><span id="l112.92">                                         1,</span>
<a href="#l112.93"></a><span id="l112.93">                                         getter_Copies(errorString));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l113.1"></a><span id="l113.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsMsgComposeSecure.h</span>
<a href="#l113.2"></a><span id="l113.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsMsgComposeSecure.h</span>
<a href="#l113.3"></a><span id="l113.3" class="difflineat">@@ -61,22 +61,22 @@ public:</span>
<a href="#l113.4"></a><span id="l113.4"> private:</span>
<a href="#l113.5"></a><span id="l113.5">   typedef mozilla::mailnews::MimeEncoder MimeEncoder;</span>
<a href="#l113.6"></a><span id="l113.6">   nsresult MimeInitMultipartSigned(bool aOuter, nsIMsgSendReport *sendReport);</span>
<a href="#l113.7"></a><span id="l113.7">   nsresult MimeInitEncryption(bool aSign, nsIMsgSendReport *sendReport);</span>
<a href="#l113.8"></a><span id="l113.8">   nsresult MimeFinishMultipartSigned (bool aOuter, nsIMsgSendReport *sendReport);</span>
<a href="#l113.9"></a><span id="l113.9">   nsresult MimeFinishEncryption (bool aSign, nsIMsgSendReport *sendReport);</span>
<a href="#l113.10"></a><span id="l113.10">   nsresult MimeCryptoHackCerts(const char *aRecipients, nsIMsgSendReport *sendReport, bool aEncrypt, bool aSign);</span>
<a href="#l113.11"></a><span id="l113.11">   bool InitializeSMIMEBundle();</span>
<a href="#l113.12"></a><span id="l113.12" class="difflineminus">-  nsresult GetSMIMEBundleString(const PRUnichar *name,</span>
<a href="#l113.13"></a><span id="l113.13" class="difflineminus">-				PRUnichar **outString);</span>
<a href="#l113.14"></a><span id="l113.14" class="difflineminus">-  nsresult SMIMEBundleFormatStringFromName(const PRUnichar *name,</span>
<a href="#l113.15"></a><span id="l113.15" class="difflineminus">-					   const PRUnichar **params,</span>
<a href="#l113.16"></a><span id="l113.16" class="difflineplus">+  nsresult GetSMIMEBundleString(const char16_t *name,</span>
<a href="#l113.17"></a><span id="l113.17" class="difflineplus">+				char16_t **outString);</span>
<a href="#l113.18"></a><span id="l113.18" class="difflineplus">+  nsresult SMIMEBundleFormatStringFromName(const char16_t *name,</span>
<a href="#l113.19"></a><span id="l113.19" class="difflineplus">+					   const char16_t **params,</span>
<a href="#l113.20"></a><span id="l113.20"> 					   uint32_t numParams,</span>
<a href="#l113.21"></a><span id="l113.21" class="difflineminus">-					   PRUnichar **outString);</span>
<a href="#l113.22"></a><span id="l113.22" class="difflineplus">+					   char16_t **outString);</span>
<a href="#l113.23"></a><span id="l113.23">   nsresult ExtractEncryptionState(nsIMsgIdentity * aIdentity, nsIMsgCompFields * aComposeFields, bool * aSignMessage, bool * aEncrypt);</span>
<a href="#l113.24"></a><span id="l113.24"> </span>
<a href="#l113.25"></a><span id="l113.25">   mimeDeliveryCryptoState mCryptoState;</span>
<a href="#l113.26"></a><span id="l113.26">   nsCOMPtr&lt;nsIOutputStream&gt; mStream;</span>
<a href="#l113.27"></a><span id="l113.27">   int16_t mHashType;</span>
<a href="#l113.28"></a><span id="l113.28">   nsCOMPtr&lt;nsICryptoHash&gt; mDataHash;</span>
<a href="#l113.29"></a><span id="l113.29">   nsAutoPtr&lt;MimeEncoder&gt; mSigEncoder;</span>
<a href="#l113.30"></a><span id="l113.30">   char *mMultipartSignedBoundary;</span>
<a href="#l113.31"></a><span id="l113.31" class="difflineat">@@ -92,13 +92,13 @@ private:</span>
<a href="#l113.32"></a><span id="l113.32">   nsAutoPtr&lt;MimeEncoder&gt; mCryptoEncoder;</span>
<a href="#l113.33"></a><span id="l113.33">   bool mIsDraft;</span>
<a href="#l113.34"></a><span id="l113.34"> </span>
<a href="#l113.35"></a><span id="l113.35">   enum {eBufferSize = 8192};</span>
<a href="#l113.36"></a><span id="l113.36">   char *mBuffer;</span>
<a href="#l113.37"></a><span id="l113.37">   uint32_t mBufferedBytes;</span>
<a href="#l113.38"></a><span id="l113.38"> </span>
<a href="#l113.39"></a><span id="l113.39">   bool mErrorAlreadyReported;</span>
<a href="#l113.40"></a><span id="l113.40" class="difflineminus">-  void SetError(nsIMsgSendReport *sendReport, const PRUnichar *bundle_string);</span>
<a href="#l113.41"></a><span id="l113.41" class="difflineminus">-  void SetErrorWithParam(nsIMsgSendReport *sendReport, const PRUnichar *bundle_string, const char *param);</span>
<a href="#l113.42"></a><span id="l113.42" class="difflineplus">+  void SetError(nsIMsgSendReport *sendReport, const char16_t *bundle_string);</span>
<a href="#l113.43"></a><span id="l113.43" class="difflineplus">+  void SetErrorWithParam(nsIMsgSendReport *sendReport, const char16_t *bundle_string, const char *param);</span>
<a href="#l113.44"></a><span id="l113.44"> };</span>
<a href="#l113.45"></a><span id="l113.45"> </span>
<a href="#l113.46"></a><span id="l113.46"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l114.1"></a><span id="l114.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp</span>
<a href="#l114.2"></a><span id="l114.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsSMimeJSHelper.cpp</span>
<a href="#l114.3"></a><span id="l114.3" class="difflineat">@@ -25,20 +25,20 @@ nsSMimeJSHelper::nsSMimeJSHelper()</span>
<a href="#l114.4"></a><span id="l114.4"> </span>
<a href="#l114.5"></a><span id="l114.5"> nsSMimeJSHelper::~nsSMimeJSHelper()</span>
<a href="#l114.6"></a><span id="l114.6"> {</span>
<a href="#l114.7"></a><span id="l114.7"> }</span>
<a href="#l114.8"></a><span id="l114.8"> </span>
<a href="#l114.9"></a><span id="l114.9"> NS_IMETHODIMP nsSMimeJSHelper::GetRecipientCertsInfo(</span>
<a href="#l114.10"></a><span id="l114.10">     nsIMsgCompFields *compFields,</span>
<a href="#l114.11"></a><span id="l114.11">     uint32_t *count,</span>
<a href="#l114.12"></a><span id="l114.12" class="difflineminus">-    PRUnichar ***emailAddresses,</span>
<a href="#l114.13"></a><span id="l114.13" class="difflineplus">+    char16_t ***emailAddresses,</span>
<a href="#l114.14"></a><span id="l114.14">     int32_t **certVerification,</span>
<a href="#l114.15"></a><span id="l114.15" class="difflineminus">-    PRUnichar ***certIssuedInfos,</span>
<a href="#l114.16"></a><span id="l114.16" class="difflineminus">-    PRUnichar ***certExpiresInfos,</span>
<a href="#l114.17"></a><span id="l114.17" class="difflineplus">+    char16_t ***certIssuedInfos,</span>
<a href="#l114.18"></a><span id="l114.18" class="difflineplus">+    char16_t ***certExpiresInfos,</span>
<a href="#l114.19"></a><span id="l114.19">     nsIX509Cert ***certs,</span>
<a href="#l114.20"></a><span id="l114.20">     bool *canEncrypt)</span>
<a href="#l114.21"></a><span id="l114.21"> {</span>
<a href="#l114.22"></a><span id="l114.22">   NS_ENSURE_ARG_POINTER(count);</span>
<a href="#l114.23"></a><span id="l114.23">   *count = 0;</span>
<a href="#l114.24"></a><span id="l114.24"> </span>
<a href="#l114.25"></a><span id="l114.25">   NS_ENSURE_ARG_POINTER(emailAddresses);</span>
<a href="#l114.26"></a><span id="l114.26">   NS_ENSURE_ARG_POINTER(certVerification);</span>
<a href="#l114.27"></a><span id="l114.27" class="difflineat">@@ -58,37 +58,37 @@ NS_IMETHODIMP nsSMimeJSHelper::GetRecipi</span>
<a href="#l114.28"></a><span id="l114.28">   nsCOMPtr&lt;nsIX509CertDB&gt; certdb = do_GetService(NS_X509CERTDB_CONTRACTID);</span>
<a href="#l114.29"></a><span id="l114.29"> </span>
<a href="#l114.30"></a><span id="l114.30">   *count = mailbox_count;</span>
<a href="#l114.31"></a><span id="l114.31">   *canEncrypt = false;</span>
<a href="#l114.32"></a><span id="l114.32">   rv = NS_OK;</span>
<a href="#l114.33"></a><span id="l114.33"> </span>
<a href="#l114.34"></a><span id="l114.34">   if (mailbox_count)</span>
<a href="#l114.35"></a><span id="l114.35">   {</span>
<a href="#l114.36"></a><span id="l114.36" class="difflineminus">-    PRUnichar **outEA = static_cast&lt;PRUnichar **&gt;(nsMemory::Alloc(mailbox_count * sizeof(PRUnichar *)));</span>
<a href="#l114.37"></a><span id="l114.37" class="difflineplus">+    char16_t **outEA = static_cast&lt;char16_t **&gt;(nsMemory::Alloc(mailbox_count * sizeof(char16_t *)));</span>
<a href="#l114.38"></a><span id="l114.38">     int32_t *outCV = static_cast&lt;int32_t *&gt;(nsMemory::Alloc(mailbox_count * sizeof(int32_t)));</span>
<a href="#l114.39"></a><span id="l114.39" class="difflineminus">-    PRUnichar **outCII = static_cast&lt;PRUnichar **&gt;(nsMemory::Alloc(mailbox_count * sizeof(PRUnichar *)));</span>
<a href="#l114.40"></a><span id="l114.40" class="difflineminus">-    PRUnichar **outCEI = static_cast&lt;PRUnichar **&gt;(nsMemory::Alloc(mailbox_count * sizeof(PRUnichar *)));</span>
<a href="#l114.41"></a><span id="l114.41" class="difflineplus">+    char16_t **outCII = static_cast&lt;char16_t **&gt;(nsMemory::Alloc(mailbox_count * sizeof(char16_t *)));</span>
<a href="#l114.42"></a><span id="l114.42" class="difflineplus">+    char16_t **outCEI = static_cast&lt;char16_t **&gt;(nsMemory::Alloc(mailbox_count * sizeof(char16_t *)));</span>
<a href="#l114.43"></a><span id="l114.43">     nsIX509Cert **outCerts = static_cast&lt;nsIX509Cert **&gt;(nsMemory::Alloc(mailbox_count * sizeof(nsIX509Cert *)));</span>
<a href="#l114.44"></a><span id="l114.44"> </span>
<a href="#l114.45"></a><span id="l114.45">     if (!outEA || !outCV || !outCII || !outCEI || !outCerts)</span>
<a href="#l114.46"></a><span id="l114.46">     {</span>
<a href="#l114.47"></a><span id="l114.47">       nsMemory::Free(outEA);</span>
<a href="#l114.48"></a><span id="l114.48">       nsMemory::Free(outCV);</span>
<a href="#l114.49"></a><span id="l114.49">       nsMemory::Free(outCII);</span>
<a href="#l114.50"></a><span id="l114.50">       nsMemory::Free(outCEI);</span>
<a href="#l114.51"></a><span id="l114.51">       nsMemory::Free(outCerts);</span>
<a href="#l114.52"></a><span id="l114.52">       rv = NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l114.53"></a><span id="l114.53">     }</span>
<a href="#l114.54"></a><span id="l114.54">     else</span>
<a href="#l114.55"></a><span id="l114.55">     {</span>
<a href="#l114.56"></a><span id="l114.56" class="difflineminus">-      PRUnichar **iEA = outEA;</span>
<a href="#l114.57"></a><span id="l114.57" class="difflineplus">+      char16_t **iEA = outEA;</span>
<a href="#l114.58"></a><span id="l114.58">       int32_t *iCV = outCV;</span>
<a href="#l114.59"></a><span id="l114.59" class="difflineminus">-      PRUnichar **iCII = outCII;</span>
<a href="#l114.60"></a><span id="l114.60" class="difflineminus">-      PRUnichar **iCEI = outCEI;</span>
<a href="#l114.61"></a><span id="l114.61" class="difflineplus">+      char16_t **iCII = outCII;</span>
<a href="#l114.62"></a><span id="l114.62" class="difflineplus">+      char16_t **iCEI = outCEI;</span>
<a href="#l114.63"></a><span id="l114.63">       nsIX509Cert **iCert = outCerts;</span>
<a href="#l114.64"></a><span id="l114.64"> </span>
<a href="#l114.65"></a><span id="l114.65">       bool found_blocker = false;</span>
<a href="#l114.66"></a><span id="l114.66">       bool memory_failure = false;</span>
<a href="#l114.67"></a><span id="l114.67"> </span>
<a href="#l114.68"></a><span id="l114.68">       for (uint32_t i = 0;</span>
<a href="#l114.69"></a><span id="l114.69">           i &lt; mailbox_count;</span>
<a href="#l114.70"></a><span id="l114.70">           ++i, ++iEA, ++iCV, ++iCII, ++iCEI, ++iCert)</span>
<a href="#l114.71"></a><span id="l114.71" class="difflineat">@@ -174,17 +174,17 @@ NS_IMETHODIMP nsSMimeJSHelper::GetRecipi</span>
<a href="#l114.72"></a><span id="l114.72">     }</span>
<a href="#l114.73"></a><span id="l114.73">   }</span>
<a href="#l114.74"></a><span id="l114.74">   return rv;</span>
<a href="#l114.75"></a><span id="l114.75"> }</span>
<a href="#l114.76"></a><span id="l114.76"> </span>
<a href="#l114.77"></a><span id="l114.77"> NS_IMETHODIMP nsSMimeJSHelper::GetNoCertAddresses(</span>
<a href="#l114.78"></a><span id="l114.78">     nsIMsgCompFields *compFields,</span>
<a href="#l114.79"></a><span id="l114.79">     uint32_t *count,</span>
<a href="#l114.80"></a><span id="l114.80" class="difflineminus">-    PRUnichar ***emailAddresses)</span>
<a href="#l114.81"></a><span id="l114.81" class="difflineplus">+    char16_t ***emailAddresses)</span>
<a href="#l114.82"></a><span id="l114.82"> {</span>
<a href="#l114.83"></a><span id="l114.83">   NS_ENSURE_ARG_POINTER(count);</span>
<a href="#l114.84"></a><span id="l114.84">   *count = 0;</span>
<a href="#l114.85"></a><span id="l114.85"> </span>
<a href="#l114.86"></a><span id="l114.86">   NS_ENSURE_ARG_POINTER(emailAddresses);</span>
<a href="#l114.87"></a><span id="l114.87"> </span>
<a href="#l114.88"></a><span id="l114.88">   NS_ENSURE_ARG_POINTER(compFields);</span>
<a href="#l114.89"></a><span id="l114.89"> </span>
<a href="#l114.90"></a><span id="l114.90" class="difflineat">@@ -230,24 +230,24 @@ NS_IMETHODIMP nsSMimeJSHelper::GetNoCert</span>
<a href="#l114.91"></a><span id="l114.91">         ++missing_count;</span>
<a href="#l114.92"></a><span id="l114.92">     }</span>
<a href="#l114.93"></a><span id="l114.93">   }</span>
<a href="#l114.94"></a><span id="l114.94"> </span>
<a href="#l114.95"></a><span id="l114.95">   *count = missing_count;</span>
<a href="#l114.96"></a><span id="l114.96"> </span>
<a href="#l114.97"></a><span id="l114.97">   if (missing_count)</span>
<a href="#l114.98"></a><span id="l114.98">   {</span>
<a href="#l114.99"></a><span id="l114.99" class="difflineminus">-    PRUnichar **outEA = static_cast&lt;PRUnichar **&gt;(nsMemory::Alloc(missing_count * sizeof(PRUnichar *)));</span>
<a href="#l114.100"></a><span id="l114.100" class="difflineplus">+    char16_t **outEA = static_cast&lt;char16_t **&gt;(nsMemory::Alloc(missing_count * sizeof(char16_t *)));</span>
<a href="#l114.101"></a><span id="l114.101">     if (!outEA )</span>
<a href="#l114.102"></a><span id="l114.102">     {</span>
<a href="#l114.103"></a><span id="l114.103">       rv = NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l114.104"></a><span id="l114.104">     }</span>
<a href="#l114.105"></a><span id="l114.105">     else</span>
<a href="#l114.106"></a><span id="l114.106">     {</span>
<a href="#l114.107"></a><span id="l114.107" class="difflineminus">-      PRUnichar **iEA = outEA;</span>
<a href="#l114.108"></a><span id="l114.108" class="difflineplus">+      char16_t **iEA = outEA;</span>
<a href="#l114.109"></a><span id="l114.109"> </span>
<a href="#l114.110"></a><span id="l114.110">       bool memory_failure = false;</span>
<a href="#l114.111"></a><span id="l114.111"> </span>
<a href="#l114.112"></a><span id="l114.112">       for (uint32_t i = 0; i &lt; mailbox_count; ++i)</span>
<a href="#l114.113"></a><span id="l114.113">       {</span>
<a href="#l114.114"></a><span id="l114.114">         if (!haveCert[i])</span>
<a href="#l114.115"></a><span id="l114.115">         {</span>
<a href="#l114.116"></a><span id="l114.116">           if (memory_failure) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l115.1"></a><span id="l115.1" class="difflineminus">--- a/mailnews/imap/src/nsAutoSyncManager.cpp</span>
<a href="#l115.2"></a><span id="l115.2" class="difflineplus">+++ b/mailnews/imap/src/nsAutoSyncManager.cpp</span>
<a href="#l115.3"></a><span id="l115.3" class="difflineat">@@ -547,17 +547,17 @@ NS_IMETHODIMP nsAutoSyncManager::Pause()</span>
<a href="#l115.4"></a><span id="l115.4"> NS_IMETHODIMP nsAutoSyncManager::Resume()</span>
<a href="#l115.5"></a><span id="l115.5"> {</span>
<a href="#l115.6"></a><span id="l115.6">   mPaused = false;</span>
<a href="#l115.7"></a><span id="l115.7">   StartTimerIfNeeded();</span>
<a href="#l115.8"></a><span id="l115.8">   PR_LOG(gAutoSyncLog, PR_LOG_DEBUG, (&quot;autosync resumed\n&quot;));</span>
<a href="#l115.9"></a><span id="l115.9">   return NS_OK;</span>
<a href="#l115.10"></a><span id="l115.10"> }</span>
<a href="#l115.11"></a><span id="l115.11"> </span>
<a href="#l115.12"></a><span id="l115.12" class="difflineminus">-NS_IMETHODIMP nsAutoSyncManager::Observe(nsISupports*, const char *aTopic, const PRUnichar *aSomeData)</span>
<a href="#l115.13"></a><span id="l115.13" class="difflineplus">+NS_IMETHODIMP nsAutoSyncManager::Observe(nsISupports*, const char *aTopic, const char16_t *aSomeData)</span>
<a href="#l115.14"></a><span id="l115.14"> {</span>
<a href="#l115.15"></a><span id="l115.15">   if (!PL_strcmp(aTopic, NS_XPCOM_SHUTDOWN_OBSERVER_ID))</span>
<a href="#l115.16"></a><span id="l115.16">   {</span>
<a href="#l115.17"></a><span id="l115.17">     nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l115.18"></a><span id="l115.18">       mozilla::services::GetObserverService();</span>
<a href="#l115.19"></a><span id="l115.19">     if (observerService)</span>
<a href="#l115.20"></a><span id="l115.20">     {</span>
<a href="#l115.21"></a><span id="l115.21">       observerService-&gt;RemoveObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l116.1"></a><span id="l116.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l116.2"></a><span id="l116.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l116.3"></a><span id="l116.3" class="difflineat">@@ -82,17 +82,17 @@ nsresult nsIMAPHostSessionList::Init()</span>
<a href="#l116.4"></a><span id="l116.4">     mozilla::services::GetObserverService();</span>
<a href="#l116.5"></a><span id="l116.5">   NS_ENSURE_TRUE(observerService, NS_ERROR_UNEXPECTED);</span>
<a href="#l116.6"></a><span id="l116.6">   observerService-&gt;AddObserver(this, &quot;profile-before-change&quot;, true);</span>
<a href="#l116.7"></a><span id="l116.7">   observerService-&gt;AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID, true);</span>
<a href="#l116.8"></a><span id="l116.8">   return NS_OK;</span>
<a href="#l116.9"></a><span id="l116.9"> }</span>
<a href="#l116.10"></a><span id="l116.10"> </span>
<a href="#l116.11"></a><span id="l116.11"> </span>
<a href="#l116.12"></a><span id="l116.12" class="difflineminus">-NS_IMETHODIMP nsIMAPHostSessionList::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData)</span>
<a href="#l116.13"></a><span id="l116.13" class="difflineplus">+NS_IMETHODIMP nsIMAPHostSessionList::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *someData)</span>
<a href="#l116.14"></a><span id="l116.14"> {</span>
<a href="#l116.15"></a><span id="l116.15">   if (!strcmp(aTopic, &quot;profile-before-change&quot;))</span>
<a href="#l116.16"></a><span id="l116.16">     ResetAll();</span>
<a href="#l116.17"></a><span id="l116.17">   else if (!strcmp(aTopic, NS_XPCOM_SHUTDOWN_OBSERVER_ID))</span>
<a href="#l116.18"></a><span id="l116.18">   {</span>
<a href="#l116.19"></a><span id="l116.19">     nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l116.20"></a><span id="l116.20">       mozilla::services::GetObserverService();</span>
<a href="#l116.21"></a><span id="l116.21">     NS_ENSURE_TRUE(observerService, NS_ERROR_UNEXPECTED);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l117.1"></a><span id="l117.1" class="difflineminus">--- a/mailnews/imap/src/nsImapCore.h</span>
<a href="#l117.2"></a><span id="l117.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapCore.h</span>
<a href="#l117.3"></a><span id="l117.3" class="difflineat">@@ -165,17 +165,17 @@ typedef enum {</span>
<a href="#l117.4"></a><span id="l117.4"> </span>
<a href="#l117.5"></a><span id="l117.5"> typedef struct _utf_name_struct {</span>
<a href="#l117.6"></a><span id="l117.6"> 	bool toUtf7Imap;</span>
<a href="#l117.7"></a><span id="l117.7"> 	unsigned char *sourceString;</span>
<a href="#l117.8"></a><span id="l117.8"> 	unsigned char *convertedString;</span>
<a href="#l117.9"></a><span id="l117.9"> } utf_name_struct;</span>
<a href="#l117.10"></a><span id="l117.10"> </span>
<a href="#l117.11"></a><span id="l117.11"> typedef struct _ProgressInfo {</span>
<a href="#l117.12"></a><span id="l117.12" class="difflineminus">-  PRUnichar *message;</span>
<a href="#l117.13"></a><span id="l117.13" class="difflineplus">+  char16_t *message;</span>
<a href="#l117.14"></a><span id="l117.14">   int32_t currentProgress;</span>
<a href="#l117.15"></a><span id="l117.15">   int32_t maxProgress;</span>
<a href="#l117.16"></a><span id="l117.16"> } ProgressInfo;</span>
<a href="#l117.17"></a><span id="l117.17"> </span>
<a href="#l117.18"></a><span id="l117.18"> typedef enum {</span>
<a href="#l117.19"></a><span id="l117.19">     eContinue,</span>
<a href="#l117.20"></a><span id="l117.20">     eContinueNew,</span>
<a href="#l117.21"></a><span id="l117.21">     eListMyChildren,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l118.1"></a><span id="l118.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l118.2"></a><span id="l118.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l118.3"></a><span id="l118.3" class="difflineat">@@ -1796,17 +1796,17 @@ nsImapIncomingServer::FEAlert(const nsAS</span>
<a href="#l118.4"></a><span id="l118.4">   if (m_stringBundle)</span>
<a href="#l118.5"></a><span id="l118.5">   {</span>
<a href="#l118.6"></a><span id="l118.6">     nsAutoString hostName;</span>
<a href="#l118.7"></a><span id="l118.7">     nsresult rv = GetPrettyName(hostName);</span>
<a href="#l118.8"></a><span id="l118.8">     if (NS_SUCCEEDED(rv))</span>
<a href="#l118.9"></a><span id="l118.9">     {</span>
<a href="#l118.10"></a><span id="l118.10">       nsString message;</span>
<a href="#l118.11"></a><span id="l118.11">       nsString tempString(aAlertString);</span>
<a href="#l118.12"></a><span id="l118.12" class="difflineminus">-      const PRUnichar *params[] = { hostName.get(), tempString.get() };</span>
<a href="#l118.13"></a><span id="l118.13" class="difflineplus">+      const char16_t *params[] = { hostName.get(), tempString.get() };</span>
<a href="#l118.14"></a><span id="l118.14"> </span>
<a href="#l118.15"></a><span id="l118.15">       rv = m_stringBundle-&gt;FormatStringFromName(</span>
<a href="#l118.16"></a><span id="l118.16">         MOZ_UTF16(&quot;imapServerAlert&quot;),</span>
<a href="#l118.17"></a><span id="l118.17">         params, 2, getter_Copies(message));</span>
<a href="#l118.18"></a><span id="l118.18">       if (NS_SUCCEEDED(rv))</span>
<a href="#l118.19"></a><span id="l118.19">         return AlertUser(message, aUrl);</span>
<a href="#l118.20"></a><span id="l118.20">     }</span>
<a href="#l118.21"></a><span id="l118.21">   }</span>
<a href="#l118.22"></a><span id="l118.22" class="difflineat">@@ -1836,17 +1836,17 @@ nsImapIncomingServer::FEAlertWithName(co</span>
<a href="#l118.23"></a><span id="l118.23">   nsString message;</span>
<a href="#l118.24"></a><span id="l118.24"> </span>
<a href="#l118.25"></a><span id="l118.25">   if (m_stringBundle)</span>
<a href="#l118.26"></a><span id="l118.26">   {</span>
<a href="#l118.27"></a><span id="l118.27">     nsAutoString hostName;</span>
<a href="#l118.28"></a><span id="l118.28">     nsresult rv = GetPrettyName(hostName);</span>
<a href="#l118.29"></a><span id="l118.29">     if (NS_SUCCEEDED(rv))</span>
<a href="#l118.30"></a><span id="l118.30">     {</span>
<a href="#l118.31"></a><span id="l118.31" class="difflineminus">-      const PRUnichar *params[] = { hostName.get() };</span>
<a href="#l118.32"></a><span id="l118.32" class="difflineplus">+      const char16_t *params[] = { hostName.get() };</span>
<a href="#l118.33"></a><span id="l118.33">       rv = m_stringBundle-&gt;FormatStringFromName(</span>
<a href="#l118.34"></a><span id="l118.34">         NS_ConvertASCIItoUTF16(aMsgName).get(),</span>
<a href="#l118.35"></a><span id="l118.35">         params, 1,getter_Copies(message));</span>
<a href="#l118.36"></a><span id="l118.36">       if (NS_SUCCEEDED(rv))</span>
<a href="#l118.37"></a><span id="l118.37">         return AlertUser(message, aUrl);</span>
<a href="#l118.38"></a><span id="l118.38">     }</span>
<a href="#l118.39"></a><span id="l118.39">   }</span>
<a href="#l118.40"></a><span id="l118.40"> </span>
<a href="#l118.41"></a><span id="l118.41" class="difflineat">@@ -1877,17 +1877,17 @@ NS_IMETHODIMP  nsImapIncomingServer::FEA</span>
<a href="#l118.42"></a><span id="l118.42"> </span>
<a href="#l118.43"></a><span id="l118.43">   // Adjust the message.</span>
<a href="#l118.44"></a><span id="l118.44">   if (pos != -1)</span>
<a href="#l118.45"></a><span id="l118.45">     message = Substring(message, pos + 1);</span>
<a href="#l118.46"></a><span id="l118.46"> </span>
<a href="#l118.47"></a><span id="l118.47">   nsString hostName;</span>
<a href="#l118.48"></a><span id="l118.48">   GetPrettyName(hostName);</span>
<a href="#l118.49"></a><span id="l118.49"> </span>
<a href="#l118.50"></a><span id="l118.50" class="difflineminus">-  const PRUnichar *formatStrings[] =</span>
<a href="#l118.51"></a><span id="l118.51" class="difflineplus">+  const char16_t *formatStrings[] =</span>
<a href="#l118.52"></a><span id="l118.52">   {</span>
<a href="#l118.53"></a><span id="l118.53">     hostName.get(),</span>
<a href="#l118.54"></a><span id="l118.54">     nullptr,</span>
<a href="#l118.55"></a><span id="l118.55">     nullptr</span>
<a href="#l118.56"></a><span id="l118.56">   };</span>
<a href="#l118.57"></a><span id="l118.57"> </span>
<a href="#l118.58"></a><span id="l118.58">   nsString msgName;</span>
<a href="#l118.59"></a><span id="l118.59">   int32_t numStrings;</span>
<a href="#l118.60"></a><span id="l118.60" class="difflineat">@@ -2468,25 +2468,25 @@ NS_IMETHODIMP</span>
<a href="#l118.61"></a><span id="l118.61"> nsImapIncomingServer::GetSubscribeListener(nsISubscribeListener **aListener)</span>
<a href="#l118.62"></a><span id="l118.62"> {</span>
<a href="#l118.63"></a><span id="l118.63">   nsresult rv = EnsureInner();</span>
<a href="#l118.64"></a><span id="l118.64">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l118.65"></a><span id="l118.65">   return mInner-&gt;GetSubscribeListener(aListener);</span>
<a href="#l118.66"></a><span id="l118.66"> }</span>
<a href="#l118.67"></a><span id="l118.67"> </span>
<a href="#l118.68"></a><span id="l118.68"> NS_IMETHODIMP</span>
<a href="#l118.69"></a><span id="l118.69" class="difflineminus">-nsImapIncomingServer::Subscribe(const PRUnichar *aName)</span>
<a href="#l118.70"></a><span id="l118.70" class="difflineplus">+nsImapIncomingServer::Subscribe(const char16_t *aName)</span>
<a href="#l118.71"></a><span id="l118.71"> {</span>
<a href="#l118.72"></a><span id="l118.72">   NS_ENSURE_ARG_POINTER(aName);</span>
<a href="#l118.73"></a><span id="l118.73">   </span>
<a href="#l118.74"></a><span id="l118.74">   return SubscribeToFolder(nsDependentString(aName), true, nullptr);</span>
<a href="#l118.75"></a><span id="l118.75"> }</span>
<a href="#l118.76"></a><span id="l118.76"> </span>
<a href="#l118.77"></a><span id="l118.77"> NS_IMETHODIMP</span>
<a href="#l118.78"></a><span id="l118.78" class="difflineminus">-nsImapIncomingServer::Unsubscribe(const PRUnichar *aName)</span>
<a href="#l118.79"></a><span id="l118.79" class="difflineplus">+nsImapIncomingServer::Unsubscribe(const char16_t *aName)</span>
<a href="#l118.80"></a><span id="l118.80"> {</span>
<a href="#l118.81"></a><span id="l118.81">   NS_ENSURE_ARG_POINTER(aName);</span>
<a href="#l118.82"></a><span id="l118.82"> </span>
<a href="#l118.83"></a><span id="l118.83">   return SubscribeToFolder(nsDependentString(aName), false, nullptr);</span>
<a href="#l118.84"></a><span id="l118.84"> }</span>
<a href="#l118.85"></a><span id="l118.85"> </span>
<a href="#l118.86"></a><span id="l118.86"> NS_IMETHODIMP</span>
<a href="#l118.87"></a><span id="l118.87"> nsImapIncomingServer::SubscribeToFolder(const nsAString&amp; aName, bool subscribe, nsIURI **aUri)</span>
<a href="#l118.88"></a><span id="l118.88" class="difflineat">@@ -2868,17 +2868,17 @@ nsresult</span>
<a href="#l118.89"></a><span id="l118.89"> nsImapIncomingServer::GetFormattedStringFromName(const nsAString&amp; aValue,</span>
<a href="#l118.90"></a><span id="l118.90">                                                  const char* aName,</span>
<a href="#l118.91"></a><span id="l118.91">                                                  nsAString&amp; aResult)</span>
<a href="#l118.92"></a><span id="l118.92"> {</span>
<a href="#l118.93"></a><span id="l118.93">   nsresult rv = GetStringBundle();</span>
<a href="#l118.94"></a><span id="l118.94">   if (m_stringBundle)</span>
<a href="#l118.95"></a><span id="l118.95">   {</span>
<a href="#l118.96"></a><span id="l118.96">     nsString tmpVal (aValue);</span>
<a href="#l118.97"></a><span id="l118.97" class="difflineminus">-    const PRUnichar *formatStrings[] = { tmpVal.get() };</span>
<a href="#l118.98"></a><span id="l118.98" class="difflineplus">+    const char16_t *formatStrings[] = { tmpVal.get() };</span>
<a href="#l118.99"></a><span id="l118.99"> </span>
<a href="#l118.100"></a><span id="l118.100">     nsString result;</span>
<a href="#l118.101"></a><span id="l118.101">     rv = m_stringBundle-&gt;FormatStringFromName(</span>
<a href="#l118.102"></a><span id="l118.102">       NS_ConvertASCIItoUTF16(aName).get(),</span>
<a href="#l118.103"></a><span id="l118.103">       formatStrings, 1, getter_Copies(result));</span>
<a href="#l118.104"></a><span id="l118.104">     aResult.Assign(result);</span>
<a href="#l118.105"></a><span id="l118.105">   }</span>
<a href="#l118.106"></a><span id="l118.106">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l119.1"></a><span id="l119.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.h</span>
<a href="#l119.2"></a><span id="l119.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.h</span>
<a href="#l119.3"></a><span id="l119.3" class="difflineat">@@ -87,17 +87,17 @@ protected:</span>
<a href="#l119.4"></a><span id="l119.4">   nsresult DeleteNonVerifiedFolders(nsIMsgFolder *parentFolder);</span>
<a href="#l119.5"></a><span id="l119.5">   bool NoDescendentsAreVerified(nsIMsgFolder *parentFolder);</span>
<a href="#l119.6"></a><span id="l119.6">   bool AllDescendentsAreNoSelect(nsIMsgFolder *parentFolder);</span>
<a href="#l119.7"></a><span id="l119.7"> </span>
<a href="#l119.8"></a><span id="l119.8">   nsresult GetStringBundle();</span>
<a href="#l119.9"></a><span id="l119.9">   static nsresult AlertUser(const nsAString&amp; aString, nsIMsgMailNewsUrl *aUrl);</span>
<a href="#l119.10"></a><span id="l119.10"> </span>
<a href="#l119.11"></a><span id="l119.11"> private:</span>
<a href="#l119.12"></a><span id="l119.12" class="difflineminus">-  nsresult SubscribeToFolder(const PRUnichar *aName, bool subscribe);</span>
<a href="#l119.13"></a><span id="l119.13" class="difflineplus">+  nsresult SubscribeToFolder(const char16_t *aName, bool subscribe);</span>
<a href="#l119.14"></a><span id="l119.14">   nsresult GetImapConnection(nsIImapUrl* aImapUrl,</span>
<a href="#l119.15"></a><span id="l119.15">                              nsIImapProtocol** aImapConnection);</span>
<a href="#l119.16"></a><span id="l119.16">   nsresult CreateProtocolInstance(nsIImapProtocol ** aImapConnection);</span>
<a href="#l119.17"></a><span id="l119.17">   nsresult CreateHostSpecificPrefName(const char *prefPrefix, nsAutoCString &amp;prefName);</span>
<a href="#l119.18"></a><span id="l119.18"> </span>
<a href="#l119.19"></a><span id="l119.19">   nsresult DoomUrlIfChannelHasError(nsIImapUrl *aImapUrl, bool *urlDoomed);</span>
<a href="#l119.20"></a><span id="l119.20">   bool ConnectionTimeOut(nsIImapProtocol* aImapConnection);</span>
<a href="#l119.21"></a><span id="l119.21">   nsresult GetFormattedStringFromName(const nsAString&amp; aValue, const char* aName, nsAString&amp; aResult);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l120.1"></a><span id="l120.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l120.2"></a><span id="l120.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l120.3"></a><span id="l120.3" class="difflineat">@@ -1595,34 +1595,34 @@ NS_IMETHODIMP nsImapMailFolder::Rename (</span>
<a href="#l120.4"></a><span id="l120.4">     if (msgWindow)</span>
<a href="#l120.5"></a><span id="l120.5">       msgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l120.6"></a><span id="l120.6">     if (docShell)</span>
<a href="#l120.7"></a><span id="l120.7">     {</span>
<a href="#l120.8"></a><span id="l120.8">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l120.9"></a><span id="l120.9">       rv = IMAPGetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l120.10"></a><span id="l120.10">       if (NS_SUCCEEDED(rv) &amp;&amp; bundle)</span>
<a href="#l120.11"></a><span id="l120.11">       {</span>
<a href="#l120.12"></a><span id="l120.12" class="difflineminus">-        const PRUnichar *formatStrings[] =</span>
<a href="#l120.13"></a><span id="l120.13" class="difflineplus">+        const char16_t *formatStrings[] =</span>
<a href="#l120.14"></a><span id="l120.14">         {</span>
<a href="#l120.15"></a><span id="l120.15" class="difflineminus">-          (const PRUnichar*)(intptr_t)m_hierarchyDelimiter</span>
<a href="#l120.16"></a><span id="l120.16" class="difflineplus">+          (const char16_t*)(intptr_t)m_hierarchyDelimiter</span>
<a href="#l120.17"></a><span id="l120.17">         };</span>
<a href="#l120.18"></a><span id="l120.18">         nsString alertString;</span>
<a href="#l120.19"></a><span id="l120.19">         rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l120.20"></a><span id="l120.20">           MOZ_UTF16(&quot;imapSpecialChar&quot;),</span>
<a href="#l120.21"></a><span id="l120.21">           formatStrings, 1, getter_Copies(alertString));</span>
<a href="#l120.22"></a><span id="l120.22">         nsCOMPtr&lt;nsIPrompt&gt; dialog(do_GetInterface(docShell));</span>
<a href="#l120.23"></a><span id="l120.23">         // setting up the dialog title</span>
<a href="#l120.24"></a><span id="l120.24">         nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l120.25"></a><span id="l120.25">         rv = GetServer(getter_AddRefs(server));</span>
<a href="#l120.26"></a><span id="l120.26">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l120.27"></a><span id="l120.27">         nsString dialogTitle;</span>
<a href="#l120.28"></a><span id="l120.28">         nsString accountName;</span>
<a href="#l120.29"></a><span id="l120.29">         rv = server-&gt;GetPrettyName(accountName);</span>
<a href="#l120.30"></a><span id="l120.30">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l120.31"></a><span id="l120.31" class="difflineminus">-        const PRUnichar *titleParams[] = { accountName.get() };</span>
<a href="#l120.32"></a><span id="l120.32" class="difflineplus">+        const char16_t *titleParams[] = { accountName.get() };</span>
<a href="#l120.33"></a><span id="l120.33">         rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l120.34"></a><span id="l120.34">           MOZ_UTF16(&quot;imapAlertDialogTitle&quot;),</span>
<a href="#l120.35"></a><span id="l120.35">           titleParams, 1, getter_Copies(dialogTitle));</span>
<a href="#l120.36"></a><span id="l120.36"> </span>
<a href="#l120.37"></a><span id="l120.37">         if (dialog &amp;&amp; !alertString.IsEmpty())</span>
<a href="#l120.38"></a><span id="l120.38">           dialog-&gt;Alert(dialogTitle.get(), alertString.get());</span>
<a href="#l120.39"></a><span id="l120.39">       }</span>
<a href="#l120.40"></a><span id="l120.40">     }</span>
<a href="#l120.41"></a><span id="l120.41" class="difflineat">@@ -2408,17 +2408,17 @@ nsImapMailFolder::DeleteSubFolders(nsIAr</span>
<a href="#l120.42"></a><span id="l120.42">   {</span>
<a href="#l120.43"></a><span id="l120.43">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l120.44"></a><span id="l120.44">     rv = IMAPGetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l120.45"></a><span id="l120.45">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l120.46"></a><span id="l120.46"> </span>
<a href="#l120.47"></a><span id="l120.47">     nsAutoString folderName;</span>
<a href="#l120.48"></a><span id="l120.48">     rv = curFolder-&gt;GetName(folderName);</span>
<a href="#l120.49"></a><span id="l120.49">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l120.50"></a><span id="l120.50" class="difflineminus">-    const PRUnichar *formatStrings[1] = { folderName.get() };</span>
<a href="#l120.51"></a><span id="l120.51" class="difflineplus">+    const char16_t *formatStrings[1] = { folderName.get() };</span>
<a href="#l120.52"></a><span id="l120.52"> </span>
<a href="#l120.53"></a><span id="l120.53">     nsAutoString deleteFolderDialogTitle;</span>
<a href="#l120.54"></a><span id="l120.54">     rv = bundle-&gt;GetStringFromName(</span>
<a href="#l120.55"></a><span id="l120.55">       MOZ_UTF16(&quot;imapDeleteFolderDialogTitle&quot;),</span>
<a href="#l120.56"></a><span id="l120.56">       getter_Copies(deleteFolderDialogTitle));</span>
<a href="#l120.57"></a><span id="l120.57">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l120.58"></a><span id="l120.58"> </span>
<a href="#l120.59"></a><span id="l120.59">     nsAutoString deleteFolderButtonLabel;</span>
<a href="#l120.60"></a><span id="l120.60" class="difflineat">@@ -6009,17 +6009,17 @@ nsImapMailFolder::FillInFolderProps(nsIM</span>
<a href="#l120.61"></a><span id="l120.61">       // Another user's folder, for which we couldn't find an owner name</span>
<a href="#l120.62"></a><span id="l120.62">       NS_ASSERTION(false, &quot;couldn't get owner name for other user's folder&quot;);</span>
<a href="#l120.63"></a><span id="l120.63">     }</span>
<a href="#l120.64"></a><span id="l120.64">     else</span>
<a href="#l120.65"></a><span id="l120.65">     {</span>
<a href="#l120.66"></a><span id="l120.66">       // is this right? It doesn't leak, does it?</span>
<a href="#l120.67"></a><span id="l120.67">       CopyASCIItoUTF16(owner, uniOwner);</span>
<a href="#l120.68"></a><span id="l120.68">     }</span>
<a href="#l120.69"></a><span id="l120.69" class="difflineminus">-    const PRUnichar *params[] = { uniOwner.get() };</span>
<a href="#l120.70"></a><span id="l120.70" class="difflineplus">+    const char16_t *params[] = { uniOwner.get() };</span>
<a href="#l120.71"></a><span id="l120.71">     rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l120.72"></a><span id="l120.72">       MOZ_UTF16(&quot;imapOtherUsersFolderTypeDescription&quot;),</span>
<a href="#l120.73"></a><span id="l120.73">       params, 1, getter_Copies(folderTypeDesc));</span>
<a href="#l120.74"></a><span id="l120.74">   }</span>
<a href="#l120.75"></a><span id="l120.75">   else if (GetFolderACL()-&gt;GetIsFolderShared())</span>
<a href="#l120.76"></a><span id="l120.76">   {</span>
<a href="#l120.77"></a><span id="l120.77">     folderTypeStringID = &quot;imapPersonalSharedFolderTypeName&quot;;</span>
<a href="#l120.78"></a><span id="l120.78">     folderTypeDescStringID = &quot;imapPersonalSharedFolderTypeDescription&quot;;</span>
<a href="#l120.79"></a><span id="l120.79" class="difflineat">@@ -6662,17 +6662,17 @@ nsresult nsImapMailFolder::DisplayStatus</span>
<a href="#l120.80"></a><span id="l120.80">     }</span>
<a href="#l120.81"></a><span id="l120.81">   }</span>
<a href="#l120.82"></a><span id="l120.82">   return NS_OK;</span>
<a href="#l120.83"></a><span id="l120.83"> }</span>
<a href="#l120.84"></a><span id="l120.84"> </span>
<a href="#l120.85"></a><span id="l120.85"> NS_IMETHODIMP</span>
<a href="#l120.86"></a><span id="l120.86"> nsImapMailFolder::ProgressStatusString(nsIImapProtocol* aProtocol,</span>
<a href="#l120.87"></a><span id="l120.87">                                        const char* aMsgName,</span>
<a href="#l120.88"></a><span id="l120.88" class="difflineminus">-                                       const PRUnichar * extraInfo)</span>
<a href="#l120.89"></a><span id="l120.89" class="difflineplus">+                                       const char16_t * extraInfo)</span>
<a href="#l120.90"></a><span id="l120.90"> {</span>
<a href="#l120.91"></a><span id="l120.91">   nsString progressMsg;</span>
<a href="#l120.92"></a><span id="l120.92"> </span>
<a href="#l120.93"></a><span id="l120.93">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l120.94"></a><span id="l120.94">   nsresult rv = GetServer(getter_AddRefs(server));</span>
<a href="#l120.95"></a><span id="l120.95">   if (NS_SUCCEEDED(rv) &amp;&amp; server)</span>
<a href="#l120.96"></a><span id="l120.96">   {</span>
<a href="#l120.97"></a><span id="l120.97">     nsCOMPtr&lt;nsIImapServerSink&gt; serverSink = do_QueryInterface(server);</span>
<a href="#l120.98"></a><span id="l120.98" class="difflineat">@@ -6685,30 +6685,30 @@ nsImapMailFolder::ProgressStatusString(n</span>
<a href="#l120.99"></a><span id="l120.99">   if (aProtocol &amp;&amp; !progressMsg.IsEmpty())</span>
<a href="#l120.100"></a><span id="l120.100">   {</span>
<a href="#l120.101"></a><span id="l120.101">     nsCOMPtr &lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l120.102"></a><span id="l120.102">     aProtocol-&gt;GetRunningImapURL(getter_AddRefs(imapUrl));</span>
<a href="#l120.103"></a><span id="l120.103">     if (imapUrl)</span>
<a href="#l120.104"></a><span id="l120.104">     {</span>
<a href="#l120.105"></a><span id="l120.105">       if (extraInfo)</span>
<a href="#l120.106"></a><span id="l120.106">       {</span>
<a href="#l120.107"></a><span id="l120.107" class="difflineminus">-        PRUnichar *printfString = nsTextFormatter::smprintf(progressMsg.get(), extraInfo);</span>
<a href="#l120.108"></a><span id="l120.108" class="difflineplus">+        char16_t *printfString = nsTextFormatter::smprintf(progressMsg.get(), extraInfo);</span>
<a href="#l120.109"></a><span id="l120.109">         if (printfString)</span>
<a href="#l120.110"></a><span id="l120.110">           progressMsg.Adopt(printfString);</span>
<a href="#l120.111"></a><span id="l120.111">       }</span>
<a href="#l120.112"></a><span id="l120.112"> </span>
<a href="#l120.113"></a><span id="l120.113">       DisplayStatusMsg(imapUrl, progressMsg);</span>
<a href="#l120.114"></a><span id="l120.114">     }</span>
<a href="#l120.115"></a><span id="l120.115">   }</span>
<a href="#l120.116"></a><span id="l120.116">   return NS_OK;</span>
<a href="#l120.117"></a><span id="l120.117"> }</span>
<a href="#l120.118"></a><span id="l120.118"> </span>
<a href="#l120.119"></a><span id="l120.119"> NS_IMETHODIMP</span>
<a href="#l120.120"></a><span id="l120.120"> nsImapMailFolder::PercentProgress(nsIImapProtocol* aProtocol,</span>
<a href="#l120.121"></a><span id="l120.121" class="difflineminus">-                                  const PRUnichar * aMessage,</span>
<a href="#l120.122"></a><span id="l120.122" class="difflineplus">+                                  const char16_t * aMessage,</span>
<a href="#l120.123"></a><span id="l120.123">                                   int64_t aCurrentProgress, int64_t aMaxProgress)</span>
<a href="#l120.124"></a><span id="l120.124"> {</span>
<a href="#l120.125"></a><span id="l120.125">   if (aProtocol)</span>
<a href="#l120.126"></a><span id="l120.126">   {</span>
<a href="#l120.127"></a><span id="l120.127">     nsCOMPtr &lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l120.128"></a><span id="l120.128">     aProtocol-&gt;GetRunningImapURL(getter_AddRefs(imapUrl));</span>
<a href="#l120.129"></a><span id="l120.129">     if (imapUrl)</span>
<a href="#l120.130"></a><span id="l120.130">     {</span>
<a href="#l120.131"></a><span id="l120.131" class="difflineat">@@ -8125,17 +8125,17 @@ nsImapMailFolder::CopyStreamMessage(nsIM</span>
<a href="#l120.132"></a><span id="l120.132">     {</span>
<a href="#l120.133"></a><span id="l120.133">       nsString dstFolderName, progressText;</span>
<a href="#l120.134"></a><span id="l120.134">       GetName(dstFolderName);</span>
<a href="#l120.135"></a><span id="l120.135">       nsAutoString curMsgString;</span>
<a href="#l120.136"></a><span id="l120.136">       nsAutoString totalMsgString;</span>
<a href="#l120.137"></a><span id="l120.137">       totalMsgString.AppendInt(m_copyState-&gt;m_totalCount);</span>
<a href="#l120.138"></a><span id="l120.138">       curMsgString.AppendInt(m_copyState-&gt;m_curIndex + 1);</span>
<a href="#l120.139"></a><span id="l120.139"> </span>
<a href="#l120.140"></a><span id="l120.140" class="difflineminus">-      const PRUnichar *formatStrings[3] = {curMsgString.get(),</span>
<a href="#l120.141"></a><span id="l120.141" class="difflineplus">+      const char16_t *formatStrings[3] = {curMsgString.get(),</span>
<a href="#l120.142"></a><span id="l120.142">                                             totalMsgString.get(),</span>
<a href="#l120.143"></a><span id="l120.143">                                             dstFolderName.get()</span>
<a href="#l120.144"></a><span id="l120.144">                                             };</span>
<a href="#l120.145"></a><span id="l120.145"> </span>
<a href="#l120.146"></a><span id="l120.146">       nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l120.147"></a><span id="l120.147">       rv = IMAPGetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l120.148"></a><span id="l120.148">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l120.149"></a><span id="l120.149">       rv = bundle-&gt;FormatStringFromName(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l121.1"></a><span id="l121.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l121.2"></a><span id="l121.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l121.3"></a><span id="l121.3" class="difflineat">@@ -5036,24 +5036,24 @@ void nsImapProtocol::SetProgressString(c</span>
<a href="#l121.4"></a><span id="l121.4">                                           m_progressString);</span>
<a href="#l121.5"></a><span id="l121.5"> }</span>
<a href="#l121.6"></a><span id="l121.6"> </span>
<a href="#l121.7"></a><span id="l121.7"> void</span>
<a href="#l121.8"></a><span id="l121.8"> nsImapProtocol::ShowProgress()</span>
<a href="#l121.9"></a><span id="l121.9"> {</span>
<a href="#l121.10"></a><span id="l121.10">   if (!m_progressString.IsEmpty() &amp;&amp; !m_progressStringName.IsEmpty())</span>
<a href="#l121.11"></a><span id="l121.11">   {</span>
<a href="#l121.12"></a><span id="l121.12" class="difflineminus">-    PRUnichar *progressString = NULL;</span>
<a href="#l121.13"></a><span id="l121.13" class="difflineplus">+    char16_t *progressString = NULL;</span>
<a href="#l121.14"></a><span id="l121.14">     const char *mailboxName = GetServerStateParser().GetSelectedMailboxName();</span>
<a href="#l121.15"></a><span id="l121.15">     nsString unicodeMailboxName;</span>
<a href="#l121.16"></a><span id="l121.16">     nsresult rv = CopyMUTF7toUTF16(nsDependentCString(mailboxName),</span>
<a href="#l121.17"></a><span id="l121.17">                                    unicodeMailboxName);</span>
<a href="#l121.18"></a><span id="l121.18">     if (NS_SUCCEEDED(rv))</span>
<a href="#l121.19"></a><span id="l121.19">     {</span>
<a href="#l121.20"></a><span id="l121.20" class="difflineminus">-      // ### should convert mailboxName to PRUnichar and change %s to %S in msg text</span>
<a href="#l121.21"></a><span id="l121.21" class="difflineplus">+      // ### should convert mailboxName to char16_t and change %s to %S in msg text</span>
<a href="#l121.22"></a><span id="l121.22">       progressString = nsTextFormatter::smprintf(m_progressString.get(),</span>
<a href="#l121.23"></a><span id="l121.23">                                 unicodeMailboxName.get(), ++m_progressIndex, m_progressCount);</span>
<a href="#l121.24"></a><span id="l121.24">       if (progressString)</span>
<a href="#l121.25"></a><span id="l121.25">       {</span>
<a href="#l121.26"></a><span id="l121.26">         PercentProgressUpdateEvent(progressString, m_progressIndex, m_progressCount);</span>
<a href="#l121.27"></a><span id="l121.27">         nsTextFormatter::smprintf_free(progressString);</span>
<a href="#l121.28"></a><span id="l121.28">       }</span>
<a href="#l121.29"></a><span id="l121.29">     }</span>
<a href="#l121.30"></a><span id="l121.30" class="difflineat">@@ -5080,17 +5080,17 @@ nsImapProtocol::ProgressEventFunctionUsi</span>
<a href="#l121.31"></a><span id="l121.31">     nsString unicodeStr;</span>
<a href="#l121.32"></a><span id="l121.32">     nsresult rv = CopyMUTF7toUTF16(nsDependentCString(aExtraInfo), unicodeStr);</span>
<a href="#l121.33"></a><span id="l121.33">     if (NS_SUCCEEDED(rv))</span>
<a href="#l121.34"></a><span id="l121.34">       m_imapMailFolderSink-&gt;ProgressStatusString(this, aMsgName, unicodeStr.get());</span>
<a href="#l121.35"></a><span id="l121.35">   }</span>
<a href="#l121.36"></a><span id="l121.36"> }</span>
<a href="#l121.37"></a><span id="l121.37"> </span>
<a href="#l121.38"></a><span id="l121.38"> void</span>
<a href="#l121.39"></a><span id="l121.39" class="difflineminus">-nsImapProtocol::PercentProgressUpdateEvent(PRUnichar *message, int64_t currentProgress, int64_t maxProgress)</span>
<a href="#l121.40"></a><span id="l121.40" class="difflineplus">+nsImapProtocol::PercentProgressUpdateEvent(char16_t *message, int64_t currentProgress, int64_t maxProgress)</span>
<a href="#l121.41"></a><span id="l121.41"> {</span>
<a href="#l121.42"></a><span id="l121.42">   int64_t nowMS = 0;</span>
<a href="#l121.43"></a><span id="l121.43">   int32_t percent = (100 * currentProgress) / maxProgress;</span>
<a href="#l121.44"></a><span id="l121.44">   if (percent == m_lastPercent)</span>
<a href="#l121.45"></a><span id="l121.45">     return; // hasn't changed, right? So just return. Do we need to clear this anywhere?</span>
<a href="#l121.46"></a><span id="l121.46"> </span>
<a href="#l121.47"></a><span id="l121.47">   if (percent &lt; 100)  // always need to do 100%</span>
<a href="#l121.48"></a><span id="l121.48">   {</span>
<a href="#l121.49"></a><span id="l121.49" class="difflineat">@@ -7781,17 +7781,17 @@ void nsImapProtocol::Copy(const char * m</span>
<a href="#l121.50"></a><span id="l121.50"> void nsImapProtocol::NthLevelChildList(const char* onlineMailboxPrefix,</span>
<a href="#l121.51"></a><span id="l121.51">                                        int32_t depth)</span>
<a href="#l121.52"></a><span id="l121.52"> {</span>
<a href="#l121.53"></a><span id="l121.53">   NS_ASSERTION (depth &gt;= 0,</span>
<a href="#l121.54"></a><span id="l121.54">                   &quot;Oops ... depth must be equal or greater than 0&quot;);</span>
<a href="#l121.55"></a><span id="l121.55">   if (depth &lt; 0) return;</span>
<a href="#l121.56"></a><span id="l121.56"> </span>
<a href="#l121.57"></a><span id="l121.57">   nsCString truncatedPrefix (onlineMailboxPrefix);</span>
<a href="#l121.58"></a><span id="l121.58" class="difflineminus">-  PRUnichar slash = '/';</span>
<a href="#l121.59"></a><span id="l121.59" class="difflineplus">+  char16_t slash = '/';</span>
<a href="#l121.60"></a><span id="l121.60">   if (truncatedPrefix.Last() == slash)</span>
<a href="#l121.61"></a><span id="l121.61">         truncatedPrefix.SetLength(truncatedPrefix.Length()-1);</span>
<a href="#l121.62"></a><span id="l121.62"> </span>
<a href="#l121.63"></a><span id="l121.63">   nsAutoCString pattern(truncatedPrefix);</span>
<a href="#l121.64"></a><span id="l121.64">   nsAutoCString suffix;</span>
<a href="#l121.65"></a><span id="l121.65">   int count = 0;</span>
<a href="#l121.66"></a><span id="l121.66">   char separator = 0;</span>
<a href="#l121.67"></a><span id="l121.67">   m_runningUrl-&gt;GetOnlineSubDirSeparator(&amp;separator);</span>
<a href="#l121.68"></a><span id="l121.68" class="difflineat">@@ -8506,17 +8506,17 @@ bool</span>
<a href="#l121.69"></a><span id="l121.69"> nsImapProtocol::GetShowDeletedMessages()</span>
<a href="#l121.70"></a><span id="l121.70"> {</span>
<a href="#l121.71"></a><span id="l121.71">     bool rv = false;</span>
<a href="#l121.72"></a><span id="l121.72">     if (m_hostSessionList)</span>
<a href="#l121.73"></a><span id="l121.73">         m_hostSessionList-&gt;GetShowDeletedMessagesForHost(GetImapServerKey(), rv);</span>
<a href="#l121.74"></a><span id="l121.74">     return rv;</span>
<a href="#l121.75"></a><span id="l121.75"> }</span>
<a href="#l121.76"></a><span id="l121.76"> </span>
<a href="#l121.77"></a><span id="l121.77" class="difflineminus">-NS_IMETHODIMP nsImapProtocol::OverrideConnectionInfo(const PRUnichar *pHost, uint16_t pPort, const char *pCookieData)</span>
<a href="#l121.78"></a><span id="l121.78" class="difflineplus">+NS_IMETHODIMP nsImapProtocol::OverrideConnectionInfo(const char16_t *pHost, uint16_t pPort, const char *pCookieData)</span>
<a href="#l121.79"></a><span id="l121.79"> {</span>
<a href="#l121.80"></a><span id="l121.80">   m_logonHost = NS_LossyConvertUTF16toASCII(pHost);</span>
<a href="#l121.81"></a><span id="l121.81">   m_logonPort = pPort;</span>
<a href="#l121.82"></a><span id="l121.82">   m_logonCookie = pCookieData;</span>
<a href="#l121.83"></a><span id="l121.83">   m_overRideUrlConnectionInfo = true;</span>
<a href="#l121.84"></a><span id="l121.84">   return NS_OK;</span>
<a href="#l121.85"></a><span id="l121.85"> }</span>
<a href="#l121.86"></a><span id="l121.86"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l122.1"></a><span id="l122.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l122.2"></a><span id="l122.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l122.3"></a><span id="l122.3" class="difflineat">@@ -238,17 +238,17 @@ public:</span>
<a href="#l122.4"></a><span id="l122.4">   void DiscoverMailboxSpec(nsImapMailboxSpec * adoptedBoxSpec);</span>
<a href="#l122.5"></a><span id="l122.5">   void AlertUserEventUsingName(const char* aMessageId);</span>
<a href="#l122.6"></a><span id="l122.6">   void AlertUserEvent(const char * message);</span>
<a href="#l122.7"></a><span id="l122.7">   void AlertUserEventFromServer(const char * aServerEvent);</span>
<a href="#l122.8"></a><span id="l122.8"> </span>
<a href="#l122.9"></a><span id="l122.9">   void ProgressEventFunctionUsingName(const char* aMsgId);</span>
<a href="#l122.10"></a><span id="l122.10">   void ProgressEventFunctionUsingNameWithString(const char* aMsgName, const char *</span>
<a href="#l122.11"></a><span id="l122.11">     aExtraInfo);</span>
<a href="#l122.12"></a><span id="l122.12" class="difflineminus">-  void PercentProgressUpdateEvent(PRUnichar *message, int64_t currentProgress, int64_t maxProgress);</span>
<a href="#l122.13"></a><span id="l122.13" class="difflineplus">+  void PercentProgressUpdateEvent(char16_t *message, int64_t currentProgress, int64_t maxProgress);</span>
<a href="#l122.14"></a><span id="l122.14">   void ShowProgress();</span>
<a href="#l122.15"></a><span id="l122.15"> </span>
<a href="#l122.16"></a><span id="l122.16">   // utility function calls made by the server</span>
<a href="#l122.17"></a><span id="l122.17"> </span>
<a href="#l122.18"></a><span id="l122.18">   void Copy(const char * messageList, const char *destinationMailbox,</span>
<a href="#l122.19"></a><span id="l122.19">     bool idsAreUid);</span>
<a href="#l122.20"></a><span id="l122.20">   void Search(const char * searchCriteria,  bool useUID,</span>
<a href="#l122.21"></a><span id="l122.21">     bool notifyHit = true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l123.1"></a><span id="l123.1" class="difflineminus">--- a/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l123.2"></a><span id="l123.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l123.3"></a><span id="l123.3" class="difflineat">@@ -932,17 +932,17 @@ void nsImapServerResponseParser::mailbox</span>
<a href="#l123.4"></a><span id="l123.4">       default:	// (kUnknownNamespace)</span>
<a href="#l123.5"></a><span id="l123.5">         break;</span>
<a href="#l123.6"></a><span id="l123.6">       }</span>
<a href="#l123.7"></a><span id="l123.7">       boxSpec-&gt;mNamespaceForFolder = ns;</span>
<a href="#l123.8"></a><span id="l123.8">     }</span>
<a href="#l123.9"></a><span id="l123.9"> </span>
<a href="#l123.10"></a><span id="l123.10">     //    	char *convertedName =</span>
<a href="#l123.11"></a><span id="l123.11">     //            fServerConnection.CreateUtf7ConvertedString(boxname, false);</span>
<a href="#l123.12"></a><span id="l123.12" class="difflineminus">-    //		PRUnichar *unicharName;</span>
<a href="#l123.13"></a><span id="l123.13" class="difflineplus">+    //		char16_t *unicharName;</span>
<a href="#l123.14"></a><span id="l123.14">     //        unicharName = fServerConnection.CreatePRUnicharStringFromUTF7(boxname);</span>
<a href="#l123.15"></a><span id="l123.15">     //    	PL_strfree(boxname);</span>
<a href="#l123.16"></a><span id="l123.16">     //    	boxname = convertedName;</span>
<a href="#l123.17"></a><span id="l123.17">   }</span>
<a href="#l123.18"></a><span id="l123.18"> </span>
<a href="#l123.19"></a><span id="l123.19">   if (!boxname)</span>
<a href="#l123.20"></a><span id="l123.20">   {</span>
<a href="#l123.21"></a><span id="l123.21">     if (!fServerConnection.DeathSignalReceived())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l124.1"></a><span id="l124.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l124.2"></a><span id="l124.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l124.3"></a><span id="l124.3" class="difflineat">@@ -2733,17 +2733,17 @@ NS_IMETHODIMP nsImapService::NewChannel(</span>
<a href="#l124.4"></a><span id="l124.4">       nsString statusString, confirmText;</span>
<a href="#l124.5"></a><span id="l124.5">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l124.6"></a><span id="l124.6">       rv = IMAPGetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l124.7"></a><span id="l124.7">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l124.8"></a><span id="l124.8">         // need to convert folder name from mod-utf7 to unicode</span>
<a href="#l124.9"></a><span id="l124.9">       nsAutoString unescapedName;</span>
<a href="#l124.10"></a><span id="l124.10">       if (NS_FAILED(CopyMUTF7toUTF16(fullFolderName, unescapedName)))</span>
<a href="#l124.11"></a><span id="l124.11">         CopyASCIItoUTF16(fullFolderName, unescapedName);</span>
<a href="#l124.12"></a><span id="l124.12" class="difflineminus">-      const PRUnichar *formatStrings[1] = { unescapedName.get() };</span>
<a href="#l124.13"></a><span id="l124.13" class="difflineplus">+      const char16_t *formatStrings[1] = { unescapedName.get() };</span>
<a href="#l124.14"></a><span id="l124.14"> </span>
<a href="#l124.15"></a><span id="l124.15">       rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l124.16"></a><span id="l124.16">         MOZ_UTF16(&quot;imapSubscribePrompt&quot;),</span>
<a href="#l124.17"></a><span id="l124.17">         formatStrings, 1, getter_Copies(confirmText));</span>
<a href="#l124.18"></a><span id="l124.18">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l124.19"></a><span id="l124.19"> </span>
<a href="#l124.20"></a><span id="l124.20">       bool confirmResult = false;</span>
<a href="#l124.21"></a><span id="l124.21">       rv = dialog-&gt;Confirm(nullptr, confirmText.get(), &amp;confirmResult);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l125.1"></a><span id="l125.1" class="difflineminus">--- a/mailnews/imap/src/nsImapStringBundle.cpp</span>
<a href="#l125.2"></a><span id="l125.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapStringBundle.cpp</span>
<a href="#l125.3"></a><span id="l125.3" class="difflineat">@@ -12,17 +12,17 @@</span>
<a href="#l125.4"></a><span id="l125.4"> #include &quot;nsIURI.h&quot;</span>
<a href="#l125.5"></a><span id="l125.5"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l125.6"></a><span id="l125.6"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l125.7"></a><span id="l125.7"> </span>
<a href="#l125.8"></a><span id="l125.8"> #define IMAP_MSGS_URL       &quot;chrome://messenger/locale/imapMsgs.properties&quot;</span>
<a href="#l125.9"></a><span id="l125.9"> </span>
<a href="#l125.10"></a><span id="l125.10"> extern &quot;C&quot; </span>
<a href="#l125.11"></a><span id="l125.11"> nsresult</span>
<a href="#l125.12"></a><span id="l125.12" class="difflineminus">-IMAPGetStringByName(const char* stringName, PRUnichar **aString)</span>
<a href="#l125.13"></a><span id="l125.13" class="difflineplus">+IMAPGetStringByName(const char* stringName, char16_t **aString)</span>
<a href="#l125.14"></a><span id="l125.14"> {</span>
<a href="#l125.15"></a><span id="l125.15">   nsCOMPtr &lt;nsIStringBundle&gt; sBundle;</span>
<a href="#l125.16"></a><span id="l125.16">   nsresult rv = IMAPGetStringBundle(getter_AddRefs(sBundle));</span>
<a href="#l125.17"></a><span id="l125.17">   if (NS_SUCCEEDED(rv) &amp;&amp; sBundle)</span>
<a href="#l125.18"></a><span id="l125.18">     rv = sBundle-&gt;GetStringFromName(NS_ConvertASCIItoUTF16(stringName).get(),</span>
<a href="#l125.19"></a><span id="l125.19">                                     aString);</span>
<a href="#l125.20"></a><span id="l125.20">   return rv;</span>
<a href="#l125.21"></a><span id="l125.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l126.1"></a><span id="l126.1" class="difflineminus">--- a/mailnews/imap/src/nsImapStringBundle.h</span>
<a href="#l126.2"></a><span id="l126.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapStringBundle.h</span>
<a href="#l126.3"></a><span id="l126.3" class="difflineat">@@ -4,14 +4,14 @@</span>
<a href="#l126.4"></a><span id="l126.4"> </span>
<a href="#l126.5"></a><span id="l126.5"> #ifndef _nsImapStringBundle_H__</span>
<a href="#l126.6"></a><span id="l126.6"> #define _nsImapStringBundle_H__</span>
<a href="#l126.7"></a><span id="l126.7"> </span>
<a href="#l126.8"></a><span id="l126.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l126.9"></a><span id="l126.9"> </span>
<a href="#l126.10"></a><span id="l126.10"> PR_BEGIN_EXTERN_C</span>
<a href="#l126.11"></a><span id="l126.11"> </span>
<a href="#l126.12"></a><span id="l126.12" class="difflineminus">-nsresult      IMAPGetStringByName(const char* stringName, PRUnichar **aString);</span>
<a href="#l126.13"></a><span id="l126.13" class="difflineplus">+nsresult      IMAPGetStringByName(const char* stringName, char16_t **aString);</span>
<a href="#l126.14"></a><span id="l126.14"> nsresult      IMAPGetStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l126.15"></a><span id="l126.15"> </span>
<a href="#l126.16"></a><span id="l126.16"> PR_END_EXTERN_C</span>
<a href="#l126.17"></a><span id="l126.17"> </span>
<a href="#l126.18"></a><span id="l126.18"> #endif /* _nsImapStringBundle_H__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l127.1"></a><span id="l127.1" class="difflineminus">--- a/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l127.2"></a><span id="l127.2" class="difflineplus">+++ b/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l127.3"></a><span id="l127.3" class="difflineat">@@ -391,18 +391,18 @@ NS_SYNCRUNNABLEMETHOD2(ImapMailFolderSin</span>
<a href="#l127.4"></a><span id="l127.4"> NS_SYNCRUNNABLEMETHOD2(ImapMailFolderSink, NotifySearchHit, nsIMsgMailNewsUrl *, const char *)</span>
<a href="#l127.5"></a><span id="l127.5"> NS_SYNCRUNNABLEMETHOD2(ImapMailFolderSink, CopyNextStreamMessage, bool, nsISupports *)</span>
<a href="#l127.6"></a><span id="l127.6"> NS_SYNCRUNNABLEMETHOD1(ImapMailFolderSink, CloseMockChannel, nsIImapMockChannel *)</span>
<a href="#l127.7"></a><span id="l127.7"> NS_SYNCRUNNABLEMETHOD5(ImapMailFolderSink, SetUrlState, nsIImapProtocol *, nsIMsgMailNewsUrl *,</span>
<a href="#l127.8"></a><span id="l127.8">                        bool, bool, nsresult)</span>
<a href="#l127.9"></a><span id="l127.9"> NS_SYNCRUNNABLEMETHOD1(ImapMailFolderSink, ReleaseUrlCacheEntry, nsIMsgMailNewsUrl *)</span>
<a href="#l127.10"></a><span id="l127.10"> NS_SYNCRUNNABLEMETHOD1(ImapMailFolderSink, HeaderFetchCompleted, nsIImapProtocol *)</span>
<a href="#l127.11"></a><span id="l127.11"> NS_SYNCRUNNABLEMETHOD1(ImapMailFolderSink, SetBiffStateAndUpdate, int32_t)</span>
<a href="#l127.12"></a><span id="l127.12" class="difflineminus">-NS_SYNCRUNNABLEMETHOD3(ImapMailFolderSink, ProgressStatusString, nsIImapProtocol*, const char*, const PRUnichar *)</span>
<a href="#l127.13"></a><span id="l127.13" class="difflineminus">-NS_SYNCRUNNABLEMETHOD4(ImapMailFolderSink, PercentProgress, nsIImapProtocol*, const PRUnichar *, int64_t, int64_t)</span>
<a href="#l127.14"></a><span id="l127.14" class="difflineplus">+NS_SYNCRUNNABLEMETHOD3(ImapMailFolderSink, ProgressStatusString, nsIImapProtocol*, const char*, const char16_t *)</span>
<a href="#l127.15"></a><span id="l127.15" class="difflineplus">+NS_SYNCRUNNABLEMETHOD4(ImapMailFolderSink, PercentProgress, nsIImapProtocol*, const char16_t *, int64_t, int64_t)</span>
<a href="#l127.16"></a><span id="l127.16"> NS_SYNCRUNNABLEMETHOD0(ImapMailFolderSink, ClearFolderRights)</span>
<a href="#l127.17"></a><span id="l127.17"> NS_SYNCRUNNABLEMETHOD2(ImapMailFolderSink, SetCopyResponseUid, const char *, nsIImapUrl *)</span>
<a href="#l127.18"></a><span id="l127.18"> NS_SYNCRUNNABLEMETHOD2(ImapMailFolderSink, SetAppendMsgUid, nsMsgKey, nsIImapUrl *)</span>
<a href="#l127.19"></a><span id="l127.19"> NS_SYNCRUNNABLEMETHOD2(ImapMailFolderSink, GetMessageId, nsIImapUrl *, nsACString &amp;)</span>
<a href="#l127.20"></a><span id="l127.20"> </span>
<a href="#l127.21"></a><span id="l127.21"> NS_SYNCRUNNABLEMETHOD2(ImapMessageSink, SetupMsgWriteStream, nsIFile *, bool)</span>
<a href="#l127.22"></a><span id="l127.22"> NS_SYNCRUNNABLEMETHOD3(ImapMessageSink, ParseAdoptedMsgLine, const char *, nsMsgKey, nsIImapUrl *)</span>
<a href="#l127.23"></a><span id="l127.23"> NS_SYNCRUNNABLEMETHOD4(ImapMessageSink, NormalEndMsgWriteStream, nsMsgKey, bool, nsIImapUrl *, int32_t)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l128.1"></a><span id="l128.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l128.2"></a><span id="l128.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l128.3"></a><span id="l128.3" class="difflineat">@@ -66,23 +66,23 @@ nsAppleMailImportModule::~nsAppleMailImp</span>
<a href="#l128.4"></a><span id="l128.4"> {</span>
<a href="#l128.5"></a><span id="l128.5">   IMPORT_LOG0(&quot;nsAppleMailImportModule Deleted&quot;);</span>
<a href="#l128.6"></a><span id="l128.6"> }</span>
<a href="#l128.7"></a><span id="l128.7"> </span>
<a href="#l128.8"></a><span id="l128.8"> </span>
<a href="#l128.9"></a><span id="l128.9"> NS_IMPL_ISUPPORTS1(nsAppleMailImportModule, nsIImportModule)</span>
<a href="#l128.10"></a><span id="l128.10"> </span>
<a href="#l128.11"></a><span id="l128.11"> </span>
<a href="#l128.12"></a><span id="l128.12" class="difflineminus">-NS_IMETHODIMP nsAppleMailImportModule::GetName(PRUnichar **aName)</span>
<a href="#l128.13"></a><span id="l128.13" class="difflineplus">+NS_IMETHODIMP nsAppleMailImportModule::GetName(char16_t **aName)</span>
<a href="#l128.14"></a><span id="l128.14"> {</span>
<a href="#l128.15"></a><span id="l128.15">   return mBundle ? </span>
<a href="#l128.16"></a><span id="l128.16">     mBundle-&gt;GetStringFromID(APPLEMAILIMPORT_NAME, aName) : NS_ERROR_FAILURE;</span>
<a href="#l128.17"></a><span id="l128.17"> }</span>
<a href="#l128.18"></a><span id="l128.18"> </span>
<a href="#l128.19"></a><span id="l128.19" class="difflineminus">-NS_IMETHODIMP nsAppleMailImportModule::GetDescription(PRUnichar **aName)</span>
<a href="#l128.20"></a><span id="l128.20" class="difflineplus">+NS_IMETHODIMP nsAppleMailImportModule::GetDescription(char16_t **aName)</span>
<a href="#l128.21"></a><span id="l128.21"> {</span>
<a href="#l128.22"></a><span id="l128.22">   return mBundle ? </span>
<a href="#l128.23"></a><span id="l128.23">     mBundle-&gt;GetStringFromID(APPLEMAILIMPORT_DESCRIPTION, aName) : NS_ERROR_FAILURE;</span>
<a href="#l128.24"></a><span id="l128.24"> }</span>
<a href="#l128.25"></a><span id="l128.25"> </span>
<a href="#l128.26"></a><span id="l128.26"> NS_IMETHODIMP nsAppleMailImportModule::GetSupports(char **aSupports)</span>
<a href="#l128.27"></a><span id="l128.27"> {</span>
<a href="#l128.28"></a><span id="l128.28">   NS_ENSURE_ARG_POINTER(aSupports);</span>
<a href="#l128.29"></a><span id="l128.29" class="difflineat">@@ -467,18 +467,18 @@ nsresult nsAppleMailImportMail::FindMbox</span>
<a href="#l128.30"></a><span id="l128.30">   } </span>
<a href="#l128.31"></a><span id="l128.31"> </span>
<a href="#l128.32"></a><span id="l128.32">   return NS_OK;</span>
<a href="#l128.33"></a><span id="l128.33"> }</span>
<a href="#l128.34"></a><span id="l128.34"> </span>
<a href="#l128.35"></a><span id="l128.35"> NS_IMETHODIMP</span>
<a href="#l128.36"></a><span id="l128.36"> nsAppleMailImportMail::ImportMailbox(nsIImportMailboxDescriptor *aMailbox,</span>
<a href="#l128.37"></a><span id="l128.37">                                      nsIMsgFolder *aDstFolder,</span>
<a href="#l128.38"></a><span id="l128.38" class="difflineminus">-                                     PRUnichar **aErrorLog,</span>
<a href="#l128.39"></a><span id="l128.39" class="difflineminus">-                                     PRUnichar **aSuccessLog, bool *aFatalError)</span>
<a href="#l128.40"></a><span id="l128.40" class="difflineplus">+                                     char16_t **aErrorLog,</span>
<a href="#l128.41"></a><span id="l128.41" class="difflineplus">+                                     char16_t **aSuccessLog, bool *aFatalError)</span>
<a href="#l128.42"></a><span id="l128.42"> {</span>
<a href="#l128.43"></a><span id="l128.43">   nsAutoString errorLog, successLog;</span>
<a href="#l128.44"></a><span id="l128.44"> </span>
<a href="#l128.45"></a><span id="l128.45">   // reset progress</span>
<a href="#l128.46"></a><span id="l128.46">   mProgress = 0;</span>
<a href="#l128.47"></a><span id="l128.47"> </span>
<a href="#l128.48"></a><span id="l128.48">   nsAutoString mailboxName;</span>
<a href="#l128.49"></a><span id="l128.49">   aMailbox-&gt;GetDisplayName(getter_Copies(mailboxName));</span>
<a href="#l128.50"></a><span id="l128.50" class="difflineat">@@ -597,26 +597,26 @@ nsAppleMailImportMail::ImportMailbox(nsI</span>
<a href="#l128.51"></a><span id="l128.51"> </span>
<a href="#l128.52"></a><span id="l128.52">   return NS_OK;</span>
<a href="#l128.53"></a><span id="l128.53"> }</span>
<a href="#l128.54"></a><span id="l128.54"> </span>
<a href="#l128.55"></a><span id="l128.55"> void nsAppleMailImportMail::ReportStatus(int32_t aErrorNum, nsString &amp;aName, nsAString &amp;aStream)</span>
<a href="#l128.56"></a><span id="l128.56"> {</span>
<a href="#l128.57"></a><span id="l128.57">   // get (and format, if needed) the error string from the bundle  </span>
<a href="#l128.58"></a><span id="l128.58">   nsAutoString outString;</span>
<a href="#l128.59"></a><span id="l128.59" class="difflineminus">-  const PRUnichar *fmt = { aName.get() };</span>
<a href="#l128.60"></a><span id="l128.60" class="difflineplus">+  const char16_t *fmt = { aName.get() };</span>
<a href="#l128.61"></a><span id="l128.61">   nsresult rv = mBundle-&gt;FormatStringFromID(aErrorNum, &amp;fmt, 1, getter_Copies(outString));</span>
<a href="#l128.62"></a><span id="l128.62">   // write it out the stream</span>
<a href="#l128.63"></a><span id="l128.63">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l128.64"></a><span id="l128.64">     aStream.Append(outString);</span>
<a href="#l128.65"></a><span id="l128.65" class="difflineminus">-    aStream.Append(PRUnichar('\n'));</span>
<a href="#l128.66"></a><span id="l128.66" class="difflineplus">+    aStream.Append(char16_t('\n'));</span>
<a href="#l128.67"></a><span id="l128.67">   }</span>
<a href="#l128.68"></a><span id="l128.68"> }</span>
<a href="#l128.69"></a><span id="l128.69"> </span>
<a href="#l128.70"></a><span id="l128.70" class="difflineminus">-void nsAppleMailImportMail::SetLogs(const nsAString &amp;aSuccess, const nsAString &amp;aError, PRUnichar **aOutSuccess, PRUnichar **aOutError)</span>
<a href="#l128.71"></a><span id="l128.71" class="difflineplus">+void nsAppleMailImportMail::SetLogs(const nsAString &amp;aSuccess, const nsAString &amp;aError, char16_t **aOutSuccess, char16_t **aOutError)</span>
<a href="#l128.72"></a><span id="l128.72"> {</span>
<a href="#l128.73"></a><span id="l128.73">   if (aOutError &amp;&amp; !*aOutError)</span>
<a href="#l128.74"></a><span id="l128.74">     *aOutError = ToNewUnicode(aError);</span>
<a href="#l128.75"></a><span id="l128.75">   if (aOutSuccess &amp;&amp; !*aOutSuccess)</span>
<a href="#l128.76"></a><span id="l128.76">     *aOutSuccess = ToNewUnicode(aSuccess);</span>
<a href="#l128.77"></a><span id="l128.77"> }</span>
<a href="#l128.78"></a><span id="l128.78"> </span>
<a href="#l128.79"></a><span id="l128.79"> NS_IMETHODIMP nsAppleMailImportMail::GetImportProgress(uint32_t *aDoneSoFar)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l129.1"></a><span id="l129.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.h</span>
<a href="#l129.2"></a><span id="l129.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.h</span>
<a href="#l129.3"></a><span id="l129.3" class="difflineat">@@ -63,16 +63,16 @@ class nsAppleMailImportMail : public nsI</span>
<a href="#l129.4"></a><span id="l129.4">   private:</span>
<a href="#l129.5"></a><span id="l129.5"> </span>
<a href="#l129.6"></a><span id="l129.6">   void FindAccountMailDirs(nsIFile *aRoot, nsIMutableArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l129.7"></a><span id="l129.7">   nsresult FindMboxDirs(nsIFile *aFolder, nsIMutableArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l129.8"></a><span id="l129.8">   nsresult AddMboxDir(nsIFile *aFolder, nsIMutableArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l129.9"></a><span id="l129.9">     </span>
<a href="#l129.10"></a><span id="l129.10">   // aInfoString is the format to a &quot;foo %s&quot; string. It may be NULL if the error string needs no such format.</span>
<a href="#l129.11"></a><span id="l129.11">   void ReportStatus(int32_t aErrorNum, nsString &amp;aName, nsAString &amp;aStream);</span>
<a href="#l129.12"></a><span id="l129.12" class="difflineminus">-  static void SetLogs(const nsAString&amp; success, const nsAString&amp; error, PRUnichar **aOutErrorLog, PRUnichar **aSuccessLog);</span>
<a href="#l129.13"></a><span id="l129.13" class="difflineplus">+  static void SetLogs(const nsAString&amp; success, const nsAString&amp; error, char16_t **aOutErrorLog, char16_t **aSuccessLog);</span>
<a href="#l129.14"></a><span id="l129.14"> </span>
<a href="#l129.15"></a><span id="l129.15">   nsCOMPtr&lt;nsIStringBundle&gt;  mBundle;</span>
<a href="#l129.16"></a><span id="l129.16">   uint32_t                   mProgress;</span>
<a href="#l129.17"></a><span id="l129.17">   uint16_t                   mCurDepth;</span>
<a href="#l129.18"></a><span id="l129.18"> };</span>
<a href="#l129.19"></a><span id="l129.19"> </span>
<a href="#l129.20"></a><span id="l129.20"> #endif /* nsAppleMailImport_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l130.1"></a><span id="l130.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l130.2"></a><span id="l130.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l130.3"></a><span id="l130.3" class="difflineat">@@ -80,17 +80,17 @@ nsEudoraAddress::nsEudoraAddress()</span>
<a href="#l130.4"></a><span id="l130.4"> </span>
<a href="#l130.5"></a><span id="l130.5"> nsEudoraAddress::~nsEudoraAddress()</span>
<a href="#l130.6"></a><span id="l130.6"> {</span>
<a href="#l130.7"></a><span id="l130.7">   EmptyAliases();</span>
<a href="#l130.8"></a><span id="l130.8"> }</span>
<a href="#l130.9"></a><span id="l130.9"> </span>
<a href="#l130.10"></a><span id="l130.10"> </span>
<a href="#l130.11"></a><span id="l130.11"> nsresult nsEudoraAddress::ImportAddresses(uint32_t *pBytes, bool *pAbort,</span>
<a href="#l130.12"></a><span id="l130.12" class="difflineminus">-                                          const PRUnichar *pName, nsIFile *pSrc,</span>
<a href="#l130.13"></a><span id="l130.13" class="difflineplus">+                                          const char16_t *pName, nsIFile *pSrc,</span>
<a href="#l130.14"></a><span id="l130.14">                                           nsIAddrDatabase *pDb, nsString&amp; errors)</span>
<a href="#l130.15"></a><span id="l130.15"> {</span>
<a href="#l130.16"></a><span id="l130.16">   // Open the source file for reading, read each line and process it!</span>
<a href="#l130.17"></a><span id="l130.17"> </span>
<a href="#l130.18"></a><span id="l130.18">   EmptyAliases();</span>
<a href="#l130.19"></a><span id="l130.19">   nsCOMPtr&lt;nsIInputStream&gt; inputStream;</span>
<a href="#l130.20"></a><span id="l130.20">   nsresult rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), pSrc);</span>
<a href="#l130.21"></a><span id="l130.21">   if (NS_FAILED(rv)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l131.1"></a><span id="l131.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l131.2"></a><span id="l131.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l131.3"></a><span id="l131.3" class="difflineat">@@ -33,17 +33,17 @@ public:</span>
<a href="#l131.4"></a><span id="l131.4">   // Things that must be overridden because they are platform specific.</span>
<a href="#l131.5"></a><span id="l131.5">     // retrieve the mail folder</span>
<a href="#l131.6"></a><span id="l131.6">   virtual bool      FindAddressFolder(nsIFile **pFolder) { return false;}</span>
<a href="#l131.7"></a><span id="l131.7">     // get the list of mailboxes</span>
<a href="#l131.8"></a><span id="l131.8">   virtual nsresult  FindAddressBooks(nsIFile *pRoot, nsIMutableArray *pArray) { return NS_ERROR_FAILURE;}</span>
<a href="#l131.9"></a><span id="l131.9"> </span>
<a href="#l131.10"></a><span id="l131.10">   // Non-platform specific common stuff</span>
<a href="#l131.11"></a><span id="l131.11">     // import a mailbox</span>
<a href="#l131.12"></a><span id="l131.12" class="difflineminus">-  nsresult ImportAddresses(uint32_t *pBytes, bool *pAbort, const PRUnichar *pName, nsIFile *pSrc, nsIAddrDatabase *pDb, nsString&amp; errors);</span>
<a href="#l131.13"></a><span id="l131.13" class="difflineplus">+  nsresult ImportAddresses(uint32_t *pBytes, bool *pAbort, const char16_t *pName, nsIFile *pSrc, nsIAddrDatabase *pDb, nsString&amp; errors);</span>
<a href="#l131.14"></a><span id="l131.14"> </span>
<a href="#l131.15"></a><span id="l131.15"> </span>
<a href="#l131.16"></a><span id="l131.16"> private:</span>
<a href="#l131.17"></a><span id="l131.17">   void       EmptyAliases(void);</span>
<a href="#l131.18"></a><span id="l131.18">   void      ProcessLine(const char *pLine, int32_t len, nsString&amp; errors);</span>
<a href="#l131.19"></a><span id="l131.19">   int32_t     CountWhiteSpace(const char *pLine, int32_t len);</span>
<a href="#l131.20"></a><span id="l131.20">   CAliasEntry  *  ProcessAlias(const char *pLine, int32_t len, nsString&amp; errors);</span>
<a href="#l131.21"></a><span id="l131.21">   void      ProcessNote(const char *pLine, int32_t len, nsString&amp; errors);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l132.1"></a><span id="l132.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l132.2"></a><span id="l132.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l132.3"></a><span id="l132.3" class="difflineat">@@ -105,20 +105,20 @@ public:</span>
<a href="#l132.4"></a><span id="l132.4"> </span>
<a href="#l132.5"></a><span id="l132.5">   /* void OnStartSending (in string aMsgID, in uint32_t aMsgSize); */</span>
<a href="#l132.6"></a><span id="l132.6">   NS_IMETHOD OnStartSending(const char *aMsgID, uint32_t aMsgSize) {return NS_OK;}</span>
<a href="#l132.7"></a><span id="l132.7"> </span>
<a href="#l132.8"></a><span id="l132.8">   /* void OnProgress (in string aMsgID, in uint32_t aProgress, in uint32_t aProgressMax); */</span>
<a href="#l132.9"></a><span id="l132.9">   NS_IMETHOD OnProgress(const char *aMsgID, uint32_t aProgress, uint32_t aProgressMax) {return NS_OK;}</span>
<a href="#l132.10"></a><span id="l132.10"> </span>
<a href="#l132.11"></a><span id="l132.11">   /* void OnStatus (in string aMsgID, in wstring aMsg); */</span>
<a href="#l132.12"></a><span id="l132.12" class="difflineminus">-  NS_IMETHOD OnStatus(const char *aMsgID, const PRUnichar *aMsg) {return NS_OK;}</span>
<a href="#l132.13"></a><span id="l132.13" class="difflineplus">+  NS_IMETHOD OnStatus(const char *aMsgID, const char16_t *aMsg) {return NS_OK;}</span>
<a href="#l132.14"></a><span id="l132.14"> </span>
<a href="#l132.15"></a><span id="l132.15">   /* void OnStopSending (in string aMsgID, in nsresult aStatus, in wstring aMsg, in nsIFile returnFile); */</span>
<a href="#l132.16"></a><span id="l132.16" class="difflineminus">-  NS_IMETHOD OnStopSending(const char *aMsgID, nsresult aStatus, const PRUnichar *aMsg,</span>
<a href="#l132.17"></a><span id="l132.17" class="difflineplus">+  NS_IMETHOD OnStopSending(const char *aMsgID, nsresult aStatus, const char16_t *aMsg,</span>
<a href="#l132.18"></a><span id="l132.18">                nsIFile *returnFile) {</span>
<a href="#l132.19"></a><span id="l132.19">     m_done = true;</span>
<a href="#l132.20"></a><span id="l132.20">     m_location = returnFile;</span>
<a href="#l132.21"></a><span id="l132.21">     return NS_OK;</span>
<a href="#l132.22"></a><span id="l132.22">   }</span>
<a href="#l132.23"></a><span id="l132.23"> </span>
<a href="#l132.24"></a><span id="l132.24">     /* void OnSendNotPerformed */</span>
<a href="#l132.25"></a><span id="l132.25">     NS_IMETHOD OnSendNotPerformed(const char *aMsgID, nsresult aStatus) {return NS_OK;}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l133.1"></a><span id="l133.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l133.2"></a><span id="l133.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l133.3"></a><span id="l133.3" class="difflineat">@@ -54,17 +54,17 @@ nsEudoraFilters::nsEudoraFilters()</span>
<a href="#l133.4"></a><span id="l133.4"> }</span>
<a href="#l133.5"></a><span id="l133.5"> </span>
<a href="#l133.6"></a><span id="l133.6"> nsEudoraFilters::~nsEudoraFilters()</span>
<a href="#l133.7"></a><span id="l133.7"> {</span>
<a href="#l133.8"></a><span id="l133.8"> }</span>
<a href="#l133.9"></a><span id="l133.9"> </span>
<a href="#l133.10"></a><span id="l133.10"> NS_IMPL_ISUPPORTS1(nsEudoraFilters, nsIImportFilters)</span>
<a href="#l133.11"></a><span id="l133.11"> </span>
<a href="#l133.12"></a><span id="l133.12" class="difflineminus">-NS_IMETHODIMP nsEudoraFilters::AutoLocate(PRUnichar **aDescription, nsIFile **aLocation, bool *_retval)</span>
<a href="#l133.13"></a><span id="l133.13" class="difflineplus">+NS_IMETHODIMP nsEudoraFilters::AutoLocate(char16_t **aDescription, nsIFile **aLocation, bool *_retval)</span>
<a href="#l133.14"></a><span id="l133.14"> {</span>
<a href="#l133.15"></a><span id="l133.15">   NS_ENSURE_ARG_POINTER(aDescription);</span>
<a href="#l133.16"></a><span id="l133.16">   NS_ENSURE_ARG_POINTER(aLocation);</span>
<a href="#l133.17"></a><span id="l133.17">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l133.18"></a><span id="l133.18"> </span>
<a href="#l133.19"></a><span id="l133.19">   *aDescription = nullptr;</span>
<a href="#l133.20"></a><span id="l133.20">   *_retval = false;</span>
<a href="#l133.21"></a><span id="l133.21"> </span>
<a href="#l133.22"></a><span id="l133.22" class="difflineat">@@ -87,17 +87,17 @@ NS_IMETHODIMP nsEudoraFilters::AutoLocat</span>
<a href="#l133.23"></a><span id="l133.23"> </span>
<a href="#l133.24"></a><span id="l133.24"> NS_IMETHODIMP nsEudoraFilters::SetLocation(nsIFile *aLocation)</span>
<a href="#l133.25"></a><span id="l133.25"> {</span>
<a href="#l133.26"></a><span id="l133.26">   m_pLocation = aLocation;</span>
<a href="#l133.27"></a><span id="l133.27"> </span>
<a href="#l133.28"></a><span id="l133.28">   return NS_OK;</span>
<a href="#l133.29"></a><span id="l133.29"> }</span>
<a href="#l133.30"></a><span id="l133.30"> </span>
<a href="#l133.31"></a><span id="l133.31" class="difflineminus">-NS_IMETHODIMP nsEudoraFilters::Import(PRUnichar **aError, bool *_retval)</span>
<a href="#l133.32"></a><span id="l133.32" class="difflineplus">+NS_IMETHODIMP nsEudoraFilters::Import(char16_t **aError, bool *_retval)</span>
<a href="#l133.33"></a><span id="l133.33"> {</span>
<a href="#l133.34"></a><span id="l133.34">   NS_ENSURE_ARG_POINTER(aError);</span>
<a href="#l133.35"></a><span id="l133.35">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l133.36"></a><span id="l133.36">   nsresult rv;</span>
<a href="#l133.37"></a><span id="l133.37"> </span>
<a href="#l133.38"></a><span id="l133.38">   *_retval = false;</span>
<a href="#l133.39"></a><span id="l133.39">   *aError = nullptr;</span>
<a href="#l133.40"></a><span id="l133.40"> </span>
<a href="#l133.41"></a><span id="l133.41" class="difflineat">@@ -364,17 +364,17 @@ nsresult nsEudoraFilters::Init()</span>
<a href="#l133.42"></a><span id="l133.42">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l133.43"></a><span id="l133.43"> </span>
<a href="#l133.44"></a><span id="l133.44">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l133.45"></a><span id="l133.45">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/importMsgs.properties&quot;,</span>
<a href="#l133.46"></a><span id="l133.46">                                    getter_AddRefs(bundle));</span>
<a href="#l133.47"></a><span id="l133.47">   if (NS_SUCCEEDED(rv))</span>
<a href="#l133.48"></a><span id="l133.48">   {</span>
<a href="#l133.49"></a><span id="l133.49">     nsAutoString Eudora(NS_LITERAL_STRING(&quot;Eudora&quot;));</span>
<a href="#l133.50"></a><span id="l133.50" class="difflineminus">-    const PRUnichar *moduleName[] = { Eudora.get() };</span>
<a href="#l133.51"></a><span id="l133.51" class="difflineplus">+    const char16_t *moduleName[] = { Eudora.get() };</span>
<a href="#l133.52"></a><span id="l133.52">     rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;ImportModuleFolderName&quot;),</span>
<a href="#l133.53"></a><span id="l133.53">                                       moduleName, 1, getter_Copies(folderName));</span>
<a href="#l133.54"></a><span id="l133.54">   }</span>
<a href="#l133.55"></a><span id="l133.55">   localRootFolder-&gt;GetChildNamed(folderName, getter_AddRefs(m_pMailboxesRoot));</span>
<a href="#l133.56"></a><span id="l133.56">   if (!m_pMailboxesRoot)</span>
<a href="#l133.57"></a><span id="l133.57">   {</span>
<a href="#l133.58"></a><span id="l133.58">     // If no &quot;Eudora Import&quot; folder then this is a</span>
<a href="#l133.59"></a><span id="l133.59">     // migration which just puts it in the root</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l134.1"></a><span id="l134.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l134.2"></a><span id="l134.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l134.3"></a><span id="l134.3" class="difflineat">@@ -76,27 +76,27 @@ public:</span>
<a href="#l134.4"></a><span id="l134.4">   /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l134.5"></a><span id="l134.5">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l134.6"></a><span id="l134.6"> </span>
<a href="#l134.7"></a><span id="l134.7">   /* nsIArray FindMailboxes (in nsIFile location); */</span>
<a href="#l134.8"></a><span id="l134.8">   NS_IMETHOD FindMailboxes(nsIFile *location, nsIArray **_retval);</span>
<a href="#l134.9"></a><span id="l134.9"> </span>
<a href="#l134.10"></a><span id="l134.10">   NS_IMETHOD ImportMailbox(nsIImportMailboxDescriptor *source,</span>
<a href="#l134.11"></a><span id="l134.11">                            nsIMsgFolder *dstFolder,</span>
<a href="#l134.12"></a><span id="l134.12" class="difflineminus">-                           PRUnichar **pErrorLog, PRUnichar **pSuccessLog,</span>
<a href="#l134.13"></a><span id="l134.13" class="difflineplus">+                           char16_t **pErrorLog, char16_t **pSuccessLog,</span>
<a href="#l134.14"></a><span id="l134.14">                            bool *fatalError);</span>
<a href="#l134.15"></a><span id="l134.15"> </span>
<a href="#l134.16"></a><span id="l134.16">   /* unsigned long GetImportProgress (); */</span>
<a href="#l134.17"></a><span id="l134.17">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l134.18"></a><span id="l134.18"> </span>
<a href="#l134.19"></a><span id="l134.19">   NS_IMETHOD TranslateFolderName(const nsAString &amp; aFolderName, nsAString &amp; _retval);</span>
<a href="#l134.20"></a><span id="l134.20"> </span>
<a href="#l134.21"></a><span id="l134.21"> public:</span>
<a href="#l134.22"></a><span id="l134.22">   static void  AddLinebreak(nsString *pStream);</span>
<a href="#l134.23"></a><span id="l134.23" class="difflineminus">-  static void  SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess);</span>
<a href="#l134.24"></a><span id="l134.24" class="difflineplus">+  static void  SetLogs(nsString&amp; success, nsString&amp; error, char16_t **pError, char16_t **pSuccess);</span>
<a href="#l134.25"></a><span id="l134.25">   static void ReportError(int32_t errorNum, nsString&amp; name, nsString *pStream);</span>
<a href="#l134.26"></a><span id="l134.26"> </span>
<a href="#l134.27"></a><span id="l134.27"> </span>
<a href="#l134.28"></a><span id="l134.28"> private:</span>
<a href="#l134.29"></a><span id="l134.29">   static void  ReportSuccess(nsString&amp; name, int32_t count, nsString *pStream);</span>
<a href="#l134.30"></a><span id="l134.30"> </span>
<a href="#l134.31"></a><span id="l134.31"> private:</span>
<a href="#l134.32"></a><span id="l134.32"> #if defined(XP_WIN) || defined(XP_OS2)</span>
<a href="#l134.33"></a><span id="l134.33" class="difflineat">@@ -119,38 +119,38 @@ public:</span>
<a href="#l134.34"></a><span id="l134.34"> </span>
<a href="#l134.35"></a><span id="l134.35">   // nsISupports interface</span>
<a href="#l134.36"></a><span id="l134.36">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l134.37"></a><span id="l134.37"> </span>
<a href="#l134.38"></a><span id="l134.38">   // nsIImportAddressBooks interface</span>
<a href="#l134.39"></a><span id="l134.39"> </span>
<a href="#l134.40"></a><span id="l134.40">   NS_IMETHOD GetSupportsMultiple(bool *_retval) { *_retval = true; return NS_OK;}</span>
<a href="#l134.41"></a><span id="l134.41"> </span>
<a href="#l134.42"></a><span id="l134.42" class="difflineminus">-  NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l134.43"></a><span id="l134.43" class="difflineplus">+  NS_IMETHOD GetAutoFind(char16_t **description, bool *_retval);</span>
<a href="#l134.44"></a><span id="l134.44"> </span>
<a href="#l134.45"></a><span id="l134.45">   NS_IMETHOD GetNeedsFieldMap(nsIFile *location, bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l134.46"></a><span id="l134.46"> </span>
<a href="#l134.47"></a><span id="l134.47">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l134.48"></a><span id="l134.48"> </span>
<a href="#l134.49"></a><span id="l134.49">   NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l134.50"></a><span id="l134.50"> </span>
<a href="#l134.51"></a><span id="l134.51">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap)</span>
<a href="#l134.52"></a><span id="l134.52">     { return NS_ERROR_FAILURE; }</span>
<a href="#l134.53"></a><span id="l134.53"> </span>
<a href="#l134.54"></a><span id="l134.54">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l134.55"></a><span id="l134.55">                                nsIAddrDatabase *destination,</span>
<a href="#l134.56"></a><span id="l134.56">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l134.57"></a><span id="l134.57">                                nsISupports *aSupportService,</span>
<a href="#l134.58"></a><span id="l134.58" class="difflineminus">-                               PRUnichar **errorLog,</span>
<a href="#l134.59"></a><span id="l134.59" class="difflineminus">-                               PRUnichar **successLog,</span>
<a href="#l134.60"></a><span id="l134.60" class="difflineplus">+                               char16_t **errorLog,</span>
<a href="#l134.61"></a><span id="l134.61" class="difflineplus">+                               char16_t **successLog,</span>
<a href="#l134.62"></a><span id="l134.62">                                bool *fatalError);</span>
<a href="#l134.63"></a><span id="l134.63"> </span>
<a href="#l134.64"></a><span id="l134.64">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l134.65"></a><span id="l134.65"> </span>
<a href="#l134.66"></a><span id="l134.66" class="difflineminus">-  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, PRUnichar **pStr)</span>
<a href="#l134.67"></a><span id="l134.67" class="difflineplus">+  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, char16_t **pStr)</span>
<a href="#l134.68"></a><span id="l134.68">     { return NS_ERROR_FAILURE;}</span>
<a href="#l134.69"></a><span id="l134.69"> </span>
<a href="#l134.70"></a><span id="l134.70">   NS_IMETHOD SetSampleLocation(nsIFile *) { return NS_OK; }</span>
<a href="#l134.71"></a><span id="l134.71"> </span>
<a href="#l134.72"></a><span id="l134.72"> private:</span>
<a href="#l134.73"></a><span id="l134.73">   static void  ReportSuccess(nsString&amp; name, nsString *pStream);</span>
<a href="#l134.74"></a><span id="l134.74"> </span>
<a href="#l134.75"></a><span id="l134.75"> private:</span>
<a href="#l134.76"></a><span id="l134.76" class="difflineat">@@ -183,28 +183,28 @@ nsEudoraImport::~nsEudoraImport()</span>
<a href="#l134.77"></a><span id="l134.77">   IMPORT_LOG0(&quot;nsEudoraImport Module Deleted\n&quot;);</span>
<a href="#l134.78"></a><span id="l134.78"> }</span>
<a href="#l134.79"></a><span id="l134.79"> </span>
<a href="#l134.80"></a><span id="l134.80"> </span>
<a href="#l134.81"></a><span id="l134.81"> </span>
<a href="#l134.82"></a><span id="l134.82"> NS_IMPL_ISUPPORTS1(nsEudoraImport, nsIImportModule)</span>
<a href="#l134.83"></a><span id="l134.83"> </span>
<a href="#l134.84"></a><span id="l134.84"> </span>
<a href="#l134.85"></a><span id="l134.85" class="difflineminus">-NS_IMETHODIMP nsEudoraImport::GetName(PRUnichar **name)</span>
<a href="#l134.86"></a><span id="l134.86" class="difflineplus">+NS_IMETHODIMP nsEudoraImport::GetName(char16_t **name)</span>
<a href="#l134.87"></a><span id="l134.87"> {</span>
<a href="#l134.88"></a><span id="l134.88">   NS_PRECONDITION(name != nullptr, &quot;null ptr&quot;);</span>
<a href="#l134.89"></a><span id="l134.89">   if (! name)</span>
<a href="#l134.90"></a><span id="l134.90">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l134.91"></a><span id="l134.91"> </span>
<a href="#l134.92"></a><span id="l134.92">   *name = nsEudoraStringBundle::GetStringByID(EUDORAIMPORT_NAME);</span>
<a href="#l134.93"></a><span id="l134.93"> </span>
<a href="#l134.94"></a><span id="l134.94">   return NS_OK;</span>
<a href="#l134.95"></a><span id="l134.95"> }</span>
<a href="#l134.96"></a><span id="l134.96"> </span>
<a href="#l134.97"></a><span id="l134.97" class="difflineminus">-NS_IMETHODIMP nsEudoraImport::GetDescription(PRUnichar **name)</span>
<a href="#l134.98"></a><span id="l134.98" class="difflineplus">+NS_IMETHODIMP nsEudoraImport::GetDescription(char16_t **name)</span>
<a href="#l134.99"></a><span id="l134.99"> {</span>
<a href="#l134.100"></a><span id="l134.100">   NS_PRECONDITION(name != nullptr, &quot;null ptr&quot;);</span>
<a href="#l134.101"></a><span id="l134.101">   if (! name)</span>
<a href="#l134.102"></a><span id="l134.102">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l134.103"></a><span id="l134.103"> </span>
<a href="#l134.104"></a><span id="l134.104">   *name = nsEudoraStringBundle::GetStringByID(EUDORAIMPORT_DESCRIPTION);</span>
<a href="#l134.105"></a><span id="l134.105"> </span>
<a href="#l134.106"></a><span id="l134.106">   return NS_OK;</span>
<a href="#l134.107"></a><span id="l134.107" class="difflineat">@@ -449,70 +449,70 @@ NS_IMETHODIMP ImportEudoraMailImpl::Find</span>
<a href="#l134.108"></a><span id="l134.108">   array.forget(ppArray);</span>
<a href="#l134.109"></a><span id="l134.109"> </span>
<a href="#l134.110"></a><span id="l134.110">   return NS_OK;</span>
<a href="#l134.111"></a><span id="l134.111"> }</span>
<a href="#l134.112"></a><span id="l134.112"> </span>
<a href="#l134.113"></a><span id="l134.113"> void ImportEudoraMailImpl::AddLinebreak(nsString *pStream)</span>
<a href="#l134.114"></a><span id="l134.114"> {</span>
<a href="#l134.115"></a><span id="l134.115">   if (pStream)</span>
<a href="#l134.116"></a><span id="l134.116" class="difflineminus">-    pStream-&gt;Append(PRUnichar('\n'));</span>
<a href="#l134.117"></a><span id="l134.117" class="difflineplus">+    pStream-&gt;Append(char16_t('\n'));</span>
<a href="#l134.118"></a><span id="l134.118"> }</span>
<a href="#l134.119"></a><span id="l134.119"> </span>
<a href="#l134.120"></a><span id="l134.120"> void ImportEudoraMailImpl::ReportSuccess(nsString&amp; name, int32_t count, nsString *pStream)</span>
<a href="#l134.121"></a><span id="l134.121"> {</span>
<a href="#l134.122"></a><span id="l134.122">   if (!pStream)</span>
<a href="#l134.123"></a><span id="l134.123">     return;</span>
<a href="#l134.124"></a><span id="l134.124">   // load the success string</span>
<a href="#l134.125"></a><span id="l134.125" class="difflineminus">-  PRUnichar *pFmt = nsEudoraStringBundle::GetStringByID(EUDORAIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l134.126"></a><span id="l134.126" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get(), count);</span>
<a href="#l134.127"></a><span id="l134.127" class="difflineplus">+  char16_t *pFmt = nsEudoraStringBundle::GetStringByID(EUDORAIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l134.128"></a><span id="l134.128" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get(), count);</span>
<a href="#l134.129"></a><span id="l134.129">   pStream-&gt;Append(pText);</span>
<a href="#l134.130"></a><span id="l134.130">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l134.131"></a><span id="l134.131">   nsEudoraStringBundle::FreeString(pFmt);</span>
<a href="#l134.132"></a><span id="l134.132">   AddLinebreak(pStream);</span>
<a href="#l134.133"></a><span id="l134.133"> }</span>
<a href="#l134.134"></a><span id="l134.134"> </span>
<a href="#l134.135"></a><span id="l134.135"> void ImportEudoraMailImpl::ReportError(int32_t errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l134.136"></a><span id="l134.136"> {</span>
<a href="#l134.137"></a><span id="l134.137">   if (!pStream)</span>
<a href="#l134.138"></a><span id="l134.138">     return;</span>
<a href="#l134.139"></a><span id="l134.139">   // load the error string</span>
<a href="#l134.140"></a><span id="l134.140" class="difflineminus">-  PRUnichar *pFmt = nsEudoraStringBundle::GetStringByID(errorNum);</span>
<a href="#l134.141"></a><span id="l134.141" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l134.142"></a><span id="l134.142" class="difflineplus">+  char16_t *pFmt = nsEudoraStringBundle::GetStringByID(errorNum);</span>
<a href="#l134.143"></a><span id="l134.143" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l134.144"></a><span id="l134.144">   pStream-&gt;Append(pText);</span>
<a href="#l134.145"></a><span id="l134.145">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l134.146"></a><span id="l134.146">   nsEudoraStringBundle::FreeString(pFmt);</span>
<a href="#l134.147"></a><span id="l134.147">   AddLinebreak(pStream);</span>
<a href="#l134.148"></a><span id="l134.148"> }</span>
<a href="#l134.149"></a><span id="l134.149"> </span>
<a href="#l134.150"></a><span id="l134.150"> </span>
<a href="#l134.151"></a><span id="l134.151" class="difflineminus">-void ImportEudoraMailImpl::SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l134.152"></a><span id="l134.152" class="difflineplus">+void ImportEudoraMailImpl::SetLogs(nsString&amp; success, nsString&amp; error, char16_t **pError, char16_t **pSuccess)</span>
<a href="#l134.153"></a><span id="l134.153"> {</span>
<a href="#l134.154"></a><span id="l134.154">   if (pError)</span>
<a href="#l134.155"></a><span id="l134.155">     *pError = ToNewUnicode(error);</span>
<a href="#l134.156"></a><span id="l134.156">   if (pSuccess)</span>
<a href="#l134.157"></a><span id="l134.157">     *pSuccess = ToNewUnicode(success);</span>
<a href="#l134.158"></a><span id="l134.158"> }</span>
<a href="#l134.159"></a><span id="l134.159"> </span>
<a href="#l134.160"></a><span id="l134.160"> NS_IMETHODIMP</span>
<a href="#l134.161"></a><span id="l134.161"> ImportEudoraMailImpl::ImportMailbox(nsIImportMailboxDescriptor *pSource,</span>
<a href="#l134.162"></a><span id="l134.162">                                     nsIMsgFolder *pDstFolder,</span>
<a href="#l134.163"></a><span id="l134.163" class="difflineminus">-                                    PRUnichar **pErrorLog,</span>
<a href="#l134.164"></a><span id="l134.164" class="difflineminus">-                                    PRUnichar **pSuccessLog,</span>
<a href="#l134.165"></a><span id="l134.165" class="difflineplus">+                                    char16_t **pErrorLog,</span>
<a href="#l134.166"></a><span id="l134.166" class="difflineplus">+                                    char16_t **pSuccessLog,</span>
<a href="#l134.167"></a><span id="l134.167">                                     bool *fatalError)</span>
<a href="#l134.168"></a><span id="l134.168"> {</span>
<a href="#l134.169"></a><span id="l134.169">   NS_ENSURE_ARG_POINTER(pSource);</span>
<a href="#l134.170"></a><span id="l134.170">   NS_ENSURE_ARG_POINTER(pDstFolder);</span>
<a href="#l134.171"></a><span id="l134.171">   NS_ENSURE_ARG_POINTER(fatalError);</span>
<a href="#l134.172"></a><span id="l134.172"> </span>
<a href="#l134.173"></a><span id="l134.173">   nsString  success;</span>
<a href="#l134.174"></a><span id="l134.174">   nsString  error;</span>
<a href="#l134.175"></a><span id="l134.175">   bool      abort = false;</span>
<a href="#l134.176"></a><span id="l134.176">   nsString  name;</span>
<a href="#l134.177"></a><span id="l134.177" class="difflineminus">-  PRUnichar *  pName;</span>
<a href="#l134.178"></a><span id="l134.178" class="difflineplus">+  char16_t *  pName;</span>
<a href="#l134.179"></a><span id="l134.179">   if (NS_SUCCEEDED(pSource-&gt;GetDisplayName(&amp;pName)))</span>
<a href="#l134.180"></a><span id="l134.180">   {</span>
<a href="#l134.181"></a><span id="l134.181">     name = pName;</span>
<a href="#l134.182"></a><span id="l134.182">     NS_Free(pName);</span>
<a href="#l134.183"></a><span id="l134.183">   }</span>
<a href="#l134.184"></a><span id="l134.184"> </span>
<a href="#l134.185"></a><span id="l134.185">   uint32_t mailSize = 0;</span>
<a href="#l134.186"></a><span id="l134.186">   pSource-&gt;GetSize(&amp;mailSize);</span>
<a href="#l134.187"></a><span id="l134.187" class="difflineat">@@ -603,17 +603,17 @@ ImportEudoraAddressImpl::~ImportEudoraAd</span>
<a href="#l134.188"></a><span id="l134.188"> {</span>
<a href="#l134.189"></a><span id="l134.189"> }</span>
<a href="#l134.190"></a><span id="l134.190"> </span>
<a href="#l134.191"></a><span id="l134.191"> </span>
<a href="#l134.192"></a><span id="l134.192"> </span>
<a href="#l134.193"></a><span id="l134.193"> NS_IMPL_ISUPPORTS1(ImportEudoraAddressImpl, nsIImportAddressBooks)</span>
<a href="#l134.194"></a><span id="l134.194"> </span>
<a href="#l134.195"></a><span id="l134.195"> </span>
<a href="#l134.196"></a><span id="l134.196" class="difflineminus">-NS_IMETHODIMP ImportEudoraAddressImpl::GetAutoFind(PRUnichar **description, bool *_retval)</span>
<a href="#l134.197"></a><span id="l134.197" class="difflineplus">+NS_IMETHODIMP ImportEudoraAddressImpl::GetAutoFind(char16_t **description, bool *_retval)</span>
<a href="#l134.198"></a><span id="l134.198"> {</span>
<a href="#l134.199"></a><span id="l134.199">   NS_PRECONDITION(description != nullptr, &quot;null ptr&quot;);</span>
<a href="#l134.200"></a><span id="l134.200">   NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l134.201"></a><span id="l134.201">   if (! description || !_retval)</span>
<a href="#l134.202"></a><span id="l134.202">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l134.203"></a><span id="l134.203"> </span>
<a href="#l134.204"></a><span id="l134.204">   nsString  str;</span>
<a href="#l134.205"></a><span id="l134.205">   *_retval = false;</span>
<a href="#l134.206"></a><span id="l134.206" class="difflineat">@@ -670,32 +670,32 @@ NS_IMETHODIMP ImportEudoraAddressImpl::F</span>
<a href="#l134.207"></a><span id="l134.207"> </span>
<a href="#l134.208"></a><span id="l134.208"> </span>
<a href="#l134.209"></a><span id="l134.209"> </span>
<a href="#l134.210"></a><span id="l134.210"> void ImportEudoraAddressImpl::ReportSuccess(nsString&amp; name, nsString *pStream)</span>
<a href="#l134.211"></a><span id="l134.211"> {</span>
<a href="#l134.212"></a><span id="l134.212">   if (!pStream)</span>
<a href="#l134.213"></a><span id="l134.213">     return;</span>
<a href="#l134.214"></a><span id="l134.214">   // load the success string</span>
<a href="#l134.215"></a><span id="l134.215" class="difflineminus">-  PRUnichar *pFmt = nsEudoraStringBundle::GetStringByID(EUDORAIMPORT_ADDRESS_SUCCESS);</span>
<a href="#l134.216"></a><span id="l134.216" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l134.217"></a><span id="l134.217" class="difflineplus">+  char16_t *pFmt = nsEudoraStringBundle::GetStringByID(EUDORAIMPORT_ADDRESS_SUCCESS);</span>
<a href="#l134.218"></a><span id="l134.218" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l134.219"></a><span id="l134.219">   pStream-&gt;Append(pText);</span>
<a href="#l134.220"></a><span id="l134.220">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l134.221"></a><span id="l134.221">   nsEudoraStringBundle::FreeString(pFmt);</span>
<a href="#l134.222"></a><span id="l134.222">   ImportEudoraMailImpl::AddLinebreak(pStream);</span>
<a href="#l134.223"></a><span id="l134.223"> }</span>
<a href="#l134.224"></a><span id="l134.224"> </span>
<a href="#l134.225"></a><span id="l134.225"> </span>
<a href="#l134.226"></a><span id="l134.226"> NS_IMETHODIMP</span>
<a href="#l134.227"></a><span id="l134.227"> ImportEudoraAddressImpl::ImportAddressBook(nsIImportABDescriptor *pSource,</span>
<a href="#l134.228"></a><span id="l134.228">                                            nsIAddrDatabase *pDestination,</span>
<a href="#l134.229"></a><span id="l134.229">                                            nsIImportFieldMap *fieldMap,</span>
<a href="#l134.230"></a><span id="l134.230">                                            nsISupports *aSupportService,</span>
<a href="#l134.231"></a><span id="l134.231" class="difflineminus">-                                           PRUnichar **pErrorLog,</span>
<a href="#l134.232"></a><span id="l134.232" class="difflineminus">-                                           PRUnichar **pSuccessLog,</span>
<a href="#l134.233"></a><span id="l134.233" class="difflineplus">+                                           char16_t **pErrorLog,</span>
<a href="#l134.234"></a><span id="l134.234" class="difflineplus">+                                           char16_t **pSuccessLog,</span>
<a href="#l134.235"></a><span id="l134.235">                                            bool *fatalError)</span>
<a href="#l134.236"></a><span id="l134.236"> {</span>
<a href="#l134.237"></a><span id="l134.237">   NS_PRECONDITION(pSource != nullptr, &quot;null ptr&quot;);</span>
<a href="#l134.238"></a><span id="l134.238">   NS_PRECONDITION(pDestination != nullptr, &quot;null ptr&quot;);</span>
<a href="#l134.239"></a><span id="l134.239">   NS_PRECONDITION(fatalError != nullptr, &quot;null ptr&quot;);</span>
<a href="#l134.240"></a><span id="l134.240"> </span>
<a href="#l134.241"></a><span id="l134.241">   nsString success;</span>
<a href="#l134.242"></a><span id="l134.242">   nsString error;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l135.1"></a><span id="l135.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l135.2"></a><span id="l135.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l135.3"></a><span id="l135.3" class="difflineat">@@ -914,17 +914,17 @@ nsresult nsEudoraMac::GetAttachmentInfo(</span>
<a href="#l135.4"></a><span id="l135.4"> </span>
<a href="#l135.5"></a><span id="l135.5">   // Sample attachment line</span>
<a href="#l135.6"></a><span id="l135.6">   // Internet:sandh.jpg (JPEG/JVWR) (0003C2E8)</span>
<a href="#l135.7"></a><span id="l135.7"> </span>
<a href="#l135.8"></a><span id="l135.8">   OSType    type = '?\??\?';</span>
<a href="#l135.9"></a><span id="l135.9">   OSType    creator = '?\??\?';</span>
<a href="#l135.10"></a><span id="l135.10">   uint32_t  fNum = 0;</span>
<a href="#l135.11"></a><span id="l135.11">   int      i;</span>
<a href="#l135.12"></a><span id="l135.12" class="difflineminus">-  PRUnichar  c;</span>
<a href="#l135.13"></a><span id="l135.13" class="difflineplus">+  char16_t  c;</span>
<a href="#l135.14"></a><span id="l135.14"> </span>
<a href="#l135.15"></a><span id="l135.15">   nsCString  str(pFileName);</span>
<a href="#l135.16"></a><span id="l135.16">   if (str.Length() &gt; 22)</span>
<a href="#l135.17"></a><span id="l135.17">   {</span>
<a href="#l135.18"></a><span id="l135.18">     // try and extract the mac file info from the attachment line</span>
<a href="#l135.19"></a><span id="l135.19">     nsCString  fileNum;</span>
<a href="#l135.20"></a><span id="l135.20">     nsCString  types;</span>
<a href="#l135.21"></a><span id="l135.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l136.1"></a><span id="l136.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l136.2"></a><span id="l136.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l136.3"></a><span id="l136.3" class="difflineat">@@ -194,17 +194,17 @@ nsresult nsEudoraMailbox::DeleteFile(nsI</span>
<a href="#l136.4"></a><span id="l136.4">   }</span>
<a href="#l136.5"></a><span id="l136.5">   return rv;</span>
<a href="#l136.6"></a><span id="l136.6"> }</span>
<a href="#l136.7"></a><span id="l136.7"> </span>
<a href="#l136.8"></a><span id="l136.8"> #define kComposeErrorStr  &quot;X-Eudora-Compose-Error: *****&quot; &quot;\x0D\x0A&quot;</span>
<a href="#l136.9"></a><span id="l136.9"> #define kHTMLTag &quot;&lt;html&gt;&quot;</span>
<a href="#l136.10"></a><span id="l136.10"> </span>
<a href="#l136.11"></a><span id="l136.11"> nsresult nsEudoraMailbox::ImportMailbox(uint32_t *pBytes, bool *pAbort,</span>
<a href="#l136.12"></a><span id="l136.12" class="difflineminus">-                                        const PRUnichar *pName, nsIFile *pSrc,</span>
<a href="#l136.13"></a><span id="l136.13" class="difflineplus">+                                        const char16_t *pName, nsIFile *pSrc,</span>
<a href="#l136.14"></a><span id="l136.14">                                         nsIMsgFolder *dstFolder,</span>
<a href="#l136.15"></a><span id="l136.15">                                         int32_t *pMsgCount)</span>
<a href="#l136.16"></a><span id="l136.16"> {</span>
<a href="#l136.17"></a><span id="l136.17">   nsCOMPtr&lt;nsIFile&gt;   tocFile;</span>
<a href="#l136.18"></a><span id="l136.18">   nsCOMPtr&lt;nsIInputStream&gt; srcInputStream;</span>
<a href="#l136.19"></a><span id="l136.19">   nsCOMPtr&lt;nsIInputStream&gt; tocInputStream;</span>
<a href="#l136.20"></a><span id="l136.20">   nsCOMPtr&lt;nsIOutputStream&gt; mailOutputStream;</span>
<a href="#l136.21"></a><span id="l136.21">   bool                importWithoutToc = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l137.1"></a><span id="l137.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l137.2"></a><span id="l137.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l137.3"></a><span id="l137.3" class="difflineat">@@ -144,17 +144,17 @@ public:</span>
<a href="#l137.4"></a><span id="l137.4">   virtual nsresult  FindMailboxes(nsIFile *pRoot, nsIMutableArray *pArray) { return NS_ERROR_FAILURE;}</span>
<a href="#l137.5"></a><span id="l137.5">     // get the toc file corresponding to this mailbox</span>
<a href="#l137.6"></a><span id="l137.6">   virtual nsresult  FindTOCFile(nsIFile *pMailFile, nsIFile **pTOCFile, bool *pDeleteToc) { return NS_ERROR_FAILURE;}</span>
<a href="#l137.7"></a><span id="l137.7">     // interpret the attachment line and return the attached file</span>
<a href="#l137.8"></a><span id="l137.8">   virtual nsresult  GetAttachmentInfo(const char *pFileName, nsIFile *pFile, nsCString&amp; mimeType, nsCString&amp; aAttachment) { return NS_ERROR_FAILURE;}</span>
<a href="#l137.9"></a><span id="l137.9"> </span>
<a href="#l137.10"></a><span id="l137.10">   // Non-platform specific common stuff</span>
<a href="#l137.11"></a><span id="l137.11">     // import a mailbox</span>
<a href="#l137.12"></a><span id="l137.12" class="difflineminus">-  nsresult ImportMailbox(uint32_t *pBytes, bool *pAbort, const PRUnichar *pName,</span>
<a href="#l137.13"></a><span id="l137.13" class="difflineplus">+  nsresult ImportMailbox(uint32_t *pBytes, bool *pAbort, const char16_t *pName,</span>
<a href="#l137.14"></a><span id="l137.14">                          nsIFile *pSrc, nsIMsgFolder *pDst, int32_t *pMsgCount);</span>
<a href="#l137.15"></a><span id="l137.15">  </span>
<a href="#l137.16"></a><span id="l137.16"> </span>
<a href="#l137.17"></a><span id="l137.17">   static int32_t    IsEudoraFromSeparator(const char *pData, int32_t maxLen, nsCString&amp; defaultDate);</span>
<a href="#l137.18"></a><span id="l137.18">   static bool      IsEudoraTag(const char *pChar, int32_t maxLen, bool &amp;insideEudoraTags, nsCString &amp;bodyType, int32_t&amp; tagLength);</span>
<a href="#l137.19"></a><span id="l137.19"> </span>
<a href="#l137.20"></a><span id="l137.20"> protected:</span>
<a href="#l137.21"></a><span id="l137.21">   nsresult  CreateTempFile(nsIFile **ppFile);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l138.1"></a><span id="l138.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraSettings.cpp</span>
<a href="#l138.2"></a><span id="l138.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraSettings.cpp</span>
<a href="#l138.3"></a><span id="l138.3" class="difflineat">@@ -43,17 +43,17 @@ nsEudoraSettings::nsEudoraSettings()</span>
<a href="#l138.4"></a><span id="l138.4"> }</span>
<a href="#l138.5"></a><span id="l138.5"> </span>
<a href="#l138.6"></a><span id="l138.6"> nsEudoraSettings::~nsEudoraSettings()</span>
<a href="#l138.7"></a><span id="l138.7"> {</span>
<a href="#l138.8"></a><span id="l138.8"> }</span>
<a href="#l138.9"></a><span id="l138.9"> </span>
<a href="#l138.10"></a><span id="l138.10"> NS_IMPL_ISUPPORTS1(nsEudoraSettings, nsIImportSettings)</span>
<a href="#l138.11"></a><span id="l138.11"> </span>
<a href="#l138.12"></a><span id="l138.12" class="difflineminus">-NS_IMETHODIMP nsEudoraSettings::AutoLocate(PRUnichar **description, nsIFile **location, bool *_retval)</span>
<a href="#l138.13"></a><span id="l138.13" class="difflineplus">+NS_IMETHODIMP nsEudoraSettings::AutoLocate(char16_t **description, nsIFile **location, bool *_retval)</span>
<a href="#l138.14"></a><span id="l138.14"> {</span>
<a href="#l138.15"></a><span id="l138.15">     NS_PRECONDITION(description != nullptr, &quot;null ptr&quot;);</span>
<a href="#l138.16"></a><span id="l138.16">     NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l138.17"></a><span id="l138.17">     NS_PRECONDITION(location != nullptr, &quot;null ptr&quot;);</span>
<a href="#l138.18"></a><span id="l138.18">   if (!description || !_retval || !location)</span>
<a href="#l138.19"></a><span id="l138.19">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l138.20"></a><span id="l138.20"> </span>
<a href="#l138.21"></a><span id="l138.21">   *description = nullptr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l139.1"></a><span id="l139.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraStringBundle.cpp</span>
<a href="#l139.2"></a><span id="l139.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp</span>
<a href="#l139.3"></a><span id="l139.3" class="difflineat">@@ -33,29 +33,29 @@ nsIStringBundle *nsEudoraStringBundle::G</span>
<a href="#l139.4"></a><span id="l139.4"> </span>
<a href="#l139.5"></a><span id="l139.5">   m_pBundle = sBundle;</span>
<a href="#l139.6"></a><span id="l139.6">   return sBundle;</span>
<a href="#l139.7"></a><span id="l139.7"> }</span>
<a href="#l139.8"></a><span id="l139.8"> </span>
<a href="#l139.9"></a><span id="l139.9"> void nsEudoraStringBundle::GetStringByID(int32_t stringID, nsString&amp; result)</span>
<a href="#l139.10"></a><span id="l139.10"> {</span>
<a href="#l139.11"></a><span id="l139.11"> </span>
<a href="#l139.12"></a><span id="l139.12" class="difflineminus">-  PRUnichar *ptrv = GetStringByID(stringID);</span>
<a href="#l139.13"></a><span id="l139.13" class="difflineplus">+  char16_t *ptrv = GetStringByID(stringID);</span>
<a href="#l139.14"></a><span id="l139.14">   result = ptrv;</span>
<a href="#l139.15"></a><span id="l139.15">   FreeString(ptrv);</span>
<a href="#l139.16"></a><span id="l139.16"> }</span>
<a href="#l139.17"></a><span id="l139.17"> </span>
<a href="#l139.18"></a><span id="l139.18" class="difflineminus">-PRUnichar *nsEudoraStringBundle::GetStringByID(int32_t stringID)</span>
<a href="#l139.19"></a><span id="l139.19" class="difflineplus">+char16_t *nsEudoraStringBundle::GetStringByID(int32_t stringID)</span>
<a href="#l139.20"></a><span id="l139.20"> {</span>
<a href="#l139.21"></a><span id="l139.21">   if (!m_pBundle)</span>
<a href="#l139.22"></a><span id="l139.22">     m_pBundle = GetStringBundle();</span>
<a href="#l139.23"></a><span id="l139.23"> </span>
<a href="#l139.24"></a><span id="l139.24">   if (m_pBundle)</span>
<a href="#l139.25"></a><span id="l139.25">   {</span>
<a href="#l139.26"></a><span id="l139.26" class="difflineminus">-    PRUnichar *ptrv = nullptr;</span>
<a href="#l139.27"></a><span id="l139.27" class="difflineplus">+    char16_t *ptrv = nullptr;</span>
<a href="#l139.28"></a><span id="l139.28">     nsresult rv = m_pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l139.29"></a><span id="l139.29"> </span>
<a href="#l139.30"></a><span id="l139.30">     if (NS_SUCCEEDED(rv) &amp;&amp; ptrv)</span>
<a href="#l139.31"></a><span id="l139.31">       return ptrv;</span>
<a href="#l139.32"></a><span id="l139.32">   }</span>
<a href="#l139.33"></a><span id="l139.33"> </span>
<a href="#l139.34"></a><span id="l139.34">   nsString resultString(NS_LITERAL_STRING(&quot;[StringID &quot;));</span>
<a href="#l139.35"></a><span id="l139.35">   resultString.AppendInt(stringID);</span>
<a href="#l139.36"></a><span id="l139.36" class="difflineat">@@ -69,17 +69,17 @@ nsString nsEudoraStringBundle::FormatStr</span>
<a href="#l139.37"></a><span id="l139.37">   // Yeah, I know.  This causes an extra string buffer allocation, but there's no guarantee</span>
<a href="#l139.38"></a><span id="l139.38">   // that nsString's free and nsTextFormatter::smprintf_free deallocate memory the same way.</span>
<a href="#l139.39"></a><span id="l139.39">   nsAutoString format;</span>
<a href="#l139.40"></a><span id="l139.40">   GetStringByID(stringID, format);</span>
<a href="#l139.41"></a><span id="l139.41"> </span>
<a href="#l139.42"></a><span id="l139.42">   va_list args;</span>
<a href="#l139.43"></a><span id="l139.43">   va_start(args, stringID);</span>
<a href="#l139.44"></a><span id="l139.44"> </span>
<a href="#l139.45"></a><span id="l139.45" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::vsmprintf(format.get(), args);</span>
<a href="#l139.46"></a><span id="l139.46" class="difflineplus">+  char16_t *pText = nsTextFormatter::vsmprintf(format.get(), args);</span>
<a href="#l139.47"></a><span id="l139.47">   va_end(args);</span>
<a href="#l139.48"></a><span id="l139.48"> </span>
<a href="#l139.49"></a><span id="l139.49">   nsString result(pText);</span>
<a href="#l139.50"></a><span id="l139.50">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l139.51"></a><span id="l139.51">   return result;</span>
<a href="#l139.52"></a><span id="l139.52"> }</span>
<a href="#l139.53"></a><span id="l139.53"> </span>
<a href="#l139.54"></a><span id="l139.54"> void nsEudoraStringBundle::Cleanup(void)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l140.1"></a><span id="l140.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraStringBundle.h</span>
<a href="#l140.2"></a><span id="l140.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraStringBundle.h</span>
<a href="#l140.3"></a><span id="l140.3" class="difflineat">@@ -7,21 +7,21 @@</span>
<a href="#l140.4"></a><span id="l140.4"> #define nsEudoraStringBundle_H__</span>
<a href="#l140.5"></a><span id="l140.5"> </span>
<a href="#l140.6"></a><span id="l140.6"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l140.7"></a><span id="l140.7"> </span>
<a href="#l140.8"></a><span id="l140.8"> class nsIStringBundle;</span>
<a href="#l140.9"></a><span id="l140.9"> </span>
<a href="#l140.10"></a><span id="l140.10"> class nsEudoraStringBundle {</span>
<a href="#l140.11"></a><span id="l140.11"> public:</span>
<a href="#l140.12"></a><span id="l140.12" class="difflineminus">-  static PRUnichar       *  GetStringByID(int32_t stringID);</span>
<a href="#l140.13"></a><span id="l140.13" class="difflineplus">+  static char16_t       *  GetStringByID(int32_t stringID);</span>
<a href="#l140.14"></a><span id="l140.14">   static void               GetStringByID(int32_t stringID, nsString&amp; result);</span>
<a href="#l140.15"></a><span id="l140.15">   static nsString           FormatString(int32_t stringID, ...);</span>
<a href="#l140.16"></a><span id="l140.16">   static nsIStringBundle *  GetStringBundle(void); // don't release</span>
<a href="#l140.17"></a><span id="l140.17" class="difflineminus">-  static void               FreeString(PRUnichar *pStr) { NS_Free(pStr);}</span>
<a href="#l140.18"></a><span id="l140.18" class="difflineplus">+  static void               FreeString(char16_t *pStr) { NS_Free(pStr);}</span>
<a href="#l140.19"></a><span id="l140.19">   static void               Cleanup(void);</span>
<a href="#l140.20"></a><span id="l140.20"> </span>
<a href="#l140.21"></a><span id="l140.21"> private:</span>
<a href="#l140.22"></a><span id="l140.22">   static nsIStringBundle *  m_pBundle;</span>
<a href="#l140.23"></a><span id="l140.23"> };</span>
<a href="#l140.24"></a><span id="l140.24"> </span>
<a href="#l140.25"></a><span id="l140.25"> </span>
<a href="#l140.26"></a><span id="l140.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l141.1"></a><span id="l141.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l141.2"></a><span id="l141.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l141.3"></a><span id="l141.3" class="difflineat">@@ -1507,17 +1507,17 @@ nsresult nsEudoraWin32::ScanAddressDir(n</span>
<a href="#l141.4"></a><span id="l141.4">       }</span>
<a href="#l141.5"></a><span id="l141.5">     }</span>
<a href="#l141.6"></a><span id="l141.6">   }</span>
<a href="#l141.7"></a><span id="l141.7"> </span>
<a href="#l141.8"></a><span id="l141.8">   return rv;</span>
<a href="#l141.9"></a><span id="l141.9"> }</span>
<a href="#l141.10"></a><span id="l141.10"> </span>
<a href="#l141.11"></a><span id="l141.11"> </span>
<a href="#l141.12"></a><span id="l141.12" class="difflineminus">-nsresult nsEudoraWin32::FoundAddressBook(nsIFile *file, const PRUnichar *pName, nsIMutableArray *pArray, nsIImportService *impSvc)</span>
<a href="#l141.13"></a><span id="l141.13" class="difflineplus">+nsresult nsEudoraWin32::FoundAddressBook(nsIFile *file, const char16_t *pName, nsIMutableArray *pArray, nsIImportService *impSvc)</span>
<a href="#l141.14"></a><span id="l141.14"> {</span>
<a href="#l141.15"></a><span id="l141.15">   nsCOMPtr&lt;nsIImportABDescriptor&gt; desc;</span>
<a href="#l141.16"></a><span id="l141.16">   nsISupports *  pInterface;</span>
<a href="#l141.17"></a><span id="l141.17">   nsString name;</span>
<a href="#l141.18"></a><span id="l141.18">   nsresult rv;</span>
<a href="#l141.19"></a><span id="l141.19"> </span>
<a href="#l141.20"></a><span id="l141.20">   if (pName)</span>
<a href="#l141.21"></a><span id="l141.21">     name = pName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l142.1"></a><span id="l142.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.h</span>
<a href="#l142.2"></a><span id="l142.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.h</span>
<a href="#l142.3"></a><span id="l142.3" class="difflineat">@@ -53,17 +53,17 @@ public:</span>
<a href="#l142.4"></a><span id="l142.4"> private:</span>
<a href="#l142.5"></a><span id="l142.5">   nsresult  ScanMailDir(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport);</span>
<a href="#l142.6"></a><span id="l142.6">   nsresult  IterateMailDir(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport);</span>
<a href="#l142.7"></a><span id="l142.7">   nsresult  ScanDescmap(nsIFile *pFolder, nsIMutableArray *pArray, nsIImportService *pImport, const char *pData, int32_t len);</span>
<a href="#l142.8"></a><span id="l142.8">   nsresult  FoundMailFolder(nsIFile *mailFolder, const char *pName, nsIMutableArray *pArray, nsIImportService *pImport);</span>
<a href="#l142.9"></a><span id="l142.9">   nsresult  FoundMailbox(nsIFile *mailFile, const char *pName, nsIMutableArray *pArray, nsIImportService *pImport);</span>
<a href="#l142.10"></a><span id="l142.10">   bool      FindMimeIniFile(nsIFile *pFile);</span>
<a href="#l142.11"></a><span id="l142.11">   void    GetMimeTypeFromExtension(nsCString&amp; ext, nsCString&amp; mimeType);</span>
<a href="#l142.12"></a><span id="l142.12" class="difflineminus">-  nsresult  FoundAddressBook(nsIFile *file, const PRUnichar *pName, nsIMutableArray *pArray, nsIImportService *impSvc);</span>
<a href="#l142.13"></a><span id="l142.13" class="difflineplus">+  nsresult  FoundAddressBook(nsIFile *file, const char16_t *pName, nsIMutableArray *pArray, nsIImportService *impSvc);</span>
<a href="#l142.14"></a><span id="l142.14">   nsresult  ScanAddressDir(nsIFile *pDir, nsIMutableArray *pArray, nsIImportService *impSvc);</span>
<a href="#l142.15"></a><span id="l142.15"> </span>
<a href="#l142.16"></a><span id="l142.16"> </span>
<a href="#l142.17"></a><span id="l142.17">   static bool      FindEudoraLocation(nsIFile **pFolder, bool findIni = false);</span>
<a href="#l142.18"></a><span id="l142.18"> </span>
<a href="#l142.19"></a><span id="l142.19">     // Settings support</span>
<a href="#l142.20"></a><span id="l142.20">   static bool    BuildPOPAccount(nsIMsgAccountManager *accMgr, const char *pSection, const char *pIni, nsIMsgAccount **ppAccount);</span>
<a href="#l142.21"></a><span id="l142.21">   static bool    BuildIMAPAccount(nsIMsgAccountManager *accMgr, const char *pSection, const char *pIni, nsIMsgAccount **ppAccount);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l143.1"></a><span id="l143.1" class="difflineminus">--- a/mailnews/import/oexpress/WabObject.cpp</span>
<a href="#l143.2"></a><span id="l143.2" class="difflineplus">+++ b/mailnews/import/oexpress/WabObject.cpp</span>
<a href="#l143.3"></a><span id="l143.3" class="difflineat">@@ -521,17 +521,17 @@ LPSPropValue CWAB::GetUserProperty(LPMAI</span>
<a href="#l143.4"></a><span id="l143.4"> </span>
<a href="#l143.5"></a><span id="l143.5"> void CWAB::CStrToUnicode(const char *pStr, nsString&amp; result)</span>
<a href="#l143.6"></a><span id="l143.6"> {</span>
<a href="#l143.7"></a><span id="l143.7">   result.Truncate();</span>
<a href="#l143.8"></a><span id="l143.8">   int wLen = MultiByteToWideChar(CP_ACP, 0, pStr, -1, m_pUniBuff, 0);</span>
<a href="#l143.9"></a><span id="l143.9">   if (wLen &gt;= m_uniBuffLen) {</span>
<a href="#l143.10"></a><span id="l143.10">     if (m_pUniBuff)</span>
<a href="#l143.11"></a><span id="l143.11">       delete [] m_pUniBuff;</span>
<a href="#l143.12"></a><span id="l143.12" class="difflineminus">-    m_pUniBuff = new PRUnichar[wLen + 64];</span>
<a href="#l143.13"></a><span id="l143.13" class="difflineplus">+    m_pUniBuff = new char16_t[wLen + 64];</span>
<a href="#l143.14"></a><span id="l143.14">     m_uniBuffLen = wLen + 64;</span>
<a href="#l143.15"></a><span id="l143.15">   }</span>
<a href="#l143.16"></a><span id="l143.16">   if (wLen) {</span>
<a href="#l143.17"></a><span id="l143.17">     MultiByteToWideChar(CP_ACP, 0, pStr, -1, m_pUniBuff, m_uniBuffLen);</span>
<a href="#l143.18"></a><span id="l143.18">     result = m_pUniBuff;</span>
<a href="#l143.19"></a><span id="l143.19">   }</span>
<a href="#l143.20"></a><span id="l143.20"> }</span>
<a href="#l143.21"></a><span id="l143.21"> </span>
<a href="#l143.22"></a><span id="l143.22" class="difflineat">@@ -543,32 +543,32 @@ void CWAB::GetValueString(LPSPropValue p</span>
<a href="#l143.23"></a><span id="l143.23">   if (!pVal)</span>
<a href="#l143.24"></a><span id="l143.24">     return;</span>
<a href="#l143.25"></a><span id="l143.25"> </span>
<a href="#l143.26"></a><span id="l143.26">   switch(PROP_TYPE(pVal-&gt;ulPropTag)) {</span>
<a href="#l143.27"></a><span id="l143.27">     case PT_STRING8:</span>
<a href="#l143.28"></a><span id="l143.28">       CStrToUnicode((const char *) (pVal-&gt;Value.lpszA), val);</span>
<a href="#l143.29"></a><span id="l143.29">       break;</span>
<a href="#l143.30"></a><span id="l143.30">     case PT_UNICODE:</span>
<a href="#l143.31"></a><span id="l143.31" class="difflineminus">-      val = (PRUnichar *) (pVal-&gt;Value.lpszW);</span>
<a href="#l143.32"></a><span id="l143.32" class="difflineplus">+      val = (char16_t *) (pVal-&gt;Value.lpszW);</span>
<a href="#l143.33"></a><span id="l143.33">       break;</span>
<a href="#l143.34"></a><span id="l143.34">     case PT_MV_STRING8: {</span>
<a href="#l143.35"></a><span id="l143.35">       nsString  tmp;</span>
<a href="#l143.36"></a><span id="l143.36">       ULONG  j;</span>
<a href="#l143.37"></a><span id="l143.37">       for(j = 0; j &lt; pVal-&gt;Value.MVszA.cValues; j++) {</span>
<a href="#l143.38"></a><span id="l143.38">         CStrToUnicode((const char *) (pVal-&gt;Value.MVszA.lppszA[j]), tmp);</span>
<a href="#l143.39"></a><span id="l143.39">         val += tmp;</span>
<a href="#l143.40"></a><span id="l143.40">         val.Append(NS_ConvertASCIItoUTF16(TR_OUTPUT_EOL));</span>
<a href="#l143.41"></a><span id="l143.41">       }</span>
<a href="#l143.42"></a><span id="l143.42">       break;</span>
<a href="#l143.43"></a><span id="l143.43">     }</span>
<a href="#l143.44"></a><span id="l143.44">     case PT_MV_UNICODE: {</span>
<a href="#l143.45"></a><span id="l143.45">       ULONG  j;</span>
<a href="#l143.46"></a><span id="l143.46">       for(j = 0; j &lt; pVal-&gt;Value.MVszW.cValues; j++) {</span>
<a href="#l143.47"></a><span id="l143.47" class="difflineminus">-        val += (PRUnichar *) (pVal-&gt;Value.MVszW.lppszW[j]);</span>
<a href="#l143.48"></a><span id="l143.48" class="difflineplus">+        val += (char16_t *) (pVal-&gt;Value.MVszW.lppszW[j]);</span>
<a href="#l143.49"></a><span id="l143.49">         val.Append(NS_ConvertASCIItoUTF16(TR_OUTPUT_EOL));</span>
<a href="#l143.50"></a><span id="l143.50">       }</span>
<a href="#l143.51"></a><span id="l143.51">       break;</span>
<a href="#l143.52"></a><span id="l143.52">     }</span>
<a href="#l143.53"></a><span id="l143.53">     case PT_I2:</span>
<a href="#l143.54"></a><span id="l143.54">     case PT_LONG:</span>
<a href="#l143.55"></a><span id="l143.55">     case PT_R4:</span>
<a href="#l143.56"></a><span id="l143.56">     case PT_DOUBLE:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l144.1"></a><span id="l144.1" class="difflineminus">--- a/mailnews/import/oexpress/WabObject.h</span>
<a href="#l144.2"></a><span id="l144.2" class="difflineplus">+++ b/mailnews/import/oexpress/WabObject.h</span>
<a href="#l144.3"></a><span id="l144.3" class="difflineat">@@ -11,18 +11,18 @@</span>
<a href="#l144.4"></a><span id="l144.4"> #include &quot;nsIFile.h&quot;</span>
<a href="#l144.5"></a><span id="l144.5"> </span>
<a href="#l144.6"></a><span id="l144.6"> #include &lt;windows.h&gt;</span>
<a href="#l144.7"></a><span id="l144.7"> #include &lt;wab.h&gt;</span>
<a href="#l144.8"></a><span id="l144.8"> </span>
<a href="#l144.9"></a><span id="l144.9"> </span>
<a href="#l144.10"></a><span id="l144.10"> class CWabIterator {</span>
<a href="#l144.11"></a><span id="l144.11"> public:</span>
<a href="#l144.12"></a><span id="l144.12" class="difflineminus">-  virtual nsresult  EnumUser(const PRUnichar *pName, LPENTRYID pEid, ULONG cbEid) = 0;</span>
<a href="#l144.13"></a><span id="l144.13" class="difflineminus">-  virtual nsresult  EnumList(const PRUnichar *pName, LPENTRYID pEid, ULONG cbEid, LPMAPITABLE lpTable) = 0;</span>
<a href="#l144.14"></a><span id="l144.14" class="difflineplus">+  virtual nsresult  EnumUser(const char16_t *pName, LPENTRYID pEid, ULONG cbEid) = 0;</span>
<a href="#l144.15"></a><span id="l144.15" class="difflineplus">+  virtual nsresult  EnumList(const char16_t *pName, LPENTRYID pEid, ULONG cbEid, LPMAPITABLE lpTable) = 0;</span>
<a href="#l144.16"></a><span id="l144.16"> };</span>
<a href="#l144.17"></a><span id="l144.17"> </span>
<a href="#l144.18"></a><span id="l144.18"> </span>
<a href="#l144.19"></a><span id="l144.19"> class CWAB</span>
<a href="#l144.20"></a><span id="l144.20"> {</span>
<a href="#l144.21"></a><span id="l144.21"> public:</span>
<a href="#l144.22"></a><span id="l144.22">     CWAB(nsIFile *fileName);</span>
<a href="#l144.23"></a><span id="l144.23">     ~CWAB();</span>
<a href="#l144.24"></a><span id="l144.24" class="difflineat">@@ -45,17 +45,17 @@ public:</span>
<a href="#l144.25"></a><span id="l144.25">   void      CStrToUnicode(const char *pStr, nsString&amp; result);</span>
<a href="#l144.26"></a><span id="l144.26"> </span>
<a href="#l144.27"></a><span id="l144.27">   // Utility stuff used by iterate</span>
<a href="#l144.28"></a><span id="l144.28">   void      FreeProws(LPSRowSet prows);</span>
<a href="#l144.29"></a><span id="l144.29"> </span>
<a href="#l144.30"></a><span id="l144.30">   bool      IsAvailable();</span>
<a href="#l144.31"></a><span id="l144.31"> </span>
<a href="#l144.32"></a><span id="l144.32"> private:</span>
<a href="#l144.33"></a><span id="l144.33" class="difflineminus">-  PRUnichar *  m_pUniBuff;</span>
<a href="#l144.34"></a><span id="l144.34" class="difflineplus">+  char16_t *  m_pUniBuff;</span>
<a href="#l144.35"></a><span id="l144.35">   int      m_uniBuffLen;</span>
<a href="#l144.36"></a><span id="l144.36">   bool        m_bInitialized;</span>
<a href="#l144.37"></a><span id="l144.37">     HINSTANCE   m_hinstWAB;</span>
<a href="#l144.38"></a><span id="l144.38">     LPWABOPEN   m_lpfnWABOpen;</span>
<a href="#l144.39"></a><span id="l144.39">     LPADRBOOK   m_lpAdrBook;</span>
<a href="#l144.40"></a><span id="l144.40">     LPWABOBJECT m_lpWABObject;</span>
<a href="#l144.41"></a><span id="l144.41"> };</span>
<a href="#l144.42"></a><span id="l144.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l145.1"></a><span id="l145.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEAddressIterator.cpp</span>
<a href="#l145.2"></a><span id="l145.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEAddressIterator.cpp</span>
<a href="#l145.3"></a><span id="l145.3" class="difflineat">@@ -83,17 +83,17 @@ nsOEAddressIterator::nsOEAddressIterator</span>
<a href="#l145.4"></a><span id="l145.4">   m_pWab = pWab;</span>
<a href="#l145.5"></a><span id="l145.5">   m_database = database;</span>
<a href="#l145.6"></a><span id="l145.6"> }</span>
<a href="#l145.7"></a><span id="l145.7"> </span>
<a href="#l145.8"></a><span id="l145.8"> nsOEAddressIterator::~nsOEAddressIterator()</span>
<a href="#l145.9"></a><span id="l145.9"> {</span>
<a href="#l145.10"></a><span id="l145.10"> }</span>
<a href="#l145.11"></a><span id="l145.11"> </span>
<a href="#l145.12"></a><span id="l145.12" class="difflineminus">-nsresult nsOEAddressIterator::EnumUser(const PRUnichar * pName, LPENTRYID pEid, ULONG cbEid)</span>
<a href="#l145.13"></a><span id="l145.13" class="difflineplus">+nsresult nsOEAddressIterator::EnumUser(const char16_t * pName, LPENTRYID pEid, ULONG cbEid)</span>
<a href="#l145.14"></a><span id="l145.14"> {</span>
<a href="#l145.15"></a><span id="l145.15">   IMPORT_LOG1(&quot;User: %S\n&quot;, pName);</span>
<a href="#l145.16"></a><span id="l145.16">   nsresult   rv = NS_OK;</span>
<a href="#l145.17"></a><span id="l145.17">   </span>
<a href="#l145.18"></a><span id="l145.18">   if (m_database) {</span>
<a href="#l145.19"></a><span id="l145.19">     LPMAILUSER  pUser = m_pWab-&gt;GetUser(cbEid, pEid);</span>
<a href="#l145.20"></a><span id="l145.20">     if (pUser) {</span>
<a href="#l145.21"></a><span id="l145.21">       // Get a new row from the database!</span>
<a href="#l145.22"></a><span id="l145.22" class="difflineat">@@ -123,17 +123,17 @@ nsresult nsOEAddressIterator::EnumUser(c</span>
<a href="#l145.23"></a><span id="l145.23">   return rv;</span>
<a href="#l145.24"></a><span id="l145.24"> }</span>
<a href="#l145.25"></a><span id="l145.25"> </span>
<a href="#l145.26"></a><span id="l145.26"> void nsOEAddressIterator::FindListRow(nsString &amp;eMail, nsIMdbRow **cardRow)</span>
<a href="#l145.27"></a><span id="l145.27"> {</span>
<a href="#l145.28"></a><span id="l145.28">   m_listRows.Get(eMail,cardRow);</span>
<a href="#l145.29"></a><span id="l145.29"> }</span>
<a href="#l145.30"></a><span id="l145.30"> </span>
<a href="#l145.31"></a><span id="l145.31" class="difflineminus">-nsresult nsOEAddressIterator::EnumList(const PRUnichar * pName, LPENTRYID pEid, ULONG cbEid, LPMAPITABLE lpTable)</span>
<a href="#l145.32"></a><span id="l145.32" class="difflineplus">+nsresult nsOEAddressIterator::EnumList(const char16_t * pName, LPENTRYID pEid, ULONG cbEid, LPMAPITABLE lpTable)</span>
<a href="#l145.33"></a><span id="l145.33"> {</span>
<a href="#l145.34"></a><span id="l145.34">   // If no name provided then we're done.</span>
<a href="#l145.35"></a><span id="l145.35">   if (!pName || !(*pName))</span>
<a href="#l145.36"></a><span id="l145.36">     return NS_OK;</span>
<a href="#l145.37"></a><span id="l145.37"> </span>
<a href="#l145.38"></a><span id="l145.38">   nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l145.39"></a><span id="l145.39">   HRESULT hr = E_FAIL;</span>
<a href="#l145.40"></a><span id="l145.40">   // Make sure we have db to work with.</span>
<a href="#l145.41"></a><span id="l145.41" class="difflineat">@@ -255,17 +255,17 @@ void nsOEAddressIterator::SetBirthDay(ns</span>
<a href="#l145.42"></a><span id="l145.42">   PR_snprintf(stringValue, sizeof(stringValue), &quot;%04d&quot;, exploded.tm_year);</span>
<a href="#l145.43"></a><span id="l145.43">   m_database-&gt;AddBirthYear(newRow, stringValue);</span>
<a href="#l145.44"></a><span id="l145.44">   PR_snprintf(stringValue, sizeof(stringValue), &quot;%02d&quot;, exploded.tm_month + 1);</span>
<a href="#l145.45"></a><span id="l145.45">   m_database-&gt;AddBirthMonth(newRow, stringValue);</span>
<a href="#l145.46"></a><span id="l145.46">   PR_snprintf(stringValue, sizeof(stringValue), &quot;%02d&quot;, exploded.tm_mday);</span>
<a href="#l145.47"></a><span id="l145.47">   m_database-&gt;AddBirthDay(newRow, stringValue);</span>
<a href="#l145.48"></a><span id="l145.48"> }</span>
<a href="#l145.49"></a><span id="l145.49"> </span>
<a href="#l145.50"></a><span id="l145.50" class="difflineminus">-bool nsOEAddressIterator::BuildCard(const PRUnichar * pName, nsIMdbRow *newRow, LPMAILUSER pUser)</span>
<a href="#l145.51"></a><span id="l145.51" class="difflineplus">+bool nsOEAddressIterator::BuildCard(const char16_t * pName, nsIMdbRow *newRow, LPMAILUSER pUser)</span>
<a href="#l145.52"></a><span id="l145.52"> {</span>
<a href="#l145.53"></a><span id="l145.53">   </span>
<a href="#l145.54"></a><span id="l145.54">   nsString    lastName;</span>
<a href="#l145.55"></a><span id="l145.55">   nsString    firstName;</span>
<a href="#l145.56"></a><span id="l145.56">   nsString    eMail;</span>
<a href="#l145.57"></a><span id="l145.57">   nsString    nickName;</span>
<a href="#l145.58"></a><span id="l145.58">   nsString    middleName;</span>
<a href="#l145.59"></a><span id="l145.59">   PRTime      birthDay = 0;</span>
<a href="#l145.60"></a><span id="l145.60" class="difflineat">@@ -313,21 +313,21 @@ bool nsOEAddressIterator::BuildCard(cons</span>
<a href="#l145.61"></a><span id="l145.61">     m_pWab-&gt;FreeProperty(pProp);</span>
<a href="#l145.62"></a><span id="l145.62">   }</span>
<a href="#l145.63"></a><span id="l145.63">   if (displayName.IsEmpty()) {</span>
<a href="#l145.64"></a><span id="l145.64">     if (firstName.IsEmpty())</span>
<a href="#l145.65"></a><span id="l145.65">       displayName = pName;</span>
<a href="#l145.66"></a><span id="l145.66">     else {</span>
<a href="#l145.67"></a><span id="l145.67">       displayName = firstName;</span>
<a href="#l145.68"></a><span id="l145.68">       if (!middleName.IsEmpty()) {</span>
<a href="#l145.69"></a><span id="l145.69" class="difflineminus">-        displayName.Append(PRUnichar(' '));</span>
<a href="#l145.70"></a><span id="l145.70" class="difflineplus">+        displayName.Append(char16_t(' '));</span>
<a href="#l145.71"></a><span id="l145.71">         displayName.Append(middleName);</span>
<a href="#l145.72"></a><span id="l145.72">       }</span>
<a href="#l145.73"></a><span id="l145.73">       if (!lastName.IsEmpty()) {</span>
<a href="#l145.74"></a><span id="l145.74" class="difflineminus">-        displayName.Append(PRUnichar(' '));</span>
<a href="#l145.75"></a><span id="l145.75" class="difflineplus">+        displayName.Append(char16_t(' '));</span>
<a href="#l145.76"></a><span id="l145.76">         displayName.Append(lastName);</span>
<a href="#l145.77"></a><span id="l145.77">       }</span>
<a href="#l145.78"></a><span id="l145.78">     }</span>
<a href="#l145.79"></a><span id="l145.79">   }</span>
<a href="#l145.80"></a><span id="l145.80"> </span>
<a href="#l145.81"></a><span id="l145.81">   pProp = m_pWab-&gt;GetUserProperty(pUser, PR_BIRTHDAY);</span>
<a href="#l145.82"></a><span id="l145.82">   if (pProp) {</span>
<a href="#l145.83"></a><span id="l145.83">     m_pWab-&gt;GetValueTime(pProp, birthDay);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l146.1"></a><span id="l146.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEAddressIterator.h</span>
<a href="#l146.2"></a><span id="l146.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEAddressIterator.h</span>
<a href="#l146.3"></a><span id="l146.3" class="difflineat">@@ -13,22 +13,22 @@</span>
<a href="#l146.4"></a><span id="l146.4"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l146.5"></a><span id="l146.5"> #include &quot;nsInterfaceHashtable.h&quot;</span>
<a href="#l146.6"></a><span id="l146.6"> </span>
<a href="#l146.7"></a><span id="l146.7"> class nsOEAddressIterator : public CWabIterator {</span>
<a href="#l146.8"></a><span id="l146.8"> public:</span>
<a href="#l146.9"></a><span id="l146.9">   nsOEAddressIterator(CWAB *pWab, nsIAddrDatabase *database);</span>
<a href="#l146.10"></a><span id="l146.10">   ~nsOEAddressIterator();</span>
<a href="#l146.11"></a><span id="l146.11">   </span>
<a href="#l146.12"></a><span id="l146.12" class="difflineminus">-  virtual nsresult  EnumUser(const PRUnichar * pName, LPENTRYID pEid, ULONG cbEid) MOZ_OVERRIDE;</span>
<a href="#l146.13"></a><span id="l146.13" class="difflineminus">-  virtual nsresult  EnumList(const PRUnichar * pName, LPENTRYID pEid, ULONG cbEid, LPMAPITABLE table) MOZ_OVERRIDE;</span>
<a href="#l146.14"></a><span id="l146.14" class="difflineplus">+  virtual nsresult  EnumUser(const char16_t * pName, LPENTRYID pEid, ULONG cbEid) MOZ_OVERRIDE;</span>
<a href="#l146.15"></a><span id="l146.15" class="difflineplus">+  virtual nsresult  EnumList(const char16_t * pName, LPENTRYID pEid, ULONG cbEid, LPMAPITABLE table) MOZ_OVERRIDE;</span>
<a href="#l146.16"></a><span id="l146.16">         void FindListRow(nsString &amp;eMail, nsIMdbRow **cardRow);</span>
<a href="#l146.17"></a><span id="l146.17"> </span>
<a href="#l146.18"></a><span id="l146.18"> private:</span>
<a href="#l146.19"></a><span id="l146.19" class="difflineminus">-  bool      BuildCard(const PRUnichar * pName, nsIMdbRow *card, LPMAILUSER pUser);</span>
<a href="#l146.20"></a><span id="l146.20" class="difflineplus">+  bool      BuildCard(const char16_t * pName, nsIMdbRow *card, LPMAILUSER pUser);</span>
<a href="#l146.21"></a><span id="l146.21">   void    SanitizeValue(nsString&amp; val);</span>
<a href="#l146.22"></a><span id="l146.22">   void    SplitString(nsString&amp; val1, nsString&amp; val2);</span>
<a href="#l146.23"></a><span id="l146.23">   void    SetBirthDay(nsIMdbRow *card, PRTime&amp; birthDay);</span>
<a href="#l146.24"></a><span id="l146.24"> </span>
<a href="#l146.25"></a><span id="l146.25">   CWAB *                m_pWab;</span>
<a href="#l146.26"></a><span id="l146.26">   nsCOMPtr&lt;nsIAddrDatabase&gt;     m_database;</span>
<a href="#l146.27"></a><span id="l146.27">   nsInterfaceHashtable &lt;nsStringHashKey, nsIMdbRow&gt; m_listRows;</span>
<a href="#l146.28"></a><span id="l146.28"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l147.1"></a><span id="l147.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l147.2"></a><span id="l147.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l147.3"></a><span id="l147.3" class="difflineat">@@ -67,29 +67,29 @@ public:</span>
<a href="#l147.4"></a><span id="l147.4">   /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l147.5"></a><span id="l147.5">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l147.6"></a><span id="l147.6"> </span>
<a href="#l147.7"></a><span id="l147.7">   /* nsIArray FindMailboxes (in nsIFile location); */</span>
<a href="#l147.8"></a><span id="l147.8">   NS_IMETHOD FindMailboxes(nsIFile *location, nsIArray **_retval);</span>
<a href="#l147.9"></a><span id="l147.9"> </span>
<a href="#l147.10"></a><span id="l147.10">   NS_IMETHOD ImportMailbox(nsIImportMailboxDescriptor *source,</span>
<a href="#l147.11"></a><span id="l147.11">                            nsIMsgFolder *dstFolder,</span>
<a href="#l147.12"></a><span id="l147.12" class="difflineminus">-                           PRUnichar **pErrorLog, PRUnichar **pSuccessLog,</span>
<a href="#l147.13"></a><span id="l147.13" class="difflineplus">+                           char16_t **pErrorLog, char16_t **pSuccessLog,</span>
<a href="#l147.14"></a><span id="l147.14">                            bool *fatalError);</span>
<a href="#l147.15"></a><span id="l147.15"> </span>
<a href="#l147.16"></a><span id="l147.16">   /* unsigned long GetImportProgress (); */</span>
<a href="#l147.17"></a><span id="l147.17">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l147.18"></a><span id="l147.18"> </span>
<a href="#l147.19"></a><span id="l147.19">     NS_IMETHOD TranslateFolderName(const nsAString &amp; aFolderName, nsAString &amp; _retval);</span>
<a href="#l147.20"></a><span id="l147.20"> </span>
<a href="#l147.21"></a><span id="l147.21"> public:</span>
<a href="#l147.22"></a><span id="l147.22">   static void ReportSuccess(nsString&amp; name, int32_t count, nsString *pStream);</span>
<a href="#l147.23"></a><span id="l147.23">   static void ReportError(int32_t errorNum, nsString&amp; name, nsString *pStream);</span>
<a href="#l147.24"></a><span id="l147.24">   static void AddLinebreak(nsString *pStream);</span>
<a href="#l147.25"></a><span id="l147.25" class="difflineminus">-  static void SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess);</span>
<a href="#l147.26"></a><span id="l147.26" class="difflineplus">+  static void SetLogs(nsString&amp; success, nsString&amp; error, char16_t **pError, char16_t **pSuccess);</span>
<a href="#l147.27"></a><span id="l147.27"> </span>
<a href="#l147.28"></a><span id="l147.28"> private:</span>
<a href="#l147.29"></a><span id="l147.29">   uint32_t m_bytesDone;</span>
<a href="#l147.30"></a><span id="l147.30"> };</span>
<a href="#l147.31"></a><span id="l147.31"> </span>
<a href="#l147.32"></a><span id="l147.32"> </span>
<a href="#l147.33"></a><span id="l147.33"> class ImportOEAddressImpl : public nsIImportAddressBooks</span>
<a href="#l147.34"></a><span id="l147.34"> {</span>
<a href="#l147.35"></a><span id="l147.35" class="difflineat">@@ -101,38 +101,38 @@ public:</span>
<a href="#l147.36"></a><span id="l147.36"> </span>
<a href="#l147.37"></a><span id="l147.37">   // nsISupports interface</span>
<a href="#l147.38"></a><span id="l147.38">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l147.39"></a><span id="l147.39"> </span>
<a href="#l147.40"></a><span id="l147.40">     // nsIImportAddressBooks interface</span>
<a href="#l147.41"></a><span id="l147.41"> </span>
<a href="#l147.42"></a><span id="l147.42">   NS_IMETHOD GetSupportsMultiple(bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l147.43"></a><span id="l147.43"> </span>
<a href="#l147.44"></a><span id="l147.44" class="difflineminus">-  NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l147.45"></a><span id="l147.45" class="difflineplus">+  NS_IMETHOD GetAutoFind(char16_t **description, bool *_retval);</span>
<a href="#l147.46"></a><span id="l147.46"> </span>
<a href="#l147.47"></a><span id="l147.47">   NS_IMETHOD GetNeedsFieldMap(nsIFile *pLoc, bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l147.48"></a><span id="l147.48"> </span>
<a href="#l147.49"></a><span id="l147.49">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l147.50"></a><span id="l147.50"> </span>
<a href="#l147.51"></a><span id="l147.51">   NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l147.52"></a><span id="l147.52"> </span>
<a href="#l147.53"></a><span id="l147.53">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap)</span>
<a href="#l147.54"></a><span id="l147.54">     { return NS_ERROR_FAILURE; }</span>
<a href="#l147.55"></a><span id="l147.55"> </span>
<a href="#l147.56"></a><span id="l147.56">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l147.57"></a><span id="l147.57">                                nsIAddrDatabase *destination,</span>
<a href="#l147.58"></a><span id="l147.58">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l147.59"></a><span id="l147.59">                                nsISupports *aSupportService,</span>
<a href="#l147.60"></a><span id="l147.60" class="difflineminus">-                               PRUnichar **errorLog,</span>
<a href="#l147.61"></a><span id="l147.61" class="difflineminus">-                               PRUnichar **successLog,</span>
<a href="#l147.62"></a><span id="l147.62" class="difflineplus">+                               char16_t **errorLog,</span>
<a href="#l147.63"></a><span id="l147.63" class="difflineplus">+                               char16_t **successLog,</span>
<a href="#l147.64"></a><span id="l147.64">                                bool *fatalError);</span>
<a href="#l147.65"></a><span id="l147.65"> </span>
<a href="#l147.66"></a><span id="l147.66">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l147.67"></a><span id="l147.67"> </span>
<a href="#l147.68"></a><span id="l147.68" class="difflineminus">-  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, PRUnichar **pStr)</span>
<a href="#l147.69"></a><span id="l147.69" class="difflineplus">+  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, char16_t **pStr)</span>
<a href="#l147.70"></a><span id="l147.70">     { return NS_ERROR_FAILURE;}</span>
<a href="#l147.71"></a><span id="l147.71"> </span>
<a href="#l147.72"></a><span id="l147.72">   NS_IMETHOD SetSampleLocation(nsIFile *) { return NS_OK; }</span>
<a href="#l147.73"></a><span id="l147.73"> </span>
<a href="#l147.74"></a><span id="l147.74"> private:</span>
<a href="#l147.75"></a><span id="l147.75">   static void ReportSuccess(nsString&amp; name, nsString *pStream);</span>
<a href="#l147.76"></a><span id="l147.76"> </span>
<a href="#l147.77"></a><span id="l147.77"> private:</span>
<a href="#l147.78"></a><span id="l147.78" class="difflineat">@@ -157,26 +157,26 @@ nsOEImport::nsOEImport()</span>
<a href="#l147.79"></a><span id="l147.79"> </span>
<a href="#l147.80"></a><span id="l147.80"> nsOEImport::~nsOEImport()</span>
<a href="#l147.81"></a><span id="l147.81"> {</span>
<a href="#l147.82"></a><span id="l147.82">   IMPORT_LOG0(&quot;nsOEImport Module Deleted\n&quot;);</span>
<a href="#l147.83"></a><span id="l147.83"> }</span>
<a href="#l147.84"></a><span id="l147.84"> </span>
<a href="#l147.85"></a><span id="l147.85"> NS_IMPL_ISUPPORTS1(nsOEImport, nsIImportModule)</span>
<a href="#l147.86"></a><span id="l147.86"> </span>
<a href="#l147.87"></a><span id="l147.87" class="difflineminus">-NS_IMETHODIMP nsOEImport::GetName(PRUnichar **name)</span>
<a href="#l147.88"></a><span id="l147.88" class="difflineplus">+NS_IMETHODIMP nsOEImport::GetName(char16_t **name)</span>
<a href="#l147.89"></a><span id="l147.89"> {</span>
<a href="#l147.90"></a><span id="l147.90">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l147.91"></a><span id="l147.91"> </span>
<a href="#l147.92"></a><span id="l147.92">   *name = nsOEStringBundle::GetStringByID(OEIMPORT_NAME);</span>
<a href="#l147.93"></a><span id="l147.93"> </span>
<a href="#l147.94"></a><span id="l147.94">     return NS_OK;</span>
<a href="#l147.95"></a><span id="l147.95"> }</span>
<a href="#l147.96"></a><span id="l147.96"> </span>
<a href="#l147.97"></a><span id="l147.97" class="difflineminus">-NS_IMETHODIMP nsOEImport::GetDescription(PRUnichar **name)</span>
<a href="#l147.98"></a><span id="l147.98" class="difflineplus">+NS_IMETHODIMP nsOEImport::GetDescription(char16_t **name)</span>
<a href="#l147.99"></a><span id="l147.99"> {</span>
<a href="#l147.100"></a><span id="l147.100">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l147.101"></a><span id="l147.101"> </span>
<a href="#l147.102"></a><span id="l147.102">   *name = nsOEStringBundle::GetStringByID(OEIMPORT_DESCRIPTION);</span>
<a href="#l147.103"></a><span id="l147.103">   return NS_OK;</span>
<a href="#l147.104"></a><span id="l147.104"> }</span>
<a href="#l147.105"></a><span id="l147.105"> </span>
<a href="#l147.106"></a><span id="l147.106"> NS_IMETHODIMP nsOEImport::GetSupports(char **supports)</span>
<a href="#l147.107"></a><span id="l147.107" class="difflineat">@@ -346,58 +346,58 @@ NS_IMETHODIMP ImportOEMailImpl::FindMail</span>
<a href="#l147.108"></a><span id="l147.108">     *ppArray = nullptr;</span>
<a href="#l147.109"></a><span id="l147.109"> </span>
<a href="#l147.110"></a><span id="l147.110">   return NS_OK;</span>
<a href="#l147.111"></a><span id="l147.111"> }</span>
<a href="#l147.112"></a><span id="l147.112"> </span>
<a href="#l147.113"></a><span id="l147.113"> void ImportOEMailImpl::AddLinebreak(nsString *pStream)</span>
<a href="#l147.114"></a><span id="l147.114"> {</span>
<a href="#l147.115"></a><span id="l147.115">   if (pStream)</span>
<a href="#l147.116"></a><span id="l147.116" class="difflineminus">-    pStream-&gt;Append(PRUnichar('\n'));</span>
<a href="#l147.117"></a><span id="l147.117" class="difflineplus">+    pStream-&gt;Append(char16_t('\n'));</span>
<a href="#l147.118"></a><span id="l147.118"> }</span>
<a href="#l147.119"></a><span id="l147.119"> </span>
<a href="#l147.120"></a><span id="l147.120"> void ImportOEMailImpl::ReportSuccess(nsString&amp; name, int32_t count, nsString *pStream)</span>
<a href="#l147.121"></a><span id="l147.121"> {</span>
<a href="#l147.122"></a><span id="l147.122">   if (!pStream)</span>
<a href="#l147.123"></a><span id="l147.123">     return;</span>
<a href="#l147.124"></a><span id="l147.124">   // load the success string</span>
<a href="#l147.125"></a><span id="l147.125" class="difflineminus">-  PRUnichar *pFmt = nsOEStringBundle::GetStringByID(OEIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l147.126"></a><span id="l147.126" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get(), count);</span>
<a href="#l147.127"></a><span id="l147.127" class="difflineplus">+  char16_t *pFmt = nsOEStringBundle::GetStringByID(OEIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l147.128"></a><span id="l147.128" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get(), count);</span>
<a href="#l147.129"></a><span id="l147.129">   pStream-&gt;Append(pText);</span>
<a href="#l147.130"></a><span id="l147.130">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l147.131"></a><span id="l147.131">   nsOEStringBundle::FreeString(pFmt);</span>
<a href="#l147.132"></a><span id="l147.132">   AddLinebreak(pStream);</span>
<a href="#l147.133"></a><span id="l147.133"> }</span>
<a href="#l147.134"></a><span id="l147.134"> </span>
<a href="#l147.135"></a><span id="l147.135"> void ImportOEMailImpl::ReportError(int32_t errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l147.136"></a><span id="l147.136"> {</span>
<a href="#l147.137"></a><span id="l147.137">   if (!pStream)</span>
<a href="#l147.138"></a><span id="l147.138">     return;</span>
<a href="#l147.139"></a><span id="l147.139">   // load the error string</span>
<a href="#l147.140"></a><span id="l147.140" class="difflineminus">-  PRUnichar *pFmt = nsOEStringBundle::GetStringByID(errorNum);</span>
<a href="#l147.141"></a><span id="l147.141" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l147.142"></a><span id="l147.142" class="difflineplus">+  char16_t *pFmt = nsOEStringBundle::GetStringByID(errorNum);</span>
<a href="#l147.143"></a><span id="l147.143" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l147.144"></a><span id="l147.144">   pStream-&gt;Append(pText);</span>
<a href="#l147.145"></a><span id="l147.145">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l147.146"></a><span id="l147.146">   nsOEStringBundle::FreeString(pFmt);</span>
<a href="#l147.147"></a><span id="l147.147">   AddLinebreak(pStream);</span>
<a href="#l147.148"></a><span id="l147.148"> }</span>
<a href="#l147.149"></a><span id="l147.149"> </span>
<a href="#l147.150"></a><span id="l147.150"> </span>
<a href="#l147.151"></a><span id="l147.151" class="difflineminus">-void ImportOEMailImpl::SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l147.152"></a><span id="l147.152" class="difflineplus">+void ImportOEMailImpl::SetLogs(nsString&amp; success, nsString&amp; error, char16_t **pError, char16_t **pSuccess)</span>
<a href="#l147.153"></a><span id="l147.153"> {</span>
<a href="#l147.154"></a><span id="l147.154">   if (pError)</span>
<a href="#l147.155"></a><span id="l147.155">     *pError = ToNewUnicode(error);</span>
<a href="#l147.156"></a><span id="l147.156">   if (pSuccess)</span>
<a href="#l147.157"></a><span id="l147.157">     *pSuccess = ToNewUnicode(success);</span>
<a href="#l147.158"></a><span id="l147.158"> }</span>
<a href="#l147.159"></a><span id="l147.159"> </span>
<a href="#l147.160"></a><span id="l147.160"> NS_IMETHODIMP ImportOEMailImpl::ImportMailbox(nsIImportMailboxDescriptor *pSource,</span>
<a href="#l147.161"></a><span id="l147.161">                                               nsIMsgFolder *dstFolder,</span>
<a href="#l147.162"></a><span id="l147.162" class="difflineminus">-                                              PRUnichar **pErrorLog,</span>
<a href="#l147.163"></a><span id="l147.163" class="difflineminus">-                                              PRUnichar **pSuccessLog,</span>
<a href="#l147.164"></a><span id="l147.164" class="difflineplus">+                                              char16_t **pErrorLog,</span>
<a href="#l147.165"></a><span id="l147.165" class="difflineplus">+                                              char16_t **pSuccessLog,</span>
<a href="#l147.166"></a><span id="l147.166">                                               bool *fatalError)</span>
<a href="#l147.167"></a><span id="l147.167"> {</span>
<a href="#l147.168"></a><span id="l147.168">   NS_ENSURE_ARG_POINTER(pSource);</span>
<a href="#l147.169"></a><span id="l147.169">   NS_ENSURE_ARG_POINTER(dstFolder);</span>
<a href="#l147.170"></a><span id="l147.170">   NS_ENSURE_ARG_POINTER(fatalError);</span>
<a href="#l147.171"></a><span id="l147.171"> </span>
<a href="#l147.172"></a><span id="l147.172">   nsString success;</span>
<a href="#l147.173"></a><span id="l147.173">   nsString error;</span>
<a href="#l147.174"></a><span id="l147.174" class="difflineat">@@ -501,17 +501,17 @@ NS_IMETHODIMP ImportOEAddressImpl::GetDe</span>
<a href="#l147.175"></a><span id="l147.175">     // So we set a fake location here.</span>
<a href="#l147.176"></a><span id="l147.176">     if (NS_SUCCEEDED(NS_GetSpecialDirectory(NS_XPCOM_CURRENT_PROCESS_DIR, aLocation)))</span>
<a href="#l147.177"></a><span id="l147.177">       *aUserVerify = false;</span>
<a href="#l147.178"></a><span id="l147.178">   }</span>
<a href="#l147.179"></a><span id="l147.179"> </span>
<a href="#l147.180"></a><span id="l147.180">   return NS_OK;</span>
<a href="#l147.181"></a><span id="l147.181"> }</span>
<a href="#l147.182"></a><span id="l147.182"> </span>
<a href="#l147.183"></a><span id="l147.183" class="difflineminus">-NS_IMETHODIMP ImportOEAddressImpl::GetAutoFind(PRUnichar **description, bool *_retval)</span>
<a href="#l147.184"></a><span id="l147.184" class="difflineplus">+NS_IMETHODIMP ImportOEAddressImpl::GetAutoFind(char16_t **description, bool *_retval)</span>
<a href="#l147.185"></a><span id="l147.185"> {</span>
<a href="#l147.186"></a><span id="l147.186">   NS_PRECONDITION(description != nullptr, &quot;null ptr&quot;);</span>
<a href="#l147.187"></a><span id="l147.187">   NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l147.188"></a><span id="l147.188">   if (! description || !_retval)</span>
<a href="#l147.189"></a><span id="l147.189">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l147.190"></a><span id="l147.190"> </span>
<a href="#l147.191"></a><span id="l147.191">   *_retval = false;</span>
<a href="#l147.192"></a><span id="l147.192">   nsString str;</span>
<a href="#l147.193"></a><span id="l147.193" class="difflineat">@@ -585,18 +585,18 @@ NS_IMETHODIMP ImportOEAddressImpl::FindA</span>
<a href="#l147.194"></a><span id="l147.194"> }</span>
<a href="#l147.195"></a><span id="l147.195"> </span>
<a href="#l147.196"></a><span id="l147.196"> </span>
<a href="#l147.197"></a><span id="l147.197"> </span>
<a href="#l147.198"></a><span id="l147.198"> NS_IMETHODIMP ImportOEAddressImpl::ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l147.199"></a><span id="l147.199">                                                      nsIAddrDatabase *destination,</span>
<a href="#l147.200"></a><span id="l147.200">                                                      nsIImportFieldMap *fieldMap,</span>
<a href="#l147.201"></a><span id="l147.201">                                                      nsISupports *aSupportService,</span>
<a href="#l147.202"></a><span id="l147.202" class="difflineminus">-                                                     PRUnichar **errorLog,</span>
<a href="#l147.203"></a><span id="l147.203" class="difflineminus">-                                                     PRUnichar **successLog,</span>
<a href="#l147.204"></a><span id="l147.204" class="difflineplus">+                                                     char16_t **errorLog,</span>
<a href="#l147.205"></a><span id="l147.205" class="difflineplus">+                                                     char16_t **successLog,</span>
<a href="#l147.206"></a><span id="l147.206">                                                      bool *fatalError)</span>
<a href="#l147.207"></a><span id="l147.207"> {</span>
<a href="#l147.208"></a><span id="l147.208">     NS_PRECONDITION(source != nullptr, &quot;null ptr&quot;);</span>
<a href="#l147.209"></a><span id="l147.209">     // NS_PRECONDITION(destination != nullptr, &quot;null ptr&quot;);</span>
<a href="#l147.210"></a><span id="l147.210">     // NS_PRECONDITION(fieldMap != nullptr, &quot;null ptr&quot;);</span>
<a href="#l147.211"></a><span id="l147.211">     NS_PRECONDITION(fatalError != nullptr, &quot;null ptr&quot;);</span>
<a href="#l147.212"></a><span id="l147.212">     if (!source || !fatalError)</span>
<a href="#l147.213"></a><span id="l147.213">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l147.214"></a><span id="l147.214" class="difflineat">@@ -648,15 +648,15 @@ NS_IMETHODIMP ImportOEAddressImpl::GetIm</span>
<a href="#l147.215"></a><span id="l147.215">   return NS_OK;</span>
<a href="#l147.216"></a><span id="l147.216"> }</span>
<a href="#l147.217"></a><span id="l147.217"> </span>
<a href="#l147.218"></a><span id="l147.218"> void ImportOEAddressImpl::ReportSuccess(nsString&amp; name, nsString *pStream)</span>
<a href="#l147.219"></a><span id="l147.219"> {</span>
<a href="#l147.220"></a><span id="l147.220">   if (!pStream)</span>
<a href="#l147.221"></a><span id="l147.221">     return;</span>
<a href="#l147.222"></a><span id="l147.222">   // load the success string</span>
<a href="#l147.223"></a><span id="l147.223" class="difflineminus">-  PRUnichar *pFmt = nsOEStringBundle::GetStringByID(OEIMPORT_ADDRESS_SUCCESS);</span>
<a href="#l147.224"></a><span id="l147.224" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l147.225"></a><span id="l147.225" class="difflineplus">+  char16_t *pFmt = nsOEStringBundle::GetStringByID(OEIMPORT_ADDRESS_SUCCESS);</span>
<a href="#l147.226"></a><span id="l147.226" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l147.227"></a><span id="l147.227">   pStream-&gt;Append(pText);</span>
<a href="#l147.228"></a><span id="l147.228">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l147.229"></a><span id="l147.229">   nsOEStringBundle::FreeString(pFmt);</span>
<a href="#l147.230"></a><span id="l147.230">   ImportOEMailImpl::AddLinebreak(pStream);</span>
<a href="#l147.231"></a><span id="l147.231"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l148.1"></a><span id="l148.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l148.2"></a><span id="l148.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l148.3"></a><span id="l148.3" class="difflineat">@@ -247,17 +247,17 @@ bool nsOEScanBoxes::FindMailBoxes(nsIFil</span>
<a href="#l148.4"></a><span id="l148.4">       delete pEntry;</span>
<a href="#l148.5"></a><span id="l148.5">       return false;</span>
<a href="#l148.6"></a><span id="l148.6">     }</span>
<a href="#l148.7"></a><span id="l148.7"> </span>
<a href="#l148.8"></a><span id="l148.8">     #ifdef _TRACE_MAILBOX_ENTRIES</span>
<a href="#l148.9"></a><span id="l148.9">     IMPORT_LOG0(&quot;------------\n&quot;);</span>
<a href="#l148.10"></a><span id="l148.10">     IMPORT_LOG2(&quot;    Offset: %lx, index: %ld\n&quot;, curRec, pEntry-&gt;index);</span>
<a href="#l148.11"></a><span id="l148.11">     IMPORT_LOG2(&quot;      previous: %lx, next: %lx\n&quot;, previous, next);</span>
<a href="#l148.12"></a><span id="l148.12" class="difflineminus">-    IMPORT_LOG2(&quot;      Name: %S, File: %s\n&quot;, (PRUnichar *) pEntry-&gt;mailName, (const char *) pEntry-&gt;fileName);</span>
<a href="#l148.13"></a><span id="l148.13" class="difflineplus">+    IMPORT_LOG2(&quot;      Name: %S, File: %s\n&quot;, (char16_t *) pEntry-&gt;mailName, (const char *) pEntry-&gt;fileName);</span>
<a href="#l148.14"></a><span id="l148.14">     IMPORT_LOG3(&quot;      Parent: %ld, Child: %ld, Sibling: %ld\n&quot;, pEntry-&gt;parent, pEntry-&gt;child, pEntry-&gt;sibling);</span>
<a href="#l148.15"></a><span id="l148.15">     #endif</span>
<a href="#l148.16"></a><span id="l148.16"> </span>
<a href="#l148.17"></a><span id="l148.17">     if (!StringEndsWith(pEntry-&gt;fileName, NS_LITERAL_CSTRING(&quot;.mbx&quot;)))</span>
<a href="#l148.18"></a><span id="l148.18">       pEntry-&gt;fileName.Append(&quot;.mbx&quot;);</span>
<a href="#l148.19"></a><span id="l148.19"> </span>
<a href="#l148.20"></a><span id="l148.20">     m_entryArray.AppendElement(pEntry);</span>
<a href="#l148.21"></a><span id="l148.21"> </span>
<a href="#l148.22"></a><span id="l148.22" class="difflineat">@@ -727,17 +727,17 @@ void nsOEScanBoxes::BuildMailboxList(Mai</span>
<a href="#l148.23"></a><span id="l148.23">   nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l148.24"></a><span id="l148.24">   NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l148.25"></a><span id="l148.25"> </span>
<a href="#l148.26"></a><span id="l148.26">   while (pBox) {</span>
<a href="#l148.27"></a><span id="l148.27">     rv = impSvc-&gt;CreateNewMailboxDescriptor(&amp;pID);</span>
<a href="#l148.28"></a><span id="l148.28">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l148.29"></a><span id="l148.29">       pID-&gt;SetDepth(depth);</span>
<a href="#l148.30"></a><span id="l148.30">       pID-&gt;SetIdentifier(pBox-&gt;index);</span>
<a href="#l148.31"></a><span id="l148.31" class="difflineminus">-      pID-&gt;SetDisplayName((PRUnichar *)pBox-&gt;mailName.get());</span>
<a href="#l148.32"></a><span id="l148.32" class="difflineplus">+      pID-&gt;SetDisplayName((char16_t *)pBox-&gt;mailName.get());</span>
<a href="#l148.33"></a><span id="l148.33">       if (!pBox-&gt;fileName.IsEmpty()) {</span>
<a href="#l148.34"></a><span id="l148.34">         pID-&gt;GetFile(getter_AddRefs(file));</span>
<a href="#l148.35"></a><span id="l148.35">         file-&gt;InitWithFile(root);</span>
<a href="#l148.36"></a><span id="l148.36">         file-&gt;AppendNative(pBox-&gt;fileName);</span>
<a href="#l148.37"></a><span id="l148.37">         size = 0;</span>
<a href="#l148.38"></a><span id="l148.38">         file-&gt;GetFileSize(&amp;size);</span>
<a href="#l148.39"></a><span id="l148.39">         pID-&gt;SetSize(size);</span>
<a href="#l148.40"></a><span id="l148.40">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l149.1"></a><span id="l149.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l149.2"></a><span id="l149.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l149.3"></a><span id="l149.3" class="difflineat">@@ -113,17 +113,17 @@ nsOESettings::nsOESettings()</span>
<a href="#l149.4"></a><span id="l149.4"> }</span>
<a href="#l149.5"></a><span id="l149.5"> </span>
<a href="#l149.6"></a><span id="l149.6"> nsOESettings::~nsOESettings()</span>
<a href="#l149.7"></a><span id="l149.7"> {</span>
<a href="#l149.8"></a><span id="l149.8"> }</span>
<a href="#l149.9"></a><span id="l149.9"> </span>
<a href="#l149.10"></a><span id="l149.10"> NS_IMPL_ISUPPORTS1(nsOESettings, nsIImportSettings)</span>
<a href="#l149.11"></a><span id="l149.11"> </span>
<a href="#l149.12"></a><span id="l149.12" class="difflineminus">-NS_IMETHODIMP nsOESettings::AutoLocate(PRUnichar **description, nsIFile **location, bool *_retval)</span>
<a href="#l149.13"></a><span id="l149.13" class="difflineplus">+NS_IMETHODIMP nsOESettings::AutoLocate(char16_t **description, nsIFile **location, bool *_retval)</span>
<a href="#l149.14"></a><span id="l149.14"> {</span>
<a href="#l149.15"></a><span id="l149.15">   NS_PRECONDITION(description != nullptr, &quot;null ptr&quot;);</span>
<a href="#l149.16"></a><span id="l149.16">   NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l149.17"></a><span id="l149.17">   if (!description || !_retval)</span>
<a href="#l149.18"></a><span id="l149.18">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l149.19"></a><span id="l149.19"> </span>
<a href="#l149.20"></a><span id="l149.20">   *description = nsOEStringBundle::GetStringByID(OEIMPORT_NAME);</span>
<a href="#l149.21"></a><span id="l149.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l150.1"></a><span id="l150.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEStringBundle.cpp</span>
<a href="#l150.2"></a><span id="l150.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEStringBundle.cpp</span>
<a href="#l150.3"></a><span id="l150.3" class="difflineat">@@ -33,27 +33,27 @@ nsIStringBundle *nsOEStringBundle::GetSt</span>
<a href="#l150.4"></a><span id="l150.4">   m_pBundle = sBundle;</span>
<a href="#l150.5"></a><span id="l150.5"> </span>
<a href="#l150.6"></a><span id="l150.6">   return sBundle;</span>
<a href="#l150.7"></a><span id="l150.7"> }</span>
<a href="#l150.8"></a><span id="l150.8"> </span>
<a href="#l150.9"></a><span id="l150.9"> </span>
<a href="#l150.10"></a><span id="l150.10"> void nsOEStringBundle::GetStringByID(int32_t stringID, nsString&amp; result)</span>
<a href="#l150.11"></a><span id="l150.11"> {</span>
<a href="#l150.12"></a><span id="l150.12" class="difflineminus">-  PRUnichar *ptrv = GetStringByID(stringID);</span>
<a href="#l150.13"></a><span id="l150.13" class="difflineplus">+  char16_t *ptrv = GetStringByID(stringID);</span>
<a href="#l150.14"></a><span id="l150.14">   result.Adopt(ptrv);</span>
<a href="#l150.15"></a><span id="l150.15"> }</span>
<a href="#l150.16"></a><span id="l150.16"> </span>
<a href="#l150.17"></a><span id="l150.17" class="difflineminus">-PRUnichar *nsOEStringBundle::GetStringByID(int32_t stringID)</span>
<a href="#l150.18"></a><span id="l150.18" class="difflineplus">+char16_t *nsOEStringBundle::GetStringByID(int32_t stringID)</span>
<a href="#l150.19"></a><span id="l150.19"> {</span>
<a href="#l150.20"></a><span id="l150.20">   if (!m_pBundle)</span>
<a href="#l150.21"></a><span id="l150.21">     m_pBundle = GetStringBundle();</span>
<a href="#l150.22"></a><span id="l150.22"> </span>
<a href="#l150.23"></a><span id="l150.23">   if (m_pBundle) {</span>
<a href="#l150.24"></a><span id="l150.24" class="difflineminus">-    PRUnichar *ptrv = nullptr;</span>
<a href="#l150.25"></a><span id="l150.25" class="difflineplus">+    char16_t *ptrv = nullptr;</span>
<a href="#l150.26"></a><span id="l150.26">     nsresult rv = m_pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l150.27"></a><span id="l150.27"> </span>
<a href="#l150.28"></a><span id="l150.28">     if (NS_SUCCEEDED(rv) &amp;&amp; ptrv)</span>
<a href="#l150.29"></a><span id="l150.29">       return ptrv;</span>
<a href="#l150.30"></a><span id="l150.30">   }</span>
<a href="#l150.31"></a><span id="l150.31"> </span>
<a href="#l150.32"></a><span id="l150.32">   nsString resultString;</span>
<a href="#l150.33"></a><span id="l150.33">   resultString.AppendLiteral(&quot;[StringID &quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l151.1"></a><span id="l151.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEStringBundle.h</span>
<a href="#l151.2"></a><span id="l151.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEStringBundle.h</span>
<a href="#l151.3"></a><span id="l151.3" class="difflineat">@@ -6,20 +6,20 @@</span>
<a href="#l151.4"></a><span id="l151.4"> #define _nsOEStringBundle_H__</span>
<a href="#l151.5"></a><span id="l151.5"> </span>
<a href="#l151.6"></a><span id="l151.6"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l151.7"></a><span id="l151.7"> </span>
<a href="#l151.8"></a><span id="l151.8"> class nsIStringBundle;</span>
<a href="#l151.9"></a><span id="l151.9"> </span>
<a href="#l151.10"></a><span id="l151.10"> class nsOEStringBundle {</span>
<a href="#l151.11"></a><span id="l151.11"> public:</span>
<a href="#l151.12"></a><span id="l151.12" class="difflineminus">-  static PRUnichar     *    GetStringByID(int32_t stringID);</span>
<a href="#l151.13"></a><span id="l151.13" class="difflineplus">+  static char16_t     *    GetStringByID(int32_t stringID);</span>
<a href="#l151.14"></a><span id="l151.14">   static void          GetStringByID(int32_t stringID, nsString&amp; result);</span>
<a href="#l151.15"></a><span id="l151.15">   static nsIStringBundle *  GetStringBundle(void); // don't release</span>
<a href="#l151.16"></a><span id="l151.16" class="difflineminus">-  static void          FreeString(PRUnichar *pStr) { NS_Free(pStr);}</span>
<a href="#l151.17"></a><span id="l151.17" class="difflineplus">+  static void          FreeString(char16_t *pStr) { NS_Free(pStr);}</span>
<a href="#l151.18"></a><span id="l151.18">   static void          Cleanup(void);</span>
<a href="#l151.19"></a><span id="l151.19"> </span>
<a href="#l151.20"></a><span id="l151.20"> private:</span>
<a href="#l151.21"></a><span id="l151.21">   static nsIStringBundle *  m_pBundle;</span>
<a href="#l151.22"></a><span id="l151.22"> };</span>
<a href="#l151.23"></a><span id="l151.23"> </span>
<a href="#l151.24"></a><span id="l151.24"> </span>
<a href="#l151.25"></a><span id="l151.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l152.1"></a><span id="l152.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l152.2"></a><span id="l152.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l152.3"></a><span id="l152.3" class="difflineat">@@ -15,17 +15,17 @@</span>
<a href="#l152.4"></a><span id="l152.4"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l152.5"></a><span id="l152.5"> </span>
<a href="#l152.6"></a><span id="l152.6"> int      CMapiApi::m_clients = 0;</span>
<a href="#l152.7"></a><span id="l152.7"> BOOL    CMapiApi::m_initialized = false;</span>
<a href="#l152.8"></a><span id="l152.8"> nsVoidArray  *CMapiApi::m_pStores = NULL;</span>
<a href="#l152.9"></a><span id="l152.9"> LPMAPISESSION CMapiApi::m_lpSession = NULL;</span>
<a href="#l152.10"></a><span id="l152.10"> LPMDB    CMapiApi::m_lpMdb = NULL;</span>
<a href="#l152.11"></a><span id="l152.11"> HRESULT    CMapiApi::m_lastError;</span>
<a href="#l152.12"></a><span id="l152.12" class="difflineminus">-PRUnichar *  CMapiApi::m_pUniBuff = NULL;</span>
<a href="#l152.13"></a><span id="l152.13" class="difflineplus">+char16_t *  CMapiApi::m_pUniBuff = NULL;</span>
<a href="#l152.14"></a><span id="l152.14"> int      CMapiApi::m_uniBuffLen = 0;</span>
<a href="#l152.15"></a><span id="l152.15"> /*</span>
<a href="#l152.16"></a><span id="l152.16"> Type: 1, name: Calendar, class: IPF.Appointment</span>
<a href="#l152.17"></a><span id="l152.17"> Type: 1, name: Contacts, class: IPF.Contact</span>
<a href="#l152.18"></a><span id="l152.18"> Type: 1, name: Journal, class: IPF.Journal</span>
<a href="#l152.19"></a><span id="l152.19"> Type: 1, name: Notes, class: IPF.StickyNote</span>
<a href="#l152.20"></a><span id="l152.20"> Type: 1, name: Tasks, class: IPF.Task</span>
<a href="#l152.21"></a><span id="l152.21"> Type: 1, name: Drafts, class: IPF.Note</span>
<a href="#l152.22"></a><span id="l152.22" class="difflineat">@@ -295,17 +295,17 @@ CMapiApi::~CMapiApi()</span>
<a href="#l152.23"></a><span id="l152.23"> </span>
<a href="#l152.24"></a><span id="l152.24"> void CMapiApi::CStrToUnicode(const char *pStr, nsString&amp; result)</span>
<a href="#l152.25"></a><span id="l152.25"> {</span>
<a href="#l152.26"></a><span id="l152.26">   result.Truncate();</span>
<a href="#l152.27"></a><span id="l152.27">   int wLen = MultiByteToWideChar(CP_ACP, 0, pStr, -1, m_pUniBuff, 0);</span>
<a href="#l152.28"></a><span id="l152.28">   if (wLen &gt;= m_uniBuffLen) {</span>
<a href="#l152.29"></a><span id="l152.29">     if (m_pUniBuff)</span>
<a href="#l152.30"></a><span id="l152.30">       delete [] m_pUniBuff;</span>
<a href="#l152.31"></a><span id="l152.31" class="difflineminus">-    m_pUniBuff = new PRUnichar[wLen + 64];</span>
<a href="#l152.32"></a><span id="l152.32" class="difflineplus">+    m_pUniBuff = new char16_t[wLen + 64];</span>
<a href="#l152.33"></a><span id="l152.33">     m_uniBuffLen = wLen + 64;</span>
<a href="#l152.34"></a><span id="l152.34">   }</span>
<a href="#l152.35"></a><span id="l152.35">   if (wLen) {</span>
<a href="#l152.36"></a><span id="l152.36">     MultiByteToWideChar(CP_ACP, 0, pStr, -1, m_pUniBuff, m_uniBuffLen);</span>
<a href="#l152.37"></a><span id="l152.37">     result = m_pUniBuff;</span>
<a href="#l152.38"></a><span id="l152.38">   }</span>
<a href="#l152.39"></a><span id="l152.39"> }</span>
<a href="#l152.40"></a><span id="l152.40"> </span>
<a href="#l152.41"></a><span id="l152.41" class="difflineat">@@ -362,33 +362,33 @@ BOOL CMapiApi::LogOn(void)</span>
<a href="#l152.42"></a><span id="l152.42"> </span>
<a href="#l152.43"></a><span id="l152.43"> class CGetStoreFoldersIter : public CMapiHierarchyIter {</span>
<a href="#l152.44"></a><span id="l152.44"> public:</span>
<a href="#l152.45"></a><span id="l152.45">   CGetStoreFoldersIter(CMapiApi *pApi, CMapiFolderList&amp; folders, int depth, BOOL isMail = TRUE);</span>
<a href="#l152.46"></a><span id="l152.46"> </span>
<a href="#l152.47"></a><span id="l152.47">   virtual BOOL HandleHierarchyItem(ULONG oType, ULONG cb, LPENTRYID pEntry);</span>
<a href="#l152.48"></a><span id="l152.48"> </span>
<a href="#l152.49"></a><span id="l152.49"> protected:</span>
<a href="#l152.50"></a><span id="l152.50" class="difflineminus">-  BOOL  ExcludeFolderClass(const PRUnichar *pName);</span>
<a href="#l152.51"></a><span id="l152.51" class="difflineplus">+  BOOL  ExcludeFolderClass(const char16_t *pName);</span>
<a href="#l152.52"></a><span id="l152.52"> </span>
<a href="#l152.53"></a><span id="l152.53">   BOOL        m_isMail;</span>
<a href="#l152.54"></a><span id="l152.54">   CMapiApi *      m_pApi;</span>
<a href="#l152.55"></a><span id="l152.55">   CMapiFolderList *  m_pList;</span>
<a href="#l152.56"></a><span id="l152.56">   int          m_depth;</span>
<a href="#l152.57"></a><span id="l152.57"> };</span>
<a href="#l152.58"></a><span id="l152.58"> </span>
<a href="#l152.59"></a><span id="l152.59"> CGetStoreFoldersIter::CGetStoreFoldersIter(CMapiApi *pApi, CMapiFolderList&amp; folders, int depth, BOOL isMail)</span>
<a href="#l152.60"></a><span id="l152.60"> {</span>
<a href="#l152.61"></a><span id="l152.61">   m_pApi = pApi;</span>
<a href="#l152.62"></a><span id="l152.62">   m_pList = &amp;folders;</span>
<a href="#l152.63"></a><span id="l152.63">   m_depth = depth;</span>
<a href="#l152.64"></a><span id="l152.64">   m_isMail = isMail;</span>
<a href="#l152.65"></a><span id="l152.65"> }</span>
<a href="#l152.66"></a><span id="l152.66"> </span>
<a href="#l152.67"></a><span id="l152.67" class="difflineminus">-BOOL CGetStoreFoldersIter::ExcludeFolderClass(const PRUnichar *pName)</span>
<a href="#l152.68"></a><span id="l152.68" class="difflineplus">+BOOL CGetStoreFoldersIter::ExcludeFolderClass(const char16_t *pName)</span>
<a href="#l152.69"></a><span id="l152.69"> {</span>
<a href="#l152.70"></a><span id="l152.70">   BOOL bResult;</span>
<a href="#l152.71"></a><span id="l152.71">     nsDependentString pNameStr(pName);</span>
<a href="#l152.72"></a><span id="l152.72">   if (m_isMail) {</span>
<a href="#l152.73"></a><span id="l152.73">     bResult = FALSE;</span>
<a href="#l152.74"></a><span id="l152.74">         if (pNameStr.EqualsLiteral(&quot;IPF.Appointment&quot;))</span>
<a href="#l152.75"></a><span id="l152.75">       bResult = TRUE;</span>
<a href="#l152.76"></a><span id="l152.76">     else if (pNameStr.EqualsLiteral(&quot;IPF.Contact&quot;))</span>
<a href="#l152.77"></a><span id="l152.77" class="difflineat">@@ -982,17 +982,17 @@ BOOL CMapiApi::IterateStores(CMapiFolder</span>
<a href="#l152.78"></a><span id="l152.78">         // does not exist, then szContents will be zero.  We'll</span>
<a href="#l152.79"></a><span id="l152.79">         // assume that any store that doesn't have anything in</span>
<a href="#l152.80"></a><span id="l152.80">         // it's hierarchy tree is not a store we want to import -</span>
<a href="#l152.81"></a><span id="l152.81">         // there would be nothing to import from anyway!</span>
<a href="#l152.82"></a><span id="l152.82">         // Currently, this does exclude IMAP server accounts</span>
<a href="#l152.83"></a><span id="l152.83">         // which is the desired behaviour.</span>
<a href="#l152.84"></a><span id="l152.84"> </span>
<a href="#l152.85"></a><span id="l152.85">         int         strLen = strlen(lpStr);</span>
<a href="#l152.86"></a><span id="l152.86" class="difflineminus">-        PRUnichar * pwszStr = (PRUnichar *) nsMemory::Alloc((strLen + 1) * sizeof(WCHAR));</span>
<a href="#l152.87"></a><span id="l152.87" class="difflineplus">+        char16_t * pwszStr = (char16_t *) nsMemory::Alloc((strLen + 1) * sizeof(WCHAR));</span>
<a href="#l152.88"></a><span id="l152.88">         if (!pwszStr) {</span>
<a href="#l152.89"></a><span id="l152.89">           // out of memory</span>
<a href="#l152.90"></a><span id="l152.90">           FreeProws(lpRow);</span>
<a href="#l152.91"></a><span id="l152.91">           lpTable-&gt;Release();</span>
<a href="#l152.92"></a><span id="l152.92">           return FALSE;</span>
<a href="#l152.93"></a><span id="l152.93">         }</span>
<a href="#l152.94"></a><span id="l152.94">         ::MultiByteToWideChar(CP_ACP, 0, lpStr, strlen(lpStr) + 1, pwszStr, (strLen + 1) * sizeof(WCHAR));</span>
<a href="#l152.95"></a><span id="l152.95">         CMapiFolder *pFolder = new CMapiFolder(pwszStr, cbEID, lpEID, 0, MAPI_STORE);</span>
<a href="#l152.96"></a><span id="l152.96" class="difflineat">@@ -1310,17 +1310,17 @@ BOOL CMapiApi::GetStringFromProp(LPSProp</span>
<a href="#l152.97"></a><span id="l152.97"> </span>
<a href="#l152.98"></a><span id="l152.98"> BOOL CMapiApi::GetStringFromProp(LPSPropValue pVal, nsString&amp; val, BOOL delVal)</span>
<a href="#l152.99"></a><span id="l152.99"> {</span>
<a href="#l152.100"></a><span id="l152.100">   BOOL bResult = TRUE;</span>
<a href="#l152.101"></a><span id="l152.101">   if (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_STRING8)) {</span>
<a href="#l152.102"></a><span id="l152.102">     CStrToUnicode((const char *)pVal-&gt;Value.lpszA, val);</span>
<a href="#l152.103"></a><span id="l152.103">   }</span>
<a href="#l152.104"></a><span id="l152.104">   else if (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_UNICODE)) {</span>
<a href="#l152.105"></a><span id="l152.105" class="difflineminus">-    val = (PRUnichar *) pVal-&gt;Value.lpszW;</span>
<a href="#l152.106"></a><span id="l152.106" class="difflineplus">+    val = (char16_t *) pVal-&gt;Value.lpszW;</span>
<a href="#l152.107"></a><span id="l152.107">   }</span>
<a href="#l152.108"></a><span id="l152.108">   else if (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_NULL)) {</span>
<a href="#l152.109"></a><span id="l152.109">     val.Truncate();</span>
<a href="#l152.110"></a><span id="l152.110">   }</span>
<a href="#l152.111"></a><span id="l152.111">   else if (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_ERROR)) {</span>
<a href="#l152.112"></a><span id="l152.112">     val.Truncate();</span>
<a href="#l152.113"></a><span id="l152.113">     bResult = FALSE;</span>
<a href="#l152.114"></a><span id="l152.114">   }</span>
<a href="#l152.115"></a><span id="l152.115" class="difflineat">@@ -1549,17 +1549,17 @@ void CMapiFolderList::AddItem(CMapiFolde</span>
<a href="#l152.116"></a><span id="l152.116"> }</span>
<a href="#l152.117"></a><span id="l152.117"> </span>
<a href="#l152.118"></a><span id="l152.118"> void CMapiFolderList::ChangeName(nsString&amp; name)</span>
<a href="#l152.119"></a><span id="l152.119"> {</span>
<a href="#l152.120"></a><span id="l152.120">   if (name.IsEmpty()) {</span>
<a href="#l152.121"></a><span id="l152.121">     name.AssignLiteral(&quot;1&quot;);</span>
<a href="#l152.122"></a><span id="l152.122">     return;</span>
<a href="#l152.123"></a><span id="l152.123">   }</span>
<a href="#l152.124"></a><span id="l152.124" class="difflineminus">-  PRUnichar lastC = name.Last();</span>
<a href="#l152.125"></a><span id="l152.125" class="difflineplus">+  char16_t lastC = name.Last();</span>
<a href="#l152.126"></a><span id="l152.126">   if ((lastC &gt;= '0') &amp;&amp; (lastC &lt;= '9')) {</span>
<a href="#l152.127"></a><span id="l152.127">     lastC++;</span>
<a href="#l152.128"></a><span id="l152.128">     if (lastC &gt; '9') {</span>
<a href="#l152.129"></a><span id="l152.129">       lastC = '1';</span>
<a href="#l152.130"></a><span id="l152.130">       name.SetCharAt(lastC, name.Length() - 1);</span>
<a href="#l152.131"></a><span id="l152.131">       name.AppendLiteral(&quot;0&quot;);</span>
<a href="#l152.132"></a><span id="l152.132">     }</span>
<a href="#l152.133"></a><span id="l152.133">     else {</span>
<a href="#l152.134"></a><span id="l152.134" class="difflineat">@@ -1679,17 +1679,17 @@ CMapiFolder::CMapiFolder()</span>
<a href="#l152.135"></a><span id="l152.135"> {</span>
<a href="#l152.136"></a><span id="l152.136">   m_objectType = MAPI_FOLDER;</span>
<a href="#l152.137"></a><span id="l152.137">   m_cbEid = 0;</span>
<a href="#l152.138"></a><span id="l152.138">   m_lpEid = NULL;</span>
<a href="#l152.139"></a><span id="l152.139">   m_depth = 0;</span>
<a href="#l152.140"></a><span id="l152.140">   m_doImport = TRUE;</span>
<a href="#l152.141"></a><span id="l152.141"> }</span>
<a href="#l152.142"></a><span id="l152.142"> </span>
<a href="#l152.143"></a><span id="l152.143" class="difflineminus">-CMapiFolder::CMapiFolder(const PRUnichar *pDisplayName, ULONG cbEid, LPENTRYID lpEid, int depth, LONG oType)</span>
<a href="#l152.144"></a><span id="l152.144" class="difflineplus">+CMapiFolder::CMapiFolder(const char16_t *pDisplayName, ULONG cbEid, LPENTRYID lpEid, int depth, LONG oType)</span>
<a href="#l152.145"></a><span id="l152.145"> {</span>
<a href="#l152.146"></a><span id="l152.146">   m_cbEid = 0;</span>
<a href="#l152.147"></a><span id="l152.147">   m_lpEid = NULL;</span>
<a href="#l152.148"></a><span id="l152.148">   SetDisplayName(pDisplayName);</span>
<a href="#l152.149"></a><span id="l152.149">   SetEntryID(cbEid, lpEid);</span>
<a href="#l152.150"></a><span id="l152.150">   SetDepth(depth);</span>
<a href="#l152.151"></a><span id="l152.151">   SetObjectType(oType);</span>
<a href="#l152.152"></a><span id="l152.152">   SetDoImport(TRUE);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l153.1"></a><span id="l153.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiApi.h</span>
<a href="#l153.2"></a><span id="l153.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiApi.h</span>
<a href="#l153.3"></a><span id="l153.3" class="difflineat">@@ -145,35 +145,35 @@ protected:</span>
<a href="#l153.4"></a><span id="l153.4"> </span>
<a href="#l153.5"></a><span id="l153.5"> private:</span>
<a href="#l153.6"></a><span id="l153.6">   static int        m_clients;</span>
<a href="#l153.7"></a><span id="l153.7">   static BOOL        m_initialized;</span>
<a href="#l153.8"></a><span id="l153.8">   static nsVoidArray *  m_pStores;</span>
<a href="#l153.9"></a><span id="l153.9">   static LPMAPISESSION  m_lpSession;</span>
<a href="#l153.10"></a><span id="l153.10">   static LPMDB      m_lpMdb;</span>
<a href="#l153.11"></a><span id="l153.11">   static HRESULT      m_lastError;</span>
<a href="#l153.12"></a><span id="l153.12" class="difflineminus">-  static PRUnichar *    m_pUniBuff;</span>
<a href="#l153.13"></a><span id="l153.13" class="difflineplus">+  static char16_t *    m_pUniBuff;</span>
<a href="#l153.14"></a><span id="l153.14">   static int        m_uniBuffLen;</span>
<a href="#l153.15"></a><span id="l153.15"> </span>
<a href="#l153.16"></a><span id="l153.16">   static BOOL      GetLargeProperty(LPMAPIPROP pProp, ULONG tag, void** result);</span>
<a href="#l153.17"></a><span id="l153.17"> };</span>
<a href="#l153.18"></a><span id="l153.18"> </span>
<a href="#l153.19"></a><span id="l153.19"> class CMapiFolder {</span>
<a href="#l153.20"></a><span id="l153.20"> public:</span>
<a href="#l153.21"></a><span id="l153.21">   CMapiFolder();</span>
<a href="#l153.22"></a><span id="l153.22">   CMapiFolder(const CMapiFolder *pCopyFrom);</span>
<a href="#l153.23"></a><span id="l153.23" class="difflineminus">-  CMapiFolder(const PRUnichar *pDisplayName, ULONG cbEid, LPENTRYID lpEid, int depth, LONG oType = MAPI_FOLDER);</span>
<a href="#l153.24"></a><span id="l153.24" class="difflineplus">+  CMapiFolder(const char16_t *pDisplayName, ULONG cbEid, LPENTRYID lpEid, int depth, LONG oType = MAPI_FOLDER);</span>
<a href="#l153.25"></a><span id="l153.25">   ~CMapiFolder();</span>
<a href="#l153.26"></a><span id="l153.26"> </span>
<a href="#l153.27"></a><span id="l153.27">   void  SetDoImport(BOOL doIt) { m_doImport = doIt;}</span>
<a href="#l153.28"></a><span id="l153.28">   void  SetObjectType(long oType) { m_objectType = oType;}</span>
<a href="#l153.29"></a><span id="l153.29" class="difflineminus">-  void  SetDisplayName(const PRUnichar *pDisplayName) { m_displayName = pDisplayName;}</span>
<a href="#l153.30"></a><span id="l153.30" class="difflineplus">+  void  SetDisplayName(const char16_t *pDisplayName) { m_displayName = pDisplayName;}</span>
<a href="#l153.31"></a><span id="l153.31">   void  SetEntryID(ULONG cbEid, LPENTRYID lpEid);</span>
<a href="#l153.32"></a><span id="l153.32">   void  SetDepth(int depth) { m_depth = depth;}</span>
<a href="#l153.33"></a><span id="l153.33" class="difflineminus">-  void  SetFilePath(const PRUnichar *pFilePath) { m_mailFilePath = pFilePath;}</span>
<a href="#l153.34"></a><span id="l153.34" class="difflineplus">+  void  SetFilePath(const char16_t *pFilePath) { m_mailFilePath = pFilePath;}</span>
<a href="#l153.35"></a><span id="l153.35"> </span>
<a href="#l153.36"></a><span id="l153.36">   BOOL  GetDoImport(void) const { return m_doImport;}</span>
<a href="#l153.37"></a><span id="l153.37">   LONG  GetObjectType(void) const { return m_objectType;}</span>
<a href="#l153.38"></a><span id="l153.38">   void  GetDisplayName(nsString&amp; name) const { name = m_displayName;}</span>
<a href="#l153.39"></a><span id="l153.39">   void  GetFilePath(nsString&amp; path) const { path = m_mailFilePath;}</span>
<a href="#l153.40"></a><span id="l153.40">   BOOL  IsStore(void) const { return m_objectType == MAPI_STORE;}</span>
<a href="#l153.41"></a><span id="l153.41">   BOOL  IsFolder(void) const { return m_objectType == MAPI_FOLDER;}</span>
<a href="#l153.42"></a><span id="l153.42">   int    GetDepth(void) const { return m_depth;}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l154.1"></a><span id="l154.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l154.2"></a><span id="l154.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l154.3"></a><span id="l154.3" class="difflineat">@@ -127,20 +127,20 @@ public:</span>
<a href="#l154.4"></a><span id="l154.4"> </span>
<a href="#l154.5"></a><span id="l154.5">   /* void OnStartSending (in string aMsgID, in uint32_t aMsgSize); */</span>
<a href="#l154.6"></a><span id="l154.6">   NS_IMETHOD OnStartSending(const char *aMsgID, uint32_t aMsgSize) {return NS_OK;}</span>
<a href="#l154.7"></a><span id="l154.7"> </span>
<a href="#l154.8"></a><span id="l154.8">   /* void OnProgress (in string aMsgID, in uint32_t aProgress, in uint32_t aProgressMax); */</span>
<a href="#l154.9"></a><span id="l154.9">   NS_IMETHOD OnProgress(const char *aMsgID, uint32_t aProgress, uint32_t aProgressMax) {return NS_OK;}</span>
<a href="#l154.10"></a><span id="l154.10"> </span>
<a href="#l154.11"></a><span id="l154.11">   /* void OnStatus (in string aMsgID, in wstring aMsg); */</span>
<a href="#l154.12"></a><span id="l154.12" class="difflineminus">-  NS_IMETHOD OnStatus(const char *aMsgID, const PRUnichar *aMsg) {return NS_OK;}</span>
<a href="#l154.13"></a><span id="l154.13" class="difflineplus">+  NS_IMETHOD OnStatus(const char *aMsgID, const char16_t *aMsg) {return NS_OK;}</span>
<a href="#l154.14"></a><span id="l154.14"> </span>
<a href="#l154.15"></a><span id="l154.15">   /* void OnStopSending (in string aMsgID, in nsresult aStatus, in wstring aMsg, in nsIFile returnFile); */</span>
<a href="#l154.16"></a><span id="l154.16" class="difflineminus">-  NS_IMETHOD OnStopSending(const char *aMsgID, nsresult aStatus, const PRUnichar *aMsg,</span>
<a href="#l154.17"></a><span id="l154.17" class="difflineplus">+  NS_IMETHOD OnStopSending(const char *aMsgID, nsresult aStatus, const char16_t *aMsg,</span>
<a href="#l154.18"></a><span id="l154.18">                nsIFile *returnFile) {</span>
<a href="#l154.19"></a><span id="l154.19">     m_done = true;</span>
<a href="#l154.20"></a><span id="l154.20">     NS_IF_ADDREF(m_location = returnFile);</span>
<a href="#l154.21"></a><span id="l154.21">     return NS_OK;</span>
<a href="#l154.22"></a><span id="l154.22">   }</span>
<a href="#l154.23"></a><span id="l154.23"> </span>
<a href="#l154.24"></a><span id="l154.24">    /* void OnSendNotPerformed */</span>
<a href="#l154.25"></a><span id="l154.25">    NS_IMETHOD OnSendNotPerformed(const char *aMsgID, nsresult aStatus) {return NS_OK;}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l155.1"></a><span id="l155.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookImport.cpp</span>
<a href="#l155.2"></a><span id="l155.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookImport.cpp</span>
<a href="#l155.3"></a><span id="l155.3" class="difflineat">@@ -60,29 +60,29 @@ public:</span>
<a href="#l155.4"></a><span id="l155.4">   /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l155.5"></a><span id="l155.5">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l155.6"></a><span id="l155.6"> </span>
<a href="#l155.7"></a><span id="l155.7">   /* nsIArray FindMailboxes (in nsIFile location); */</span>
<a href="#l155.8"></a><span id="l155.8">   NS_IMETHOD FindMailboxes(nsIFile *location, nsIArray **_retval);</span>
<a href="#l155.9"></a><span id="l155.9"> </span>
<a href="#l155.10"></a><span id="l155.10">   NS_IMETHOD ImportMailbox(nsIImportMailboxDescriptor *source,</span>
<a href="#l155.11"></a><span id="l155.11">                            nsIMsgFolder *dstFolder,</span>
<a href="#l155.12"></a><span id="l155.12" class="difflineminus">-                           PRUnichar **pErrorLog, PRUnichar **pSuccessLog,</span>
<a href="#l155.13"></a><span id="l155.13" class="difflineplus">+                           char16_t **pErrorLog, char16_t **pSuccessLog,</span>
<a href="#l155.14"></a><span id="l155.14">                            bool *fatalError);</span>
<a href="#l155.15"></a><span id="l155.15"> </span>
<a href="#l155.16"></a><span id="l155.16">   /* unsigned long GetImportProgress (); */</span>
<a href="#l155.17"></a><span id="l155.17">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l155.18"></a><span id="l155.18"> </span>
<a href="#l155.19"></a><span id="l155.19">   NS_IMETHOD TranslateFolderName(const nsAString &amp; aFolderName, nsAString &amp; _retval);</span>
<a href="#l155.20"></a><span id="l155.20"> </span>
<a href="#l155.21"></a><span id="l155.21"> public:</span>
<a href="#l155.22"></a><span id="l155.22">   static void  ReportSuccess(nsString&amp; name, int32_t count, nsString *pStream);</span>
<a href="#l155.23"></a><span id="l155.23">   static void ReportError(int32_t errorNum, nsString&amp; name, nsString *pStream);</span>
<a href="#l155.24"></a><span id="l155.24">   static void  AddLinebreak(nsString *pStream);</span>
<a href="#l155.25"></a><span id="l155.25" class="difflineminus">-  static void  SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess);</span>
<a href="#l155.26"></a><span id="l155.26" class="difflineplus">+  static void  SetLogs(nsString&amp; success, nsString&amp; error, char16_t **pError, char16_t **pSuccess);</span>
<a href="#l155.27"></a><span id="l155.27"> </span>
<a href="#l155.28"></a><span id="l155.28"> private:</span>
<a href="#l155.29"></a><span id="l155.29">   nsOutlookMail  m_mail;</span>
<a href="#l155.30"></a><span id="l155.30">   uint32_t    m_bytesDone;</span>
<a href="#l155.31"></a><span id="l155.31"> };</span>
<a href="#l155.32"></a><span id="l155.32"> </span>
<a href="#l155.33"></a><span id="l155.33"> </span>
<a href="#l155.34"></a><span id="l155.34"> class ImportOutlookAddressImpl : public nsIImportAddressBooks</span>
<a href="#l155.35"></a><span id="l155.35" class="difflineat">@@ -95,39 +95,39 @@ public:</span>
<a href="#l155.36"></a><span id="l155.36"> </span>
<a href="#l155.37"></a><span id="l155.37">   // nsISupports interface</span>
<a href="#l155.38"></a><span id="l155.38">   NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l155.39"></a><span id="l155.39"> </span>
<a href="#l155.40"></a><span id="l155.40">   // nsIImportAddressBooks interface</span>
<a href="#l155.41"></a><span id="l155.41"> </span>
<a href="#l155.42"></a><span id="l155.42">   NS_IMETHOD GetSupportsMultiple(bool *_retval) { *_retval = true; return NS_OK;}</span>
<a href="#l155.43"></a><span id="l155.43"> </span>
<a href="#l155.44"></a><span id="l155.44" class="difflineminus">-  NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l155.45"></a><span id="l155.45" class="difflineplus">+  NS_IMETHOD GetAutoFind(char16_t **description, bool *_retval);</span>
<a href="#l155.46"></a><span id="l155.46"> </span>
<a href="#l155.47"></a><span id="l155.47">   NS_IMETHOD GetNeedsFieldMap(nsIFile *location, bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l155.48"></a><span id="l155.48"> </span>
<a href="#l155.49"></a><span id="l155.49">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify)</span>
<a href="#l155.50"></a><span id="l155.50">     { return NS_ERROR_FAILURE;}</span>
<a href="#l155.51"></a><span id="l155.51"> </span>
<a href="#l155.52"></a><span id="l155.52">   NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l155.53"></a><span id="l155.53"> </span>
<a href="#l155.54"></a><span id="l155.54">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap)</span>
<a href="#l155.55"></a><span id="l155.55">     { return NS_ERROR_FAILURE; }</span>
<a href="#l155.56"></a><span id="l155.56"> </span>
<a href="#l155.57"></a><span id="l155.57">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l155.58"></a><span id="l155.58">                                nsIAddrDatabase *destination,</span>
<a href="#l155.59"></a><span id="l155.59">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l155.60"></a><span id="l155.60">                                nsISupports *aSupportService,</span>
<a href="#l155.61"></a><span id="l155.61" class="difflineminus">-                               PRUnichar **errorLog,</span>
<a href="#l155.62"></a><span id="l155.62" class="difflineminus">-                               PRUnichar **successLog,</span>
<a href="#l155.63"></a><span id="l155.63" class="difflineplus">+                               char16_t **errorLog,</span>
<a href="#l155.64"></a><span id="l155.64" class="difflineplus">+                               char16_t **successLog,</span>
<a href="#l155.65"></a><span id="l155.65">                                bool *fatalError);</span>
<a href="#l155.66"></a><span id="l155.66"> </span>
<a href="#l155.67"></a><span id="l155.67">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l155.68"></a><span id="l155.68"> </span>
<a href="#l155.69"></a><span id="l155.69" class="difflineminus">-  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, PRUnichar **pStr)</span>
<a href="#l155.70"></a><span id="l155.70" class="difflineplus">+  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, char16_t **pStr)</span>
<a href="#l155.71"></a><span id="l155.71">     { return NS_ERROR_FAILURE;}</span>
<a href="#l155.72"></a><span id="l155.72"> </span>
<a href="#l155.73"></a><span id="l155.73">   NS_IMETHOD SetSampleLocation(nsIFile *) { return NS_OK; }</span>
<a href="#l155.74"></a><span id="l155.74"> </span>
<a href="#l155.75"></a><span id="l155.75"> private:</span>
<a href="#l155.76"></a><span id="l155.76">   void  ReportSuccess(nsString&amp; name, nsString *pStream);</span>
<a href="#l155.77"></a><span id="l155.77"> </span>
<a href="#l155.78"></a><span id="l155.78"> private:</span>
<a href="#l155.79"></a><span id="l155.79" class="difflineat">@@ -155,27 +155,27 @@ nsOutlookImport::nsOutlookImport()</span>
<a href="#l155.80"></a><span id="l155.80"> </span>
<a href="#l155.81"></a><span id="l155.81"> nsOutlookImport::~nsOutlookImport()</span>
<a href="#l155.82"></a><span id="l155.82"> {</span>
<a href="#l155.83"></a><span id="l155.83">   IMPORT_LOG0(&quot;nsOutlookImport Module Deleted\n&quot;);</span>
<a href="#l155.84"></a><span id="l155.84"> }</span>
<a href="#l155.85"></a><span id="l155.85"> </span>
<a href="#l155.86"></a><span id="l155.86"> NS_IMPL_ISUPPORTS1(nsOutlookImport, nsIImportModule)</span>
<a href="#l155.87"></a><span id="l155.87"> </span>
<a href="#l155.88"></a><span id="l155.88" class="difflineminus">-NS_IMETHODIMP nsOutlookImport::GetName(PRUnichar **name)</span>
<a href="#l155.89"></a><span id="l155.89" class="difflineplus">+NS_IMETHODIMP nsOutlookImport::GetName(char16_t **name)</span>
<a href="#l155.90"></a><span id="l155.90"> {</span>
<a href="#l155.91"></a><span id="l155.91">   NS_PRECONDITION(name != nullptr, &quot;null ptr&quot;);</span>
<a href="#l155.92"></a><span id="l155.92">   if (! name)</span>
<a href="#l155.93"></a><span id="l155.93">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l155.94"></a><span id="l155.94"> </span>
<a href="#l155.95"></a><span id="l155.95">   *name = nsOutlookStringBundle::GetStringByID(OUTLOOKIMPORT_NAME);</span>
<a href="#l155.96"></a><span id="l155.96">   return NS_OK;</span>
<a href="#l155.97"></a><span id="l155.97"> }</span>
<a href="#l155.98"></a><span id="l155.98"> </span>
<a href="#l155.99"></a><span id="l155.99" class="difflineminus">-NS_IMETHODIMP nsOutlookImport::GetDescription(PRUnichar **name)</span>
<a href="#l155.100"></a><span id="l155.100" class="difflineplus">+NS_IMETHODIMP nsOutlookImport::GetDescription(char16_t **name)</span>
<a href="#l155.101"></a><span id="l155.101"> {</span>
<a href="#l155.102"></a><span id="l155.102">   NS_PRECONDITION(name != nullptr, &quot;null ptr&quot;);</span>
<a href="#l155.103"></a><span id="l155.103">   if (!name)</span>
<a href="#l155.104"></a><span id="l155.104">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l155.105"></a><span id="l155.105"> </span>
<a href="#l155.106"></a><span id="l155.106">   *name = nsOutlookStringBundle::GetStringByID(OUTLOOKIMPORT_DESCRIPTION);</span>
<a href="#l155.107"></a><span id="l155.107"> </span>
<a href="#l155.108"></a><span id="l155.108">   return NS_OK;</span>
<a href="#l155.109"></a><span id="l155.109" class="difflineat">@@ -345,70 +345,70 @@ NS_IMETHODIMP ImportOutlookMailImpl::Fin</span>
<a href="#l155.110"></a><span id="l155.110">   if (!pLoc || !ppArray)</span>
<a href="#l155.111"></a><span id="l155.111">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l155.112"></a><span id="l155.112">   return m_mail.GetMailFolders(ppArray);</span>
<a href="#l155.113"></a><span id="l155.113"> }</span>
<a href="#l155.114"></a><span id="l155.114"> </span>
<a href="#l155.115"></a><span id="l155.115"> void ImportOutlookMailImpl::AddLinebreak(nsString *pStream)</span>
<a href="#l155.116"></a><span id="l155.116"> {</span>
<a href="#l155.117"></a><span id="l155.117">   if (pStream)</span>
<a href="#l155.118"></a><span id="l155.118" class="difflineminus">-    pStream-&gt;Append(PRUnichar('\n'));</span>
<a href="#l155.119"></a><span id="l155.119" class="difflineplus">+    pStream-&gt;Append(char16_t('\n'));</span>
<a href="#l155.120"></a><span id="l155.120"> }</span>
<a href="#l155.121"></a><span id="l155.121"> </span>
<a href="#l155.122"></a><span id="l155.122"> void ImportOutlookMailImpl::ReportSuccess(nsString&amp; name, int32_t count, nsString *pStream)</span>
<a href="#l155.123"></a><span id="l155.123"> {</span>
<a href="#l155.124"></a><span id="l155.124">   if (!pStream)</span>
<a href="#l155.125"></a><span id="l155.125">     return;</span>
<a href="#l155.126"></a><span id="l155.126">   // load the success string</span>
<a href="#l155.127"></a><span id="l155.127" class="difflineminus">-  PRUnichar *pFmt = nsOutlookStringBundle::GetStringByID(OUTLOOKIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l155.128"></a><span id="l155.128" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get(), count);</span>
<a href="#l155.129"></a><span id="l155.129" class="difflineplus">+  char16_t *pFmt = nsOutlookStringBundle::GetStringByID(OUTLOOKIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l155.130"></a><span id="l155.130" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get(), count);</span>
<a href="#l155.131"></a><span id="l155.131">   pStream-&gt;Append(pText);</span>
<a href="#l155.132"></a><span id="l155.132">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l155.133"></a><span id="l155.133">   nsOutlookStringBundle::FreeString(pFmt);</span>
<a href="#l155.134"></a><span id="l155.134">   AddLinebreak(pStream);</span>
<a href="#l155.135"></a><span id="l155.135"> }</span>
<a href="#l155.136"></a><span id="l155.136"> </span>
<a href="#l155.137"></a><span id="l155.137"> void ImportOutlookMailImpl::ReportError(int32_t errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l155.138"></a><span id="l155.138"> {</span>
<a href="#l155.139"></a><span id="l155.139">   if (!pStream)</span>
<a href="#l155.140"></a><span id="l155.140">     return;</span>
<a href="#l155.141"></a><span id="l155.141">   // load the error string</span>
<a href="#l155.142"></a><span id="l155.142" class="difflineminus">-  PRUnichar *pFmt = nsOutlookStringBundle::GetStringByID(errorNum);</span>
<a href="#l155.143"></a><span id="l155.143" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l155.144"></a><span id="l155.144" class="difflineplus">+  char16_t *pFmt = nsOutlookStringBundle::GetStringByID(errorNum);</span>
<a href="#l155.145"></a><span id="l155.145" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l155.146"></a><span id="l155.146">   pStream-&gt;Append(pText);</span>
<a href="#l155.147"></a><span id="l155.147">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l155.148"></a><span id="l155.148">   nsOutlookStringBundle::FreeString(pFmt);</span>
<a href="#l155.149"></a><span id="l155.149">   AddLinebreak(pStream);</span>
<a href="#l155.150"></a><span id="l155.150"> }</span>
<a href="#l155.151"></a><span id="l155.151"> </span>
<a href="#l155.152"></a><span id="l155.152"> </span>
<a href="#l155.153"></a><span id="l155.153" class="difflineminus">-void ImportOutlookMailImpl::SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l155.154"></a><span id="l155.154" class="difflineplus">+void ImportOutlookMailImpl::SetLogs(nsString&amp; success, nsString&amp; error, char16_t **pError, char16_t **pSuccess)</span>
<a href="#l155.155"></a><span id="l155.155"> {</span>
<a href="#l155.156"></a><span id="l155.156">   if (pError)</span>
<a href="#l155.157"></a><span id="l155.157">     *pError = ToNewUnicode(error);</span>
<a href="#l155.158"></a><span id="l155.158">   if (pSuccess)</span>
<a href="#l155.159"></a><span id="l155.159">     *pSuccess = ToNewUnicode(success);</span>
<a href="#l155.160"></a><span id="l155.160"> }</span>
<a href="#l155.161"></a><span id="l155.161"> </span>
<a href="#l155.162"></a><span id="l155.162"> NS_IMETHODIMP</span>
<a href="#l155.163"></a><span id="l155.163"> ImportOutlookMailImpl::ImportMailbox(nsIImportMailboxDescriptor *pSource,</span>
<a href="#l155.164"></a><span id="l155.164">                                      nsIMsgFolder *dstFolder,</span>
<a href="#l155.165"></a><span id="l155.165" class="difflineminus">-                                     PRUnichar **pErrorLog,</span>
<a href="#l155.166"></a><span id="l155.166" class="difflineminus">-                                     PRUnichar **pSuccessLog,</span>
<a href="#l155.167"></a><span id="l155.167" class="difflineplus">+                                     char16_t **pErrorLog,</span>
<a href="#l155.168"></a><span id="l155.168" class="difflineplus">+                                     char16_t **pSuccessLog,</span>
<a href="#l155.169"></a><span id="l155.169">                                      bool *fatalError)</span>
<a href="#l155.170"></a><span id="l155.170"> {</span>
<a href="#l155.171"></a><span id="l155.171">   NS_ENSURE_ARG_POINTER(pSource);</span>
<a href="#l155.172"></a><span id="l155.172">   NS_ENSURE_ARG_POINTER(dstFolder);</span>
<a href="#l155.173"></a><span id="l155.173">   NS_ENSURE_ARG_POINTER(fatalError);</span>
<a href="#l155.174"></a><span id="l155.174"> </span>
<a href="#l155.175"></a><span id="l155.175">   nsString  success;</span>
<a href="#l155.176"></a><span id="l155.176">   nsString  error;</span>
<a href="#l155.177"></a><span id="l155.177">   bool abort = false;</span>
<a href="#l155.178"></a><span id="l155.178">   nsString name;</span>
<a href="#l155.179"></a><span id="l155.179" class="difflineminus">-  PRUnichar *pName;</span>
<a href="#l155.180"></a><span id="l155.180" class="difflineplus">+  char16_t *pName;</span>
<a href="#l155.181"></a><span id="l155.181">   if (NS_SUCCEEDED( pSource-&gt;GetDisplayName( &amp;pName))) {</span>
<a href="#l155.182"></a><span id="l155.182">     name = pName;</span>
<a href="#l155.183"></a><span id="l155.183">     NS_Free( pName);</span>
<a href="#l155.184"></a><span id="l155.184">  }</span>
<a href="#l155.185"></a><span id="l155.185"> </span>
<a href="#l155.186"></a><span id="l155.186">   uint32_t mailSize = 0;</span>
<a href="#l155.187"></a><span id="l155.187">   pSource-&gt;GetSize(&amp;mailSize);</span>
<a href="#l155.188"></a><span id="l155.188">   if (mailSize == 0) {</span>
<a href="#l155.189"></a><span id="l155.189" class="difflineat">@@ -482,17 +482,17 @@ ImportOutlookAddressImpl::ImportOutlookA</span>
<a href="#l155.190"></a><span id="l155.190"> }</span>
<a href="#l155.191"></a><span id="l155.191"> </span>
<a href="#l155.192"></a><span id="l155.192"> ImportOutlookAddressImpl::~ImportOutlookAddressImpl()</span>
<a href="#l155.193"></a><span id="l155.193"> {</span>
<a href="#l155.194"></a><span id="l155.194"> }</span>
<a href="#l155.195"></a><span id="l155.195"> </span>
<a href="#l155.196"></a><span id="l155.196"> NS_IMPL_ISUPPORTS1(ImportOutlookAddressImpl, nsIImportAddressBooks)</span>
<a href="#l155.197"></a><span id="l155.197"> </span>
<a href="#l155.198"></a><span id="l155.198" class="difflineminus">-NS_IMETHODIMP ImportOutlookAddressImpl::GetAutoFind(PRUnichar **description, bool *_retval)</span>
<a href="#l155.199"></a><span id="l155.199" class="difflineplus">+NS_IMETHODIMP ImportOutlookAddressImpl::GetAutoFind(char16_t **description, bool *_retval)</span>
<a href="#l155.200"></a><span id="l155.200"> {</span>
<a href="#l155.201"></a><span id="l155.201">   NS_PRECONDITION(description != nullptr, &quot;null ptr&quot;);</span>
<a href="#l155.202"></a><span id="l155.202">   NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l155.203"></a><span id="l155.203">   if (! description || !_retval)</span>
<a href="#l155.204"></a><span id="l155.204">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l155.205"></a><span id="l155.205"> </span>
<a href="#l155.206"></a><span id="l155.206">   *_retval = true;</span>
<a href="#l155.207"></a><span id="l155.207">   nsString str;</span>
<a href="#l155.208"></a><span id="l155.208" class="difflineat">@@ -509,18 +509,18 @@ NS_IMETHODIMP ImportOutlookAddressImpl::</span>
<a href="#l155.209"></a><span id="l155.209"> </span>
<a href="#l155.210"></a><span id="l155.210">   return m_address.GetAddressBooks(_retval);</span>
<a href="#l155.211"></a><span id="l155.211"> }</span>
<a href="#l155.212"></a><span id="l155.212"> </span>
<a href="#l155.213"></a><span id="l155.213"> NS_IMETHODIMP ImportOutlookAddressImpl::ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l155.214"></a><span id="l155.214">                                                           nsIAddrDatabase *destination,</span>
<a href="#l155.215"></a><span id="l155.215">                                                           nsIImportFieldMap *fieldMap,</span>
<a href="#l155.216"></a><span id="l155.216">                                                           nsISupports *aSupportService,</span>
<a href="#l155.217"></a><span id="l155.217" class="difflineminus">-                                                          PRUnichar **pErrorLog,</span>
<a href="#l155.218"></a><span id="l155.218" class="difflineminus">-                                                          PRUnichar **pSuccessLog,</span>
<a href="#l155.219"></a><span id="l155.219" class="difflineplus">+                                                          char16_t **pErrorLog,</span>
<a href="#l155.220"></a><span id="l155.220" class="difflineplus">+                                                          char16_t **pSuccessLog,</span>
<a href="#l155.221"></a><span id="l155.221">                                                           bool *fatalError)</span>
<a href="#l155.222"></a><span id="l155.222"> {</span>
<a href="#l155.223"></a><span id="l155.223">   m_msgCount = 0;</span>
<a href="#l155.224"></a><span id="l155.224">   m_msgTotal = 0;</span>
<a href="#l155.225"></a><span id="l155.225">     NS_PRECONDITION(source != nullptr, &quot;null ptr&quot;);</span>
<a href="#l155.226"></a><span id="l155.226">     NS_PRECONDITION(destination != nullptr, &quot;null ptr&quot;);</span>
<a href="#l155.227"></a><span id="l155.227">   NS_PRECONDITION(fatalError != nullptr, &quot;null ptr&quot;);</span>
<a href="#l155.228"></a><span id="l155.228"> </span>
<a href="#l155.229"></a><span id="l155.229" class="difflineat">@@ -580,15 +580,15 @@ NS_IMETHODIMP ImportOutlookAddressImpl::</span>
<a href="#l155.230"></a><span id="l155.230">   return NS_OK;</span>
<a href="#l155.231"></a><span id="l155.231"> }</span>
<a href="#l155.232"></a><span id="l155.232"> </span>
<a href="#l155.233"></a><span id="l155.233"> void ImportOutlookAddressImpl::ReportSuccess(nsString&amp; name, nsString *pStream)</span>
<a href="#l155.234"></a><span id="l155.234"> {</span>
<a href="#l155.235"></a><span id="l155.235">   if (!pStream)</span>
<a href="#l155.236"></a><span id="l155.236">     return;</span>
<a href="#l155.237"></a><span id="l155.237">   // load the success string</span>
<a href="#l155.238"></a><span id="l155.238" class="difflineminus">-  PRUnichar *pFmt = nsOutlookStringBundle::GetStringByID(OUTLOOKIMPORT_ADDRESS_SUCCESS);</span>
<a href="#l155.239"></a><span id="l155.239" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l155.240"></a><span id="l155.240" class="difflineplus">+  char16_t *pFmt = nsOutlookStringBundle::GetStringByID(OUTLOOKIMPORT_ADDRESS_SUCCESS);</span>
<a href="#l155.241"></a><span id="l155.241" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l155.242"></a><span id="l155.242">   pStream-&gt;Append(pText);</span>
<a href="#l155.243"></a><span id="l155.243">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l155.244"></a><span id="l155.244">   nsOutlookStringBundle::FreeString(pFmt);</span>
<a href="#l155.245"></a><span id="l155.245">   ImportOutlookMailImpl::AddLinebreak(pStream);</span>
<a href="#l155.246"></a><span id="l155.246"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l156.1"></a><span id="l156.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l156.2"></a><span id="l156.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l156.3"></a><span id="l156.3" class="difflineat">@@ -198,17 +198,17 @@ bool nsOutlookMail::IsAddressBookNameUni</span>
<a href="#l156.4"></a><span id="l156.4"> void nsOutlookMail::MakeAddressBookNameUnique(nsString&amp; name, nsString&amp; list)</span>
<a href="#l156.5"></a><span id="l156.5"> {</span>
<a href="#l156.6"></a><span id="l156.6">   nsString    newName;</span>
<a href="#l156.7"></a><span id="l156.7">   int        idx = 1;</span>
<a href="#l156.8"></a><span id="l156.8"> </span>
<a href="#l156.9"></a><span id="l156.9">   newName = name;</span>
<a href="#l156.10"></a><span id="l156.10">   while (!IsAddressBookNameUnique(newName, list)) {</span>
<a href="#l156.11"></a><span id="l156.11">     newName = name;</span>
<a href="#l156.12"></a><span id="l156.12" class="difflineminus">-    newName.Append(PRUnichar(' '));</span>
<a href="#l156.13"></a><span id="l156.13" class="difflineplus">+    newName.Append(char16_t(' '));</span>
<a href="#l156.14"></a><span id="l156.14">     newName.AppendInt((int32_t) idx);</span>
<a href="#l156.15"></a><span id="l156.15">     idx++;</span>
<a href="#l156.16"></a><span id="l156.16">   }</span>
<a href="#l156.17"></a><span id="l156.17"> </span>
<a href="#l156.18"></a><span id="l156.18">   name = newName;</span>
<a href="#l156.19"></a><span id="l156.19">   list.AppendLiteral(&quot;[&quot;);</span>
<a href="#l156.20"></a><span id="l156.20">   list.Append(name);</span>
<a href="#l156.21"></a><span id="l156.21">   list.AppendLiteral(&quot;],&quot;);</span>
<a href="#l156.22"></a><span id="l156.22" class="difflineat">@@ -335,17 +335,17 @@ void nsOutlookMail::OpenMessageStore(CMa</span>
<a href="#l156.23"></a><span id="l156.23"> //   - Save the composed message to the TB mailbox</span>
<a href="#l156.24"></a><span id="l156.24"> //   - Ensure the proper cleanup</span>
<a href="#l156.25"></a><span id="l156.25"> //</span>
<a href="#l156.26"></a><span id="l156.26"> // CMapiMessage</span>
<a href="#l156.27"></a><span id="l156.27"> //   - Encapsulate the MAPI message interface</span>
<a href="#l156.28"></a><span id="l156.28"> //   - Gather the information required to (re)compose the message</span>
<a href="#l156.29"></a><span id="l156.29"> </span>
<a href="#l156.30"></a><span id="l156.30"> nsresult nsOutlookMail::ImportMailbox(uint32_t *pDoneSoFar, bool *pAbort,</span>
<a href="#l156.31"></a><span id="l156.31" class="difflineminus">-                                      int32_t index, const PRUnichar *pName,</span>
<a href="#l156.32"></a><span id="l156.32" class="difflineplus">+                                      int32_t index, const char16_t *pName,</span>
<a href="#l156.33"></a><span id="l156.33">                                       nsIMsgFolder *dstFolder,</span>
<a href="#l156.34"></a><span id="l156.34">                                       int32_t *pMsgCount)</span>
<a href="#l156.35"></a><span id="l156.35"> {</span>
<a href="#l156.36"></a><span id="l156.36">   if ((index &lt; 0) || (index &gt;= m_folderList.GetSize())) {</span>
<a href="#l156.37"></a><span id="l156.37">     IMPORT_LOG0(&quot;*** Bad mailbox identifier, unable to import\n&quot;);</span>
<a href="#l156.38"></a><span id="l156.38">     *pAbort = true;</span>
<a href="#l156.39"></a><span id="l156.39">     return NS_ERROR_FAILURE;</span>
<a href="#l156.40"></a><span id="l156.40">   }</span>
<a href="#l156.41"></a><span id="l156.41" class="difflineat">@@ -472,17 +472,17 @@ nsresult nsOutlookMail::ImportMessage(LP</span>
<a href="#l156.42"></a><span id="l156.42"> </span>
<a href="#l156.43"></a><span id="l156.43"> BOOL nsOutlookMail::WriteData(nsIOutputStream *pDest, const char *pData, int32_t len)</span>
<a href="#l156.44"></a><span id="l156.44"> {</span>
<a href="#l156.45"></a><span id="l156.45">   uint32_t    written;</span>
<a href="#l156.46"></a><span id="l156.46">   nsresult rv = pDest-&gt;Write(pData, len, &amp;written);</span>
<a href="#l156.47"></a><span id="l156.47">   return NS_SUCCEEDED(rv) &amp;&amp; written == len;</span>
<a href="#l156.48"></a><span id="l156.48"> }</span>
<a href="#l156.49"></a><span id="l156.49"> </span>
<a href="#l156.50"></a><span id="l156.50" class="difflineminus">-nsresult nsOutlookMail::ImportAddresses(uint32_t *pCount, uint32_t *pTotal, const PRUnichar *pName, uint32_t id, nsIAddrDatabase *pDb, nsString&amp; errors)</span>
<a href="#l156.51"></a><span id="l156.51" class="difflineplus">+nsresult nsOutlookMail::ImportAddresses(uint32_t *pCount, uint32_t *pTotal, const char16_t *pName, uint32_t id, nsIAddrDatabase *pDb, nsString&amp; errors)</span>
<a href="#l156.52"></a><span id="l156.52"> {</span>
<a href="#l156.53"></a><span id="l156.53">   if (id &gt;= (uint32_t)(m_addressList.GetSize())) {</span>
<a href="#l156.54"></a><span id="l156.54">     IMPORT_LOG0(&quot;*** Bad address identifier, unable to import\n&quot;);</span>
<a href="#l156.55"></a><span id="l156.55">     return NS_ERROR_FAILURE;</span>
<a href="#l156.56"></a><span id="l156.56">   }</span>
<a href="#l156.57"></a><span id="l156.57"> </span>
<a href="#l156.58"></a><span id="l156.58">   uint32_t  dummyCount = 0;</span>
<a href="#l156.59"></a><span id="l156.59">   if (pCount)</span>
<a href="#l156.60"></a><span id="l156.60" class="difflineat">@@ -588,17 +588,17 @@ nsresult nsOutlookMail::ImportAddresses(</span>
<a href="#l156.61"></a><span id="l156.61"> </span>
<a href="#l156.62"></a><span id="l156.62">       lpMsg-&gt;Release();</span>
<a href="#l156.63"></a><span id="l156.63">     }</span>
<a href="#l156.64"></a><span id="l156.64">   }</span>
<a href="#l156.65"></a><span id="l156.65"> </span>
<a href="#l156.66"></a><span id="l156.66">   rv = pDb-&gt;Commit(nsAddrDBCommitType::kLargeCommit);</span>
<a href="#l156.67"></a><span id="l156.67">   return rv;</span>
<a href="#l156.68"></a><span id="l156.68"> }</span>
<a href="#l156.69"></a><span id="l156.69" class="difflineminus">-nsresult nsOutlookMail::CreateList(const PRUnichar * pName,</span>
<a href="#l156.70"></a><span id="l156.70" class="difflineplus">+nsresult nsOutlookMail::CreateList(const char16_t * pName,</span>
<a href="#l156.71"></a><span id="l156.71">                                    nsIAddrDatabase *pDb,</span>
<a href="#l156.72"></a><span id="l156.72">                                    LPMAPIPROP pUserList,</span>
<a href="#l156.73"></a><span id="l156.73">                                    nsIImportFieldMap *pFieldMap)</span>
<a href="#l156.74"></a><span id="l156.74"> {</span>
<a href="#l156.75"></a><span id="l156.75">   // If no name provided then we're done.</span>
<a href="#l156.76"></a><span id="l156.76">   if (!pName || !(*pName))</span>
<a href="#l156.77"></a><span id="l156.77">     return NS_OK;</span>
<a href="#l156.78"></a><span id="l156.78"> </span>
<a href="#l156.79"></a><span id="l156.79" class="difflineat">@@ -722,17 +722,17 @@ void nsOutlookMail::SplitString(nsString</span>
<a href="#l156.80"></a><span id="l156.80">     idx= val1.RFindChar(10);</span>
<a href="#l156.81"></a><span id="l156.81">   if (idx != -1) {</span>
<a href="#l156.82"></a><span id="l156.82">     val2 = Substring(val1, idx + cnt);</span>
<a href="#l156.83"></a><span id="l156.83">     val1.SetLength(idx);</span>
<a href="#l156.84"></a><span id="l156.84">     SanitizeValue(val1);</span>
<a href="#l156.85"></a><span id="l156.85">   }</span>
<a href="#l156.86"></a><span id="l156.86"> }</span>
<a href="#l156.87"></a><span id="l156.87"> </span>
<a href="#l156.88"></a><span id="l156.88" class="difflineminus">-bool nsOutlookMail::BuildCard(const PRUnichar *pName, nsIAddrDatabase *pDb, nsIMdbRow *newRow, LPMAPIPROP pUser, nsIImportFieldMap *pFieldMap)</span>
<a href="#l156.89"></a><span id="l156.89" class="difflineplus">+bool nsOutlookMail::BuildCard(const char16_t *pName, nsIAddrDatabase *pDb, nsIMdbRow *newRow, LPMAPIPROP pUser, nsIImportFieldMap *pFieldMap)</span>
<a href="#l156.90"></a><span id="l156.90"> {</span>
<a href="#l156.91"></a><span id="l156.91"> </span>
<a href="#l156.92"></a><span id="l156.92">   nsString    lastName;</span>
<a href="#l156.93"></a><span id="l156.93">   nsString    firstName;</span>
<a href="#l156.94"></a><span id="l156.94">   nsString    eMail;</span>
<a href="#l156.95"></a><span id="l156.95">   nsString    nickName;</span>
<a href="#l156.96"></a><span id="l156.96">   nsString    middleName;</span>
<a href="#l156.97"></a><span id="l156.97">   nsString    secondEMail;</span>
<a href="#l156.98"></a><span id="l156.98" class="difflineat">@@ -791,21 +791,21 @@ bool nsOutlookMail::BuildCard(const PRUn</span>
<a href="#l156.99"></a><span id="l156.99">     SanitizeValue(displayName);</span>
<a href="#l156.100"></a><span id="l156.100">   }</span>
<a href="#l156.101"></a><span id="l156.101">   if (displayName.IsEmpty()) {</span>
<a href="#l156.102"></a><span id="l156.102">     if (firstName.IsEmpty())</span>
<a href="#l156.103"></a><span id="l156.103">       displayName = pName;</span>
<a href="#l156.104"></a><span id="l156.104">     else {</span>
<a href="#l156.105"></a><span id="l156.105">       displayName = firstName;</span>
<a href="#l156.106"></a><span id="l156.106">       if (!middleName.IsEmpty()) {</span>
<a href="#l156.107"></a><span id="l156.107" class="difflineminus">-        displayName.Append(PRUnichar(' '));</span>
<a href="#l156.108"></a><span id="l156.108" class="difflineplus">+        displayName.Append(char16_t(' '));</span>
<a href="#l156.109"></a><span id="l156.109">         displayName.Append(middleName);</span>
<a href="#l156.110"></a><span id="l156.110">       }</span>
<a href="#l156.111"></a><span id="l156.111">       if (!lastName.IsEmpty()) {</span>
<a href="#l156.112"></a><span id="l156.112" class="difflineminus">-        displayName.Append(PRUnichar(' '));</span>
<a href="#l156.113"></a><span id="l156.113" class="difflineplus">+        displayName.Append(char16_t(' '));</span>
<a href="#l156.114"></a><span id="l156.114">         displayName.Append(lastName);</span>
<a href="#l156.115"></a><span id="l156.115">       }</span>
<a href="#l156.116"></a><span id="l156.116">     }</span>
<a href="#l156.117"></a><span id="l156.117">   }</span>
<a href="#l156.118"></a><span id="l156.118"> </span>
<a href="#l156.119"></a><span id="l156.119">   // We now have the required fields</span>
<a href="#l156.120"></a><span id="l156.120">   // write them out followed by any optional fields!</span>
<a href="#l156.121"></a><span id="l156.121">   if (!displayName.IsEmpty()) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l157.1"></a><span id="l157.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookMail.h</span>
<a href="#l157.2"></a><span id="l157.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookMail.h</span>
<a href="#l157.3"></a><span id="l157.3" class="difflineat">@@ -20,30 +20,30 @@ class nsIImportFieldMap;</span>
<a href="#l157.4"></a><span id="l157.4"> class nsOutlookMail {</span>
<a href="#l157.5"></a><span id="l157.5"> public:</span>
<a href="#l157.6"></a><span id="l157.6">   nsOutlookMail();</span>
<a href="#l157.7"></a><span id="l157.7">   ~nsOutlookMail();</span>
<a href="#l157.8"></a><span id="l157.8">   </span>
<a href="#l157.9"></a><span id="l157.9">   nsresult GetMailFolders(nsIArray **pArray);</span>
<a href="#l157.10"></a><span id="l157.10">   nsresult GetAddressBooks(nsIArray **pArray);</span>
<a href="#l157.11"></a><span id="l157.11">   nsresult ImportMailbox(uint32_t *pDoneSoFar, bool *pAbort, int32_t index,</span>
<a href="#l157.12"></a><span id="l157.12" class="difflineminus">-                         const PRUnichar *pName, nsIMsgFolder *pDest,</span>
<a href="#l157.13"></a><span id="l157.13" class="difflineplus">+                         const char16_t *pName, nsIMsgFolder *pDest,</span>
<a href="#l157.14"></a><span id="l157.14">                          int32_t *pMsgCount);</span>
<a href="#l157.15"></a><span id="l157.15">   static nsresult ImportMessage(LPMESSAGE lpMsg, nsIOutputStream *destOutputStream, nsMsgDeliverMode mode);</span>
<a href="#l157.16"></a><span id="l157.16" class="difflineminus">-  nsresult ImportAddresses(uint32_t *pCount, uint32_t *pTotal, const PRUnichar *pName, uint32_t id, nsIAddrDatabase *pDb, nsString&amp; errors);</span>
<a href="#l157.17"></a><span id="l157.17" class="difflineplus">+  nsresult ImportAddresses(uint32_t *pCount, uint32_t *pTotal, const char16_t *pName, uint32_t id, nsIAddrDatabase *pDb, nsString&amp; errors);</span>
<a href="#l157.18"></a><span id="l157.18"> private:</span>
<a href="#l157.19"></a><span id="l157.19">   void  OpenMessageStore(CMapiFolder *pNextFolder);</span>
<a href="#l157.20"></a><span id="l157.20">   static BOOL  WriteData(nsIOutputStream *pDest, const char *pData, int32_t len);</span>
<a href="#l157.21"></a><span id="l157.21">   </span>
<a href="#l157.22"></a><span id="l157.22">   bool      IsAddressBookNameUnique(nsString&amp; name, nsString&amp; list);</span>
<a href="#l157.23"></a><span id="l157.23">   void      MakeAddressBookNameUnique(nsString&amp; name, nsString&amp; list);</span>
<a href="#l157.24"></a><span id="l157.24">   void      SanitizeValue(nsString&amp; val);</span>
<a href="#l157.25"></a><span id="l157.25">   void      SplitString(nsString&amp; val1, nsString&amp; val2);</span>
<a href="#l157.26"></a><span id="l157.26" class="difflineminus">-  bool      BuildCard(const PRUnichar *pName, nsIAddrDatabase *pDb, nsIMdbRow *newRow, LPMAPIPROP pUser, nsIImportFieldMap *pFieldMap);</span>
<a href="#l157.27"></a><span id="l157.27" class="difflineminus">-  nsresult  CreateList(const PRUnichar * pName, nsIAddrDatabase *pDb, LPMAPIPROP pUserList, nsIImportFieldMap *pFieldMap);</span>
<a href="#l157.28"></a><span id="l157.28" class="difflineplus">+  bool      BuildCard(const char16_t *pName, nsIAddrDatabase *pDb, nsIMdbRow *newRow, LPMAPIPROP pUser, nsIImportFieldMap *pFieldMap);</span>
<a href="#l157.29"></a><span id="l157.29" class="difflineplus">+  nsresult  CreateList(const char16_t * pName, nsIAddrDatabase *pDb, LPMAPIPROP pUserList, nsIImportFieldMap *pFieldMap);</span>
<a href="#l157.30"></a><span id="l157.30">   </span>
<a href="#l157.31"></a><span id="l157.31"> private:</span>
<a href="#l157.32"></a><span id="l157.32">   bool              m_gotFolders;</span>
<a href="#l157.33"></a><span id="l157.33">   bool              m_gotAddresses;</span>
<a href="#l157.34"></a><span id="l157.34">   bool              m_haveMapi;</span>
<a href="#l157.35"></a><span id="l157.35">   CMapiApi          m_mapi;</span>
<a href="#l157.36"></a><span id="l157.36">   CMapiFolderList   m_folderList;</span>
<a href="#l157.37"></a><span id="l157.37">   CMapiFolderList   m_addressList;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l158.1"></a><span id="l158.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookSettings.cpp</span>
<a href="#l158.2"></a><span id="l158.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookSettings.cpp</span>
<a href="#l158.3"></a><span id="l158.3" class="difflineat">@@ -97,17 +97,17 @@ nsOutlookSettings::nsOutlookSettings()</span>
<a href="#l158.4"></a><span id="l158.4"> }</span>
<a href="#l158.5"></a><span id="l158.5"> </span>
<a href="#l158.6"></a><span id="l158.6"> nsOutlookSettings::~nsOutlookSettings()</span>
<a href="#l158.7"></a><span id="l158.7"> {</span>
<a href="#l158.8"></a><span id="l158.8"> }</span>
<a href="#l158.9"></a><span id="l158.9"> </span>
<a href="#l158.10"></a><span id="l158.10"> NS_IMPL_ISUPPORTS1(nsOutlookSettings, nsIImportSettings)</span>
<a href="#l158.11"></a><span id="l158.11"> </span>
<a href="#l158.12"></a><span id="l158.12" class="difflineminus">-NS_IMETHODIMP nsOutlookSettings::AutoLocate(PRUnichar **description, nsIFile **location, bool *_retval)</span>
<a href="#l158.13"></a><span id="l158.13" class="difflineplus">+NS_IMETHODIMP nsOutlookSettings::AutoLocate(char16_t **description, nsIFile **location, bool *_retval)</span>
<a href="#l158.14"></a><span id="l158.14"> {</span>
<a href="#l158.15"></a><span id="l158.15">     NS_PRECONDITION(description != nullptr, &quot;null ptr&quot;);</span>
<a href="#l158.16"></a><span id="l158.16">     NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l158.17"></a><span id="l158.17">   if (!description || !_retval)</span>
<a href="#l158.18"></a><span id="l158.18">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l158.19"></a><span id="l158.19"> </span>
<a href="#l158.20"></a><span id="l158.20">   *description = nsOutlookStringBundle::GetStringByID(OUTLOOKIMPORT_NAME);</span>
<a href="#l158.21"></a><span id="l158.21">   *_retval = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l159.1"></a><span id="l159.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookStringBundle.cpp</span>
<a href="#l159.2"></a><span id="l159.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookStringBundle.cpp</span>
<a href="#l159.3"></a><span id="l159.3" class="difflineat">@@ -32,28 +32,28 @@ nsIStringBundle *nsOutlookStringBundle::</span>
<a href="#l159.4"></a><span id="l159.4"> </span>
<a href="#l159.5"></a><span id="l159.5">   m_pBundle = sBundle;</span>
<a href="#l159.6"></a><span id="l159.6"> </span>
<a href="#l159.7"></a><span id="l159.7">   return sBundle;</span>
<a href="#l159.8"></a><span id="l159.8"> }</span>
<a href="#l159.9"></a><span id="l159.9"> </span>
<a href="#l159.10"></a><span id="l159.10"> void nsOutlookStringBundle::GetStringByID(int32_t stringID, nsString&amp; result)</span>
<a href="#l159.11"></a><span id="l159.11"> {</span>
<a href="#l159.12"></a><span id="l159.12" class="difflineminus">-  PRUnichar *ptrv = GetStringByID(stringID);</span>
<a href="#l159.13"></a><span id="l159.13" class="difflineplus">+  char16_t *ptrv = GetStringByID(stringID);</span>
<a href="#l159.14"></a><span id="l159.14">   result = ptrv;</span>
<a href="#l159.15"></a><span id="l159.15">   FreeString(ptrv);</span>
<a href="#l159.16"></a><span id="l159.16"> }</span>
<a href="#l159.17"></a><span id="l159.17"> </span>
<a href="#l159.18"></a><span id="l159.18" class="difflineminus">-PRUnichar *nsOutlookStringBundle::GetStringByID(int32_t stringID)</span>
<a href="#l159.19"></a><span id="l159.19" class="difflineplus">+char16_t *nsOutlookStringBundle::GetStringByID(int32_t stringID)</span>
<a href="#l159.20"></a><span id="l159.20"> {</span>
<a href="#l159.21"></a><span id="l159.21">   if (m_pBundle)</span>
<a href="#l159.22"></a><span id="l159.22">     m_pBundle = GetStringBundle();</span>
<a href="#l159.23"></a><span id="l159.23"> </span>
<a href="#l159.24"></a><span id="l159.24">   if (m_pBundle) {</span>
<a href="#l159.25"></a><span id="l159.25" class="difflineminus">-    PRUnichar *ptrv = nullptr;</span>
<a href="#l159.26"></a><span id="l159.26" class="difflineplus">+    char16_t *ptrv = nullptr;</span>
<a href="#l159.27"></a><span id="l159.27">     nsresult rv = m_pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l159.28"></a><span id="l159.28"> </span>
<a href="#l159.29"></a><span id="l159.29">     if (NS_SUCCEEDED(rv) &amp;&amp; ptrv)</span>
<a href="#l159.30"></a><span id="l159.30">       return ptrv;</span>
<a href="#l159.31"></a><span id="l159.31">   }</span>
<a href="#l159.32"></a><span id="l159.32"> </span>
<a href="#l159.33"></a><span id="l159.33">   nsString resultString;</span>
<a href="#l159.34"></a><span id="l159.34">   resultString.AppendLiteral(&quot;[StringID &quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l160.1"></a><span id="l160.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookStringBundle.h</span>
<a href="#l160.2"></a><span id="l160.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookStringBundle.h</span>
<a href="#l160.3"></a><span id="l160.3" class="difflineat">@@ -7,20 +7,20 @@</span>
<a href="#l160.4"></a><span id="l160.4"> </span>
<a href="#l160.5"></a><span id="l160.5"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l160.6"></a><span id="l160.6"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l160.7"></a><span id="l160.7"> </span>
<a href="#l160.8"></a><span id="l160.8"> class nsIStringBundle;</span>
<a href="#l160.9"></a><span id="l160.9"> </span>
<a href="#l160.10"></a><span id="l160.10"> class nsOutlookStringBundle {</span>
<a href="#l160.11"></a><span id="l160.11"> public:</span>
<a href="#l160.12"></a><span id="l160.12" class="difflineminus">-  static PRUnichar     * GetStringByID(int32_t stringID);</span>
<a href="#l160.13"></a><span id="l160.13" class="difflineplus">+  static char16_t     * GetStringByID(int32_t stringID);</span>
<a href="#l160.14"></a><span id="l160.14">   static void GetStringByID(int32_t stringID, nsString&amp; result);</span>
<a href="#l160.15"></a><span id="l160.15">   static nsIStringBundle * GetStringBundle(void); // don't release</span>
<a href="#l160.16"></a><span id="l160.16" class="difflineminus">-  static void FreeString(PRUnichar *pStr) { NS_Free(pStr);}</span>
<a href="#l160.17"></a><span id="l160.17" class="difflineplus">+  static void FreeString(char16_t *pStr) { NS_Free(pStr);}</span>
<a href="#l160.18"></a><span id="l160.18">   static void Cleanup(void);</span>
<a href="#l160.19"></a><span id="l160.19"> private:</span>
<a href="#l160.20"></a><span id="l160.20">   static nsIStringBundle * m_pBundle;</span>
<a href="#l160.21"></a><span id="l160.21"> };</span>
<a href="#l160.22"></a><span id="l160.22"> </span>
<a href="#l160.23"></a><span id="l160.23"> </span>
<a href="#l160.24"></a><span id="l160.24"> </span>
<a href="#l160.25"></a><span id="l160.25"> #define OUTLOOKIMPORT_NAME                     2000</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l161.1"></a><span id="l161.1" class="difflineminus">--- a/mailnews/import/src/nsImportAddressBooks.cpp</span>
<a href="#l161.2"></a><span id="l161.2" class="difflineplus">+++ b/mailnews/import/src/nsImportAddressBooks.cpp</span>
<a href="#l161.3"></a><span id="l161.3" class="difflineat">@@ -63,27 +63,27 @@ public:</span>
<a href="#l161.4"></a><span id="l161.4"> </span>
<a href="#l161.5"></a><span id="l161.5"> private:</span>
<a href="#l161.6"></a><span id="l161.6">   void  GetDefaultLocation(void);</span>
<a href="#l161.7"></a><span id="l161.7">   void  GetDefaultBooks(void);</span>
<a href="#l161.8"></a><span id="l161.8">   void  GetDefaultFieldMap(void);</span>
<a href="#l161.9"></a><span id="l161.9"> </span>
<a href="#l161.10"></a><span id="l161.10"> public:</span>
<a href="#l161.11"></a><span id="l161.11">   static void  SetLogs(nsString&amp; success, nsString&amp; error, nsISupportsString *pSuccess, nsISupportsString *pError);</span>
<a href="#l161.12"></a><span id="l161.12" class="difflineminus">-  static void ReportError(const PRUnichar *pName, nsString *pStream,</span>
<a href="#l161.13"></a><span id="l161.13" class="difflineplus">+  static void ReportError(const char16_t *pName, nsString *pStream,</span>
<a href="#l161.14"></a><span id="l161.14">                           nsIStringBundle *aBundle);</span>
<a href="#l161.15"></a><span id="l161.15"> </span>
<a href="#l161.16"></a><span id="l161.16"> private:</span>
<a href="#l161.17"></a><span id="l161.17">   nsIImportAddressBooks *    m_pInterface;</span>
<a href="#l161.18"></a><span id="l161.18">   nsCOMPtr&lt;nsIArray&gt; m_Books;</span>
<a href="#l161.19"></a><span id="l161.19">   nsCOMArray&lt;nsIAddrDatabase&gt; m_DBs;</span>
<a href="#l161.20"></a><span id="l161.20">   nsCOMPtr &lt;nsIFile&gt;              m_pLocation;</span>
<a href="#l161.21"></a><span id="l161.21">   nsIImportFieldMap *      m_pFieldMap;</span>
<a href="#l161.22"></a><span id="l161.22">   bool              m_autoFind;</span>
<a href="#l161.23"></a><span id="l161.23" class="difflineminus">-  PRUnichar *          m_description;</span>
<a href="#l161.24"></a><span id="l161.24" class="difflineplus">+  char16_t *          m_description;</span>
<a href="#l161.25"></a><span id="l161.25">   bool              m_gotLocation;</span>
<a href="#l161.26"></a><span id="l161.26">   bool              m_found;</span>
<a href="#l161.27"></a><span id="l161.27">   bool              m_userVerify;</span>
<a href="#l161.28"></a><span id="l161.28">   nsISupportsString *    m_pSuccessLog;</span>
<a href="#l161.29"></a><span id="l161.29">   nsISupportsString *    m_pErrorLog;</span>
<a href="#l161.30"></a><span id="l161.30">   uint32_t          m_totalSize;</span>
<a href="#l161.31"></a><span id="l161.31">   bool              m_doImport;</span>
<a href="#l161.32"></a><span id="l161.32">   AddressThreadData *      m_pThreadData;</span>
<a href="#l161.33"></a><span id="l161.33" class="difflineat">@@ -237,17 +237,17 @@ NS_IMETHODIMP nsImportGenericAddressBook</span>
<a href="#l161.34"></a><span id="l161.34">       rNum += (*pNum - '0');</span>
<a href="#l161.35"></a><span id="l161.35">       pNum++;</span>
<a href="#l161.36"></a><span id="l161.36">     }</span>
<a href="#l161.37"></a><span id="l161.37">     IMPORT_LOG1(&quot;Requesting sample data #: %ld\n&quot;, (long)rNum);</span>
<a href="#l161.38"></a><span id="l161.38">     if (m_pInterface) {</span>
<a href="#l161.39"></a><span id="l161.39">       nsCOMPtr&lt;nsISupportsString&gt;  data = do_CreateInstance(NS_SUPPORTS_STRING_CONTRACTID, &amp;rv);</span>
<a href="#l161.40"></a><span id="l161.40">       if (NS_FAILED(rv))</span>
<a href="#l161.41"></a><span id="l161.41">         return rv;</span>
<a href="#l161.42"></a><span id="l161.42" class="difflineminus">-      PRUnichar *  pData = nullptr;</span>
<a href="#l161.43"></a><span id="l161.43" class="difflineplus">+      char16_t *  pData = nullptr;</span>
<a href="#l161.44"></a><span id="l161.44">       bool      found = false;</span>
<a href="#l161.45"></a><span id="l161.45">       rv = m_pInterface-&gt;GetSampleData(rNum, &amp;found, &amp;pData);</span>
<a href="#l161.46"></a><span id="l161.46">       if (NS_FAILED(rv))</span>
<a href="#l161.47"></a><span id="l161.47">         return rv;</span>
<a href="#l161.48"></a><span id="l161.48">       if (found) {</span>
<a href="#l161.49"></a><span id="l161.49">         data-&gt;SetData(nsDependentString(pData));</span>
<a href="#l161.50"></a><span id="l161.50">         *_retval = data;</span>
<a href="#l161.51"></a><span id="l161.51">         NS_ADDREF(*_retval);</span>
<a href="#l161.52"></a><span id="l161.52" class="difflineat">@@ -501,17 +501,17 @@ already_AddRefed&lt;nsIAddrDatabase&gt; GetAdd</span>
<a href="#l161.53"></a><span id="l161.53">   if (!mdbDirectory)</span>
<a href="#l161.54"></a><span id="l161.54">     return nullptr;</span>
<a href="#l161.55"></a><span id="l161.55"> </span>
<a href="#l161.56"></a><span id="l161.56">   nsCOMPtr&lt;nsIAddrDatabase&gt; pDatabase;</span>
<a href="#l161.57"></a><span id="l161.57">   mdbDirectory-&gt;GetDatabase(getter_AddRefs(pDatabase));</span>
<a href="#l161.58"></a><span id="l161.58">   return pDatabase.forget();</span>
<a href="#l161.59"></a><span id="l161.59"> }</span>
<a href="#l161.60"></a><span id="l161.60"> </span>
<a href="#l161.61"></a><span id="l161.61" class="difflineminus">-already_AddRefed&lt;nsIAddrDatabase&gt; GetAddressBook(const PRUnichar *name,</span>
<a href="#l161.62"></a><span id="l161.62" class="difflineplus">+already_AddRefed&lt;nsIAddrDatabase&gt; GetAddressBook(const char16_t *name,</span>
<a href="#l161.63"></a><span id="l161.63">                                                  bool makeNew)</span>
<a href="#l161.64"></a><span id="l161.64"> {</span>
<a href="#l161.65"></a><span id="l161.65">   if (!makeNew) {</span>
<a href="#l161.66"></a><span id="l161.66">     // FIXME: How do I get the list of address books and look for a</span>
<a href="#l161.67"></a><span id="l161.67">     // specific name.  Major bogosity!</span>
<a href="#l161.68"></a><span id="l161.68">     // For now, assume we didn't find anything with that name</span>
<a href="#l161.69"></a><span id="l161.69">   }</span>
<a href="#l161.70"></a><span id="l161.70"> </span>
<a href="#l161.71"></a><span id="l161.71" class="difflineat">@@ -775,25 +775,25 @@ AddressThreadData::~AddressThreadData()</span>
<a href="#l161.72"></a><span id="l161.72">   NS_IF_RELEASE(books);</span>
<a href="#l161.73"></a><span id="l161.73">   NS_IF_RELEASE(addressImport);</span>
<a href="#l161.74"></a><span id="l161.74">   NS_IF_RELEASE(errorLog);</span>
<a href="#l161.75"></a><span id="l161.75">   NS_IF_RELEASE(successLog);</span>
<a href="#l161.76"></a><span id="l161.76">   NS_IF_RELEASE(fieldMap);</span>
<a href="#l161.77"></a><span id="l161.77">   NS_IF_RELEASE(stringBundle);</span>
<a href="#l161.78"></a><span id="l161.78"> }</span>
<a href="#l161.79"></a><span id="l161.79"> </span>
<a href="#l161.80"></a><span id="l161.80" class="difflineminus">-void nsImportGenericAddressBooks::ReportError(const PRUnichar *pName,</span>
<a href="#l161.81"></a><span id="l161.81" class="difflineplus">+void nsImportGenericAddressBooks::ReportError(const char16_t *pName,</span>
<a href="#l161.82"></a><span id="l161.82">                                               nsString *pStream,</span>
<a href="#l161.83"></a><span id="l161.83">                                               nsIStringBundle* aBundle)</span>
<a href="#l161.84"></a><span id="l161.84"> {</span>
<a href="#l161.85"></a><span id="l161.85">   if (!pStream)</span>
<a href="#l161.86"></a><span id="l161.86">     return;</span>
<a href="#l161.87"></a><span id="l161.87">   // load the error string</span>
<a href="#l161.88"></a><span id="l161.88" class="difflineminus">-  PRUnichar *pFmt = nsImportStringBundle::GetStringByID(IMPORT_ERROR_GETABOOK, aBundle);</span>
<a href="#l161.89"></a><span id="l161.89" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, pName);</span>
<a href="#l161.90"></a><span id="l161.90" class="difflineplus">+  char16_t *pFmt = nsImportStringBundle::GetStringByID(IMPORT_ERROR_GETABOOK, aBundle);</span>
<a href="#l161.91"></a><span id="l161.91" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, pName);</span>
<a href="#l161.92"></a><span id="l161.92">   pStream-&gt;Append(pText);</span>
<a href="#l161.93"></a><span id="l161.93">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l161.94"></a><span id="l161.94">   NS_Free(pFmt);</span>
<a href="#l161.95"></a><span id="l161.95">   pStream-&gt;AppendLiteral(MSG_LINEBREAK);</span>
<a href="#l161.96"></a><span id="l161.96"> }</span>
<a href="#l161.97"></a><span id="l161.97"> </span>
<a href="#l161.98"></a><span id="l161.98"> static void ImportAddressThread(void *stuff)</span>
<a href="#l161.99"></a><span id="l161.99"> {</span>
<a href="#l161.100"></a><span id="l161.100" class="difflineat">@@ -825,18 +825,18 @@ static void ImportAddressThread(void *st</span>
<a href="#l161.101"></a><span id="l161.101">         nsString name;</span>
<a href="#l161.102"></a><span id="l161.102">         book-&gt;GetPreferredName(name);</span>
<a href="#l161.103"></a><span id="l161.103"> </span>
<a href="#l161.104"></a><span id="l161.104">         nsCOMPtr&lt;nsIAddrDatabase&gt; db = pData-&gt;dBs-&gt;ObjectAt(i);</span>
<a href="#l161.105"></a><span id="l161.105"> </span>
<a href="#l161.106"></a><span id="l161.106">         bool fatalError = false;</span>
<a href="#l161.107"></a><span id="l161.107">         pData-&gt;currentSize = size;</span>
<a href="#l161.108"></a><span id="l161.108">         if (db) {</span>
<a href="#l161.109"></a><span id="l161.109" class="difflineminus">-          PRUnichar *pSuccess = nullptr;</span>
<a href="#l161.110"></a><span id="l161.110" class="difflineminus">-          PRUnichar *pError = nullptr;</span>
<a href="#l161.111"></a><span id="l161.111" class="difflineplus">+          char16_t *pSuccess = nullptr;</span>
<a href="#l161.112"></a><span id="l161.112" class="difflineplus">+          char16_t *pError = nullptr;</span>
<a href="#l161.113"></a><span id="l161.113"> </span>
<a href="#l161.114"></a><span id="l161.114">           /*</span>
<a href="#l161.115"></a><span id="l161.115">           if (pData-&gt;fieldMap) {</span>
<a href="#l161.116"></a><span id="l161.116">             int32_t    sz = 0;</span>
<a href="#l161.117"></a><span id="l161.117">             int32_t    mapIndex;</span>
<a href="#l161.118"></a><span id="l161.118">             bool      active;</span>
<a href="#l161.119"></a><span id="l161.119">             pData-&gt;fieldMap-&gt;GetMapSize(&amp;sz);</span>
<a href="#l161.120"></a><span id="l161.120">             IMPORT_LOG1(&quot;**** Field Map Size: %d\n&quot;, (int) sz);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l162.1"></a><span id="l162.1" class="difflineminus">--- a/mailnews/import/src/nsImportFieldMap.cpp</span>
<a href="#l162.2"></a><span id="l162.2" class="difflineplus">+++ b/mailnews/import/src/nsImportFieldMap.cpp</span>
<a href="#l162.3"></a><span id="l162.3" class="difflineat">@@ -88,17 +88,17 @@ NS_IMETHODIMP nsImportFieldMap::GetMapSi</span>
<a href="#l162.4"></a><span id="l162.4">     NS_PRECONDITION(aNumFields != nullptr, &quot;null ptr&quot;);</span>
<a href="#l162.5"></a><span id="l162.5">   if (!aNumFields)</span>
<a href="#l162.6"></a><span id="l162.6">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l162.7"></a><span id="l162.7"> </span>
<a href="#l162.8"></a><span id="l162.8">   *aNumFields = m_numFields;</span>
<a href="#l162.9"></a><span id="l162.9">   return NS_OK;</span>
<a href="#l162.10"></a><span id="l162.10"> }</span>
<a href="#l162.11"></a><span id="l162.11"> </span>
<a href="#l162.12"></a><span id="l162.12" class="difflineminus">-NS_IMETHODIMP nsImportFieldMap::GetFieldDescription(int32_t index, PRUnichar **_retval)</span>
<a href="#l162.13"></a><span id="l162.13" class="difflineplus">+NS_IMETHODIMP nsImportFieldMap::GetFieldDescription(int32_t index, char16_t **_retval)</span>
<a href="#l162.14"></a><span id="l162.14"> {</span>
<a href="#l162.15"></a><span id="l162.15">     NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l162.16"></a><span id="l162.16">   if (!_retval)</span>
<a href="#l162.17"></a><span id="l162.17">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l162.18"></a><span id="l162.18"> </span>
<a href="#l162.19"></a><span id="l162.19">   *_retval = nullptr;</span>
<a href="#l162.20"></a><span id="l162.20">   if ((index &lt; 0) || (index &gt;= m_descriptions.Count()))</span>
<a href="#l162.21"></a><span id="l162.21">     return NS_ERROR_FAILURE;</span>
<a href="#l162.22"></a><span id="l162.22" class="difflineat">@@ -184,17 +184,17 @@ NS_IMETHODIMP nsImportFieldMap::SetField</span>
<a href="#l162.23"></a><span id="l162.23">   if ((index &lt; 0) || (index &gt;= m_numFields))</span>
<a href="#l162.24"></a><span id="l162.24">     return NS_ERROR_FAILURE;</span>
<a href="#l162.25"></a><span id="l162.25"> </span>
<a href="#l162.26"></a><span id="l162.26">   m_pActive[index] = active;</span>
<a href="#l162.27"></a><span id="l162.27">   return NS_OK;</span>
<a href="#l162.28"></a><span id="l162.28"> }</span>
<a href="#l162.29"></a><span id="l162.29"> </span>
<a href="#l162.30"></a><span id="l162.30"> </span>
<a href="#l162.31"></a><span id="l162.31" class="difflineminus">-NS_IMETHODIMP nsImportFieldMap::SetFieldValue(nsIAddrDatabase *database, nsIMdbRow *row, int32_t fieldNum, const PRUnichar *value)</span>
<a href="#l162.32"></a><span id="l162.32" class="difflineplus">+NS_IMETHODIMP nsImportFieldMap::SetFieldValue(nsIAddrDatabase *database, nsIMdbRow *row, int32_t fieldNum, const char16_t *value)</span>
<a href="#l162.33"></a><span id="l162.33"> {</span>
<a href="#l162.34"></a><span id="l162.34">   NS_PRECONDITION(database != nullptr, &quot;null ptr&quot;);</span>
<a href="#l162.35"></a><span id="l162.35">   NS_PRECONDITION(row != nullptr, &quot;null ptr&quot;);</span>
<a href="#l162.36"></a><span id="l162.36">   NS_PRECONDITION(value != nullptr, &quot;null ptr&quot;);</span>
<a href="#l162.37"></a><span id="l162.37">   if (!database || !row || !value)</span>
<a href="#l162.38"></a><span id="l162.38">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l162.39"></a><span id="l162.39"> </span>
<a href="#l162.40"></a><span id="l162.40">   // Allow the special value for a null field</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l163.1"></a><span id="l163.1" class="difflineminus">--- a/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l163.2"></a><span id="l163.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l163.3"></a><span id="l163.3" class="difflineat">@@ -81,17 +81,17 @@ private:</span>
<a href="#l163.4"></a><span id="l163.4">   bool    CreateFolder(nsIMsgFolder **ppFolder);</span>
<a href="#l163.5"></a><span id="l163.5">   void  GetDefaultMailboxes(void);</span>
<a href="#l163.6"></a><span id="l163.6">   void  GetDefaultLocation(void);</span>
<a href="#l163.7"></a><span id="l163.7">   void  GetDefaultDestination(void);</span>
<a href="#l163.8"></a><span id="l163.8">   void  GetMailboxName(uint32_t index, nsISupportsString *pStr);</span>
<a href="#l163.9"></a><span id="l163.9"> </span>
<a href="#l163.10"></a><span id="l163.10"> public:</span>
<a href="#l163.11"></a><span id="l163.11">   static void  SetLogs(nsString&amp; success, nsString&amp; error, nsISupportsString *pSuccess, nsISupportsString *pError);</span>
<a href="#l163.12"></a><span id="l163.12" class="difflineminus">-  static void ReportError(int32_t id, const PRUnichar *pName, nsString *pStream, nsIStringBundle* aBundle);</span>
<a href="#l163.13"></a><span id="l163.13" class="difflineplus">+  static void ReportError(int32_t id, const char16_t *pName, nsString *pStream, nsIStringBundle* aBundle);</span>
<a href="#l163.14"></a><span id="l163.14"> </span>
<a href="#l163.15"></a><span id="l163.15"> private:</span>
<a href="#l163.16"></a><span id="l163.16">   nsString      m_pName;  // module name that created this interface</span>
<a href="#l163.17"></a><span id="l163.17">   nsIMsgFolder *    m_pDestFolder;</span>
<a href="#l163.18"></a><span id="l163.18">   bool          m_deleteDestFolder;</span>
<a href="#l163.19"></a><span id="l163.19">   bool          m_createdFolder;</span>
<a href="#l163.20"></a><span id="l163.20">   nsCOMPtr &lt;nsIFile&gt; m_pSrcLocation;</span>
<a href="#l163.21"></a><span id="l163.21">   bool          m_gotLocation;</span>
<a href="#l163.22"></a><span id="l163.22" class="difflineat">@@ -598,24 +598,24 @@ NS_IMETHODIMP nsImportGenericMail::GetPr</span>
<a href="#l163.23"></a><span id="l163.23"> </span>
<a href="#l163.24"></a><span id="l163.24">   // never return 100% while the thread is still alive</span>
<a href="#l163.25"></a><span id="l163.25">   if (*_retval &gt; 99)</span>
<a href="#l163.26"></a><span id="l163.26">     *_retval = 99;</span>
<a href="#l163.27"></a><span id="l163.27"> </span>
<a href="#l163.28"></a><span id="l163.28">   return NS_OK;</span>
<a href="#l163.29"></a><span id="l163.29"> }</span>
<a href="#l163.30"></a><span id="l163.30"> </span>
<a href="#l163.31"></a><span id="l163.31" class="difflineminus">-void nsImportGenericMail::ReportError(int32_t id, const PRUnichar *pName, nsString *pStream, nsIStringBundle *aBundle)</span>
<a href="#l163.32"></a><span id="l163.32" class="difflineplus">+void nsImportGenericMail::ReportError(int32_t id, const char16_t *pName, nsString *pStream, nsIStringBundle *aBundle)</span>
<a href="#l163.33"></a><span id="l163.33"> {</span>
<a href="#l163.34"></a><span id="l163.34">   if (!pStream)</span>
<a href="#l163.35"></a><span id="l163.35">     return;</span>
<a href="#l163.36"></a><span id="l163.36"> </span>
<a href="#l163.37"></a><span id="l163.37">   // load the error string</span>
<a href="#l163.38"></a><span id="l163.38" class="difflineminus">-  PRUnichar *pFmt = nsImportStringBundle::GetStringByID(id, aBundle);</span>
<a href="#l163.39"></a><span id="l163.39" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, pName);</span>
<a href="#l163.40"></a><span id="l163.40" class="difflineplus">+  char16_t *pFmt = nsImportStringBundle::GetStringByID(id, aBundle);</span>
<a href="#l163.41"></a><span id="l163.41" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, pName);</span>
<a href="#l163.42"></a><span id="l163.42">   pStream-&gt;Append(pText);</span>
<a href="#l163.43"></a><span id="l163.43">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l163.44"></a><span id="l163.44">   NS_Free(pFmt);</span>
<a href="#l163.45"></a><span id="l163.45">   pStream-&gt;Append(NS_ConvertASCIItoUTF16(MSG_LINEBREAK));</span>
<a href="#l163.46"></a><span id="l163.46"> }</span>
<a href="#l163.47"></a><span id="l163.47"> </span>
<a href="#l163.48"></a><span id="l163.48"> </span>
<a href="#l163.49"></a><span id="l163.49"> void nsImportGenericMail::SetLogs(nsString&amp; success, nsString&amp; error, nsISupportsString *pSuccess, nsISupportsString *pError)</span>
<a href="#l163.50"></a><span id="l163.50" class="difflineat">@@ -718,17 +718,17 @@ ImportMailThread(void *stuff)</span>
<a href="#l163.51"></a><span id="l163.51">   rv = pData-&gt;boxes-&gt;GetLength(&amp;count);</span>
<a href="#l163.52"></a><span id="l163.52"> </span>
<a href="#l163.53"></a><span id="l163.53">   uint32_t    i;</span>
<a href="#l163.54"></a><span id="l163.54">   bool        import;</span>
<a href="#l163.55"></a><span id="l163.55">   uint32_t    size;</span>
<a href="#l163.56"></a><span id="l163.56">   uint32_t    depth = 1;</span>
<a href="#l163.57"></a><span id="l163.57">   uint32_t    newDepth;</span>
<a href="#l163.58"></a><span id="l163.58">   nsString    lastName;</span>
<a href="#l163.59"></a><span id="l163.59" class="difflineminus">-  PRUnichar *    pName;</span>
<a href="#l163.60"></a><span id="l163.60" class="difflineplus">+  char16_t *    pName;</span>
<a href="#l163.61"></a><span id="l163.61"> </span>
<a href="#l163.62"></a><span id="l163.62">   nsCOMPtr&lt;nsIMsgFolder&gt;    curFolder(destRoot);</span>
<a href="#l163.63"></a><span id="l163.63"> </span>
<a href="#l163.64"></a><span id="l163.64">   nsCOMPtr&lt;nsIMsgFolder&gt;          newFolder;</span>
<a href="#l163.65"></a><span id="l163.65">   nsCOMPtr&lt;nsIMsgFolder&gt;          subFolder;</span>
<a href="#l163.66"></a><span id="l163.66">   nsCOMPtr&lt;nsISimpleEnumerator&gt;   enumerator;</span>
<a href="#l163.67"></a><span id="l163.67"> </span>
<a href="#l163.68"></a><span id="l163.68">   bool              exists;</span>
<a href="#l163.69"></a><span id="l163.69" class="difflineat">@@ -832,18 +832,18 @@ ImportMailThread(void *stuff)</span>
<a href="#l163.70"></a><span id="l163.70">         IMPORT_LOG1(&quot;*** ImportMailThread: Failed to locate subfolder '%s' after it's been created.&quot;, lastName.get());</span>
<a href="#l163.71"></a><span id="l163.71">         nsImportGenericMail::ReportError(IMPORT_ERROR_MB_CREATE, lastName.get(),</span>
<a href="#l163.72"></a><span id="l163.72">                                          &amp;error, pData-&gt;stringBundle);</span>
<a href="#l163.73"></a><span id="l163.73">       }</span>
<a href="#l163.74"></a><span id="l163.74"> </span>
<a href="#l163.75"></a><span id="l163.75">       if (size &amp;&amp; import &amp;&amp; newFolder &amp;&amp; NS_SUCCEEDED(rv)) {</span>
<a href="#l163.76"></a><span id="l163.76">         bool fatalError = false;</span>
<a href="#l163.77"></a><span id="l163.77">         pData-&gt;currentSize = size;</span>
<a href="#l163.78"></a><span id="l163.78" class="difflineminus">-        PRUnichar *pSuccess = nullptr;</span>
<a href="#l163.79"></a><span id="l163.79" class="difflineminus">-        PRUnichar *pError = nullptr;</span>
<a href="#l163.80"></a><span id="l163.80" class="difflineplus">+        char16_t *pSuccess = nullptr;</span>
<a href="#l163.81"></a><span id="l163.81" class="difflineplus">+        char16_t *pError = nullptr;</span>
<a href="#l163.82"></a><span id="l163.82">         rv = pData-&gt;mailImport-&gt;ImportMailbox(box, newFolder, &amp;pError, &amp;pSuccess, &amp;fatalError);</span>
<a href="#l163.83"></a><span id="l163.83">         if (pError) {</span>
<a href="#l163.84"></a><span id="l163.84">           error.Append(pError);</span>
<a href="#l163.85"></a><span id="l163.85">           NS_Free(pError);</span>
<a href="#l163.86"></a><span id="l163.86">         }</span>
<a href="#l163.87"></a><span id="l163.87">         if (pSuccess) {</span>
<a href="#l163.88"></a><span id="l163.88">           success.Append(pSuccess);</span>
<a href="#l163.89"></a><span id="l163.89">           NS_Free(pSuccess);</span>
<a href="#l163.90"></a><span id="l163.90" class="difflineat">@@ -908,17 +908,17 @@ bool nsImportGenericMail::CreateFolder(n</span>
<a href="#l163.91"></a><span id="l163.91">     mozilla::services::GetStringBundleService();</span>
<a href="#l163.92"></a><span id="l163.92">   if (!bundleService)</span>
<a href="#l163.93"></a><span id="l163.93">       return false;</span>
<a href="#l163.94"></a><span id="l163.94">   rv = bundleService-&gt;CreateBundle(IMPORT_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l163.95"></a><span id="l163.95">   if (NS_FAILED(rv))</span>
<a href="#l163.96"></a><span id="l163.96">       return false;</span>
<a href="#l163.97"></a><span id="l163.97">   nsString folderName;</span>
<a href="#l163.98"></a><span id="l163.98">   if (!m_pName.IsEmpty()) {</span>
<a href="#l163.99"></a><span id="l163.99" class="difflineminus">-    const PRUnichar *moduleName[] = { m_pName.get() };</span>
<a href="#l163.100"></a><span id="l163.100" class="difflineplus">+    const char16_t *moduleName[] = { m_pName.get() };</span>
<a href="#l163.101"></a><span id="l163.101">     rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;ImportModuleFolderName&quot;),</span>
<a href="#l163.102"></a><span id="l163.102">                                       moduleName, 1,</span>
<a href="#l163.103"></a><span id="l163.103">                                       getter_Copies(folderName));</span>
<a href="#l163.104"></a><span id="l163.104">   }</span>
<a href="#l163.105"></a><span id="l163.105">   else {</span>
<a href="#l163.106"></a><span id="l163.106">     rv = bundle-&gt;GetStringFromName(MOZ_UTF16(&quot;DefaultFolderName&quot;),</span>
<a href="#l163.107"></a><span id="l163.107">                                    getter_Copies(folderName));</span>
<a href="#l163.108"></a><span id="l163.108">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l164.1"></a><span id="l164.1" class="difflineminus">--- a/mailnews/import/src/nsImportMailboxDescriptor.h</span>
<a href="#l164.2"></a><span id="l164.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMailboxDescriptor.h</span>
<a href="#l164.3"></a><span id="l164.3" class="difflineat">@@ -28,18 +28,18 @@ public:</span>
<a href="#l164.4"></a><span id="l164.4">   NS_IMETHOD  GetDepth(uint32_t *pDepth) MOZ_OVERRIDE { *pDepth = m_depth; return NS_OK;}</span>
<a href="#l164.5"></a><span id="l164.5">   NS_IMETHOD  SetDepth(uint32_t theDepth) MOZ_OVERRIDE { m_depth = theDepth; return NS_OK;}</span>
<a href="#l164.6"></a><span id="l164.6"> </span>
<a href="#l164.7"></a><span id="l164.7">   /* attribute unsigned long size; */</span>
<a href="#l164.8"></a><span id="l164.8">   NS_IMETHOD  GetSize(uint32_t *pSize) MOZ_OVERRIDE { *pSize = m_size; return NS_OK;}</span>
<a href="#l164.9"></a><span id="l164.9">   NS_IMETHOD  SetSize(uint32_t theSize) MOZ_OVERRIDE { m_size = theSize; return NS_OK;}</span>
<a href="#l164.10"></a><span id="l164.10"> </span>
<a href="#l164.11"></a><span id="l164.11">   /* attribute wstring displayName; */</span>
<a href="#l164.12"></a><span id="l164.12" class="difflineminus">-  NS_IMETHOD  GetDisplayName(PRUnichar **pName) MOZ_OVERRIDE { *pName = ToNewUnicode(m_displayName); return NS_OK;}</span>
<a href="#l164.13"></a><span id="l164.13" class="difflineminus">-  NS_IMETHOD  SetDisplayName(const PRUnichar * pName) MOZ_OVERRIDE { m_displayName = pName; return NS_OK;}</span>
<a href="#l164.14"></a><span id="l164.14" class="difflineplus">+  NS_IMETHOD  GetDisplayName(char16_t **pName) MOZ_OVERRIDE { *pName = ToNewUnicode(m_displayName); return NS_OK;}</span>
<a href="#l164.15"></a><span id="l164.15" class="difflineplus">+  NS_IMETHOD  SetDisplayName(const char16_t * pName) MOZ_OVERRIDE { m_displayName = pName; return NS_OK;}</span>
<a href="#l164.16"></a><span id="l164.16"> </span>
<a href="#l164.17"></a><span id="l164.17">   /* attribute boolean import; */</span>
<a href="#l164.18"></a><span id="l164.18">   NS_IMETHOD  GetImport(bool *pImport) MOZ_OVERRIDE { *pImport = m_import; return NS_OK;}</span>
<a href="#l164.19"></a><span id="l164.19">   NS_IMETHOD  SetImport(bool doImport) MOZ_OVERRIDE { m_import = doImport; return NS_OK;}</span>
<a href="#l164.20"></a><span id="l164.20"> </span>
<a href="#l164.21"></a><span id="l164.21">   /* readonly attribute nsIFile file; */</span>
<a href="#l164.22"></a><span id="l164.22">   NS_IMETHOD GetFile(nsIFile * *aFile) MOZ_OVERRIDE { if (m_pFile) { NS_ADDREF(*aFile = m_pFile); return NS_OK;} else return NS_ERROR_FAILURE; }</span>
<a href="#l164.23"></a><span id="l164.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l165.1"></a><span id="l165.1" class="difflineminus">--- a/mailnews/import/src/nsImportService.cpp</span>
<a href="#l165.2"></a><span id="l165.2" class="difflineplus">+++ b/mailnews/import/src/nsImportService.cpp</span>
<a href="#l165.3"></a><span id="l165.3" class="difflineat">@@ -182,17 +182,17 @@ NS_IMETHODIMP nsImportService::GetModule</span>
<a href="#l165.4"></a><span id="l165.4">     }</span>
<a href="#l165.5"></a><span id="l165.5">   }</span>
<a href="#l165.6"></a><span id="l165.6"> </span>
<a href="#l165.7"></a><span id="l165.7">   IMPORT_LOG0(&quot;* nsImportService::GetSpecificModule - module not found\n&quot;);</span>
<a href="#l165.8"></a><span id="l165.8"> </span>
<a href="#l165.9"></a><span id="l165.9">   return NS_ERROR_NOT_AVAILABLE;</span>
<a href="#l165.10"></a><span id="l165.10"> }</span>
<a href="#l165.11"></a><span id="l165.11"> </span>
<a href="#l165.12"></a><span id="l165.12" class="difflineminus">-NS_IMETHODIMP nsImportService::GetModuleInfo(const char *filter, int32_t index, PRUnichar **name, PRUnichar **moduleDescription)</span>
<a href="#l165.13"></a><span id="l165.13" class="difflineplus">+NS_IMETHODIMP nsImportService::GetModuleInfo(const char *filter, int32_t index, char16_t **name, char16_t **moduleDescription)</span>
<a href="#l165.14"></a><span id="l165.14"> {</span>
<a href="#l165.15"></a><span id="l165.15">     NS_PRECONDITION(name != nullptr, &quot;null ptr&quot;);</span>
<a href="#l165.16"></a><span id="l165.16">     NS_PRECONDITION(moduleDescription != nullptr, &quot;null ptr&quot;);</span>
<a href="#l165.17"></a><span id="l165.17">     if (!name || !moduleDescription)</span>
<a href="#l165.18"></a><span id="l165.18">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l165.19"></a><span id="l165.19"> </span>
<a href="#l165.20"></a><span id="l165.20">   *name = nullptr;</span>
<a href="#l165.21"></a><span id="l165.21">   *moduleDescription = nullptr;</span>
<a href="#l165.22"></a><span id="l165.22" class="difflineat">@@ -217,17 +217,17 @@ NS_IMETHODIMP nsImportService::GetModule</span>
<a href="#l165.23"></a><span id="l165.23">       else</span>
<a href="#l165.24"></a><span id="l165.24">         count++;</span>
<a href="#l165.25"></a><span id="l165.25">     }</span>
<a href="#l165.26"></a><span id="l165.26">   }</span>
<a href="#l165.27"></a><span id="l165.27"> </span>
<a href="#l165.28"></a><span id="l165.28">   return NS_ERROR_FAILURE;</span>
<a href="#l165.29"></a><span id="l165.29"> }</span>
<a href="#l165.30"></a><span id="l165.30"> </span>
<a href="#l165.31"></a><span id="l165.31" class="difflineminus">-NS_IMETHODIMP nsImportService::GetModuleName(const char *filter, int32_t index, PRUnichar **_retval)</span>
<a href="#l165.32"></a><span id="l165.32" class="difflineplus">+NS_IMETHODIMP nsImportService::GetModuleName(const char *filter, int32_t index, char16_t **_retval)</span>
<a href="#l165.33"></a><span id="l165.33"> {</span>
<a href="#l165.34"></a><span id="l165.34">     NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l165.35"></a><span id="l165.35">     if (!_retval)</span>
<a href="#l165.36"></a><span id="l165.36">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l165.37"></a><span id="l165.37"> </span>
<a href="#l165.38"></a><span id="l165.38">   *_retval = nullptr;</span>
<a href="#l165.39"></a><span id="l165.39"> </span>
<a href="#l165.40"></a><span id="l165.40">     DoDiscover();</span>
<a href="#l165.41"></a><span id="l165.41" class="difflineat">@@ -250,17 +250,17 @@ NS_IMETHODIMP nsImportService::GetModule</span>
<a href="#l165.42"></a><span id="l165.42">         count++;</span>
<a href="#l165.43"></a><span id="l165.43">     }</span>
<a href="#l165.44"></a><span id="l165.44">   }</span>
<a href="#l165.45"></a><span id="l165.45"> </span>
<a href="#l165.46"></a><span id="l165.46">   return NS_ERROR_FAILURE;</span>
<a href="#l165.47"></a><span id="l165.47"> }</span>
<a href="#l165.48"></a><span id="l165.48"> </span>
<a href="#l165.49"></a><span id="l165.49"> </span>
<a href="#l165.50"></a><span id="l165.50" class="difflineminus">-NS_IMETHODIMP nsImportService::GetModuleDescription(const char *filter, int32_t index, PRUnichar **_retval)</span>
<a href="#l165.51"></a><span id="l165.51" class="difflineplus">+NS_IMETHODIMP nsImportService::GetModuleDescription(const char *filter, int32_t index, char16_t **_retval)</span>
<a href="#l165.52"></a><span id="l165.52"> {</span>
<a href="#l165.53"></a><span id="l165.53">     NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l165.54"></a><span id="l165.54">     if (!_retval)</span>
<a href="#l165.55"></a><span id="l165.55">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l165.56"></a><span id="l165.56"> </span>
<a href="#l165.57"></a><span id="l165.57">   *_retval = nullptr;</span>
<a href="#l165.58"></a><span id="l165.58"> </span>
<a href="#l165.59"></a><span id="l165.59">     DoDiscover();</span>
<a href="#l165.60"></a><span id="l165.60" class="difflineat">@@ -555,17 +555,17 @@ void nsImportModuleList::ClearList(void)</span>
<a href="#l165.61"></a><span id="l165.61">     m_count = 0;</span>
<a href="#l165.62"></a><span id="l165.62">     delete [] m_pList;</span>
<a href="#l165.63"></a><span id="l165.63">     m_pList = nullptr;</span>
<a href="#l165.64"></a><span id="l165.64">     m_alloc = 0;</span>
<a href="#l165.65"></a><span id="l165.65">   }</span>
<a href="#l165.66"></a><span id="l165.66"> </span>
<a href="#l165.67"></a><span id="l165.67"> }</span>
<a href="#l165.68"></a><span id="l165.68"> </span>
<a href="#l165.69"></a><span id="l165.69" class="difflineminus">-void nsImportModuleList::AddModule(const nsCID&amp; cid, const char *pSupports, const PRUnichar *pName, const PRUnichar *pDesc)</span>
<a href="#l165.70"></a><span id="l165.70" class="difflineplus">+void nsImportModuleList::AddModule(const nsCID&amp; cid, const char *pSupports, const char16_t *pName, const char16_t *pDesc)</span>
<a href="#l165.71"></a><span id="l165.71"> {</span>
<a href="#l165.72"></a><span id="l165.72">   if (!m_pList)</span>
<a href="#l165.73"></a><span id="l165.73">   {</span>
<a href="#l165.74"></a><span id="l165.74">     m_alloc = 10;</span>
<a href="#l165.75"></a><span id="l165.75">     m_pList = new ImportModuleDesc *[m_alloc];</span>
<a href="#l165.76"></a><span id="l165.76">     m_count = 0;</span>
<a href="#l165.77"></a><span id="l165.77">     memset(m_pList, 0, sizeof(ImportModuleDesc *) * m_alloc);</span>
<a href="#l165.78"></a><span id="l165.78">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l166.1"></a><span id="l166.1" class="difflineminus">--- a/mailnews/import/src/nsImportService.h</span>
<a href="#l166.2"></a><span id="l166.2" class="difflineplus">+++ b/mailnews/import/src/nsImportService.h</span>
<a href="#l166.3"></a><span id="l166.3" class="difflineat">@@ -44,23 +44,23 @@ private:</span>
<a href="#l166.4"></a><span id="l166.4"> };</span>
<a href="#l166.5"></a><span id="l166.5"> </span>
<a href="#l166.6"></a><span id="l166.6"> class ImportModuleDesc {</span>
<a href="#l166.7"></a><span id="l166.7"> public:</span>
<a href="#l166.8"></a><span id="l166.8">   ImportModuleDesc() { m_pModule = nullptr;}</span>
<a href="#l166.9"></a><span id="l166.9">   ~ImportModuleDesc() { ReleaseModule();  }</span>
<a href="#l166.10"></a><span id="l166.10"> </span>
<a href="#l166.11"></a><span id="l166.11">   void  SetCID(const nsCID&amp; cid) { m_cid = cid;}</span>
<a href="#l166.12"></a><span id="l166.12" class="difflineminus">-  void  SetName(const PRUnichar *pName) { m_name = pName;}</span>
<a href="#l166.13"></a><span id="l166.13" class="difflineminus">-  void  SetDescription(const PRUnichar *pDesc) { m_description = pDesc;}</span>
<a href="#l166.14"></a><span id="l166.14" class="difflineplus">+  void  SetName(const char16_t *pName) { m_name = pName;}</span>
<a href="#l166.15"></a><span id="l166.15" class="difflineplus">+  void  SetDescription(const char16_t *pDesc) { m_description = pDesc;}</span>
<a href="#l166.16"></a><span id="l166.16">   void  SetSupports(const char *pSupports) { m_supports = pSupports;}</span>
<a href="#l166.17"></a><span id="l166.17"> </span>
<a href="#l166.18"></a><span id="l166.18">   nsCID      GetCID(void) { return m_cid;}</span>
<a href="#l166.19"></a><span id="l166.19" class="difflineminus">-  const PRUnichar *GetName(void) { return m_name.get();}</span>
<a href="#l166.20"></a><span id="l166.20" class="difflineminus">-  const PRUnichar *GetDescription(void) { return m_description.get();}</span>
<a href="#l166.21"></a><span id="l166.21" class="difflineplus">+  const char16_t *GetName(void) { return m_name.get();}</span>
<a href="#l166.22"></a><span id="l166.22" class="difflineplus">+  const char16_t *GetDescription(void) { return m_description.get();}</span>
<a href="#l166.23"></a><span id="l166.23">   const char *  GetSupports(void) { return m_supports.get();}</span>
<a href="#l166.24"></a><span id="l166.24"> </span>
<a href="#l166.25"></a><span id="l166.25">   nsIImportModule *  GetModule(bool keepLoaded = false); // Adds ref</span>
<a href="#l166.26"></a><span id="l166.26">   void        ReleaseModule(void);</span>
<a href="#l166.27"></a><span id="l166.27"> </span>
<a href="#l166.28"></a><span id="l166.28">   bool        SupportsThings(const char *pThings);</span>
<a href="#l166.29"></a><span id="l166.29"> </span>
<a href="#l166.30"></a><span id="l166.30"> private:</span>
<a href="#l166.31"></a><span id="l166.31" class="difflineat">@@ -71,17 +71,17 @@ private:</span>
<a href="#l166.32"></a><span id="l166.32">   nsIImportModule *m_pModule;</span>
<a href="#l166.33"></a><span id="l166.33"> };</span>
<a href="#l166.34"></a><span id="l166.34"> </span>
<a href="#l166.35"></a><span id="l166.35"> class nsImportModuleList {</span>
<a href="#l166.36"></a><span id="l166.36"> public:</span>
<a href="#l166.37"></a><span id="l166.37">   nsImportModuleList() { m_pList = nullptr; m_alloc = 0; m_count = 0;}</span>
<a href="#l166.38"></a><span id="l166.38">   ~nsImportModuleList() { ClearList(); }</span>
<a href="#l166.39"></a><span id="l166.39"> </span>
<a href="#l166.40"></a><span id="l166.40" class="difflineminus">-  void  AddModule(const nsCID&amp; cid, const char *pSupports, const PRUnichar *pName, const PRUnichar *pDesc);</span>
<a href="#l166.41"></a><span id="l166.41" class="difflineplus">+  void  AddModule(const nsCID&amp; cid, const char *pSupports, const char16_t *pName, const char16_t *pDesc);</span>
<a href="#l166.42"></a><span id="l166.42"> </span>
<a href="#l166.43"></a><span id="l166.43">   void  ClearList(void);</span>
<a href="#l166.44"></a><span id="l166.44"> </span>
<a href="#l166.45"></a><span id="l166.45">   int32_t  GetCount(void) { return m_count;}</span>
<a href="#l166.46"></a><span id="l166.46"> </span>
<a href="#l166.47"></a><span id="l166.47">   ImportModuleDesc *  GetModuleDesc(int32_t idx)</span>
<a href="#l166.48"></a><span id="l166.48">     { if ((idx &lt; 0) || (idx &gt;= m_count)) return nullptr; else return m_pList[idx];}</span>
<a href="#l166.49"></a><span id="l166.49"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l167.1"></a><span id="l167.1" class="difflineminus">--- a/mailnews/import/src/nsImportStringBundle.cpp</span>
<a href="#l167.2"></a><span id="l167.2" class="difflineplus">+++ b/mailnews/import/src/nsImportStringBundle.cpp</span>
<a href="#l167.3"></a><span id="l167.3" class="difflineat">@@ -28,22 +28,22 @@ nsresult nsImportStringBundle::GetString</span>
<a href="#l167.4"></a><span id="l167.4"> </span>
<a href="#l167.5"></a><span id="l167.5"> void nsImportStringBundle::GetStringByID(int32_t aStringID,</span>
<a href="#l167.6"></a><span id="l167.6">                                          nsIStringBundle *aBundle,</span>
<a href="#l167.7"></a><span id="l167.7">                                          nsString &amp;aResult)</span>
<a href="#l167.8"></a><span id="l167.8"> {</span>
<a href="#l167.9"></a><span id="l167.9">   aResult.Adopt(GetStringByID(aStringID, aBundle));</span>
<a href="#l167.10"></a><span id="l167.10"> }</span>
<a href="#l167.11"></a><span id="l167.11"> </span>
<a href="#l167.12"></a><span id="l167.12" class="difflineminus">-PRUnichar *nsImportStringBundle::GetStringByID(int32_t aStringID,</span>
<a href="#l167.13"></a><span id="l167.13" class="difflineplus">+char16_t *nsImportStringBundle::GetStringByID(int32_t aStringID,</span>
<a href="#l167.14"></a><span id="l167.14">                                                nsIStringBundle *aBundle)</span>
<a href="#l167.15"></a><span id="l167.15"> {</span>
<a href="#l167.16"></a><span id="l167.16">   if (aBundle)</span>
<a href="#l167.17"></a><span id="l167.17">   {</span>
<a href="#l167.18"></a><span id="l167.18" class="difflineminus">-    PRUnichar *ptrv = nullptr;</span>
<a href="#l167.19"></a><span id="l167.19" class="difflineplus">+    char16_t *ptrv = nullptr;</span>
<a href="#l167.20"></a><span id="l167.20">     nsresult rv = aBundle-&gt;GetStringFromID(aStringID, &amp;ptrv);</span>
<a href="#l167.21"></a><span id="l167.21"> </span>
<a href="#l167.22"></a><span id="l167.22">     if (NS_SUCCEEDED(rv) &amp;&amp; ptrv)</span>
<a href="#l167.23"></a><span id="l167.23">       return ptrv;</span>
<a href="#l167.24"></a><span id="l167.24">   }</span>
<a href="#l167.25"></a><span id="l167.25"> </span>
<a href="#l167.26"></a><span id="l167.26">   nsString resultString(NS_LITERAL_STRING(&quot;[StringID &quot;));</span>
<a href="#l167.27"></a><span id="l167.27">   resultString.AppendInt(aStringID);</span>
<a href="#l167.28"></a><span id="l167.28" class="difflineat">@@ -54,22 +54,22 @@ PRUnichar *nsImportStringBundle::GetStri</span>
<a href="#l167.29"></a><span id="l167.29"> </span>
<a href="#l167.30"></a><span id="l167.30"> void nsImportStringBundle::GetStringByName(const char *aName,</span>
<a href="#l167.31"></a><span id="l167.31">                                            nsIStringBundle *aBundle,</span>
<a href="#l167.32"></a><span id="l167.32">                                            nsString &amp;aResult)</span>
<a href="#l167.33"></a><span id="l167.33"> {</span>
<a href="#l167.34"></a><span id="l167.34">   aResult.Adopt(GetStringByName(aName, aBundle));</span>
<a href="#l167.35"></a><span id="l167.35"> }</span>
<a href="#l167.36"></a><span id="l167.36"> </span>
<a href="#l167.37"></a><span id="l167.37" class="difflineminus">-PRUnichar *nsImportStringBundle::GetStringByName(const char *aName,</span>
<a href="#l167.38"></a><span id="l167.38" class="difflineplus">+char16_t *nsImportStringBundle::GetStringByName(const char *aName,</span>
<a href="#l167.39"></a><span id="l167.39">                                                  nsIStringBundle *aBundle)</span>
<a href="#l167.40"></a><span id="l167.40"> {</span>
<a href="#l167.41"></a><span id="l167.41">   if (aBundle)</span>
<a href="#l167.42"></a><span id="l167.42">   {</span>
<a href="#l167.43"></a><span id="l167.43" class="difflineminus">-    PRUnichar *ptrv = nullptr;</span>
<a href="#l167.44"></a><span id="l167.44" class="difflineplus">+    char16_t *ptrv = nullptr;</span>
<a href="#l167.45"></a><span id="l167.45">     nsresult rv = aBundle-&gt;GetStringFromName(</span>
<a href="#l167.46"></a><span id="l167.46">         NS_ConvertUTF8toUTF16(aName).get(), &amp;ptrv);</span>
<a href="#l167.47"></a><span id="l167.47"> </span>
<a href="#l167.48"></a><span id="l167.48">     if (NS_SUCCEEDED(rv) &amp;&amp; ptrv)</span>
<a href="#l167.49"></a><span id="l167.49">       return ptrv;</span>
<a href="#l167.50"></a><span id="l167.50">   }</span>
<a href="#l167.51"></a><span id="l167.51"> </span>
<a href="#l167.52"></a><span id="l167.52">   nsString resultString(NS_LITERAL_STRING(&quot;[StringName &quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l168.1"></a><span id="l168.1" class="difflineminus">--- a/mailnews/import/src/nsImportStringBundle.h</span>
<a href="#l168.2"></a><span id="l168.2" class="difflineplus">+++ b/mailnews/import/src/nsImportStringBundle.h</span>
<a href="#l168.3"></a><span id="l168.3" class="difflineat">@@ -7,22 +7,22 @@</span>
<a href="#l168.4"></a><span id="l168.4"> </span>
<a href="#l168.5"></a><span id="l168.5"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l168.6"></a><span id="l168.6"> </span>
<a href="#l168.7"></a><span id="l168.7"> class nsIStringBundle;</span>
<a href="#l168.8"></a><span id="l168.8"> </span>
<a href="#l168.9"></a><span id="l168.9"> class nsImportStringBundle</span>
<a href="#l168.10"></a><span id="l168.10"> {</span>
<a href="#l168.11"></a><span id="l168.11"> public:</span>
<a href="#l168.12"></a><span id="l168.12" class="difflineminus">-  static PRUnichar* GetStringByID(int32_t aStringID,</span>
<a href="#l168.13"></a><span id="l168.13" class="difflineplus">+  static char16_t* GetStringByID(int32_t aStringID,</span>
<a href="#l168.14"></a><span id="l168.14">                                   nsIStringBundle *aBundle = nullptr);</span>
<a href="#l168.15"></a><span id="l168.15">   static void GetStringByID(int32_t aStringID,</span>
<a href="#l168.16"></a><span id="l168.16">                             nsIStringBundle *aBundle,</span>
<a href="#l168.17"></a><span id="l168.17">                             nsString &amp;aResult);</span>
<a href="#l168.18"></a><span id="l168.18" class="difflineminus">-  static PRUnichar* GetStringByName(const char *aName,</span>
<a href="#l168.19"></a><span id="l168.19" class="difflineplus">+  static char16_t* GetStringByName(const char *aName,</span>
<a href="#l168.20"></a><span id="l168.20">                                     nsIStringBundle *aBundle = nullptr);</span>
<a href="#l168.21"></a><span id="l168.21">   static void GetStringByName(const char *aName,</span>
<a href="#l168.22"></a><span id="l168.22">                                 nsIStringBundle *aBundle,</span>
<a href="#l168.23"></a><span id="l168.23">                                 nsString &amp;aResult);</span>
<a href="#l168.24"></a><span id="l168.24">   static nsresult GetStringBundle(const char *aPropertyURL,</span>
<a href="#l168.25"></a><span id="l168.25">                                   nsIStringBundle **aBundle);</span>
<a href="#l168.26"></a><span id="l168.26"> };</span>
<a href="#l168.27"></a><span id="l168.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l169.1"></a><span id="l169.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l169.2"></a><span id="l169.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l169.3"></a><span id="l169.3" class="difflineat">@@ -62,17 +62,17 @@ nsresult nsTextAddress::GetUnicharLineSt</span>
<a href="#l169.4"></a><span id="l169.4">                                charset.get(),</span>
<a href="#l169.5"></a><span id="l169.5">                                8192,</span>
<a href="#l169.6"></a><span id="l169.6">                                nsIConverterInputStream::DEFAULT_REPLACEMENT_CHARACTER);</span>
<a href="#l169.7"></a><span id="l169.7">   }</span>
<a href="#l169.8"></a><span id="l169.8"> </span>
<a href="#l169.9"></a><span id="l169.9">   return CallQueryInterface(converterStream, aStream);</span>
<a href="#l169.10"></a><span id="l169.10"> }</span>
<a href="#l169.11"></a><span id="l169.11"> </span>
<a href="#l169.12"></a><span id="l169.12" class="difflineminus">-nsresult nsTextAddress::ImportAddresses(bool *pAbort, const PRUnichar *pName, nsIFile *pSrc, nsIAddrDatabase *pDb, nsIImportFieldMap *fieldMap, nsString&amp; errors, uint32_t *pProgress)</span>
<a href="#l169.13"></a><span id="l169.13" class="difflineplus">+nsresult nsTextAddress::ImportAddresses(bool *pAbort, const char16_t *pName, nsIFile *pSrc, nsIAddrDatabase *pDb, nsIImportFieldMap *fieldMap, nsString&amp; errors, uint32_t *pProgress)</span>
<a href="#l169.14"></a><span id="l169.14"> {</span>
<a href="#l169.15"></a><span id="l169.15">   // Open the source file for reading, read each line and process it!</span>
<a href="#l169.16"></a><span id="l169.16">   NS_IF_RELEASE(m_database);</span>
<a href="#l169.17"></a><span id="l169.17">   NS_IF_RELEASE(m_fieldMap);</span>
<a href="#l169.18"></a><span id="l169.18">   m_database = pDb;</span>
<a href="#l169.19"></a><span id="l169.19">   m_fieldMap = fieldMap;</span>
<a href="#l169.20"></a><span id="l169.20">   NS_ADDREF(m_fieldMap);</span>
<a href="#l169.21"></a><span id="l169.21">   NS_ADDREF(m_database);</span>
<a href="#l169.22"></a><span id="l169.22" class="difflineat">@@ -168,17 +168,17 @@ nsresult nsTextAddress::ReadRecord(nsIUn</span>
<a href="#l169.23"></a><span id="l169.23">     else {</span>
<a href="#l169.24"></a><span id="l169.24">       // Read the line and append it</span>
<a href="#l169.25"></a><span id="l169.25">       rv = aLineStream-&gt;ReadLine(line, &amp;more);</span>
<a href="#l169.26"></a><span id="l169.26">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l169.27"></a><span id="l169.27">         if (!aLine.IsEmpty())</span>
<a href="#l169.28"></a><span id="l169.28">           aLine.AppendLiteral(MSG_LINEBREAK);</span>
<a href="#l169.29"></a><span id="l169.29">         aLine.Append(line);</span>
<a href="#l169.30"></a><span id="l169.30"> </span>
<a href="#l169.31"></a><span id="l169.31" class="difflineminus">-        numQuotes += MsgCountChar(line, PRUnichar('&quot;'));</span>
<a href="#l169.32"></a><span id="l169.32" class="difflineplus">+        numQuotes += MsgCountChar(line, char16_t('&quot;'));</span>
<a href="#l169.33"></a><span id="l169.33">       }</span>
<a href="#l169.34"></a><span id="l169.34">     }</span>
<a href="#l169.35"></a><span id="l169.35">     // Continue whilst everything is ok, and we have an odd number of quotes.</span>
<a href="#l169.36"></a><span id="l169.36">   } while (NS_SUCCEEDED(rv) &amp;&amp; (numQuotes % 2 != 0));</span>
<a href="#l169.37"></a><span id="l169.37"> </span>
<a href="#l169.38"></a><span id="l169.38">   *aMore = more;</span>
<a href="#l169.39"></a><span id="l169.39">   return rv;</span>
<a href="#l169.40"></a><span id="l169.40"> }</span>
<a href="#l169.41"></a><span id="l169.41" class="difflineat">@@ -223,29 +223,29 @@ nsresult nsTextAddress::ReadRecordNumber</span>
<a href="#l169.42"></a><span id="l169.42">     }</span>
<a href="#l169.43"></a><span id="l169.43"> </span>
<a href="#l169.44"></a><span id="l169.44">     rIndex++;</span>
<a href="#l169.45"></a><span id="l169.45">   }</span>
<a href="#l169.46"></a><span id="l169.46"> </span>
<a href="#l169.47"></a><span id="l169.47">   return NS_ERROR_FAILURE;</span>
<a href="#l169.48"></a><span id="l169.48"> }</span>
<a href="#l169.49"></a><span id="l169.49"> </span>
<a href="#l169.50"></a><span id="l169.50" class="difflineminus">-int32_t nsTextAddress::CountFields(const nsAString &amp;aLine, PRUnichar delim)</span>
<a href="#l169.51"></a><span id="l169.51" class="difflineplus">+int32_t nsTextAddress::CountFields(const nsAString &amp;aLine, char16_t delim)</span>
<a href="#l169.52"></a><span id="l169.52"> {</span>
<a href="#l169.53"></a><span id="l169.53">     int32_t pos = 0;</span>
<a href="#l169.54"></a><span id="l169.54">     int32_t maxLen = aLine.Length();</span>
<a href="#l169.55"></a><span id="l169.55">     int32_t count = 0;</span>
<a href="#l169.56"></a><span id="l169.56" class="difflineminus">-    PRUnichar tab = PRUnichar('\t');</span>
<a href="#l169.57"></a><span id="l169.57" class="difflineminus">-    PRUnichar doubleQuote = PRUnichar('&quot;');</span>
<a href="#l169.58"></a><span id="l169.58" class="difflineplus">+    char16_t tab = char16_t('\t');</span>
<a href="#l169.59"></a><span id="l169.59" class="difflineplus">+    char16_t doubleQuote = char16_t('&quot;');</span>
<a href="#l169.60"></a><span id="l169.60"> </span>
<a href="#l169.61"></a><span id="l169.61">     if (delim == tab)</span>
<a href="#l169.62"></a><span id="l169.62" class="difflineminus">-        tab = PRUnichar('\0');</span>
<a href="#l169.63"></a><span id="l169.63" class="difflineplus">+        tab = char16_t('\0');</span>
<a href="#l169.64"></a><span id="l169.64"> </span>
<a href="#l169.65"></a><span id="l169.65">     while (pos &lt; maxLen) {</span>
<a href="#l169.66"></a><span id="l169.66" class="difflineminus">-        while (((aLine[pos] == PRUnichar(' ')) || (aLine[pos] == tab)) &amp;&amp;</span>
<a href="#l169.67"></a><span id="l169.67" class="difflineplus">+        while (((aLine[pos] == char16_t(' ')) || (aLine[pos] == tab)) &amp;&amp;</span>
<a href="#l169.68"></a><span id="l169.68">                (pos &lt; maxLen)) {</span>
<a href="#l169.69"></a><span id="l169.69">             pos++;</span>
<a href="#l169.70"></a><span id="l169.70">         }</span>
<a href="#l169.71"></a><span id="l169.71">         if ((pos &lt; maxLen) &amp;&amp; (aLine[pos] == doubleQuote)) {</span>
<a href="#l169.72"></a><span id="l169.72">             pos++;</span>
<a href="#l169.73"></a><span id="l169.73">             while ((pos &lt; maxLen) &amp;&amp; (aLine[pos] != doubleQuote)) {</span>
<a href="#l169.74"></a><span id="l169.74">                 pos++;</span>
<a href="#l169.75"></a><span id="l169.75">                 if (((pos + 1) &lt; maxLen) &amp;&amp;</span>
<a href="#l169.76"></a><span id="l169.76" class="difflineat">@@ -265,31 +265,31 @@ int32_t nsTextAddress::CountFields(const</span>
<a href="#l169.77"></a><span id="l169.77">     }</span>
<a href="#l169.78"></a><span id="l169.78"> </span>
<a href="#l169.79"></a><span id="l169.79">     return count;</span>
<a href="#l169.80"></a><span id="l169.80"> }</span>
<a href="#l169.81"></a><span id="l169.81"> </span>
<a href="#l169.82"></a><span id="l169.82"> bool nsTextAddress::GetField(const nsAString &amp;aLine,</span>
<a href="#l169.83"></a><span id="l169.83">                              int32_t index,</span>
<a href="#l169.84"></a><span id="l169.84">                              nsString &amp;field,</span>
<a href="#l169.85"></a><span id="l169.85" class="difflineminus">-                             PRUnichar delim)</span>
<a href="#l169.86"></a><span id="l169.86" class="difflineplus">+                             char16_t delim)</span>
<a href="#l169.87"></a><span id="l169.87"> {</span>
<a href="#l169.88"></a><span id="l169.88">     bool result = false;</span>
<a href="#l169.89"></a><span id="l169.89">     int32_t pos = 0;</span>
<a href="#l169.90"></a><span id="l169.90">     int32_t maxLen = aLine.Length();</span>
<a href="#l169.91"></a><span id="l169.91" class="difflineminus">-    PRUnichar tab = PRUnichar('\t');</span>
<a href="#l169.92"></a><span id="l169.92" class="difflineminus">-    PRUnichar doubleQuote = PRUnichar('&quot;');</span>
<a href="#l169.93"></a><span id="l169.93" class="difflineplus">+    char16_t tab = char16_t('\t');</span>
<a href="#l169.94"></a><span id="l169.94" class="difflineplus">+    char16_t doubleQuote = char16_t('&quot;');</span>
<a href="#l169.95"></a><span id="l169.95"> </span>
<a href="#l169.96"></a><span id="l169.96">     field.Truncate();</span>
<a href="#l169.97"></a><span id="l169.97"> </span>
<a href="#l169.98"></a><span id="l169.98">     if (delim == tab)</span>
<a href="#l169.99"></a><span id="l169.99">         tab = 0;</span>
<a href="#l169.100"></a><span id="l169.100"> </span>
<a href="#l169.101"></a><span id="l169.101">     while (index &amp;&amp; (pos &lt; maxLen)) {</span>
<a href="#l169.102"></a><span id="l169.102" class="difflineminus">-        while (((aLine[pos] == PRUnichar(' ')) || (aLine[pos] == tab)) &amp;&amp;</span>
<a href="#l169.103"></a><span id="l169.103" class="difflineplus">+        while (((aLine[pos] == char16_t(' ')) || (aLine[pos] == tab)) &amp;&amp;</span>
<a href="#l169.104"></a><span id="l169.104">                (pos &lt; maxLen)) {</span>
<a href="#l169.105"></a><span id="l169.105">             pos++;</span>
<a href="#l169.106"></a><span id="l169.106">         }</span>
<a href="#l169.107"></a><span id="l169.107">         if (pos &gt;= maxLen)</span>
<a href="#l169.108"></a><span id="l169.108">             break;</span>
<a href="#l169.109"></a><span id="l169.109">         if (aLine[pos] == doubleQuote) {</span>
<a href="#l169.110"></a><span id="l169.110">             do {</span>
<a href="#l169.111"></a><span id="l169.111">                 pos++;</span>
<a href="#l169.112"></a><span id="l169.112" class="difflineat">@@ -388,32 +388,32 @@ nsresult nsTextAddress::DetermineDelim(n</span>
<a href="#l169.113"></a><span id="l169.113">   if (NS_FAILED(rv)) {</span>
<a href="#l169.114"></a><span id="l169.114">     IMPORT_LOG0(&quot;*** Error opening converter stream for importer\n&quot;);</span>
<a href="#l169.115"></a><span id="l169.115">     return rv;</span>
<a href="#l169.116"></a><span id="l169.116">   }</span>
<a href="#l169.117"></a><span id="l169.117"> </span>
<a href="#l169.118"></a><span id="l169.118">   while (more &amp;&amp; NS_SUCCEEDED(rv) &amp;&amp; (lineCount &lt; 100)) {</span>
<a href="#l169.119"></a><span id="l169.119">     rv = lineStream-&gt;ReadLine(line, &amp;more);</span>
<a href="#l169.120"></a><span id="l169.120">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l169.121"></a><span id="l169.121" class="difflineminus">-      tabCount = CountFields(line, PRUnichar('\t'));</span>
<a href="#l169.122"></a><span id="l169.122" class="difflineminus">-      commaCount = CountFields(line, PRUnichar(','));</span>
<a href="#l169.123"></a><span id="l169.123" class="difflineplus">+      tabCount = CountFields(line, char16_t('\t'));</span>
<a href="#l169.124"></a><span id="l169.124" class="difflineplus">+      commaCount = CountFields(line, char16_t(','));</span>
<a href="#l169.125"></a><span id="l169.125">       if (tabCount &gt; commaCount)</span>
<a href="#l169.126"></a><span id="l169.126">         tabLines++;</span>
<a href="#l169.127"></a><span id="l169.127">       else if (commaCount)</span>
<a href="#l169.128"></a><span id="l169.128">         commaLines++;</span>
<a href="#l169.129"></a><span id="l169.129">     }</span>
<a href="#l169.130"></a><span id="l169.130">     lineCount++;</span>
<a href="#l169.131"></a><span id="l169.131">   }</span>
<a href="#l169.132"></a><span id="l169.132"> </span>
<a href="#l169.133"></a><span id="l169.133">   rv = inputStream-&gt;Close();</span>
<a href="#l169.134"></a><span id="l169.134"> </span>
<a href="#l169.135"></a><span id="l169.135">   if (tabLines &gt; commaLines)</span>
<a href="#l169.136"></a><span id="l169.136" class="difflineminus">-    m_delim = PRUnichar('\t');</span>
<a href="#l169.137"></a><span id="l169.137" class="difflineplus">+    m_delim = char16_t('\t');</span>
<a href="#l169.138"></a><span id="l169.138">   else</span>
<a href="#l169.139"></a><span id="l169.139" class="difflineminus">-    m_delim = PRUnichar(',');</span>
<a href="#l169.140"></a><span id="l169.140" class="difflineplus">+    m_delim = char16_t(',');</span>
<a href="#l169.141"></a><span id="l169.141"> </span>
<a href="#l169.142"></a><span id="l169.142">   IMPORT_LOG2( &quot;Tab count = %d, Comma count = %d\n&quot;, tabLines, commaLines);</span>
<a href="#l169.143"></a><span id="l169.143"> </span>
<a href="#l169.144"></a><span id="l169.144">   return rv;</span>
<a href="#l169.145"></a><span id="l169.145"> }</span>
<a href="#l169.146"></a><span id="l169.146"> </span>
<a href="#l169.147"></a><span id="l169.147"> /*</span>
<a href="#l169.148"></a><span id="l169.148">     This is where the real work happens!</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l170.1"></a><span id="l170.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextAddress.h</span>
<a href="#l170.2"></a><span id="l170.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextAddress.h</span>
<a href="#l170.3"></a><span id="l170.3" class="difflineat">@@ -21,34 +21,34 @@ class nsIUnicharLineInputStream;</span>
<a href="#l170.4"></a><span id="l170.4"> /////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l170.5"></a><span id="l170.5"> /////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l170.6"></a><span id="l170.6"> </span>
<a href="#l170.7"></a><span id="l170.7"> class nsTextAddress {</span>
<a href="#l170.8"></a><span id="l170.8"> public:</span>
<a href="#l170.9"></a><span id="l170.9">   nsTextAddress();</span>
<a href="#l170.10"></a><span id="l170.10">   virtual ~nsTextAddress();</span>
<a href="#l170.11"></a><span id="l170.11"> </span>
<a href="#l170.12"></a><span id="l170.12" class="difflineminus">-  nsresult ImportAddresses(bool *pAbort, const PRUnichar *pName, nsIFile *pSrc, nsIAddrDatabase *pDb, nsIImportFieldMap *fieldMap, nsString&amp; errors, uint32_t *pProgress);</span>
<a href="#l170.13"></a><span id="l170.13" class="difflineplus">+  nsresult ImportAddresses(bool *pAbort, const char16_t *pName, nsIFile *pSrc, nsIAddrDatabase *pDb, nsIImportFieldMap *fieldMap, nsString&amp; errors, uint32_t *pProgress);</span>
<a href="#l170.14"></a><span id="l170.14"> </span>
<a href="#l170.15"></a><span id="l170.15">   nsresult DetermineDelim(nsIFile *pSrc);</span>
<a href="#l170.16"></a><span id="l170.16" class="difflineminus">-  PRUnichar GetDelim(void) { return m_delim; }</span>
<a href="#l170.17"></a><span id="l170.17" class="difflineplus">+  char16_t GetDelim(void) { return m_delim; }</span>
<a href="#l170.18"></a><span id="l170.18"> </span>
<a href="#l170.19"></a><span id="l170.19">   static nsresult ReadRecordNumber(nsIFile *pSrc, nsAString &amp;aLine, int32_t rNum);</span>
<a href="#l170.20"></a><span id="l170.20" class="difflineminus">-  static bool GetField(const nsAString &amp;aLine, int32_t index, nsString &amp;field, PRUnichar delim);</span>
<a href="#l170.21"></a><span id="l170.21" class="difflineplus">+  static bool GetField(const nsAString &amp;aLine, int32_t index, nsString &amp;field, char16_t delim);</span>
<a href="#l170.22"></a><span id="l170.22"> </span>
<a href="#l170.23"></a><span id="l170.23"> private:</span>
<a href="#l170.24"></a><span id="l170.24">   nsresult ProcessLine(const nsAString &amp;aLine, nsString &amp;errors);</span>
<a href="#l170.25"></a><span id="l170.25"> </span>
<a href="#l170.26"></a><span id="l170.26" class="difflineminus">-  static int32_t CountFields(const nsAString &amp;aLine, PRUnichar delim);</span>
<a href="#l170.27"></a><span id="l170.27" class="difflineplus">+  static int32_t CountFields(const nsAString &amp;aLine, char16_t delim);</span>
<a href="#l170.28"></a><span id="l170.28">   static nsresult ReadRecord(nsIUnicharLineInputStream *pSrc, nsAString &amp;aLine, bool *aMore);</span>
<a href="#l170.29"></a><span id="l170.29">   static nsresult GetUnicharLineStreamForFile(nsIFile *aFile,</span>
<a href="#l170.30"></a><span id="l170.30">                                               nsIInputStream *aInputStream,</span>
<a href="#l170.31"></a><span id="l170.31">                                               nsIUnicharLineInputStream **aStream);</span>
<a href="#l170.32"></a><span id="l170.32"> </span>
<a href="#l170.33"></a><span id="l170.33" class="difflineminus">-  PRUnichar m_delim;</span>
<a href="#l170.34"></a><span id="l170.34" class="difflineplus">+  char16_t m_delim;</span>
<a href="#l170.35"></a><span id="l170.35">   int32_t m_LFCount;</span>
<a href="#l170.36"></a><span id="l170.36">   int32_t m_CRCount;</span>
<a href="#l170.37"></a><span id="l170.37">   nsIAddrDatabase *m_database;</span>
<a href="#l170.38"></a><span id="l170.38">   nsIImportFieldMap *m_fieldMap;</span>
<a href="#l170.39"></a><span id="l170.39">   nsCOMPtr&lt;nsIImportService&gt; m_pService;</span>
<a href="#l170.40"></a><span id="l170.40"> };</span>
<a href="#l170.41"></a><span id="l170.41"> </span>
<a href="#l170.42"></a><span id="l170.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l171.1"></a><span id="l171.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l171.2"></a><span id="l171.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l171.3"></a><span id="l171.3" class="difflineat">@@ -63,58 +63,58 @@ public:</span>
<a href="#l171.4"></a><span id="l171.4"> </span>
<a href="#l171.5"></a><span id="l171.5">     // nsISupports interface</span>
<a href="#l171.6"></a><span id="l171.6">     NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l171.7"></a><span id="l171.7"> </span>
<a href="#l171.8"></a><span id="l171.8">     // nsIImportAddressBooks interface</span>
<a href="#l171.9"></a><span id="l171.9">     </span>
<a href="#l171.10"></a><span id="l171.10">   NS_IMETHOD GetSupportsMultiple(bool *_retval) { *_retval = false; return NS_OK;}</span>
<a href="#l171.11"></a><span id="l171.11"> </span>
<a href="#l171.12"></a><span id="l171.12" class="difflineminus">-  NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l171.13"></a><span id="l171.13" class="difflineplus">+  NS_IMETHOD GetAutoFind(char16_t **description, bool *_retval);</span>
<a href="#l171.14"></a><span id="l171.14"> </span>
<a href="#l171.15"></a><span id="l171.15">   NS_IMETHOD GetNeedsFieldMap(nsIFile *location, bool *_retval);</span>
<a href="#l171.16"></a><span id="l171.16"> </span>
<a href="#l171.17"></a><span id="l171.17">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l171.18"></a><span id="l171.18"> </span>
<a href="#l171.19"></a><span id="l171.19">   NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l171.20"></a><span id="l171.20"> </span>
<a href="#l171.21"></a><span id="l171.21">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap);</span>
<a href="#l171.22"></a><span id="l171.22"> </span>
<a href="#l171.23"></a><span id="l171.23">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l171.24"></a><span id="l171.24">                                nsIAddrDatabase *destination,</span>
<a href="#l171.25"></a><span id="l171.25">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l171.26"></a><span id="l171.26">                                nsISupports *aSupportService,</span>
<a href="#l171.27"></a><span id="l171.27" class="difflineminus">-                               PRUnichar **errorLog,</span>
<a href="#l171.28"></a><span id="l171.28" class="difflineminus">-                               PRUnichar **successLog,</span>
<a href="#l171.29"></a><span id="l171.29" class="difflineplus">+                               char16_t **errorLog,</span>
<a href="#l171.30"></a><span id="l171.30" class="difflineplus">+                               char16_t **successLog,</span>
<a href="#l171.31"></a><span id="l171.31">                                bool *fatalError);</span>
<a href="#l171.32"></a><span id="l171.32"> </span>
<a href="#l171.33"></a><span id="l171.33">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l171.34"></a><span id="l171.34"> </span>
<a href="#l171.35"></a><span id="l171.35" class="difflineminus">-  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, PRUnichar **pStr);</span>
<a href="#l171.36"></a><span id="l171.36" class="difflineplus">+  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, char16_t **pStr);</span>
<a href="#l171.37"></a><span id="l171.37"> </span>
<a href="#l171.38"></a><span id="l171.38">   NS_IMETHOD SetSampleLocation(nsIFile *);</span>
<a href="#l171.39"></a><span id="l171.39"> </span>
<a href="#l171.40"></a><span id="l171.40"> private:</span>
<a href="#l171.41"></a><span id="l171.41">   void ClearSampleFile(void);</span>
<a href="#l171.42"></a><span id="l171.42">   void SaveFieldMap(nsIImportFieldMap *pMap);</span>
<a href="#l171.43"></a><span id="l171.43"> </span>
<a href="#l171.44"></a><span id="l171.44">   static void ReportSuccess(nsString&amp; name, nsString *pStream,</span>
<a href="#l171.45"></a><span id="l171.45">                             nsIStringBundle* pBundle);</span>
<a href="#l171.46"></a><span id="l171.46" class="difflineminus">-  static void SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError,</span>
<a href="#l171.47"></a><span id="l171.47" class="difflineminus">-                      PRUnichar **pSuccess);</span>
<a href="#l171.48"></a><span id="l171.48" class="difflineplus">+  static void SetLogs(nsString&amp; success, nsString&amp; error, char16_t **pError,</span>
<a href="#l171.49"></a><span id="l171.49" class="difflineplus">+                      char16_t **pSuccess);</span>
<a href="#l171.50"></a><span id="l171.50">   static void ReportError(int32_t errorNum, nsString&amp; name, nsString *pStream,</span>
<a href="#l171.51"></a><span id="l171.51">                           nsIStringBundle* pBundle);</span>
<a href="#l171.52"></a><span id="l171.52">   static void SanitizeSampleData(nsString&amp; val);</span>
<a href="#l171.53"></a><span id="l171.53"> </span>
<a href="#l171.54"></a><span id="l171.54"> private:</span>
<a href="#l171.55"></a><span id="l171.55">   nsTextAddress m_text;</span>
<a href="#l171.56"></a><span id="l171.56">   bool m_haveDelim;</span>
<a href="#l171.57"></a><span id="l171.57">   nsCOMPtr&lt;nsIFile&gt; m_fileLoc;</span>
<a href="#l171.58"></a><span id="l171.58">   nsCOMPtr&lt;nsIStringBundle&gt; m_notProxyBundle;</span>
<a href="#l171.59"></a><span id="l171.59" class="difflineminus">-  PRUnichar m_delim;</span>
<a href="#l171.60"></a><span id="l171.60" class="difflineplus">+  char16_t m_delim;</span>
<a href="#l171.61"></a><span id="l171.61">   uint32_t m_bytesImported;</span>
<a href="#l171.62"></a><span id="l171.62"> };</span>
<a href="#l171.63"></a><span id="l171.63"> </span>
<a href="#l171.64"></a><span id="l171.64"> ////////////////////////////////////////////////////////////////////////</span>
<a href="#l171.65"></a><span id="l171.65"> ////////////////////////////////////////////////////////////////////////</span>
<a href="#l171.66"></a><span id="l171.66"> </span>
<a href="#l171.67"></a><span id="l171.67"> nsTextImport::nsTextImport()</span>
<a href="#l171.68"></a><span id="l171.68"> {</span>
<a href="#l171.69"></a><span id="l171.69" class="difflineat">@@ -129,24 +129,24 @@ nsTextImport::nsTextImport()</span>
<a href="#l171.70"></a><span id="l171.70"> </span>
<a href="#l171.71"></a><span id="l171.71"> nsTextImport::~nsTextImport()</span>
<a href="#l171.72"></a><span id="l171.72"> {</span>
<a href="#l171.73"></a><span id="l171.73">   IMPORT_LOG0(&quot;nsTextImport Module Deleted\n&quot;);</span>
<a href="#l171.74"></a><span id="l171.74"> }</span>
<a href="#l171.75"></a><span id="l171.75"> </span>
<a href="#l171.76"></a><span id="l171.76"> NS_IMPL_ISUPPORTS1(nsTextImport, nsIImportModule)</span>
<a href="#l171.77"></a><span id="l171.77"> </span>
<a href="#l171.78"></a><span id="l171.78" class="difflineminus">-NS_IMETHODIMP nsTextImport::GetName(PRUnichar **name)</span>
<a href="#l171.79"></a><span id="l171.79" class="difflineplus">+NS_IMETHODIMP nsTextImport::GetName(char16_t **name)</span>
<a href="#l171.80"></a><span id="l171.80"> {</span>
<a href="#l171.81"></a><span id="l171.81">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l171.82"></a><span id="l171.82">   *name = nsImportStringBundle::GetStringByID(TEXTIMPORT_NAME, m_stringBundle);</span>
<a href="#l171.83"></a><span id="l171.83">   return NS_OK;</span>
<a href="#l171.84"></a><span id="l171.84"> }</span>
<a href="#l171.85"></a><span id="l171.85"> </span>
<a href="#l171.86"></a><span id="l171.86" class="difflineminus">-NS_IMETHODIMP nsTextImport::GetDescription(PRUnichar **name)</span>
<a href="#l171.87"></a><span id="l171.87" class="difflineplus">+NS_IMETHODIMP nsTextImport::GetDescription(char16_t **name)</span>
<a href="#l171.88"></a><span id="l171.88"> {</span>
<a href="#l171.89"></a><span id="l171.89">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l171.90"></a><span id="l171.90">   *name = nsImportStringBundle::GetStringByID(TEXTIMPORT_DESCRIPTION,</span>
<a href="#l171.91"></a><span id="l171.91">                                               m_stringBundle);</span>
<a href="#l171.92"></a><span id="l171.92"> </span>
<a href="#l171.93"></a><span id="l171.93">   return NS_OK;</span>
<a href="#l171.94"></a><span id="l171.94"> }</span>
<a href="#l171.95"></a><span id="l171.95"> </span>
<a href="#l171.96"></a><span id="l171.96" class="difflineat">@@ -217,17 +217,17 @@ ImportAddressImpl::ImportAddressImpl(nsI</span>
<a href="#l171.97"></a><span id="l171.97">   m_notProxyBundle(aStringBundle)</span>
<a href="#l171.98"></a><span id="l171.98"> {</span>
<a href="#l171.99"></a><span id="l171.99">   m_haveDelim = false;</span>
<a href="#l171.100"></a><span id="l171.100"> }</span>
<a href="#l171.101"></a><span id="l171.101"> </span>
<a href="#l171.102"></a><span id="l171.102"> NS_IMPL_ISUPPORTS1(ImportAddressImpl, nsIImportAddressBooks)</span>
<a href="#l171.103"></a><span id="l171.103"> </span>
<a href="#l171.104"></a><span id="l171.104"> </span>
<a href="#l171.105"></a><span id="l171.105" class="difflineminus">-NS_IMETHODIMP ImportAddressImpl::GetAutoFind(PRUnichar **addrDescription, bool *_retval)</span>
<a href="#l171.106"></a><span id="l171.106" class="difflineplus">+NS_IMETHODIMP ImportAddressImpl::GetAutoFind(char16_t **addrDescription, bool *_retval)</span>
<a href="#l171.107"></a><span id="l171.107"> {</span>
<a href="#l171.108"></a><span id="l171.108">   NS_PRECONDITION(addrDescription != nullptr, &quot;null ptr&quot;);</span>
<a href="#l171.109"></a><span id="l171.109">   NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l171.110"></a><span id="l171.110">   if (! addrDescription || !_retval)</span>
<a href="#l171.111"></a><span id="l171.111">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l171.112"></a><span id="l171.112"> </span>
<a href="#l171.113"></a><span id="l171.113">   nsString str;</span>
<a href="#l171.114"></a><span id="l171.114">   *_retval = false;</span>
<a href="#l171.115"></a><span id="l171.115" class="difflineat">@@ -337,57 +337,57 @@ NS_IMETHODIMP ImportAddressImpl::FindAdd</span>
<a href="#l171.116"></a><span id="l171.116"> </span>
<a href="#l171.117"></a><span id="l171.117"> void ImportAddressImpl::ReportSuccess(nsString&amp; name, nsString *pStream,</span>
<a href="#l171.118"></a><span id="l171.118">                                       nsIStringBundle* pBundle)</span>
<a href="#l171.119"></a><span id="l171.119"> {</span>
<a href="#l171.120"></a><span id="l171.120">   if (!pStream)</span>
<a href="#l171.121"></a><span id="l171.121">     return;</span>
<a href="#l171.122"></a><span id="l171.122"> </span>
<a href="#l171.123"></a><span id="l171.123">   // load the success string</span>
<a href="#l171.124"></a><span id="l171.124" class="difflineminus">-  PRUnichar *pFmt =</span>
<a href="#l171.125"></a><span id="l171.125" class="difflineplus">+  char16_t *pFmt =</span>
<a href="#l171.126"></a><span id="l171.126">     nsImportStringBundle::GetStringByID(TEXTIMPORT_ADDRESS_SUCCESS, pBundle);</span>
<a href="#l171.127"></a><span id="l171.127"> </span>
<a href="#l171.128"></a><span id="l171.128" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l171.129"></a><span id="l171.129" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l171.130"></a><span id="l171.130">   pStream-&gt;Append(pText);</span>
<a href="#l171.131"></a><span id="l171.131">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l171.132"></a><span id="l171.132">   NS_Free(pFmt);</span>
<a href="#l171.133"></a><span id="l171.133" class="difflineminus">-  pStream-&gt;Append(PRUnichar('\n'));</span>
<a href="#l171.134"></a><span id="l171.134" class="difflineplus">+  pStream-&gt;Append(char16_t('\n'));</span>
<a href="#l171.135"></a><span id="l171.135"> }</span>
<a href="#l171.136"></a><span id="l171.136"> </span>
<a href="#l171.137"></a><span id="l171.137"> void ImportAddressImpl::ReportError(int32_t errorNum, nsString&amp; name,</span>
<a href="#l171.138"></a><span id="l171.138">                                     nsString *pStream, nsIStringBundle* pBundle)</span>
<a href="#l171.139"></a><span id="l171.139"> {</span>
<a href="#l171.140"></a><span id="l171.140">   if (!pStream)</span>
<a href="#l171.141"></a><span id="l171.141">     return;</span>
<a href="#l171.142"></a><span id="l171.142"> </span>
<a href="#l171.143"></a><span id="l171.143">   // load the error string</span>
<a href="#l171.144"></a><span id="l171.144" class="difflineminus">-  PRUnichar *pFmt = nsImportStringBundle::GetStringByID(errorNum, pBundle);</span>
<a href="#l171.145"></a><span id="l171.145" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l171.146"></a><span id="l171.146" class="difflineplus">+  char16_t *pFmt = nsImportStringBundle::GetStringByID(errorNum, pBundle);</span>
<a href="#l171.147"></a><span id="l171.147" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l171.148"></a><span id="l171.148">   pStream-&gt;Append(pText);</span>
<a href="#l171.149"></a><span id="l171.149">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l171.150"></a><span id="l171.150">   NS_Free(pFmt);</span>
<a href="#l171.151"></a><span id="l171.151" class="difflineminus">-  pStream-&gt;Append(PRUnichar('\n'));</span>
<a href="#l171.152"></a><span id="l171.152" class="difflineplus">+  pStream-&gt;Append(char16_t('\n'));</span>
<a href="#l171.153"></a><span id="l171.153"> }</span>
<a href="#l171.154"></a><span id="l171.154"> </span>
<a href="#l171.155"></a><span id="l171.155" class="difflineminus">-void ImportAddressImpl::SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l171.156"></a><span id="l171.156" class="difflineplus">+void ImportAddressImpl::SetLogs(nsString&amp; success, nsString&amp; error, char16_t **pError, char16_t **pSuccess)</span>
<a href="#l171.157"></a><span id="l171.157"> {</span>
<a href="#l171.158"></a><span id="l171.158">   if (pError)</span>
<a href="#l171.159"></a><span id="l171.159">     *pError = ToNewUnicode(error);</span>
<a href="#l171.160"></a><span id="l171.160">   if (pSuccess)</span>
<a href="#l171.161"></a><span id="l171.161">     *pSuccess = ToNewUnicode(success);</span>
<a href="#l171.162"></a><span id="l171.162"> }</span>
<a href="#l171.163"></a><span id="l171.163"> </span>
<a href="#l171.164"></a><span id="l171.164"> </span>
<a href="#l171.165"></a><span id="l171.165"> NS_IMETHODIMP</span>
<a href="#l171.166"></a><span id="l171.166"> ImportAddressImpl::ImportAddressBook(nsIImportABDescriptor *pSource,</span>
<a href="#l171.167"></a><span id="l171.167">                                      nsIAddrDatabase *pDestination,</span>
<a href="#l171.168"></a><span id="l171.168">                                      nsIImportFieldMap *fieldMap,</span>
<a href="#l171.169"></a><span id="l171.169">                                      nsISupports *aSupportService,</span>
<a href="#l171.170"></a><span id="l171.170" class="difflineminus">-                                     PRUnichar ** pErrorLog,</span>
<a href="#l171.171"></a><span id="l171.171" class="difflineminus">-                                     PRUnichar ** pSuccessLog,</span>
<a href="#l171.172"></a><span id="l171.172" class="difflineplus">+                                     char16_t ** pErrorLog,</span>
<a href="#l171.173"></a><span id="l171.173" class="difflineplus">+                                     char16_t ** pSuccessLog,</span>
<a href="#l171.174"></a><span id="l171.174">                                      bool * fatalError)</span>
<a href="#l171.175"></a><span id="l171.175"> {</span>
<a href="#l171.176"></a><span id="l171.176">   NS_PRECONDITION(pSource != nullptr, &quot;null ptr&quot;);</span>
<a href="#l171.177"></a><span id="l171.177">   NS_PRECONDITION(pDestination != nullptr, &quot;null ptr&quot;);</span>
<a href="#l171.178"></a><span id="l171.178">   NS_PRECONDITION(fatalError != nullptr, &quot;null ptr&quot;);</span>
<a href="#l171.179"></a><span id="l171.179"> </span>
<a href="#l171.180"></a><span id="l171.180">   m_bytesImported = 0;</span>
<a href="#l171.181"></a><span id="l171.181"> </span>
<a href="#l171.182"></a><span id="l171.182" class="difflineat">@@ -530,31 +530,31 @@ void ImportAddressImpl::SanitizeSampleDa</span>
<a href="#l171.183"></a><span id="l171.183">   }</span>
<a href="#l171.184"></a><span id="l171.184">   offset = val.FindChar(10);</span>
<a href="#l171.185"></a><span id="l171.185">   while (offset != -1) {</span>
<a href="#l171.186"></a><span id="l171.186">     val.Replace(offset, 1, ',');</span>
<a href="#l171.187"></a><span id="l171.187">     offset = val.FindChar(10, offset + 2);</span>
<a href="#l171.188"></a><span id="l171.188">   }</span>
<a href="#l171.189"></a><span id="l171.189"> }</span>
<a href="#l171.190"></a><span id="l171.190"> </span>
<a href="#l171.191"></a><span id="l171.191" class="difflineminus">-NS_IMETHODIMP ImportAddressImpl::GetSampleData(int32_t index, bool *pFound, PRUnichar **pStr)</span>
<a href="#l171.192"></a><span id="l171.192" class="difflineplus">+NS_IMETHODIMP ImportAddressImpl::GetSampleData(int32_t index, bool *pFound, char16_t **pStr)</span>
<a href="#l171.193"></a><span id="l171.193"> {</span>
<a href="#l171.194"></a><span id="l171.194">   NS_PRECONDITION(pFound != nullptr, &quot;null ptr&quot;);</span>
<a href="#l171.195"></a><span id="l171.195">   NS_PRECONDITION(pStr != nullptr, &quot;null ptr&quot;);</span>
<a href="#l171.196"></a><span id="l171.196">   if (!pFound || !pStr)</span>
<a href="#l171.197"></a><span id="l171.197">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l171.198"></a><span id="l171.198"> </span>
<a href="#l171.199"></a><span id="l171.199">   if (!m_fileLoc) {</span>
<a href="#l171.200"></a><span id="l171.200">     IMPORT_LOG0(&quot;*** Error, called GetSampleData before SetSampleLocation\n&quot;);</span>
<a href="#l171.201"></a><span id="l171.201">     return NS_ERROR_FAILURE;</span>
<a href="#l171.202"></a><span id="l171.202">   }</span>
<a href="#l171.203"></a><span id="l171.203"> </span>
<a href="#l171.204"></a><span id="l171.204">   nsresult rv;</span>
<a href="#l171.205"></a><span id="l171.205">   *pStr = nullptr;</span>
<a href="#l171.206"></a><span id="l171.206" class="difflineminus">-  PRUnichar term = 0;</span>
<a href="#l171.207"></a><span id="l171.207" class="difflineplus">+  char16_t term = 0;</span>
<a href="#l171.208"></a><span id="l171.208"> </span>
<a href="#l171.209"></a><span id="l171.209">   if (!m_haveDelim) {</span>
<a href="#l171.210"></a><span id="l171.210">     rv = m_text.DetermineDelim(m_fileLoc);</span>
<a href="#l171.211"></a><span id="l171.211">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l171.212"></a><span id="l171.212">     m_haveDelim = true;</span>
<a href="#l171.213"></a><span id="l171.213">     m_delim = m_text.GetDelim();</span>
<a href="#l171.214"></a><span id="l171.214">   }</span>
<a href="#l171.215"></a><span id="l171.215"> </span>
<a href="#l171.216"></a><span id="l171.216" class="difflineat">@@ -571,17 +571,17 @@ NS_IMETHODIMP ImportAddressImpl::GetSamp</span>
<a href="#l171.217"></a><span id="l171.217">   nsAutoString line;</span>
<a href="#l171.218"></a><span id="l171.218">   rv = nsTextAddress::ReadRecordNumber(m_fileLoc, line, index);</span>
<a href="#l171.219"></a><span id="l171.219">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l171.220"></a><span id="l171.220">     nsString str;</span>
<a href="#l171.221"></a><span id="l171.221">     nsString field;</span>
<a href="#l171.222"></a><span id="l171.222">     int32_t fNum = 0;</span>
<a href="#l171.223"></a><span id="l171.223">     while (nsTextAddress::GetField(line, fNum, field, m_delim)) {</span>
<a href="#l171.224"></a><span id="l171.224">       if (fNum)</span>
<a href="#l171.225"></a><span id="l171.225" class="difflineminus">-        str.Append(PRUnichar('\n'));</span>
<a href="#l171.226"></a><span id="l171.226" class="difflineplus">+        str.Append(char16_t('\n'));</span>
<a href="#l171.227"></a><span id="l171.227">       SanitizeSampleData(field);</span>
<a href="#l171.228"></a><span id="l171.228">       str.Append(field);</span>
<a href="#l171.229"></a><span id="l171.229">       fNum++;</span>
<a href="#l171.230"></a><span id="l171.230">       field.Truncate();</span>
<a href="#l171.231"></a><span id="l171.231">     }</span>
<a href="#l171.232"></a><span id="l171.232"> </span>
<a href="#l171.233"></a><span id="l171.233">     *pStr = ToNewUnicode(str);</span>
<a href="#l171.234"></a><span id="l171.234">     *pFound = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l172.1"></a><span id="l172.1" class="difflineminus">--- a/mailnews/import/vcard/src/nsVCardAddress.cpp</span>
<a href="#l172.2"></a><span id="l172.2" class="difflineplus">+++ b/mailnews/import/vcard/src/nsVCardAddress.cpp</span>
<a href="#l172.3"></a><span id="l172.3" class="difflineat">@@ -23,17 +23,17 @@ nsVCardAddress::nsVCardAddress()</span>
<a href="#l172.4"></a><span id="l172.4"> }</span>
<a href="#l172.5"></a><span id="l172.5"> </span>
<a href="#l172.6"></a><span id="l172.6"> nsVCardAddress::~nsVCardAddress()</span>
<a href="#l172.7"></a><span id="l172.7"> {</span>
<a href="#l172.8"></a><span id="l172.8"> }</span>
<a href="#l172.9"></a><span id="l172.9"> </span>
<a href="#l172.10"></a><span id="l172.10"> nsresult nsVCardAddress::ImportAddresses(</span>
<a href="#l172.11"></a><span id="l172.11">     bool *pAbort,</span>
<a href="#l172.12"></a><span id="l172.12" class="difflineminus">-    const PRUnichar *pName,</span>
<a href="#l172.13"></a><span id="l172.13" class="difflineplus">+    const char16_t *pName,</span>
<a href="#l172.14"></a><span id="l172.14">     nsIFile *pSrc,</span>
<a href="#l172.15"></a><span id="l172.15">     nsIAddrDatabase *pDb,</span>
<a href="#l172.16"></a><span id="l172.16">     nsString&amp; errors,</span>
<a href="#l172.17"></a><span id="l172.17">     uint32_t *pProgress)</span>
<a href="#l172.18"></a><span id="l172.18"> {</span>
<a href="#l172.19"></a><span id="l172.19">   // Open the source file for reading, read each line and process it!</span>
<a href="#l172.20"></a><span id="l172.20">   nsCOMPtr&lt;nsIInputStream&gt; inputStream;</span>
<a href="#l172.21"></a><span id="l172.21">   nsresult rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), pSrc);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l173.1"></a><span id="l173.1" class="difflineminus">--- a/mailnews/import/vcard/src/nsVCardAddress.h</span>
<a href="#l173.2"></a><span id="l173.2" class="difflineplus">+++ b/mailnews/import/vcard/src/nsVCardAddress.h</span>
<a href="#l173.3"></a><span id="l173.3" class="difflineat">@@ -20,17 +20,17 @@ class nsILineInputStream;</span>
<a href="#l173.4"></a><span id="l173.4"> </span>
<a href="#l173.5"></a><span id="l173.5"> class nsVCardAddress {</span>
<a href="#l173.6"></a><span id="l173.6"> public:</span>
<a href="#l173.7"></a><span id="l173.7">   nsVCardAddress();</span>
<a href="#l173.8"></a><span id="l173.8">   virtual ~nsVCardAddress();</span>
<a href="#l173.9"></a><span id="l173.9"> </span>
<a href="#l173.10"></a><span id="l173.10">   nsresult ImportAddresses(</span>
<a href="#l173.11"></a><span id="l173.11">       bool *pAbort,</span>
<a href="#l173.12"></a><span id="l173.12" class="difflineminus">-      const PRUnichar *pName,</span>
<a href="#l173.13"></a><span id="l173.13" class="difflineplus">+      const char16_t *pName,</span>
<a href="#l173.14"></a><span id="l173.14">       nsIFile *pSrc,</span>
<a href="#l173.15"></a><span id="l173.15">       nsIAddrDatabase *pDb,</span>
<a href="#l173.16"></a><span id="l173.16">       nsString&amp; errors,</span>
<a href="#l173.17"></a><span id="l173.17">       uint32_t *pProgress);</span>
<a href="#l173.18"></a><span id="l173.18"> </span>
<a href="#l173.19"></a><span id="l173.19"> private:</span>
<a href="#l173.20"></a><span id="l173.20">   static nsresult ReadRecord(</span>
<a href="#l173.21"></a><span id="l173.21">       nsILineInputStream *aLineStream, nsCString &amp;aRecord, bool *aMore);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l174.1"></a><span id="l174.1" class="difflineminus">--- a/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l174.2"></a><span id="l174.2" class="difflineplus">+++ b/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l174.3"></a><span id="l174.3" class="difflineat">@@ -46,51 +46,51 @@ public:</span>
<a href="#l174.4"></a><span id="l174.4"> </span>
<a href="#l174.5"></a><span id="l174.5">   // nsIImportAddressBooks interface</span>
<a href="#l174.6"></a><span id="l174.6"> </span>
<a href="#l174.7"></a><span id="l174.7">   // TODO: support multiple vCard files in future - shouldn't be too hard,</span>
<a href="#l174.8"></a><span id="l174.8">   // since you just import each file in turn.</span>
<a href="#l174.9"></a><span id="l174.9">   NS_IMETHOD GetSupportsMultiple(bool *_retval)</span>
<a href="#l174.10"></a><span id="l174.10">   { *_retval = false; return NS_OK;}</span>
<a href="#l174.11"></a><span id="l174.11"> </span>
<a href="#l174.12"></a><span id="l174.12" class="difflineminus">-  NS_IMETHOD GetAutoFind(PRUnichar **description, bool *_retval);</span>
<a href="#l174.13"></a><span id="l174.13" class="difflineplus">+  NS_IMETHOD GetAutoFind(char16_t **description, bool *_retval);</span>
<a href="#l174.14"></a><span id="l174.14"> </span>
<a href="#l174.15"></a><span id="l174.15">   NS_IMETHOD GetNeedsFieldMap(nsIFile *location, bool *_retval)</span>
<a href="#l174.16"></a><span id="l174.16">   { *_retval = false; return NS_OK;}</span>
<a href="#l174.17"></a><span id="l174.17"> </span>
<a href="#l174.18"></a><span id="l174.18">   NS_IMETHOD GetDefaultLocation(</span>
<a href="#l174.19"></a><span id="l174.19">       nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l174.20"></a><span id="l174.20"> </span>
<a href="#l174.21"></a><span id="l174.21">   NS_IMETHOD FindAddressBooks(nsIFile *location, nsIArray **_retval);</span>
<a href="#l174.22"></a><span id="l174.22"> </span>
<a href="#l174.23"></a><span id="l174.23">   NS_IMETHOD InitFieldMap(nsIImportFieldMap *fieldMap)</span>
<a href="#l174.24"></a><span id="l174.24">   { return NS_ERROR_FAILURE;}</span>
<a href="#l174.25"></a><span id="l174.25"> </span>
<a href="#l174.26"></a><span id="l174.26">   NS_IMETHOD ImportAddressBook(nsIImportABDescriptor *source,</span>
<a href="#l174.27"></a><span id="l174.27">                                nsIAddrDatabase *destination,</span>
<a href="#l174.28"></a><span id="l174.28">                                nsIImportFieldMap *fieldMap,</span>
<a href="#l174.29"></a><span id="l174.29">                                nsISupports *aSupportService,</span>
<a href="#l174.30"></a><span id="l174.30" class="difflineminus">-                               PRUnichar **errorLog,</span>
<a href="#l174.31"></a><span id="l174.31" class="difflineminus">-                               PRUnichar **successLog,</span>
<a href="#l174.32"></a><span id="l174.32" class="difflineplus">+                               char16_t **errorLog,</span>
<a href="#l174.33"></a><span id="l174.33" class="difflineplus">+                               char16_t **successLog,</span>
<a href="#l174.34"></a><span id="l174.34">                                bool *fatalError);</span>
<a href="#l174.35"></a><span id="l174.35"> </span>
<a href="#l174.36"></a><span id="l174.36">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l174.37"></a><span id="l174.37"> </span>
<a href="#l174.38"></a><span id="l174.38" class="difflineminus">-  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, PRUnichar **pStr)</span>
<a href="#l174.39"></a><span id="l174.39" class="difflineplus">+  NS_IMETHOD GetSampleData(int32_t index, bool *pFound, char16_t **pStr)</span>
<a href="#l174.40"></a><span id="l174.40">   { return NS_ERROR_FAILURE;}</span>
<a href="#l174.41"></a><span id="l174.41"> </span>
<a href="#l174.42"></a><span id="l174.42">   NS_IMETHOD SetSampleLocation(nsIFile *)</span>
<a href="#l174.43"></a><span id="l174.43">   { return NS_ERROR_FAILURE; } </span>
<a href="#l174.44"></a><span id="l174.44"> </span>
<a href="#l174.45"></a><span id="l174.45"> private:</span>
<a href="#l174.46"></a><span id="l174.46">   static void ReportSuccess(</span>
<a href="#l174.47"></a><span id="l174.47">       nsString&amp; name, nsString *pStream, nsIStringBundle* pBundle);</span>
<a href="#l174.48"></a><span id="l174.48">   static void SetLogs(</span>
<a href="#l174.49"></a><span id="l174.49">       nsString&amp; success, nsString&amp; error,</span>
<a href="#l174.50"></a><span id="l174.50" class="difflineminus">-      PRUnichar **pError, PRUnichar **pSuccess);</span>
<a href="#l174.51"></a><span id="l174.51" class="difflineplus">+      char16_t **pError, char16_t **pSuccess);</span>
<a href="#l174.52"></a><span id="l174.52">   static void ReportError(</span>
<a href="#l174.53"></a><span id="l174.53">       const char *errorName, nsString&amp; name, nsString *pStream,</span>
<a href="#l174.54"></a><span id="l174.54">       nsIStringBundle* pBundle);</span>
<a href="#l174.55"></a><span id="l174.55"> </span>
<a href="#l174.56"></a><span id="l174.56"> private:</span>
<a href="#l174.57"></a><span id="l174.57">   nsVCardAddress m_vCard;</span>
<a href="#l174.58"></a><span id="l174.58">   nsCOMPtr&lt;nsIFile&gt; m_fileLoc;</span>
<a href="#l174.59"></a><span id="l174.59">   uint32_t m_bytesImported;</span>
<a href="#l174.60"></a><span id="l174.60" class="difflineat">@@ -110,25 +110,25 @@ nsVCardImport::nsVCardImport()</span>
<a href="#l174.61"></a><span id="l174.61"> </span>
<a href="#l174.62"></a><span id="l174.62"> nsVCardImport::~nsVCardImport()</span>
<a href="#l174.63"></a><span id="l174.63"> {</span>
<a href="#l174.64"></a><span id="l174.64">   IMPORT_LOG0(&quot;nsVCardImport Module Deleted\n&quot;);</span>
<a href="#l174.65"></a><span id="l174.65"> }</span>
<a href="#l174.66"></a><span id="l174.66"> </span>
<a href="#l174.67"></a><span id="l174.67"> NS_IMPL_ISUPPORTS1(nsVCardImport, nsIImportModule)</span>
<a href="#l174.68"></a><span id="l174.68"> </span>
<a href="#l174.69"></a><span id="l174.69" class="difflineminus">-NS_IMETHODIMP nsVCardImport::GetName(PRUnichar **name)</span>
<a href="#l174.70"></a><span id="l174.70" class="difflineplus">+NS_IMETHODIMP nsVCardImport::GetName(char16_t **name)</span>
<a href="#l174.71"></a><span id="l174.71"> {</span>
<a href="#l174.72"></a><span id="l174.72">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l174.73"></a><span id="l174.73">   *name = nsImportStringBundle::GetStringByName(</span>
<a href="#l174.74"></a><span id="l174.74">       &quot;vCardImportName&quot;, m_stringBundle);</span>
<a href="#l174.75"></a><span id="l174.75">   return NS_OK;</span>
<a href="#l174.76"></a><span id="l174.76"> }</span>
<a href="#l174.77"></a><span id="l174.77"> </span>
<a href="#l174.78"></a><span id="l174.78" class="difflineminus">-NS_IMETHODIMP nsVCardImport::GetDescription(PRUnichar **name)</span>
<a href="#l174.79"></a><span id="l174.79" class="difflineplus">+NS_IMETHODIMP nsVCardImport::GetDescription(char16_t **name)</span>
<a href="#l174.80"></a><span id="l174.80"> {</span>
<a href="#l174.81"></a><span id="l174.81">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l174.82"></a><span id="l174.82">   *name = nsImportStringBundle::GetStringByName(</span>
<a href="#l174.83"></a><span id="l174.83">       &quot;vCardImportDescription&quot;, m_stringBundle);</span>
<a href="#l174.84"></a><span id="l174.84">   return NS_OK;</span>
<a href="#l174.85"></a><span id="l174.85"> }</span>
<a href="#l174.86"></a><span id="l174.86"> </span>
<a href="#l174.87"></a><span id="l174.87"> NS_IMETHODIMP nsVCardImport::GetSupports(char **supports)</span>
<a href="#l174.88"></a><span id="l174.88" class="difflineat">@@ -193,17 +193,17 @@ ImportVCardAddressImpl::ImportVCardAddre</span>
<a href="#l174.89"></a><span id="l174.89"> </span>
<a href="#l174.90"></a><span id="l174.90"> ImportVCardAddressImpl::~ImportVCardAddressImpl()</span>
<a href="#l174.91"></a><span id="l174.91"> {</span>
<a href="#l174.92"></a><span id="l174.92"> }</span>
<a href="#l174.93"></a><span id="l174.93"> </span>
<a href="#l174.94"></a><span id="l174.94"> NS_IMPL_ISUPPORTS1(ImportVCardAddressImpl, nsIImportAddressBooks)</span>
<a href="#l174.95"></a><span id="l174.95"> </span>
<a href="#l174.96"></a><span id="l174.96"> NS_IMETHODIMP ImportVCardAddressImpl::GetAutoFind(</span>
<a href="#l174.97"></a><span id="l174.97" class="difflineminus">-    PRUnichar **addrDescription, bool *_retval)</span>
<a href="#l174.98"></a><span id="l174.98" class="difflineplus">+    char16_t **addrDescription, bool *_retval)</span>
<a href="#l174.99"></a><span id="l174.99"> {</span>
<a href="#l174.100"></a><span id="l174.100">   NS_ENSURE_ARG_POINTER(addrDescription);</span>
<a href="#l174.101"></a><span id="l174.101">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l174.102"></a><span id="l174.102"> </span>
<a href="#l174.103"></a><span id="l174.103">   nsString str;</span>
<a href="#l174.104"></a><span id="l174.104">   *_retval = false;</span>
<a href="#l174.105"></a><span id="l174.105"> </span>
<a href="#l174.106"></a><span id="l174.106">   if (!m_notProxyBundle)</span>
<a href="#l174.107"></a><span id="l174.107" class="difflineat">@@ -295,59 +295,59 @@ NS_IMETHODIMP ImportVCardAddressImpl::Fi</span>
<a href="#l174.108"></a><span id="l174.108"> </span>
<a href="#l174.109"></a><span id="l174.109"> void ImportVCardAddressImpl::ReportSuccess(</span>
<a href="#l174.110"></a><span id="l174.110">     nsString&amp; name, nsString *pStream, nsIStringBundle* pBundle)</span>
<a href="#l174.111"></a><span id="l174.111"> {</span>
<a href="#l174.112"></a><span id="l174.112">   if (!pStream)</span>
<a href="#l174.113"></a><span id="l174.113">     return;</span>
<a href="#l174.114"></a><span id="l174.114"> </span>
<a href="#l174.115"></a><span id="l174.115">   // load the success string</span>
<a href="#l174.116"></a><span id="l174.116" class="difflineminus">-  PRUnichar *pFmt = nsImportStringBundle::GetStringByName(</span>
<a href="#l174.117"></a><span id="l174.117" class="difflineplus">+  char16_t *pFmt = nsImportStringBundle::GetStringByName(</span>
<a href="#l174.118"></a><span id="l174.118">       &quot;vCardImportAddressSuccess&quot;, pBundle);</span>
<a href="#l174.119"></a><span id="l174.119"> </span>
<a href="#l174.120"></a><span id="l174.120" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l174.121"></a><span id="l174.121" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l174.122"></a><span id="l174.122">   pStream-&gt;Append(pText);</span>
<a href="#l174.123"></a><span id="l174.123">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l174.124"></a><span id="l174.124">   NS_Free(pFmt);</span>
<a href="#l174.125"></a><span id="l174.125" class="difflineminus">-  pStream-&gt;Append(PRUnichar('\n'));</span>
<a href="#l174.126"></a><span id="l174.126" class="difflineplus">+  pStream-&gt;Append(char16_t('\n'));</span>
<a href="#l174.127"></a><span id="l174.127"> }</span>
<a href="#l174.128"></a><span id="l174.128"> </span>
<a href="#l174.129"></a><span id="l174.129"> void ImportVCardAddressImpl::ReportError(</span>
<a href="#l174.130"></a><span id="l174.130">     const char *errorName, nsString&amp; name, nsString *pStream,</span>
<a href="#l174.131"></a><span id="l174.131">     nsIStringBundle* pBundle)</span>
<a href="#l174.132"></a><span id="l174.132"> {</span>
<a href="#l174.133"></a><span id="l174.133">   if (!pStream)</span>
<a href="#l174.134"></a><span id="l174.134">     return;</span>
<a href="#l174.135"></a><span id="l174.135"> </span>
<a href="#l174.136"></a><span id="l174.136">   // load the error string</span>
<a href="#l174.137"></a><span id="l174.137" class="difflineminus">-  PRUnichar *pFmt = nsImportStringBundle::GetStringByName(errorName, pBundle);</span>
<a href="#l174.138"></a><span id="l174.138" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l174.139"></a><span id="l174.139" class="difflineplus">+  char16_t *pFmt = nsImportStringBundle::GetStringByName(errorName, pBundle);</span>
<a href="#l174.140"></a><span id="l174.140" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l174.141"></a><span id="l174.141">   pStream-&gt;Append(pText);</span>
<a href="#l174.142"></a><span id="l174.142">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l174.143"></a><span id="l174.143">   NS_Free(pFmt);</span>
<a href="#l174.144"></a><span id="l174.144" class="difflineminus">-  pStream-&gt;Append(PRUnichar('\n'));</span>
<a href="#l174.145"></a><span id="l174.145" class="difflineplus">+  pStream-&gt;Append(char16_t('\n'));</span>
<a href="#l174.146"></a><span id="l174.146"> }</span>
<a href="#l174.147"></a><span id="l174.147"> </span>
<a href="#l174.148"></a><span id="l174.148"> void ImportVCardAddressImpl::SetLogs(</span>
<a href="#l174.149"></a><span id="l174.149">     nsString&amp; success, nsString&amp; error,</span>
<a href="#l174.150"></a><span id="l174.150" class="difflineminus">-    PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l174.151"></a><span id="l174.151" class="difflineplus">+    char16_t **pError, char16_t **pSuccess)</span>
<a href="#l174.152"></a><span id="l174.152"> { </span>
<a href="#l174.153"></a><span id="l174.153">   if (pError) </span>
<a href="#l174.154"></a><span id="l174.154">     *pError = ToNewUnicode(error);</span>
<a href="#l174.155"></a><span id="l174.155">   if (pSuccess) </span>
<a href="#l174.156"></a><span id="l174.156">     *pSuccess = ToNewUnicode(success);</span>
<a href="#l174.157"></a><span id="l174.157"> }</span>
<a href="#l174.158"></a><span id="l174.158"> </span>
<a href="#l174.159"></a><span id="l174.159"> NS_IMETHODIMP ImportVCardAddressImpl::ImportAddressBook(</span>
<a href="#l174.160"></a><span id="l174.160">     nsIImportABDescriptor *pSource,</span>
<a href="#l174.161"></a><span id="l174.161">     nsIAddrDatabase *pDestination,</span>
<a href="#l174.162"></a><span id="l174.162">     nsIImportFieldMap *fieldMap,</span>
<a href="#l174.163"></a><span id="l174.163">     nsISupports *aSupportService,</span>
<a href="#l174.164"></a><span id="l174.164" class="difflineminus">-    PRUnichar ** pErrorLog,</span>
<a href="#l174.165"></a><span id="l174.165" class="difflineminus">-    PRUnichar ** pSuccessLog,</span>
<a href="#l174.166"></a><span id="l174.166" class="difflineplus">+    char16_t ** pErrorLog,</span>
<a href="#l174.167"></a><span id="l174.167" class="difflineplus">+    char16_t ** pSuccessLog,</span>
<a href="#l174.168"></a><span id="l174.168">     bool * fatalError)</span>
<a href="#l174.169"></a><span id="l174.169"> {</span>
<a href="#l174.170"></a><span id="l174.170">   NS_ENSURE_ARG_POINTER(pSource);</span>
<a href="#l174.171"></a><span id="l174.171">   NS_ENSURE_ARG_POINTER(pDestination);</span>
<a href="#l174.172"></a><span id="l174.172">   NS_ENSURE_ARG_POINTER(fatalError);</span>
<a href="#l174.173"></a><span id="l174.173"> </span>
<a href="#l174.174"></a><span id="l174.174">   if (!m_notProxyBundle)</span>
<a href="#l174.175"></a><span id="l174.175">     return NS_ERROR_FAILURE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l175.1"></a><span id="l175.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMImport.cpp</span>
<a href="#l175.2"></a><span id="l175.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMImport.cpp</span>
<a href="#l175.3"></a><span id="l175.3" class="difflineat">@@ -59,29 +59,29 @@ public:</span>
<a href="#l175.4"></a><span id="l175.4">   /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l175.5"></a><span id="l175.5">   NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l175.6"></a><span id="l175.6"> </span>
<a href="#l175.7"></a><span id="l175.7">   /* nsIArray FindMailboxes (in nsIFile location); */</span>
<a href="#l175.8"></a><span id="l175.8">   NS_IMETHOD FindMailboxes(nsIFile *location, nsIArray **_retval);</span>
<a href="#l175.9"></a><span id="l175.9"> </span>
<a href="#l175.10"></a><span id="l175.10">   NS_IMETHOD ImportMailbox(nsIImportMailboxDescriptor *source,</span>
<a href="#l175.11"></a><span id="l175.11">                            nsIMsgFolder *dstFolder,</span>
<a href="#l175.12"></a><span id="l175.12" class="difflineminus">-                           PRUnichar **pErrorLog, PRUnichar **pSuccessLog,</span>
<a href="#l175.13"></a><span id="l175.13" class="difflineplus">+                           char16_t **pErrorLog, char16_t **pSuccessLog,</span>
<a href="#l175.14"></a><span id="l175.14">                            bool *fatalError);</span>
<a href="#l175.15"></a><span id="l175.15"> </span>
<a href="#l175.16"></a><span id="l175.16">   /* unsigned long GetImportProgress (); */</span>
<a href="#l175.17"></a><span id="l175.17">   NS_IMETHOD GetImportProgress(uint32_t *_retval);</span>
<a href="#l175.18"></a><span id="l175.18"> </span>
<a href="#l175.19"></a><span id="l175.19">   NS_IMETHOD TranslateFolderName(const nsAString &amp; aFolderName, nsAString &amp; _retval);</span>
<a href="#l175.20"></a><span id="l175.20"> </span>
<a href="#l175.21"></a><span id="l175.21"> public:</span>
<a href="#l175.22"></a><span id="l175.22">   static void ReportSuccess(nsString&amp; name, int32_t count, nsString *pStream);</span>
<a href="#l175.23"></a><span id="l175.23">   static void ReportError(int32_t errorNum, nsString&amp; name, nsString *pStream);</span>
<a href="#l175.24"></a><span id="l175.24">   static void AddLinebreak(nsString *pStream);</span>
<a href="#l175.25"></a><span id="l175.25" class="difflineminus">-  static void SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess);</span>
<a href="#l175.26"></a><span id="l175.26" class="difflineplus">+  static void SetLogs(nsString&amp; success, nsString&amp; error, char16_t **pError, char16_t **pSuccess);</span>
<a href="#l175.27"></a><span id="l175.27"> </span>
<a href="#l175.28"></a><span id="l175.28"> private:</span>
<a href="#l175.29"></a><span id="l175.29">   uint32_t m_bytesDone;</span>
<a href="#l175.30"></a><span id="l175.30"> };</span>
<a href="#l175.31"></a><span id="l175.31"> </span>
<a href="#l175.32"></a><span id="l175.32"> nsWMImport::nsWMImport()</span>
<a href="#l175.33"></a><span id="l175.33"> {</span>
<a href="#l175.34"></a><span id="l175.34">   // Init logging module.</span>
<a href="#l175.35"></a><span id="l175.35" class="difflineat">@@ -93,27 +93,27 @@ nsWMImport::nsWMImport()</span>
<a href="#l175.36"></a><span id="l175.36"> </span>
<a href="#l175.37"></a><span id="l175.37"> nsWMImport::~nsWMImport()</span>
<a href="#l175.38"></a><span id="l175.38"> {</span>
<a href="#l175.39"></a><span id="l175.39">   IMPORT_LOG0(&quot;nsWMImport Module Deleted\n&quot;);</span>
<a href="#l175.40"></a><span id="l175.40"> }</span>
<a href="#l175.41"></a><span id="l175.41"> </span>
<a href="#l175.42"></a><span id="l175.42"> NS_IMPL_ISUPPORTS1(nsWMImport, nsIImportModule)</span>
<a href="#l175.43"></a><span id="l175.43"> </span>
<a href="#l175.44"></a><span id="l175.44" class="difflineminus">-NS_IMETHODIMP nsWMImport::GetName(PRUnichar **name)</span>
<a href="#l175.45"></a><span id="l175.45" class="difflineplus">+NS_IMETHODIMP nsWMImport::GetName(char16_t **name)</span>
<a href="#l175.46"></a><span id="l175.46"> {</span>
<a href="#l175.47"></a><span id="l175.47">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l175.48"></a><span id="l175.48">   // nsString  title = &quot;Windows Live Mail&quot;;</span>
<a href="#l175.49"></a><span id="l175.49">   // *name = ToNewUnicode(title);</span>
<a href="#l175.50"></a><span id="l175.50">   *name = nsWMStringBundle::GetStringByID(WMIMPORT_NAME);</span>
<a href="#l175.51"></a><span id="l175.51"> </span>
<a href="#l175.52"></a><span id="l175.52">     return NS_OK;</span>
<a href="#l175.53"></a><span id="l175.53"> }</span>
<a href="#l175.54"></a><span id="l175.54"> </span>
<a href="#l175.55"></a><span id="l175.55" class="difflineminus">-NS_IMETHODIMP nsWMImport::GetDescription(PRUnichar **name)</span>
<a href="#l175.56"></a><span id="l175.56" class="difflineplus">+NS_IMETHODIMP nsWMImport::GetDescription(char16_t **name)</span>
<a href="#l175.57"></a><span id="l175.57"> {</span>
<a href="#l175.58"></a><span id="l175.58">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l175.59"></a><span id="l175.59"> </span>
<a href="#l175.60"></a><span id="l175.60">   // nsString  desc = &quot;Windows Live Mail mail and address books&quot;;</span>
<a href="#l175.61"></a><span id="l175.61">   // *name = ToNewUnicode(desc);</span>
<a href="#l175.62"></a><span id="l175.62">   *name = nsWMStringBundle::GetStringByID(WMIMPORT_DESCRIPTION);</span>
<a href="#l175.63"></a><span id="l175.63">   return NS_OK;</span>
<a href="#l175.64"></a><span id="l175.64"> }</span>
<a href="#l175.65"></a><span id="l175.65" class="difflineat">@@ -195,58 +195,58 @@ NS_IMETHODIMP ImportWMMailImpl::FindMail</span>
<a href="#l175.66"></a><span id="l175.66">                                               nsIArray **ppArray)</span>
<a href="#l175.67"></a><span id="l175.67"> {</span>
<a href="#l175.68"></a><span id="l175.68">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l175.69"></a><span id="l175.69"> }</span>
<a href="#l175.70"></a><span id="l175.70"> </span>
<a href="#l175.71"></a><span id="l175.71"> void ImportWMMailImpl::AddLinebreak(nsString *pStream)</span>
<a href="#l175.72"></a><span id="l175.72"> {</span>
<a href="#l175.73"></a><span id="l175.73">   if (pStream)</span>
<a href="#l175.74"></a><span id="l175.74" class="difflineminus">-    pStream-&gt;Append(PRUnichar('\n'));</span>
<a href="#l175.75"></a><span id="l175.75" class="difflineplus">+    pStream-&gt;Append(char16_t('\n'));</span>
<a href="#l175.76"></a><span id="l175.76"> }</span>
<a href="#l175.77"></a><span id="l175.77"> </span>
<a href="#l175.78"></a><span id="l175.78"> void ImportWMMailImpl::ReportSuccess(nsString&amp; name, int32_t count, nsString *pStream)</span>
<a href="#l175.79"></a><span id="l175.79"> {</span>
<a href="#l175.80"></a><span id="l175.80">   if (!pStream)</span>
<a href="#l175.81"></a><span id="l175.81">     return;</span>
<a href="#l175.82"></a><span id="l175.82">   // load the success string</span>
<a href="#l175.83"></a><span id="l175.83" class="difflineminus">-  PRUnichar *pFmt = nsWMStringBundle::GetStringByID(WMIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l175.84"></a><span id="l175.84" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get(), count);</span>
<a href="#l175.85"></a><span id="l175.85" class="difflineplus">+  char16_t *pFmt = nsWMStringBundle::GetStringByID(WMIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l175.86"></a><span id="l175.86" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get(), count);</span>
<a href="#l175.87"></a><span id="l175.87">   pStream-&gt;Append(pText);</span>
<a href="#l175.88"></a><span id="l175.88">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l175.89"></a><span id="l175.89">   nsWMStringBundle::FreeString(pFmt);</span>
<a href="#l175.90"></a><span id="l175.90">   AddLinebreak(pStream);</span>
<a href="#l175.91"></a><span id="l175.91"> }</span>
<a href="#l175.92"></a><span id="l175.92"> </span>
<a href="#l175.93"></a><span id="l175.93"> void ImportWMMailImpl::ReportError(int32_t errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l175.94"></a><span id="l175.94"> {</span>
<a href="#l175.95"></a><span id="l175.95">   if (!pStream)</span>
<a href="#l175.96"></a><span id="l175.96">     return;</span>
<a href="#l175.97"></a><span id="l175.97">   // load the error string</span>
<a href="#l175.98"></a><span id="l175.98" class="difflineminus">-  PRUnichar *pFmt = nsWMStringBundle::GetStringByID(errorNum);</span>
<a href="#l175.99"></a><span id="l175.99" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l175.100"></a><span id="l175.100" class="difflineplus">+  char16_t *pFmt = nsWMStringBundle::GetStringByID(errorNum);</span>
<a href="#l175.101"></a><span id="l175.101" class="difflineplus">+  char16_t *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l175.102"></a><span id="l175.102">   pStream-&gt;Append(pText);</span>
<a href="#l175.103"></a><span id="l175.103">   nsTextFormatter::smprintf_free(pText);</span>
<a href="#l175.104"></a><span id="l175.104">   nsWMStringBundle::FreeString(pFmt);</span>
<a href="#l175.105"></a><span id="l175.105">   AddLinebreak(pStream);</span>
<a href="#l175.106"></a><span id="l175.106"> }</span>
<a href="#l175.107"></a><span id="l175.107"> </span>
<a href="#l175.108"></a><span id="l175.108"> void ImportWMMailImpl::SetLogs(nsString&amp; success, nsString&amp; error,</span>
<a href="#l175.109"></a><span id="l175.109" class="difflineminus">-                               PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l175.110"></a><span id="l175.110" class="difflineplus">+                               char16_t **pError, char16_t **pSuccess)</span>
<a href="#l175.111"></a><span id="l175.111"> {</span>
<a href="#l175.112"></a><span id="l175.112">   if (pError)</span>
<a href="#l175.113"></a><span id="l175.113">     *pError = ToNewUnicode(error);</span>
<a href="#l175.114"></a><span id="l175.114">   if (pSuccess)</span>
<a href="#l175.115"></a><span id="l175.115">     *pSuccess = ToNewUnicode(success);</span>
<a href="#l175.116"></a><span id="l175.116"> }</span>
<a href="#l175.117"></a><span id="l175.117"> </span>
<a href="#l175.118"></a><span id="l175.118"> NS_IMETHODIMP ImportWMMailImpl::ImportMailbox(nsIImportMailboxDescriptor *pSource,</span>
<a href="#l175.119"></a><span id="l175.119">                                               nsIMsgFolder *pDstFolder,</span>
<a href="#l175.120"></a><span id="l175.120" class="difflineminus">-                                              PRUnichar **pErrorLog,</span>
<a href="#l175.121"></a><span id="l175.121" class="difflineminus">-                                              PRUnichar **pSuccessLog,</span>
<a href="#l175.122"></a><span id="l175.122" class="difflineplus">+                                              char16_t **pErrorLog,</span>
<a href="#l175.123"></a><span id="l175.123" class="difflineplus">+                                              char16_t **pSuccessLog,</span>
<a href="#l175.124"></a><span id="l175.124">                                               bool *fatalError)</span>
<a href="#l175.125"></a><span id="l175.125"> {</span>
<a href="#l175.126"></a><span id="l175.126">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l175.127"></a><span id="l175.127"> }</span>
<a href="#l175.128"></a><span id="l175.128"> </span>
<a href="#l175.129"></a><span id="l175.129"> NS_IMETHODIMP ImportWMMailImpl::GetImportProgress(uint32_t *pDoneSoFar)</span>
<a href="#l175.130"></a><span id="l175.130"> {</span>
<a href="#l175.131"></a><span id="l175.131">   return NS_ERROR_NOT_IMPLEMENTED;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l176.1"></a><span id="l176.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l176.2"></a><span id="l176.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l176.3"></a><span id="l176.3" class="difflineat">@@ -93,17 +93,17 @@ nsWMSettings::nsWMSettings()</span>
<a href="#l176.4"></a><span id="l176.4"> }</span>
<a href="#l176.5"></a><span id="l176.5"> </span>
<a href="#l176.6"></a><span id="l176.6"> nsWMSettings::~nsWMSettings()</span>
<a href="#l176.7"></a><span id="l176.7"> {</span>
<a href="#l176.8"></a><span id="l176.8"> }</span>
<a href="#l176.9"></a><span id="l176.9"> </span>
<a href="#l176.10"></a><span id="l176.10"> NS_IMPL_ISUPPORTS1(nsWMSettings, nsIImportSettings)</span>
<a href="#l176.11"></a><span id="l176.11"> </span>
<a href="#l176.12"></a><span id="l176.12" class="difflineminus">-NS_IMETHODIMP nsWMSettings::AutoLocate(PRUnichar **description,</span>
<a href="#l176.13"></a><span id="l176.13" class="difflineplus">+NS_IMETHODIMP nsWMSettings::AutoLocate(char16_t **description,</span>
<a href="#l176.14"></a><span id="l176.14">                                        nsIFile **location, bool *_retval)</span>
<a href="#l176.15"></a><span id="l176.15"> {</span>
<a href="#l176.16"></a><span id="l176.16">   NS_PRECONDITION(description != nullptr, &quot;null ptr&quot;);</span>
<a href="#l176.17"></a><span id="l176.17">   NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l176.18"></a><span id="l176.18">   if (!description || !_retval)</span>
<a href="#l176.19"></a><span id="l176.19">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l176.20"></a><span id="l176.20"> </span>
<a href="#l176.21"></a><span id="l176.21">   *description = nsWMStringBundle::GetStringByID(WMIMPORT_NAME);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l177.1"></a><span id="l177.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMStringBundle.cpp</span>
<a href="#l177.2"></a><span id="l177.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMStringBundle.cpp</span>
<a href="#l177.3"></a><span id="l177.3" class="difflineat">@@ -32,28 +32,28 @@ nsIStringBundle *nsWMStringBundle::GetSt</span>
<a href="#l177.4"></a><span id="l177.4"> </span>
<a href="#l177.5"></a><span id="l177.5">   m_pBundle = sBundle;</span>
<a href="#l177.6"></a><span id="l177.6"> </span>
<a href="#l177.7"></a><span id="l177.7">   return sBundle;</span>
<a href="#l177.8"></a><span id="l177.8"> }</span>
<a href="#l177.9"></a><span id="l177.9"> </span>
<a href="#l177.10"></a><span id="l177.10"> void nsWMStringBundle::GetStringByID(int32_t stringID, nsString&amp; result)</span>
<a href="#l177.11"></a><span id="l177.11"> {</span>
<a href="#l177.12"></a><span id="l177.12" class="difflineminus">-  PRUnichar *ptrv = GetStringByID(stringID);</span>
<a href="#l177.13"></a><span id="l177.13" class="difflineplus">+  char16_t *ptrv = GetStringByID(stringID);</span>
<a href="#l177.14"></a><span id="l177.14">   result = ptrv;</span>
<a href="#l177.15"></a><span id="l177.15">   FreeString(ptrv);</span>
<a href="#l177.16"></a><span id="l177.16"> }</span>
<a href="#l177.17"></a><span id="l177.17"> </span>
<a href="#l177.18"></a><span id="l177.18" class="difflineminus">-PRUnichar *nsWMStringBundle::GetStringByID(int32_t stringID)</span>
<a href="#l177.19"></a><span id="l177.19" class="difflineplus">+char16_t *nsWMStringBundle::GetStringByID(int32_t stringID)</span>
<a href="#l177.20"></a><span id="l177.20"> {</span>
<a href="#l177.21"></a><span id="l177.21">   if (!m_pBundle)</span>
<a href="#l177.22"></a><span id="l177.22">     m_pBundle = GetStringBundle();</span>
<a href="#l177.23"></a><span id="l177.23"> </span>
<a href="#l177.24"></a><span id="l177.24">   if (m_pBundle) {</span>
<a href="#l177.25"></a><span id="l177.25" class="difflineminus">-    PRUnichar *ptrv = nullptr;</span>
<a href="#l177.26"></a><span id="l177.26" class="difflineplus">+    char16_t *ptrv = nullptr;</span>
<a href="#l177.27"></a><span id="l177.27">     nsresult rv = m_pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l177.28"></a><span id="l177.28"> </span>
<a href="#l177.29"></a><span id="l177.29">     if (NS_SUCCEEDED(rv) &amp;&amp; ptrv)</span>
<a href="#l177.30"></a><span id="l177.30">       return ptrv;</span>
<a href="#l177.31"></a><span id="l177.31">   }</span>
<a href="#l177.32"></a><span id="l177.32"> </span>
<a href="#l177.33"></a><span id="l177.33">   nsString resultString;</span>
<a href="#l177.34"></a><span id="l177.34">   resultString.AppendLiteral(&quot;[StringID &quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l178.1"></a><span id="l178.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMStringBundle.h</span>
<a href="#l178.2"></a><span id="l178.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMStringBundle.h</span>
<a href="#l178.3"></a><span id="l178.3" class="difflineat">@@ -6,20 +6,20 @@</span>
<a href="#l178.4"></a><span id="l178.4"> #define _nsWMStringBundle_H__</span>
<a href="#l178.5"></a><span id="l178.5"> </span>
<a href="#l178.6"></a><span id="l178.6"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l178.7"></a><span id="l178.7"> </span>
<a href="#l178.8"></a><span id="l178.8"> class nsIStringBundle;</span>
<a href="#l178.9"></a><span id="l178.9"> </span>
<a href="#l178.10"></a><span id="l178.10"> class nsWMStringBundle {</span>
<a href="#l178.11"></a><span id="l178.11"> public:</span>
<a href="#l178.12"></a><span id="l178.12" class="difflineminus">-  static PRUnichar     *    GetStringByID(int32_t stringID);</span>
<a href="#l178.13"></a><span id="l178.13" class="difflineplus">+  static char16_t     *    GetStringByID(int32_t stringID);</span>
<a href="#l178.14"></a><span id="l178.14">   static void          GetStringByID(int32_t stringID, nsString&amp; result);</span>
<a href="#l178.15"></a><span id="l178.15">   static nsIStringBundle *  GetStringBundle(void); // don't release</span>
<a href="#l178.16"></a><span id="l178.16" class="difflineminus">-  static void          FreeString(PRUnichar *pStr) { NS_Free(pStr);}</span>
<a href="#l178.17"></a><span id="l178.17" class="difflineplus">+  static void          FreeString(char16_t *pStr) { NS_Free(pStr);}</span>
<a href="#l178.18"></a><span id="l178.18">   static void          Cleanup(void);</span>
<a href="#l178.19"></a><span id="l178.19"> </span>
<a href="#l178.20"></a><span id="l178.20"> private:</span>
<a href="#l178.21"></a><span id="l178.21">   static nsIStringBundle *  m_pBundle;</span>
<a href="#l178.22"></a><span id="l178.22"> };</span>
<a href="#l178.23"></a><span id="l178.23"> </span>
<a href="#l178.24"></a><span id="l178.24"> </span>
<a href="#l178.25"></a><span id="l178.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l179.1"></a><span id="l179.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l179.2"></a><span id="l179.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l179.3"></a><span id="l179.3" class="difflineat">@@ -829,17 +829,17 @@ nsresult nsMsgLocalMailFolder::ConfirmFo</span>
<a href="#l179.4"></a><span id="l179.4">       NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l179.5"></a><span id="l179.5">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l179.6"></a><span id="l179.6">       rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l179.7"></a><span id="l179.7">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l179.8"></a><span id="l179.8"> </span>
<a href="#l179.9"></a><span id="l179.9">       nsAutoString folderName;</span>
<a href="#l179.10"></a><span id="l179.10">       rv = aFolder-&gt;GetName(folderName);</span>
<a href="#l179.11"></a><span id="l179.11">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l179.12"></a><span id="l179.12" class="difflineminus">-      const PRUnichar *formatStrings[1] = { folderName.get() };</span>
<a href="#l179.13"></a><span id="l179.13" class="difflineplus">+      const char16_t *formatStrings[1] = { folderName.get() };</span>
<a href="#l179.14"></a><span id="l179.14"> </span>
<a href="#l179.15"></a><span id="l179.15">       nsAutoString deleteFolderDialogTitle;</span>
<a href="#l179.16"></a><span id="l179.16">       rv = bundle-&gt;GetStringFromName(</span>
<a href="#l179.17"></a><span id="l179.17">         MOZ_UTF16(&quot;pop3DeleteFolderDialogTitle&quot;),</span>
<a href="#l179.18"></a><span id="l179.18">         getter_Copies(deleteFolderDialogTitle));</span>
<a href="#l179.19"></a><span id="l179.19">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l179.20"></a><span id="l179.20"> </span>
<a href="#l179.21"></a><span id="l179.21">       nsAutoString deleteFolderButtonLabel;</span>
<a href="#l179.22"></a><span id="l179.22" class="difflineat">@@ -3152,17 +3152,17 @@ nsresult nsMsgLocalMailFolder::DisplayMo</span>
<a href="#l179.23"></a><span id="l179.23">       nsString folderName;</span>
<a href="#l179.24"></a><span id="l179.24">       GetName(folderName);</span>
<a href="#l179.25"></a><span id="l179.25">       nsAutoString numMsgSoFarString;</span>
<a href="#l179.26"></a><span id="l179.26">       numMsgSoFarString.AppendInt((mCopyState-&gt;m_copyingMultipleMessages) ? mCopyState-&gt;m_curCopyIndex : 1);</span>
<a href="#l179.27"></a><span id="l179.27"> </span>
<a href="#l179.28"></a><span id="l179.28">       nsAutoString totalMessagesString;</span>
<a href="#l179.29"></a><span id="l179.29">       totalMessagesString.AppendInt(mCopyState-&gt;m_totalMsgCount);</span>
<a href="#l179.30"></a><span id="l179.30">       nsString finalString;</span>
<a href="#l179.31"></a><span id="l179.31" class="difflineminus">-      const PRUnichar * stringArray[] = { numMsgSoFarString.get(), totalMessagesString.get(), folderName.get() };</span>
<a href="#l179.32"></a><span id="l179.32" class="difflineplus">+      const char16_t * stringArray[] = { numMsgSoFarString.get(), totalMessagesString.get(), folderName.get() };</span>
<a href="#l179.33"></a><span id="l179.33">       rv = mCopyState-&gt;m_stringBundle-&gt;FormatStringFromName(</span>
<a href="#l179.34"></a><span id="l179.34">         (mCopyState-&gt;m_isMove) ?</span>
<a href="#l179.35"></a><span id="l179.35">         MOZ_UTF16(&quot;movingMessagesStatus&quot;) :</span>
<a href="#l179.36"></a><span id="l179.36">         MOZ_UTF16(&quot;copyingMessagesStatus&quot;),</span>
<a href="#l179.37"></a><span id="l179.37">         stringArray, 3, getter_Copies(finalString));</span>
<a href="#l179.38"></a><span id="l179.38">       int64_t nowMS = PR_IntervalToMilliseconds(PR_IntervalNow());</span>
<a href="#l179.39"></a><span id="l179.39"> </span>
<a href="#l179.40"></a><span id="l179.40">       // only update status/progress every half second</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l180.1"></a><span id="l180.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l180.2"></a><span id="l180.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l180.3"></a><span id="l180.3" class="difflineat">@@ -465,17 +465,17 @@ NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnI</span>
<a href="#l180.4"></a><span id="l180.4">   return NS_OK;</span>
<a href="#l180.5"></a><span id="l180.5"> }</span>
<a href="#l180.6"></a><span id="l180.6"> </span>
<a href="#l180.7"></a><span id="l180.7"> NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l180.8"></a><span id="l180.8"> {</span>
<a href="#l180.9"></a><span id="l180.9">   return NS_OK;</span>
<a href="#l180.10"></a><span id="l180.10"> }</span>
<a href="#l180.11"></a><span id="l180.11"> </span>
<a href="#l180.12"></a><span id="l180.12" class="difflineminus">-NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const PRUnichar *oldValue, const PRUnichar *newValue)</span>
<a href="#l180.13"></a><span id="l180.13" class="difflineplus">+NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l180.14"></a><span id="l180.14"> {</span>
<a href="#l180.15"></a><span id="l180.15">   return NS_OK;</span>
<a href="#l180.16"></a><span id="l180.16"> }</span>
<a href="#l180.17"></a><span id="l180.17"> </span>
<a href="#l180.18"></a><span id="l180.18"> NS_IMETHODIMP nsLocalMoveCopyMsgTxn::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l180.19"></a><span id="l180.19"> {</span>
<a href="#l180.20"></a><span id="l180.20">   return NS_OK;</span>
<a href="#l180.21"></a><span id="l180.21"> }</span>
<a href="#l180.22"></a><span id="l180.22" class="difflineat">@@ -517,17 +517,17 @@ NS_IMETHODIMP nsLocalUndoFolderListener:</span>
<a href="#l180.23"></a><span id="l180.23">     return NS_OK;</span>
<a href="#l180.24"></a><span id="l180.24"> }</span>
<a href="#l180.25"></a><span id="l180.25"> </span>
<a href="#l180.26"></a><span id="l180.26"> NS_IMETHODIMP nsLocalUndoFolderListener::OnItemBoolPropertyChanged(nsIMsgFolder *item, nsIAtom *property, bool oldValue, bool newValue)</span>
<a href="#l180.27"></a><span id="l180.27"> {</span>
<a href="#l180.28"></a><span id="l180.28">     return NS_OK;</span>
<a href="#l180.29"></a><span id="l180.29"> }</span>
<a href="#l180.30"></a><span id="l180.30"> </span>
<a href="#l180.31"></a><span id="l180.31" class="difflineminus">-NS_IMETHODIMP nsLocalUndoFolderListener::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const PRUnichar *oldValue, const PRUnichar *newValue)</span>
<a href="#l180.32"></a><span id="l180.32" class="difflineplus">+NS_IMETHODIMP nsLocalUndoFolderListener::OnItemUnicharPropertyChanged(nsIMsgFolder *item, nsIAtom *property, const char16_t *oldValue, const char16_t *newValue)</span>
<a href="#l180.33"></a><span id="l180.33"> {</span>
<a href="#l180.34"></a><span id="l180.34">     return NS_OK;</span>
<a href="#l180.35"></a><span id="l180.35"> }</span>
<a href="#l180.36"></a><span id="l180.36"> </span>
<a href="#l180.37"></a><span id="l180.37"> NS_IMETHODIMP nsLocalUndoFolderListener::OnItemPropertyFlagChanged(nsIMsgDBHdr *item, nsIAtom *property, uint32_t oldFlag, uint32_t newFlag)</span>
<a href="#l180.38"></a><span id="l180.38"> {</span>
<a href="#l180.39"></a><span id="l180.39">     return NS_OK;</span>
<a href="#l180.40"></a><span id="l180.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l181.1"></a><span id="l181.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l181.2"></a><span id="l181.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l181.3"></a><span id="l181.3" class="difflineat">@@ -122,17 +122,17 @@ nsMovemailService::CheckForNewMail(nsIUr</span>
<a href="#l181.4"></a><span id="l181.4"> {</span>
<a href="#l181.5"></a><span id="l181.5">   nsresult rv = NS_OK;</span>
<a href="#l181.6"></a><span id="l181.6">   LOG((&quot;nsMovemailService::CheckForNewMail\n&quot;));</span>
<a href="#l181.7"></a><span id="l181.7">   return rv;</span>
<a href="#l181.8"></a><span id="l181.8"> }</span>
<a href="#l181.9"></a><span id="l181.9"> </span>
<a href="#l181.10"></a><span id="l181.10"> void</span>
<a href="#l181.11"></a><span id="l181.11"> nsMovemailService::Error(const char* errorCode,</span>
<a href="#l181.12"></a><span id="l181.12" class="difflineminus">-                         const PRUnichar **params,</span>
<a href="#l181.13"></a><span id="l181.13" class="difflineplus">+                         const char16_t **params,</span>
<a href="#l181.14"></a><span id="l181.14">                          uint32_t length)</span>
<a href="#l181.15"></a><span id="l181.15"> {</span>
<a href="#l181.16"></a><span id="l181.16">   if (!mMsgWindow) return;</span>
<a href="#l181.17"></a><span id="l181.17"> </span>
<a href="#l181.18"></a><span id="l181.18">   nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l181.19"></a><span id="l181.19">   nsresult rv = mMsgWindow-&gt;GetPromptDialog(getter_AddRefs(dialog));</span>
<a href="#l181.20"></a><span id="l181.20">   if (NS_FAILED(rv))</span>
<a href="#l181.21"></a><span id="l181.21">     return;</span>
<a href="#l181.22"></a><span id="l181.22" class="difflineat">@@ -166,29 +166,29 @@ SpoolLock::SpoolLock(nsACString *aSpoolN</span>
<a href="#l181.23"></a><span id="l181.23"> : mLocked(false),</span>
<a href="#l181.24"></a><span id="l181.24">   mSpoolName(*aSpoolName),</span>
<a href="#l181.25"></a><span id="l181.25">   mOwningService(&amp;aMovemail),</span>
<a href="#l181.26"></a><span id="l181.26">   mServer(aServer)</span>
<a href="#l181.27"></a><span id="l181.27"> {</span>
<a href="#l181.28"></a><span id="l181.28">   if (!ObtainSpoolLock(aSeconds)) {</span>
<a href="#l181.29"></a><span id="l181.29">     NS_ConvertUTF8toUTF16 lockFile(mSpoolName);</span>
<a href="#l181.30"></a><span id="l181.30">     lockFile.AppendLiteral(LOCK_SUFFIX);</span>
<a href="#l181.31"></a><span id="l181.31" class="difflineminus">-    const PRUnichar* params[] = { lockFile.get() };</span>
<a href="#l181.32"></a><span id="l181.32" class="difflineplus">+    const char16_t* params[] = { lockFile.get() };</span>
<a href="#l181.33"></a><span id="l181.33">     mOwningService-&gt;Error(&quot;movemailCantCreateLock&quot;, params, 1);</span>
<a href="#l181.34"></a><span id="l181.34">     return;</span>
<a href="#l181.35"></a><span id="l181.35">   }</span>
<a href="#l181.36"></a><span id="l181.36">   mServer-&gt;SetServerBusy(true);</span>
<a href="#l181.37"></a><span id="l181.37">   mLocked = true;</span>
<a href="#l181.38"></a><span id="l181.38"> }</span>
<a href="#l181.39"></a><span id="l181.39"> </span>
<a href="#l181.40"></a><span id="l181.40"> SpoolLock::~SpoolLock() {</span>
<a href="#l181.41"></a><span id="l181.41">   if (mLocked &amp;&amp; !YieldSpoolLock()) {</span>
<a href="#l181.42"></a><span id="l181.42">     NS_ConvertUTF8toUTF16 lockFile(mSpoolName);</span>
<a href="#l181.43"></a><span id="l181.43">     lockFile.AppendLiteral(LOCK_SUFFIX);</span>
<a href="#l181.44"></a><span id="l181.44" class="difflineminus">-    const PRUnichar* params[] = { lockFile.get() };</span>
<a href="#l181.45"></a><span id="l181.45" class="difflineplus">+    const char16_t* params[] = { lockFile.get() };</span>
<a href="#l181.46"></a><span id="l181.46">     mOwningService-&gt;Error(&quot;movemailCantDeleteLock&quot;, params, 1);</span>
<a href="#l181.47"></a><span id="l181.47">   }</span>
<a href="#l181.48"></a><span id="l181.48">   mServer-&gt;SetServerBusy(false);</span>
<a href="#l181.49"></a><span id="l181.49"> }</span>
<a href="#l181.50"></a><span id="l181.50"> </span>
<a href="#l181.51"></a><span id="l181.51"> bool</span>
<a href="#l181.52"></a><span id="l181.52"> SpoolLock::isLocked() {</span>
<a href="#l181.53"></a><span id="l181.53">   return mLocked;</span>
<a href="#l181.54"></a><span id="l181.54" class="difflineat">@@ -432,17 +432,17 @@ nsMovemailService::GetNewMail(nsIMsgWind</span>
<a href="#l181.55"></a><span id="l181.55">   if (NS_FAILED(rv) || spoolPath.IsEmpty())</span>
<a href="#l181.56"></a><span id="l181.56">     rv = LocateSpoolFile(spoolPath);</span>
<a href="#l181.57"></a><span id="l181.57">   if (NS_FAILED(rv) || spoolPath.IsEmpty()) {</span>
<a href="#l181.58"></a><span id="l181.58">     Error(&quot;movemailSpoolFileNotFound&quot;, nullptr, 0);</span>
<a href="#l181.59"></a><span id="l181.59">     return NS_ERROR_FAILURE;</span>
<a href="#l181.60"></a><span id="l181.60">   }</span>
<a href="#l181.61"></a><span id="l181.61"> </span>
<a href="#l181.62"></a><span id="l181.62">   NS_ConvertUTF8toUTF16 wideSpoolPath(spoolPath);</span>
<a href="#l181.63"></a><span id="l181.63" class="difflineminus">-  const PRUnichar* spoolPathString[] = { wideSpoolPath.get() };</span>
<a href="#l181.64"></a><span id="l181.64" class="difflineplus">+  const char16_t* spoolPathString[] = { wideSpoolPath.get() };</span>
<a href="#l181.65"></a><span id="l181.65"> </span>
<a href="#l181.66"></a><span id="l181.66">   // Create an input stream for the spool file</span>
<a href="#l181.67"></a><span id="l181.67">   nsCOMPtr&lt;nsIFile&gt; spoolFile;</span>
<a href="#l181.68"></a><span id="l181.68">   rv = NS_NewNativeLocalFile(spoolPath, true, getter_AddRefs(spoolFile));</span>
<a href="#l181.69"></a><span id="l181.69">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l181.70"></a><span id="l181.70">   nsCOMPtr&lt;nsIInputStream&gt; spoolInputStream;</span>
<a href="#l181.71"></a><span id="l181.71">   rv = NS_NewLocalFileInputStream(getter_AddRefs(spoolInputStream), spoolFile);</span>
<a href="#l181.72"></a><span id="l181.72">   if (NS_FAILED(rv)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l182.1"></a><span id="l182.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.h</span>
<a href="#l182.2"></a><span id="l182.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.h</span>
<a href="#l182.3"></a><span id="l182.3" class="difflineat">@@ -18,15 +18,15 @@ class nsMovemailService : public nsIMsgP</span>
<a href="#l182.4"></a><span id="l182.4"> public:</span>
<a href="#l182.5"></a><span id="l182.5">   nsMovemailService();</span>
<a href="#l182.6"></a><span id="l182.6">   virtual ~nsMovemailService();</span>
<a href="#l182.7"></a><span id="l182.7"> </span>
<a href="#l182.8"></a><span id="l182.8">   NS_DECL_ISUPPORTS</span>
<a href="#l182.9"></a><span id="l182.9">   NS_DECL_NSIMOVEMAILSERVICE</span>
<a href="#l182.10"></a><span id="l182.10">   NS_DECL_NSIMSGPROTOCOLINFO</span>
<a href="#l182.11"></a><span id="l182.11"> </span>
<a href="#l182.12"></a><span id="l182.12" class="difflineminus">-  void Error(const char* errorCode, const PRUnichar **params, uint32_t length);</span>
<a href="#l182.13"></a><span id="l182.13" class="difflineplus">+  void Error(const char* errorCode, const char16_t **params, uint32_t length);</span>
<a href="#l182.14"></a><span id="l182.14"> </span>
<a href="#l182.15"></a><span id="l182.15"> private:</span>
<a href="#l182.16"></a><span id="l182.16">   nsCOMPtr&lt;nsIMsgWindow&gt; mMsgWindow;</span>
<a href="#l182.17"></a><span id="l182.17"> };</span>
<a href="#l182.18"></a><span id="l182.18"> </span>
<a href="#l182.19"></a><span id="l182.19"> #endif /* nsMovemailService_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l183.1"></a><span id="l183.1" class="difflineminus">--- a/mailnews/local/src/nsMsgLocalStoreUtils.cpp</span>
<a href="#l183.2"></a><span id="l183.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgLocalStoreUtils.cpp</span>
<a href="#l183.3"></a><span id="l183.3" class="difflineat">@@ -21,17 +21,17 @@ nsMsgLocalStoreUtils::AddDirectorySepara</span>
<a href="#l183.4"></a><span id="l183.4">   path-&gt;GetLeafName(leafName);</span>
<a href="#l183.5"></a><span id="l183.5">   leafName.AppendLiteral(FOLDER_SUFFIX);</span>
<a href="#l183.6"></a><span id="l183.6">   return path-&gt;SetLeafName(leafName);</span>
<a href="#l183.7"></a><span id="l183.7"> }</span>
<a href="#l183.8"></a><span id="l183.8"> </span>
<a href="#l183.9"></a><span id="l183.9"> bool</span>
<a href="#l183.10"></a><span id="l183.10"> nsMsgLocalStoreUtils::nsShouldIgnoreFile(nsAString&amp; name)</span>
<a href="#l183.11"></a><span id="l183.11"> {</span>
<a href="#l183.12"></a><span id="l183.12" class="difflineminus">-  PRUnichar firstChar = name.First();</span>
<a href="#l183.13"></a><span id="l183.13" class="difflineplus">+  char16_t firstChar = name.First();</span>
<a href="#l183.14"></a><span id="l183.14">   if (firstChar == '.' || firstChar == '#' ||</span>
<a href="#l183.15"></a><span id="l183.15">       name.CharAt(name.Length() - 1) == '~')</span>
<a href="#l183.16"></a><span id="l183.16">     return true;</span>
<a href="#l183.17"></a><span id="l183.17"> </span>
<a href="#l183.18"></a><span id="l183.18">   if (name.LowerCaseEqualsLiteral(&quot;msgfilterrules.dat&quot;) ||</span>
<a href="#l183.19"></a><span id="l183.19">       name.LowerCaseEqualsLiteral(&quot;rules.dat&quot;) ||</span>
<a href="#l183.20"></a><span id="l183.20">       name.LowerCaseEqualsLiteral(&quot;filterlog.html&quot;) ||</span>
<a href="#l183.21"></a><span id="l183.21">       name.LowerCaseEqualsLiteral(&quot;junklog.html&quot;) ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l184.1"></a><span id="l184.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l184.2"></a><span id="l184.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l184.3"></a><span id="l184.3" class="difflineat">@@ -286,17 +286,17 @@ void nsMsgMailboxParser::UpdateStatusTex</span>
<a href="#l184.4"></a><span id="l184.4">       mozilla::services::GetStringBundleService();</span>
<a href="#l184.5"></a><span id="l184.5">     if (!bundleService)</span>
<a href="#l184.6"></a><span id="l184.6">       return;</span>
<a href="#l184.7"></a><span id="l184.7">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l184.8"></a><span id="l184.8">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l184.9"></a><span id="l184.9">     if (NS_FAILED(rv))</span>
<a href="#l184.10"></a><span id="l184.10">       return;</span>
<a href="#l184.11"></a><span id="l184.11">     nsString finalString;</span>
<a href="#l184.12"></a><span id="l184.12" class="difflineminus">-    const PRUnichar * stringArray[] = { m_folderName.get() };</span>
<a href="#l184.13"></a><span id="l184.13" class="difflineplus">+    const char16_t * stringArray[] = { m_folderName.get() };</span>
<a href="#l184.14"></a><span id="l184.14">     rv = bundle-&gt;FormatStringFromName(NS_ConvertASCIItoUTF16(stringName).get(),</span>
<a href="#l184.15"></a><span id="l184.15">                                       stringArray, 1, getter_Copies(finalString));</span>
<a href="#l184.16"></a><span id="l184.16">     m_statusFeedback-&gt;ShowStatusString(finalString);</span>
<a href="#l184.17"></a><span id="l184.17">   }</span>
<a href="#l184.18"></a><span id="l184.18"> }</span>
<a href="#l184.19"></a><span id="l184.19"> </span>
<a href="#l184.20"></a><span id="l184.20"> void nsMsgMailboxParser::UpdateProgressPercent ()</span>
<a href="#l184.21"></a><span id="l184.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l185.1"></a><span id="l185.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l185.2"></a><span id="l185.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l185.3"></a><span id="l185.3" class="difflineat">@@ -620,17 +620,17 @@ nsresult nsPop3Protocol::FormatCounterSt</span>
<a href="#l185.4"></a><span id="l185.4">   count1String.AppendInt(count1);</span>
<a href="#l185.5"></a><span id="l185.5"> </span>
<a href="#l185.6"></a><span id="l185.6">   nsAutoString count2String;</span>
<a href="#l185.7"></a><span id="l185.7">   count2String.AppendInt(count2);</span>
<a href="#l185.8"></a><span id="l185.8"> </span>
<a href="#l185.9"></a><span id="l185.9">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server(do_QueryInterface(m_pop3Server));</span>
<a href="#l185.10"></a><span id="l185.10">   nsString hostName;</span>
<a href="#l185.11"></a><span id="l185.11">   server-&gt;GetPrettyName(hostName);</span>
<a href="#l185.12"></a><span id="l185.12" class="difflineminus">-  const PRUnichar *formatStrings[] = {</span>
<a href="#l185.13"></a><span id="l185.13" class="difflineplus">+  const char16_t *formatStrings[] = {</span>
<a href="#l185.14"></a><span id="l185.14">     count1String.get(),</span>
<a href="#l185.15"></a><span id="l185.15">     count2String.get(),</span>
<a href="#l185.16"></a><span id="l185.16">     hostName.get()</span>
<a href="#l185.17"></a><span id="l185.17">   };</span>
<a href="#l185.18"></a><span id="l185.18"> </span>
<a href="#l185.19"></a><span id="l185.19">   return mLocalBundle-&gt;FormatStringFromName(stringName.get(),</span>
<a href="#l185.20"></a><span id="l185.20">                                             formatStrings, 3,</span>
<a href="#l185.21"></a><span id="l185.21">                                             getter_Copies(resultString));</span>
<a href="#l185.22"></a><span id="l185.22" class="difflineat">@@ -638,27 +638,27 @@ nsresult nsPop3Protocol::FormatCounterSt</span>
<a href="#l185.23"></a><span id="l185.23"> </span>
<a href="#l185.24"></a><span id="l185.24"> void nsPop3Protocol::UpdateStatus(const nsString &amp;aStatusName)</span>
<a href="#l185.25"></a><span id="l185.25"> {</span>
<a href="#l185.26"></a><span id="l185.26">   if (m_statusFeedback)</span>
<a href="#l185.27"></a><span id="l185.27">   {</span>
<a href="#l185.28"></a><span id="l185.28">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server(do_QueryInterface(m_pop3Server));</span>
<a href="#l185.29"></a><span id="l185.29">     nsString hostName;</span>
<a href="#l185.30"></a><span id="l185.30">     server-&gt;GetPrettyName(hostName);</span>
<a href="#l185.31"></a><span id="l185.31" class="difflineminus">-    const PRUnichar *formatStrings[] = {</span>
<a href="#l185.32"></a><span id="l185.32" class="difflineplus">+    const char16_t *formatStrings[] = {</span>
<a href="#l185.33"></a><span id="l185.33">       hostName.get()</span>
<a href="#l185.34"></a><span id="l185.34">     };</span>
<a href="#l185.35"></a><span id="l185.35">     nsString statusString;</span>
<a href="#l185.36"></a><span id="l185.36">     mLocalBundle-&gt;FormatStringFromName(aStatusName.get(), formatStrings, 1,</span>
<a href="#l185.37"></a><span id="l185.37">                                        getter_Copies(statusString));</span>
<a href="#l185.38"></a><span id="l185.38">     UpdateStatusWithString(statusString.get());</span>
<a href="#l185.39"></a><span id="l185.39">   }</span>
<a href="#l185.40"></a><span id="l185.40"> }</span>
<a href="#l185.41"></a><span id="l185.41"> </span>
<a href="#l185.42"></a><span id="l185.42" class="difflineminus">-void nsPop3Protocol::UpdateStatusWithString(const PRUnichar * aStatusString)</span>
<a href="#l185.43"></a><span id="l185.43" class="difflineplus">+void nsPop3Protocol::UpdateStatusWithString(const char16_t * aStatusString)</span>
<a href="#l185.44"></a><span id="l185.44"> {</span>
<a href="#l185.45"></a><span id="l185.45">     nsresult rv;</span>
<a href="#l185.46"></a><span id="l185.46">     if (mProgressEventSink)</span>
<a href="#l185.47"></a><span id="l185.47">     {</span>
<a href="#l185.48"></a><span id="l185.48">         rv = mProgressEventSink-&gt;OnStatus(this, m_channelContext, NS_OK, aStatusString);      // XXX i18n message</span>
<a href="#l185.49"></a><span id="l185.49">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;dropping error result&quot;);</span>
<a href="#l185.50"></a><span id="l185.50">     }</span>
<a href="#l185.51"></a><span id="l185.51"> }</span>
<a href="#l185.52"></a><span id="l185.52" class="difflineat">@@ -781,17 +781,17 @@ NS_IMETHODIMP nsPop3Protocol::OnPromptSt</span>
<a href="#l185.53"></a><span id="l185.53">   server-&gt;GetRealUsername(userName);</span>
<a href="#l185.54"></a><span id="l185.54"> </span>
<a href="#l185.55"></a><span id="l185.55">   nsCString hostName;</span>
<a href="#l185.56"></a><span id="l185.56">   server-&gt;GetRealHostName(hostName);</span>
<a href="#l185.57"></a><span id="l185.57"> </span>
<a href="#l185.58"></a><span id="l185.58">   nsString passwordPrompt;</span>
<a href="#l185.59"></a><span id="l185.59">   NS_ConvertUTF8toUTF16 userNameUTF16(userName);</span>
<a href="#l185.60"></a><span id="l185.60">   NS_ConvertUTF8toUTF16 hostNameUTF16(hostName);</span>
<a href="#l185.61"></a><span id="l185.61" class="difflineminus">-  const PRUnichar* passwordParams[] = { userNameUTF16.get(),</span>
<a href="#l185.62"></a><span id="l185.62" class="difflineplus">+  const char16_t* passwordParams[] = { userNameUTF16.get(),</span>
<a href="#l185.63"></a><span id="l185.63">                                         hostNameUTF16.get() };</span>
<a href="#l185.64"></a><span id="l185.64"> </span>
<a href="#l185.65"></a><span id="l185.65">   // if the last prompt got us a bad password then show a special dialog</span>
<a href="#l185.66"></a><span id="l185.66">   if (TestFlag(POP3_PASSWORD_FAILED))</span>
<a href="#l185.67"></a><span id="l185.67">   {</span>
<a href="#l185.68"></a><span id="l185.68">     // Biff case (no msgWindow) shouldn't cause prompts or passwords to get forgotten at all</span>
<a href="#l185.69"></a><span id="l185.69">     // TODO shouldn't we skip the new password prompt below as well for biff? Just exit here?</span>
<a href="#l185.70"></a><span id="l185.70">     if (msgWindow)</span>
<a href="#l185.71"></a><span id="l185.71" class="difflineat">@@ -1249,29 +1249,29 @@ nsPop3Protocol::WaitForResponse(nsIInput</span>
<a href="#l185.72"></a><span id="l185.72">   m_pop3ConData-&gt;pause_for_read = false; /* don't pause */</span>
<a href="#l185.73"></a><span id="l185.73"> </span>
<a href="#l185.74"></a><span id="l185.74">   PR_Free(line);</span>
<a href="#l185.75"></a><span id="l185.75">   return(1);  /* everything ok */</span>
<a href="#l185.76"></a><span id="l185.76"> }</span>
<a href="#l185.77"></a><span id="l185.77"> </span>
<a href="#l185.78"></a><span id="l185.78"> int32_t</span>
<a href="#l185.79"></a><span id="l185.79"> nsPop3Protocol::Error(const char* err_code,</span>
<a href="#l185.80"></a><span id="l185.80" class="difflineminus">-                      const PRUnichar **params,</span>
<a href="#l185.81"></a><span id="l185.81" class="difflineplus">+                      const char16_t **params,</span>
<a href="#l185.82"></a><span id="l185.82">                       uint32_t length)</span>
<a href="#l185.83"></a><span id="l185.83"> {</span>
<a href="#l185.84"></a><span id="l185.84">     </span>
<a href="#l185.85"></a><span id="l185.85">     PR_LOG(POP3LOGMODULE, PR_LOG_ALWAYS, (&quot;ERROR: %s&quot;, err_code));</span>
<a href="#l185.86"></a><span id="l185.86"> </span>
<a href="#l185.87"></a><span id="l185.87">     // the error code is just the resource name for the error string...</span>
<a href="#l185.88"></a><span id="l185.88">     // so print out that error message!</span>
<a href="#l185.89"></a><span id="l185.89">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l185.90"></a><span id="l185.90">     nsString accountName;</span>
<a href="#l185.91"></a><span id="l185.91">     nsresult rv = server-&gt;GetPrettyName(accountName);</span>
<a href="#l185.92"></a><span id="l185.92">     NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l185.93"></a><span id="l185.93" class="difflineminus">-    const PRUnichar *titleParams[] = { accountName.get() };</span>
<a href="#l185.94"></a><span id="l185.94" class="difflineplus">+    const char16_t *titleParams[] = { accountName.get() };</span>
<a href="#l185.95"></a><span id="l185.95">     nsString dialogTitle;</span>
<a href="#l185.96"></a><span id="l185.96">     mLocalBundle-&gt;FormatStringFromName(</span>
<a href="#l185.97"></a><span id="l185.97">       MOZ_UTF16(&quot;pop3ErrorDialogTitle&quot;),</span>
<a href="#l185.98"></a><span id="l185.98">       titleParams, 1, getter_Copies(dialogTitle));</span>
<a href="#l185.99"></a><span id="l185.99">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(m_url, &amp;rv);</span>
<a href="#l185.100"></a><span id="l185.100">     // we handle &quot;pop3TmpDownloadError&quot; earlier...</span>
<a href="#l185.101"></a><span id="l185.101">     if (strcmp(err_code, &quot;pop3TmpDownloadError&quot;) &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l185.102"></a><span id="l185.102">     {</span>
<a href="#l185.103"></a><span id="l185.103" class="difflineat">@@ -1300,17 +1300,17 @@ nsPop3Protocol::Error(const char* err_co</span>
<a href="#l185.104"></a><span id="l185.104">                 nsCString hostName;</span>
<a href="#l185.105"></a><span id="l185.105">                 // Fomat string with hostname.</span>
<a href="#l185.106"></a><span id="l185.106">                 if (server)</span>
<a href="#l185.107"></a><span id="l185.107">                   rv = server-&gt;GetRealHostName(hostName);</span>
<a href="#l185.108"></a><span id="l185.108">                 if (NS_SUCCEEDED(rv))</span>
<a href="#l185.109"></a><span id="l185.109">                 {</span>
<a href="#l185.110"></a><span id="l185.110">                   nsAutoString hostStr;</span>
<a href="#l185.111"></a><span id="l185.111">                   CopyASCIItoUTF16(hostName, hostStr);</span>
<a href="#l185.112"></a><span id="l185.112" class="difflineminus">-                  const PRUnichar *params[] = { hostStr.get() };</span>
<a href="#l185.113"></a><span id="l185.113" class="difflineplus">+                  const char16_t *params[] = { hostStr.get() };</span>
<a href="#l185.114"></a><span id="l185.114">                   mLocalBundle-&gt;FormatStringFromName(</span>
<a href="#l185.115"></a><span id="l185.115">                     MOZ_UTF16(&quot;pop3ServerSaid&quot;),</span>
<a href="#l185.116"></a><span id="l185.116">                     params, 1, getter_Copies(serverSaidPrefix));</span>
<a href="#l185.117"></a><span id="l185.117">                 }</span>
<a href="#l185.118"></a><span id="l185.118"> </span>
<a href="#l185.119"></a><span id="l185.119">                 nsAutoString message(alertString);</span>
<a href="#l185.120"></a><span id="l185.120">                 message.AppendLiteral(&quot; &quot;);</span>
<a href="#l185.121"></a><span id="l185.121">                 message.Append(serverSaidPrefix);</span>
<a href="#l185.122"></a><span id="l185.122" class="difflineat">@@ -1849,17 +1849,17 @@ int32_t nsPop3Protocol::NextAuthStep()</span>
<a href="#l185.123"></a><span id="l185.123">         // response code received shows that login failed not because of</span>
<a href="#l185.124"></a><span id="l185.124">         // wrong credential -&gt; stop login without retry or pw dialog, only alert</span>
<a href="#l185.125"></a><span id="l185.125">         // parameter list -&gt; user</span>
<a href="#l185.126"></a><span id="l185.126">         nsCString userName;</span>
<a href="#l185.127"></a><span id="l185.127">         nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l185.128"></a><span id="l185.128">         nsresult rv = server-&gt;GetRealUsername(userName);</span>
<a href="#l185.129"></a><span id="l185.129">         NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l185.130"></a><span id="l185.130">         NS_ConvertUTF8toUTF16 userNameUTF16(userName);</span>
<a href="#l185.131"></a><span id="l185.131" class="difflineminus">-        const PRUnichar* params[] = { userNameUTF16.get() };</span>
<a href="#l185.132"></a><span id="l185.132" class="difflineplus">+        const char16_t* params[] = { userNameUTF16.get() };</span>
<a href="#l185.133"></a><span id="l185.133">         if (TestFlag(POP3_STOPLOGIN))</span>
<a href="#l185.134"></a><span id="l185.134">         {</span>
<a href="#l185.135"></a><span id="l185.135">           if (m_password_already_sent)</span>
<a href="#l185.136"></a><span id="l185.136">             return Error(&quot;pop3PasswordFailed&quot;, params, 1);</span>
<a href="#l185.137"></a><span id="l185.137"> </span>
<a href="#l185.138"></a><span id="l185.138">           return Error(&quot;pop3UsernameFailure&quot;);</span>
<a href="#l185.139"></a><span id="l185.139">         }</span>
<a href="#l185.140"></a><span id="l185.140">         // response code received shows that server is certain about the</span>
<a href="#l185.141"></a><span id="l185.141" class="difflineat">@@ -2373,17 +2373,17 @@ nsPop3Protocol::GetStat()</span>
<a href="#l185.142"></a><span id="l185.142">       {</span>
<a href="#l185.143"></a><span id="l185.143">         m_nsIPop3Sink-&gt;AbortMailDelivery(this);</span>
<a href="#l185.144"></a><span id="l185.144">         if (rv == NS_MSG_FOLDER_BUSY) {</span>
<a href="#l185.145"></a><span id="l185.145">           nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l185.146"></a><span id="l185.146">           nsString accountName;</span>
<a href="#l185.147"></a><span id="l185.147">           rv = server-&gt;GetPrettyName(accountName);</span>
<a href="#l185.148"></a><span id="l185.148">           NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l185.149"></a><span id="l185.149"> </span>
<a href="#l185.150"></a><span id="l185.150" class="difflineminus">-          const PRUnichar *params[] = { accountName.get() };</span>
<a href="#l185.151"></a><span id="l185.151" class="difflineplus">+          const char16_t *params[] = { accountName.get() };</span>
<a href="#l185.152"></a><span id="l185.152">           return Error(&quot;pop3ServerBusy&quot;, params, 1);</span>
<a href="#l185.153"></a><span id="l185.153">         }</span>
<a href="#l185.154"></a><span id="l185.154"> </span>
<a href="#l185.155"></a><span id="l185.155">         return Error(&quot;pop3MessageWriteError&quot;);</span>
<a href="#l185.156"></a><span id="l185.156">       }</span>
<a href="#l185.157"></a><span id="l185.157"> </span>
<a href="#l185.158"></a><span id="l185.158">       if(!m_pop3ConData-&gt;msg_del_started)</span>
<a href="#l185.159"></a><span id="l185.159">         return Error(&quot;pop3MessageWriteError&quot;);</span>
<a href="#l185.160"></a><span id="l185.160" class="difflineat">@@ -2553,17 +2553,17 @@ int32_t nsPop3Protocol::HandleNoUidListA</span>
<a href="#l185.161"></a><span id="l185.161">     return 0;</span>
<a href="#l185.162"></a><span id="l185.162">   }</span>
<a href="#l185.163"></a><span id="l185.163">   m_pop3ConData-&gt;next_state = POP3_SEND_QUIT;</span>
<a href="#l185.164"></a><span id="l185.164">   nsCString hostName;</span>
<a href="#l185.165"></a><span id="l185.165">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l185.166"></a><span id="l185.166">   nsresult rv = server-&gt;GetRealHostName(hostName);</span>
<a href="#l185.167"></a><span id="l185.167">   NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l185.168"></a><span id="l185.168">   NS_ConvertASCIItoUTF16 hostNameUnicode(hostName);</span>
<a href="#l185.169"></a><span id="l185.169" class="difflineminus">-  const PRUnichar *params[] = { hostNameUnicode.get() };</span>
<a href="#l185.170"></a><span id="l185.170" class="difflineplus">+  const char16_t *params[] = { hostNameUnicode.get() };</span>
<a href="#l185.171"></a><span id="l185.171">   return Error(&quot;pop3ServerDoesNotSupportUidlEtc&quot;, params, 1);  </span>
<a href="#l185.172"></a><span id="l185.172"> }</span>
<a href="#l185.173"></a><span id="l185.173"> </span>
<a href="#l185.174"></a><span id="l185.174"> </span>
<a href="#l185.175"></a><span id="l185.175"> /* km</span>
<a href="#l185.176"></a><span id="l185.176">  *</span>
<a href="#l185.177"></a><span id="l185.177">  *  net_pop3_send_xtnd_xlst_msgid</span>
<a href="#l185.178"></a><span id="l185.178">  *</span>
<a href="#l185.179"></a><span id="l185.179" class="difflineat">@@ -3443,17 +3443,17 @@ nsPop3Protocol::TopResponse(nsIInputStre</span>
<a href="#l185.180"></a><span id="l185.180"> </span>
<a href="#l185.181"></a><span id="l185.181">     nsString statusTemplate;</span>
<a href="#l185.182"></a><span id="l185.182">     mLocalBundle-&gt;GetStringFromName(</span>
<a href="#l185.183"></a><span id="l185.183">       MOZ_UTF16(&quot;pop3ServerDoesNotSupportTopCommand&quot;),</span>
<a href="#l185.184"></a><span id="l185.184">       getter_Copies(statusTemplate));</span>
<a href="#l185.185"></a><span id="l185.185">     if (!statusTemplate.IsEmpty())</span>
<a href="#l185.186"></a><span id="l185.186">     {</span>
<a href="#l185.187"></a><span id="l185.187">       nsAutoCString hostName;</span>
<a href="#l185.188"></a><span id="l185.188" class="difflineminus">-      PRUnichar * statusString = nullptr;</span>
<a href="#l185.189"></a><span id="l185.189" class="difflineplus">+      char16_t * statusString = nullptr;</span>
<a href="#l185.190"></a><span id="l185.190">       m_url-&gt;GetHost(hostName);</span>
<a href="#l185.191"></a><span id="l185.191"> </span>
<a href="#l185.192"></a><span id="l185.192">       statusString = nsTextFormatter::smprintf(statusTemplate.get(), hostName.get());</span>
<a href="#l185.193"></a><span id="l185.193">       UpdateStatusWithString(statusString);</span>
<a href="#l185.194"></a><span id="l185.194">       nsTextFormatter::smprintf_free(statusString);</span>
<a href="#l185.195"></a><span id="l185.195">     }</span>
<a href="#l185.196"></a><span id="l185.196"> </span>
<a href="#l185.197"></a><span id="l185.197">     if (m_prefAuthMethods != POP3_HAS_AUTH_USER &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l186.1"></a><span id="l186.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l186.2"></a><span id="l186.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l186.3"></a><span id="l186.3" class="difflineat">@@ -291,17 +291,17 @@ private:</span>
<a href="#l186.4"></a><span id="l186.4">   nsCString m_GSSAPICache;</span>
<a href="#l186.5"></a><span id="l186.5"> </span>
<a href="#l186.6"></a><span id="l186.6">   // Used for asynchronous password prompts to store the password temporarily.</span>
<a href="#l186.7"></a><span id="l186.7">   nsCString m_passwordResult;</span>
<a href="#l186.8"></a><span id="l186.8"> </span>
<a href="#l186.9"></a><span id="l186.9">   // progress state information</span>
<a href="#l186.10"></a><span id="l186.10">   void UpdateProgressPercent (uint32_t totalDone, uint32_t total);</span>
<a href="#l186.11"></a><span id="l186.11">   void UpdateStatus(const nsString &amp;aStatusName);</span>
<a href="#l186.12"></a><span id="l186.12" class="difflineminus">-  void UpdateStatusWithString(const PRUnichar * aString);</span>
<a href="#l186.13"></a><span id="l186.13" class="difflineplus">+  void UpdateStatusWithString(const char16_t * aString);</span>
<a href="#l186.14"></a><span id="l186.14">   nsresult FormatCounterString(const nsString &amp;stringName,</span>
<a href="#l186.15"></a><span id="l186.15">                                uint32_t count1,</span>
<a href="#l186.16"></a><span id="l186.16">                                uint32_t count2,</span>
<a href="#l186.17"></a><span id="l186.17">                                nsString &amp;resultString);</span>
<a href="#l186.18"></a><span id="l186.18"> </span>
<a href="#l186.19"></a><span id="l186.19">   int32_t  m_bytesInMsgReceived;</span>
<a href="#l186.20"></a><span id="l186.20">   int32_t  m_totalFolderSize;</span>
<a href="#l186.21"></a><span id="l186.21">   int32_t  m_totalDownloadSize; /* Number of bytes we're going to</span>
<a href="#l186.22"></a><span id="l186.22" class="difflineat">@@ -350,17 +350,17 @@ private:</span>
<a href="#l186.23"></a><span id="l186.23"> </span>
<a href="#l186.24"></a><span id="l186.24">   //////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l186.25"></a><span id="l186.25">       // Begin Pop3 protocol state handlers</span>
<a href="#l186.26"></a><span id="l186.26">       //////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l186.27"></a><span id="l186.27">   int32_t WaitForStartOfConnectionResponse(nsIInputStream* inputStream,</span>
<a href="#l186.28"></a><span id="l186.28">                                            uint32_t length);</span>
<a href="#l186.29"></a><span id="l186.29">   int32_t WaitForResponse(nsIInputStream* inputStream,</span>
<a href="#l186.30"></a><span id="l186.30">                           uint32_t length);</span>
<a href="#l186.31"></a><span id="l186.31" class="difflineminus">-  int32_t Error(const char* err_code, const PRUnichar **params = nullptr,</span>
<a href="#l186.32"></a><span id="l186.32" class="difflineplus">+  int32_t Error(const char* err_code, const char16_t **params = nullptr,</span>
<a href="#l186.33"></a><span id="l186.33">                 uint32_t length = 0);</span>
<a href="#l186.34"></a><span id="l186.34">   int32_t SendAuth();</span>
<a href="#l186.35"></a><span id="l186.35">   int32_t AuthResponse(nsIInputStream* inputStream, uint32_t length);</span>
<a href="#l186.36"></a><span id="l186.36">   int32_t SendCapa();</span>
<a href="#l186.37"></a><span id="l186.37">   int32_t CapaResponse(nsIInputStream* inputStream, uint32_t length);</span>
<a href="#l186.38"></a><span id="l186.38">   int32_t SendTLSResponse();</span>
<a href="#l186.39"></a><span id="l186.39">   int32_t ProcessAuth();</span>
<a href="#l186.40"></a><span id="l186.40">   int32_t NextAuthStep();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l187.1"></a><span id="l187.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l187.2"></a><span id="l187.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l187.3"></a><span id="l187.3" class="difflineat">@@ -457,17 +457,17 @@ void nsPop3Service::AlertServerBusy(nsIM</span>
<a href="#l187.4"></a><span id="l187.4"> </span>
<a href="#l187.5"></a><span id="l187.5">   nsString accountName;</span>
<a href="#l187.6"></a><span id="l187.6">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l187.7"></a><span id="l187.7">   rv = url-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l187.8"></a><span id="l187.8">   NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l187.9"></a><span id="l187.9">   rv = server-&gt;GetPrettyName(accountName);</span>
<a href="#l187.10"></a><span id="l187.10">   NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l187.11"></a><span id="l187.11"> </span>
<a href="#l187.12"></a><span id="l187.12" class="difflineminus">-  const PRUnichar *params[] = { accountName.get() };</span>
<a href="#l187.13"></a><span id="l187.13" class="difflineplus">+  const char16_t *params[] = { accountName.get() };</span>
<a href="#l187.14"></a><span id="l187.14">   nsString alertString;</span>
<a href="#l187.15"></a><span id="l187.15">   nsString dialogTitle;</span>
<a href="#l187.16"></a><span id="l187.16">   bundle-&gt;FormatStringFromName(</span>
<a href="#l187.17"></a><span id="l187.17">     MOZ_UTF16(&quot;pop3ServerBusy&quot;),</span>
<a href="#l187.18"></a><span id="l187.18">     params, 1, getter_Copies(alertString));</span>
<a href="#l187.19"></a><span id="l187.19">   bundle-&gt;FormatStringFromName(</span>
<a href="#l187.20"></a><span id="l187.20">     MOZ_UTF16(&quot;pop3ErrorDialogTitle&quot;),</span>
<a href="#l187.21"></a><span id="l187.21">     params, 1, getter_Copies(dialogTitle));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l188.1"></a><span id="l188.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l188.2"></a><span id="l188.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l188.3"></a><span id="l188.3" class="difflineat">@@ -700,17 +700,17 @@ nsresult nsPop3Sink::HandleTempDownloadF</span>
<a href="#l188.4"></a><span id="l188.4">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l188.5"></a><span id="l188.5">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l188.6"></a><span id="l188.6">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l188.7"></a><span id="l188.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l188.8"></a><span id="l188.8">   nsString fromStr, subjectStr, confirmString;</span>
<a href="#l188.9"></a><span id="l188.9"> </span>
<a href="#l188.10"></a><span id="l188.10">   m_newMailParser-&gt;m_newMsgHdr-&gt;GetMime2DecodedSubject(subjectStr);</span>
<a href="#l188.11"></a><span id="l188.11">   m_newMailParser-&gt;m_newMsgHdr-&gt;GetMime2DecodedAuthor(fromStr);</span>
<a href="#l188.12"></a><span id="l188.12" class="difflineminus">-  const PRUnichar *params[] = { fromStr.get(), subjectStr.get() };</span>
<a href="#l188.13"></a><span id="l188.13" class="difflineplus">+  const char16_t *params[] = { fromStr.get(), subjectStr.get() };</span>
<a href="#l188.14"></a><span id="l188.14">   bundle-&gt;FormatStringFromName(</span>
<a href="#l188.15"></a><span id="l188.15">     MOZ_UTF16(&quot;pop3TmpDownloadError&quot;),</span>
<a href="#l188.16"></a><span id="l188.16">     params, 2, getter_Copies(confirmString));</span>
<a href="#l188.17"></a><span id="l188.17">   nsCOMPtr&lt;nsIDOMWindow&gt; parentWindow;</span>
<a href="#l188.18"></a><span id="l188.18">   nsCOMPtr&lt;nsIPromptService&gt; promptService = do_GetService(NS_PROMPTSERVICE_CONTRACTID);</span>
<a href="#l188.19"></a><span id="l188.19">   nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l188.20"></a><span id="l188.20">   if (msgWindow)</span>
<a href="#l188.21"></a><span id="l188.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l189.1"></a><span id="l189.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l189.2"></a><span id="l189.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l189.3"></a><span id="l189.3" class="difflineat">@@ -63,20 +63,20 @@ public:</span>
<a href="#l189.4"></a><span id="l189.4"> </span>
<a href="#l189.5"></a><span id="l189.5">     /* void OnStartSending (in string aMsgID, in uint32_t aMsgSize); */</span>
<a href="#l189.6"></a><span id="l189.6">     NS_IMETHOD OnStartSending(const char *aMsgID, uint32_t aMsgSize) { return NS_OK; }</span>
<a href="#l189.7"></a><span id="l189.7"> </span>
<a href="#l189.8"></a><span id="l189.8">     /* void OnProgress (in string aMsgID, in uint32_t aProgress, in uint32_t aProgressMax); */</span>
<a href="#l189.9"></a><span id="l189.9">     NS_IMETHOD OnProgress(const char *aMsgID, uint32_t aProgress, uint32_t aProgressMax) { return NS_OK;}</span>
<a href="#l189.10"></a><span id="l189.10"> </span>
<a href="#l189.11"></a><span id="l189.11">     /* void OnStatus (in string aMsgID, in wstring aMsg); */</span>
<a href="#l189.12"></a><span id="l189.12" class="difflineminus">-    NS_IMETHOD OnStatus(const char *aMsgID, const PRUnichar *aMsg) { return NS_OK;}</span>
<a href="#l189.13"></a><span id="l189.13" class="difflineplus">+    NS_IMETHOD OnStatus(const char *aMsgID, const char16_t *aMsg) { return NS_OK;}</span>
<a href="#l189.14"></a><span id="l189.14"> </span>
<a href="#l189.15"></a><span id="l189.15">     /* void OnStopSending (in string aMsgID, in nsresult aStatus, in wstring aMsg, in nsIFile returnFile); */</span>
<a href="#l189.16"></a><span id="l189.16" class="difflineminus">-    NS_IMETHOD OnStopSending(const char *aMsgID, nsresult aStatus, const PRUnichar *aMsg,</span>
<a href="#l189.17"></a><span id="l189.17" class="difflineplus">+    NS_IMETHOD OnStopSending(const char *aMsgID, nsresult aStatus, const char16_t *aMsg,</span>
<a href="#l189.18"></a><span id="l189.18">                            nsIFile *returnFile) {</span>
<a href="#l189.19"></a><span id="l189.19">         PR_CEnterMonitor(this);</span>
<a href="#l189.20"></a><span id="l189.20">         PR_CNotifyAll(this);</span>
<a href="#l189.21"></a><span id="l189.21">         m_done = true;</span>
<a href="#l189.22"></a><span id="l189.22">         PR_CExitMonitor(this);</span>
<a href="#l189.23"></a><span id="l189.23">         return NS_OK ;</span>
<a href="#l189.24"></a><span id="l189.24">     }</span>
<a href="#l189.25"></a><span id="l189.25"> </span>
<a href="#l189.26"></a><span id="l189.26" class="difflineat">@@ -119,18 +119,18 @@ nsresult nsMAPISendListener::CreateMAPIS</span>
<a href="#l189.27"></a><span id="l189.27"> bool nsMapiHook::isMapiService = false;</span>
<a href="#l189.28"></a><span id="l189.28"> </span>
<a href="#l189.29"></a><span id="l189.29"> void nsMapiHook::CleanUp()</span>
<a href="#l189.30"></a><span id="l189.30"> {</span>
<a href="#l189.31"></a><span id="l189.31">     // This routine will be fully implemented in future</span>
<a href="#l189.32"></a><span id="l189.32">     // to cleanup mapi related stuff inside mozilla code.</span>
<a href="#l189.33"></a><span id="l189.33"> }</span>
<a href="#l189.34"></a><span id="l189.34"> </span>
<a href="#l189.35"></a><span id="l189.35" class="difflineminus">-bool nsMapiHook::DisplayLoginDialog(bool aLogin, PRUnichar **aUsername,</span>
<a href="#l189.36"></a><span id="l189.36" class="difflineminus">-                      PRUnichar **aPassword)</span>
<a href="#l189.37"></a><span id="l189.37" class="difflineplus">+bool nsMapiHook::DisplayLoginDialog(bool aLogin, char16_t **aUsername,</span>
<a href="#l189.38"></a><span id="l189.38" class="difflineplus">+                      char16_t **aPassword)</span>
<a href="#l189.39"></a><span id="l189.39"> {</span>
<a href="#l189.40"></a><span id="l189.40">   nsresult rv;</span>
<a href="#l189.41"></a><span id="l189.41">   bool btnResult = false;</span>
<a href="#l189.42"></a><span id="l189.42"> </span>
<a href="#l189.43"></a><span id="l189.43">   nsCOMPtr&lt;nsIPromptService&gt; dlgService(do_GetService(NS_PROMPTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l189.44"></a><span id="l189.44">   if (NS_SUCCEEDED(rv) &amp;&amp; dlgService)</span>
<a href="#l189.45"></a><span id="l189.45">   {</span>
<a href="#l189.46"></a><span id="l189.46">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l189.47"></a><span id="l189.47" class="difflineat">@@ -149,19 +149,19 @@ bool nsMapiHook::DisplayLoginDialog(bool</span>
<a href="#l189.48"></a><span id="l189.48"> </span>
<a href="#l189.49"></a><span id="l189.49">     nsString brandName;</span>
<a href="#l189.50"></a><span id="l189.50">     rv = brandBundle-&gt;GetStringFromName(</span>
<a href="#l189.51"></a><span id="l189.51">                        MOZ_UTF16(&quot;brandFullName&quot;),</span>
<a href="#l189.52"></a><span id="l189.52">                        getter_Copies(brandName));</span>
<a href="#l189.53"></a><span id="l189.53">     if (NS_FAILED(rv)) return false;</span>
<a href="#l189.54"></a><span id="l189.54"> </span>
<a href="#l189.55"></a><span id="l189.55">     nsString loginTitle;</span>
<a href="#l189.56"></a><span id="l189.56" class="difflineminus">-    const PRUnichar *brandStrings[] = { brandName.get() };</span>
<a href="#l189.57"></a><span id="l189.57" class="difflineplus">+    const char16_t *brandStrings[] = { brandName.get() };</span>
<a href="#l189.58"></a><span id="l189.58">     NS_NAMED_LITERAL_STRING(loginTitlePropertyTag, &quot;loginTitle&quot;);</span>
<a href="#l189.59"></a><span id="l189.59" class="difflineminus">-    const PRUnichar *dTitlePropertyTag = loginTitlePropertyTag.get();</span>
<a href="#l189.60"></a><span id="l189.60" class="difflineplus">+    const char16_t *dTitlePropertyTag = loginTitlePropertyTag.get();</span>
<a href="#l189.61"></a><span id="l189.61">     rv = bundle-&gt;FormatStringFromName(dTitlePropertyTag, brandStrings, 1,</span>
<a href="#l189.62"></a><span id="l189.62">                                       getter_Copies(loginTitle));</span>
<a href="#l189.63"></a><span id="l189.63">     if (NS_FAILED(rv)) return false;</span>
<a href="#l189.64"></a><span id="l189.64"> </span>
<a href="#l189.65"></a><span id="l189.65">     if (aLogin)</span>
<a href="#l189.66"></a><span id="l189.66">     {</span>
<a href="#l189.67"></a><span id="l189.67">       nsString loginText;</span>
<a href="#l189.68"></a><span id="l189.68">       rv = bundle-&gt;GetStringFromName(MOZ_UTF16(&quot;loginTextwithName&quot;),</span>
<a href="#l189.69"></a><span id="l189.69" class="difflineat">@@ -172,20 +172,20 @@ bool nsMapiHook::DisplayLoginDialog(bool</span>
<a href="#l189.70"></a><span id="l189.70">       rv = dlgService-&gt;PromptUsernameAndPassword(nullptr, loginTitle.get(),</span>
<a href="#l189.71"></a><span id="l189.71">                                                  loginText.get(), aUsername, aPassword,</span>
<a href="#l189.72"></a><span id="l189.72">                                                  nullptr, &amp;dummyValue, &amp;btnResult);</span>
<a href="#l189.73"></a><span id="l189.73">     }</span>
<a href="#l189.74"></a><span id="l189.74">     else</span>
<a href="#l189.75"></a><span id="l189.75">     {</span>
<a href="#l189.76"></a><span id="l189.76">       //nsString loginString;</span>
<a href="#l189.77"></a><span id="l189.77">       nsString loginText;</span>
<a href="#l189.78"></a><span id="l189.78" class="difflineminus">-      const PRUnichar *userNameStrings[] = { *aUsername };</span>
<a href="#l189.79"></a><span id="l189.79" class="difflineplus">+      const char16_t *userNameStrings[] = { *aUsername };</span>
<a href="#l189.80"></a><span id="l189.80"> </span>
<a href="#l189.81"></a><span id="l189.81">       NS_NAMED_LITERAL_STRING(loginTextPropertyTag, &quot;loginText&quot;);</span>
<a href="#l189.82"></a><span id="l189.82" class="difflineminus">-      const PRUnichar *dpropertyTag = loginTextPropertyTag.get();</span>
<a href="#l189.83"></a><span id="l189.83" class="difflineplus">+      const char16_t *dpropertyTag = loginTextPropertyTag.get();</span>
<a href="#l189.84"></a><span id="l189.84">       rv = bundle-&gt;FormatStringFromName(dpropertyTag, userNameStrings, 1,</span>
<a href="#l189.85"></a><span id="l189.85">                                         getter_Copies(loginText));</span>
<a href="#l189.86"></a><span id="l189.86">       if (NS_FAILED(rv)) return false;</span>
<a href="#l189.87"></a><span id="l189.87"> </span>
<a href="#l189.88"></a><span id="l189.88">       bool dummyValue = false;</span>
<a href="#l189.89"></a><span id="l189.89">       rv = dlgService-&gt;PromptPassword(nullptr, loginTitle.get(), loginText.get(),</span>
<a href="#l189.90"></a><span id="l189.90">                                       aPassword, nullptr, &amp;dummyValue, &amp;btnResult);</span>
<a href="#l189.91"></a><span id="l189.91">     }</span>
<a href="#l189.92"></a><span id="l189.92" class="difflineat">@@ -295,17 +295,17 @@ nsresult nsMapiHook::BlindSendMail (unsi</span>
<a href="#l189.93"></a><span id="l189.93">   nsCOMPtr&lt;nsIAppShellService&gt; appService = do_GetService( &quot;@mozilla.org/appshell/appShellService;1&quot;, &amp;rv);</span>
<a href="#l189.94"></a><span id="l189.94">   if (NS_FAILED(rv)|| (!appService) ) return rv ;</span>
<a href="#l189.95"></a><span id="l189.95"> </span>
<a href="#l189.96"></a><span id="l189.96">   rv = appService-&gt;GetHiddenDOMWindow(getter_AddRefs(hiddenWindow));</span>
<a href="#l189.97"></a><span id="l189.97">   if ( NS_FAILED(rv) ) return rv ;</span>
<a href="#l189.98"></a><span id="l189.98">   // smtp password and Logged in used IdKey from MapiConfig (session obj)</span>
<a href="#l189.99"></a><span id="l189.99">   nsMAPIConfiguration * pMapiConfig = nsMAPIConfiguration::GetMAPIConfiguration() ;</span>
<a href="#l189.100"></a><span id="l189.100">   if (!pMapiConfig) return NS_ERROR_FAILURE ;  // get the singelton obj</span>
<a href="#l189.101"></a><span id="l189.101" class="difflineminus">-  PRUnichar * password = pMapiConfig-&gt;GetPassword(aSession) ;</span>
<a href="#l189.102"></a><span id="l189.102" class="difflineplus">+  char16_t * password = pMapiConfig-&gt;GetPassword(aSession) ;</span>
<a href="#l189.103"></a><span id="l189.103">   // password</span>
<a href="#l189.104"></a><span id="l189.104">   nsAutoCString smtpPassword;</span>
<a href="#l189.105"></a><span id="l189.105">   LossyCopyUTF16toASCII(password, smtpPassword);</span>
<a href="#l189.106"></a><span id="l189.106"> </span>
<a href="#l189.107"></a><span id="l189.107">   // Id key</span>
<a href="#l189.108"></a><span id="l189.108">   nsCString MsgIdKey;</span>
<a href="#l189.109"></a><span id="l189.109">   pMapiConfig-&gt;GetIdKey(aSession, MsgIdKey);</span>
<a href="#l189.110"></a><span id="l189.110"> </span>
<a href="#l189.111"></a><span id="l189.111" class="difflineat">@@ -497,17 +497,17 @@ nsresult nsMapiHook::HandleAttachments (</span>
<a href="#l189.112"></a><span id="l189.112">             if (aFiles[i].lpszFileName)</span>
<a href="#l189.113"></a><span id="l189.113">             {</span>
<a href="#l189.114"></a><span id="l189.114">               nsAutoString wholeFileName;</span>
<a href="#l189.115"></a><span id="l189.115">                 if (aIsUnicode)</span>
<a href="#l189.116"></a><span id="l189.116">                     wholeFileName.Assign(aFiles[i].lpszFileName);</span>
<a href="#l189.117"></a><span id="l189.117">                 else</span>
<a href="#l189.118"></a><span id="l189.118">                     ConvertToUnicode(nsMsgI18NFileSystemCharset(), (char *) aFiles[i].lpszFileName, wholeFileName);</span>
<a href="#l189.119"></a><span id="l189.119">                 // need to find the last '\' and find the leafname from that.</span>
<a href="#l189.120"></a><span id="l189.120" class="difflineminus">-                int32_t lastSlash = wholeFileName.RFindChar(PRUnichar('\\'));</span>
<a href="#l189.121"></a><span id="l189.121" class="difflineplus">+                int32_t lastSlash = wholeFileName.RFindChar(char16_t('\\'));</span>
<a href="#l189.122"></a><span id="l189.122">                 if (lastSlash != kNotFound)</span>
<a href="#l189.123"></a><span id="l189.123">                   leafName.Assign(Substring(wholeFileName, lastSlash + 1));</span>
<a href="#l189.124"></a><span id="l189.124">                 else</span>
<a href="#l189.125"></a><span id="l189.125">                   leafName.Assign(wholeFileName);</span>
<a href="#l189.126"></a><span id="l189.126">             }</span>
<a href="#l189.127"></a><span id="l189.127">             else</span>
<a href="#l189.128"></a><span id="l189.128">               pFile-&gt;GetLeafName (leafName);</span>
<a href="#l189.129"></a><span id="l189.129"> </span>
<a href="#l189.130"></a><span id="l189.130" class="difflineat">@@ -657,17 +657,17 @@ nsresult nsMapiHook::PopulateCompFieldsW</span>
<a href="#l189.131"></a><span id="l189.131">   printf (&quot;BCC : %S \n&quot;, Bcc.get() ) ;</span>
<a href="#l189.132"></a><span id="l189.132"> #endif</span>
<a href="#l189.133"></a><span id="l189.133"> </span>
<a href="#l189.134"></a><span id="l189.134">   return rv ;</span>
<a href="#l189.135"></a><span id="l189.135"> }</span>
<a href="#l189.136"></a><span id="l189.136"> </span>
<a href="#l189.137"></a><span id="l189.137"> // this is used to populate the docs as attachments in the Comp fields for Send Documents</span>
<a href="#l189.138"></a><span id="l189.138"> nsresult nsMapiHook::PopulateCompFieldsForSendDocs(nsIMsgCompFields * aCompFields, ULONG aFlags,</span>
<a href="#l189.139"></a><span id="l189.139" class="difflineminus">-                            PRUnichar * aDelimChar, PRUnichar * aFilePaths)</span>
<a href="#l189.140"></a><span id="l189.140" class="difflineplus">+                            char16_t * aDelimChar, char16_t * aFilePaths)</span>
<a href="#l189.141"></a><span id="l189.141"> {</span>
<a href="#l189.142"></a><span id="l189.142">   nsAutoString strDelimChars ;</span>
<a href="#l189.143"></a><span id="l189.143">   nsString strFilePaths;</span>
<a href="#l189.144"></a><span id="l189.144">   nsresult rv = NS_OK ;</span>
<a href="#l189.145"></a><span id="l189.145">   bool bExist ;</span>
<a href="#l189.146"></a><span id="l189.146"> </span>
<a href="#l189.147"></a><span id="l189.147">   if (aFlags &amp; MAPI_UNICODE)</span>
<a href="#l189.148"></a><span id="l189.148">   {</span>
<a href="#l189.149"></a><span id="l189.149" class="difflineat">@@ -702,17 +702,17 @@ nsresult nsMapiHook::PopulateCompFieldsF</span>
<a href="#l189.150"></a><span id="l189.150">   if (FilePathsLen)</span>
<a href="#l189.151"></a><span id="l189.151">   {</span>
<a href="#l189.152"></a><span id="l189.152">     nsAutoString Subject ;</span>
<a href="#l189.153"></a><span id="l189.153"> </span>
<a href="#l189.154"></a><span id="l189.154">     // multiple files to be sent, delim specified</span>
<a href="#l189.155"></a><span id="l189.155">     nsCOMPtr &lt;nsIFile&gt; pFile = do_CreateInstance (NS_LOCAL_FILE_CONTRACTID, &amp;rv) ;</span>
<a href="#l189.156"></a><span id="l189.156">     if (NS_FAILED(rv) || (!pFile) ) return rv ;</span>
<a href="#l189.157"></a><span id="l189.157"> </span>
<a href="#l189.158"></a><span id="l189.158" class="difflineminus">-    PRUnichar * newFilePaths = (PRUnichar *) strFilePaths.get() ;</span>
<a href="#l189.159"></a><span id="l189.159" class="difflineplus">+    char16_t * newFilePaths = (char16_t *) strFilePaths.get() ;</span>
<a href="#l189.160"></a><span id="l189.160">     while (offset != kNotFound)</span>
<a href="#l189.161"></a><span id="l189.161">     {</span>
<a href="#l189.162"></a><span id="l189.162">       //Temp Directory</span>
<a href="#l189.163"></a><span id="l189.163">       nsCOMPtr &lt;nsIFile&gt; pTempDir;</span>
<a href="#l189.164"></a><span id="l189.164">       NS_GetSpecialDirectory(NS_OS_TEMP_DIR, getter_AddRefs(pTempDir));</span>
<a href="#l189.165"></a><span id="l189.165"> </span>
<a href="#l189.166"></a><span id="l189.166">       // if not already existing, create another temp dir for mapi within Win temp dir</span>
<a href="#l189.167"></a><span id="l189.167">       // this is windows only so we can do &quot;\\&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l190.1"></a><span id="l190.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiHook.h</span>
<a href="#l190.2"></a><span id="l190.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiHook.h</span>
<a href="#l190.3"></a><span id="l190.3" class="difflineat">@@ -6,18 +6,18 @@</span>
<a href="#l190.4"></a><span id="l190.4"> #define MSG_MAPI_HOOK_H_</span>
<a href="#l190.5"></a><span id="l190.5"> </span>
<a href="#l190.6"></a><span id="l190.6"> #include &quot;prtypes.h&quot;</span>
<a href="#l190.7"></a><span id="l190.7"> </span>
<a href="#l190.8"></a><span id="l190.8"> class nsMapiHook</span>
<a href="#l190.9"></a><span id="l190.9"> {</span>
<a href="#l190.10"></a><span id="l190.10">     public :</span>
<a href="#l190.11"></a><span id="l190.11"> </span>
<a href="#l190.12"></a><span id="l190.12" class="difflineminus">-        static bool DisplayLoginDialog(bool aLogin, PRUnichar **aUsername, </span>
<a href="#l190.13"></a><span id="l190.13" class="difflineminus">-                        PRUnichar **aPassword);</span>
<a href="#l190.14"></a><span id="l190.14" class="difflineplus">+        static bool DisplayLoginDialog(bool aLogin, char16_t **aUsername, </span>
<a href="#l190.15"></a><span id="l190.15" class="difflineplus">+                        char16_t **aPassword);</span>
<a href="#l190.16"></a><span id="l190.16">         static bool VerifyUserName(const nsString&amp; aUsername, nsCString&amp; aIdKey);</span>
<a href="#l190.17"></a><span id="l190.17"> </span>
<a href="#l190.18"></a><span id="l190.18">         static bool IsBlindSendAllowed () ;</span>
<a href="#l190.19"></a><span id="l190.19">         static nsresult BlindSendMail (unsigned long aSession, nsIMsgCompFields * aCompFields) ;</span>
<a href="#l190.20"></a><span id="l190.20">         static nsresult ShowComposerWindow (unsigned long aSession, nsIMsgCompFields * aCompFields) ;</span>
<a href="#l190.21"></a><span id="l190.21">         static nsresult PopulateCompFields(lpnsMapiMessage aMessage, nsIMsgCompFields * aCompFields) ;</span>
<a href="#l190.22"></a><span id="l190.22">         static nsresult PopulateCompFieldsWithConversion(lpnsMapiMessage aMessage, </span>
<a href="#l190.23"></a><span id="l190.23">                                         nsIMsgCompFields * aCompFields) ;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l191.1"></a><span id="l191.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiMain.cpp</span>
<a href="#l191.2"></a><span id="l191.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiMain.cpp</span>
<a href="#l191.3"></a><span id="l191.3" class="difflineat">@@ -41,17 +41,17 @@ void nsMAPIConfiguration::OpenConfigurat</span>
<a href="#l191.4"></a><span id="l191.4">   // if it is decided to have configuration (registry)</span>
<a href="#l191.5"></a><span id="l191.5">   // parameter, this function can be used to set the</span>
<a href="#l191.6"></a><span id="l191.6">   // max sessions;</span>
<a href="#l191.7"></a><span id="l191.7"> </span>
<a href="#l191.8"></a><span id="l191.8">   return;</span>
<a href="#l191.9"></a><span id="l191.9"> }</span>
<a href="#l191.10"></a><span id="l191.10"> </span>
<a href="#l191.11"></a><span id="l191.11"> int16_t nsMAPIConfiguration::RegisterSession(uint32_t aHwnd,</span>
<a href="#l191.12"></a><span id="l191.12" class="difflineminus">-                const PRUnichar *aUserName, const PRUnichar *aPassword,</span>
<a href="#l191.13"></a><span id="l191.13" class="difflineplus">+                const char16_t *aUserName, const char16_t *aPassword,</span>
<a href="#l191.14"></a><span id="l191.14">                 bool aForceDownLoad, bool aNewSession,</span>
<a href="#l191.15"></a><span id="l191.15">                 uint32_t *aSession, const char *aIdKey)</span>
<a href="#l191.16"></a><span id="l191.16"> {</span>
<a href="#l191.17"></a><span id="l191.17">   int16_t nResult = 0;</span>
<a href="#l191.18"></a><span id="l191.18">   uint32_t n_SessionId = 0;</span>
<a href="#l191.19"></a><span id="l191.19"> </span>
<a href="#l191.20"></a><span id="l191.20">   PR_Lock(m_Lock);</span>
<a href="#l191.21"></a><span id="l191.21"> </span>
<a href="#l191.22"></a><span id="l191.22" class="difflineat">@@ -141,19 +141,19 @@ bool nsMAPIConfiguration::IsSessionValid</span>
<a href="#l191.23"></a><span id="l191.23">     return false;</span>
<a href="#l191.24"></a><span id="l191.24">   bool retValue = false;</span>
<a href="#l191.25"></a><span id="l191.25">   PR_Lock(m_Lock);</span>
<a href="#l191.26"></a><span id="l191.26">   retValue = m_SessionMap.Get(aSessionID, NULL);</span>
<a href="#l191.27"></a><span id="l191.27">   PR_Unlock(m_Lock);</span>
<a href="#l191.28"></a><span id="l191.28">   return retValue;</span>
<a href="#l191.29"></a><span id="l191.29"> }</span>
<a href="#l191.30"></a><span id="l191.30"> </span>
<a href="#l191.31"></a><span id="l191.31" class="difflineminus">-PRUnichar *nsMAPIConfiguration::GetPassword(uint32_t aSessionID)</span>
<a href="#l191.32"></a><span id="l191.32" class="difflineplus">+char16_t *nsMAPIConfiguration::GetPassword(uint32_t aSessionID)</span>
<a href="#l191.33"></a><span id="l191.33"> {</span>
<a href="#l191.34"></a><span id="l191.34" class="difflineminus">-  PRUnichar *pResult = nullptr;</span>
<a href="#l191.35"></a><span id="l191.35" class="difflineplus">+  char16_t *pResult = nullptr;</span>
<a href="#l191.36"></a><span id="l191.36"> </span>
<a href="#l191.37"></a><span id="l191.37">   PR_Lock(m_Lock);</span>
<a href="#l191.38"></a><span id="l191.38"> </span>
<a href="#l191.39"></a><span id="l191.39">   if (aSessionID != 0)</span>
<a href="#l191.40"></a><span id="l191.40">   {</span>
<a href="#l191.41"></a><span id="l191.41">     nsMAPISession *pTemp = nullptr;</span>
<a href="#l191.42"></a><span id="l191.42">     m_SessionMap.Get(aSessionID, &amp;pTemp);</span>
<a href="#l191.43"></a><span id="l191.43"> </span>
<a href="#l191.44"></a><span id="l191.44" class="difflineat">@@ -257,18 +257,18 @@ HRESULT nsMAPIConfiguration::GetMAPIErro</span>
<a href="#l191.45"></a><span id="l191.45">       hr = MAPI_E_FAILURE;</span>
<a href="#l191.46"></a><span id="l191.46">       break;</span>
<a href="#l191.47"></a><span id="l191.47">   }</span>
<a href="#l191.48"></a><span id="l191.48"> </span>
<a href="#l191.49"></a><span id="l191.49">   return hr;</span>
<a href="#l191.50"></a><span id="l191.50"> }</span>
<a href="#l191.51"></a><span id="l191.51"> </span>
<a href="#l191.52"></a><span id="l191.52"> </span>
<a href="#l191.53"></a><span id="l191.53" class="difflineminus">-nsMAPISession::nsMAPISession(uint32_t aHwnd, const PRUnichar *aUserName,</span>
<a href="#l191.54"></a><span id="l191.54" class="difflineminus">-                             const PRUnichar *aPassword, </span>
<a href="#l191.55"></a><span id="l191.55" class="difflineplus">+nsMAPISession::nsMAPISession(uint32_t aHwnd, const char16_t *aUserName,</span>
<a href="#l191.56"></a><span id="l191.56" class="difflineplus">+                             const char16_t *aPassword, </span>
<a href="#l191.57"></a><span id="l191.57">                              bool aForceDownLoad, const char *aKey)</span>
<a href="#l191.58"></a><span id="l191.58"> : m_bIsForcedDownLoad(aForceDownLoad),</span>
<a href="#l191.59"></a><span id="l191.59">   m_hAppHandle(aHwnd),</span>
<a href="#l191.60"></a><span id="l191.60">   m_nShared(1),</span>
<a href="#l191.61"></a><span id="l191.61">   m_pIdKey(aKey)</span>
<a href="#l191.62"></a><span id="l191.62"> {</span>
<a href="#l191.63"></a><span id="l191.63">   m_listContext = NULL;</span>
<a href="#l191.64"></a><span id="l191.64">   m_pProfileName.Assign(aUserName);</span>
<a href="#l191.65"></a><span id="l191.65" class="difflineat">@@ -289,18 +289,18 @@ uint32_t nsMAPISession::DecrementSession</span>
<a href="#l191.66"></a><span id="l191.66">   return --m_nShared;</span>
<a href="#l191.67"></a><span id="l191.67"> }</span>
<a href="#l191.68"></a><span id="l191.68"> </span>
<a href="#l191.69"></a><span id="l191.69"> uint32_t nsMAPISession::GetSessionCount()</span>
<a href="#l191.70"></a><span id="l191.70"> {</span>
<a href="#l191.71"></a><span id="l191.71">   return m_nShared;</span>
<a href="#l191.72"></a><span id="l191.72"> }</span>
<a href="#l191.73"></a><span id="l191.73"> </span>
<a href="#l191.74"></a><span id="l191.74" class="difflineminus">-PRUnichar *nsMAPISession::GetPassword()</span>
<a href="#l191.75"></a><span id="l191.75" class="difflineplus">+char16_t *nsMAPISession::GetPassword()</span>
<a href="#l191.76"></a><span id="l191.76"> {</span>
<a href="#l191.77"></a><span id="l191.77" class="difflineminus">-  return (PRUnichar *)m_pPassword.get();</span>
<a href="#l191.78"></a><span id="l191.78" class="difflineplus">+  return (char16_t *)m_pPassword.get();</span>
<a href="#l191.79"></a><span id="l191.79"> }</span>
<a href="#l191.80"></a><span id="l191.80"> </span>
<a href="#l191.81"></a><span id="l191.81"> void nsMAPISession::GetIdKey(nsCString&amp; aKey)</span>
<a href="#l191.82"></a><span id="l191.82"> {</span>
<a href="#l191.83"></a><span id="l191.83">   aKey = m_pIdKey;</span>
<a href="#l191.84"></a><span id="l191.84">   return;</span>
<a href="#l191.85"></a><span id="l191.85"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l192.1"></a><span id="l192.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiMain.h</span>
<a href="#l192.2"></a><span id="l192.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiMain.h</span>
<a href="#l192.3"></a><span id="l192.3" class="difflineat">@@ -33,22 +33,22 @@ private :</span>
<a href="#l192.4"></a><span id="l192.4"> </span>
<a href="#l192.5"></a><span id="l192.5">   nsDataHashtable&lt;nsStringHashKey, uint32_t&gt; m_ProfileMap;</span>
<a href="#l192.6"></a><span id="l192.6">   nsClassHashtable&lt;nsUint32HashKey, nsMAPISession&gt; m_SessionMap;</span>
<a href="#l192.7"></a><span id="l192.7">   nsMAPIConfiguration();</span>
<a href="#l192.8"></a><span id="l192.8"> </span>
<a href="#l192.9"></a><span id="l192.9"> public :</span>
<a href="#l192.10"></a><span id="l192.10">   static nsMAPIConfiguration *GetMAPIConfiguration();</span>
<a href="#l192.11"></a><span id="l192.11">   void OpenConfiguration();</span>
<a href="#l192.12"></a><span id="l192.12" class="difflineminus">-  int16_t RegisterSession(uint32_t aHwnd, const PRUnichar *aUserName, \</span>
<a href="#l192.13"></a><span id="l192.13" class="difflineminus">-                          const PRUnichar *aPassword, bool aForceDownLoad, \</span>
<a href="#l192.14"></a><span id="l192.14" class="difflineplus">+  int16_t RegisterSession(uint32_t aHwnd, const char16_t *aUserName, \</span>
<a href="#l192.15"></a><span id="l192.15" class="difflineplus">+                          const char16_t *aPassword, bool aForceDownLoad, \</span>
<a href="#l192.16"></a><span id="l192.16">                           bool aNewSession, uint32_t *aSession, const char *aIdKey);</span>
<a href="#l192.17"></a><span id="l192.17">   bool IsSessionValid(uint32_t aSessionID);</span>
<a href="#l192.18"></a><span id="l192.18">   bool UnRegisterSession(uint32_t aSessionID);</span>
<a href="#l192.19"></a><span id="l192.19" class="difflineminus">-  PRUnichar *GetPassword(uint32_t aSessionID);</span>
<a href="#l192.20"></a><span id="l192.20" class="difflineplus">+  char16_t *GetPassword(uint32_t aSessionID);</span>
<a href="#l192.21"></a><span id="l192.21">   void GetIdKey(uint32_t aSessionID, nsCString&amp; aKey);</span>
<a href="#l192.22"></a><span id="l192.22">   void *GetMapiListContext(uint32_t aSessionID);</span>
<a href="#l192.23"></a><span id="l192.23">   void SetMapiListContext(uint32_t aSessionID, void *mapiListContext);</span>
<a href="#l192.24"></a><span id="l192.24">   ~nsMAPIConfiguration();</span>
<a href="#l192.25"></a><span id="l192.25"> </span>
<a href="#l192.26"></a><span id="l192.26">   // a util func</span>
<a href="#l192.27"></a><span id="l192.27">   static HRESULT GetMAPIErrorFromNSError (nsresult res) ;</span>
<a href="#l192.28"></a><span id="l192.28"> };</span>
<a href="#l192.29"></a><span id="l192.29" class="difflineat">@@ -64,23 +64,23 @@ class nsMAPISession</span>
<a href="#l192.30"></a><span id="l192.30">     uint32_t m_nShared;</span>
<a href="#l192.31"></a><span id="l192.31">     nsCString m_pIdKey;</span>
<a href="#l192.32"></a><span id="l192.32">     nsString m_pProfileName;</span>
<a href="#l192.33"></a><span id="l192.33">     nsString m_pPassword;</span>
<a href="#l192.34"></a><span id="l192.34">     int32_t m_messageIndex;</span>
<a href="#l192.35"></a><span id="l192.35">     void   *m_listContext; // used by findNext</span>
<a href="#l192.36"></a><span id="l192.36"> </span>
<a href="#l192.37"></a><span id="l192.37">   public :</span>
<a href="#l192.38"></a><span id="l192.38" class="difflineminus">-    nsMAPISession(uint32_t aHwnd, const PRUnichar *aUserName, \</span>
<a href="#l192.39"></a><span id="l192.39" class="difflineminus">-                  const PRUnichar *aPassword, \</span>
<a href="#l192.40"></a><span id="l192.40" class="difflineplus">+    nsMAPISession(uint32_t aHwnd, const char16_t *aUserName, \</span>
<a href="#l192.41"></a><span id="l192.41" class="difflineplus">+                  const char16_t *aPassword, \</span>
<a href="#l192.42"></a><span id="l192.42">                   bool aForceDownLoad, const char *aKey);</span>
<a href="#l192.43"></a><span id="l192.43">     uint32_t IncrementSession();</span>
<a href="#l192.44"></a><span id="l192.44">     uint32_t DecrementSession();</span>
<a href="#l192.45"></a><span id="l192.45">     uint32_t GetSessionCount();</span>
<a href="#l192.46"></a><span id="l192.46" class="difflineminus">-    PRUnichar *nsMAPISession::GetPassword();</span>
<a href="#l192.47"></a><span id="l192.47" class="difflineplus">+    char16_t *nsMAPISession::GetPassword();</span>
<a href="#l192.48"></a><span id="l192.48">     void GetIdKey(nsCString&amp; aKey);</span>
<a href="#l192.49"></a><span id="l192.49">     ~nsMAPISession();</span>
<a href="#l192.50"></a><span id="l192.50">     // For enumerating Messages...</span>
<a href="#l192.51"></a><span id="l192.51">     void SetMapiListContext( void *listContext) { m_listContext = listContext; } </span>
<a href="#l192.52"></a><span id="l192.52">     void *GetMapiListContext( ) { return m_listContext; }</span>
<a href="#l192.53"></a><span id="l192.53"> };</span>
<a href="#l192.54"></a><span id="l192.54"> </span>
<a href="#l192.55"></a><span id="l192.55"> #endif    // MSG_MAPI_MAIN_H_</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l193.1"></a><span id="l193.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiSupport.cpp</span>
<a href="#l193.2"></a><span id="l193.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiSupport.cpp</span>
<a href="#l193.3"></a><span id="l193.3" class="difflineat">@@ -19,17 +19,17 @@</span>
<a href="#l193.4"></a><span id="l193.4"> </span>
<a href="#l193.5"></a><span id="l193.5"> /** Implementation of the nsIMapiSupport interface.</span>
<a href="#l193.6"></a><span id="l193.6">  *  Use standard implementation of nsISupports stuff.</span>
<a href="#l193.7"></a><span id="l193.7">  */</span>
<a href="#l193.8"></a><span id="l193.8"> </span>
<a href="#l193.9"></a><span id="l193.9"> NS_IMPL_ISUPPORTS2(nsMapiSupport, nsIMapiSupport, nsIObserver)</span>
<a href="#l193.10"></a><span id="l193.10"> </span>
<a href="#l193.11"></a><span id="l193.11"> NS_IMETHODIMP</span>
<a href="#l193.12"></a><span id="l193.12" class="difflineminus">-nsMapiSupport::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *aData)</span>
<a href="#l193.13"></a><span id="l193.13" class="difflineplus">+nsMapiSupport::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *aData)</span>
<a href="#l193.14"></a><span id="l193.14"> {</span>
<a href="#l193.15"></a><span id="l193.15">     nsresult rv = NS_OK ;</span>
<a href="#l193.16"></a><span id="l193.16"> </span>
<a href="#l193.17"></a><span id="l193.17">     if (!strcmp(aTopic, &quot;profile-after-change&quot;))</span>
<a href="#l193.18"></a><span id="l193.18">         return InitializeMAPISupport();</span>
<a href="#l193.19"></a><span id="l193.19"> </span>
<a href="#l193.20"></a><span id="l193.20">     if (!strcmp(aTopic, NS_XPCOM_SHUTDOWN_OBSERVER_ID))</span>
<a href="#l193.21"></a><span id="l193.21">         return ShutdownMAPISupport();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l194.1"></a><span id="l194.1" class="difflineminus">--- a/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</span>
<a href="#l194.2"></a><span id="l194.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</span>
<a href="#l194.3"></a><span id="l194.3" class="difflineat">@@ -75,17 +75,17 @@ static void PgpMimeGetNeedsAddonString(n</span>
<a href="#l194.4"></a><span id="l194.4">     return;</span>
<a href="#l194.5"></a><span id="l194.5"> </span>
<a href="#l194.6"></a><span id="l194.6">   nsCString url;</span>
<a href="#l194.7"></a><span id="l194.7">   if (NS_FAILED(prefs-&gt;GetCharPref(&quot;mail.pgpmime.addon_url&quot;,</span>
<a href="#l194.8"></a><span id="l194.8">                                    getter_Copies(url))))</span>
<a href="#l194.9"></a><span id="l194.9">     return;</span>
<a href="#l194.10"></a><span id="l194.10"> </span>
<a href="#l194.11"></a><span id="l194.11">   NS_ConvertUTF8toUTF16 url16(url);</span>
<a href="#l194.12"></a><span id="l194.12" class="difflineminus">-  const PRUnichar *formatStrings[] = { url16.get() };</span>
<a href="#l194.13"></a><span id="l194.13" class="difflineplus">+  const char16_t *formatStrings[] = { url16.get() };</span>
<a href="#l194.14"></a><span id="l194.14"> </span>
<a href="#l194.15"></a><span id="l194.15">   nsString result;</span>
<a href="#l194.16"></a><span id="l194.16">   rv = stringBundle-&gt;FormatStringFromName(MOZ_UTF16(PGPMIME_STR_NOT_SUPPORTED_ID),</span>
<a href="#l194.17"></a><span id="l194.17">                                           formatStrings, 1, getter_Copies(result));</span>
<a href="#l194.18"></a><span id="l194.18">   if (NS_FAILED(rv))</span>
<a href="#l194.19"></a><span id="l194.19">     return;</span>
<a href="#l194.20"></a><span id="l194.20">   aResult = NS_ConvertUTF16toUTF8(result);</span>
<a href="#l194.21"></a><span id="l194.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l195.1"></a><span id="l195.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l195.2"></a><span id="l195.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l195.3"></a><span id="l195.3" class="difflineat">@@ -737,17 +737,17 @@ nsMimeBaseEmitter::GenerateDateString(co</span>
<a href="#l195.4"></a><span id="l195.4">     if (NS_SUCCEEDED(rv))</span>
<a href="#l195.5"></a><span id="l195.5">     {</span>
<a href="#l195.6"></a><span id="l195.6">       if (displaySenderTimezone)</span>
<a href="#l195.7"></a><span id="l195.7">       {</span>
<a href="#l195.8"></a><span id="l195.8">         // offset of local time from UTC in minutes</span>
<a href="#l195.9"></a><span id="l195.9">         int32_t senderoffset = (explodedMsgTime.tm_params.tp_gmt_offset +</span>
<a href="#l195.10"></a><span id="l195.10">                                 explodedMsgTime.tm_params.tp_dst_offset) / 60;</span>
<a href="#l195.11"></a><span id="l195.11">         // append offset to date string</span>
<a href="#l195.12"></a><span id="l195.12" class="difflineminus">-        PRUnichar *tzstring =</span>
<a href="#l195.13"></a><span id="l195.13" class="difflineplus">+        char16_t *tzstring =</span>
<a href="#l195.14"></a><span id="l195.14">           nsTextFormatter::smprintf(MOZ_UTF16(&quot; %+05d&quot;),</span>
<a href="#l195.15"></a><span id="l195.15">                                     (senderoffset / 60 * 100) +</span>
<a href="#l195.16"></a><span id="l195.16">                                     (senderoffset % 60));</span>
<a href="#l195.17"></a><span id="l195.17">         formattedDateString.Append(tzstring);</span>
<a href="#l195.18"></a><span id="l195.18">         nsTextFormatter::smprintf_free(tzstring);</span>
<a href="#l195.19"></a><span id="l195.19">       }</span>
<a href="#l195.20"></a><span id="l195.20"> </span>
<a href="#l195.21"></a><span id="l195.21">       CopyUTF16toUTF8(formattedDateString, formattedDate);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l196.1"></a><span id="l196.1" class="difflineminus">--- a/mailnews/mime/src/MimeHeaderParser.cpp</span>
<a href="#l196.2"></a><span id="l196.2" class="difflineplus">+++ b/mailnews/mime/src/MimeHeaderParser.cpp</span>
<a href="#l196.3"></a><span id="l196.3" class="difflineat">@@ -65,19 +65,19 @@ void RemoveDuplicateAddresses(const nsAC</span>
<a href="#l196.4"></a><span id="l196.4"> /////////////////////////////////////////////</span>
<a href="#l196.5"></a><span id="l196.5"> // These are the core shim methods we need //</span>
<a href="#l196.6"></a><span id="l196.6"> /////////////////////////////////////////////</span>
<a href="#l196.7"></a><span id="l196.7"> </span>
<a href="#l196.8"></a><span id="l196.8"> ParsedHeader DecodedHeader(const nsAString &amp;aHeader)</span>
<a href="#l196.9"></a><span id="l196.9"> {</span>
<a href="#l196.10"></a><span id="l196.10">   ParsedHeader retval;</span>
<a href="#l196.11"></a><span id="l196.11">   nsCOMPtr&lt;nsIMsgHeaderParser&gt; headerParser(services::GetHeaderParser());</span>
<a href="#l196.12"></a><span id="l196.12" class="difflineminus">-  PRUnichar **rawNames = nullptr;</span>
<a href="#l196.13"></a><span id="l196.13" class="difflineminus">-  PRUnichar **rawEmails = nullptr;</span>
<a href="#l196.14"></a><span id="l196.14" class="difflineminus">-  PRUnichar **rawFull = nullptr;</span>
<a href="#l196.15"></a><span id="l196.15" class="difflineplus">+  char16_t **rawNames = nullptr;</span>
<a href="#l196.16"></a><span id="l196.16" class="difflineplus">+  char16_t **rawEmails = nullptr;</span>
<a href="#l196.17"></a><span id="l196.17" class="difflineplus">+  char16_t **rawFull = nullptr;</span>
<a href="#l196.18"></a><span id="l196.18"> </span>
<a href="#l196.19"></a><span id="l196.19">   headerParser-&gt;ParseHeadersWithArray(PromiseFlatString(aHeader).get(),</span>
<a href="#l196.20"></a><span id="l196.20">     &amp;rawEmails, &amp;rawNames, &amp;rawFull, &amp;retval.mCount);</span>
<a href="#l196.21"></a><span id="l196.21"> </span>
<a href="#l196.22"></a><span id="l196.22">   retval.mAddresses = static_cast&lt;msgIAddressObject**&gt;(NS_Alloc(</span>
<a href="#l196.23"></a><span id="l196.23">     sizeof(msgIAddressObject*) * retval.mCount));</span>
<a href="#l196.24"></a><span id="l196.24"> </span>
<a href="#l196.25"></a><span id="l196.25">   for (uint32_t i = 0; i &lt; retval.mCount; i++)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l197.1"></a><span id="l197.1" class="difflineminus">--- a/mailnews/mime/src/comi18n.cpp</span>
<a href="#l197.2"></a><span id="l197.2" class="difflineplus">+++ b/mailnews/mime/src/comi18n.cpp</span>
<a href="#l197.3"></a><span id="l197.3" class="difflineat">@@ -157,17 +157,17 @@ static unsigned char * utf8_nextchar(uns</span>
<a href="#l197.4"></a><span id="l197.4"> #undef IS_UTF8_SUBBYTE</span>
<a href="#l197.5"></a><span id="l197.5"> </span>
<a href="#l197.6"></a><span id="l197.6"> /* -------------- */</span>
<a href="#l197.7"></a><span id="l197.7"> </span>
<a href="#l197.8"></a><span id="l197.8"> static</span>
<a href="#l197.9"></a><span id="l197.9"> int32_t generate_encodedwords(char *pUTF8, const char *charset, char method, char *output, int32_t outlen, int32_t output_carryoverlen, int32_t foldlen, bool foldingonly)</span>
<a href="#l197.10"></a><span id="l197.10"> {</span>
<a href="#l197.11"></a><span id="l197.11">   nsCOMPtr &lt;nsISaveAsCharset&gt; conv;</span>
<a href="#l197.12"></a><span id="l197.12" class="difflineminus">-  PRUnichar *_pUCS2 = nullptr, *pUCS2 = nullptr, *pUCS2Head = nullptr, cUCS2Tmp = 0;</span>
<a href="#l197.13"></a><span id="l197.13" class="difflineplus">+  char16_t *_pUCS2 = nullptr, *pUCS2 = nullptr, *pUCS2Head = nullptr, cUCS2Tmp = 0;</span>
<a href="#l197.14"></a><span id="l197.14">   char  *ibuf, *o = output;</span>
<a href="#l197.15"></a><span id="l197.15">   char  encodedword_head[nsIMimeConverter::MAX_CHARSET_NAME_LENGTH+4+1];</span>
<a href="#l197.16"></a><span id="l197.16">   nsAutoCString _charset;</span>
<a href="#l197.17"></a><span id="l197.17">   char  *pUTF8Head = nullptr, cUTF8Tmp = 0;</span>
<a href="#l197.18"></a><span id="l197.18">   int32_t   olen = 0, obufsize = outlen, offset, linelen = output_carryoverlen, convlen = 0;</span>
<a href="#l197.19"></a><span id="l197.19">   int32_t   encodedword_headlen = 0, encodedword_taillen = foldingonly ? 0 : 2; // &quot;?=&quot;</span>
<a href="#l197.20"></a><span id="l197.20">   nsresult rv;</span>
<a href="#l197.21"></a><span id="l197.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l198.1"></a><span id="l198.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l198.2"></a><span id="l198.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l198.3"></a><span id="l198.3" class="difflineat">@@ -787,29 +787,29 @@ int ConvertUsingEncoderAndDecoder(const </span>
<a href="#l198.4"></a><span id="l198.4">                                   nsIUnicodeEncoder *encoder, nsIUnicodeDecoder *decoder,</span>
<a href="#l198.5"></a><span id="l198.5">                                   char **pConvertedString, int32_t *outLength)</span>
<a href="#l198.6"></a><span id="l198.6"> {</span>
<a href="#l198.7"></a><span id="l198.7">   // buffer size 144 =</span>
<a href="#l198.8"></a><span id="l198.8">   // 72 (default line len for compose)</span>
<a href="#l198.9"></a><span id="l198.9">   // times 2 (converted byte len might be larger)</span>
<a href="#l198.10"></a><span id="l198.10">   const int klocalbufsize = 144;</span>
<a href="#l198.11"></a><span id="l198.11">   // do the conversion</span>
<a href="#l198.12"></a><span id="l198.12" class="difflineminus">-  PRUnichar *unichars;</span>
<a href="#l198.13"></a><span id="l198.13" class="difflineplus">+  char16_t *unichars;</span>
<a href="#l198.14"></a><span id="l198.14">   int32_t unicharLength;</span>
<a href="#l198.15"></a><span id="l198.15">   int32_t srcLen = inLength;</span>
<a href="#l198.16"></a><span id="l198.16">   int32_t dstLength = 0;</span>
<a href="#l198.17"></a><span id="l198.17">   char *dstPtr;</span>
<a href="#l198.18"></a><span id="l198.18">   nsresult rv;</span>
<a href="#l198.19"></a><span id="l198.19"> </span>
<a href="#l198.20"></a><span id="l198.20">   // use this local buffer if possible</span>
<a href="#l198.21"></a><span id="l198.21" class="difflineminus">-  PRUnichar localbuf[klocalbufsize+1];</span>
<a href="#l198.22"></a><span id="l198.22" class="difflineplus">+  char16_t localbuf[klocalbufsize+1];</span>
<a href="#l198.23"></a><span id="l198.23">   if (inLength &gt; klocalbufsize) {</span>
<a href="#l198.24"></a><span id="l198.24">     rv = decoder-&gt;GetMaxLength(stringToUse, srcLen, &amp;unicharLength);</span>
<a href="#l198.25"></a><span id="l198.25">     // allocate temporary buffer to hold unicode string</span>
<a href="#l198.26"></a><span id="l198.26" class="difflineminus">-    unichars = new PRUnichar[unicharLength];</span>
<a href="#l198.27"></a><span id="l198.27" class="difflineplus">+    unichars = new char16_t[unicharLength];</span>
<a href="#l198.28"></a><span id="l198.28">   }</span>
<a href="#l198.29"></a><span id="l198.29">   else {</span>
<a href="#l198.30"></a><span id="l198.30">     unichars = localbuf;</span>
<a href="#l198.31"></a><span id="l198.31">     unicharLength = klocalbufsize+1;</span>
<a href="#l198.32"></a><span id="l198.32">   }</span>
<a href="#l198.33"></a><span id="l198.33">   if (unichars == nullptr) {</span>
<a href="#l198.34"></a><span id="l198.34">     rv = NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l198.35"></a><span id="l198.35">   }</span>
<a href="#l198.36"></a><span id="l198.36" class="difflineat">@@ -837,17 +837,17 @@ int ConvertUsingEncoderAndDecoder(const </span>
<a href="#l198.37"></a><span id="l198.37">       totalChars += outLen;</span>
<a href="#l198.38"></a><span id="l198.38">       // Done if conversion successful</span>
<a href="#l198.39"></a><span id="l198.39">       if (NS_SUCCEEDED(rv))</span>
<a href="#l198.40"></a><span id="l198.40">           break;</span>
<a href="#l198.41"></a><span id="l198.41"> </span>
<a href="#l198.42"></a><span id="l198.42">       // We consume one byte, replace it with U+FFFD</span>
<a href="#l198.43"></a><span id="l198.43">       // and try the conversion again.</span>
<a href="#l198.44"></a><span id="l198.44">       outBufferIndex += outLen;</span>
<a href="#l198.45"></a><span id="l198.45" class="difflineminus">-      unichars[outBufferIndex++] = PRUnichar(0xFFFD);</span>
<a href="#l198.46"></a><span id="l198.46" class="difflineplus">+      unichars[outBufferIndex++] = char16_t(0xFFFD);</span>
<a href="#l198.47"></a><span id="l198.47">       // totalChars is updated here</span>
<a href="#l198.48"></a><span id="l198.48">       outLen = unicharLength - (++totalChars);</span>
<a href="#l198.49"></a><span id="l198.49"> </span>
<a href="#l198.50"></a><span id="l198.50">       inBufferIndex += inBufferLength + 1;</span>
<a href="#l198.51"></a><span id="l198.51">       dataLen -= inBufferLength + 1;</span>
<a href="#l198.52"></a><span id="l198.52"> </span>
<a href="#l198.53"></a><span id="l198.53">       decoder-&gt;Reset();</span>
<a href="#l198.54"></a><span id="l198.54"> </span>
<a href="#l198.55"></a><span id="l198.55" class="difflineat">@@ -2050,17 +2050,17 @@ MimeGetStringByID(int32_t stringID)</span>
<a href="#l198.56"></a><span id="l198.56">       return ToNewUTF8String(v);</span>
<a href="#l198.57"></a><span id="l198.57">   }</span>
<a href="#l198.58"></a><span id="l198.58"> </span>
<a href="#l198.59"></a><span id="l198.59">   return strdup(&quot;???&quot;);</span>
<a href="#l198.60"></a><span id="l198.60"> }</span>
<a href="#l198.61"></a><span id="l198.61"> </span>
<a href="#l198.62"></a><span id="l198.62"> extern &quot;C&quot;</span>
<a href="#l198.63"></a><span id="l198.63"> char *</span>
<a href="#l198.64"></a><span id="l198.64" class="difflineminus">-MimeGetStringByName(const PRUnichar *stringName)</span>
<a href="#l198.65"></a><span id="l198.65" class="difflineplus">+MimeGetStringByName(const char16_t *stringName)</span>
<a href="#l198.66"></a><span id="l198.66"> {</span>
<a href="#l198.67"></a><span id="l198.67">   nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService =</span>
<a href="#l198.68"></a><span id="l198.68">     do_GetService(NS_STRINGBUNDLE_CONTRACTID);</span>
<a href="#l198.69"></a><span id="l198.69"> </span>
<a href="#l198.70"></a><span id="l198.70">   nsCOMPtr&lt;nsIStringBundle&gt; stringBundle;</span>
<a href="#l198.71"></a><span id="l198.71">   stringBundleService-&gt;CreateBundle(MIME_URL, getter_AddRefs(stringBundle));</span>
<a href="#l198.72"></a><span id="l198.72">   if (stringBundle)</span>
<a href="#l198.73"></a><span id="l198.73">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l199.1"></a><span id="l199.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.h</span>
<a href="#l199.2"></a><span id="l199.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.h</span>
<a href="#l199.3"></a><span id="l199.3" class="difflineat">@@ -173,17 +173,17 @@ mozITXTToHTMLConv           *GetTextConv</span>
<a href="#l199.4"></a><span id="l199.4"> </span>
<a href="#l199.5"></a><span id="l199.5"> nsresult</span>
<a href="#l199.6"></a><span id="l199.6"> HTML2Plaintext(const nsString&amp; inString, nsString&amp; outString,</span>
<a href="#l199.7"></a><span id="l199.7">                uint32_t flags, uint32_t wrapCol);</span>
<a href="#l199.8"></a><span id="l199.8"> nsresult</span>
<a href="#l199.9"></a><span id="l199.9"> HTMLSanitize(const nsString&amp; inString, nsString&amp; outString);</span>
<a href="#l199.10"></a><span id="l199.10"> </span>
<a href="#l199.11"></a><span id="l199.11"> extern &quot;C&quot; char             *MimeGetStringByID(int32_t stringID);</span>
<a href="#l199.12"></a><span id="l199.12" class="difflineminus">-extern &quot;C&quot; char             *MimeGetStringByName(const PRUnichar *stringName);</span>
<a href="#l199.13"></a><span id="l199.13" class="difflineplus">+extern &quot;C&quot; char             *MimeGetStringByName(const char16_t *stringName);</span>
<a href="#l199.14"></a><span id="l199.14"> </span>
<a href="#l199.15"></a><span id="l199.15"> // Utility to create a nsIURI object...</span>
<a href="#l199.16"></a><span id="l199.16"> extern &quot;C&quot; nsresult         nsMimeNewURI(nsIURI** aInstancePtrResult, const char *aSpec, nsIURI *aBase);</span>
<a href="#l199.17"></a><span id="l199.17"> </span>
<a href="#l199.18"></a><span id="l199.18"> extern &quot;C&quot; nsresult SetMailCharacterSetToMsgWindow(MimeObject *obj, const char *aCharacterSet);</span>
<a href="#l199.19"></a><span id="l199.19"> </span>
<a href="#l199.20"></a><span id="l199.20"> extern &quot;C&quot;  nsresult GetMailNewsFont(MimeObject *obj, bool styleFixed, int32_t *fontPixelSize, int32_t *fontSizePercentage, nsCString&amp; fontLang);</span>
<a href="#l199.21"></a><span id="l199.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l200.1"></a><span id="l200.1" class="difflineminus">--- a/mailnews/mime/src/mimetpfl.cpp</span>
<a href="#l200.2"></a><span id="l200.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpfl.cpp</span>
<a href="#l200.3"></a><span id="l200.3" class="difflineat">@@ -483,18 +483,18 @@ MimeInlineTextPlainFlowed_parse_line (co</span>
<a href="#l200.4"></a><span id="l200.4">  * @param in/out a_in_tag, if we are in a tag right now.</span>
<a href="#l200.5"></a><span id="l200.5">  * @param in/out a_in_quote_in_tag, if we are in a quote inside a tag.</span>
<a href="#l200.6"></a><span id="l200.6">  * @param in/out a_quote_char, the kind of quote (&quot; or ').</span>
<a href="#l200.7"></a><span id="l200.7">  * @param in a_current_char, the next char. It decides which state</span>
<a href="#l200.8"></a><span id="l200.8">  *                           will be next.</span>
<a href="#l200.9"></a><span id="l200.9">  */</span>
<a href="#l200.10"></a><span id="l200.10"> static void Update_in_tag_info(bool *a_in_tag, /* IN/OUT */</span>
<a href="#l200.11"></a><span id="l200.11">                    bool *a_in_quote_in_tag, /* IN/OUT */</span>
<a href="#l200.12"></a><span id="l200.12" class="difflineminus">-                   PRUnichar *a_quote_char, /* IN/OUT (pointer to single char) */</span>
<a href="#l200.13"></a><span id="l200.13" class="difflineminus">-                   PRUnichar a_current_char) /* IN */</span>
<a href="#l200.14"></a><span id="l200.14" class="difflineplus">+                   char16_t *a_quote_char, /* IN/OUT (pointer to single char) */</span>
<a href="#l200.15"></a><span id="l200.15" class="difflineplus">+                   char16_t a_current_char) /* IN */</span>
<a href="#l200.16"></a><span id="l200.16"> {</span>
<a href="#l200.17"></a><span id="l200.17">   if(*a_in_tag) {</span>
<a href="#l200.18"></a><span id="l200.18">     // Keep us informed of what's quoted so that we</span>
<a href="#l200.19"></a><span id="l200.19">     // don't end the tag too soon. For instance in</span>
<a href="#l200.20"></a><span id="l200.20">     // &lt;font face=&quot;weird&gt;font&lt;name&quot;&gt;</span>
<a href="#l200.21"></a><span id="l200.21">     if(*a_in_quote_in_tag) {</span>
<a href="#l200.22"></a><span id="l200.22">       // We are in a quote. A quote is ended by the same</span>
<a href="#l200.23"></a><span id="l200.23">       // character that started it ('...' or &quot;...&quot;)</span>
<a href="#l200.24"></a><span id="l200.24" class="difflineat">@@ -538,18 +538,18 @@ static void Update_in_tag_info(bool *a_i</span>
<a href="#l200.25"></a><span id="l200.25">  *</span>
<a href="#l200.26"></a><span id="l200.26">  * @param in a_current_char, the char to convert.</span>
<a href="#l200.27"></a><span id="l200.27">  * @param in a_next_char, the char after the char to convert.</span>
<a href="#l200.28"></a><span id="l200.28">  * @param in a_convert_all_whitespace, if also the last whitespace</span>
<a href="#l200.29"></a><span id="l200.29">  *                                     in a sequence should be</span>
<a href="#l200.30"></a><span id="l200.30">  *                                     converted.</span>
<a href="#l200.31"></a><span id="l200.31">  * @param out a_out_string, result will be appended.</span>
<a href="#l200.32"></a><span id="l200.32"> */</span>
<a href="#l200.33"></a><span id="l200.33" class="difflineminus">-static void Convert_whitespace(const PRUnichar a_current_char,</span>
<a href="#l200.34"></a><span id="l200.34" class="difflineminus">-                               const PRUnichar a_next_char,</span>
<a href="#l200.35"></a><span id="l200.35" class="difflineplus">+static void Convert_whitespace(const char16_t a_current_char,</span>
<a href="#l200.36"></a><span id="l200.36" class="difflineplus">+                               const char16_t a_next_char,</span>
<a href="#l200.37"></a><span id="l200.37">                                const bool a_convert_all_whitespace,</span>
<a href="#l200.38"></a><span id="l200.38">                                nsString&amp; a_out_string)</span>
<a href="#l200.39"></a><span id="l200.39"> {</span>
<a href="#l200.40"></a><span id="l200.40">   NS_ASSERTION('\t' == a_current_char || ' ' == a_current_char,</span>
<a href="#l200.41"></a><span id="l200.41">                &quot;Convert_whitespace got something else than a whitespace!&quot;);</span>
<a href="#l200.42"></a><span id="l200.42"> </span>
<a href="#l200.43"></a><span id="l200.43">   uint32_t number_of_nbsp = 0;</span>
<a href="#l200.44"></a><span id="l200.44">   uint32_t number_of_space = 1; // Assume we're going to output one space.</span>
<a href="#l200.45"></a><span id="l200.45" class="difflineat">@@ -588,21 +588,21 @@ static void Convert_whitespace(const PRU</span>
<a href="#l200.46"></a><span id="l200.46"> */</span>
<a href="#l200.47"></a><span id="l200.47"> static</span>
<a href="#l200.48"></a><span id="l200.48"> nsresult Line_convert_whitespace(const nsString&amp; a_line,</span>
<a href="#l200.49"></a><span id="l200.49">                                  const bool a_convert_all_whitespace,</span>
<a href="#l200.50"></a><span id="l200.50">                                  nsString&amp; a_out_line)</span>
<a href="#l200.51"></a><span id="l200.51"> {</span>
<a href="#l200.52"></a><span id="l200.52">   bool in_tag = false;</span>
<a href="#l200.53"></a><span id="l200.53">   bool in_quote_in_tag = false;</span>
<a href="#l200.54"></a><span id="l200.54" class="difflineminus">-  PRUnichar quote_char;</span>
<a href="#l200.55"></a><span id="l200.55" class="difflineplus">+  char16_t quote_char;</span>
<a href="#l200.56"></a><span id="l200.56"> </span>
<a href="#l200.57"></a><span id="l200.57">   for (uint32_t i = 0; a_line.Length() &gt; i; i++)</span>
<a href="#l200.58"></a><span id="l200.58">   {</span>
<a href="#l200.59"></a><span id="l200.59" class="difflineminus">-    const PRUnichar ic = a_line[i];  // Cache</span>
<a href="#l200.60"></a><span id="l200.60" class="difflineplus">+    const char16_t ic = a_line[i];  // Cache</span>
<a href="#l200.61"></a><span id="l200.61"> </span>
<a href="#l200.62"></a><span id="l200.62">     Update_in_tag_info(&amp;in_tag, &amp;in_quote_in_tag, &amp;quote_char, ic);</span>
<a href="#l200.63"></a><span id="l200.63">     // We don't touch anything inside a tag.</span>
<a href="#l200.64"></a><span id="l200.64">     if (!in_tag) {</span>
<a href="#l200.65"></a><span id="l200.65">       if (ic == ' ' || ic == '\t') {</span>
<a href="#l200.66"></a><span id="l200.66">         // Convert the whitespace to something appropriate</span>
<a href="#l200.67"></a><span id="l200.67">         Convert_whitespace(ic, a_line.Length() &gt; i + 1 ? a_line[i + 1] : '\0',</span>
<a href="#l200.68"></a><span id="l200.68">                            a_convert_all_whitespace ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l201.1"></a><span id="l201.1" class="difflineminus">--- a/mailnews/mime/src/nsMsgHeaderParser.cpp</span>
<a href="#l201.2"></a><span id="l201.2" class="difflineplus">+++ b/mailnews/mime/src/nsMsgHeaderParser.cpp</span>
<a href="#l201.3"></a><span id="l201.3" class="difflineat">@@ -9,18 +9,18 @@</span>
<a href="#l201.4"></a><span id="l201.4"> #include &quot;comi18n.h&quot;</span>
<a href="#l201.5"></a><span id="l201.5"> #include &quot;prmem.h&quot;</span>
<a href="#l201.6"></a><span id="l201.6"> #include &lt;ctype.h&gt;</span>
<a href="#l201.7"></a><span id="l201.7"> #include &quot;nsAlgorithm.h&quot;</span>
<a href="#l201.8"></a><span id="l201.8"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l201.9"></a><span id="l201.9"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l201.10"></a><span id="l201.10"> #include &lt;algorithm&gt;</span>
<a href="#l201.11"></a><span id="l201.11"> </span>
<a href="#l201.12"></a><span id="l201.12" class="difflineminus">-nsresult FillResultsArray(const char * aName, const char *aAddress, PRUnichar ** aOutgoingEmailAddress, PRUnichar ** aOutgoingName,</span>
<a href="#l201.13"></a><span id="l201.13" class="difflineminus">-                          PRUnichar ** aOutgoingFullName, nsIMsgHeaderParser *aParser);</span>
<a href="#l201.14"></a><span id="l201.14" class="difflineplus">+nsresult FillResultsArray(const char * aName, const char *aAddress, char16_t ** aOutgoingEmailAddress, char16_t ** aOutgoingName,</span>
<a href="#l201.15"></a><span id="l201.15" class="difflineplus">+                          char16_t ** aOutgoingFullName, nsIMsgHeaderParser *aParser);</span>
<a href="#l201.16"></a><span id="l201.16"> </span>
<a href="#l201.17"></a><span id="l201.17"> /*</span>
<a href="#l201.18"></a><span id="l201.18">  * Macros used throughout the RFC-822 parsing code.</span>
<a href="#l201.19"></a><span id="l201.19">  */</span>
<a href="#l201.20"></a><span id="l201.20"> </span>
<a href="#l201.21"></a><span id="l201.21"> #undef FREEIF</span>
<a href="#l201.22"></a><span id="l201.22"> #define FREEIF(obj) do { if (obj) { PR_Free (obj); obj = 0; }} while (0)</span>
<a href="#l201.23"></a><span id="l201.23"> </span>
<a href="#l201.24"></a><span id="l201.24" class="difflineat">@@ -64,18 +64,18 @@ nsMsgHeaderParser::nsMsgHeaderParser()</span>
<a href="#l201.25"></a><span id="l201.25"> </span>
<a href="#l201.26"></a><span id="l201.26"> nsMsgHeaderParser::~nsMsgHeaderParser()</span>
<a href="#l201.27"></a><span id="l201.27"> {</span>
<a href="#l201.28"></a><span id="l201.28"> }</span>
<a href="#l201.29"></a><span id="l201.29"> </span>
<a href="#l201.30"></a><span id="l201.30"> NS_IMPL_ISUPPORTS1(nsMsgHeaderParser, nsIMsgHeaderParser)</span>
<a href="#l201.31"></a><span id="l201.31"> </span>
<a href="#l201.32"></a><span id="l201.32"> // helper function called by ParseHeadersWithArray</span>
<a href="#l201.33"></a><span id="l201.33" class="difflineminus">-nsresult FillResultsArray(const char * aName, const char *aAddress, PRUnichar ** aOutgoingEmailAddress, PRUnichar ** aOutgoingName,</span>
<a href="#l201.34"></a><span id="l201.34" class="difflineminus">-                          PRUnichar ** aOutgoingFullName, nsIMsgHeaderParser *aParser)</span>
<a href="#l201.35"></a><span id="l201.35" class="difflineplus">+nsresult FillResultsArray(const char * aName, const char *aAddress, char16_t ** aOutgoingEmailAddress, char16_t ** aOutgoingName,</span>
<a href="#l201.36"></a><span id="l201.36" class="difflineplus">+                          char16_t ** aOutgoingFullName, nsIMsgHeaderParser *aParser)</span>
<a href="#l201.37"></a><span id="l201.37"> {</span>
<a href="#l201.38"></a><span id="l201.38">   NS_ENSURE_ARG(aParser);</span>
<a href="#l201.39"></a><span id="l201.39"> </span>
<a href="#l201.40"></a><span id="l201.40">   *aOutgoingFullName = nullptr;</span>
<a href="#l201.41"></a><span id="l201.41">   *aOutgoingEmailAddress = nullptr;</span>
<a href="#l201.42"></a><span id="l201.42">   *aOutgoingName = nullptr;</span>
<a href="#l201.43"></a><span id="l201.43"> </span>
<a href="#l201.44"></a><span id="l201.44">   nsAutoCString result;</span>
<a href="#l201.45"></a><span id="l201.45" class="difflineat">@@ -105,41 +105,41 @@ nsresult FillResultsArray(const char * a</span>
<a href="#l201.46"></a><span id="l201.46">     *aOutgoingFullName = ToNewUnicode(NS_ConvertUTF8toUTF16(fullAddress));</span>
<a href="#l201.47"></a><span id="l201.47">   }</span>
<a href="#l201.48"></a><span id="l201.48">   else</span>
<a href="#l201.49"></a><span id="l201.49">     *aOutgoingFullName = nullptr;</span>
<a href="#l201.50"></a><span id="l201.50"> </span>
<a href="#l201.51"></a><span id="l201.51">   return NS_OK;</span>
<a href="#l201.52"></a><span id="l201.52"> }</span>
<a href="#l201.53"></a><span id="l201.53"> </span>
<a href="#l201.54"></a><span id="l201.54" class="difflineminus">-NS_IMETHODIMP nsMsgHeaderParser::ParseHeadersWithArray(const PRUnichar * aLine, PRUnichar *** aEmailAddresses,</span>
<a href="#l201.55"></a><span id="l201.55" class="difflineminus">-                                                       PRUnichar *** aNames, PRUnichar *** aFullNames, uint32_t * aNumAddresses)</span>
<a href="#l201.56"></a><span id="l201.56" class="difflineplus">+NS_IMETHODIMP nsMsgHeaderParser::ParseHeadersWithArray(const char16_t * aLine, char16_t *** aEmailAddresses,</span>
<a href="#l201.57"></a><span id="l201.57" class="difflineplus">+                                                       char16_t *** aNames, char16_t *** aFullNames, uint32_t * aNumAddresses)</span>
<a href="#l201.58"></a><span id="l201.58"> {</span>
<a href="#l201.59"></a><span id="l201.59">   char * names = nullptr;</span>
<a href="#l201.60"></a><span id="l201.60">   char * addresses = nullptr;</span>
<a href="#l201.61"></a><span id="l201.61">   uint32_t numAddresses = 0;</span>
<a href="#l201.62"></a><span id="l201.62">   nsresult rv = NS_OK;</span>
<a href="#l201.63"></a><span id="l201.63"> </span>
<a href="#l201.64"></a><span id="l201.64">   // need to convert unicode to UTF-8...</span>
<a href="#l201.65"></a><span id="l201.65">   nsAutoString tempString (aLine);</span>
<a href="#l201.66"></a><span id="l201.66">   char * utf8String = ToNewUTF8String(tempString);</span>
<a href="#l201.67"></a><span id="l201.67"> </span>
<a href="#l201.68"></a><span id="l201.68">   rv = ParseHeaderAddresses(utf8String, &amp;names, &amp;addresses, &amp;numAddresses);</span>
<a href="#l201.69"></a><span id="l201.69">   NS_Free(utf8String);</span>
<a href="#l201.70"></a><span id="l201.70">   if (NS_SUCCEEDED(rv) &amp;&amp; numAddresses)</span>
<a href="#l201.71"></a><span id="l201.71">   {</span>
<a href="#l201.72"></a><span id="l201.72">     // allocate space for our arrays....</span>
<a href="#l201.73"></a><span id="l201.73" class="difflineminus">-    *aEmailAddresses = (PRUnichar **) PR_MALLOC(sizeof(PRUnichar *) * numAddresses);</span>
<a href="#l201.74"></a><span id="l201.74" class="difflineminus">-    *aNames = (PRUnichar **) PR_MALLOC(sizeof(PRUnichar *) * numAddresses);</span>
<a href="#l201.75"></a><span id="l201.75" class="difflineminus">-    *aFullNames = (PRUnichar **) PR_MALLOC(sizeof(PRUnichar *) * numAddresses);</span>
<a href="#l201.76"></a><span id="l201.76" class="difflineplus">+    *aEmailAddresses = (char16_t **) PR_MALLOC(sizeof(char16_t *) * numAddresses);</span>
<a href="#l201.77"></a><span id="l201.77" class="difflineplus">+    *aNames = (char16_t **) PR_MALLOC(sizeof(char16_t *) * numAddresses);</span>
<a href="#l201.78"></a><span id="l201.78" class="difflineplus">+    *aFullNames = (char16_t **) PR_MALLOC(sizeof(char16_t *) * numAddresses);</span>
<a href="#l201.79"></a><span id="l201.79"> </span>
<a href="#l201.80"></a><span id="l201.80">     // for simplicities sake...</span>
<a href="#l201.81"></a><span id="l201.81" class="difflineminus">-    PRUnichar ** outgoingEmailAddresses = *aEmailAddresses;</span>
<a href="#l201.82"></a><span id="l201.82" class="difflineminus">-    PRUnichar ** outgoingNames = *aNames;</span>
<a href="#l201.83"></a><span id="l201.83" class="difflineminus">-    PRUnichar ** outgoingFullNames = *aFullNames;</span>
<a href="#l201.84"></a><span id="l201.84" class="difflineplus">+    char16_t ** outgoingEmailAddresses = *aEmailAddresses;</span>
<a href="#l201.85"></a><span id="l201.85" class="difflineplus">+    char16_t ** outgoingNames = *aNames;</span>
<a href="#l201.86"></a><span id="l201.86" class="difflineplus">+    char16_t ** outgoingFullNames = *aFullNames;</span>
<a href="#l201.87"></a><span id="l201.87"> </span>
<a href="#l201.88"></a><span id="l201.88">     // iterate over the results and fill in our arrays....</span>
<a href="#l201.89"></a><span id="l201.89">     uint32_t index = 0;</span>
<a href="#l201.90"></a><span id="l201.90">     const char * currentName = names;</span>
<a href="#l201.91"></a><span id="l201.91">     const char * currentAddress = addresses;</span>
<a href="#l201.92"></a><span id="l201.92">     char * unquotedName = nullptr;</span>
<a href="#l201.93"></a><span id="l201.93">     while (index &lt; numAddresses)</span>
<a href="#l201.94"></a><span id="l201.94">     {</span>
<a href="#l201.95"></a><span id="l201.95" class="difflineat">@@ -208,31 +208,31 @@ nsMsgHeaderParser::MakeMimeAddress(const</span>
<a href="#l201.96"></a><span id="l201.96"> }</span>
<a href="#l201.97"></a><span id="l201.97"> </span>
<a href="#l201.98"></a><span id="l201.98"> nsresult nsMsgHeaderParser::UnquotePhraseOrAddr (const char *line, bool preserveIntegrity, char** result)</span>
<a href="#l201.99"></a><span id="l201.99"> {</span>
<a href="#l201.100"></a><span id="l201.100">   NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l201.101"></a><span id="l201.101">   return msg_unquote_phrase_or_addr(line, preserveIntegrity, result);</span>
<a href="#l201.102"></a><span id="l201.102"> }</span>
<a href="#l201.103"></a><span id="l201.103"> </span>
<a href="#l201.104"></a><span id="l201.104" class="difflineminus">-nsresult nsMsgHeaderParser::UnquotePhraseOrAddrWString (const PRUnichar *line, bool preserveIntegrity, PRUnichar ** result)</span>
<a href="#l201.105"></a><span id="l201.105" class="difflineplus">+nsresult nsMsgHeaderParser::UnquotePhraseOrAddrWString (const char16_t *line, bool preserveIntegrity, char16_t ** result)</span>
<a href="#l201.106"></a><span id="l201.106"> {</span>
<a href="#l201.107"></a><span id="l201.107">   nsCString utf8Str;</span>
<a href="#l201.108"></a><span id="l201.108">   nsresult rv = msg_unquote_phrase_or_addr(NS_ConvertUTF16toUTF8(line).get(), preserveIntegrity, getter_Copies(utf8Str));</span>
<a href="#l201.109"></a><span id="l201.109">   if (NS_SUCCEEDED(rv))</span>
<a href="#l201.110"></a><span id="l201.110">   {</span>
<a href="#l201.111"></a><span id="l201.111">     *result = ToNewUnicode(NS_ConvertUTF8toUTF16(utf8Str.get()));</span>
<a href="#l201.112"></a><span id="l201.112">     if (*result == nullptr)</span>
<a href="#l201.113"></a><span id="l201.113">       rv = NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l201.114"></a><span id="l201.114">   }</span>
<a href="#l201.115"></a><span id="l201.115"> </span>
<a href="#l201.116"></a><span id="l201.116">   return rv;</span>
<a href="#l201.117"></a><span id="l201.117"> }</span>
<a href="#l201.118"></a><span id="l201.118"> </span>
<a href="#l201.119"></a><span id="l201.119" class="difflineminus">-nsresult nsMsgHeaderParser::ReformatUnquotedAddresses (const PRUnichar *line, PRUnichar ** result)</span>
<a href="#l201.120"></a><span id="l201.120" class="difflineplus">+nsresult nsMsgHeaderParser::ReformatUnquotedAddresses (const char16_t *line, char16_t ** result)</span>
<a href="#l201.121"></a><span id="l201.121"> {</span>
<a href="#l201.122"></a><span id="l201.122">   NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l201.123"></a><span id="l201.123">   *result = nullptr;</span>
<a href="#l201.124"></a><span id="l201.124">   bool badInput = false;</span>
<a href="#l201.125"></a><span id="l201.125"> </span>
<a href="#l201.126"></a><span id="l201.126">   NS_ConvertUTF16toUTF8 convertedLine(line);</span>
<a href="#l201.127"></a><span id="l201.127"> </span>
<a href="#l201.128"></a><span id="l201.128">   int32_t lineLen = convertedLine.Length();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l202.1"></a><span id="l202.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l202.2"></a><span id="l202.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l202.3"></a><span id="l202.3" class="difflineat">@@ -881,17 +881,17 @@ nsNNTPNewsgroupList::FinishXOVERLINE(int</span>
<a href="#l202.4"></a><span id="l202.4">       nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l202.5"></a><span id="l202.5">         mozilla::services::GetStringBundleService();</span>
<a href="#l202.6"></a><span id="l202.6">       NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l202.7"></a><span id="l202.7"> </span>
<a href="#l202.8"></a><span id="l202.8">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l202.9"></a><span id="l202.9">       rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l202.10"></a><span id="l202.10">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l202.11"></a><span id="l202.11"> </span>
<a href="#l202.12"></a><span id="l202.12" class="difflineminus">-      const PRUnichar *formatStrings[2] = { firstStr.get(), lastStr.get() };</span>
<a href="#l202.13"></a><span id="l202.13" class="difflineplus">+      const char16_t *formatStrings[2] = { firstStr.get(), lastStr.get() };</span>
<a href="#l202.14"></a><span id="l202.14">       rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;downloadingArticles&quot;), formatStrings, 2, getter_Copies(statusString));</span>
<a href="#l202.15"></a><span id="l202.15">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l202.16"></a><span id="l202.16"> </span>
<a href="#l202.17"></a><span id="l202.17">       SetProgressStatus(statusString.get());</span>
<a href="#l202.18"></a><span id="l202.18">     }</span>
<a href="#l202.19"></a><span id="l202.19">   }</span>
<a href="#l202.20"></a><span id="l202.20"> </span>
<a href="#l202.21"></a><span id="l202.21">   if (newstatus)</span>
<a href="#l202.22"></a><span id="l202.22" class="difflineat">@@ -1223,17 +1223,17 @@ nsNNTPNewsgroupList::SetProgressBarPerce</span>
<a href="#l202.23"></a><span id="l202.23"> </span>
<a href="#l202.24"></a><span id="l202.24">     if (feedback) {</span>
<a href="#l202.25"></a><span id="l202.25">       feedback-&gt;ShowProgress(percent);</span>
<a href="#l202.26"></a><span id="l202.26">     }</span>
<a href="#l202.27"></a><span id="l202.27">   }</span>
<a href="#l202.28"></a><span id="l202.28"> }</span>
<a href="#l202.29"></a><span id="l202.29"> </span>
<a href="#l202.30"></a><span id="l202.30"> void</span>
<a href="#l202.31"></a><span id="l202.31" class="difflineminus">-nsNNTPNewsgroupList::SetProgressStatus(const PRUnichar *message)</span>
<a href="#l202.32"></a><span id="l202.32" class="difflineplus">+nsNNTPNewsgroupList::SetProgressStatus(const char16_t *message)</span>
<a href="#l202.33"></a><span id="l202.33"> {</span>
<a href="#l202.34"></a><span id="l202.34">   if (!m_runningURL)</span>
<a href="#l202.35"></a><span id="l202.35">     return;</span>
<a href="#l202.36"></a><span id="l202.36"> </span>
<a href="#l202.37"></a><span id="l202.37">   nsCOMPtr &lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(m_runningURL);</span>
<a href="#l202.38"></a><span id="l202.38">   if (mailnewsUrl) {</span>
<a href="#l202.39"></a><span id="l202.39">     nsCOMPtr &lt;nsIMsgStatusFeedback&gt; feedback;</span>
<a href="#l202.40"></a><span id="l202.40">     mailnewsUrl-&gt;GetStatusFeedback(getter_AddRefs(feedback));</span>
<a href="#l202.41"></a><span id="l202.41" class="difflineat">@@ -1271,24 +1271,24 @@ nsNNTPNewsgroupList::UpdateStatus(bool f</span>
<a href="#l202.42"></a><span id="l202.42">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l202.43"></a><span id="l202.43">   rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l202.44"></a><span id="l202.44">   if (!NS_SUCCEEDED(rv))</span>
<a href="#l202.45"></a><span id="l202.45">     return;</span>
<a href="#l202.46"></a><span id="l202.46"> </span>
<a href="#l202.47"></a><span id="l202.47">   if (filtering)</span>
<a href="#l202.48"></a><span id="l202.48">   {</span>
<a href="#l202.49"></a><span id="l202.49">     NS_ConvertUTF8toUTF16 header(m_filterHeaders[m_currentXHDRIndex]);</span>
<a href="#l202.50"></a><span id="l202.50" class="difflineminus">-    const PRUnichar *formatStrings[4] = { header.get(),</span>
<a href="#l202.51"></a><span id="l202.51" class="difflineplus">+    const char16_t *formatStrings[4] = { header.get(),</span>
<a href="#l202.52"></a><span id="l202.52">       numDownloadedStr.get(), totalToDownloadStr.get(), newsgroupName.get() };</span>
<a href="#l202.53"></a><span id="l202.53">     rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;newNewsgroupFilteringHeaders&quot;),</span>
<a href="#l202.54"></a><span id="l202.54">       formatStrings, 4, getter_Copies(statusString));</span>
<a href="#l202.55"></a><span id="l202.55">   }</span>
<a href="#l202.56"></a><span id="l202.56">   else</span>
<a href="#l202.57"></a><span id="l202.57">   {</span>
<a href="#l202.58"></a><span id="l202.58" class="difflineminus">-    const PRUnichar *formatStrings[3] = { numDownloadedStr.get(),</span>
<a href="#l202.59"></a><span id="l202.59" class="difflineplus">+    const char16_t *formatStrings[3] = { numDownloadedStr.get(),</span>
<a href="#l202.60"></a><span id="l202.60">       totalToDownloadStr.get(), newsgroupName.get() };</span>
<a href="#l202.61"></a><span id="l202.61">     rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;newNewsgroupHeaders&quot;),</span>
<a href="#l202.62"></a><span id="l202.62">       formatStrings, 3, getter_Copies(statusString));</span>
<a href="#l202.63"></a><span id="l202.63">   }</span>
<a href="#l202.64"></a><span id="l202.64">   if (!NS_SUCCEEDED(rv))</span>
<a href="#l202.65"></a><span id="l202.65">     return;</span>
<a href="#l202.66"></a><span id="l202.66"> </span>
<a href="#l202.67"></a><span id="l202.67">   SetProgressStatus(statusString.get());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l203.1"></a><span id="l203.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.h</span>
<a href="#l203.2"></a><span id="l203.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.h</span>
<a href="#l203.3"></a><span id="l203.3" class="difflineat">@@ -65,17 +65,17 @@ private:</span>
<a href="#l203.4"></a><span id="l203.4">   bool    m_finishingXover;</span>
<a href="#l203.5"></a><span id="l203.5"> </span>
<a href="#l203.6"></a><span id="l203.6"> #ifdef HAVE_CHANGELISTENER</span>
<a href="#l203.7"></a><span id="l203.7">   virtual void OnAnnouncerGoingAway (ChangeAnnouncer *instigator);</span>
<a href="#l203.8"></a><span id="l203.8"> #endif</span>
<a href="#l203.9"></a><span id="l203.9">   nsresult ParseLine(char *line, uint32_t *message_number);</span>
<a href="#l203.10"></a><span id="l203.10">   nsresult GetDatabase(const char *uri, nsIMsgDatabase **db);</span>
<a href="#l203.11"></a><span id="l203.11">   void SetProgressBarPercent(int32_t percent);</span>
<a href="#l203.12"></a><span id="l203.12" class="difflineminus">-  void SetProgressStatus(const PRUnichar *message);</span>
<a href="#l203.13"></a><span id="l203.13" class="difflineplus">+  void SetProgressStatus(const char16_t *message);</span>
<a href="#l203.14"></a><span id="l203.14"> </span>
<a href="#l203.15"></a><span id="l203.15">   void UpdateStatus(bool filtering, int32_t numDled, int32_t totToDL);</span>
<a href="#l203.16"></a><span id="l203.16"> </span>
<a href="#l203.17"></a><span id="l203.17">   nsresult AddHeader(const char * header, const char * value);</span>
<a href="#l203.18"></a><span id="l203.18"> protected:</span>
<a href="#l203.19"></a><span id="l203.19">   bool m_getOldMessages;</span>
<a href="#l203.20"></a><span id="l203.20">   bool m_promptedAlready;</span>
<a href="#l203.21"></a><span id="l203.21">   bool m_downloadAll;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l204.1"></a><span id="l204.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l204.2"></a><span id="l204.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l204.3"></a><span id="l204.3" class="difflineat">@@ -1024,17 +1024,17 @@ nsresult nsNNTPProtocol::LoadUrl(nsIURI </span>
<a href="#l204.4"></a><span id="l204.4">       // as escaped. decode and unescape the newsgroup name so we'll</span>
<a href="#l204.5"></a><span id="l204.5">       // display a proper name.</span>
<a href="#l204.6"></a><span id="l204.6"> </span>
<a href="#l204.7"></a><span id="l204.7">       nsAutoString unescapedName;</span>
<a href="#l204.8"></a><span id="l204.8">       rv = NS_MsgDecodeUnescapeURLPath(group, unescapedName);</span>
<a href="#l204.9"></a><span id="l204.9">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l204.10"></a><span id="l204.10"> </span>
<a href="#l204.11"></a><span id="l204.11">       bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l204.12"></a><span id="l204.12" class="difflineminus">-      const PRUnichar *formatStrings[1] = { unescapedName.get() };</span>
<a href="#l204.13"></a><span id="l204.13" class="difflineplus">+      const char16_t *formatStrings[1] = { unescapedName.get() };</span>
<a href="#l204.14"></a><span id="l204.14"> </span>
<a href="#l204.15"></a><span id="l204.15">       rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l204.16"></a><span id="l204.16">         MOZ_UTF16(&quot;autoSubscribeText&quot;), formatStrings, 1,</span>
<a href="#l204.17"></a><span id="l204.17">         getter_Copies(confirmText));</span>
<a href="#l204.18"></a><span id="l204.18">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l204.19"></a><span id="l204.19"> </span>
<a href="#l204.20"></a><span id="l204.20">       bool confirmResult = false;</span>
<a href="#l204.21"></a><span id="l204.21">       rv = dialog-&gt;Confirm(nullptr, confirmText.get(), &amp;confirmResult);</span>
<a href="#l204.22"></a><span id="l204.22" class="difflineat">@@ -2775,17 +2775,17 @@ nsresult nsNNTPProtocol::ReadNewsList(ns</span>
<a href="#l204.23"></a><span id="l204.23">       ComputeRate(mBytesReceived, m_startTime, &amp;rate);</span>
<a href="#l204.24"></a><span id="l204.24">       char rate_buf[RATE_STR_BUF_LEN];</span>
<a href="#l204.25"></a><span id="l204.25">       PR_snprintf(rate_buf,RATE_STR_BUF_LEN,&quot;%.1f&quot;, rate);</span>
<a href="#l204.26"></a><span id="l204.26"> </span>
<a href="#l204.27"></a><span id="l204.27">       nsAutoString numGroupsStr;</span>
<a href="#l204.28"></a><span id="l204.28">       numGroupsStr.AppendInt(mNumGroupsListed);</span>
<a href="#l204.29"></a><span id="l204.29">       NS_ConvertASCIItoUTF16 rateStr(rate_buf);</span>
<a href="#l204.30"></a><span id="l204.30"> </span>
<a href="#l204.31"></a><span id="l204.31" class="difflineminus">-      const PRUnichar *formatStrings[3] = { numGroupsStr.get(), bytesStr.get(), rateStr.get()};</span>
<a href="#l204.32"></a><span id="l204.32" class="difflineplus">+      const char16_t *formatStrings[3] = { numGroupsStr.get(), bytesStr.get(), rateStr.get()};</span>
<a href="#l204.33"></a><span id="l204.33">       rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;bytesReceived&quot;),</span>
<a href="#l204.34"></a><span id="l204.34">         formatStrings, 3,</span>
<a href="#l204.35"></a><span id="l204.35">         getter_Copies(statusString));</span>
<a href="#l204.36"></a><span id="l204.36"> </span>
<a href="#l204.37"></a><span id="l204.37">       rv = msgStatusFeedback-&gt;ShowStatusString(statusString);</span>
<a href="#l204.38"></a><span id="l204.38">       if (NS_FAILED(rv)) {</span>
<a href="#l204.39"></a><span id="l204.39">         PR_Free(lineToFree);</span>
<a href="#l204.40"></a><span id="l204.40">         return rv;</span>
<a href="#l204.41"></a><span id="l204.41" class="difflineat">@@ -3329,33 +3329,33 @@ nsresult nsNNTPProtocol::ReadNewsgroupBo</span>
<a href="#l204.42"></a><span id="l204.42"> </span>
<a href="#l204.43"></a><span id="l204.43">   nsCString safe_line(line);</span>
<a href="#l204.44"></a><span id="l204.44">   rv = m_newsgroupList-&gt;ProcessHEADLine(safe_line);</span>
<a href="#l204.45"></a><span id="l204.45">   PR_Free(lineToFree);</span>
<a href="#l204.46"></a><span id="l204.46">   return rv;</span>
<a href="#l204.47"></a><span id="l204.47"> }</span>
<a href="#l204.48"></a><span id="l204.48"> </span>
<a href="#l204.49"></a><span id="l204.49"> </span>
<a href="#l204.50"></a><span id="l204.50" class="difflineminus">-nsresult nsNNTPProtocol::GetNewsStringByID(int32_t stringID, PRUnichar **aString)</span>
<a href="#l204.51"></a><span id="l204.51" class="difflineplus">+nsresult nsNNTPProtocol::GetNewsStringByID(int32_t stringID, char16_t **aString)</span>
<a href="#l204.52"></a><span id="l204.52"> {</span>
<a href="#l204.53"></a><span id="l204.53">   nsresult rv;</span>
<a href="#l204.54"></a><span id="l204.54">   nsAutoString resultString(NS_LITERAL_STRING(&quot;???&quot;));</span>
<a href="#l204.55"></a><span id="l204.55"> </span>
<a href="#l204.56"></a><span id="l204.56">   if (!m_stringBundle)</span>
<a href="#l204.57"></a><span id="l204.57">   {</span>
<a href="#l204.58"></a><span id="l204.58">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l204.59"></a><span id="l204.59">       mozilla::services::GetStringBundleService();</span>
<a href="#l204.60"></a><span id="l204.60">     NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l204.61"></a><span id="l204.61"> </span>
<a href="#l204.62"></a><span id="l204.62">     rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(m_stringBundle));</span>
<a href="#l204.63"></a><span id="l204.63">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l204.64"></a><span id="l204.64">   }</span>
<a href="#l204.65"></a><span id="l204.65"> </span>
<a href="#l204.66"></a><span id="l204.66">   if (m_stringBundle) {</span>
<a href="#l204.67"></a><span id="l204.67" class="difflineminus">-    PRUnichar *ptrv = nullptr;</span>
<a href="#l204.68"></a><span id="l204.68" class="difflineplus">+    char16_t *ptrv = nullptr;</span>
<a href="#l204.69"></a><span id="l204.69">     rv = m_stringBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l204.70"></a><span id="l204.70"> </span>
<a href="#l204.71"></a><span id="l204.71">     if (NS_FAILED(rv)) {</span>
<a href="#l204.72"></a><span id="l204.72">       resultString.AssignLiteral(&quot;[StringID&quot;);</span>
<a href="#l204.73"></a><span id="l204.73">       resultString.AppendInt(stringID);</span>
<a href="#l204.74"></a><span id="l204.74">       resultString.AppendLiteral(&quot;?]&quot;);</span>
<a href="#l204.75"></a><span id="l204.75">       *aString = ToNewUnicode(resultString);</span>
<a href="#l204.76"></a><span id="l204.76">     }</span>
<a href="#l204.77"></a><span id="l204.77" class="difflineat">@@ -3365,17 +3365,17 @@ nsresult nsNNTPProtocol::GetNewsStringBy</span>
<a href="#l204.78"></a><span id="l204.78">   }</span>
<a href="#l204.79"></a><span id="l204.79">   else {</span>
<a href="#l204.80"></a><span id="l204.80">     rv = NS_OK;</span>
<a href="#l204.81"></a><span id="l204.81">     *aString = ToNewUnicode(resultString);</span>
<a href="#l204.82"></a><span id="l204.82">   }</span>
<a href="#l204.83"></a><span id="l204.83">   return rv;</span>
<a href="#l204.84"></a><span id="l204.84"> }</span>
<a href="#l204.85"></a><span id="l204.85"> </span>
<a href="#l204.86"></a><span id="l204.86" class="difflineminus">-nsresult nsNNTPProtocol::GetNewsStringByName(const char *aName, PRUnichar **aString)</span>
<a href="#l204.87"></a><span id="l204.87" class="difflineplus">+nsresult nsNNTPProtocol::GetNewsStringByName(const char *aName, char16_t **aString)</span>
<a href="#l204.88"></a><span id="l204.88"> {</span>
<a href="#l204.89"></a><span id="l204.89">   nsresult rv;</span>
<a href="#l204.90"></a><span id="l204.90">   nsAutoString resultString(NS_LITERAL_STRING(&quot;???&quot;));</span>
<a href="#l204.91"></a><span id="l204.91">   if (!m_stringBundle)</span>
<a href="#l204.92"></a><span id="l204.92">   {</span>
<a href="#l204.93"></a><span id="l204.93">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l204.94"></a><span id="l204.94">       mozilla::services::GetStringBundleService();</span>
<a href="#l204.95"></a><span id="l204.95">     NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l204.96"></a><span id="l204.96" class="difflineat">@@ -3384,17 +3384,17 @@ nsresult nsNNTPProtocol::GetNewsStringBy</span>
<a href="#l204.97"></a><span id="l204.97">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l204.98"></a><span id="l204.98">   }</span>
<a href="#l204.99"></a><span id="l204.99"> </span>
<a href="#l204.100"></a><span id="l204.100">   if (m_stringBundle)</span>
<a href="#l204.101"></a><span id="l204.101">   {</span>
<a href="#l204.102"></a><span id="l204.102">     nsAutoString unicodeName;</span>
<a href="#l204.103"></a><span id="l204.103">     CopyASCIItoUTF16(nsDependentCString(aName), unicodeName);</span>
<a href="#l204.104"></a><span id="l204.104"> </span>
<a href="#l204.105"></a><span id="l204.105" class="difflineminus">-    PRUnichar *ptrv = nullptr;</span>
<a href="#l204.106"></a><span id="l204.106" class="difflineplus">+    char16_t *ptrv = nullptr;</span>
<a href="#l204.107"></a><span id="l204.107">     rv = m_stringBundle-&gt;GetStringFromName(unicodeName.get(), &amp;ptrv);</span>
<a href="#l204.108"></a><span id="l204.108"> </span>
<a href="#l204.109"></a><span id="l204.109">     if (NS_FAILED(rv))</span>
<a href="#l204.110"></a><span id="l204.110">     {</span>
<a href="#l204.111"></a><span id="l204.111">       resultString.AssignLiteral(&quot;[StringName&quot;);</span>
<a href="#l204.112"></a><span id="l204.112">       resultString.Append(NS_ConvertASCIItoUTF16(aName));</span>
<a href="#l204.113"></a><span id="l204.113">       resultString.AppendLiteral(&quot;?]&quot;);</span>
<a href="#l204.114"></a><span id="l204.114">       *aString = ToNewUnicode(resultString);</span>
<a href="#l204.115"></a><span id="l204.115" class="difflineat">@@ -4720,17 +4720,17 @@ void nsNNTPProtocol::SetProgressBarPerce</span>
<a href="#l204.116"></a><span id="l204.116"> {</span>
<a href="#l204.117"></a><span id="l204.117">   // XXX 64-bit</span>
<a href="#l204.118"></a><span id="l204.118">   if (mProgressEventSink)</span>
<a href="#l204.119"></a><span id="l204.119">     mProgressEventSink-&gt;OnProgress(this, m_channelContext, uint64_t(aProgress),</span>
<a href="#l204.120"></a><span id="l204.120">                                    uint64_t(aProgressMax));</span>
<a href="#l204.121"></a><span id="l204.121"> }</span>
<a href="#l204.122"></a><span id="l204.122"> </span>
<a href="#l204.123"></a><span id="l204.123"> nsresult</span>
<a href="#l204.124"></a><span id="l204.124" class="difflineminus">-nsNNTPProtocol::SetProgressStatus(const PRUnichar *aMessage)</span>
<a href="#l204.125"></a><span id="l204.125" class="difflineplus">+nsNNTPProtocol::SetProgressStatus(const char16_t *aMessage)</span>
<a href="#l204.126"></a><span id="l204.126"> {</span>
<a href="#l204.127"></a><span id="l204.127">   nsresult rv = NS_OK;</span>
<a href="#l204.128"></a><span id="l204.128">   if (mProgressEventSink)</span>
<a href="#l204.129"></a><span id="l204.129">     rv = mProgressEventSink-&gt;OnStatus(this, m_channelContext, NS_OK, aMessage);</span>
<a href="#l204.130"></a><span id="l204.130">   return rv;</span>
<a href="#l204.131"></a><span id="l204.131"> }</span>
<a href="#l204.132"></a><span id="l204.132"> </span>
<a href="#l204.133"></a><span id="l204.133"> NS_IMETHODIMP nsNNTPProtocol::GetContentType(nsACString &amp;aContentType)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l205.1"></a><span id="l205.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.h</span>
<a href="#l205.2"></a><span id="l205.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.h</span>
<a href="#l205.3"></a><span id="l205.3" class="difflineat">@@ -246,18 +246,18 @@ private:</span>
<a href="#l205.4"></a><span id="l205.4">   nsCString m_searchData;</span>
<a href="#l205.5"></a><span id="l205.5"> </span>
<a href="#l205.6"></a><span id="l205.6">   int32_t   m_originalContentLength; /* the content length at the time of calling graph progress */</span>
<a href="#l205.7"></a><span id="l205.7"> </span>
<a href="#l205.8"></a><span id="l205.8">   nsCOMPtr&lt;nsIStringBundle&gt; m_stringBundle;</span>
<a href="#l205.9"></a><span id="l205.9"> </span>
<a href="#l205.10"></a><span id="l205.10">   nsCOMPtr&lt;nsINntpIncomingServer&gt; m_nntpServer;</span>
<a href="#l205.11"></a><span id="l205.11"> </span>
<a href="#l205.12"></a><span id="l205.12" class="difflineminus">-  nsresult GetNewsStringByName(const char *aName, PRUnichar **aString);</span>
<a href="#l205.13"></a><span id="l205.13" class="difflineminus">-  nsresult GetNewsStringByID(int32_t stringID, PRUnichar **aString);</span>
<a href="#l205.14"></a><span id="l205.14" class="difflineplus">+  nsresult GetNewsStringByName(const char *aName, char16_t **aString);</span>
<a href="#l205.15"></a><span id="l205.15" class="difflineplus">+  nsresult GetNewsStringByID(int32_t stringID, char16_t **aString);</span>
<a href="#l205.16"></a><span id="l205.16"> </span>
<a href="#l205.17"></a><span id="l205.17">   nsresult PostMessageInFile(nsIFile * filePath);</span>
<a href="#l205.18"></a><span id="l205.18"> </span>
<a href="#l205.19"></a><span id="l205.19">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l205.20"></a><span id="l205.20">   // Communication methods --&gt; Reading and writing protocol</span>
<a href="#l205.21"></a><span id="l205.21">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l205.22"></a><span id="l205.22"> </span>
<a href="#l205.23"></a><span id="l205.23">   int32_t ReadLine(nsIInputStream * inputStream, uint32_t length, char ** line);</span>
<a href="#l205.24"></a><span id="l205.24" class="difflineat">@@ -474,17 +474,17 @@ private:</span>
<a href="#l205.25"></a><span id="l205.25"> </span>
<a href="#l205.26"></a><span id="l205.26">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l205.27"></a><span id="l205.27">   // End of Protocol Methods</span>
<a href="#l205.28"></a><span id="l205.28">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l205.29"></a><span id="l205.29"> </span>
<a href="#l205.30"></a><span id="l205.30">   nsresult ParseURL(nsIURI *aURL, nsCString &amp;aGroup, nsCString &amp;aMessageID);</span>
<a href="#l205.31"></a><span id="l205.31"> </span>
<a href="#l205.32"></a><span id="l205.32">   void SetProgressBarPercent(uint32_t aProgress, uint32_t aProgressMax);</span>
<a href="#l205.33"></a><span id="l205.33" class="difflineminus">-  nsresult SetProgressStatus(const PRUnichar *aMessage);</span>
<a href="#l205.34"></a><span id="l205.34" class="difflineplus">+  nsresult SetProgressStatus(const char16_t *aMessage);</span>
<a href="#l205.35"></a><span id="l205.35">   nsresult InitializeNewsFolderFromUri(const char *uri);</span>
<a href="#l205.36"></a><span id="l205.36">   void TimerCallback();</span>
<a href="#l205.37"></a><span id="l205.37"> </span>
<a href="#l205.38"></a><span id="l205.38">   void HandleAuthenticationFailure();</span>
<a href="#l205.39"></a><span id="l205.39">   nsCOMPtr &lt;nsIInputStream&gt; mInputStream;</span>
<a href="#l205.40"></a><span id="l205.40">   nsCOMPtr &lt;nsITimer&gt; mUpdateTimer;</span>
<a href="#l205.41"></a><span id="l205.41">   nsresult AlertError(int32_t errorCode, const char *text);</span>
<a href="#l205.42"></a><span id="l205.42">   int32_t mBytesReceived;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l206.1"></a><span id="l206.1" class="difflineminus">--- a/mailnews/news/src/nsNewsDownloader.cpp</span>
<a href="#l206.2"></a><span id="l206.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsDownloader.cpp</span>
<a href="#l206.3"></a><span id="l206.3" class="difflineat">@@ -191,28 +191,28 @@ bool nsNewsDownloader::GetNextHdrToRetri</span>
<a href="#l206.4"></a><span id="l206.4">     firstStr.AppendInt(m_numwrote);</span>
<a href="#l206.5"></a><span id="l206.5">     nsAutoString totalStr;</span>
<a href="#l206.6"></a><span id="l206.6">     totalStr.AppendInt(m_keysToDownload.Length());</span>
<a href="#l206.7"></a><span id="l206.7">     nsString prettiestName;</span>
<a href="#l206.8"></a><span id="l206.8">     nsString statusString;</span>
<a href="#l206.9"></a><span id="l206.9"> </span>
<a href="#l206.10"></a><span id="l206.10">     m_folder-&gt;GetPrettiestName(prettiestName);</span>
<a href="#l206.11"></a><span id="l206.11"> </span>
<a href="#l206.12"></a><span id="l206.12" class="difflineminus">-    const PRUnichar *formatStrings[3] = { firstStr.get(), totalStr.get(), prettiestName.get() };</span>
<a href="#l206.13"></a><span id="l206.13" class="difflineplus">+    const char16_t *formatStrings[3] = { firstStr.get(), totalStr.get(), prettiestName.get() };</span>
<a href="#l206.14"></a><span id="l206.14">     rv = bundle-&gt;FormatStringFromName(MOZ_UTF16(&quot;downloadingArticlesForOffline&quot;),</span>
<a href="#l206.15"></a><span id="l206.15">                                       formatStrings, 3, getter_Copies(statusString));</span>
<a href="#l206.16"></a><span id="l206.16">     NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l206.17"></a><span id="l206.17">     ShowProgress(statusString.get(), percent);</span>
<a href="#l206.18"></a><span id="l206.18">     return true;</span>
<a href="#l206.19"></a><span id="l206.19">   }</span>
<a href="#l206.20"></a><span id="l206.20">   NS_ASSERTION(false, &quot;shouldn't get here if we're not downloading from keys.&quot;);</span>
<a href="#l206.21"></a><span id="l206.21">   return false;  // shouldn't get here if we're not downloading from keys.</span>
<a href="#l206.22"></a><span id="l206.22"> }</span>
<a href="#l206.23"></a><span id="l206.23"> </span>
<a href="#l206.24"></a><span id="l206.24" class="difflineminus">-nsresult nsNewsDownloader::ShowProgress(const PRUnichar *progressString, int32_t percent)</span>
<a href="#l206.25"></a><span id="l206.25" class="difflineplus">+nsresult nsNewsDownloader::ShowProgress(const char16_t *progressString, int32_t percent)</span>
<a href="#l206.26"></a><span id="l206.26"> {</span>
<a href="#l206.27"></a><span id="l206.27">   if (!m_statusFeedback)</span>
<a href="#l206.28"></a><span id="l206.28">   {</span>
<a href="#l206.29"></a><span id="l206.29">     if (m_window)</span>
<a href="#l206.30"></a><span id="l206.30">       m_window-&gt;GetStatusFeedback(getter_AddRefs(m_statusFeedback));</span>
<a href="#l206.31"></a><span id="l206.31">   }</span>
<a href="#l206.32"></a><span id="l206.32">   if (m_statusFeedback)</span>
<a href="#l206.33"></a><span id="l206.33">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l207.1"></a><span id="l207.1" class="difflineminus">--- a/mailnews/news/src/nsNewsDownloader.h</span>
<a href="#l207.2"></a><span id="l207.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsDownloader.h</span>
<a href="#l207.3"></a><span id="l207.3" class="difflineat">@@ -34,17 +34,17 @@ public:</span>
<a href="#l207.4"></a><span id="l207.4"> protected:</span>
<a href="#l207.5"></a><span id="l207.5">   virtual int32_t Write(const char * /*block*/, int32_t length) {return length;}</span>
<a href="#l207.6"></a><span id="l207.6">   virtual void Abort();</span>
<a href="#l207.7"></a><span id="l207.7">   virtual void Complete();</span>
<a href="#l207.8"></a><span id="l207.8">   virtual bool GetNextHdrToRetrieve();</span>
<a href="#l207.9"></a><span id="l207.9">   virtual nsresult DownloadNext(bool firstTimeP);</span>
<a href="#l207.10"></a><span id="l207.10">   virtual int32_t FinishDownload() {return 0;}</span>
<a href="#l207.11"></a><span id="l207.11">   virtual int32_t  StartDownload() {return 0;}</span>
<a href="#l207.12"></a><span id="l207.12" class="difflineminus">-  virtual nsresult ShowProgress(const PRUnichar *progressString, int32_t percent);</span>
<a href="#l207.13"></a><span id="l207.13" class="difflineplus">+  virtual nsresult ShowProgress(const char16_t *progressString, int32_t percent);</span>
<a href="#l207.14"></a><span id="l207.14"> </span>
<a href="#l207.15"></a><span id="l207.15">   nsTArray&lt;nsMsgKey&gt;      m_keysToDownload;</span>
<a href="#l207.16"></a><span id="l207.16">   nsCOMPtr &lt;nsIMsgFolder&gt;  m_folder;</span>
<a href="#l207.17"></a><span id="l207.17">   nsCOMPtr &lt;nsIMsgDatabase&gt; m_newsDB;</span>
<a href="#l207.18"></a><span id="l207.18">   nsCOMPtr &lt;nsIUrlListener&gt; m_listener;</span>
<a href="#l207.19"></a><span id="l207.19">   bool m_downloadFromKeys;</span>
<a href="#l207.20"></a><span id="l207.20">   bool m_existedP;</span>
<a href="#l207.21"></a><span id="l207.21">   bool m_wroteAnyP;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l208.1"></a><span id="l208.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l208.2"></a><span id="l208.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l208.3"></a><span id="l208.3" class="difflineat">@@ -675,17 +675,17 @@ nsresult nsMsgNewsFolder::AbbreviatePret</span>
<a href="#l208.4"></a><span id="l208.4">   // build the ellipsis</span>
<a href="#l208.5"></a><span id="l208.5">   nsAutoString out;</span>
<a href="#l208.6"></a><span id="l208.6">   out += name[0];</span>
<a href="#l208.7"></a><span id="l208.7"> </span>
<a href="#l208.8"></a><span id="l208.8">   int32_t length = name.Length();</span>
<a href="#l208.9"></a><span id="l208.9">   int32_t newword = 0;     // == 2 if done with all abbreviated words</span>
<a href="#l208.10"></a><span id="l208.10"> </span>
<a href="#l208.11"></a><span id="l208.11">   fullwords = 0;</span>
<a href="#l208.12"></a><span id="l208.12" class="difflineminus">-  PRUnichar currentChar;</span>
<a href="#l208.13"></a><span id="l208.13" class="difflineplus">+  char16_t currentChar;</span>
<a href="#l208.14"></a><span id="l208.14">   for (int32_t i = 1; i &lt; length; i++)</span>
<a href="#l208.15"></a><span id="l208.15">   {</span>
<a href="#l208.16"></a><span id="l208.16">     // this temporary assignment is needed to fix an intel mac compiler bug.</span>
<a href="#l208.17"></a><span id="l208.17">     // See Bug #327037 for details.</span>
<a href="#l208.18"></a><span id="l208.18">     currentChar = name[i];</span>
<a href="#l208.19"></a><span id="l208.19">     if (newword &lt; 2) {</span>
<a href="#l208.20"></a><span id="l208.20">       switch (currentChar) {</span>
<a href="#l208.21"></a><span id="l208.21">       case '.':</span>
<a href="#l208.22"></a><span id="l208.22" class="difflineat">@@ -1371,17 +1371,17 @@ nsMsgNewsFolder::GetAuthenticationCreden</span>
<a href="#l208.23"></a><span id="l208.23"> </span>
<a href="#l208.24"></a><span id="l208.24">       nsCOMPtr&lt;nsINntpIncomingServer&gt; nntpServer;</span>
<a href="#l208.25"></a><span id="l208.25">       rv = GetNntpServer(getter_AddRefs(nntpServer));</span>
<a href="#l208.26"></a><span id="l208.26">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l208.27"></a><span id="l208.27"> </span>
<a href="#l208.28"></a><span id="l208.28">       bool singleSignon = true;</span>
<a href="#l208.29"></a><span id="l208.29">       nntpServer-&gt;GetSingleSignon(&amp;singleSignon);</span>
<a href="#l208.30"></a><span id="l208.30"> </span>
<a href="#l208.31"></a><span id="l208.31" class="difflineminus">-      const PRUnichar *params[2];</span>
<a href="#l208.32"></a><span id="l208.32" class="difflineplus">+      const char16_t *params[2];</span>
<a href="#l208.33"></a><span id="l208.33">       params[0] = mName.get();</span>
<a href="#l208.34"></a><span id="l208.34">       params[1] = serverName.get();</span>
<a href="#l208.35"></a><span id="l208.35">       if (singleSignon)</span>
<a href="#l208.36"></a><span id="l208.36">         bundle-&gt;FormatStringFromName(</span>
<a href="#l208.37"></a><span id="l208.37">           MOZ_UTF16(&quot;enterUserPassServer&quot;),</span>
<a href="#l208.38"></a><span id="l208.38">           &amp;params[1], 1, getter_Copies(promptText));</span>
<a href="#l208.39"></a><span id="l208.39">       else</span>
<a href="#l208.40"></a><span id="l208.40">         bundle-&gt;FormatStringFromName(</span>
<a href="#l208.41"></a><span id="l208.41" class="difflineat">@@ -1389,19 +1389,19 @@ nsMsgNewsFolder::GetAuthenticationCreden</span>
<a href="#l208.42"></a><span id="l208.42">           params, 2, getter_Copies(promptText));</span>
<a href="#l208.43"></a><span id="l208.43"> </span>
<a href="#l208.44"></a><span id="l208.44">       // Fill the signon url for the dialog</span>
<a href="#l208.45"></a><span id="l208.45">       nsString signonURL;</span>
<a href="#l208.46"></a><span id="l208.46">       rv = CreateNewsgroupUrlForSignon(nullptr, signonURL);</span>
<a href="#l208.47"></a><span id="l208.47">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l208.48"></a><span id="l208.48"> </span>
<a href="#l208.49"></a><span id="l208.49">       // Prefill saved username/password</span>
<a href="#l208.50"></a><span id="l208.50" class="difflineminus">-      PRUnichar *uniGroupUsername = ToNewUnicode(</span>
<a href="#l208.51"></a><span id="l208.51" class="difflineplus">+      char16_t *uniGroupUsername = ToNewUnicode(</span>
<a href="#l208.52"></a><span id="l208.52">         NS_ConvertASCIItoUTF16(mGroupUsername));</span>
<a href="#l208.53"></a><span id="l208.53" class="difflineminus">-      PRUnichar *uniGroupPassword = ToNewUnicode(</span>
<a href="#l208.54"></a><span id="l208.54" class="difflineplus">+      char16_t *uniGroupPassword = ToNewUnicode(</span>
<a href="#l208.55"></a><span id="l208.55">         NS_ConvertASCIItoUTF16(mGroupPassword));</span>
<a href="#l208.56"></a><span id="l208.56"> </span>
<a href="#l208.57"></a><span id="l208.57">       // Prompt for the dialog</span>
<a href="#l208.58"></a><span id="l208.58">       rv = dialog-&gt;PromptUsernameAndPassword(promptTitle.get(),</span>
<a href="#l208.59"></a><span id="l208.59">         promptText.get(), signonURL.get(),</span>
<a href="#l208.60"></a><span id="l208.60">         nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY,</span>
<a href="#l208.61"></a><span id="l208.61">         &amp;uniGroupUsername, &amp;uniGroupPassword, validCredentials);</span>
<a href="#l208.62"></a><span id="l208.62"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l209.1"></a><span id="l209.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l209.2"></a><span id="l209.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l209.3"></a><span id="l209.3" class="difflineat">@@ -1155,23 +1155,23 @@ NS_IMETHODIMP</span>
<a href="#l209.4"></a><span id="l209.4"> nsNntpIncomingServer::GetSubscribeListener(nsISubscribeListener **aListener)</span>
<a href="#l209.5"></a><span id="l209.5"> {</span>
<a href="#l209.6"></a><span id="l209.6">     nsresult rv = EnsureInner();</span>
<a href="#l209.7"></a><span id="l209.7">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l209.8"></a><span id="l209.8">     return mInner-&gt;GetSubscribeListener(aListener);</span>
<a href="#l209.9"></a><span id="l209.9"> }</span>
<a href="#l209.10"></a><span id="l209.10"> </span>
<a href="#l209.11"></a><span id="l209.11"> NS_IMETHODIMP</span>
<a href="#l209.12"></a><span id="l209.12" class="difflineminus">-nsNntpIncomingServer::Subscribe(const PRUnichar *aUnicharName)</span>
<a href="#l209.13"></a><span id="l209.13" class="difflineplus">+nsNntpIncomingServer::Subscribe(const char16_t *aUnicharName)</span>
<a href="#l209.14"></a><span id="l209.14"> {</span>
<a href="#l209.15"></a><span id="l209.15">   return SubscribeToNewsgroup(NS_ConvertUTF16toUTF8(aUnicharName));</span>
<a href="#l209.16"></a><span id="l209.16"> }</span>
<a href="#l209.17"></a><span id="l209.17"> </span>
<a href="#l209.18"></a><span id="l209.18"> NS_IMETHODIMP</span>
<a href="#l209.19"></a><span id="l209.19" class="difflineminus">-nsNntpIncomingServer::Unsubscribe(const PRUnichar *aUnicharName)</span>
<a href="#l209.20"></a><span id="l209.20" class="difflineplus">+nsNntpIncomingServer::Unsubscribe(const char16_t *aUnicharName)</span>
<a href="#l209.21"></a><span id="l209.21"> {</span>
<a href="#l209.22"></a><span id="l209.22">   NS_ENSURE_ARG_POINTER(aUnicharName);</span>
<a href="#l209.23"></a><span id="l209.23"> </span>
<a href="#l209.24"></a><span id="l209.24">   nsresult rv;</span>
<a href="#l209.25"></a><span id="l209.25"> </span>
<a href="#l209.26"></a><span id="l209.26">   nsCOMPtr &lt;nsIMsgFolder&gt; serverFolder;</span>
<a href="#l209.27"></a><span id="l209.27">   rv = GetRootMsgFolder(getter_AddRefs(serverFolder));</span>
<a href="#l209.28"></a><span id="l209.28">   if (NS_FAILED(rv))</span>
<a href="#l209.29"></a><span id="l209.29" class="difflineat">@@ -1570,17 +1570,17 @@ nsNntpIncomingServer::GroupNotFound(nsIM</span>
<a href="#l209.30"></a><span id="l209.30"> </span>
<a href="#l209.31"></a><span id="l209.31">   nsCString hostname;</span>
<a href="#l209.32"></a><span id="l209.32">   rv = GetRealHostName(hostname);</span>
<a href="#l209.33"></a><span id="l209.33">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l209.34"></a><span id="l209.34"> </span>
<a href="#l209.35"></a><span id="l209.35">   NS_ConvertUTF8toUTF16 hostStr(hostname);</span>
<a href="#l209.36"></a><span id="l209.36"> </span>
<a href="#l209.37"></a><span id="l209.37">   nsString groupName(aName);</span>
<a href="#l209.38"></a><span id="l209.38" class="difflineminus">-  const PRUnichar *formatStrings[2] = { groupName.get(), hostStr.get() };</span>
<a href="#l209.39"></a><span id="l209.39" class="difflineplus">+  const char16_t *formatStrings[2] = { groupName.get(), hostStr.get() };</span>
<a href="#l209.40"></a><span id="l209.40">   nsString confirmText;</span>
<a href="#l209.41"></a><span id="l209.41">   rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l209.42"></a><span id="l209.42">                     MOZ_UTF16(&quot;autoUnsubscribeText&quot;),</span>
<a href="#l209.43"></a><span id="l209.43">                     formatStrings, 2,</span>
<a href="#l209.44"></a><span id="l209.44">                     getter_Copies(confirmText));</span>
<a href="#l209.45"></a><span id="l209.45">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l209.46"></a><span id="l209.46"> </span>
<a href="#l209.47"></a><span id="l209.47">   bool confirmResult = false;</span>
<a href="#l209.48"></a><span id="l209.48" class="difflineat">@@ -1732,17 +1732,17 @@ nsNntpIncomingServer::GetRowProperties(i</span>
<a href="#l209.49"></a><span id="l209.49"> NS_IMETHODIMP</span>
<a href="#l209.50"></a><span id="l209.50"> nsNntpIncomingServer::GetCellProperties(int32_t row, nsITreeColumn* col, nsAString&amp; properties)</span>
<a href="#l209.51"></a><span id="l209.51"> {</span>
<a href="#l209.52"></a><span id="l209.52">     if (!IsValidRow(row))</span>
<a href="#l209.53"></a><span id="l209.53">       return NS_ERROR_UNEXPECTED;</span>
<a href="#l209.54"></a><span id="l209.54"> </span>
<a href="#l209.55"></a><span id="l209.55">     NS_ENSURE_ARG_POINTER(col);</span>
<a href="#l209.56"></a><span id="l209.56"> </span>
<a href="#l209.57"></a><span id="l209.57" class="difflineminus">-    const PRUnichar* colID;</span>
<a href="#l209.58"></a><span id="l209.58" class="difflineplus">+    const char16_t* colID;</span>
<a href="#l209.59"></a><span id="l209.59">     col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l209.60"></a><span id="l209.60">     if (colID[0] == 's') {</span>
<a href="#l209.61"></a><span id="l209.61">         // if &lt;name&gt; is in our temporary list of subscribed groups</span>
<a href="#l209.62"></a><span id="l209.62">         // add the &quot;subscribed&quot; property so the check mark shows up</span>
<a href="#l209.63"></a><span id="l209.63">         // in the &quot;subscribedCol&quot;</span>
<a href="#l209.64"></a><span id="l209.64">         if (mSearchResultSortDescending)</span>
<a href="#l209.65"></a><span id="l209.65">           row = mSubscribeSearchResult.Length() - 1 - row;</span>
<a href="#l209.66"></a><span id="l209.66">         if (mTempSubscribed.Contains(mSubscribeSearchResult.ElementAt(row))) {</span>
<a href="#l209.67"></a><span id="l209.67" class="difflineat">@@ -1858,17 +1858,17 @@ nsNntpIncomingServer::GetCellValue(int32</span>
<a href="#l209.68"></a><span id="l209.68"> NS_IMETHODIMP</span>
<a href="#l209.69"></a><span id="l209.69"> nsNntpIncomingServer::GetCellText(int32_t row, nsITreeColumn* col, nsAString&amp; _retval)</span>
<a href="#l209.70"></a><span id="l209.70"> {</span>
<a href="#l209.71"></a><span id="l209.71">     if (!IsValidRow(row))</span>
<a href="#l209.72"></a><span id="l209.72">       return NS_ERROR_UNEXPECTED;</span>
<a href="#l209.73"></a><span id="l209.73"> </span>
<a href="#l209.74"></a><span id="l209.74">     NS_ENSURE_ARG_POINTER(col);</span>
<a href="#l209.75"></a><span id="l209.75"> </span>
<a href="#l209.76"></a><span id="l209.76" class="difflineminus">-    const PRUnichar* colID;</span>
<a href="#l209.77"></a><span id="l209.77" class="difflineplus">+    const char16_t* colID;</span>
<a href="#l209.78"></a><span id="l209.78">     col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l209.79"></a><span id="l209.79"> </span>
<a href="#l209.80"></a><span id="l209.80">     nsresult rv = NS_OK;</span>
<a href="#l209.81"></a><span id="l209.81">     if (colID[0] == 'n') {</span>
<a href="#l209.82"></a><span id="l209.82">       nsAutoCString str;</span>
<a href="#l209.83"></a><span id="l209.83">       if (mSearchResultSortDescending)</span>
<a href="#l209.84"></a><span id="l209.84">         row = mSubscribeSearchResult.Length() - 1 - row;</span>
<a href="#l209.85"></a><span id="l209.85">       // some servers have newsgroup names that are non ASCII.  we store</span>
<a href="#l209.86"></a><span id="l209.86" class="difflineat">@@ -1965,29 +1965,29 @@ nsNntpIncomingServer::SetCellValue(int32</span>
<a href="#l209.87"></a><span id="l209.87"> </span>
<a href="#l209.88"></a><span id="l209.88"> NS_IMETHODIMP</span>
<a href="#l209.89"></a><span id="l209.89"> nsNntpIncomingServer::SetCellText(int32_t row, nsITreeColumn* col, const nsAString&amp; value)</span>
<a href="#l209.90"></a><span id="l209.90"> {</span>
<a href="#l209.91"></a><span id="l209.91">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l209.92"></a><span id="l209.92"> }</span>
<a href="#l209.93"></a><span id="l209.93"> </span>
<a href="#l209.94"></a><span id="l209.94"> NS_IMETHODIMP</span>
<a href="#l209.95"></a><span id="l209.95" class="difflineminus">-nsNntpIncomingServer::PerformAction(const PRUnichar *action)</span>
<a href="#l209.96"></a><span id="l209.96" class="difflineplus">+nsNntpIncomingServer::PerformAction(const char16_t *action)</span>
<a href="#l209.97"></a><span id="l209.97"> {</span>
<a href="#l209.98"></a><span id="l209.98">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l209.99"></a><span id="l209.99"> }</span>
<a href="#l209.100"></a><span id="l209.100"> </span>
<a href="#l209.101"></a><span id="l209.101"> NS_IMETHODIMP</span>
<a href="#l209.102"></a><span id="l209.102" class="difflineminus">-nsNntpIncomingServer::PerformActionOnRow(const PRUnichar *action, int32_t row)</span>
<a href="#l209.103"></a><span id="l209.103" class="difflineplus">+nsNntpIncomingServer::PerformActionOnRow(const char16_t *action, int32_t row)</span>
<a href="#l209.104"></a><span id="l209.104"> {</span>
<a href="#l209.105"></a><span id="l209.105">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l209.106"></a><span id="l209.106"> }</span>
<a href="#l209.107"></a><span id="l209.107"> </span>
<a href="#l209.108"></a><span id="l209.108"> NS_IMETHODIMP</span>
<a href="#l209.109"></a><span id="l209.109" class="difflineminus">-nsNntpIncomingServer::PerformActionOnCell(const PRUnichar *action, int32_t row, nsITreeColumn* col)</span>
<a href="#l209.110"></a><span id="l209.110" class="difflineplus">+nsNntpIncomingServer::PerformActionOnCell(const char16_t *action, int32_t row, nsITreeColumn* col)</span>
<a href="#l209.111"></a><span id="l209.111"> {</span>
<a href="#l209.112"></a><span id="l209.112">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l209.113"></a><span id="l209.113"> }</span>
<a href="#l209.114"></a><span id="l209.114"> </span>
<a href="#l209.115"></a><span id="l209.115"> NS_IMETHODIMP</span>
<a href="#l209.116"></a><span id="l209.116"> nsNntpIncomingServer::GetCanFileMessagesOnServer(bool *aCanFileMessagesOnServer)</span>
<a href="#l209.117"></a><span id="l209.117"> {</span>
<a href="#l209.118"></a><span id="l209.118">     NS_ENSURE_ARG_POINTER(aCanFileMessagesOnServer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l210.1"></a><span id="l210.1" class="difflineminus">--- a/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l210.2"></a><span id="l210.2" class="difflineplus">+++ b/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l210.3"></a><span id="l210.3" class="difflineat">@@ -289,17 +289,17 @@ nsNetscapeProfileMigratorBase::SetCookie</span>
<a href="#l210.4"></a><span id="l210.4"> </span>
<a href="#l210.5"></a><span id="l210.5">   return NS_OK;</span>
<a href="#l210.6"></a><span id="l210.6"> }</span>
<a href="#l210.7"></a><span id="l210.7"> </span>
<a href="#l210.8"></a><span id="l210.8"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l210.9"></a><span id="l210.9"> // General Utility Methods</span>
<a href="#l210.10"></a><span id="l210.10"> </span>
<a href="#l210.11"></a><span id="l210.11"> nsresult</span>
<a href="#l210.12"></a><span id="l210.12" class="difflineminus">-nsNetscapeProfileMigratorBase::GetSourceProfile(const PRUnichar* aProfile)</span>
<a href="#l210.13"></a><span id="l210.13" class="difflineplus">+nsNetscapeProfileMigratorBase::GetSourceProfile(const char16_t* aProfile)</span>
<a href="#l210.14"></a><span id="l210.14"> {</span>
<a href="#l210.15"></a><span id="l210.15">   uint32_t count;</span>
<a href="#l210.16"></a><span id="l210.16">   mProfileNames-&gt;GetLength(&amp;count);</span>
<a href="#l210.17"></a><span id="l210.17">   for (uint32_t i = 0; i &lt; count; ++i) {</span>
<a href="#l210.18"></a><span id="l210.18">     nsCOMPtr&lt;nsISupportsString&gt; str(do_QueryElementAt(mProfileNames, i));</span>
<a href="#l210.19"></a><span id="l210.19">     nsString profileName;</span>
<a href="#l210.20"></a><span id="l210.20">     str-&gt;GetData(profileName);</span>
<a href="#l210.21"></a><span id="l210.21">     if (profileName.Equals(aProfile))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l211.1"></a><span id="l211.1" class="difflineminus">--- a/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l211.2"></a><span id="l211.2" class="difflineplus">+++ b/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l211.3"></a><span id="l211.3" class="difflineat">@@ -97,17 +97,17 @@ public:</span>
<a href="#l211.4"></a><span id="l211.4">   static nsresult SetCookie(PrefTransform* aTransform, nsIPrefBranch* aBranch);</span>
<a href="#l211.5"></a><span id="l211.5"> </span>
<a href="#l211.6"></a><span id="l211.6"> protected:</span>
<a href="#l211.7"></a><span id="l211.7">   // This function is designed to be overriden by derived classes so that</span>
<a href="#l211.8"></a><span id="l211.8">   // the required profile data for the specific application can be obtained.</span>
<a href="#l211.9"></a><span id="l211.9">   virtual nsresult FillProfileDataFromRegistry() = 0;</span>
<a href="#l211.10"></a><span id="l211.10"> </span>
<a href="#l211.11"></a><span id="l211.11">   // General Utility Methods</span>
<a href="#l211.12"></a><span id="l211.12" class="difflineminus">-  nsresult GetSourceProfile(const PRUnichar* aProfile);</span>
<a href="#l211.13"></a><span id="l211.13" class="difflineplus">+  nsresult GetSourceProfile(const char16_t* aProfile);</span>
<a href="#l211.14"></a><span id="l211.14">   nsresult GetProfileDataFromProfilesIni(nsIFile* aDataDir,</span>
<a href="#l211.15"></a><span id="l211.15">                                          nsIMutableArray* aProfileNames,</span>
<a href="#l211.16"></a><span id="l211.16">                                          nsIMutableArray* aProfileLocations);</span>
<a href="#l211.17"></a><span id="l211.17">   nsresult GetFileValue(nsIPrefBranch* aPrefBranch, const char* aRelPrefName,</span>
<a href="#l211.18"></a><span id="l211.18">                         const char* aPrefName, nsIFile** aReturnFile);</span>
<a href="#l211.19"></a><span id="l211.19">   nsresult CopyFile(const char* aSourceFileName,</span>
<a href="#l211.20"></a><span id="l211.20">                     const char* aTargetFileName);</span>
<a href="#l211.21"></a><span id="l211.21">   nsresult RecursiveCopy(nsIFile* srcDir, nsIFile* destDir);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l212.1"></a><span id="l212.1" class="difflineminus">--- a/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp</span>
<a href="#l212.2"></a><span id="l212.2" class="difflineplus">+++ b/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp</span>
<a href="#l212.3"></a><span id="l212.3" class="difflineat">@@ -176,13 +176,13 @@ AnnotatePersonalToolbarFolder(nsIFile* a</span>
<a href="#l212.4"></a><span id="l212.4">   </span>
<a href="#l212.5"></a><span id="l212.5">   outputStream-&gt;Close();</span>
<a href="#l212.6"></a><span id="l212.6">   </span>
<a href="#l212.7"></a><span id="l212.7">   return NS_OK;</span>
<a href="#l212.8"></a><span id="l212.8"> }</span>
<a href="#l212.9"></a><span id="l212.9"> </span>
<a href="#l212.10"></a><span id="l212.10"> nsresult</span>
<a href="#l212.11"></a><span id="l212.11"> ImportBookmarksHTML(nsIFile* aBookmarksFile,</span>
<a href="#l212.12"></a><span id="l212.12" class="difflineminus">-                    const PRUnichar* aImportSourceNameKey)</span>
<a href="#l212.13"></a><span id="l212.13" class="difflineplus">+                    const char16_t* aImportSourceNameKey)</span>
<a href="#l212.14"></a><span id="l212.14"> {</span>
<a href="#l212.15"></a><span id="l212.15">   // XXX: need to make this work with places</span>
<a href="#l212.16"></a><span id="l212.16">   return NS_OK;</span>
<a href="#l212.17"></a><span id="l212.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l213.1"></a><span id="l213.1" class="difflineminus">--- a/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h</span>
<a href="#l213.2"></a><span id="l213.2" class="difflineplus">+++ b/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h</span>
<a href="#l213.3"></a><span id="l213.3" class="difflineat">@@ -71,11 +71,11 @@ void GetProfilePath(nsIProfileStartup* a</span>
<a href="#l213.4"></a><span id="l213.4"> nsresult AnnotatePersonalToolbarFolder(nsIFile* aSourceBookmarksFile,</span>
<a href="#l213.5"></a><span id="l213.5">                                        nsIFile* aTargetBookmarksFile,</span>
<a href="#l213.6"></a><span id="l213.6">                                        const char* aToolbarFolderName);</span>
<a href="#l213.7"></a><span id="l213.7"> </span>
<a href="#l213.8"></a><span id="l213.8"> // In-place import from aBookmarksFile into a folder in the user's bookmarks</span>
<a href="#l213.9"></a><span id="l213.9"> // with the name &quot;From (STR:aImportSourceNameKey)&quot; (aImportSourceNameKey</span>
<a href="#l213.10"></a><span id="l213.10"> // is a key into migration.properties with the pretty name of the application.</span>
<a href="#l213.11"></a><span id="l213.11"> nsresult ImportBookmarksHTML(nsIFile* aBookmarksFile,</span>
<a href="#l213.12"></a><span id="l213.12" class="difflineminus">-                             const PRUnichar* aImportSourceNameKey);</span>
<a href="#l213.13"></a><span id="l213.13" class="difflineplus">+                             const char16_t* aImportSourceNameKey);</span>
<a href="#l213.14"></a><span id="l213.14"> </span>
<a href="#l213.15"></a><span id="l213.15"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l214.1"></a><span id="l214.1" class="difflineminus">--- a/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l214.2"></a><span id="l214.2" class="difflineplus">+++ b/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l214.3"></a><span id="l214.3" class="difflineat">@@ -44,17 +44,17 @@ nsThunderbirdProfileMigrator::~nsThunder</span>
<a href="#l214.4"></a><span id="l214.4"> }</span>
<a href="#l214.5"></a><span id="l214.5"> </span>
<a href="#l214.6"></a><span id="l214.6"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l214.7"></a><span id="l214.7"> // nsISuiteProfileMigrator</span>
<a href="#l214.8"></a><span id="l214.8"> </span>
<a href="#l214.9"></a><span id="l214.9"> NS_IMETHODIMP</span>
<a href="#l214.10"></a><span id="l214.10"> nsThunderbirdProfileMigrator::Migrate(uint16_t aItems,</span>
<a href="#l214.11"></a><span id="l214.11">                                       nsIProfileStartup* aStartup,</span>
<a href="#l214.12"></a><span id="l214.12" class="difflineminus">-                                      const PRUnichar* aProfile)</span>
<a href="#l214.13"></a><span id="l214.13" class="difflineplus">+                                      const char16_t* aProfile)</span>
<a href="#l214.14"></a><span id="l214.14"> {</span>
<a href="#l214.15"></a><span id="l214.15">   nsresult rv = NS_OK;</span>
<a href="#l214.16"></a><span id="l214.16">   bool aReplace = aStartup ? true : false;</span>
<a href="#l214.17"></a><span id="l214.17"> </span>
<a href="#l214.18"></a><span id="l214.18">   if (!mTargetProfile) {</span>
<a href="#l214.19"></a><span id="l214.19">     GetProfilePath(aStartup, getter_AddRefs(mTargetProfile));</span>
<a href="#l214.20"></a><span id="l214.20">     if (!mTargetProfile)</span>
<a href="#l214.21"></a><span id="l214.21">       return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l214.22"></a><span id="l214.22" class="difflineat">@@ -105,17 +105,17 @@ nsThunderbirdProfileMigrator::Migrate(ui</span>
<a href="#l214.23"></a><span id="l214.23">   // asynchronous so the UI doesn't freeze up while we perform</span>
<a href="#l214.24"></a><span id="l214.24">   // this potentially very long operation.</span>
<a href="#l214.25"></a><span id="l214.25">   CopyMailFolders();</span>
<a href="#l214.26"></a><span id="l214.26"> </span>
<a href="#l214.27"></a><span id="l214.27">   return rv;</span>
<a href="#l214.28"></a><span id="l214.28"> }</span>
<a href="#l214.29"></a><span id="l214.29"> </span>
<a href="#l214.30"></a><span id="l214.30"> NS_IMETHODIMP</span>
<a href="#l214.31"></a><span id="l214.31" class="difflineminus">-nsThunderbirdProfileMigrator::GetMigrateData(const PRUnichar* aProfile,</span>
<a href="#l214.32"></a><span id="l214.32" class="difflineplus">+nsThunderbirdProfileMigrator::GetMigrateData(const char16_t* aProfile,</span>
<a href="#l214.33"></a><span id="l214.33">                                              bool aReplace,</span>
<a href="#l214.34"></a><span id="l214.34">                                              uint16_t* aResult)</span>
<a href="#l214.35"></a><span id="l214.35"> {</span>
<a href="#l214.36"></a><span id="l214.36">   *aResult = 0;</span>
<a href="#l214.37"></a><span id="l214.37"> </span>
<a href="#l214.38"></a><span id="l214.38">   if (!mSourceProfile) {</span>
<a href="#l214.39"></a><span id="l214.39">     GetSourceProfile(aProfile);</span>
<a href="#l214.40"></a><span id="l214.40">     if (!mSourceProfile)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l215.1"></a><span id="l215.1" class="difflineminus">--- a/suite/profile/migration/src/nsThunderbirdProfileMigrator.h</span>
<a href="#l215.2"></a><span id="l215.2" class="difflineplus">+++ b/suite/profile/migration/src/nsThunderbirdProfileMigrator.h</span>
<a href="#l215.3"></a><span id="l215.3" class="difflineat">@@ -26,18 +26,18 @@ class nsThunderbirdProfileMigrator : pub</span>
<a href="#l215.4"></a><span id="l215.4"> public:</span>
<a href="#l215.5"></a><span id="l215.5">   NS_DECL_ISUPPORTS</span>
<a href="#l215.6"></a><span id="l215.6"> </span>
<a href="#l215.7"></a><span id="l215.7">   nsThunderbirdProfileMigrator();</span>
<a href="#l215.8"></a><span id="l215.8">   virtual ~nsThunderbirdProfileMigrator();</span>
<a href="#l215.9"></a><span id="l215.9"> </span>
<a href="#l215.10"></a><span id="l215.10">   // nsISuiteProfileMigrator methods</span>
<a href="#l215.11"></a><span id="l215.11">   NS_IMETHOD Migrate(uint16_t aItems, nsIProfileStartup *aStartup,</span>
<a href="#l215.12"></a><span id="l215.12" class="difflineminus">-                     const PRUnichar *aProfile);</span>
<a href="#l215.13"></a><span id="l215.13" class="difflineminus">-  NS_IMETHOD GetMigrateData(const PRUnichar *aProfile, bool aDoingStartup,</span>
<a href="#l215.14"></a><span id="l215.14" class="difflineplus">+                     const char16_t *aProfile);</span>
<a href="#l215.15"></a><span id="l215.15" class="difflineplus">+  NS_IMETHOD GetMigrateData(const char16_t *aProfile, bool aDoingStartup,</span>
<a href="#l215.16"></a><span id="l215.16">                             uint16_t *_retval);</span>
<a href="#l215.17"></a><span id="l215.17">   NS_IMETHOD GetSupportedItems(uint16_t *aSupportedItems);</span>
<a href="#l215.18"></a><span id="l215.18"> </span>
<a href="#l215.19"></a><span id="l215.19"> protected:</span>
<a href="#l215.20"></a><span id="l215.20">   nsresult FillProfileDataFromRegistry();</span>
<a href="#l215.21"></a><span id="l215.21">   nsresult CopyPreferences(bool aReplace);</span>
<a href="#l215.22"></a><span id="l215.22">   nsresult TransformPreferences(const char* aSourcePrefFileName,</span>
<a href="#l215.23"></a><span id="l215.23">                                 const char* aTargetPrefFileName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l216.1"></a><span id="l216.1" class="difflineminus">--- a/suite/shell/src/nsMacShellService.cpp</span>
<a href="#l216.2"></a><span id="l216.2" class="difflineplus">+++ b/suite/shell/src/nsMacShellService.cpp</span>
<a href="#l216.3"></a><span id="l216.3" class="difflineat">@@ -266,17 +266,17 @@ nsMacShellService::OnLocationChange(nsIW</span>
<a href="#l216.4"></a><span id="l216.4"> {</span>
<a href="#l216.5"></a><span id="l216.5">   return NS_OK;</span>
<a href="#l216.6"></a><span id="l216.6"> }</span>
<a href="#l216.7"></a><span id="l216.7"> </span>
<a href="#l216.8"></a><span id="l216.8"> NS_IMETHODIMP</span>
<a href="#l216.9"></a><span id="l216.9"> nsMacShellService::OnStatusChange(nsIWebProgress* aWebProgress,</span>
<a href="#l216.10"></a><span id="l216.10">                                   nsIRequest* aRequest,</span>
<a href="#l216.11"></a><span id="l216.11">                                   nsresult aStatus,</span>
<a href="#l216.12"></a><span id="l216.12" class="difflineminus">-                                  const PRUnichar* aMessage)</span>
<a href="#l216.13"></a><span id="l216.13" class="difflineplus">+                                  const char16_t* aMessage)</span>
<a href="#l216.14"></a><span id="l216.14"> {</span>
<a href="#l216.15"></a><span id="l216.15">   return NS_OK;</span>
<a href="#l216.16"></a><span id="l216.16"> }</span>
<a href="#l216.17"></a><span id="l216.17"> </span>
<a href="#l216.18"></a><span id="l216.18"> NS_IMETHODIMP</span>
<a href="#l216.19"></a><span id="l216.19"> nsMacShellService::OnSecurityChange(nsIWebProgress* aWebProgress,</span>
<a href="#l216.20"></a><span id="l216.20">                                     nsIRequest* aRequest,</span>
<a href="#l216.21"></a><span id="l216.21">                                     uint32_t aState)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l217.1"></a><span id="l217.1" class="difflineminus">--- a/suite/shell/src/nsWindowsShellService.cpp</span>
<a href="#l217.2"></a><span id="l217.2" class="difflineplus">+++ b/suite/shell/src/nsWindowsShellService.cpp</span>
<a href="#l217.3"></a><span id="l217.3" class="difflineat">@@ -45,17 +45,17 @@</span>
<a href="#l217.4"></a><span id="l217.4"> #define REG_FAILED(val) \</span>
<a href="#l217.5"></a><span id="l217.5">   (val != ERROR_SUCCESS)</span>
<a href="#l217.6"></a><span id="l217.6"> </span>
<a href="#l217.7"></a><span id="l217.7"> #define NS_TASKBAR_CONTRACTID &quot;@mozilla.org/windows-taskbar;1&quot;</span>
<a href="#l217.8"></a><span id="l217.8"> </span>
<a href="#l217.9"></a><span id="l217.9"> NS_IMPL_ISUPPORTS2(nsWindowsShellService, nsIWindowsShellService, nsIShellService)</span>
<a href="#l217.10"></a><span id="l217.10"> </span>
<a href="#l217.11"></a><span id="l217.11"> static nsresult</span>
<a href="#l217.12"></a><span id="l217.12" class="difflineminus">-OpenKeyForReading(HKEY aKeyRoot, const PRUnichar* aKeyName, HKEY* aKey)</span>
<a href="#l217.13"></a><span id="l217.13" class="difflineplus">+OpenKeyForReading(HKEY aKeyRoot, const char16_t* aKeyName, HKEY* aKey)</span>
<a href="#l217.14"></a><span id="l217.14"> {</span>
<a href="#l217.15"></a><span id="l217.15">   DWORD res = ::RegOpenKeyExW(aKeyRoot, aKeyName, 0, KEY_READ, aKey);</span>
<a href="#l217.16"></a><span id="l217.16">   switch (res) {</span>
<a href="#l217.17"></a><span id="l217.17">   case ERROR_SUCCESS:</span>
<a href="#l217.18"></a><span id="l217.18">    break;</span>
<a href="#l217.19"></a><span id="l217.19">   case ERROR_ACCESS_DENIED:</span>
<a href="#l217.20"></a><span id="l217.20">     return NS_ERROR_FILE_ACCESS_DENIED;</span>
<a href="#l217.21"></a><span id="l217.21">   case ERROR_FILE_NOT_FOUND:</span>
<a href="#l217.22"></a><span id="l217.22" class="difflineat">@@ -415,17 +415,17 @@ nsWindowsShellService::ShortcutMaintenan</span>
<a href="#l217.23"></a><span id="l217.23"> }</span>
<a href="#l217.24"></a><span id="l217.24"> </span>
<a href="#l217.25"></a><span id="l217.25"> /* helper routine. Iterate over the passed in settings object,</span>
<a href="#l217.26"></a><span id="l217.26">    testing each key to see if we are handling it.</span>
<a href="#l217.27"></a><span id="l217.27"> */</span>
<a href="#l217.28"></a><span id="l217.28"> bool</span>
<a href="#l217.29"></a><span id="l217.29"> nsWindowsShellService::TestForDefault(SETTING aSettings[], int32_t aSize)</span>
<a href="#l217.30"></a><span id="l217.30"> {</span>
<a href="#l217.31"></a><span id="l217.31" class="difflineminus">-  PRUnichar currValue[MAX_BUF];</span>
<a href="#l217.32"></a><span id="l217.32" class="difflineplus">+  char16_t currValue[MAX_BUF];</span>
<a href="#l217.33"></a><span id="l217.33">   SETTING* end = aSettings + aSize;</span>
<a href="#l217.34"></a><span id="l217.34">   for (SETTING * settings = aSettings; settings &lt; end; ++settings) {</span>
<a href="#l217.35"></a><span id="l217.35">     NS_ConvertUTF8toUTF16 dataLongPath(settings-&gt;valueData);</span>
<a href="#l217.36"></a><span id="l217.36">     NS_ConvertUTF8toUTF16 dataShortPath(settings-&gt;valueData);</span>
<a href="#l217.37"></a><span id="l217.37">     NS_ConvertUTF8toUTF16 key(settings-&gt;keyName);</span>
<a href="#l217.38"></a><span id="l217.38">     NS_ConvertUTF8toUTF16 value(settings-&gt;valueName);</span>
<a href="#l217.39"></a><span id="l217.39">     if (settings-&gt;flags &amp; APP_PATH_SUBSTITUTION) {</span>
<a href="#l217.40"></a><span id="l217.40">       int32_t offset = dataLongPath.Find(&quot;%APPPATH%&quot;);</span>
<a href="#l217.41"></a><span id="l217.41" class="difflineat">@@ -458,17 +458,17 @@ nsWindowsShellService::TestForDefault(SE</span>
<a href="#l217.42"></a><span id="l217.42">     }</span>
<a href="#l217.43"></a><span id="l217.43">   }</span>
<a href="#l217.44"></a><span id="l217.44"> </span>
<a href="#l217.45"></a><span id="l217.45">   return true;</span>
<a href="#l217.46"></a><span id="l217.46"> }</span>
<a href="#l217.47"></a><span id="l217.47"> </span>
<a href="#l217.48"></a><span id="l217.48"> nsresult nsWindowsShellService::Init()</span>
<a href="#l217.49"></a><span id="l217.49"> {</span>
<a href="#l217.50"></a><span id="l217.50" class="difflineminus">-  PRUnichar appPath[MAX_BUF];</span>
<a href="#l217.51"></a><span id="l217.51" class="difflineplus">+  char16_t appPath[MAX_BUF];</span>
<a href="#l217.52"></a><span id="l217.52">   if (!::GetModuleFileNameW(0, appPath, MAX_BUF))</span>
<a href="#l217.53"></a><span id="l217.53">     return NS_ERROR_FAILURE;</span>
<a href="#l217.54"></a><span id="l217.54"> </span>
<a href="#l217.55"></a><span id="l217.55">   mAppLongPath = appPath;</span>
<a href="#l217.56"></a><span id="l217.56"> </span>
<a href="#l217.57"></a><span id="l217.57">   // Support short path to the exe so if it is already set the user is not</span>
<a href="#l217.58"></a><span id="l217.58">   // prompted to set the default mail client again.</span>
<a href="#l217.59"></a><span id="l217.59">   if (!::GetShortPathNameW(appPath, appPath, MAX_BUF))</span>
<a href="#l217.60"></a><span id="l217.60" class="difflineat">@@ -844,17 +844,17 @@ nsWindowsShellService::SetDesktopBackgro</span>
<a href="#l217.61"></a><span id="l217.61">   nsCOMPtr&lt;nsIWindowsRegKey&gt; key(do_CreateInstance(&quot;@mozilla.org/windows-registry-key;1&quot;, &amp;rv));</span>
<a href="#l217.62"></a><span id="l217.62">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l217.63"></a><span id="l217.63"> </span>
<a href="#l217.64"></a><span id="l217.64">   rv = key-&gt;Create(nsIWindowsRegKey::ROOT_KEY_CURRENT_USER,</span>
<a href="#l217.65"></a><span id="l217.65">                    NS_LITERAL_STRING(&quot;Control Panel\\Colors&quot;),</span>
<a href="#l217.66"></a><span id="l217.66">                    nsIWindowsRegKey::ACCESS_SET_VALUE);</span>
<a href="#l217.67"></a><span id="l217.67">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l217.68"></a><span id="l217.68"> </span>
<a href="#l217.69"></a><span id="l217.69" class="difflineminus">-  PRUnichar rgb[12];</span>
<a href="#l217.70"></a><span id="l217.70" class="difflineplus">+  char16_t rgb[12];</span>
<a href="#l217.71"></a><span id="l217.71">   _snwprintf(rgb, 12, L&quot;%u %u %u&quot;, r, g, b);</span>
<a href="#l217.72"></a><span id="l217.72">   rv = key-&gt;WriteStringValue(NS_LITERAL_STRING(&quot;Background&quot;),</span>
<a href="#l217.73"></a><span id="l217.73">                              nsDependentString(rgb));</span>
<a href="#l217.74"></a><span id="l217.74">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l217.75"></a><span id="l217.75"> </span>
<a href="#l217.76"></a><span id="l217.76">   return key-&gt;Close();</span>
<a href="#l217.77"></a><span id="l217.77"> }</span>
<a href="#l217.78"></a><span id="l217.78"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

