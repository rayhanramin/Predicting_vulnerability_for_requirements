<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 15392:6c15e451a8d573e9525914f70b2b2657522961ed</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6c15e451a8d573e9525914f70b2b2657522961ed" />
<meta property="og:url" content="/comm-central/rev/6c15e451a8d573e9525914f70b2b2657522961ed" />
<meta property="og:description" content="Bug 955492 - New conversation tab needs to display open conversations and those on hold, r=florian,Mic,aleth" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6c15e451a8d573e9525914f70b2b2657522961ed 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6c15e451a8d573e9525914f70b2b2657522961ed">shortlog</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6c15e451a8d573e9525914f70b2b2657522961ed">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed">files</a> |
changeset |
<a href="/comm-central/raw-rev/6c15e451a8d573e9525914f70b2b2657522961ed">raw</a>  | <a href="/comm-central/archive/6c15e451a8d573e9525914f70b2b2657522961ed.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=955492">Bug 955492</a> - New conversation tab needs to display open conversations and those on hold, r=florian,Mic,aleth
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#78;&#105;&#104;&#97;&#110;&#116;&#104;&#32;&#83;&#117;&#98;&#114;&#97;&#109;&#97;&#110;&#121;&#97;&#32;&#60;&#110;&#104;&#110;&#116;&#49;&#49;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 24 Jul 2013 22:43:14 +0530</td></tr>

<tr>
 <td>changeset 15392</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6c15e451a8d573e9525914f70b2b2657522961ed">6c15e451a8d573e9525914f70b2b2657522961ed</a></td>
</tr>



<tr>
<td>parent 15391</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a23947f2be24f176e3eb95a8f3db62f099321cb2">a23947f2be24f176e3eb95a8f3db62f099321cb2</a>
</td>
</tr>

<tr>
<td>child 15393</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4e2488508ab86dee14c05afc59eba6ad2c46db9f">4e2488508ab86dee14c05afc59eba6ad2c46db9f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6c15e451a8d573e9525914f70b2b2657522961ed">9778</a></td></tr>
<tr><td>push user</td><td>florian@queze.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 12 Jan 2014 18:25:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f81a23bfefcd [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28florian%29&revcount=50">florian</a>, <a href="/comm-central/log?rev=reviewer%28Mic%29&revcount=50">Mic</a>, <a href="/comm-central/log?rev=reviewer%28aleth%29&revcount=50">aleth</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=955492">955492</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=955492">Bug 955492</a> - New conversation tab needs to display open conversations and those on hold, r=florian,Mic,aleth</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/Makefile.in">im/components/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/Makefile.in">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/Makefile.in">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/Makefile.in">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/Makefile.in">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.js">im/components/ibConvStatsService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.js">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.js">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.js">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.js">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.manifest">im/components/ibConvStatsService.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.manifest">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.manifest">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.manifest">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.manifest">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibConvStatsService.manifest">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibIConvStatsService.idl">im/components/ibIConvStatsService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibIConvStatsService.idl">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibIConvStatsService.idl">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibIConvStatsService.idl">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibIConvStatsService.idl">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/components/ibIConvStatsService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/instantbird.css">im/content/instantbird.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/instantbird.css">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/instantbird.css">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/instantbird.css">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/instantbird.css">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/instantbird.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/newtab.xml">im/content/newtab.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/newtab.xml">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/newtab.xml">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/newtab.xml">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/newtab.xml">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/content/newtab.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/installer/package-manifest.in">im/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/installer/package-manifest.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/locales/en-US/chrome/instantbird/newtab.properties">im/locales/en-US/chrome/instantbird/newtab.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/locales/en-US/chrome/instantbird/newtab.properties">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/locales/en-US/chrome/instantbird/newtab.properties">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/locales/en-US/chrome/instantbird/newtab.properties">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/locales/en-US/chrome/instantbird/newtab.properties">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/locales/en-US/chrome/instantbird/newtab.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-linux.png">im/themes/actionicon-tab-linux.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-linux.png">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-linux.png">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-linux.png">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-linux.png">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-linux.png">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac.png">im/themes/actionicon-tab-mac.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac.png">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac.png">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac.png">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac.png">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac.png">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac%402x.png">im/themes/actionicon-tab-mac@2x.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac%402x.png">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac%402x.png">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac%402x.png">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac%402x.png">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-mac%402x.png">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-win.png">im/themes/actionicon-tab-win.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-win.png">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-win.png">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-win.png">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-win.png">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/actionicon-tab-win.png">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/jar.mn">im/themes/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/jar.mn">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/jar.mn">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/jar.mn">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/jar.mn">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/newtab.css">im/themes/newtab.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/newtab.css">file</a> |
<a href="/comm-central/annotate/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/newtab.css">annotate</a> |
<a href="/comm-central/diff/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/newtab.css">diff</a> |
<a href="/comm-central/comparison/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/newtab.css">comparison</a> |
<a href="/comm-central/log/6c15e451a8d573e9525914f70b2b2657522961ed/im/themes/newtab.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/components/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/components/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -11,22 +11,29 @@ include $(DEPTH)/config/autoconf.mk</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> ifneq ($(MOZ_WIDGET_TOOLKIT),cocoa)</span>
<a href="#l1.6"></a><span id="l1.6"> DIRS = mintrayr</span>
<a href="#l1.7"></a><span id="l1.7"> endif</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> EXTRA_COMPONENTS = \</span>
<a href="#l1.10"></a><span id="l1.10"> 	contentHandler.js contentHandler.manifest \</span>
<a href="#l1.11"></a><span id="l1.11"> 	ibCommandLineHandler.manifest \</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+	ibConvStatsService.js ibConvStatsService.manifest \</span>
<a href="#l1.13"></a><span id="l1.13"> 	ibStatusCommandLineHandler.js ibStatusCommandLineHandler.manifest \</span>
<a href="#l1.14"></a><span id="l1.14"> 	$(NULL)</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> EXTRA_PP_COMPONENTS = \</span>
<a href="#l1.17"></a><span id="l1.17"> 	ibCommandLineHandler.js \</span>
<a href="#l1.18"></a><span id="l1.18"> 	$(NULL)</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+MODULE = instantbird</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+XPIDLSRCS = \</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+	ibIConvStatsService.idl \</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+	$(NULL)</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+</span>
<a href="#l1.26"></a><span id="l1.26"> ifeq ($(MOZ_WIDGET_TOOLKIT),cocoa)</span>
<a href="#l1.27"></a><span id="l1.27"> EXTRA_COMPONENTS += ibDockBadge.js ibDockBadge.manifest</span>
<a href="#l1.28"></a><span id="l1.28"> else</span>
<a href="#l1.29"></a><span id="l1.29"> EXTRA_COMPONENTS += profileMigrator.js profileMigrator.manifest</span>
<a href="#l1.30"></a><span id="l1.30"> endif</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32"> include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/im/components/ibConvStatsService.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,222 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+const {interfaces: Ci, utils: Cu} = Components;</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+Cu.import(&quot;resource:///modules/imXPCOMUtils.jsm&quot;);</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+Cu.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+const kNotificationsToObserve =</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  [&quot;contact-added&quot;, &quot;contact-removed&quot;,&quot;contact-status-changed&quot;,</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+   &quot;contact-display-name-changed&quot;, &quot;contact-no-longer-dummy&quot;,</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+   &quot;contact-preferred-buddy-changed&quot;, &quot;contact-moved&quot;];</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+XPCOMUtils.defineLazyGetter(this, &quot;_newtab&quot;, function()</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+  l10nHelper(&quot;chrome://instantbird/locale/newtab.properties&quot;)</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+);</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+XPCOMUtils.defineLazyGetter(this, &quot;_instantbird&quot;, function()</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+  l10nHelper(&quot;chrome://instantbird/locale/instantbird.properties&quot;)</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+);</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+function ConvStatsService() {}</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+ConvStatsService.prototype = {</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+  // Sorted list of contacts, stored as PossibleConvFromContacts.</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+  _contacts: [],</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+  // PossibleConvFromContacts stored by id.</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+  _contactsById: new Map(),</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  _observers: [],</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+  _initContacts: function() {</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+    let contacts = Services.contacts.getContacts();</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+    for (let contact of contacts)</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+      this._addContact(contact);</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+    for (let notification of kNotificationsToObserve)</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+      Services.obs.addObserver(this, notification, false);</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+  },</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+  _addContact: function(aContact) {</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+    if (this._contactsById.has(aContact.id)) // Already added.</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+      return;</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+    let possibleConv = new PossibleConvFromContact(aContact);</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+    let pos = this._getPositionToInsert(possibleConv, this._contacts);</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+    this._contacts.splice(pos, 0, possibleConv);</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+    this._contactsById.set(aContact.id, possibleConv);</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+  },</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  _removeContact: function(aId) {</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+    if (!this._contactsById.has(aId))</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+      return;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+    this._contacts.splice(</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+      this._contacts.indexOf(this._contactsById.get(aId)), 1);</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+    this._contactsById.delete(aId);</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+  },</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+  _getPositionToInsert: function(aPossibleConversation, aArrayToInsert) {</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+    let end = aArrayToInsert.length;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+    // Avoid the binary search loop if aArrayToInsert was already sorted.</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+    if (end == 0 ||</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+        this._sortComparator(aPossibleConversation, aArrayToInsert[end - 1]) &gt;= 0)</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+      return end;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+    let start = 0;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+    while (start &lt; end) {</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+      let middle = Math.floor((start + end) / 2);</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+      if (this._sortComparator(aPossibleConversation, aArrayToInsert[middle]) &lt; 0)</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+        end = middle;</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+      else</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+        start = middle + 1;</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+    }</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+    return end;</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+  },</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+  _sortComparator: function(aPossibleConvA, aPossibleConvB) {</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+    return (aPossibleConvB.statusType - aPossibleConvA.statusType) ||</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+      aPossibleConvA.lowerCaseName.localeCompare(aPossibleConvB.lowerCaseName);</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+  },</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+  getFilteredConvs: function(aFilterStr, aFilteredConvsCount) {</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+    // Clone this._contacts to ensure it doesn't get modified</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    // when we insert ui conversations.</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+    let filteredConvs = this._contacts.slice(0);</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+    let existingConvs = Services.conversations.getUIConversations().map(</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+                          function(uiConv) new ExistingConversation(uiConv));</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+    for (let existingConv of existingConvs) {</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+      let pos = this._getPositionToInsert(existingConv, filteredConvs);</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+      filteredConvs.splice(pos, 0, existingConv);</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+      // Remove the contact to prevent a duplicate.</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+      let contact = existingConv.uiConv.contact;</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+      if (contact &amp;&amp; this._contactsById.has(contact.id)) {</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+        filteredConvs.splice(</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+          filteredConvs.indexOf(this._contactsById.get(contact.id)), 1);</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+      }</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+    }</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+    if (aFilterStr) {</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+      aFilterStr = aFilterStr.toLowerCase();</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+      filteredConvs = filteredConvs.filter(function(c) {</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+        return c.lowerCaseName.startsWith(aFilterStr) ||</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+          c.lowerCaseName.split(/\s+/).some(function(s) s.startsWith(aFilterStr));</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+      });</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+    }</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineplus">+    if (aFilteredConvsCount)</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineplus">+      aFilteredConvsCount.value = filteredConvs.length;</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineplus">+    return filteredConvs;</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+  },</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+  addObserver: function(aObserver) {</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+      this._observers.push(aObserver);</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+  },</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineplus">+  removeObserver: function(aObserver) {</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+    this._observers = this._observers.filter(function(o) o !== aObserver);</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+  },</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+  _notifyObservers: function(aTopic) {</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+    for each (let observer in this._observers) {</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineplus">+      if (&quot;observe&quot; in observer) // Avoid failing on destructed XBL bindings.</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+        observer.observe(this, &quot;stats-service-&quot; + aTopic);</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+    }</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineplus">+  },</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineplus">+</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineplus">+  observe: function(aSubject, aTopic, aData) {</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+    if (aTopic == &quot;profile-after-change&quot;)</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+      Services.obs.addObserver(this, &quot;prpl-init&quot;, false);</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+    else if (aTopic == &quot;prpl-init&quot;) {</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+      executeSoon(this._initContacts.bind(this));</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineplus">+      Services.obs.removeObserver(this, &quot;prpl-init&quot;);</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+    }</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+    if (!aTopic.startsWith(&quot;contact-&quot;))</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+      return;</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+    if (aTopic == &quot;contact-no-longer-dummy&quot;) {</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineplus">+      // Contact ID changed. aData is the old ID.</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+      let id = aSubject.id;</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+      let oldId = parseInt(aData, 10);</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+      this._contactsById.set(id, this._contactsById.get(oldId));</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+      this._contactsById.delete(oldId);</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+      this._contactsById.get(id)._id = id;</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+      return;</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineplus">+    }</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineplus">+    else if (aTopic == &quot;contact-added&quot;)</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineplus">+      this._addContact(aSubject);</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineplus">+    else if (aTopic == &quot;contact-removed&quot;)</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineplus">+      this._removeContact(aSubject.id);</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineplus">+    else {</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineplus">+      // A change in the contact's status or display name may cause the</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineplus">+      // order to change, so we simply remove and re-add it.</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineplus">+      this._removeContact(aSubject.id);</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineplus">+      this._addContact(aSubject);</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineplus">+    }</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineplus">+    this._notifyObservers(&quot;contact-updated&quot;);</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineplus">+  },</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineplus">+</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Ci.nsIObserver, Ci.ibIConvStatsService]),</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+  classDescription: &quot;ConvStatsService&quot;,</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineplus">+  classID: Components.ID(&quot;{1d9be575-87a4-4f2f-b414-c67a560f29fd}&quot;),</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineplus">+  contractID: &quot;@instantbird.org/conv-stats-service;1&quot;</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineplus">+};</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineplus">+</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineplus">+let PossibleConversation = {</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineplus">+  get displayName() this._displayName,</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineplus">+  get lowerCaseName() {</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineplus">+    delete this.lowerCaseName;</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineplus">+    return  this.lowerCaseName = this._displayName.toLowerCase();</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineplus">+  },</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineplus">+  _isChat: false, // False by default. Extensions should override this.</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineplus">+  get isChat() this._isChat,</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineplus">+  get statusType() this._statusType,</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineplus">+  get statusText() this._statusText,</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+  get infoText() this._infoText,</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+  get buddyIconFilename() this._buddyIconFilename,</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Ci.ibIPossibleConversation])</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineplus">+};</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineplus">+</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineplus">+function PossibleConvFromContact(aContact) {</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineplus">+  this._displayName = aContact.displayName;</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineplus">+  this._statusType = aContact.statusType;</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineplus">+  this._statusText = aContact.statusText;</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineplus">+  this._buddyIconFilename = aContact.preferredBuddy.buddyIconFilename;</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineplus">+  this._id = aContact.id;</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineplus">+}</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineplus">+PossibleConvFromContact.prototype = {</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineplus">+  __proto__: PossibleConversation,</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineplus">+  get source() &quot;contact&quot;,</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineplus">+  get infoText() {</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+    let tagNames = this.contact.getTags().map(function(aTag) aTag.name);</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineplus">+    tagNames.sort(function(a, b) a.toLowerCase().localeCompare(b.toLowerCase()));</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineplus">+    return tagNames.join(&quot;, &quot;);</span>
<a href="#l2.191"></a><span id="l2.191" class="difflineplus">+  },</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineplus">+  get contact() Services.contacts.getContactById(this._id),</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineplus">+  get account() this.contact.preferredBuddy.preferredAccountBuddy.account,</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineplus">+  createConversation: function() this.contact.createConversation()</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineplus">+};</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineplus">+</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineplus">+function ExistingConversation(aUIConv) {</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineplus">+  this._id = aUIConv.target.id;</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineplus">+  this._displayName = aUIConv.title;</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineplus">+  this._isChat = aUIConv.isChat;</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineplus">+  if (aUIConv.isChat) {</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineplus">+    this._statusText = aUIConv.topic || _instantbird(&quot;noTopic&quot;);</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineplus">+    this._statusType = aUIConv.account.connected &amp;&amp; !aUIConv.left ?</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineplus">+      Ci.imIStatusInfo.STATUS_AVAILABLE : Ci.imIStatusInfo.STATUS_OFFLINE;</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineplus">+    this._buddyIconFilename = &quot;&quot;;</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineplus">+  }</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineplus">+  else {</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineplus">+    let buddy = aUIConv.buddy;</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineplus">+    this._statusType = buddy.statusType;</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineplus">+    this._statusText = buddy.statusText;</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineplus">+    this._buddyIconFilename = buddy.buddyIconFilename;</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineplus">+  }</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineplus">+  this._infoText = _newtab(&quot;existingConv.infoText&quot;);</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineplus">+}</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+ExistingConversation.prototype = {</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineplus">+  __proto__: PossibleConversation,</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineplus">+  get source() &quot;existing&quot;,</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineplus">+  get uiConv() {</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineplus">+    return Services.conversations.getUIConversation(Services.conversations</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineplus">+                   .getConversationById(this._id));</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineplus">+  },</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineplus">+  get account() this.uiConv.account,</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineplus">+  createConversation: function() this.uiConv.target</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineplus">+};</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineplus">+</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineplus">+const NSGetFactory = XPCOMUtils.generateNSGetFactory([ConvStatsService]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/im/components/ibConvStatsService.manifest</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+component {1d9be575-87a4-4f2f-b414-c67a560f29fd} ibConvStatsService.js</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+contract @instantbird.org/conv-stats-service;1 {1d9be575-87a4-4f2f-b414-c67a560f29fd}</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+category profile-after-change ConvStatsService @instantbird.org/conv-stats-service;1</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- /dev/null</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ b/im/components/ibIConvStatsService.idl</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -0,0 +1,42 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+#include &quot;nsISupports.idl&quot;</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+#include &quot;nsIObserver.idl&quot;</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+#include &quot;imIStatusInfo.idl&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+interface ibIPossibleConversation;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+interface imIAccount;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+interface imIAccountBuddy;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+interface imIContact;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+[scriptable, uuid(1b495592-8512-4443-bcdb-49118f045e42)]</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+interface ibIConvStatsService: nsISupports {</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+  // Returns an array of PossibleConversations which match the given filter string.</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+  void getFilteredConvs(in AUTF8String aFilterStr,</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+    [optional] out unsigned long filteredConvCount,</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+    [retval, array, size_is(filteredConvCount)] out ibIPossibleConversation filteredConvs);</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+  // A stats-service-contact-updated notification is fired when a contact has</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+  // been updated and observers need to refresh.</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+  void addObserver(in nsIObserver aObserver);</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+  void removeObserver(in nsIObserver aObserver);</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+};</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+[scriptable, uuid(e7e5e7ba-203c-47ea-8174-55b5e5d8131f)]</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+// Inherits from imIStatusInfo to avoid code duplication.</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+interface ibIPossibleConversation: imIStatusInfo {</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+  /* The source of the possible conversation. Possible values are:</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+   * &quot;contact&quot;  - From an imIContact.</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+   * &quot;existing&quot; - From an imIConversation.</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+   */</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+  readonly attribute AUTF8String source;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+  readonly attribute imIAccount account;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+  // If the possible conversation is a chat, statusText will give its topic.</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+  readonly attribute boolean isChat;</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+  /* Provides additional info about the conversation depending on the source:</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+   * &quot;contact&quot;  - The contact's tags (comma separated).</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+   * &quot;existing&quot; - Localized string existingConv.infoText (newtab.properties).</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+   */</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+  readonly attribute AUTF8String infoText;</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/im/content/instantbird.css</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/im/content/instantbird.css</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -5,18 +5,18 @@</span>
<a href="#l5.4"></a><span id="l5.4"> conversation {</span>
<a href="#l5.5"></a><span id="l5.5">   -moz-binding: url(&quot;chrome://instantbird/content/conversation.xml#conversation&quot;);</span>
<a href="#l5.6"></a><span id="l5.6"> }</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> newtab {</span>
<a href="#l5.9"></a><span id="l5.9">   -moz-binding: url(&quot;chrome://instantbird/content/newtab.xml#newtab&quot;);</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-.newtab-contact {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-  -moz-binding: url(&quot;chrome://instantbird/content/newtab.xml#newtab-contact&quot;);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+.newtab-item {</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+  -moz-binding: url(&quot;chrome://instantbird/content/newtab.xml#newtab-item&quot;);</span>
<a href="#l5.16"></a><span id="l5.16"> }</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> aboutPanel {</span>
<a href="#l5.19"></a><span id="l5.19">   -moz-binding: url(&quot;chrome://instantbird/content/aboutPanel.xml#aboutPanel&quot;);</span>
<a href="#l5.20"></a><span id="l5.20"> }</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> .conv-chat:not([chat]) {</span>
<a href="#l5.23"></a><span id="l5.23">   display: none;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/im/content/newtab.xml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/im/content/newtab.xml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -14,73 +14,69 @@</span>
<a href="#l6.4"></a><span id="l6.4">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l6.5"></a><span id="l6.5">   &lt;binding id=&quot;newtab&quot;&gt;</span>
<a href="#l6.6"></a><span id="l6.6">     &lt;resources&gt;</span>
<a href="#l6.7"></a><span id="l6.7">       &lt;stylesheet src=&quot;chrome://instantbird/skin/newtab.css&quot;/&gt;</span>
<a href="#l6.8"></a><span id="l6.8">       &lt;stylesheet src=&quot;chrome://instantbird/skin/richlistbox.css&quot;/&gt;</span>
<a href="#l6.9"></a><span id="l6.9">     &lt;/resources&gt;</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">     &lt;content&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-      &lt;xul:stringbundle anonid=&quot;newtabbundle&quot;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                        src=&quot;chrome://instantbird/locale/newtab.properties&quot;/&gt;</span>
<a href="#l6.14"></a><span id="l6.14">       &lt;xul:vbox flex=&quot;1&quot;&gt;</span>
<a href="#l6.15"></a><span id="l6.15">         &lt;xul:toolbar class=&quot;newtab-toolbar&quot;&gt;</span>
<a href="#l6.16"></a><span id="l6.16">           &lt;xul:textbox class=&quot;filterbox&quot; anonid=&quot;filterbox&quot; type=&quot;search&quot;</span>
<a href="#l6.17"></a><span id="l6.17">                        placeholder=&quot;&amp;filterbox.placeholder;&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l6.18"></a><span id="l6.18">         &lt;/xul:toolbar&gt;</span>
<a href="#l6.19"></a><span id="l6.19">         &lt;xul:richlistbox anonid=&quot;newtab-listbox&quot; class=&quot;newtab-listbox&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l6.20"></a><span id="l6.20">       &lt;/xul:vbox&gt;</span>
<a href="#l6.21"></a><span id="l6.21">     &lt;/content&gt;</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">     &lt;implementation implements=&quot;nsIObserver&quot;&gt;</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+      &lt;property name=&quot;statsService&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+          if (!this._statsService) {</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+            this._statsService = Components.classes[&quot;@instantbird.org/conv-stats-service;1&quot;]</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+                                           .getService(Components.interfaces.ibIConvStatsService);</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+          }</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+          return this._statsService;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+        ]]&gt;</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+</span>
<a href="#l6.36"></a><span id="l6.36">       &lt;property name=&quot;filterbox&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l6.37"></a><span id="l6.37">         &lt;getter&gt;</span>
<a href="#l6.38"></a><span id="l6.38">           return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;filterbox&quot;);</span>
<a href="#l6.39"></a><span id="l6.39">         &lt;/getter&gt;</span>
<a href="#l6.40"></a><span id="l6.40">       &lt;/property&gt;</span>
<a href="#l6.41"></a><span id="l6.41"> </span>
<a href="#l6.42"></a><span id="l6.42">       &lt;property name=&quot;listbox&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l6.43"></a><span id="l6.43">         &lt;getter&gt;</span>
<a href="#l6.44"></a><span id="l6.44">           return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;newtab-listbox&quot;);</span>
<a href="#l6.45"></a><span id="l6.45">         &lt;/getter&gt;</span>
<a href="#l6.46"></a><span id="l6.46">       &lt;/property&gt;</span>
<a href="#l6.47"></a><span id="l6.47"> </span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+      &lt;!-- Array version of this.listbox.childNodes. --&gt;</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+      &lt;field name=&quot;listItems&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+</span>
<a href="#l6.51"></a><span id="l6.51">       &lt;property name=&quot;tab&quot;&gt;</span>
<a href="#l6.52"></a><span id="l6.52">         &lt;getter&gt;</span>
<a href="#l6.53"></a><span id="l6.53">         &lt;![CDATA[</span>
<a href="#l6.54"></a><span id="l6.54">           return this._tab;</span>
<a href="#l6.55"></a><span id="l6.55">         ]]&gt;</span>
<a href="#l6.56"></a><span id="l6.56">         &lt;/getter&gt;</span>
<a href="#l6.57"></a><span id="l6.57">         &lt;setter&gt;</span>
<a href="#l6.58"></a><span id="l6.58">         &lt;![CDATA[</span>
<a href="#l6.59"></a><span id="l6.59">           this._tab = val;</span>
<a href="#l6.60"></a><span id="l6.60">           this._tab.setAttribute(&quot;label&quot;,</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-            document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;newtabbundle&quot;)</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-                    .getString(&quot;newtab.label&quot;));</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+            Services.strings.createBundle(&quot;chrome://instantbird/locale/newtab.properties&quot;)</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+                    .GetStringFromName(&quot;newtab.label&quot;));</span>
<a href="#l6.65"></a><span id="l6.65">         ]]&gt;</span>
<a href="#l6.66"></a><span id="l6.66">         &lt;/setter&gt;</span>
<a href="#l6.67"></a><span id="l6.67">       &lt;/property&gt;</span>
<a href="#l6.68"></a><span id="l6.68"> </span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-      &lt;field name=&quot;kNotificationsToObserve&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-        [&quot;contact-added&quot;, &quot;contact-removed&quot;, &quot;contact-status-changed&quot;,</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-         &quot;contact-display-name-changed&quot;, &quot;contact-no-longer-dummy&quot;,</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-         &quot;contact-preferred-buddy-changed&quot;, &quot;contact-moved&quot;]</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-      &lt;![CDATA[</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">-        // Sorted list of contacts.</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-        this.contacts = [];</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-        // List of contacts by ID, used to check for dupes.</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-        this.contactsById = {};</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-        // List of currently added contact elements - array version of this.listbox.childNodes.</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-        this.contactElts = [];</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-      ]]&gt;</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-</span>
<a href="#l6.86"></a><span id="l6.86">       &lt;destructor&gt;</span>
<a href="#l6.87"></a><span id="l6.87">       &lt;![CDATA[</span>
<a href="#l6.88"></a><span id="l6.88">         this.destroy();</span>
<a href="#l6.89"></a><span id="l6.89">       ]]&gt;</span>
<a href="#l6.90"></a><span id="l6.90">       &lt;/destructor&gt;</span>
<a href="#l6.91"></a><span id="l6.91"> </span>
<a href="#l6.92"></a><span id="l6.92">       &lt;method name=&quot;focus&quot;&gt;</span>
<a href="#l6.93"></a><span id="l6.93">         &lt;body&gt;</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineat">@@ -88,195 +84,106 @@</span>
<a href="#l6.95"></a><span id="l6.95">           this.filterbox.focus();</span>
<a href="#l6.96"></a><span id="l6.96">         ]]&gt;</span>
<a href="#l6.97"></a><span id="l6.97">         &lt;/body&gt;</span>
<a href="#l6.98"></a><span id="l6.98">       &lt;/method&gt;</span>
<a href="#l6.99"></a><span id="l6.99"> </span>
<a href="#l6.100"></a><span id="l6.100">       &lt;method name=&quot;onResize&quot;&gt;</span>
<a href="#l6.101"></a><span id="l6.101">         &lt;body&gt;</span>
<a href="#l6.102"></a><span id="l6.102">         &lt;![CDATA[</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-          this.addMoreElements();</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineplus">+          this.addMoreItems();</span>
<a href="#l6.105"></a><span id="l6.105">         ]]&gt;</span>
<a href="#l6.106"></a><span id="l6.106">         &lt;/body&gt;</span>
<a href="#l6.107"></a><span id="l6.107">       &lt;/method&gt;</span>
<a href="#l6.108"></a><span id="l6.108"> </span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-      &lt;!-- Maintains computed number of elements to display. Incremented when the user</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineminus">-           scrolls near the bottom of the list, unless hasMoreElementsToDisplay is false. --&gt;</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-      &lt;field name=&quot;numberOfElementsToDisplay&quot;&gt;0&lt;/field&gt;</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineminus">-      &lt;field name=&quot;hasMoreElementsToDisplay&quot;&gt;true&lt;/field&gt;</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineminus">-      &lt;!-- While scrolling, we add more elements when there are three elements left that</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineminus">-           aren't displayed (the last visible element is fourth from the end of the list). --&gt;</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineminus">-      &lt;field name=&quot;kAddMoreElementsThreshold&quot; readonly=&quot;true&quot;&gt;3&lt;/field&gt;</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineminus">-      &lt;!-- Try to add this many elements when scrolling past the threshold. --&gt;</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineminus">-      &lt;field name=&quot;kNumElementsIncrement&quot; readonly=&quot;true&quot;&gt;10&lt;/field&gt;</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineplus">+      &lt;!-- Maintains computed number of items to display. Incremented when the user</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineplus">+           scrolls near the bottom of the list, unless hasMoreItemsToDisplay is false. --&gt;</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineplus">+      &lt;field name=&quot;numberOfItemsToDisplay&quot;&gt;0&lt;/field&gt;</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineplus">+      &lt;field name=&quot;hasMoreItemsToDisplay&quot;&gt;true&lt;/field&gt;</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineplus">+      &lt;!-- While scrolling, we add more items when there are three items left that</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineplus">+           aren't displayed (the last visible item is fourth from the end of the list). --&gt;</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineplus">+      &lt;field name=&quot;kAddMoreItemsThreshold&quot; readonly=&quot;true&quot;&gt;3&lt;/field&gt;</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineplus">+      &lt;!-- Try to add this many items when scrolling past the threshold. --&gt;</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineplus">+      &lt;field name=&quot;kNumItemsIncrement&quot; readonly=&quot;true&quot;&gt;10&lt;/field&gt;</span>
<a href="#l6.127"></a><span id="l6.127"> </span>
<a href="#l6.128"></a><span id="l6.128" class="difflineminus">-      &lt;!-- Increments numberOfElementsToDisplay and calls refresh(). Used on scrolling/resizing. --&gt;</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineminus">-      &lt;method name=&quot;addMoreElements&quot;&gt;</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineplus">+      &lt;!-- Increments numberOfItemsToDisplay and calls refresh(). Used on scrolling/resizing. --&gt;</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineplus">+      &lt;method name=&quot;addMoreItems&quot;&gt;</span>
<a href="#l6.132"></a><span id="l6.132">         &lt;body&gt;</span>
<a href="#l6.133"></a><span id="l6.133">         &lt;![CDATA[</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineminus">-          if (!this.hasMoreElementsToDisplay)</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineplus">+          if (!this.hasMoreItemsToDisplay)</span>
<a href="#l6.136"></a><span id="l6.136">             return;</span>
<a href="#l6.137"></a><span id="l6.137">           let lastVisibleIndex = this.listbox.getIndexOfFirstVisibleRow() +</span>
<a href="#l6.138"></a><span id="l6.138">                                    this.listbox.getNumberOfVisibleRows() - 1;</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineminus">-          // Increment numberOfElementsToDisplay if lastVisibleIndex exceeds the threshold.</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineminus">-          if (lastVisibleIndex &gt;= this.contactElts.length - this.kAddMoreElementsThreshold) {</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineminus">-            this.numberOfElementsToDisplay += this.kNumElementsIncrement;</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineplus">+          // Increment numberOfItemsToDisplay if lastVisibleIndex exceeds the threshold.</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineplus">+          if (lastVisibleIndex &gt;= this.listItems.length - this.kAddMoreItemsThreshold) {</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineplus">+            this.numberOfItemsToDisplay += this.kNumItemsIncrement;</span>
<a href="#l6.145"></a><span id="l6.145">             this.refresh();</span>
<a href="#l6.146"></a><span id="l6.146">           }</span>
<a href="#l6.147"></a><span id="l6.147">         ]]&gt;</span>
<a href="#l6.148"></a><span id="l6.148">         &lt;/body&gt;</span>
<a href="#l6.149"></a><span id="l6.149">       &lt;/method&gt;</span>
<a href="#l6.150"></a><span id="l6.150"> </span>
<a href="#l6.151"></a><span id="l6.151">       &lt;!-- Remove observers when closing tab. --&gt;</span>
<a href="#l6.152"></a><span id="l6.152">       &lt;method name=&quot;destroy&quot;&gt;</span>
<a href="#l6.153"></a><span id="l6.153">         &lt;body&gt;</span>
<a href="#l6.154"></a><span id="l6.154">         &lt;![CDATA[</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineminus">-          // destroy is called from both tabbrowser and the destructor.</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineminus">-          // We need to ensure we don't remove our observer twice if both call it.</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineminus">-          if (this._destroyed)</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineminus">-            return;</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineminus">-          for (let notification of this.kNotificationsToObserve)</span>
<a href="#l6.160"></a><span id="l6.160" class="difflineminus">-            Services.obs.removeObserver(this, notification);</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineplus">+          this.statsService.removeObserver(this);</span>
<a href="#l6.162"></a><span id="l6.162">           this._destroyed = true;</span>
<a href="#l6.163"></a><span id="l6.163">         ]]&gt;</span>
<a href="#l6.164"></a><span id="l6.164">         &lt;/body&gt;</span>
<a href="#l6.165"></a><span id="l6.165">       &lt;/method&gt;</span>
<a href="#l6.166"></a><span id="l6.166"> </span>
<a href="#l6.167"></a><span id="l6.167">       &lt;method name=&quot;finishImport&quot;&gt;</span>
<a href="#l6.168"></a><span id="l6.168">         &lt;parameter name=&quot;aOtherNewTab&quot;/&gt;</span>
<a href="#l6.169"></a><span id="l6.169">         &lt;body&gt;</span>
<a href="#l6.170"></a><span id="l6.170">         &lt;![CDATA[</span>
<a href="#l6.171"></a><span id="l6.171">           let filterbox = this.filterbox;</span>
<a href="#l6.172"></a><span id="l6.172">           let otherFilterbox = aOtherNewTab.filterbox;</span>
<a href="#l6.173"></a><span id="l6.173">           filterbox.value = otherFilterbox.value;</span>
<a href="#l6.174"></a><span id="l6.174">           filterbox.selectionStart = otherFilterbox.selectionStart;</span>
<a href="#l6.175"></a><span id="l6.175">           filterbox.selectionEnd = otherFilterbox.selectionEnd;</span>
<a href="#l6.176"></a><span id="l6.176" class="difflineminus">-          const kFieldsToImport = [&quot;contacts&quot;, &quot;filteredContacts&quot;, &quot;contactsById&quot;,</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineminus">-                                   &quot;numberOfElementsToDisplay&quot;, &quot;_prevFilterTxt&quot;,</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineminus">-                                   &quot;_contactUpdated&quot;, &quot;hasMoreElementsToDisplay&quot;];</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineplus">+          const kFieldsToImport = [&quot;contacts&quot;, &quot;filteredConvs&quot;, &quot;contactsById&quot;,</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineplus">+                                   &quot;numberOfItemsToDisplay&quot;, &quot;_prevFilterTxt&quot;,</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineplus">+                                   &quot;_forceRefresh&quot;, &quot;hasMoreItemsToDisplay&quot;];</span>
<a href="#l6.182"></a><span id="l6.182">           for (let field of kFieldsToImport)</span>
<a href="#l6.183"></a><span id="l6.183">             this[field] = aOtherNewTab[field];</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineminus">-          for (let i = 0; i &lt; aOtherNewTab.contactElts.length; ++i) {</span>
<a href="#l6.185"></a><span id="l6.185" class="difflineminus">-            this.pushContactElement();</span>
<a href="#l6.186"></a><span id="l6.186" class="difflineminus">-            if (!aOtherNewTab.contactElts[i].selected)</span>
<a href="#l6.187"></a><span id="l6.187" class="difflineminus">-              continue;</span>
<a href="#l6.188"></a><span id="l6.188" class="difflineminus">-            this.listbox.addItemToSelection(this.contactElts[i]);</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineminus">-          }</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineplus">+          for (let i = 0; i &lt; aOtherNewTab.listItems.length; ++i)</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineplus">+            this.pushListItem();</span>
<a href="#l6.192"></a><span id="l6.192" class="difflineplus">+          this.listbox.selectedIndex = aOtherNewTab.listbox.selectedIndex;</span>
<a href="#l6.193"></a><span id="l6.193">           this._delayedRefresh();</span>
<a href="#l6.194"></a><span id="l6.194">           this.listbox.scrollToIndex(aOtherNewTab.listbox.getIndexOfFirstVisibleRow());</span>
<a href="#l6.195"></a><span id="l6.195">           this.addListeners();</span>
<a href="#l6.196"></a><span id="l6.196">         ]]&gt;</span>
<a href="#l6.197"></a><span id="l6.197">         &lt;/body&gt;</span>
<a href="#l6.198"></a><span id="l6.198">       &lt;/method&gt;</span>
<a href="#l6.199"></a><span id="l6.199"> </span>
<a href="#l6.200"></a><span id="l6.200">       &lt;!-- This is separated from the constructor because we don't want to init</span>
<a href="#l6.201"></a><span id="l6.201">            when being imported from another window. --&gt;</span>
<a href="#l6.202"></a><span id="l6.202">       &lt;method name=&quot;init&quot;&gt;</span>
<a href="#l6.203"></a><span id="l6.203">         &lt;body&gt;</span>
<a href="#l6.204"></a><span id="l6.204">         &lt;![CDATA[</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineminus">-          let contacts = Services.contacts.getContacts();</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineminus">-          for (let contact of contacts)</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineminus">-            this.addContact(contact);</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineminus">-          this.filteredContacts = this.contacts;</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineminus">-          this.resetElementsToDisplay();</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineplus">+          this.filteredConvs = this.statsService.getFilteredConvs(&quot;&quot;);</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineplus">+          this.resetItemsToDisplay();</span>
<a href="#l6.212"></a><span id="l6.212">           this.refresh();</span>
<a href="#l6.213"></a><span id="l6.213">           this.addListeners();</span>
<a href="#l6.214"></a><span id="l6.214">         ]]&gt;</span>
<a href="#l6.215"></a><span id="l6.215">         &lt;/body&gt;</span>
<a href="#l6.216"></a><span id="l6.216">       &lt;/method&gt;</span>
<a href="#l6.217"></a><span id="l6.217"> </span>
<a href="#l6.218"></a><span id="l6.218">       &lt;method name=&quot;addListeners&quot;&gt;</span>
<a href="#l6.219"></a><span id="l6.219">         &lt;body&gt;</span>
<a href="#l6.220"></a><span id="l6.220">         &lt;![CDATA[</span>
<a href="#l6.221"></a><span id="l6.221">           this.filterbox.addEventListener(&quot;keyup&quot;, this.refresh.bind(this));</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineminus">-          this.listbox.addEventListener(&quot;scroll&quot;, this.addMoreElements.bind(this));</span>
<a href="#l6.223"></a><span id="l6.223" class="difflineminus">-          for (let notification of this.kNotificationsToObserve)</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-            Services.obs.addObserver(this, notification, false);</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineminus">-        ]]&gt;</span>
<a href="#l6.226"></a><span id="l6.226" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineminus">-</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineminus">-      &lt;!-- Add contact to this.contacts, in its correct position.</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineminus">-           Does not add to the listbox. --&gt;</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-      &lt;method name=&quot;addContact&quot;&gt;</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineminus">-        &lt;parameter name=&quot;aImContact&quot;/&gt;</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineminus">-          if (aImContact.id in this.contactsById) // Already added.</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineminus">-            return;</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineminus">-          /* When multiple contacts change at once, we receive notifications for</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineminus">-           * each of them one by one and so resort them one by one. If we maintain</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineminus">-           * a list of imIContacts, it would be impossible to resort them properly</span>
<a href="#l6.240"></a><span id="l6.240" class="difflineminus">-           * because of this, since they would all have changed. To work around</span>
<a href="#l6.241"></a><span id="l6.241" class="difflineminus">-           * this problem, we maintain a list of custom contact objects, storing</span>
<a href="#l6.242"></a><span id="l6.242" class="difflineminus">-           * only the lowercase display name and status type for sorting purposes.</span>
<a href="#l6.243"></a><span id="l6.243" class="difflineminus">-           */</span>
<a href="#l6.244"></a><span id="l6.244" class="difflineminus">-          let contact = {</span>
<a href="#l6.245"></a><span id="l6.245" class="difflineminus">-            id: aImContact.id,</span>
<a href="#l6.246"></a><span id="l6.246" class="difflineminus">-            name: aImContact.displayName.toLowerCase(),</span>
<a href="#l6.247"></a><span id="l6.247" class="difflineminus">-            status: aImContact.statusType,</span>
<a href="#l6.248"></a><span id="l6.248" class="difflineminus">-            imContact: aImContact</span>
<a href="#l6.249"></a><span id="l6.249" class="difflineminus">-          };</span>
<a href="#l6.250"></a><span id="l6.250" class="difflineminus">-          let pos = this.getPositionToInsert(contact);</span>
<a href="#l6.251"></a><span id="l6.251" class="difflineminus">-          this.contacts.splice(pos, 0, contact);</span>
<a href="#l6.252"></a><span id="l6.252" class="difflineminus">-          this.contactsById[contact.id] = contact;</span>
<a href="#l6.253"></a><span id="l6.253" class="difflineplus">+          this.listbox.addEventListener(&quot;scroll&quot;, this.addMoreItems.bind(this));</span>
<a href="#l6.254"></a><span id="l6.254" class="difflineplus">+          this.statsService.addObserver(this);</span>
<a href="#l6.255"></a><span id="l6.255">         ]]&gt;</span>
<a href="#l6.256"></a><span id="l6.256">         &lt;/body&gt;</span>
<a href="#l6.257"></a><span id="l6.257">       &lt;/method&gt;</span>
<a href="#l6.258"></a><span id="l6.258"> </span>
<a href="#l6.259"></a><span id="l6.259" class="difflineminus">-      &lt;!-- Remove contact from this.contacts. Does not update listbox. --&gt;</span>
<a href="#l6.260"></a><span id="l6.260" class="difflineminus">-      &lt;method name=&quot;removeContact&quot;&gt;</span>
<a href="#l6.261"></a><span id="l6.261" class="difflineminus">-        &lt;parameter name=&quot;aId&quot;/&gt;</span>
<a href="#l6.262"></a><span id="l6.262" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l6.263"></a><span id="l6.263" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l6.264"></a><span id="l6.264" class="difflineminus">-          if (!(aId in this.contactsById))</span>
<a href="#l6.265"></a><span id="l6.265" class="difflineminus">-            return;</span>
<a href="#l6.266"></a><span id="l6.266" class="difflineminus">-          this.contacts.splice(this.contacts.indexOf(this.contactsById[aId]), 1);</span>
<a href="#l6.267"></a><span id="l6.267" class="difflineminus">-          delete this.contactsById[aId];</span>
<a href="#l6.268"></a><span id="l6.268" class="difflineminus">-        ]]&gt;</span>
<a href="#l6.269"></a><span id="l6.269" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l6.270"></a><span id="l6.270" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l6.271"></a><span id="l6.271" class="difflineminus">-</span>
<a href="#l6.272"></a><span id="l6.272" class="difflineminus">-      &lt;!-- Binary search to find the correct location for the given contact --&gt;</span>
<a href="#l6.273"></a><span id="l6.273" class="difflineminus">-      &lt;method name=&quot;getPositionToInsert&quot;&gt;</span>
<a href="#l6.274"></a><span id="l6.274" class="difflineminus">-        &lt;parameter name=&quot;aContact&quot;/&gt;</span>
<a href="#l6.275"></a><span id="l6.275" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l6.276"></a><span id="l6.276" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l6.277"></a><span id="l6.277" class="difflineminus">-          let end = this.contacts.length;</span>
<a href="#l6.278"></a><span id="l6.278" class="difflineminus">-          // Avoid the binary search loop if the contacts were already sorted.</span>
<a href="#l6.279"></a><span id="l6.279" class="difflineminus">-          if (end != 0 &amp;&amp;</span>
<a href="#l6.280"></a><span id="l6.280" class="difflineminus">-              this.sortComparator(aContact, this.contacts[end - 1]) &lt; 0) {</span>
<a href="#l6.281"></a><span id="l6.281" class="difflineminus">-            let start = 0;</span>
<a href="#l6.282"></a><span id="l6.282" class="difflineminus">-            while (start &lt; end) {</span>
<a href="#l6.283"></a><span id="l6.283" class="difflineminus">-              let middle = Math.floor((start + end) / 2);</span>
<a href="#l6.284"></a><span id="l6.284" class="difflineminus">-              if (this.sortComparator(aContact, this.contacts[middle]) &lt; 0)</span>
<a href="#l6.285"></a><span id="l6.285" class="difflineminus">-                end = middle;</span>
<a href="#l6.286"></a><span id="l6.286" class="difflineminus">-              else</span>
<a href="#l6.287"></a><span id="l6.287" class="difflineminus">-                start = middle + 1;</span>
<a href="#l6.288"></a><span id="l6.288" class="difflineminus">-            }</span>
<a href="#l6.289"></a><span id="l6.289" class="difflineminus">-          }</span>
<a href="#l6.290"></a><span id="l6.290" class="difflineminus">-          return end;</span>
<a href="#l6.291"></a><span id="l6.291" class="difflineminus">-        ]]&gt;</span>
<a href="#l6.292"></a><span id="l6.292" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l6.293"></a><span id="l6.293" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l6.294"></a><span id="l6.294" class="difflineminus">-</span>
<a href="#l6.295"></a><span id="l6.295" class="difflineminus">-      &lt;!-- Takes two items from contacts list (not imIContacts) and compares first</span>
<a href="#l6.296"></a><span id="l6.296" class="difflineminus">-           their statusTypes, then their display names. --&gt;</span>
<a href="#l6.297"></a><span id="l6.297" class="difflineminus">-      &lt;method name=&quot;sortComparator&quot;&gt;</span>
<a href="#l6.298"></a><span id="l6.298" class="difflineminus">-        &lt;parameter name=&quot;aContactA&quot;/&gt;</span>
<a href="#l6.299"></a><span id="l6.299" class="difflineminus">-        &lt;parameter name=&quot;aContactB&quot;/&gt;</span>
<a href="#l6.300"></a><span id="l6.300" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l6.301"></a><span id="l6.301" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l6.302"></a><span id="l6.302" class="difflineminus">-          return (aContactB.status - aContactA.status) ||</span>
<a href="#l6.303"></a><span id="l6.303" class="difflineminus">-            aContactA.name.localeCompare(aContactB.name);</span>
<a href="#l6.304"></a><span id="l6.304" class="difflineminus">-        ]]&gt;</span>
<a href="#l6.305"></a><span id="l6.305" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l6.306"></a><span id="l6.306" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l6.307"></a><span id="l6.307" class="difflineminus">-</span>
<a href="#l6.308"></a><span id="l6.308" class="difflineminus">-      &lt;!-- Dispatch a call to _delayedRefresh, to avoid consecutive multiple calls. --&gt;</span>
<a href="#l6.309"></a><span id="l6.309" class="difflineplus">+      &lt;!-- Dispatch a call to _delayedRefresh, to avoid multiple consecutive calls. --&gt;</span>
<a href="#l6.310"></a><span id="l6.310">       &lt;method name=&quot;refresh&quot;&gt;</span>
<a href="#l6.311"></a><span id="l6.311">         &lt;body&gt;</span>
<a href="#l6.312"></a><span id="l6.312">         &lt;![CDATA[</span>
<a href="#l6.313"></a><span id="l6.313">           if (this._pendingRefreshCall)</span>
<a href="#l6.314"></a><span id="l6.314">             return;</span>
<a href="#l6.315"></a><span id="l6.315">           this._pendingRefreshCall = true;</span>
<a href="#l6.316"></a><span id="l6.316">           Services.tm.mainThread.dispatch(this._delayedRefresh.bind(this),</span>
<a href="#l6.317"></a><span id="l6.317">             Components.interfaces.nsIEventTarget.DISPATCH_NORMAL);</span>
<a href="#l6.318"></a><span id="l6.318" class="difflineat">@@ -288,126 +195,104 @@</span>
<a href="#l6.319"></a><span id="l6.319">       &lt;method name=&quot;_delayedRefresh&quot;&gt;</span>
<a href="#l6.320"></a><span id="l6.320">         &lt;body&gt;</span>
<a href="#l6.321"></a><span id="l6.321">         &lt;![CDATA[</span>
<a href="#l6.322"></a><span id="l6.322">           this._pendingRefreshCall = false;</span>
<a href="#l6.323"></a><span id="l6.323">           // Don't do anything if the tab has been removed.</span>
<a href="#l6.324"></a><span id="l6.324">           if (this._destroyed)</span>
<a href="#l6.325"></a><span id="l6.325">             return;</span>
<a href="#l6.326"></a><span id="l6.326">           let filterTxt = this.filterbox.value.toLowerCase();</span>
<a href="#l6.327"></a><span id="l6.327" class="difflineminus">-          // Filtering needs to be done only if either the filter string has</span>
<a href="#l6.328"></a><span id="l6.328" class="difflineminus">-          // changed, or a contact was updated.</span>
<a href="#l6.329"></a><span id="l6.329" class="difflineminus">-          if (this._prevFilterTxt != filterTxt || this._contactUpdated) {</span>
<a href="#l6.330"></a><span id="l6.330" class="difflineminus">-            this.filteredContacts = this.contacts.filter(function(aContact) {</span>
<a href="#l6.331"></a><span id="l6.331" class="difflineminus">-              return aContact.name.startsWith(filterTxt) ||</span>
<a href="#l6.332"></a><span id="l6.332" class="difflineminus">-                aContact.name.split(/\s+/).some(function(s) s.startsWith(filterTxt));</span>
<a href="#l6.333"></a><span id="l6.333" class="difflineminus">-            });</span>
<a href="#l6.334"></a><span id="l6.334" class="difflineminus">-            // If the filter string has changed, reset number of elements to display.</span>
<a href="#l6.335"></a><span id="l6.335" class="difflineplus">+          // Filtering needs to be done only if either the filter string has changed,</span>
<a href="#l6.336"></a><span id="l6.336" class="difflineplus">+          // or the stats service's list was updated. _forceRefresh is a field as</span>
<a href="#l6.337"></a><span id="l6.337" class="difflineplus">+          // opposed to a parameter because calls to this function are delayed.</span>
<a href="#l6.338"></a><span id="l6.338" class="difflineplus">+          if (this._prevFilterTxt != filterTxt || this._forceRefresh) {</span>
<a href="#l6.339"></a><span id="l6.339" class="difflineplus">+            this.filteredConvs = this._statsService.getFilteredConvs(filterTxt);</span>
<a href="#l6.340"></a><span id="l6.340" class="difflineplus">+            // If the filter string has changed, reset number of items to display.</span>
<a href="#l6.341"></a><span id="l6.341">             if (this._prevFilterTxt != filterTxt) {</span>
<a href="#l6.342"></a><span id="l6.342" class="difflineminus">-              this.resetElementsToDisplay();</span>
<a href="#l6.343"></a><span id="l6.343" class="difflineplus">+              this.resetItemsToDisplay();</span>
<a href="#l6.344"></a><span id="l6.344">               this._prevFilterTxt = filterTxt;</span>
<a href="#l6.345"></a><span id="l6.345">             }</span>
<a href="#l6.346"></a><span id="l6.346">           }</span>
<a href="#l6.347"></a><span id="l6.347" class="difflineminus">-          this._contactUpdated = false;</span>
<a href="#l6.348"></a><span id="l6.348" class="difflineminus">-          let filteredContacts = this.filteredContacts;</span>
<a href="#l6.349"></a><span id="l6.349" class="difflineminus">-          if (filteredContacts.length &lt; this.numberOfElementsToDisplay) {</span>
<a href="#l6.350"></a><span id="l6.350" class="difflineminus">-            this.numberOfElementsToDisplay = filteredContacts.length;</span>
<a href="#l6.351"></a><span id="l6.351" class="difflineminus">-            this.hasMoreElementsToDisplay = false;</span>
<a href="#l6.352"></a><span id="l6.352" class="difflineplus">+          this._forceRefresh = false;</span>
<a href="#l6.353"></a><span id="l6.353" class="difflineplus">+          let filteredConvs = this.filteredConvs;</span>
<a href="#l6.354"></a><span id="l6.354" class="difflineplus">+          if (filteredConvs.length &lt; this.numberOfItemsToDisplay) {</span>
<a href="#l6.355"></a><span id="l6.355" class="difflineplus">+            this.numberOfItemsToDisplay = filteredConvs.length;</span>
<a href="#l6.356"></a><span id="l6.356" class="difflineplus">+            this.hasMoreItemsToDisplay = false;</span>
<a href="#l6.357"></a><span id="l6.357">           }</span>
<a href="#l6.358"></a><span id="l6.358" class="difflineminus">-          /* Add/remove list elements until we have the number required.</span>
<a href="#l6.359"></a><span id="l6.359" class="difflineminus">-           * Then rebuild them all from filteredContacts.</span>
<a href="#l6.360"></a><span id="l6.360" class="difflineminus">-           */</span>
<a href="#l6.361"></a><span id="l6.361" class="difflineminus">-          while (this.contactElts.length &gt; this.numberOfElementsToDisplay)</span>
<a href="#l6.362"></a><span id="l6.362" class="difflineminus">-            this.popContactElement();</span>
<a href="#l6.363"></a><span id="l6.363" class="difflineminus">-          while (this.contactElts.length &lt; this.numberOfElementsToDisplay)</span>
<a href="#l6.364"></a><span id="l6.364" class="difflineminus">-            this.pushContactElement();</span>
<a href="#l6.365"></a><span id="l6.365" class="difflineminus">-          for (let i = 0; i &lt; this.contactElts.length; ++i)</span>
<a href="#l6.366"></a><span id="l6.366" class="difflineminus">-            this.contactElts[i].build(filteredContacts[i].imContact);</span>
<a href="#l6.367"></a><span id="l6.367" class="difflineplus">+          // Add/remove list items until we have the number required.</span>
<a href="#l6.368"></a><span id="l6.368" class="difflineplus">+          // Then rebuild them all from filteredConvs.</span>
<a href="#l6.369"></a><span id="l6.369" class="difflineplus">+          while (this.listItems.length &gt; this.numberOfItemsToDisplay)</span>
<a href="#l6.370"></a><span id="l6.370" class="difflineplus">+            this.popListItem();</span>
<a href="#l6.371"></a><span id="l6.371" class="difflineplus">+          while (this.listItems.length &lt; this.numberOfItemsToDisplay)</span>
<a href="#l6.372"></a><span id="l6.372" class="difflineplus">+            this.pushListItem();</span>
<a href="#l6.373"></a><span id="l6.373" class="difflineplus">+          for (let i = 0; i &lt; this.listItems.length; ++i)</span>
<a href="#l6.374"></a><span id="l6.374" class="difflineplus">+            this.listItems[i].build(filteredConvs[i]);</span>
<a href="#l6.375"></a><span id="l6.375">         ]]&gt;</span>
<a href="#l6.376"></a><span id="l6.376">         &lt;/body&gt;</span>
<a href="#l6.377"></a><span id="l6.377">       &lt;/method&gt;</span>
<a href="#l6.378"></a><span id="l6.378"> </span>
<a href="#l6.379"></a><span id="l6.379" class="difflineminus">-      &lt;method name=&quot;resetElementsToDisplay&quot;&gt;</span>
<a href="#l6.380"></a><span id="l6.380" class="difflineplus">+      &lt;method name=&quot;resetItemsToDisplay&quot;&gt;</span>
<a href="#l6.381"></a><span id="l6.381">         &lt;body&gt;</span>
<a href="#l6.382"></a><span id="l6.382">         &lt;![CDATA[</span>
<a href="#l6.383"></a><span id="l6.383">           let listbox = this.listbox;</span>
<a href="#l6.384"></a><span id="l6.384" class="difflineminus">-          this.hasMoreElementsToDisplay = this.filteredContacts.length &gt; 0;</span>
<a href="#l6.385"></a><span id="l6.385" class="difflineplus">+          this.hasMoreItemsToDisplay = this.filteredConvs.length &gt; 0;</span>
<a href="#l6.386"></a><span id="l6.386">           // We need to have a list item so that we can use its height to compute</span>
<a href="#l6.387"></a><span id="l6.387" class="difflineminus">-          // the number of elements to display. If we don't have one, we add it,</span>
<a href="#l6.388"></a><span id="l6.388" class="difflineminus">-          // but only if it will be used (i.e. hasMoreElementsToDisplay is true).</span>
<a href="#l6.389"></a><span id="l6.389" class="difflineminus">-          if (this.hasMoreElementsToDisplay) {</span>
<a href="#l6.390"></a><span id="l6.390" class="difflineplus">+          // the number of items to display. If we don't have one, we add it,</span>
<a href="#l6.391"></a><span id="l6.391" class="difflineplus">+          // but only if it will be used (i.e. hasMoreItemsToDisplay is true).</span>
<a href="#l6.392"></a><span id="l6.392" class="difflineplus">+          if (this.hasMoreItemsToDisplay) {</span>
<a href="#l6.393"></a><span id="l6.393">             if (!listbox.firstChild)</span>
<a href="#l6.394"></a><span id="l6.394" class="difflineminus">-              this.pushContactElement();</span>
<a href="#l6.395"></a><span id="l6.395" class="difflineminus">-            // Add enough elements to fill the visible area, plus kNumElementsIncrement.</span>
<a href="#l6.396"></a><span id="l6.396" class="difflineminus">-            this.numberOfElementsToDisplay =</span>
<a href="#l6.397"></a><span id="l6.397" class="difflineminus">-              (listbox.clientHeight / listbox.firstChild.clientHeight) + this.kNumElementsIncrement;</span>
<a href="#l6.398"></a><span id="l6.398" class="difflineplus">+              this.pushListItem();</span>
<a href="#l6.399"></a><span id="l6.399" class="difflineplus">+            // Add enough items to fill the visible area, plus kNumItemsIncrement.</span>
<a href="#l6.400"></a><span id="l6.400" class="difflineplus">+            this.numberOfItemsToDisplay =</span>
<a href="#l6.401"></a><span id="l6.401" class="difflineplus">+              (listbox.clientHeight / listbox.firstChild.clientHeight) + this.kNumItemsIncrement;</span>
<a href="#l6.402"></a><span id="l6.402">           }</span>
<a href="#l6.403"></a><span id="l6.403">           else</span>
<a href="#l6.404"></a><span id="l6.404" class="difflineminus">-            this.numberOfElementsToDisplay = 0;</span>
<a href="#l6.405"></a><span id="l6.405" class="difflineplus">+            this.numberOfItemsToDisplay = 0;</span>
<a href="#l6.406"></a><span id="l6.406">           listbox.scrollToIndex(0);</span>
<a href="#l6.407"></a><span id="l6.407">           listbox.clearSelection();</span>
<a href="#l6.408"></a><span id="l6.408" class="difflineminus">-          // Ensure the first element will be selected if the user presses</span>
<a href="#l6.409"></a><span id="l6.409" class="difflineplus">+          // Ensure the first item will be selected if the user presses</span>
<a href="#l6.410"></a><span id="l6.410">           // down (for example) from the filterbox.</span>
<a href="#l6.411"></a><span id="l6.411">           listbox.selectedIndex = -1;</span>
<a href="#l6.412"></a><span id="l6.412">         ]]&gt;</span>
<a href="#l6.413"></a><span id="l6.413">         &lt;/body&gt;</span>
<a href="#l6.414"></a><span id="l6.414">       &lt;/method&gt;</span>
<a href="#l6.415"></a><span id="l6.415"> </span>
<a href="#l6.416"></a><span id="l6.416" class="difflineminus">-      &lt;method name=&quot;pushContactElement&quot;&gt;</span>
<a href="#l6.417"></a><span id="l6.417" class="difflineplus">+      &lt;method name=&quot;pushListItem&quot;&gt;</span>
<a href="#l6.418"></a><span id="l6.418">         &lt;body&gt;</span>
<a href="#l6.419"></a><span id="l6.419">         &lt;![CDATA[</span>
<a href="#l6.420"></a><span id="l6.420">           // We use richlistitem as the nodeName so that CSS rules from richlistbox.css</span>
<a href="#l6.421"></a><span id="l6.421">           // get applied. We use the className to apply the -moz-binding.</span>
<a href="#l6.422"></a><span id="l6.422">           let elt = document.createElementNS(</span>
<a href="#l6.423"></a><span id="l6.423">             &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l6.424"></a><span id="l6.424">             &quot;richlistitem&quot;);</span>
<a href="#l6.425"></a><span id="l6.425" class="difflineminus">-          elt.className = &quot;newtab-contact&quot;;</span>
<a href="#l6.426"></a><span id="l6.426" class="difflineplus">+          elt.className = &quot;newtab-item&quot;;</span>
<a href="#l6.427"></a><span id="l6.427">           this.listbox.appendChild(elt);</span>
<a href="#l6.428"></a><span id="l6.428" class="difflineminus">-          this.contactElts.push(elt);</span>
<a href="#l6.429"></a><span id="l6.429" class="difflineplus">+          this.listItems.push(elt);</span>
<a href="#l6.430"></a><span id="l6.430">           return elt;</span>
<a href="#l6.431"></a><span id="l6.431">         ]]&gt;</span>
<a href="#l6.432"></a><span id="l6.432">         &lt;/body&gt;</span>
<a href="#l6.433"></a><span id="l6.433">       &lt;/method&gt;</span>
<a href="#l6.434"></a><span id="l6.434"> </span>
<a href="#l6.435"></a><span id="l6.435" class="difflineminus">-      &lt;method name=&quot;popContactElement&quot;&gt;</span>
<a href="#l6.436"></a><span id="l6.436" class="difflineplus">+      &lt;method name=&quot;popListItem&quot;&gt;</span>
<a href="#l6.437"></a><span id="l6.437">         &lt;body&gt;</span>
<a href="#l6.438"></a><span id="l6.438">         &lt;![CDATA[</span>
<a href="#l6.439"></a><span id="l6.439">           this.listbox.removeChild(this.listbox.lastChild);</span>
<a href="#l6.440"></a><span id="l6.440" class="difflineminus">-          this.contactElts.pop();</span>
<a href="#l6.441"></a><span id="l6.441" class="difflineplus">+          this.listItems.pop();</span>
<a href="#l6.442"></a><span id="l6.442">         ]]&gt;</span>
<a href="#l6.443"></a><span id="l6.443">         &lt;/body&gt;</span>
<a href="#l6.444"></a><span id="l6.444">       &lt;/method&gt;</span>
<a href="#l6.445"></a><span id="l6.445"> </span>
<a href="#l6.446"></a><span id="l6.446">       &lt;!-- nsIObserver implementation --&gt;</span>
<a href="#l6.447"></a><span id="l6.447">       &lt;method name=&quot;observe&quot;&gt;</span>
<a href="#l6.448"></a><span id="l6.448">         &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l6.449"></a><span id="l6.449">         &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l6.450"></a><span id="l6.450">         &lt;parameter name=&quot;aData&quot;/&gt;</span>
<a href="#l6.451"></a><span id="l6.451">         &lt;body&gt;</span>
<a href="#l6.452"></a><span id="l6.452">         &lt;![CDATA[</span>
<a href="#l6.453"></a><span id="l6.453" class="difflineminus">-          if (aTopic == &quot;contact-no-longer-dummy&quot;) {</span>
<a href="#l6.454"></a><span id="l6.454" class="difflineminus">-            // Contact ID changed. aData is the old ID.</span>
<a href="#l6.455"></a><span id="l6.455" class="difflineminus">-            let oldId = parseInt(aData, 10);</span>
<a href="#l6.456"></a><span id="l6.456" class="difflineminus">-            let id = aSubject.id;</span>
<a href="#l6.457"></a><span id="l6.457" class="difflineminus">-            this.contactsById[id] = this.contactsById[oldId];</span>
<a href="#l6.458"></a><span id="l6.458" class="difflineminus">-            delete this.contactsById[oldId];</span>
<a href="#l6.459"></a><span id="l6.459" class="difflineminus">-            this.contactsById[id].id = id;</span>
<a href="#l6.460"></a><span id="l6.460" class="difflineminus">-            return;</span>
<a href="#l6.461"></a><span id="l6.461" class="difflineminus">-          }</span>
<a href="#l6.462"></a><span id="l6.462" class="difflineminus">-          else if (aTopic == &quot;contact-added&quot;)</span>
<a href="#l6.463"></a><span id="l6.463" class="difflineminus">-            this.addContact(aSubject);</span>
<a href="#l6.464"></a><span id="l6.464" class="difflineminus">-          else if (aTopic == &quot;contact-removed&quot;)</span>
<a href="#l6.465"></a><span id="l6.465" class="difflineminus">-            this.removeContact(aSubject.id);</span>
<a href="#l6.466"></a><span id="l6.466" class="difflineminus">-          else {</span>
<a href="#l6.467"></a><span id="l6.467" class="difflineminus">-            // A change in the contact's status or display name may cause the</span>
<a href="#l6.468"></a><span id="l6.468" class="difflineminus">-            // order to change, so we simply remove and re-add it.</span>
<a href="#l6.469"></a><span id="l6.469" class="difflineminus">-            this.removeContact(aSubject.id);</span>
<a href="#l6.470"></a><span id="l6.470" class="difflineminus">-            this.addContact(aSubject);</span>
<a href="#l6.471"></a><span id="l6.471" class="difflineminus">-          }</span>
<a href="#l6.472"></a><span id="l6.472" class="difflineminus">-          this._contactUpdated = true;</span>
<a href="#l6.473"></a><span id="l6.473" class="difflineplus">+          this._forceRefresh = true;</span>
<a href="#l6.474"></a><span id="l6.474">           this.refresh();</span>
<a href="#l6.475"></a><span id="l6.475">         ]]&gt;</span>
<a href="#l6.476"></a><span id="l6.476">         &lt;/body&gt;</span>
<a href="#l6.477"></a><span id="l6.477">       &lt;/method&gt;</span>
<a href="#l6.478"></a><span id="l6.478">     &lt;/implementation&gt;</span>
<a href="#l6.479"></a><span id="l6.479"> </span>
<a href="#l6.480"></a><span id="l6.480">     &lt;handlers&gt;</span>
<a href="#l6.481"></a><span id="l6.481">       &lt;handler event=&quot;keydown&quot;&gt;</span>
<a href="#l6.482"></a><span id="l6.482" class="difflineat">@@ -436,17 +321,17 @@</span>
<a href="#l6.483"></a><span id="l6.483">           return;</span>
<a href="#l6.484"></a><span id="l6.484">         }</span>
<a href="#l6.485"></a><span id="l6.485">         // If modifiers are pressed, let whatever is focused handle the event.</span>
<a href="#l6.486"></a><span id="l6.486">         if (modifiersPressed)</span>
<a href="#l6.487"></a><span id="l6.487">           return;</span>
<a href="#l6.488"></a><span id="l6.488">         // Otherwise, give listbox focus so that it can process the navigation key.</span>
<a href="#l6.489"></a><span id="l6.489">         listbox.focus();</span>
<a href="#l6.490"></a><span id="l6.490">         // The selectedIndex is -1 after a new filter. In this case, pressing a</span>
<a href="#l6.491"></a><span id="l6.491" class="difflineminus">-        // navkey from the filterbox should select the first element on the list.</span>
<a href="#l6.492"></a><span id="l6.492" class="difflineplus">+        // navkey from the filterbox should select the first item in the list.</span>
<a href="#l6.493"></a><span id="l6.493">         if (listbox.selectedIndex &lt; 0 &amp;&amp; listbox.firstChild) {</span>
<a href="#l6.494"></a><span id="l6.494">           listbox.selectItem(listbox.firstChild);</span>
<a href="#l6.495"></a><span id="l6.495">           listbox.ensureIndexIsVisible(0);</span>
<a href="#l6.496"></a><span id="l6.496">           event.preventDefault();</span>
<a href="#l6.497"></a><span id="l6.497">           event.stopPropagation();</span>
<a href="#l6.498"></a><span id="l6.498">         }</span>
<a href="#l6.499"></a><span id="l6.499">       ]]&gt;</span>
<a href="#l6.500"></a><span id="l6.500">       &lt;/handler&gt;</span>
<a href="#l6.501"></a><span id="l6.501" class="difflineat">@@ -455,92 +340,90 @@</span>
<a href="#l6.502"></a><span id="l6.502">       &lt;![CDATA[</span>
<a href="#l6.503"></a><span id="l6.503">         if (!this.listbox.firstChild ||</span>
<a href="#l6.504"></a><span id="l6.504">             (event.keyCode != event.DOM_VK_ENTER &amp;&amp;</span>
<a href="#l6.505"></a><span id="l6.505">              event.keyCode != event.DOM_VK_RETURN))</span>
<a href="#l6.506"></a><span id="l6.506">           return;</span>
<a href="#l6.507"></a><span id="l6.507">         if (!(&quot;Conversations&quot; in window))</span>
<a href="#l6.508"></a><span id="l6.508">           Components.utils.import(&quot;resource:///modules/imWindows.jsm&quot;);</span>
<a href="#l6.509"></a><span id="l6.509">         let item = this.listbox.selectedItem || this.listbox.firstChild;</span>
<a href="#l6.510"></a><span id="l6.510" class="difflineminus">-        Conversations.focusConversation(item.contact.createConversation());</span>
<a href="#l6.511"></a><span id="l6.511" class="difflineplus">+        Conversations.focusConversation(item.target.createConversation());</span>
<a href="#l6.512"></a><span id="l6.512">         window.getTabBrowser().removeTab(this.tab);</span>
<a href="#l6.513"></a><span id="l6.513">       ]]&gt;</span>
<a href="#l6.514"></a><span id="l6.514">       &lt;/handler&gt;</span>
<a href="#l6.515"></a><span id="l6.515" class="difflineminus">-</span>
<a href="#l6.516"></a><span id="l6.516" class="difflineminus">-      &lt;handler event=&quot;mousedown&quot;&gt;</span>
<a href="#l6.517"></a><span id="l6.517" class="difflineminus">-        // Prevent elements from getting selected. This is to ensure clicked</span>
<a href="#l6.518"></a><span id="l6.518" class="difflineminus">-        // elements won't stay highlighted.</span>
<a href="#l6.519"></a><span id="l6.519" class="difflineminus">-        this.listbox.selectedIndex = -1;</span>
<a href="#l6.520"></a><span id="l6.520" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l6.521"></a><span id="l6.521">     &lt;/handlers&gt;</span>
<a href="#l6.522"></a><span id="l6.522">   &lt;/binding&gt;</span>
<a href="#l6.523"></a><span id="l6.523"> </span>
<a href="#l6.524"></a><span id="l6.524" class="difflineminus">-  &lt;binding id=&quot;newtab-contact&quot;</span>
<a href="#l6.525"></a><span id="l6.525" class="difflineplus">+  &lt;binding id=&quot;newtab-item&quot;</span>
<a href="#l6.526"></a><span id="l6.526">     extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistitem&quot;&gt;</span>
<a href="#l6.527"></a><span id="l6.527">     &lt;content&gt;</span>
<a href="#l6.528"></a><span id="l6.528">       &lt;xul:hbox flex=&quot;1&quot;&gt;</span>
<a href="#l6.529"></a><span id="l6.529">         &lt;xul:stack class=&quot;buddyStatusIconStack&quot; mousethrough=&quot;always&quot;&gt;</span>
<a href="#l6.530"></a><span id="l6.530">           &lt;xul:image anonid=&quot;buddyIcon&quot; class=&quot;buddyIcon&quot; xbl:inherits=&quot;src=buddyIcon,status&quot;/&gt;</span>
<a href="#l6.531"></a><span id="l6.531">           &lt;xul:image anonid=&quot;statusIcon&quot; class=&quot;statusTypeIcon&quot; xbl:inherits=&quot;status&quot;/&gt;</span>
<a href="#l6.532"></a><span id="l6.532">         &lt;/xul:stack&gt;</span>
<a href="#l6.533"></a><span id="l6.533">         &lt;xul:vbox flex=&quot;1&quot;&gt;</span>
<a href="#l6.534"></a><span id="l6.534">           &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l6.535"></a><span id="l6.535">           &lt;xul:hbox&gt;</span>
<a href="#l6.536"></a><span id="l6.536">             &lt;xul:label class=&quot;displayName&quot; flex=&quot;1&quot; crop=&quot;end&quot; xbl:inherits=&quot;value=displayName,status&quot;/&gt;</span>
<a href="#l6.537"></a><span id="l6.537">             &lt;xul:hbox flex=&quot;10000&quot;&gt;</span>
<a href="#l6.538"></a><span id="l6.538">               &lt;xul:spacer flex=&quot;10000&quot;/&gt;</span>
<a href="#l6.539"></a><span id="l6.539" class="difflineminus">-              &lt;xul:image class=&quot;tagIcon&quot; xbl:inherits=&quot;status&quot;/&gt;</span>
<a href="#l6.540"></a><span id="l6.540" class="difflineminus">-              &lt;xul:label class=&quot;tags&quot; flex=&quot;1&quot; crop=&quot;end&quot; xbl:inherits=&quot;value=tags,status&quot;/&gt;</span>
<a href="#l6.541"></a><span id="l6.541" class="difflineplus">+              &lt;xul:image class=&quot;infoIcon&quot; xbl:inherits=&quot;source,selected&quot;/&gt;</span>
<a href="#l6.542"></a><span id="l6.542" class="difflineplus">+              &lt;xul:label class=&quot;infoText&quot; flex=&quot;1&quot; crop=&quot;end&quot; xbl:inherits=&quot;value=infoText&quot;/&gt;</span>
<a href="#l6.543"></a><span id="l6.543">             &lt;/xul:hbox&gt;</span>
<a href="#l6.544"></a><span id="l6.544">           &lt;/xul:hbox&gt;</span>
<a href="#l6.545"></a><span id="l6.545">           &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l6.546"></a><span id="l6.546">           &lt;xul:hbox class=&quot;statusAndProtoIconBox&quot;&gt;</span>
<a href="#l6.547"></a><span id="l6.547">             &lt;xul:label class=&quot;statusText&quot; flex=&quot;1&quot; crop=&quot;end&quot; xbl:inherits=&quot;value=statusText,status&quot;/&gt;</span>
<a href="#l6.548"></a><span id="l6.548">             &lt;xul:image class=&quot;protoIcon&quot; xbl:inherits=&quot;src=protoIcon,status&quot;/&gt;</span>
<a href="#l6.549"></a><span id="l6.549">           &lt;/xul:hbox&gt;</span>
<a href="#l6.550"></a><span id="l6.550">         &lt;/xul:vbox&gt;</span>
<a href="#l6.551"></a><span id="l6.551">       &lt;/xul:hbox&gt;</span>
<a href="#l6.552"></a><span id="l6.552">     &lt;/content&gt;</span>
<a href="#l6.553"></a><span id="l6.553"> </span>
<a href="#l6.554"></a><span id="l6.554">     &lt;implementation&gt;</span>
<a href="#l6.555"></a><span id="l6.555" class="difflineminus">-      &lt;field name=&quot;contact&quot;&gt;null&lt;/field&gt;</span>
<a href="#l6.556"></a><span id="l6.556" class="difflineplus">+      &lt;field name=&quot;target&quot;&gt;null&lt;/field&gt;</span>
<a href="#l6.557"></a><span id="l6.557"> </span>
<a href="#l6.558"></a><span id="l6.558">       &lt;method name=&quot;build&quot;&gt;</span>
<a href="#l6.559"></a><span id="l6.559" class="difflineminus">-        &lt;parameter name=&quot;aContact&quot;/&gt;</span>
<a href="#l6.560"></a><span id="l6.560" class="difflineplus">+        &lt;parameter name=&quot;aTarget&quot;/&gt;</span>
<a href="#l6.561"></a><span id="l6.561">         &lt;body&gt;</span>
<a href="#l6.562"></a><span id="l6.562">         &lt;![CDATA[</span>
<a href="#l6.563"></a><span id="l6.563" class="difflineminus">-          this.contact = aContact;</span>
<a href="#l6.564"></a><span id="l6.564" class="difflineminus">-          this.setAttribute(&quot;displayName&quot;, this.contact.displayName);</span>
<a href="#l6.565"></a><span id="l6.565" class="difflineplus">+          this.target = aTarget;</span>
<a href="#l6.566"></a><span id="l6.566" class="difflineplus">+          this.setAttribute(&quot;displayName&quot;, aTarget.displayName);</span>
<a href="#l6.567"></a><span id="l6.567">           if (!(&quot;Status&quot; in window))</span>
<a href="#l6.568"></a><span id="l6.568">             Components.utils.import(&quot;resource:///modules/imStatusUtils.jsm&quot;);</span>
<a href="#l6.569"></a><span id="l6.569" class="difflineminus">-          let status = Status.toLabel(this.contact.statusType);</span>
<a href="#l6.570"></a><span id="l6.570" class="difflineminus">-          if (this.contact.statusText)</span>
<a href="#l6.571"></a><span id="l6.571" class="difflineminus">-            status += &quot; - &quot; + this.contact.statusText;</span>
<a href="#l6.572"></a><span id="l6.572" class="difflineplus">+          this.setAttribute(&quot;status&quot;, Status.toAttribute(aTarget.statusType));</span>
<a href="#l6.573"></a><span id="l6.573" class="difflineplus">+          let status;</span>
<a href="#l6.574"></a><span id="l6.574" class="difflineplus">+          if (aTarget.isChat)</span>
<a href="#l6.575"></a><span id="l6.575" class="difflineplus">+            status = aTarget.statusText;</span>
<a href="#l6.576"></a><span id="l6.576" class="difflineplus">+          else {</span>
<a href="#l6.577"></a><span id="l6.577" class="difflineplus">+            status = Status.toLabel(aTarget.statusType);</span>
<a href="#l6.578"></a><span id="l6.578" class="difflineplus">+            let statusText = aTarget.statusText;</span>
<a href="#l6.579"></a><span id="l6.579" class="difflineplus">+            if (statusText)</span>
<a href="#l6.580"></a><span id="l6.580" class="difflineplus">+              status += &quot; - &quot; + statusText;</span>
<a href="#l6.581"></a><span id="l6.581" class="difflineplus">+          }</span>
<a href="#l6.582"></a><span id="l6.582">           this.setAttribute(&quot;statusText&quot;, status);</span>
<a href="#l6.583"></a><span id="l6.583" class="difflineminus">-          let tagNames = this.contact.getTags().map(function(aTag) aTag.name);</span>
<a href="#l6.584"></a><span id="l6.584" class="difflineminus">-          tagNames.sort(function(a, b) a.toLowerCase().localeCompare(b.toLowerCase()));</span>
<a href="#l6.585"></a><span id="l6.585" class="difflineminus">-          this.setAttribute(&quot;tags&quot;, tagNames.join(&quot;, &quot;));</span>
<a href="#l6.586"></a><span id="l6.586" class="difflineminus">-          let buddy = this.contact.preferredBuddy;</span>
<a href="#l6.587"></a><span id="l6.587" class="difflineminus">-          this.setAttribute(&quot;protoIcon&quot;, buddy.protocol.iconBaseURI + &quot;icon.png&quot;);</span>
<a href="#l6.588"></a><span id="l6.588" class="difflineminus">-          this.setAttribute(&quot;buddyIcon&quot;, buddy.buddyIconFilename || &quot;&quot;);</span>
<a href="#l6.589"></a><span id="l6.589" class="difflineminus">-          this.setAttribute(&quot;status&quot;, Status.toAttribute(buddy.statusType));</span>
<a href="#l6.590"></a><span id="l6.590" class="difflineplus">+          this.setAttribute(&quot;infoText&quot;, aTarget.infoText);</span>
<a href="#l6.591"></a><span id="l6.591" class="difflineplus">+          this.setAttribute(&quot;protoIcon&quot;, aTarget.account.protocol.iconBaseURI + &quot;icon.png&quot;);</span>
<a href="#l6.592"></a><span id="l6.592" class="difflineplus">+          this.setAttribute(&quot;buddyIcon&quot;, aTarget.buddyIconFilename);</span>
<a href="#l6.593"></a><span id="l6.593" class="difflineplus">+          this.setAttribute(&quot;source&quot;, aTarget.source);</span>
<a href="#l6.594"></a><span id="l6.594">         ]]&gt;</span>
<a href="#l6.595"></a><span id="l6.595">         &lt;/body&gt;</span>
<a href="#l6.596"></a><span id="l6.596">       &lt;/method&gt;</span>
<a href="#l6.597"></a><span id="l6.597">     &lt;/implementation&gt;</span>
<a href="#l6.598"></a><span id="l6.598"> </span>
<a href="#l6.599"></a><span id="l6.599">     &lt;handlers&gt;</span>
<a href="#l6.600"></a><span id="l6.600">       &lt;handler event=&quot;mouseup&quot;&gt;</span>
<a href="#l6.601"></a><span id="l6.601">       &lt;![CDATA[</span>
<a href="#l6.602"></a><span id="l6.602">         if (event.button == 2) // Don't handle right clicks.</span>
<a href="#l6.603"></a><span id="l6.603">           return;</span>
<a href="#l6.604"></a><span id="l6.604">         let newtab = document.getBindingParent(this);</span>
<a href="#l6.605"></a><span id="l6.605">         if (!(&quot;Conversations&quot; in window))</span>
<a href="#l6.606"></a><span id="l6.606">           Components.utils.import(&quot;resource:///modules/imWindows.jsm&quot;);</span>
<a href="#l6.607"></a><span id="l6.607" class="difflineminus">-        Conversations.focusConversation(this.contact.createConversation());</span>
<a href="#l6.608"></a><span id="l6.608" class="difflineplus">+        Conversations.focusConversation(this.target.createConversation());</span>
<a href="#l6.609"></a><span id="l6.609">         let tabbrowser = window.getTabBrowser();</span>
<a href="#l6.610"></a><span id="l6.610">         if (event.button != 1 &amp;&amp; !event.controlKey &amp;&amp; !event.metaKey)</span>
<a href="#l6.611"></a><span id="l6.611">           tabbrowser.removeTab(newtab.tab);</span>
<a href="#l6.612"></a><span id="l6.612">         else {</span>
<a href="#l6.613"></a><span id="l6.613">           tabbrowser.selectPanel(newtab);</span>
<a href="#l6.614"></a><span id="l6.614">           newtab.listbox.selectedIndex = -1;</span>
<a href="#l6.615"></a><span id="l6.615">           newtab.filterbox.focus();</span>
<a href="#l6.616"></a><span id="l6.616">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/im/installer/package-manifest.in</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/im/installer/package-manifest.in</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -444,16 +444,18 @@</span>
<a href="#l7.4"></a><span id="l7.4"> @BINPATH@/components/trayToolkit.xpt</span>
<a href="#l7.5"></a><span id="l7.5"> @BINPATH@/components/profileMigrator.js</span>
<a href="#l7.6"></a><span id="l7.6"> @BINPATH@/components/profileMigrator.manifest</span>
<a href="#l7.7"></a><span id="l7.7"> #endif</span>
<a href="#l7.8"></a><span id="l7.8"> @BINPATH@/components/contentHandler.js</span>
<a href="#l7.9"></a><span id="l7.9"> @BINPATH@/components/contentHandler.manifest</span>
<a href="#l7.10"></a><span id="l7.10"> @BINPATH@/components/ibCommandLineHandler.js</span>
<a href="#l7.11"></a><span id="l7.11"> @BINPATH@/components/ibCommandLineHandler.manifest</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+@BINPATH@/components/ibConvStatsService.js</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+@BINPATH@/components/ibConvStatsService.manifest</span>
<a href="#l7.14"></a><span id="l7.14"> @BINPATH@/components/ibStatusCommandLineHandler.js</span>
<a href="#l7.15"></a><span id="l7.15"> @BINPATH@/components/ibStatusCommandLineHandler.manifest</span>
<a href="#l7.16"></a><span id="l7.16"> @BINPATH@/components/irc.js</span>
<a href="#l7.17"></a><span id="l7.17"> @BINPATH@/components/irc.manifest</span>
<a href="#l7.18"></a><span id="l7.18"> @BINPATH@/components/facebook.js</span>
<a href="#l7.19"></a><span id="l7.19"> @BINPATH@/components/facebook.manifest</span>
<a href="#l7.20"></a><span id="l7.20"> @BINPATH@/components/gtalk.js</span>
<a href="#l7.21"></a><span id="l7.21"> @BINPATH@/components/gtalk.manifest</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/im/locales/en-US/chrome/instantbird/newtab.properties</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/im/locales/en-US/chrome/instantbird/newtab.properties</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,5 +1,6 @@</span>
<a href="#l8.4"></a><span id="l8.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> newtab.label=New Conversation</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+existingConv.infoText=Switch to conversation</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..433c25e1a39d85ef3c4545b7e0f6dd0c6baab724</span>
<a href="#l9.3"></a><span id="l9.3">GIT binary patch
literal 236
zc$@+302BX-P)&lt;h;3K|Lk000e1NJLTq000mG000UI1^@s6y}sU@00029Nkl&lt;ZC{vw~
zy$ZrG6h=EZ2)?jm27epH$=4BG9r_L;R*J=%8c47q*L=Z%f=$H&gt;r$ag4p)?_)1h-uA
z(VS13SvsZ|aNuI&amp;w|Fqddg)^NP)bqP!GVhny#@O2rGX%&amp;jDmxU&amp;DVesB1&amp;hVs;*I5
z1McS-Yb}-KB?=t49|6w!AOwoy93=#&gt;@d5WaLkDelo0F7x%JbviacHBiZ{Eemu||N5
mX*^o%p9ns-2xPC?KV(lIVEPvZT@;D{0000&lt;MNUMnLSTaKI$&amp;D&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..ab78613132887820625051be89da9a706e4b0cfe</span>
<a href="#l10.3"></a><span id="l10.3">GIT binary patch
literal 645
zc$@)+0($+4P)&lt;h;3K|Lk000e1NJLTq001BW000&amp;U1^@s6p;?|p0006^Nkl&lt;ZNQuRi
z&amp;5Ke|7{+f+?u1q?%6&lt;EiOp#_G`L(`&amp;3}(6za-j&lt;sB8r&lt;RC&lt;rEE{sf~d6f-0&lt;+7QvM
zAf1`Q0%&gt;T5`CwuwsA-(l2-^D$=Ufie*twlWi=TSWeSWWx_nxaZ8jUpI_xsO;!{NJ$
zM52{SrCRB9x+#J+oI?g#?m3;#X`j!x7zhNKR)7On&lt;AXw&gt;(EVI4H&amp;&gt;}t&gt;eXu1_!Bsn
z&amp;*$f;#0&gt;Y`Zuf&amp;oBr;0{4Js-HvT)#&lt;1&gt;*7eLa9`$m&amp;;{i9LP|%$vv0L&lt;qigewPZ5+
zIFrd3G9U{Fu2`T|EEWwJkmVlmcsv(kvDnjWHfzX$EIF6pnnR+|XtPi#7&amp;0I$7Vvt#
zCv{z4pxa}}fGjySvw+F~)gPdI2~}^Q@+MN&lt;#LAD6&gt;SL_@N22;iriu6Qf1ugy=Z&gt;I*
zv&amp;17}m-uoFyDWn&amp;_Zr04G0t(oX_y6u!{IC~d?vR4!VYEUd4c}H0SfF$c)!hoD;C(I
z#SKZe*(IFlEWN#UcsS_N=S&gt;U#CLFlpEkJ=!l5FuSK-e4e&amp;vZ6e*56os{&amp;EVgSYVy#
zNwO{!(5{AcI~}iC@YklU-#87IfB6LQk?2Z-tc@37GgdA5tK^&amp;z3tT2X5G#_r9}EUp
zeksti;P&lt;!(agsLR3wrMmZzSn3XHwY2@94NK;Ud#D3(#(?vBg&amp;wX~X4%_I~Ww*__v7
z9Gq+K_xn%G0(4Mgmu1N!D{%RsTX&amp;`}e*3=nkk*&amp;SILpY~ynWAU7N8dgasD512&gt;ala
f&lt;SYlv9(g|jcN*i;D;K{P00000NkvXXu0mjf3lB0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..f53fdda5733fa693ddfc6073c8092afc8edb5505</span>
<a href="#l11.3"></a><span id="l11.3">GIT binary patch
literal 1371
zc$@)S1*H0kP)&lt;h;3K|Lk000e1NJLTq002M$001lq1^@s6)nC5&lt;000FdNkl&lt;Zc-rNc
zS!i5U9LCQ`GpV-42gRx-Rv%geVrhL)C@qLsCR?+RgzWnc+4t=|Bw(sm5c(&gt;;GwI9)
zp%f9dVj4+onx-~2N{C5FlNj4K(&lt;V|w;`hM&gt;CbwrMkj#HZ@Zpz%IcL7#x!;_7=0=s2
zl&lt;2U5bCs2q{k65VuDZH9b2sp_%wQHX{kVEDkMlzcoph_&gt;;$j^&amp;4Gj(M_V#vHS67$O
z-QB$__*rH!i&lt;vrCO-+rdafm}F-Kwal$jVtX&lt;mv3}baGNKU=}l(ZS_@GSDP5;ypTdC
z-KwCVU&gt;jv+Wj!q|Ev}A^4kMT_li3y@OXx*8ZjNKOaIPqH&amp;_yTQeNPooRaIrQwY70#
zP+=ys&gt;97z1qRY$6dm0-X2YlQjYiMd}a#d7RT!8Z=u&amp;cbhJYQIV+1lD_NWg45{1Ax}
zE@FXBDL=Du@t5E_u;o=bIXT&lt;F1hcuh*^q$QbOgYG`|^sApNHN69Or$VDmy#d7oGto
zwxS^cv*`%HD=5h$&lt;;PF58;&amp;EsPL-LNxsB4&amp;QnS9k-jIOVbOc}@=6D4C9ysj2PL+|7
z;R}D8`H)~pz-)^z?0%J=p1zI3!a@`Gp&amp;&lt;dYExxe(RcdOgFZ=TI^F92zl7QK8*y-{E
zPi9lf&amp;upttrKF_z@-ilQa1a&gt;+umCq4N9giLZf&gt;qA&lt;!83lr;?MCeQ{usS8!Sz0`MVd
z0FLu?`GF_1DdlIj)u$2@6Ss)OJ#i6_hfe&amp;LWJthl96XocIzXoep3J6{pV?NQN=QhE
z0MWP~day+Xa8PieA|RXhp$o1HaGnHqpnTxL#CalaW?Oyy(~ED#jf;0-`*WL$LI+)R
z(j6ZkuY5^LO6uWwu)WM=w$;azkk98_SV*Ch?zp%(W#KHoDG$b-L3BBp$!x2SCn2BD
z*-%KKlkV8qSf!yhEiKKRm6hefygfOX!7OI#Tq-6erWdCne;z^#opAR7rNIWy;TGw~
zJl7r^E@m)`nL3wpI2`|L)aK@9IQh&gt;OU&lt;0|}d$0%|?2&lt;)hFpHUfTwj5QoF8Hy((SK+
zPr#pG2`uiBC1x&gt;G&gt;+%*ACLZV(lmh+$_k#&gt;GQ#8J1j)#e5T&gt;)3UgY!Y=KC`X9l}C@h
z^X`%b0cW7KEWv&amp;KsRA}OHh#zJoCM6a`l3&amp;qe(SQ+lZwTB!^Lr)F!QUcYd5Z5`#R^;
zdmp^5+W`w;Mu-KgFXG^&lt;QQ-KyXB;Qi*8U#Bd$WT6*(Xo_8IMoSeuqxFbp_0WX(8q{
z1=zrT5H)uD=O!*v&amp;_8&gt;3VzL9Squ@EZbp_0UDIw-G1#DsK&gt;;LQw7b)nU{pjP*--qj&amp;
zEx)dS8StwRGyV!7AI7G&gt;DD6+nDtU?CKm|;LUxb(rPymUL_QPS{sembPSBR+{3b0B0
z=?GLn1o#cy5rWx~{t6%=@T))tyyo31w}oK#8#@#*Dd?XJSit)FdX~4TQ6cWYQLsY+
z_XPd-0u}Hqp46^+C;lYFC&gt;-D7^-zEUCItNxx&amp;rLr6!-#+f?;9kFu`fC-%&lt;c~A;(7q
zyd%uk6&gt;u4hd8I#wh!HyJwifW$%8G~M5&gt;9683K$1B!o;|&gt;fWe{RV!VF~3&lt;c3M#7t)E
z3K#=Fgo!ar0VHZ^Y57x(-SjSea1Z%|%wQHXnQbkATh8=0J{n?f(XA=q(7_j8e{&lt;yK
zSk&gt;dlt6$&gt;K9Nw*ipJfKKn8|Ew0Tdn&amp;GfKl@0ncGxu&amp;#ipFkU&gt;}$`8+jqu|&amp;c@{cit
dS-e;s{{ly`&gt;rF95EY&lt;)3002ovPDHLkV1jTLmG=Mu</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..ced958ebbe39646e15fef004e6c1a5bb3f2f21f5</span>
<a href="#l12.3"></a><span id="l12.3">GIT binary patch
literal 425
zc$@*L0apHrP)&lt;h;3K|Lk000e1NJLTq000mG000&amp;U1^@s6$*LTD0004SNkl&lt;ZIE|gt
zT}#4X7zW@M#E$v{=6QdiqwFZ?w{;RhK_5i1nn_}2t0sPoRf;(0&amp;=f^5ORbO&amp;^C%}i
zJ&amp;&amp;klTlLO^3+KE0zR`&amp;c02nz8WxU51TI4)l?njggM3m|e6`*^Rq3pQF#uq|38;hpu
zpz3Y7&amp;A-^9d(reGU{&lt;vZ1m)sqGTQ`2YyF8b!Dz8&gt;890**5YIeup{!-#^vVGFzRrcR
zQv+Lq;u0@)kklF%QOW~$&lt;|YH1M~M|tG9a9&amp;aPeanJFCNijf2?QULe&amp;BTo&gt;@+l(&lt;lK
zKag%xmj;qTI5#|Wf;!Y?&gt;$^Ad_K6BR{yRsgL*2=*Fe~PsUl_tS9wed;djCadl&lt;`;w
z27^He58hDwAFr5|&gt;;_tR@XV=g_Z4WM&amp;Z%WL&amp;_GpAji~{=aG@G{;6z#X_kkr;Mh2&amp;n
zX`0L9|AG%6U;&lt;xrD9b4~&gt;iAf%X9{?sp|nF9b=gO^D~vvt?vO!UdIny!I3w&gt;D%N&lt;S~
T8or7A00000NkvXXu0mjf^CG#N</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/im/themes/jar.mn</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/im/themes/jar.mn</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -33,21 +33,25 @@ instantbird.jar:</span>
<a href="#l13.4"></a><span id="l13.4"> 	skin/classic/instantbird/newMessage.png</span>
<a href="#l13.5"></a><span id="l13.5"> 	skin/classic/instantbird/expand.png</span>
<a href="#l13.6"></a><span id="l13.6"> 	skin/classic/instantbird/collapse.png</span>
<a href="#l13.7"></a><span id="l13.7"> 	skin/classic/instantbird/userIcon.png</span>
<a href="#l13.8"></a><span id="l13.8"> #ifdef XP_UNIX</span>
<a href="#l13.9"></a><span id="l13.9"> #ifdef XP_MACOSX</span>
<a href="#l13.10"></a><span id="l13.10"> 	skin/classic/instantbird/tag.png        (tag-mac.png)</span>
<a href="#l13.11"></a><span id="l13.11"> 	skin/classic/instantbird/tag@2x.png     (tag-mac@2x.png)</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+	skin/classic/instantbird/actionicon-tab.png       (actionicon-tab-mac.png)</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+	skin/classic/instantbird/actionicon-tab@2x.png    (actionicon-tab-mac@2x.png)</span>
<a href="#l13.14"></a><span id="l13.14"> #else</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-	skin/classic/instantbird/tag.png        (tag-linux.png)</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+	skin/classic/instantbird/tag.png    (tag-linux.png)</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+	skin/classic/instantbird/actionicon-tab.png    (actionicon-tab-linux.png)</span>
<a href="#l13.18"></a><span id="l13.18"> #endif</span>
<a href="#l13.19"></a><span id="l13.19"> #else</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-	skin/classic/instantbird/tag.png        (tag-win.png)</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+	skin/classic/instantbird/tag.png    (tag-win.png)</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+	skin/classic/instantbird/actionicon-tab.png    (actionicon-tab-win.png)</span>
<a href="#l13.23"></a><span id="l13.23"> #endif</span>
<a href="#l13.24"></a><span id="l13.24"> #ifdef XP_UNIX</span>
<a href="#l13.25"></a><span id="l13.25"> #ifdef XP_MACOSX</span>
<a href="#l13.26"></a><span id="l13.26"> 	skin/classic/instantbird/preferences/Options.png        (preferences-pinstripe/Options.png)</span>
<a href="#l13.27"></a><span id="l13.27"> 	skin/classic/instantbird/preferences/alwaysAsk.png      (preferences-pinstripe/alwaysAsk.png)</span>
<a href="#l13.28"></a><span id="l13.28"> 	skin/classic/instantbird/preferences/application.png    (preferences-pinstripe/application.png)</span>
<a href="#l13.29"></a><span id="l13.29"> 	skin/classic/instantbird/preferences/applications.css   (preferences-pinstripe/applications.css)</span>
<a href="#l13.30"></a><span id="l13.30"> 	skin/classic/instantbird/preferences/preferences.css    (preferences-pinstripe/preferences.css)</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineat">@@ -118,16 +122,17 @@ instantbird.jar:</span>
<a href="#l13.32"></a><span id="l13.32"> 	skin/classic/aero/instantbird/status.css</span>
<a href="#l13.33"></a><span id="l13.33"> *	skin/classic/aero/instantbird/viewlog.css</span>
<a href="#l13.34"></a><span id="l13.34"> 	skin/classic/aero/instantbird/newMessage.png</span>
<a href="#l13.35"></a><span id="l13.35"> 	skin/classic/aero/instantbird/expand.png</span>
<a href="#l13.36"></a><span id="l13.36"> 	skin/classic/aero/instantbird/collapse.png</span>
<a href="#l13.37"></a><span id="l13.37"> 	skin/classic/aero/instantbird/userIcon.png</span>
<a href="#l13.38"></a><span id="l13.38"> 	skin/classic/aero/instantbird/newConversation.png</span>
<a href="#l13.39"></a><span id="l13.39"> 	skin/classic/aero/instantbird/tag.png		(tag-aero.png)</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+	skin/classic/aero/instantbird/actionicon-tab.png        (actionicon-tab-win.png)</span>
<a href="#l13.41"></a><span id="l13.41"> 	skin/classic/aero/instantbird/preferences/Options.png        (preferences-winstripe/Options-aero.png)</span>
<a href="#l13.42"></a><span id="l13.42"> 	skin/classic/aero/instantbird/preferences/alwaysAsk.png      (preferences-winstripe/alwaysAsk-aero.png)</span>
<a href="#l13.43"></a><span id="l13.43"> 	skin/classic/aero/instantbird/preferences/application.png    (preferences-winstripe/application-aero.png)</span>
<a href="#l13.44"></a><span id="l13.44"> 	skin/classic/aero/instantbird/preferences/applications.css   (preferences-winstripe/applications.css)</span>
<a href="#l13.45"></a><span id="l13.45"> 	skin/classic/aero/instantbird/preferences/preferences.css    (preferences-winstripe/preferences.css)</span>
<a href="#l13.46"></a><span id="l13.46"> 	skin/classic/aero/instantbird/preferences/saveFile.png       (preferences-winstripe/saveFile-aero.png)</span>
<a href="#l13.47"></a><span id="l13.47"> 	skin/classic/aero/instantbird/preferences/mail.png           (preferences-winstripe/mail-aero.png)</span>
<a href="#l13.48"></a><span id="l13.48"> *	skin/classic/aero/instantbird/tabbrowser.css                            (tabbrowser-winstripe/tabbrowser.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/im/themes/newtab.css</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/im/themes/newtab.css</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1,12 +1,18 @@</span>
<a href="#l14.4"></a><span id="l14.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.5"></a><span id="l14.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.6"></a><span id="l14.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8" class="difflineplus">+%ifdef XP_UNIX</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+%ifndef XP_MACOSX</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineplus">+%define XP_LINUX</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+%endif</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+%endif</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+</span>
<a href="#l14.14"></a><span id="l14.14"> .newtab-toolbar {</span>
<a href="#l14.15"></a><span id="l14.15">   margin: 0;</span>
<a href="#l14.16"></a><span id="l14.16">   padding: 2px;</span>
<a href="#l14.17"></a><span id="l14.17">   border-style: none;</span>
<a href="#l14.18"></a><span id="l14.18">   -moz-appearance: none;</span>
<a href="#l14.19"></a><span id="l14.19"> %ifdef XP_MACOSX</span>
<a href="#l14.20"></a><span id="l14.20">   background-color: -moz-mac-chrome-active;</span>
<a href="#l14.21"></a><span id="l14.21">   background-image: -moz-linear-gradient(rgba(255,255,255,.43), rgba(255,255,255,0));</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -49,17 +55,56 @@</span>
<a href="#l14.23"></a><span id="l14.23">   padding-top: 4px;</span>
<a href="#l14.24"></a><span id="l14.24">   padding-bottom: 4px;</span>
<a href="#l14.25"></a><span id="l14.25"> }</span>
<a href="#l14.26"></a><span id="l14.26"> </span>
<a href="#l14.27"></a><span id="l14.27"> .displayName {</span>
<a href="#l14.28"></a><span id="l14.28">   font-size: large;</span>
<a href="#l14.29"></a><span id="l14.29"> }</span>
<a href="#l14.30"></a><span id="l14.30"> </span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-.tags {</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+.infoIcon {</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+  height: 16px;</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+  width: 16px;</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+  max-height: 16px;</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+  max-width: 16px;</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+}</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+.infoIcon[source=&quot;contact&quot;] {</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+  list-style-image: url(&quot;chrome://instantbird/skin/tag.png&quot;);</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+}</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+.infoIcon[source=&quot;existing&quot;] {</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+  list-style-image: url(&quot;chrome://instantbird/skin/actionicon-tab.png&quot;);</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+  padding: 3px 0 2px;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+%ifndef XP_LINUX</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+  -moz-image-region: rect(0, 16px, 11px, 0);</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+}</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+.infoIcon[source=&quot;existing&quot;][selected=&quot;true&quot;] {</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+  -moz-image-region: rect(11px, 16px, 22px, 0);</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+%endif</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+}</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+@media (min-resolution: 2dppx) {</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+  .infoIcon[source=&quot;contact&quot;] {</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+    list-style-image: url(&quot;chrome://instantbird/skin/tag@2x.png&quot;);</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+  }</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+  .infoIcon[source=&quot;existing&quot;] {</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+    list-style-image: url(&quot;chrome://instantbird/skin/actionicon-tab@2x.png&quot;);</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+    -moz-image-region: rect(0, 32px, 22px, 0);</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+  }</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+  .infoIcon[source=&quot;existing&quot;][selected=&quot;true&quot;] {</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+    -moz-image-region: rect(22px, 32px, 44px, 0);</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+  }</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+}</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+.infoText {</span>
<a href="#l14.72"></a><span id="l14.72">   margin-right: 0px !important;</span>
<a href="#l14.73"></a><span id="l14.73"> }</span>
<a href="#l14.74"></a><span id="l14.74"> </span>
<a href="#l14.75"></a><span id="l14.75"> .buddyIcon {</span>
<a href="#l14.76"></a><span id="l14.76">   border: 2px solid rgba(0,0,0,0.15);</span>
<a href="#l14.77"></a><span id="l14.77">   border-radius: 5px;</span>
<a href="#l14.78"></a><span id="l14.78">   overflow: hidden;</span>
<a href="#l14.79"></a><span id="l14.79">   max-width: 48px;</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineat">@@ -76,30 +121,16 @@</span>
<a href="#l14.81"></a><span id="l14.81"> </span>
<a href="#l14.82"></a><span id="l14.82"> .statusTypeIcon {</span>
<a href="#l14.83"></a><span id="l14.83">   margin-top: 32px;</span>
<a href="#l14.84"></a><span id="l14.84">   margin-left: 32px;</span>
<a href="#l14.85"></a><span id="l14.85">   width: 16px;</span>
<a href="#l14.86"></a><span id="l14.86">   height: 16px;</span>
<a href="#l14.87"></a><span id="l14.87"> }</span>
<a href="#l14.88"></a><span id="l14.88"> </span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-.tagIcon {</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-  height: 16px;</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-  width: 16px;</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-  max-height: 16px;</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineminus">-  max-width: 16px;</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-  list-style-image: url(&quot;chrome://instantbird/skin/tag.png&quot;);</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-}</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-@media (min-resolution: 2dppx) {</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-  .tagIcon {</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-    list-style-image: url(&quot;chrome://instantbird/skin/tag@2x.png&quot;);</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-  }</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-}</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-</span>
<a href="#l14.103"></a><span id="l14.103"> .protoIcon {</span>
<a href="#l14.104"></a><span id="l14.104">   width: 16px;</span>
<a href="#l14.105"></a><span id="l14.105">   height: 16px;</span>
<a href="#l14.106"></a><span id="l14.106">   max-width: 16px;</span>
<a href="#l14.107"></a><span id="l14.107">   max-height: 16px;</span>
<a href="#l14.108"></a><span id="l14.108">   margin-right: 0px;</span>
<a href="#l14.109"></a><span id="l14.109"> }</span>
<a href="#l14.110"></a><span id="l14.110"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

