<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22296:9c0e3022858b6fc0f25c4b9f32563ee143075467</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9c0e3022858b6fc0f25c4b9f32563ee143075467" />
<meta property="og:url" content="/comm-central/rev/9c0e3022858b6fc0f25c4b9f32563ee143075467" />
<meta property="og:description" content="Bug 1399756 - remove trailing spaces in mailnews/local. rs=white-space-only CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9c0e3022858b6fc0f25c4b9f32563ee143075467 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9c0e3022858b6fc0f25c4b9f32563ee143075467">shortlog</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9c0e3022858b6fc0f25c4b9f32563ee143075467">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467">files</a> |
changeset |
<a href="/comm-central/raw-rev/9c0e3022858b6fc0f25c4b9f32563ee143075467">raw</a>  | <a href="/comm-central/archive/9c0e3022858b6fc0f25c4b9f32563ee143075467.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1399756">Bug 1399756</a> - remove trailing spaces in mailnews/local. rs=white-space-only CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 08 Oct 2017 17:57:10 +0200</td></tr>

<tr>
 <td>changeset 22296</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9c0e3022858b6fc0f25c4b9f32563ee143075467">9c0e3022858b6fc0f25c4b9f32563ee143075467</a></td>
</tr>



<tr>
<td>parent 22295</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/434e56e5ffc732a536ea8e3d426449a9231b85eb">434e56e5ffc732a536ea8e3d426449a9231b85eb</a>
</td>
</tr>

<tr>
<td>child 22297</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/076da1348bcce4fc0b579531505709fb0601b790">076da1348bcce4fc0b579531505709fb0601b790</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9c0e3022858b6fc0f25c4b9f32563ee143075467">13597</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 08 Oct 2017 15:58:30 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9c0e3022858b [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9c0e3022858b6fc0f25c4b9f32563ee143075467">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9c0e3022858b6fc0f25c4b9f32563ee143075467&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9c0e3022858b6fc0f25c4b9f32563ee143075467&newProject=comm-central&newRevision=9c0e3022858b6fc0f25c4b9f32563ee143075467&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9c0e3022858b6fc0f25c4b9f32563ee143075467&newProject=comm-central&newRevision=9c0e3022858b6fc0f25c4b9f32563ee143075467&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9c0e3022858b6fc0f25c4b9f32563ee143075467&newProject=comm-central&newRevision=9c0e3022858b6fc0f25c4b9f32563ee143075467&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28white-space-only%29&revcount=50">white-space-only</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1399756">1399756</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1399756">Bug 1399756</a> - remove trailing spaces in mailnews/local. rs=white-space-only CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.h">mailnews/local/src/nsLocalMailFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.h">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.h">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.h">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.h">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalMailFolder.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUndoTxn.cpp">mailnews/local/src/nsLocalUndoTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUndoTxn.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUndoTxn.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUndoTxn.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUndoTxn.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUndoTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.cpp">mailnews/local/src/nsLocalUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.h">mailnews/local/src/nsLocalUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.h">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.h">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.h">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.h">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsLocalUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMailboxUrl.cpp">mailnews/local/src/nsMailboxUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMailboxUrl.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMailboxUrl.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMailboxUrl.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMailboxUrl.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMailboxUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailIncomingServer.cpp">mailnews/local/src/nsMovemailIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailService.cpp">mailnews/local/src/nsMovemailService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailService.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailService.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailService.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailService.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMovemailService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMsgLocalStoreUtils.cpp">mailnews/local/src/nsMsgLocalStoreUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMsgLocalStoreUtils.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMsgLocalStoreUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMsgLocalStoreUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMsgLocalStoreUtils.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsMsgLocalStoreUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsNoneService.cpp">mailnews/local/src/nsNoneService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsNoneService.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsNoneService.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsNoneService.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsNoneService.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsNoneService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Service.h">mailnews/local/src/nsPop3Service.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Service.h">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Service.h">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Service.h">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Service.h">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsPop3Service.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.cpp">mailnews/local/src/nsRssService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.cpp">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.cpp">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.cpp">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.cpp">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.h">mailnews/local/src/nsRssService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.h">file</a> |
<a href="/comm-central/annotate/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.h">annotate</a> |
<a href="/comm-central/diff/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.h">diff</a> |
<a href="/comm-central/comparison/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.h">comparison</a> |
<a href="/comm-central/log/9c0e3022858b6fc0f25c4b9f32563ee143075467/mailnews/local/src/nsRssService.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1814,17 +1814,17 @@ nsMsgLocalMailFolder::CopyFolderLocal(ns</span>
<a href="#l1.4"></a><span id="l1.4">   nsresult rv = IsChildOfTrash(&amp;isChildOfTrash);</span>
<a href="#l1.5"></a><span id="l1.5">   if (NS_SUCCEEDED(rv) &amp;&amp; isChildOfTrash)</span>
<a href="#l1.6"></a><span id="l1.6">   {</span>
<a href="#l1.7"></a><span id="l1.7">     // do it just for the parent folder (isMoveFolder is true for parent only) if we are deleting/moving a folder tree</span>
<a href="#l1.8"></a><span id="l1.8">     // don't confirm for rss folders.</span>
<a href="#l1.9"></a><span id="l1.9">     if (isMoveFolder)</span>
<a href="#l1.10"></a><span id="l1.10">     {</span>
<a href="#l1.11"></a><span id="l1.11">       // if there's a msgWindow, confirm the deletion</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      if (msgWindow) </span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      if (msgWindow)</span>
<a href="#l1.14"></a><span id="l1.14">       {</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16">         bool okToDelete = false;</span>
<a href="#l1.17"></a><span id="l1.17">         ConfirmFolderDeletion(msgWindow, srcFolder, &amp;okToDelete);</span>
<a href="#l1.18"></a><span id="l1.18">         if (!okToDelete)</span>
<a href="#l1.19"></a><span id="l1.19">           return NS_MSG_ERROR_COPY_FOLDER_ABORTED;</span>
<a href="#l1.20"></a><span id="l1.20">       }</span>
<a href="#l1.21"></a><span id="l1.21">       // if we are moving a favorite folder to trash, we should clear the favorites flag</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -1892,17 +1892,17 @@ nsMsgLocalMailFolder::CopyFolderLocal(ns</span>
<a href="#l1.23"></a><span id="l1.23">     return rv;</span>
<a href="#l1.24"></a><span id="l1.24">   }</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   return msgStore-&gt;CopyFolder(srcFolder, this, isMoveFolder, msgWindow,</span>
<a href="#l1.27"></a><span id="l1.27">                               aListener, newFolderName);</span>
<a href="#l1.28"></a><span id="l1.28"> }</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30"> NS_IMETHODIMP</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-nsMsgLocalMailFolder::CopyFileMessage(nsIFile* aFile, </span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+nsMsgLocalMailFolder::CopyFileMessage(nsIFile* aFile,</span>
<a href="#l1.33"></a><span id="l1.33">                                       nsIMsgDBHdr *msgToReplace,</span>
<a href="#l1.34"></a><span id="l1.34">                                       bool isDraftOrTemplate,</span>
<a href="#l1.35"></a><span id="l1.35">                                       uint32_t newMsgFlags,</span>
<a href="#l1.36"></a><span id="l1.36">                                       const nsACString &amp;aNewMsgKeywords,</span>
<a href="#l1.37"></a><span id="l1.37">                                       nsIMsgWindow *msgWindow,</span>
<a href="#l1.38"></a><span id="l1.38">                                       nsIMsgCopyServiceListener* listener)</span>
<a href="#l1.39"></a><span id="l1.39"> {</span>
<a href="#l1.40"></a><span id="l1.40">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineat">@@ -1938,22 +1938,22 @@ nsMsgLocalMailFolder::CopyFileMessage(ns</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43">     nsCOMPtr&lt;nsIInputStream&gt; inputStream;</span>
<a href="#l1.44"></a><span id="l1.44">     rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), aFile);</span>
<a href="#l1.45"></a><span id="l1.45"> </span>
<a href="#l1.46"></a><span id="l1.46">     // All or none for adding a message file to the store</span>
<a href="#l1.47"></a><span id="l1.47">     if (NS_SUCCEEDED(rv) &amp;&amp; fileSize &gt; PR_INT32_MAX)</span>
<a href="#l1.48"></a><span id="l1.48">         rv = NS_ERROR_ILLEGAL_VALUE; // may need error code for max msg size</span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; inputStream) </span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; inputStream)</span>
<a href="#l1.52"></a><span id="l1.52">     {</span>
<a href="#l1.53"></a><span id="l1.53">       char buffer[5];</span>
<a href="#l1.54"></a><span id="l1.54">       uint32_t readCount;</span>
<a href="#l1.55"></a><span id="l1.55">       rv = inputStream-&gt;Read(buffer, 5, &amp;readCount);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-      if (NS_SUCCEEDED(rv)) </span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+      if (NS_SUCCEEDED(rv))</span>
<a href="#l1.58"></a><span id="l1.58">       {</span>
<a href="#l1.59"></a><span id="l1.59">         if (strncmp(buffer, &quot;From &quot;, 5))</span>
<a href="#l1.60"></a><span id="l1.60">           mCopyState-&gt;m_dummyEnvelopeNeeded = true;</span>
<a href="#l1.61"></a><span id="l1.61">         nsCOMPtr &lt;nsISeekableStream&gt; seekableStream = do_QueryInterface(inputStream, &amp;rv);</span>
<a href="#l1.62"></a><span id="l1.62">         if (NS_SUCCEEDED(rv))</span>
<a href="#l1.63"></a><span id="l1.63">           seekableStream-&gt;Seek(nsISeekableStream::NS_SEEK_SET, 0);</span>
<a href="#l1.64"></a><span id="l1.64">       }</span>
<a href="#l1.65"></a><span id="l1.65">     }</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineat">@@ -2461,17 +2461,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::EndC</span>
<a href="#l1.67"></a><span id="l1.67">   if (mCopyState-&gt;m_parseMsgState)</span>
<a href="#l1.68"></a><span id="l1.68">   {</span>
<a href="#l1.69"></a><span id="l1.69">     nsCOMPtr&lt;nsIMsgDatabase&gt; msgDb;</span>
<a href="#l1.70"></a><span id="l1.70">     mCopyState-&gt;m_parseMsgState-&gt;FinishHeader();</span>
<a href="#l1.71"></a><span id="l1.71">     GetDatabaseWOReparse(getter_AddRefs(msgDb));</span>
<a href="#l1.72"></a><span id="l1.72">     if (msgDb)</span>
<a href="#l1.73"></a><span id="l1.73">     {</span>
<a href="#l1.74"></a><span id="l1.74">       nsresult result = mCopyState-&gt;m_parseMsgState-&gt;GetNewMsgHdr(getter_AddRefs(newHdr));</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-      // we need to copy newHdr because mCopyState will get cleared </span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+      // we need to copy newHdr because mCopyState will get cleared</span>
<a href="#l1.77"></a><span id="l1.77">       // in OnCopyCompleted, but we need OnCopyCompleted to know about</span>
<a href="#l1.78"></a><span id="l1.78">       // the newHdr, via mCopyState. And we send a notification about newHdr</span>
<a href="#l1.79"></a><span id="l1.79">       // after OnCopyCompleted.</span>
<a href="#l1.80"></a><span id="l1.80">       mCopyState-&gt;m_newHdr = newHdr;</span>
<a href="#l1.81"></a><span id="l1.81">       if (NS_SUCCEEDED(result) &amp;&amp; newHdr)</span>
<a href="#l1.82"></a><span id="l1.82">       {</span>
<a href="#l1.83"></a><span id="l1.83">         // Copy message metadata.</span>
<a href="#l1.84"></a><span id="l1.84">         if (mCopyState-&gt;m_message)</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineat">@@ -2480,17 +2480,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::EndC</span>
<a href="#l1.86"></a><span id="l1.86">           // Flags may get changed when deleting the original source message in</span>
<a href="#l1.87"></a><span id="l1.87">           // IMAP. We have a copy of the original flags, but parseMsgState has</span>
<a href="#l1.88"></a><span id="l1.88">           // already tried to decide what those flags should be. Who to believe?</span>
<a href="#l1.89"></a><span id="l1.89">           // Let's only deal here with the flags that might get changed, Read</span>
<a href="#l1.90"></a><span id="l1.90">           // and New, and trust upstream code for everything else.</span>
<a href="#l1.91"></a><span id="l1.91">           uint32_t readAndNew = nsMsgMessageFlags::New | nsMsgMessageFlags::Read;</span>
<a href="#l1.92"></a><span id="l1.92">           uint32_t newFlags;</span>
<a href="#l1.93"></a><span id="l1.93">           newHdr-&gt;GetFlags(&amp;newFlags);</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-          newHdr-&gt;SetFlags( (newFlags &amp; ~readAndNew) | </span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+          newHdr-&gt;SetFlags( (newFlags &amp; ~readAndNew) |</span>
<a href="#l1.96"></a><span id="l1.96">                             ((mCopyState-&gt;m_flags) &amp; readAndNew));</span>
<a href="#l1.97"></a><span id="l1.97"> </span>
<a href="#l1.98"></a><span id="l1.98">           // Copy other message properties.</span>
<a href="#l1.99"></a><span id="l1.99">           CopyPropertiesToMsgHdr(newHdr, mCopyState-&gt;m_message, mCopyState-&gt;m_isMove);</span>
<a href="#l1.100"></a><span id="l1.100">         }</span>
<a href="#l1.101"></a><span id="l1.101">         msgDb-&gt;AddNewHdrToDB(newHdr, true);</span>
<a href="#l1.102"></a><span id="l1.102">         if (localUndoTxn)</span>
<a href="#l1.103"></a><span id="l1.103">         {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -28,17 +28,17 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #define COPY_BUFFER_SIZE 16384</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> class nsParseMailMessageState;</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> struct nsLocalMailCopyState</span>
<a href="#l2.9"></a><span id="l2.9"> {</span>
<a href="#l2.10"></a><span id="l2.10">   nsLocalMailCopyState();</span>
<a href="#l2.11"></a><span id="l2.11">   virtual ~nsLocalMailCopyState();</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  </span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+</span>
<a href="#l2.14"></a><span id="l2.14">   nsCOMPtr &lt;nsIOutputStream&gt; m_fileStream;</span>
<a href="#l2.15"></a><span id="l2.15">   nsCOMPtr&lt;nsIMsgPluggableStore&gt; m_msgStore;</span>
<a href="#l2.16"></a><span id="l2.16">   nsCOMPtr&lt;nsISupports&gt; m_srcSupport;</span>
<a href="#l2.17"></a><span id="l2.17">   /// Source nsIMsgDBHdr instances.</span>
<a href="#l2.18"></a><span id="l2.18">   nsCOMPtr&lt;nsIArray&gt; m_messages;</span>
<a href="#l2.19"></a><span id="l2.19">   /// Destination nsIMsgDBHdr instances.</span>
<a href="#l2.20"></a><span id="l2.20">   nsCOMPtr&lt;nsIMutableArray&gt; m_destMessages;</span>
<a href="#l2.21"></a><span id="l2.21">   RefPtr&lt;nsLocalMoveCopyMsgTxn&gt; m_undoMsgTxn;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -133,27 +133,27 @@ public:</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">   NS_IMETHOD GetManyHeadersToDownload(bool *retval) override;</span>
<a href="#l2.25"></a><span id="l2.25"> </span>
<a href="#l2.26"></a><span id="l2.26">   NS_IMETHOD GetDeletable (bool *deletable) override;</span>
<a href="#l2.27"></a><span id="l2.27">   NS_IMETHOD GetSizeOnDisk(int64_t *size) override;</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29">   NS_IMETHOD GetDBFolderInfoAndDB(nsIDBFolderInfo **folderInfo, nsIMsgDatabase **db) override;</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  NS_IMETHOD DeleteMessages(nsIArray *messages, </span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  NS_IMETHOD DeleteMessages(nsIArray *messages,</span>
<a href="#l2.33"></a><span id="l2.33">                       nsIMsgWindow *msgWindow, bool</span>
<a href="#l2.34"></a><span id="l2.34">                       deleteStorage, bool isMove,</span>
<a href="#l2.35"></a><span id="l2.35">                       nsIMsgCopyServiceListener* listener, bool allowUndo) override;</span>
<a href="#l2.36"></a><span id="l2.36">   NS_IMETHOD CopyMessages(nsIMsgFolder *srcFolder, nsIArray* messages,</span>
<a href="#l2.37"></a><span id="l2.37">                           bool isMove, nsIMsgWindow *msgWindow,</span>
<a href="#l2.38"></a><span id="l2.38">                           nsIMsgCopyServiceListener* listener, bool isFolder, bool allowUndo) override;</span>
<a href="#l2.39"></a><span id="l2.39">   NS_IMETHOD CopyFolder(nsIMsgFolder *srcFolder, bool isMoveFolder, nsIMsgWindow *msgWindow,</span>
<a href="#l2.40"></a><span id="l2.40">                           nsIMsgCopyServiceListener* listener) override;</span>
<a href="#l2.41"></a><span id="l2.41">   NS_IMETHOD CopyFileMessage(nsIFile* aFile, nsIMsgDBHdr* msgToReplace,</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-                             bool isDraftOrTemplate, </span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+                             bool isDraftOrTemplate,</span>
<a href="#l2.44"></a><span id="l2.44">                              uint32_t newMsgFlags,</span>
<a href="#l2.45"></a><span id="l2.45">                              const nsACString &amp;aNewMsgKeywords,</span>
<a href="#l2.46"></a><span id="l2.46">                              nsIMsgWindow *msgWindow,</span>
<a href="#l2.47"></a><span id="l2.47">                              nsIMsgCopyServiceListener* listener) override;</span>
<a href="#l2.48"></a><span id="l2.48"> </span>
<a href="#l2.49"></a><span id="l2.49">   NS_IMETHOD AddMessageDispositionState(nsIMsgDBHdr *aMessage, nsMsgDispositionState aDispositionFlag) override;</span>
<a href="#l2.50"></a><span id="l2.50">   NS_IMETHOD MarkMessagesRead(nsIArray *aMessages, bool aMarkRead) override;</span>
<a href="#l2.51"></a><span id="l2.51">   NS_IMETHOD MarkMessagesFlagged(nsIArray *aMessages, bool aMarkFlagged) override;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineat">@@ -166,17 +166,17 @@ public:</span>
<a href="#l2.53"></a><span id="l2.53">   NS_IMETHOD WriteToFolderCacheElem(nsIMsgFolderCacheElement *element) override;</span>
<a href="#l2.54"></a><span id="l2.54">   NS_IMETHOD ReadFromFolderCacheElem(nsIMsgFolderCacheElement *element) override;</span>
<a href="#l2.55"></a><span id="l2.55"> </span>
<a href="#l2.56"></a><span id="l2.56">   NS_IMETHOD GetName(nsAString&amp; aName) override;</span>
<a href="#l2.57"></a><span id="l2.57"> </span>
<a href="#l2.58"></a><span id="l2.58">   // Used when headers_only is TRUE</span>
<a href="#l2.59"></a><span id="l2.59">   NS_IMETHOD DownloadMessagesForOffline(nsIArray *aMessages, nsIMsgWindow *aWindow) override;</span>
<a href="#l2.60"></a><span id="l2.60">   NS_IMETHOD FetchMsgPreviewText(nsMsgKey *aKeysToFetch, uint32_t aNumKeys,</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-                                                 bool aLocalOnly, nsIUrlListener *aUrlListener, </span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+                                                 bool aLocalOnly, nsIUrlListener *aUrlListener,</span>
<a href="#l2.63"></a><span id="l2.63">                                                  bool *aAsyncResults) override;</span>
<a href="#l2.64"></a><span id="l2.64">   NS_IMETHOD AddKeywordsToMessages(nsIArray *aMessages, const nsACString&amp; aKeywords) override;</span>
<a href="#l2.65"></a><span id="l2.65">   NS_IMETHOD RemoveKeywordsFromMessages(nsIArray *aMessages, const nsACString&amp; aKeywords) override;</span>
<a href="#l2.66"></a><span id="l2.66">   NS_IMETHOD GetIncomingServerType(nsACString&amp; serverType) override;</span>
<a href="#l2.67"></a><span id="l2.67"> </span>
<a href="#l2.68"></a><span id="l2.68"> protected:</span>
<a href="#l2.69"></a><span id="l2.69">   virtual ~nsMsgLocalMailFolder();</span>
<a href="#l2.70"></a><span id="l2.70">   nsresult CreateChildFromURI(const nsCString &amp;uri, nsIMsgFolder **folder) override;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -47,17 +47,17 @@ nsLocalMoveCopyMsgTxn::Init(nsIMsgFolder</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">     nsCString protocolType;</span>
<a href="#l3.6"></a><span id="l3.6">     rv = srcFolder-&gt;GetURI(protocolType);</span>
<a href="#l3.7"></a><span id="l3.7">     protocolType.SetLength(protocolType.FindChar(':'));</span>
<a href="#l3.8"></a><span id="l3.8">     if (MsgLowerCaseEqualsLiteral(protocolType, &quot;imap&quot;))</span>
<a href="#l3.9"></a><span id="l3.9">       m_srcIsImap4 = true;</span>
<a href="#l3.10"></a><span id="l3.10">     return nsMsgTxn::Init();</span>
<a href="#l3.11"></a><span id="l3.11"> }</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-nsresult </span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+nsresult</span>
<a href="#l3.14"></a><span id="l3.14"> nsLocalMoveCopyMsgTxn::GetSrcIsImap(bool *isImap)</span>
<a href="#l3.15"></a><span id="l3.15"> {</span>
<a href="#l3.16"></a><span id="l3.16">   *isImap = m_srcIsImap4;</span>
<a href="#l3.17"></a><span id="l3.17">   return NS_OK;</span>
<a href="#l3.18"></a><span id="l3.18"> }</span>
<a href="#l3.19"></a><span id="l3.19"> nsresult</span>
<a href="#l3.20"></a><span id="l3.20"> nsLocalMoveCopyMsgTxn::SetSrcFolder(nsIMsgFolder* srcFolder)</span>
<a href="#l3.21"></a><span id="l3.21"> {</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -101,17 +101,17 @@ nsLocalMoveCopyMsgTxn::AddDstKey(nsMsgKe</span>
<a href="#l3.23"></a><span id="l3.23"> nsresult</span>
<a href="#l3.24"></a><span id="l3.24"> nsLocalMoveCopyMsgTxn::AddDstMsgSize(uint32_t msgSize)</span>
<a href="#l3.25"></a><span id="l3.25"> {</span>
<a href="#l3.26"></a><span id="l3.26">     m_dstSizeArray.AppendElement(msgSize);</span>
<a href="#l3.27"></a><span id="l3.27">     return NS_OK;</span>
<a href="#l3.28"></a><span id="l3.28"> }</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30"> nsresult</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-nsLocalMoveCopyMsgTxn::UndoImapDeleteFlag(nsIMsgFolder* folder, </span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+nsLocalMoveCopyMsgTxn::UndoImapDeleteFlag(nsIMsgFolder* folder,</span>
<a href="#l3.33"></a><span id="l3.33">                                           nsTArray&lt;nsMsgKey&gt;&amp; keyArray,</span>
<a href="#l3.34"></a><span id="l3.34">                                           bool deleteFlag)</span>
<a href="#l3.35"></a><span id="l3.35"> {</span>
<a href="#l3.36"></a><span id="l3.36">   nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l3.37"></a><span id="l3.37">   if (m_srcIsImap4)</span>
<a href="#l3.38"></a><span id="l3.38">   {</span>
<a href="#l3.39"></a><span id="l3.39">     nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l3.40"></a><span id="l3.40">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineat">@@ -151,74 +151,74 @@ nsLocalMoveCopyMsgTxn::UndoImapDeleteFla</span>
<a href="#l3.42"></a><span id="l3.42">   return rv;</span>
<a href="#l3.43"></a><span id="l3.43"> }</span>
<a href="#l3.44"></a><span id="l3.44"> </span>
<a href="#l3.45"></a><span id="l3.45"> NS_IMETHODIMP</span>
<a href="#l3.46"></a><span id="l3.46"> nsLocalMoveCopyMsgTxn::UndoTransaction()</span>
<a href="#l3.47"></a><span id="l3.47"> {</span>
<a href="#l3.48"></a><span id="l3.48">   nsresult rv;</span>
<a href="#l3.49"></a><span id="l3.49">   nsCOMPtr&lt;nsIMsgDatabase&gt; dstDB;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-  </span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+</span>
<a href="#l3.52"></a><span id="l3.52">   nsCOMPtr&lt;nsIMsgFolder&gt; dstFolder = do_QueryReferent(m_dstFolder, &amp;rv);</span>
<a href="#l3.53"></a><span id="l3.53">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.54"></a><span id="l3.54">   nsCOMPtr&lt;nsIMsgLocalMailFolder&gt; dstlocalMailFolder = do_QueryReferent(m_dstFolder, &amp;rv);</span>
<a href="#l3.55"></a><span id="l3.55">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.56"></a><span id="l3.56">   dstlocalMailFolder-&gt;GetDatabaseWOReparse(getter_AddRefs(dstDB));</span>
<a href="#l3.57"></a><span id="l3.57"> </span>
<a href="#l3.58"></a><span id="l3.58">   if (!dstDB)</span>
<a href="#l3.59"></a><span id="l3.59">   {</span>
<a href="#l3.60"></a><span id="l3.60">     // This will listen for the db reparse finishing, and the corresponding</span>
<a href="#l3.61"></a><span id="l3.61">     // FolderLoadedNotification. When it gets that, it will then call</span>
<a href="#l3.62"></a><span id="l3.62">     // UndoTransactionInternal.</span>
<a href="#l3.63"></a><span id="l3.63">     mUndoFolderListener = new nsLocalUndoFolderListener(this, dstFolder);</span>
<a href="#l3.64"></a><span id="l3.64">     if (!mUndoFolderListener)</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-      return NS_ERROR_OUT_OF_MEMORY; </span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+      return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l3.67"></a><span id="l3.67">     NS_ADDREF(mUndoFolderListener);</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-    </span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-    nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = </span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-      do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv); </span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+    nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession =</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+      do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l3.74"></a><span id="l3.74">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-    </span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+</span>
<a href="#l3.77"></a><span id="l3.77">     rv = mailSession-&gt;AddFolderListener(mUndoFolderListener, nsIFolderListener::event);</span>
<a href="#l3.78"></a><span id="l3.78">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-    </span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+</span>
<a href="#l3.81"></a><span id="l3.81">     rv = dstFolder-&gt;GetMsgDatabase(getter_AddRefs(dstDB));</span>
<a href="#l3.82"></a><span id="l3.82">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.83"></a><span id="l3.83">   }</span>
<a href="#l3.84"></a><span id="l3.84">   else</span>
<a href="#l3.85"></a><span id="l3.85">     rv = UndoTransactionInternal();</span>
<a href="#l3.86"></a><span id="l3.86">   return rv;</span>
<a href="#l3.87"></a><span id="l3.87"> }</span>
<a href="#l3.88"></a><span id="l3.88"> </span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-nsresult </span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+nsresult</span>
<a href="#l3.91"></a><span id="l3.91"> nsLocalMoveCopyMsgTxn::UndoTransactionInternal()</span>
<a href="#l3.92"></a><span id="l3.92"> {</span>
<a href="#l3.93"></a><span id="l3.93">   nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l3.94"></a><span id="l3.94"> </span>
<a href="#l3.95"></a><span id="l3.95">   if (mUndoFolderListener)</span>
<a href="#l3.96"></a><span id="l3.96">   {</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-    nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = </span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-      do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv); </span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+    nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession =</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+      do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l3.101"></a><span id="l3.101">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-    </span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+</span>
<a href="#l3.104"></a><span id="l3.104">     rv = mailSession-&gt;RemoveFolderListener(mUndoFolderListener);</span>
<a href="#l3.105"></a><span id="l3.105">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-    </span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+</span>
<a href="#l3.108"></a><span id="l3.108">     NS_RELEASE(mUndoFolderListener);</span>
<a href="#l3.109"></a><span id="l3.109">     mUndoFolderListener = nullptr;</span>
<a href="#l3.110"></a><span id="l3.110">   }</span>
<a href="#l3.111"></a><span id="l3.111"> </span>
<a href="#l3.112"></a><span id="l3.112">   nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l3.113"></a><span id="l3.113">   nsCOMPtr&lt;nsIMsgDatabase&gt; dstDB;</span>
<a href="#l3.114"></a><span id="l3.114">   nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder = do_QueryReferent(m_srcFolder, &amp;rv);</span>
<a href="#l3.115"></a><span id="l3.115">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-  </span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+</span>
<a href="#l3.118"></a><span id="l3.118">   nsCOMPtr&lt;nsIMsgFolder&gt; dstFolder = do_QueryReferent(m_dstFolder, &amp;rv);</span>
<a href="#l3.119"></a><span id="l3.119">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineminus">-  </span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+</span>
<a href="#l3.122"></a><span id="l3.122">   rv = srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l3.123"></a><span id="l3.123">   if(NS_FAILED(rv)) return rv;</span>
<a href="#l3.124"></a><span id="l3.124"> </span>
<a href="#l3.125"></a><span id="l3.125">   rv = dstFolder-&gt;GetMsgDatabase(getter_AddRefs(dstDB));</span>
<a href="#l3.126"></a><span id="l3.126">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.127"></a><span id="l3.127"> </span>
<a href="#l3.128"></a><span id="l3.128">   uint32_t count = m_srcKeyArray.Length();</span>
<a href="#l3.129"></a><span id="l3.129">   uint32_t i;</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineat">@@ -243,25 +243,25 @@ nsLocalMoveCopyMsgTxn::UndoTransactionIn</span>
<a href="#l3.131"></a><span id="l3.131">     {</span>
<a href="#l3.132"></a><span id="l3.132">       nsCOMPtr&lt;nsIMutableArray&gt; srcMessages =</span>
<a href="#l3.133"></a><span id="l3.133">         do_CreateInstance(NS_ARRAY_CONTRACTID);</span>
<a href="#l3.134"></a><span id="l3.134">       nsCOMPtr&lt;nsIMutableArray&gt; dstMessages =</span>
<a href="#l3.135"></a><span id="l3.135">         do_CreateInstance(NS_ARRAY_CONTRACTID);</span>
<a href="#l3.136"></a><span id="l3.136"> </span>
<a href="#l3.137"></a><span id="l3.137">       for (i = 0; i &lt; count; i++)</span>
<a href="#l3.138"></a><span id="l3.138">       {</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineminus">-        rv = dstDB-&gt;GetMsgHdrForKey(m_dstKeyArray[i], </span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+        rv = dstDB-&gt;GetMsgHdrForKey(m_dstKeyArray[i],</span>
<a href="#l3.141"></a><span id="l3.141">                                     getter_AddRefs(oldHdr));</span>
<a href="#l3.142"></a><span id="l3.142">         NS_ASSERTION(oldHdr, &quot;fatal ... cannot get old msg header\n&quot;);</span>
<a href="#l3.143"></a><span id="l3.143">         if (NS_SUCCEEDED(rv) &amp;&amp; oldHdr)</span>
<a href="#l3.144"></a><span id="l3.144">         {</span>
<a href="#l3.145"></a><span id="l3.145">           rv = srcDB-&gt;CopyHdrFromExistingHdr(m_srcKeyArray[i],</span>
<a href="#l3.146"></a><span id="l3.146">                                              oldHdr, true,</span>
<a href="#l3.147"></a><span id="l3.147">                                              getter_AddRefs(newHdr));</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineminus">-          NS_ASSERTION(newHdr, </span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+          NS_ASSERTION(newHdr,</span>
<a href="#l3.150"></a><span id="l3.150">                        &quot;fatal ... cannot create new msg header\n&quot;);</span>
<a href="#l3.151"></a><span id="l3.151">           if (NS_SUCCEEDED(rv) &amp;&amp; newHdr)</span>
<a href="#l3.152"></a><span id="l3.152">           {</span>
<a href="#l3.153"></a><span id="l3.153">             newHdr-&gt;SetStatusOffset(m_srcStatusOffsetArray[i]);</span>
<a href="#l3.154"></a><span id="l3.154">             srcDB-&gt;UndoDelete(newHdr);</span>
<a href="#l3.155"></a><span id="l3.155">             srcMessages-&gt;AppendElement(newHdr, false);</span>
<a href="#l3.156"></a><span id="l3.156">             // (we want to keep these two lists in sync)</span>
<a href="#l3.157"></a><span id="l3.157">             dstMessages-&gt;AppendElement(oldHdr, false);</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineat">@@ -339,41 +339,41 @@ nsLocalMoveCopyMsgTxn::RedoTransaction()</span>
<a href="#l3.159"></a><span id="l3.159">   nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l3.160"></a><span id="l3.160">   nsCOMPtr&lt;nsIMsgDatabase&gt; dstDB;</span>
<a href="#l3.161"></a><span id="l3.161"> </span>
<a href="#l3.162"></a><span id="l3.162">   nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder = do_QueryReferent(m_srcFolder, &amp;rv);</span>
<a href="#l3.163"></a><span id="l3.163">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.164"></a><span id="l3.164"> </span>
<a href="#l3.165"></a><span id="l3.165">   nsCOMPtr&lt;nsIMsgFolder&gt; dstFolder = do_QueryReferent(m_dstFolder, &amp;rv);</span>
<a href="#l3.166"></a><span id="l3.166">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineminus">-  </span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+</span>
<a href="#l3.169"></a><span id="l3.169">   rv = srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l3.170"></a><span id="l3.170">   if(NS_FAILED(rv)) return rv;</span>
<a href="#l3.171"></a><span id="l3.171">   rv = dstFolder-&gt;GetMsgDatabase(getter_AddRefs(dstDB));</span>
<a href="#l3.172"></a><span id="l3.172">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.173"></a><span id="l3.173"> </span>
<a href="#l3.174"></a><span id="l3.174">   uint32_t count = m_srcKeyArray.Length();</span>
<a href="#l3.175"></a><span id="l3.175">   uint32_t i;</span>
<a href="#l3.176"></a><span id="l3.176">   nsCOMPtr&lt;nsIMsgDBHdr&gt; oldHdr;</span>
<a href="#l3.177"></a><span id="l3.177">   nsCOMPtr&lt;nsIMsgDBHdr&gt; newHdr;</span>
<a href="#l3.178"></a><span id="l3.178"> </span>
<a href="#l3.179"></a><span id="l3.179">   nsCOMPtr&lt;nsIMutableArray&gt; srcMessages = do_CreateInstance(NS_ARRAY_CONTRACTID);</span>
<a href="#l3.180"></a><span id="l3.180">   nsCOMPtr &lt;nsISupports&gt; msgSupports;</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-  </span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+</span>
<a href="#l3.183"></a><span id="l3.183">   for (i=0; i&lt;count; i++)</span>
<a href="#l3.184"></a><span id="l3.184">   {</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-    rv = srcDB-&gt;GetMsgHdrForKey(m_srcKeyArray[i], </span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+    rv = srcDB-&gt;GetMsgHdrForKey(m_srcKeyArray[i],</span>
<a href="#l3.187"></a><span id="l3.187">                                 getter_AddRefs(oldHdr));</span>
<a href="#l3.188"></a><span id="l3.188">     NS_ASSERTION(oldHdr, &quot;fatal ... cannot get old msg header\n&quot;);</span>
<a href="#l3.189"></a><span id="l3.189"> </span>
<a href="#l3.190"></a><span id="l3.190">     if (NS_SUCCEEDED(rv) &amp;&amp; oldHdr)</span>
<a href="#l3.191"></a><span id="l3.191">     {</span>
<a href="#l3.192"></a><span id="l3.192">       msgSupports =do_QueryInterface(oldHdr);</span>
<a href="#l3.193"></a><span id="l3.193">       srcMessages-&gt;AppendElement(msgSupports, false);</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineminus">-      </span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+</span>
<a href="#l3.196"></a><span id="l3.196">       if (m_canUndelete)</span>
<a href="#l3.197"></a><span id="l3.197">       {</span>
<a href="#l3.198"></a><span id="l3.198">       rv = dstDB-&gt;CopyHdrFromExistingHdr(m_dstKeyArray[i],</span>
<a href="#l3.199"></a><span id="l3.199">                                          oldHdr, true,</span>
<a href="#l3.200"></a><span id="l3.200">                                          getter_AddRefs(newHdr));</span>
<a href="#l3.201"></a><span id="l3.201">       NS_ASSERTION(newHdr, &quot;fatal ... cannot get new msg header\n&quot;);</span>
<a href="#l3.202"></a><span id="l3.202">       if (NS_SUCCEEDED(rv) &amp;&amp; newHdr)</span>
<a href="#l3.203"></a><span id="l3.203">       {</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineat">@@ -390,17 +390,17 @@ nsLocalMoveCopyMsgTxn::RedoTransaction()</span>
<a href="#l3.205"></a><span id="l3.205">   {</span>
<a href="#l3.206"></a><span id="l3.206">     if (m_srcIsImap4)</span>
<a href="#l3.207"></a><span id="l3.207">     {</span>
<a href="#l3.208"></a><span id="l3.208">       // protect against a bogus undo txn without any source keys</span>
<a href="#l3.209"></a><span id="l3.209">       // see bug #179856 for details</span>
<a href="#l3.210"></a><span id="l3.210">       NS_ASSERTION(!m_srcKeyArray.IsEmpty(), &quot;no source keys&quot;);</span>
<a href="#l3.211"></a><span id="l3.211">       if (m_srcKeyArray.IsEmpty())</span>
<a href="#l3.212"></a><span id="l3.212">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineminus">-    </span>
<a href="#l3.214"></a><span id="l3.214" class="difflineplus">+</span>
<a href="#l3.215"></a><span id="l3.215">       bool deleteFlag = false; //message is un-deleted- we are trying to redo</span>
<a href="#l3.216"></a><span id="l3.216">       CheckForToggleDelete(srcFolder, m_srcKeyArray[0], &amp;deleteFlag); // there could have been a toggle</span>
<a href="#l3.217"></a><span id="l3.217">       rv = UndoImapDeleteFlag(srcFolder, m_srcKeyArray, deleteFlag);</span>
<a href="#l3.218"></a><span id="l3.218">     }</span>
<a href="#l3.219"></a><span id="l3.219">     else if (m_canUndelete)</span>
<a href="#l3.220"></a><span id="l3.220">     {</span>
<a href="#l3.221"></a><span id="l3.221">       nsCOMPtr &lt;nsIMsgLocalMailFolder&gt; localFolder = do_QueryInterface(srcFolder);</span>
<a href="#l3.222"></a><span id="l3.222">       if (localFolder)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -28,36 +28,36 @@</span>
<a href="#l4.4"></a><span id="l4.4"> static nsresult</span>
<a href="#l4.5"></a><span id="l4.5"> nsGetMailboxServer(const char *uriStr, nsIMsgIncomingServer** aResult)</span>
<a href="#l4.6"></a><span id="l4.6"> {</span>
<a href="#l4.7"></a><span id="l4.7">   nsresult rv = NS_OK;</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">   nsCOMPtr&lt;nsIURL&gt; aUrl = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l4.10"></a><span id="l4.10">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  rv = aUrl-&gt;SetSpec(nsDependentCString(uriStr));  </span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  rv = aUrl-&gt;SetSpec(nsDependentCString(uriStr));</span>
<a href="#l4.14"></a><span id="l4.14">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">   // retrieve the AccountManager</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager = </span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+  nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l4.19"></a><span id="l4.19">     do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l4.20"></a><span id="l4.20">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-  </span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+</span>
<a href="#l4.23"></a><span id="l4.23">   // find all local mail &quot;no servers&quot; matching the given hostname</span>
<a href="#l4.24"></a><span id="l4.24">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; none_server;</span>
<a href="#l4.25"></a><span id="l4.25">   aUrl-&gt;SetScheme(NS_LITERAL_CSTRING(&quot;none&quot;));</span>
<a href="#l4.26"></a><span id="l4.26">   // No unescaping of username or hostname done here.</span>
<a href="#l4.27"></a><span id="l4.27">   // The unescaping is done inside of FindServerByURI</span>
<a href="#l4.28"></a><span id="l4.28">   rv = accountManager-&gt;FindServerByURI(aUrl, false,</span>
<a href="#l4.29"></a><span id="l4.29">                                   getter_AddRefs(none_server));</span>
<a href="#l4.30"></a><span id="l4.30">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l4.31"></a><span id="l4.31">     none_server.forget(aResult);</span>
<a href="#l4.32"></a><span id="l4.32">     return rv;</span>
<a href="#l4.33"></a><span id="l4.33">   }</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-  </span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+</span>
<a href="#l4.36"></a><span id="l4.36">   // if that fails, look for the rss hosts matching the given hostname</span>
<a href="#l4.37"></a><span id="l4.37">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; rss_server;</span>
<a href="#l4.38"></a><span id="l4.38">   aUrl-&gt;SetScheme(NS_LITERAL_CSTRING(&quot;rss&quot;));</span>
<a href="#l4.39"></a><span id="l4.39">   rv = accountManager-&gt;FindServerByURI(aUrl, false,</span>
<a href="#l4.40"></a><span id="l4.40">                                   getter_AddRefs(rss_server));</span>
<a href="#l4.41"></a><span id="l4.41">   if (NS_SUCCEEDED(rv))</span>
<a href="#l4.42"></a><span id="l4.42">   {</span>
<a href="#l4.43"></a><span id="l4.43">      rss_server.forget(aResult);</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineat">@@ -72,32 +72,32 @@ nsGetMailboxServer(const char *uriStr, n</span>
<a href="#l4.45"></a><span id="l4.45">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l4.46"></a><span id="l4.46">     movemail_server.forget(aResult);</span>
<a href="#l4.47"></a><span id="l4.47">     return rv;</span>
<a href="#l4.48"></a><span id="l4.48">   }</span>
<a href="#l4.49"></a><span id="l4.49"> #endif /* HAVE_MOVEMAIL */</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51">   // if that fails, look for the pop hosts matching the given hostname</span>
<a href="#l4.52"></a><span id="l4.52">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-  if (NS_FAILED(rv)) </span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l4.55"></a><span id="l4.55">   {</span>
<a href="#l4.56"></a><span id="l4.56">     aUrl-&gt;SetScheme(NS_LITERAL_CSTRING(&quot;pop3&quot;));</span>
<a href="#l4.57"></a><span id="l4.57">     rv = accountManager-&gt;FindServerByURI(aUrl, false,</span>
<a href="#l4.58"></a><span id="l4.58">                                     getter_AddRefs(server));</span>
<a href="#l4.59"></a><span id="l4.59"> </span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-    // if we can't find a pop server, maybe it's a local message </span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+    // if we can't find a pop server, maybe it's a local message</span>
<a href="#l4.62"></a><span id="l4.62">     // in an imap hierarchy. look for an imap server.</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-    if (NS_FAILED(rv)) </span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+    if (NS_FAILED(rv))</span>
<a href="#l4.65"></a><span id="l4.65">     {</span>
<a href="#l4.66"></a><span id="l4.66">       aUrl-&gt;SetScheme(NS_LITERAL_CSTRING(&quot;imap&quot;));</span>
<a href="#l4.67"></a><span id="l4.67">       rv = accountManager-&gt;FindServerByURI(aUrl, false,</span>
<a href="#l4.68"></a><span id="l4.68">                                     getter_AddRefs(server));</span>
<a href="#l4.69"></a><span id="l4.69">     }</span>
<a href="#l4.70"></a><span id="l4.70">   }</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-  if (NS_SUCCEEDED(rv)) </span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+  if (NS_SUCCEEDED(rv))</span>
<a href="#l4.73"></a><span id="l4.73">   {</span>
<a href="#l4.74"></a><span id="l4.74">     server.forget(aResult);</span>
<a href="#l4.75"></a><span id="l4.75">     return rv;</span>
<a href="#l4.76"></a><span id="l4.76">   }</span>
<a href="#l4.77"></a><span id="l4.77"> </span>
<a href="#l4.78"></a><span id="l4.78"> // if you fail after looking at all &quot;pop3&quot;, &quot;movemail&quot; and &quot;none&quot; servers, you fail.</span>
<a href="#l4.79"></a><span id="l4.79"> return rv;</span>
<a href="#l4.80"></a><span id="l4.80"> }</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineat">@@ -116,17 +116,17 @@ nsLocalURI2Server(const char* uriStr,</span>
<a href="#l4.82"></a><span id="l4.82"> // given rootURI and rootURI##folder, return on-disk path of folder</span>
<a href="#l4.83"></a><span id="l4.83"> nsresult</span>
<a href="#l4.84"></a><span id="l4.84"> nsLocalURI2Path(const char* rootURI, const char* uriStr,</span>
<a href="#l4.85"></a><span id="l4.85">                 nsCString&amp; pathResult)</span>
<a href="#l4.86"></a><span id="l4.86"> {</span>
<a href="#l4.87"></a><span id="l4.87">   nsresult rv;</span>
<a href="#l4.88"></a><span id="l4.88"> </span>
<a href="#l4.89"></a><span id="l4.89">   // verify that rootURI starts with &quot;mailbox:/&quot; or &quot;mailbox-message:/&quot;</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-  if ((PL_strcmp(rootURI, kMailboxRootURI) != 0) &amp;&amp; </span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+  if ((PL_strcmp(rootURI, kMailboxRootURI) != 0) &amp;&amp;</span>
<a href="#l4.92"></a><span id="l4.92">       (PL_strcmp(rootURI, kMailboxMessageRootURI) != 0)) {</span>
<a href="#l4.93"></a><span id="l4.93">     return NS_ERROR_FAILURE;</span>
<a href="#l4.94"></a><span id="l4.94">   }</span>
<a href="#l4.95"></a><span id="l4.95"> </span>
<a href="#l4.96"></a><span id="l4.96">   // verify that uristr starts with rooturi</span>
<a href="#l4.97"></a><span id="l4.97">   nsAutoCString uri(uriStr);</span>
<a href="#l4.98"></a><span id="l4.98">   if (uri.Find(rootURI) != 0)</span>
<a href="#l4.99"></a><span id="l4.99">     return NS_ERROR_FAILURE;</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineat">@@ -219,17 +219,17 @@ nsresult nsBuildLocalMessageURI(const ch</span>
<a href="#l4.101"></a><span id="l4.101"> </span>
<a href="#l4.102"></a><span id="l4.102"> nsresult nsCreateLocalBaseMessageURI(const nsACString&amp; baseURI, nsCString &amp;baseMessageURI)</span>
<a href="#l4.103"></a><span id="l4.103"> {</span>
<a href="#l4.104"></a><span id="l4.104">   nsAutoCString tailURI(baseURI);</span>
<a href="#l4.105"></a><span id="l4.105"> </span>
<a href="#l4.106"></a><span id="l4.106">   // chop off mailbox:/</span>
<a href="#l4.107"></a><span id="l4.107">   if (tailURI.Find(kMailboxRootURI) == 0)</span>
<a href="#l4.108"></a><span id="l4.108">     tailURI.Cut(0, PL_strlen(kMailboxRootURI));</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-  </span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+</span>
<a href="#l4.111"></a><span id="l4.111">   baseMessageURI = kMailboxMessageRootURI;</span>
<a href="#l4.112"></a><span id="l4.112">   baseMessageURI += tailURI;</span>
<a href="#l4.113"></a><span id="l4.113"> </span>
<a href="#l4.114"></a><span id="l4.114">   return NS_OK;</span>
<a href="#l4.115"></a><span id="l4.115"> }</span>
<a href="#l4.116"></a><span id="l4.116"> </span>
<a href="#l4.117"></a><span id="l4.117"> void nsEscapeNativePath(nsCString&amp; nativePath)</span>
<a href="#l4.118"></a><span id="l4.118"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUtils.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUtils.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -13,17 +13,17 @@ static const char kMailboxRootURI[] = &quot;m</span>
<a href="#l5.4"></a><span id="l5.4"> static const char kMailboxMessageRootURI[] = &quot;mailbox-message:/&quot;;</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> nsresult</span>
<a href="#l5.7"></a><span id="l5.7"> nsLocalURI2Path(const char* rootURI, const char* uriStr, nsCString&amp; pathResult);</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> nsresult</span>
<a href="#l5.10"></a><span id="l5.10"> nsParseLocalMessageURI(const char* uri, nsCString&amp; folderURI, nsMsgKey *key);</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-nsresult </span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+nsresult</span>
<a href="#l5.14"></a><span id="l5.14"> nsBuildLocalMessageURI(const char* baseURI, nsMsgKey key, nsCString&amp; uri);</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> nsresult</span>
<a href="#l5.17"></a><span id="l5.17"> nsCreateLocalBaseMessageURI(const nsACString&amp; baseURI, nsCString &amp;baseMessageURI);</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19"> void</span>
<a href="#l5.20"></a><span id="l5.20"> nsEscapeNativePath(nsCString&amp; nativePath);</span>
<a href="#l5.21"></a><span id="l5.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxUrl.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxUrl.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -485,17 +485,17 @@ nsresult nsMailboxUrl::GetFolder(nsIMsgF</span>
<a href="#l6.4"></a><span id="l6.4">   return msg-&gt;GetFolder(msgFolder);</span>
<a href="#l6.5"></a><span id="l6.5"> }</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7"> NS_IMETHODIMP nsMailboxUrl::GetFolderCharset(char ** aCharacterSet)</span>
<a href="#l6.8"></a><span id="l6.8"> {</span>
<a href="#l6.9"></a><span id="l6.9">   NS_ENSURE_ARG_POINTER(aCharacterSet);</span>
<a href="#l6.10"></a><span id="l6.10">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l6.11"></a><span id="l6.11">   nsresult rv = GetFolder(getter_AddRefs(folder));</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  </span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+</span>
<a href="#l6.14"></a><span id="l6.14">   // In cases where a file is not associated with a folder, for</span>
<a href="#l6.15"></a><span id="l6.15">   // example standalone .eml files, failure is normal.</span>
<a href="#l6.16"></a><span id="l6.16">   if (NS_FAILED(rv))</span>
<a href="#l6.17"></a><span id="l6.17">     return rv;</span>
<a href="#l6.18"></a><span id="l6.18">   nsCString tmpStr;</span>
<a href="#l6.19"></a><span id="l6.19">   folder-&gt;GetCharset(tmpStr);</span>
<a href="#l6.20"></a><span id="l6.20">   *aCharacterSet = ToNewCString(tmpStr);</span>
<a href="#l6.21"></a><span id="l6.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailIncomingServer.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailIncomingServer.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -16,28 +16,27 @@</span>
<a href="#l7.4"></a><span id="l7.4"> static NS_DEFINE_CID(kCMovemailServiceCID, NS_MOVEMAILSERVICE_CID);</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> NS_IMPL_ISUPPORTS_INHERITED(nsMovemailIncomingServer,</span>
<a href="#l7.8"></a><span id="l7.8">                              nsMsgIncomingServer,</span>
<a href="#l7.9"></a><span id="l7.9">                              nsIMovemailIncomingServer,</span>
<a href="#l7.10"></a><span id="l7.10">                              nsILocalMailIncomingServer)</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-                            </span>
<a href="#l7.13"></a><span id="l7.13"> </span>
<a href="#l7.14"></a><span id="l7.14"> nsMovemailIncomingServer::nsMovemailIncomingServer()</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-{    </span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+{</span>
<a href="#l7.17"></a><span id="l7.17">     m_canHaveFilters = true;</span>
<a href="#l7.18"></a><span id="l7.18"> }</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> nsMovemailIncomingServer::~nsMovemailIncomingServer()</span>
<a href="#l7.21"></a><span id="l7.21"> {</span>
<a href="#l7.22"></a><span id="l7.22"> }</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-NS_IMETHODIMP </span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l7.26"></a><span id="l7.26"> nsMovemailIncomingServer::PerformBiff(nsIMsgWindow *aMsgWindow)</span>
<a href="#l7.27"></a><span id="l7.27"> {</span>
<a href="#l7.28"></a><span id="l7.28">     nsresult rv;</span>
<a href="#l7.29"></a><span id="l7.29">     nsCOMPtr&lt;nsIMovemailService&gt; movemailService(do_GetService(</span>
<a href="#l7.30"></a><span id="l7.30">                                                  kCMovemailServiceCID, &amp;rv));</span>
<a href="#l7.31"></a><span id="l7.31">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l7.32"></a><span id="l7.32">     nsCOMPtr&lt;nsIMsgFolder&gt; inbox;</span>
<a href="#l7.33"></a><span id="l7.33">     nsCOMPtr&lt;nsIMsgFolder&gt; rootMsgFolder;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineat">@@ -85,17 +84,17 @@ nsMovemailIncomingServer::PerformBiff(ns</span>
<a href="#l7.35"></a><span id="l7.35">               {</span>
<a href="#l7.36"></a><span id="l7.36">                  rv = localInbox-&gt;SetCheckForNewMessagesAfterParsing(true);</span>
<a href="#l7.37"></a><span id="l7.37">               }</span>
<a href="#l7.38"></a><span id="l7.38">            }</span>
<a href="#l7.39"></a><span id="l7.39">        }</span>
<a href="#l7.40"></a><span id="l7.40">     }</span>
<a href="#l7.41"></a><span id="l7.41">     else</span>
<a href="#l7.42"></a><span id="l7.42">     {</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineminus">-        movemailService-&gt;CheckForNewMail(urlListener, inbox, this, nullptr); </span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+        movemailService-&gt;CheckForNewMail(urlListener, inbox, this, nullptr);</span>
<a href="#l7.45"></a><span id="l7.45">     }</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47">     return NS_OK;</span>
<a href="#l7.48"></a><span id="l7.48"> }</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50"> NS_IMETHODIMP</span>
<a href="#l7.51"></a><span id="l7.51"> nsMovemailIncomingServer::SetFlagsOnDefaultMailboxes()</span>
<a href="#l7.52"></a><span id="l7.52"> {</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineat">@@ -121,27 +120,27 @@ NS_IMETHODIMP nsMovemailIncomingServer::</span>
<a href="#l7.54"></a><span id="l7.54"> </span>
<a href="#l7.55"></a><span id="l7.55"> NS_IMETHODIMP</span>
<a href="#l7.56"></a><span id="l7.56"> nsMovemailIncomingServer::GetNewMail(nsIMsgWindow *aMsgWindow,</span>
<a href="#l7.57"></a><span id="l7.57">                                      nsIUrlListener *aUrlListener,</span>
<a href="#l7.58"></a><span id="l7.58">                                      nsIMsgFolder *aMsgFolder,</span>
<a href="#l7.59"></a><span id="l7.59">                                      nsIURI **aResult)</span>
<a href="#l7.60"></a><span id="l7.60"> {</span>
<a href="#l7.61"></a><span id="l7.61">     nsresult rv;</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-    </span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-    nsCOMPtr&lt;nsIMovemailService&gt; movemailService = </span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+    nsCOMPtr&lt;nsIMovemailService&gt; movemailService =</span>
<a href="#l7.66"></a><span id="l7.66">              do_GetService(kCMovemailServiceCID, &amp;rv);</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-    </span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+</span>
<a href="#l7.69"></a><span id="l7.69">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-    </span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+</span>
<a href="#l7.72"></a><span id="l7.72">     rv = movemailService-&gt;GetNewMail(aMsgWindow, aUrlListener,</span>
<a href="#l7.73"></a><span id="l7.73">                                      aMsgFolder, this, aResult);</span>
<a href="#l7.74"></a><span id="l7.74"> </span>
<a href="#l7.75"></a><span id="l7.75">     return rv;</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-}        </span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+}</span>
<a href="#l7.78"></a><span id="l7.78"> </span>
<a href="#l7.79"></a><span id="l7.79"> NS_IMETHODIMP</span>
<a href="#l7.80"></a><span id="l7.80"> nsMovemailIncomingServer::GetDownloadMessagesAtStartup(bool *getMessagesAtStartup)</span>
<a href="#l7.81"></a><span id="l7.81"> {</span>
<a href="#l7.82"></a><span id="l7.82">     NS_ENSURE_ARG_POINTER(getMessagesAtStartup);</span>
<a href="#l7.83"></a><span id="l7.83">     *getMessagesAtStartup = true;</span>
<a href="#l7.84"></a><span id="l7.84">     return NS_OK;</span>
<a href="#l7.85"></a><span id="l7.85"> }</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineat">@@ -157,22 +156,22 @@ nsMovemailIncomingServer::GetCanBeDefaul</span>
<a href="#l7.87"></a><span id="l7.87"> NS_IMETHODIMP</span>
<a href="#l7.88"></a><span id="l7.88"> nsMovemailIncomingServer::GetCanSearchMessages(bool *canSearchMessages)</span>
<a href="#l7.89"></a><span id="l7.89"> {</span>
<a href="#l7.90"></a><span id="l7.90">     NS_ENSURE_ARG_POINTER(canSearchMessages);</span>
<a href="#l7.91"></a><span id="l7.91">     *canSearchMessages = true;</span>
<a href="#l7.92"></a><span id="l7.92">     return NS_OK;</span>
<a href="#l7.93"></a><span id="l7.93"> }</span>
<a href="#l7.94"></a><span id="l7.94"> </span>
<a href="#l7.95"></a><span id="l7.95" class="difflineminus">-NS_IMETHODIMP </span>
<a href="#l7.96"></a><span id="l7.96" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l7.97"></a><span id="l7.97"> nsMovemailIncomingServer::GetServerRequiresPasswordForBiff(bool *aServerRequiresPasswordForBiff)</span>
<a href="#l7.98"></a><span id="l7.98"> {</span>
<a href="#l7.99"></a><span id="l7.99">     NS_ENSURE_ARG_POINTER(aServerRequiresPasswordForBiff);</span>
<a href="#l7.100"></a><span id="l7.100">     *aServerRequiresPasswordForBiff = false;</span>
<a href="#l7.101"></a><span id="l7.101">     return NS_OK;</span>
<a href="#l7.102"></a><span id="l7.102"> }</span>
<a href="#l7.103"></a><span id="l7.103"> </span>
<a href="#l7.104"></a><span id="l7.104" class="difflineminus">-NS_IMETHODIMP </span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l7.106"></a><span id="l7.106"> nsMovemailIncomingServer::GetAccountManagerChrome(nsAString&amp; aResult)</span>
<a href="#l7.107"></a><span id="l7.107"> {</span>
<a href="#l7.108"></a><span id="l7.108">     aResult.AssignLiteral(&quot;am-main.xul&quot;);</span>
<a href="#l7.109"></a><span id="l7.109">     return NS_OK;</span>
<a href="#l7.110"></a><span id="l7.110"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -211,17 +211,17 @@ SpoolLock::ObtainSpoolLock(unsigned int </span>
<a href="#l8.4"></a><span id="l8.4">     PRFileDesc *fd;</span>
<a href="#l8.5"></a><span id="l8.5">     rv = spoolFile-&gt;OpenNSPRFileDesc(PR_RDWR, 0, &amp;fd);</span>
<a href="#l8.6"></a><span id="l8.6">     NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l8.7"></a><span id="l8.7">     PRStatus lock_result;</span>
<a href="#l8.8"></a><span id="l8.8">     unsigned int retry_count = 0;</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">     do {</span>
<a href="#l8.11"></a><span id="l8.11">       lock_result = PR_TLockFile(fd);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  </span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+</span>
<a href="#l8.14"></a><span id="l8.14">       retry_count++;</span>
<a href="#l8.15"></a><span id="l8.15">       LOG((&quot;Attempt %d of %d to lock file&quot;, retry_count, aSeconds));</span>
<a href="#l8.16"></a><span id="l8.16">       if (aSeconds &gt; 0 &amp;&amp; lock_result == PR_FAILURE) {</span>
<a href="#l8.17"></a><span id="l8.17">         // pause 1sec, waiting for .lock to go away</span>
<a href="#l8.18"></a><span id="l8.18">         PRIntervalTime sleepTime = 1000; // 1 second</span>
<a href="#l8.19"></a><span id="l8.19">         PR_Sleep(sleepTime);</span>
<a href="#l8.20"></a><span id="l8.20">       }</span>
<a href="#l8.21"></a><span id="l8.21">     } while (lock_result == PR_FAILURE &amp;&amp; retry_count &lt; aSeconds);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/local/src/nsMsgLocalStoreUtils.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgLocalStoreUtils.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.5"></a><span id="l9.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">- </span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+</span>
<a href="#l9.10"></a><span id="l9.10"> #include &quot;msgCore.h&quot;    // precompiled header...</span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;nsMsgLocalStoreUtils.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12"> #include &quot;nsIFile.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l9.14"></a><span id="l9.14"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l9.15"></a><span id="l9.15"> #include &quot;prprf.h&quot;</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17"> #define EXTRA_SAFETY_SPACE 0x400000 // (4MiB)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/local/src/nsNoneService.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/local/src/nsNoneService.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -31,40 +31,40 @@ nsNoneService::~nsNoneService()</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> NS_IMPL_ISUPPORTS(nsNoneService, nsINoneService, nsIMsgProtocolInfo)</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> NS_IMETHODIMP</span>
<a href="#l10.8"></a><span id="l10.8"> nsNoneService::SetDefaultLocalPath(nsIFile *aPath)</span>
<a href="#l10.9"></a><span id="l10.9"> {</span>
<a href="#l10.10"></a><span id="l10.10">     NS_ENSURE_ARG(aPath);</span>
<a href="#l10.11"></a><span id="l10.11">     return NS_SetPersistentFile(PREF_MAIL_ROOT_NONE_REL, PREF_MAIL_ROOT_NONE, aPath);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-}     </span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+}</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15"> NS_IMETHODIMP</span>
<a href="#l10.16"></a><span id="l10.16"> nsNoneService::GetDefaultLocalPath(nsIFile ** aResult)</span>
<a href="#l10.17"></a><span id="l10.17"> {</span>
<a href="#l10.18"></a><span id="l10.18">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l10.19"></a><span id="l10.19">     *aResult = nullptr;</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-    </span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+</span>
<a href="#l10.22"></a><span id="l10.22">     bool havePref;</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-    nsCOMPtr&lt;nsIFile&gt; localFile;    </span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l10.25"></a><span id="l10.25">     nsresult rv = NS_GetPersistentFile(PREF_MAIL_ROOT_NONE_REL,</span>
<a href="#l10.26"></a><span id="l10.26">                               PREF_MAIL_ROOT_NONE,</span>
<a href="#l10.27"></a><span id="l10.27">                               NS_APP_MAIL_50_DIR,</span>
<a href="#l10.28"></a><span id="l10.28">                               havePref,</span>
<a href="#l10.29"></a><span id="l10.29">                               getter_AddRefs(localFile));</span>
<a href="#l10.30"></a><span id="l10.30">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-    </span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+</span>
<a href="#l10.33"></a><span id="l10.33">     bool exists;</span>
<a href="#l10.34"></a><span id="l10.34">     rv = localFile-&gt;Exists(&amp;exists);</span>
<a href="#l10.35"></a><span id="l10.35">     if (NS_SUCCEEDED(rv) &amp;&amp; !exists)</span>
<a href="#l10.36"></a><span id="l10.36">         rv = localFile-&gt;Create(nsIFile::DIRECTORY_TYPE, 0775);</span>
<a href="#l10.37"></a><span id="l10.37">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-    </span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-    if (!havePref || !exists) </span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+    if (!havePref || !exists)</span>
<a href="#l10.42"></a><span id="l10.42">     {</span>
<a href="#l10.43"></a><span id="l10.43">         rv = NS_SetPersistentFile(PREF_MAIL_ROOT_NONE_REL, PREF_MAIL_ROOT_NONE, localFile);</span>
<a href="#l10.44"></a><span id="l10.44">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Failed to set root dir pref.&quot;);</span>
<a href="#l10.45"></a><span id="l10.45">     }</span>
<a href="#l10.46"></a><span id="l10.46"> </span>
<a href="#l10.47"></a><span id="l10.47">     localFile.forget(aResult);</span>
<a href="#l10.48"></a><span id="l10.48">     return NS_OK;</span>
<a href="#l10.49"></a><span id="l10.49"> }</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineat">@@ -101,64 +101,64 @@ nsNoneService::GetCanLoginAtStartUp(bool</span>
<a href="#l10.51"></a><span id="l10.51"> }</span>
<a href="#l10.52"></a><span id="l10.52"> </span>
<a href="#l10.53"></a><span id="l10.53"> NS_IMETHODIMP</span>
<a href="#l10.54"></a><span id="l10.54"> nsNoneService::GetCanDelete(bool *aCanDelete)</span>
<a href="#l10.55"></a><span id="l10.55"> {</span>
<a href="#l10.56"></a><span id="l10.56">   NS_ENSURE_ARG_POINTER(aCanDelete);</span>
<a href="#l10.57"></a><span id="l10.57">   *aCanDelete = false;</span>
<a href="#l10.58"></a><span id="l10.58">   return NS_OK;</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-}  </span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+}</span>
<a href="#l10.61"></a><span id="l10.61"> </span>
<a href="#l10.62"></a><span id="l10.62"> NS_IMETHODIMP</span>
<a href="#l10.63"></a><span id="l10.63"> nsNoneService::GetCanDuplicate(bool *aCanDuplicate)</span>
<a href="#l10.64"></a><span id="l10.64"> {</span>
<a href="#l10.65"></a><span id="l10.65">   NS_ENSURE_ARG_POINTER(aCanDuplicate);</span>
<a href="#l10.66"></a><span id="l10.66">   *aCanDuplicate = false;</span>
<a href="#l10.67"></a><span id="l10.67">   return NS_OK;</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-}  </span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+}</span>
<a href="#l10.70"></a><span id="l10.70"> </span>
<a href="#l10.71"></a><span id="l10.71"> NS_IMETHODIMP</span>
<a href="#l10.72"></a><span id="l10.72"> nsNoneService::GetCanGetMessages(bool *aCanGetMessages)</span>
<a href="#l10.73"></a><span id="l10.73"> {</span>
<a href="#l10.74"></a><span id="l10.74">     NS_ENSURE_ARG_POINTER(aCanGetMessages);</span>
<a href="#l10.75"></a><span id="l10.75">     *aCanGetMessages = false;</span>
<a href="#l10.76"></a><span id="l10.76">     return NS_OK;</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-}  </span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+}</span>
<a href="#l10.79"></a><span id="l10.79"> </span>
<a href="#l10.80"></a><span id="l10.80"> NS_IMETHODIMP</span>
<a href="#l10.81"></a><span id="l10.81"> nsNoneService::GetCanGetIncomingMessages(bool *aCanGetIncomingMessages)</span>
<a href="#l10.82"></a><span id="l10.82"> {</span>
<a href="#l10.83"></a><span id="l10.83">     NS_ENSURE_ARG_POINTER(aCanGetIncomingMessages);</span>
<a href="#l10.84"></a><span id="l10.84">     *aCanGetIncomingMessages = false;</span>
<a href="#l10.85"></a><span id="l10.85">     return NS_OK;</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-} </span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+}</span>
<a href="#l10.88"></a><span id="l10.88"> </span>
<a href="#l10.89"></a><span id="l10.89" class="difflineminus">-NS_IMETHODIMP </span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l10.91"></a><span id="l10.91"> nsNoneService::GetDefaultDoBiff(bool *aDoBiff)</span>
<a href="#l10.92"></a><span id="l10.92"> {</span>
<a href="#l10.93"></a><span id="l10.93">     NS_ENSURE_ARG_POINTER(aDoBiff);</span>
<a href="#l10.94"></a><span id="l10.94">     // by default, don't do biff for &quot;none&quot; servers</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineminus">-    *aDoBiff = false;    </span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+    *aDoBiff = false;</span>
<a href="#l10.97"></a><span id="l10.97">     return NS_OK;</span>
<a href="#l10.98"></a><span id="l10.98"> }</span>
<a href="#l10.99"></a><span id="l10.99"> </span>
<a href="#l10.100"></a><span id="l10.100"> NS_IMETHODIMP</span>
<a href="#l10.101"></a><span id="l10.101"> nsNoneService::GetDefaultServerPort(bool isSecure, int32_t *aDefaultPort)</span>
<a href="#l10.102"></a><span id="l10.102"> {</span>
<a href="#l10.103"></a><span id="l10.103">     NS_ENSURE_ARG_POINTER(aDefaultPort);</span>
<a href="#l10.104"></a><span id="l10.104">     *aDefaultPort = -1;</span>
<a href="#l10.105"></a><span id="l10.105">     return NS_OK;</span>
<a href="#l10.106"></a><span id="l10.106"> }</span>
<a href="#l10.107"></a><span id="l10.107"> </span>
<a href="#l10.108"></a><span id="l10.108" class="difflineminus">-NS_IMETHODIMP </span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l10.110"></a><span id="l10.110"> nsNoneService::GetShowComposeMsgLink(bool *showComposeMsgLink)</span>
<a href="#l10.111"></a><span id="l10.111"> {</span>
<a href="#l10.112"></a><span id="l10.112">     NS_ENSURE_ARG_POINTER(showComposeMsgLink);</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineminus">-    *showComposeMsgLink = false;    </span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+    *showComposeMsgLink = false;</span>
<a href="#l10.115"></a><span id="l10.115">     return NS_OK;</span>
<a href="#l10.116"></a><span id="l10.116"> }</span>
<a href="#l10.117"></a><span id="l10.117"> </span>
<a href="#l10.118"></a><span id="l10.118"> NS_IMETHODIMP</span>
<a href="#l10.119"></a><span id="l10.119"> nsNoneService::GetFoldersCreatedAsync(bool *aAsyncCreation)</span>
<a href="#l10.120"></a><span id="l10.120"> {</span>
<a href="#l10.121"></a><span id="l10.121">   NS_ENSURE_ARG_POINTER(aAsyncCreation);</span>
<a href="#l10.122"></a><span id="l10.122">   *aAsyncCreation = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -868,17 +868,17 @@ NS_IMETHODIMP nsPop3Protocol::OnPromptSt</span>
<a href="#l11.4"></a><span id="l11.4">           MOZ_LOG(POP3LOGMODULE, LogLevel::Warning, (POP3LOG(&quot;retry button pressed&quot;)));</span>
<a href="#l11.5"></a><span id="l11.5">           // try all methods again, including GSSAPI</span>
<a href="#l11.6"></a><span id="l11.6">           ResetAuthMethods();</span>
<a href="#l11.7"></a><span id="l11.7">           ClearFlag(POP3_PASSWORD_FAILED|POP3_AUTH_FAILURE);</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">           if (m_needToRerunUrl)</span>
<a href="#l11.10"></a><span id="l11.10">             return RerunUrl();</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-          // It is a bit strange that we're going onto the next state that </span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+          // It is a bit strange that we're going onto the next state that</span>
<a href="#l11.14"></a><span id="l11.14">           // would essentially send the password. However in resetting the</span>
<a href="#l11.15"></a><span id="l11.15">           // auth methods above, we're setting up SendUsername, SendPassword</span>
<a href="#l11.16"></a><span id="l11.16">           // and friends to abort and return to the POP3_SEND_CAPA state.</span>
<a href="#l11.17"></a><span id="l11.17">           // Hence we can do this safely.</span>
<a href="#l11.18"></a><span id="l11.18">           m_pop3ConData-&gt;next_state = GetNextPasswordObtainState();</span>
<a href="#l11.19"></a><span id="l11.19">           // As we're async, calling ProcessProtocolState gets things going</span>
<a href="#l11.20"></a><span id="l11.20">           // again.</span>
<a href="#l11.21"></a><span id="l11.21">           ProcessProtocolState(nullptr, nullptr, 0, 0);</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -2404,17 +2404,17 @@ nsPop3Protocol::GetStat()</span>
<a href="#l11.23"></a><span id="l11.23">     m_nsIPop3Sink-&gt;BeginMailDelivery(false, nullptr, nullptr);</span>
<a href="#l11.24"></a><span id="l11.24">     m_nsIPop3Sink-&gt;AbortMailDelivery(this);</span>
<a href="#l11.25"></a><span id="l11.25">     return(0);</span>
<a href="#l11.26"></a><span id="l11.26">   }</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28">   /* We're just checking for new mail, and we're not playing any games that</span>
<a href="#l11.29"></a><span id="l11.29">      involve keeping messages on the server.  Therefore, we now know enough</span>
<a href="#l11.30"></a><span id="l11.30">      to finish up.  If we had no messages, that would have been handled</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-     above; therefore, we know we have some new messages. </span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+     above; therefore, we know we have some new messages.</span>
<a href="#l11.33"></a><span id="l11.33">   */</span>
<a href="#l11.34"></a><span id="l11.34">   if (m_pop3ConData-&gt;only_check_for_new_mail &amp;&amp; !m_pop3ConData-&gt;leave_on_server)</span>
<a href="#l11.35"></a><span id="l11.35">   {</span>
<a href="#l11.36"></a><span id="l11.36">     m_nsIPop3Sink-&gt;SetBiffStateAndUpdateFE(nsIMsgFolder::nsMsgBiffState_NewMail,</span>
<a href="#l11.37"></a><span id="l11.37">                                            m_pop3ConData-&gt;number_of_messages,</span>
<a href="#l11.38"></a><span id="l11.38">                                            true);</span>
<a href="#l11.39"></a><span id="l11.39">     m_pop3ConData-&gt;next_state = POP3_SEND_QUIT;</span>
<a href="#l11.40"></a><span id="l11.40">     return(0);</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineat">@@ -2622,17 +2622,17 @@ int32_t nsPop3Protocol::HandleNoUidListA</span>
<a href="#l11.42"></a><span id="l11.42">   }</span>
<a href="#l11.43"></a><span id="l11.43">   m_pop3ConData-&gt;next_state = POP3_SEND_QUIT;</span>
<a href="#l11.44"></a><span id="l11.44">   nsCString hostName;</span>
<a href="#l11.45"></a><span id="l11.45">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l11.46"></a><span id="l11.46">   nsresult rv = server-&gt;GetRealHostName(hostName);</span>
<a href="#l11.47"></a><span id="l11.47">   NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l11.48"></a><span id="l11.48">   NS_ConvertASCIItoUTF16 hostNameUnicode(hostName);</span>
<a href="#l11.49"></a><span id="l11.49">   const char16_t *params[] = { hostNameUnicode.get() };</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-  return Error(&quot;pop3ServerDoesNotSupportUidlEtc&quot;, params, 1);  </span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+  return Error(&quot;pop3ServerDoesNotSupportUidlEtc&quot;, params, 1);</span>
<a href="#l11.52"></a><span id="l11.52"> }</span>
<a href="#l11.53"></a><span id="l11.53"> </span>
<a href="#l11.54"></a><span id="l11.54"> </span>
<a href="#l11.55"></a><span id="l11.55"> /* km</span>
<a href="#l11.56"></a><span id="l11.56">  *</span>
<a href="#l11.57"></a><span id="l11.57">  *  net_pop3_send_xtnd_xlst_msgid</span>
<a href="#l11.58"></a><span id="l11.58">  *</span>
<a href="#l11.59"></a><span id="l11.59">  *  Process state: POP3_SEND_XTND_XLST_MSGID</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Service.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Service.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -20,28 +20,28 @@ class nsIMsgMailNewsUrl;</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> class nsPop3Service : public nsIPop3Service,</span>
<a href="#l12.6"></a><span id="l12.6">                       public nsIProtocolHandler,</span>
<a href="#l12.7"></a><span id="l12.7">                       public nsIMsgProtocolInfo</span>
<a href="#l12.8"></a><span id="l12.8"> {</span>
<a href="#l12.9"></a><span id="l12.9"> public:</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">   nsPop3Service();</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  </span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+</span>
<a href="#l12.14"></a><span id="l12.14">   NS_DECL_ISUPPORTS</span>
<a href="#l12.15"></a><span id="l12.15">   NS_DECL_NSIPOP3SERVICE</span>
<a href="#l12.16"></a><span id="l12.16">   NS_DECL_NSIPROTOCOLHANDLER</span>
<a href="#l12.17"></a><span id="l12.17">   NS_DECL_NSIMSGPROTOCOLINFO</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19"> protected:</span>
<a href="#l12.20"></a><span id="l12.20">   virtual ~nsPop3Service();</span>
<a href="#l12.21"></a><span id="l12.21">   nsresult GetMail(bool downloadNewMail,</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-                   nsIMsgWindow* aMsgWindow, </span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+                   nsIMsgWindow* aMsgWindow,</span>
<a href="#l12.24"></a><span id="l12.24">                    nsIUrlListener * aUrlListener,</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-                   nsIMsgFolder *inbox, </span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+                   nsIMsgFolder *inbox,</span>
<a href="#l12.27"></a><span id="l12.27">                    nsIPop3IncomingServer *popServer,</span>
<a href="#l12.28"></a><span id="l12.28">                    nsIURI ** aURL);</span>
<a href="#l12.29"></a><span id="l12.29">   // convience function to make constructing of the pop3 url easier...</span>
<a href="#l12.30"></a><span id="l12.30">   nsresult BuildPop3Url(const char * urlSpec, nsIMsgFolder *inbox,</span>
<a href="#l12.31"></a><span id="l12.31">                     nsIPop3IncomingServer *, nsIUrlListener * aUrlListener,</span>
<a href="#l12.32"></a><span id="l12.32">                     nsIURI ** aUrl, nsIMsgWindow *aMsgWindow);</span>
<a href="#l12.33"></a><span id="l12.33"> </span>
<a href="#l12.34"></a><span id="l12.34">   nsresult RunPopUrl(nsIMsgIncomingServer * aServer, nsIURI * aUrlToRun);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/local/src/nsRssService.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/local/src/nsRssService.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -16,22 +16,22 @@ nsRssService::nsRssService()</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> nsRssService::~nsRssService()</span>
<a href="#l13.6"></a><span id="l13.6"> {</span>
<a href="#l13.7"></a><span id="l13.7"> }</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9"> NS_IMPL_ISUPPORTS(nsRssService,</span>
<a href="#l13.10"></a><span id="l13.10">                    nsIRssService,</span>
<a href="#l13.11"></a><span id="l13.11">                    nsIMsgProtocolInfo)</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-                   </span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+</span>
<a href="#l13.14"></a><span id="l13.14"> NS_IMETHODIMP nsRssService::GetDefaultLocalPath(nsIFile * *aDefaultLocalPath)</span>
<a href="#l13.15"></a><span id="l13.15"> {</span>
<a href="#l13.16"></a><span id="l13.16">     NS_ENSURE_ARG_POINTER(aDefaultLocalPath);</span>
<a href="#l13.17"></a><span id="l13.17">     *aDefaultLocalPath = nullptr;</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-    </span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+</span>
<a href="#l13.20"></a><span id="l13.20">     nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l13.21"></a><span id="l13.21">     nsCOMPtr&lt;nsIProperties&gt; dirService(do_GetService(&quot;@mozilla.org/file/directory_service;1&quot;));</span>
<a href="#l13.22"></a><span id="l13.22">     if (!dirService) return NS_ERROR_FAILURE;</span>
<a href="#l13.23"></a><span id="l13.23">     dirService-&gt;Get(NS_APP_MAIL_50_DIR, NS_GET_IID(nsIFile), getter_AddRefs(localFile));</span>
<a href="#l13.24"></a><span id="l13.24">     if (!localFile) return NS_ERROR_FAILURE;</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26">     bool exists;</span>
<a href="#l13.27"></a><span id="l13.27">     nsresult rv = localFile-&gt;Exists(&amp;exists);</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineat">@@ -105,24 +105,24 @@ NS_IMETHODIMP nsRssService::GetCanGetInc</span>
<a href="#l13.29"></a><span id="l13.29">     *aCanGetIncomingMessages = true;</span>
<a href="#l13.30"></a><span id="l13.30">     return NS_OK;</span>
<a href="#l13.31"></a><span id="l13.31"> }</span>
<a href="#l13.32"></a><span id="l13.32"> </span>
<a href="#l13.33"></a><span id="l13.33"> NS_IMETHODIMP nsRssService::GetDefaultDoBiff(bool *aDefaultDoBiff)</span>
<a href="#l13.34"></a><span id="l13.34"> {</span>
<a href="#l13.35"></a><span id="l13.35">     NS_ENSURE_ARG_POINTER(aDefaultDoBiff);</span>
<a href="#l13.36"></a><span id="l13.36">     // by default, do biff for RSS feeds</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-    *aDefaultDoBiff = true;    </span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+    *aDefaultDoBiff = true;</span>
<a href="#l13.39"></a><span id="l13.39">     return NS_OK;</span>
<a href="#l13.40"></a><span id="l13.40"> }</span>
<a href="#l13.41"></a><span id="l13.41"> </span>
<a href="#l13.42"></a><span id="l13.42"> NS_IMETHODIMP nsRssService::GetShowComposeMsgLink(bool *aShowComposeMsgLink)</span>
<a href="#l13.43"></a><span id="l13.43"> {</span>
<a href="#l13.44"></a><span id="l13.44">     NS_ENSURE_ARG_POINTER(aShowComposeMsgLink);</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-    *aShowComposeMsgLink = false;    </span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+    *aShowComposeMsgLink = false;</span>
<a href="#l13.47"></a><span id="l13.47">     return NS_OK;</span>
<a href="#l13.48"></a><span id="l13.48"> }</span>
<a href="#l13.49"></a><span id="l13.49"> </span>
<a href="#l13.50"></a><span id="l13.50"> NS_IMETHODIMP nsRssService::GetFoldersCreatedAsync(bool *aAsyncCreation)</span>
<a href="#l13.51"></a><span id="l13.51"> {</span>
<a href="#l13.52"></a><span id="l13.52">   NS_ENSURE_ARG_POINTER(aAsyncCreation);</span>
<a href="#l13.53"></a><span id="l13.53">   *aAsyncCreation = false;</span>
<a href="#l13.54"></a><span id="l13.54">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/local/src/nsRssService.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/local/src/nsRssService.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -8,17 +8,17 @@</span>
<a href="#l14.4"></a><span id="l14.4"> #include &quot;nsIRssService.h&quot;</span>
<a href="#l14.5"></a><span id="l14.5"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> class nsRssService : public nsIMsgProtocolInfo, public nsIRssService</span>
<a href="#l14.8"></a><span id="l14.8"> {</span>
<a href="#l14.9"></a><span id="l14.9"> public:</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">   nsRssService();</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  </span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+</span>
<a href="#l14.14"></a><span id="l14.14">   NS_DECL_ISUPPORTS</span>
<a href="#l14.15"></a><span id="l14.15">   NS_DECL_NSIRSSSERVICE</span>
<a href="#l14.16"></a><span id="l14.16">   NS_DECL_NSIMSGPROTOCOLINFO</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18"> private:</span>
<a href="#l14.19"></a><span id="l14.19">   virtual ~nsRssService();</span>
<a href="#l14.20"></a><span id="l14.20"> };</span>
<a href="#l14.21"></a><span id="l14.21"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

