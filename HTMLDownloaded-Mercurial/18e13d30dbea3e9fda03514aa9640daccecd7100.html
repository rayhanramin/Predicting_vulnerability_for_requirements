<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 23454:18e13d30dbea3e9fda03514aa9640daccecd7100</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 18e13d30dbea3e9fda03514aa9640daccecd7100" />
<meta property="og:url" content="/comm-central/rev/18e13d30dbea3e9fda03514aa9640daccecd7100" />
<meta property="og:description" content="Bug 1399756 - remove trailing spaces in mailnews/mime. rs=white-space-only" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 18e13d30dbea3e9fda03514aa9640daccecd7100 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/18e13d30dbea3e9fda03514aa9640daccecd7100">shortlog</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/18e13d30dbea3e9fda03514aa9640daccecd7100">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100">files</a> |
changeset |
<a href="/comm-central/raw-rev/18e13d30dbea3e9fda03514aa9640daccecd7100">raw</a>  | <a href="/comm-central/archive/18e13d30dbea3e9fda03514aa9640daccecd7100.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1399756">Bug 1399756</a> - remove trailing spaces in mailnews/mime. rs=white-space-only
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 09 Mar 2018 09:00:13 +0100</td></tr>

<tr>
 <td>changeset 23454</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/18e13d30dbea3e9fda03514aa9640daccecd7100">18e13d30dbea3e9fda03514aa9640daccecd7100</a></td>
</tr>



<tr>
<td>parent 23453</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b0a89e8248ccf095edc77b057506731bfd068853">b0a89e8248ccf095edc77b057506731bfd068853</a>
</td>
</tr>

<tr>
<td>child 23455</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/df69b8b00e44e91dd3712893b5dff9e3b7a15901">df69b8b00e44e91dd3712893b5dff9e3b7a15901</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=18e13d30dbea3e9fda03514aa9640daccecd7100">14169</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 09 Mar 2018 08:00:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@18e13d30dbea [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=18e13d30dbea3e9fda03514aa9640daccecd7100">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=18e13d30dbea3e9fda03514aa9640daccecd7100&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=18e13d30dbea3e9fda03514aa9640daccecd7100&newProject=comm-central&newRevision=8a8e32962e4731034e43c90732785cf53ec9eab9&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=18e13d30dbea3e9fda03514aa9640daccecd7100&newProject=comm-central&newRevision=8a8e32962e4731034e43c90732785cf53ec9eab9&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=18e13d30dbea3e9fda03514aa9640daccecd7100&newProject=comm-central&newRevision=8a8e32962e4731034e43c90732785cf53ec9eab9&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28white-space-only%29&revcount=50">white-space-only</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1399756">1399756</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1399756">Bug 1399756</a> - remove trailing spaces in mailnews/mime. rs=white-space-only
[skip-blame]</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/mimexpcom.cpp">mailnews/mime/cthandlers/glue/mimexpcom.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/mimexpcom.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/mimexpcom.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/mimexpcom.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/mimexpcom.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/mimexpcom.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/nsMimeContentTypeHandler.h">mailnews/mime/cthandlers/glue/nsMimeContentTypeHandler.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/nsMimeContentTypeHandler.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/nsMimeContentTypeHandler.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/nsMimeContentTypeHandler.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/nsMimeContentTypeHandler.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/glue/nsMimeContentTypeHandler.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">mailnews/mime/cthandlers/vcard/mimevcrd.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">mailnews/mime/emitters/nsMimeBaseEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.cpp">mailnews/mime/emitters/nsMimePlainEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.h">mailnews/mime/emitters/nsMimePlainEmitter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimePlainEmitter.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRawEmitter.h">mailnews/mime/emitters/nsMimeRawEmitter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRawEmitter.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRawEmitter.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRawEmitter.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRawEmitter.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRawEmitter.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRebuffer.h">mailnews/mime/emitters/nsMimeRebuffer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRebuffer.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRebuffer.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRebuffer.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRebuffer.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeRebuffer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeXmlEmitter.h">mailnews/mime/emitters/nsMimeXmlEmitter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeXmlEmitter.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeXmlEmitter.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeXmlEmitter.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeXmlEmitter.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/emitters/nsMimeXmlEmitter.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecom.h">mailnews/mime/src/mimecom.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecom.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecom.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecom.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecom.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecom.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecth.cpp">mailnews/mime/src/mimecth.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecth.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecth.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecth.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecth.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimecth.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeebod.cpp">mailnews/mime/src/mimeebod.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeebod.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeebod.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeebod.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeebod.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeebod.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeeobj.h">mailnews/mime/src/mimeeobj.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeeobj.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeeobj.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeeobj.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeeobj.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeeobj.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeleaf.cpp">mailnews/mime/src/mimeleaf.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeleaf.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeleaf.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeleaf.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeleaf.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimeleaf.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemalt.cpp">mailnews/mime/src/mimemalt.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemalt.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemalt.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemalt.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemalt.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemalt.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemcms.h">mailnews/mime/src/mimemcms.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemcms.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemcms.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemcms.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemcms.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemcms.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemdig.h">mailnews/mime/src/mimemdig.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemdig.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemdig.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemdig.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemdig.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemdig.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimempar.h">mailnews/mime/src/mimempar.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimempar.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimempar.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimempar.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimempar.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimempar.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemrel.cpp">mailnews/mime/src/mimemrel.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemrel.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemrel.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemrel.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemrel.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemrel.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemsig.cpp">mailnews/mime/src/mimemsig.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemsig.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemsig.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemsig.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemsig.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemsig.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemult.cpp">mailnews/mime/src/mimemult.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemult.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemult.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemult.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemult.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimemult.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetext.cpp">mailnews/mime/src/mimetext.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetext.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetext.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetext.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetext.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetext.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetpfl.h">mailnews/mime/src/mimetpfl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetpfl.h">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetpfl.h">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetpfl.h">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetpfl.h">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetpfl.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetric.cpp">mailnews/mime/src/mimetric.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetric.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetric.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetric.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetric.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/mimetric.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsCMSSecureMessage.cpp">mailnews/mime/src/nsCMSSecureMessage.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsCMSSecureMessage.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsCMSSecureMessage.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsCMSSecureMessage.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsCMSSecureMessage.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsCMSSecureMessage.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsMimeObjectClassAccess.cpp">mailnews/mime/src/nsMimeObjectClassAccess.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsMimeObjectClassAccess.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsMimeObjectClassAccess.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsMimeObjectClassAccess.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsMimeObjectClassAccess.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsMimeObjectClassAccess.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsStreamConverter.cpp">mailnews/mime/src/nsStreamConverter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsStreamConverter.cpp">file</a> |
<a href="/comm-central/annotate/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsStreamConverter.cpp">annotate</a> |
<a href="/comm-central/diff/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsStreamConverter.cpp">diff</a> |
<a href="/comm-central/comparison/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsStreamConverter.cpp">comparison</a> |
<a href="/comm-central/log/18e13d30dbea3e9fda03514aa9640daccecd7100/mailnews/mime/src/nsStreamConverter.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/mime/cthandlers/glue/mimexpcom.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/glue/mimexpcom.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,21 +1,21 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l1.5"></a><span id="l1.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.6"></a><span id="l1.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.7"></a><span id="l1.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineminus">-#include &quot;nsIComponentManager.h&quot; </span>
<a href="#l1.9"></a><span id="l1.9" class="difflineplus">+#include &quot;nsIComponentManager.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> #include &quot;nsIMimeObjectClassAccess.h&quot;</span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-static NS_DEFINE_CID(kMimeObjectClassAccessCID, NS_MIME_OBJECT_CLASS_ACCESS_CID); </span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+static NS_DEFINE_CID(kMimeObjectClassAccessCID, NS_MIME_OBJECT_CLASS_ACCESS_CID);</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> /*</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">- * These calls are necessary to expose the object class hierarchy </span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+ * These calls are necessary to expose the object class hierarchy</span>
<a href="#l1.20"></a><span id="l1.20">  * to externally developed content type handlers.</span>
<a href="#l1.21"></a><span id="l1.21">  */</span>
<a href="#l1.22"></a><span id="l1.22"> extern &quot;C&quot; void *</span>
<a href="#l1.23"></a><span id="l1.23"> COM_GetmimeInlineTextClass(void)</span>
<a href="#l1.24"></a><span id="l1.24"> {</span>
<a href="#l1.25"></a><span id="l1.25">   void *ptr = NULL;</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">   nsresult res;</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineat">@@ -92,32 +92,32 @@ COM_GetmimeMultipartSignedClass(void)</span>
<a href="#l1.29"></a><span id="l1.29">   nsCOMPtr&lt;nsIMimeObjectClassAccess&gt; objAccess =</span>
<a href="#l1.30"></a><span id="l1.30">       do_CreateInstance(kMimeObjectClassAccessCID, &amp;res);</span>
<a href="#l1.31"></a><span id="l1.31">   if (NS_SUCCEEDED(res) &amp;&amp; objAccess)</span>
<a href="#l1.32"></a><span id="l1.32">     objAccess-&gt;GetmimeMultipartSignedClass(&amp;ptr);</span>
<a href="#l1.33"></a><span id="l1.33"> </span>
<a href="#l1.34"></a><span id="l1.34">   return ptr;</span>
<a href="#l1.35"></a><span id="l1.35"> }</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-extern &quot;C&quot; int  </span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-COM_MimeObject_write(void *mimeObject, char *data, int32_t length, </span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+extern &quot;C&quot; int</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+COM_MimeObject_write(void *mimeObject, char *data, int32_t length,</span>
<a href="#l1.41"></a><span id="l1.41">                      bool user_visible_p)</span>
<a href="#l1.42"></a><span id="l1.42"> {</span>
<a href="#l1.43"></a><span id="l1.43">   int32_t rc = -1;</span>
<a href="#l1.44"></a><span id="l1.44"> </span>
<a href="#l1.45"></a><span id="l1.45">   nsresult res;</span>
<a href="#l1.46"></a><span id="l1.46">   nsCOMPtr&lt;nsIMimeObjectClassAccess&gt; objAccess =</span>
<a href="#l1.47"></a><span id="l1.47">       do_CreateInstance(kMimeObjectClassAccessCID, &amp;res);</span>
<a href="#l1.48"></a><span id="l1.48">   if (NS_SUCCEEDED(res) &amp;&amp; objAccess)</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-  { </span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+  {</span>
<a href="#l1.51"></a><span id="l1.51">     if (NS_SUCCEEDED(objAccess-&gt;MimeObjectWrite(mimeObject, data, length, user_visible_p)))</span>
<a href="#l1.52"></a><span id="l1.52">       rc = length;</span>
<a href="#l1.53"></a><span id="l1.53">     else</span>
<a href="#l1.54"></a><span id="l1.54">       rc = -1;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-  } </span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+  }</span>
<a href="#l1.57"></a><span id="l1.57"> </span>
<a href="#l1.58"></a><span id="l1.58">   return rc;</span>
<a href="#l1.59"></a><span id="l1.59"> }</span>
<a href="#l1.60"></a><span id="l1.60"> </span>
<a href="#l1.61"></a><span id="l1.61"> extern &quot;C&quot; void *</span>
<a href="#l1.62"></a><span id="l1.62"> COM_MimeCreate(char * content_type, void * hdrs, void * opts)</span>
<a href="#l1.63"></a><span id="l1.63"> {</span>
<a href="#l1.64"></a><span id="l1.64">   void *ptr = NULL;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/mime/cthandlers/glue/nsMimeContentTypeHandler.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/glue/nsMimeContentTypeHandler.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,47 +1,47 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l2.5"></a><span id="l2.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.7"></a><span id="l2.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineminus">- </span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+</span>
<a href="#l2.10"></a><span id="l2.10"> /*</span>
<a href="#l2.11"></a><span id="l2.11">  * This interface is implemented by content type handlers that will be</span>
<a href="#l2.12"></a><span id="l2.12">  * called upon by libmime to process various attachments types. The primary</span>
<a href="#l2.13"></a><span id="l2.13">  * purpose of these handlers will be to represent the attached data in a</span>
<a href="#l2.14"></a><span id="l2.14">  * viewable HTML format that is useful for the user</span>
<a href="#l2.15"></a><span id="l2.15">  *</span>
<a href="#l2.16"></a><span id="l2.16">  * Note: These will all register by their content type prefixed by the</span>
<a href="#l2.17"></a><span id="l2.17">  *       following:  mimecth:text/vcard</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">- * </span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">- *       libmime will then use the XPCOM Component Manager to </span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+ *</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+ *       libmime will then use the XPCOM Component Manager to</span>
<a href="#l2.22"></a><span id="l2.22">  *       locate the appropriate Content Type handler</span>
<a href="#l2.23"></a><span id="l2.23">  */</span>
<a href="#l2.24"></a><span id="l2.24"> #ifndef nsMimeContentTypeHandler_h_</span>
<a href="#l2.25"></a><span id="l2.25"> #define nsMimeContentTypeHandler_h_</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27"> #include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l2.28"></a><span id="l2.28"> #include &quot;nsIMimeContentTypeHandler.h&quot;</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30"> typedef MimeObjectClass  *</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-(* MCTHCreateCTHClass)(const char *content_type, </span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+(* MCTHCreateCTHClass)(const char *content_type,</span>
<a href="#l2.33"></a><span id="l2.33">                        contentTypeHandlerInitStruct *initStruct);</span>
<a href="#l2.34"></a><span id="l2.34"> </span>
<a href="#l2.35"></a><span id="l2.35"> class nsMimeContentTypeHandler : public nsIMimeContentTypeHandler {</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-public: </span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-    nsMimeContentTypeHandler (const char *aMimeType, </span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+public:</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+    nsMimeContentTypeHandler (const char *aMimeType,</span>
<a href="#l2.40"></a><span id="l2.40">                               MCTHCreateCTHClass callback);</span>
<a href="#l2.41"></a><span id="l2.41"> </span>
<a href="#l2.42"></a><span id="l2.42">     /* this macro defines QueryInterface, AddRef and Release for this class */</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-    NS_DECL_ISUPPORTS </span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+    NS_DECL_ISUPPORTS</span>
<a href="#l2.45"></a><span id="l2.45"> </span>
<a href="#l2.46"></a><span id="l2.46">     NS_IMETHOD    GetContentType(char **contentType) override;</span>
<a href="#l2.47"></a><span id="l2.47"> </span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-    NS_IMETHOD    CreateContentTypeHandlerClass(const char *content_type, </span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-                                                contentTypeHandlerInitStruct *initStruct, </span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+    NS_IMETHOD    CreateContentTypeHandlerClass(const char *content_type,</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+                                                contentTypeHandlerInitStruct *initStruct,</span>
<a href="#l2.52"></a><span id="l2.52">                                                 MimeObjectClass **objClass) override;</span>
<a href="#l2.53"></a><span id="l2.53">  private:</span>
<a href="#l2.54"></a><span id="l2.54">     virtual ~nsMimeContentTypeHandler();</span>
<a href="#l2.55"></a><span id="l2.55">     char *mimeType;</span>
<a href="#l2.56"></a><span id="l2.56">     MCTHCreateCTHClass realCreateContentTypeHandlerClass;</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-}; </span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+};</span>
<a href="#l2.59"></a><span id="l2.59"> </span>
<a href="#l2.60"></a><span id="l2.60"> #endif /* nsMimeContentTypeHandler_h_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/mime/cthandlers/vcard/mimevcrd.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/vcard/mimevcrd.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l3.5"></a><span id="l3.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;mimevcrd.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">- </span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+</span>
<a href="#l3.12"></a><span id="l3.12"> #include &quot;mimecth.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13"> #include &quot;mimexpcom.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> #include &quot;nsIMsgVCardService.h&quot;</span>
<a href="#l3.15"></a><span id="l3.15"> #include &quot;nsINetUtil.h&quot;</span>
<a href="#l3.16"></a><span id="l3.16"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l3.17"></a><span id="l3.17"> #include &quot;prmem.h&quot;</span>
<a href="#l3.18"></a><span id="l3.18"> #include &quot;prprf.h&quot;</span>
<a href="#l3.19"></a><span id="l3.19"> #include &quot;nsServiceManagerUtils.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -470,17 +470,17 @@ nsMimeBaseEmitter::WriteHelper(const nsA</span>
<a href="#l4.4"></a><span id="l4.4">   NS_ENSURE_TRUE(mOutStream, NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6">   nsresult rv = mOutStream-&gt;Write(buf.BeginReading(), buf.Length(), countWritten);</span>
<a href="#l4.7"></a><span id="l4.7">   if (rv == NS_BASE_STREAM_WOULD_BLOCK) {</span>
<a href="#l4.8"></a><span id="l4.8">     // pipe is full, push contents of pipe to listener...</span>
<a href="#l4.9"></a><span id="l4.9">     uint64_t avail;</span>
<a href="#l4.10"></a><span id="l4.10">     rv = mInputStream-&gt;Available(&amp;avail);</span>
<a href="#l4.11"></a><span id="l4.11">     if (NS_SUCCEEDED(rv) &amp;&amp; avail) {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      mOutListener-&gt;OnDataAvailable(mChannel, mURL, mInputStream, 0, </span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      mOutListener-&gt;OnDataAvailable(mChannel, mURL, mInputStream, 0,</span>
<a href="#l4.14"></a><span id="l4.14">                                     std::min(avail, uint64_t(PR_UINT32_MAX)));</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">       // try writing again...</span>
<a href="#l4.17"></a><span id="l4.17">       rv = mOutStream-&gt;Write(buf.BeginReading(), buf.Length(), countWritten);</span>
<a href="#l4.18"></a><span id="l4.18">     }</span>
<a href="#l4.19"></a><span id="l4.19">   }</span>
<a href="#l4.20"></a><span id="l4.20">   return rv;</span>
<a href="#l4.21"></a><span id="l4.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimePlainEmitter.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimePlainEmitter.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -28,17 +28,17 @@ nsMimePlainEmitter::~nsMimePlainEmitter(</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> // Header handling routines.</span>
<a href="#l5.7"></a><span id="l5.7"> nsresult</span>
<a href="#l5.8"></a><span id="l5.8"> nsMimePlainEmitter::StartHeader(bool rootMailHeader, bool headerOnly, const char *msgID,</span>
<a href="#l5.9"></a><span id="l5.9">                            const char *outCharset)</span>
<a href="#l5.10"></a><span id="l5.10"> {</span>
<a href="#l5.11"></a><span id="l5.11">   mDocHeader = rootMailHeader;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  return NS_OK; </span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  return NS_OK;</span>
<a href="#l5.14"></a><span id="l5.14"> }</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> nsresult</span>
<a href="#l5.17"></a><span id="l5.17"> nsMimePlainEmitter::AddHeaderField(const char *field, const char *value)</span>
<a href="#l5.18"></a><span id="l5.18"> {</span>
<a href="#l5.19"></a><span id="l5.19">   if ( (!field) || (!value) )</span>
<a href="#l5.20"></a><span id="l5.20">     return NS_OK;</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -47,17 +47,17 @@ nsMimePlainEmitter::AddHeaderField(const</span>
<a href="#l5.23"></a><span id="l5.23">   UtilityWriteCRLF(value);</span>
<a href="#l5.24"></a><span id="l5.24">   return NS_OK;</span>
<a href="#l5.25"></a><span id="l5.25"> }</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27"> nsresult</span>
<a href="#l5.28"></a><span id="l5.28"> nsMimePlainEmitter::EndHeader(const nsACString &amp;name)</span>
<a href="#l5.29"></a><span id="l5.29"> {</span>
<a href="#l5.30"></a><span id="l5.30">   UtilityWriteCRLF(&quot;&quot;);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-  return NS_OK; </span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  return NS_OK;</span>
<a href="#l5.33"></a><span id="l5.33"> }</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35"> NS_IMETHODIMP</span>
<a href="#l5.36"></a><span id="l5.36"> nsMimePlainEmitter::WriteBody(const nsACString &amp;buf, uint32_t *amountWritten)</span>
<a href="#l5.37"></a><span id="l5.37"> {</span>
<a href="#l5.38"></a><span id="l5.38">   Write(buf, amountWritten);</span>
<a href="#l5.39"></a><span id="l5.39">   return NS_OK;</span>
<a href="#l5.40"></a><span id="l5.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimePlainEmitter.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimePlainEmitter.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -10,17 +10,17 @@</span>
<a href="#l6.4"></a><span id="l6.4"> #include &quot;nsMimeBaseEmitter.h&quot;</span>
<a href="#l6.5"></a><span id="l6.5"> #include &quot;nsMimeRebuffer.h&quot;</span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsIURI.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11"> class nsMimePlainEmitter : public nsMimeBaseEmitter {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-public: </span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+public:</span>
<a href="#l6.14"></a><span id="l6.14">     nsMimePlainEmitter ();</span>
<a href="#l6.15"></a><span id="l6.15">     virtual       ~nsMimePlainEmitter (void);</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">     // Header handling routines.</span>
<a href="#l6.18"></a><span id="l6.18">     NS_IMETHOD    StartHeader(bool rootMailHeader, bool headerOnly, const char *msgID,</span>
<a href="#l6.19"></a><span id="l6.19">                               const char *outCharset) override;</span>
<a href="#l6.20"></a><span id="l6.20">     NS_IMETHOD    AddHeaderField(const char *field, const char *value) override;</span>
<a href="#l6.21"></a><span id="l6.21">     NS_IMETHOD    EndHeader(const nsACString &amp;buf) override;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeRawEmitter.h</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeRawEmitter.h</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -10,17 +10,17 @@</span>
<a href="#l7.4"></a><span id="l7.4"> #include &quot;nsMimeBaseEmitter.h&quot;</span>
<a href="#l7.5"></a><span id="l7.5"> #include &quot;nsMimeRebuffer.h&quot;</span>
<a href="#l7.6"></a><span id="l7.6"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l7.7"></a><span id="l7.7"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l7.8"></a><span id="l7.8"> #include &quot;nsIURI.h&quot;</span>
<a href="#l7.9"></a><span id="l7.9"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> class nsMimeRawEmitter : public nsMimeBaseEmitter {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-public: </span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+public:</span>
<a href="#l7.14"></a><span id="l7.14">     nsMimeRawEmitter ();</span>
<a href="#l7.15"></a><span id="l7.15">     virtual       ~nsMimeRawEmitter (void);</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17">     NS_IMETHOD    WriteBody(const nsACString &amp;buf,</span>
<a href="#l7.18"></a><span id="l7.18">                             uint32_t *amountWritten) override;</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> protected:</span>
<a href="#l7.21"></a><span id="l7.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeRebuffer.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeRebuffer.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -8,17 +8,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #include &lt;stdint.h&gt;</span>
<a href="#l8.5"></a><span id="l8.5"> #include &quot;nsString.h&quot;</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> //////////////////////////////////////////////////////////////</span>
<a href="#l8.8"></a><span id="l8.8"> // A rebuffering class necessary for stream output buffering</span>
<a href="#l8.9"></a><span id="l8.9"> //////////////////////////////////////////////////////////////</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11"> class MimeRebuffer {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-public: </span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+public:</span>
<a href="#l8.14"></a><span id="l8.14">     MimeRebuffer (void);</span>
<a href="#l8.15"></a><span id="l8.15">     virtual       ~MimeRebuffer (void);</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">     uint32_t      GetSize();</span>
<a href="#l8.18"></a><span id="l8.18">     uint32_t      IncreaseBuffer(const nsACString &amp;addBuf);</span>
<a href="#l8.19"></a><span id="l8.19">     uint32_t      ReduceBuffer(uint32_t numBytes);</span>
<a href="#l8.20"></a><span id="l8.20">     nsACString &amp;  GetBuffer();</span>
<a href="#l8.21"></a><span id="l8.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeXmlEmitter.h</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeXmlEmitter.h</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -10,17 +10,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> #include &quot;nsMimeBaseEmitter.h&quot;</span>
<a href="#l9.5"></a><span id="l9.5"> #include &quot;nsMimeRebuffer.h&quot;</span>
<a href="#l9.6"></a><span id="l9.6"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l9.7"></a><span id="l9.7"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l9.8"></a><span id="l9.8"> #include &quot;nsIURI.h&quot;</span>
<a href="#l9.9"></a><span id="l9.9"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11"> class nsMimeXmlEmitter : public nsMimeBaseEmitter {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-public: </span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+public:</span>
<a href="#l9.14"></a><span id="l9.14">     nsMimeXmlEmitter ();</span>
<a href="#l9.15"></a><span id="l9.15">     virtual       ~nsMimeXmlEmitter (void);</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">     NS_IMETHOD    Complete() override;</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19">     // Header handling routines.</span>
<a href="#l9.20"></a><span id="l9.20">     NS_IMETHOD    StartHeader(bool rootMailHeader, bool headerOnly, const char *msgID,</span>
<a href="#l9.21"></a><span id="l9.21">                               const char *outCharset) override;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -35,13 +35,13 @@ public:</span>
<a href="#l9.23"></a><span id="l9.23">     NS_IMETHOD    EndAttachment() override;</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">     NS_IMETHOD    WriteXMLHeader(const char *msgID);</span>
<a href="#l9.26"></a><span id="l9.26">     NS_IMETHOD    WriteXMLTag(const char *tagName, const char *value);</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28"> protected:</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30">     // For header determination...</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    bool                mXMLHeaderStarted; </span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    bool                mXMLHeaderStarted;</span>
<a href="#l9.33"></a><span id="l9.33">     int32_t             mAttachCount;</span>
<a href="#l9.34"></a><span id="l9.34"> };</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36"> #endif /* _nsMimeXmlEmitter_h_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/mime/src/mimecom.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/mime/src/mimecom.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,35 +1,35 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.5"></a><span id="l10.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">-/* </span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+/*</span>
<a href="#l10.11"></a><span id="l10.11">  * XP-COM Bridges for C function calls</span>
<a href="#l10.12"></a><span id="l10.12">  */</span>
<a href="#l10.13"></a><span id="l10.13"> #ifndef _MIMECOM_H_</span>
<a href="#l10.14"></a><span id="l10.14"> #define _MIMECOM_H_</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> #include &lt;stdint.h&gt;</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> /*</span>
<a href="#l10.19"></a><span id="l10.19">  * These functions are exposed by libmime to be used by content type</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">- * handler plugins for processing stream data. </span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+ * handler plugins for processing stream data.</span>
<a href="#l10.22"></a><span id="l10.22">  */</span>
<a href="#l10.23"></a><span id="l10.23"> /*</span>
<a href="#l10.24"></a><span id="l10.24">  * This is the write call for outputting processed stream data.</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">- */ </span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-extern &quot;C&quot; int  XPCOM_MimeObject_write(void *mimeObject, const char *data, </span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-                                  int32_t length, </span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+ */</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+extern &quot;C&quot; int  XPCOM_MimeObject_write(void *mimeObject, const char *data,</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+                                  int32_t length,</span>
<a href="#l10.31"></a><span id="l10.31">                                   bool user_visible_p);</span>
<a href="#l10.32"></a><span id="l10.32"> /*</span>
<a href="#l10.33"></a><span id="l10.33">  * The following group of calls expose the pointers for the object</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">- * system within libmime. </span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">- */                                                        </span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+ * system within libmime.</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+ */</span>
<a href="#l10.38"></a><span id="l10.38"> extern &quot;C&quot; void *XPCOM_GetmimeInlineTextClass(void);</span>
<a href="#l10.39"></a><span id="l10.39"> extern &quot;C&quot; void *XPCOM_GetmimeLeafClass(void);</span>
<a href="#l10.40"></a><span id="l10.40"> extern &quot;C&quot; void *XPCOM_GetmimeObjectClass(void);</span>
<a href="#l10.41"></a><span id="l10.41"> extern &quot;C&quot; void *XPCOM_GetmimeContainerClass(void);</span>
<a href="#l10.42"></a><span id="l10.42"> extern &quot;C&quot; void *XPCOM_GetmimeMultipartClass(void);</span>
<a href="#l10.43"></a><span id="l10.43"> extern &quot;C&quot; void *XPCOM_GetmimeMultipartSignedClass(void);</span>
<a href="#l10.44"></a><span id="l10.44"> extern &quot;C&quot; void *XPCOM_GetmimeEncryptedClass(void);</span>
<a href="#l10.45"></a><span id="l10.45"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/mime/src/mimecth.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/mime/src/mimecth.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l11.5"></a><span id="l11.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;mimecth.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10"> /*</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">- * These calls are necessary to expose the object class hierarchy </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+ * These calls are necessary to expose the object class hierarchy</span>
<a href="#l11.13"></a><span id="l11.13">  * to externally developed content type handlers.</span>
<a href="#l11.14"></a><span id="l11.14">  */</span>
<a href="#l11.15"></a><span id="l11.15"> MimeInlineTextClass *</span>
<a href="#l11.16"></a><span id="l11.16"> MIME_GetmimeInlineTextClass(void)</span>
<a href="#l11.17"></a><span id="l11.17"> {</span>
<a href="#l11.18"></a><span id="l11.18">   return &amp;mimeInlineTextClass;</span>
<a href="#l11.19"></a><span id="l11.19"> }</span>
<a href="#l11.20"></a><span id="l11.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/mime/src/mimeebod.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/mime/src/mimeebod.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -149,17 +149,17 @@ MimeExternalBody_make_url(const char *ct</span>
<a href="#l12.4"></a><span id="l12.4">   if (!at)</span>
<a href="#l12.5"></a><span id="l12.5">   {</span>
<a href="#l12.6"></a><span id="l12.6">     return 0;</span>
<a href="#l12.7"></a><span id="l12.7">   }</span>
<a href="#l12.8"></a><span id="l12.8">   else if (!PL_strcasecmp(at, &quot;ftp&quot;) || !PL_strcasecmp(at, &quot;anon-ftp&quot;))</span>
<a href="#l12.9"></a><span id="l12.9">   {</span>
<a href="#l12.10"></a><span id="l12.10">     if (!site || !name)</span>
<a href="#l12.11"></a><span id="l12.11">       return 0;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-	  </span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+	</span>
<a href="#l12.14"></a><span id="l12.14">     slen = strlen(name) + strlen(site) + (dir ? strlen(dir) : 0) + 20;</span>
<a href="#l12.15"></a><span id="l12.15">     s = (char *) PR_MALLOC(slen);</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17">     if (!s) return 0;</span>
<a href="#l12.18"></a><span id="l12.18">     PL_strncpyz(s, &quot;ftp://&quot;, slen);</span>
<a href="#l12.19"></a><span id="l12.19">     PL_strcatn(s, slen, site);</span>
<a href="#l12.20"></a><span id="l12.20">     PL_strcatn(s, slen, &quot;/&quot;);</span>
<a href="#l12.21"></a><span id="l12.21">     if (dir) PL_strcatn(s, slen, (dir[0] == '/' ? dir+1 : dir));</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -286,17 +286,17 @@ MimeExternalBody_parse_eof (MimeObject *</span>
<a href="#l12.23"></a><span id="l12.23">     svr  = MimeHeaders_get_parameter(ct, &quot;server&quot;, NULL, NULL);</span>
<a href="#l12.24"></a><span id="l12.24">     subj = MimeHeaders_get_parameter(ct, &quot;subject&quot;, NULL, NULL);</span>
<a href="#l12.25"></a><span id="l12.25">     url  = MimeHeaders_get_parameter(ct, &quot;url&quot;, NULL, NULL);</span>
<a href="#l12.26"></a><span id="l12.26">     PR_FREEIF(ct);</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">     /* the *internal* content-type */</span>
<a href="#l12.29"></a><span id="l12.29">     ct = MimeHeaders_get(bod-&gt;hdrs, HEADER_CONTENT_TYPE,</span>
<a href="#l12.30"></a><span id="l12.30">                          true, false);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-						 </span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+						</span>
<a href="#l12.33"></a><span id="l12.33">     uint32_t hlen = ((at ? strlen(at) : 0) +</span>
<a href="#l12.34"></a><span id="l12.34">                     (lexp ? strlen(lexp) : 0) +</span>
<a href="#l12.35"></a><span id="l12.35">                     (size ? strlen(size) : 0) +</span>
<a href="#l12.36"></a><span id="l12.36">                     (perm ? strlen(perm) : 0) +</span>
<a href="#l12.37"></a><span id="l12.37">                     (dir ? strlen(dir) : 0) +</span>
<a href="#l12.38"></a><span id="l12.38">                     (mode ? strlen(mode) : 0) +</span>
<a href="#l12.39"></a><span id="l12.39">                     (name ? strlen(name) : 0) +</span>
<a href="#l12.40"></a><span id="l12.40">                     (site ? strlen(site) : 0) +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/mime/src/mimeeobj.h</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/mime/src/mimeeobj.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l13.4"></a><span id="l13.4"> #ifndef _MIMEEOBJ_H_</span>
<a href="#l13.5"></a><span id="l13.5"> #define _MIMEEOBJ_H_</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;mimeleaf.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9"> /* The MimeExternalObject class represents MIME parts which contain data</span>
<a href="#l13.10"></a><span id="l13.10">    which cannot be displayed inline -- application/octet-stream and any</span>
<a href="#l13.11"></a><span id="l13.11">    other type that is not otherwise specially handled.  (This is not to</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-   be confused with MimeExternalBody, which is the handler for the </span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+   be confused with MimeExternalBody, which is the handler for the</span>
<a href="#l13.14"></a><span id="l13.14">    message/external-object MIME type only.)</span>
<a href="#l13.15"></a><span id="l13.15">  */</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17"> typedef struct MimeExternalObjectClass MimeExternalObjectClass;</span>
<a href="#l13.18"></a><span id="l13.18"> typedef struct MimeExternalObject      MimeExternalObject;</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20"> struct MimeExternalObjectClass {</span>
<a href="#l13.21"></a><span id="l13.21">   MimeLeafClass leaf;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/mime/src/mimeleaf.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/mime/src/mimeleaf.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -99,17 +99,17 @@ MimeLeaf_parse_begin (MimeObject *obj)</span>
<a href="#l14.4"></a><span id="l14.4">        obj-&gt;parent &amp;&amp;</span>
<a href="#l14.5"></a><span id="l14.5">        (!PL_strcasecmp(obj-&gt;parent-&gt;content_type, MESSAGE_NEWS) ||</span>
<a href="#l14.6"></a><span id="l14.6">         !PL_strcasecmp(obj-&gt;parent-&gt;content_type, MESSAGE_RFC822)) &amp;&amp;</span>
<a href="#l14.7"></a><span id="l14.7">        !PL_strncasecmp(obj-&gt;content_type, &quot;text/&quot;, 5)))</span>
<a href="#l14.8"></a><span id="l14.8">     /* no-op */ ;</span>
<a href="#l14.9"></a><span id="l14.9">   else if (!PL_strcasecmp(obj-&gt;encoding, ENCODING_BASE64))</span>
<a href="#l14.10"></a><span id="l14.10">   fn = &amp;MimeB64DecoderInit;</span>
<a href="#l14.11"></a><span id="l14.11">   else if (!PL_strcasecmp(obj-&gt;encoding, ENCODING_QUOTED_PRINTABLE))</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  leaf-&gt;decoder_data = </span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  leaf-&gt;decoder_data =</span>
<a href="#l14.14"></a><span id="l14.14">           MimeQPDecoderInit(((MimeConverterOutputCallback)</span>
<a href="#l14.15"></a><span id="l14.15">                         ((MimeLeafClass *)obj-&gt;clazz)-&gt;parse_decoded_buffer),</span>
<a href="#l14.16"></a><span id="l14.16">                         obj, obj);</span>
<a href="#l14.17"></a><span id="l14.17">   else if (!PL_strcasecmp(obj-&gt;encoding, ENCODING_UUENCODE) ||</span>
<a href="#l14.18"></a><span id="l14.18">        !PL_strcasecmp(obj-&gt;encoding, ENCODING_UUENCODE2) ||</span>
<a href="#l14.19"></a><span id="l14.19">        !PL_strcasecmp(obj-&gt;encoding, ENCODING_UUENCODE3) ||</span>
<a href="#l14.20"></a><span id="l14.20">        !PL_strcasecmp(obj-&gt;encoding, ENCODING_UUENCODE4))</span>
<a href="#l14.21"></a><span id="l14.21">   fn = &amp;MimeUUDecoderInit;</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -148,17 +148,17 @@ MimeLeaf_parse_buffer (const char *buffe</span>
<a href="#l14.23"></a><span id="l14.23">     !obj-&gt;options-&gt;output_fn)</span>
<a href="#l14.24"></a><span id="l14.24">   return 0;</span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26">   int rv;</span>
<a href="#l14.27"></a><span id="l14.27">   if (leaf-&gt;sizeSoFar == -1)</span>
<a href="#l14.28"></a><span id="l14.28">     leaf-&gt;sizeSoFar = 0;</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30">   if (leaf-&gt;decoder_data &amp;&amp;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-      obj-&gt;options &amp;&amp; </span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+      obj-&gt;options &amp;&amp;</span>
<a href="#l14.33"></a><span id="l14.33">       obj-&gt;options-&gt;format_out != nsMimeOutput::nsMimeMessageDecrypt</span>
<a href="#l14.34"></a><span id="l14.34">       &amp;&amp; obj-&gt;options-&gt;format_out != nsMimeOutput::nsMimeMessageAttach) {</span>
<a href="#l14.35"></a><span id="l14.35">     int outSize = 0;</span>
<a href="#l14.36"></a><span id="l14.36">     rv = MimeDecoderWrite (leaf-&gt;decoder_data, buffer, size, &amp;outSize);</span>
<a href="#l14.37"></a><span id="l14.37">     leaf-&gt;sizeSoFar += outSize;</span>
<a href="#l14.38"></a><span id="l14.38">   }</span>
<a href="#l14.39"></a><span id="l14.39">   else {</span>
<a href="#l14.40"></a><span id="l14.40">     rv = ((MimeLeafClass *)obj-&gt;clazz)-&gt;parse_decoded_buffer (buffer, size,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/mime/src/mimemalt.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/mime/src/mimemalt.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -210,17 +210,17 @@ MimeMultipartAlternative_flush_children(</span>
<a href="#l15.4"></a><span id="l15.4">   MimeMultipartAlternative *malt = (MimeMultipartAlternative *) obj;</span>
<a href="#l15.5"></a><span id="l15.5">   bool have_displayable, do_flush, do_display;</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7">   /* Case 1 */</span>
<a href="#l15.8"></a><span id="l15.8">   if (! malt-&gt;pending_parts)</span>
<a href="#l15.9"></a><span id="l15.9">     return 0;</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11">   have_displayable = (malt-&gt;buffered_priority &gt; next_priority);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  </span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+</span>
<a href="#l15.14"></a><span id="l15.14">   if (finished &amp;&amp; have_displayable) {</span>
<a href="#l15.15"></a><span id="l15.15">     /* Case 2 */</span>
<a href="#l15.16"></a><span id="l15.16">     do_flush = true;</span>
<a href="#l15.17"></a><span id="l15.17">     do_display = true;</span>
<a href="#l15.18"></a><span id="l15.18">   }</span>
<a href="#l15.19"></a><span id="l15.19">   else if (finished &amp;&amp; ! have_displayable) {</span>
<a href="#l15.20"></a><span id="l15.20">     /* Case 3 */</span>
<a href="#l15.21"></a><span id="l15.21">     do_flush = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/mime/src/mimemcms.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/mime/src/mimemcms.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5"> #ifndef _MIMEMPKC_H_</span>
<a href="#l16.6"></a><span id="l16.6"> #define _MIMEMPKC_H_</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> #include &quot;mimemsig.h&quot;</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10"> class nsICMSMessage;</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-/* The MimeMultipartSignedCMS class implements a multipart/signed MIME </span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+/* The MimeMultipartSignedCMS class implements a multipart/signed MIME</span>
<a href="#l16.14"></a><span id="l16.14">    container with protocol=application/x-CMS-signature, which passes the</span>
<a href="#l16.15"></a><span id="l16.15">    signed object through CMS code to verify the signature.  See mimemsig.h</span>
<a href="#l16.16"></a><span id="l16.16">    for details of the general mechanism on which this is built.</span>
<a href="#l16.17"></a><span id="l16.17">  */</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19"> typedef struct MimeMultipartSignedCMSClass MimeMultipartSignedCMSClass;</span>
<a href="#l16.20"></a><span id="l16.20"> typedef struct MimeMultipartSignedCMS      MimeMultipartSignedCMS;</span>
<a href="#l16.21"></a><span id="l16.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/mime/src/mimemdig.h</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/mime/src/mimemdig.h</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l17.4"></a><span id="l17.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l17.5"></a><span id="l17.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7"> #ifndef _MIMEMDIG_H_</span>
<a href="#l17.8"></a><span id="l17.8"> #define _MIMEMDIG_H_</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10"> #include &quot;mimemult.h&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-/* The MimeMultipartDigest class implements the multipart/digest MIME </span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+/* The MimeMultipartDigest class implements the multipart/digest MIME</span>
<a href="#l17.14"></a><span id="l17.14">    container, which is just like multipart/mixed, except that the default</span>
<a href="#l17.15"></a><span id="l17.15">    type (for parts with no type explicitly specified) is message/rfc822</span>
<a href="#l17.16"></a><span id="l17.16">    instead of text/plain.</span>
<a href="#l17.17"></a><span id="l17.17">  */</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19"> typedef struct MimeMultipartDigestClass MimeMultipartDigestClass;</span>
<a href="#l17.20"></a><span id="l17.20"> typedef struct MimeMultipartDigest      MimeMultipartDigest;</span>
<a href="#l17.21"></a><span id="l17.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/mime/src/mimempar.h</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/mime/src/mimempar.h</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l18.4"></a><span id="l18.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l18.5"></a><span id="l18.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7"> #ifndef _MIMEMPAR_H_</span>
<a href="#l18.8"></a><span id="l18.8"> #define _MIMEMPAR_H_</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10"> #include &quot;mimemult.h&quot;</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-/* The MimeMultipartParallel class implements the multipart/parallel MIME </span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+/* The MimeMultipartParallel class implements the multipart/parallel MIME</span>
<a href="#l18.14"></a><span id="l18.14">    container, which is currently no different from multipart/mixed, since</span>
<a href="#l18.15"></a><span id="l18.15">    it's not clear that there's anything useful it could do differently.</span>
<a href="#l18.16"></a><span id="l18.16">  */</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18"> typedef struct MimeMultipartParallelClass MimeMultipartParallelClass;</span>
<a href="#l18.19"></a><span id="l18.19"> typedef struct MimeMultipartParallel      MimeMultipartParallel;</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21"> struct MimeMultipartParallelClass {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -741,17 +741,17 @@ real_write(MimeMultipartRelated* relobj,</span>
<a href="#l19.4"></a><span id="l19.4"> #ifdef MIME_DRAFTS</span>
<a href="#l19.5"></a><span id="l19.5">   if ( obj-&gt;options &amp;&amp;</span>
<a href="#l19.6"></a><span id="l19.6">      obj-&gt;options-&gt;decompose_file_p &amp;&amp;</span>
<a href="#l19.7"></a><span id="l19.7">      obj-&gt;options-&gt;decompose_file_output_fn )</span>
<a href="#l19.8"></a><span id="l19.8">   {</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10">     // the buf here has already been decoded, but we want to use general output</span>
<a href="#l19.11"></a><span id="l19.11">     // functions here that permit decoded or encoded input, using the closure</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    // to tell the difference. We'll temporarily disable the closure's decoder, </span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    // to tell the difference. We'll temporarily disable the closure's decoder,</span>
<a href="#l19.14"></a><span id="l19.14">     // then restore it when we are done. Not sure if we shouldn't just turn it off</span>
<a href="#l19.15"></a><span id="l19.15">     // permanently though.</span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17">     mime_draft_data *mdd = (mime_draft_data *) obj-&gt;options-&gt;stream_closure;</span>
<a href="#l19.18"></a><span id="l19.18">     MimeDecoderData* old_decoder_data = mdd-&gt;decoder_data;</span>
<a href="#l19.19"></a><span id="l19.19">     mdd-&gt;decoder_data = nullptr;</span>
<a href="#l19.20"></a><span id="l19.20">     int status = obj-&gt;options-&gt;decompose_file_output_fn</span>
<a href="#l19.21"></a><span id="l19.21">                  (buf, size, (void *)mdd);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/mime/src/mimemsig.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/mime/src/mimemsig.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -192,17 +192,17 @@ MimeMultipartSigned_parse_line (const ch</span>
<a href="#l20.4"></a><span id="l20.4">       sig-&gt;state = MimeMultipartSignedSignatureHeaders;</span>
<a href="#l20.5"></a><span id="l20.5">       else if (sig-&gt;state == MimeMultipartSignedSignatureFirstLine ||</span>
<a href="#l20.6"></a><span id="l20.6">            sig-&gt;state == MimeMultipartSignedSignatureLine)</span>
<a href="#l20.7"></a><span id="l20.7">       sig-&gt;state = MimeMultipartSignedEpilogue;</span>
<a href="#l20.8"></a><span id="l20.8">       break;</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10">     case MimeMultipartPartFirstLine:</span>
<a href="#l20.11"></a><span id="l20.11">       if (sig-&gt;state == MimeMultipartSignedBodyFirstHeader)</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-      {      </span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+      {</span>
<a href="#l20.14"></a><span id="l20.14">         sig-&gt;state = MimeMultipartSignedBodyFirstLine;</span>
<a href="#l20.15"></a><span id="l20.15">         no_headers_p = true;</span>
<a href="#l20.16"></a><span id="l20.16">       }</span>
<a href="#l20.17"></a><span id="l20.17">       else if (sig-&gt;state == MimeMultipartSignedBodyHeaders)</span>
<a href="#l20.18"></a><span id="l20.18">       sig-&gt;state = MimeMultipartSignedBodyFirstLine;</span>
<a href="#l20.19"></a><span id="l20.19">       else if (sig-&gt;state == MimeMultipartSignedSignatureHeaders)</span>
<a href="#l20.20"></a><span id="l20.20">       sig-&gt;state = MimeMultipartSignedSignatureFirstLine;</span>
<a href="#l20.21"></a><span id="l20.21">       else</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -651,17 +651,17 @@ MimeMultipartSigned_emit_child (MimeObje</span>
<a href="#l20.23"></a><span id="l20.23">    */</span>
<a href="#l20.24"></a><span id="l20.24">   status = (((MimeMultipartClass *)(&amp;MIME_SUPERCLASS))-&gt;create_child(obj));</span>
<a href="#l20.25"></a><span id="l20.25">   if (status &lt; 0) return status;</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27">   // Notify the charset of the first part.</span>
<a href="#l20.28"></a><span id="l20.28">   if (obj-&gt;options &amp;&amp; !(obj-&gt;options-&gt;override_charset)) {</span>
<a href="#l20.29"></a><span id="l20.29">     MimeObject *firstChild = ((MimeContainer*) obj)-&gt;children[0];</span>
<a href="#l20.30"></a><span id="l20.30">     char *disposition = MimeHeaders_get (firstChild-&gt;headers,</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-                                         HEADER_CONTENT_DISPOSITION, </span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+                                         HEADER_CONTENT_DISPOSITION,</span>
<a href="#l20.33"></a><span id="l20.33">                                          true,</span>
<a href="#l20.34"></a><span id="l20.34">                                          false);</span>
<a href="#l20.35"></a><span id="l20.35">     // check if need to show as inline</span>
<a href="#l20.36"></a><span id="l20.36">     if (!disposition)</span>
<a href="#l20.37"></a><span id="l20.37">     {</span>
<a href="#l20.38"></a><span id="l20.38">       const char *content_type = firstChild-&gt;content_type;</span>
<a href="#l20.39"></a><span id="l20.39">       if (!PL_strcasecmp (content_type, TEXT_PLAIN) ||</span>
<a href="#l20.40"></a><span id="l20.40">           !PL_strcasecmp (content_type, TEXT_HTML) ||</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineat">@@ -678,33 +678,33 @@ MimeMultipartSigned_emit_child (MimeObje</span>
<a href="#l20.42"></a><span id="l20.42">             SetMailCharacterSetToMsgWindow(obj, cset);</span>
<a href="#l20.43"></a><span id="l20.43">             PR_Free(cset);</span>
<a href="#l20.44"></a><span id="l20.44">           }</span>
<a href="#l20.45"></a><span id="l20.45">           PR_Free(ct);</span>
<a href="#l20.46"></a><span id="l20.46">         }</span>
<a href="#l20.47"></a><span id="l20.47">       }</span>
<a href="#l20.48"></a><span id="l20.48">     }</span>
<a href="#l20.49"></a><span id="l20.49">   }</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-  </span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+</span>
<a href="#l20.52"></a><span id="l20.52">   // The js emitter wants to know about the newly created child.  Because</span>
<a href="#l20.53"></a><span id="l20.53">   //  MimeMultipartSigned dummies out its create_child operation, the logic</span>
<a href="#l20.54"></a><span id="l20.54">   //  in MimeMultipart_parse_line that would normally provide this notification</span>
<a href="#l20.55"></a><span id="l20.55">   //  does not get to fire.</span>
<a href="#l20.56"></a><span id="l20.56">   if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;notify_nested_bodies) {</span>
<a href="#l20.57"></a><span id="l20.57">     MimeObject *kid = ((MimeContainer*) obj)-&gt;children[0];</span>
<a href="#l20.58"></a><span id="l20.58">     // The emitter is expecting the content type with parameters; not the fully</span>
<a href="#l20.59"></a><span id="l20.59">     //  parsed thing, so get it from raw.  (We do not do it in the charset</span>
<a href="#l20.60"></a><span id="l20.60">     //  notification block that just happened because it already has complex</span>
<a href="#l20.61"></a><span id="l20.61">     //  if-checks that do not jive with us.</span>
<a href="#l20.62"></a><span id="l20.62">     char *ct = MimeHeaders_get(mult-&gt;hdrs, HEADER_CONTENT_TYPE, false,</span>
<a href="#l20.63"></a><span id="l20.63">                                false);</span>
<a href="#l20.64"></a><span id="l20.64">     mimeEmitterAddHeaderField(obj-&gt;options, HEADER_CONTENT_TYPE,</span>
<a href="#l20.65"></a><span id="l20.65">                               ct ? ct : &quot;text/plain&quot;);</span>
<a href="#l20.66"></a><span id="l20.66">     PR_Free(ct);</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineminus">-    </span>
<a href="#l20.68"></a><span id="l20.68" class="difflineplus">+</span>
<a href="#l20.69"></a><span id="l20.69">     char *part_path = mime_part_address(kid);</span>
<a href="#l20.70"></a><span id="l20.70">     if (part_path) {</span>
<a href="#l20.71"></a><span id="l20.71">       mimeEmitterAddHeaderField(obj-&gt;options,</span>
<a href="#l20.72"></a><span id="l20.72">                                 &quot;x-jsemitter-part-path&quot;,</span>
<a href="#l20.73"></a><span id="l20.73">                                 part_path);</span>
<a href="#l20.74"></a><span id="l20.74">       PR_Free(part_path);</span>
<a href="#l20.75"></a><span id="l20.75">     }</span>
<a href="#l20.76"></a><span id="l20.76">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/mime/src/mimemult.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/mime/src/mimemult.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -112,17 +112,17 @@ int MimeWriteAString(MimeObject *obj, co</span>
<a href="#l21.4"></a><span id="l21.4">   const nsCString &amp;flatString = PromiseFlatCString(string);</span>
<a href="#l21.5"></a><span id="l21.5">   return MimeObject_write(obj, flatString.get(), flatString.Length(), true);</span>
<a href="#l21.6"></a><span id="l21.6"> }</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> static int</span>
<a href="#l21.9"></a><span id="l21.9"> MimeMultipart_parse_line (const char *line, int32_t length, MimeObject *obj)</span>
<a href="#l21.10"></a><span id="l21.10"> {</span>
<a href="#l21.11"></a><span id="l21.11">   MimeMultipart *mult = (MimeMultipart *) obj;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  MimeContainer *container = (MimeContainer*) obj; </span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  MimeContainer *container = (MimeContainer*) obj;</span>
<a href="#l21.14"></a><span id="l21.14">   int status = 0;</span>
<a href="#l21.15"></a><span id="l21.15">   MimeMultipartBoundaryType boundary;</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17">   NS_ASSERTION(line &amp;&amp; *line, &quot;empty line in multipart parse_line&quot;);</span>
<a href="#l21.18"></a><span id="l21.18">   if (!line || !*line) return -1;</span>
<a href="#l21.19"></a><span id="l21.19"> </span>
<a href="#l21.20"></a><span id="l21.20">   NS_ASSERTION(!obj-&gt;closed_p, &quot;obj shouldn't already be closed&quot;);</span>
<a href="#l21.21"></a><span id="l21.21">   if (obj-&gt;closed_p) return -1;</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -147,23 +147,23 @@ MimeMultipart_parse_line (const char *li</span>
<a href="#l21.23"></a><span id="l21.23">   {</span>
<a href="#l21.24"></a><span id="l21.24">   /* Match!  Close the currently-open part, move on to the next</span>
<a href="#l21.25"></a><span id="l21.25">      state, and discard this line.</span>
<a href="#l21.26"></a><span id="l21.26">    */</span>
<a href="#l21.27"></a><span id="l21.27">     bool endOfPart = (mult-&gt;state != MimeMultipartPreamble);</span>
<a href="#l21.28"></a><span id="l21.28">     if (endOfPart)</span>
<a href="#l21.29"></a><span id="l21.29">       status = ((MimeMultipartClass *)obj-&gt;clazz)-&gt;close_child(obj);</span>
<a href="#l21.30"></a><span id="l21.30">     if (status &lt; 0) return status;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-    </span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+</span>
<a href="#l21.33"></a><span id="l21.33">     if (boundary == MimeMultipartBoundaryTypeTerminator)</span>
<a href="#l21.34"></a><span id="l21.34">       mult-&gt;state = MimeMultipartEpilogue;</span>
<a href="#l21.35"></a><span id="l21.35">     else</span>
<a href="#l21.36"></a><span id="l21.36">     {</span>
<a href="#l21.37"></a><span id="l21.37">       mult-&gt;state = MimeMultipartHeaders;</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-      </span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+</span>
<a href="#l21.40"></a><span id="l21.40">       /* Reset the header parser for this upcoming part. */</span>
<a href="#l21.41"></a><span id="l21.41">       NS_ASSERTION(!mult-&gt;hdrs, &quot;mult-&gt;hdrs should be null here&quot;);</span>
<a href="#l21.42"></a><span id="l21.42">       if (mult-&gt;hdrs)</span>
<a href="#l21.43"></a><span id="l21.43">         MimeHeaders_free(mult-&gt;hdrs);</span>
<a href="#l21.44"></a><span id="l21.44">       mult-&gt;hdrs = MimeHeaders_new();</span>
<a href="#l21.45"></a><span id="l21.45">       if (!mult-&gt;hdrs)</span>
<a href="#l21.46"></a><span id="l21.46">         return MIME_OUT_OF_MEMORY;</span>
<a href="#l21.47"></a><span id="l21.47">       if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;state &amp;&amp;</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineat">@@ -182,22 +182,22 @@ MimeMultipart_parse_line (const char *li</span>
<a href="#l21.49"></a><span id="l21.49">             obj-&gt;options-&gt;state-&gt;strippingPart = true;</span>
<a href="#l21.50"></a><span id="l21.50">             if (partIndex &lt; obj-&gt;options-&gt;state-&gt;detachToFiles.Length())</span>
<a href="#l21.51"></a><span id="l21.51">               obj-&gt;options-&gt;state-&gt;detachedFilePath = obj-&gt;options-&gt;state-&gt;detachToFiles[partIndex];</span>
<a href="#l21.52"></a><span id="l21.52">             break;</span>
<a href="#l21.53"></a><span id="l21.53">           }</span>
<a href="#l21.54"></a><span id="l21.54">         }</span>
<a href="#l21.55"></a><span id="l21.55">       }</span>
<a href="#l21.56"></a><span id="l21.56">     }</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineminus">-    </span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+</span>
<a href="#l21.59"></a><span id="l21.59">     // if stripping out attachments, write the boundary line. Otherwise, return</span>
<a href="#l21.60"></a><span id="l21.60">     // to ignore it.</span>
<a href="#l21.61"></a><span id="l21.61">     if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;format_out == nsMimeOutput::nsMimeMessageAttach)</span>
<a href="#l21.62"></a><span id="l21.62">     {</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineminus">-      // Because MimeMultipart_parse_child_line strips out the </span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+      // Because MimeMultipart_parse_child_line strips out the</span>
<a href="#l21.65"></a><span id="l21.65">       // the CRLF of the last line before the end of a part, we need to add that</span>
<a href="#l21.66"></a><span id="l21.66">       // back in here.</span>
<a href="#l21.67"></a><span id="l21.67">       if (endOfPart)</span>
<a href="#l21.68"></a><span id="l21.68">         MimeWriteAString(obj, NS_LITERAL_CSTRING(MSG_LINEBREAK));</span>
<a href="#l21.69"></a><span id="l21.69"> </span>
<a href="#l21.70"></a><span id="l21.70">       status = MimeObject_write(obj, line, length, true);</span>
<a href="#l21.71"></a><span id="l21.71">     }</span>
<a href="#l21.72"></a><span id="l21.72">     return 0;</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineat">@@ -216,17 +216,17 @@ MimeMultipart_parse_line (const char *li</span>
<a href="#l21.74"></a><span id="l21.74"> </span>
<a href="#l21.75"></a><span id="l21.75">     case MimeMultipartHeaders:</span>
<a href="#l21.76"></a><span id="l21.76">     /* Parse this line as a header for the sub-part. */</span>
<a href="#l21.77"></a><span id="l21.77">     {</span>
<a href="#l21.78"></a><span id="l21.78">       status = MimeHeaders_parse_line(line, length, mult-&gt;hdrs);</span>
<a href="#l21.79"></a><span id="l21.79">       bool stripping = false;</span>
<a href="#l21.80"></a><span id="l21.80"> </span>
<a href="#l21.81"></a><span id="l21.81">       if (status &lt; 0) return status;</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineminus">-      </span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+</span>
<a href="#l21.84"></a><span id="l21.84">       // If this line is blank, we're now done parsing headers, and should</span>
<a href="#l21.85"></a><span id="l21.85">       // now examine the content-type to create this &quot;body&quot; part.</span>
<a href="#l21.86"></a><span id="l21.86">       //</span>
<a href="#l21.87"></a><span id="l21.87">       if (*line == '\r' || *line == '\n')</span>
<a href="#l21.88"></a><span id="l21.88">       {</span>
<a href="#l21.89"></a><span id="l21.89">         if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;state &amp;&amp;</span>
<a href="#l21.90"></a><span id="l21.90">             obj-&gt;options-&gt;state-&gt;strippingPart)</span>
<a href="#l21.91"></a><span id="l21.91">         {</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineat">@@ -253,17 +253,17 @@ MimeMultipart_parse_line (const char *li</span>
<a href="#l21.93"></a><span id="l21.93">             MimeWriteAString(obj, NS_LITERAL_CSTRING(MSG_LINEBREAK));</span>
<a href="#l21.94"></a><span id="l21.94">             MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;X-Mozilla-Altered: AttachmentDetached; date=\&quot;&quot;));</span>
<a href="#l21.95"></a><span id="l21.95">           }</span>
<a href="#l21.96"></a><span id="l21.96">           else</span>
<a href="#l21.97"></a><span id="l21.97">           {</span>
<a href="#l21.98"></a><span id="l21.98">             nsAutoCString header(&quot;Content-Type: text/x-moz-deleted; name=\&quot;Deleted: &quot;);</span>
<a href="#l21.99"></a><span id="l21.99">             header.Append(fileName);</span>
<a href="#l21.100"></a><span id="l21.100">             status = MimeWriteAString(obj, header);</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineminus">-            if (status &lt; 0) </span>
<a href="#l21.102"></a><span id="l21.102" class="difflineplus">+            if (status &lt; 0)</span>
<a href="#l21.103"></a><span id="l21.103">               return status;</span>
<a href="#l21.104"></a><span id="l21.104">             status = MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;\&quot;&quot; MSG_LINEBREAK &quot;Content-Transfer-Encoding: 8bit&quot; MSG_LINEBREAK));</span>
<a href="#l21.105"></a><span id="l21.105">             MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;Content-Disposition: inline; filename=\&quot;Deleted: &quot;));</span>
<a href="#l21.106"></a><span id="l21.106">             MimeWriteAString(obj, fileName);</span>
<a href="#l21.107"></a><span id="l21.107">             MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;\&quot;&quot; MSG_LINEBREAK &quot;X-Mozilla-Altered: AttachmentDeleted; date=\&quot;&quot;));</span>
<a href="#l21.108"></a><span id="l21.108">           }</span>
<a href="#l21.109"></a><span id="l21.109">           nsCString result;</span>
<a href="#l21.110"></a><span id="l21.110">           char timeBuffer[128];</span>
<a href="#l21.111"></a><span id="l21.111" class="difflineat">@@ -441,28 +441,28 @@ MimeMultipart_create_child(MimeObject *o</span>
<a href="#l21.112"></a><span id="l21.112">   status = ((MimeContainerClass *) obj-&gt;clazz)-&gt;add_child(obj, body);</span>
<a href="#l21.113"></a><span id="l21.113">   if (status &lt; 0)</span>
<a href="#l21.114"></a><span id="l21.114">   {</span>
<a href="#l21.115"></a><span id="l21.115">     mime_free(body);</span>
<a href="#l21.116"></a><span id="l21.116">     return status;</span>
<a href="#l21.117"></a><span id="l21.117">   }</span>
<a href="#l21.118"></a><span id="l21.118"> </span>
<a href="#l21.119"></a><span id="l21.119"> #ifdef MIME_DRAFTS</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineminus">-  if ( obj-&gt;options &amp;&amp; </span>
<a href="#l21.121"></a><span id="l21.121" class="difflineplus">+  if ( obj-&gt;options &amp;&amp;</span>
<a href="#l21.122"></a><span id="l21.122">      obj-&gt;options-&gt;decompose_file_p &amp;&amp;</span>
<a href="#l21.123"></a><span id="l21.123">      obj-&gt;options-&gt;is_multipart_msg &amp;&amp;</span>
<a href="#l21.124"></a><span id="l21.124">      obj-&gt;options-&gt;decompose_file_init_fn )</span>
<a href="#l21.125"></a><span id="l21.125">   {</span>
<a href="#l21.126"></a><span id="l21.126">     if ( !mime_typep(obj,(MimeObjectClass*)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l21.127"></a><span id="l21.127">            !mime_typep(obj,(MimeObjectClass*)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l21.128"></a><span id="l21.128">        !mime_typep(obj,(MimeObjectClass*)&amp;mimeMultipartSignedClass) &amp;&amp;</span>
<a href="#l21.129"></a><span id="l21.129"> #ifdef MIME_DETAIL_CHECK</span>
<a href="#l21.130"></a><span id="l21.130">        !mime_typep(body, (MimeObjectClass*)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l21.131"></a><span id="l21.131">        !mime_typep(body, (MimeObjectClass*)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l21.132"></a><span id="l21.132" class="difflineminus">-       !mime_typep(body,(MimeObjectClass*)&amp;mimeMultipartSignedClass) </span>
<a href="#l21.133"></a><span id="l21.133" class="difflineplus">+       !mime_typep(body,(MimeObjectClass*)&amp;mimeMultipartSignedClass)</span>
<a href="#l21.134"></a><span id="l21.134"> #else</span>
<a href="#l21.135"></a><span id="l21.135">            /* bug 21869 -- due to the fact that we are not generating the</span>
<a href="#l21.136"></a><span id="l21.136">               correct mime class object for content-typ multipart/signed part</span>
<a href="#l21.137"></a><span id="l21.137">               the above check failed. to solve the problem in general and not</span>
<a href="#l21.138"></a><span id="l21.138">               to cause early temination when parsing message for opening as</span>
<a href="#l21.139"></a><span id="l21.139">               draft we can simply make sure that the child is not a multipart</span>
<a href="#l21.140"></a><span id="l21.140">               mime object. this way we could have a proper decomposing message</span>
<a href="#l21.141"></a><span id="l21.141">               part functions set correctly */</span>
<a href="#l21.142"></a><span id="l21.142" class="difflineat">@@ -478,17 +478,17 @@ MimeMultipart_create_child(MimeObject *o</span>
<a href="#l21.143"></a><span id="l21.143"> #endif /* MIME_DRAFTS */</span>
<a href="#l21.144"></a><span id="l21.144"> </span>
<a href="#l21.145"></a><span id="l21.145"> </span>
<a href="#l21.146"></a><span id="l21.146">   /* Now that we've added this new object to our list of children,</span>
<a href="#l21.147"></a><span id="l21.147">    start its parser going (if we want to display it.)</span>
<a href="#l21.148"></a><span id="l21.148">    */</span>
<a href="#l21.149"></a><span id="l21.149">   body-&gt;output_p = (((MimeMultipartClass *) obj-&gt;clazz)-&gt;output_child_p(obj, body));</span>
<a href="#l21.150"></a><span id="l21.150">   if (body-&gt;output_p)</span>
<a href="#l21.151"></a><span id="l21.151" class="difflineminus">-  {  </span>
<a href="#l21.152"></a><span id="l21.152" class="difflineplus">+  {</span>
<a href="#l21.153"></a><span id="l21.153">     status = body-&gt;clazz-&gt;parse_begin(body);</span>
<a href="#l21.154"></a><span id="l21.154"> </span>
<a href="#l21.155"></a><span id="l21.155"> #ifdef XP_MACOSX</span>
<a href="#l21.156"></a><span id="l21.156">     /* if we are saving an apple double attachment, we need to set correctly the conten type of the channel */</span>
<a href="#l21.157"></a><span id="l21.157">     if (mime_typep(obj, (MimeObjectClass *) &amp;mimeMultipartAppleDoubleClass))</span>
<a href="#l21.158"></a><span id="l21.158">     {</span>
<a href="#l21.159"></a><span id="l21.159">       mime_stream_data *msd = (mime_stream_data *)body-&gt;options-&gt;stream_closure;</span>
<a href="#l21.160"></a><span id="l21.160">       if (!body-&gt;options-&gt;write_html_p &amp;&amp; body-&gt;content_type &amp;&amp; !PL_strcasecmp(body-&gt;content_type, APPLICATION_APPLEFILE))</span>
<a href="#l21.161"></a><span id="l21.161" class="difflineat">@@ -548,25 +548,25 @@ MimeMultipart_close_child(MimeObject *ob</span>
<a href="#l21.162"></a><span id="l21.162">       if (status &lt; 0) return status;</span>
<a href="#l21.163"></a><span id="l21.163">       status = kid-&gt;clazz-&gt;parse_end(kid, false);</span>
<a href="#l21.164"></a><span id="l21.164">       if (status &lt; 0) return status;</span>
<a href="#l21.165"></a><span id="l21.165"> </span>
<a href="#l21.166"></a><span id="l21.166"> #ifdef MIME_DRAFTS</span>
<a href="#l21.167"></a><span id="l21.167">       if ( object-&gt;options &amp;&amp;</span>
<a href="#l21.168"></a><span id="l21.168">          object-&gt;options-&gt;decompose_file_p &amp;&amp;</span>
<a href="#l21.169"></a><span id="l21.169">          object-&gt;options-&gt;is_multipart_msg &amp;&amp;</span>
<a href="#l21.170"></a><span id="l21.170" class="difflineminus">-         object-&gt;options-&gt;decompose_file_close_fn ) </span>
<a href="#l21.171"></a><span id="l21.171" class="difflineplus">+         object-&gt;options-&gt;decompose_file_close_fn )</span>
<a href="#l21.172"></a><span id="l21.172">       {</span>
<a href="#l21.173"></a><span id="l21.173">         if ( !mime_typep(object,(MimeObjectClass*)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l21.174"></a><span id="l21.174">            !mime_typep(object,(MimeObjectClass*)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l21.175"></a><span id="l21.175">            !mime_typep(object,(MimeObjectClass*)&amp;mimeMultipartSignedClass) &amp;&amp;</span>
<a href="#l21.176"></a><span id="l21.176"> #ifdef MIME_DETAIL_CHECK</span>
<a href="#l21.177"></a><span id="l21.177">            !mime_typep(kid,(MimeObjectClass*)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l21.178"></a><span id="l21.178">            !mime_typep(kid,(MimeObjectClass*)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l21.179"></a><span id="l21.179" class="difflineminus">-           !mime_typep(kid,(MimeObjectClass*)&amp;mimeMultipartSignedClass) </span>
<a href="#l21.180"></a><span id="l21.180" class="difflineplus">+           !mime_typep(kid,(MimeObjectClass*)&amp;mimeMultipartSignedClass)</span>
<a href="#l21.181"></a><span id="l21.181"> #else</span>
<a href="#l21.182"></a><span id="l21.182">                    /* bug 21869 -- due to the fact that we are not generating the</span>
<a href="#l21.183"></a><span id="l21.183">                       correct mime class object for content-typ multipart/signed part</span>
<a href="#l21.184"></a><span id="l21.184">                       the above check failed. to solve the problem in general and not</span>
<a href="#l21.185"></a><span id="l21.185">                       to cause early temination when parsing message for opening as</span>
<a href="#l21.186"></a><span id="l21.186">                       draft we can simply make sure that the child is not a multipart</span>
<a href="#l21.187"></a><span id="l21.187">                       mime object. this way we could have a proper decomposing message</span>
<a href="#l21.188"></a><span id="l21.188">                       part functions set correctly */</span>
<a href="#l21.189"></a><span id="l21.189" class="difflineat">@@ -601,18 +601,18 @@ MimeMultipart_parse_child_line (MimeObje</span>
<a href="#l21.190"></a><span id="l21.190"> </span>
<a href="#l21.191"></a><span id="l21.191">   kid = cont-&gt;children[cont-&gt;nchildren-1];</span>
<a href="#l21.192"></a><span id="l21.192">   PR_ASSERT(kid);</span>
<a href="#l21.193"></a><span id="l21.193">   if (!kid) return -1;</span>
<a href="#l21.194"></a><span id="l21.194"> </span>
<a href="#l21.195"></a><span id="l21.195"> #ifdef MIME_DRAFTS</span>
<a href="#l21.196"></a><span id="l21.196">   if ( obj-&gt;options &amp;&amp;</span>
<a href="#l21.197"></a><span id="l21.197">      obj-&gt;options-&gt;decompose_file_p &amp;&amp;</span>
<a href="#l21.198"></a><span id="l21.198" class="difflineminus">-     obj-&gt;options-&gt;is_multipart_msg &amp;&amp; </span>
<a href="#l21.199"></a><span id="l21.199" class="difflineminus">-     obj-&gt;options-&gt;decompose_file_output_fn ) </span>
<a href="#l21.200"></a><span id="l21.200" class="difflineplus">+     obj-&gt;options-&gt;is_multipart_msg &amp;&amp;</span>
<a href="#l21.201"></a><span id="l21.201" class="difflineplus">+     obj-&gt;options-&gt;decompose_file_output_fn )</span>
<a href="#l21.202"></a><span id="l21.202">   {</span>
<a href="#l21.203"></a><span id="l21.203">   if (!mime_typep(obj,(MimeObjectClass*)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l21.204"></a><span id="l21.204">     !mime_typep(obj,(MimeObjectClass*)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l21.205"></a><span id="l21.205">     !mime_typep(obj,(MimeObjectClass*)&amp;mimeMultipartSignedClass) &amp;&amp;</span>
<a href="#l21.206"></a><span id="l21.206"> #ifdef MIME_DETAIL_CHECK</span>
<a href="#l21.207"></a><span id="l21.207">     !mime_typep(kid,(MimeObjectClass*)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l21.208"></a><span id="l21.208">     !mime_typep(kid,(MimeObjectClass*)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l21.209"></a><span id="l21.209">     !mime_typep(kid,(MimeObjectClass*)&amp;mimeMultipartSignedClass)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/mime/src/mimetext.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/mime/src/mimetext.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l22.4"></a><span id="l22.4"> /* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l22.5"></a><span id="l22.5">  *</span>
<a href="#l22.6"></a><span id="l22.6">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.7"></a><span id="l22.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.8"></a><span id="l22.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineminus">- * This Original Code has been modified by IBM Corporation. Modifications made by IBM </span>
<a href="#l22.10"></a><span id="l22.10" class="difflineplus">+ * This Original Code has been modified by IBM Corporation. Modifications made by IBM</span>
<a href="#l22.11"></a><span id="l22.11">  * described herein are Copyright (c) International Business Machines Corporation, 2000.</span>
<a href="#l22.12"></a><span id="l22.12">  * Modifications to Mozilla code or documentation identified per MPL Section 3.3</span>
<a href="#l22.13"></a><span id="l22.13">  *</span>
<a href="#l22.14"></a><span id="l22.14">  * Date             Modified by     Description of modification</span>
<a href="#l22.15"></a><span id="l22.15">  * 04/20/2000       IBM Corp.      OS/2 VisualAge build.</span>
<a href="#l22.16"></a><span id="l22.16">  */</span>
<a href="#l22.17"></a><span id="l22.17"> #include &quot;mimetext.h&quot;</span>
<a href="#l22.18"></a><span id="l22.18"> #include &quot;mimebuf.h&quot;</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineat">@@ -70,17 +70,17 @@ MimeInlineText_initialize (MimeObject *o</span>
<a href="#l22.20"></a><span id="l22.20"> }</span>
<a href="#l22.21"></a><span id="l22.21"> </span>
<a href="#l22.22"></a><span id="l22.22"> static int MimeInlineText_initializeCharset(MimeObject *obj)</span>
<a href="#l22.23"></a><span id="l22.23"> {</span>
<a href="#l22.24"></a><span id="l22.24">   MimeInlineText  *text = (MimeInlineText *) obj;</span>
<a href="#l22.25"></a><span id="l22.25"> </span>
<a href="#l22.26"></a><span id="l22.26">   text-&gt;inputAutodetect = false;</span>
<a href="#l22.27"></a><span id="l22.27">   text-&gt;charsetOverridable = false;</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineminus">-  </span>
<a href="#l22.29"></a><span id="l22.29" class="difflineplus">+</span>
<a href="#l22.30"></a><span id="l22.30">   /* Figure out an appropriate charset for this object.</span>
<a href="#l22.31"></a><span id="l22.31">   */</span>
<a href="#l22.32"></a><span id="l22.32">   if (!text-&gt;charset &amp;&amp; obj-&gt;headers)</span>
<a href="#l22.33"></a><span id="l22.33">   {</span>
<a href="#l22.34"></a><span id="l22.34">     if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;override_charset)</span>
<a href="#l22.35"></a><span id="l22.35">     {</span>
<a href="#l22.36"></a><span id="l22.36">       text-&gt;charset = strdup(obj-&gt;options-&gt;default_charset);</span>
<a href="#l22.37"></a><span id="l22.37">     }</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineat">@@ -88,17 +88,17 @@ static int MimeInlineText_initializeChar</span>
<a href="#l22.39"></a><span id="l22.39">     {</span>
<a href="#l22.40"></a><span id="l22.40">       char *ct = MimeHeaders_get (obj-&gt;headers, HEADER_CONTENT_TYPE,</span>
<a href="#l22.41"></a><span id="l22.41">                                   false, false);</span>
<a href="#l22.42"></a><span id="l22.42">       if (ct)</span>
<a href="#l22.43"></a><span id="l22.43">       {</span>
<a href="#l22.44"></a><span id="l22.44">         text-&gt;charset = MimeHeaders_get_parameter (ct, &quot;charset&quot;, NULL, NULL);</span>
<a href="#l22.45"></a><span id="l22.45">         PR_Free(ct);</span>
<a href="#l22.46"></a><span id="l22.46">       }</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineminus">-    </span>
<a href="#l22.48"></a><span id="l22.48" class="difflineplus">+</span>
<a href="#l22.49"></a><span id="l22.49">       if (!text-&gt;charset)</span>
<a href="#l22.50"></a><span id="l22.50">       {</span>
<a href="#l22.51"></a><span id="l22.51">         /* If we didn't find &quot;Content-Type: ...; charset=XX&quot; then look</span>
<a href="#l22.52"></a><span id="l22.52">            for &quot;X-Sun-Charset: XX&quot; instead.  (Maybe this should be done</span>
<a href="#l22.53"></a><span id="l22.53">            in MimeSunAttachmentClass, but it's harder there than here.)</span>
<a href="#l22.54"></a><span id="l22.54">          */</span>
<a href="#l22.55"></a><span id="l22.55">         text-&gt;charset = MimeHeaders_get (obj-&gt;headers,</span>
<a href="#l22.56"></a><span id="l22.56">                                           HEADER_X_SUN_CHARSET,</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineat">@@ -114,46 +114,46 @@ static int MimeInlineText_initializeChar</span>
<a href="#l22.58"></a><span id="l22.58">       if (!text-&gt;charset &amp;&amp;</span>
<a href="#l22.59"></a><span id="l22.59">           obj-&gt;content_type &amp;&amp;</span>
<a href="#l22.60"></a><span id="l22.60">           !PL_strcasecmp(obj-&gt;content_type, TEXT_CALENDAR))</span>
<a href="#l22.61"></a><span id="l22.61">         text-&gt;charset = strdup(&quot;UTF-8&quot;);</span>
<a href="#l22.62"></a><span id="l22.62"> </span>
<a href="#l22.63"></a><span id="l22.63">       if (!text-&gt;charset)</span>
<a href="#l22.64"></a><span id="l22.64">       {</span>
<a href="#l22.65"></a><span id="l22.65">         nsresult res;</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineminus">-        </span>
<a href="#l22.67"></a><span id="l22.67" class="difflineplus">+</span>
<a href="#l22.68"></a><span id="l22.68">         text-&gt;charsetOverridable = true;</span>
<a href="#l22.69"></a><span id="l22.69"> </span>
<a href="#l22.70"></a><span id="l22.70" class="difflineminus">-        nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;res)); </span>
<a href="#l22.71"></a><span id="l22.71" class="difflineplus">+        nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;res));</span>
<a href="#l22.72"></a><span id="l22.72">         if (NS_SUCCEEDED(res))</span>
<a href="#l22.73"></a><span id="l22.73">         {</span>
<a href="#l22.74"></a><span id="l22.74">           nsCOMPtr&lt;nsIPrefLocalizedString&gt; str;</span>
<a href="#l22.75"></a><span id="l22.75">           if (NS_SUCCEEDED(prefBranch-&gt;GetComplexValue(&quot;intl.charset.detector&quot;, NS_GET_IID(nsIPrefLocalizedString), getter_AddRefs(str)))) {</span>
<a href="#l22.76"></a><span id="l22.76">             //only if we can get autodetector name correctly, do we set this to true</span>
<a href="#l22.77"></a><span id="l22.77">             text-&gt;inputAutodetect = true;</span>
<a href="#l22.78"></a><span id="l22.78">           }</span>
<a href="#l22.79"></a><span id="l22.79">         }</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineminus">-        </span>
<a href="#l22.81"></a><span id="l22.81" class="difflineplus">+</span>
<a href="#l22.82"></a><span id="l22.82">         if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;default_charset)</span>
<a href="#l22.83"></a><span id="l22.83">           text-&gt;charset = strdup(obj-&gt;options-&gt;default_charset);</span>
<a href="#l22.84"></a><span id="l22.84">         else</span>
<a href="#l22.85"></a><span id="l22.85">         {</span>
<a href="#l22.86"></a><span id="l22.86">           if (NS_SUCCEEDED(res))</span>
<a href="#l22.87"></a><span id="l22.87">           {</span>
<a href="#l22.88"></a><span id="l22.88">             nsString value;</span>
<a href="#l22.89"></a><span id="l22.89">             NS_GetLocalizedUnicharPreferenceWithDefault(prefBranch, &quot;mailnews.view_default_charset&quot;, EmptyString(), value);</span>
<a href="#l22.90"></a><span id="l22.90">             text-&gt;charset = ToNewUTF8String(value);</span>
<a href="#l22.91"></a><span id="l22.91">           }</span>
<a href="#l22.92"></a><span id="l22.92">           else</span>
<a href="#l22.93"></a><span id="l22.93">             text-&gt;charset = strdup(&quot;&quot;);</span>
<a href="#l22.94"></a><span id="l22.94">         }</span>
<a href="#l22.95"></a><span id="l22.95" class="difflineminus">-      } </span>
<a href="#l22.96"></a><span id="l22.96" class="difflineplus">+      }</span>
<a href="#l22.97"></a><span id="l22.97">     }</span>
<a href="#l22.98"></a><span id="l22.98">   }</span>
<a href="#l22.99"></a><span id="l22.99" class="difflineminus">-  </span>
<a href="#l22.100"></a><span id="l22.100" class="difflineplus">+</span>
<a href="#l22.101"></a><span id="l22.101">   if (text-&gt;inputAutodetect)</span>
<a href="#l22.102"></a><span id="l22.102">   {</span>
<a href="#l22.103"></a><span id="l22.103">     //we need to prepare lineDam for charset detection</span>
<a href="#l22.104"></a><span id="l22.104">     text-&gt;lineDamBuffer = (char*)PR_Malloc(DAM_MAX_BUFFER_SIZE);</span>
<a href="#l22.105"></a><span id="l22.105">     text-&gt;lineDamPtrs = (char**)PR_Malloc(DAM_MAX_LINES*sizeof(char*));</span>
<a href="#l22.106"></a><span id="l22.106">     text-&gt;curDamOffset = 0;</span>
<a href="#l22.107"></a><span id="l22.107">     text-&gt;lastLineInDam = 0;</span>
<a href="#l22.108"></a><span id="l22.108">     if (!text-&gt;lineDamBuffer || !text-&gt;lineDamPtrs)</span>
<a href="#l22.109"></a><span id="l22.109" class="difflineat">@@ -230,17 +230,17 @@ MimeInlineText_parse_eof (MimeObject *ob</span>
<a href="#l22.110"></a><span id="l22.110">       obj-&gt;closed_p = true;</span>
<a href="#l22.111"></a><span id="l22.111">       return status;</span>
<a href="#l22.112"></a><span id="l22.112">     }</span>
<a href="#l22.113"></a><span id="l22.113">   }</span>
<a href="#l22.114"></a><span id="l22.114"> </span>
<a href="#l22.115"></a><span id="l22.115">   //we haven't find charset yet? now its the time</span>
<a href="#l22.116"></a><span id="l22.116">   if (text-&gt;inputAutodetect)</span>
<a href="#l22.117"></a><span id="l22.117">      status = MimeInlineText_open_dam(nullptr, 0, obj);</span>
<a href="#l22.118"></a><span id="l22.118" class="difflineminus">- </span>
<a href="#l22.119"></a><span id="l22.119" class="difflineplus">+</span>
<a href="#l22.120"></a><span id="l22.120">   return ((MimeObjectClass*)&amp;MIME_SUPERCLASS)-&gt;parse_eof (obj, abort_p);</span>
<a href="#l22.121"></a><span id="l22.121"> }</span>
<a href="#l22.122"></a><span id="l22.122"> </span>
<a href="#l22.123"></a><span id="l22.123"> static int</span>
<a href="#l22.124"></a><span id="l22.124"> MimeInlineText_parse_end (MimeObject *obj, bool abort_p)</span>
<a href="#l22.125"></a><span id="l22.125"> {</span>
<a href="#l22.126"></a><span id="l22.126">   MimeInlineText *text = (MimeInlineText *) obj;</span>
<a href="#l22.127"></a><span id="l22.127"> </span>
<a href="#l22.128"></a><span id="l22.128" class="difflineat">@@ -326,30 +326,30 @@ MimeInlineText_parse_decoded_buffer (con</span>
<a href="#l22.129"></a><span id="l22.129"> </span>
<a href="#l22.130"></a><span id="l22.130"> </span>
<a href="#l22.131"></a><span id="l22.131"> #define MimeInlineText_grow_cbuffer(text, desired_size) \</span>
<a href="#l22.132"></a><span id="l22.132">   (((desired_size) &gt;= (text)-&gt;cbuffer_size) ? \</span>
<a href="#l22.133"></a><span id="l22.133">    mime_GrowBuffer ((desired_size), sizeof(char), 100, \</span>
<a href="#l22.134"></a><span id="l22.134">            &amp;(text)-&gt;cbuffer, &amp;(text)-&gt;cbuffer_size) \</span>
<a href="#l22.135"></a><span id="l22.135">    : 0)</span>
<a href="#l22.136"></a><span id="l22.136"> </span>
<a href="#l22.137"></a><span id="l22.137" class="difflineminus">-static int </span>
<a href="#l22.138"></a><span id="l22.138" class="difflineplus">+static int</span>
<a href="#l22.139"></a><span id="l22.139"> MimeInlineText_convert_and_parse_line(char *line, int32_t length, MimeObject *obj)</span>
<a href="#l22.140"></a><span id="l22.140"> {</span>
<a href="#l22.141"></a><span id="l22.141">   int status;</span>
<a href="#l22.142"></a><span id="l22.142">   nsAutoCString converted;</span>
<a href="#l22.143"></a><span id="l22.143" class="difflineminus">-  </span>
<a href="#l22.144"></a><span id="l22.144" class="difflineplus">+</span>
<a href="#l22.145"></a><span id="l22.145">   MimeInlineText *text = (MimeInlineText *) obj;</span>
<a href="#l22.146"></a><span id="l22.146"> </span>
<a href="#l22.147"></a><span id="l22.147">   //in case of charset autodetection, charset can be override by meta charset</span>
<a href="#l22.148"></a><span id="l22.148">   if (text-&gt;charsetOverridable) {</span>
<a href="#l22.149"></a><span id="l22.149">     if (mime_typep(obj, (MimeObjectClass *) &amp;mimeInlineTextHTMLClass))</span>
<a href="#l22.150"></a><span id="l22.150">     {</span>
<a href="#l22.151"></a><span id="l22.151">       MimeInlineTextHTML  *textHTML = (MimeInlineTextHTML *) obj;</span>
<a href="#l22.152"></a><span id="l22.152" class="difflineminus">-      if (textHTML-&gt;charset &amp;&amp; </span>
<a href="#l22.153"></a><span id="l22.153" class="difflineplus">+      if (textHTML-&gt;charset &amp;&amp;</span>
<a href="#l22.154"></a><span id="l22.154">           *textHTML-&gt;charset &amp;&amp;</span>
<a href="#l22.155"></a><span id="l22.155">           strcmp(textHTML-&gt;charset, text-&gt;charset))</span>
<a href="#l22.156"></a><span id="l22.156">       {</span>
<a href="#l22.157"></a><span id="l22.157">         //if meta tag specified charset is different from our detected result, use meta charset.</span>
<a href="#l22.158"></a><span id="l22.158">         //but we don't want to redo previous lines</span>
<a href="#l22.159"></a><span id="l22.159">         PR_FREEIF(text-&gt;charset);</span>
<a href="#l22.160"></a><span id="l22.160">         text-&gt;charset = strdup(textHTML-&gt;charset);</span>
<a href="#l22.161"></a><span id="l22.161"> </span>
<a href="#l22.162"></a><span id="l22.162" class="difflineat">@@ -373,35 +373,35 @@ MimeInlineText_convert_and_parse_line(ch</span>
<a href="#l22.163"></a><span id="l22.163"> </span>
<a href="#l22.164"></a><span id="l22.164">   /* Now that the line has been converted, call the subclass's parse_line</span>
<a href="#l22.165"></a><span id="l22.165">    method with the decoded data. */</span>
<a href="#l22.166"></a><span id="l22.166">   status = obj-&gt;clazz-&gt;parse_line(line, length, obj);</span>
<a href="#l22.167"></a><span id="l22.167"> </span>
<a href="#l22.168"></a><span id="l22.168">   return status;</span>
<a href="#l22.169"></a><span id="l22.169"> }</span>
<a href="#l22.170"></a><span id="l22.170"> </span>
<a href="#l22.171"></a><span id="l22.171" class="difflineminus">-//In this function call, all buffered lines in lineDam will be sent to charset detector </span>
<a href="#l22.172"></a><span id="l22.172" class="difflineplus">+//In this function call, all buffered lines in lineDam will be sent to charset detector</span>
<a href="#l22.173"></a><span id="l22.173"> // and a charset will be used to parse all those line and following lines in this mime obj.</span>
<a href="#l22.174"></a><span id="l22.174" class="difflineminus">-static int </span>
<a href="#l22.175"></a><span id="l22.175" class="difflineplus">+static int</span>
<a href="#l22.176"></a><span id="l22.176"> MimeInlineText_open_dam(char *line, int32_t length, MimeObject *obj)</span>
<a href="#l22.177"></a><span id="l22.177"> {</span>
<a href="#l22.178"></a><span id="l22.178">   MimeInlineText *text = (MimeInlineText *) obj;</span>
<a href="#l22.179"></a><span id="l22.179">   const char* detectedCharset = nullptr;</span>
<a href="#l22.180"></a><span id="l22.180">   nsresult res = NS_OK;</span>
<a href="#l22.181"></a><span id="l22.181">   int status = 0;</span>
<a href="#l22.182"></a><span id="l22.182">   int32_t i;</span>
<a href="#l22.183"></a><span id="l22.183"> </span>
<a href="#l22.184"></a><span id="l22.184">   if (text-&gt;curDamOffset &lt;= 0) {</span>
<a href="#l22.185"></a><span id="l22.185">     //there is nothing in dam, use current line for detection</span>
<a href="#l22.186"></a><span id="l22.186">     if (length &gt; 0) {</span>
<a href="#l22.187"></a><span id="l22.187" class="difflineminus">-      res = MIME_detect_charset(line, length, &amp;detectedCharset);  </span>
<a href="#l22.188"></a><span id="l22.188" class="difflineplus">+      res = MIME_detect_charset(line, length, &amp;detectedCharset);</span>
<a href="#l22.189"></a><span id="l22.189">     }</span>
<a href="#l22.190"></a><span id="l22.190">   } else {</span>
<a href="#l22.191"></a><span id="l22.191" class="difflineminus">-    //we have stuff in dam, use the one </span>
<a href="#l22.192"></a><span id="l22.192" class="difflineminus">-    res = MIME_detect_charset(text-&gt;lineDamBuffer, text-&gt;curDamOffset, &amp;detectedCharset);  </span>
<a href="#l22.193"></a><span id="l22.193" class="difflineplus">+    //we have stuff in dam, use the one</span>
<a href="#l22.194"></a><span id="l22.194" class="difflineplus">+    res = MIME_detect_charset(text-&gt;lineDamBuffer, text-&gt;curDamOffset, &amp;detectedCharset);</span>
<a href="#l22.195"></a><span id="l22.195">   }</span>
<a href="#l22.196"></a><span id="l22.196"> </span>
<a href="#l22.197"></a><span id="l22.197">   //set the charset for this obj</span>
<a href="#l22.198"></a><span id="l22.198">   if (NS_SUCCEEDED(res) &amp;&amp; detectedCharset &amp;&amp; *detectedCharset)  {</span>
<a href="#l22.199"></a><span id="l22.199">     PR_FREEIF(text-&gt;charset);</span>
<a href="#l22.200"></a><span id="l22.200">     text-&gt;charset = strdup(detectedCharset);</span>
<a href="#l22.201"></a><span id="l22.201"> </span>
<a href="#l22.202"></a><span id="l22.202">     //update MsgWindow charset if we are instructed to do so</span>
<a href="#l22.203"></a><span id="l22.203" class="difflineat">@@ -409,17 +409,17 @@ MimeInlineText_open_dam(char *line, int3</span>
<a href="#l22.204"></a><span id="l22.204">       SetMailCharacterSetToMsgWindow(obj, text-&gt;charset);</span>
<a href="#l22.205"></a><span id="l22.205">   }</span>
<a href="#l22.206"></a><span id="l22.206"> </span>
<a href="#l22.207"></a><span id="l22.207">   //process dam and line using the charset</span>
<a href="#l22.208"></a><span id="l22.208">   if (text-&gt;curDamOffset) {</span>
<a href="#l22.209"></a><span id="l22.209">     for (i = 0; i &lt; text-&gt;lastLineInDam-1; i++)</span>
<a href="#l22.210"></a><span id="l22.210">     {</span>
<a href="#l22.211"></a><span id="l22.211">       status = MimeInlineText_convert_and_parse_line(</span>
<a href="#l22.212"></a><span id="l22.212" class="difflineminus">-                text-&gt;lineDamPtrs[i],  </span>
<a href="#l22.213"></a><span id="l22.213" class="difflineplus">+                text-&gt;lineDamPtrs[i],</span>
<a href="#l22.214"></a><span id="l22.214">                 text-&gt;lineDamPtrs[i+1] - text-&gt;lineDamPtrs[i],</span>
<a href="#l22.215"></a><span id="l22.215">                 obj  );</span>
<a href="#l22.216"></a><span id="l22.216">     }</span>
<a href="#l22.217"></a><span id="l22.217">     status = MimeInlineText_convert_and_parse_line(</span>
<a href="#l22.218"></a><span id="l22.218">                 text-&gt;lineDamPtrs[i],</span>
<a href="#l22.219"></a><span id="l22.219">                 text-&gt;lineDamBuffer + text-&gt;curDamOffset - text-&gt;lineDamPtrs[i],</span>
<a href="#l22.220"></a><span id="l22.220">                 obj );</span>
<a href="#l22.221"></a><span id="l22.221">   }</span>
<a href="#l22.222"></a><span id="l22.222" class="difflineat">@@ -458,21 +458,21 @@ MimeInlineText_rotate_convert_and_parse_</span>
<a href="#l22.223"></a><span id="l22.223">   // Now convert to the canonical charset, if desired.</span>
<a href="#l22.224"></a><span id="l22.224">   //</span>
<a href="#l22.225"></a><span id="l22.225">   bool    doConvert = true;</span>
<a href="#l22.226"></a><span id="l22.226">   // Don't convert vCard data</span>
<a href="#l22.227"></a><span id="l22.227">   if ( ( (obj-&gt;content_type) &amp;&amp; (!PL_strcasecmp(obj-&gt;content_type, TEXT_VCARD)) ) ||</span>
<a href="#l22.228"></a><span id="l22.228">        (obj-&gt;options-&gt;format_out == nsMimeOutput::nsMimeMessageSaveAs)</span>
<a href="#l22.229"></a><span id="l22.229">        || obj-&gt;options-&gt;format_out == nsMimeOutput::nsMimeMessageAttach)</span>
<a href="#l22.230"></a><span id="l22.230">     doConvert = false;</span>
<a href="#l22.231"></a><span id="l22.231" class="difflineminus">-    </span>
<a href="#l22.232"></a><span id="l22.232" class="difflineminus">-  // Only convert if the user prefs is false </span>
<a href="#l22.233"></a><span id="l22.233" class="difflineplus">+</span>
<a href="#l22.234"></a><span id="l22.234" class="difflineplus">+  // Only convert if the user prefs is false</span>
<a href="#l22.235"></a><span id="l22.235">   if ( (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;charset_conversion_fn) &amp;&amp;</span>
<a href="#l22.236"></a><span id="l22.236">        (!obj-&gt;options-&gt;force_user_charset) &amp;&amp;</span>
<a href="#l22.237"></a><span id="l22.237" class="difflineminus">-       (doConvert)       </span>
<a href="#l22.238"></a><span id="l22.238" class="difflineplus">+       (doConvert)</span>
<a href="#l22.239"></a><span id="l22.239">      )</span>
<a href="#l22.240"></a><span id="l22.240">   {</span>
<a href="#l22.241"></a><span id="l22.241">     MimeInlineText  *text = (MimeInlineText *) obj;</span>
<a href="#l22.242"></a><span id="l22.242"> </span>
<a href="#l22.243"></a><span id="l22.243">     if (!text-&gt;initializeCharset)</span>
<a href="#l22.244"></a><span id="l22.244">     {</span>
<a href="#l22.245"></a><span id="l22.245">       MimeInlineText_initializeCharset(obj);</span>
<a href="#l22.246"></a><span id="l22.246">       //update MsgWindow charset if we are instructed to do so</span>
<a href="#l22.247"></a><span id="l22.247" class="difflineat">@@ -482,28 +482,28 @@ MimeInlineText_rotate_convert_and_parse_</span>
<a href="#l22.248"></a><span id="l22.248"> </span>
<a href="#l22.249"></a><span id="l22.249">     //if autodetect is on, push line to dam</span>
<a href="#l22.250"></a><span id="l22.250">     if (text-&gt;inputAutodetect)</span>
<a href="#l22.251"></a><span id="l22.251">     {</span>
<a href="#l22.252"></a><span id="l22.252">       //see if we reach the lineDam buffer limit, if so, there is no need to keep buffering</span>
<a href="#l22.253"></a><span id="l22.253">       if (text-&gt;lastLineInDam &gt;= DAM_MAX_LINES ||</span>
<a href="#l22.254"></a><span id="l22.254">           DAM_MAX_BUFFER_SIZE - text-&gt;curDamOffset &lt;= length) {</span>
<a href="#l22.255"></a><span id="l22.255">         //we let open dam process this line as well as thing that already in Dam</span>
<a href="#l22.256"></a><span id="l22.256" class="difflineminus">-        //In case there is nothing in dam because this line is too big, we need to </span>
<a href="#l22.257"></a><span id="l22.257" class="difflineplus">+        //In case there is nothing in dam because this line is too big, we need to</span>
<a href="#l22.258"></a><span id="l22.258">         //perform autodetect on this line</span>
<a href="#l22.259"></a><span id="l22.259">         status = MimeInlineText_open_dam(line, length, obj);</span>
<a href="#l22.260"></a><span id="l22.260">       }</span>
<a href="#l22.261"></a><span id="l22.261">       else {</span>
<a href="#l22.262"></a><span id="l22.262">         //buffering current line</span>
<a href="#l22.263"></a><span id="l22.263">         text-&gt;lineDamPtrs[text-&gt;lastLineInDam] = text-&gt;lineDamBuffer + text-&gt;curDamOffset;</span>
<a href="#l22.264"></a><span id="l22.264">         memcpy(text-&gt;lineDamPtrs[text-&gt;lastLineInDam], line, length);</span>
<a href="#l22.265"></a><span id="l22.265">         text-&gt;lastLineInDam++;</span>
<a href="#l22.266"></a><span id="l22.266">         text-&gt;curDamOffset += length;</span>
<a href="#l22.267"></a><span id="l22.267">       }</span>
<a href="#l22.268"></a><span id="l22.268">     }</span>
<a href="#l22.269"></a><span id="l22.269" class="difflineminus">-    else </span>
<a href="#l22.270"></a><span id="l22.270" class="difflineplus">+    else</span>
<a href="#l22.271"></a><span id="l22.271">       status = MimeInlineText_convert_and_parse_line(line, length, obj);</span>
<a href="#l22.272"></a><span id="l22.272">   }</span>
<a href="#l22.273"></a><span id="l22.273">   else</span>
<a href="#l22.274"></a><span id="l22.274">     status = obj-&gt;clazz-&gt;parse_line(line, length, obj);</span>
<a href="#l22.275"></a><span id="l22.275"> </span>
<a href="#l22.276"></a><span id="l22.276">   return status;</span>
<a href="#l22.277"></a><span id="l22.277"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/mime/src/mimetpfl.h</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpfl.h</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -7,17 +7,17 @@</span>
<a href="#l23.4"></a><span id="l23.4"> #define _MIMETPFL_H_</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6"> #include &quot;mimetext.h&quot;</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8"> /* The MimeInlineTextPlainFlowed class implements the</span>
<a href="#l23.9"></a><span id="l23.9">    text/plain MIME content type for the special case of a supplied</span>
<a href="#l23.10"></a><span id="l23.10">    format=flowed. See</span>
<a href="#l23.11"></a><span id="l23.11">    ftp://ftp.ietf.org/internet-drafts/draft-gellens-format-06.txt for</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-   more information. </span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+   more information.</span>
<a href="#l23.14"></a><span id="l23.14">  */</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16"> typedef struct MimeInlineTextPlainFlowedClass MimeInlineTextPlainFlowedClass;</span>
<a href="#l23.17"></a><span id="l23.17"> typedef struct MimeInlineTextPlainFlowed      MimeInlineTextPlainFlowed;</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19"> struct MimeInlineTextPlainFlowedClass {</span>
<a href="#l23.20"></a><span id="l23.20">   MimeInlineTextClass text;</span>
<a href="#l23.21"></a><span id="l23.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/mime/src/mimetric.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/mime/src/mimetric.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -71,17 +71,17 @@ MimeRichtextConvert (const char *line, i</span>
<a href="#l24.4"></a><span id="l24.4">   unsigned int desired_size;</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6">   // The code below must never expand the input by more than 5x;</span>
<a href="#l24.7"></a><span id="l24.7">   // if it does, the desired_size multiplier (5) below must be changed too</span>
<a href="#l24.8"></a><span id="l24.8"> #define BGROWTH 5</span>
<a href="#l24.9"></a><span id="l24.9">   if ( (uint32_t)length &gt;= ( (uint32_t) 0xfffffffe)/BGROWTH )</span>
<a href="#l24.10"></a><span id="l24.10">       return -1;</span>
<a href="#l24.11"></a><span id="l24.11">   desired_size = (length * BGROWTH) + 1;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-#undef BGROWTH  </span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+#undef BGROWTH</span>
<a href="#l24.14"></a><span id="l24.14">   if (desired_size &gt;= (uint32_t) *obuffer_sizeP)</span>
<a href="#l24.15"></a><span id="l24.15">   status = mime_GrowBuffer (desired_size, sizeof(char), 1024,</span>
<a href="#l24.16"></a><span id="l24.16">                obufferP, obuffer_sizeP);</span>
<a href="#l24.17"></a><span id="l24.17">   if (status &lt; 0) return status;</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19">   if (enriched_p)</span>
<a href="#l24.20"></a><span id="l24.20">   {</span>
<a href="#l24.21"></a><span id="l24.21">     for (this_start = line; this_start &lt; line + length; this_start++)</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -133,36 +133,36 @@ MimeRichtextConvert (const char *line, i</span>
<a href="#l24.23"></a><span id="l24.23">       *out = 0;</span>
<a href="#l24.24"></a><span id="l24.24">       outlen -= (this_start - last_end);</span>
<a href="#l24.25"></a><span id="l24.25">     }</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27">     if (this_start &gt;= data_end)</span>
<a href="#l24.28"></a><span id="l24.28">     break;</span>
<a href="#l24.29"></a><span id="l24.29">     else if (*this_start == '&amp;')</span>
<a href="#l24.30"></a><span id="l24.30">     {</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-      PL_strncpyz (out, &quot;&amp;amp;&quot;, outlen); </span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+      PL_strncpyz (out, &quot;&amp;amp;&quot;, outlen);</span>
<a href="#l24.33"></a><span id="l24.33">       addedlen = strlen(out);</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-      outlen -= addedlen; </span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+      outlen -= addedlen;</span>
<a href="#l24.36"></a><span id="l24.36">       out += addedlen;</span>
<a href="#l24.37"></a><span id="l24.37">     }</span>
<a href="#l24.38"></a><span id="l24.38">     else if (*this_start == '&gt;')</span>
<a href="#l24.39"></a><span id="l24.39">     {</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-      PL_strncpyz (out, &quot;&amp;gt;&quot;, outlen); </span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-      addedlen = strlen(out); </span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-      outlen -= addedlen; </span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+      PL_strncpyz (out, &quot;&amp;gt;&quot;, outlen);</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+      addedlen = strlen(out);</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+      outlen -= addedlen;</span>
<a href="#l24.46"></a><span id="l24.46">       out += addedlen;</span>
<a href="#l24.47"></a><span id="l24.47">     }</span>
<a href="#l24.48"></a><span id="l24.48">     else if (enriched_p &amp;&amp;</span>
<a href="#l24.49"></a><span id="l24.49">          this_start &lt; data_end + 1 &amp;&amp;</span>
<a href="#l24.50"></a><span id="l24.50">          this_start[0] == '&lt;' &amp;&amp;</span>
<a href="#l24.51"></a><span id="l24.51">          this_start[1] == '&lt;')</span>
<a href="#l24.52"></a><span id="l24.52">     {</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-      PL_strncpyz (out, &quot;&amp;lt;&quot;, outlen); </span>
<a href="#l24.54"></a><span id="l24.54" class="difflineminus">-      addedlen = strlen(out); </span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-      outlen -= addedlen; </span>
<a href="#l24.56"></a><span id="l24.56" class="difflineplus">+      PL_strncpyz (out, &quot;&amp;lt;&quot;, outlen);</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+      addedlen = strlen(out);</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+      outlen -= addedlen;</span>
<a href="#l24.59"></a><span id="l24.59">       out += addedlen;</span>
<a href="#l24.60"></a><span id="l24.60">     }</span>
<a href="#l24.61"></a><span id="l24.61">     else if (this_start != this_end)</span>
<a href="#l24.62"></a><span id="l24.62">     {</span>
<a href="#l24.63"></a><span id="l24.63">       /* Push out this ID. */</span>
<a href="#l24.64"></a><span id="l24.64">       const char *old = this_start + 1;</span>
<a href="#l24.65"></a><span id="l24.65">       const char *tag_open  = 0;</span>
<a href="#l24.66"></a><span id="l24.66">       const char *tag_close = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/mime/src/nsCMSSecureMessage.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/mime/src/nsCMSSecureMessage.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -208,17 +208,17 @@ SendMessage(const char *msg, const char </span>
<a href="#l25.4"></a><span id="l25.4">   /* Step 5. Add content to message */</span>
<a href="#l25.5"></a><span id="l25.5">   cinfo = NSS_CMSMessage_GetContentInfo(cmsMsg);</span>
<a href="#l25.6"></a><span id="l25.6">   s = NSS_CMSContentInfo_SetContent_EnvelopedData(cmsMsg, cinfo, env);</span>
<a href="#l25.7"></a><span id="l25.7">   if (s != SECSuccess) {</span>
<a href="#l25.8"></a><span id="l25.8">     MOZ_LOG(gPIPNSSLog, LogLevel::Debug, (&quot;nsCMSSecureMessage::SendMessage - can't set content enveloped data\n&quot;));</span>
<a href="#l25.9"></a><span id="l25.9">     rv = NS_ERROR_FAILURE;</span>
<a href="#l25.10"></a><span id="l25.10">     goto done;</span>
<a href="#l25.11"></a><span id="l25.11">   }</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  </span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+</span>
<a href="#l25.14"></a><span id="l25.14">   /* Step 6. Encode */</span>
<a href="#l25.15"></a><span id="l25.15">   NSSCMSEncoderContext *ecx;</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17">   output.data = 0; output.len = 0;</span>
<a href="#l25.18"></a><span id="l25.18">   ecx = NSS_CMSEncoder_Start(cmsMsg, 0, 0, &amp;output, arena,</span>
<a href="#l25.19"></a><span id="l25.19">             0, ctx, 0, 0, 0, 0);</span>
<a href="#l25.20"></a><span id="l25.20">   if (!ecx) {</span>
<a href="#l25.21"></a><span id="l25.21">     MOZ_LOG(gPIPNSSLog, LogLevel::Debug, (&quot;nsCMSSecureMessage::SendMessage - can't start cms encoder\n&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/mime/src/nsMimeObjectClassAccess.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/mime/src/nsMimeObjectClassAccess.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -12,17 +12,17 @@</span>
<a href="#l26.4"></a><span id="l26.4">  * query interface for our component.</span>
<a href="#l26.5"></a><span id="l26.5">  */</span>
<a href="#l26.6"></a><span id="l26.6"> NS_IMPL_ISUPPORTS(nsMimeObjectClassAccess, nsIMimeObjectClassAccess)</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> /*</span>
<a href="#l26.9"></a><span id="l26.9">  * nsMimeObjectClassAccess definitions....</span>
<a href="#l26.10"></a><span id="l26.10">  */</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-/* </span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+/*</span>
<a href="#l26.14"></a><span id="l26.14">  * Inherited methods for nsMimeObjectClassAccess</span>
<a href="#l26.15"></a><span id="l26.15">  */</span>
<a href="#l26.16"></a><span id="l26.16"> nsMimeObjectClassAccess::nsMimeObjectClassAccess()</span>
<a href="#l26.17"></a><span id="l26.17"> {</span>
<a href="#l26.18"></a><span id="l26.18"> }</span>
<a href="#l26.19"></a><span id="l26.19"> </span>
<a href="#l26.20"></a><span id="l26.20"> nsMimeObjectClassAccess::~nsMimeObjectClassAccess()</span>
<a href="#l26.21"></a><span id="l26.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -839,17 +839,17 @@ nsStreamConverter::SetOrigMsgHdr(nsIMsgD</span>
<a href="#l27.4"></a><span id="l27.4"> }</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6"> NS_IMETHODIMP</span>
<a href="#l27.7"></a><span id="l27.7"> nsStreamConverter::GetOrigMsgHdr(nsIMsgDBHdr * *aMsgHdr)</span>
<a href="#l27.8"></a><span id="l27.8"> {</span>
<a href="#l27.9"></a><span id="l27.9">   if (!aMsgHdr) return NS_ERROR_NULL_POINTER;</span>
<a href="#l27.10"></a><span id="l27.10">   NS_IF_ADDREF(*aMsgHdr = mOrigMsgHdr);</span>
<a href="#l27.11"></a><span id="l27.11">   return NS_OK;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-} </span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+}</span>
<a href="#l27.14"></a><span id="l27.14"> </span>
<a href="#l27.15"></a><span id="l27.15"> /////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.16"></a><span id="l27.16"> // Methods for nsIStreamListener...</span>
<a href="#l27.17"></a><span id="l27.17"> /////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.18"></a><span id="l27.18"> //</span>
<a href="#l27.19"></a><span id="l27.19"> // Notify the client that data is available in the input stream.  This</span>
<a href="#l27.20"></a><span id="l27.20"> // method is called whenver data is written into the input stream by the</span>
<a href="#l27.21"></a><span id="l27.21"> // networking library...</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

