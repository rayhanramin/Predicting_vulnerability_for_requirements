<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 15887:e67da9f094fffc87c30eb1e5b84b8d2145f168ef</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ e67da9f094fffc87c30eb1e5b84b8d2145f168ef" />
<meta property="og:url" content="/comm-central/rev/e67da9f094fffc87c30eb1e5b84b8d2145f168ef" />
<meta property="og:description" content="Fix up comm-central for bug 345123 and bug 967364." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / e67da9f094fffc87c30eb1e5b84b8d2145f168ef 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/e67da9f094fffc87c30eb1e5b84b8d2145f168ef">shortlog</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/e67da9f094fffc87c30eb1e5b84b8d2145f168ef">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef">files</a> |
changeset |
<a href="/comm-central/raw-rev/e67da9f094fffc87c30eb1e5b84b8d2145f168ef">raw</a>  | <a href="/comm-central/archive/e67da9f094fffc87c30eb1e5b84b8d2145f168ef.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix up comm-central for <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=345123">bug 345123</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=967364">bug 967364</a>.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#121;&#108;&#101;&#32;&#72;&#117;&#101;&#121;&#32;&#60;&#107;&#104;&#117;&#101;&#121;&#64;&#107;&#121;&#108;&#101;&#104;&#117;&#101;&#121;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 15 Mar 2014 17:41:46 -0700</td></tr>

<tr>
 <td>changeset 15887</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/e67da9f094fffc87c30eb1e5b84b8d2145f168ef">e67da9f094fffc87c30eb1e5b84b8d2145f168ef</a></td>
</tr>



<tr>
<td>parent 15886</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/393fbf5c28bf7e815844386e8f4646e869454604">393fbf5c28bf7e815844386e8f4646e869454604</a>
</td>
</tr>

<tr>
<td>child 15888</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3fca0bc24f73ce3187f16f13b5c9e354c35e88d5">3fca0bc24f73ce3187f16f13b5c9e354c35e88d5</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=e67da9f094fffc87c30eb1e5b84b8d2145f168ef">9961</a></td></tr>
<tr><td>push user</td><td>khuey@mozilla.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 16 Mar 2014 00:43:05 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@e67da9f094ff [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e67da9f094fffc87c30eb1e5b84b8d2145f168ef">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e67da9f094fffc87c30eb1e5b84b8d2145f168ef&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e67da9f094fffc87c30eb1e5b84b8d2145f168ef&newProject=comm-central&newRevision=e67da9f094fffc87c30eb1e5b84b8d2145f168ef&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e67da9f094fffc87c30eb1e5b84b8d2145f168ef&newProject=comm-central&newRevision=e67da9f094fffc87c30eb1e5b84b8d2145f168ef&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e67da9f094fffc87c30eb1e5b84b8d2145f168ef&newProject=comm-central&newRevision=e67da9f094fffc87c30eb1e5b84b8d2145f168ef&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=345123">345123</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=967364">967364</a></td></tr>




</table></div>

<div class="page_body description">Fix up comm-central for <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=345123">bug 345123</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=967364">bug 967364</a>.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/ldap/xpcom/src/nsLDAPService.cpp">ldap/xpcom/src/nsLDAPService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/ldap/xpcom/src/nsLDAPService.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/ldap/xpcom/src/nsLDAPService.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/ldap/xpcom/src/nsLDAPService.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/ldap/xpcom/src/nsLDAPService.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/ldap/xpcom/src/nsLDAPService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsEudoraProfileMigrator.cpp">mail/components/migration/src/nsEudoraProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsEudoraProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsEudoraProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsEudoraProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsEudoraProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsEudoraProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOEProfileMigrator.cpp">mail/components/migration/src/nsOEProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOEProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOEProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOEProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOEProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOEProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOutlookProfileMigrator.cpp">mail/components/migration/src/nsOutlookProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOutlookProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOutlookProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOutlookProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOutlookProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsOutlookProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsProfileMigratorBase.cpp">mail/components/migration/src/nsProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/migration/src/nsProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/search/nsMailWinSearchHelper.cpp">mail/components/search/nsMailWinSearchHelper.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/search/nsMailWinSearchHelper.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/search/nsMailWinSearchHelper.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/search/nsMailWinSearchHelper.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/search/nsMailWinSearchHelper.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mail/components/search/nsMailWinSearchHelper.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">mailnews/addrbook/src/nsAbOutlookDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAddbookUrl.cpp">mailnews/addrbook/src/nsAddbookUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAddbookUrl.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAddbookUrl.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAddbookUrl.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAddbookUrl.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/addrbook/src/nsAddbookUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/search/src/nsMsgFilterService.cpp">mailnews/base/search/src/nsMsgFilterService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/search/src/nsMsgFilterService.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/search/src/nsMsgFilterService.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/search/src/nsMsgFilterService.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/search/src/nsMsgFilterService.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/search/src/nsMsgFilterService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManagerDS.cpp">mailnews/base/src/nsMsgAccountManagerDS.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManagerDS.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManagerDS.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManagerDS.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManagerDS.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgAccountManagerDS.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgQuickSearchDBView.cpp">mailnews/base/src/nsMsgQuickSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgQuickSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgQuickSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgQuickSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgQuickSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgQuickSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsStatusBarBiffManager.cpp">mailnews/base/src/nsStatusBarBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsStatusBarBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsStatusBarBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsStatusBarBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsStatusBarBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/base/src/nsStatusBarBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/compose/src/nsSmtpUrl.cpp">mailnews/compose/src/nsSmtpUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/compose/src/nsSmtpUrl.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/compose/src/nsSmtpUrl.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/compose/src/nsSmtpUrl.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/compose/src/nsSmtpUrl.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/compose/src/nsSmtpUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">mailnews/db/msgdb/src/nsDBFolderInfo.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsNewsDatabase.cpp">mailnews/db/msgdb/src/nsNewsDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsNewsDatabase.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsNewsDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsNewsDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsNewsDatabase.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/db/msgdb/src/nsNewsDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/src/nsImportService.cpp">mailnews/import/src/nsImportService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/src/nsImportService.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/src/nsImportService.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/src/nsImportService.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/src/nsImportService.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/src/nsImportService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/winlivemail/nsWMUtils.cpp">mailnews/import/winlivemail/nsWMUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/winlivemail/nsWMUtils.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/winlivemail/nsWMUtils.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/winlivemail/nsWMUtils.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/winlivemail/nsWMUtils.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/import/winlivemail/nsWMUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/e67da9f094fffc87c30eb1e5b84b8d2145f168ef/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPService.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPService.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -295,17 +295,17 @@ NS_IMETHODIMP nsLDAPService::GetServer(c</span>
<a href="#l1.4"></a><span id="l1.4">         NS_ERROR(&quot;nsLDAPService::GetServer: null pointer &quot;);</span>
<a href="#l1.5"></a><span id="l1.5">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l1.6"></a><span id="l1.6">     }</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">     if (!mServers.Get(nsDependentString(aKey), &amp;entry)) {</span>
<a href="#l1.9"></a><span id="l1.9">         *_retval = 0;</span>
<a href="#l1.10"></a><span id="l1.10">         return NS_ERROR_FAILURE;</span>
<a href="#l1.11"></a><span id="l1.11">     }</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    if (!(*_retval = entry-&gt;GetServer().get())) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    if (!(*_retval = entry-&gt;GetServer().take())) {</span>
<a href="#l1.14"></a><span id="l1.14">         return NS_ERROR_FAILURE;</span>
<a href="#l1.15"></a><span id="l1.15">     }</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17">     return NS_OK;</span>
<a href="#l1.18"></a><span id="l1.18"> }</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> //void requestConnection (in wstring aKey,</span>
<a href="#l1.21"></a><span id="l1.21"> //                        in nsILDAPMessageListener aMessageListener);</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -382,17 +382,17 @@ NS_IMETHODIMP nsLDAPService::GetConnecti</span>
<a href="#l1.23"></a><span id="l1.23">     }</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">     if (!mServers.Get(nsDependentString(aKey), &amp;entry)) {</span>
<a href="#l1.26"></a><span id="l1.26">         *_retval = 0;</span>
<a href="#l1.27"></a><span id="l1.27">         return NS_ERROR_FAILURE;</span>
<a href="#l1.28"></a><span id="l1.28">     }</span>
<a href="#l1.29"></a><span id="l1.29">     entry-&gt;SetTimestamp();</span>
<a href="#l1.30"></a><span id="l1.30">     entry-&gt;IncrementLeases();</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-    if (!(*_retval = entry-&gt;GetConnection().get())){</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+    if (!(*_retval = entry-&gt;GetConnection().take())){</span>
<a href="#l1.33"></a><span id="l1.33">         return NS_ERROR_FAILURE;</span>
<a href="#l1.34"></a><span id="l1.34">     }</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36">     return NS_OK;</span>
<a href="#l1.37"></a><span id="l1.37"> }</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39"> // void releaseConnection (in wstring aKey);</span>
<a href="#l1.40"></a><span id="l1.40"> NS_IMETHODIMP nsLDAPService::ReleaseConnection(const char16_t *aKey)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/migration/src/nsEudoraProfileMigrator.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/migration/src/nsEudoraProfileMigrator.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -104,18 +104,19 @@ nsEudoraProfileMigrator::GetMigrateData(</span>
<a href="#l2.4"></a><span id="l2.4">   return NS_OK;</span>
<a href="#l2.5"></a><span id="l2.5"> }</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> NS_IMETHODIMP</span>
<a href="#l2.8"></a><span id="l2.8"> nsEudoraProfileMigrator::GetSourceExists(bool* aResult)</span>
<a href="#l2.9"></a><span id="l2.9"> {</span>
<a href="#l2.10"></a><span id="l2.10">   *aResult = false;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  nsCOMPtr&lt;nsIImportSettings&gt; importSettings;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  mImportModule-&gt;GetImportInterface(NS_IMPORT_SETTINGS_STR, getter_AddRefs(importSettings));</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+  mImportModule-&gt;GetImportInterface(NS_IMPORT_SETTINGS_STR, getter_AddRefs(supports));</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  nsCOMPtr&lt;nsIImportSettings&gt; importSettings = do_QueryInterface(supports);</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">   if (importSettings)</span>
<a href="#l2.19"></a><span id="l2.19">   {</span>
<a href="#l2.20"></a><span id="l2.20">     nsString description;</span>
<a href="#l2.21"></a><span id="l2.21">     nsCOMPtr&lt;nsIFile&gt; location;</span>
<a href="#l2.22"></a><span id="l2.22">     importSettings-&gt;AutoLocate(getter_Copies(description), getter_AddRefs(location), aResult);</span>
<a href="#l2.23"></a><span id="l2.23">   }</span>
<a href="#l2.24"></a><span id="l2.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -290,18 +290,20 @@ nsresult nsNetscapeProfileMigratorBase::</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">   rv = dirIterator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l3.6"></a><span id="l3.6">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">   nsCOMPtr&lt;nsIFile&gt; dirEntry;</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">   while (hasMore)</span>
<a href="#l3.11"></a><span id="l3.11">   {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    rv = dirIterator-&gt;GetNext((nsISupports**)getter_AddRefs(dirEntry));</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+    rv = dirIterator-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+    dirEntry = do_QueryInterface(supports);</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; dirEntry)</span>
<a href="#l3.18"></a><span id="l3.18">     {</span>
<a href="#l3.19"></a><span id="l3.19">       rv = dirEntry-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l3.20"></a><span id="l3.20">       if (NS_SUCCEEDED(rv))</span>
<a href="#l3.21"></a><span id="l3.21">       {</span>
<a href="#l3.22"></a><span id="l3.22">         if (isDir)</span>
<a href="#l3.23"></a><span id="l3.23">         {</span>
<a href="#l3.24"></a><span id="l3.24">           nsCOMPtr&lt;nsIFile&gt; newChild;</span>
<a href="#l3.25"></a><span id="l3.25">           rv = destDir-&gt;Clone(getter_AddRefs(newChild));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/migration/src/nsOEProfileMigrator.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/migration/src/nsOEProfileMigrator.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -101,18 +101,19 @@ nsOEProfileMigrator::GetMigrateData(cons</span>
<a href="#l4.4"></a><span id="l4.4">   return NS_OK;</span>
<a href="#l4.5"></a><span id="l4.5"> }</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> NS_IMETHODIMP</span>
<a href="#l4.8"></a><span id="l4.8"> nsOEProfileMigrator::GetSourceExists(bool* aResult)</span>
<a href="#l4.9"></a><span id="l4.9"> {</span>
<a href="#l4.10"></a><span id="l4.10">   *aResult = false;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  nsCOMPtr&lt;nsIImportSettings&gt; importSettings;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  mImportModule-&gt;GetImportInterface(NS_IMPORT_SETTINGS_STR, getter_AddRefs(importSettings));</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+  mImportModule-&gt;GetImportInterface(NS_IMPORT_SETTINGS_STR, getter_AddRefs(supports));</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+  nsCOMPtr&lt;nsIImportSettings&gt; importSettings = do_QueryInterface(supports);</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">   if (importSettings)</span>
<a href="#l4.19"></a><span id="l4.19">   {</span>
<a href="#l4.20"></a><span id="l4.20">     nsString description;</span>
<a href="#l4.21"></a><span id="l4.21">     nsCOMPtr&lt;nsIFile&gt; location;</span>
<a href="#l4.22"></a><span id="l4.22">     importSettings-&gt;AutoLocate(getter_Copies(description), getter_AddRefs(location), aResult);</span>
<a href="#l4.23"></a><span id="l4.23">   }</span>
<a href="#l4.24"></a><span id="l4.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/migration/src/nsOutlookProfileMigrator.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/migration/src/nsOutlookProfileMigrator.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -95,18 +95,19 @@ nsOutlookProfileMigrator::GetMigrateData</span>
<a href="#l5.4"></a><span id="l5.4">   return NS_OK;</span>
<a href="#l5.5"></a><span id="l5.5"> }</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> NS_IMETHODIMP</span>
<a href="#l5.8"></a><span id="l5.8"> nsOutlookProfileMigrator::GetSourceExists(bool* aResult)</span>
<a href="#l5.9"></a><span id="l5.9"> {</span>
<a href="#l5.10"></a><span id="l5.10">   *aResult = false;</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  nsCOMPtr&lt;nsIImportSettings&gt; importSettings;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-  mImportModule-&gt;GetImportInterface(NS_IMPORT_SETTINGS_STR, getter_AddRefs(importSettings));</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+  mImportModule-&gt;GetImportInterface(NS_IMPORT_SETTINGS_STR, getter_AddRefs(supports));</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+  nsCOMPtr&lt;nsIImportSettings&gt; importSettings = do_QueryInterface(supports);</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">   if (importSettings)</span>
<a href="#l5.19"></a><span id="l5.19">   {</span>
<a href="#l5.20"></a><span id="l5.20">     nsString description;</span>
<a href="#l5.21"></a><span id="l5.21">     nsCOMPtr&lt;nsIFile&gt; location;</span>
<a href="#l5.22"></a><span id="l5.22">     importSettings-&gt;AutoLocate(getter_Copies(description), getter_AddRefs(location), aResult);</span>
<a href="#l5.23"></a><span id="l5.23">   }</span>
<a href="#l5.24"></a><span id="l5.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigratorBase.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigratorBase.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -28,18 +28,21 @@ nsProfileMigratorBase::~nsProfileMigrato</span>
<a href="#l6.4"></a><span id="l6.4"> nsresult nsProfileMigratorBase::ImportSettings(nsIImportModule * aImportModule)</span>
<a href="#l6.5"></a><span id="l6.5"> {</span>
<a href="#l6.6"></a><span id="l6.6">   nsresult rv;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   nsAutoString index;</span>
<a href="#l6.9"></a><span id="l6.9">   index.AppendInt(nsIMailProfileMigrator::ACCOUNT_SETTINGS);</span>
<a href="#l6.10"></a><span id="l6.10">   NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get());</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  nsCOMPtr&lt;nsIImportSettings&gt; importSettings;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  rv = aImportModule-&gt;GetImportInterface(NS_IMPORT_SETTINGS_STR, getter_AddRefs(importSettings));</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+  rv = aImportModule-&gt;GetImportInterface(NS_IMPORT_SETTINGS_STR, getter_AddRefs(supports));</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+  nsCOMPtr&lt;nsIImportSettings&gt; importSettings = do_QueryInterface(supports);</span>
<a href="#l6.19"></a><span id="l6.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">   bool importedSettings = false;</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">   rv = importSettings-&gt;Import(getter_AddRefs(mLocalFolderAccount), &amp;importedSettings);</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25">   NOTIFY_OBSERVERS(MIGRATION_ITEMAFTERMIGRATE, index.get());</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27" class="difflineat">@@ -49,17 +52,21 @@ nsresult nsProfileMigratorBase::ImportSe</span>
<a href="#l6.28"></a><span id="l6.28"> nsresult nsProfileMigratorBase::ImportAddressBook(nsIImportModule * aImportModule)</span>
<a href="#l6.29"></a><span id="l6.29"> {</span>
<a href="#l6.30"></a><span id="l6.30">   nsresult rv;</span>
<a href="#l6.31"></a><span id="l6.31"> </span>
<a href="#l6.32"></a><span id="l6.32">   nsAutoString index;</span>
<a href="#l6.33"></a><span id="l6.33">   index.AppendInt(nsIMailProfileMigrator::ADDRESSBOOK_DATA);</span>
<a href="#l6.34"></a><span id="l6.34">   NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get());</span>
<a href="#l6.35"></a><span id="l6.35"> </span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-  rv = aImportModule-&gt;GetImportInterface(NS_IMPORT_ADDRESS_STR, getter_AddRefs(mGenericImporter));</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+  rv = aImportModule-&gt;GetImportInterface(NS_IMPORT_ADDRESS_STR, getter_AddRefs(supports));</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+  mGenericImporter = do_QueryInterface(supports);</span>
<a href="#l6.42"></a><span id="l6.42">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.43"></a><span id="l6.43"> </span>
<a href="#l6.44"></a><span id="l6.44">   nsCOMPtr&lt;nsISupportsCString&gt; pabString = do_CreateInstance(NS_SUPPORTS_CSTRING_CONTRACTID, &amp;rv);</span>
<a href="#l6.45"></a><span id="l6.45">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.46"></a><span id="l6.46"> </span>
<a href="#l6.47"></a><span id="l6.47">   // we want to migrate the outlook express addressbook into our personal address book</span>
<a href="#l6.48"></a><span id="l6.48">   pabString-&gt;SetData(nsDependentCString(kPersonalAddressbookUri));</span>
<a href="#l6.49"></a><span id="l6.49">   mGenericImporter-&gt;SetData(&quot;addressDestination&quot;, pabString);</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineat">@@ -92,17 +99,21 @@ nsresult nsProfileMigratorBase::FinishCo</span>
<a href="#l6.51"></a><span id="l6.51"> nsresult nsProfileMigratorBase::ImportMailData(nsIImportModule * aImportModule)</span>
<a href="#l6.52"></a><span id="l6.52"> {</span>
<a href="#l6.53"></a><span id="l6.53">   nsresult rv;</span>
<a href="#l6.54"></a><span id="l6.54"> </span>
<a href="#l6.55"></a><span id="l6.55">   nsAutoString index;</span>
<a href="#l6.56"></a><span id="l6.56">   index.AppendInt(nsIMailProfileMigrator::MAILDATA);</span>
<a href="#l6.57"></a><span id="l6.57">   NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get());</span>
<a href="#l6.58"></a><span id="l6.58"> </span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-  rv = aImportModule-&gt;GetImportInterface(NS_IMPORT_MAIL_STR, getter_AddRefs(mGenericImporter));</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+  rv = aImportModule-&gt;GetImportInterface(NS_IMPORT_MAIL_STR, getter_AddRefs(supports));</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+  mGenericImporter = do_QueryInterface(supports);</span>
<a href="#l6.65"></a><span id="l6.65">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.66"></a><span id="l6.66"> </span>
<a href="#l6.67"></a><span id="l6.67">   nsCOMPtr&lt;nsISupportsPRBool&gt; migrating = do_CreateInstance(NS_SUPPORTS_PRBOOL_CONTRACTID, &amp;rv);</span>
<a href="#l6.68"></a><span id="l6.68">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.69"></a><span id="l6.69"> </span>
<a href="#l6.70"></a><span id="l6.70">   // by setting the migration flag, we force the import utility to install local folders from OE</span>
<a href="#l6.71"></a><span id="l6.71">   // directly into Local Folders and not as a subfolder</span>
<a href="#l6.72"></a><span id="l6.72">   migrating-&gt;SetData(true);</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineat">@@ -132,20 +143,21 @@ nsresult nsProfileMigratorBase::FinishCo</span>
<a href="#l6.74"></a><span id="l6.74">   // now kick off the filters migration code</span>
<a href="#l6.75"></a><span id="l6.75">   return ImportFilters(mImportModule);</span>
<a href="#l6.76"></a><span id="l6.76"> }</span>
<a href="#l6.77"></a><span id="l6.77"> </span>
<a href="#l6.78"></a><span id="l6.78"> nsresult nsProfileMigratorBase::ImportFilters(nsIImportModule * aImportModule)</span>
<a href="#l6.79"></a><span id="l6.79"> {</span>
<a href="#l6.80"></a><span id="l6.80">   nsresult rv = NS_OK;</span>
<a href="#l6.81"></a><span id="l6.81"> </span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-  nsCOMPtr&lt;nsIImportFilters&gt; importFilters;</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-  nsresult rv2 = aImportModule-&gt;GetImportInterface(NS_IMPORT_FILTERS_STR, getter_AddRefs(importFilters));</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+  nsresult rv2 = aImportModule-&gt;GetImportInterface(NS_IMPORT_FILTERS_STR, getter_AddRefs(supports));</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+  nsCOMPtr&lt;nsIImportFilters&gt; importFilters = do_QueryInterface(supports);</span>
<a href="#l6.87"></a><span id="l6.87"> </span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-  if (NS_SUCCEEDED(rv2))</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+  if (NS_SUCCEEDED(rv2) &amp;&amp; importFilters)</span>
<a href="#l6.90"></a><span id="l6.90">   {</span>
<a href="#l6.91"></a><span id="l6.91">     nsAutoString index;</span>
<a href="#l6.92"></a><span id="l6.92">     index.AppendInt(nsIMailProfileMigrator::FILTERS);</span>
<a href="#l6.93"></a><span id="l6.93">     NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get());</span>
<a href="#l6.94"></a><span id="l6.94"> </span>
<a href="#l6.95"></a><span id="l6.95">     bool importedFilters = false;</span>
<a href="#l6.96"></a><span id="l6.96">     char16_t* error;</span>
<a href="#l6.97"></a><span id="l6.97"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/search/nsMailWinSearchHelper.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/search/nsMailWinSearchHelper.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -169,18 +169,20 @@ NS_IMETHODIMP nsMailWinSearchHelper::Set</span>
<a href="#l7.4"></a><span id="l7.4">   {</span>
<a href="#l7.5"></a><span id="l7.5">     nsCOMPtr&lt;nsISimpleEnumerator&gt; children;</span>
<a href="#l7.6"></a><span id="l7.6">     rv = aFile-&gt;GetDirectoryEntries(getter_AddRefs(children));</span>
<a href="#l7.7"></a><span id="l7.7">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.8"></a><span id="l7.8">     </span>
<a href="#l7.9"></a><span id="l7.9">     bool hasMore;</span>
<a href="#l7.10"></a><span id="l7.10">     while (NS_SUCCEEDED(rv) &amp;&amp; NS_SUCCEEDED(children-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l7.11"></a><span id="l7.11">     {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      nsCOMPtr&lt;nsIFile&gt; childFile;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-      rv = children-&gt;GetNext(getter_AddRefs(childFile));</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+      nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+      rv = children-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; childFile = do_QueryInterface(supports, &amp;rv);</span>
<a href="#l7.18"></a><span id="l7.18">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.19"></a><span id="l7.19">       rv = SetFANCIBit(childFile, aBit, aRecurse);</span>
<a href="#l7.20"></a><span id="l7.20">     }</span>
<a href="#l7.21"></a><span id="l7.21">   }</span>
<a href="#l7.22"></a><span id="l7.22">   return rv;</span>
<a href="#l7.23"></a><span id="l7.23"> }</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25"> NS_IMETHODIMP nsMailWinSearchHelper::GetIsFileAssociationSet(bool *aResult)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -773,19 +773,22 @@ static nsresult BuildRestriction(nsIAbBo</span>
<a href="#l8.4"></a><span id="l8.4">     return NS_OK ;</span>
<a href="#l8.5"></a><span id="l8.5"> }</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> static nsresult BuildRestriction(nsIAbDirectoryQueryArguments *aArguments, </span>
<a href="#l8.8"></a><span id="l8.8">                                  SRestriction&amp; aRestriction)</span>
<a href="#l8.9"></a><span id="l8.9"> {</span>
<a href="#l8.10"></a><span id="l8.10">     if (!aArguments) { return NS_ERROR_NULL_POINTER ; }</span>
<a href="#l8.11"></a><span id="l8.11">     nsresult retCode = NS_OK ;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    nsCOMPtr&lt;nsIAbBooleanExpression&gt; booleanQuery ;</span>
<a href="#l8.13"></a><span id="l8.13"> </span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-    retCode = aArguments-&gt;GetExpression(getter_AddRefs(booleanQuery)) ;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+    nsCOMPtr&lt;nsISupports&gt; supports ;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+    retCode = aArguments-&gt;GetExpression(getter_AddRefs(supports)) ;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+    NS_ENSURE_SUCCESS(retCode, retCode) ;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+    nsCOMPtr&lt;nsIAbBooleanExpression&gt; booleanQuery =</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+      do_QueryInterface(supports, &amp;retCode) ;</span>
<a href="#l8.20"></a><span id="l8.20">     NS_ENSURE_SUCCESS(retCode, retCode) ;</span>
<a href="#l8.21"></a><span id="l8.21">     retCode = BuildRestriction(booleanQuery, aRestriction) ;</span>
<a href="#l8.22"></a><span id="l8.22">     return retCode ;</span>
<a href="#l8.23"></a><span id="l8.23"> }</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25"> static void DestroyRestriction(SRestriction&amp; aRestriction)</span>
<a href="#l8.26"></a><span id="l8.26"> {</span>
<a href="#l8.27"></a><span id="l8.27">     switch(aRestriction.rt) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddbookUrl.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddbookUrl.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -185,17 +185,17 @@ NS_IMETHODIMP nsAddbookUrl::Clone(nsIURI</span>
<a href="#l9.4"></a><span id="l9.4">   nsRefPtr&lt;nsAddbookUrl&gt; clone = new nsAddbookUrl();</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6">   if (!clone)</span>
<a href="#l9.7"></a><span id="l9.7">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">   nsresult rv = m_baseURL-&gt;Clone(getter_AddRefs(clone-&gt;m_baseURL));</span>
<a href="#l9.10"></a><span id="l9.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.11"></a><span id="l9.11">   clone-&gt;ParseUrl();</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  *_retval = clone.forget().get();</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  clone.forget(_retval);</span>
<a href="#l9.14"></a><span id="l9.14">   return NS_OK;</span>
<a href="#l9.15"></a><span id="l9.15"> }	</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17"> NS_IMETHODIMP nsAddbookUrl::Resolve(const nsACString &amp;relativePath, nsACString &amp;result) </span>
<a href="#l9.18"></a><span id="l9.18"> {</span>
<a href="#l9.19"></a><span id="l9.19">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l9.20"></a><span id="l9.20"> }</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -231,17 +231,17 @@ nsAddbookUrl::CloneIgnoringRef(nsIURI** </span>
<a href="#l9.23"></a><span id="l9.23">   nsRefPtr&lt;nsAddbookUrl&gt; clone = new nsAddbookUrl();</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">   if (!clone)</span>
<a href="#l9.26"></a><span id="l9.26">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28">   nsresult rv = m_baseURL-&gt;CloneIgnoringRef(getter_AddRefs(clone-&gt;m_baseURL));</span>
<a href="#l9.29"></a><span id="l9.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.30"></a><span id="l9.30">   clone-&gt;ParseUrl();</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-  *_retval = clone.forget().get();</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  clone.forget(_retval);</span>
<a href="#l9.33"></a><span id="l9.33">   return NS_OK;</span>
<a href="#l9.34"></a><span id="l9.34"> }</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36"> NS_IMETHODIMP</span>
<a href="#l9.37"></a><span id="l9.37"> nsAddbookUrl::GetSpecIgnoringRef(nsACString &amp;result)</span>
<a href="#l9.38"></a><span id="l9.38"> {</span>
<a href="#l9.39"></a><span id="l9.39">   return m_baseURL-&gt;GetSpecIgnoringRef(result);</span>
<a href="#l9.40"></a><span id="l9.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -892,18 +892,20 @@ nsMsgApplyFiltersToMessages::nsMsgApplyF</span>
<a href="#l10.4"></a><span id="l10.4">   {</span>
<a href="#l10.5"></a><span id="l10.5">     uint32_t length;</span>
<a href="#l10.6"></a><span id="l10.6">     if (NS_SUCCEEDED(aMsgHdrList-&gt;GetLength(&amp;length)))</span>
<a href="#l10.7"></a><span id="l10.7">       m_msgHdrList.SetCapacity(length);</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">     bool hasMore;</span>
<a href="#l10.10"></a><span id="l10.10">     while (NS_SUCCEEDED(msgEnumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l10.11"></a><span id="l10.11">     {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+      nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l10.13"></a><span id="l10.13">       nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-      if (NS_SUCCEEDED(msgEnumerator-&gt;GetNext(getter_AddRefs(msgHdr))) &amp;&amp; msgHdr)</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+      if (NS_SUCCEEDED(msgEnumerator-&gt;GetNext(getter_AddRefs(supports))) &amp;&amp;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+          (msgHdr = do_QueryInterface(supports)))</span>
<a href="#l10.17"></a><span id="l10.17">         m_msgHdrList.AppendObject(msgHdr);</span>
<a href="#l10.18"></a><span id="l10.18">     }</span>
<a href="#l10.19"></a><span id="l10.19">   }</span>
<a href="#l10.20"></a><span id="l10.20"> }</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22"> nsresult nsMsgApplyFiltersToMessages::RunNextFilter()</span>
<a href="#l10.23"></a><span id="l10.23"> {</span>
<a href="#l10.24"></a><span id="l10.24">   while (m_curFilterIndex &lt; m_numFilters)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -2527,18 +2527,19 @@ nsMsgAccountManager::GetChromePackageNam</span>
<a href="#l11.4"></a><span id="l11.4">   nsresult rv;</span>
<a href="#l11.5"></a><span id="l11.5">   nsCOMPtr&lt;nsICategoryManager&gt; catman = do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l11.6"></a><span id="l11.6">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8">   nsCOMPtr&lt;nsISimpleEnumerator&gt; e;</span>
<a href="#l11.9"></a><span id="l11.9">   rv = catman-&gt;EnumerateCategory(MAILNEWS_ACCOUNTMANAGER_EXTENSIONS, getter_AddRefs(e));</span>
<a href="#l11.10"></a><span id="l11.10">   if(NS_SUCCEEDED(rv) &amp;&amp; e) {</span>
<a href="#l11.11"></a><span id="l11.11">     while (true) {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-      nsCOMPtr&lt;nsISupportsCString&gt; catEntry;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-      rv = e-&gt;GetNext(getter_AddRefs(catEntry));</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+      nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+      rv = e-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+      nsCOMPtr&lt;nsISupportsCString&gt; catEntry = do_QueryInterface(supports);</span>
<a href="#l11.17"></a><span id="l11.17">       if (NS_FAILED(rv) || !catEntry)</span>
<a href="#l11.18"></a><span id="l11.18">         break;</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">       nsAutoCString entryString;</span>
<a href="#l11.21"></a><span id="l11.21">       rv = catEntry-&gt;GetData(entryString);</span>
<a href="#l11.22"></a><span id="l11.22">       if (NS_FAILED(rv))</span>
<a href="#l11.23"></a><span id="l11.23">          break;</span>
<a href="#l11.24"></a><span id="l11.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -156,17 +156,17 @@ nsMsgAccountManagerDataSource::nsMsgAcco</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5">     getRDFService()-&gt;GetLiteral(MOZ_UTF16(&quot;true&quot;),</span>
<a href="#l12.6"></a><span id="l12.6">                                 &amp;kTrueLiteral);</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8">     // eventually these need to exist in some kind of array</span>
<a href="#l12.9"></a><span id="l12.9">     // that's easily extensible</span>
<a href="#l12.10"></a><span id="l12.10">     getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SETTINGS), &amp;kNC_Settings);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    kDefaultServerAtom = MsgNewAtom(&quot;DefaultServer&quot;).get();</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    kDefaultServerAtom = MsgNewAtom(&quot;DefaultServer&quot;).take();</span>
<a href="#l12.14"></a><span id="l12.14">   }</span>
<a href="#l12.15"></a><span id="l12.15"> }</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17"> nsMsgAccountManagerDataSource::~nsMsgAccountManagerDataSource()</span>
<a href="#l12.18"></a><span id="l12.18"> {</span>
<a href="#l12.19"></a><span id="l12.19">   nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager);</span>
<a href="#l12.20"></a><span id="l12.20">   if (am)</span>
<a href="#l12.21"></a><span id="l12.21">     am-&gt;RemoveIncomingServerListener(this);</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -614,18 +614,19 @@ nsMsgAccountManagerDataSource::appendGen</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">   nsCOMPtr&lt;nsICategoryManager&gt; catman = do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l12.25"></a><span id="l12.25">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">   nsCOMPtr&lt;nsISimpleEnumerator&gt; e;</span>
<a href="#l12.28"></a><span id="l12.28">   rv = catman-&gt;EnumerateCategory(MAILNEWS_ACCOUNTMANAGER_EXTENSIONS, getter_AddRefs(e));</span>
<a href="#l12.29"></a><span id="l12.29">   if(NS_SUCCEEDED(rv) &amp;&amp; e) {</span>
<a href="#l12.30"></a><span id="l12.30">     while (true) {</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-      nsCOMPtr&lt;nsISupportsCString&gt; catEntry;</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-      rv = e-&gt;GetNext(getter_AddRefs(catEntry));</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+      nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+      rv = e-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+      nsCOMPtr&lt;nsISupportsCString&gt; catEntry = do_QueryInterface(supports);</span>
<a href="#l12.36"></a><span id="l12.36">       if (NS_FAILED(rv) || !catEntry)</span>
<a href="#l12.37"></a><span id="l12.37">         break;</span>
<a href="#l12.38"></a><span id="l12.38"> </span>
<a href="#l12.39"></a><span id="l12.39">       nsAutoCString entryString;</span>
<a href="#l12.40"></a><span id="l12.40">       rv = catEntry-&gt;GetData(entryString);</span>
<a href="#l12.41"></a><span id="l12.41">       if (NS_FAILED(rv))</span>
<a href="#l12.42"></a><span id="l12.42">         break;</span>
<a href="#l12.43"></a><span id="l12.43"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -147,18 +147,18 @@ nsMsgDBView::nsMsgDBView()</span>
<a href="#l13.4"></a><span id="l13.4">   }</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6">   InitLabelStrings();</span>
<a href="#l13.7"></a><span id="l13.7">   gInstanceCount++;</span>
<a href="#l13.8"></a><span id="l13.8"> }</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10"> void nsMsgDBView::InitializeAtomsAndLiterals()</span>
<a href="#l13.11"></a><span id="l13.11"> {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  kJunkMsgAtom = MsgNewAtom(&quot;junk&quot;).get();</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-  kNotJunkMsgAtom = MsgNewAtom(&quot;notjunk&quot;).get();</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  kJunkMsgAtom = MsgNewAtom(&quot;junk&quot;).take();</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+  kNotJunkMsgAtom = MsgNewAtom(&quot;notjunk&quot;).take();</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">   // priority strings</span>
<a href="#l13.18"></a><span id="l13.18">   kHighestPriorityString = GetString(MOZ_UTF16(&quot;priorityHighest&quot;));</span>
<a href="#l13.19"></a><span id="l13.19">   kHighPriorityString = GetString(MOZ_UTF16(&quot;priorityHigh&quot;));</span>
<a href="#l13.20"></a><span id="l13.20">   kLowestPriorityString = GetString(MOZ_UTF16(&quot;priorityLowest&quot;));</span>
<a href="#l13.21"></a><span id="l13.21">   kLowPriorityString = GetString(MOZ_UTF16(&quot;priorityLow&quot;));</span>
<a href="#l13.22"></a><span id="l13.22">   kNormalPriorityString = GetString(MOZ_UTF16(&quot;priorityNormal&quot;));</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24" class="difflineat">@@ -3161,19 +3161,20 @@ nsresult nsMsgDBView::DownloadFlaggedFor</span>
<a href="#l13.25"></a><span id="l13.25">   nsCOMPtr &lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l13.26"></a><span id="l13.26">   rv = GetMessageEnumerator(getter_AddRefs(enumerator));</span>
<a href="#l13.27"></a><span id="l13.27">   if (NS_SUCCEEDED(rv) &amp;&amp; enumerator)</span>
<a href="#l13.28"></a><span id="l13.28">   {</span>
<a href="#l13.29"></a><span id="l13.29">     bool hasMore;</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31">     while (NS_SUCCEEDED(rv = enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l13.32"></a><span id="l13.32">     {</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-      nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-      rv = enumerator-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+      nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+      rv = enumerator-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l13.37"></a><span id="l13.37">       NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+      nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader = do_QueryInterface(supports);</span>
<a href="#l13.39"></a><span id="l13.39">       if (pHeader &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l13.40"></a><span id="l13.40">       {</span>
<a href="#l13.41"></a><span id="l13.41">         uint32_t flags;</span>
<a href="#l13.42"></a><span id="l13.42">         pHeader-&gt;GetFlags(&amp;flags);</span>
<a href="#l13.43"></a><span id="l13.43">         if ((flags &amp; nsMsgMessageFlags::Marked) &amp;&amp; !(flags &amp; nsMsgMessageFlags::Offline))</span>
<a href="#l13.44"></a><span id="l13.44">           messageArray-&gt;AppendElement(pHeader, false);</span>
<a href="#l13.45"></a><span id="l13.45">       }</span>
<a href="#l13.46"></a><span id="l13.46">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -178,29 +178,29 @@ nsMsgFolderDataSource::nsMsgFolderDataSo</span>
<a href="#l14.4"></a><span id="l14.4">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_MOVEFOLDER), &amp;kNC_MoveFolder);</span>
<a href="#l14.5"></a><span id="l14.5">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_MARKALLMESSAGESREAD),</span>
<a href="#l14.6"></a><span id="l14.6">                              &amp;kNC_MarkAllMessagesRead);</span>
<a href="#l14.7"></a><span id="l14.7">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COMPACT), &amp;kNC_Compact);</span>
<a href="#l14.8"></a><span id="l14.8">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COMPACTALL), &amp;kNC_CompactAll);</span>
<a href="#l14.9"></a><span id="l14.9">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_RENAME), &amp;kNC_Rename);</span>
<a href="#l14.10"></a><span id="l14.10">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_EMPTYTRASH), &amp;kNC_EmptyTrash);</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    kTotalMessagesAtom           = MsgNewAtom(&quot;TotalMessages&quot;).get();</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    kTotalUnreadMessagesAtom     = MsgNewAtom(&quot;TotalUnreadMessages&quot;).get();</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-    kFolderSizeAtom              = MsgNewAtom(&quot;FolderSize&quot;).get();</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-    kBiffStateAtom               = MsgNewAtom(&quot;BiffState&quot;).get();</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-    kSortOrderAtom               = MsgNewAtom(&quot;SortOrder&quot;).get();</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-    kNewMessagesAtom             = MsgNewAtom(&quot;NewMessages&quot;).get();</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-    kNameAtom                    = MsgNewAtom(&quot;Name&quot;).get();</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-    kSynchronizeAtom             = MsgNewAtom(&quot;Synchronize&quot;).get();</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-    kOpenAtom                    = MsgNewAtom(&quot;open&quot;).get();</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-    kIsDeferredAtom              = MsgNewAtom(&quot;isDeferred&quot;).get();</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-    kIsSecureAtom                = MsgNewAtom(&quot;isSecure&quot;).get();</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-    kCanFileMessagesAtom         = MsgNewAtom(&quot;canFileMessages&quot;).get();</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-    kInVFEditSearchScopeAtom     = MsgNewAtom(&quot;inVFEditSearchScope&quot;).get();</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+    kTotalMessagesAtom           = MsgNewAtom(&quot;TotalMessages&quot;).take();</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+    kTotalUnreadMessagesAtom     = MsgNewAtom(&quot;TotalUnreadMessages&quot;).take();</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+    kFolderSizeAtom              = MsgNewAtom(&quot;FolderSize&quot;).take();</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+    kBiffStateAtom               = MsgNewAtom(&quot;BiffState&quot;).take();</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+    kSortOrderAtom               = MsgNewAtom(&quot;SortOrder&quot;).take();</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+    kNewMessagesAtom             = MsgNewAtom(&quot;NewMessages&quot;).take();</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+    kNameAtom                    = MsgNewAtom(&quot;Name&quot;).take();</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    kSynchronizeAtom             = MsgNewAtom(&quot;Synchronize&quot;).take();</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+    kOpenAtom                    = MsgNewAtom(&quot;open&quot;).take();</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+    kIsDeferredAtom              = MsgNewAtom(&quot;isDeferred&quot;).take();</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+    kIsSecureAtom                = MsgNewAtom(&quot;isSecure&quot;).take();</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+    kCanFileMessagesAtom         = MsgNewAtom(&quot;canFileMessages&quot;).take();</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+    kInVFEditSearchScopeAtom     = MsgNewAtom(&quot;inVFEditSearchScope&quot;).take();</span>
<a href="#l14.38"></a><span id="l14.38">   }</span>
<a href="#l14.39"></a><span id="l14.39"> </span>
<a href="#l14.40"></a><span id="l14.40">   CreateLiterals(rdf);</span>
<a href="#l14.41"></a><span id="l14.41">   CreateArcsOutEnumerator();</span>
<a href="#l14.42"></a><span id="l14.42"> }</span>
<a href="#l14.43"></a><span id="l14.43"> </span>
<a href="#l14.44"></a><span id="l14.44"> nsMsgFolderDataSource::~nsMsgFolderDataSource (void)</span>
<a href="#l14.45"></a><span id="l14.45"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -394,19 +394,20 @@ nsMsgQuickSearchDBView::OnNewSearch()</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5">       m_usingCachedHits = true;</span>
<a href="#l15.6"></a><span id="l15.6">       cachedHits-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l15.7"></a><span id="l15.7">       m_cacheEmpty = !hasMore;</span>
<a href="#l15.8"></a><span id="l15.8">       if (mTree)</span>
<a href="#l15.9"></a><span id="l15.9">         mTree-&gt;BeginUpdateBatch();</span>
<a href="#l15.10"></a><span id="l15.10">       while (hasMore)</span>
<a href="#l15.11"></a><span id="l15.11">       {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-        nsresult rv = cachedHits-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+        nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+        nsresult rv = cachedHits-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l15.16"></a><span id="l15.16">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+        nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader = do_QueryInterface(supports);</span>
<a href="#l15.18"></a><span id="l15.18">         if (pHeader &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l15.19"></a><span id="l15.19">           AddHdr(pHeader);</span>
<a href="#l15.20"></a><span id="l15.20">         else</span>
<a href="#l15.21"></a><span id="l15.21">           break;</span>
<a href="#l15.22"></a><span id="l15.22">         cachedHits-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l15.23"></a><span id="l15.23">       }</span>
<a href="#l15.24"></a><span id="l15.24">       if (mTree)</span>
<a href="#l15.25"></a><span id="l15.25">         mTree-&gt;EndUpdateBatch();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -428,19 +428,20 @@ nsMsgXFVirtualFolderDBView::OnNewSearch(</span>
<a href="#l16.4"></a><span id="l16.4">         if (cachedHits)</span>
<a href="#l16.5"></a><span id="l16.5">         {</span>
<a href="#l16.6"></a><span id="l16.6">           cachedHits-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l16.7"></a><span id="l16.7">           if (hasMore)</span>
<a href="#l16.8"></a><span id="l16.8">           {</span>
<a href="#l16.9"></a><span id="l16.9">             nsMsgKey prevKey = nsMsgKey_None;</span>
<a href="#l16.10"></a><span id="l16.10">             while (hasMore)</span>
<a href="#l16.11"></a><span id="l16.11">             {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-              nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-              nsresult rv = cachedHits-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+              nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+              nsresult rv = cachedHits-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l16.16"></a><span id="l16.16">               NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+              nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader = do_QueryInterface(supports);</span>
<a href="#l16.18"></a><span id="l16.18">               if (pHeader &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l16.19"></a><span id="l16.19">               {</span>
<a href="#l16.20"></a><span id="l16.20">                 nsMsgKey msgKey;</span>
<a href="#l16.21"></a><span id="l16.21">                 pHeader-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l16.22"></a><span id="l16.22">                 NS_ASSERTION(prevKey == nsMsgKey_None || msgKey &gt; prevKey, &quot;cached Hits not sorted&quot;);</span>
<a href="#l16.23"></a><span id="l16.23">                 prevKey = msgKey;</span>
<a href="#l16.24"></a><span id="l16.24">                 AddHdrFromFolder(pHeader, searchFolder);</span>
<a href="#l16.25"></a><span id="l16.25">               }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -50,17 +50,17 @@ nsStatusBarBiffManager::~nsStatusBarBiff</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5"> nsresult nsStatusBarBiffManager::Init()</span>
<a href="#l17.6"></a><span id="l17.6"> {</span>
<a href="#l17.7"></a><span id="l17.7">   if (mInitialized)</span>
<a href="#l17.8"></a><span id="l17.8">     return NS_ERROR_ALREADY_INITIALIZED;</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10">   nsresult rv;</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  kBiffStateAtom = MsgNewAtom(&quot;BiffState&quot;).get();</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  kBiffStateAtom = MsgNewAtom(&quot;BiffState&quot;).take();</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = </span>
<a href="#l17.16"></a><span id="l17.16">     do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv); </span>
<a href="#l17.17"></a><span id="l17.17">   if(NS_SUCCEEDED(rv))</span>
<a href="#l17.18"></a><span id="l17.18">     mailSession-&gt;AddFolderListener(this, nsIFolderListener::intPropertyChanged);</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">   nsCOMPtr&lt;nsIPrefBranch&gt; pref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l17.21"></a><span id="l17.21">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -518,17 +518,17 @@ NS_IMETHODIMP nsMailtoUrl::Clone(nsIURI </span>
<a href="#l18.4"></a><span id="l18.4">   nsRefPtr&lt;nsMailtoUrl&gt; clone = new nsMailtoUrl();</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">   NS_ENSURE_TRUE(clone, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8">   nsresult rv = m_baseURL-&gt;Clone(getter_AddRefs(clone-&gt;m_baseURL));</span>
<a href="#l18.9"></a><span id="l18.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">   clone-&gt;ParseUrl();</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  *_retval = clone.forget().get();</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  clone.forget(_retval);</span>
<a href="#l18.14"></a><span id="l18.14">   return NS_OK;</span>
<a href="#l18.15"></a><span id="l18.15"> }</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17"> NS_IMETHODIMP nsMailtoUrl::Resolve(const nsACString &amp;relativePath, nsACString &amp;result)</span>
<a href="#l18.18"></a><span id="l18.18"> {</span>
<a href="#l18.19"></a><span id="l18.19">   return m_baseURL-&gt;Resolve(relativePath, result);</span>
<a href="#l18.20"></a><span id="l18.20"> }</span>
<a href="#l18.21"></a><span id="l18.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -451,17 +451,19 @@ NS_IMETHODIMP nsDBFolderInfo::GetHighWat</span>
<a href="#l19.4"></a><span id="l19.4">       return rv;</span>
<a href="#l19.5"></a><span id="l19.5">     bool hasMore = false;</span>
<a href="#l19.6"></a><span id="l19.6">     nsCOMPtr&lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l19.7"></a><span id="l19.7">     nsMsgKey recalculatedHighWater = 1;</span>
<a href="#l19.8"></a><span id="l19.8">     int32_t i = 0;</span>
<a href="#l19.9"></a><span id="l19.9">     while(i++ &lt; 100 &amp;&amp; NS_SUCCEEDED(rv = hdrs-&gt;HasMoreElements(&amp;hasMore))</span>
<a href="#l19.10"></a><span id="l19.10">               &amp;&amp; hasMore)</span>
<a href="#l19.11"></a><span id="l19.11">     {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-      (void) hdrs-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+      nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+      (void) hdrs-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+      pHeader = do_QueryInterface(supports);</span>
<a href="#l19.16"></a><span id="l19.16">       if (pHeader)</span>
<a href="#l19.17"></a><span id="l19.17">       {</span>
<a href="#l19.18"></a><span id="l19.18">         nsMsgKey msgKey;</span>
<a href="#l19.19"></a><span id="l19.19">         pHeader-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l19.20"></a><span id="l19.20">         if (msgKey &gt; recalculatedHighWater)</span>
<a href="#l19.21"></a><span id="l19.21">           recalculatedHighWater = msgKey;</span>
<a href="#l19.22"></a><span id="l19.22">       }</span>
<a href="#l19.23"></a><span id="l19.23">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -1739,19 +1739,20 @@ nsresult nsMsgDatabase::InitExistingDB()</span>
<a href="#l20.4"></a><span id="l20.4">       err = EnumerateMessages(getter_AddRefs(enumerator));</span>
<a href="#l20.5"></a><span id="l20.5">       if (NS_SUCCEEDED(err) &amp;&amp; enumerator)</span>
<a href="#l20.6"></a><span id="l20.6">       {</span>
<a href="#l20.7"></a><span id="l20.7">         bool hasMore;</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9">         while (NS_SUCCEEDED(err = enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp;</span>
<a href="#l20.10"></a><span id="l20.10">                hasMore)</span>
<a href="#l20.11"></a><span id="l20.11">         {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-          nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-          err = enumerator-&gt;GetNext(getter_AddRefs(msgHdr));</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+          nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+          err = enumerator-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l20.16"></a><span id="l20.16">           NS_ASSERTION(NS_SUCCEEDED(err), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+          nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr = do_QueryInterface(supports);</span>
<a href="#l20.18"></a><span id="l20.18">           if (msgHdr &amp;&amp; NS_SUCCEEDED(err))</span>
<a href="#l20.19"></a><span id="l20.19">           {</span>
<a href="#l20.20"></a><span id="l20.20">             nsCString messageId;</span>
<a href="#l20.21"></a><span id="l20.21">             nsAutoCString firstReference;</span>
<a href="#l20.22"></a><span id="l20.22">             msgHdr-&gt;GetMessageId(getter_Copies(messageId));</span>
<a href="#l20.23"></a><span id="l20.23">             msgHdr-&gt;GetStringReference(0, firstReference);</span>
<a href="#l20.24"></a><span id="l20.24">             if (messageId.Equals(firstReference))</span>
<a href="#l20.25"></a><span id="l20.25">             {</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineat">@@ -3068,18 +3069,19 @@ nsMsgDatabase::NextMatchingHdrs(nsISimpl</span>
<a href="#l20.27"></a><span id="l20.27">       enumerator-&gt;mRowPos - aNumHdrsToLookAt;</span>
<a href="#l20.28"></a><span id="l20.28">     if (enumerator-&gt;mStopPos &lt; 0)</span>
<a href="#l20.29"></a><span id="l20.29">       enumerator-&gt;mStopPos = 0;</span>
<a href="#l20.30"></a><span id="l20.30">   }</span>
<a href="#l20.31"></a><span id="l20.31">   int32_t numMatches = 0;</span>
<a href="#l20.32"></a><span id="l20.32">   nsresult rv;</span>
<a href="#l20.33"></a><span id="l20.33">   do</span>
<a href="#l20.34"></a><span id="l20.34">   {</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-    nsCOMPtr &lt;nsIMsgDBHdr&gt; nextMessage;</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-    rv = enumerator-&gt;GetNext(getter_AddRefs(nextMessage));</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineplus">+    nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+    rv = enumerator-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+    nsCOMPtr &lt;nsIMsgDBHdr&gt; nextMessage = do_QueryInterface(supports);</span>
<a href="#l20.40"></a><span id="l20.40">     if (NS_SUCCEEDED(rv) &amp;&amp; nextMessage)</span>
<a href="#l20.41"></a><span id="l20.41">     {</span>
<a href="#l20.42"></a><span id="l20.42">       if (aMatchingHdrs)</span>
<a href="#l20.43"></a><span id="l20.43">         aMatchingHdrs-&gt;AppendElement(nextMessage, false);</span>
<a href="#l20.44"></a><span id="l20.44">       ++numMatches;</span>
<a href="#l20.45"></a><span id="l20.45">       if (aMaxResults &amp;&amp; numMatches == aMaxResults)</span>
<a href="#l20.46"></a><span id="l20.46">         break;</span>
<a href="#l20.47"></a><span id="l20.47">     }</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineat">@@ -3093,17 +3095,16 @@ nsMsgDatabase::NextMatchingHdrs(nsISimpl</span>
<a href="#l20.49"></a><span id="l20.49"> </span>
<a href="#l20.50"></a><span id="l20.50">   *aResult = !enumerator-&gt;mDone;</span>
<a href="#l20.51"></a><span id="l20.51">   return NS_OK;</span>
<a href="#l20.52"></a><span id="l20.52"> }</span>
<a href="#l20.53"></a><span id="l20.53"> </span>
<a href="#l20.54"></a><span id="l20.54"> NS_IMETHODIMP</span>
<a href="#l20.55"></a><span id="l20.55"> nsMsgDatabase::SyncCounts()</span>
<a href="#l20.56"></a><span id="l20.56"> {</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-  nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l20.58"></a><span id="l20.58">   nsCOMPtr &lt;nsISimpleEnumerator&gt; hdrs;</span>
<a href="#l20.59"></a><span id="l20.59">   nsresult rv = EnumerateMessages(getter_AddRefs(hdrs));</span>
<a href="#l20.60"></a><span id="l20.60">   if (NS_FAILED(rv))</span>
<a href="#l20.61"></a><span id="l20.61">     return rv;</span>
<a href="#l20.62"></a><span id="l20.62">   bool hasMore = false;</span>
<a href="#l20.63"></a><span id="l20.63"> </span>
<a href="#l20.64"></a><span id="l20.64">   mdb_count numHdrsInTable = 0;</span>
<a href="#l20.65"></a><span id="l20.65">   int32_t numUnread = 0;</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineat">@@ -3111,21 +3112,24 @@ nsMsgDatabase::SyncCounts()</span>
<a href="#l20.67"></a><span id="l20.67"> </span>
<a href="#l20.68"></a><span id="l20.68">   if (m_mdbAllMsgHeadersTable)</span>
<a href="#l20.69"></a><span id="l20.69">     m_mdbAllMsgHeadersTable-&gt;GetCount(GetEnv(), &amp;numHdrsInTable);</span>
<a href="#l20.70"></a><span id="l20.70">   else</span>
<a href="#l20.71"></a><span id="l20.71">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l20.72"></a><span id="l20.72"> </span>
<a href="#l20.73"></a><span id="l20.73">   while (NS_SUCCEEDED(rv = hdrs-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l20.74"></a><span id="l20.74">   {</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-    rv = hdrs-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineplus">+    nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineplus">+    rv = hdrs-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l20.78"></a><span id="l20.78">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l20.79"></a><span id="l20.79">     if (NS_FAILED(rv))</span>
<a href="#l20.80"></a><span id="l20.80">       break;</span>
<a href="#l20.81"></a><span id="l20.81"> </span>
<a href="#l20.82"></a><span id="l20.82" class="difflineplus">+    nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader = do_QueryInterface(supports);</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineplus">+</span>
<a href="#l20.84"></a><span id="l20.84">     bool isRead;</span>
<a href="#l20.85"></a><span id="l20.85">     IsHeaderRead(pHeader, &amp;isRead);</span>
<a href="#l20.86"></a><span id="l20.86">     if (!isRead)</span>
<a href="#l20.87"></a><span id="l20.87">       numUnread++;</span>
<a href="#l20.88"></a><span id="l20.88">     numHdrs++;</span>
<a href="#l20.89"></a><span id="l20.89">   }</span>
<a href="#l20.90"></a><span id="l20.90"> </span>
<a href="#l20.91"></a><span id="l20.91">   int32_t oldTotal, oldUnread;</span>
<a href="#l20.92"></a><span id="l20.92" class="difflineat">@@ -4263,19 +4267,20 @@ nsresult nsMsgDatabase::InitRefHash()</span>
<a href="#l20.93"></a><span id="l20.93">   if (enumerator == nullptr)</span>
<a href="#l20.94"></a><span id="l20.94">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l20.95"></a><span id="l20.95"> </span>
<a href="#l20.96"></a><span id="l20.96">   // Populate table with references of existing messages</span>
<a href="#l20.97"></a><span id="l20.97">   bool hasMore;</span>
<a href="#l20.98"></a><span id="l20.98">   nsresult rv = NS_OK;</span>
<a href="#l20.99"></a><span id="l20.99">   while (NS_SUCCEEDED(rv = enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l20.100"></a><span id="l20.100">   {</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineminus">-    nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineminus">-    rv = enumerator-&gt;GetNext(getter_AddRefs(msgHdr));</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineplus">+    nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineplus">+    rv = enumerator-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l20.105"></a><span id="l20.105">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l20.106"></a><span id="l20.106" class="difflineplus">+    nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr = do_QueryInterface(supports);</span>
<a href="#l20.107"></a><span id="l20.107">     if (msgHdr &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l20.108"></a><span id="l20.108">       rv = AddMsgRefsToHash(msgHdr);</span>
<a href="#l20.109"></a><span id="l20.109">     if (NS_FAILED(rv))</span>
<a href="#l20.110"></a><span id="l20.110">       break;</span>
<a href="#l20.111"></a><span id="l20.111">   }</span>
<a href="#l20.112"></a><span id="l20.112"> </span>
<a href="#l20.113"></a><span id="l20.113">   return rv;</span>
<a href="#l20.114"></a><span id="l20.114"> }</span>
<a href="#l20.115"></a><span id="l20.115" class="difflineat">@@ -5045,19 +5050,20 @@ nsresult nsMsgDatabase::DumpThread(nsMsg</span>
<a href="#l20.116"></a><span id="l20.116">     rv = thread-&gt;EnumerateMessages(nsMsgKey_None, &amp;enumerator);</span>
<a href="#l20.117"></a><span id="l20.117">     if (NS_SUCCEEDED(rv) &amp;&amp; enumerator)</span>
<a href="#l20.118"></a><span id="l20.118">     {</span>
<a href="#l20.119"></a><span id="l20.119">       bool hasMore = false;</span>
<a href="#l20.120"></a><span id="l20.120"> </span>
<a href="#l20.121"></a><span id="l20.121">       while (NS_SUCCEEDED(rv = enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp;</span>
<a href="#l20.122"></a><span id="l20.122">              hasMore)</span>
<a href="#l20.123"></a><span id="l20.123">       {</span>
<a href="#l20.124"></a><span id="l20.124" class="difflineminus">-        nsCOMPtr &lt;nsIMsgDBHdr&gt; pMessage;</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineminus">-        rv = enumerator-&gt;GetNext(getter_AddRefs(pMessage));</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineplus">+        nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l20.127"></a><span id="l20.127" class="difflineplus">+        rv = enumerator-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l20.128"></a><span id="l20.128">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l20.129"></a><span id="l20.129" class="difflineplus">+        nsCOMPtr &lt;nsIMsgDBHdr&gt; pMessage = do_QueryInterface(supports);</span>
<a href="#l20.130"></a><span id="l20.130">         if (NS_FAILED(rv) || !pMessage)</span>
<a href="#l20.131"></a><span id="l20.131">           break;</span>
<a href="#l20.132"></a><span id="l20.132">       }</span>
<a href="#l20.133"></a><span id="l20.133">       NS_RELEASE(enumerator);</span>
<a href="#l20.134"></a><span id="l20.134"> </span>
<a href="#l20.135"></a><span id="l20.135">     }</span>
<a href="#l20.136"></a><span id="l20.136">   }</span>
<a href="#l20.137"></a><span id="l20.137">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsNewsDatabase.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsNewsDatabase.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -252,25 +252,28 @@ nsresult nsNewsDatabase::SyncWithReadSet</span>
<a href="#l21.4"></a><span id="l21.4">   // of read/unread flags to match the read set in the .newsrc file. It should</span>
<a href="#l21.5"></a><span id="l21.5">   // only be called when they don't match, e.g., we crashed after committing the</span>
<a href="#l21.6"></a><span id="l21.6">   // db but before writing out the .newsrc</span>
<a href="#l21.7"></a><span id="l21.7">   nsCOMPtr &lt;nsISimpleEnumerator&gt; hdrs;</span>
<a href="#l21.8"></a><span id="l21.8">   nsresult rv = EnumerateMessages(getter_AddRefs(hdrs));</span>
<a href="#l21.9"></a><span id="l21.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11">   bool hasMore = false, readInNewsrc, isReadInDB, changed = false;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  nsCOMPtr &lt;nsIMsgDBHdr&gt; header;</span>
<a href="#l21.13"></a><span id="l21.13">   int32_t numMessages = 0, numUnreadMessages = 0;</span>
<a href="#l21.14"></a><span id="l21.14">   nsMsgKey messageKey;</span>
<a href="#l21.15"></a><span id="l21.15">   nsCOMPtr &lt;nsIMsgThread&gt; threadHdr;</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17">   // Scan all messages in DB</span>
<a href="#l21.18"></a><span id="l21.18">   while (NS_SUCCEEDED(rv = hdrs-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l21.19"></a><span id="l21.19">   {</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineminus">-      rv = hdrs-&gt;GetNext(getter_AddRefs(header));</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+      nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+      rv = hdrs-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+      nsCOMPtr &lt;nsIMsgDBHdr&gt; header = do_QueryInterface(supports, &amp;rv);</span>
<a href="#l21.26"></a><span id="l21.26">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28">       rv = nsMsgDatabase::IsHeaderRead(header, &amp;isReadInDB);</span>
<a href="#l21.29"></a><span id="l21.29">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.30"></a><span id="l21.30"> </span>
<a href="#l21.31"></a><span id="l21.31">       header-&gt;GetMessageKey(&amp;messageKey);</span>
<a href="#l21.32"></a><span id="l21.32">       IsRead(messageKey,&amp;readInNewsrc);</span>
<a href="#l21.33"></a><span id="l21.33"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -136,18 +136,20 @@ nsresult RecursiveCopy(nsIFile* srcDir, </span>
<a href="#l22.4"></a><span id="l22.4"> </span>
<a href="#l22.5"></a><span id="l22.5">   rv = dirIterator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l22.6"></a><span id="l22.6">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">   nsCOMPtr&lt;nsIFile&gt; dirEntry;</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10">   while (hasMore)</span>
<a href="#l22.11"></a><span id="l22.11">   {</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    rv = dirIterator-&gt;GetNext((nsISupports**)getter_AddRefs(dirEntry));</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+    nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+    rv = dirIterator-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+    dirEntry = do_QueryInterface(supports);</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; dirEntry)</span>
<a href="#l22.18"></a><span id="l22.18">     {</span>
<a href="#l22.19"></a><span id="l22.19">       rv = dirEntry-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l22.20"></a><span id="l22.20">       if (NS_SUCCEEDED(rv))</span>
<a href="#l22.21"></a><span id="l22.21">       {</span>
<a href="#l22.22"></a><span id="l22.22">         if (isDir)</span>
<a href="#l22.23"></a><span id="l22.23">         {</span>
<a href="#l22.24"></a><span id="l22.24">           nsCOMPtr&lt;nsIFile&gt; newChild;</span>
<a href="#l22.25"></a><span id="l22.25">           rv = destDir-&gt;Clone(getter_AddRefs(newChild));</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineat">@@ -442,18 +444,20 @@ nsresult nsImapMailFolder::CreateSubFold</span>
<a href="#l22.27"></a><span id="l22.27">   rv = path-&gt;GetDirectoryEntries(getter_AddRefs(children));</span>
<a href="#l22.28"></a><span id="l22.28">   bool more = false;</span>
<a href="#l22.29"></a><span id="l22.29">   if (children)</span>
<a href="#l22.30"></a><span id="l22.30">     children-&gt;HasMoreElements(&amp;more);</span>
<a href="#l22.31"></a><span id="l22.31">   nsCOMPtr&lt;nsIFile&gt; dirEntry;</span>
<a href="#l22.32"></a><span id="l22.32"> </span>
<a href="#l22.33"></a><span id="l22.33">   while (more)</span>
<a href="#l22.34"></a><span id="l22.34">   {</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">-    rv = children-&gt;GetNext((nsISupports**) getter_AddRefs(dirEntry));</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+    nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+    rv = children-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+    dirEntry = do_QueryInterface(supports);</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+    if (NS_FAILED(rv) || !dirEntry)</span>
<a href="#l22.41"></a><span id="l22.41">       break;</span>
<a href="#l22.42"></a><span id="l22.42">     rv = children-&gt;HasMoreElements(&amp;more);</span>
<a href="#l22.43"></a><span id="l22.43">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l22.44"></a><span id="l22.44"> </span>
<a href="#l22.45"></a><span id="l22.45">     nsCOMPtr &lt;nsIFile&gt; currentFolderPath = do_QueryInterface(dirEntry);</span>
<a href="#l22.46"></a><span id="l22.46">     currentFolderPath-&gt;GetLeafName(currentFolderNameStr);</span>
<a href="#l22.47"></a><span id="l22.47">     if (nsShouldIgnoreFile(currentFolderNameStr))</span>
<a href="#l22.48"></a><span id="l22.48">       continue;</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineat">@@ -1279,18 +1283,22 @@ NS_IMETHODIMP nsImapMailFolder::ApplyRet</span>
<a href="#l22.50"></a><span id="l22.50">     PRTime cutOffDay =</span>
<a href="#l22.51"></a><span id="l22.51">       MsgConvertAgeInDaysToCutoffDate(numDaysToKeepOfflineMsgs);</span>
<a href="#l22.52"></a><span id="l22.52"> </span>
<a href="#l22.53"></a><span id="l22.53">     nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l22.54"></a><span id="l22.54">     // so now cutOffDay is the PRTime cut-off point. Any offline msg with </span>
<a href="#l22.55"></a><span id="l22.55">     // a date less than that will get marked for pending removal.</span>
<a href="#l22.56"></a><span id="l22.56">     while (NS_SUCCEEDED(rv = hdrs-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l22.57"></a><span id="l22.57">     {</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineminus">-      rv = hdrs-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineplus">+      nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineplus">+      rv = hdrs-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l22.61"></a><span id="l22.61">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineplus">+      pHeader = do_QueryInterface(supports, &amp;rv);</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineplus">+</span>
<a href="#l22.65"></a><span id="l22.65">       uint32_t msgFlags;</span>
<a href="#l22.66"></a><span id="l22.66">       PRTime msgDate;</span>
<a href="#l22.67"></a><span id="l22.67">       pHeader-&gt;GetFlags(&amp;msgFlags);</span>
<a href="#l22.68"></a><span id="l22.68">       if (msgFlags &amp; nsMsgMessageFlags::Offline)</span>
<a href="#l22.69"></a><span id="l22.69">       {</span>
<a href="#l22.70"></a><span id="l22.70">         pHeader-&gt;GetDate(&amp;msgDate);</span>
<a href="#l22.71"></a><span id="l22.71">         MarkPendingRemoval(pHeader, msgDate &lt; cutOffDay);</span>
<a href="#l22.72"></a><span id="l22.72">         // I'm horribly tempted to break out of the loop if we've found</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineat">@@ -2585,18 +2593,20 @@ nsresult nsImapMailFolder::GetBodysToDow</span>
<a href="#l22.74"></a><span id="l22.74"> </span>
<a href="#l22.75"></a><span id="l22.75">   nsCOMPtr &lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l22.76"></a><span id="l22.76">   nsresult rv = mDatabase-&gt;EnumerateMessages(getter_AddRefs(enumerator));</span>
<a href="#l22.77"></a><span id="l22.77">   if (NS_SUCCEEDED(rv) &amp;&amp; enumerator)</span>
<a href="#l22.78"></a><span id="l22.78">   {</span>
<a href="#l22.79"></a><span id="l22.79">     bool hasMore;</span>
<a href="#l22.80"></a><span id="l22.80">     while (NS_SUCCEEDED(rv = enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l22.81"></a><span id="l22.81">     {</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineminus">-      nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineminus">-      rv = enumerator-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineplus">+      nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l22.85"></a><span id="l22.85" class="difflineplus">+      rv = enumerator-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l22.86"></a><span id="l22.86" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.87"></a><span id="l22.87" class="difflineplus">+      nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader = do_QueryInterface(supports, &amp;rv);</span>
<a href="#l22.88"></a><span id="l22.88">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.89"></a><span id="l22.89">       bool shouldStoreMsgOffline = false;</span>
<a href="#l22.90"></a><span id="l22.90">       nsMsgKey msgKey;</span>
<a href="#l22.91"></a><span id="l22.91">       pHeader-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l22.92"></a><span id="l22.92">       // MsgFitsDownloadCriteria ignores nsMsgFolderFlags::Offline, which we want</span>
<a href="#l22.93"></a><span id="l22.93">       if (m_downloadingFolderForOfflineUse)</span>
<a href="#l22.94"></a><span id="l22.94">         MsgFitsDownloadCriteria(msgKey, &amp;shouldStoreMsgOffline);</span>
<a href="#l22.95"></a><span id="l22.95">       else</span>
<a href="#l22.96"></a><span id="l22.96" class="difflineat">@@ -4210,17 +4220,20 @@ void nsImapMailFolder::FindKeysToDelete(</span>
<a href="#l22.97"></a><span id="l22.97">       // tell from the expunge response which messages were deleted.</span>
<a href="#l22.98"></a><span id="l22.98">       nsCOMPtr &lt;nsISimpleEnumerator&gt; hdrs;</span>
<a href="#l22.99"></a><span id="l22.99">       nsresult rv = GetMessages(getter_AddRefs(hdrs));</span>
<a href="#l22.100"></a><span id="l22.100">       NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l22.101"></a><span id="l22.101">       bool hasMore = false;</span>
<a href="#l22.102"></a><span id="l22.102">       nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l22.103"></a><span id="l22.103">       while (NS_SUCCEEDED(rv = hdrs-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l22.104"></a><span id="l22.104">       {</span>
<a href="#l22.105"></a><span id="l22.105" class="difflineminus">-        rv = hdrs-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l22.106"></a><span id="l22.106" class="difflineplus">+        nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l22.107"></a><span id="l22.107" class="difflineplus">+        rv = hdrs-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineplus">+        NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l22.109"></a><span id="l22.109" class="difflineplus">+        pHeader = do_QueryInterface(supports, &amp;rv);</span>
<a href="#l22.110"></a><span id="l22.110">         NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l22.111"></a><span id="l22.111">         uint32_t msgFlags;</span>
<a href="#l22.112"></a><span id="l22.112">         pHeader-&gt;GetFlags(&amp;msgFlags);</span>
<a href="#l22.113"></a><span id="l22.113">         if (msgFlags &amp; nsMsgMessageFlags::IMAPDeleted)</span>
<a href="#l22.114"></a><span id="l22.114">         {</span>
<a href="#l22.115"></a><span id="l22.115">           nsMsgKey msgKey;</span>
<a href="#l22.116"></a><span id="l22.116">           pHeader-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l22.117"></a><span id="l22.117">           keysToDelete.AppendElement(msgKey);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/import/src/nsImportService.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/import/src/nsImportService.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -423,27 +423,32 @@ nsresult nsImportService::DoDiscover(voi</span>
<a href="#l23.4"></a><span id="l23.4">   nsresult rv;</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6">   nsCOMPtr&lt;nsICategoryManager&gt; catMan = do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l23.7"></a><span id="l23.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9">   nsCOMPtr&lt;nsISimpleEnumerator&gt; e;</span>
<a href="#l23.10"></a><span id="l23.10">   rv = catMan-&gt;EnumerateCategory(&quot;mailnewsimport&quot;, getter_AddRefs(e));</span>
<a href="#l23.11"></a><span id="l23.11">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l23.13"></a><span id="l23.13">   nsCOMPtr&lt;nsISupportsCString&gt; contractid;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-  rv = e-&gt;GetNext(getter_AddRefs(contractid));</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-  while (NS_SUCCEEDED(rv) &amp;&amp; contractid)</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+  rv = e-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+  while (NS_SUCCEEDED(rv) &amp;&amp; supports)</span>
<a href="#l23.18"></a><span id="l23.18">   {</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineplus">+    contractid = do_QueryInterface(supports);</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineplus">+    if (!contractid)</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineplus">+      break;</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineplus">+</span>
<a href="#l23.23"></a><span id="l23.23">     nsCString contractIdStr;</span>
<a href="#l23.24"></a><span id="l23.24">     contractid-&gt;ToString(getter_Copies(contractIdStr));</span>
<a href="#l23.25"></a><span id="l23.25">     nsCString supportsStr;</span>
<a href="#l23.26"></a><span id="l23.26">     rv = catMan-&gt;GetCategoryEntry(&quot;mailnewsimport&quot;, contractIdStr.get(), getter_Copies(supportsStr));</span>
<a href="#l23.27"></a><span id="l23.27">     if (NS_SUCCEEDED(rv))</span>
<a href="#l23.28"></a><span id="l23.28">       LoadModuleInfo(contractIdStr.get(), supportsStr.get());</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineminus">-    rv = e-&gt;GetNext(getter_AddRefs(contractid));</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineplus">+    rv = e-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l23.31"></a><span id="l23.31">   }</span>
<a href="#l23.32"></a><span id="l23.32"> </span>
<a href="#l23.33"></a><span id="l23.33">   m_didDiscovery = true;</span>
<a href="#l23.34"></a><span id="l23.34"> </span>
<a href="#l23.35"></a><span id="l23.35">   return NS_OK;</span>
<a href="#l23.36"></a><span id="l23.36"> }</span>
<a href="#l23.37"></a><span id="l23.37"> </span>
<a href="#l23.38"></a><span id="l23.38"> nsresult nsImportService::LoadModuleInfo(const char *pClsId, const char *pSupports)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMUtils.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMUtils.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -96,18 +96,21 @@ nsWMUtils::GetOEAccountFilesInFolder(nsI</span>
<a href="#l24.4"></a><span id="l24.4"> {</span>
<a href="#l24.5"></a><span id="l24.5">   nsCOMPtr&lt;nsISimpleEnumerator&gt; entries;</span>
<a href="#l24.6"></a><span id="l24.6">   nsresult rv = aFolder-&gt;GetDirectoryEntries(getter_AddRefs(entries));</span>
<a href="#l24.7"></a><span id="l24.7">   if (NS_FAILED(rv) || !entries)</span>
<a href="#l24.8"></a><span id="l24.8">     return NS_ERROR_FAILURE;</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10">   bool hasMore;</span>
<a href="#l24.11"></a><span id="l24.11">   while (NS_SUCCEEDED(entries-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    nsCOMPtr&lt;nsIFile&gt; file;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-    rv = entries-&gt;GetNext(getter_AddRefs(file));</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+    nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+    rv = entries-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; file = do_QueryInterface(supports);</span>
<a href="#l24.19"></a><span id="l24.19">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.20"></a><span id="l24.20"> </span>
<a href="#l24.21"></a><span id="l24.21">     bool isDirectory;</span>
<a href="#l24.22"></a><span id="l24.22">     rv = file-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l24.23"></a><span id="l24.23">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.24"></a><span id="l24.24"> </span>
<a href="#l24.25"></a><span id="l24.25">     if (isDirectory) {</span>
<a href="#l24.26"></a><span id="l24.26">       GetOEAccountFilesInFolder(file, aFileArray);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -1730,19 +1730,20 @@ NS_IMETHODIMP nsMsgNewsFolder::DownloadA</span>
<a href="#l25.4"></a><span id="l25.4">   {</span>
<a href="#l25.5"></a><span id="l25.5">     nsCOMPtr &lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l25.6"></a><span id="l25.6">     rv = mDatabase-&gt;EnumerateMessages(getter_AddRefs(enumerator));</span>
<a href="#l25.7"></a><span id="l25.7">     if (NS_SUCCEEDED(rv) &amp;&amp; enumerator)</span>
<a href="#l25.8"></a><span id="l25.8">     {</span>
<a href="#l25.9"></a><span id="l25.9">       bool hasMore;</span>
<a href="#l25.10"></a><span id="l25.10">       while (NS_SUCCEEDED(rv = enumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l25.11"></a><span id="l25.11">       {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-        rv = enumerator-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+        nsCOMPtr &lt;nsISupports&gt; supports;</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+        rv = enumerator-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l25.16"></a><span id="l25.16">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+        nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader = do_QueryInterface(supports);</span>
<a href="#l25.18"></a><span id="l25.18">         if (pHeader &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l25.19"></a><span id="l25.19">         {</span>
<a href="#l25.20"></a><span id="l25.20">           bool shouldStoreMsgOffline = false;</span>
<a href="#l25.21"></a><span id="l25.21">           nsMsgKey msgKey;</span>
<a href="#l25.22"></a><span id="l25.22">           pHeader-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l25.23"></a><span id="l25.23">           MsgFitsDownloadCriteria(msgKey, &amp;shouldStoreMsgOffline);</span>
<a href="#l25.24"></a><span id="l25.24">           if (shouldStoreMsgOffline)</span>
<a href="#l25.25"></a><span id="l25.25">             srcKeyArray.AppendElement(msgKey);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

