<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 593:228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609" />
<meta property="og:url" content="/comm-central/rev/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609" />
<meta property="og:description" content="Bug 457695 Drop old xpfe autocomplete based local address book search code. r/sr=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609">shortlog</a> |
<a href="/comm-central/log/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609">files</a> |
changeset |
<a href="/comm-central/raw-rev/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609">raw</a>  | <a href="/comm-central/archive/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=457695">Bug 457695</a> Drop old xpfe autocomplete based local address book search code. r/sr=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 13 Oct 2008 12:43:52 +0100</td></tr>

<tr>
 <td>changeset 593</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609">228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609</a></td>
</tr>



<tr>
<td>parent 592</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c2ce3f2385745de594a6c097cbb26e96cc9906f5">c2ce3f2385745de594a6c097cbb26e96cc9906f5</a>
</td>
</tr>

<tr>
<td>child 594</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8ce2707a3de4c366a2307eef9d7f6f22e09abe15">8ce2707a3de4c366a2307eef9d7f6f22e09abe15</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609">525</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 13 Oct 2008 11:44:31 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@228194fc0c36 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609&newProject=comm-central&newRevision=c2ce3f2385745de594a6c097cbb26e96cc9906f5&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609&newProject=comm-central&newRevision=c2ce3f2385745de594a6c097cbb26e96cc9906f5&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609&newProject=comm-central&newRevision=c2ce3f2385745de594a6c097cbb26e96cc9906f5&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=457695">457695</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=457695">Bug 457695</a> Drop old xpfe autocomplete based local address book search code. r/sr=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/build/nsAbFactory.cpp">mailnews/addrbook/build/nsAbFactory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/build/nsAbFactory.cpp">file</a> |
<a href="/comm-central/annotate/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/build/nsAbFactory.cpp">annotate</a> |
<a href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/build/nsAbFactory.cpp">diff</a> |
<a href="/comm-central/comparison/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/build/nsAbFactory.cpp">comparison</a> |
<a href="/comm-central/log/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/build/nsAbFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/public/nsAbBaseCID.h">mailnews/addrbook/public/nsAbBaseCID.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/public/nsAbBaseCID.h">file</a> |
<a href="/comm-central/annotate/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/public/nsAbBaseCID.h">annotate</a> |
<a href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/public/nsAbBaseCID.h">diff</a> |
<a href="/comm-central/comparison/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/public/nsAbBaseCID.h">comparison</a> |
<a href="/comm-central/log/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/public/nsAbBaseCID.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/Makefile.in">mailnews/addrbook/src/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/Makefile.in">file</a> |
<a href="/comm-central/annotate/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/Makefile.in">annotate</a> |
<a href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/nsAbAutoCompleteSession.cpp">mailnews/addrbook/src/nsAbAutoCompleteSession.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/nsAbAutoCompleteSession.cpp">diff</a> |
<a href="/comm-central/comparison/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/nsAbAutoCompleteSession.cpp">comparison</a> |
<a href="/comm-central/log/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/nsAbAutoCompleteSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/nsAbAutoCompleteSession.h">mailnews/addrbook/src/nsAbAutoCompleteSession.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/nsAbAutoCompleteSession.h">diff</a> |
<a href="/comm-central/comparison/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/nsAbAutoCompleteSession.h">comparison</a> |
<a href="/comm-central/log/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/addrbook/src/nsAbAutoCompleteSession.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/build/nsMailModule.cpp">mailnews/build/nsMailModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/build/nsMailModule.cpp">file</a> |
<a href="/comm-central/annotate/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/build/nsMailModule.cpp">annotate</a> |
<a href="/comm-central/diff/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/build/nsMailModule.cpp">diff</a> |
<a href="/comm-central/comparison/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/build/nsMailModule.cpp">comparison</a> |
<a href="/comm-central/log/228194fc0c36ee9b3bc1622e4ffdd5bc94e8c609/mailnews/build/nsMailModule.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/build/nsAbFactory.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/build/nsAbFactory.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -54,17 +54,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #include &quot;nsAbMDBDirectory.h&quot;</span>
<a href="#l1.5"></a><span id="l1.5"> #include &quot;nsAbMDBCard.h&quot;</span>
<a href="#l1.6"></a><span id="l1.6"> #include &quot;nsAbDirFactoryService.h&quot;</span>
<a href="#l1.7"></a><span id="l1.7"> #include &quot;nsAbMDBDirFactory.h&quot;</span>
<a href="#l1.8"></a><span id="l1.8"> #include &quot;nsAddrDatabase.h&quot;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsAbManager.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> #include &quot;nsAbContentHandler.h&quot;</span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsAbDirProperty.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-#include &quot;nsAbAutoCompleteSession.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13"> #include &quot;nsAbAddressCollecter.h&quot;</span>
<a href="#l1.14"></a><span id="l1.14"> #include &quot;nsAddbookProtocolHandler.h&quot;</span>
<a href="#l1.15"></a><span id="l1.15"> #include &quot;nsAddbookUrl.h&quot;</span>
<a href="#l1.16"></a><span id="l1.16"> #include &quot;nsCURILoader.h&quot;</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> #include &quot;nsAbDirectoryQuery.h&quot;</span>
<a href="#l1.19"></a><span id="l1.19"> #include &quot;nsAbBooleanExpression.h&quot;</span>
<a href="#l1.20"></a><span id="l1.20"> #include &quot;nsAbDirectoryQueryProxy.h&quot;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -104,17 +103,16 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbManag</span>
<a href="#l1.22"></a><span id="l1.22"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbContentHandler)</span>
<a href="#l1.23"></a><span id="l1.23"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbDirectoryDataSource,Init)</span>
<a href="#l1.24"></a><span id="l1.24"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbDirProperty)</span>
<a href="#l1.25"></a><span id="l1.25"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbCardProperty)</span>
<a href="#l1.26"></a><span id="l1.26"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbBSDirectory)</span>
<a href="#l1.27"></a><span id="l1.27"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBDirectory)</span>
<a href="#l1.28"></a><span id="l1.28"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBCard)</span>
<a href="#l1.29"></a><span id="l1.29"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddrDatabase)</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbAutoCompleteSession)</span>
<a href="#l1.31"></a><span id="l1.31"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbAddressCollecter,Init)</span>
<a href="#l1.32"></a><span id="l1.32"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddbookUrl)</span>
<a href="#l1.33"></a><span id="l1.33"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbDirFactoryService)</span>
<a href="#l1.34"></a><span id="l1.34"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBDirFactory)</span>
<a href="#l1.35"></a><span id="l1.35"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddbookProtocolHandler)</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37"> #if defined(XP_WIN) &amp;&amp; !defined(__MINGW32__)</span>
<a href="#l1.38"></a><span id="l1.38"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbOutlookDirectory)</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineat">@@ -224,20 +222,16 @@ static const nsModuleComponentInfo compo</span>
<a href="#l1.40"></a><span id="l1.40">     NS_ABCARDPROPERTY_CID,</span>
<a href="#l1.41"></a><span id="l1.41">     NS_ABCARDPROPERTY_CONTRACTID,</span>
<a href="#l1.42"></a><span id="l1.42">     nsAbCardPropertyConstructor },</span>
<a href="#l1.43"></a><span id="l1.43"> </span>
<a href="#l1.44"></a><span id="l1.44">   { &quot;Address Book Directory Property&quot;,</span>
<a href="#l1.45"></a><span id="l1.45">     NS_ABDIRPROPERTY_CID,</span>
<a href="#l1.46"></a><span id="l1.46">     NS_ABDIRPROPERTY_CONTRACTID,</span>
<a href="#l1.47"></a><span id="l1.47">     nsAbDirPropertyConstructor },</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-  { &quot;Address Book Auto Complete Session&quot;,</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-    NS_ABAUTOCOMPLETESESSION_CID,</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-    NS_ABAUTOCOMPLETESESSION_CONTRACTID,</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-    nsAbAutoCompleteSessionConstructor },</span>
<a href="#l1.52"></a><span id="l1.52">   { &quot;Address Book Address Collector&quot;,</span>
<a href="#l1.53"></a><span id="l1.53">     NS_ABADDRESSCOLLECTER_CID,</span>
<a href="#l1.54"></a><span id="l1.54">     NS_ABADDRESSCOLLECTER_CONTRACTID,</span>
<a href="#l1.55"></a><span id="l1.55">     nsAbAddressCollecterConstructor },</span>
<a href="#l1.56"></a><span id="l1.56">   { &quot;The addbook URL Interface&quot;, </span>
<a href="#l1.57"></a><span id="l1.57">     NS_ADDBOOKURL_CID,</span>
<a href="#l1.58"></a><span id="l1.58">     NS_ADDBOOKURL_CONTRACTID,</span>
<a href="#l1.59"></a><span id="l1.59">     nsAddbookUrlConstructor },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/public/nsAbBaseCID.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsAbBaseCID.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -164,27 +164,16 @@</span>
<a href="#l2.4"></a><span id="l2.4">   &quot;@mozilla.org/addressbook/properties;1&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #define NS_ABDIRECTORYPROPERTIES_CID						\</span>
<a href="#l2.6"></a><span id="l2.6"> { /* 8b00a972-1dd2-11b2-9d9c-9c377a9c3dba */		\</span>
<a href="#l2.7"></a><span id="l2.7">     0x8b00a972, 0x1dd2, 0x11b2, \</span>
<a href="#l2.8"></a><span id="l2.8">     {0x9d, 0x9c, 0x9c, 0x37, 0x7a, 0x9c, 0x3d, 0xba} \</span>
<a href="#l2.9"></a><span id="l2.9"> }</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> //</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-// nsAbAutoCompleteSession</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-//</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-#define NS_ABAUTOCOMPLETESESSION_CONTRACTID \</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-  &quot;@mozilla.org/autocompleteSession;1?type=addrbook&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-#define NS_ABAUTOCOMPLETESESSION_CID				\</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-{ /* 138DE9BD-362B-11d3-988E-001083010E9B */		\</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-    0x138de9bd, 0x362b, 0x11d3,						\</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-    {0x98, 0x8e, 0x0, 0x10, 0x83, 0x1, 0xe, 0x9b}	\</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-}</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-//</span>
<a href="#l2.23"></a><span id="l2.23"> // nsAbAddressCollecter</span>
<a href="#l2.24"></a><span id="l2.24"> //</span>
<a href="#l2.25"></a><span id="l2.25"> #define NS_ABADDRESSCOLLECTER_CONTRACTID \</span>
<a href="#l2.26"></a><span id="l2.26">   &quot;@mozilla.org/addressbook/services/addressCollecter;1&quot;</span>
<a href="#l2.27"></a><span id="l2.27"> #define NS_ABADDRESSCOLLECTER_CID \</span>
<a href="#l2.28"></a><span id="l2.28"> {	/* fe04c8e6-501e-11d3-a527-0060b0fc04b7 */		\</span>
<a href="#l2.29"></a><span id="l2.29"> 	0xfe04c8e6, 0x501e, 0x11d3,						\</span>
<a href="#l2.30"></a><span id="l2.30"> 	{0xa5, 0x27, 0x0, 0x60, 0xb0, 0xfc, 0x4, 0xb7}	\</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/Makefile.in</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/Makefile.in</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -75,17 +75,16 @@ REQUIRES	= xpcom \</span>
<a href="#l3.4"></a><span id="l3.4"> CPPSRCS		= \</span>
<a href="#l3.5"></a><span id="l3.5"> 		nsAbManager.cpp \</span>
<a href="#l3.6"></a><span id="l3.6"> 		nsAbRDFDataSource.cpp \</span>
<a href="#l3.7"></a><span id="l3.7"> 		nsDirectoryDataSource.cpp \</span>
<a href="#l3.8"></a><span id="l3.8"> 		nsAbCardProperty.cpp \</span>
<a href="#l3.9"></a><span id="l3.9"> 		nsDirPrefs.cpp \</span>
<a href="#l3.10"></a><span id="l3.10"> 		nsAddrDatabase.cpp \</span>
<a href="#l3.11"></a><span id="l3.11"> 		nsAbDirProperty.cpp \</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-		nsAbAutoCompleteSession.cpp \</span>
<a href="#l3.13"></a><span id="l3.13"> 		nsAbAddressCollecter.cpp \</span>
<a href="#l3.14"></a><span id="l3.14"> 		nsAddbookProtocolHandler.cpp  \</span>
<a href="#l3.15"></a><span id="l3.15"> 		nsAbMDBDirProperty.cpp \</span>
<a href="#l3.16"></a><span id="l3.16"> 		nsAbMDBDirectory.cpp \</span>
<a href="#l3.17"></a><span id="l3.17"> 		nsAbMDBCard.cpp \</span>
<a href="#l3.18"></a><span id="l3.18"> 		nsAbBSDirectory.cpp \</span>
<a href="#l3.19"></a><span id="l3.19"> 		nsAddbookUrl.cpp    \</span>
<a href="#l3.20"></a><span id="l3.20"> 		nsAbDirFactoryService.cpp	\</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">deleted file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- a/mailnews/addrbook/src/nsAbAutoCompleteSession.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ /dev/null</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -1,715 +0,0 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">- *</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">- *</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">- * License.</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">- *</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">- *</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1999</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">- *</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">- *   Pierre Phaneuf &lt;pp@ludusdesign.com&gt;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">- *</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">- *</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-#include &quot;nsAbAutoCompleteSession.h&quot;</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-#include &quot;nsRDFCID.h&quot;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-#include &quot;nsIRDFService.h&quot;</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-#include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-#include &quot;prmem.h&quot;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-#include &quot;nsNetCID.h&quot;</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-#include &quot;nsIIOService.h&quot;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-#include &quot;nsIPrefService.h&quot;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-#include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-#include &quot;nsIAbMDBDirectory.h&quot;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-NS_IMPL_ISUPPORTS1(nsAbAutoCompleteSession, nsIAutoCompleteSession)</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-nsAbAutoCompleteSession::nsAbAutoCompleteSession()</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-{</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-    mParser = do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID);</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-}</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-nsAbAutoCompleteSession::~nsAbAutoCompleteSession()</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-{</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-}</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-PRBool nsAbAutoCompleteSession::ItsADuplicate(const nsString &amp;fullAddress,</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-                                              PRInt32 aPopularityIndex,</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-                                              nsIAutoCompleteResults* results)</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-{</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-    nsresult rv;</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-    nsCOMPtr&lt;nsISupportsArray&gt; array;</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-    rv = results-&gt;GetItems(getter_AddRefs(array));</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-    {</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-        nsCOMPtr&lt;nsIEnumerator&gt; enumerator;</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-        rv = array-&gt;Enumerate(getter_AddRefs(enumerator));</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-        {</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-            nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-            nsCOMPtr&lt;nsIAutoCompleteItem&gt; resultItem;</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-            nsAutoString valueStr;</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-            for (rv = enumerator-&gt;First(); NS_SUCCEEDED(rv); rv = enumerator-&gt;Next())</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-            {</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-                rv = enumerator-&gt;CurrentItem(getter_AddRefs(item));</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-                if (NS_SUCCEEDED(rv) &amp;&amp; item)</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-                {</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-                    resultItem = do_QueryInterface(item, &amp;rv);</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-                    if (NS_SUCCEEDED(rv))</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-                    {</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-                        rv = resultItem-&gt;GetValue(valueStr);</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineminus">-                        if (NS_SUCCEEDED(rv) &amp;&amp; !valueStr.IsEmpty() </span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-                            &amp;&amp; fullAddress.Equals(valueStr, nsCaseInsensitiveStringComparator()))</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-#else</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-                        if (NS_SUCCEEDED(rv) &amp;&amp; !valueStr.IsEmpty() </span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-                            &amp;&amp; fullAddress.Equals(valueStr, CaseInsensitiveCompare))</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-#endif</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-                        {</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-                          // ok, we have a duplicate, but before we ignore the dupe, check the popularity index</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-                          // and use the card that is the most popular so it gets sorted correctly</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-                          nsCOMPtr&lt;nsISupports&gt; currentItemParams;</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-                          rv = resultItem-&gt;GetParam(getter_AddRefs(currentItemParams));</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-                          if (NS_SUCCEEDED(rv))</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-                          {</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-                            nsAbAutoCompleteParam *param = (nsAbAutoCompleteParam *)(void *)currentItemParams;</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-                            if (aPopularityIndex &gt; param-&gt;mPopularityIndex)</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-                            {</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-                              // remove the current autocomplete result, and return false so our dupe</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-                              // gets added in its place.</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-                              array-&gt;RemoveElement(item);</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-                              break; </span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-                            }</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-                          }</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineminus">-</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineminus">-                          // it's a dupe, ignore it.</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineminus">-                          return PR_TRUE;</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineminus">-                        }</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineminus">-                    }</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-                }</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-            }</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-        }</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-    }</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-    </span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-    return PR_FALSE;</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-}</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-void </span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-nsAbAutoCompleteSession::AddToResult(const PRUnichar* pNickNameStr,</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-                                     const PRUnichar* pDisplayNameStr,</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-                                     const PRUnichar* pFirstNameStr,</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-                                     const PRUnichar* pLastNameStr,</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-                                     const PRUnichar* pEmailStr, </span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-                                     const PRUnichar* pNotesStr, </span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-                                     const PRUnichar* pDirName,</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-                                     PRUint32 aPopularityIndex,</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-                                     PRBool bIsMailList,</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineminus">-                                     nsIAutoCompleteResults* results)</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-{</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-  nsresult rv;</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-  nsString fullAddress;</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineminus">-  if (mParser)</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineminus">-  {</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineminus">-    nsString displayName(pDisplayNameStr);</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineminus">-    if (bIsMailList)</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineminus">-    {</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineminus">-      if (pNotesStr &amp;&amp; *pNotesStr)</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineminus">-        mParser-&gt;MakeFullAddress(displayName, nsDependentString(pNotesStr),</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-                                 fullAddress);</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-      else if (pDisplayNameStr)</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineminus">-        mParser-&gt;MakeFullAddress(displayName, displayName, fullAddress);</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-    }</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-    else if (pEmailStr)</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineminus">-      mParser-&gt;MakeFullAddress(displayName, nsDependentString(pEmailStr),</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineminus">-                               fullAddress);</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineminus">-  }</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineminus">-  </span>
<a href="#l4.162"></a><span id="l4.162" class="difflineminus">-  if (fullAddress.IsEmpty())</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineminus">-  {</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-    // oops, parser problem! I will try to do my best...</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-    const PRUnichar * pStr = nsnull;</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-    if (bIsMailList)</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-    {</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineminus">-      if (pNotesStr &amp;&amp; *pNotesStr)</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineminus">-        pStr = pNotesStr;</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineminus">-      else</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineminus">-        pStr = pDisplayNameStr;</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineminus">-    }</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineminus">-    else</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineminus">-      pStr = pEmailStr;</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineminus">-</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineminus">-    // check this so we do not get a bogus entry &quot;someName &lt;&gt;&quot;</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineminus">-    if (pStr &amp;&amp; *pStr) {</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineminus">-      fullAddress = pDisplayNameStr;</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineminus">-      fullAddress.AppendLiteral(&quot; &lt;&quot;);</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineminus">-      fullAddress += pStr;</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineminus">-      fullAddress.AppendLiteral(&quot;&gt;&quot;);</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineminus">-    }</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineminus">-  }</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineminus">-    </span>
<a href="#l4.185"></a><span id="l4.185" class="difflineminus">-  if (!fullAddress.IsEmpty() &amp;&amp;</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineminus">-      !ItsADuplicate(fullAddress, aPopularityIndex, results))</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineminus">-  {    </span>
<a href="#l4.188"></a><span id="l4.188" class="difflineminus">-    nsCOMPtr&lt;nsIAutoCompleteItem&gt; newItem = do_CreateInstance(NS_AUTOCOMPLETEITEM_CONTRACTID, &amp;rv);</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineminus">-    {</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineminus">-      nsAbAutoCompleteParam *param = new nsAbAutoCompleteParam(pNickNameStr, pDisplayNameStr, pFirstNameStr, pLastNameStr, pEmailStr, pNotesStr, pDirName, aPopularityIndex, bIsMailList);</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineminus">-      NS_IF_ADDREF(param);</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineminus">-      newItem-&gt;SetParam(param);</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineminus">-      NS_IF_RELEASE(param);</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineminus">-</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineminus">-      // how to process the comment column, if at all.  this value</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineminus">-      // comes from &quot;mail.autoComplete.commentColumn&quot;, or, if that</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineminus">-      // doesn't exist, defaults to 0</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineminus">-      //</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineminus">-      // 0 = none</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineminus">-      // 1 = name of addressbook this card came from</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-      // 2 = other per-addressbook format (currrently unused here)</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-      //</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-      if (mAutoCompleteCommentColumn == 1) {</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-        rv = newItem-&gt;SetComment(pDirName);</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-        if (NS_FAILED(rv)) {</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-          NS_WARNING(&quot;nsAbAutoCompleteSession::AddToResult():&quot;</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineminus">-                     &quot; newItem-&gt;SetComment() failed\n&quot;);</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineminus">-        }</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineminus">-      }</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineminus">-      rv = newItem-&gt;SetClassName(&quot;local-abook&quot;);</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineminus">-      if (NS_FAILED(rv)) {</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineminus">-        NS_WARNING(&quot;nsAbAutoCompleteSession::AddToResult():&quot;</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineminus">-                   &quot; newItem-&gt;SetClassName() failed\n&quot;);</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineminus">-      }</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineminus">-</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineminus">-      newItem-&gt;SetValue(fullAddress);</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineminus">-      nsCOMPtr&lt;nsISupportsArray&gt; array;</span>
<a href="#l4.220"></a><span id="l4.220" class="difflineminus">-      rv = results-&gt;GetItems(getter_AddRefs(array));</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineminus">-      if (NS_SUCCEEDED(rv))</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineminus">-      {</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineminus">-        PRUint32 nbrOfItems;      </span>
<a href="#l4.224"></a><span id="l4.224" class="difflineminus">-        rv = array-&gt;Count(&amp;nbrOfItems);</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineminus">-</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineminus">-        PRInt32 insertPosition = 0;</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineminus">-</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineminus">-        for (; insertPosition &lt; nbrOfItems; insertPosition++)</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineminus">-        {</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineminus">-          nsCOMPtr&lt;nsISupports&gt; currentItemParams;</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineminus">-          nsCOMPtr&lt;nsIAutoCompleteItem&gt; resultItem;</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineminus">-          nsresult rv = array-&gt;QueryElementAt(insertPosition, NS_GET_IID(nsIAutoCompleteItem),</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineminus">-                                           getter_AddRefs(resultItem));</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-          if (NS_FAILED(rv))</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-            continue;</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineminus">-          rv = resultItem-&gt;GetParam(getter_AddRefs(currentItemParams));</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineminus">-          if (NS_FAILED(rv))</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineminus">-            continue;</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineminus">-          param = (nsAbAutoCompleteParam *)(void *)currentItemParams;</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineminus">-          if (aPopularityIndex &gt; param-&gt;mPopularityIndex) // sort the search results by popularity index </span>
<a href="#l4.242"></a><span id="l4.242" class="difflineminus">-            break;</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineminus">-        }</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineminus">-</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineminus">-        rv = array-&gt;InsertElementAt(newItem, insertPosition);</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineminus">-      }</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineminus">-    }</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineminus">-  }    </span>
<a href="#l4.249"></a><span id="l4.249" class="difflineminus">-}</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineminus">-</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineminus">-static PRBool CommonPrefix(const PRUnichar *aString, const PRUnichar *aSubstr, PRInt32 aSubstrLen)</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineminus">-{</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineminus">-  if (!aSubstrLen || (NS_strlen(aString) &lt; static_cast&lt;PRUint32&gt;(aSubstrLen)))</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineminus">-    return PR_FALSE;</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineminus">-</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineminus">-#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineminus">-  return (Substring(aString,</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineminus">-                    aString+aSubstrLen).Equals(Substring(aSubstr, aSubstr+aSubstrLen),</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineminus">-                                               nsCaseInsensitiveStringComparator()));</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-#else</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-  return (Substring(aString,</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-                    aString+aSubstrLen).Equals(Substring(aSubstr, aSubstr+aSubstrLen),</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-                                               CaseInsensitiveCompare));</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-#endif</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-}</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-PRBool</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineminus">-nsAbAutoCompleteSession::CheckEntry(nsAbAutoCompleteSearchString* searchStr,</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineminus">-                                    const PRUnichar* nickName,</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">-                                    const PRUnichar* displayName,</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineminus">-                                    const PRUnichar* firstName,</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-                                    const PRUnichar* lastName,</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineminus">-                                    const PRUnichar* emailAddress)</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineminus">-{</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineminus">-  const PRUnichar * fullString;</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineminus">-  PRUint32 fullStringLen;</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineminus">-  PRBool isAMatch = PR_FALSE;</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineminus">-  </span>
<a href="#l4.280"></a><span id="l4.280" class="difflineminus">-  if (searchStr-&gt;mFirstPartLen &gt; 0 &amp;&amp; searchStr-&gt;mSecondPartLen == 0)</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineminus">-  {</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineminus">-    fullString = searchStr-&gt;mFirstPart;</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineminus">-    fullStringLen = searchStr-&gt;mFirstPartLen;</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineminus">-  }</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineminus">-  else</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineminus">-  {</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineminus">-    fullString = searchStr-&gt;mFullString;</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineminus">-    fullStringLen = searchStr-&gt;mFullStringLen;</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineminus">-  }</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineminus">-</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineminus">-  nsDependentString fullStringStr(fullString, fullStringLen);</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineminus">-  </span>
<a href="#l4.293"></a><span id="l4.293" class="difflineminus">-  // Compare various properties looking for a match (exact or partial)</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineminus">-#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineminus">-  if ( (nickName &amp;&amp;</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineminus">-        fullStringStr.Equals(nsDependentString(nickName), nsCaseInsensitiveStringComparator())) || </span>
<a href="#l4.297"></a><span id="l4.297" class="difflineminus">-       (displayName &amp;&amp;</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineminus">-        fullStringStr.Equals(nsDependentString(displayName), nsCaseInsensitiveStringComparator())) ||</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineminus">-       (firstName &amp;&amp;</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineminus">-        fullStringStr.Equals(nsDependentString(firstName), nsCaseInsensitiveStringComparator())) ||</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineminus">-       (lastName &amp;&amp;</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineminus">-        fullStringStr.Equals(nsDependentString(lastName), nsCaseInsensitiveStringComparator())) || </span>
<a href="#l4.303"></a><span id="l4.303" class="difflineminus">-       (emailAddress &amp;&amp;</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineminus">-        fullStringStr.Equals(nsDependentString(emailAddress), nsCaseInsensitiveStringComparator())) ||</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineminus">-       (nickName &amp;&amp; CommonPrefix(nickName, fullString, fullStringLen)) ||</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-       (displayName &amp;&amp; CommonPrefix(displayName, fullString, fullStringLen)) || </span>
<a href="#l4.307"></a><span id="l4.307" class="difflineminus">-       (firstName &amp;&amp; CommonPrefix(firstName, fullString, fullStringLen)) ||</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-       (lastName &amp;&amp; CommonPrefix(lastName, fullString, fullStringLen)) ||</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-       (emailAddress &amp;&amp; CommonPrefix(emailAddress, fullString, fullStringLen)) )</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-#else</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-  if ( (nickName &amp;&amp;</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-        fullStringStr.Equals(nsDependentString(nickName), CaseInsensitiveCompare)) || </span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-       (displayName &amp;&amp;</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-        fullStringStr.Equals(nsDependentString(displayName), CaseInsensitiveCompare)) ||</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-       (firstName &amp;&amp;</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-        fullStringStr.Equals(nsDependentString(firstName), CaseInsensitiveCompare)) ||</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-       (lastName &amp;&amp;</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-        fullStringStr.Equals(nsDependentString(lastName), CaseInsensitiveCompare)) || </span>
<a href="#l4.319"></a><span id="l4.319" class="difflineminus">-       (emailAddress &amp;&amp;</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineminus">-        fullStringStr.Equals(nsDependentString(emailAddress), CaseInsensitiveCompare)) ||</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineminus">-       (nickName &amp;&amp; CommonPrefix(nickName, fullString, fullStringLen)) ||</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineminus">-       (displayName &amp;&amp; CommonPrefix(displayName, fullString, fullStringLen)) || </span>
<a href="#l4.323"></a><span id="l4.323" class="difflineminus">-       (firstName &amp;&amp; CommonPrefix(firstName, fullString, fullStringLen)) ||</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineminus">-       (lastName &amp;&amp; CommonPrefix(lastName, fullString, fullStringLen)) ||</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineminus">-       (emailAddress &amp;&amp; CommonPrefix(emailAddress, fullString, fullStringLen)) )</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineminus">-#endif</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineminus">-</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineminus">-    isAMatch = PR_TRUE;</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineminus">-  //If we have a muti-part search string, look for a partial match with first name and last name or reverse</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineminus">-  else if (searchStr-&gt;mFirstPartLen &amp;&amp; searchStr-&gt;mSecondPartLen)</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineminus">-  {</span>
<a href="#l4.332"></a><span id="l4.332" class="difflineminus">-    if (((firstName &amp;&amp; CommonPrefix(firstName, searchStr-&gt;mFirstPart, searchStr-&gt;mFirstPartLen)) &amp;&amp;</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineminus">-        (lastName &amp;&amp; CommonPrefix(lastName, searchStr-&gt;mSecondPart, searchStr-&gt;mSecondPartLen))) ||</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineminus">-        ((lastName &amp;&amp; CommonPrefix(lastName, searchStr-&gt;mFirstPart, searchStr-&gt;mFirstPartLen)) &amp;&amp;</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineminus">-        (firstName &amp;&amp; CommonPrefix(firstName, searchStr-&gt;mSecondPart, searchStr-&gt;mSecondPartLen))))</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineminus">-      isAMatch = PR_TRUE;</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineminus">-  }</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineminus">-</span>
<a href="#l4.339"></a><span id="l4.339" class="difflineminus">-  return isAMatch;</span>
<a href="#l4.340"></a><span id="l4.340" class="difflineminus">-}</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineminus">-</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineminus">-nsresult nsAbAutoCompleteSession::SearchCards(nsIAbDirectory* directory, nsAbAutoCompleteSearchString* searchStr, nsIAutoCompleteResults* results)</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineminus">-{</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineminus">-  nsresult rv;    </span>
<a href="#l4.345"></a><span id="l4.345" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; cardsEnumerator;</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineminus">-  nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineminus">-  PRInt32 i;</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineminus">-  </span>
<a href="#l4.349"></a><span id="l4.349" class="difflineminus">-  rv = directory-&gt;GetChildCards(getter_AddRefs(cardsEnumerator));</span>
<a href="#l4.350"></a><span id="l4.350" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; cardsEnumerator)</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineminus">-  {</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineminus">-    nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineminus">-    PRBool more;</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineminus">-    while (NS_SUCCEEDED(cardsEnumerator-&gt;HasMoreElements(&amp;more)) &amp;&amp; more)</span>
<a href="#l4.355"></a><span id="l4.355" class="difflineminus">-    {</span>
<a href="#l4.356"></a><span id="l4.356" class="difflineminus">-      rv = cardsEnumerator-&gt;GetNext(getter_AddRefs(item));</span>
<a href="#l4.357"></a><span id="l4.357" class="difflineminus">-      if (NS_SUCCEEDED(rv))</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineminus">-      {</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineminus">-        card = do_QueryInterface(item, &amp;rv);</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineminus">-        {</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineminus">-          nsString pEmailStr[MAX_NUMBER_OF_EMAIL_ADDRESSES]; //[0]=primary email, [1]=secondary email (no available with mailing list)</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineminus">-          nsString pDisplayNameStr;</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineminus">-          nsString pFirstNameStr;</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineminus">-          nsString pLastNameStr;</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineminus">-          nsString pNickNameStr;</span>
<a href="#l4.367"></a><span id="l4.367" class="difflineminus">-          nsString pNotesStr;</span>
<a href="#l4.368"></a><span id="l4.368" class="difflineminus">-          PRUint32 popularityIndex = 0;</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineminus">-          PRBool bIsMailList;</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineminus">-</span>
<a href="#l4.371"></a><span id="l4.371" class="difflineminus">-          rv = card-&gt;GetIsMailList(&amp;bIsMailList);</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineminus">-          if (NS_FAILED(rv))</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineminus">-            continue;</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineminus">-          if (bIsMailList)</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineminus">-          {</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineminus">-            rv = card-&gt;GetPropertyAsAString(kNotesProperty, pNotesStr);</span>
<a href="#l4.377"></a><span id="l4.377" class="difflineminus">-            if (NS_FAILED(rv))</span>
<a href="#l4.378"></a><span id="l4.378" class="difflineminus">-              continue;</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineminus">-          }</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineminus">-          else</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineminus">-          {</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineminus">-            for (i = 0 ; i &lt; MAX_NUMBER_OF_EMAIL_ADDRESSES; i ++)</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineminus">-            {</span>
<a href="#l4.384"></a><span id="l4.384" class="difflineminus">-              switch (i)</span>
<a href="#l4.385"></a><span id="l4.385" class="difflineminus">-              {</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineminus">-                case 0:</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineminus">-                  rv = card-&gt;GetPrimaryEmail(pEmailStr[i]);</span>
<a href="#l4.388"></a><span id="l4.388" class="difflineminus">-                  break;</span>
<a href="#l4.389"></a><span id="l4.389" class="difflineminus">-                case 1:</span>
<a href="#l4.390"></a><span id="l4.390" class="difflineminus">-                  rv = card-&gt;GetPropertyAsAString(k2ndEmailProperty, pEmailStr[i]);</span>
<a href="#l4.391"></a><span id="l4.391" class="difflineminus">-                  break;</span>
<a href="#l4.392"></a><span id="l4.392" class="difflineminus">-                default:</span>
<a href="#l4.393"></a><span id="l4.393" class="difflineminus">-                  return NS_ERROR_FAILURE;</span>
<a href="#l4.394"></a><span id="l4.394" class="difflineminus">-              }</span>
<a href="#l4.395"></a><span id="l4.395" class="difflineminus">-              if (NS_FAILED(rv))</span>
<a href="#l4.396"></a><span id="l4.396" class="difflineminus">-                continue;</span>
<a href="#l4.397"></a><span id="l4.397" class="difflineminus">-</span>
<a href="#l4.398"></a><span id="l4.398" class="difflineminus">-              // Don't bother with card without an email address</span>
<a href="#l4.399"></a><span id="l4.399" class="difflineminus">-              if (pEmailStr[i].IsEmpty())</span>
<a href="#l4.400"></a><span id="l4.400" class="difflineminus">-                continue;</span>
<a href="#l4.401"></a><span id="l4.401" class="difflineminus">-</span>
<a href="#l4.402"></a><span id="l4.402" class="difflineminus">-              //...and does it looks like a valid address?</span>
<a href="#l4.403"></a><span id="l4.403" class="difflineminus">-              if (pEmailStr[i].FindChar('@') &lt;= 0)</span>
<a href="#l4.404"></a><span id="l4.404" class="difflineminus">-                pEmailStr[i].Truncate();</span>
<a href="#l4.405"></a><span id="l4.405" class="difflineminus">-            }</span>
<a href="#l4.406"></a><span id="l4.406" class="difflineminus">-            if (pEmailStr[0].IsEmpty() &amp;&amp; pEmailStr[1].IsEmpty())</span>
<a href="#l4.407"></a><span id="l4.407" class="difflineminus">-              continue;</span>
<a href="#l4.408"></a><span id="l4.408" class="difflineminus">-          }</span>
<a href="#l4.409"></a><span id="l4.409" class="difflineminus">-</span>
<a href="#l4.410"></a><span id="l4.410" class="difflineminus">-          // Now, retrieve the user name and nickname</span>
<a href="#l4.411"></a><span id="l4.411" class="difflineminus">-          (void)card-&gt;GetDisplayName(pDisplayNameStr);</span>
<a href="#l4.412"></a><span id="l4.412" class="difflineminus">-          (void)card-&gt;GetFirstName(pFirstNameStr);</span>
<a href="#l4.413"></a><span id="l4.413" class="difflineminus">-          (void)card-&gt;GetLastName(pLastNameStr);</span>
<a href="#l4.414"></a><span id="l4.414" class="difflineminus">-</span>
<a href="#l4.415"></a><span id="l4.415" class="difflineminus">-          (void)card-&gt;GetPropertyAsAString(kNicknameProperty, pNickNameStr);</span>
<a href="#l4.416"></a><span id="l4.416" class="difflineminus">-</span>
<a href="#l4.417"></a><span id="l4.417" class="difflineminus">-          (void)card-&gt;GetPropertyAsUint32(kPopularityIndexProperty,</span>
<a href="#l4.418"></a><span id="l4.418" class="difflineminus">-                                          &amp;popularityIndex);</span>
<a href="#l4.419"></a><span id="l4.419" class="difflineminus">-</span>
<a href="#l4.420"></a><span id="l4.420" class="difflineminus">-          // In the address book a mailing list does not have an email address</span>
<a href="#l4.421"></a><span id="l4.421" class="difflineminus">-          // field. However, we do &quot;fix up&quot; mailing lists in the UI sometimes to</span>
<a href="#l4.422"></a><span id="l4.422" class="difflineminus">-          // look like &quot;My List &lt;My List&gt;.&quot; If we are looking up an address, and</span>
<a href="#l4.423"></a><span id="l4.423" class="difflineminus">-          // we are comparing it to a mailing list to see if it is a match,</span>
<a href="#l4.424"></a><span id="l4.424" class="difflineminus">-          // instead of just looking for an exact match on &quot;My List&quot;, hijack the</span>
<a href="#l4.425"></a><span id="l4.425" class="difflineminus">-          // unused email address field and use that to test against</span>
<a href="#l4.426"></a><span id="l4.426" class="difflineminus">-          // &quot;My List &lt;My List&gt;&quot;</span>
<a href="#l4.427"></a><span id="l4.427" class="difflineminus">-          if (bIsMailList)</span>
<a href="#l4.428"></a><span id="l4.428" class="difflineminus">-            mParser-&gt;MakeFullAddress(pDisplayNameStr, pDisplayNameStr, pEmailStr[0]);</span>
<a href="#l4.429"></a><span id="l4.429" class="difflineminus">-</span>
<a href="#l4.430"></a><span id="l4.430" class="difflineminus">-          for (i = 0 ; i &lt; MAX_NUMBER_OF_EMAIL_ADDRESSES; i ++)</span>
<a href="#l4.431"></a><span id="l4.431" class="difflineminus">-          {</span>
<a href="#l4.432"></a><span id="l4.432" class="difflineminus">-            if (!bIsMailList &amp;&amp; pEmailStr[i].IsEmpty())</span>
<a href="#l4.433"></a><span id="l4.433" class="difflineminus">-              continue;</span>
<a href="#l4.434"></a><span id="l4.434" class="difflineminus">-</span>
<a href="#l4.435"></a><span id="l4.435" class="difflineminus">-            if (CheckEntry(searchStr, pNickNameStr.get(), </span>
<a href="#l4.436"></a><span id="l4.436" class="difflineminus">-                                      pDisplayNameStr.get(), </span>
<a href="#l4.437"></a><span id="l4.437" class="difflineminus">-                                      pFirstNameStr.get(), </span>
<a href="#l4.438"></a><span id="l4.438" class="difflineminus">-                                      pLastNameStr.get(), pEmailStr[i].get()))</span>
<a href="#l4.439"></a><span id="l4.439" class="difflineminus">-            {</span>
<a href="#l4.440"></a><span id="l4.440" class="difflineminus">-              nsString dirName;</span>
<a href="#l4.441"></a><span id="l4.441" class="difflineminus">-              if (mAutoCompleteCommentColumn == 1)</span>
<a href="#l4.442"></a><span id="l4.442" class="difflineminus">-              {</span>
<a href="#l4.443"></a><span id="l4.443" class="difflineminus">-                rv = directory-&gt;GetDirName(dirName);</span>
<a href="#l4.444"></a><span id="l4.444" class="difflineminus">-                if (NS_FAILED(rv))</span>
<a href="#l4.445"></a><span id="l4.445" class="difflineminus">-                  continue;</span>
<a href="#l4.446"></a><span id="l4.446" class="difflineminus">-              }</span>
<a href="#l4.447"></a><span id="l4.447" class="difflineminus">-</span>
<a href="#l4.448"></a><span id="l4.448" class="difflineminus">-              AddToResult(pNickNameStr.get(), pDisplayNameStr.get(), </span>
<a href="#l4.449"></a><span id="l4.449" class="difflineminus">-                          pFirstNameStr.get(), pLastNameStr.get(), </span>
<a href="#l4.450"></a><span id="l4.450" class="difflineminus">-                          pEmailStr[i].get(), pNotesStr.get(), </span>
<a href="#l4.451"></a><span id="l4.451" class="difflineminus">-                          dirName.get(), popularityIndex, bIsMailList, results);</span>
<a href="#l4.452"></a><span id="l4.452" class="difflineminus">-            }</span>
<a href="#l4.453"></a><span id="l4.453" class="difflineminus">-          }</span>
<a href="#l4.454"></a><span id="l4.454" class="difflineminus">-        }</span>
<a href="#l4.455"></a><span id="l4.455" class="difflineminus">-      }</span>
<a href="#l4.456"></a><span id="l4.456" class="difflineminus">-    }</span>
<a href="#l4.457"></a><span id="l4.457" class="difflineminus">-  }</span>
<a href="#l4.458"></a><span id="l4.458" class="difflineminus">-</span>
<a href="#l4.459"></a><span id="l4.459" class="difflineminus">-  return NS_OK;</span>
<a href="#l4.460"></a><span id="l4.460" class="difflineminus">-}</span>
<a href="#l4.461"></a><span id="l4.461" class="difflineminus">-</span>
<a href="#l4.462"></a><span id="l4.462" class="difflineminus">-nsresult nsAbAutoCompleteSession::SearchDirectory(const nsACString&amp; aURI,</span>
<a href="#l4.463"></a><span id="l4.463" class="difflineminus">-                                                  nsAbAutoCompleteSearchString* searchStr,</span>
<a href="#l4.464"></a><span id="l4.464" class="difflineminus">-                                                  PRBool searchSubDirectory,</span>
<a href="#l4.465"></a><span id="l4.465" class="difflineminus">-                                                  PRBool &amp;didSearch,</span>
<a href="#l4.466"></a><span id="l4.466" class="difflineminus">-                                                  nsIAutoCompleteResults* results)</span>
<a href="#l4.467"></a><span id="l4.467" class="difflineminus">-{</span>
<a href="#l4.468"></a><span id="l4.468" class="difflineminus">-    nsresult rv = NS_OK;</span>
<a href="#l4.469"></a><span id="l4.469" class="difflineminus">-    nsCOMPtr&lt;nsIRDFService&gt; rdfService(do_GetService(&quot;@mozilla.org/rdf/rdf-service;1&quot;, &amp;rv));</span>
<a href="#l4.470"></a><span id="l4.470" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.471"></a><span id="l4.471" class="difflineminus">-</span>
<a href="#l4.472"></a><span id="l4.472" class="difflineminus">-    nsCOMPtr &lt;nsIRDFResource&gt; resource;</span>
<a href="#l4.473"></a><span id="l4.473" class="difflineminus">-    rv = rdfService-&gt;GetResource(aURI, getter_AddRefs(resource));</span>
<a href="#l4.474"></a><span id="l4.474" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.475"></a><span id="l4.475" class="difflineminus">-</span>
<a href="#l4.476"></a><span id="l4.476" class="difflineminus">-    // query interface </span>
<a href="#l4.477"></a><span id="l4.477" class="difflineminus">-    nsCOMPtr&lt;nsIAbDirectory&gt; directory(do_QueryInterface(resource, &amp;rv));</span>
<a href="#l4.478"></a><span id="l4.478" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.479"></a><span id="l4.479" class="difflineminus">-</span>
<a href="#l4.480"></a><span id="l4.480" class="difflineminus">-    // when autocompleteing against directories, </span>
<a href="#l4.481"></a><span id="l4.481" class="difflineminus">-    // we only want to match against certain directories</span>
<a href="#l4.482"></a><span id="l4.482" class="difflineminus">-    // we ask the directory if it wants to be used</span>
<a href="#l4.483"></a><span id="l4.483" class="difflineminus">-    // for local autocompleting.</span>
<a href="#l4.484"></a><span id="l4.484" class="difflineminus">-    PRBool useForAutocomplete;</span>
<a href="#l4.485"></a><span id="l4.485" class="difflineminus">-    rv = directory-&gt;UseForAutocomplete(EmptyCString(), &amp;useForAutocomplete);</span>
<a href="#l4.486"></a><span id="l4.486" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.487"></a><span id="l4.487" class="difflineminus">-</span>
<a href="#l4.488"></a><span id="l4.488" class="difflineminus">-    if (!useForAutocomplete)</span>
<a href="#l4.489"></a><span id="l4.489" class="difflineminus">-      return NS_OK;</span>
<a href="#l4.490"></a><span id="l4.490" class="difflineminus">-</span>
<a href="#l4.491"></a><span id="l4.491" class="difflineminus">-    if (!aURI.EqualsLiteral(kAllDirectoryRoot))</span>
<a href="#l4.492"></a><span id="l4.492" class="difflineminus">-    {</span>
<a href="#l4.493"></a><span id="l4.493" class="difflineminus">-        rv = SearchCards(directory, searchStr, results);</span>
<a href="#l4.494"></a><span id="l4.494" class="difflineminus">-        didSearch = PR_TRUE;</span>
<a href="#l4.495"></a><span id="l4.495" class="difflineminus">-    }</span>
<a href="#l4.496"></a><span id="l4.496" class="difflineminus">-    </span>
<a href="#l4.497"></a><span id="l4.497" class="difflineminus">-    if (!searchSubDirectory)</span>
<a href="#l4.498"></a><span id="l4.498" class="difflineminus">-        return rv;</span>
<a href="#l4.499"></a><span id="l4.499" class="difflineminus">-  </span>
<a href="#l4.500"></a><span id="l4.500" class="difflineminus">-    nsCOMPtr&lt;nsISimpleEnumerator&gt; subDirectories;</span>
<a href="#l4.501"></a><span id="l4.501" class="difflineminus">-    if (NS_SUCCEEDED(directory-&gt;GetChildNodes(getter_AddRefs(subDirectories))) &amp;&amp; subDirectories)</span>
<a href="#l4.502"></a><span id="l4.502" class="difflineminus">-    {</span>
<a href="#l4.503"></a><span id="l4.503" class="difflineminus">-        nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l4.504"></a><span id="l4.504" class="difflineminus">-        PRBool hasMore;</span>
<a href="#l4.505"></a><span id="l4.505" class="difflineminus">-        while (NS_SUCCEEDED(rv = subDirectories-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l4.506"></a><span id="l4.506" class="difflineminus">-        {</span>
<a href="#l4.507"></a><span id="l4.507" class="difflineminus">-            if (NS_SUCCEEDED(subDirectories-&gt;GetNext(getter_AddRefs(item))))</span>
<a href="#l4.508"></a><span id="l4.508" class="difflineminus">-            {</span>
<a href="#l4.509"></a><span id="l4.509" class="difflineminus">-              directory = do_QueryInterface(item, &amp;rv);</span>
<a href="#l4.510"></a><span id="l4.510" class="difflineminus">-              if (NS_SUCCEEDED(rv))</span>
<a href="#l4.511"></a><span id="l4.511" class="difflineminus">-              {</span>
<a href="#l4.512"></a><span id="l4.512" class="difflineminus">-                nsCOMPtr&lt;nsIRDFResource&gt; subResource(do_QueryInterface(item, &amp;rv));</span>
<a href="#l4.513"></a><span id="l4.513" class="difflineminus">-                if (NS_SUCCEEDED(rv))</span>
<a href="#l4.514"></a><span id="l4.514" class="difflineminus">-                {</span>
<a href="#l4.515"></a><span id="l4.515" class="difflineminus">-                    nsCString URI;</span>
<a href="#l4.516"></a><span id="l4.516" class="difflineminus">-                    subResource-&gt;GetValue(getter_Copies(URI));</span>
<a href="#l4.517"></a><span id="l4.517" class="difflineminus">-                    rv = SearchDirectory(URI, searchStr, PR_TRUE, didSearch,</span>
<a href="#l4.518"></a><span id="l4.518" class="difflineminus">-                                         results);</span>
<a href="#l4.519"></a><span id="l4.519" class="difflineminus">-                }</span>
<a href="#l4.520"></a><span id="l4.520" class="difflineminus">-              }</span>
<a href="#l4.521"></a><span id="l4.521" class="difflineminus">-            }</span>
<a href="#l4.522"></a><span id="l4.522" class="difflineminus">-        }</span>
<a href="#l4.523"></a><span id="l4.523" class="difflineminus">-    }</span>
<a href="#l4.524"></a><span id="l4.524" class="difflineminus">-    return rv;</span>
<a href="#l4.525"></a><span id="l4.525" class="difflineminus">-}</span>
<a href="#l4.526"></a><span id="l4.526" class="difflineminus">-</span>
<a href="#l4.527"></a><span id="l4.527" class="difflineminus">-nsresult nsAbAutoCompleteSession::SearchPreviousResults(nsAbAutoCompleteSearchString *searchStr, nsIAutoCompleteResults *previousSearchResult, nsIAutoCompleteResults* results)</span>
<a href="#l4.528"></a><span id="l4.528" class="difflineminus">-{</span>
<a href="#l4.529"></a><span id="l4.529" class="difflineminus">-    if (!previousSearchResult)</span>
<a href="#l4.530"></a><span id="l4.530" class="difflineminus">-        return NS_ERROR_NULL_POINTER;</span>
<a href="#l4.531"></a><span id="l4.531" class="difflineminus">-        </span>
<a href="#l4.532"></a><span id="l4.532" class="difflineminus">-    nsString prevSearchString;</span>
<a href="#l4.533"></a><span id="l4.533" class="difflineminus">-    nsresult rv;</span>
<a href="#l4.534"></a><span id="l4.534" class="difflineminus">-</span>
<a href="#l4.535"></a><span id="l4.535" class="difflineminus">-    rv = previousSearchResult-&gt;GetSearchString(getter_Copies(prevSearchString));</span>
<a href="#l4.536"></a><span id="l4.536" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.537"></a><span id="l4.537" class="difflineminus">-    </span>
<a href="#l4.538"></a><span id="l4.538" class="difflineminus">-    if (prevSearchString.IsEmpty())</span>
<a href="#l4.539"></a><span id="l4.539" class="difflineminus">-        return NS_ERROR_FAILURE;</span>
<a href="#l4.540"></a><span id="l4.540" class="difflineminus">-    </span>
<a href="#l4.541"></a><span id="l4.541" class="difflineminus">-    PRUint32 prevSearchStrLen = prevSearchString.Length();</span>
<a href="#l4.542"></a><span id="l4.542" class="difflineminus">-    if (searchStr-&gt;mFullStringLen &lt; prevSearchStrLen ||</span>
<a href="#l4.543"></a><span id="l4.543" class="difflineminus">-        CommonPrefix(searchStr-&gt;mFullString, prevSearchString.get(), prevSearchStrLen))</span>
<a href="#l4.544"></a><span id="l4.544" class="difflineminus">-        return NS_ERROR_ABORT;</span>
<a href="#l4.545"></a><span id="l4.545" class="difflineminus">-</span>
<a href="#l4.546"></a><span id="l4.546" class="difflineminus">-    nsCOMPtr&lt;nsISupportsArray&gt; array;</span>
<a href="#l4.547"></a><span id="l4.547" class="difflineminus">-    rv = previousSearchResult-&gt;GetItems(getter_AddRefs(array));</span>
<a href="#l4.548"></a><span id="l4.548" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l4.549"></a><span id="l4.549" class="difflineminus">-    {</span>
<a href="#l4.550"></a><span id="l4.550" class="difflineminus">-        PRUint32 nbrOfItems;</span>
<a href="#l4.551"></a><span id="l4.551" class="difflineminus">-        PRUint32 i;</span>
<a href="#l4.552"></a><span id="l4.552" class="difflineminus">-        PRUint32 pos;</span>
<a href="#l4.553"></a><span id="l4.553" class="difflineminus">-        </span>
<a href="#l4.554"></a><span id="l4.554" class="difflineminus">-        rv = array-&gt;Count(&amp;nbrOfItems);</span>
<a href="#l4.555"></a><span id="l4.555" class="difflineminus">-        if (NS_FAILED(rv) || nbrOfItems &lt;= 0)</span>
<a href="#l4.556"></a><span id="l4.556" class="difflineminus">-            return NS_ERROR_FAILURE;</span>
<a href="#l4.557"></a><span id="l4.557" class="difflineminus">-        </span>
<a href="#l4.558"></a><span id="l4.558" class="difflineminus">-        nsCOMPtr&lt;nsISupports&gt; item;</span>
<a href="#l4.559"></a><span id="l4.559" class="difflineminus">-        nsCOMPtr&lt;nsIAutoCompleteItem&gt; resultItem;</span>
<a href="#l4.560"></a><span id="l4.560" class="difflineminus">-        nsAbAutoCompleteParam *param;</span>
<a href="#l4.561"></a><span id="l4.561" class="difflineminus">-</span>
<a href="#l4.562"></a><span id="l4.562" class="difflineminus">-        for (i = 0, pos = 0; i &lt; nbrOfItems; i ++, pos ++)</span>
<a href="#l4.563"></a><span id="l4.563" class="difflineminus">-        {</span>
<a href="#l4.564"></a><span id="l4.564" class="difflineminus">-            rv = array-&gt;QueryElementAt(pos, NS_GET_IID(nsIAutoCompleteItem),</span>
<a href="#l4.565"></a><span id="l4.565" class="difflineminus">-                                           getter_AddRefs(resultItem));</span>
<a href="#l4.566"></a><span id="l4.566" class="difflineminus">-            NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.567"></a><span id="l4.567" class="difflineminus">-              </span>
<a href="#l4.568"></a><span id="l4.568" class="difflineminus">-            rv = resultItem-&gt;GetParam(getter_AddRefs(item));</span>
<a href="#l4.569"></a><span id="l4.569" class="difflineminus">-            NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.570"></a><span id="l4.570" class="difflineminus">-            if (!item)</span>
<a href="#l4.571"></a><span id="l4.571" class="difflineminus">-                return NS_ERROR_FAILURE;</span>
<a href="#l4.572"></a><span id="l4.572" class="difflineminus">-</span>
<a href="#l4.573"></a><span id="l4.573" class="difflineminus">-            param = (nsAbAutoCompleteParam *)(void *)item;</span>
<a href="#l4.574"></a><span id="l4.574" class="difflineminus">-            </span>
<a href="#l4.575"></a><span id="l4.575" class="difflineminus">-            if (CheckEntry(searchStr, param-&gt;mNickName, param-&gt;mDisplayName,  param-&gt;mFirstName,  param-&gt;mLastName, param-&gt;mEmailAddress))</span>
<a href="#l4.576"></a><span id="l4.576" class="difflineminus">-                AddToResult(param-&gt;mNickName, param-&gt;mDisplayName, </span>
<a href="#l4.577"></a><span id="l4.577" class="difflineminus">-                            param-&gt;mFirstName, param-&gt;mLastName, </span>
<a href="#l4.578"></a><span id="l4.578" class="difflineminus">-                            param-&gt;mEmailAddress, param-&gt;mNotes, </span>
<a href="#l4.579"></a><span id="l4.579" class="difflineminus">-                            param-&gt;mDirName, param-&gt;mPopularityIndex, param-&gt;mIsMailList,</span>
<a href="#l4.580"></a><span id="l4.580" class="difflineminus">-                            results);</span>
<a href="#l4.581"></a><span id="l4.581" class="difflineminus">-        }</span>
<a href="#l4.582"></a><span id="l4.582" class="difflineminus">-        return NS_OK;</span>
<a href="#l4.583"></a><span id="l4.583" class="difflineminus">-    }</span>
<a href="#l4.584"></a><span id="l4.584" class="difflineminus">-</span>
<a href="#l4.585"></a><span id="l4.585" class="difflineminus">-    return NS_ERROR_ABORT;</span>
<a href="#l4.586"></a><span id="l4.586" class="difflineminus">-}</span>
<a href="#l4.587"></a><span id="l4.587" class="difflineminus">-</span>
<a href="#l4.588"></a><span id="l4.588" class="difflineminus">-NS_IMETHODIMP nsAbAutoCompleteSession::OnStartLookup(const PRUnichar *uSearchString, nsIAutoCompleteResults *previousSearchResult, nsIAutoCompleteListener *listener)</span>
<a href="#l4.589"></a><span id="l4.589" class="difflineminus">-{</span>
<a href="#l4.590"></a><span id="l4.590" class="difflineminus">-    nsresult rv = NS_OK;</span>
<a href="#l4.591"></a><span id="l4.591" class="difflineminus">-    </span>
<a href="#l4.592"></a><span id="l4.592" class="difflineminus">-    if (!listener)</span>
<a href="#l4.593"></a><span id="l4.593" class="difflineminus">-        return NS_ERROR_NULL_POINTER;</span>
<a href="#l4.594"></a><span id="l4.594" class="difflineminus">-    </span>
<a href="#l4.595"></a><span id="l4.595" class="difflineminus">-    nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l4.596"></a><span id="l4.596" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.597"></a><span id="l4.597" class="difflineminus">-</span>
<a href="#l4.598"></a><span id="l4.598" class="difflineminus">-    if (uSearchString[0] == 0)</span>
<a href="#l4.599"></a><span id="l4.599" class="difflineminus">-    {</span>
<a href="#l4.600"></a><span id="l4.600" class="difflineminus">-        listener-&gt;OnAutoComplete(nsnull, nsIAutoCompleteStatus::ignored);</span>
<a href="#l4.601"></a><span id="l4.601" class="difflineminus">-        return NS_OK;</span>
<a href="#l4.602"></a><span id="l4.602" class="difflineminus">-    }</span>
<a href="#l4.603"></a><span id="l4.603" class="difflineminus">-</span>
<a href="#l4.604"></a><span id="l4.604" class="difflineminus">-    // figure out what we're supposed to do about the comment column, and </span>
<a href="#l4.605"></a><span id="l4.605" class="difflineminus">-    // remember it for when the results start coming back</span>
<a href="#l4.606"></a><span id="l4.606" class="difflineminus">-    //</span>
<a href="#l4.607"></a><span id="l4.607" class="difflineminus">-    rv = prefs-&gt;GetIntPref(&quot;mail.autoComplete.commentColumn&quot;, </span>
<a href="#l4.608"></a><span id="l4.608" class="difflineminus">-                           &amp;mAutoCompleteCommentColumn);</span>
<a href="#l4.609"></a><span id="l4.609" class="difflineminus">-    if (NS_FAILED(rv)) {</span>
<a href="#l4.610"></a><span id="l4.610" class="difflineminus">-      mAutoCompleteCommentColumn = 0;</span>
<a href="#l4.611"></a><span id="l4.611" class="difflineminus">-    }</span>
<a href="#l4.612"></a><span id="l4.612" class="difflineminus">-</span>
<a href="#l4.613"></a><span id="l4.613" class="difflineminus">-</span>
<a href="#l4.614"></a><span id="l4.614" class="difflineminus">-    // strings with commas (commas denote multiple names) should be ignored for </span>
<a href="#l4.615"></a><span id="l4.615" class="difflineminus">-    // autocomplete purposes</span>
<a href="#l4.616"></a><span id="l4.616" class="difflineminus">-    PRInt32 i;</span>
<a href="#l4.617"></a><span id="l4.617" class="difflineminus">-    for (i = NS_strlen(uSearchString) - 1; i &gt;= 0; i --)</span>
<a href="#l4.618"></a><span id="l4.618" class="difflineminus">-        if (uSearchString[i] == ',')</span>
<a href="#l4.619"></a><span id="l4.619" class="difflineminus">-        {</span>
<a href="#l4.620"></a><span id="l4.620" class="difflineminus">-            listener-&gt;OnAutoComplete(nsnull, nsIAutoCompleteStatus::ignored);</span>
<a href="#l4.621"></a><span id="l4.621" class="difflineminus">-            return NS_OK;</span>
<a href="#l4.622"></a><span id="l4.622" class="difflineminus">-        }</span>
<a href="#l4.623"></a><span id="l4.623" class="difflineminus">-        </span>
<a href="#l4.624"></a><span id="l4.624" class="difflineminus">-    nsAbAutoCompleteSearchString searchStrings(uSearchString);</span>
<a href="#l4.625"></a><span id="l4.625" class="difflineminus">-    </span>
<a href="#l4.626"></a><span id="l4.626" class="difflineminus">-    nsCOMPtr&lt;nsIAutoCompleteResults&gt; results = do_CreateInstance(NS_AUTOCOMPLETERESULTS_CONTRACTID, &amp;rv);</span>
<a href="#l4.627"></a><span id="l4.627" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l4.628"></a><span id="l4.628" class="difflineminus">-      if (NS_FAILED(SearchPreviousResults(&amp;searchStrings, previousSearchResult, results)))</span>
<a href="#l4.629"></a><span id="l4.629" class="difflineminus">-      {</span>
<a href="#l4.630"></a><span id="l4.630" class="difflineminus">-        PRBool didSearch = PR_FALSE;</span>
<a href="#l4.631"></a><span id="l4.631" class="difflineminus">-        rv = SearchDirectory(NS_LITERAL_CSTRING(kAllDirectoryRoot), &amp;searchStrings,</span>
<a href="#l4.632"></a><span id="l4.632" class="difflineminus">-                             PR_TRUE, didSearch, results);</span>
<a href="#l4.633"></a><span id="l4.633" class="difflineminus">-        NS_ASSERTION(NS_SUCCEEDED(rv), &quot;searching local directories failed&quot;);</span>
<a href="#l4.634"></a><span id="l4.634" class="difflineminus">-</span>
<a href="#l4.635"></a><span id="l4.635" class="difflineminus">-        // if we didn't search any directories, just return ignored</span>
<a href="#l4.636"></a><span id="l4.636" class="difflineminus">-        if (!didSearch)</span>
<a href="#l4.637"></a><span id="l4.637" class="difflineminus">-        {</span>
<a href="#l4.638"></a><span id="l4.638" class="difflineminus">-          listener-&gt;OnAutoComplete(nsnull, nsIAutoCompleteStatus::ignored);</span>
<a href="#l4.639"></a><span id="l4.639" class="difflineminus">-          return NS_OK;</span>
<a href="#l4.640"></a><span id="l4.640" class="difflineminus">-        }</span>
<a href="#l4.641"></a><span id="l4.641" class="difflineminus">-    }</span>
<a href="#l4.642"></a><span id="l4.642" class="difflineminus">-                </span>
<a href="#l4.643"></a><span id="l4.643" class="difflineminus">-    AutoCompleteStatus status = nsIAutoCompleteStatus::failed;</span>
<a href="#l4.644"></a><span id="l4.644" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; results)</span>
<a href="#l4.645"></a><span id="l4.645" class="difflineminus">-    {</span>
<a href="#l4.646"></a><span id="l4.646" class="difflineminus">-        results-&gt;SetSearchString(uSearchString);</span>
<a href="#l4.647"></a><span id="l4.647" class="difflineminus">-        results-&gt;SetDefaultItemIndex(-1);</span>
<a href="#l4.648"></a><span id="l4.648" class="difflineminus">-</span>
<a href="#l4.649"></a><span id="l4.649" class="difflineminus">-        nsCOMPtr&lt;nsISupportsArray&gt; array;</span>
<a href="#l4.650"></a><span id="l4.650" class="difflineminus">-        rv = results-&gt;GetItems(getter_AddRefs(array));</span>
<a href="#l4.651"></a><span id="l4.651" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l4.652"></a><span id="l4.652" class="difflineminus">-        {</span>
<a href="#l4.653"></a><span id="l4.653" class="difflineminus">-          //If we have more than a match (without counting the default item), we don't</span>
<a href="#l4.654"></a><span id="l4.654" class="difflineminus">-          //want to auto complete the user input therefore set the default item index to -1</span>
<a href="#l4.655"></a><span id="l4.655" class="difflineminus">-</span>
<a href="#l4.656"></a><span id="l4.656" class="difflineminus">-          PRUint32 nbrOfItems;</span>
<a href="#l4.657"></a><span id="l4.657" class="difflineminus">-          rv = array-&gt;Count(&amp;nbrOfItems);</span>
<a href="#l4.658"></a><span id="l4.658" class="difflineminus">-          if (NS_SUCCEEDED(rv))</span>
<a href="#l4.659"></a><span id="l4.659" class="difflineminus">-            if (nbrOfItems == 0)</span>
<a href="#l4.660"></a><span id="l4.660" class="difflineminus">-              status = nsIAutoCompleteStatus::noMatch;</span>
<a href="#l4.661"></a><span id="l4.661" class="difflineminus">-            else</span>
<a href="#l4.662"></a><span id="l4.662" class="difflineminus">-            {</span>
<a href="#l4.663"></a><span id="l4.663" class="difflineminus">-              status = nsIAutoCompleteStatus::matchFound;</span>
<a href="#l4.664"></a><span id="l4.664" class="difflineminus">-              results-&gt;SetDefaultItemIndex(0);  </span>
<a href="#l4.665"></a><span id="l4.665" class="difflineminus">-            }</span>
<a href="#l4.666"></a><span id="l4.666" class="difflineminus">-        }</span>
<a href="#l4.667"></a><span id="l4.667" class="difflineminus">-    }</span>
<a href="#l4.668"></a><span id="l4.668" class="difflineminus">-    listener-&gt;OnAutoComplete(results, status);</span>
<a href="#l4.669"></a><span id="l4.669" class="difflineminus">-    </span>
<a href="#l4.670"></a><span id="l4.670" class="difflineminus">-    return NS_OK;</span>
<a href="#l4.671"></a><span id="l4.671" class="difflineminus">-}</span>
<a href="#l4.672"></a><span id="l4.672" class="difflineminus">-</span>
<a href="#l4.673"></a><span id="l4.673" class="difflineminus">-NS_IMETHODIMP nsAbAutoCompleteSession::OnStopLookup()</span>
<a href="#l4.674"></a><span id="l4.674" class="difflineminus">-{</span>
<a href="#l4.675"></a><span id="l4.675" class="difflineminus">-    return NS_OK;</span>
<a href="#l4.676"></a><span id="l4.676" class="difflineminus">-}</span>
<a href="#l4.677"></a><span id="l4.677" class="difflineminus">-</span>
<a href="#l4.678"></a><span id="l4.678" class="difflineminus">-NS_IMETHODIMP nsAbAutoCompleteSession::OnAutoComplete(const PRUnichar *searchString, nsIAutoCompleteResults *previousSearchResult, nsIAutoCompleteListener *listener)</span>
<a href="#l4.679"></a><span id="l4.679" class="difflineminus">-{</span>
<a href="#l4.680"></a><span id="l4.680" class="difflineminus">-    return OnStartLookup(searchString, previousSearchResult, listener);</span>
<a href="#l4.681"></a><span id="l4.681" class="difflineminus">-}</span>
<a href="#l4.682"></a><span id="l4.682" class="difflineminus">-</span>
<a href="#l4.683"></a><span id="l4.683" class="difflineminus">-NS_IMPL_ISUPPORTS1(nsAbAutoCompleteParam, nsISupports)</span>
<a href="#l4.684"></a><span id="l4.684" class="difflineminus">-</span>
<a href="#l4.685"></a><span id="l4.685" class="difflineminus">-nsAbAutoCompleteSearchString::nsAbAutoCompleteSearchString(const PRUnichar *uSearchString)</span>
<a href="#l4.686"></a><span id="l4.686" class="difflineminus">-{</span>
<a href="#l4.687"></a><span id="l4.687" class="difflineminus">-  mFullString = NS_strdup(uSearchString);</span>
<a href="#l4.688"></a><span id="l4.688" class="difflineminus">-  mFullStringLen = NS_strlen(mFullString);</span>
<a href="#l4.689"></a><span id="l4.689" class="difflineminus">-  </span>
<a href="#l4.690"></a><span id="l4.690" class="difflineminus">-  PRUint32 i;</span>
<a href="#l4.691"></a><span id="l4.691" class="difflineminus">-  PRUnichar * aPtr;</span>
<a href="#l4.692"></a><span id="l4.692" class="difflineminus">-  for (i = 0, aPtr = (PRUnichar*)mFullString; i &lt; mFullStringLen; i ++, aPtr ++)</span>
<a href="#l4.693"></a><span id="l4.693" class="difflineminus">-  {</span>
<a href="#l4.694"></a><span id="l4.694" class="difflineminus">-    if (*aPtr == ' ')</span>
<a href="#l4.695"></a><span id="l4.695" class="difflineminus">-    {</span>
<a href="#l4.696"></a><span id="l4.696" class="difflineminus">-      mFirstPart = NS_strndup(mFullString, i);</span>
<a href="#l4.697"></a><span id="l4.697" class="difflineminus">-      mFirstPartLen = i;</span>
<a href="#l4.698"></a><span id="l4.698" class="difflineminus">-      mSecondPart = NS_strdup(++aPtr);</span>
<a href="#l4.699"></a><span id="l4.699" class="difflineminus">-      mSecondPartLen = mFullStringLen - i - 1;</span>
<a href="#l4.700"></a><span id="l4.700" class="difflineminus">-      return;</span>
<a href="#l4.701"></a><span id="l4.701" class="difflineminus">-    }</span>
<a href="#l4.702"></a><span id="l4.702" class="difflineminus">-  }</span>
<a href="#l4.703"></a><span id="l4.703" class="difflineminus">-  </span>
<a href="#l4.704"></a><span id="l4.704" class="difflineminus">-  /* If we did not find a space in the search string, initialize the first and second part as null */</span>
<a href="#l4.705"></a><span id="l4.705" class="difflineminus">-  mFirstPart = nsnull;</span>
<a href="#l4.706"></a><span id="l4.706" class="difflineminus">-  mFirstPartLen = 0;</span>
<a href="#l4.707"></a><span id="l4.707" class="difflineminus">-  mSecondPart = nsnull;</span>
<a href="#l4.708"></a><span id="l4.708" class="difflineminus">-  mSecondPartLen = 0;</span>
<a href="#l4.709"></a><span id="l4.709" class="difflineminus">-}</span>
<a href="#l4.710"></a><span id="l4.710" class="difflineminus">-</span>
<a href="#l4.711"></a><span id="l4.711" class="difflineminus">-nsAbAutoCompleteSearchString::~nsAbAutoCompleteSearchString()</span>
<a href="#l4.712"></a><span id="l4.712" class="difflineminus">-{</span>
<a href="#l4.713"></a><span id="l4.713" class="difflineminus">-  if (mFullString)</span>
<a href="#l4.714"></a><span id="l4.714" class="difflineminus">-     NS_Free((PRUnichar*)mFullString);</span>
<a href="#l4.715"></a><span id="l4.715" class="difflineminus">-  if (mFirstPart)</span>
<a href="#l4.716"></a><span id="l4.716" class="difflineminus">-     NS_Free((PRUnichar*)mFirstPart);</span>
<a href="#l4.717"></a><span id="l4.717" class="difflineminus">-  if (mSecondPart)</span>
<a href="#l4.718"></a><span id="l4.718" class="difflineminus">-     NS_Free((PRUnichar*)mSecondPart);</span>
<a href="#l4.719"></a><span id="l4.719" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">deleted file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- a/mailnews/addrbook/src/nsAbAutoCompleteSession.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ /dev/null</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -1,186 +0,0 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">- *</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">- *</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">- * License.</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">- *</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">- *</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1999</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">- *</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">- *</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">- *</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-#ifndef nsAbAutoCompleteSession_h___</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-#define nsAbAutoCompleteSession_h___</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-#include &quot;nsStringGlue.h&quot;</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-#include &quot;nsIMsgHeaderParser.h&quot;</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-#include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-#include &quot;nsIAutoCompleteSession.h&quot;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-#include &quot;nsCRTGlue.h&quot;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-class nsIPrefBranch;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-typedef struct</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-{</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-  char * userName;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-  char * emailAddress;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-  char * nickName;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-} nsAbStubEntry;</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-#define MAX_ENTRIES 100</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-class nsAbAutoCompleteSearchString</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-{</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-public:</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-  nsAbAutoCompleteSearchString(const PRUnichar *uSearchString);</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-  virtual ~nsAbAutoCompleteSearchString();</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-  </span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-  const PRUnichar*  mFullString;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-  PRUint32          mFullStringLen;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-  </span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-  const PRUnichar*  mFirstPart;</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-  PRUint32          mFirstPartLen;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-  </span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-  const PRUnichar*  mSecondPart;</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-  PRUint32          mSecondPartLen;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-};</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-class nsAbAutoCompleteSession : public nsIAutoCompleteSession</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-{</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-public:</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-  NS_DECL_ISUPPORTS</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-    NS_DECL_NSIAUTOCOMPLETESESSION</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-  nsAbAutoCompleteSession();</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-  virtual ~nsAbAutoCompleteSession(); </span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-protected:    </span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-    PRBool ItsADuplicate(const nsString &amp;fullAddrStr, PRInt32 aPopularityIndex,</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-                         nsIAutoCompleteResults* results);</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-    void AddToResult(const PRUnichar* pNickNameStr, </span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-                     const PRUnichar* pDisplayNameStr, </span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-                     const PRUnichar* pFirstNameStr,</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-                     const PRUnichar* pLastNameStr, </span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-                     const PRUnichar* pEmailStr, const PRUnichar* pNotes,</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-                     const PRUnichar* pDirName, </span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-                     PRUint32 aPopularityIndex, PRBool bIsMailList, </span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-                     nsIAutoCompleteResults* results);</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-    PRBool CheckEntry(nsAbAutoCompleteSearchString* searchStr, const PRUnichar* nickName,const PRUnichar* displayName, </span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-                      const PRUnichar* firstName, const PRUnichar* lastName, const PRUnichar* emailAddress);</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-        </span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-    nsCOMPtr&lt;nsIMsgHeaderParser&gt; mParser;</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-    // how to process the comment column, if at all.  this value</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-    // comes from &quot;mail.autoComplete.commentColumn&quot;, or, if that</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineminus">-    // doesn't exist, defaults to 0</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineminus">-    //</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineminus">-    // 0 = none</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineminus">-    // 1 = name of addressbook this card came from</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineminus">-    // 2 = other per-addressbook format (currrently unused here)</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineminus">-    //</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-    PRInt32 mAutoCompleteCommentColumn;</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-private:</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineminus">-    #define MAX_NUMBER_OF_EMAIL_ADDRESSES     2</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineminus">-</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineminus">-    nsresult SearchCards(nsIAbDirectory* directory, nsAbAutoCompleteSearchString* searchStr, nsIAutoCompleteResults* results);</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineminus">-    nsresult SearchDirectory(const nsACString&amp; aURI,</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineminus">-                             nsAbAutoCompleteSearchString* searchStr,</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineminus">-                             PRBool searchSubDirectory,</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-                             PRBool &amp;didSearch,</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineminus">-                             nsIAutoCompleteResults* results);</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-    nsresult SearchPreviousResults(nsAbAutoCompleteSearchString *uSearchString, nsIAutoCompleteResults *previousSearchResult, nsIAutoCompleteResults* results);</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-};</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineminus">-</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-#define NS_ABAUTOCOMPLETEPARAM_IID_STR &quot;a3093c00-1469-11d4-a449-e55aa307c5bc&quot;</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineminus">-#define NS_ABAUTOCOMPLETEPARAM_IID \</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineminus">-  {0xa3093c00, 0x1469, 0x11d4, \</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-    { 0xa4, 0x49, 0xe5, 0x5a, 0xa3, 0x07, 0xc5, 0xbc }}</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-class nsAbAutoCompleteParam : public nsISupports</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-{</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-public:</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-  NS_DECL_ISUPPORTS</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-  </span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-  nsAbAutoCompleteParam(const PRUnichar* nickName,</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-                          const PRUnichar* displayName,</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-                          const PRUnichar* firstName,</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-                          const PRUnichar* lastName,</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-                          const PRUnichar* emailAddress,</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineminus">-                          const PRUnichar* notes,</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineminus">-                          const PRUnichar* dirName,</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineminus">-                          PRUint32 aPopularityIndex,</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineminus">-                          PRBool isMailList)</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineminus">-  {</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-    const PRUnichar *empty = EmptyString().get();</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineminus">-    mNickName = NS_strdup(nickName ? nickName : empty);</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-    mDisplayName = NS_strdup(displayName ? displayName : empty);</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-    mFirstName = NS_strdup(firstName ? firstName : empty);</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineminus">-    mLastName = NS_strdup(lastName ? lastName : empty);</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-    mEmailAddress = NS_strdup(emailAddress ? emailAddress : empty);</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-    mNotes = NS_strdup(notes ? notes : empty);</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-    mDirName = NS_strdup(dirName ? dirName : empty);</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineminus">-    mIsMailList = isMailList;</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineminus">-    mPopularityIndex = aPopularityIndex;</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineminus">-  }</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineminus">-  </span>
<a href="#l5.162"></a><span id="l5.162" class="difflineminus">-  virtual ~nsAbAutoCompleteParam()</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-  {</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineminus">-    NS_Free(mNickName);</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-    NS_Free(mDisplayName);</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-    NS_Free(mFirstName);</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineminus">-    NS_Free(mLastName);</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-    NS_Free(mEmailAddress);</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineminus">-    NS_Free(mNotes);</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineminus">-    NS_Free(mDirName);</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-  }</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-  </span>
<a href="#l5.173"></a><span id="l5.173" class="difflineminus">-protected:</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineminus">-    PRUnichar* mNickName;</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineminus">-    PRUnichar* mDisplayName;</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineminus">-    PRUnichar* mFirstName;</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineminus">-    PRUnichar* mLastName;</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineminus">-    PRUnichar* mEmailAddress;</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineminus">-    PRUnichar* mNotes;</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineminus">-    PRUnichar* mDirName;</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineminus">-    PRUint32 mPopularityIndex;</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineminus">-    PRBool mIsMailList;</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineminus">-</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineminus">-public:</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineminus">-    friend class nsAbAutoCompleteSession;</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineminus">-};</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineminus">-</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineminus">-#endif /* nsAbAutoCompleteSession_h___ */</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineminus">-</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/build/nsMailModule.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/build/nsMailModule.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -132,17 +132,16 @@</span>
<a href="#l6.4"></a><span id="l6.4"> #include &quot;nsAbMDBDirectory.h&quot;</span>
<a href="#l6.5"></a><span id="l6.5"> #include &quot;nsAbMDBCard.h&quot;</span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;nsAbDirFactoryService.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;nsAbMDBDirFactory.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsAddrDatabase.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsAbManager.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;nsAbContentHandler.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> #include &quot;nsAbDirProperty.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-#include &quot;nsAbAutoCompleteSession.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13"> #include &quot;nsAbAddressCollecter.h&quot;</span>
<a href="#l6.14"></a><span id="l6.14"> #include &quot;nsAddbookProtocolHandler.h&quot;</span>
<a href="#l6.15"></a><span id="l6.15"> #include &quot;nsAddbookUrl.h&quot;</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17"> #include &quot;nsAbDirectoryQuery.h&quot;</span>
<a href="#l6.18"></a><span id="l6.18"> #include &quot;nsAbBooleanExpression.h&quot;</span>
<a href="#l6.19"></a><span id="l6.19"> #include &quot;nsAbDirectoryQueryProxy.h&quot;</span>
<a href="#l6.20"></a><span id="l6.20"> #include &quot;nsAbView.h&quot;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -373,17 +372,16 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbManag</span>
<a href="#l6.22"></a><span id="l6.22"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbContentHandler)</span>
<a href="#l6.23"></a><span id="l6.23"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbDirectoryDataSource,Init)</span>
<a href="#l6.24"></a><span id="l6.24"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbDirProperty)</span>
<a href="#l6.25"></a><span id="l6.25"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbCardProperty)</span>
<a href="#l6.26"></a><span id="l6.26"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbBSDirectory)</span>
<a href="#l6.27"></a><span id="l6.27"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBDirectory)</span>
<a href="#l6.28"></a><span id="l6.28"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBCard)</span>
<a href="#l6.29"></a><span id="l6.29"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddrDatabase)</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbAutoCompleteSession)</span>
<a href="#l6.31"></a><span id="l6.31"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbAddressCollecter,Init)</span>
<a href="#l6.32"></a><span id="l6.32"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddbookUrl)</span>
<a href="#l6.33"></a><span id="l6.33"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbDirFactoryService)</span>
<a href="#l6.34"></a><span id="l6.34"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBDirFactory)</span>
<a href="#l6.35"></a><span id="l6.35"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddbookProtocolHandler)</span>
<a href="#l6.36"></a><span id="l6.36"> </span>
<a href="#l6.37"></a><span id="l6.37"> #if defined(XP_WIN) &amp;&amp; !defined(__MINGW32__)</span>
<a href="#l6.38"></a><span id="l6.38"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbOutlookDirectory)</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineat">@@ -968,18 +966,16 @@ static const nsModuleComponentInfo gComp</span>
<a href="#l6.40"></a><span id="l6.40">     { &quot;Address MDB Book Card&quot;, NS_ABMDBCARD_CID,</span>
<a href="#l6.41"></a><span id="l6.41">        NS_ABMDBCARD_CONTRACTID, nsAbMDBCardConstructor },</span>
<a href="#l6.42"></a><span id="l6.42">     { &quot;Address Database&quot;, NS_ADDRDATABASE_CID,</span>
<a href="#l6.43"></a><span id="l6.43">       NS_ADDRDATABASE_CONTRACTID, nsAddrDatabaseConstructor },</span>
<a href="#l6.44"></a><span id="l6.44">     { &quot;Address Book Card Property&quot;, NS_ABCARDPROPERTY_CID,</span>
<a href="#l6.45"></a><span id="l6.45">       NS_ABCARDPROPERTY_CONTRACTID, nsAbCardPropertyConstructor },</span>
<a href="#l6.46"></a><span id="l6.46">     { &quot;Address Book Directory Property&quot;, NS_ABDIRPROPERTY_CID,</span>
<a href="#l6.47"></a><span id="l6.47">       NS_ABDIRPROPERTY_CONTRACTID, nsAbDirPropertyConstructor },</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-    { &quot;Address Book Auto Complete Session&quot;, NS_ABAUTOCOMPLETESESSION_CID,</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-      NS_ABAUTOCOMPLETESESSION_CONTRACTID, nsAbAutoCompleteSessionConstructor },</span>
<a href="#l6.50"></a><span id="l6.50">     { &quot;Address Book Address Collector&quot;, NS_ABADDRESSCOLLECTER_CID,</span>
<a href="#l6.51"></a><span id="l6.51">       NS_ABADDRESSCOLLECTER_CONTRACTID, nsAbAddressCollecterConstructor },</span>
<a href="#l6.52"></a><span id="l6.52">     { &quot;The addbook URL Interface&quot;, NS_ADDBOOKURL_CID,</span>
<a href="#l6.53"></a><span id="l6.53">       NS_ADDBOOKURL_CONTRACTID, nsAddbookUrlConstructor },</span>
<a href="#l6.54"></a><span id="l6.54">     { &quot;The addbook Protocol Handler&quot;, NS_ADDBOOK_HANDLER_CID,</span>
<a href="#l6.55"></a><span id="l6.55">       NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX &quot;addbook&quot;, nsAddbookProtocolHandlerConstructor },</span>
<a href="#l6.56"></a><span id="l6.56">     { &quot;add vCard content handler&quot;, NS_ABCONTENTHANDLER_CID,</span>
<a href="#l6.57"></a><span id="l6.57">       NS_CONTENT_HANDLER_CONTRACTID_PREFIX&quot;application/x-addvcard&quot;,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

