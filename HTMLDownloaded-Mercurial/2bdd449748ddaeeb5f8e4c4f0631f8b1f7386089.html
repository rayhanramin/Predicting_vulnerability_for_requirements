<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 10991:2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089" />
<meta property="og:url" content="/comm-central/rev/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089" />
<meta property="og:description" content="Bug 775394 - Use Services.io instead of Cc[&quot;@mozilla.org/network/io-service;1&quot;].getService(Ci.nsIIOService). r=mconley" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089">shortlog</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089">files</a> |
changeset |
<a href="/comm-central/raw-rev/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089">raw</a>  | <a href="/comm-central/archive/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=775394">Bug 775394</a> - Use Services.io instead of Cc[&quot;@mozilla.org/network/io-service;1&quot;].getService(Ci.nsIIOService). r=mconley
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#72;&#105;&#114;&#111;&#121;&#117;&#107;&#105;&#32;&#73;&#107;&#101;&#122;&#111;&#101;&#32;&#60;&#104;&#105;&#105;&#107;&#101;&#122;&#111;&#101;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#45;&#106;&#97;&#112;&#97;&#110;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 31 Aug 2012 06:27:50 -0400</td></tr>

<tr>
 <td>changeset 10991</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089">2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089</a></td>
</tr>



<tr>
<td>parent 10990</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8502d1fd3cccbd21125df23269e6c64de1fd4900">8502d1fd3cccbd21125df23269e6c64de1fd4900</a>
</td>
</tr>

<tr>
<td>child 10992</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d7e8c7ff579b8118988e682311e7b40369e07d5c">d7e8c7ff579b8118988e682311e7b40369e07d5c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089">8245</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 31 Aug 2012 10:27:51 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@83616ca185bb [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=83616ca185bba6150105a8994e8ab3a020b07f40">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=83616ca185bba6150105a8994e8ab3a020b07f40&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=83616ca185bba6150105a8994e8ab3a020b07f40&newProject=comm-central&newRevision=8502d1fd3cccbd21125df23269e6c64de1fd4900&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=83616ca185bba6150105a8994e8ab3a020b07f40&newProject=comm-central&newRevision=8502d1fd3cccbd21125df23269e6c64de1fd4900&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=83616ca185bba6150105a8994e8ab3a020b07f40&newProject=comm-central&newRevision=8502d1fd3cccbd21125df23269e6c64de1fd4900&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mconley%29&revcount=50">mconley</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=775394">775394</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=775394">Bug 775394</a> - Use Services.io instead of Cc[&quot;@mozilla.org/network/io-service;1&quot;].getService(Ci.nsIIOService). r=mconley</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_bug366491.js">mailnews/base/test/unit/test_bug366491.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_bug366491.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_bug366491.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_bug366491.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_bug366491.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_bug366491.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_imapPump.js">mailnews/base/test/unit/test_imapPump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_imapPump.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_imapPump.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_imapPump.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_imapPump.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_imapPump.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_postPluginFilters.js">mailnews/base/test/unit/test_postPluginFilters.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_postPluginFilters.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_postPluginFilters.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_postPluginFilters.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_postPluginFilters.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_postPluginFilters.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_searchChaining.js">mailnews/base/test/unit/test_searchChaining.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_searchChaining.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_searchChaining.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_searchChaining.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_searchChaining.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/base/test/unit/test_searchChaining.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/compose/test/unit/test_smtpURL.js">mailnews/compose/test/unit/test_smtpURL.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/compose/test/unit/test_smtpURL.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/compose/test/unit/test_smtpURL.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/compose/test/unit/test_smtpURL.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/compose/test/unit/test_smtpURL.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/compose/test/unit/test_smtpURL.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/db/gloda/test/unit/test_startup_offline.js">mailnews/db/gloda/test/unit/test_startup_offline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/db/gloda/test/unit/test_startup_offline.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/db/gloda/test/unit/test_startup_offline.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/db/gloda/test/unit/test_startup_offline.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/db/gloda/test/unit/test_startup_offline.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/db/gloda/test/unit/test_startup_offline.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bccProperty.js">mailnews/imap/test/unit/test_bccProperty.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bccProperty.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bccProperty.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bccProperty.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bccProperty.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bccProperty.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bug460636.js">mailnews/imap/test/unit/test_bug460636.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bug460636.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bug460636.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bug460636.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bug460636.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_bug460636.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_chunkLastLF.js">mailnews/imap/test/unit/test_chunkLastLF.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_chunkLastLF.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_chunkLastLF.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_chunkLastLF.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_chunkLastLF.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_chunkLastLF.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_compactOfflineStore.js">mailnews/imap/test/unit/test_compactOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_compactOfflineStore.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_compactOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_compactOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_compactOfflineStore.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_compactOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dod.js">mailnews/imap/test/unit/test_dod.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dod.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dod.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dod.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dod.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dod.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dontStatNoSelect.js">mailnews/imap/test/unit/test_dontStatNoSelect.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dontStatNoSelect.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dontStatNoSelect.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dontStatNoSelect.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dontStatNoSelect.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_dontStatNoSelect.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_downloadOffline.js">mailnews/imap/test/unit/test_downloadOffline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_downloadOffline.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_downloadOffline.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_downloadOffline.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_downloadOffline.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_downloadOffline.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_fetchCustomAttribute.js">mailnews/imap/test/unit/test_fetchCustomAttribute.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_fetchCustomAttribute.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_fetchCustomAttribute.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_fetchCustomAttribute.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_fetchCustomAttribute.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_fetchCustomAttribute.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_filterNeedsBody.js">mailnews/imap/test/unit/test_filterNeedsBody.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_filterNeedsBody.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_filterNeedsBody.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_filterNeedsBody.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_filterNeedsBody.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_filterNeedsBody.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAttachmentSaves.js">mailnews/imap/test/unit/test_imapAttachmentSaves.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAttachmentSaves.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAttachmentSaves.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAttachmentSaves.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAttachmentSaves.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAttachmentSaves.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAutoSync.js">mailnews/imap/test/unit/test_imapAutoSync.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAutoSync.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAutoSync.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAutoSync.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAutoSync.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapAutoSync.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapChunks.js">mailnews/imap/test/unit/test_imapChunks.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapChunks.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapChunks.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapChunks.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapChunks.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapChunks.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapContentLength.js">mailnews/imap/test/unit/test_imapContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapContentLength.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapContentLength.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapContentLength.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapContentLength.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapCopyTimeout.js">mailnews/imap/test/unit/test_imapCopyTimeout.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapCopyTimeout.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapCopyTimeout.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapCopyTimeout.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapCopyTimeout.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapCopyTimeout.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFilterActions.js">mailnews/imap/test/unit/test_imapFilterActions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFilterActions.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFilterActions.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFilterActions.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFilterActions.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFilterActions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFlagChange.js">mailnews/imap/test/unit/test_imapFlagChange.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFlagChange.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFlagChange.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFlagChange.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFlagChange.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapFlagChange.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrChunking.js">mailnews/imap/test/unit/test_imapHdrChunking.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrChunking.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrChunking.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrChunking.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrChunking.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrChunking.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrStreaming.js">mailnews/imap/test/unit/test_imapHdrStreaming.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrStreaming.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrStreaming.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrStreaming.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrStreaming.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapHdrStreaming.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">mailnews/imap/test/unit/test_imapStoreMsgOffline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapUndo.js">mailnews/imap/test/unit/test_imapUndo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapUndo.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapUndo.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapUndo.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapUndo.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_imapUndo.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_largeOfflineStore.js">mailnews/imap/test/unit/test_largeOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_largeOfflineStore.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_largeOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_largeOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_largeOfflineStore.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_largeOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlinePlayback.js">mailnews/imap/test/unit/test_offlinePlayback.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlinePlayback.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlinePlayback.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlinePlayback.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlinePlayback.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlinePlayback.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlineStoreLocking.js">mailnews/imap/test/unit/test_offlineStoreLocking.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlineStoreLocking.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlineStoreLocking.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlineStoreLocking.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlineStoreLocking.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_offlineStoreLocking.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_partsOnDemand.js">mailnews/imap/test/unit/test_partsOnDemand.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_partsOnDemand.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_partsOnDemand.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_partsOnDemand.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_partsOnDemand.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_partsOnDemand.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_preserveDataOnMove.js">mailnews/imap/test/unit/test_preserveDataOnMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_preserveDataOnMove.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_preserveDataOnMove.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_preserveDataOnMove.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_preserveDataOnMove.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_preserveDataOnMove.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_syncChanges.js">mailnews/imap/test/unit/test_syncChanges.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_syncChanges.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_syncChanges.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_syncChanges.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_syncChanges.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_syncChanges.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_trustSpamAssassin.js">mailnews/imap/test/unit/test_trustSpamAssassin.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_trustSpamAssassin.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_trustSpamAssassin.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_trustSpamAssassin.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_trustSpamAssassin.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/imap/test/unit/test_trustSpamAssassin.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/local/test/unit/test_mailboxContentLength.js">mailnews/local/test/unit/test_mailboxContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/local/test/unit/test_mailboxContentLength.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/local/test/unit/test_mailboxContentLength.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/local/test/unit/test_mailboxContentLength.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/local/test/unit/test_mailboxContentLength.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/local/test/unit/test_mailboxContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_bug37465.js">mailnews/news/test/unit/test_bug37465.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_bug37465.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_bug37465.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_bug37465.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_bug37465.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_bug37465.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_nntpContentLength.js">mailnews/news/test/unit/test_nntpContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_nntpContentLength.js">file</a> |
<a href="/comm-central/annotate/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_nntpContentLength.js">annotate</a> |
<a href="/comm-central/diff/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_nntpContentLength.js">diff</a> |
<a href="/comm-central/comparison/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_nntpContentLength.js">comparison</a> |
<a href="/comm-central/log/2bdd449748ddaeeb5f8e4c4f0631f8b1f7386089/mailnews/news/test/unit/test_nntpContentLength.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug366491.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug366491.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -6,18 +6,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> // main setup</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> // only needed during debug</span>
<a href="#l1.8"></a><span id="l1.8"> //do_import_script(&quot;mailnews/extensions/bayesian-spam-filter/test/resources/trainingfile.js&quot;);</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> const nsIJunkMailPlugin = Cc[&quot;@mozilla.org/messenger/filter-plugin;1?name=bayesianfilter&quot;]</span>
<a href="#l1.11"></a><span id="l1.11">                             .getService(Ci.nsIJunkMailPlugin);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-const nsIIOService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                       .getService(Ci.nsIIOService);</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15"> // local constants</span>
<a href="#l1.16"></a><span id="l1.16"> const kUnclassified = nsIJunkMailPlugin.UNCLASSIFIED;</span>
<a href="#l1.17"></a><span id="l1.17"> const kJunk = nsIJunkMailPlugin.JUNK;</span>
<a href="#l1.18"></a><span id="l1.18"> const kGood = nsIJunkMailPlugin.GOOD;</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> /*</span>
<a href="#l1.21"></a><span id="l1.21">  * This test is not intended to check the spam calculations,</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -90,12 +88,12 @@ var doTestingListener =</span>
<a href="#l1.23"></a><span id="l1.23">   }</span>
<a href="#l1.24"></a><span id="l1.24"> };</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26"> // helper functions</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28"> function getSpec(aFileName)</span>
<a href="#l1.29"></a><span id="l1.29"> {</span>
<a href="#l1.30"></a><span id="l1.30">   var file = do_get_file(&quot;../../../extensions/bayesian-spam-filter/test/unit/resources/&quot; + aFileName);</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-  var uri = nsIIOService.newFileURI(file).QueryInterface(Ci.nsIURL);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+  var uri = Services.io.newFileURI(file).QueryInterface(Ci.nsIURL);</span>
<a href="#l1.33"></a><span id="l1.33">   uri.query = &quot;type=application/x-message-display&quot;;</span>
<a href="#l1.34"></a><span id="l1.34">   return uri.spec;</span>
<a href="#l1.35"></a><span id="l1.35"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/test/unit/test_imapPump.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_imapPump.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -56,14 +56,11 @@ function run_test()</span>
<a href="#l2.4"></a><span id="l2.4"> /*</span>
<a href="#l2.5"></a><span id="l2.5">  * helper functions</span>
<a href="#l2.6"></a><span id="l2.6">  */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> // given a test file, return the file uri spec</span>
<a href="#l2.9"></a><span id="l2.9"> function specForFileName(aFileName)</span>
<a href="#l2.10"></a><span id="l2.10"> {</span>
<a href="#l2.11"></a><span id="l2.11">   let file = do_get_file(&quot;../../../data/&quot; + aFileName);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  let msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                     .getService(Ci.nsIIOService)</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-                     .newFileURI(file)</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                     .QueryInterface(Ci.nsIFileURL);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l2.17"></a><span id="l2.17">   return msgfileuri.spec;</span>
<a href="#l2.18"></a><span id="l2.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/test/unit/test_postPluginFilters.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_postPluginFilters.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -248,14 +248,12 @@ function startCommand()</span>
<a href="#l3.4"></a><span id="l3.4">       gPOP3Pump.run();</span>
<a href="#l3.5"></a><span id="l3.5">       break;</span>
<a href="#l3.6"></a><span id="l3.6">   }</span>
<a href="#l3.7"></a><span id="l3.7"> }</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> function getSpec(aFileName)</span>
<a href="#l3.10"></a><span id="l3.10"> {</span>
<a href="#l3.11"></a><span id="l3.11">   var file = do_get_file(aFileName);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  var uri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-               .getService(Ci.nsIIOService)</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-               .newFileURI(file).QueryInterface(Ci.nsIURL);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+  var uri = Services.io.newFileURI(file).QueryInterface(Ci.nsIURL);</span>
<a href="#l3.16"></a><span id="l3.16">   uri.query = &quot;type=application/x-message-display&quot;;</span>
<a href="#l3.17"></a><span id="l3.17">   return uri.spec;</span>
<a href="#l3.18"></a><span id="l3.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchChaining.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchChaining.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -52,22 +52,20 @@ function run_test()</span>
<a href="#l4.4"></a><span id="l4.4">   Services.prefs.setBoolPref(&quot;mail.biff.animate_dock_icon&quot;, false);</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6">   // add a single message to the imap inbox.</span>
<a href="#l4.7"></a><span id="l4.7">   let messages = [];</span>
<a href="#l4.8"></a><span id="l4.8">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l4.9"></a><span id="l4.9">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l4.10"></a><span id="l4.10">   gSynthMessage = messages[0];</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                  .getService(Ci.nsIIOService);</span>
<a href="#l4.14"></a><span id="l4.14">   let msgURI =</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-    ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-                     btoa(gSynthMessage.toMessageString()),</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-                     null, null);</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+    Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+                       btoa(gSynthMessage.toMessageString()),</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+                       null, null);</span>
<a href="#l4.21"></a><span id="l4.21">   let imapInbox =  IMAPDaemon.getMailbox(&quot;INBOX&quot;)</span>
<a href="#l4.22"></a><span id="l4.22">   gMessage = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l4.23"></a><span id="l4.23">   imapInbox.addMessage(gMessage);</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">   // Get the IMAP inbox...</span>
<a href="#l4.26"></a><span id="l4.26">   let rootFolder = gIMAPIncomingServer.rootFolder;</span>
<a href="#l4.27"></a><span id="l4.27">   gIMAPInbox = rootFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox)</span>
<a href="#l4.28"></a><span id="l4.28">                          .QueryInterface(Ci.nsIMsgImapMailFolder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpURL.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpURL.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -10,22 +10,18 @@ const smtpURLs =</span>
<a href="#l5.4"></a><span id="l5.4">       username: &quot;user&quot;</span>
<a href="#l5.5"></a><span id="l5.5">     },</span>
<a href="#l5.6"></a><span id="l5.6">     { url: &quot;smtps://user@localhost/&quot;,</span>
<a href="#l5.7"></a><span id="l5.7">       spec: &quot;smtps://user@localhost/&quot;,</span>
<a href="#l5.8"></a><span id="l5.8">       username: &quot;user&quot;</span>
<a href="#l5.9"></a><span id="l5.9">     } ];</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> function run_test() {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  // Get the IO service;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-  var ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-                            .getService(Components.interfaces.nsIIOService);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-</span>
<a href="#l5.16"></a><span id="l5.16">   var url;</span>
<a href="#l5.17"></a><span id="l5.17">   for (var part = 0; part &lt; smtpURLs.length; ++part) {</span>
<a href="#l5.18"></a><span id="l5.18">     print(&quot;url: &quot; + smtpURLs[part].url);</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-    url = ioService.newURI(smtpURLs[part].url, null, null);</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+    url = Services.io.newURI(smtpURLs[part].url, null, null);</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23">     do_check_eq(url.spec, smtpURLs[part].spec);</span>
<a href="#l5.24"></a><span id="l5.24">     do_check_eq(url.username, smtpURLs[part].username);</span>
<a href="#l5.25"></a><span id="l5.25">   }</span>
<a href="#l5.26"></a><span id="l5.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_startup_offline.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_startup_offline.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,40 +1,37 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> /*</span>
<a href="#l6.11"></a><span id="l6.11">  * Test gloda starts up with indexing suppressed when offline at startup.</span>
<a href="#l6.12"></a><span id="l6.12">  */</span>
<a href="#l6.13"></a><span id="l6.13"> </span>
<a href="#l6.14"></a><span id="l6.14"> // We must do this before the first load otherwise gloda is started without</span>
<a href="#l6.15"></a><span id="l6.15"> // picking up the necessary initialisation.</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-var ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-                          .getService(Components.interfaces.nsIIOService2);</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-ioService.manageOfflineStatus = false;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-ioService.offline = true;</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+Services.io.manageOfflineStatus = false;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+Services.io.offline = true;</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23"> load(&quot;resources/glodaTestHelper.js&quot;);</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25"> /**</span>
<a href="#l6.26"></a><span id="l6.26">  * Make sure that if we have to reparse a local folder we do not hang or</span>
<a href="#l6.27"></a><span id="l6.27">  *  anything.  (We had a regression where we would hang.)</span>
<a href="#l6.28"></a><span id="l6.28">  */</span>
<a href="#l6.29"></a><span id="l6.29"> function test_gloda_offline_startup() {</span>
<a href="#l6.30"></a><span id="l6.30">   // Set up a folder for indexing and check the message doesn't get indexed.</span>
<a href="#l6.31"></a><span id="l6.31">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l6.32"></a><span id="l6.32">   yield wait_for_message_injection();</span>
<a href="#l6.33"></a><span id="l6.33">   yield wait_for_gloda_indexer();</span>
<a href="#l6.34"></a><span id="l6.34"> </span>
<a href="#l6.35"></a><span id="l6.35">   // Now go online...</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-  Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-          .getService(Components.interfaces.nsIIOService)</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-          .offline = false;</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+  Services.io.offline = false;</span>
<a href="#l6.40"></a><span id="l6.40"> </span>
<a href="#l6.41"></a><span id="l6.41">   // ...and check we have done the indexing and indexed the message.</span>
<a href="#l6.42"></a><span id="l6.42">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l6.43"></a><span id="l6.43"> }</span>
<a href="#l6.44"></a><span id="l6.44"> </span>
<a href="#l6.45"></a><span id="l6.45"> let tests = [</span>
<a href="#l6.46"></a><span id="l6.46">   test_gloda_offline_startup,</span>
<a href="#l6.47"></a><span id="l6.47"> ];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -24,19 +24,18 @@ var tests = [</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> function setup() {</span>
<a href="#l7.6"></a><span id="l7.6">   setupIMAPPump();</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">   /*</span>
<a href="#l7.9"></a><span id="l7.9">    * Ok, prelude done. Read the original message from disk</span>
<a href="#l7.10"></a><span id="l7.10">    * (through a file URI), and add it to the Inbox.</span>
<a href="#l7.11"></a><span id="l7.11">    */</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  let msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                     .getService(Ci.nsIIOService)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-                     .newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+  let msgfileuri =</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+    Services.io.newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18">   gIMAPMailbox.addMessage(new imapMessage(msgfileuri.spec,</span>
<a href="#l7.19"></a><span id="l7.19">                                           gIMAPMailbox.uidnext++, []));</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">   // ...and download for offline use.</span>
<a href="#l7.22"></a><span id="l7.22">   gIMAPInbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l7.23"></a><span id="l7.23">   yield false;</span>
<a href="#l7.24"></a><span id="l7.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_bug460636.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_bug460636.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -23,19 +23,18 @@ var tests = [</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> function setup() {</span>
<a href="#l8.6"></a><span id="l8.6">   setupIMAPPump();</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">   /*</span>
<a href="#l8.9"></a><span id="l8.9">    * Ok, prelude done. Read the original message from disk</span>
<a href="#l8.10"></a><span id="l8.10">    * (through a file URI), and add it to the Inbox.</span>
<a href="#l8.11"></a><span id="l8.11">    */</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  var msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-                     .getService(Ci.nsIIOService)</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-                     .newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+  var msgfileuri =</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+    Services.io.newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">   gIMAPMailbox.addMessage(new imapMessage(msgfileuri.spec, gIMAPMailbox.uidnext++, []));</span>
<a href="#l8.19"></a><span id="l8.19">   gIMAPInbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l8.20"></a><span id="l8.20">   yield false;</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22">   /*</span>
<a href="#l8.23"></a><span id="l8.23">    * Save the message to a local file. IMapMD corresponds to</span>
<a href="#l8.24"></a><span id="l8.24">    * &lt;profile_dir&gt;/mailtest/ImapMail (where fakeserver puts the IMAP mailbox</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -14,23 +14,20 @@</span>
<a href="#l9.4"></a><span id="l9.4">  // async support</span>
<a href="#l9.5"></a><span id="l9.5"> load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l9.6"></a><span id="l9.6"> load(&quot;../../../resources/mailTestUtils.js&quot;);</span>
<a href="#l9.7"></a><span id="l9.7"> load(&quot;../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> const gFile = do_get_file(&quot;../../../data/bug92111b&quot;);</span>
<a href="#l9.10"></a><span id="l9.10"> var gIMAPDaemon, gIMAPServer, gIMAPIncomingServer;</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-var gIOService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-                  .getService(Ci.nsIIOService);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-</span>
<a href="#l9.15"></a><span id="l9.15"> // Adds some messages directly to a mailbox (eg new mail)</span>
<a href="#l9.16"></a><span id="l9.16"> function addMessageToServer(file, mailbox)</span>
<a href="#l9.17"></a><span id="l9.17"> {</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-  let URI = gIOService.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+  let URI = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l9.20"></a><span id="l9.20">   let msg = new imapMessage(URI.spec, mailbox.uidnext++, []);</span>
<a href="#l9.21"></a><span id="l9.21">   // underestimate the actual file size, like some IMAP servers do</span>
<a href="#l9.22"></a><span id="l9.22">   msg.setSize(file.fileSize - 55);</span>
<a href="#l9.23"></a><span id="l9.23">   mailbox.addMessage(msg);</span>
<a href="#l9.24"></a><span id="l9.24"> }</span>
<a href="#l9.25"></a><span id="l9.25"> </span>
<a href="#l9.26"></a><span id="l9.26"> function run_test()</span>
<a href="#l9.27"></a><span id="l9.27"> {</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineat">@@ -69,34 +66,34 @@ function verifyContentLength()</span>
<a href="#l9.29"></a><span id="l9.29">   let imapS = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l9.30"></a><span id="l9.30">                 .getService(Ci.nsIMsgMessageService);</span>
<a href="#l9.31"></a><span id="l9.31"> </span>
<a href="#l9.32"></a><span id="l9.32">   dump(&quot;getting uri\n&quot;);</span>
<a href="#l9.33"></a><span id="l9.33">   let uri = {};</span>
<a href="#l9.34"></a><span id="l9.34">   imapS.GetUrlForUri(&quot;imap-message://user@localhost/INBOX#1&quot;, uri, null);</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36">   // Get a channel from this URI, and check its content length</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-  let channel = gIOService.newChannelFromURI(uri.value);</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+  let channel = Services.io.newChannelFromURI(uri.value);</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40">   dump(channel + &quot;\n&quot;);</span>
<a href="#l9.41"></a><span id="l9.41"> </span>
<a href="#l9.42"></a><span id="l9.42">   // Read all the contents</span>
<a href="#l9.43"></a><span id="l9.43">   channel.asyncOpen(gStreamListener, null);</span>
<a href="#l9.44"></a><span id="l9.44">   yield false;</span>
<a href="#l9.45"></a><span id="l9.45">   // Now check whether our stream listener got the right bytes</span>
<a href="#l9.46"></a><span id="l9.46">   // First, clean up line endings to avoid CRLF vs. LF differences</span>
<a href="#l9.47"></a><span id="l9.47">   let origData = loadFileToString(gFile).replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l9.48"></a><span id="l9.48">   let streamData = gStreamListener._data.replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l9.49"></a><span id="l9.49">   do_check_eq(origData.length, streamData.length);</span>
<a href="#l9.50"></a><span id="l9.50">   do_check_eq(origData, streamData);</span>
<a href="#l9.51"></a><span id="l9.51"> </span>
<a href="#l9.52"></a><span id="l9.52">   // Now try an attachment. &amp;part=1.2</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-  // let attachmentURL = gIOService.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;,</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-  //                                       null, null);</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-  // let attachmentChannel = gIOService.newChannelFromURI(attachmentURL);</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+  // let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;,</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+  //                                        null, null);</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+  // let attachmentChannel = Services.io.newChannelFromURI(attachmentURL);</span>
<a href="#l9.59"></a><span id="l9.59">   // Currently attachments have their content length set to the length of the</span>
<a href="#l9.60"></a><span id="l9.60">   // entire message</span>
<a href="#l9.61"></a><span id="l9.61">   // do_check_eq(attachmentChannel.contentLength, gFile.fileSize);</span>
<a href="#l9.62"></a><span id="l9.62"> </span>
<a href="#l9.63"></a><span id="l9.63">   yield true;</span>
<a href="#l9.64"></a><span id="l9.64"> }</span>
<a href="#l9.65"></a><span id="l9.65"> </span>
<a href="#l9.66"></a><span id="l9.66"> function endTest()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -31,42 +31,39 @@ const gMsgId1 = &quot;200806061706.m56H6RWT00</span>
<a href="#l10.4"></a><span id="l10.4"> const gMsgId2 = &quot;200804111417.m3BEHTk4030129@mrapp51.mozilla.org&quot;;</span>
<a href="#l10.5"></a><span id="l10.5"> const gMsgId3 = &quot;4849BF7B.2030800@example.com&quot;;</span>
<a href="#l10.6"></a><span id="l10.6"> const gMsgId4 = &quot;bugmail7.m47LtAEf007542@mrapp51.mozilla.org&quot;;</span>
<a href="#l10.7"></a><span id="l10.7"> const gMsgId5 = &quot;bugmail6.m47LtAEf007542@mrapp51.mozilla.org&quot;;</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> // Adds some messages directly to a mailbox (eg new mail)</span>
<a href="#l10.10"></a><span id="l10.10"> function addMessagesToServer(messages, mailbox)</span>
<a href="#l10.11"></a><span id="l10.11"> {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l10.14"></a><span id="l10.14">   // For every message we have, we need to convert it to a file:/// URI</span>
<a href="#l10.15"></a><span id="l10.15">   messages.forEach(function (message)</span>
<a href="#l10.16"></a><span id="l10.16">   {</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-    let URI = ioService.newFileURI(message.file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+    let URI =</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+      Services.io.newFileURI(message.file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l10.20"></a><span id="l10.20">     message.spec = URI.spec;</span>
<a href="#l10.21"></a><span id="l10.21">   });</span>
<a href="#l10.22"></a><span id="l10.22"> </span>
<a href="#l10.23"></a><span id="l10.23">   // Create the imapMessages and store them on the mailbox</span>
<a href="#l10.24"></a><span id="l10.24">   messages.forEach(function (message)</span>
<a href="#l10.25"></a><span id="l10.25">   {</span>
<a href="#l10.26"></a><span id="l10.26">     mailbox.addMessage(new imapMessage(message.spec, mailbox.uidnext++, []));</span>
<a href="#l10.27"></a><span id="l10.27">   });</span>
<a href="#l10.28"></a><span id="l10.28"> }</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30"> function addGeneratedMessagesToServer(messages, mailbox)</span>
<a href="#l10.31"></a><span id="l10.31"> {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l10.34"></a><span id="l10.34">   // Create the imapMessages and store them on the mailbox</span>
<a href="#l10.35"></a><span id="l10.35">   messages.forEach(function (message)</span>
<a href="#l10.36"></a><span id="l10.36">   {</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-    let dataUri = ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-                                    btoa(message.toMessageString()),</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-                                   null, null);</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+    let dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+                                     btoa(message.toMessageString()),</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+                                     null, null);</span>
<a href="#l10.43"></a><span id="l10.43">     mailbox.addMessage(new imapMessage(dataUri.spec, mailbox.uidnext++, []));</span>
<a href="#l10.44"></a><span id="l10.44">   });</span>
<a href="#l10.45"></a><span id="l10.45"> }</span>
<a href="#l10.46"></a><span id="l10.46"> </span>
<a href="#l10.47"></a><span id="l10.47"> </span>
<a href="#l10.48"></a><span id="l10.48"> function checkOfflineStore(prevOfflineStoreSize) {</span>
<a href="#l10.49"></a><span id="l10.49">   dump(&quot;checking offline store\n&quot;);</span>
<a href="#l10.50"></a><span id="l10.50">   let offset = new Object;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -10,18 +10,16 @@</span>
<a href="#l11.4"></a><span id="l11.4">  // async support</span>
<a href="#l11.5"></a><span id="l11.5"> load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l11.6"></a><span id="l11.6"> load(&quot;../../../resources/mailTestUtils.js&quot;);</span>
<a href="#l11.7"></a><span id="l11.7"> load(&quot;../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> var gServer, gIMAPIncomingServer, gIMAPDaemon;</span>
<a href="#l11.10"></a><span id="l11.10"> var gThreadManager = Cc[&quot;@mozilla.org/thread-manager;1&quot;].getService();</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-const ioS = Cc[&quot;@mozilla.org/network/io-service;1&quot;].getService(Ci.nsIIOService);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-</span>
<a href="#l11.14"></a><span id="l11.14"> var tests = [</span>
<a href="#l11.15"></a><span id="l11.15">   streamMessages,</span>
<a href="#l11.16"></a><span id="l11.16">   endTest</span>
<a href="#l11.17"></a><span id="l11.17"> ];</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19"> function run_test()</span>
<a href="#l11.20"></a><span id="l11.20"> {</span>
<a href="#l11.21"></a><span id="l11.21">   gIMAPDaemon = new imapDaemon();</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -53,17 +51,18 @@ function run_test()</span>
<a href="#l11.23"></a><span id="l11.23"> function streamMessages() {</span>
<a href="#l11.24"></a><span id="l11.24">   let inbox = gIMAPDaemon.getMailbox(&quot;INBOX&quot;);</span>
<a href="#l11.25"></a><span id="l11.25">   let imapS = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l11.26"></a><span id="l11.26">                 .getService(Ci.nsIMsgMessageService);</span>
<a href="#l11.27"></a><span id="l11.27">   let fileNames = [];</span>
<a href="#l11.28"></a><span id="l11.28">   let msgFiles = do_get_file(&quot;../../../data/&quot;).directoryEntries;</span>
<a href="#l11.29"></a><span id="l11.29">   while (msgFiles.hasMoreElements()) {</span>
<a href="#l11.30"></a><span id="l11.30">     let file = msgFiles.getNext();</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-    let msgfileuri = ioS.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+    let msgfileuri =</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+      Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l11.34"></a><span id="l11.34">     if (/^bodystructure/i.test(msgfileuri.fileName)) {</span>
<a href="#l11.35"></a><span id="l11.35">       inbox.addMessage(new imapMessage(msgfileuri.spec, inbox.uidnext++, []));</span>
<a href="#l11.36"></a><span id="l11.36">       fileNames.push(msgfileuri.fileName);</span>
<a href="#l11.37"></a><span id="l11.37">     }</span>
<a href="#l11.38"></a><span id="l11.38">   }</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40">   // loop through the files twice, once for plain and one for html check</span>
<a href="#l11.41"></a><span id="l11.41">   let isPlain = true;</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineat">@@ -77,17 +76,17 @@ function streamMessages() {</span>
<a href="#l11.43"></a><span id="l11.43">       markerRe = /thisplaintextneedstodisplaytopasstest/;</span>
<a href="#l11.44"></a><span id="l11.44">     else</span>
<a href="#l11.45"></a><span id="l11.45">       markerRe = /thishtmltextneedstodisplaytopasstest/;</span>
<a href="#l11.46"></a><span id="l11.46"> </span>
<a href="#l11.47"></a><span id="l11.47">     for (let i = 1; i &lt; inbox.uidnext ; i++) {</span>
<a href="#l11.48"></a><span id="l11.48">       let uri = {};</span>
<a href="#l11.49"></a><span id="l11.49">       imapS.GetUrlForUri(&quot;imap-message://user@localhost/INBOX#&quot; + i,uri,null);</span>
<a href="#l11.50"></a><span id="l11.50">       uri.value.spec += &quot;?header=quotebody&quot;;</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-      let channel = ioS.newChannelFromURI(uri.value);</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+      let channel = Services.io.newChannelFromURI(uri.value);</span>
<a href="#l11.53"></a><span id="l11.53">       channel.asyncOpen(gStreamListener, null);</span>
<a href="#l11.54"></a><span id="l11.54">       yield false;</span>
<a href="#l11.55"></a><span id="l11.55">       let buf = gStreamListener._data;</span>
<a href="#l11.56"></a><span id="l11.56">       dump(&quot;##########\nTesting---&gt;&quot; + fileNames[i-1] +</span>
<a href="#l11.57"></a><span id="l11.57">            &quot;; 'prefer plain text': &quot; + isPlain + &quot;\n&quot; +</span>
<a href="#l11.58"></a><span id="l11.58">            buf + &quot;\n&quot; +</span>
<a href="#l11.59"></a><span id="l11.59">            &quot;##########\nTesting---&gt;&quot; + fileNames[i-1] +</span>
<a href="#l11.60"></a><span id="l11.60">            &quot;; 'prefer plain text': &quot; + isPlain + &quot;\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dontStatNoSelect.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dontStatNoSelect.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -6,19 +6,16 @@ var gIMAPInbox, gIMAPFolder1, gIMAPFolde</span>
<a href="#l12.4"></a><span id="l12.4"> var gFolder2Mailbox;</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> load(&quot;../../../resources/messageGenerator.js&quot;);</span>
<a href="#l12.7"></a><span id="l12.7"> // async support</span>
<a href="#l12.8"></a><span id="l12.8"> load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l12.9"></a><span id="l12.9"> load(&quot;../../../resources/mailTestUtils.js&quot;);</span>
<a href="#l12.10"></a><span id="l12.10"> load(&quot;../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-const nsIIOService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-                     .getService(Ci.nsIIOService);</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-</span>
<a href="#l12.15"></a><span id="l12.15"> var tests = [</span>
<a href="#l12.16"></a><span id="l12.16">   checkStatSelect,</span>
<a href="#l12.17"></a><span id="l12.17">   checkStatNoSelect,</span>
<a href="#l12.18"></a><span id="l12.18">   endTest</span>
<a href="#l12.19"></a><span id="l12.19"> ];</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21"> function run_test() {</span>
<a href="#l12.22"></a><span id="l12.22">   var daemon = new imapDaemon();</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineat">@@ -108,19 +105,19 @@ function checkStatNoSelect() {</span>
<a href="#l12.24"></a><span id="l12.24"> </span>
<a href="#l12.25"></a><span id="l12.25"> function addMessageToFolder(mbox) {</span>
<a href="#l12.26"></a><span id="l12.26">   // make a couple messges</span>
<a href="#l12.27"></a><span id="l12.27">   let messages = [];</span>
<a href="#l12.28"></a><span id="l12.28">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l12.29"></a><span id="l12.29">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31">   let msgURI =</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-    nsIIOService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-                     btoa(messages[0].toMessageString()),</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-                     null, null);</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+    Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+                       btoa(messages[0].toMessageString()),</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+                       null, null);</span>
<a href="#l12.38"></a><span id="l12.38">   let message = new imapMessage(msgURI.spec, mbox.uidnext++);</span>
<a href="#l12.39"></a><span id="l12.39">   mbox.addMessage(message);</span>
<a href="#l12.40"></a><span id="l12.40"> }</span>
<a href="#l12.41"></a><span id="l12.41"> </span>
<a href="#l12.42"></a><span id="l12.42"> function endTest()</span>
<a href="#l12.43"></a><span id="l12.43"> {</span>
<a href="#l12.44"></a><span id="l12.44">   do_check_eq(gFolder2.getNumUnread(false), 2);</span>
<a href="#l12.45"></a><span id="l12.45">   // Clean up the server in preparation</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_downloadOffline.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_downloadOffline.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -18,33 +18,32 @@ var tests = [</span>
<a href="#l13.4"></a><span id="l13.4">   downloadAllForOffline,</span>
<a href="#l13.5"></a><span id="l13.5">   verifyDownloaded,</span>
<a href="#l13.6"></a><span id="l13.6">   teardown</span>
<a href="#l13.7"></a><span id="l13.7"> ];</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9"> function setup() {</span>
<a href="#l13.10"></a><span id="l13.10">   setupIMAPPump();</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l13.14"></a><span id="l13.14">  /*</span>
<a href="#l13.15"></a><span id="l13.15">    * Ok, prelude done. Read the original message from disk</span>
<a href="#l13.16"></a><span id="l13.16">    * (through a file URI), and add it to the Inbox.</span>
<a href="#l13.17"></a><span id="l13.17">    */</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-  let msgfileuri = ioService.newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+  let msgfileuri =</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+    Services.io.newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22">   gIMAPMailbox.addMessage(new imapMessage(msgfileuri.spec, gIMAPMailbox.uidnext++, []));</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24">   let messages = [];</span>
<a href="#l13.25"></a><span id="l13.25">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l13.26"></a><span id="l13.26">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l13.27"></a><span id="l13.27">   gSynthMessage = messages[0];</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-  let dataUri = ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-                   btoa(messages[0].toMessageString()),</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-                   null, null);</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+  let dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+                                   btoa(messages[0].toMessageString()),</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+                                   null, null);</span>
<a href="#l13.34"></a><span id="l13.34">   let imapMsg = new imapMessage(dataUri.spec, gIMAPMailbox.uidnext++, []);</span>
<a href="#l13.35"></a><span id="l13.35">   imapMsg.setSize(5000);</span>
<a href="#l13.36"></a><span id="l13.36">   gIMAPMailbox.addMessage(imapMsg);</span>
<a href="#l13.37"></a><span id="l13.37">   </span>
<a href="#l13.38"></a><span id="l13.38">   // ...and download for offline use.</span>
<a href="#l13.39"></a><span id="l13.39">   gIMAPInbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l13.40"></a><span id="l13.40">   yield false;</span>
<a href="#l13.41"></a><span id="l13.41"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_fetchCustomAttribute.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_fetchCustomAttribute.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -129,14 +129,11 @@ function run_test()</span>
<a href="#l14.4"></a><span id="l14.4"> /*</span>
<a href="#l14.5"></a><span id="l14.5">  * helper functions</span>
<a href="#l14.6"></a><span id="l14.6">  */</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> // given a test file, return the file uri spec</span>
<a href="#l14.9"></a><span id="l14.9"> function specForFileName(aFileName)</span>
<a href="#l14.10"></a><span id="l14.10"> {</span>
<a href="#l14.11"></a><span id="l14.11">   let file = do_get_file(&quot;../../../data/&quot; + aFileName);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  let msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-                     .getService(Ci.nsIIOService)</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-                     .newFileURI(file)</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-                     .QueryInterface(Ci.nsIFileURL);</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+  let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l14.17"></a><span id="l14.17">   return msgfileuri.spec;</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-}</span>
<a href="#l14.19"></a><span id="l14.19">\ No newline at end of file</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_filterNeedsBody.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_filterNeedsBody.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -109,14 +109,11 @@ actionTestOffline =</span>
<a href="#l15.4"></a><span id="l15.4"> /*</span>
<a href="#l15.5"></a><span id="l15.5">  * helper functions</span>
<a href="#l15.6"></a><span id="l15.6">  */</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> // given a test file, return the file uri spec</span>
<a href="#l15.9"></a><span id="l15.9"> function specForFileName(aFileName)</span>
<a href="#l15.10"></a><span id="l15.10"> {</span>
<a href="#l15.11"></a><span id="l15.11">   let file = do_get_file(&quot;../../../data/&quot; + aFileName);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  let msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-                     .getService(Ci.nsIIOService)</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-                     .newFileURI(file)</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-                     .QueryInterface(Ci.nsIFileURL);</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+  let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l15.17"></a><span id="l15.17">   return msgfileuri.spec;</span>
<a href="#l15.18"></a><span id="l15.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAttachmentSaves.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAttachmentSaves.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -45,22 +45,20 @@ function loadImapMessage()</span>
<a href="#l16.4"></a><span id="l16.4">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l16.5"></a><span id="l16.5">   // create a synthetic message with attachment</span>
<a href="#l16.6"></a><span id="l16.6">   let smsg = gMessageGenerator.makeMessage({</span>
<a href="#l16.7"></a><span id="l16.7">     attachments: [</span>
<a href="#l16.8"></a><span id="l16.8">       {filename: kAttachFileName, body: 'I like cheese!'}</span>
<a href="#l16.9"></a><span id="l16.9">     ],</span>
<a href="#l16.10"></a><span id="l16.10">   });</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-                  .getService(Ci.nsIIOService);</span>
<a href="#l16.14"></a><span id="l16.14">   let msgURI =</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-    ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-                     btoa(smsg.toMessageString()),</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-                     null, null);</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+    Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+                       btoa(smsg.toMessageString()),</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+                       null, null);</span>
<a href="#l16.21"></a><span id="l16.21">   let imapInbox =  gIMAPDaemon.getMailbox(&quot;INBOX&quot;)</span>
<a href="#l16.22"></a><span id="l16.22">   let message = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l16.23"></a><span id="l16.23">   gIMAPMailbox.addMessage(message);</span>
<a href="#l16.24"></a><span id="l16.24">   gIMAPInbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l16.25"></a><span id="l16.25">   yield false;</span>
<a href="#l16.26"></a><span id="l16.26">   do_check_eq(1, gIMAPInbox.getTotalMessages(false));</span>
<a href="#l16.27"></a><span id="l16.27">   let msgHdr = firstMsgHdr(gIMAPInbox);</span>
<a href="#l16.28"></a><span id="l16.28">   do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -282,21 +282,19 @@ var gAutoSyncListener =</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5"> // load and update a message in the imap fake server</span>
<a href="#l17.6"></a><span id="l17.6"> function addMessageToFolder(folder)</span>
<a href="#l17.7"></a><span id="l17.7"> {</span>
<a href="#l17.8"></a><span id="l17.8">   let messages = [];</span>
<a href="#l17.9"></a><span id="l17.9">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l17.10"></a><span id="l17.10">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-                  .getService(Ci.nsIIOService);</span>
<a href="#l17.14"></a><span id="l17.14">   let msgURI =</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-    ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-                     btoa(messages[0].toMessageString()),</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-                     null, null);</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+    Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+                       btoa(messages[0].toMessageString()),</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+                       null, null);</span>
<a href="#l17.21"></a><span id="l17.21">   let imapMailbox =  gIMAPDaemon.getMailbox(folder.name);</span>
<a href="#l17.22"></a><span id="l17.22">   // We add messages with \Seen flag set so that we won't accidentally</span>
<a href="#l17.23"></a><span id="l17.23">   // trigger the code that updates imap folders that have unread messages moved</span>
<a href="#l17.24"></a><span id="l17.24">   // into them.</span>
<a href="#l17.25"></a><span id="l17.25">   gMessage = new imapMessage(msgURI.spec, imapMailbox.uidnext++, [&quot;\\Seen&quot;]);</span>
<a href="#l17.26"></a><span id="l17.26">   imapMailbox.addMessage(gMessage);</span>
<a href="#l17.27"></a><span id="l17.27"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapChunks.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapChunks.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -36,19 +36,18 @@ function run_test()</span>
<a href="#l18.4"></a><span id="l18.4">   Services.prefs.setIntPref(&quot;mail.imap.chunk_add&quot;, 0);</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">   var inbox = gIMAPDaemon.getMailbox(&quot;INBOX&quot;);</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8">   /*</span>
<a href="#l18.9"></a><span id="l18.9">    * Ok, prelude done. Read the original message from disk</span>
<a href="#l18.10"></a><span id="l18.10">    * (through a file URI), and add it to the Inbox.</span>
<a href="#l18.11"></a><span id="l18.11">    */</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  let gIOService = Cc[&quot;@mozilla.org/network/io-service;1&quot;].getService(Ci.nsIIOService);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-  var msgfileuri = gIOService.newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+  var msgfileuri =</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+    Services.io.newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18">   let message = new imapMessage(msgfileuri.spec, inbox.uidnext++, []);</span>
<a href="#l18.19"></a><span id="l18.19">   // report an artificially low size, like gmail and Exchange do</span>
<a href="#l18.20"></a><span id="l18.20">   message.setSize(gMsgFile.fileSize - 100);</span>
<a href="#l18.21"></a><span id="l18.21">   inbox.addMessage(message);</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23">   /*</span>
<a href="#l18.24"></a><span id="l18.24">    * Save the message to a local file. IMapMD corresponds to</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -27,20 +27,17 @@ var tests = [</span>
<a href="#l19.4"></a><span id="l19.4">   setup,</span>
<a href="#l19.5"></a><span id="l19.5">   addMessageToServer,</span>
<a href="#l19.6"></a><span id="l19.6">   verifyContentLength,</span>
<a href="#l19.7"></a><span id="l19.7">   teardown</span>
<a href="#l19.8"></a><span id="l19.8"> ];</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10"> // Adds some messages directly to a mailbox (eg new mail)</span>
<a href="#l19.11"></a><span id="l19.11"> function addMessageToServer() {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-  let URI = ioService.newFileURI(gFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+  let URI = Services.io.newFileURI(gFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l19.17"></a><span id="l19.17">   gIMAPMailbox.addMessage(new imapMessage(URI.spec, gIMAPMailbox.uidnext++, []));</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19">   gIMAPInbox.updateFolder(null);</span>
<a href="#l19.20"></a><span id="l19.20">   yield false;</span>
<a href="#l19.21"></a><span id="l19.21"> }</span>
<a href="#l19.22"></a><span id="l19.22"> </span>
<a href="#l19.23"></a><span id="l19.23"> var msgFolderListener = {</span>
<a href="#l19.24"></a><span id="l19.24">   msgAdded: function(aMsgHdr) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapCopyTimeout.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapCopyTimeout.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -64,22 +64,20 @@ function createTargetFolder()</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> // load and update a message in the imap fake server</span>
<a href="#l20.6"></a><span id="l20.6"> function loadImapMessage()</span>
<a href="#l20.7"></a><span id="l20.7"> {</span>
<a href="#l20.8"></a><span id="l20.8">   let messages = [];</span>
<a href="#l20.9"></a><span id="l20.9">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l20.10"></a><span id="l20.10">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-                  .getService(Ci.nsIIOService);</span>
<a href="#l20.14"></a><span id="l20.14">   let msgURI =</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-    ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-                     btoa(messages[0].toMessageString()),</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-                     null, null);</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+    Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+                       btoa(messages[0].toMessageString()),</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+                       null, null);</span>
<a href="#l20.21"></a><span id="l20.21">   let imapInbox =  gIMAPDaemon.getMailbox(&quot;INBOX&quot;)</span>
<a href="#l20.22"></a><span id="l20.22">   gMessage = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l20.23"></a><span id="l20.23">   gIMAPMailbox.addMessage(gMessage);</span>
<a href="#l20.24"></a><span id="l20.24">   gIMAPInbox.updateFolder(null);</span>
<a href="#l20.25"></a><span id="l20.25">   yield false;</span>
<a href="#l20.26"></a><span id="l20.26">   do_check_eq(1, gIMAPInbox.getTotalMessages(false));</span>
<a href="#l20.27"></a><span id="l20.27">   let msgHdr = firstMsgHdr(gIMAPInbox);</span>
<a href="#l20.28"></a><span id="l20.28">   do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -696,20 +696,17 @@ function listMessages(folder) {</span>
<a href="#l21.4"></a><span id="l21.4">     dump(msgCount + &quot;: &quot; + hdr.subject + &quot;\n&quot;);</span>
<a href="#l21.5"></a><span id="l21.5">   }</span>
<a href="#l21.6"></a><span id="l21.6"> }</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> // given a test file, return the file uri spec</span>
<a href="#l21.9"></a><span id="l21.9"> function specForFileName(aFileName)</span>
<a href="#l21.10"></a><span id="l21.10"> {</span>
<a href="#l21.11"></a><span id="l21.11">   let file = do_get_file(&quot;../../../data/&quot; + aFileName);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  let msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-                     .getService(Ci.nsIIOService)</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-                     .newFileURI(file)</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-                     .QueryInterface(Ci.nsIFileURL);</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+  let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l21.17"></a><span id="l21.17">   return msgfileuri.spec;</span>
<a href="#l21.18"></a><span id="l21.18"> }</span>
<a href="#l21.19"></a><span id="l21.19"> </span>
<a href="#l21.20"></a><span id="l21.20"> // shorthand for the inbox message summary database</span>
<a href="#l21.21"></a><span id="l21.21"> function db()</span>
<a href="#l21.22"></a><span id="l21.22"> {</span>
<a href="#l21.23"></a><span id="l21.23">   return gIMAPInbox.msgDatabase;</span>
<a href="#l21.24"></a><span id="l21.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFlagChange.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFlagChange.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -110,22 +110,20 @@ function setup() {</span>
<a href="#l22.4"></a><span id="l22.4">   gIMAPDaemon.createMailbox(&quot;secondFolder&quot;, {subscribed : true});</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6">   // build up a diverse list of messages</span>
<a href="#l22.7"></a><span id="l22.7">   let messages = [];</span>
<a href="#l22.8"></a><span id="l22.8">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l22.9"></a><span id="l22.9">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l22.10"></a><span id="l22.10">   gSynthMessage = messages[0];</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-                  .getService(Ci.nsIIOService);</span>
<a href="#l22.14"></a><span id="l22.14">   let msgURI =</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-    ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-                     btoa(gSynthMessage.toMessageString()),</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-                     null, null);</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+    Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+                       btoa(gSynthMessage.toMessageString()),</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+                       null, null);</span>
<a href="#l22.21"></a><span id="l22.21">   gMessage = new imapMessage(msgURI.spec, gIMAPMailbox.uidnext++, []);</span>
<a href="#l22.22"></a><span id="l22.22">   gIMAPMailbox.addMessage(gMessage);</span>
<a href="#l22.23"></a><span id="l22.23"> </span>
<a href="#l22.24"></a><span id="l22.24">   // update folder to download header.</span>
<a href="#l22.25"></a><span id="l22.25">   gIMAPInbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l22.26"></a><span id="l22.26">   yield false;</span>
<a href="#l22.27"></a><span id="l22.27"> }</span>
<a href="#l22.28"></a><span id="l22.28"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHdrChunking.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHdrChunking.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -61,17 +61,17 @@ function uploadImapMessages()</span>
<a href="#l23.4"></a><span id="l23.4">   messages = messages.concat(scenarioFactory.directReply(10));</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6">   // Add 10 messages with uids 1-10.</span>
<a href="#l23.7"></a><span id="l23.7">   let imapInbox = gIMAPDaemon.getMailbox(&quot;INBOX&quot;)</span>
<a href="#l23.8"></a><span id="l23.8">   // Create the imapMessages and store them on the mailbox</span>
<a href="#l23.9"></a><span id="l23.9">   messages.forEach(function (message)</span>
<a href="#l23.10"></a><span id="l23.10">   {</span>
<a href="#l23.11"></a><span id="l23.11">     let dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-                                      btoa(message.toMessageString()),</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+                                     btoa(message.toMessageString()),</span>
<a href="#l23.14"></a><span id="l23.14">                                      null, null);</span>
<a href="#l23.15"></a><span id="l23.15">     imapInbox.addMessage(new imapMessage(dataUri.spec, imapInbox.uidnext++, []));</span>
<a href="#l23.16"></a><span id="l23.16">   });</span>
<a href="#l23.17"></a><span id="l23.17">   // updateFolderWithListener with null for nsIMsgWindow makes biff notify.</span>
<a href="#l23.18"></a><span id="l23.18">   gIMAPInbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l23.19"></a><span id="l23.19">   yield false;</span>
<a href="#l23.20"></a><span id="l23.20"> }</span>
<a href="#l23.21"></a><span id="l23.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHdrStreaming.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHdrStreaming.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -52,23 +52,21 @@ var streamListener =</span>
<a href="#l24.4"></a><span id="l24.4">     }</span>
<a href="#l24.5"></a><span id="l24.5">     this._data += this._stream.read(aCount);</span>
<a href="#l24.6"></a><span id="l24.6">   }</span>
<a href="#l24.7"></a><span id="l24.7"> };</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9"> // Adds some messages directly to a mailbox (eg new mail)</span>
<a href="#l24.10"></a><span id="l24.10"> function addMessagesToServer(messages, mailbox)</span>
<a href="#l24.11"></a><span id="l24.11"> {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-</span>
<a href="#l24.15"></a><span id="l24.15">   // For every message we have, we need to convert it to a file:/// URI</span>
<a href="#l24.16"></a><span id="l24.16">   messages.forEach(function (message)</span>
<a href="#l24.17"></a><span id="l24.17">   {</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-    let URI = ioService.newFileURI(message.file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+    let URI =</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+      Services.io.newFileURI(message.file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l24.21"></a><span id="l24.21">     message.spec = URI.spec;</span>
<a href="#l24.22"></a><span id="l24.22">   });</span>
<a href="#l24.23"></a><span id="l24.23"> </span>
<a href="#l24.24"></a><span id="l24.24">   // Create the imapMessages and store them on the mailbox</span>
<a href="#l24.25"></a><span id="l24.25">   messages.forEach(function (message)</span>
<a href="#l24.26"></a><span id="l24.26">   {</span>
<a href="#l24.27"></a><span id="l24.27">     mailbox.addMessage(new imapMessage(message.spec, mailbox.uidnext++, []));</span>
<a href="#l24.28"></a><span id="l24.28">   });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapStoreMsgOffline.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapStoreMsgOffline.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -59,23 +59,21 @@ var streamListener =</span>
<a href="#l25.4"></a><span id="l25.4"> </span>
<a href="#l25.5"></a><span id="l25.5">     scriptStream.read(aCount);</span>
<a href="#l25.6"></a><span id="l25.6">   }</span>
<a href="#l25.7"></a><span id="l25.7"> };</span>
<a href="#l25.8"></a><span id="l25.8"> </span>
<a href="#l25.9"></a><span id="l25.9"> // Adds some messages directly to a mailbox (eg new mail)</span>
<a href="#l25.10"></a><span id="l25.10"> function addMessagesToServer(messages, mailbox, localFolder)</span>
<a href="#l25.11"></a><span id="l25.11"> {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-</span>
<a href="#l25.15"></a><span id="l25.15">   // For every message we have, we need to convert it to a file:/// URI</span>
<a href="#l25.16"></a><span id="l25.16">   messages.forEach(function (message)</span>
<a href="#l25.17"></a><span id="l25.17">   {</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">-    let URI = ioService.newFileURI(message.file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineplus">+    let URI =</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineplus">+      Services.io.newFileURI(message.file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l25.21"></a><span id="l25.21">     message.spec = URI.spec;</span>
<a href="#l25.22"></a><span id="l25.22">   });</span>
<a href="#l25.23"></a><span id="l25.23"> </span>
<a href="#l25.24"></a><span id="l25.24">   // Create the imapMessages and store them on the mailbox</span>
<a href="#l25.25"></a><span id="l25.25">   messages.forEach(function (message)</span>
<a href="#l25.26"></a><span id="l25.26">   {</span>
<a href="#l25.27"></a><span id="l25.27">     mailbox.addMessage(new imapMessage(message.spec, mailbox.uidnext++, []));</span>
<a href="#l25.28"></a><span id="l25.28">   });</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineat">@@ -180,24 +178,21 @@ var tests = [</span>
<a href="#l25.30"></a><span id="l25.30"> </span>
<a href="#l25.31"></a><span id="l25.31">     let gMessageGenerator = new MessageGenerator();</span>
<a href="#l25.32"></a><span id="l25.32">     messages = messages.concat(gMessageGenerator.makeMessage({body: {body: bodyString, contentType: &quot;text/plain&quot;}}));</span>
<a href="#l25.33"></a><span id="l25.33"> </span>
<a href="#l25.34"></a><span id="l25.34">     gFirstNewMsg = mbox.uidnext;</span>
<a href="#l25.35"></a><span id="l25.35">     // need to account for x-mozilla-status, status2, and envelope.</span>
<a href="#l25.36"></a><span id="l25.36">     gFirstMsgSize = messages[0].toMessageString().length + 102;</span>
<a href="#l25.37"></a><span id="l25.37"> </span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">-    let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">-                      .getService(Ci.nsIIOService);</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineminus">-</span>
<a href="#l25.41"></a><span id="l25.41">     messages.forEach(function (message)</span>
<a href="#l25.42"></a><span id="l25.42">     {</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineminus">-      let dataUri = ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineminus">-                                      btoa(message.toMessageString()),</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineminus">-                                     null, null);</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineplus">+      let dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineplus">+                                       btoa(message.toMessageString()),</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineplus">+                                       null, null);</span>
<a href="#l25.49"></a><span id="l25.49">       mbox.addMessage(new imapMessage(dataUri.spec, mbox.uidnext++, []));</span>
<a href="#l25.50"></a><span id="l25.50">     });</span>
<a href="#l25.51"></a><span id="l25.51">     gIMAPInbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l25.52"></a><span id="l25.52">     yield false;</span>
<a href="#l25.53"></a><span id="l25.53">   },</span>
<a href="#l25.54"></a><span id="l25.54">   function testQueuedOfflineDownload()</span>
<a href="#l25.55"></a><span id="l25.55">   {</span>
<a href="#l25.56"></a><span id="l25.56">     // Make sure that streaming the same message and then trying to download</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -34,24 +34,21 @@ const gMsgId3 = &quot;4849BF7B.2030800@exampl</span>
<a href="#l26.4"></a><span id="l26.4"> const gMsgId4 = &quot;bugmail7.m47LtAEf007542@mrapp51.mozilla.org&quot;;</span>
<a href="#l26.5"></a><span id="l26.5"> const gMsgId5 = &quot;bugmail6.m47LtAEf007542@mrapp51.mozilla.org&quot;;</span>
<a href="#l26.6"></a><span id="l26.6"> </span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9"> // Adds some messages directly to a mailbox (eg new mail)</span>
<a href="#l26.10"></a><span id="l26.10"> function addMessagesToServer(messages, mailbox, localFolder)</span>
<a href="#l26.11"></a><span id="l26.11"> {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-</span>
<a href="#l26.15"></a><span id="l26.15">   // For every message we have, we need to convert it to a file:/// URI</span>
<a href="#l26.16"></a><span id="l26.16">   messages.forEach(function (message)</span>
<a href="#l26.17"></a><span id="l26.17">   {</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineminus">-    message.spec = ioService.newFileURI(message.file)</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineminus">-                     .QueryInterface(Ci.nsIFileURL).spec;</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+    message.spec =</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineplus">+      Services.io.newFileURI(message.file).QueryInterface(Ci.nsIFileURL).spec;</span>
<a href="#l26.22"></a><span id="l26.22">   });</span>
<a href="#l26.23"></a><span id="l26.23"> </span>
<a href="#l26.24"></a><span id="l26.24">   // Create the imapMessages and store them on the mailbox</span>
<a href="#l26.25"></a><span id="l26.25">   messages.forEach(function (message)</span>
<a href="#l26.26"></a><span id="l26.26">   {</span>
<a href="#l26.27"></a><span id="l26.27">     mailbox.addMessage(new imapMessage(message.spec, mailbox.uidnext++, []));</span>
<a href="#l26.28"></a><span id="l26.28">   });</span>
<a href="#l26.29"></a><span id="l26.29"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_largeOfflineStore.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_largeOfflineStore.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -53,34 +53,31 @@ function run_test() {</span>
<a href="#l27.4"></a><span id="l27.4">     teardown();</span>
<a href="#l27.5"></a><span id="l27.5">     return;</span>
<a href="#l27.6"></a><span id="l27.6">   }</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8">   async_run_tests(tests);</span>
<a href="#l27.9"></a><span id="l27.9"> }</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11"> function setup() {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-</span>
<a href="#l27.15"></a><span id="l27.15">   // Create a couple test messages on the IMAP server.</span>
<a href="#l27.16"></a><span id="l27.16">   let messages = [];</span>
<a href="#l27.17"></a><span id="l27.17">   let messageGenerator = new MessageGenerator();</span>
<a href="#l27.18"></a><span id="l27.18">   let scenarioFactory = new MessageScenarioFactory(messageGenerator);</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20">   messages = messages.concat(scenarioFactory.directReply(2));</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineminus">-  let dataUri = ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineplus">+  let dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l27.23"></a><span id="l27.23">                                    btoa(messages[0].toMessageString()),</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineminus">-                                 null, null);</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+                                   null, null);</span>
<a href="#l27.26"></a><span id="l27.26">   let imapMsg = new imapMessage(dataUri.spec, gIMAPMailbox.uidnext++, []);</span>
<a href="#l27.27"></a><span id="l27.27">   gIMAPMailbox.addMessage(imapMsg);</span>
<a href="#l27.28"></a><span id="l27.28"> </span>
<a href="#l27.29"></a><span id="l27.29" class="difflineminus">-  dataUri = ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineplus">+  dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l27.31"></a><span id="l27.31">                                btoa(messages[1].toMessageString()),</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineminus">-                             null, null);</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineplus">+                               null, null);</span>
<a href="#l27.34"></a><span id="l27.34">   imapMsg = new imapMessage(dataUri.spec, gIMAPMailbox.uidnext++, []);</span>
<a href="#l27.35"></a><span id="l27.35">   gIMAPMailbox.addMessage(imapMsg);</span>
<a href="#l27.36"></a><span id="l27.36"> </span>
<a href="#l27.37"></a><span id="l27.37">   // Extend local IMAP inbox to over 4 GiB.</span>
<a href="#l27.38"></a><span id="l27.38">   let outputStream = Cc[&quot;@mozilla.org/network/file-output-stream;1&quot;]</span>
<a href="#l27.39"></a><span id="l27.39">                        .createInstance(Ci.nsIFileOutputStream)</span>
<a href="#l27.40"></a><span id="l27.40">                        .QueryInterface(Ci.nsISeekableStream);</span>
<a href="#l27.41"></a><span id="l27.41">   // Open in write-only mode, no truncate.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -89,23 +89,21 @@ function doUpdateFolder(test)</span>
<a href="#l28.4"></a><span id="l28.4">     resetStatusAndProceed();</span>
<a href="#l28.5"></a><span id="l28.5">   else</span>
<a href="#l28.6"></a><span id="l28.6">     do_timeout(1000, function(){doUpdateFolder(test);});</span>
<a href="#l28.7"></a><span id="l28.7"> }</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9"> // Adds some messages directly to a mailbox (eg new mail)</span>
<a href="#l28.10"></a><span id="l28.10"> function addMessagesToServer(messages, mailbox, localFolder)</span>
<a href="#l28.11"></a><span id="l28.11"> {</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-</span>
<a href="#l28.15"></a><span id="l28.15">   // For every message we have, we need to convert it to a file:/// URI</span>
<a href="#l28.16"></a><span id="l28.16">   messages.forEach(function (message)</span>
<a href="#l28.17"></a><span id="l28.17">   {</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">-    let URI = ioService.newFileURI(message.file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+    let URI =</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+      Services.io.newFileURI(message.file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l28.21"></a><span id="l28.21">     message.spec = URI.spec;</span>
<a href="#l28.22"></a><span id="l28.22">     // We can't get the headers again, so just pass on the message id</span>
<a href="#l28.23"></a><span id="l28.23">     gExpectedEvents.push([gMFNService.msgAdded, {expectedMessageId: message.messageId}]);</span>
<a href="#l28.24"></a><span id="l28.24">   });</span>
<a href="#l28.25"></a><span id="l28.25">   gExpectedEvents.push([gMFNService.msgsClassified,</span>
<a href="#l28.26"></a><span id="l28.26">                         [hdr.messageId for each (hdr in messages)],</span>
<a href="#l28.27"></a><span id="l28.27">                         false, false]);</span>
<a href="#l28.28"></a><span id="l28.28"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlinePlayback.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlinePlayback.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -2,19 +2,16 @@</span>
<a href="#l29.4"></a><span id="l29.4"> /*</span>
<a href="#l29.5"></a><span id="l29.5">  * Test to ensure that changes made while offline are played back when we</span>
<a href="#l29.6"></a><span id="l29.6">  * go back online.</span>
<a href="#l29.7"></a><span id="l29.7">  */</span>
<a href="#l29.8"></a><span id="l29.8"> </span>
<a href="#l29.9"></a><span id="l29.9"> const copyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l29.10"></a><span id="l29.10">                       .getService(Ci.nsIMsgCopyService);</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-const nsIIOService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-                     .getService(Ci.nsIIOService);</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-</span>
<a href="#l29.15"></a><span id="l29.15"> load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l29.16"></a><span id="l29.16"> load(&quot;../../../resources/mailTestUtils.js&quot;);</span>
<a href="#l29.17"></a><span id="l29.17"> load(&quot;../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l29.18"></a><span id="l29.18"> load(&quot;../../../resources/messageGenerator.js&quot;);</span>
<a href="#l29.19"></a><span id="l29.19"> load(&quot;../../../resources/IMAPpump.js&quot;);</span>
<a href="#l29.20"></a><span id="l29.20"> </span>
<a href="#l29.21"></a><span id="l29.21"> var gSecondFolder, gThirdFolder;</span>
<a href="#l29.22"></a><span id="l29.22"> var gSynthMessage1, gSynthMessage2;</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineat">@@ -36,17 +33,17 @@ var tests = [</span>
<a href="#l29.24"></a><span id="l29.24">       thread.processNextEvent(true);</span>
<a href="#l29.25"></a><span id="l29.25"> </span>
<a href="#l29.26"></a><span id="l29.26">     dump(&quot;wait 2 seconds, then go offline\n&quot;);</span>
<a href="#l29.27"></a><span id="l29.27">     do_timeout(2000, async_driver);</span>
<a href="#l29.28"></a><span id="l29.28">     yield false;</span>
<a href="#l29.29"></a><span id="l29.29">   },</span>
<a href="#l29.30"></a><span id="l29.30">   function doOfflineOps() {</span>
<a href="#l29.31"></a><span id="l29.31">     gIMAPServer.stop();</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineminus">-    nsIIOService.offline = true;</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+    Services.io.offline = true;</span>
<a href="#l29.34"></a><span id="l29.34"> </span>
<a href="#l29.35"></a><span id="l29.35">     // Flag the two messages, and then copy them to different folders. Since</span>
<a href="#l29.36"></a><span id="l29.36">     // we're offline, these operations are synchronous.</span>
<a href="#l29.37"></a><span id="l29.37">     let msgHdr1 = gIMAPInbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage1.messageId);</span>
<a href="#l29.38"></a><span id="l29.38">     let msgHdr2 = gIMAPInbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage2.messageId);</span>
<a href="#l29.39"></a><span id="l29.39">     let headers1 = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l29.40"></a><span id="l29.40">                      .createInstance(Ci.nsIMutableArray);</span>
<a href="#l29.41"></a><span id="l29.41">     let headers2 = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l29.42"></a><span id="l29.42" class="difflineat">@@ -63,17 +60,17 @@ var tests = [</span>
<a href="#l29.43"></a><span id="l29.43">     copyService.CopyFileMessage(file, gIMAPInbox, null, false, 0,</span>
<a href="#l29.44"></a><span id="l29.44">                                 &quot;&quot;, asyncCopyListener, null);</span>
<a href="#l29.45"></a><span id="l29.45">     yield false;</span>
<a href="#l29.46"></a><span id="l29.46">   },</span>
<a href="#l29.47"></a><span id="l29.47">   function goOffline() {</span>
<a href="#l29.48"></a><span id="l29.48">     gOfflineManager = Cc[&quot;@mozilla.org/messenger/offline-manager;1&quot;]</span>
<a href="#l29.49"></a><span id="l29.49">                            .getService(Ci.nsIMsgOfflineManager);</span>
<a href="#l29.50"></a><span id="l29.50">     gIMAPDaemon.closing = false;</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-    nsIIOService.offline = false;</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineplus">+    Services.io.offline = false;</span>
<a href="#l29.53"></a><span id="l29.53"> </span>
<a href="#l29.54"></a><span id="l29.54">     gIMAPServer.start(IMAP_PORT);</span>
<a href="#l29.55"></a><span id="l29.55">     gOfflineManager.goOnline(false, true, null);</span>
<a href="#l29.56"></a><span id="l29.56">     do_timeout(2000, async_driver);</span>
<a href="#l29.57"></a><span id="l29.57">     yield false;</span>
<a href="#l29.58"></a><span id="l29.58">   },</span>
<a href="#l29.59"></a><span id="l29.59">   function updateSecondFolder() {</span>
<a href="#l29.60"></a><span id="l29.60">     if (gOfflineManager.inProgress)</span>
<a href="#l29.61"></a><span id="l29.61" class="difflineat">@@ -116,26 +113,26 @@ function setup() {</span>
<a href="#l29.62"></a><span id="l29.62">   let messages = [];</span>
<a href="#l29.63"></a><span id="l29.63">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l29.64"></a><span id="l29.64">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l29.65"></a><span id="l29.65">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l29.66"></a><span id="l29.66">   gSynthMessage1 = messages[0];</span>
<a href="#l29.67"></a><span id="l29.67">   gSynthMessage2 = messages[1];</span>
<a href="#l29.68"></a><span id="l29.68"> </span>
<a href="#l29.69"></a><span id="l29.69">   let msgURI =</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineminus">-    nsIIOService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineminus">-                     btoa(messages[0].toMessageString()),</span>
<a href="#l29.72"></a><span id="l29.72" class="difflineminus">-                     null, null);</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineplus">+    Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l29.74"></a><span id="l29.74" class="difflineplus">+                       btoa(messages[0].toMessageString()),</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineplus">+                       null, null);</span>
<a href="#l29.76"></a><span id="l29.76">   let imapInbox =  gIMAPDaemon.getMailbox(&quot;INBOX&quot;)</span>
<a href="#l29.77"></a><span id="l29.77">   let message = new imapMessage(msgURI.spec, imapInbox.uidnext++, [&quot;\\Seen&quot;]);</span>
<a href="#l29.78"></a><span id="l29.78">   imapInbox.addMessage(message);</span>
<a href="#l29.79"></a><span id="l29.79">   msgURI =</span>
<a href="#l29.80"></a><span id="l29.80" class="difflineminus">-    nsIIOService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l29.81"></a><span id="l29.81" class="difflineminus">-                     btoa(messages[1].toMessageString()),</span>
<a href="#l29.82"></a><span id="l29.82" class="difflineminus">-                     null, null);</span>
<a href="#l29.83"></a><span id="l29.83" class="difflineplus">+    Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l29.84"></a><span id="l29.84" class="difflineplus">+                       btoa(messages[1].toMessageString()),</span>
<a href="#l29.85"></a><span id="l29.85" class="difflineplus">+                       null, null);</span>
<a href="#l29.86"></a><span id="l29.86">   message = new imapMessage(msgURI.spec, imapInbox.uidnext++, [&quot;\\Seen&quot;]);</span>
<a href="#l29.87"></a><span id="l29.87">   imapInbox.addMessage(message);</span>
<a href="#l29.88"></a><span id="l29.88"> </span>
<a href="#l29.89"></a><span id="l29.89">   // update folder to download header.</span>
<a href="#l29.90"></a><span id="l29.90">   gIMAPInbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l29.91"></a><span id="l29.91">   yield false;</span>
<a href="#l29.92"></a><span id="l29.92"> }</span>
<a href="#l29.93"></a><span id="l29.93"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlineStoreLocking.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlineStoreLocking.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -1,17 +1,14 @@</span>
<a href="#l30.4"></a><span id="l30.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l30.5"></a><span id="l30.5"> /*</span>
<a href="#l30.6"></a><span id="l30.6">  * Test to ensure that code that writes to the imap offline store deals</span>
<a href="#l30.7"></a><span id="l30.7">  * with offline store locking correctly.</span>
<a href="#l30.8"></a><span id="l30.8">  */</span>
<a href="#l30.9"></a><span id="l30.9"> </span>
<a href="#l30.10"></a><span id="l30.10" class="difflineminus">-const nsIIOService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l30.11"></a><span id="l30.11" class="difflineminus">-                       .getService(Ci.nsIIOService);</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-</span>
<a href="#l30.13"></a><span id="l30.13"> load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l30.14"></a><span id="l30.14"> load(&quot;../../../resources/mailTestUtils.js&quot;);</span>
<a href="#l30.15"></a><span id="l30.15"> load(&quot;../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l30.16"></a><span id="l30.16"> load(&quot;../../../resources/messageGenerator.js&quot;);</span>
<a href="#l30.17"></a><span id="l30.17"> load(&quot;../../../resources/alertTestUtils.js&quot;);</span>
<a href="#l30.18"></a><span id="l30.18"> load(&quot;../../../resources/IMAPpump.js&quot;);</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineat">@@ -24,24 +21,22 @@ var gMovedMsgId;</span>
<a href="#l30.22"></a><span id="l30.22"> </span>
<a href="#l30.23"></a><span id="l30.23"> function alert(aDialogTitle, aText) {</span>
<a href="#l30.24"></a><span id="l30.24"> //  do_check_eq(aText.indexOf(&quot;Connection to server Mail for  timed out.&quot;), 0);</span>
<a href="#l30.25"></a><span id="l30.25">   gGotAlert = true;</span>
<a href="#l30.26"></a><span id="l30.26"> }</span>
<a href="#l30.27"></a><span id="l30.27"> </span>
<a href="#l30.28"></a><span id="l30.28"> function addGeneratedMessagesToServer(messages, mailbox)</span>
<a href="#l30.29"></a><span id="l30.29"> {</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l30.32"></a><span id="l30.32">   // Create the imapMessages and store them on the mailbox</span>
<a href="#l30.33"></a><span id="l30.33">   messages.forEach(function (message)</span>
<a href="#l30.34"></a><span id="l30.34">   {</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineminus">-    let dataUri = ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineminus">-                                    btoa(message.toMessageString()),</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineminus">-                                   null, null);</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineplus">+    let dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineplus">+                                     btoa(message.toMessageString()),</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineplus">+                                     null, null);</span>
<a href="#l30.41"></a><span id="l30.41">     mailbox.addMessage(new imapMessage(dataUri.spec, mailbox.uidnext++, []));</span>
<a href="#l30.42"></a><span id="l30.42">   });</span>
<a href="#l30.43"></a><span id="l30.43"> }</span>
<a href="#l30.44"></a><span id="l30.44"> </span>
<a href="#l30.45"></a><span id="l30.45"> var gStreamedHdr = null;</span>
<a href="#l30.46"></a><span id="l30.46"> </span>
<a href="#l30.47"></a><span id="l30.47"> function checkOfflineStore(prevOfflineStoreSize) {</span>
<a href="#l30.48"></a><span id="l30.48">   dump(&quot;checking offline store\n&quot;);</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineat">@@ -131,17 +126,17 @@ var tests = [</span>
<a href="#l30.50"></a><span id="l30.50">     yield false;</span>
<a href="#l30.51"></a><span id="l30.51">   },</span>
<a href="#l30.52"></a><span id="l30.52">   function testOfflineBodyCopy() {</span>
<a href="#l30.53"></a><span id="l30.53">     // In order to check that offline copy of messages doesn't try to copy</span>
<a href="#l30.54"></a><span id="l30.54">     // the body if the offline store is locked, we're going to go offline.</span>
<a href="#l30.55"></a><span id="l30.55">     // Thunderbird itself does move/copies pseudo-offline, but that's too</span>
<a href="#l30.56"></a><span id="l30.56">     // hard to test because of the half-second delay.</span>
<a href="#l30.57"></a><span id="l30.57">     gIMAPServer.stop();</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineminus">-    nsIIOService.offline = true;</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineplus">+    Services.io.offline = true;</span>
<a href="#l30.60"></a><span id="l30.60">     let trashHdr;</span>
<a href="#l30.61"></a><span id="l30.61">     let enumerator = gIMAPTrashFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l30.62"></a><span id="l30.62">     let msgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l30.63"></a><span id="l30.63">     gMovedMsgId = msgHdr.messageId;</span>
<a href="#l30.64"></a><span id="l30.64">     let array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l30.65"></a><span id="l30.65">     array.appendElement(msgHdr, false);</span>
<a href="#l30.66"></a><span id="l30.66">     const gCopyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l30.67"></a><span id="l30.67">                           .getService(Ci.nsIMsgCopyService);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_partsOnDemand.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_partsOnDemand.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -47,29 +47,27 @@ function setPrefs() {</span>
<a href="#l31.4"></a><span id="l31.4">   yield true;</span>
<a href="#l31.5"></a><span id="l31.5"> }</span>
<a href="#l31.6"></a><span id="l31.6"> </span>
<a href="#l31.7"></a><span id="l31.7"> // load and update a message in the imap fake server</span>
<a href="#l31.8"></a><span id="l31.8"> function loadImapMessage()</span>
<a href="#l31.9"></a><span id="l31.9"> {</span>
<a href="#l31.10"></a><span id="l31.10">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-                  .getService(Ci.nsIIOService);</span>
<a href="#l31.14"></a><span id="l31.14">   let file = do_get_file(&quot;../../../data/bodystructuretest1&quot;);</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-  let msgURI = ioService.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+  let msgURI = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18">   let imapInbox =  gIMAPDaemon.getMailbox(&quot;INBOX&quot;)</span>
<a href="#l31.19"></a><span id="l31.19">   let message = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l31.20"></a><span id="l31.20">   gIMAPMailbox.addMessage(message);</span>
<a href="#l31.21"></a><span id="l31.21">   // add a second message with no external parts. We want to make</span>
<a href="#l31.22"></a><span id="l31.22">   // sure that streaming this message doesn't mark it read, even</span>
<a href="#l31.23"></a><span id="l31.23">   // though we will fallback to fetching the whole message.</span>
<a href="#l31.24"></a><span id="l31.24">   file = do_get_file(&quot;../../../data/bodystructuretest3&quot;);</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineminus">-  msgURI = ioService.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineplus">+  msgURI = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l31.27"></a><span id="l31.27">   message = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l31.28"></a><span id="l31.28">   gIMAPMailbox.addMessage(message);</span>
<a href="#l31.29"></a><span id="l31.29">   gIMAPInbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l31.30"></a><span id="l31.30">   yield false;</span>
<a href="#l31.31"></a><span id="l31.31"> </span>
<a href="#l31.32"></a><span id="l31.32">   do_check_eq(2, gIMAPInbox.getTotalMessages(false));</span>
<a href="#l31.33"></a><span id="l31.33">   let msgHdr = firstMsgHdr(gIMAPInbox);</span>
<a href="#l31.34"></a><span id="l31.34">   do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_preserveDataOnMove.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_preserveDataOnMove.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -140,19 +140,16 @@ function run_test()</span>
<a href="#l32.4"></a><span id="l32.4"> /*</span>
<a href="#l32.5"></a><span id="l32.5">  * helper functions</span>
<a href="#l32.6"></a><span id="l32.6">  */</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8"> // given a test file, return the file uri spec</span>
<a href="#l32.9"></a><span id="l32.9"> function specForFileName(aFileName)</span>
<a href="#l32.10"></a><span id="l32.10"> {</span>
<a href="#l32.11"></a><span id="l32.11">   let file = do_get_file(&quot;../../../data/&quot; + aFileName);</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  let msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-                     .getService(Ci.nsIIOService)</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineminus">-                     .newFileURI(file)</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineminus">-                     .QueryInterface(Ci.nsIFileURL);</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+  let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l32.17"></a><span id="l32.17">   return msgfileuri.spec;</span>
<a href="#l32.18"></a><span id="l32.18"> }</span>
<a href="#l32.19"></a><span id="l32.19"> </span>
<a href="#l32.20"></a><span id="l32.20"> // shorthand output of a line of text</span>
<a href="#l32.21"></a><span id="l32.21"> function dl(text) {</span>
<a href="#l32.22"></a><span id="l32.22">   dump(text + '\n');</span>
<a href="#l32.23"></a><span id="l32.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_syncChanges.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_syncChanges.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -53,22 +53,20 @@ function setup() {</span>
<a href="#l33.4"></a><span id="l33.4"> </span>
<a href="#l33.5"></a><span id="l33.5">   gIMAPDaemon.createMailbox(&quot;secondFolder&quot;, {subscribed : true});</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7">   let messages = [];</span>
<a href="#l33.8"></a><span id="l33.8">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l33.9"></a><span id="l33.9">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l33.10"></a><span id="l33.10">   gSynthMessage = messages[0];</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">-                  .getService(Ci.nsIIOService);</span>
<a href="#l33.14"></a><span id="l33.14">   let msgURI =</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineminus">-    ioService.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineminus">-                     btoa(gSynthMessage.toMessageString()),</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineminus">-                     null, null);</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineplus">+    Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineplus">+                       btoa(gSynthMessage.toMessageString()),</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineplus">+                       null, null);</span>
<a href="#l33.21"></a><span id="l33.21">   gMessage = new imapMessage(msgURI.spec, gIMAPMailbox.uidnext++, []);</span>
<a href="#l33.22"></a><span id="l33.22">   gIMAPMailbox.addMessage(gMessage);</span>
<a href="#l33.23"></a><span id="l33.23"> </span>
<a href="#l33.24"></a><span id="l33.24">   // update folder to download header.</span>
<a href="#l33.25"></a><span id="l33.25">   gIMAPInbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l33.26"></a><span id="l33.26">   yield false;</span>
<a href="#l33.27"></a><span id="l33.27"> }</span>
<a href="#l33.28"></a><span id="l33.28"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_trustSpamAssassin.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_trustSpamAssassin.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -187,19 +187,16 @@ mfnListener =</span>
<a href="#l34.4"></a><span id="l34.4"> /*</span>
<a href="#l34.5"></a><span id="l34.5">  * helper functions</span>
<a href="#l34.6"></a><span id="l34.6">  */</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8"> // given a test file, return the file uri spec</span>
<a href="#l34.9"></a><span id="l34.9"> function specForFileName(aFileName)</span>
<a href="#l34.10"></a><span id="l34.10"> {</span>
<a href="#l34.11"></a><span id="l34.11">   let file = do_get_file(&quot;../../../data/&quot; + aFileName);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  let msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-                     .getService(Ci.nsIIOService)</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-                     .newFileURI(file)</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineminus">-                     .QueryInterface(Ci.nsIFileURL);</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+  let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l34.17"></a><span id="l34.17">   return msgfileuri.spec;</span>
<a href="#l34.18"></a><span id="l34.18"> }</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20"> // quick shorthand for output of a line of text.</span>
<a href="#l34.21"></a><span id="l34.21"> function dl(text) {</span>
<a href="#l34.22"></a><span id="l34.22">   dump(text + '\n');</span>
<a href="#l34.23"></a><span id="l34.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/local/test/unit/test_mailboxContentLength.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_mailboxContentLength.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -28,26 +28,24 @@ function verifyContentLength(aMessageHea</span>
<a href="#l35.4"></a><span id="l35.4">   let messageUri = gLocalInboxFolder.getUriForMsg(msgHdr);</span>
<a href="#l35.5"></a><span id="l35.5">   // Convert this to a URI that necko can run</span>
<a href="#l35.6"></a><span id="l35.6">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l35.7"></a><span id="l35.7">   let neckoURL = {};</span>
<a href="#l35.8"></a><span id="l35.8">   let messageService = messenger.messageServiceFromURI(messageUri);</span>
<a href="#l35.9"></a><span id="l35.9">   messageService.GetUrlForUri(messageUri, neckoURL, null);</span>
<a href="#l35.10"></a><span id="l35.10">   // Don't use the necko URL directly. Instead, get the spec and create a new</span>
<a href="#l35.11"></a><span id="l35.11">   // URL using the IO service</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-  let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineminus">-  let urlToRun = ioService.newURI(neckoURL.value.spec, null, null);</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+  let urlToRun = Services.io.newURI(neckoURL.value.spec, null, null);</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17">   // Get a channel from this URI, and check its content length</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">-  let channel = ioService.newChannelFromURI(urlToRun);</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+  let channel = Services.io.newChannelFromURI(urlToRun);</span>
<a href="#l35.20"></a><span id="l35.20">   do_check_eq(channel.contentLength, gFile.fileSize);</span>
<a href="#l35.21"></a><span id="l35.21"> </span>
<a href="#l35.22"></a><span id="l35.22">   // Now try an attachment. &amp;part=1.2</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineminus">-  let attachmentURL = ioService.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;,</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineminus">-                                       null, null);</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineminus">-  let attachmentChannel = ioService.newChannelFromURI(attachmentURL);</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineplus">+  let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;,</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineplus">+                                         null, null);</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineplus">+  let attachmentChannel = Services.io.newChannelFromURI(attachmentURL);</span>
<a href="#l35.29"></a><span id="l35.29">   // Currently attachments have their content length set to the length of the</span>
<a href="#l35.30"></a><span id="l35.30">   // entire message</span>
<a href="#l35.31"></a><span id="l35.31">   do_check_eq(channel.contentLength, gFile.fileSize);</span>
<a href="#l35.32"></a><span id="l35.32"> </span>
<a href="#l35.33"></a><span id="l35.33">   do_test_finished();</span>
<a href="#l35.34"></a><span id="l35.34"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug37465.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug37465.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -3,28 +3,27 @@</span>
<a href="#l36.4"></a><span id="l36.4"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l36.5"></a><span id="l36.5"> </span>
<a href="#l36.6"></a><span id="l36.6"> function run_test() {</span>
<a href="#l36.7"></a><span id="l36.7">   var daemon = setupNNTPDaemon();</span>
<a href="#l36.8"></a><span id="l36.8">   var server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l36.9"></a><span id="l36.9">   server.start(NNTP_PORT);</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11">   // Correct URI?</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  let ioSvc = Cc['@mozilla.org/network/io-service;1']</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-                    .getService(Ci.nsIIOService);</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-  let uri = ioSvc.newURI(&quot;news://localhost:1143/1@regular.invalid&quot;, null, null);</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+  let uri = Services.io.newURI(&quot;news://localhost:1143/1@regular.invalid&quot;,</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineplus">+                               null, null);</span>
<a href="#l36.17"></a><span id="l36.17">   let newsUri = uri.QueryInterface(Ci.nsINntpUrl)</span>
<a href="#l36.18"></a><span id="l36.18">                    .QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l36.19"></a><span id="l36.19">   do_check_eq(uri.port, NNTP_PORT);</span>
<a href="#l36.20"></a><span id="l36.20">   do_check_eq(newsUri.server, null);</span>
<a href="#l36.21"></a><span id="l36.21">   do_check_eq(newsUri.messageID, &quot;1@regular.invalid&quot;);</span>
<a href="#l36.22"></a><span id="l36.22">   do_check_eq(newsUri.folder, null);</span>
<a href="#l36.23"></a><span id="l36.23"> </span>
<a href="#l36.24"></a><span id="l36.24">   // Run the URI and make sure we get the message</span>
<a href="#l36.25"></a><span id="l36.25" class="difflineminus">-  let channel = ioSvc.newChannelFromURI(uri);</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineplus">+  let channel = Services.io.newChannelFromURI(uri);</span>
<a href="#l36.27"></a><span id="l36.27">   channel.asyncOpen(articleTextListener, null);</span>
<a href="#l36.28"></a><span id="l36.28"> </span>
<a href="#l36.29"></a><span id="l36.29">   // Run the server</span>
<a href="#l36.30"></a><span id="l36.30">   var thread = gThreadManager.currentThread;</span>
<a href="#l36.31"></a><span id="l36.31">   while (!articleTextListener.finished)</span>
<a href="#l36.32"></a><span id="l36.32">     thread.processNextEvent(true);</span>
<a href="#l36.33"></a><span id="l36.33"> </span>
<a href="#l36.34"></a><span id="l36.34">   do_check_eq(articleTextListener.data,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpContentLength.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpContentLength.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -41,29 +41,27 @@ function run_test() {</span>
<a href="#l37.4"></a><span id="l37.4">     let messageUri = folder.getUriForMsg(msgHdr);</span>
<a href="#l37.5"></a><span id="l37.5">     // Convert this to a URI that necko can run</span>
<a href="#l37.6"></a><span id="l37.6">     let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l37.7"></a><span id="l37.7">     let neckoURL = {};</span>
<a href="#l37.8"></a><span id="l37.8">     let messageService = messenger.messageServiceFromURI(messageUri);</span>
<a href="#l37.9"></a><span id="l37.9">     messageService.GetUrlForUri(messageUri, neckoURL, null);</span>
<a href="#l37.10"></a><span id="l37.10">     // Don't use the necko URL directly. Instead, get the spec and create a new</span>
<a href="#l37.11"></a><span id="l37.11">     // URL using the IO service</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-    let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-                      .getService(Ci.nsIIOService);</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-    let urlToRun = ioService.newURI(neckoURL.value.spec, null, null);</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+    let urlToRun = Services.io.newURI(neckoURL.value.spec, null, null);</span>
<a href="#l37.16"></a><span id="l37.16"> </span>
<a href="#l37.17"></a><span id="l37.17">     // Get a channel from this URI, and check its content length</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineminus">-    let channel = ioService.newChannelFromURI(urlToRun);</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineplus">+    let channel = Services.io.newChannelFromURI(urlToRun);</span>
<a href="#l37.20"></a><span id="l37.20">     do_check_eq(channel.contentLength, kSimpleNewsArticle.length);</span>
<a href="#l37.21"></a><span id="l37.21"> </span>
<a href="#l37.22"></a><span id="l37.22">     // Now try an attachment. &amp;part=1.2</span>
<a href="#l37.23"></a><span id="l37.23">     // XXX the message doesn't really have an attachment</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineminus">-    let attachmentURL = ioService.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;,</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineminus">-                                         null, null);</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineminus">-    let attachmentChannel = ioService.newChannelFromURI(attachmentURL);</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineplus">+    let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;,</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineplus">+                                           null, null);</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineplus">+    let attachmentChannel = Services.io.newChannelFromURI(attachmentURL);</span>
<a href="#l37.30"></a><span id="l37.30">     // Currently attachments have their content length set to the length of the</span>
<a href="#l37.31"></a><span id="l37.31">     // entire message</span>
<a href="#l37.32"></a><span id="l37.32">     do_check_eq(channel.contentLength, kSimpleNewsArticle.length);</span>
<a href="#l37.33"></a><span id="l37.33">   }</span>
<a href="#l37.34"></a><span id="l37.34">   catch (e) {</span>
<a href="#l37.35"></a><span id="l37.35">     server.stop();</span>
<a href="#l37.36"></a><span id="l37.36">     do_throw(e);</span>
<a href="#l37.37"></a><span id="l37.37">   }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

