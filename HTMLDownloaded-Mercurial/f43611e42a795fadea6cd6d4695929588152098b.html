<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25298:f43611e42a795fadea6cd6d4695929588152098b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ f43611e42a795fadea6cd6d4695929588152098b" />
<meta property="og:url" content="/comm-central/rev/f43611e42a795fadea6cd6d4695929588152098b" />
<meta property="og:description" content="Bug 1509779 - Codify unwritten rules in ESLint configuration; r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / f43611e42a795fadea6cd6d4695929588152098b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/f43611e42a795fadea6cd6d4695929588152098b">shortlog</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/f43611e42a795fadea6cd6d4695929588152098b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b">files</a> |
changeset |
<a href="/comm-central/raw-rev/f43611e42a795fadea6cd6d4695929588152098b">raw</a>  | <a href="/comm-central/archive/f43611e42a795fadea6cd6d4695929588152098b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1509779">Bug 1509779</a> - Codify unwritten rules in ESLint configuration; r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 29 Nov 2018 12:04:40 +1300</td></tr>

<tr>
 <td>changeset 25298</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/f43611e42a795fadea6cd6d4695929588152098b">f43611e42a795fadea6cd6d4695929588152098b</a></td>
</tr>



<tr>
<td>parent 25297</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/97d41ef7fee6a9ab617731c3d5519dd96f3d50c8">97d41ef7fee6a9ab617731c3d5519dd96f3d50c8</a>
</td>
</tr>

<tr>
<td>child 25299</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8709d04aee9295aea108b7e20823b550d5d74017">8709d04aee9295aea108b7e20823b550d5d74017</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=f43611e42a795fadea6cd6d4695929588152098b">15178</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Thu, 29 Nov 2018 07:29:46 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8709d04aee92 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8709d04aee9295aea108b7e20823b550d5d74017">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8709d04aee9295aea108b7e20823b550d5d74017&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8709d04aee9295aea108b7e20823b550d5d74017&newProject=comm-central&newRevision=97d41ef7fee6a9ab617731c3d5519dd96f3d50c8&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8709d04aee9295aea108b7e20823b550d5d74017&newProject=comm-central&newRevision=97d41ef7fee6a9ab617731c3d5519dd96f3d50c8&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8709d04aee9295aea108b7e20823b550d5d74017&newProject=comm-central&newRevision=97d41ef7fee6a9ab617731c3d5519dd96f3d50c8&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1509779">1509779</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1509779">Bug 1509779</a> - Codify unwritten rules in ESLint configuration; r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/.eslintrc.js">.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/datetimepicker.xml">common/bindings/datetimepicker.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/datetimepicker.xml">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/datetimepicker.xml">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/datetimepicker.xml">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/datetimepicker.xml">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/datetimepicker.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/preferences.xml">common/bindings/preferences.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/preferences.xml">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/preferences.xml">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/preferences.xml">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/preferences.xml">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/preferences.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/textbox.xml">common/bindings/textbox.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/textbox.xml">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/textbox.xml">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/textbox.xml">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/textbox.xml">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/common/bindings/textbox.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/common/src/customizeToolbar.js">common/src/customizeToolbar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/common/src/customizeToolbar.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/common/src/customizeToolbar.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/common/src/customizeToolbar.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/common/src/customizeToolbar.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/common/src/customizeToolbar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/mailCore.js">mail/base/content/mailCore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/mailCore.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/mailCore.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/mailCore.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/mailCore.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/mailCore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/tabmail.xml">mail/base/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/base/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportMac.js">mail/components/about-support/aboutSupportMac.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportMac.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportMac.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportMac.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportMac.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportMac.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportUnix.js">mail/components/about-support/aboutSupportUnix.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportUnix.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportUnix.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportUnix.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportUnix.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportUnix.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportWin32.js">mail/components/about-support/aboutSupportWin32.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportWin32.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportWin32.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportWin32.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportWin32.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/aboutSupportWin32.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/aboutSupport.js">mail/components/about-support/content/aboutSupport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/aboutSupport.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/aboutSupport.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/aboutSupport.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/aboutSupport.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/aboutSupport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/accounts.js">mail/components/about-support/content/accounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/accounts.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/accounts.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/accounts.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/accounts.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/about-support/content/accounts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/aboutRedirector.js">mail/components/aboutRedirector.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/aboutRedirector.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/aboutRedirector.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/aboutRedirector.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/aboutRedirector.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/aboutRedirector.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/emailWizard.js">mail/components/accountcreation/content/emailWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/emailWizard.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/emailWizard.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/emailWizard.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/emailWizard.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/emailWizard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/fetchhttp.js">mail/components/accountcreation/content/fetchhttp.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/fetchhttp.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/fetchhttp.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/fetchhttp.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/fetchhttp.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/fetchhttp.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/guessConfig.js">mail/components/accountcreation/content/guessConfig.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/guessConfig.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/guessConfig.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/guessConfig.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/guessConfig.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/guessConfig.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/util.js">mail/components/accountcreation/content/util.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/util.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/util.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/util.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/util.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/accountcreation/content/util.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/content/activity.js">mail/components/activity/content/activity.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/content/activity.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/content/activity.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/content/activity.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/content/activity.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/content/activity.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/nsActivityManagerUI.js">mail/components/activity/nsActivityManagerUI.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/nsActivityManagerUI.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/nsActivityManagerUI.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/nsActivityManagerUI.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/nsActivityManagerUI.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/activity/nsActivityManagerUI.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCard.js">mail/components/addrbook/content/abCard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCard.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCard.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCard.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCard.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCardView.js">mail/components/addrbook/content/abCardView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCardView.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCardView.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCardView.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCardView.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abCardView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abTrees.js">mail/components/addrbook/content/abTrees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abTrees.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abTrees.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abTrees.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abTrees.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/abTrees.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/addressbook.js">mail/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/cloudFileAccounts.js">mail/components/cloudfile/cloudFileAccounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/cloudFileAccounts.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/cloudFileAccounts.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/cloudFileAccounts.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/cloudFileAccounts.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/cloudFileAccounts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/content/addAccountDialog.js">mail/components/cloudfile/content/addAccountDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/content/addAccountDialog.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/content/addAccountDialog.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/content/addAccountDialog.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/content/addAccountDialog.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/content/addAccountDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsBox.js">mail/components/cloudfile/nsBox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsBox.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsBox.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsBox.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsBox.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsBox.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsHightail.js">mail/components/cloudfile/nsHightail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsHightail.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsHightail.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsHightail.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsHightail.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/cloudfile/nsHightail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/cloudAttachmentLinkManager.js">mail/components/compose/content/cloudAttachmentLinkManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/cloudAttachmentLinkManager.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/cloudAttachmentLinkManager.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/cloudAttachmentLinkManager.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/cloudAttachmentLinkManager.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/compose/content/cloudAttachmentLinkManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/extensions/test/xpcshell/.eslintrc.js">mail/components/extensions/test/xpcshell/.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/extensions/test/xpcshell/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/extensions/test/xpcshell/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/extensions/test/xpcshell/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/extensions/test/xpcshell/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/extensions/test/xpcshell/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/addbuddy.js">mail/components/im/content/addbuddy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/addbuddy.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/addbuddy.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/addbuddy.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/addbuddy.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/addbuddy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/am-im.js">mail/components/im/content/am-im.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/am-im.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/am-im.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/am-im.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/am-im.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/am-im.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/chat-messenger.js">mail/components/im/content/chat-messenger.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/chat-messenger.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/chat-messenger.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/chat-messenger.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/chat-messenger.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/chat-messenger.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccountWizard.js">mail/components/im/content/imAccountWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccountWizard.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccountWizard.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccountWizard.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccountWizard.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccountWizard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccounts.js">mail/components/im/content/imAccounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccounts.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccounts.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccounts.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccounts.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imAccounts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imContextMenu.js">mail/components/im/content/imContextMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imContextMenu.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imContextMenu.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imContextMenu.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imContextMenu.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imContextMenu.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imStatusSelector.js">mail/components/im/content/imStatusSelector.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imStatusSelector.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imStatusSelector.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imStatusSelector.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imStatusSelector.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imStatusSelector.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imconversation.xml">mail/components/im/content/imconversation.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imconversation.xml">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imconversation.xml">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imconversation.xml">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imconversation.xml">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/imconversation.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/joinchat.js">mail/components/im/content/joinchat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/joinchat.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/joinchat.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/joinchat.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/joinchat.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/content/joinchat.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/messages/papersheets/Footer.html">mail/components/im/messages/papersheets/Footer.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/messages/papersheets/Footer.html">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/messages/papersheets/Footer.html">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/messages/papersheets/Footer.html">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/messages/papersheets/Footer.html">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/messages/papersheets/Footer.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/index_im.jsm">mail/components/im/modules/index_im.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/index_im.jsm">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/index_im.jsm">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/index_im.jsm">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/index_im.jsm">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/index_im.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/search_im.jsm">mail/components/im/modules/search_im.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/search_im.jsm">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/search_im.jsm">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/search_im.jsm">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/search_im.jsm">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/im/modules/search_im.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailContentHandler.js">mail/components/mailContentHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailContentHandler.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailContentHandler.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailContentHandler.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailContentHandler.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailContentHandler.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailGlue.js">mail/components/mailGlue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailGlue.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailGlue.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailGlue.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailGlue.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/mailGlue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/migration/content/migration.js">mail/components/migration/content/migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/migration/content/migration.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/migration/content/migration.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/migration/content/migration.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/migration/content/migration.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/migration/content/migration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisioner.js">mail/components/newmailaccount/content/accountProvisioner.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisioner.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisioner.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisioner.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisioner.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisioner.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisionerTab.js">mail/components/newmailaccount/content/accountProvisionerTab.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisionerTab.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisionerTab.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisionerTab.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisionerTab.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/newmailaccount/content/accountProvisionerTab.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applicationManager.js">mail/components/preferences/applicationManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applicationManager.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applicationManager.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applicationManager.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applicationManager.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applicationManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applications.js">mail/components/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/applications.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/cookies.js">mail/components/preferences/cookies.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/cookies.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/cookies.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/cookies.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/cookies.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/cookies.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/display.js">mail/components/preferences/display.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/display.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/display.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/display.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/display.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/display.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/messagestyle.js">mail/components/preferences/messagestyle.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/messagestyle.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/messagestyle.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/messagestyle.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/messagestyle.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/messagestyle.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferences.js">mail/components/preferences/preferences.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferences.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferences.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferences.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferences.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferences.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferencesTab.js">mail/components/preferences/preferencesTab.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferencesTab.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferencesTab.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferencesTab.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferencesTab.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/preferences/preferencesTab.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/search/SearchIntegration.jsm">mail/components/search/SearchIntegration.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/search/SearchIntegration.jsm">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/search/SearchIntegration.jsm">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/search/SearchIntegration.jsm">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/search/SearchIntegration.jsm">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/search/SearchIntegration.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/wintaskbar/windowsJumpLists.js">mail/components/wintaskbar/windowsJumpLists.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f43611e42a795fadea6cd6d4695929588152098b/mail/components/wintaskbar/windowsJumpLists.js">file</a> |
<a href="/comm-central/annotate/f43611e42a795fadea6cd6d4695929588152098b/mail/components/wintaskbar/windowsJumpLists.js">annotate</a> |
<a href="/comm-central/diff/f43611e42a795fadea6cd6d4695929588152098b/mail/components/wintaskbar/windowsJumpLists.js">diff</a> |
<a href="/comm-central/comparison/f43611e42a795fadea6cd6d4695929588152098b/mail/components/wintaskbar/windowsJumpLists.js">comparison</a> |
<a href="/comm-central/log/f43611e42a795fadea6cd6d4695929588152098b/mail/components/wintaskbar/windowsJumpLists.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.eslintrc.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.eslintrc.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -10,25 +10,28 @@ module.exports = {</span>
<a href="#l1.4"></a><span id="l1.4">   ],</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">   // When adding items to this file please check for effects on sub-directories.</span>
<a href="#l1.7"></a><span id="l1.7">   &quot;plugins&quot;: [</span>
<a href="#l1.8"></a><span id="l1.8">     &quot;mozilla&quot;,</span>
<a href="#l1.9"></a><span id="l1.9">   ],</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">   &quot;rules&quot;: {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    &quot;func-names&quot;: [&quot;error&quot;, &quot;never&quot;],</span>
<a href="#l1.13"></a><span id="l1.13">     &quot;no-multi-spaces&quot;: [&quot;error&quot;, {</span>
<a href="#l1.14"></a><span id="l1.14">       exceptions: {</span>
<a href="#l1.15"></a><span id="l1.15">         &quot;ArrayExpression&quot;: true,</span>
<a href="#l1.16"></a><span id="l1.16">         &quot;AssignmentExpression&quot;: true,</span>
<a href="#l1.17"></a><span id="l1.17">         &quot;ObjectExpression&quot;: true,</span>
<a href="#l1.18"></a><span id="l1.18">         &quot;VariableDeclarator&quot;: true,</span>
<a href="#l1.19"></a><span id="l1.19">       },</span>
<a href="#l1.20"></a><span id="l1.20">       ignoreEOLComments: true,</span>
<a href="#l1.21"></a><span id="l1.21">     }],</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+    &quot;semi-spacing&quot;: [&quot;error&quot;, {&quot;before&quot;: false, &quot;after&quot;: true}],</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+    &quot;space-in-parens&quot;: [&quot;error&quot;, &quot;never&quot;],</span>
<a href="#l1.24"></a><span id="l1.24">   },</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   // The html plugin is enabled via a command line option on eslint. To avoid</span>
<a href="#l1.27"></a><span id="l1.27">   // bad interactions with the xml preprocessor in eslint-plugin-mozilla, we</span>
<a href="#l1.28"></a><span id="l1.28">   // turn off processing of the html plugin for .xml files.</span>
<a href="#l1.29"></a><span id="l1.29">   &quot;settings&quot;: {</span>
<a href="#l1.30"></a><span id="l1.30">     &quot;html/xml-extensions&quot;: [ &quot;.xhtml&quot; ],</span>
<a href="#l1.31"></a><span id="l1.31">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/common/bindings/datetimepicker.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/common/bindings/datetimepicker.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -298,18 +298,19 @@</span>
<a href="#l2.4"></a><span id="l2.4">             return (this.hour &gt;= 12);</span>
<a href="#l2.5"></a><span id="l2.5">           ]]&gt;</span>
<a href="#l2.6"></a><span id="l2.6">         &lt;/getter&gt;</span>
<a href="#l2.7"></a><span id="l2.7">         &lt;setter&gt;</span>
<a href="#l2.8"></a><span id="l2.8">           &lt;![CDATA[</span>
<a href="#l2.9"></a><span id="l2.9">             if (val) {</span>
<a href="#l2.10"></a><span id="l2.10">               if (this.hour &lt; 12)</span>
<a href="#l2.11"></a><span id="l2.11">                 this.hour += 12;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-            } else if (this.hour &gt;= 12)</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+            } else if (this.hour &gt;= 12) {</span>
<a href="#l2.14"></a><span id="l2.14">               this.hour -= 12;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+            }</span>
<a href="#l2.16"></a><span id="l2.16">             return val;</span>
<a href="#l2.17"></a><span id="l2.17">           ]]&gt;</span>
<a href="#l2.18"></a><span id="l2.18">         &lt;/setter&gt;</span>
<a href="#l2.19"></a><span id="l2.19">       &lt;/property&gt;</span>
<a href="#l2.20"></a><span id="l2.20">       &lt;property name=&quot;hideSeconds&quot;&gt;</span>
<a href="#l2.21"></a><span id="l2.21">         &lt;getter&gt;</span>
<a href="#l2.22"></a><span id="l2.22">           return (this.getAttribute(&quot;hideseconds&quot;) == &quot;true&quot;);</span>
<a href="#l2.23"></a><span id="l2.23">         &lt;/getter&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/common/bindings/preferences.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/common/bindings/preferences.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -419,18 +419,19 @@</span>
<a href="#l3.4"></a><span id="l3.4">           case &quot;file&quot;:</span>
<a href="#l3.5"></a><span id="l3.5">             var lf;</span>
<a href="#l3.6"></a><span id="l3.6">             if (typeof(val) == &quot;string&quot;) {</span>
<a href="#l3.7"></a><span id="l3.7">               lf = Cc[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l3.8"></a><span id="l3.8">                      .createInstance(Ci.nsIFile);</span>
<a href="#l3.9"></a><span id="l3.9">               lf.persistentDescriptor = val;</span>
<a href="#l3.10"></a><span id="l3.10">               if (!lf.exists())</span>
<a href="#l3.11"></a><span id="l3.11">                 lf.initWithPath(val);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-            } else</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+            } else {</span>
<a href="#l3.14"></a><span id="l3.14">               lf = val.QueryInterface(Ci.nsIFile);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+            }</span>
<a href="#l3.16"></a><span id="l3.16">             this.preferences.rootBranch</span>
<a href="#l3.17"></a><span id="l3.17">                 .setComplexValue(this.name, Ci.nsIFile, lf);</span>
<a href="#l3.18"></a><span id="l3.18">             break;</span>
<a href="#l3.19"></a><span id="l3.19">           default:</span>
<a href="#l3.20"></a><span id="l3.20">             this._reportUnknownType();</span>
<a href="#l3.21"></a><span id="l3.21">           }</span>
<a href="#l3.22"></a><span id="l3.22">           if (!this.batching)</span>
<a href="#l3.23"></a><span id="l3.23">             this.preferences.service.savePrefFile(null);</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineat">@@ -477,28 +478,29 @@</span>
<a href="#l3.25"></a><span id="l3.25">            * constructor or property getters appropriately handle this state.</span>
<a href="#l3.26"></a><span id="l3.26">            */</span>
<a href="#l3.27"></a><span id="l3.27">           function setValue(element, attribute, value) {</span>
<a href="#l3.28"></a><span id="l3.28">             if (attribute in element)</span>
<a href="#l3.29"></a><span id="l3.29">               element[attribute] = value;</span>
<a href="#l3.30"></a><span id="l3.30">             else</span>
<a href="#l3.31"></a><span id="l3.31">               element.setAttribute(attribute, value);</span>
<a href="#l3.32"></a><span id="l3.32">           }</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-          if (aElement.localName == &quot;checkbox&quot;)</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+          if (aElement.localName == &quot;checkbox&quot;) {</span>
<a href="#l3.35"></a><span id="l3.35">             setValue(aElement, &quot;checked&quot;, val);</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-          else if (aElement.localName == &quot;colorpicker&quot;)</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+          } else if (aElement.localName == &quot;colorpicker&quot;) {</span>
<a href="#l3.38"></a><span id="l3.38">             setValue(aElement, &quot;color&quot;, val);</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-          else if (aElement.localName == &quot;textbox&quot;) {</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+          } else if (aElement.localName == &quot;textbox&quot;) {</span>
<a href="#l3.41"></a><span id="l3.41">             // XXXmano Bug 303998: Avoid a caret placement issue if either the</span>
<a href="#l3.42"></a><span id="l3.42">             // preference observer or its setter calls updateElements as a result</span>
<a href="#l3.43"></a><span id="l3.43">             // of the input event handler.</span>
<a href="#l3.44"></a><span id="l3.44">             if (aElement.value !== val)</span>
<a href="#l3.45"></a><span id="l3.45">               setValue(aElement, &quot;value&quot;, val);</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-          } else</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+          } else {</span>
<a href="#l3.48"></a><span id="l3.48">             setValue(aElement, &quot;value&quot;, val);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+          }</span>
<a href="#l3.50"></a><span id="l3.50">         ]]&gt;</span>
<a href="#l3.51"></a><span id="l3.51">         &lt;/body&gt;</span>
<a href="#l3.52"></a><span id="l3.52">       &lt;/method&gt;</span>
<a href="#l3.53"></a><span id="l3.53"> </span>
<a href="#l3.54"></a><span id="l3.54">       &lt;method name=&quot;getElementValue&quot;&gt;</span>
<a href="#l3.55"></a><span id="l3.55">         &lt;parameter name=&quot;aElement&quot;/&gt;</span>
<a href="#l3.56"></a><span id="l3.56">         &lt;body&gt;</span>
<a href="#l3.57"></a><span id="l3.57">         &lt;![CDATA[</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineat">@@ -775,18 +777,19 @@</span>
<a href="#l3.59"></a><span id="l3.59">                 this._pane.loaded = true;</span>
<a href="#l3.60"></a><span id="l3.60">                 this._outer._fireEvent(&quot;paneload&quot;, this._pane);</span>
<a href="#l3.61"></a><span id="l3.61">                 this._outer._selectPane(this._pane);</span>
<a href="#l3.62"></a><span id="l3.62">               },</span>
<a href="#l3.63"></a><span id="l3.63">             };</span>
<a href="#l3.64"></a><span id="l3.64"> </span>
<a href="#l3.65"></a><span id="l3.65">             var obs = new OverlayLoadObserver(aPaneElement);</span>
<a href="#l3.66"></a><span id="l3.66">             document.loadOverlay(aPaneElement.src, obs);</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-          } else</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+          } else {</span>
<a href="#l3.69"></a><span id="l3.69">             this._selectPane(aPaneElement);</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+          }</span>
<a href="#l3.71"></a><span id="l3.71">         ]]&gt;</span>
<a href="#l3.72"></a><span id="l3.72">         &lt;/body&gt;</span>
<a href="#l3.73"></a><span id="l3.73">       &lt;/method&gt;</span>
<a href="#l3.74"></a><span id="l3.74"> </span>
<a href="#l3.75"></a><span id="l3.75">       &lt;method name=&quot;_fireEvent&quot;&gt;</span>
<a href="#l3.76"></a><span id="l3.76">         &lt;parameter name=&quot;aEventName&quot;/&gt;</span>
<a href="#l3.77"></a><span id="l3.77">         &lt;parameter name=&quot;aTarget&quot;/&gt;</span>
<a href="#l3.78"></a><span id="l3.78">         &lt;body&gt;</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineat">@@ -946,19 +949,19 @@</span>
<a href="#l3.80"></a><span id="l3.80">               this._currentHeight += increment;</span>
<a href="#l3.81"></a><span id="l3.81">             } else {</span>
<a href="#l3.82"></a><span id="l3.82">               aTimer.cancel();</span>
<a href="#l3.83"></a><span id="l3.83">               this._setUpFadeTimer();</span>
<a href="#l3.84"></a><span id="l3.84">             }</span>
<a href="#l3.85"></a><span id="l3.85">           } else if (aTimer == this._fadeTimer) {</span>
<a href="#l3.86"></a><span id="l3.86">             var elt = document.getElementById(this.lastSelected);</span>
<a href="#l3.87"></a><span id="l3.87">             var newOpacity = parseFloat(window.getComputedStyle(elt).opacity) + this._fadeIncrement;</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-            if (newOpacity &lt; 1.0)</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+            if (newOpacity &lt; 1.0) {</span>
<a href="#l3.90"></a><span id="l3.90">               elt.style.opacity = newOpacity;</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineminus">-            else {</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+            } else {</span>
<a href="#l3.93"></a><span id="l3.93">               aTimer.cancel();</span>
<a href="#l3.94"></a><span id="l3.94">               elt.style.opacity = 1.0;</span>
<a href="#l3.95"></a><span id="l3.95">             }</span>
<a href="#l3.96"></a><span id="l3.96">           }</span>
<a href="#l3.97"></a><span id="l3.97">         ]]&gt;</span>
<a href="#l3.98"></a><span id="l3.98">         &lt;/body&gt;</span>
<a href="#l3.99"></a><span id="l3.99">       &lt;/method&gt;</span>
<a href="#l3.100"></a><span id="l3.100"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/common/bindings/textbox.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/common/bindings/textbox.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -117,17 +117,17 @@</span>
<a href="#l4.4"></a><span id="l4.4">                                       onget=&quot;return this.inputField.selectionStart;&quot;/&gt;</span>
<a href="#l4.5"></a><span id="l4.5">       &lt;property name=&quot;selectionEnd&quot;   onset=&quot;this.inputField.selectionEnd = val; return val;&quot;</span>
<a href="#l4.6"></a><span id="l4.6">                                       onget=&quot;return this.inputField.selectionEnd;&quot;/&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">       &lt;method name=&quot;setSelectionRange&quot;&gt;</span>
<a href="#l4.9"></a><span id="l4.9">         &lt;parameter name=&quot;aSelectionStart&quot;/&gt;</span>
<a href="#l4.10"></a><span id="l4.10">         &lt;parameter name=&quot;aSelectionEnd&quot;/&gt;</span>
<a href="#l4.11"></a><span id="l4.11">         &lt;body&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-          this.inputField.setSelectionRange( aSelectionStart, aSelectionEnd );</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+          this.inputField.setSelectionRange(aSelectionStart, aSelectionEnd);</span>
<a href="#l4.14"></a><span id="l4.14">         &lt;/body&gt;</span>
<a href="#l4.15"></a><span id="l4.15">       &lt;/method&gt;</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">       &lt;method name=&quot;_setNewlineHandling&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.19"></a><span id="l4.19">           var str = this.getAttribute(&quot;newlines&quot;);</span>
<a href="#l4.20"></a><span id="l4.20">           if (str &amp;&amp; this.editor) {</span>
<a href="#l4.21"></a><span id="l4.21">             for (let x in Ci.nsIPlaintextEditor) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/common/src/customizeToolbar.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/common/src/customizeToolbar.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -338,21 +338,21 @@ function buildPalette() {</span>
<a href="#l5.4"></a><span id="l5.4">  * Makes sure that an item that has been cloned from a template</span>
<a href="#l5.5"></a><span id="l5.5">  * is stripped of any attributes that may adversely affect its</span>
<a href="#l5.6"></a><span id="l5.6">  * appearance in the palette.</span>
<a href="#l5.7"></a><span id="l5.7">  */</span>
<a href="#l5.8"></a><span id="l5.8"> function cleanUpItemForPalette(aItem, aWrapper) {</span>
<a href="#l5.9"></a><span id="l5.9">   aWrapper.setAttribute(&quot;place&quot;, &quot;palette&quot;);</span>
<a href="#l5.10"></a><span id="l5.10">   setWrapperType(aItem, aWrapper);</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  if (aItem.hasAttribute(&quot;title&quot;))</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  if (aItem.hasAttribute(&quot;title&quot;)) {</span>
<a href="#l5.14"></a><span id="l5.14">     aWrapper.setAttribute(&quot;title&quot;, aItem.getAttribute(&quot;title&quot;));</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-  else if (aItem.hasAttribute(&quot;label&quot;))</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+  } else if (aItem.hasAttribute(&quot;label&quot;)) {</span>
<a href="#l5.17"></a><span id="l5.17">     aWrapper.setAttribute(&quot;title&quot;, aItem.getAttribute(&quot;label&quot;));</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-  else if (isSpecialItem(aItem)) {</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+  } else if (isSpecialItem(aItem)) {</span>
<a href="#l5.20"></a><span id="l5.20">     var stringBundle = document.getElementById(&quot;stringBundle&quot;);</span>
<a href="#l5.21"></a><span id="l5.21">     // Remove the common &quot;toolbar&quot; prefix to generate the string name.</span>
<a href="#l5.22"></a><span id="l5.22">     var title = stringBundle.getString(aItem.localName.slice(7) + &quot;Title&quot;);</span>
<a href="#l5.23"></a><span id="l5.23">     aWrapper.setAttribute(&quot;title&quot;, title);</span>
<a href="#l5.24"></a><span id="l5.24">   }</span>
<a href="#l5.25"></a><span id="l5.25">   aWrapper.setAttribute(&quot;tooltiptext&quot;, aWrapper.getAttribute(&quot;title&quot;));</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">   // Remove attributes that screw up our appearance.</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineat">@@ -681,18 +681,19 @@ function onToolbarDragOver(aEvent) {</span>
<a href="#l5.29"></a><span id="l5.29">       dragAfter = aEvent.clientX &gt; dropTargetCenter;</span>
<a href="#l5.30"></a><span id="l5.30">     else</span>
<a href="#l5.31"></a><span id="l5.31">       dragAfter = aEvent.clientX &lt; dropTargetCenter;</span>
<a href="#l5.32"></a><span id="l5.32"> </span>
<a href="#l5.33"></a><span id="l5.33">     if (dragAfter) {</span>
<a href="#l5.34"></a><span id="l5.34">       gCurrentDragOverItem = dropTarget.nextSibling;</span>
<a href="#l5.35"></a><span id="l5.35">       if (!gCurrentDragOverItem)</span>
<a href="#l5.36"></a><span id="l5.36">         gCurrentDragOverItem = toolbar;</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-    } else</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+    } else {</span>
<a href="#l5.39"></a><span id="l5.39">       gCurrentDragOverItem = dropTarget;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+    }</span>
<a href="#l5.41"></a><span id="l5.41">   }</span>
<a href="#l5.42"></a><span id="l5.42"> </span>
<a href="#l5.43"></a><span id="l5.43">   if (previousDragItem &amp;&amp; gCurrentDragOverItem != previousDragItem) {</span>
<a href="#l5.44"></a><span id="l5.44">     setDragActive(previousDragItem, false);</span>
<a href="#l5.45"></a><span id="l5.45">   }</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47">   setDragActive(gCurrentDragOverItem, true);</span>
<a href="#l5.48"></a><span id="l5.48"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/mailCore.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/mailCore.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -494,19 +494,19 @@ function openAddonPrefs(aURL, aOptionsTy</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> function openActivityMgr() {</span>
<a href="#l6.6"></a><span id="l6.6">   Cc[&quot;@mozilla.org/activity-manager-ui;1&quot;].</span>
<a href="#l6.7"></a><span id="l6.7">     getService(Ci.nsIActivityManagerUI).show(window);</span>
<a href="#l6.8"></a><span id="l6.8"> }</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> function openIMAccountMgr() {</span>
<a href="#l6.11"></a><span id="l6.11">   var win = Services.wm.getMostRecentWindow(&quot;Messenger:Accounts&quot;);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  if (win)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  if (win) {</span>
<a href="#l6.14"></a><span id="l6.14">     win.focus();</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-  else {</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+  } else {</span>
<a href="#l6.17"></a><span id="l6.17">     win = Services.ww.openWindow(null,</span>
<a href="#l6.18"></a><span id="l6.18">                                  &quot;chrome://messenger/content/chat/imAccounts.xul&quot;,</span>
<a href="#l6.19"></a><span id="l6.19">                                  &quot;Accounts&quot;, &quot;chrome,resizable,centerscreen&quot;,</span>
<a href="#l6.20"></a><span id="l6.20">                                  null);</span>
<a href="#l6.21"></a><span id="l6.21">   }</span>
<a href="#l6.22"></a><span id="l6.22">   return win;</span>
<a href="#l6.23"></a><span id="l6.23"> }</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25" class="difflineat">@@ -527,19 +527,19 @@ function openIMAccountWizard() {</span>
<a href="#l6.26"></a><span id="l6.26">   }</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28">   window.openDialog(kUrl, kName, kFeatures);</span>
<a href="#l6.29"></a><span id="l6.29"> }</span>
<a href="#l6.30"></a><span id="l6.30"> </span>
<a href="#l6.31"></a><span id="l6.31"> function openSavedFilesWnd() {</span>
<a href="#l6.32"></a><span id="l6.32">   let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l6.33"></a><span id="l6.33">   let downloadsBrowser = tabmail.getBrowserForDocumentId(&quot;aboutDownloads&quot;);</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-  if (downloadsBrowser)</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+  if (downloadsBrowser) {</span>
<a href="#l6.36"></a><span id="l6.36">     tabmail.switchToTab(downloadsBrowser);</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-  else {</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+  } else {</span>
<a href="#l6.39"></a><span id="l6.39">     tabmail.openTab(&quot;chromeTab&quot;,</span>
<a href="#l6.40"></a><span id="l6.40">                     { chromePage: &quot;about:downloads&quot;,</span>
<a href="#l6.41"></a><span id="l6.41">                       clickHandler: &quot;specialTabs.aboutClickHandler(event);&quot; });</span>
<a href="#l6.42"></a><span id="l6.42">   }</span>
<a href="#l6.43"></a><span id="l6.43"> }</span>
<a href="#l6.44"></a><span id="l6.44"> </span>
<a href="#l6.45"></a><span id="l6.45"> function SetBusyCursor(window, enable) {</span>
<a href="#l6.46"></a><span id="l6.46">     // setCursor() is only available for chrome windows.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -346,19 +346,19 @@</span>
<a href="#l7.4"></a><span id="l7.4">           for (let [modeName, modeDetails] of Object.entries(aTabType.modes)) {</span>
<a href="#l7.5"></a><span id="l7.5">             modeDetails.name = modeName;</span>
<a href="#l7.6"></a><span id="l7.6">             modeDetails.tabType = aTabType;</span>
<a href="#l7.7"></a><span id="l7.7">             modeDetails.tabs = [];</span>
<a href="#l7.8"></a><span id="l7.8">             this.tabModes[modeName] = modeDetails;</span>
<a href="#l7.9"></a><span id="l7.9">             if (modeDetails.isDefault)</span>
<a href="#l7.10"></a><span id="l7.10">               this.defaultTabMode = modeDetails;</span>
<a href="#l7.11"></a><span id="l7.11">           }</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-          if (aTabType.panelId)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+          if (aTabType.panelId) {</span>
<a href="#l7.14"></a><span id="l7.14">             aTabType.panel = document.getElementById(aTabType.panelId);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-          else if (!aTabType.perTabPanel) {</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+          } else if (!aTabType.perTabPanel) {</span>
<a href="#l7.17"></a><span id="l7.17">             throw new Error(&quot;Trying to register a tab type with neither panelId &quot; +</span>
<a href="#l7.18"></a><span id="l7.18">                             &quot;nor perTabPanel attributes.&quot;);</span>
<a href="#l7.19"></a><span id="l7.19">           }</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">           setTimeout(() =&gt; {</span>
<a href="#l7.22"></a><span id="l7.22">             for (let modeName of Object.keys(aTabType.modes)) {</span>
<a href="#l7.23"></a><span id="l7.23">               for (let i = 0; i &lt; this.unrestoredTabs.length;) {</span>
<a href="#l7.24"></a><span id="l7.24">                 let state = this.unrestoredTabs[i];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -15,27 +15,27 @@ ChromeUtils.import(&quot;resource:///modules/</span>
<a href="#l8.4"></a><span id="l8.4"> initViewWrapperTestUtils({mode: &quot;imap&quot;, offline: false});</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> /**</span>
<a href="#l8.7"></a><span id="l8.7">  * A custom search term, that just does Subject Contains</span>
<a href="#l8.8"></a><span id="l8.8">  */</span>
<a href="#l8.9"></a><span id="l8.9"> var gCustomSearchTermSubject = {</span>
<a href="#l8.10"></a><span id="l8.10">   id: &quot;mailnews@mozilla.org#test&quot;,</span>
<a href="#l8.11"></a><span id="l8.11">   name: &quot;Test-mailbase Subject&quot;,</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  getEnabled: function subject_getEnabled(scope, op) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  getEnabled(scope, op) {</span>
<a href="#l8.14"></a><span id="l8.14">     return true;</span>
<a href="#l8.15"></a><span id="l8.15">   },</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-  getAvailable: function subject_getAvailable(scope, op) {</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+  getAvailable(scope, op) {</span>
<a href="#l8.18"></a><span id="l8.18">     return true;</span>
<a href="#l8.19"></a><span id="l8.19">   },</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-  getAvailableOperators: function subject_getAvailableOperators(scope, length) {</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+  getAvailableOperators(scope, length) {</span>
<a href="#l8.22"></a><span id="l8.22">     length.value = 1;</span>
<a href="#l8.23"></a><span id="l8.23">     return [Ci.nsMsgSearchOp.Contains];</span>
<a href="#l8.24"></a><span id="l8.24">   },</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-  match: function subject_match(aMsgHdr, aSearchValue, aSearchOp) {</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+  match(aMsgHdr, aSearchValue, aSearchOp) {</span>
<a href="#l8.27"></a><span id="l8.27">     return (aMsgHdr.subject.includes(aSearchValue));</span>
<a href="#l8.28"></a><span id="l8.28">   },</span>
<a href="#l8.29"></a><span id="l8.29">   needsBody: false,</span>
<a href="#l8.30"></a><span id="l8.30"> };</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32"> MailServices.filters.addCustomTerm(gCustomSearchTermSubject);</span>
<a href="#l8.33"></a><span id="l8.33"> </span>
<a href="#l8.34"></a><span id="l8.34"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/about-support/aboutSupportMac.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/about-support/aboutSupportMac.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -4,13 +4,13 @@</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5"> var EXPORTED_SYMBOLS = [&quot;AboutSupportPlatform&quot;];</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> var AboutSupportPlatform = {</span>
<a href="#l9.8"></a><span id="l9.8">   /**</span>
<a href="#l9.9"></a><span id="l9.9">    * Given an nsIFile, gets the file system type. The type is returned as a</span>
<a href="#l9.10"></a><span id="l9.10">    * string. Possible values are &quot;network&quot;, &quot;local&quot;, &quot;unknown&quot; and null.</span>
<a href="#l9.11"></a><span id="l9.11">    */</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  getFileSystemType: function ASPMac_getFileSystemType(aFile) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  getFileSystemType(aFile) {</span>
<a href="#l9.14"></a><span id="l9.14">     // Not implemented</span>
<a href="#l9.15"></a><span id="l9.15">     return null;</span>
<a href="#l9.16"></a><span id="l9.16">   },</span>
<a href="#l9.17"></a><span id="l9.17"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/about-support/aboutSupportUnix.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/about-support/aboutSupportUnix.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -40,17 +40,17 @@ if (gLibsExist) {</span>
<a href="#l10.4"></a><span id="l10.4">   );</span>
<a href="#l10.5"></a><span id="l10.5"> }</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> var AboutSupportPlatform = {</span>
<a href="#l10.8"></a><span id="l10.8">   /**</span>
<a href="#l10.9"></a><span id="l10.9">    * Given an nsIFile, gets the file system type. The type is returned as a</span>
<a href="#l10.10"></a><span id="l10.10">    * string. Possible values are &quot;network&quot;, &quot;local&quot;, &quot;unknown&quot; and null.</span>
<a href="#l10.11"></a><span id="l10.11">    */</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  getFileSystemType: function ASPUnix_getFileSystemType(aFile) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  getFileSystemType(aFile) {</span>
<a href="#l10.14"></a><span id="l10.14">     // Check if the libs exist.</span>
<a href="#l10.15"></a><span id="l10.15">     if (!gLibsExist)</span>
<a href="#l10.16"></a><span id="l10.16">       return &quot;unknown&quot;;</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18">     try {</span>
<a href="#l10.19"></a><span id="l10.19">       // Given a UTF-8 string, converts it to the current Glib locale.</span>
<a href="#l10.20"></a><span id="l10.20">       let g_filename_from_utf8 = glib.declare(</span>
<a href="#l10.21"></a><span id="l10.21">         &quot;g_filename_from_utf8&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/about-support/aboutSupportWin32.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/about-support/aboutSupportWin32.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -11,17 +11,17 @@ var BOOL = ctypes.int32_t;</span>
<a href="#l11.4"></a><span id="l11.4"> var DRIVE_UNKNOWN = 0;</span>
<a href="#l11.5"></a><span id="l11.5"> var DRIVE_NETWORK = 4;</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> var AboutSupportPlatform = {</span>
<a href="#l11.8"></a><span id="l11.8">   /**</span>
<a href="#l11.9"></a><span id="l11.9">    * Given an nsIFile, gets the file system type. The type is returned as a</span>
<a href="#l11.10"></a><span id="l11.10">    * string. Possible values are &quot;network&quot;, &quot;local&quot;, &quot;unknown&quot; and null.</span>
<a href="#l11.11"></a><span id="l11.11">    */</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  getFileSystemType: function ASPWin32_getFileSystemType(aFile) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  getFileSystemType(aFile) {</span>
<a href="#l11.14"></a><span id="l11.14">     let kernel32 = ctypes.open(&quot;kernel32.dll&quot;);</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16">     try {</span>
<a href="#l11.17"></a><span id="l11.17">       // Returns the path of the volume a file is on.</span>
<a href="#l11.18"></a><span id="l11.18">       let GetVolumePathName = kernel32.declare(</span>
<a href="#l11.19"></a><span id="l11.19">         &quot;GetVolumePathNameW&quot;,</span>
<a href="#l11.20"></a><span id="l11.20">         ctypes.winapi_abi,</span>
<a href="#l11.21"></a><span id="l11.21">         BOOL,                // return type: 1 indicates success, 0 failure</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/about-support/content/aboutSupport.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/about-support/content/aboutSupport.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -53,17 +53,17 @@ window.addEventListener(&quot;load&quot;, function</span>
<a href="#l12.4"></a><span id="l12.4">   populateAccountsSection();</span>
<a href="#l12.5"></a><span id="l12.5"> });</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> // Each property in this object corresponds to a property in Troubleshoot.jsm's</span>
<a href="#l12.8"></a><span id="l12.8"> // snapshot data.  Each function is passed its property's corresponding data,</span>
<a href="#l12.9"></a><span id="l12.9"> // and it's the function's job to update the page with it.</span>
<a href="#l12.10"></a><span id="l12.10"> var snapshotFormatters = {</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  application: function application(data) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  application(data) {</span>
<a href="#l12.14"></a><span id="l12.14">     let strings = stringBundle();</span>
<a href="#l12.15"></a><span id="l12.15">     $(&quot;application-box&quot;).textContent = data.name;</span>
<a href="#l12.16"></a><span id="l12.16">     $(&quot;useragent-box&quot;).textContent = data.userAgent;</span>
<a href="#l12.17"></a><span id="l12.17">     $(&quot;os-box&quot;).textContent = data.osVersion;</span>
<a href="#l12.18"></a><span id="l12.18">     $(&quot;supportLink&quot;).href = data.supportURL;</span>
<a href="#l12.19"></a><span id="l12.19">     let version = AppConstants.MOZ_APP_VERSION_DISPLAY;</span>
<a href="#l12.20"></a><span id="l12.20">     if (data.vendor)</span>
<a href="#l12.21"></a><span id="l12.21">       version += &quot; (&quot; + data.vendor + &quot;)&quot;;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -160,17 +160,17 @@ var snapshotFormatters = {</span>
<a href="#l12.23"></a><span id="l12.23">       fsTextNode.textContent = fsText;</span>
<a href="#l12.24"></a><span id="l12.24">       profElem.appendChild(fsTextNode);</span>
<a href="#l12.25"></a><span id="l12.25">     } catch (x) {</span>
<a href="#l12.26"></a><span id="l12.26">       Cu.reportError(x);</span>
<a href="#l12.27"></a><span id="l12.27">     }</span>
<a href="#l12.28"></a><span id="l12.28">     // end of TB addition</span>
<a href="#l12.29"></a><span id="l12.29">   },</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  crashes: function crashes(data) {</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  crashes(data) {</span>
<a href="#l12.33"></a><span id="l12.33">     if (!AppConstants.MOZ_CRASHREPORTER)</span>
<a href="#l12.34"></a><span id="l12.34">       return;</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36">     let strings = stringBundle();</span>
<a href="#l12.37"></a><span id="l12.37">     let daysRange = Troubleshoot.kMaxCrashAge / (24 * 60 * 60 * 1000);</span>
<a href="#l12.38"></a><span id="l12.38">     $(&quot;crashes-title&quot;).textContent =</span>
<a href="#l12.39"></a><span id="l12.39">       PluralForm.get(daysRange, strings.GetStringFromName(&quot;crashesTitle&quot;))</span>
<a href="#l12.40"></a><span id="l12.40">                 .replace(&quot;#1&quot;, daysRange);</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineat">@@ -220,77 +220,77 @@ var snapshotFormatters = {</span>
<a href="#l12.42"></a><span id="l12.42">         $.new(&quot;td&quot;, [</span>
<a href="#l12.43"></a><span id="l12.43">           $.new(&quot;a&quot;, crash.id, null, {href: reportURL + crash.id}),</span>
<a href="#l12.44"></a><span id="l12.44">         ]),</span>
<a href="#l12.45"></a><span id="l12.45">         $.new(&quot;td&quot;, formattedDate),</span>
<a href="#l12.46"></a><span id="l12.46">       ]);</span>
<a href="#l12.47"></a><span id="l12.47">     }));</span>
<a href="#l12.48"></a><span id="l12.48">   },</span>
<a href="#l12.49"></a><span id="l12.49"> </span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-  extensions: function extensions(data) {</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+  extensions(data) {</span>
<a href="#l12.52"></a><span id="l12.52">     $.append($(&quot;extensions-tbody&quot;), data.map(function(extension) {</span>
<a href="#l12.53"></a><span id="l12.53">       return $.new(&quot;tr&quot;, [</span>
<a href="#l12.54"></a><span id="l12.54">         $.new(&quot;td&quot;, extension.name),</span>
<a href="#l12.55"></a><span id="l12.55">         $.new(&quot;td&quot;, extension.version),</span>
<a href="#l12.56"></a><span id="l12.56">         $.new(&quot;td&quot;, extension.isActive),</span>
<a href="#l12.57"></a><span id="l12.57">         $.new(&quot;td&quot;, extension.id),</span>
<a href="#l12.58"></a><span id="l12.58">       ]);</span>
<a href="#l12.59"></a><span id="l12.59">     }));</span>
<a href="#l12.60"></a><span id="l12.60">   },</span>
<a href="#l12.61"></a><span id="l12.61"> </span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-  securitySoftware: function securitySoftware(data) {</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+  securitySoftware(data) {</span>
<a href="#l12.64"></a><span id="l12.64">     if (!AppConstants.isPlatformAndVersionAtLeast(&quot;win&quot;, &quot;6.2&quot;)) {</span>
<a href="#l12.65"></a><span id="l12.65">       $(&quot;security-software-title&quot;).hidden = true;</span>
<a href="#l12.66"></a><span id="l12.66">       $(&quot;security-software-table&quot;).hidden = true;</span>
<a href="#l12.67"></a><span id="l12.67">       return;</span>
<a href="#l12.68"></a><span id="l12.68">     }</span>
<a href="#l12.69"></a><span id="l12.69"> </span>
<a href="#l12.70"></a><span id="l12.70">     $(&quot;security-software-antivirus&quot;).textContent = data.registeredAntiVirus;</span>
<a href="#l12.71"></a><span id="l12.71">     $(&quot;security-software-antispyware&quot;).textContent = data.registeredAntiSpyware;</span>
<a href="#l12.72"></a><span id="l12.72">     $(&quot;security-software-firewall&quot;).textContent = data.registeredFirewall;</span>
<a href="#l12.73"></a><span id="l12.73">   },</span>
<a href="#l12.74"></a><span id="l12.74"> </span>
<a href="#l12.75"></a><span id="l12.75"> /* Not used by TB</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-  features: function features(data) {</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+  features(data) {</span>
<a href="#l12.78"></a><span id="l12.78">     $.append($(&quot;features-tbody&quot;), data.map(function(feature) {</span>
<a href="#l12.79"></a><span id="l12.79">       return $.new(&quot;tr&quot;, [</span>
<a href="#l12.80"></a><span id="l12.80">         $.new(&quot;td&quot;, feature.name),</span>
<a href="#l12.81"></a><span id="l12.81">         $.new(&quot;td&quot;, feature.version),</span>
<a href="#l12.82"></a><span id="l12.82">         $.new(&quot;td&quot;, feature.id),</span>
<a href="#l12.83"></a><span id="l12.83">       ]);</span>
<a href="#l12.84"></a><span id="l12.84">     }));</span>
<a href="#l12.85"></a><span id="l12.85">   },</span>
<a href="#l12.86"></a><span id="l12.86"> */</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-  modifiedPreferences: function modifiedPreferences(data) {</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+  modifiedPreferences(data) {</span>
<a href="#l12.89"></a><span id="l12.89">     $.append($(&quot;prefs-tbody&quot;), sortedArrayFromObject(data).map(</span>
<a href="#l12.90"></a><span id="l12.90">       function([name, value]) {</span>
<a href="#l12.91"></a><span id="l12.91">         return $.new(&quot;tr&quot;, [</span>
<a href="#l12.92"></a><span id="l12.92">           $.new(&quot;td&quot;, name, &quot;pref-name&quot;),</span>
<a href="#l12.93"></a><span id="l12.93">           // Very long preference values can cause users problems when they</span>
<a href="#l12.94"></a><span id="l12.94">           // copy and paste them into some text editors.  Long values generally</span>
<a href="#l12.95"></a><span id="l12.95">           // aren't useful anyway, so truncate them to a reasonable length.</span>
<a href="#l12.96"></a><span id="l12.96">           $.new(&quot;td&quot;, String(value).substr(0, 120), &quot;pref-value&quot;),</span>
<a href="#l12.97"></a><span id="l12.97">         ]);</span>
<a href="#l12.98"></a><span id="l12.98">       }</span>
<a href="#l12.99"></a><span id="l12.99">     ));</span>
<a href="#l12.100"></a><span id="l12.100">   },</span>
<a href="#l12.101"></a><span id="l12.101"> </span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-  lockedPreferences: function lockedPreferences(data) {</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineplus">+  lockedPreferences(data) {</span>
<a href="#l12.104"></a><span id="l12.104">     $.append($(&quot;locked-prefs-tbody&quot;), sortedArrayFromObject(data).map(</span>
<a href="#l12.105"></a><span id="l12.105">       function([name, value]) {</span>
<a href="#l12.106"></a><span id="l12.106">         return $.new(&quot;tr&quot;, [</span>
<a href="#l12.107"></a><span id="l12.107">           $.new(&quot;td&quot;, name, &quot;pref-name&quot;),</span>
<a href="#l12.108"></a><span id="l12.108">           $.new(&quot;td&quot;, String(value).substr(0, 120), &quot;pref-value&quot;),</span>
<a href="#l12.109"></a><span id="l12.109">         ]);</span>
<a href="#l12.110"></a><span id="l12.110">       }</span>
<a href="#l12.111"></a><span id="l12.111">     ));</span>
<a href="#l12.112"></a><span id="l12.112">   },</span>
<a href="#l12.113"></a><span id="l12.113"> </span>
<a href="#l12.114"></a><span id="l12.114">   /* eslint-disable complexity */</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineminus">-  graphics: function graphics(data) {</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineplus">+  graphics(data) {</span>
<a href="#l12.117"></a><span id="l12.117">     let strings = stringBundle();</span>
<a href="#l12.118"></a><span id="l12.118"> </span>
<a href="#l12.119"></a><span id="l12.119">     function localizedMsg(msgArray) {</span>
<a href="#l12.120"></a><span id="l12.120">       let nameOrMsg = msgArray.shift();</span>
<a href="#l12.121"></a><span id="l12.121">       if (msgArray.length) {</span>
<a href="#l12.122"></a><span id="l12.122">         // formatStringFromName logs an NS_ASSERTION failure otherwise that says</span>
<a href="#l12.123"></a><span id="l12.123">         // &quot;use GetStringFromName&quot;.  Lame.</span>
<a href="#l12.124"></a><span id="l12.124">         try {</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineat">@@ -655,17 +655,17 @@ var snapshotFormatters = {</span>
<a href="#l12.126"></a><span id="l12.126">       if (Array.isArray(value)) {</span>
<a href="#l12.127"></a><span id="l12.127">         value = localizedMsg(value);</span>
<a href="#l12.128"></a><span id="l12.128">       }</span>
<a href="#l12.129"></a><span id="l12.129">       addRow(&quot;diagnostics&quot;, key, value);</span>
<a href="#l12.130"></a><span id="l12.130">     }</span>
<a href="#l12.131"></a><span id="l12.131">   },</span>
<a href="#l12.132"></a><span id="l12.132">   /* eslint-enable complexity */</span>
<a href="#l12.133"></a><span id="l12.133"> </span>
<a href="#l12.134"></a><span id="l12.134" class="difflineminus">-  media: function media(data) {</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineplus">+  media(data) {</span>
<a href="#l12.136"></a><span id="l12.136">     let strings = stringBundle();</span>
<a href="#l12.137"></a><span id="l12.137"> </span>
<a href="#l12.138"></a><span id="l12.138">     function insertBasicInfo(key, value) {</span>
<a href="#l12.139"></a><span id="l12.139">       function createRow(key, value) {</span>
<a href="#l12.140"></a><span id="l12.140">         let th = $.new(&quot;th&quot;, strings.GetStringFromName(key), &quot;column&quot;);</span>
<a href="#l12.141"></a><span id="l12.141">         let td = $.new(&quot;td&quot;, value);</span>
<a href="#l12.142"></a><span id="l12.142">         td.style[&quot;white-space&quot;] = &quot;pre-wrap&quot;;</span>
<a href="#l12.143"></a><span id="l12.143">         td.colSpan = 8;</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineat">@@ -760,36 +760,36 @@ var snapshotFormatters = {</span>
<a href="#l12.145"></a><span id="l12.145"> </span>
<a href="#l12.146"></a><span id="l12.146">     // Output devices information</span>
<a href="#l12.147"></a><span id="l12.147">     insertDeviceInfo(&quot;output&quot;, data.audioOutputDevices);</span>
<a href="#l12.148"></a><span id="l12.148"> </span>
<a href="#l12.149"></a><span id="l12.149">     // Input devices information</span>
<a href="#l12.150"></a><span id="l12.150">     insertDeviceInfo(&quot;input&quot;, data.audioInputDevices);</span>
<a href="#l12.151"></a><span id="l12.151">   },</span>
<a href="#l12.152"></a><span id="l12.152"> </span>
<a href="#l12.153"></a><span id="l12.153" class="difflineminus">-  javaScript: function javaScript(data) {</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineplus">+  javaScript(data) {</span>
<a href="#l12.155"></a><span id="l12.155">     $(&quot;javascript-incremental-gc&quot;).textContent = data.incrementalGCEnabled;</span>
<a href="#l12.156"></a><span id="l12.156">   },</span>
<a href="#l12.157"></a><span id="l12.157"> </span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-  accessibility: function accessibility(data) {</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineplus">+  accessibility(data) {</span>
<a href="#l12.160"></a><span id="l12.160">     $(&quot;a11y-activated&quot;).textContent = data.isActive;</span>
<a href="#l12.161"></a><span id="l12.161">     $(&quot;a11y-force-disabled&quot;).textContent = data.forceDisabled || 0;</span>
<a href="#l12.162"></a><span id="l12.162"> </span>
<a href="#l12.163"></a><span id="l12.163">     let a11yHandlerUsed = $(&quot;a11y-handler-used&quot;);</span>
<a href="#l12.164"></a><span id="l12.164">     if (a11yHandlerUsed) {</span>
<a href="#l12.165"></a><span id="l12.165">       a11yHandlerUsed.textContent = data.handlerUsed;</span>
<a href="#l12.166"></a><span id="l12.166">     }</span>
<a href="#l12.167"></a><span id="l12.167"> </span>
<a href="#l12.168"></a><span id="l12.168">     let a11yInstantiator = $(&quot;a11y-instantiator&quot;);</span>
<a href="#l12.169"></a><span id="l12.169">     if (a11yInstantiator) {</span>
<a href="#l12.170"></a><span id="l12.170">       a11yInstantiator.textContent = data.instantiator;</span>
<a href="#l12.171"></a><span id="l12.171">     }</span>
<a href="#l12.172"></a><span id="l12.172">   },</span>
<a href="#l12.173"></a><span id="l12.173"> </span>
<a href="#l12.174"></a><span id="l12.174" class="difflineminus">-  libraryVersions: function libraryVersions(data) {</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineplus">+  libraryVersions(data) {</span>
<a href="#l12.176"></a><span id="l12.176">     let strings = stringBundle();</span>
<a href="#l12.177"></a><span id="l12.177">     let trs = [</span>
<a href="#l12.178"></a><span id="l12.178">       $.new(&quot;tr&quot;, [</span>
<a href="#l12.179"></a><span id="l12.179">         $.new(&quot;th&quot;, &quot;&quot;),</span>
<a href="#l12.180"></a><span id="l12.180">         $.new(&quot;th&quot;, strings.GetStringFromName(&quot;minLibVersions&quot;)),</span>
<a href="#l12.181"></a><span id="l12.181">         $.new(&quot;th&quot;, strings.GetStringFromName(&quot;loadedLibVersions&quot;)),</span>
<a href="#l12.182"></a><span id="l12.182">       ]),</span>
<a href="#l12.183"></a><span id="l12.183">     ];</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineat">@@ -800,28 +800,28 @@ var snapshotFormatters = {</span>
<a href="#l12.185"></a><span id="l12.185">           $.new(&quot;td&quot;, val.minVersion),</span>
<a href="#l12.186"></a><span id="l12.186">           $.new(&quot;td&quot;, val.version),</span>
<a href="#l12.187"></a><span id="l12.187">         ]));</span>
<a href="#l12.188"></a><span id="l12.188">       }</span>
<a href="#l12.189"></a><span id="l12.189">     );</span>
<a href="#l12.190"></a><span id="l12.190">     $.append($(&quot;libversions-tbody&quot;), trs);</span>
<a href="#l12.191"></a><span id="l12.191">   },</span>
<a href="#l12.192"></a><span id="l12.192"> </span>
<a href="#l12.193"></a><span id="l12.193" class="difflineminus">-  userJS: function userJS(data) {</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineplus">+  userJS(data) {</span>
<a href="#l12.195"></a><span id="l12.195">     if (!data.exists)</span>
<a href="#l12.196"></a><span id="l12.196">       return;</span>
<a href="#l12.197"></a><span id="l12.197">     let userJSFile = Services.dirsvc.get(&quot;PrefD&quot;, Ci.nsIFile);</span>
<a href="#l12.198"></a><span id="l12.198">     userJSFile.append(&quot;user.js&quot;);</span>
<a href="#l12.199"></a><span id="l12.199">     $(&quot;prefs-user-js-link&quot;).href = Services.io.newFileURI(userJSFile).spec;</span>
<a href="#l12.200"></a><span id="l12.200">     $(&quot;prefs-user-js-section&quot;).style.display = &quot;&quot;;</span>
<a href="#l12.201"></a><span id="l12.201">     // Clear the no-copy class</span>
<a href="#l12.202"></a><span id="l12.202">     $(&quot;prefs-user-js-section&quot;).className = &quot;&quot;;</span>
<a href="#l12.203"></a><span id="l12.203">   },</span>
<a href="#l12.204"></a><span id="l12.204"> </span>
<a href="#l12.205"></a><span id="l12.205" class="difflineminus">-  sandbox: function sandbox(data) {</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineplus">+  sandbox(data) {</span>
<a href="#l12.207"></a><span id="l12.207">     if (!AppConstants.MOZ_SANDBOX)</span>
<a href="#l12.208"></a><span id="l12.208">       return;</span>
<a href="#l12.209"></a><span id="l12.209"> </span>
<a href="#l12.210"></a><span id="l12.210">     let strings = stringBundle();</span>
<a href="#l12.211"></a><span id="l12.211">     let tbody = $(&quot;sandbox-tbody&quot;);</span>
<a href="#l12.212"></a><span id="l12.212">     for (let key in data) {</span>
<a href="#l12.213"></a><span id="l12.213">       // Simplify the display a little in the common case.</span>
<a href="#l12.214"></a><span id="l12.214">       if (key === &quot;hasPrivilegedUserNamespaces&quot; &amp;&amp;</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineat">@@ -857,17 +857,17 @@ var snapshotFormatters = {</span>
<a href="#l12.216"></a><span id="l12.216">         for (let arg of syscall.args) {</span>
<a href="#l12.217"></a><span id="l12.217">           cells.push($.new(&quot;td&quot;, arg, &quot;integer&quot;));</span>
<a href="#l12.218"></a><span id="l12.218">         }</span>
<a href="#l12.219"></a><span id="l12.219">         syscallBody.appendChild($.new(&quot;tr&quot;, cells));</span>
<a href="#l12.220"></a><span id="l12.220">       }</span>
<a href="#l12.221"></a><span id="l12.221">     }</span>
<a href="#l12.222"></a><span id="l12.222">   },</span>
<a href="#l12.223"></a><span id="l12.223"> </span>
<a href="#l12.224"></a><span id="l12.224" class="difflineminus">-  intl: function intl(data) {</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineplus">+  intl(data) {</span>
<a href="#l12.226"></a><span id="l12.226">     $(&quot;intl-locale-requested&quot;).textContent =</span>
<a href="#l12.227"></a><span id="l12.227">       JSON.stringify(data.localeService.requested);</span>
<a href="#l12.228"></a><span id="l12.228">     $(&quot;intl-locale-available&quot;).textContent =</span>
<a href="#l12.229"></a><span id="l12.229">       JSON.stringify(data.localeService.available);</span>
<a href="#l12.230"></a><span id="l12.230">     $(&quot;intl-locale-supported&quot;).textContent =</span>
<a href="#l12.231"></a><span id="l12.231">       JSON.stringify(data.localeService.supported);</span>
<a href="#l12.232"></a><span id="l12.232">     $(&quot;intl-locale-regionalprefs&quot;).textContent =</span>
<a href="#l12.233"></a><span id="l12.233">       JSON.stringify(data.localeService.regionalPrefs);</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineat">@@ -878,32 +878,32 @@ var snapshotFormatters = {</span>
<a href="#l12.235"></a><span id="l12.235">       JSON.stringify(data.osPrefs.systemLocales);</span>
<a href="#l12.236"></a><span id="l12.236">     $(&quot;intl-osprefs-regionalprefs&quot;).textContent =</span>
<a href="#l12.237"></a><span id="l12.237">       JSON.stringify(data.osPrefs.regionalPrefsLocales);</span>
<a href="#l12.238"></a><span id="l12.238">   },</span>
<a href="#l12.239"></a><span id="l12.239"> };</span>
<a href="#l12.240"></a><span id="l12.240"> </span>
<a href="#l12.241"></a><span id="l12.241"> var $ = document.getElementById.bind(document);</span>
<a href="#l12.242"></a><span id="l12.242"> </span>
<a href="#l12.243"></a><span id="l12.243" class="difflineminus">-$.new = function $_new(tag, textContentOrChildren, className, attributes) {</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineplus">+$.new = function(tag, textContentOrChildren, className, attributes) {</span>
<a href="#l12.245"></a><span id="l12.245">   let elt = document.createElement(tag);</span>
<a href="#l12.246"></a><span id="l12.246">   if (className)</span>
<a href="#l12.247"></a><span id="l12.247">     elt.className = className;</span>
<a href="#l12.248"></a><span id="l12.248">   if (attributes) {</span>
<a href="#l12.249"></a><span id="l12.249">     for (let attrName in attributes)</span>
<a href="#l12.250"></a><span id="l12.250">       elt.setAttribute(attrName, attributes[attrName]);</span>
<a href="#l12.251"></a><span id="l12.251">   }</span>
<a href="#l12.252"></a><span id="l12.252">   if (Array.isArray(textContentOrChildren))</span>
<a href="#l12.253"></a><span id="l12.253">     this.append(elt, textContentOrChildren);</span>
<a href="#l12.254"></a><span id="l12.254">   else</span>
<a href="#l12.255"></a><span id="l12.255">     elt.textContent = String(textContentOrChildren);</span>
<a href="#l12.256"></a><span id="l12.256">   return elt;</span>
<a href="#l12.257"></a><span id="l12.257"> };</span>
<a href="#l12.258"></a><span id="l12.258"> </span>
<a href="#l12.259"></a><span id="l12.259" class="difflineminus">-$.append = function $_append(parent, children) {</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineplus">+$.append = function(parent, children) {</span>
<a href="#l12.261"></a><span id="l12.261">   children.forEach(c =&gt; parent.appendChild(c));</span>
<a href="#l12.262"></a><span id="l12.262"> };</span>
<a href="#l12.263"></a><span id="l12.263"> </span>
<a href="#l12.264"></a><span id="l12.264"> function stringBundle() {</span>
<a href="#l12.265"></a><span id="l12.265">   return Services.strings.createBundle(</span>
<a href="#l12.266"></a><span id="l12.266">            &quot;chrome://global/locale/aboutSupport.properties&quot;);</span>
<a href="#l12.267"></a><span id="l12.267"> }</span>
<a href="#l12.268"></a><span id="l12.268"> </span>
<a href="#l12.269"></a><span id="l12.269" class="difflineat">@@ -1061,18 +1061,19 @@ Serializer.prototype = {</span>
<a href="#l12.270"></a><span id="l12.270">     // all other elements</span>
<a href="#l12.271"></a><span id="l12.271"> </span>
<a href="#l12.272"></a><span id="l12.272">     let hasText = false;</span>
<a href="#l12.273"></a><span id="l12.273">     for (let child of elem.childNodes) {</span>
<a href="#l12.274"></a><span id="l12.274">       if (child.nodeType == Node.TEXT_NODE) {</span>
<a href="#l12.275"></a><span id="l12.275">         let text = this._nodeText(child);</span>
<a href="#l12.276"></a><span id="l12.276">         this._appendText(text);</span>
<a href="#l12.277"></a><span id="l12.277">         hasText = hasText || !!text.trim();</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineminus">-      } else if (child.nodeType == Node.ELEMENT_NODE)</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineplus">+      } else if (child.nodeType == Node.ELEMENT_NODE) {</span>
<a href="#l12.280"></a><span id="l12.280">         this._serializeElement(child);</span>
<a href="#l12.281"></a><span id="l12.281" class="difflineplus">+      }</span>
<a href="#l12.282"></a><span id="l12.282">     }</span>
<a href="#l12.283"></a><span id="l12.283"> </span>
<a href="#l12.284"></a><span id="l12.284">     // For headings, draw a &quot;line&quot; underneath them so they stand out.</span>
<a href="#l12.285"></a><span id="l12.285">     if (/^h[0-9]+$/.test(elem.localName)) {</span>
<a href="#l12.286"></a><span id="l12.286">       let headerText = (this._currentLine || &quot;&quot;).trim();</span>
<a href="#l12.287"></a><span id="l12.287">       if (headerText) {</span>
<a href="#l12.288"></a><span id="l12.288">         this._startNewLine();</span>
<a href="#l12.289"></a><span id="l12.289">         this._appendText(&quot;-&quot;.repeat(headerText.length));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/about-support/content/accounts.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/about-support/content/accounts.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -47,17 +47,17 @@ var gAuthMethodProperties = new Map([</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> var AboutSupport = {</span>
<a href="#l13.6"></a><span id="l13.6">   /**</span>
<a href="#l13.7"></a><span id="l13.7">    * Gets details about SMTP servers for a given nsIMsgAccount.</span>
<a href="#l13.8"></a><span id="l13.8">    *</span>
<a href="#l13.9"></a><span id="l13.9">    * @returns An array of records, each record containing the name and other details</span>
<a href="#l13.10"></a><span id="l13.10">    *          about one SMTP server.</span>
<a href="#l13.11"></a><span id="l13.11">    */</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  _getSMTPDetails: function AboutSupport__getSMTPDetails(aAccount) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  _getSMTPDetails(aAccount) {</span>
<a href="#l13.14"></a><span id="l13.14">     let identities = aAccount.identities;</span>
<a href="#l13.15"></a><span id="l13.15">     let defaultIdentity = aAccount.defaultIdentity;</span>
<a href="#l13.16"></a><span id="l13.16">     let smtpDetails = [];</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">     for (let identity of fixIterator(identities, Ci.nsIMsgIdentity)) {</span>
<a href="#l13.19"></a><span id="l13.19">       let isDefault = identity == defaultIdentity;</span>
<a href="#l13.20"></a><span id="l13.20">       let smtpServer = {};</span>
<a href="#l13.21"></a><span id="l13.21">       MailServices.smtp.getServerByIdentity(identity, smtpServer);</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -69,17 +69,17 @@ var AboutSupport = {</span>
<a href="#l13.23"></a><span id="l13.23">     }</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25">     return smtpDetails;</span>
<a href="#l13.26"></a><span id="l13.26">   },</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28">   /**</span>
<a href="#l13.29"></a><span id="l13.29">    * Returns account details as an array of records.</span>
<a href="#l13.30"></a><span id="l13.30">    */</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-  getAccountDetails: function AboutSupport_getAccountDetails() {</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+  getAccountDetails() {</span>
<a href="#l13.33"></a><span id="l13.33">     let accountDetails = [];</span>
<a href="#l13.34"></a><span id="l13.34">     let accounts = MailServices.accounts.accounts;</span>
<a href="#l13.35"></a><span id="l13.35"> </span>
<a href="#l13.36"></a><span id="l13.36">     for (let account of fixIterator(accounts, Ci.nsIMsgAccount)) {</span>
<a href="#l13.37"></a><span id="l13.37">       let server = account.incomingServer;</span>
<a href="#l13.38"></a><span id="l13.38">       accountDetails.push({</span>
<a href="#l13.39"></a><span id="l13.39">         key: account.key,</span>
<a href="#l13.40"></a><span id="l13.40">         name: server.prettyName,</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineat">@@ -112,17 +112,17 @@ var AboutSupport = {</span>
<a href="#l13.42"></a><span id="l13.42">     accountDetails.sort(idCompare);</span>
<a href="#l13.43"></a><span id="l13.43">     return accountDetails;</span>
<a href="#l13.44"></a><span id="l13.44">   },</span>
<a href="#l13.45"></a><span id="l13.45"> </span>
<a href="#l13.46"></a><span id="l13.46">   /**</span>
<a href="#l13.47"></a><span id="l13.47">    * Returns the corresponding text for a given socket type index. The text is</span>
<a href="#l13.48"></a><span id="l13.48">    * returned as a record with &quot;localized&quot; and &quot;neutral&quot; entries.</span>
<a href="#l13.49"></a><span id="l13.49">    */</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-  getSocketTypeText: function AboutSupport_getSocketTypeText(aIndex) {</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+  getSocketTypeText(aIndex) {</span>
<a href="#l13.52"></a><span id="l13.52">     let plainSocketType = (aIndex in gSocketTypes ?</span>
<a href="#l13.53"></a><span id="l13.53">                            gSocketTypes[aIndex] : aIndex);</span>
<a href="#l13.54"></a><span id="l13.54">     let prettySocketType;</span>
<a href="#l13.55"></a><span id="l13.55">     try {</span>
<a href="#l13.56"></a><span id="l13.56">       prettySocketType = gMessengerBundle.GetStringFromName(</span>
<a href="#l13.57"></a><span id="l13.57">         &quot;smtpServer-ConnectionSecurityType-&quot; + aIndex);</span>
<a href="#l13.58"></a><span id="l13.58">     } catch (e) {</span>
<a href="#l13.59"></a><span id="l13.59">       if (e.result == Cr.NS_ERROR_FAILURE) {</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineat">@@ -134,17 +134,17 @@ var AboutSupport = {</span>
<a href="#l13.61"></a><span id="l13.61">     }</span>
<a href="#l13.62"></a><span id="l13.62">     return {localized: prettySocketType, neutral: plainSocketType};</span>
<a href="#l13.63"></a><span id="l13.63">   },</span>
<a href="#l13.64"></a><span id="l13.64"> </span>
<a href="#l13.65"></a><span id="l13.65">   /**</span>
<a href="#l13.66"></a><span id="l13.66">    * Returns the corresponding text for a given authentication method index. The</span>
<a href="#l13.67"></a><span id="l13.67">    * text is returned as a record with &quot;localized&quot; and &quot;neutral&quot; entries.</span>
<a href="#l13.68"></a><span id="l13.68">    */</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-  getAuthMethodText: function AboutSupport_getAuthMethodText(aIndex) {</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+  getAuthMethodText(aIndex) {</span>
<a href="#l13.71"></a><span id="l13.71">     let prettyAuthMethod;</span>
<a href="#l13.72"></a><span id="l13.72">     let plainAuthMethod = (aIndex in gAuthMethods ?</span>
<a href="#l13.73"></a><span id="l13.73">                            gAuthMethods[aIndex] : aIndex);</span>
<a href="#l13.74"></a><span id="l13.74">     if (gAuthMethodProperties.has(parseInt(aIndex))) {</span>
<a href="#l13.75"></a><span id="l13.75">       prettyAuthMethod =</span>
<a href="#l13.76"></a><span id="l13.76">         gMessengerBundle.GetStringFromName(gAuthMethodProperties.get(parseInt(aIndex)));</span>
<a href="#l13.77"></a><span id="l13.77">     } else {</span>
<a href="#l13.78"></a><span id="l13.78">       prettyAuthMethod = plainAuthMethod;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/aboutRedirector.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/aboutRedirector.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -25,17 +25,17 @@ AboutRedirector.prototype = {</span>
<a href="#l14.4"></a><span id="l14.4">                     flags: Ci.nsIAboutModule.ALLOW_SCRIPT},</span>
<a href="#l14.5"></a><span id="l14.5">     &quot;downloads&quot;: {url: &quot;chrome://messenger/content/downloads/aboutDownloads.xul&quot;,</span>
<a href="#l14.6"></a><span id="l14.6">                   flags: Ci.nsIAboutModule.ALLOW_SCRIPT},</span>
<a href="#l14.7"></a><span id="l14.7">   },</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">   /**</span>
<a href="#l14.10"></a><span id="l14.10">    * Gets the module name from the given URI.</span>
<a href="#l14.11"></a><span id="l14.11">    */</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  _getModuleName: function AboutRedirector__getModuleName(aURI) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  _getModuleName(aURI) {</span>
<a href="#l14.14"></a><span id="l14.14">     // Strip out the first ? or #, and anything following it</span>
<a href="#l14.15"></a><span id="l14.15">     let name = (/[^?#]+/.exec(aURI.pathQueryRef))[0];</span>
<a href="#l14.16"></a><span id="l14.16">     return name.toLowerCase();</span>
<a href="#l14.17"></a><span id="l14.17">   },</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">   getURIFlags(aURI) {</span>
<a href="#l14.20"></a><span id="l14.20">     let name = this._getModuleName(aURI);</span>
<a href="#l14.21"></a><span id="l14.21">     if (!(name in this._redirMap))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/accountcreation/content/emailWizard.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/accountcreation/content/emailWizard.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -113,17 +113,17 @@ function setLabelFromStringBundle(elemen</span>
<a href="#l15.4"></a><span id="l15.4">   e(elementID).label = gMessengerBundle.getString(stringName);</span>
<a href="#l15.5"></a><span id="l15.5"> }</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7"> function EmailConfigWizard() {</span>
<a href="#l15.8"></a><span id="l15.8">   this._init();</span>
<a href="#l15.9"></a><span id="l15.9"> }</span>
<a href="#l15.10"></a><span id="l15.10"> EmailConfigWizard.prototype =</span>
<a href="#l15.11"></a><span id="l15.11"> {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  _init: function EmailConfigWizard__init() {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  _init() {</span>
<a href="#l15.14"></a><span id="l15.14">     gEmailWizardLogger.info(&quot;Initializing setup wizard&quot;);</span>
<a href="#l15.15"></a><span id="l15.15">     this._abortable = null;</span>
<a href="#l15.16"></a><span id="l15.16">   },</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18">   onLoad() {</span>
<a href="#l15.19"></a><span id="l15.19">     /**</span>
<a href="#l15.20"></a><span id="l15.20">      * this._currentConfig is the config we got either from the XML file or</span>
<a href="#l15.21"></a><span id="l15.21">      * from guessing or from the user. Unless it's from the user, it contains</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/components/accountcreation/content/fetchhttp.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/components/accountcreation/content/fetchhttp.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -161,20 +161,21 @@ FetchHTTP.prototype =</span>
<a href="#l16.4"></a><span id="l16.4">     // Callbacks</span>
<a href="#l16.5"></a><span id="l16.5">     if (success) {</span>
<a href="#l16.6"></a><span id="l16.6">       try {</span>
<a href="#l16.7"></a><span id="l16.7">         this._successCallback(this.result);</span>
<a href="#l16.8"></a><span id="l16.8">       } catch (e) {</span>
<a href="#l16.9"></a><span id="l16.9">         logException(e);</span>
<a href="#l16.10"></a><span id="l16.10">         this._error(e);</span>
<a href="#l16.11"></a><span id="l16.11">       }</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    } else if (exStored)</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    } else if (exStored) {</span>
<a href="#l16.14"></a><span id="l16.14">       this._error(exStored);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-    else</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+    } else {</span>
<a href="#l16.17"></a><span id="l16.17">       this._error(new ServerException(errorStr, errorCode, this._url));</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+    }</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20">     if (this._finishedCallback) {</span>
<a href="#l16.21"></a><span id="l16.21">       try {</span>
<a href="#l16.22"></a><span id="l16.22">         this._finishedCallback(this);</span>
<a href="#l16.23"></a><span id="l16.23">       } catch (e) {</span>
<a href="#l16.24"></a><span id="l16.24">         logException(e);</span>
<a href="#l16.25"></a><span id="l16.25">         this._error(e);</span>
<a href="#l16.26"></a><span id="l16.26">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/components/accountcreation/content/guessConfig.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/components/accountcreation/content/guessConfig.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -510,20 +510,20 @@ HostDetector.prototype =</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5">   _checkFinished() {</span>
<a href="#l17.6"></a><span id="l17.6">     var successfulTry = null;</span>
<a href="#l17.7"></a><span id="l17.7">     var successfulTryAlternative = null; // POP3</span>
<a href="#l17.8"></a><span id="l17.8">     var unfinishedBusiness = false;</span>
<a href="#l17.9"></a><span id="l17.9">     // this._hostsToTry is ordered by decreasing preference</span>
<a href="#l17.10"></a><span id="l17.10">     for (let i = 0; i &lt; this._hostsToTry.length; i++) {</span>
<a href="#l17.11"></a><span id="l17.11">       let thisTry = this._hostsToTry[i];</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-      if (thisTry.status == kNotTried || thisTry.status == kOngoing)</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+      if (thisTry.status == kNotTried || thisTry.status == kOngoing) {</span>
<a href="#l17.14"></a><span id="l17.14">         unfinishedBusiness = true;</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-      // thisTry is good, and all higher preference tries failed, so use this</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-      else if (thisTry.status == kSuccess &amp;&amp; !unfinishedBusiness) {</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+      } else if (thisTry.status == kSuccess &amp;&amp; !unfinishedBusiness) {</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+        // thisTry is good, and all higher preference tries failed, so use this</span>
<a href="#l17.19"></a><span id="l17.19">         if (!successfulTry) {</span>
<a href="#l17.20"></a><span id="l17.20">           successfulTry = thisTry;</span>
<a href="#l17.21"></a><span id="l17.21">           if (successfulTry.protocol == SMTP)</span>
<a href="#l17.22"></a><span id="l17.22">             break;</span>
<a href="#l17.23"></a><span id="l17.23">         } else if (successfulTry.protocol != thisTry.protocol) {</span>
<a href="#l17.24"></a><span id="l17.24">           successfulTryAlternative = thisTry;</span>
<a href="#l17.25"></a><span id="l17.25">           break;</span>
<a href="#l17.26"></a><span id="l17.26">         }</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineat">@@ -681,17 +681,17 @@ CMDS[POP] = [&quot;CAPA\r\n&quot;, &quot;QUIT\r\n&quot;];</span>
<a href="#l17.28"></a><span id="l17.28"> CMDS[SMTP] = [&quot;EHLO we-guess.mozilla.org\r\n&quot;, &quot;QUIT\r\n&quot;];</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30"> /**</span>
<a href="#l17.31"></a><span id="l17.31">  * Sort by preference of SSL, IMAP etc.</span>
<a href="#l17.32"></a><span id="l17.32">  * @param tries {Array of {HostTry}}</span>
<a href="#l17.33"></a><span id="l17.33">  * @returns {Array of {HostTry}}</span>
<a href="#l17.34"></a><span id="l17.34">  */</span>
<a href="#l17.35"></a><span id="l17.35"> function sortTriesByPreference(tries) {</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-  return tries.sort(function __sortByPreference(a, b) {</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+  return tries.sort(function(a, b) {</span>
<a href="#l17.38"></a><span id="l17.38">     // -1 = a is better; 1 = b is better; 0 = equal</span>
<a href="#l17.39"></a><span id="l17.39">     // Prefer SSL/TLS above all else</span>
<a href="#l17.40"></a><span id="l17.40">     if (a.ssl != NONE &amp;&amp; b.ssl == NONE)</span>
<a href="#l17.41"></a><span id="l17.41">       return -1;</span>
<a href="#l17.42"></a><span id="l17.42">     if (b.ssl != NONE &amp;&amp; a.ssl == NONE)</span>
<a href="#l17.43"></a><span id="l17.43">       return 1;</span>
<a href="#l17.44"></a><span id="l17.44">     // Prefer IMAP over POP</span>
<a href="#l17.45"></a><span id="l17.45">     if (a.protocol == IMAP &amp;&amp; b.protocol == POP)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/components/accountcreation/content/util.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/components/accountcreation/content/util.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -239,20 +239,21 @@ function debugObject(obj, name, maxDepth</span>
<a href="#l18.4"></a><span id="l18.4">       if (typeof(obj[prop]) == &quot;object&quot;) {</span>
<a href="#l18.5"></a><span id="l18.5">         if (obj[prop] &amp;&amp; obj[prop].length != undefined)</span>
<a href="#l18.6"></a><span id="l18.6">           result += name + &quot;.&quot; + prop + &quot;=[probably array, length &quot; +</span>
<a href="#l18.7"></a><span id="l18.7">                 obj[prop].length + &quot;]\n&quot;;</span>
<a href="#l18.8"></a><span id="l18.8">         else</span>
<a href="#l18.9"></a><span id="l18.9">           result += name + &quot;.&quot; + prop + &quot;=[&quot; + typeof(obj[prop]) + &quot;]\n&quot;;</span>
<a href="#l18.10"></a><span id="l18.10">         result += debugObject(obj[prop], name + &quot;.&quot; + prop,</span>
<a href="#l18.11"></a><span id="l18.11">                               maxDepth, curDepth + 1);</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-      } else if (typeof(obj[prop]) == &quot;function&quot;)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+      } else if (typeof(obj[prop]) == &quot;function&quot;) {</span>
<a href="#l18.14"></a><span id="l18.14">         result += name + &quot;.&quot; + prop + &quot;=[function]\n&quot;;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-      else</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+      } else {</span>
<a href="#l18.17"></a><span id="l18.17">         result += name + &quot;.&quot; + prop + &quot;=&quot; + obj[prop] + &quot;\n&quot;;</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+      }</span>
<a href="#l18.19"></a><span id="l18.19">     } catch (e) {</span>
<a href="#l18.20"></a><span id="l18.20">       result += name + &quot;.&quot; + prop + &quot;-&gt; Exception(&quot; + e + &quot;)\n&quot;;</span>
<a href="#l18.21"></a><span id="l18.21">     }</span>
<a href="#l18.22"></a><span id="l18.22">   }</span>
<a href="#l18.23"></a><span id="l18.23">   if (!i)</span>
<a href="#l18.24"></a><span id="l18.24">     result += name + &quot; is empty\n&quot;;</span>
<a href="#l18.25"></a><span id="l18.25">   return result;</span>
<a href="#l18.26"></a><span id="l18.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/components/activity/content/activity.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/components/activity/content/activity.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -42,20 +42,20 @@ var activityObject = {</span>
<a href="#l19.4"></a><span id="l19.4">     return this._groupCache.get(aContextType + &quot;:&quot; + aContextObj);</span>
<a href="#l19.5"></a><span id="l19.5">   },</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7">   /**</span>
<a href="#l19.8"></a><span id="l19.8">    * Inserts the given binding into the correct position on the</span>
<a href="#l19.9"></a><span id="l19.9">    * activity manager window.</span>
<a href="#l19.10"></a><span id="l19.10">    */</span>
<a href="#l19.11"></a><span id="l19.11">   placeActivityBinding(aBinding) {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    if (aBinding.isGroup || aBinding.isProcess)</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    if (aBinding.isGroup || aBinding.isProcess) {</span>
<a href="#l19.14"></a><span id="l19.14">       this._activitiesView.insertBefore(aBinding,</span>
<a href="#l19.15"></a><span id="l19.15">                                         this._activitiesView.firstChild);</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-    else {</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+    } else {</span>
<a href="#l19.18"></a><span id="l19.18">       let next = this._activitiesView.firstChild;</span>
<a href="#l19.19"></a><span id="l19.19">       while (next &amp;&amp; (next.isWarning || next.isProcess || next.isGroup))</span>
<a href="#l19.20"></a><span id="l19.20">         next = next.nextSibling;</span>
<a href="#l19.21"></a><span id="l19.21">       if (next)</span>
<a href="#l19.22"></a><span id="l19.22">         this._activitiesView.insertBefore(aBinding, next);</span>
<a href="#l19.23"></a><span id="l19.23">       else</span>
<a href="#l19.24"></a><span id="l19.24">         this._activitiesView.appendChild(aBinding);</span>
<a href="#l19.25"></a><span id="l19.25">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/components/activity/nsActivityManagerUI.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/components/activity/nsActivityManagerUI.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -8,17 +8,17 @@ ChromeUtils.import(&quot;resource://gre/modul</span>
<a href="#l20.4"></a><span id="l20.4"> const ACTIVITY_MANAGER_URL = &quot;chrome://messenger/content/activity.xul&quot;;</span>
<a href="#l20.5"></a><span id="l20.5"> const PREF_FLASH_COUNT = &quot;messenger.activity.manager.flashCount&quot;;</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> function nsActivityManagerUI() {}</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> nsActivityManagerUI.prototype = {</span>
<a href="#l20.10"></a><span id="l20.10">   classID: Components.ID(&quot;5fa5974e-09cb-40cc-9696-643f8a8d9a06&quot;),</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  show: function show(aWindowContext, aID) {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  show(aWindowContext, aID) {</span>
<a href="#l20.14"></a><span id="l20.14">     // First we see if it is already visible</span>
<a href="#l20.15"></a><span id="l20.15">     let window = this.recentWindow;</span>
<a href="#l20.16"></a><span id="l20.16">     if (window) {</span>
<a href="#l20.17"></a><span id="l20.17">       window.focus();</span>
<a href="#l20.18"></a><span id="l20.18">       return;</span>
<a href="#l20.19"></a><span id="l20.19">     }</span>
<a href="#l20.20"></a><span id="l20.20"> </span>
<a href="#l20.21"></a><span id="l20.21">     let parent = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/components/addrbook/content/abCard.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCard.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -160,17 +160,17 @@ function OnLoadNewCard() {</span>
<a href="#l21.4"></a><span id="l21.4">   // FIX ME - looks like we need to focus on both the text field and the tab widget</span>
<a href="#l21.5"></a><span id="l21.5">   // probably need to do the same in the addressing widget</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7">   // focus on first or last name based on the pref</span>
<a href="#l21.8"></a><span id="l21.8">   var focus = document.getElementById(gEditCard.displayLastNameFirst</span>
<a href="#l21.9"></a><span id="l21.9">                                       ? &quot;LastName&quot; : &quot;FirstName&quot;);</span>
<a href="#l21.10"></a><span id="l21.10">   if (focus) {</span>
<a href="#l21.11"></a><span id="l21.11">     // XXX Using the setTimeout hack until bug 103197 is fixed</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    setTimeout( function(firstTextBox) { firstTextBox.focus(); }, 0, focus );</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+    setTimeout(function(firstTextBox) { firstTextBox.focus(); }, 0, focus);</span>
<a href="#l21.14"></a><span id="l21.14">   }</span>
<a href="#l21.15"></a><span id="l21.15"> }</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17"> /**</span>
<a href="#l21.18"></a><span id="l21.18">  * Get the source directory containing the card we are editing.</span>
<a href="#l21.19"></a><span id="l21.19">  */</span>
<a href="#l21.20"></a><span id="l21.20"> function getContainingDirectory() {</span>
<a href="#l21.21"></a><span id="l21.21">   let directory = GetDirectoryFromURI(gEditCard.abURI);</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -278,18 +278,19 @@ function OnLoadEditCard() {</span>
<a href="#l21.23"></a><span id="l21.23">   // if not disable all the fields</span>
<a href="#l21.24"></a><span id="l21.24">   if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0]) {</span>
<a href="#l21.25"></a><span id="l21.25">     if (&quot;abURI&quot; in window.arguments[0]) {</span>
<a href="#l21.26"></a><span id="l21.26">       var abURI = window.arguments[0].abURI;</span>
<a href="#l21.27"></a><span id="l21.27">       var directory = GetDirectoryFromURI(abURI);</span>
<a href="#l21.28"></a><span id="l21.28"> </span>
<a href="#l21.29"></a><span id="l21.29">       if (directory.readOnly) {</span>
<a href="#l21.30"></a><span id="l21.30">         // Set all the editable vcard fields to read only</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-        for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+        for (var i = kVcardFields.length; i-- &gt; 0;) {</span>
<a href="#l21.33"></a><span id="l21.33">           document.getElementById(kVcardFields[i][0]).readOnly = true;</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+        }</span>
<a href="#l21.35"></a><span id="l21.35"> </span>
<a href="#l21.36"></a><span id="l21.36">         // the birthday fields</span>
<a href="#l21.37"></a><span id="l21.37">         document.getElementById(&quot;Birthday&quot;).readOnly = true;</span>
<a href="#l21.38"></a><span id="l21.38">         document.getElementById(&quot;BirthYear&quot;).readOnly = true;</span>
<a href="#l21.39"></a><span id="l21.39">         document.getElementById(&quot;Age&quot;).readOnly = true;</span>
<a href="#l21.40"></a><span id="l21.40"> </span>
<a href="#l21.41"></a><span id="l21.41">         // the photo field and buttons</span>
<a href="#l21.42"></a><span id="l21.42">         document.getElementById(&quot;PhotoType&quot;).disabled        = true;</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineat">@@ -370,18 +371,19 @@ function NotifySaveListeners(directory) </span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45"> function InitPhoneticFields() {</span>
<a href="#l21.46"></a><span id="l21.46">   var showPhoneticFields =</span>
<a href="#l21.47"></a><span id="l21.47">     Services.prefs.getComplexValue(&quot;mail.addr_book.show_phonetic_fields&quot;,</span>
<a href="#l21.48"></a><span id="l21.48">       Ci.nsIPrefLocalizedString).data;</span>
<a href="#l21.49"></a><span id="l21.49"> </span>
<a href="#l21.50"></a><span id="l21.50">   // show phonetic fields if indicated by the pref</span>
<a href="#l21.51"></a><span id="l21.51">   if (showPhoneticFields == &quot;true&quot;) {</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-    for (var i = kPhoneticFields.length; i-- &gt; 0; )</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+    for (var i = kPhoneticFields.length; i-- &gt; 0;) {</span>
<a href="#l21.54"></a><span id="l21.54">       document.getElementById(kPhoneticFields[i]).hidden = false;</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+    }</span>
<a href="#l21.56"></a><span id="l21.56">   }</span>
<a href="#l21.57"></a><span id="l21.57"> }</span>
<a href="#l21.58"></a><span id="l21.58"> </span>
<a href="#l21.59"></a><span id="l21.59"> function InitEditCard() {</span>
<a href="#l21.60"></a><span id="l21.60">   InitPhoneticFields();</span>
<a href="#l21.61"></a><span id="l21.61"> </span>
<a href="#l21.62"></a><span id="l21.62">   InitCommonJS();</span>
<a href="#l21.63"></a><span id="l21.63"> </span>
<a href="#l21.64"></a><span id="l21.64" class="difflineat">@@ -446,17 +448,17 @@ function NewCardCancelButton() {</span>
<a href="#l21.65"></a><span id="l21.65"> function GetCardValues(cardproperty, doc) {</span>
<a href="#l21.66"></a><span id="l21.66">   if (!cardproperty)</span>
<a href="#l21.67"></a><span id="l21.67">     return;</span>
<a href="#l21.68"></a><span id="l21.68"> </span>
<a href="#l21.69"></a><span id="l21.69">   // Pass the nsIAbCard and the Document through the listeners</span>
<a href="#l21.70"></a><span id="l21.70">   // to give extensions a chance to populate custom fields.</span>
<a href="#l21.71"></a><span id="l21.71">   NotifyLoadListeners(cardproperty, doc);</span>
<a href="#l21.72"></a><span id="l21.72"> </span>
<a href="#l21.73"></a><span id="l21.73" class="difflineminus">-  for (var i = kVcardFields.length; i-- &gt; 0; ) {</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+  for (var i = kVcardFields.length; i-- &gt; 0;) {</span>
<a href="#l21.75"></a><span id="l21.75">     doc.getElementById(kVcardFields[i][0]).value =</span>
<a href="#l21.76"></a><span id="l21.76">       cardproperty.getProperty(kVcardFields[i][1], &quot;&quot;);</span>
<a href="#l21.77"></a><span id="l21.77">   }</span>
<a href="#l21.78"></a><span id="l21.78"> </span>
<a href="#l21.79"></a><span id="l21.79">   var birthday = doc.getElementById(&quot;Birthday&quot;);</span>
<a href="#l21.80"></a><span id="l21.80">   modifyDatepicker(birthday);</span>
<a href="#l21.81"></a><span id="l21.81"> </span>
<a href="#l21.82"></a><span id="l21.82">   // Get the year first, so that the following month/day</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineat">@@ -516,36 +518,39 @@ function GetCardValues(cardproperty, doc</span>
<a href="#l21.84"></a><span id="l21.84"> // when the ab card dialog is being loaded to show a vCard,</span>
<a href="#l21.85"></a><span id="l21.85"> // hide the fields which aren't supported</span>
<a href="#l21.86"></a><span id="l21.86"> // by vCard so the user does not try to edit them.</span>
<a href="#l21.87"></a><span id="l21.87"> function HideNonVcardFields() {</span>
<a href="#l21.88"></a><span id="l21.88">   document.getElementById(&quot;homeTabButton&quot;).hidden = true;</span>
<a href="#l21.89"></a><span id="l21.89">   document.getElementById(&quot;chatTabButton&quot;).hidden = true;</span>
<a href="#l21.90"></a><span id="l21.90">   document.getElementById(&quot;photoTabButton&quot;).hidden = true;</span>
<a href="#l21.91"></a><span id="l21.91">   var i;</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineminus">-  for (i = kNonVcardFields.length; i-- &gt; 0; )</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineplus">+  for (i = kNonVcardFields.length; i-- &gt; 0;) {</span>
<a href="#l21.94"></a><span id="l21.94">     document.getElementById(kNonVcardFields[i]).collapsed = true;</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineminus">-  for (i = kPhoneticFields.length; i-- &gt; 0; )</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+  }</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineplus">+  for (i = kPhoneticFields.length; i-- &gt; 0;) {</span>
<a href="#l21.98"></a><span id="l21.98">     document.getElementById(kPhoneticFields[i]).collapsed = true;</span>
<a href="#l21.99"></a><span id="l21.99" class="difflineplus">+  }</span>
<a href="#l21.100"></a><span id="l21.100"> }</span>
<a href="#l21.101"></a><span id="l21.101"> </span>
<a href="#l21.102"></a><span id="l21.102"> // Move the data from the dialog to the cardproperty to be stored in the database</span>
<a href="#l21.103"></a><span id="l21.103"> // @Returns false - Some required data are missing (card values were not set);</span>
<a href="#l21.104"></a><span id="l21.104"> //          true - Card values were set, or there is no card to set values on.</span>
<a href="#l21.105"></a><span id="l21.105"> function CheckAndSetCardValues(cardproperty, doc, check) {</span>
<a href="#l21.106"></a><span id="l21.106">   // If requested, check the required data presence.</span>
<a href="#l21.107"></a><span id="l21.107">   if (check &amp;&amp; !CheckCardRequiredDataPresence(document))</span>
<a href="#l21.108"></a><span id="l21.108">     return false;</span>
<a href="#l21.109"></a><span id="l21.109"> </span>
<a href="#l21.110"></a><span id="l21.110">   if (!cardproperty)</span>
<a href="#l21.111"></a><span id="l21.111">     return true;</span>
<a href="#l21.112"></a><span id="l21.112"> </span>
<a href="#l21.113"></a><span id="l21.113" class="difflineminus">-  for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineplus">+  for (var i = kVcardFields.length; i-- &gt; 0;) {</span>
<a href="#l21.115"></a><span id="l21.115">     cardproperty.setProperty(kVcardFields[i][1],</span>
<a href="#l21.116"></a><span id="l21.116">       doc.getElementById(kVcardFields[i][0]).value);</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineplus">+  }</span>
<a href="#l21.118"></a><span id="l21.118"> </span>
<a href="#l21.119"></a><span id="l21.119">   // get the birthday information from the dialog</span>
<a href="#l21.120"></a><span id="l21.120">   var birthdayElem = doc.getElementById(&quot;Birthday&quot;);</span>
<a href="#l21.121"></a><span id="l21.121">   var birthMonth = birthdayElem.monthField.value;</span>
<a href="#l21.122"></a><span id="l21.122">   var birthDay = birthdayElem.dateField.value;</span>
<a href="#l21.123"></a><span id="l21.123">   var birthYear = doc.getElementById(&quot;BirthYear&quot;).value;</span>
<a href="#l21.124"></a><span id="l21.124"> </span>
<a href="#l21.125"></a><span id="l21.125">   // set the birth day, month, and year properties</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineat">@@ -691,18 +696,19 @@ function calculateAge(aEvent, aElement) </span>
<a href="#l21.127"></a><span id="l21.127"> </span>
<a href="#l21.128"></a><span id="l21.128">   var year = yearElem.value;</span>
<a href="#l21.129"></a><span id="l21.129">   // if the year element's value is invalid set the year and age elements to null</span>
<a href="#l21.130"></a><span id="l21.130">   if (isNaN(year) || year &lt; kMinYear || year &gt; kMaxYear) {</span>
<a href="#l21.131"></a><span id="l21.131">     yearElem.value = null;</span>
<a href="#l21.132"></a><span id="l21.132">     ageElem.value = null;</span>
<a href="#l21.133"></a><span id="l21.133">     datepicker.year = kDefaultYear;</span>
<a href="#l21.134"></a><span id="l21.134">     return;</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineminus">-  } else if (aElement == yearElem)</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineplus">+  } else if (aElement == yearElem) {</span>
<a href="#l21.137"></a><span id="l21.137">     datepicker.year = year;</span>
<a href="#l21.138"></a><span id="l21.138" class="difflineplus">+  }</span>
<a href="#l21.139"></a><span id="l21.139">   // calculate the length of time between the event and now</span>
<a href="#l21.140"></a><span id="l21.140">   try {</span>
<a href="#l21.141"></a><span id="l21.141">     var event = new Date(datepicker.year, datepicker.month, datepicker.date);</span>
<a href="#l21.142"></a><span id="l21.142">     // if the year is only 2 digits, then the year won't be set correctly</span>
<a href="#l21.143"></a><span id="l21.143">     // using setFullYear fixes this issue</span>
<a href="#l21.144"></a><span id="l21.144">     event.setFullYear(datepicker.year);</span>
<a href="#l21.145"></a><span id="l21.145">     // get the difference between today and the event</span>
<a href="#l21.146"></a><span id="l21.146">     var age = new Date(new Date() - event);</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineat">@@ -787,17 +793,17 @@ function modifyDatepicker(aDatepicker) {</span>
<a href="#l21.148"></a><span id="l21.148">   else</span>
<a href="#l21.149"></a><span id="l21.149">     aDatepicker._separatorFirst.collapsed = true;</span>
<a href="#l21.150"></a><span id="l21.150">   // collapse the spinner element</span>
<a href="#l21.151"></a><span id="l21.151">   document.getAnonymousElementByAttribute(aDatepicker, &quot;anonid&quot;, &quot;buttons&quot;)</span>
<a href="#l21.152"></a><span id="l21.152">           .collapsed = true;</span>
<a href="#l21.153"></a><span id="l21.153">   // this modified constrain value function ignores values less than the minimum</span>
<a href="#l21.154"></a><span id="l21.154">   // to let the value be blank (null)</span>
<a href="#l21.155"></a><span id="l21.155">   // from: mozilla/toolkit/content/widgets/datetimepicker.xml#759</span>
<a href="#l21.156"></a><span id="l21.156" class="difflineminus">-  aDatepicker._constrainValue = function newConstrainValue(aField, aValue, aNoWrap) {</span>
<a href="#l21.157"></a><span id="l21.157" class="difflineplus">+  aDatepicker._constrainValue = function(aField, aValue, aNoWrap) {</span>
<a href="#l21.158"></a><span id="l21.158">     // if the value is less than one, make the field's value null</span>
<a href="#l21.159"></a><span id="l21.159">     if (aValue &lt; 1) {</span>
<a href="#l21.160"></a><span id="l21.160">       aField.value = null;</span>
<a href="#l21.161"></a><span id="l21.161">       return null;</span>
<a href="#l21.162"></a><span id="l21.162">     }</span>
<a href="#l21.163"></a><span id="l21.163">     if (aNoWrap &amp;&amp; aField == this.monthField)</span>
<a href="#l21.164"></a><span id="l21.164">       aValue--;</span>
<a href="#l21.165"></a><span id="l21.165">     // make sure the date is valid for the given month</span>
<a href="#l21.166"></a><span id="l21.166" class="difflineat">@@ -810,17 +816,17 @@ function modifyDatepicker(aDatepicker) {</span>
<a href="#l21.167"></a><span id="l21.167">     var max = (aField == this.monthField) ? 11 : kMaxYear;</span>
<a href="#l21.168"></a><span id="l21.168">     // make sure the value isn't too high</span>
<a href="#l21.169"></a><span id="l21.169">     if (aValue &gt; max)</span>
<a href="#l21.170"></a><span id="l21.170">       return aNoWrap ? max : min;</span>
<a href="#l21.171"></a><span id="l21.171">     return aValue;</span>
<a href="#l21.172"></a><span id="l21.172">   };</span>
<a href="#l21.173"></a><span id="l21.173">   // sets the specified field to the given value, but allows blank fields</span>
<a href="#l21.174"></a><span id="l21.174">   // from: mozilla/toolkit/content/widgets/datetimepicker.xml#698</span>
<a href="#l21.175"></a><span id="l21.175" class="difflineminus">-  aDatepicker._setFieldValue = function setValue(aField, aValue) {</span>
<a href="#l21.176"></a><span id="l21.176" class="difflineplus">+  aDatepicker._setFieldValue = function(aField, aValue) {</span>
<a href="#l21.177"></a><span id="l21.177">     if (aField == this.yearField &amp;&amp; aValue &gt;= kMinYear &amp;&amp; aValue &lt;= kMaxYear) {</span>
<a href="#l21.178"></a><span id="l21.178">       let oldDate = this._dateValue;</span>
<a href="#l21.179"></a><span id="l21.179">       this._dateValue.setFullYear(aValue);</span>
<a href="#l21.180"></a><span id="l21.180">       if (oldDate != this._dateValue) {</span>
<a href="#l21.181"></a><span id="l21.181">         this._dateValue.setDate(0);</span>
<a href="#l21.182"></a><span id="l21.182">         this._updateUI(this.dateField, this.date);</span>
<a href="#l21.183"></a><span id="l21.183">       }</span>
<a href="#l21.184"></a><span id="l21.184">     } else if (aField == this.monthField &amp;&amp; aValue != null) {</span>
<a href="#l21.185"></a><span id="l21.185" class="difflineat">@@ -1076,17 +1082,17 @@ function doDropPhoto(aEvent) {</span>
<a href="#l21.186"></a><span id="l21.186">  */</span>
<a href="#l21.187"></a><span id="l21.187"> var gPhotoDownloadUI = (function() {</span>
<a href="#l21.188"></a><span id="l21.188">   // UI DOM elements</span>
<a href="#l21.189"></a><span id="l21.189">   let elProgressbar;</span>
<a href="#l21.190"></a><span id="l21.190">   let elProgressLabel;</span>
<a href="#l21.191"></a><span id="l21.191">   let elPhotoType;</span>
<a href="#l21.192"></a><span id="l21.192">   let elProgressContainer;</span>
<a href="#l21.193"></a><span id="l21.193"> </span>
<a href="#l21.194"></a><span id="l21.194" class="difflineminus">-  window.addEventListener(&quot;load&quot;, function load(event) {</span>
<a href="#l21.195"></a><span id="l21.195" class="difflineplus">+  window.addEventListener(&quot;load&quot;, function(event) {</span>
<a href="#l21.196"></a><span id="l21.196">     if (!elProgressbar)</span>
<a href="#l21.197"></a><span id="l21.197">       elProgressbar = document.getElementById(&quot;PhotoDownloadProgress&quot;);</span>
<a href="#l21.198"></a><span id="l21.198">     if (!elProgressLabel)</span>
<a href="#l21.199"></a><span id="l21.199">       elProgressLabel = document.getElementById(&quot;PhotoStatus&quot;);</span>
<a href="#l21.200"></a><span id="l21.200">     if (!elPhotoType)</span>
<a href="#l21.201"></a><span id="l21.201">       elPhotoType = document.getElementById(&quot;PhotoType&quot;);</span>
<a href="#l21.202"></a><span id="l21.202">     if (!elProgressContainer)</span>
<a href="#l21.203"></a><span id="l21.203">       elProgressContainer = document.getElementById(&quot;ProgressContainer&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/components/addrbook/content/abCardView.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCardView.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -431,26 +431,26 @@ function cvSetNodeWithLabel(node, label,</span>
<a href="#l22.4"></a><span id="l22.4">     return cvSetNode(node, text);</span>
<a href="#l22.5"></a><span id="l22.5">   }</span>
<a href="#l22.6"></a><span id="l22.6">   return cvSetNode(node, &quot;&quot;);</span>
<a href="#l22.7"></a><span id="l22.7"> }</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9"> function cvSetCityStateZip(node, city, state, zip) {</span>
<a href="#l22.10"></a><span id="l22.10">   let text = &quot;&quot;;</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  if (city &amp;&amp; state &amp;&amp; zip)</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+  if (city &amp;&amp; state &amp;&amp; zip) {</span>
<a href="#l22.14"></a><span id="l22.14">     text = gAddressBookBundle.getFormattedString(&quot;cityAndStateAndZip&quot;,</span>
<a href="#l22.15"></a><span id="l22.15">                                                  [city, state, zip]);</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-  else if (city &amp;&amp; state &amp;&amp; !zip)</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+  } else if (city &amp;&amp; state &amp;&amp; !zip) {</span>
<a href="#l22.18"></a><span id="l22.18">     text = gAddressBookBundle.getFormattedString(&quot;cityAndStateNoZip&quot;,</span>
<a href="#l22.19"></a><span id="l22.19">                                                  [city, state]);</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-  else if (zip &amp;&amp; ((!city &amp;&amp; state) || (city &amp;&amp; !state)))</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+  } else if (zip &amp;&amp; ((!city &amp;&amp; state) || (city &amp;&amp; !state))) {</span>
<a href="#l22.22"></a><span id="l22.22">     text = gAddressBookBundle.getFormattedString(&quot;cityOrStateAndZip&quot;,</span>
<a href="#l22.23"></a><span id="l22.23">                                                  [city + state, zip]);</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">-  else {</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+  } else {</span>
<a href="#l22.26"></a><span id="l22.26">     // Only one of the strings is non-empty so contatenating them produces that string.</span>
<a href="#l22.27"></a><span id="l22.27">     text = city + state + zip;</span>
<a href="#l22.28"></a><span id="l22.28">   }</span>
<a href="#l22.29"></a><span id="l22.29"> </span>
<a href="#l22.30"></a><span id="l22.30">   return cvSetNode(node, text);</span>
<a href="#l22.31"></a><span id="l22.31"> }</span>
<a href="#l22.32"></a><span id="l22.32"> </span>
<a href="#l22.33"></a><span id="l22.33"> function cvSetNode(node, text) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/components/addrbook/content/abTrees.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/components/addrbook/content/abTrees.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -78,17 +78,17 @@ function abSort(a, b) {</span>
<a href="#l23.4"></a><span id="l23.4"> /**</span>
<a href="#l23.5"></a><span id="l23.5">  * Each abDirTreeItem corresponds to one row in the tree view.</span>
<a href="#l23.6"></a><span id="l23.6">  */</span>
<a href="#l23.7"></a><span id="l23.7"> function abDirTreeItem(aDirectory) {</span>
<a href="#l23.8"></a><span id="l23.8">   this._directory = aDirectory;</span>
<a href="#l23.9"></a><span id="l23.9"> }</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11"> abDirTreeItem.prototype = {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  getText: function atv_getText() {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  getText() {</span>
<a href="#l23.14"></a><span id="l23.14">     return this._directory.dirName;</span>
<a href="#l23.15"></a><span id="l23.15">   },</span>
<a href="#l23.16"></a><span id="l23.16"> </span>
<a href="#l23.17"></a><span id="l23.17">   get id() {</span>
<a href="#l23.18"></a><span id="l23.18">     return this._directory.URI;</span>
<a href="#l23.19"></a><span id="l23.19">   },</span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21">   _open: false,</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineat">@@ -124,17 +124,17 @@ abDirTreeItem.prototype = {</span>
<a href="#l23.23"></a><span id="l23.23">         this._children[this._children.length - 1]._parent = this;</span>
<a href="#l23.24"></a><span id="l23.24">       }</span>
<a href="#l23.25"></a><span id="l23.25"> </span>
<a href="#l23.26"></a><span id="l23.26">       this._children.sort(abSort);</span>
<a href="#l23.27"></a><span id="l23.27">     }</span>
<a href="#l23.28"></a><span id="l23.28">     return this._children;</span>
<a href="#l23.29"></a><span id="l23.29">   },</span>
<a href="#l23.30"></a><span id="l23.30"> </span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-  getProperties: function atv_getProps() {</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+  getProperties() {</span>
<a href="#l23.33"></a><span id="l23.33">     let properties = [];</span>
<a href="#l23.34"></a><span id="l23.34">     if (this._directory.isMailList)</span>
<a href="#l23.35"></a><span id="l23.35">       properties.push(&quot;IsMailList-true&quot;);</span>
<a href="#l23.36"></a><span id="l23.36">     if (this._directory.isRemote)</span>
<a href="#l23.37"></a><span id="l23.37">       properties.push(&quot;IsRemote-true&quot;);</span>
<a href="#l23.38"></a><span id="l23.38">     if (this._directory.isSecure)</span>
<a href="#l23.39"></a><span id="l23.39">       properties.push(&quot;IsSecure-true&quot;);</span>
<a href="#l23.40"></a><span id="l23.40">     return properties.join(&quot; &quot;);</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineat">@@ -145,63 +145,63 @@ abDirTreeItem.prototype = {</span>
<a href="#l23.42"></a><span id="l23.42">  * Our actual implementation of nsITreeView.</span>
<a href="#l23.43"></a><span id="l23.43">  */</span>
<a href="#l23.44"></a><span id="l23.44"> function directoryTreeView() {}</span>
<a href="#l23.45"></a><span id="l23.45"> directoryTreeView.prototype = {</span>
<a href="#l23.46"></a><span id="l23.46">   __proto__: new PROTO_TREE_VIEW(),</span>
<a href="#l23.47"></a><span id="l23.47"> </span>
<a href="#l23.48"></a><span id="l23.48">   hasRemoteAB: false,</span>
<a href="#l23.49"></a><span id="l23.49"> </span>
<a href="#l23.50"></a><span id="l23.50" class="difflineminus">-  init: function dtv_init(aTree, aJSONFile) {</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+  init(aTree, aJSONFile) {</span>
<a href="#l23.52"></a><span id="l23.52">     if (aJSONFile) {</span>
<a href="#l23.53"></a><span id="l23.53">       // Parse our persistent-open-state json file</span>
<a href="#l23.54"></a><span id="l23.54">       let data = IOUtils.loadFileToString(aJSONFile);</span>
<a href="#l23.55"></a><span id="l23.55">       if (data)</span>
<a href="#l23.56"></a><span id="l23.56">         this._persistOpenMap = JSON.parse(data);</span>
<a href="#l23.57"></a><span id="l23.57">     }</span>
<a href="#l23.58"></a><span id="l23.58"> </span>
<a href="#l23.59"></a><span id="l23.59">     this._rebuild();</span>
<a href="#l23.60"></a><span id="l23.60">     aTree.view = this;</span>
<a href="#l23.61"></a><span id="l23.61">   },</span>
<a href="#l23.62"></a><span id="l23.62"> </span>
<a href="#l23.63"></a><span id="l23.63" class="difflineminus">-  shutdown: function dtv_shutdown(aJSONFile) {</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineplus">+  shutdown(aJSONFile) {</span>
<a href="#l23.65"></a><span id="l23.65">     // Write out the persistOpenMap to our JSON file</span>
<a href="#l23.66"></a><span id="l23.66">     if (aJSONFile) {</span>
<a href="#l23.67"></a><span id="l23.67">       // Write out our json file...</span>
<a href="#l23.68"></a><span id="l23.68">       let data = JSON.stringify(this._persistOpenMap);</span>
<a href="#l23.69"></a><span id="l23.69">       IOUtils.saveStringToFile(aJSONFile, data);</span>
<a href="#l23.70"></a><span id="l23.70">     }</span>
<a href="#l23.71"></a><span id="l23.71">   },</span>
<a href="#l23.72"></a><span id="l23.72"> </span>
<a href="#l23.73"></a><span id="l23.73">   // Override the dnd methods for those functions in abDragDrop.js</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineminus">-  canDrop: function dtv_canDrop(aIndex, aOrientation, dataTransfer) {</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineplus">+  canDrop(aIndex, aOrientation, dataTransfer) {</span>
<a href="#l23.76"></a><span id="l23.76">     return abDirTreeObserver.canDrop(aIndex, aOrientation, dataTransfer);</span>
<a href="#l23.77"></a><span id="l23.77">   },</span>
<a href="#l23.78"></a><span id="l23.78"> </span>
<a href="#l23.79"></a><span id="l23.79" class="difflineminus">-  drop: function dtv_drop(aRow, aOrientation, dataTransfer) {</span>
<a href="#l23.80"></a><span id="l23.80" class="difflineplus">+  drop(aRow, aOrientation, dataTransfer) {</span>
<a href="#l23.81"></a><span id="l23.81">     abDirTreeObserver.onDrop(aRow, aOrientation, dataTransfer);</span>
<a href="#l23.82"></a><span id="l23.82">   },</span>
<a href="#l23.83"></a><span id="l23.83"> </span>
<a href="#l23.84"></a><span id="l23.84" class="difflineminus">-  getDirectoryAtIndex: function dtv_getDirForIndex(aIndex) {</span>
<a href="#l23.85"></a><span id="l23.85" class="difflineplus">+  getDirectoryAtIndex(aIndex) {</span>
<a href="#l23.86"></a><span id="l23.86">     return this._rowMap[aIndex]._directory;</span>
<a href="#l23.87"></a><span id="l23.87">   },</span>
<a href="#l23.88"></a><span id="l23.88"> </span>
<a href="#l23.89"></a><span id="l23.89">   // Override jsTreeView's isContainer, since we want to be able</span>
<a href="#l23.90"></a><span id="l23.90">   // to react to drag-drop events for all items in the directory</span>
<a href="#l23.91"></a><span id="l23.91">   // tree.</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineminus">-  isContainer: function dtv_isContainer(aIndex) {</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineplus">+  isContainer(aIndex) {</span>
<a href="#l23.94"></a><span id="l23.94">     return true;</span>
<a href="#l23.95"></a><span id="l23.95">   },</span>
<a href="#l23.96"></a><span id="l23.96"> </span>
<a href="#l23.97"></a><span id="l23.97">   /**</span>
<a href="#l23.98"></a><span id="l23.98">    * NOTE: This function will result in indeterminate rows being selected.</span>
<a href="#l23.99"></a><span id="l23.99">    *       Callers should take care to re-select a desired row after calling</span>
<a href="#l23.100"></a><span id="l23.100">    *       this function.</span>
<a href="#l23.101"></a><span id="l23.101">    */</span>
<a href="#l23.102"></a><span id="l23.102" class="difflineminus">-  _rebuild: function dtv__rebuild() {</span>
<a href="#l23.103"></a><span id="l23.103" class="difflineplus">+  _rebuild() {</span>
<a href="#l23.104"></a><span id="l23.104">     var oldCount = this._rowMap.length;</span>
<a href="#l23.105"></a><span id="l23.105">     this._rowMap = [];</span>
<a href="#l23.106"></a><span id="l23.106"> </span>
<a href="#l23.107"></a><span id="l23.107">     // Make an entry for All Address Books.</span>
<a href="#l23.108"></a><span id="l23.108">     let rootAB = MailServices.ab.getDirectory(kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l23.109"></a><span id="l23.109">     rootAB.dirName = gAddressBookBundle.getString(&quot;allAddressBooks&quot;);</span>
<a href="#l23.110"></a><span id="l23.110">     this._rowMap.push(new abDirTreeItem(rootAB));</span>
<a href="#l23.111"></a><span id="l23.111"> </span>
<a href="#l23.112"></a><span id="l23.112" class="difflineat">@@ -219,17 +219,17 @@ directoryTreeView.prototype = {</span>
<a href="#l23.113"></a><span id="l23.113">       if (this._rowMap[i].id == aId)</span>
<a href="#l23.114"></a><span id="l23.114">         return i;</span>
<a href="#l23.115"></a><span id="l23.115">     }</span>
<a href="#l23.116"></a><span id="l23.116"> </span>
<a href="#l23.117"></a><span id="l23.117">     return -1;</span>
<a href="#l23.118"></a><span id="l23.118">   },</span>
<a href="#l23.119"></a><span id="l23.119"> </span>
<a href="#l23.120"></a><span id="l23.120">   // nsIAbListener interfaces</span>
<a href="#l23.121"></a><span id="l23.121" class="difflineminus">-  onItemAdded: function dtv_onItemAdded(aParent, aItem) {</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineplus">+  onItemAdded(aParent, aItem) {</span>
<a href="#l23.123"></a><span id="l23.123">     if (!(aItem instanceof Ci.nsIAbDirectory))</span>
<a href="#l23.124"></a><span id="l23.124">       return;</span>
<a href="#l23.125"></a><span id="l23.125">     // XXX we can optimize this later</span>
<a href="#l23.126"></a><span id="l23.126">     this._rebuild();</span>
<a href="#l23.127"></a><span id="l23.127"> </span>
<a href="#l23.128"></a><span id="l23.128">     if (!this._tree)</span>
<a href="#l23.129"></a><span id="l23.129">       return;</span>
<a href="#l23.130"></a><span id="l23.130"> </span>
<a href="#l23.131"></a><span id="l23.131" class="difflineat">@@ -237,17 +237,17 @@ directoryTreeView.prototype = {</span>
<a href="#l23.132"></a><span id="l23.132">     for (var [i, row] of this._rowMap.entries()) {</span>
<a href="#l23.133"></a><span id="l23.133">       if (row.id == aItem.URI) {</span>
<a href="#l23.134"></a><span id="l23.134">         this.selection.select(i);</span>
<a href="#l23.135"></a><span id="l23.135">         break;</span>
<a href="#l23.136"></a><span id="l23.136">       }</span>
<a href="#l23.137"></a><span id="l23.137">     }</span>
<a href="#l23.138"></a><span id="l23.138">   },</span>
<a href="#l23.139"></a><span id="l23.139"> </span>
<a href="#l23.140"></a><span id="l23.140" class="difflineminus">-  onItemRemoved: function dtv_onItemRemoved(aParent, aItem) {</span>
<a href="#l23.141"></a><span id="l23.141" class="difflineplus">+  onItemRemoved(aParent, aItem) {</span>
<a href="#l23.142"></a><span id="l23.142">     if (!(aItem instanceof Ci.nsIAbDirectory))</span>
<a href="#l23.143"></a><span id="l23.143">       return;</span>
<a href="#l23.144"></a><span id="l23.144">     // XXX we can optimize this later</span>
<a href="#l23.145"></a><span id="l23.145">     this._rebuild();</span>
<a href="#l23.146"></a><span id="l23.146"> </span>
<a href="#l23.147"></a><span id="l23.147">     if (!this._tree)</span>
<a href="#l23.148"></a><span id="l23.148">       return;</span>
<a href="#l23.149"></a><span id="l23.149"> </span>
<a href="#l23.150"></a><span id="l23.150" class="difflineat">@@ -262,17 +262,17 @@ directoryTreeView.prototype = {</span>
<a href="#l23.151"></a><span id="l23.151">     for (var [i, row] of this._rowMap.entries()) {</span>
<a href="#l23.152"></a><span id="l23.152">       if (row.id == aParent.URI) {</span>
<a href="#l23.153"></a><span id="l23.153">         this.selection.select(i);</span>
<a href="#l23.154"></a><span id="l23.154">         break;</span>
<a href="#l23.155"></a><span id="l23.155">       }</span>
<a href="#l23.156"></a><span id="l23.156">     }</span>
<a href="#l23.157"></a><span id="l23.157">   },</span>
<a href="#l23.158"></a><span id="l23.158"> </span>
<a href="#l23.159"></a><span id="l23.159" class="difflineminus">-  onItemPropertyChanged: function dtv_onItemProp(aItem, aProp, aOld, aNew) {</span>
<a href="#l23.160"></a><span id="l23.160" class="difflineplus">+  onItemPropertyChanged(aItem, aProp, aOld, aNew) {</span>
<a href="#l23.161"></a><span id="l23.161">     if (!(aItem instanceof Ci.nsIAbDirectory))</span>
<a href="#l23.162"></a><span id="l23.162">       return;</span>
<a href="#l23.163"></a><span id="l23.163"> </span>
<a href="#l23.164"></a><span id="l23.164">     for (let i in this._rowMap) {</span>
<a href="#l23.165"></a><span id="l23.165">       if (this._rowMap[i]._directory == aItem) {</span>
<a href="#l23.166"></a><span id="l23.166">         this._tree.invalidateRow(i);</span>
<a href="#l23.167"></a><span id="l23.167">         break;</span>
<a href="#l23.168"></a><span id="l23.168">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -491,25 +491,26 @@ function SetStatusText(total) {</span>
<a href="#l24.4"></a><span id="l24.4">     if (searchInput &amp;&amp; searchInput.value) {</span>
<a href="#l24.5"></a><span id="l24.5">       if (total == 0) {</span>
<a href="#l24.6"></a><span id="l24.6">         statusText = gAddressBookBundle.getString(&quot;noMatchFound&quot;);</span>
<a href="#l24.7"></a><span id="l24.7">       } else {</span>
<a href="#l24.8"></a><span id="l24.8">         statusText = PluralForm</span>
<a href="#l24.9"></a><span id="l24.9">           .get(total, gAddressBookBundle.getString(&quot;matchesFound1&quot;))</span>
<a href="#l24.10"></a><span id="l24.10">           .replace(&quot;#1&quot;, total);</span>
<a href="#l24.11"></a><span id="l24.11">       }</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    } else</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    } else {</span>
<a href="#l24.14"></a><span id="l24.14">       statusText =</span>
<a href="#l24.15"></a><span id="l24.15">         gAddressBookBundle.getFormattedString(</span>
<a href="#l24.16"></a><span id="l24.16">           &quot;totalContactStatus&quot;,</span>
<a href="#l24.17"></a><span id="l24.17">           [getSelectedDirectory().dirName, total]);</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+    }</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20">     gStatusText.setAttribute(&quot;label&quot;, statusText);</span>
<a href="#l24.21"></a><span id="l24.21">   } catch (ex) {</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-    Cu.reportError(&quot;ERROR: failed to set status text:  &quot; + ex );</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+    Cu.reportError(&quot;ERROR: failed to set status text: &quot; + ex);</span>
<a href="#l24.24"></a><span id="l24.24">   }</span>
<a href="#l24.25"></a><span id="l24.25"> }</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27"> function AbResultsPaneKeyPress(event) {</span>
<a href="#l24.28"></a><span id="l24.28">   if (event.keyCode == 13)</span>
<a href="#l24.29"></a><span id="l24.29">     AbEditSelectedCard();</span>
<a href="#l24.30"></a><span id="l24.30"> }</span>
<a href="#l24.31"></a><span id="l24.31"> </span>
<a href="#l24.32"></a><span id="l24.32" class="difflineat">@@ -777,19 +778,19 @@ function AbOSXAddressBookExists() {</span>
<a href="#l24.33"></a><span id="l24.33">   var uriPresent = Preferences.get(kOSXPrefBase + &quot;.uri&quot;, null) == kOSXDirectoryURI;</span>
<a href="#l24.34"></a><span id="l24.34">   var position = Preferences.get(kOSXPrefBase + &quot;.position&quot;, 1);</span>
<a href="#l24.35"></a><span id="l24.35"> </span>
<a href="#l24.36"></a><span id="l24.36">   // Address book exists if the uri is correct and the position is not zero.</span>
<a href="#l24.37"></a><span id="l24.37">   return uriPresent &amp;&amp; position != 0;</span>
<a href="#l24.38"></a><span id="l24.38"> }</span>
<a href="#l24.39"></a><span id="l24.39"> </span>
<a href="#l24.40"></a><span id="l24.40"> function AbShowHideOSXAddressBook() {</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-  if (AbOSXAddressBookExists())</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+  if (AbOSXAddressBookExists()) {</span>
<a href="#l24.43"></a><span id="l24.43">     MailServices.ab.deleteAddressBook(kOSXDirectoryURI);</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-  else {</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+  } else {</span>
<a href="#l24.46"></a><span id="l24.46">     MailServices.ab.newAddressBook(</span>
<a href="#l24.47"></a><span id="l24.47">       gAddressBookBundle.getString(kOSXPrefBase + &quot;.description&quot;),</span>
<a href="#l24.48"></a><span id="l24.48">       kOSXDirectoryURI, 3, kOSXPrefBase);</span>
<a href="#l24.49"></a><span id="l24.49">   }</span>
<a href="#l24.50"></a><span id="l24.50"> }</span>
<a href="#l24.51"></a><span id="l24.51"> </span>
<a href="#l24.52"></a><span id="l24.52"> var abResultsController = {</span>
<a href="#l24.53"></a><span id="l24.53">   commands: {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/components/cloudfile/cloudFileAccounts.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/components/cloudfile/cloudFileAccounts.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -107,18 +107,17 @@ var cloudFileAccounts = {</span>
<a href="#l25.4"></a><span id="l25.4">       return provider;</span>
<a href="#l25.5"></a><span id="l25.5">     } catch (e) {</span>
<a href="#l25.6"></a><span id="l25.6">       Services.prefs.deleteBranch(ACCOUNT_ROOT + key);</span>
<a href="#l25.7"></a><span id="l25.7">       throw e;</span>
<a href="#l25.8"></a><span id="l25.8">     }</span>
<a href="#l25.9"></a><span id="l25.9">   },</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11">   // Set provider-specific prefs</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  _processExtraPrefs: function CFA__processExtraPrefs(aAccountKey,</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-                                                      aExtraPrefs) {</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+  _processExtraPrefs(aAccountKey, aExtraPrefs) {</span>
<a href="#l25.15"></a><span id="l25.15">     const kFuncMap = {</span>
<a href="#l25.16"></a><span id="l25.16">       &quot;int&quot;: &quot;setIntPref&quot;,</span>
<a href="#l25.17"></a><span id="l25.17">       &quot;bool&quot;: &quot;setBoolPref&quot;,</span>
<a href="#l25.18"></a><span id="l25.18">       &quot;char&quot;: &quot;setCharPref&quot;,</span>
<a href="#l25.19"></a><span id="l25.19">     };</span>
<a href="#l25.20"></a><span id="l25.20"> </span>
<a href="#l25.21"></a><span id="l25.21">     for (let prefKey in aExtraPrefs) {</span>
<a href="#l25.22"></a><span id="l25.22">       let type = aExtraPrefs[prefKey].type;</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineat">@@ -162,29 +161,29 @@ var cloudFileAccounts = {</span>
<a href="#l25.24"></a><span id="l25.24">     }</span>
<a href="#l25.25"></a><span id="l25.25">   },</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27">   get accounts() {</span>
<a href="#l25.28"></a><span id="l25.28">     return this._accountKeys.filter(key =&gt; this.getAccount(key) != null).</span>
<a href="#l25.29"></a><span id="l25.29">       map(key =&gt; this.getAccount(key));</span>
<a href="#l25.30"></a><span id="l25.30">   },</span>
<a href="#l25.31"></a><span id="l25.31"> </span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-  getAccountsForType: function CFA_getAccountsForType(aType) {</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+  getAccountsForType(aType) {</span>
<a href="#l25.34"></a><span id="l25.34">     let result = [];</span>
<a href="#l25.35"></a><span id="l25.35"> </span>
<a href="#l25.36"></a><span id="l25.36">     for (let accountKey of this._accountKeys) {</span>
<a href="#l25.37"></a><span id="l25.37">       let type = Services.prefs.getCharPref(ACCOUNT_ROOT + accountKey + &quot;.type&quot;);</span>
<a href="#l25.38"></a><span id="l25.38">       if (type === aType)</span>
<a href="#l25.39"></a><span id="l25.39">         result.push(this.getAccount(accountKey));</span>
<a href="#l25.40"></a><span id="l25.40">     }</span>
<a href="#l25.41"></a><span id="l25.41"> </span>
<a href="#l25.42"></a><span id="l25.42">     return result;</span>
<a href="#l25.43"></a><span id="l25.43">   },</span>
<a href="#l25.44"></a><span id="l25.44"> </span>
<a href="#l25.45"></a><span id="l25.45" class="difflineminus">-  addAccountDialog: function CFA_addAccountDialog() {</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineplus">+  addAccountDialog() {</span>
<a href="#l25.47"></a><span id="l25.47">     let params = {accountKey: null};</span>
<a href="#l25.48"></a><span id="l25.48">     Services.wm</span>
<a href="#l25.49"></a><span id="l25.49">             .getMostRecentWindow(null)</span>
<a href="#l25.50"></a><span id="l25.50">             .openDialog(&quot;chrome://messenger/content/cloudfile/&quot;</span>
<a href="#l25.51"></a><span id="l25.51">                         + &quot;addAccountDialog.xul&quot;,</span>
<a href="#l25.52"></a><span id="l25.52">                         &quot;&quot;, &quot;chrome, dialog, modal, resizable=yes&quot;,</span>
<a href="#l25.53"></a><span id="l25.53">                         params).focus();</span>
<a href="#l25.54"></a><span id="l25.54">     return params.accountKey;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/components/cloudfile/content/addAccountDialog.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/components/cloudfile/content/addAccountDialog.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -47,17 +47,17 @@ var addAccountDialog = {</span>
<a href="#l26.4"></a><span id="l26.4">   _accept: null,</span>
<a href="#l26.5"></a><span id="l26.5">   _strings: Services.strings</span>
<a href="#l26.6"></a><span id="l26.6">                     .createBundle(&quot;chrome://messenger/locale/cloudfile/addAccountDialog.properties&quot;),</span>
<a href="#l26.7"></a><span id="l26.7">   // This blacklist is for providers who no longer want to be offered</span>
<a href="#l26.8"></a><span id="l26.8">   // as an option for a new Filelink provider, but still wants to</span>
<a href="#l26.9"></a><span id="l26.9">   // exist as a Filelink provider for pre-existing users.</span>
<a href="#l26.10"></a><span id="l26.10">   _blacklist: new Set([&quot;YouSendIt&quot;]),</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  onInit: function AAD_onInit() {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+  onInit() {</span>
<a href="#l26.14"></a><span id="l26.14">     this._settings = document.getElementById(&quot;accountSettings&quot;);</span>
<a href="#l26.15"></a><span id="l26.15">     this._accountType = document.getElementById(&quot;accountType&quot;);</span>
<a href="#l26.16"></a><span id="l26.16">     this._noAccountText = document.getElementById(&quot;noAccountText&quot;);</span>
<a href="#l26.17"></a><span id="l26.17">     this._accept = document.documentElement.getButton(&quot;accept&quot;);</span>
<a href="#l26.18"></a><span id="l26.18">     this._cancel = document.documentElement.getButton(&quot;cancel&quot;);</span>
<a href="#l26.19"></a><span id="l26.19">     this._messages = document.getElementById(&quot;messages&quot;);</span>
<a href="#l26.20"></a><span id="l26.20">     this._authSpinner = document.getElementById(&quot;authorizing&quot;);</span>
<a href="#l26.21"></a><span id="l26.21">     this._error = document.getElementById(&quot;error&quot;);</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -117,17 +117,17 @@ var addAccountDialog = {</span>
<a href="#l26.23"></a><span id="l26.23">       }</span>
<a href="#l26.24"></a><span id="l26.24">       case &quot;select&quot;: {</span>
<a href="#l26.25"></a><span id="l26.25">         this.accountTypeSelected();</span>
<a href="#l26.26"></a><span id="l26.26">         break;</span>
<a href="#l26.27"></a><span id="l26.27">       }</span>
<a href="#l26.28"></a><span id="l26.28">     }</span>
<a href="#l26.29"></a><span id="l26.29">   },</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-  onIFrameLoaded: function AAD_onIFrameLoaded(aEvent) {</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+  onIFrameLoaded(aEvent) {</span>
<a href="#l26.33"></a><span id="l26.33">     let doc = this._settings.contentDocument;</span>
<a href="#l26.34"></a><span id="l26.34"> </span>
<a href="#l26.35"></a><span id="l26.35">     let links = doc.getElementsByTagName(&quot;a&quot;);</span>
<a href="#l26.36"></a><span id="l26.36"> </span>
<a href="#l26.37"></a><span id="l26.37">     for (let link of links)</span>
<a href="#l26.38"></a><span id="l26.38">       link.addEventListener(&quot;click&quot;, this.onClickLink);</span>
<a href="#l26.39"></a><span id="l26.39"> </span>
<a href="#l26.40"></a><span id="l26.40">     let form = doc.getElementById(kFormId);</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineat">@@ -155,24 +155,24 @@ var addAccountDialog = {</span>
<a href="#l26.42"></a><span id="l26.42">       this._settings.style.height = this._settings.style.minHeight = &quot;16px&quot;;</span>
<a href="#l26.43"></a><span id="l26.43">       return;</span>
<a href="#l26.44"></a><span id="l26.44">     }</span>
<a href="#l26.45"></a><span id="l26.45">     let newHeight = this._settings.contentDocument.body.offsetHeight;</span>
<a href="#l26.46"></a><span id="l26.46">     this._settings.style.height = this._settings.style.minHeight = newHeight + &quot;px&quot;;</span>
<a href="#l26.47"></a><span id="l26.47">     window.sizeToContent();</span>
<a href="#l26.48"></a><span id="l26.48">   },</span>
<a href="#l26.49"></a><span id="l26.49"> </span>
<a href="#l26.50"></a><span id="l26.50" class="difflineminus">-  removeTitleMenuItem: function AAD_removeTitleMenuItem() {</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+  removeTitleMenuItem() {</span>
<a href="#l26.52"></a><span id="l26.52">     let menuitem = this._accountType.querySelector('menuitem[value=&quot;&quot;]');</span>
<a href="#l26.53"></a><span id="l26.53">     if (menuitem)</span>
<a href="#l26.54"></a><span id="l26.54">       menuitem.remove();</span>
<a href="#l26.55"></a><span id="l26.55">   },</span>
<a href="#l26.56"></a><span id="l26.56"> </span>
<a href="#l26.57"></a><span id="l26.57">   // Return number of additions to the menulist, zero if none happened.</span>
<a href="#l26.58"></a><span id="l26.58" class="difflineminus">-  addAccountTypes: function AAD_addAccountTypes() {</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineplus">+  addAccountTypes() {</span>
<a href="#l26.60"></a><span id="l26.60">     let accountTypeTotal = 0;</span>
<a href="#l26.61"></a><span id="l26.61">     for (let [key, provider] of cloudFileAccounts.enumerateProviders()) {</span>
<a href="#l26.62"></a><span id="l26.62">       // If we already have an account for this type, don't add it to the list.</span>
<a href="#l26.63"></a><span id="l26.63">       // This limitation will hopefully be removed in the future.</span>
<a href="#l26.64"></a><span id="l26.64">       if (cloudFileAccounts.getAccountsForType(key).length &gt; 0)</span>
<a href="#l26.65"></a><span id="l26.65">         continue;</span>
<a href="#l26.66"></a><span id="l26.66"> </span>
<a href="#l26.67"></a><span id="l26.67">       if (this._blacklist.has(key))</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineat">@@ -206,79 +206,79 @@ var addAccountDialog = {</span>
<a href="#l26.69"></a><span id="l26.69">     // If there's only one option, let's choose it for the user to avoid</span>
<a href="#l26.70"></a><span id="l26.70">     // a few clicks.</span>
<a href="#l26.71"></a><span id="l26.71">     if (this._accountType.itemCount == 1)</span>
<a href="#l26.72"></a><span id="l26.72">       this._accountType.selectedIndex = 0;</span>
<a href="#l26.73"></a><span id="l26.73"> </span>
<a href="#l26.74"></a><span id="l26.74">     return accountTypeTotal;</span>
<a href="#l26.75"></a><span id="l26.75">   },</span>
<a href="#l26.76"></a><span id="l26.76"> </span>
<a href="#l26.77"></a><span id="l26.77" class="difflineminus">-  onOK: function AAD_onOK() {</span>
<a href="#l26.78"></a><span id="l26.78" class="difflineplus">+  onOK() {</span>
<a href="#l26.79"></a><span id="l26.79">     let accountType = this._accountType.value;</span>
<a href="#l26.80"></a><span id="l26.80">     let obs = new createAccountObserver();</span>
<a href="#l26.81"></a><span id="l26.81"> </span>
<a href="#l26.82"></a><span id="l26.82">     let extras = this.getExtraArgs();</span>
<a href="#l26.83"></a><span id="l26.83"> </span>
<a href="#l26.84"></a><span id="l26.84">     cloudFileAccounts.createAccount(accountType, obs, extras);</span>
<a href="#l26.85"></a><span id="l26.85">     this._accept.disabled = true;</span>
<a href="#l26.86"></a><span id="l26.86"> </span>
<a href="#l26.87"></a><span id="l26.87">     this._messages.selectedPanel = this._authSpinner;</span>
<a href="#l26.88"></a><span id="l26.88"> </span>
<a href="#l26.89"></a><span id="l26.89">     // Uninitialize the dialog before closing.</span>
<a href="#l26.90"></a><span id="l26.90">     this.onUnInit();</span>
<a href="#l26.91"></a><span id="l26.91">     return false;</span>
<a href="#l26.92"></a><span id="l26.92">   },</span>
<a href="#l26.93"></a><span id="l26.93"> </span>
<a href="#l26.94"></a><span id="l26.94" class="difflineminus">-  getExtraArgs: function AAD_getExtraArgs() {</span>
<a href="#l26.95"></a><span id="l26.95" class="difflineplus">+  getExtraArgs() {</span>
<a href="#l26.96"></a><span id="l26.96">     if (!this._settings)</span>
<a href="#l26.97"></a><span id="l26.97">       return {};</span>
<a href="#l26.98"></a><span id="l26.98"> </span>
<a href="#l26.99"></a><span id="l26.99">     let func = this._settings.contentWindow</span>
<a href="#l26.100"></a><span id="l26.100">                    .wrappedJSObject</span>
<a href="#l26.101"></a><span id="l26.101">                    .extraArgs;</span>
<a href="#l26.102"></a><span id="l26.102">     if (!func)</span>
<a href="#l26.103"></a><span id="l26.103">       return {};</span>
<a href="#l26.104"></a><span id="l26.104"> </span>
<a href="#l26.105"></a><span id="l26.105">     return func();</span>
<a href="#l26.106"></a><span id="l26.106">   },</span>
<a href="#l26.107"></a><span id="l26.107"> </span>
<a href="#l26.108"></a><span id="l26.108" class="difflineminus">-  accountTypeSelected: function AAD_accountTypeSelected() {</span>
<a href="#l26.109"></a><span id="l26.109" class="difflineplus">+  accountTypeSelected() {</span>
<a href="#l26.110"></a><span id="l26.110">     let providerKey = this._accountType.selectedItem.value;</span>
<a href="#l26.111"></a><span id="l26.111">     if (!providerKey)</span>
<a href="#l26.112"></a><span id="l26.112">       return;</span>
<a href="#l26.113"></a><span id="l26.113"> </span>
<a href="#l26.114"></a><span id="l26.114">     let provider = cloudFileAccounts.getProviderForType(providerKey);</span>
<a href="#l26.115"></a><span id="l26.115">     if (!provider)</span>
<a href="#l26.116"></a><span id="l26.116">       return;</span>
<a href="#l26.117"></a><span id="l26.117"> </span>
<a href="#l26.118"></a><span id="l26.118">     // Reset the message display</span>
<a href="#l26.119"></a><span id="l26.119">     this._messages.selectedIndex = -1;</span>
<a href="#l26.120"></a><span id="l26.120"> </span>
<a href="#l26.121"></a><span id="l26.121">     // Load up the correct XHTML page for this provider.</span>
<a href="#l26.122"></a><span id="l26.122">     this._settings.contentDocument.location.href = provider.settingsURL;</span>
<a href="#l26.123"></a><span id="l26.123">   },</span>
<a href="#l26.124"></a><span id="l26.124"> </span>
<a href="#l26.125"></a><span id="l26.125" class="difflineminus">-  onClickLink: function AAD_onClickLink(e) {</span>
<a href="#l26.126"></a><span id="l26.126" class="difflineplus">+  onClickLink(e) {</span>
<a href="#l26.127"></a><span id="l26.127">     e.preventDefault();</span>
<a href="#l26.128"></a><span id="l26.128">     let href = e.target.getAttribute(&quot;href&quot;);</span>
<a href="#l26.129"></a><span id="l26.129">     gProtocolService.loadURI(Services.io.newURI(href, &quot;UTF-8&quot;));</span>
<a href="#l26.130"></a><span id="l26.130">   },</span>
<a href="#l26.131"></a><span id="l26.131"> </span>
<a href="#l26.132"></a><span id="l26.132" class="difflineminus">-  onInput: function AAD_onInput() {</span>
<a href="#l26.133"></a><span id="l26.133" class="difflineplus">+  onInput() {</span>
<a href="#l26.134"></a><span id="l26.134">     // Let's see if we have everything we need to make OK enabled...</span>
<a href="#l26.135"></a><span id="l26.135">     if (this._accountType.selectedIndex == -1) {</span>
<a href="#l26.136"></a><span id="l26.136">       // We have the &quot;Select a service provider&quot; menuitem selected, so we</span>
<a href="#l26.137"></a><span id="l26.137">       // shouldn't be able to click &quot;Set up account&quot;</span>
<a href="#l26.138"></a><span id="l26.138">       this._accept.disabled = true;</span>
<a href="#l26.139"></a><span id="l26.139">     } else {</span>
<a href="#l26.140"></a><span id="l26.140">       this._accept.disabled = !this.checkValidity();</span>
<a href="#l26.141"></a><span id="l26.141">     }</span>
<a href="#l26.142"></a><span id="l26.142">   },</span>
<a href="#l26.143"></a><span id="l26.143"> </span>
<a href="#l26.144"></a><span id="l26.144" class="difflineminus">-  checkValidity: function AAD_checkValidity() {</span>
<a href="#l26.145"></a><span id="l26.145" class="difflineplus">+  checkValidity() {</span>
<a href="#l26.146"></a><span id="l26.146">     // If there's a form in the iframe, ensure that</span>
<a href="#l26.147"></a><span id="l26.147">     // it's checkValidity function passes.</span>
<a href="#l26.148"></a><span id="l26.148">     let form = this._settings</span>
<a href="#l26.149"></a><span id="l26.149">                    .contentWindow</span>
<a href="#l26.150"></a><span id="l26.150">                    .wrappedJSObject</span>
<a href="#l26.151"></a><span id="l26.151">                    .document</span>
<a href="#l26.152"></a><span id="l26.152">                    .getElementById(kFormId);</span>
<a href="#l26.153"></a><span id="l26.153"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/components/cloudfile/nsBox.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/components/cloudfile/nsBox.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -31,25 +31,25 @@ XPCOMUtils.defineLazyServiceGetter(this,</span>
<a href="#l27.4"></a><span id="l27.4"> </span>
<a href="#l27.5"></a><span id="l27.5"> function nsBox() {</span>
<a href="#l27.6"></a><span id="l27.6">   this.log = Log4Moz.getConfiguredLogger(&quot;BoxService&quot;);</span>
<a href="#l27.7"></a><span id="l27.7">   this._oauth = new OAuth2(kAuthBaseUrl, null, kClientId, kClientSecret);</span>
<a href="#l27.8"></a><span id="l27.8">   this._oauth.authURI = kAuthBaseUrl + kAuthUrl;</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10">   let account = this;</span>
<a href="#l27.11"></a><span id="l27.11">   Object.defineProperty(this._oauth, &quot;refreshToken&quot;, {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    get: function getRefreshToken() {</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+    get() {</span>
<a href="#l27.14"></a><span id="l27.14">       if (!this.mRefreshToken) {</span>
<a href="#l27.15"></a><span id="l27.15">         let authToken = cloudFileAccounts.getSecretValue(account.accountKey,</span>
<a href="#l27.16"></a><span id="l27.16">                                                          cloudFileAccounts.kTokenRealm);</span>
<a href="#l27.17"></a><span id="l27.17">         this.mRefreshToken = authToken || &quot;&quot;;</span>
<a href="#l27.18"></a><span id="l27.18">       }</span>
<a href="#l27.19"></a><span id="l27.19">       return this.mRefreshToken;</span>
<a href="#l27.20"></a><span id="l27.20">     },</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineminus">-    set: function setRefreshToken(aVal) {</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineplus">+    set(aVal) {</span>
<a href="#l27.23"></a><span id="l27.23">       if (!aVal)</span>
<a href="#l27.24"></a><span id="l27.24">         aVal = &quot;&quot;;</span>
<a href="#l27.25"></a><span id="l27.25"> </span>
<a href="#l27.26"></a><span id="l27.26">       cloudFileAccounts.setSecretValue(account.accountKey,</span>
<a href="#l27.27"></a><span id="l27.27">                                        cloudFileAccounts.kTokenRealm,</span>
<a href="#l27.28"></a><span id="l27.28">                                        aVal);</span>
<a href="#l27.29"></a><span id="l27.29"> </span>
<a href="#l27.30"></a><span id="l27.30">       return (this.mRefreshToken = aVal);</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineat">@@ -92,74 +92,73 @@ nsBox.prototype = {</span>
<a href="#l27.32"></a><span id="l27.32">   _uploadInfo: {},</span>
<a href="#l27.33"></a><span id="l27.33">   _uploads: [],</span>
<a href="#l27.34"></a><span id="l27.34">   _oauth: null,</span>
<a href="#l27.35"></a><span id="l27.35"> </span>
<a href="#l27.36"></a><span id="l27.36">   /**</span>
<a href="#l27.37"></a><span id="l27.37">    * Used by our testing framework to override the URLs that this component</span>
<a href="#l27.38"></a><span id="l27.38">    * communicates to.</span>
<a href="#l27.39"></a><span id="l27.39">    */</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineminus">-  overrideUrls: function nsBox_overrideUrls(aNumUrls, aUrls) {</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineplus">+  overrideUrls(aNumUrls, aUrls) {</span>
<a href="#l27.42"></a><span id="l27.42">     gServerUrl = aUrls[0];</span>
<a href="#l27.43"></a><span id="l27.43">   },</span>
<a href="#l27.44"></a><span id="l27.44"> </span>
<a href="#l27.45"></a><span id="l27.45">   /**</span>
<a href="#l27.46"></a><span id="l27.46">    * Initializes an instance of this nsIMsgCloudFileProvider for an account</span>
<a href="#l27.47"></a><span id="l27.47">    * with key aAccountKey.</span>
<a href="#l27.48"></a><span id="l27.48">    *</span>
<a href="#l27.49"></a><span id="l27.49">    * @param aAccountKey the account key to initialize this</span>
<a href="#l27.50"></a><span id="l27.50">    *                    nsIMsgCloudFileProvider with.</span>
<a href="#l27.51"></a><span id="l27.51">    */</span>
<a href="#l27.52"></a><span id="l27.52" class="difflineminus">-  init: function nsBox_init(aAccountKey) {</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineplus">+  init(aAccountKey) {</span>
<a href="#l27.54"></a><span id="l27.54">     this._accountKey = aAccountKey;</span>
<a href="#l27.55"></a><span id="l27.55">     this._prefBranch = Services.prefs.getBranch(&quot;mail.cloud_files.accounts.&quot; +</span>
<a href="#l27.56"></a><span id="l27.56">                                                 aAccountKey + &quot;.&quot;);</span>
<a href="#l27.57"></a><span id="l27.57">   },</span>
<a href="#l27.58"></a><span id="l27.58"> </span>
<a href="#l27.59"></a><span id="l27.59">   /**</span>
<a href="#l27.60"></a><span id="l27.60">    * Private function for assigning the folder id from a cached version</span>
<a href="#l27.61"></a><span id="l27.61">    * If the folder doesn't exist, check if it exists on the server. If it</span>
<a href="#l27.62"></a><span id="l27.62">    * doesn't, set in motion the creation.</span>
<a href="#l27.63"></a><span id="l27.63">    *</span>
<a href="#l27.64"></a><span id="l27.64">    * @param aCallback called if folder is ready.</span>
<a href="#l27.65"></a><span id="l27.65">    */</span>
<a href="#l27.66"></a><span id="l27.66" class="difflineminus">-  _initFolder: function nsBox__initFolder(aCallback) {</span>
<a href="#l27.67"></a><span id="l27.67" class="difflineplus">+  _initFolder(aCallback) {</span>
<a href="#l27.68"></a><span id="l27.68">     this.log.info(&quot;_initFolder, cached folder id  = &quot; + this._cachedFolderId);</span>
<a href="#l27.69"></a><span id="l27.69"> </span>
<a href="#l27.70"></a><span id="l27.70">     let saveFolderId = (aFolderId) =&gt; {</span>
<a href="#l27.71"></a><span id="l27.71">       this.log.info(&quot;saveFolderId : &quot; + aFolderId);</span>
<a href="#l27.72"></a><span id="l27.72">       this._cachedFolderId = this._folderId = aFolderId;</span>
<a href="#l27.73"></a><span id="l27.73">       if (aCallback)</span>
<a href="#l27.74"></a><span id="l27.74">         aCallback();</span>
<a href="#l27.75"></a><span id="l27.75">     };</span>
<a href="#l27.76"></a><span id="l27.76"> </span>
<a href="#l27.77"></a><span id="l27.77">     let createThunderbirdFolder = () =&gt; {</span>
<a href="#l27.78"></a><span id="l27.78">       this._createFolder(&quot;Thunderbird&quot;, saveFolderId);</span>
<a href="#l27.79"></a><span id="l27.79">     };</span>
<a href="#l27.80"></a><span id="l27.80"> </span>
<a href="#l27.81"></a><span id="l27.81">     // If there's no cached folder, try to get one, otherwise create one.</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineminus">-    if (this._cachedFolderId == &quot;&quot;)</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineplus">+    if (this._cachedFolderId == &quot;&quot;) {</span>
<a href="#l27.84"></a><span id="l27.84">       this._getFolder(&quot;Thunderbird&quot;, saveFolderId, createThunderbirdFolder);</span>
<a href="#l27.85"></a><span id="l27.85" class="difflineminus">-    else {</span>
<a href="#l27.86"></a><span id="l27.86" class="difflineplus">+    } else {</span>
<a href="#l27.87"></a><span id="l27.87">       this._folderId = this._cachedFolderId;</span>
<a href="#l27.88"></a><span id="l27.88">       if (aCallback)</span>
<a href="#l27.89"></a><span id="l27.89">         aCallback();</span>
<a href="#l27.90"></a><span id="l27.90">     }</span>
<a href="#l27.91"></a><span id="l27.91">   },</span>
<a href="#l27.92"></a><span id="l27.92"> </span>
<a href="#l27.93"></a><span id="l27.93">   /**</span>
<a href="#l27.94"></a><span id="l27.94">    * Private callback function passed to, and called from</span>
<a href="#l27.95"></a><span id="l27.95">    * nsBoxFileUploader.</span>
<a href="#l27.96"></a><span id="l27.96">    *</span>
<a href="#l27.97"></a><span id="l27.97">    * @param aRequestObserver a request observer for monitoring the start and</span>
<a href="#l27.98"></a><span id="l27.98">    *                         stop states of a request.</span>
<a href="#l27.99"></a><span id="l27.99">    * @param aStatus the status of the request.</span>
<a href="#l27.100"></a><span id="l27.100">    */</span>
<a href="#l27.101"></a><span id="l27.101" class="difflineminus">-  _uploaderCallback: function nsBox__uploaderCallback(aRequestObserver,</span>
<a href="#l27.102"></a><span id="l27.102" class="difflineminus">-                                                            aStatus) {</span>
<a href="#l27.103"></a><span id="l27.103" class="difflineplus">+  _uploaderCallback(aRequestObserver, aStatus) {</span>
<a href="#l27.104"></a><span id="l27.104">     aRequestObserver.onStopRequest(null, null, aStatus);</span>
<a href="#l27.105"></a><span id="l27.105">     this._uploadingFile = null;</span>
<a href="#l27.106"></a><span id="l27.106">     this._uploads.shift();</span>
<a href="#l27.107"></a><span id="l27.107">     if (this._uploads.length &gt; 0) {</span>
<a href="#l27.108"></a><span id="l27.108">       let nextUpload = this._uploads[0];</span>
<a href="#l27.109"></a><span id="l27.109">       this.log.info(&quot;chaining upload, file = &quot; + nextUpload.file.leafName);</span>
<a href="#l27.110"></a><span id="l27.110">       this._uploadingFile = nextUpload.file;</span>
<a href="#l27.111"></a><span id="l27.111">       this._uploader = nextUpload;</span>
<a href="#l27.112"></a><span id="l27.112" class="difflineat">@@ -175,17 +174,17 @@ nsBox.prototype = {</span>
<a href="#l27.113"></a><span id="l27.113"> </span>
<a href="#l27.114"></a><span id="l27.114">   /**</span>
<a href="#l27.115"></a><span id="l27.115">    * Attempt to upload a file to Box's servers.</span>
<a href="#l27.116"></a><span id="l27.116">    *</span>
<a href="#l27.117"></a><span id="l27.117">    * @param aFile an nsIFile for uploading.</span>
<a href="#l27.118"></a><span id="l27.118">    * @param aCallback an nsIRequestObserver for monitoring the start and</span>
<a href="#l27.119"></a><span id="l27.119">    *                  stop states of the upload procedure.</span>
<a href="#l27.120"></a><span id="l27.120">    */</span>
<a href="#l27.121"></a><span id="l27.121" class="difflineminus">-  uploadFile: function nsBox_uploadFile(aFile, aCallback) {</span>
<a href="#l27.122"></a><span id="l27.122" class="difflineplus">+  uploadFile(aFile, aCallback) {</span>
<a href="#l27.123"></a><span id="l27.123">     if (Services.io.offline)</span>
<a href="#l27.124"></a><span id="l27.124">       throw Ci.nsIMsgCloudFileProvider.offlineErr;</span>
<a href="#l27.125"></a><span id="l27.125"> </span>
<a href="#l27.126"></a><span id="l27.126">     this.log.info(&quot;uploading &quot; + aFile.leafName);</span>
<a href="#l27.127"></a><span id="l27.127"> </span>
<a href="#l27.128"></a><span id="l27.128">     // Some ugliness here - we stash requestObserver here, because we might</span>
<a href="#l27.129"></a><span id="l27.129">     // use it again in _getUserInfo.</span>
<a href="#l27.130"></a><span id="l27.130">     this.requestObserver = aCallback;</span>
<a href="#l27.131"></a><span id="l27.131" class="difflineat">@@ -238,17 +237,17 @@ nsBox.prototype = {</span>
<a href="#l27.132"></a><span id="l27.132">    * A private function called when we're almost ready to kick off the upload</span>
<a href="#l27.133"></a><span id="l27.133">    * for a file. First, ensures that the file size is not too large, and that</span>
<a href="#l27.134"></a><span id="l27.134">    * we won't exceed our storage quota, and then kicks off the upload.</span>
<a href="#l27.135"></a><span id="l27.135">    *</span>
<a href="#l27.136"></a><span id="l27.136">    * @param aFile the nsIFile to upload</span>
<a href="#l27.137"></a><span id="l27.137">    * @param aCallback the nsIRequestObserver for monitoring the start and stop</span>
<a href="#l27.138"></a><span id="l27.138">    *                  states of the upload procedure.</span>
<a href="#l27.139"></a><span id="l27.139">    */</span>
<a href="#l27.140"></a><span id="l27.140" class="difflineminus">-  _finishUpload: function nsBox__finishUpload(aFile, aCallback) {</span>
<a href="#l27.141"></a><span id="l27.141" class="difflineplus">+  _finishUpload(aFile, aCallback) {</span>
<a href="#l27.142"></a><span id="l27.142">     let exceedsFileLimit = Ci.nsIMsgCloudFileProvider.uploadExceedsFileLimit;</span>
<a href="#l27.143"></a><span id="l27.143">     let exceedsQuota = Ci.nsIMsgCloudFileProvider.uploadWouldExceedQuota;</span>
<a href="#l27.144"></a><span id="l27.144">     if (aFile.fileSize &gt; this._maxFileSize) {</span>
<a href="#l27.145"></a><span id="l27.145">       aCallback.onStopRequest(null, null, exceedsFileLimit);</span>
<a href="#l27.146"></a><span id="l27.146">       return;</span>
<a href="#l27.147"></a><span id="l27.147">     }</span>
<a href="#l27.148"></a><span id="l27.148">     if (aFile.fileSize &gt; this.remainingFileSpace) {</span>
<a href="#l27.149"></a><span id="l27.149">       aCallback.onStopRequest(null, null, exceedsQuota);</span>
<a href="#l27.150"></a><span id="l27.150" class="difflineat">@@ -269,17 +268,17 @@ nsBox.prototype = {</span>
<a href="#l27.151"></a><span id="l27.151">     this._uploader.uploadFile();</span>
<a href="#l27.152"></a><span id="l27.152">   },</span>
<a href="#l27.153"></a><span id="l27.153"> </span>
<a href="#l27.154"></a><span id="l27.154">   /**</span>
<a href="#l27.155"></a><span id="l27.155">    * Cancels an in-progress file upload.</span>
<a href="#l27.156"></a><span id="l27.156">    *</span>
<a href="#l27.157"></a><span id="l27.157">    * @param aFile the nsIFile being uploaded.</span>
<a href="#l27.158"></a><span id="l27.158">    */</span>
<a href="#l27.159"></a><span id="l27.159" class="difflineminus">-  cancelFileUpload: function nsBox_cancelFileUpload(aFile) {</span>
<a href="#l27.160"></a><span id="l27.160" class="difflineplus">+  cancelFileUpload(aFile) {</span>
<a href="#l27.161"></a><span id="l27.161">     if (this._uploadingFile.equals(aFile)) {</span>
<a href="#l27.162"></a><span id="l27.162">       this._uploader.cancel();</span>
<a href="#l27.163"></a><span id="l27.163">     } else {</span>
<a href="#l27.164"></a><span id="l27.164">       for (let i = 0; i &lt; this._uploads.length; i++)</span>
<a href="#l27.165"></a><span id="l27.165">         if (this._uploads[i].file.equals(aFile)) {</span>
<a href="#l27.166"></a><span id="l27.166">           this._uploads[i].requestObserver.onStopRequest(</span>
<a href="#l27.167"></a><span id="l27.167">             null, null, Ci.nsIMsgCloudFileProvider.uploadCanceled);</span>
<a href="#l27.168"></a><span id="l27.168">           this._uploads.splice(i, 1);</span>
<a href="#l27.169"></a><span id="l27.169" class="difflineat">@@ -291,17 +290,17 @@ nsBox.prototype = {</span>
<a href="#l27.170"></a><span id="l27.170">   /**</span>
<a href="#l27.171"></a><span id="l27.171">    * A private function for retrieving profile information about a user.</span>
<a href="#l27.172"></a><span id="l27.172">    *</span>
<a href="#l27.173"></a><span id="l27.173">    * @param successCallback a callback fired if retrieving profile information</span>
<a href="#l27.174"></a><span id="l27.174">    *                        is successful.</span>
<a href="#l27.175"></a><span id="l27.175">    * @param failureCallback a callback fired if retrieving profile information</span>
<a href="#l27.176"></a><span id="l27.176">    *                        fails.</span>
<a href="#l27.177"></a><span id="l27.177">    */</span>
<a href="#l27.178"></a><span id="l27.178" class="difflineminus">-  _getUserInfo: function nsBox__getUserInfo(successCallback, failureCallback) {</span>
<a href="#l27.179"></a><span id="l27.179" class="difflineplus">+  _getUserInfo(successCallback, failureCallback) {</span>
<a href="#l27.180"></a><span id="l27.180">     let requestUrl = gServerUrl + &quot;users/me&quot;;</span>
<a href="#l27.181"></a><span id="l27.181">     this.log.info(&quot;get_account_info requestUrl = &quot; + requestUrl);</span>
<a href="#l27.182"></a><span id="l27.182"> </span>
<a href="#l27.183"></a><span id="l27.183">     if (!successCallback)</span>
<a href="#l27.184"></a><span id="l27.184">       successCallback = function() {</span>
<a href="#l27.185"></a><span id="l27.185">         this.requestObserver</span>
<a href="#l27.186"></a><span id="l27.186">             .onStopRequest(null, null,</span>
<a href="#l27.187"></a><span id="l27.187">                            this._loggedIn ? Cr.NS_OK : Ci.nsIMsgCloudFileProvider.authErr);</span>
<a href="#l27.188"></a><span id="l27.188" class="difflineat">@@ -360,82 +359,76 @@ nsBox.prototype = {</span>
<a href="#l27.189"></a><span id="l27.189">    * retrieves the user's profile information.</span>
<a href="#l27.190"></a><span id="l27.190">    *</span>
<a href="#l27.191"></a><span id="l27.191">    * @param aSuccessCallback the function called on successful information</span>
<a href="#l27.192"></a><span id="l27.192">    *                         retrieval</span>
<a href="#l27.193"></a><span id="l27.193">    * @param aFailureCallback the function called on failed information retrieval</span>
<a href="#l27.194"></a><span id="l27.194">    * @param aWithUI a boolean for whether or not we should display authorization</span>
<a href="#l27.195"></a><span id="l27.195">    *                UI if we don't have a valid token anymore, or just fail out.</span>
<a href="#l27.196"></a><span id="l27.196">    */</span>
<a href="#l27.197"></a><span id="l27.197" class="difflineminus">-  _logonAndGetUserInfo: function nsBox_logonAndGetUserInfo(aSuccessCallback,</span>
<a href="#l27.198"></a><span id="l27.198" class="difflineminus">-                                                               aFailureCallback,</span>
<a href="#l27.199"></a><span id="l27.199" class="difflineminus">-                                                               aWithUI) {</span>
<a href="#l27.200"></a><span id="l27.200" class="difflineplus">+  _logonAndGetUserInfo(aSuccessCallback, aFailureCallback, aWithUI) {</span>
<a href="#l27.201"></a><span id="l27.201">     if (!aFailureCallback)</span>
<a href="#l27.202"></a><span id="l27.202">       aFailureCallback = function() {</span>
<a href="#l27.203"></a><span id="l27.203">         this.requestObserver</span>
<a href="#l27.204"></a><span id="l27.204">             .onStopRequest(null, null, Ci.nsIMsgCloudFileProvider.authErr);</span>
<a href="#l27.205"></a><span id="l27.205">       }.bind(this);</span>
<a href="#l27.206"></a><span id="l27.206"> </span>
<a href="#l27.207"></a><span id="l27.207">     return this.logon(function() {</span>
<a href="#l27.208"></a><span id="l27.208">       this._getUserInfo(aSuccessCallback, aFailureCallback);</span>
<a href="#l27.209"></a><span id="l27.209">     }.bind(this), aFailureCallback, aWithUI);</span>
<a href="#l27.210"></a><span id="l27.210">   },</span>
<a href="#l27.211"></a><span id="l27.211"> </span>
<a href="#l27.212"></a><span id="l27.212">   /**</span>
<a href="#l27.213"></a><span id="l27.213">    * Returns the sharing URL for some uploaded file.</span>
<a href="#l27.214"></a><span id="l27.214">    *</span>
<a href="#l27.215"></a><span id="l27.215">    * @param aFile the nsIFile to get the URL for.</span>
<a href="#l27.216"></a><span id="l27.216">    */</span>
<a href="#l27.217"></a><span id="l27.217" class="difflineminus">-  urlForFile: function nsBox_urlForFile(aFile) {</span>
<a href="#l27.218"></a><span id="l27.218" class="difflineplus">+  urlForFile(aFile) {</span>
<a href="#l27.219"></a><span id="l27.219">     return this._urlsForFiles[aFile.path];</span>
<a href="#l27.220"></a><span id="l27.220">   },</span>
<a href="#l27.221"></a><span id="l27.221"> </span>
<a href="#l27.222"></a><span id="l27.222">   /**</span>
<a href="#l27.223"></a><span id="l27.223">    * Updates the profile information for the account associated with the</span>
<a href="#l27.224"></a><span id="l27.224">    * account key.</span>
<a href="#l27.225"></a><span id="l27.225">    *</span>
<a href="#l27.226"></a><span id="l27.226">    * @param aWithUI a boolean for whether or not we should display authorization</span>
<a href="#l27.227"></a><span id="l27.227">    *                UI if we don't have a valid token anymore, or just fail out.</span>
<a href="#l27.228"></a><span id="l27.228">    * @param aCallback an nsIRequestObserver for observing the starting and</span>
<a href="#l27.229"></a><span id="l27.229">    *                  ending states of the request.</span>
<a href="#l27.230"></a><span id="l27.230">    */</span>
<a href="#l27.231"></a><span id="l27.231" class="difflineminus">-  refreshUserInfo: function nsBox_refreshUserInfo(aWithUI, aCallback) {</span>
<a href="#l27.232"></a><span id="l27.232" class="difflineplus">+  refreshUserInfo(aWithUI, aCallback) {</span>
<a href="#l27.233"></a><span id="l27.233">     this.log.info(&quot;Getting User Info 1 : &quot; + this._loggedIn);</span>
<a href="#l27.234"></a><span id="l27.234">     if (Services.io.offline)</span>
<a href="#l27.235"></a><span id="l27.235">       throw Ci.nsIMsgCloudFileProvider.offlineErr;</span>
<a href="#l27.236"></a><span id="l27.236">     this.requestObserver = aCallback;</span>
<a href="#l27.237"></a><span id="l27.237">     aCallback.onStartRequest(null, null);</span>
<a href="#l27.238"></a><span id="l27.238">     if (!this._loggedIn)</span>
<a href="#l27.239"></a><span id="l27.239">       return this._logonAndGetUserInfo(null, null, aWithUI);</span>
<a href="#l27.240"></a><span id="l27.240">     if (!this._userInfo)</span>
<a href="#l27.241"></a><span id="l27.241">       return this._getUserInfo();</span>
<a href="#l27.242"></a><span id="l27.242">     return this._userInfo;</span>
<a href="#l27.243"></a><span id="l27.243">   },</span>
<a href="#l27.244"></a><span id="l27.244"> </span>
<a href="#l27.245"></a><span id="l27.245">   /**</span>
<a href="#l27.246"></a><span id="l27.246">    * Our Box implementation does not implement the createNewAccount</span>
<a href="#l27.247"></a><span id="l27.247">    * function defined in nsIMsgCloudFileProvider.idl.</span>
<a href="#l27.248"></a><span id="l27.248">    */</span>
<a href="#l27.249"></a><span id="l27.249" class="difflineminus">-  createNewAccount: function nsBox_createNewAccount(aEmailAddress,</span>
<a href="#l27.250"></a><span id="l27.250" class="difflineminus">-                                                          aPassword, aFirstName,</span>
<a href="#l27.251"></a><span id="l27.251" class="difflineminus">-                                                          aLastName) {</span>
<a href="#l27.252"></a><span id="l27.252" class="difflineplus">+  createNewAccount(aEmailAddress, aPassword, aFirstName, aLastName) {</span>
<a href="#l27.253"></a><span id="l27.253">     return Cr.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l27.254"></a><span id="l27.254">   },</span>
<a href="#l27.255"></a><span id="l27.255"> </span>
<a href="#l27.256"></a><span id="l27.256">   /**</span>
<a href="#l27.257"></a><span id="l27.257">    * Private function to get the ID of an already existing folder on the Box</span>
<a href="#l27.258"></a><span id="l27.258">    * website.</span>
<a href="#l27.259"></a><span id="l27.259">    *</span>
<a href="#l27.260"></a><span id="l27.260">    * @param aName name of folder</span>
<a href="#l27.261"></a><span id="l27.261">    * @param aSuccessCallback called if the folder exists</span>
<a href="#l27.262"></a><span id="l27.262">    * @param aFailureCallback called if the folder cannot be found</span>
<a href="#l27.263"></a><span id="l27.263">    */</span>
<a href="#l27.264"></a><span id="l27.264" class="difflineminus">-  _getFolder: function nsBox__getFolder(aName,</span>
<a href="#l27.265"></a><span id="l27.265" class="difflineminus">-                                        aSuccessCallback,</span>
<a href="#l27.266"></a><span id="l27.266" class="difflineminus">-                                        aFailureCallback) {</span>
<a href="#l27.267"></a><span id="l27.267" class="difflineplus">+  _getFolder(aName, aSuccessCallback, aFailureCallback) {</span>
<a href="#l27.268"></a><span id="l27.268">     this.log.info(&quot;Getting folder: &quot; + aName);</span>
<a href="#l27.269"></a><span id="l27.269">     if (Services.io.offline)</span>
<a href="#l27.270"></a><span id="l27.270">       throw Ci.nsIMsgCloudFileProvider.offlineErr;</span>
<a href="#l27.271"></a><span id="l27.271"> </span>
<a href="#l27.272"></a><span id="l27.272">     // There's no API to search by name and we don't know the ID. Get the root</span>
<a href="#l27.273"></a><span id="l27.273">     // folder and search for this name inside of it.</span>
<a href="#l27.274"></a><span id="l27.274">     const ROOT_ID = &quot;0&quot;;</span>
<a href="#l27.275"></a><span id="l27.275">     let requestUrl = gServerUrl + &quot;folders/&quot; + ROOT_ID;</span>
<a href="#l27.276"></a><span id="l27.276" class="difflineat">@@ -490,18 +483,17 @@ nsBox.prototype = {</span>
<a href="#l27.277"></a><span id="l27.277">   },</span>
<a href="#l27.278"></a><span id="l27.278"> </span>
<a href="#l27.279"></a><span id="l27.279">   /**</span>
<a href="#l27.280"></a><span id="l27.280">    * Private function for creating folder on the Box website.</span>
<a href="#l27.281"></a><span id="l27.281">    *</span>
<a href="#l27.282"></a><span id="l27.282">    * @param aName name of folder</span>
<a href="#l27.283"></a><span id="l27.283">    * @param aSuccessCallback called when folder is created</span>
<a href="#l27.284"></a><span id="l27.284">    */</span>
<a href="#l27.285"></a><span id="l27.285" class="difflineminus">-  _createFolder: function nsBox__createFolder(aName,</span>
<a href="#l27.286"></a><span id="l27.286" class="difflineminus">-                                              aSuccessCallback) {</span>
<a href="#l27.287"></a><span id="l27.287" class="difflineplus">+  _createFolder(aName, aSuccessCallback) {</span>
<a href="#l27.288"></a><span id="l27.288">     this.log.info(&quot;Creating folder: &quot; + aName);</span>
<a href="#l27.289"></a><span id="l27.289">     if (Services.io.offline)</span>
<a href="#l27.290"></a><span id="l27.290">       throw Ci.nsIMsgCloudFileProvider.offlineErr;</span>
<a href="#l27.291"></a><span id="l27.291"> </span>
<a href="#l27.292"></a><span id="l27.292">     let body = {</span>
<a href="#l27.293"></a><span id="l27.293">       parent: {</span>
<a href="#l27.294"></a><span id="l27.294">         id: &quot;0&quot;,</span>
<a href="#l27.295"></a><span id="l27.295">       },</span>
<a href="#l27.296"></a><span id="l27.296" class="difflineat">@@ -544,17 +536,17 @@ nsBox.prototype = {</span>
<a href="#l27.297"></a><span id="l27.297"> </span>
<a href="#l27.298"></a><span id="l27.298">   /**</span>
<a href="#l27.299"></a><span id="l27.299">    * If a the user associated with this account key already has an account,</span>
<a href="#l27.300"></a><span id="l27.300">    * allows them to log in.</span>
<a href="#l27.301"></a><span id="l27.301">    *</span>
<a href="#l27.302"></a><span id="l27.302">    * @param aRequestObserver an nsIRequestObserver for monitoring the start and</span>
<a href="#l27.303"></a><span id="l27.303">    *                         stop states of the login procedure.</span>
<a href="#l27.304"></a><span id="l27.304">    */</span>
<a href="#l27.305"></a><span id="l27.305" class="difflineminus">-  createExistingAccount: function nsBox_createExistingAccount(aRequestObserver) {</span>
<a href="#l27.306"></a><span id="l27.306" class="difflineplus">+  createExistingAccount(aRequestObserver) {</span>
<a href="#l27.307"></a><span id="l27.307">      // XXX: replace this with a better function</span>
<a href="#l27.308"></a><span id="l27.308">     let successCb = () =&gt; {</span>
<a href="#l27.309"></a><span id="l27.309">       aRequestObserver.onStopRequest(null, this, Cr.NS_OK);</span>
<a href="#l27.310"></a><span id="l27.310">     };</span>
<a href="#l27.311"></a><span id="l27.311"> </span>
<a href="#l27.312"></a><span id="l27.312">     let failureCb = (aResponseText) =&gt; {</span>
<a href="#l27.313"></a><span id="l27.313">       aRequestObserver.onStopRequest(null, this,</span>
<a href="#l27.314"></a><span id="l27.314">                                      Ci.nsIMsgCloudFileProvider.authErr);</span>
<a href="#l27.315"></a><span id="l27.315" class="difflineat">@@ -564,17 +556,17 @@ nsBox.prototype = {</span>
<a href="#l27.316"></a><span id="l27.316">   },</span>
<a href="#l27.317"></a><span id="l27.317"> </span>
<a href="#l27.318"></a><span id="l27.318">   /**</span>
<a href="#l27.319"></a><span id="l27.319">    * Returns an appropriate provider-specific URL for dealing with a particular</span>
<a href="#l27.320"></a><span id="l27.320">    * error type.</span>
<a href="#l27.321"></a><span id="l27.321">    *</span>
<a href="#l27.322"></a><span id="l27.322">    * @param aError an error to get the URL for.</span>
<a href="#l27.323"></a><span id="l27.323">    */</span>
<a href="#l27.324"></a><span id="l27.324" class="difflineminus">-  providerUrlForError: function nsBox_providerUrlForError(aError) {</span>
<a href="#l27.325"></a><span id="l27.325" class="difflineplus">+  providerUrlForError(aError) {</span>
<a href="#l27.326"></a><span id="l27.326">     if (aError == Ci.nsIMsgCloudFileProvider.uploadWouldExceedQuota)</span>
<a href="#l27.327"></a><span id="l27.327">       return &quot;https://www.box.com/pricing/&quot;;</span>
<a href="#l27.328"></a><span id="l27.328">     return &quot;&quot;;</span>
<a href="#l27.329"></a><span id="l27.329">   },</span>
<a href="#l27.330"></a><span id="l27.330"> </span>
<a href="#l27.331"></a><span id="l27.331">   /**</span>
<a href="#l27.332"></a><span id="l27.332">    * If the provider doesn't have an API for creating an account, perhaps</span>
<a href="#l27.333"></a><span id="l27.333">    * there's a url we can load in a content tab that will allow the user</span>
<a href="#l27.334"></a><span id="l27.334" class="difflineat">@@ -591,17 +583,17 @@ nsBox.prototype = {</span>
<a href="#l27.335"></a><span id="l27.335"> </span>
<a href="#l27.336"></a><span id="l27.336">   /**</span>
<a href="#l27.337"></a><span id="l27.337">    * Attempts to delete an uploaded file.</span>
<a href="#l27.338"></a><span id="l27.338">    *</span>
<a href="#l27.339"></a><span id="l27.339">    * @param aFile the nsIFile to delete.</span>
<a href="#l27.340"></a><span id="l27.340">    * @param aCallback an nsIRequestObserver for monitoring the start and stop</span>
<a href="#l27.341"></a><span id="l27.341">    *                  states of the delete procedure.</span>
<a href="#l27.342"></a><span id="l27.342">    */</span>
<a href="#l27.343"></a><span id="l27.343" class="difflineminus">-  deleteFile: function nsBox_deleteFile(aFile, aCallback) {</span>
<a href="#l27.344"></a><span id="l27.344" class="difflineplus">+  deleteFile(aFile, aCallback) {</span>
<a href="#l27.345"></a><span id="l27.345">     this.log.info(&quot;Deleting a file&quot;);</span>
<a href="#l27.346"></a><span id="l27.346"> </span>
<a href="#l27.347"></a><span id="l27.347">     if (Services.io.offline) {</span>
<a href="#l27.348"></a><span id="l27.348">       this.log.error(&quot;We're offline - we can't delete the file.&quot;);</span>
<a href="#l27.349"></a><span id="l27.349">       throw Ci.nsIMsgCloudFileProvider.offlineErr;</span>
<a href="#l27.350"></a><span id="l27.350">     }</span>
<a href="#l27.351"></a><span id="l27.351"> </span>
<a href="#l27.352"></a><span id="l27.352">     let uploadInfo = this._uploadInfo[aFile.path];</span>
<a href="#l27.353"></a><span id="l27.353" class="difflineat">@@ -637,17 +629,17 @@ nsBox.prototype = {</span>
<a href="#l27.354"></a><span id="l27.354">   /**</span>
<a href="#l27.355"></a><span id="l27.355">    * Attempt to log on and get the auth token for this Box account.</span>
<a href="#l27.356"></a><span id="l27.356">    *</span>
<a href="#l27.357"></a><span id="l27.357">    * @param successCallback the callback to be fired if logging on is successful</span>
<a href="#l27.358"></a><span id="l27.358">    * @param failureCallback the callback to be fired if loggong on fails</span>
<a href="#l27.359"></a><span id="l27.359">    * @aparam aWithUI a boolean for whether or not we should prompt for a password</span>
<a href="#l27.360"></a><span id="l27.360">    *                 if no auth token is currently stored.</span>
<a href="#l27.361"></a><span id="l27.361">    */</span>
<a href="#l27.362"></a><span id="l27.362" class="difflineminus">-  logon: function nsBox_logon(successCallback, failureCallback, aWithUI) {</span>
<a href="#l27.363"></a><span id="l27.363" class="difflineplus">+  logon(successCallback, failureCallback, aWithUI) {</span>
<a href="#l27.364"></a><span id="l27.364">     // The token has expired, reauthenticate.</span>
<a href="#l27.365"></a><span id="l27.365">     if (this._oauth.tokenExpires &lt; (new Date()).getTime()) {</span>
<a href="#l27.366"></a><span id="l27.366">       this._oauth.connect(successCallback, failureCallback, aWithUI);</span>
<a href="#l27.367"></a><span id="l27.367">     } else {</span>
<a href="#l27.368"></a><span id="l27.368">       // The token is still valid, success!</span>
<a href="#l27.369"></a><span id="l27.369">       successCallback();</span>
<a href="#l27.370"></a><span id="l27.370">     }</span>
<a href="#l27.371"></a><span id="l27.371">   },</span>
<a href="#l27.372"></a><span id="l27.372" class="difflineat">@@ -678,17 +670,17 @@ nsBoxFileUploader.prototype = {</span>
<a href="#l27.373"></a><span id="l27.373">   box: null,</span>
<a href="#l27.374"></a><span id="l27.374">   file: null,</span>
<a href="#l27.375"></a><span id="l27.375">   callback: null,</span>
<a href="#l27.376"></a><span id="l27.376">   request: null,</span>
<a href="#l27.377"></a><span id="l27.377"> </span>
<a href="#l27.378"></a><span id="l27.378">   /**</span>
<a href="#l27.379"></a><span id="l27.379">    * Do the upload of the file to Box.</span>
<a href="#l27.380"></a><span id="l27.380">    */</span>
<a href="#l27.381"></a><span id="l27.381" class="difflineminus">-  uploadFile: function nsBox_uploadFile() {</span>
<a href="#l27.382"></a><span id="l27.382" class="difflineplus">+  uploadFile() {</span>
<a href="#l27.383"></a><span id="l27.383">     this.requestObserver.onStartRequest(null, null);</span>
<a href="#l27.384"></a><span id="l27.384">     let requestUrl = gUploadUrl + &quot;files/content&quot;;</span>
<a href="#l27.385"></a><span id="l27.385">     this.box._uploadInfo[this.file.path] = {};</span>
<a href="#l27.386"></a><span id="l27.386">     this.box._uploadInfo[this.file.path].uploadUrl = requestUrl;</span>
<a href="#l27.387"></a><span id="l27.387"> </span>
<a href="#l27.388"></a><span id="l27.388">     let req = new XMLHttpRequest();</span>
<a href="#l27.389"></a><span id="l27.389"> </span>
<a href="#l27.390"></a><span id="l27.390">     this.log.info(&quot;upload url = &quot; + requestUrl);</span>
<a href="#l27.391"></a><span id="l27.391" class="difflineat">@@ -773,17 +765,17 @@ nsBoxFileUploader.prototype = {</span>
<a href="#l27.392"></a><span id="l27.392"> </span>
<a href="#l27.393"></a><span id="l27.393">       req.send(form);</span>
<a href="#l27.394"></a><span id="l27.394">     });</span>
<a href="#l27.395"></a><span id="l27.395">   },</span>
<a href="#l27.396"></a><span id="l27.396"> </span>
<a href="#l27.397"></a><span id="l27.397">   /**</span>
<a href="#l27.398"></a><span id="l27.398">    * Cancels the upload request for the file associated with this Uploader.</span>
<a href="#l27.399"></a><span id="l27.399">    */</span>
<a href="#l27.400"></a><span id="l27.400" class="difflineminus">-  cancel: function nsBox_cancel() {</span>
<a href="#l27.401"></a><span id="l27.401" class="difflineplus">+  cancel() {</span>
<a href="#l27.402"></a><span id="l27.402">     this.log.info(&quot;in uploader cancel&quot;);</span>
<a href="#l27.403"></a><span id="l27.403">     this.callback(this.requestObserver, Ci.nsIMsgCloudFileProvider.uploadCanceled);</span>
<a href="#l27.404"></a><span id="l27.404">     delete this.callback;</span>
<a href="#l27.405"></a><span id="l27.405">     if (this.request) {</span>
<a href="#l27.406"></a><span id="l27.406">       this.log.info(&quot;cancelling upload request&quot;);</span>
<a href="#l27.407"></a><span id="l27.407">       let req = this.request;</span>
<a href="#l27.408"></a><span id="l27.408">       if (req.channel) {</span>
<a href="#l27.409"></a><span id="l27.409">         this.log.info(&quot;cancelling upload channel&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/components/cloudfile/nsHightail.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/components/cloudfile/nsHightail.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1154,19 +1154,19 @@ nsHightailFileUploader.prototype = {</span>
<a href="#l28.4"></a><span id="l28.4">       aFailureCallback();</span>
<a href="#l28.5"></a><span id="l28.5">     }.bind(this);</span>
<a href="#l28.6"></a><span id="l28.6"> </span>
<a href="#l28.7"></a><span id="l28.7">     req.onload = function() {</span>
<a href="#l28.8"></a><span id="l28.8">       let response = req.responseText;</span>
<a href="#l28.9"></a><span id="l28.9">       this.log.info(&quot;findDownloadUrl response = &quot; + response);</span>
<a href="#l28.10"></a><span id="l28.10">       let fileInfo = JSON.parse(response);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-      if (fileInfo.errorStatus)</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+      if (fileInfo.errorStatus) {</span>
<a href="#l28.14"></a><span id="l28.14">         aFailureCallback();</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">-      else {</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+      } else {</span>
<a href="#l28.17"></a><span id="l28.17">         // We need a kludge here because Hightail is returning URLs without the scheme...</span>
<a href="#l28.18"></a><span id="l28.18">         let url = this._ensureScheme(fileInfo.clickableDownloadUrl);</span>
<a href="#l28.19"></a><span id="l28.19">         this.hightail._urlsForFiles[this.file.path] = url;</span>
<a href="#l28.20"></a><span id="l28.20">         aSuccessCallback();</span>
<a href="#l28.21"></a><span id="l28.21">       }</span>
<a href="#l28.22"></a><span id="l28.22">     }.bind(this);</span>
<a href="#l28.23"></a><span id="l28.23"> </span>
<a href="#l28.24"></a><span id="l28.24">     req.setRequestHeader(&quot;X-Auth-Token&quot;, this.hightail._cachedAuthToken + &quot; &quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -1497,25 +1497,24 @@ function uploadListener(aAttachment, aFi</span>
<a href="#l29.4"></a><span id="l29.4">         cloudFileAccounts.getDisplayName(this.cloudProvider),</span>
<a href="#l29.5"></a><span id="l29.5">       ]));</span>
<a href="#l29.6"></a><span id="l29.6">     item.uploading = true;</span>
<a href="#l29.7"></a><span id="l29.7">     item.cloudProvider = this.cloudProvider;</span>
<a href="#l29.8"></a><span id="l29.8">   }</span>
<a href="#l29.9"></a><span id="l29.9"> }</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11"> uploadListener.prototype = {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  onStartRequest: function uploadListener_onStartRequest(aRequest, aContext) {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+  onStartRequest(aRequest, aContext) {</span>
<a href="#l29.14"></a><span id="l29.14">     let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l29.15"></a><span id="l29.15">     let item = bucket.findItemForAttachment(this.attachment);</span>
<a href="#l29.16"></a><span id="l29.16">     if (item)</span>
<a href="#l29.17"></a><span id="l29.17">       item.image = &quot;chrome://global/skin/icons/loading.png&quot;;</span>
<a href="#l29.18"></a><span id="l29.18">   },</span>
<a href="#l29.19"></a><span id="l29.19"> </span>
<a href="#l29.20"></a><span id="l29.20" class="difflineminus">-  onStopRequest: function uploadListener_onStopRequest(aRequest, aContext,</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineminus">-                                                       aStatusCode) {</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineplus">+  onStopRequest(aRequest, aContext, aStatusCode) {</span>
<a href="#l29.23"></a><span id="l29.23">     let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l29.24"></a><span id="l29.24">     let attachmentItem = bucket.findItemForAttachment(this.attachment);</span>
<a href="#l29.25"></a><span id="l29.25"> </span>
<a href="#l29.26"></a><span id="l29.26">     if (Components.isSuccessCode(aStatusCode)) {</span>
<a href="#l29.27"></a><span id="l29.27">       let originalUrl = this.attachment.url;</span>
<a href="#l29.28"></a><span id="l29.28">       this.attachment.contentLocation = this.cloudProvider.urlForFile(this.file);</span>
<a href="#l29.29"></a><span id="l29.29">       this.attachment.cloudProviderKey = this.cloudProvider.accountKey;</span>
<a href="#l29.30"></a><span id="l29.30">       if (attachmentItem) {</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineat">@@ -1525,19 +1524,19 @@ uploadListener.prototype = {</span>
<a href="#l29.32"></a><span id="l29.32">         attachmentItem.setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l29.33"></a><span id="l29.33">           getComposeBundle().getFormattedString(&quot;cloudFileUploadedTooltip&quot;, [</span>
<a href="#l29.34"></a><span id="l29.34">             cloudFileAccounts.getDisplayName(this.cloudProvider),</span>
<a href="#l29.35"></a><span id="l29.35">           ]));</span>
<a href="#l29.36"></a><span id="l29.36">         attachmentItem.uploading = false;</span>
<a href="#l29.37"></a><span id="l29.37"> </span>
<a href="#l29.38"></a><span id="l29.38">         // Set the icon for the attachment.</span>
<a href="#l29.39"></a><span id="l29.39">         let iconClass = this.cloudProvider.iconClass;</span>
<a href="#l29.40"></a><span id="l29.40" class="difflineminus">-        if (iconClass)</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineplus">+        if (iconClass) {</span>
<a href="#l29.42"></a><span id="l29.42">           attachmentItem.image = iconClass;</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineminus">-        else {</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineplus">+        } else {</span>
<a href="#l29.45"></a><span id="l29.45">           // Should we use a generic &quot;cloud&quot; icon here? Or an overlay icon?</span>
<a href="#l29.46"></a><span id="l29.46">           // I think the provider should provide an icon, end of story.</span>
<a href="#l29.47"></a><span id="l29.47">           attachmentItem.image = null;</span>
<a href="#l29.48"></a><span id="l29.48">         }</span>
<a href="#l29.49"></a><span id="l29.49">       }</span>
<a href="#l29.50"></a><span id="l29.50"> </span>
<a href="#l29.51"></a><span id="l29.51">       let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l29.52"></a><span id="l29.52">       event.initEvent(&quot;attachment-uploaded&quot;, true, true);</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineat">@@ -1626,21 +1625,20 @@ uploadListener.prototype = {</span>
<a href="#l29.54"></a><span id="l29.54"> };</span>
<a href="#l29.55"></a><span id="l29.55"> </span>
<a href="#l29.56"></a><span id="l29.56"> function deletionListener(aAttachment, aCloudProvider) {</span>
<a href="#l29.57"></a><span id="l29.57">   this.attachment = aAttachment;</span>
<a href="#l29.58"></a><span id="l29.58">   this.cloudProvider = aCloudProvider;</span>
<a href="#l29.59"></a><span id="l29.59"> }</span>
<a href="#l29.60"></a><span id="l29.60"> </span>
<a href="#l29.61"></a><span id="l29.61"> deletionListener.prototype = {</span>
<a href="#l29.62"></a><span id="l29.62" class="difflineminus">-  onStartRequest: function deletionListener_onStartRequest(aRequest, aContext) {</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineplus">+  onStartRequest(aRequest, aContext) {</span>
<a href="#l29.64"></a><span id="l29.64">   },</span>
<a href="#l29.65"></a><span id="l29.65"> </span>
<a href="#l29.66"></a><span id="l29.66" class="difflineminus">-  onStopRequest: function deletionListener_onStopRequest(aRequest, aContext,</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineminus">-                                                         aStatusCode) {</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineplus">+  onStopRequest(aRequest, aContext, aStatusCode) {</span>
<a href="#l29.69"></a><span id="l29.69">     if (!Components.isSuccessCode(aStatusCode)) {</span>
<a href="#l29.70"></a><span id="l29.70">       let displayName = cloudFileAccounts.getDisplayName(this.cloudProvider);</span>
<a href="#l29.71"></a><span id="l29.71">       Services.prompt.alert(window,</span>
<a href="#l29.72"></a><span id="l29.72">         getComposeBundle().getString(&quot;errorCloudFileDeletion.title&quot;),</span>
<a href="#l29.73"></a><span id="l29.73">         getComposeBundle().getFormattedString(&quot;errorCloudFileDeletion.message&quot;,</span>
<a href="#l29.74"></a><span id="l29.74">                                               [displayName,</span>
<a href="#l29.75"></a><span id="l29.75">                                                this.attachment.name]));</span>
<a href="#l29.76"></a><span id="l29.76">     }</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineat">@@ -1967,17 +1965,17 @@ function GetArgs(originalData) {</span>
<a href="#l29.78"></a><span id="l29.78">   var separator = String.fromCharCode(1);</span>
<a href="#l29.79"></a><span id="l29.79"> </span>
<a href="#l29.80"></a><span id="l29.80">   var quoteChar = &quot;&quot;;</span>
<a href="#l29.81"></a><span id="l29.81">   var prevChar = &quot;&quot;;</span>
<a href="#l29.82"></a><span id="l29.82">   var nextChar = &quot;&quot;;</span>
<a href="#l29.83"></a><span id="l29.83">   for (let i = 0; i &lt; originalData.length; i++, prevChar = aChar) {</span>
<a href="#l29.84"></a><span id="l29.84">     var aChar = originalData.charAt(i);</span>
<a href="#l29.85"></a><span id="l29.85">     var aCharCode = originalData.charCodeAt(i);</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineminus">-    if ( i &lt; originalData.length - 1)</span>
<a href="#l29.87"></a><span id="l29.87" class="difflineplus">+    if (i &lt; originalData.length - 1)</span>
<a href="#l29.88"></a><span id="l29.88">       nextChar = originalData.charAt(i + 1);</span>
<a href="#l29.89"></a><span id="l29.89">     else</span>
<a href="#l29.90"></a><span id="l29.90">       nextChar = &quot;&quot;;</span>
<a href="#l29.91"></a><span id="l29.91"> </span>
<a href="#l29.92"></a><span id="l29.92">     if (aChar == quoteChar &amp;&amp; (nextChar == &quot;,&quot; || nextChar == &quot;&quot;)) {</span>
<a href="#l29.93"></a><span id="l29.93">       quoteChar = &quot;&quot;;</span>
<a href="#l29.94"></a><span id="l29.94">       data += aChar;</span>
<a href="#l29.95"></a><span id="l29.95">     } else if ((aCharCode == 39 || aCharCode == 34) &amp;&amp; prevChar == &quot;=&quot;) { // quote or double quote</span>
<a href="#l29.96"></a><span id="l29.96" class="difflineat">@@ -2498,19 +2496,19 @@ function ComposeStartup(aParams) {</span>
<a href="#l29.97"></a><span id="l29.97">     lastButton.parentNode.insertBefore(replaceButton, lastButton.nextSibling);</span>
<a href="#l29.98"></a><span id="l29.98">     lastButton.parentNode.insertBefore(tSeparator, lastButton.nextSibling);</span>
<a href="#l29.99"></a><span id="l29.99">   }</span>
<a href="#l29.100"></a><span id="l29.100"> </span>
<a href="#l29.101"></a><span id="l29.101">   var params = null; // New way to pass parameters to the compose window as a nsIMsgComposeParameters object</span>
<a href="#l29.102"></a><span id="l29.102">   var args = null;   // old way, parameters are passed as a string</span>
<a href="#l29.103"></a><span id="l29.103">   gBodyFromArgs = false;</span>
<a href="#l29.104"></a><span id="l29.104"> </span>
<a href="#l29.105"></a><span id="l29.105" class="difflineminus">-  if (aParams)</span>
<a href="#l29.106"></a><span id="l29.106" class="difflineplus">+  if (aParams) {</span>
<a href="#l29.107"></a><span id="l29.107">     params = aParams;</span>
<a href="#l29.108"></a><span id="l29.108" class="difflineminus">-  else if (window.arguments &amp;&amp; window.arguments[0]) {</span>
<a href="#l29.109"></a><span id="l29.109" class="difflineplus">+  } else if (window.arguments &amp;&amp; window.arguments[0]) {</span>
<a href="#l29.110"></a><span id="l29.110">     try {</span>
<a href="#l29.111"></a><span id="l29.111">       if (window.arguments[0] instanceof Ci.nsIMsgComposeParams)</span>
<a href="#l29.112"></a><span id="l29.112">         params = window.arguments[0];</span>
<a href="#l29.113"></a><span id="l29.113">       else</span>
<a href="#l29.114"></a><span id="l29.114">         params = handleMailtoArgs(window.arguments[0]);</span>
<a href="#l29.115"></a><span id="l29.115">     } catch (ex) {</span>
<a href="#l29.116"></a><span id="l29.116">       dump(&quot;ERROR with parameters: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l29.117"></a><span id="l29.117">     }</span>
<a href="#l29.118"></a><span id="l29.118" class="difflineat">@@ -6332,25 +6330,25 @@ function AutoSave() {</span>
<a href="#l29.119"></a><span id="l29.119"> /**</span>
<a href="#l29.120"></a><span id="l29.120">  * Periodically check for keywords in the message.</span>
<a href="#l29.121"></a><span id="l29.121">  */</span>
<a href="#l29.122"></a><span id="l29.122"> var gAttachmentNotifier = {</span>
<a href="#l29.123"></a><span id="l29.123">   _obs: null,</span>
<a href="#l29.124"></a><span id="l29.124"> </span>
<a href="#l29.125"></a><span id="l29.125">   enabled: false,</span>
<a href="#l29.126"></a><span id="l29.126"> </span>
<a href="#l29.127"></a><span id="l29.127" class="difflineminus">-  init: function gAN_init(aDocument) {</span>
<a href="#l29.128"></a><span id="l29.128" class="difflineplus">+  init(aDocument) {</span>
<a href="#l29.129"></a><span id="l29.129">     if (this._obs)</span>
<a href="#l29.130"></a><span id="l29.130">       this.shutdown();</span>
<a href="#l29.131"></a><span id="l29.131"> </span>
<a href="#l29.132"></a><span id="l29.132">     this.enabled = Services.prefs.getBoolPref(&quot;mail.compose.attachment_reminder&quot;);</span>
<a href="#l29.133"></a><span id="l29.133">     if (!this.enabled)</span>
<a href="#l29.134"></a><span id="l29.134">       return;</span>
<a href="#l29.135"></a><span id="l29.135"> </span>
<a href="#l29.136"></a><span id="l29.136" class="difflineminus">-    this._obs = new MutationObserver(function gAN_handleMutations(aMutations) {</span>
<a href="#l29.137"></a><span id="l29.137" class="difflineplus">+    this._obs = new MutationObserver(function(aMutations) {</span>
<a href="#l29.138"></a><span id="l29.138">       gAttachmentNotifier.timer.cancel();</span>
<a href="#l29.139"></a><span id="l29.139">       gAttachmentNotifier.timer.initWithCallback(gAttachmentNotifier.event, 500,</span>
<a href="#l29.140"></a><span id="l29.140">                                                  Ci.nsITimer.TYPE_ONE_SHOT);</span>
<a href="#l29.141"></a><span id="l29.141">     });</span>
<a href="#l29.142"></a><span id="l29.142"> </span>
<a href="#l29.143"></a><span id="l29.143">     this._obs.observe(aDocument, {</span>
<a href="#l29.144"></a><span id="l29.144">       attributes: true,</span>
<a href="#l29.145"></a><span id="l29.145">       childList: true,</span>
<a href="#l29.146"></a><span id="l29.146" class="difflineat">@@ -6365,17 +6363,17 @@ var gAttachmentNotifier = {</span>
<a href="#l29.147"></a><span id="l29.147"> </span>
<a href="#l29.148"></a><span id="l29.148">     // We could have been opened with a draft message already containing</span>
<a href="#l29.149"></a><span id="l29.149">     // some keywords, so run the checker once to pick them up.</span>
<a href="#l29.150"></a><span id="l29.150">     this.event.notify();</span>
<a href="#l29.151"></a><span id="l29.151">   },</span>
<a href="#l29.152"></a><span id="l29.152"> </span>
<a href="#l29.153"></a><span id="l29.153">   // Timer based function triggered by the inputEventListener</span>
<a href="#l29.154"></a><span id="l29.154">   // for the subject field.</span>
<a href="#l29.155"></a><span id="l29.155" class="difflineminus">-  subjectObserver: function handleEvent() {</span>
<a href="#l29.156"></a><span id="l29.156" class="difflineplus">+  subjectObserver() {</span>
<a href="#l29.157"></a><span id="l29.157">     gAttachmentNotifier.timer.cancel();</span>
<a href="#l29.158"></a><span id="l29.158">     gAttachmentNotifier.timer.initWithCallback(gAttachmentNotifier.event, 500,</span>
<a href="#l29.159"></a><span id="l29.159">                                                Ci.nsITimer.TYPE_ONE_SHOT);</span>
<a href="#l29.160"></a><span id="l29.160">   },</span>
<a href="#l29.161"></a><span id="l29.161"> </span>
<a href="#l29.162"></a><span id="l29.162">   /**</span>
<a href="#l29.163"></a><span id="l29.163">    * Checks for new keywords synchronously and run the usual handler.</span>
<a href="#l29.164"></a><span id="l29.164">    *</span>
<a href="#l29.165"></a><span id="l29.165" class="difflineat">@@ -6480,17 +6478,17 @@ var gAttachmentNotifier = {</span>
<a href="#l29.166"></a><span id="l29.166"> </span>
<a href="#l29.167"></a><span id="l29.167">     if (!async)</span>
<a href="#l29.168"></a><span id="l29.168">       return AttachmentChecker.getAttachmentKeywords(mailData, keywordsInCsv);</span>
<a href="#l29.169"></a><span id="l29.169"> </span>
<a href="#l29.170"></a><span id="l29.170">     attachmentWorker.postMessage([mailData, keywordsInCsv]);</span>
<a href="#l29.171"></a><span id="l29.171">     return null;</span>
<a href="#l29.172"></a><span id="l29.172">   },</span>
<a href="#l29.173"></a><span id="l29.173"> </span>
<a href="#l29.174"></a><span id="l29.174" class="difflineminus">-  shutdown: function gAN_shutdown() {</span>
<a href="#l29.175"></a><span id="l29.175" class="difflineplus">+  shutdown() {</span>
<a href="#l29.176"></a><span id="l29.176">     if (this._obs)</span>
<a href="#l29.177"></a><span id="l29.177">       this._obs.disconnect();</span>
<a href="#l29.178"></a><span id="l29.178">     gAttachmentNotifier.timer.cancel();</span>
<a href="#l29.179"></a><span id="l29.179"> </span>
<a href="#l29.180"></a><span id="l29.180">     this._obs = null;</span>
<a href="#l29.181"></a><span id="l29.181">   },</span>
<a href="#l29.182"></a><span id="l29.182"> </span>
<a href="#l29.183"></a><span id="l29.183">   event: {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mail/components/compose/content/cloudAttachmentLinkManager.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mail/components/compose/content/cloudAttachmentLinkManager.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -146,21 +146,21 @@ var gCloudAttachmentLinkManager = {</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5">     // Are we replying?</span>
<a href="#l30.6"></a><span id="l30.6">     let replyCitation = mailBody.querySelector(&quot;.moz-cite-prefix&quot;);</span>
<a href="#l30.7"></a><span id="l30.7">     if (replyCitation) {</span>
<a href="#l30.8"></a><span id="l30.8">       if (gCurrentIdentity &amp;&amp; gCurrentIdentity.replyOnTop == 0) {</span>
<a href="#l30.9"></a><span id="l30.9">         // Replying below quote - we'll select the point right before</span>
<a href="#l30.10"></a><span id="l30.10">         // the signature.  If there's no signature, we'll just use the</span>
<a href="#l30.11"></a><span id="l30.11">         // last node.</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-        if (signature &amp;&amp; signature.previousSibling)</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+        if (signature &amp;&amp; signature.previousSibling) {</span>
<a href="#l30.14"></a><span id="l30.14">           selection.collapse(mailBody,</span>
<a href="#l30.15"></a><span id="l30.15">                              Array.from(childNodes)</span>
<a href="#l30.16"></a><span id="l30.16">                                   .indexOf(signature.previousSibling));</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineminus">-        else {</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+        } else {</span>
<a href="#l30.19"></a><span id="l30.19">           selection.collapse(mailBody, childNodes.length - 1);</span>
<a href="#l30.20"></a><span id="l30.20">           editor.insertLineBreak();</span>
<a href="#l30.21"></a><span id="l30.21"> </span>
<a href="#l30.22"></a><span id="l30.22">           if (!gMsgCompose.composeHTML)</span>
<a href="#l30.23"></a><span id="l30.23">             editor.insertLineBreak();</span>
<a href="#l30.24"></a><span id="l30.24"> </span>
<a href="#l30.25"></a><span id="l30.25">           selection.collapse(mailBody, childNodes.length - 2);</span>
<a href="#l30.26"></a><span id="l30.26">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/components/extensions/test/xpcshell/.eslintrc.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/components/extensions/test/xpcshell/.eslintrc.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -3,9 +3,13 @@</span>
<a href="#l31.4"></a><span id="l31.4"> module.exports = {</span>
<a href="#l31.5"></a><span id="l31.5">   &quot;extends&quot;: &quot;plugin:mozilla/xpcshell-test&quot;,</span>
<a href="#l31.6"></a><span id="l31.6"> </span>
<a href="#l31.7"></a><span id="l31.7">   &quot;env&quot;: {</span>
<a href="#l31.8"></a><span id="l31.8">     // The tests in this folder are testing based on WebExtensions, so lets</span>
<a href="#l31.9"></a><span id="l31.9">     // just define the webextensions environment here.</span>
<a href="#l31.10"></a><span id="l31.10">     &quot;webextensions&quot;: true,</span>
<a href="#l31.11"></a><span id="l31.11">   },</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+  &quot;rules&quot;: {</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+    &quot;func-names&quot;: &quot;off&quot;,</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+  },</span>
<a href="#l31.16"></a><span id="l31.16"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/components/im/content/addbuddy.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/components/im/content/addbuddy.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -1,38 +1,38 @@</span>
<a href="#l32.4"></a><span id="l32.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l32.5"></a><span id="l32.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l32.6"></a><span id="l32.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8"> var { fixIterator } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;, null);</span>
<a href="#l32.9"></a><span id="l32.9"> var { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;, null);</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11"> var addBuddy = {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  onload: function ab_onload() {</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  onload() {</span>
<a href="#l32.14"></a><span id="l32.14">     let accountList = document.getElementById(&quot;accountlist&quot;);</span>
<a href="#l32.15"></a><span id="l32.15">     for (let acc of fixIterator(Services.accounts.getAccounts())) {</span>
<a href="#l32.16"></a><span id="l32.16">       if (!acc.connected)</span>
<a href="#l32.17"></a><span id="l32.17">         continue;</span>
<a href="#l32.18"></a><span id="l32.18">       let proto = acc.protocol;</span>
<a href="#l32.19"></a><span id="l32.19">       let item = accountList.appendItem(acc.name, acc.id, proto.name);</span>
<a href="#l32.20"></a><span id="l32.20">       item.setAttribute(&quot;image&quot;, proto.iconBaseURI + &quot;icon.png&quot;);</span>
<a href="#l32.21"></a><span id="l32.21">       item.setAttribute(&quot;class&quot;, &quot;menuitem-iconic&quot;);</span>
<a href="#l32.22"></a><span id="l32.22">     }</span>
<a href="#l32.23"></a><span id="l32.23">     if (!accountList.itemCount) {</span>
<a href="#l32.24"></a><span id="l32.24">       document.getElementById(&quot;addBuddyDialog&quot;).cancelDialog();</span>
<a href="#l32.25"></a><span id="l32.25">       throw &quot;No connected account!&quot;;</span>
<a href="#l32.26"></a><span id="l32.26">     }</span>
<a href="#l32.27"></a><span id="l32.27">     accountList.selectedIndex = 0;</span>
<a href="#l32.28"></a><span id="l32.28">   },</span>
<a href="#l32.29"></a><span id="l32.29"> </span>
<a href="#l32.30"></a><span id="l32.30" class="difflineminus">-  oninput: function ab_oninput() {</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineplus">+  oninput() {</span>
<a href="#l32.32"></a><span id="l32.32">     document.documentElement.getButton(&quot;accept&quot;).disabled =</span>
<a href="#l32.33"></a><span id="l32.33">       !addBuddy.getValue(&quot;name&quot;);</span>
<a href="#l32.34"></a><span id="l32.34">   },</span>
<a href="#l32.35"></a><span id="l32.35"> </span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-  getValue: function ab_getValue(aId) { return document.getElementById(aId).value; },</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineplus">+  getValue(aId) { return document.getElementById(aId).value; },</span>
<a href="#l32.38"></a><span id="l32.38"> </span>
<a href="#l32.39"></a><span id="l32.39" class="difflineminus">-  create: function ab_create() {</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineplus">+  create() {</span>
<a href="#l32.41"></a><span id="l32.41">     let account = Services.accounts.getAccountById(this.getValue(&quot;accountlist&quot;));</span>
<a href="#l32.42"></a><span id="l32.42">     let group = document.getElementById(&quot;chatBundle&quot;).getString(&quot;defaultGroup&quot;);</span>
<a href="#l32.43"></a><span id="l32.43">     account.addBuddy(Services.tags.createTag(group), this.getValue(&quot;name&quot;));</span>
<a href="#l32.44"></a><span id="l32.44">   },</span>
<a href="#l32.45"></a><span id="l32.45"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/components/im/content/am-im.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/components/im/content/am-im.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -9,17 +9,17 @@ ChromeUtils.import(&quot;resource://gre/modul</span>
<a href="#l33.4"></a><span id="l33.4"> </span>
<a href="#l33.5"></a><span id="l33.5"> var autoJoinPref = &quot;autoJoin&quot;;</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7"> function onPreInit(aAccount, aAccountValue) {</span>
<a href="#l33.8"></a><span id="l33.8">   account.init(aAccount.incomingServer.wrappedJSObject.imAccount);</span>
<a href="#l33.9"></a><span id="l33.9"> }</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11"> var account = {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  init: function account_init(aAccount) {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  init(aAccount) {</span>
<a href="#l33.14"></a><span id="l33.14">     this.account = aAccount;</span>
<a href="#l33.15"></a><span id="l33.15">     this.proto = this.account.protocol;</span>
<a href="#l33.16"></a><span id="l33.16">     document.getElementById(&quot;accountName&quot;).value = this.account.name;</span>
<a href="#l33.17"></a><span id="l33.17">     document.getElementById(&quot;protocolName&quot;).value = this.proto.name || this.proto.id;</span>
<a href="#l33.18"></a><span id="l33.18">     document.getElementById(&quot;protocolIcon&quot;).src =</span>
<a href="#l33.19"></a><span id="l33.19">       this.proto.iconBaseURI + &quot;icon48.png&quot;;</span>
<a href="#l33.20"></a><span id="l33.20"> </span>
<a href="#l33.21"></a><span id="l33.21">     let password = document.getElementById(&quot;server.password&quot;);</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -53,23 +53,23 @@ var account = {</span>
<a href="#l33.23"></a><span id="l33.23">     else</span>
<a href="#l33.24"></a><span id="l33.24">       autojoin.removeAttribute(&quot;wsm_persist&quot;);</span>
<a href="#l33.25"></a><span id="l33.25"> </span>
<a href="#l33.26"></a><span id="l33.26">     this.prefs = Services.prefs.getBranch(&quot;messenger.account.&quot; +</span>
<a href="#l33.27"></a><span id="l33.27">                                           this.account.id + &quot;.options.&quot;);</span>
<a href="#l33.28"></a><span id="l33.28">     this.populateProtoSpecificBox();</span>
<a href="#l33.29"></a><span id="l33.29">   },</span>
<a href="#l33.30"></a><span id="l33.30"> </span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-  getProtoOptions: function* account_getProtoOptions() {</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+  * getProtoOptions() {</span>
<a href="#l33.33"></a><span id="l33.33">     let options = this.proto.getOptions();</span>
<a href="#l33.34"></a><span id="l33.34">     while (options.hasMoreElements())</span>
<a href="#l33.35"></a><span id="l33.35">       yield options.getNext();</span>
<a href="#l33.36"></a><span id="l33.36">   },</span>
<a href="#l33.37"></a><span id="l33.37"> </span>
<a href="#l33.38"></a><span id="l33.38" class="difflineminus">-  populateProtoSpecificBox: function account_populate() {</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineplus">+  populateProtoSpecificBox() {</span>
<a href="#l33.40"></a><span id="l33.40">     let attributes = {};</span>
<a href="#l33.41"></a><span id="l33.41">     attributes[Ci.prplIPref.typeBool] = [</span>
<a href="#l33.42"></a><span id="l33.42">       {name: &quot;wsm_persist&quot;, value: &quot;true&quot;},</span>
<a href="#l33.43"></a><span id="l33.43">       {name: &quot;preftype&quot;, value: &quot;bool&quot;},</span>
<a href="#l33.44"></a><span id="l33.44">       {name: &quot;genericattr&quot;, value: &quot;true&quot;},</span>
<a href="#l33.45"></a><span id="l33.45">     ];</span>
<a href="#l33.46"></a><span id="l33.46">     attributes[Ci.prplIPref.typeInt] = [</span>
<a href="#l33.47"></a><span id="l33.47">       {name: &quot;wsm_persist&quot;, value: &quot;true&quot;},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/components/im/content/chat-messenger.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/components/im/content/chat-messenger.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -28,29 +28,29 @@ function buddyListContextMenu(aXulMenu) </span>
<a href="#l34.4"></a><span id="l34.4">     document.getElementById(aId).hidden = hide;</span>
<a href="#l34.5"></a><span id="l34.5">   });</span>
<a href="#l34.6"></a><span id="l34.6"> </span>
<a href="#l34.7"></a><span id="l34.7">   document.getElementById(&quot;context-close-conversation&quot;).hidden = !this.onConv;</span>
<a href="#l34.8"></a><span id="l34.8">   document.getElementById(&quot;context-openconversation&quot;).disabled =</span>
<a href="#l34.9"></a><span id="l34.9">     !hide &amp;&amp; !this.target.canOpenConversation();</span>
<a href="#l34.10"></a><span id="l34.10"> }</span>
<a href="#l34.11"></a><span id="l34.11"> buddyListContextMenu.prototype = {</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  openConversation: function blcm_openConversation() {</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  openConversation() {</span>
<a href="#l34.14"></a><span id="l34.14">     if (this.onContact || this.onConv)</span>
<a href="#l34.15"></a><span id="l34.15">       this.target.openConversation();</span>
<a href="#l34.16"></a><span id="l34.16">   },</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineminus">-  closeConversation: function blcm_closeConversation() {</span>
<a href="#l34.18"></a><span id="l34.18" class="difflineplus">+  closeConversation() {</span>
<a href="#l34.19"></a><span id="l34.19">     if (this.onConv)</span>
<a href="#l34.20"></a><span id="l34.20">       this.target.closeConversation();</span>
<a href="#l34.21"></a><span id="l34.21">   },</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineminus">-  alias: function blcm_alias() {</span>
<a href="#l34.23"></a><span id="l34.23" class="difflineplus">+  alias() {</span>
<a href="#l34.24"></a><span id="l34.24">     if (this.onContact)</span>
<a href="#l34.25"></a><span id="l34.25">       this.target.startAliasing();</span>
<a href="#l34.26"></a><span id="l34.26">   },</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineminus">-  delete: function blcm_delete() {</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineplus">+  delete() {</span>
<a href="#l34.29"></a><span id="l34.29">     if (!this.onContact)</span>
<a href="#l34.30"></a><span id="l34.30">       return;</span>
<a href="#l34.31"></a><span id="l34.31"> </span>
<a href="#l34.32"></a><span id="l34.32">     let buddy = this.target.contact.preferredBuddy;</span>
<a href="#l34.33"></a><span id="l34.33">     let bundle = document.getElementById(&quot;chatBundle&quot;);</span>
<a href="#l34.34"></a><span id="l34.34">     let displayName = this.target.displayName;</span>
<a href="#l34.35"></a><span id="l34.35">     let promptTitle = bundle.getFormattedString(&quot;buddy.deletePrompt.title&quot;,</span>
<a href="#l34.36"></a><span id="l34.36">                                                 [displayName]);</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineat">@@ -185,46 +185,46 @@ var chatTabType = {</span>
<a href="#l34.38"></a><span id="l34.38">   },</span>
<a href="#l34.39"></a><span id="l34.39">   persistTab(aTab) {</span>
<a href="#l34.40"></a><span id="l34.40">     return {};</span>
<a href="#l34.41"></a><span id="l34.41">   },</span>
<a href="#l34.42"></a><span id="l34.42">   restoreTab(aTabmail, aPersistedState) {</span>
<a href="#l34.43"></a><span id="l34.43">     aTabmail.openTab(&quot;chat&quot;, {});</span>
<a href="#l34.44"></a><span id="l34.44">   },</span>
<a href="#l34.45"></a><span id="l34.45"> </span>
<a href="#l34.46"></a><span id="l34.46" class="difflineminus">-  supportsCommand: function ct_supportsCommand(aCommand, aTab) {</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineplus">+  supportsCommand(aCommand, aTab) {</span>
<a href="#l34.48"></a><span id="l34.48">     switch (aCommand) {</span>
<a href="#l34.49"></a><span id="l34.49">       case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l34.50"></a><span id="l34.50">       case &quot;cmd_fullZoomEnlarge&quot;:</span>
<a href="#l34.51"></a><span id="l34.51">       case &quot;cmd_fullZoomReset&quot;:</span>
<a href="#l34.52"></a><span id="l34.52">       case &quot;cmd_fullZoomToggle&quot;:</span>
<a href="#l34.53"></a><span id="l34.53">       case &quot;cmd_find&quot;:</span>
<a href="#l34.54"></a><span id="l34.54">       case &quot;cmd_findAgain&quot;:</span>
<a href="#l34.55"></a><span id="l34.55">       case &quot;cmd_findPrevious&quot;:</span>
<a href="#l34.56"></a><span id="l34.56">         return true;</span>
<a href="#l34.57"></a><span id="l34.57">       default:</span>
<a href="#l34.58"></a><span id="l34.58">         return false;</span>
<a href="#l34.59"></a><span id="l34.59">     }</span>
<a href="#l34.60"></a><span id="l34.60">   },</span>
<a href="#l34.61"></a><span id="l34.61" class="difflineminus">-  isCommandEnabled: function ct_isCommandEnabled(aCommand, aTab) {</span>
<a href="#l34.62"></a><span id="l34.62" class="difflineplus">+  isCommandEnabled(aCommand, aTab) {</span>
<a href="#l34.63"></a><span id="l34.63">     switch (aCommand) {</span>
<a href="#l34.64"></a><span id="l34.64">       case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l34.65"></a><span id="l34.65">       case &quot;cmd_fullZoomEnlarge&quot;:</span>
<a href="#l34.66"></a><span id="l34.66">       case &quot;cmd_fullZoomReset&quot;:</span>
<a href="#l34.67"></a><span id="l34.67">       case &quot;cmd_fullZoomToggle&quot;:</span>
<a href="#l34.68"></a><span id="l34.68">         return !!this.getBrowser();</span>
<a href="#l34.69"></a><span id="l34.69">       case &quot;cmd_find&quot;:</span>
<a href="#l34.70"></a><span id="l34.70">       case &quot;cmd_findAgain&quot;:</span>
<a href="#l34.71"></a><span id="l34.71">       case &quot;cmd_findPrevious&quot;:</span>
<a href="#l34.72"></a><span id="l34.72">         return !!this.getFindbar();</span>
<a href="#l34.73"></a><span id="l34.73">       default:</span>
<a href="#l34.74"></a><span id="l34.74">         return false;</span>
<a href="#l34.75"></a><span id="l34.75">     }</span>
<a href="#l34.76"></a><span id="l34.76">   },</span>
<a href="#l34.77"></a><span id="l34.77" class="difflineminus">-  doCommand: function ct_doCommand(aCommand, aTab) {</span>
<a href="#l34.78"></a><span id="l34.78" class="difflineplus">+  doCommand(aCommand, aTab) {</span>
<a href="#l34.79"></a><span id="l34.79">     switch (aCommand) {</span>
<a href="#l34.80"></a><span id="l34.80">       case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l34.81"></a><span id="l34.81">         ZoomManager.reduce();</span>
<a href="#l34.82"></a><span id="l34.82">         break;</span>
<a href="#l34.83"></a><span id="l34.83">       case &quot;cmd_fullZoomEnlarge&quot;:</span>
<a href="#l34.84"></a><span id="l34.84">         ZoomManager.enlarge();</span>
<a href="#l34.85"></a><span id="l34.85">         break;</span>
<a href="#l34.86"></a><span id="l34.86">       case &quot;cmd_fullZoomReset&quot;:</span>
<a href="#l34.87"></a><span id="l34.87" class="difflineat">@@ -240,28 +240,28 @@ var chatTabType = {</span>
<a href="#l34.88"></a><span id="l34.88">         this.getFindbar().onFindAgainCommand(false);</span>
<a href="#l34.89"></a><span id="l34.89">         break;</span>
<a href="#l34.90"></a><span id="l34.90">       case &quot;cmd_findPrevious&quot;:</span>
<a href="#l34.91"></a><span id="l34.91">         this.getFindbar().onFindAgainCommand(true);</span>
<a href="#l34.92"></a><span id="l34.92">         break;</span>
<a href="#l34.93"></a><span id="l34.93">     }</span>
<a href="#l34.94"></a><span id="l34.94">   },</span>
<a href="#l34.95"></a><span id="l34.95">   onEvent(aEvent, aTab) {},</span>
<a href="#l34.96"></a><span id="l34.96" class="difflineminus">-  getBrowser: function ct_getBrowser(aTab) {</span>
<a href="#l34.97"></a><span id="l34.97" class="difflineplus">+  getBrowser(aTab) {</span>
<a href="#l34.98"></a><span id="l34.98">     let panel = document.getElementById(&quot;conversationsDeck&quot;).selectedPanel;</span>
<a href="#l34.99"></a><span id="l34.99">     if (panel == document.getElementById(&quot;logDisplay&quot;)) {</span>
<a href="#l34.100"></a><span id="l34.100">       if (document.getElementById(&quot;logDisplayDeck&quot;).selectedPanel ==</span>
<a href="#l34.101"></a><span id="l34.101">           document.getElementById(&quot;logDisplayBrowserBox&quot;))</span>
<a href="#l34.102"></a><span id="l34.102">         return document.getElementById(&quot;conv-log-browser&quot;);</span>
<a href="#l34.103"></a><span id="l34.103">     } else if (panel &amp;&amp; panel.localName == &quot;imconversation&quot;) {</span>
<a href="#l34.104"></a><span id="l34.104">       return panel.browser;</span>
<a href="#l34.105"></a><span id="l34.105">     }</span>
<a href="#l34.106"></a><span id="l34.106">     return null;</span>
<a href="#l34.107"></a><span id="l34.107">   },</span>
<a href="#l34.108"></a><span id="l34.108" class="difflineminus">-  getFindbar: function ct_getFindbar(aTab) {</span>
<a href="#l34.109"></a><span id="l34.109" class="difflineplus">+  getFindbar(aTab) {</span>
<a href="#l34.110"></a><span id="l34.110">     let panel = document.getElementById(&quot;conversationsDeck&quot;).selectedPanel;</span>
<a href="#l34.111"></a><span id="l34.111">     if (panel == document.getElementById(&quot;logDisplay&quot;)) {</span>
<a href="#l34.112"></a><span id="l34.112">       if (document.getElementById(&quot;logDisplayDeck&quot;).selectedPanel ==</span>
<a href="#l34.113"></a><span id="l34.113">           document.getElementById(&quot;logDisplayBrowserBox&quot;))</span>
<a href="#l34.114"></a><span id="l34.114">         return document.getElementById(&quot;log-findbar&quot;);</span>
<a href="#l34.115"></a><span id="l34.115">     } else if (panel &amp;&amp; panel.localName == &quot;imconversation&quot;) {</span>
<a href="#l34.116"></a><span id="l34.116">       return panel.findbar;</span>
<a href="#l34.117"></a><span id="l34.117">     }</span>
<a href="#l34.118"></a><span id="l34.118" class="difflineat">@@ -1180,19 +1180,19 @@ var chatHandler = {</span>
<a href="#l34.119"></a><span id="l34.119">       else</span>
<a href="#l34.120"></a><span id="l34.120">         listbox.focus();</span>
<a href="#l34.121"></a><span id="l34.121">     });</span>
<a href="#l34.122"></a><span id="l34.122">     window.addEventListener(&quot;resize&quot;, this.onConvResize.bind(this));</span>
<a href="#l34.123"></a><span id="l34.123">     document.getElementById(&quot;conversationsGroup&quot;).sortComparator =</span>
<a href="#l34.124"></a><span id="l34.124">       (a, b) =&gt; a.title.toLowerCase().localeCompare(b.title.toLowerCase());</span>
<a href="#l34.125"></a><span id="l34.125"> </span>
<a href="#l34.126"></a><span id="l34.126">     ChromeUtils.import(&quot;resource:///modules/chatHandler.jsm&quot;, this);</span>
<a href="#l34.127"></a><span id="l34.127" class="difflineminus">-    if (this.ChatCore.initialized)</span>
<a href="#l34.128"></a><span id="l34.128" class="difflineplus">+    if (this.ChatCore.initialized) {</span>
<a href="#l34.129"></a><span id="l34.129">       this.initAfterChatCore();</span>
<a href="#l34.130"></a><span id="l34.130" class="difflineminus">-    else {</span>
<a href="#l34.131"></a><span id="l34.131" class="difflineplus">+    } else {</span>
<a href="#l34.132"></a><span id="l34.132">       this.ChatCore.init();</span>
<a href="#l34.133"></a><span id="l34.133">       this._addObserver(&quot;chat-core-initialized&quot;);</span>
<a href="#l34.134"></a><span id="l34.134">     }</span>
<a href="#l34.135"></a><span id="l34.135">   },</span>
<a href="#l34.136"></a><span id="l34.136"> };</span>
<a href="#l34.137"></a><span id="l34.137"> </span>
<a href="#l34.138"></a><span id="l34.138"> function chatLogTreeGroupItem(aTitle, aLogItems) {</span>
<a href="#l34.139"></a><span id="l34.139">   this._title = aTitle;</span>
<a href="#l34.140"></a><span id="l34.140" class="difflineat">@@ -1229,17 +1229,17 @@ function chatLogTreeView(aTree, aLogs) {</span>
<a href="#l34.141"></a><span id="l34.141">   this._tree = aTree;</span>
<a href="#l34.142"></a><span id="l34.142">   this._logs = aLogs;</span>
<a href="#l34.143"></a><span id="l34.143">   this._tree.view = this;</span>
<a href="#l34.144"></a><span id="l34.144">   this._rebuild();</span>
<a href="#l34.145"></a><span id="l34.145"> }</span>
<a href="#l34.146"></a><span id="l34.146"> chatLogTreeView.prototype = {</span>
<a href="#l34.147"></a><span id="l34.147">   __proto__: new PROTO_TREE_VIEW(),</span>
<a href="#l34.148"></a><span id="l34.148"> </span>
<a href="#l34.149"></a><span id="l34.149" class="difflineminus">-  _rebuild: function cLTV__rebuild() {</span>
<a href="#l34.150"></a><span id="l34.150" class="difflineplus">+  _rebuild() {</span>
<a href="#l34.151"></a><span id="l34.151">     // Some date helpers...</span>
<a href="#l34.152"></a><span id="l34.152">     const kDayInMsecs = 24 * 60 * 60 * 1000;</span>
<a href="#l34.153"></a><span id="l34.153">     const kWeekInMsecs = 7 * kDayInMsecs;</span>
<a href="#l34.154"></a><span id="l34.154">     const kTwoWeeksInMsecs = 2 * kWeekInMsecs;</span>
<a href="#l34.155"></a><span id="l34.155"> </span>
<a href="#l34.156"></a><span id="l34.156">     // Drop the old rowMap.</span>
<a href="#l34.157"></a><span id="l34.157">     if (this._tree)</span>
<a href="#l34.158"></a><span id="l34.158">       this._tree.rowCountChanged(0, -this._rowMap.length);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mail/components/im/content/imAccountWizard.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mail/components/im/content/imAccountWizard.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l35.4"></a><span id="l35.4"> /* globals accountOptionsHelper */</span>
<a href="#l35.5"></a><span id="l35.5"> </span>
<a href="#l35.6"></a><span id="l35.6"> var { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;, null);</span>
<a href="#l35.7"></a><span id="l35.7"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l35.8"></a><span id="l35.8"> </span>
<a href="#l35.9"></a><span id="l35.9"> var PREF_EXTENSIONS_GETMOREPROTOCOLSURL = &quot;extensions.getMoreProtocolsURL&quot;;</span>
<a href="#l35.10"></a><span id="l35.10"> </span>
<a href="#l35.11"></a><span id="l35.11"> var accountWizard = {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-  onload: function aw_onload() {</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+  onload() {</span>
<a href="#l35.14"></a><span id="l35.14">     // Ensure the im core is initialized before we get a list of protocols.</span>
<a href="#l35.15"></a><span id="l35.15">     Services.core.init();</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17">     accountWizard.setGetMoreProtocols();</span>
<a href="#l35.18"></a><span id="l35.18"> </span>
<a href="#l35.19"></a><span id="l35.19">     var protoList = document.getElementById(&quot;protolist&quot;);</span>
<a href="#l35.20"></a><span id="l35.20">     var protos = [];</span>
<a href="#l35.21"></a><span id="l35.21">     for (let proto of this.getProtocols())</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -43,62 +43,61 @@ var accountWizard = {</span>
<a href="#l35.23"></a><span id="l35.23">     // there is a strange selection bug without this timeout</span>
<a href="#l35.24"></a><span id="l35.24">     setTimeout(function() {</span>
<a href="#l35.25"></a><span id="l35.25">       protoList.selectedIndex = 0;</span>
<a href="#l35.26"></a><span id="l35.26">     }, 0);</span>
<a href="#l35.27"></a><span id="l35.27"> </span>
<a href="#l35.28"></a><span id="l35.28">     Services.obs.addObserver(this, &quot;prpl-quit&quot;);</span>
<a href="#l35.29"></a><span id="l35.29">     window.addEventListener(&quot;unload&quot;, this.unload);</span>
<a href="#l35.30"></a><span id="l35.30">   },</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-  unload: function aw_unload() {</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+  unload() {</span>
<a href="#l35.33"></a><span id="l35.33">     Services.obs.removeObserver(accountWizard, &quot;prpl-quit&quot;);</span>
<a href="#l35.34"></a><span id="l35.34">   },</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineminus">-  observe: function am_observe(aObject, aTopic, aData) {</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineplus">+  observe(aObject, aTopic, aData) {</span>
<a href="#l35.37"></a><span id="l35.37">     if (aTopic == &quot;prpl-quit&quot;) {</span>
<a href="#l35.38"></a><span id="l35.38">       // libpurple is being uninitialized. We can't create any new</span>
<a href="#l35.39"></a><span id="l35.39">       // account so keeping this wizard open would be pointless, close it.</span>
<a href="#l35.40"></a><span id="l35.40">       window.close();</span>
<a href="#l35.41"></a><span id="l35.41">     }</span>
<a href="#l35.42"></a><span id="l35.42">   },</span>
<a href="#l35.43"></a><span id="l35.43"> </span>
<a href="#l35.44"></a><span id="l35.44" class="difflineminus">-  getUsername: function aw_getUsername() {</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineplus">+  getUsername() {</span>
<a href="#l35.46"></a><span id="l35.46">     // If the first username textbox is empty, make sure we return an empty</span>
<a href="#l35.47"></a><span id="l35.47">     // string so that it blocks the 'next' button of the wizard.</span>
<a href="#l35.48"></a><span id="l35.48">     if (!this.userNameBoxes[0].value)</span>
<a href="#l35.49"></a><span id="l35.49">       return &quot;&quot;;</span>
<a href="#l35.50"></a><span id="l35.50"> </span>
<a href="#l35.51"></a><span id="l35.51">     return this.userNameBoxes.reduce((prev, elt) =&gt; prev + elt.value, &quot;&quot;);</span>
<a href="#l35.52"></a><span id="l35.52">   },</span>
<a href="#l35.53"></a><span id="l35.53"> </span>
<a href="#l35.54"></a><span id="l35.54" class="difflineminus">-  checkUsername: function aw_checkUsername() {</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+  checkUsername() {</span>
<a href="#l35.56"></a><span id="l35.56">     var wizard = document.getElementById(&quot;accountWizard&quot;);</span>
<a href="#l35.57"></a><span id="l35.57">     var name = accountWizard.getUsername();</span>
<a href="#l35.58"></a><span id="l35.58">     var duplicateWarning = document.getElementById(&quot;duplicateAccount&quot;);</span>
<a href="#l35.59"></a><span id="l35.59">     if (!name) {</span>
<a href="#l35.60"></a><span id="l35.60">       wizard.canAdvance = false;</span>
<a href="#l35.61"></a><span id="l35.61">       duplicateWarning.hidden = true;</span>
<a href="#l35.62"></a><span id="l35.62">       return;</span>
<a href="#l35.63"></a><span id="l35.63">     }</span>
<a href="#l35.64"></a><span id="l35.64"> </span>
<a href="#l35.65"></a><span id="l35.65">     var exists = accountWizard.proto.accountExists(name);</span>
<a href="#l35.66"></a><span id="l35.66">     wizard.canAdvance = !exists;</span>
<a href="#l35.67"></a><span id="l35.67">     duplicateWarning.hidden = !exists;</span>
<a href="#l35.68"></a><span id="l35.68">   },</span>
<a href="#l35.69"></a><span id="l35.69"> </span>
<a href="#l35.70"></a><span id="l35.70" class="difflineminus">-  selectProtocol: function aw_selectProtocol() {</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineplus">+  selectProtocol() {</span>
<a href="#l35.72"></a><span id="l35.72">     var protoList = document.getElementById(&quot;protolist&quot;);</span>
<a href="#l35.73"></a><span id="l35.73">     var id = protoList.selectedItem.value;</span>
<a href="#l35.74"></a><span id="l35.74">     this.proto = Services.core.getProtocolById(id);</span>
<a href="#l35.75"></a><span id="l35.75"> </span>
<a href="#l35.76"></a><span id="l35.76">     return true;</span>
<a href="#l35.77"></a><span id="l35.77">   },</span>
<a href="#l35.78"></a><span id="l35.78"> </span>
<a href="#l35.79"></a><span id="l35.79"> </span>
<a href="#l35.80"></a><span id="l35.80" class="difflineminus">-  insertUsernameField: function aw_insertUsernameField(aName, aLabel, aParent,</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineminus">-                                                       aDefaultValue) {</span>
<a href="#l35.82"></a><span id="l35.82" class="difflineplus">+  insertUsernameField(aName, aLabel, aParent, aDefaultValue) {</span>
<a href="#l35.83"></a><span id="l35.83">     var hbox = document.createElement(&quot;hbox&quot;);</span>
<a href="#l35.84"></a><span id="l35.84">     hbox.setAttribute(&quot;id&quot;, aName + &quot;-hbox&quot;);</span>
<a href="#l35.85"></a><span id="l35.85">     hbox.setAttribute(&quot;align&quot;, &quot;baseline&quot;);</span>
<a href="#l35.86"></a><span id="l35.86">     hbox.setAttribute(&quot;equalsize&quot;, &quot;always&quot;);</span>
<a href="#l35.87"></a><span id="l35.87"> </span>
<a href="#l35.88"></a><span id="l35.88">     var label = document.createElement(&quot;label&quot;);</span>
<a href="#l35.89"></a><span id="l35.89">     label.setAttribute(&quot;value&quot;, aLabel);</span>
<a href="#l35.90"></a><span id="l35.90">     label.setAttribute(&quot;control&quot;, aName);</span>
<a href="#l35.91"></a><span id="l35.91" class="difflineat">@@ -112,17 +111,17 @@ var accountWizard = {</span>
<a href="#l35.92"></a><span id="l35.92">       textbox.setAttribute(&quot;value&quot;, aDefaultValue);</span>
<a href="#l35.93"></a><span id="l35.93">     textbox.addEventListener(&quot;input&quot;, accountWizard.checkUsername);</span>
<a href="#l35.94"></a><span id="l35.94">     hbox.appendChild(textbox);</span>
<a href="#l35.95"></a><span id="l35.95"> </span>
<a href="#l35.96"></a><span id="l35.96">     aParent.appendChild(hbox);</span>
<a href="#l35.97"></a><span id="l35.97">     return textbox;</span>
<a href="#l35.98"></a><span id="l35.98">   },</span>
<a href="#l35.99"></a><span id="l35.99"> </span>
<a href="#l35.100"></a><span id="l35.100" class="difflineminus">-  showUsernamePage: function aw_showUsernamePage() {</span>
<a href="#l35.101"></a><span id="l35.101" class="difflineplus">+  showUsernamePage() {</span>
<a href="#l35.102"></a><span id="l35.102">     var proto = this.proto.id;</span>
<a href="#l35.103"></a><span id="l35.103">     if (&quot;userNameBoxes&quot; in this &amp;&amp; this.userNameProto == proto) {</span>
<a href="#l35.104"></a><span id="l35.104">       this.checkUsername();</span>
<a href="#l35.105"></a><span id="l35.105">       return;</span>
<a href="#l35.106"></a><span id="l35.106">     }</span>
<a href="#l35.107"></a><span id="l35.107"> </span>
<a href="#l35.108"></a><span id="l35.108">     var bundle = document.getElementById(&quot;accountsBundle&quot;);</span>
<a href="#l35.109"></a><span id="l35.109">     var usernameInfo;</span>
<a href="#l35.110"></a><span id="l35.110" class="difflineat">@@ -158,48 +157,48 @@ var accountWizard = {</span>
<a href="#l35.111"></a><span id="l35.111">                                                        label, vbox,</span>
<a href="#l35.112"></a><span id="l35.112">                                                        defaultVal));</span>
<a href="#l35.113"></a><span id="l35.113">     }</span>
<a href="#l35.114"></a><span id="l35.114">     this.userNameBoxes[0].focus();</span>
<a href="#l35.115"></a><span id="l35.115">     this.userNameProto = proto;</span>
<a href="#l35.116"></a><span id="l35.116">     this.checkUsername();</span>
<a href="#l35.117"></a><span id="l35.117">   },</span>
<a href="#l35.118"></a><span id="l35.118"> </span>
<a href="#l35.119"></a><span id="l35.119" class="difflineminus">-  hideUsernamePage: function aw_hideUsernamePage() {</span>
<a href="#l35.120"></a><span id="l35.120" class="difflineplus">+  hideUsernamePage() {</span>
<a href="#l35.121"></a><span id="l35.121">     document.getElementById(&quot;accountWizard&quot;).canAdvance = true;</span>
<a href="#l35.122"></a><span id="l35.122">     var next = &quot;account&quot; +</span>
<a href="#l35.123"></a><span id="l35.123">       (this.proto.noPassword ? &quot;advanced&quot; : &quot;password&quot;);</span>
<a href="#l35.124"></a><span id="l35.124">     document.getElementById(&quot;accountusername&quot;).next = next;</span>
<a href="#l35.125"></a><span id="l35.125">   },</span>
<a href="#l35.126"></a><span id="l35.126"> </span>
<a href="#l35.127"></a><span id="l35.127" class="difflineminus">-  showAdvanced: function aw_showAdvanced() {</span>
<a href="#l35.128"></a><span id="l35.128" class="difflineplus">+  showAdvanced() {</span>
<a href="#l35.129"></a><span id="l35.129">     // ensure we don't destroy user data if it's not necessary</span>
<a href="#l35.130"></a><span id="l35.130">     var id = this.proto.id;</span>
<a href="#l35.131"></a><span id="l35.131">     if (&quot;protoSpecOptId&quot; in this &amp;&amp; this.protoSpecOptId == id)</span>
<a href="#l35.132"></a><span id="l35.132">       return;</span>
<a href="#l35.133"></a><span id="l35.133">     this.protoSpecOptId = id;</span>
<a href="#l35.134"></a><span id="l35.134"> </span>
<a href="#l35.135"></a><span id="l35.135">     this.populateProtoSpecificBox();</span>
<a href="#l35.136"></a><span id="l35.136"> </span>
<a href="#l35.137"></a><span id="l35.137">     let alias = document.getElementById(&quot;alias&quot;);</span>
<a href="#l35.138"></a><span id="l35.138">     alias.focus();</span>
<a href="#l35.139"></a><span id="l35.139">   },</span>
<a href="#l35.140"></a><span id="l35.140"> </span>
<a href="#l35.141"></a><span id="l35.141" class="difflineminus">-  populateProtoSpecificBox: function aw_populate() {</span>
<a href="#l35.142"></a><span id="l35.142" class="difflineplus">+  populateProtoSpecificBox() {</span>
<a href="#l35.143"></a><span id="l35.143">     let haveOptions =</span>
<a href="#l35.144"></a><span id="l35.144">       accountOptionsHelper.addOptions(this.proto.id + &quot;-&quot;, this.getProtoOptions());</span>
<a href="#l35.145"></a><span id="l35.145">     document.getElementById(&quot;protoSpecificGroupbox&quot;).hidden = !haveOptions;</span>
<a href="#l35.146"></a><span id="l35.146">     if (haveOptions) {</span>
<a href="#l35.147"></a><span id="l35.147">       var bundle = document.getElementById(&quot;accountsBundle&quot;);</span>
<a href="#l35.148"></a><span id="l35.148">       document.getElementById(&quot;protoSpecificCaption&quot;).label =</span>
<a href="#l35.149"></a><span id="l35.149">         bundle.getFormattedString(&quot;protoOptions&quot;, [this.proto.name]);</span>
<a href="#l35.150"></a><span id="l35.150">     }</span>
<a href="#l35.151"></a><span id="l35.151">   },</span>
<a href="#l35.152"></a><span id="l35.152"> </span>
<a href="#l35.153"></a><span id="l35.153" class="difflineminus">-  createSummaryRow: function aw_createSummaryRow(aLabel, aValue) {</span>
<a href="#l35.154"></a><span id="l35.154" class="difflineplus">+  createSummaryRow(aLabel, aValue) {</span>
<a href="#l35.155"></a><span id="l35.155">     var row = document.createElement(&quot;row&quot;);</span>
<a href="#l35.156"></a><span id="l35.156">     row.setAttribute(&quot;align&quot;, &quot;baseline&quot;);</span>
<a href="#l35.157"></a><span id="l35.157"> </span>
<a href="#l35.158"></a><span id="l35.158">     var label = document.createElement(&quot;label&quot;);</span>
<a href="#l35.159"></a><span id="l35.159">     label.setAttribute(&quot;class&quot;, &quot;header&quot;);</span>
<a href="#l35.160"></a><span id="l35.160">     if (aLabel.length &gt; 20) {</span>
<a href="#l35.161"></a><span id="l35.161">       aLabel = aLabel.substring(0, 20);</span>
<a href="#l35.162"></a><span id="l35.162">       aLabel += &quot;…&quot;;</span>
<a href="#l35.163"></a><span id="l35.163" class="difflineat">@@ -211,17 +210,17 @@ var accountWizard = {</span>
<a href="#l35.164"></a><span id="l35.164">     textbox.setAttribute(&quot;value&quot;, aValue);</span>
<a href="#l35.165"></a><span id="l35.165">     textbox.setAttribute(&quot;class&quot;, &quot;plain&quot;);</span>
<a href="#l35.166"></a><span id="l35.166">     textbox.setAttribute(&quot;readonly&quot;, true);</span>
<a href="#l35.167"></a><span id="l35.167">     row.appendChild(textbox);</span>
<a href="#l35.168"></a><span id="l35.168"> </span>
<a href="#l35.169"></a><span id="l35.169">     return row;</span>
<a href="#l35.170"></a><span id="l35.170">   },</span>
<a href="#l35.171"></a><span id="l35.171"> </span>
<a href="#l35.172"></a><span id="l35.172" class="difflineminus">-  showSummary: function aw_showSummary() {</span>
<a href="#l35.173"></a><span id="l35.173" class="difflineplus">+  showSummary() {</span>
<a href="#l35.174"></a><span id="l35.174">     var rows = document.getElementById(&quot;summaryRows&quot;);</span>
<a href="#l35.175"></a><span id="l35.175">     var bundle = document.getElementById(&quot;accountsBundle&quot;);</span>
<a href="#l35.176"></a><span id="l35.176">     while (rows.hasChildNodes())</span>
<a href="#l35.177"></a><span id="l35.177">       rows.lastChild.remove();</span>
<a href="#l35.178"></a><span id="l35.178"> </span>
<a href="#l35.179"></a><span id="l35.179">     var label = document.getElementById(&quot;protoLabel&quot;).value;</span>
<a href="#l35.180"></a><span id="l35.180">     rows.appendChild(this.createSummaryRow(label, this.proto.name));</span>
<a href="#l35.181"></a><span id="l35.181">     this.username = this.getUsername();</span>
<a href="#l35.182"></a><span id="l35.182" class="difflineat">@@ -282,17 +281,17 @@ var accountWizard = {</span>
<a href="#l35.183"></a><span id="l35.183"> </span>
<a href="#l35.184"></a><span id="l35.184">     for (let i = 0; i &lt; this.prefs.length; ++i) {</span>
<a href="#l35.185"></a><span id="l35.185">       let opt = this.prefs[i];</span>
<a href="#l35.186"></a><span id="l35.186">       let label = bundle.getFormattedString(&quot;accountColon&quot;, [opt.opt.label]);</span>
<a href="#l35.187"></a><span id="l35.187">       rows.appendChild(this.createSummaryRow(label, opt.value));</span>
<a href="#l35.188"></a><span id="l35.188">     }</span>
<a href="#l35.189"></a><span id="l35.189">   },</span>
<a href="#l35.190"></a><span id="l35.190"> </span>
<a href="#l35.191"></a><span id="l35.191" class="difflineminus">-  createAccount: function aw_createAccount() {</span>
<a href="#l35.192"></a><span id="l35.192" class="difflineplus">+  createAccount() {</span>
<a href="#l35.193"></a><span id="l35.193">     var acc = Services.accounts.createAccount(this.username, this.proto.id);</span>
<a href="#l35.194"></a><span id="l35.194">     if (!this.proto.noPassword &amp;&amp; this.password)</span>
<a href="#l35.195"></a><span id="l35.195">       acc.password = this.password;</span>
<a href="#l35.196"></a><span id="l35.196">     if (this.alias)</span>
<a href="#l35.197"></a><span id="l35.197">       acc.alias = this.alias;</span>
<a href="#l35.198"></a><span id="l35.198"> </span>
<a href="#l35.199"></a><span id="l35.199">     for (let i = 0; i &lt; this.prefs.length; ++i) {</span>
<a href="#l35.200"></a><span id="l35.200">       let option = this.prefs[i];</span>
<a href="#l35.201"></a><span id="l35.201" class="difflineat">@@ -342,17 +341,17 @@ var accountWizard = {</span>
<a href="#l35.202"></a><span id="l35.202">     inServer.valid = false;</span>
<a href="#l35.203"></a><span id="l35.203">     account.incomingServer = inServer;</span>
<a href="#l35.204"></a><span id="l35.204">     inServer.valid = true;</span>
<a href="#l35.205"></a><span id="l35.205">     MailServices.accounts.notifyServerLoaded(inServer);</span>
<a href="#l35.206"></a><span id="l35.206"> </span>
<a href="#l35.207"></a><span id="l35.207">     return true;</span>
<a href="#l35.208"></a><span id="l35.208">   },</span>
<a href="#l35.209"></a><span id="l35.209"> </span>
<a href="#l35.210"></a><span id="l35.210" class="difflineminus">-  getValue: function aw_getValue(aId) {</span>
<a href="#l35.211"></a><span id="l35.211" class="difflineplus">+  getValue(aId) {</span>
<a href="#l35.212"></a><span id="l35.212">     var elt = document.getElementById(aId);</span>
<a href="#l35.213"></a><span id="l35.213">     if (&quot;selectedItem&quot; in elt)</span>
<a href="#l35.214"></a><span id="l35.214">       return elt.selectedItem.value;</span>
<a href="#l35.215"></a><span id="l35.215">     if (&quot;checked&quot; in elt)</span>
<a href="#l35.216"></a><span id="l35.216">       return elt.checked;</span>
<a href="#l35.217"></a><span id="l35.217">     if (&quot;value&quot; in elt)</span>
<a href="#l35.218"></a><span id="l35.218">       return elt.value;</span>
<a href="#l35.219"></a><span id="l35.219">     // If the groupbox has never been opened, the binding isn't attached</span>
<a href="#l35.220"></a><span id="l35.220" class="difflineat">@@ -360,36 +359,36 @@ var accountWizard = {</span>
<a href="#l35.221"></a><span id="l35.221">     // has a special handling of the undefined value for this case.</span>
<a href="#l35.222"></a><span id="l35.222">     return undefined;</span>
<a href="#l35.223"></a><span id="l35.223">   },</span>
<a href="#l35.224"></a><span id="l35.224"> </span>
<a href="#l35.225"></a><span id="l35.225">   * getIter(aEnumerator) {</span>
<a href="#l35.226"></a><span id="l35.226">     while (aEnumerator.hasMoreElements())</span>
<a href="#l35.227"></a><span id="l35.227">       yield aEnumerator.getNext();</span>
<a href="#l35.228"></a><span id="l35.228">   },</span>
<a href="#l35.229"></a><span id="l35.229" class="difflineminus">-  getProtocols: function aw_getProtocols() {</span>
<a href="#l35.230"></a><span id="l35.230" class="difflineplus">+  getProtocols() {</span>
<a href="#l35.231"></a><span id="l35.231">     return this.getIter(Services.core.getProtocols());</span>
<a href="#l35.232"></a><span id="l35.232">   },</span>
<a href="#l35.233"></a><span id="l35.233" class="difflineminus">-  getProtoOptions: function aw_getProtoOptions() {</span>
<a href="#l35.234"></a><span id="l35.234" class="difflineplus">+  getProtoOptions() {</span>
<a href="#l35.235"></a><span id="l35.235">     return this.getIter(this.proto.getOptions());</span>
<a href="#l35.236"></a><span id="l35.236">   },</span>
<a href="#l35.237"></a><span id="l35.237" class="difflineminus">-  getProtoUserSplits: function aw_getProtoUserSplits() {</span>
<a href="#l35.238"></a><span id="l35.238" class="difflineplus">+  getProtoUserSplits() {</span>
<a href="#l35.239"></a><span id="l35.239">     return this.getIter(this.proto.getUsernameSplit());</span>
<a href="#l35.240"></a><span id="l35.240">   },</span>
<a href="#l35.241"></a><span id="l35.241"> </span>
<a href="#l35.242"></a><span id="l35.242" class="difflineminus">-  onGroupboxKeypress: function aw_onGroupboxKeypress(aEvent) {</span>
<a href="#l35.243"></a><span id="l35.243" class="difflineplus">+  onGroupboxKeypress(aEvent) {</span>
<a href="#l35.244"></a><span id="l35.244">     var target = aEvent.target;</span>
<a href="#l35.245"></a><span id="l35.245">     var code = aEvent.charCode || aEvent.keyCode;</span>
<a href="#l35.246"></a><span id="l35.246">     if (code == KeyEvent.DOM_VK_SPACE ||</span>
<a href="#l35.247"></a><span id="l35.247">         (code == KeyEvent.DOM_VK_LEFT &amp;&amp; !target.hasAttribute(&quot;closed&quot;)) ||</span>
<a href="#l35.248"></a><span id="l35.248">         (code == KeyEvent.DOM_VK_RIGHT &amp;&amp; target.hasAttribute(&quot;closed&quot;)))</span>
<a href="#l35.249"></a><span id="l35.249">         this.toggleGroupbox(target.id);</span>
<a href="#l35.250"></a><span id="l35.250">   },</span>
<a href="#l35.251"></a><span id="l35.251"> </span>
<a href="#l35.252"></a><span id="l35.252" class="difflineminus">-  toggleGroupbox: function aw_toggleGroupbox(id) {</span>
<a href="#l35.253"></a><span id="l35.253" class="difflineplus">+  toggleGroupbox(id) {</span>
<a href="#l35.254"></a><span id="l35.254">     var elt = document.getElementById(id);</span>
<a href="#l35.255"></a><span id="l35.255">     if (elt.hasAttribute(&quot;closed&quot;)) {</span>
<a href="#l35.256"></a><span id="l35.256">       elt.removeAttribute(&quot;closed&quot;);</span>
<a href="#l35.257"></a><span id="l35.257">       if (elt.flexWhenOpened)</span>
<a href="#l35.258"></a><span id="l35.258">         elt.flex = elt.flexWhenOpened;</span>
<a href="#l35.259"></a><span id="l35.259">     } else {</span>
<a href="#l35.260"></a><span id="l35.260">       elt.setAttribute(&quot;closed&quot;, &quot;true&quot;);</span>
<a href="#l35.261"></a><span id="l35.261">       if (elt.flex) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mail/components/im/content/imAccounts.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mail/components/im/content/imAccounts.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -31,36 +31,36 @@ var events = [</span>
<a href="#l36.4"></a><span id="l36.4"> ];</span>
<a href="#l36.5"></a><span id="l36.5"> </span>
<a href="#l36.6"></a><span id="l36.6"> var gAccountManager = {</span>
<a href="#l36.7"></a><span id="l36.7">   // Sets the delay after connect() or disconnect() during which</span>
<a href="#l36.8"></a><span id="l36.8">   // it is impossible to perform disconnect() and connect()</span>
<a href="#l36.9"></a><span id="l36.9">   _disabledDelay: 500,</span>
<a href="#l36.10"></a><span id="l36.10">   disableTimerID: 0,</span>
<a href="#l36.11"></a><span id="l36.11">   _connectedLabelInterval: 0,</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  load: function am_load() {</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+  load() {</span>
<a href="#l36.14"></a><span id="l36.14">     // Wait until the password service is ready before offering anything.</span>
<a href="#l36.15"></a><span id="l36.15">     Services.logins.initializationPromise.then(() =&gt; {</span>
<a href="#l36.16"></a><span id="l36.16">       this.accountList = document.getElementById(&quot;accountlist&quot;);</span>
<a href="#l36.17"></a><span id="l36.17">       let defaultID;</span>
<a href="#l36.18"></a><span id="l36.18">       Services.core.init(); // ensure the imCore is initialized.</span>
<a href="#l36.19"></a><span id="l36.19">       for (let acc of this.getAccounts()) {</span>
<a href="#l36.20"></a><span id="l36.20">         var elt = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l36.21"></a><span id="l36.21">         this.accountList.appendChild(elt);</span>
<a href="#l36.22"></a><span id="l36.22">         elt.build(acc);</span>
<a href="#l36.23"></a><span id="l36.23">         if (!defaultID &amp;&amp; acc.firstConnectionState == acc.FIRST_CONNECTION_CRASHED)</span>
<a href="#l36.24"></a><span id="l36.24">           defaultID = acc.id;</span>
<a href="#l36.25"></a><span id="l36.25">       }</span>
<a href="#l36.26"></a><span id="l36.26">       for (let event of events)</span>
<a href="#l36.27"></a><span id="l36.27">         Services.obs.addObserver(this, event);</span>
<a href="#l36.28"></a><span id="l36.28" class="difflineminus">-      if (!this.accountList.getRowCount())</span>
<a href="#l36.29"></a><span id="l36.29" class="difflineplus">+      if (!this.accountList.getRowCount()) {</span>
<a href="#l36.30"></a><span id="l36.30">         // This is horrible, but it works. Otherwise (at least on mac)</span>
<a href="#l36.31"></a><span id="l36.31">         // the wizard is not centered relatively to the account manager</span>
<a href="#l36.32"></a><span id="l36.32">         setTimeout(function() { gAccountManager.new(); }, 0);</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineminus">-      else {</span>
<a href="#l36.34"></a><span id="l36.34" class="difflineplus">+      } else {</span>
<a href="#l36.35"></a><span id="l36.35">         // we have accounts, show the list</span>
<a href="#l36.36"></a><span id="l36.36">         document.getElementById(&quot;accountsDesk&quot;).selectedIndex = 1;</span>
<a href="#l36.37"></a><span id="l36.37"> </span>
<a href="#l36.38"></a><span id="l36.38">         // ensure an account is selected</span>
<a href="#l36.39"></a><span id="l36.39">         if (defaultID)</span>
<a href="#l36.40"></a><span id="l36.40">           this.selectAccount(defaultID);</span>
<a href="#l36.41"></a><span id="l36.41">         else</span>
<a href="#l36.42"></a><span id="l36.42">           this.accountList.selectedIndex = 0;</span>
<a href="#l36.43"></a><span id="l36.43" class="difflineat">@@ -71,22 +71,22 @@ var gAccountManager = {</span>
<a href="#l36.44"></a><span id="l36.44">       this.accountList.addEventListener(&quot;keypress&quot;, this.onKeyPress, true);</span>
<a href="#l36.45"></a><span id="l36.45">       window.addEventListener(&quot;unload&quot;, this.unload.bind(this));</span>
<a href="#l36.46"></a><span id="l36.46">       this._connectedLabelInterval = setInterval(this.updateConnectedLabels, 60000);</span>
<a href="#l36.47"></a><span id="l36.47">       statusSelector.init();</span>
<a href="#l36.48"></a><span id="l36.48">     }, () =&gt; {</span>
<a href="#l36.49"></a><span id="l36.49">       this.close();</span>
<a href="#l36.50"></a><span id="l36.50">     });</span>
<a href="#l36.51"></a><span id="l36.51">   },</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineminus">-  unload: function am_unload() {</span>
<a href="#l36.53"></a><span id="l36.53" class="difflineplus">+  unload() {</span>
<a href="#l36.54"></a><span id="l36.54">     clearInterval(this._connectedLabelInterval);</span>
<a href="#l36.55"></a><span id="l36.55">     for (let event of events)</span>
<a href="#l36.56"></a><span id="l36.56">       Services.obs.removeObserver(this, event);</span>
<a href="#l36.57"></a><span id="l36.57">   },</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineminus">-  _updateAccountList: function am__updateAccountList() {</span>
<a href="#l36.59"></a><span id="l36.59" class="difflineplus">+  _updateAccountList() {</span>
<a href="#l36.60"></a><span id="l36.60">     let accountList = this.accountList;</span>
<a href="#l36.61"></a><span id="l36.61">     let i = 0;</span>
<a href="#l36.62"></a><span id="l36.62">     for (let acc of this.getAccounts()) {</span>
<a href="#l36.63"></a><span id="l36.63">       let oldItem = accountList.getItemAtIndex(i);</span>
<a href="#l36.64"></a><span id="l36.64">       if (oldItem.id != acc.id) {</span>
<a href="#l36.65"></a><span id="l36.65">         let accElt = document.getElementById(acc.id);</span>
<a href="#l36.66"></a><span id="l36.66">         accountList.insertBefore(accElt, oldItem);</span>
<a href="#l36.67"></a><span id="l36.67">         accElt.restoreItems();</span>
<a href="#l36.68"></a><span id="l36.68" class="difflineat">@@ -104,17 +104,17 @@ var gAccountManager = {</span>
<a href="#l36.69"></a><span id="l36.69"> </span>
<a href="#l36.70"></a><span id="l36.70">     // The selected item is still selected</span>
<a href="#l36.71"></a><span id="l36.71">     accountList.selectedItem.buttons.setFocus();</span>
<a href="#l36.72"></a><span id="l36.72">     accountList.ensureSelectedElementIsVisible();</span>
<a href="#l36.73"></a><span id="l36.73"> </span>
<a href="#l36.74"></a><span id="l36.74">     // We need to refresh the disabled menu items</span>
<a href="#l36.75"></a><span id="l36.75">     this.disableCommandItems();</span>
<a href="#l36.76"></a><span id="l36.76">   },</span>
<a href="#l36.77"></a><span id="l36.77" class="difflineminus">-  observe: function am_observe(aObject, aTopic, aData) {</span>
<a href="#l36.78"></a><span id="l36.78" class="difflineplus">+  observe(aObject, aTopic, aData) {</span>
<a href="#l36.79"></a><span id="l36.79">     if (aTopic == &quot;prpl-quit&quot;) {</span>
<a href="#l36.80"></a><span id="l36.80">       // libpurple is being uninitialized. We don't need the account</span>
<a href="#l36.81"></a><span id="l36.81">       // manager window anymore, close it.</span>
<a href="#l36.82"></a><span id="l36.82">       this.close();</span>
<a href="#l36.83"></a><span id="l36.83">       return;</span>
<a href="#l36.84"></a><span id="l36.84">     } else if (aTopic == &quot;autologin-processed&quot;) {</span>
<a href="#l36.85"></a><span id="l36.85">       var notification = document.getElementById(&quot;accountsNotificationBox&quot;)</span>
<a href="#l36.86"></a><span id="l36.86">                                  .getNotificationWithValue(&quot;autoLoginStatus&quot;);</span>
<a href="#l36.87"></a><span id="l36.87" class="difflineat">@@ -189,34 +189,34 @@ var gAccountManager = {</span>
<a href="#l36.88"></a><span id="l36.88">         } else if (aTopic == &quot;account-connected&quot;) {</span>
<a href="#l36.89"></a><span id="l36.89">           elt.refreshConnectedLabel();</span>
<a href="#l36.90"></a><span id="l36.90">         }</span>
<a href="#l36.91"></a><span id="l36.91"> </span>
<a href="#l36.92"></a><span id="l36.92">         elt.setAttribute(&quot;state&quot;, stateEvents[aTopic]);</span>
<a href="#l36.93"></a><span id="l36.93">       }</span>
<a href="#l36.94"></a><span id="l36.94">     }</span>
<a href="#l36.95"></a><span id="l36.95">   },</span>
<a href="#l36.96"></a><span id="l36.96" class="difflineminus">-  cancelReconnection: function am_cancelReconnection() {</span>
<a href="#l36.97"></a><span id="l36.97" class="difflineplus">+  cancelReconnection() {</span>
<a href="#l36.98"></a><span id="l36.98">     this.accountList.selectedItem.cancelReconnection();</span>
<a href="#l36.99"></a><span id="l36.99">   },</span>
<a href="#l36.100"></a><span id="l36.100" class="difflineminus">-  connect: function am_connect() {</span>
<a href="#l36.101"></a><span id="l36.101" class="difflineplus">+  connect() {</span>
<a href="#l36.102"></a><span id="l36.102">     let account = this.accountList.selectedItem.account;</span>
<a href="#l36.103"></a><span id="l36.103">     if (account.disconnected) {</span>
<a href="#l36.104"></a><span id="l36.104">       this.temporarilyDisableButtons();</span>
<a href="#l36.105"></a><span id="l36.105">       account.connect();</span>
<a href="#l36.106"></a><span id="l36.106">     }</span>
<a href="#l36.107"></a><span id="l36.107">   },</span>
<a href="#l36.108"></a><span id="l36.108" class="difflineminus">-  disconnect: function am_disconnect() {</span>
<a href="#l36.109"></a><span id="l36.109" class="difflineplus">+  disconnect() {</span>
<a href="#l36.110"></a><span id="l36.110">     let account = this.accountList.selectedItem.account;</span>
<a href="#l36.111"></a><span id="l36.111">     if (account.connected || account.connecting) {</span>
<a href="#l36.112"></a><span id="l36.112">       this.temporarilyDisableButtons();</span>
<a href="#l36.113"></a><span id="l36.113">       account.disconnect();</span>
<a href="#l36.114"></a><span id="l36.114">     }</span>
<a href="#l36.115"></a><span id="l36.115">   },</span>
<a href="#l36.116"></a><span id="l36.116" class="difflineminus">-  addException: function am_addException() {</span>
<a href="#l36.117"></a><span id="l36.117" class="difflineplus">+  addException() {</span>
<a href="#l36.118"></a><span id="l36.118">     let account = this.accountList.selectedItem.account;</span>
<a href="#l36.119"></a><span id="l36.119">     let prplAccount = account.prplAccount;</span>
<a href="#l36.120"></a><span id="l36.120">     if (!account.disconnected || !prplAccount.connectionTarget)</span>
<a href="#l36.121"></a><span id="l36.121">       return;</span>
<a href="#l36.122"></a><span id="l36.122"> </span>
<a href="#l36.123"></a><span id="l36.123">     // Open the Gecko SSL exception dialog.</span>
<a href="#l36.124"></a><span id="l36.124">     let params = {</span>
<a href="#l36.125"></a><span id="l36.125">       exceptionAdded: false,</span>
<a href="#l36.126"></a><span id="l36.126" class="difflineat">@@ -225,17 +225,17 @@ var gAccountManager = {</span>
<a href="#l36.127"></a><span id="l36.127">       location: prplAccount.connectionTarget,</span>
<a href="#l36.128"></a><span id="l36.128">     };</span>
<a href="#l36.129"></a><span id="l36.129">     window.openDialog(&quot;chrome://pippki/content/exceptionDialog.xul&quot;, &quot;&quot;,</span>
<a href="#l36.130"></a><span id="l36.130">                       &quot;chrome,centerscreen,modal&quot;, params);</span>
<a href="#l36.131"></a><span id="l36.131">     // Reconnect the account if an exception was added.</span>
<a href="#l36.132"></a><span id="l36.132">     if (params.exceptionAdded)</span>
<a href="#l36.133"></a><span id="l36.133">       account.connect();</span>
<a href="#l36.134"></a><span id="l36.134">   },</span>
<a href="#l36.135"></a><span id="l36.135" class="difflineminus">-  copyDebugLog: function am_copyDebugLog() {</span>
<a href="#l36.136"></a><span id="l36.136" class="difflineplus">+  copyDebugLog() {</span>
<a href="#l36.137"></a><span id="l36.137">     let account = this.accountList.selectedItem.account;</span>
<a href="#l36.138"></a><span id="l36.138">     let text = account.getDebugMessages().map(function(dbgMsg) {</span>
<a href="#l36.139"></a><span id="l36.139">       let m = dbgMsg.message;</span>
<a href="#l36.140"></a><span id="l36.140">       let time = new Date(m.timeStamp);</span>
<a href="#l36.141"></a><span id="l36.141">       const dateTimeFormatter = new Services.intl.DateTimeFormat(undefined, {</span>
<a href="#l36.142"></a><span id="l36.142">         dateStyle: &quot;short&quot;, timeStyle: &quot;long&quot;,</span>
<a href="#l36.143"></a><span id="l36.143">       });</span>
<a href="#l36.144"></a><span id="l36.144">       time = dateTimeFormatter.format(time);</span>
<a href="#l36.145"></a><span id="l36.145" class="difflineat">@@ -252,43 +252,43 @@ var gAccountManager = {</span>
<a href="#l36.146"></a><span id="l36.146">         level = &quot;DEBUG&quot;;</span>
<a href="#l36.147"></a><span id="l36.147">       return &quot;[&quot; + time + &quot;] &quot; + level + &quot; (@ &quot; + m.sourceLine +</span>
<a href="#l36.148"></a><span id="l36.148">              &quot; &quot; + m.sourceName + &quot;:&quot; + m.lineNumber + &quot;)\n&quot; +</span>
<a href="#l36.149"></a><span id="l36.149">              m.errorMessage;</span>
<a href="#l36.150"></a><span id="l36.150">     }).join(&quot;\n&quot;);</span>
<a href="#l36.151"></a><span id="l36.151">     Cc[&quot;@mozilla.org/widget/clipboardhelper;1&quot;]</span>
<a href="#l36.152"></a><span id="l36.152">       .getService(Ci.nsIClipboardHelper).copyString(text);</span>
<a href="#l36.153"></a><span id="l36.153">   },</span>
<a href="#l36.154"></a><span id="l36.154" class="difflineminus">-  updateConnectedLabels: function am_updateConnectedLabels() {</span>
<a href="#l36.155"></a><span id="l36.155" class="difflineplus">+  updateConnectedLabels() {</span>
<a href="#l36.156"></a><span id="l36.156">     for (let i = 0; i &lt; gAccountManager.accountList.itemCount; ++i) {</span>
<a href="#l36.157"></a><span id="l36.157">       let item = gAccountManager.accountList.getItemAtIndex(i);</span>
<a href="#l36.158"></a><span id="l36.158">       if (item.account.connected)</span>
<a href="#l36.159"></a><span id="l36.159">         item.refreshConnectedLabel();</span>
<a href="#l36.160"></a><span id="l36.160">     }</span>
<a href="#l36.161"></a><span id="l36.161">   },</span>
<a href="#l36.162"></a><span id="l36.162">   /* This function disables the connect/disconnect buttons for</span>
<a href="#l36.163"></a><span id="l36.163">    * `this._disabledDelay` ms before calling disableCommandItems to restore</span>
<a href="#l36.164"></a><span id="l36.164">    * the state of the buttons.</span>
<a href="#l36.165"></a><span id="l36.165">    */</span>
<a href="#l36.166"></a><span id="l36.166" class="difflineminus">-  temporarilyDisableButtons: function am_temporarilyDisableButtons() {</span>
<a href="#l36.167"></a><span id="l36.167" class="difflineplus">+  temporarilyDisableButtons() {</span>
<a href="#l36.168"></a><span id="l36.168">     document.getElementById(&quot;cmd_disconnect&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l36.169"></a><span id="l36.169">     document.getElementById(&quot;cmd_connect&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l36.170"></a><span id="l36.170">     clearTimeout(this.disableTimerID);</span>
<a href="#l36.171"></a><span id="l36.171">     this.accountList.focus();</span>
<a href="#l36.172"></a><span id="l36.172">     this.disableTimerID = setTimeout(function(aItem) {</span>
<a href="#l36.173"></a><span id="l36.173">       gAccountManager.disableTimerID = 0;</span>
<a href="#l36.174"></a><span id="l36.174">       gAccountManager.disableCommandItems();</span>
<a href="#l36.175"></a><span id="l36.175">       aItem.buttons.setFocus();</span>
<a href="#l36.176"></a><span id="l36.176">     }, this._disabledDelay, this.accountList.selectedItem);</span>
<a href="#l36.177"></a><span id="l36.177">   },</span>
<a href="#l36.178"></a><span id="l36.178"> </span>
<a href="#l36.179"></a><span id="l36.179" class="difflineminus">-  new: function am_new() {</span>
<a href="#l36.180"></a><span id="l36.180" class="difflineplus">+  new() {</span>
<a href="#l36.181"></a><span id="l36.181">     this.openDialog(&quot;chrome://messenger/content/chat/imAccountWizard.xul&quot;);</span>
<a href="#l36.182"></a><span id="l36.182">   },</span>
<a href="#l36.183"></a><span id="l36.183" class="difflineminus">-  edit: function am_edit() {</span>
<a href="#l36.184"></a><span id="l36.184" class="difflineplus">+  edit() {</span>
<a href="#l36.185"></a><span id="l36.185">     // Find the nsIIncomingServer for the current imIAccount.</span>
<a href="#l36.186"></a><span id="l36.186">     let server = null;</span>
<a href="#l36.187"></a><span id="l36.187">     let imAccountId = this.accountList.selectedItem.account.numericId;</span>
<a href="#l36.188"></a><span id="l36.188">     let mgr = MailServices.accounts;</span>
<a href="#l36.189"></a><span id="l36.189">     for (let account of fixIterator(mgr.accounts, Ci.nsIMsgAccount)) {</span>
<a href="#l36.190"></a><span id="l36.190">       let incomingServer = account.incomingServer;</span>
<a href="#l36.191"></a><span id="l36.191">       if (!incomingServer || incomingServer.type != &quot;im&quot;)</span>
<a href="#l36.192"></a><span id="l36.192">         continue;</span>
<a href="#l36.193"></a><span id="l36.193" class="difflineat">@@ -304,31 +304,31 @@ var gAccountManager = {</span>
<a href="#l36.194"></a><span id="l36.194">       win.selectServer(server);</span>
<a href="#l36.195"></a><span id="l36.195">     } else {</span>
<a href="#l36.196"></a><span id="l36.196">       window.openDialog(&quot;chrome://messenger/content/AccountManager.xul&quot;,</span>
<a href="#l36.197"></a><span id="l36.197">                         &quot;AccountManager&quot;,</span>
<a href="#l36.198"></a><span id="l36.198">                         &quot;chrome,centerscreen,modal,titlebar,resizable&quot;,</span>
<a href="#l36.199"></a><span id="l36.199">                         { server, selectPage: null });</span>
<a href="#l36.200"></a><span id="l36.200">     }</span>
<a href="#l36.201"></a><span id="l36.201">   },</span>
<a href="#l36.202"></a><span id="l36.202" class="difflineminus">-  autologin: function am_autologin() {</span>
<a href="#l36.203"></a><span id="l36.203" class="difflineplus">+  autologin() {</span>
<a href="#l36.204"></a><span id="l36.204">     var elt = this.accountList.selectedItem;</span>
<a href="#l36.205"></a><span id="l36.205">     elt.autoLogin = !elt.autoLogin;</span>
<a href="#l36.206"></a><span id="l36.206">   },</span>
<a href="#l36.207"></a><span id="l36.207" class="difflineminus">-  close: function am_close() {</span>
<a href="#l36.208"></a><span id="l36.208" class="difflineplus">+  close() {</span>
<a href="#l36.209"></a><span id="l36.209">     // If a modal dialog is opened, we can't close this window now</span>
<a href="#l36.210"></a><span id="l36.210">     if (this.modalDialog)</span>
<a href="#l36.211"></a><span id="l36.211">       setTimeout(function() { window.close(); }, 0);</span>
<a href="#l36.212"></a><span id="l36.212">     else</span>
<a href="#l36.213"></a><span id="l36.213">       window.close();</span>
<a href="#l36.214"></a><span id="l36.214">   },</span>
<a href="#l36.215"></a><span id="l36.215"> </span>
<a href="#l36.216"></a><span id="l36.216">   /* This function disables or enables the currently selected button and</span>
<a href="#l36.217"></a><span id="l36.217">      the corresponding context menu item */</span>
<a href="#l36.218"></a><span id="l36.218" class="difflineminus">-  disableCommandItems: function am_disableCommandItems() {</span>
<a href="#l36.219"></a><span id="l36.219" class="difflineplus">+  disableCommandItems() {</span>
<a href="#l36.220"></a><span id="l36.220">     let accountList = this.accountList;</span>
<a href="#l36.221"></a><span id="l36.221">     let selectedItem = accountList.selectedItem;</span>
<a href="#l36.222"></a><span id="l36.222">     // When opening the account manager, if accounts have errors, we</span>
<a href="#l36.223"></a><span id="l36.223">     // can be called during build(), before any item is selected.</span>
<a href="#l36.224"></a><span id="l36.224">     // In this case, just return early.</span>
<a href="#l36.225"></a><span id="l36.225">     if (!selectedItem)</span>
<a href="#l36.226"></a><span id="l36.226">       return;</span>
<a href="#l36.227"></a><span id="l36.227"> </span>
<a href="#l36.228"></a><span id="l36.228" class="difflineat">@@ -352,17 +352,17 @@ var gAccountManager = {</span>
<a href="#l36.229"></a><span id="l36.229">     for (let [name, state] of disabledItems) {</span>
<a href="#l36.230"></a><span id="l36.230">       let elt = document.getElementById(&quot;cmd_&quot; + name);</span>
<a href="#l36.231"></a><span id="l36.231">       if (state)</span>
<a href="#l36.232"></a><span id="l36.232">         elt.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l36.233"></a><span id="l36.233">       else</span>
<a href="#l36.234"></a><span id="l36.234">         elt.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l36.235"></a><span id="l36.235">     }</span>
<a href="#l36.236"></a><span id="l36.236">   },</span>
<a href="#l36.237"></a><span id="l36.237" class="difflineminus">-  onContextMenuShowing: function am_onContextMenuShowing() {</span>
<a href="#l36.238"></a><span id="l36.238" class="difflineplus">+  onContextMenuShowing() {</span>
<a href="#l36.239"></a><span id="l36.239">     let targetElt = document.popupNode;</span>
<a href="#l36.240"></a><span id="l36.240">     let isAccount = targetElt instanceof Ci.nsIDOMXULSelectControlItemElement;</span>
<a href="#l36.241"></a><span id="l36.241">     document.querySelector(&quot;.im-context-account-item&quot;).forEach(e =&gt; {</span>
<a href="#l36.242"></a><span id="l36.242">       e.hidden = !isAccount;</span>
<a href="#l36.243"></a><span id="l36.243">     });</span>
<a href="#l36.244"></a><span id="l36.244">     if (isAccount) {</span>
<a href="#l36.245"></a><span id="l36.245">       let account = targetElt.account;</span>
<a href="#l36.246"></a><span id="l36.246">       let hiddenItems = {</span>
<a href="#l36.247"></a><span id="l36.247" class="difflineat">@@ -371,36 +371,36 @@ var gAccountManager = {</span>
<a href="#l36.248"></a><span id="l36.248">         cancelReconnection: !targetElt.hasAttribute(&quot;reconnectPending&quot;),</span>
<a href="#l36.249"></a><span id="l36.249">         accountsItemsSeparator: account.disconnecting,</span>
<a href="#l36.250"></a><span id="l36.250">       };</span>
<a href="#l36.251"></a><span id="l36.251">       for (let name in hiddenItems)</span>
<a href="#l36.252"></a><span id="l36.252">         document.getElementById(&quot;context_&quot; + name).hidden = hiddenItems[name];</span>
<a href="#l36.253"></a><span id="l36.253">     }</span>
<a href="#l36.254"></a><span id="l36.254">   },</span>
<a href="#l36.255"></a><span id="l36.255"> </span>
<a href="#l36.256"></a><span id="l36.256" class="difflineminus">-  selectAccount: function am_selectAccount(aAccountId) {</span>
<a href="#l36.257"></a><span id="l36.257" class="difflineplus">+  selectAccount(aAccountId) {</span>
<a href="#l36.258"></a><span id="l36.258">     this.accountList.selectedItem = document.getElementById(aAccountId);</span>
<a href="#l36.259"></a><span id="l36.259">     this.accountList.ensureSelectedElementIsVisible();</span>
<a href="#l36.260"></a><span id="l36.260">   },</span>
<a href="#l36.261"></a><span id="l36.261" class="difflineminus">-  onAccountSelect: function am_onAccountSelect() {</span>
<a href="#l36.262"></a><span id="l36.262" class="difflineplus">+  onAccountSelect() {</span>
<a href="#l36.263"></a><span id="l36.263">     clearTimeout(this.disableTimerID);</span>
<a href="#l36.264"></a><span id="l36.264">     this.disableTimerID = 0;</span>
<a href="#l36.265"></a><span id="l36.265">     this.disableCommandItems();</span>
<a href="#l36.266"></a><span id="l36.266">     // Horrible hack here too, see Bug 177</span>
<a href="#l36.267"></a><span id="l36.267">     setTimeout(function(aThis) {</span>
<a href="#l36.268"></a><span id="l36.268">       try {</span>
<a href="#l36.269"></a><span id="l36.269">         aThis.accountList.selectedItem.buttons.setFocus();</span>
<a href="#l36.270"></a><span id="l36.270">       } catch (e) {</span>
<a href="#l36.271"></a><span id="l36.271">         /* Sometimes if the user goes too fast with VK_UP or VK_DOWN, the</span>
<a href="#l36.272"></a><span id="l36.272">            selectedItem doesn't have the expected binding attached */</span>
<a href="#l36.273"></a><span id="l36.273">       }</span>
<a href="#l36.274"></a><span id="l36.274">     }, 0, this);</span>
<a href="#l36.275"></a><span id="l36.275">   },</span>
<a href="#l36.276"></a><span id="l36.276"> </span>
<a href="#l36.277"></a><span id="l36.277" class="difflineminus">-  onKeyPress: function am_onKeyPress(event) {</span>
<a href="#l36.278"></a><span id="l36.278" class="difflineplus">+  onKeyPress(event) {</span>
<a href="#l36.279"></a><span id="l36.279">     if (!this.selectedItem)</span>
<a href="#l36.280"></a><span id="l36.280">       return;</span>
<a href="#l36.281"></a><span id="l36.281"> </span>
<a href="#l36.282"></a><span id="l36.282">     if (event.shiftKey &amp;&amp;</span>
<a href="#l36.283"></a><span id="l36.283">         (event.keyCode == event.DOM_VK_DOWN || event.keyCode == event.DOM_VK_UP)) {</span>
<a href="#l36.284"></a><span id="l36.284">       let offset = event.keyCode == event.DOM_VK_DOWN ? 1 : -1;</span>
<a href="#l36.285"></a><span id="l36.285">       gAccountManager.moveCurrentItem(offset);</span>
<a href="#l36.286"></a><span id="l36.286">       event.stopPropagation();</span>
<a href="#l36.287"></a><span id="l36.287" class="difflineat">@@ -428,17 +428,17 @@ var gAccountManager = {</span>
<a href="#l36.288"></a><span id="l36.288">       let target = event.originalTarget;</span>
<a href="#l36.289"></a><span id="l36.289">       if (target.localName != &quot;checkbox&quot; &amp;&amp;</span>
<a href="#l36.290"></a><span id="l36.290">           (target.localName != &quot;button&quot; ||</span>
<a href="#l36.291"></a><span id="l36.291">            /^(dis)?connect$/.test(target.getAttribute(&quot;anonid&quot;))))</span>
<a href="#l36.292"></a><span id="l36.292">         this.selectedItem.buttons.proceedDefaultAction();</span>
<a href="#l36.293"></a><span id="l36.293">     }</span>
<a href="#l36.294"></a><span id="l36.294">   },</span>
<a href="#l36.295"></a><span id="l36.295"> </span>
<a href="#l36.296"></a><span id="l36.296" class="difflineminus">-  moveCurrentItem: function am_moveCurrentItem(aOffset) {</span>
<a href="#l36.297"></a><span id="l36.297" class="difflineplus">+  moveCurrentItem(aOffset) {</span>
<a href="#l36.298"></a><span id="l36.298">     let accountList = this.accountList;</span>
<a href="#l36.299"></a><span id="l36.299">     if (!aOffset || !accountList.selectedItem)</span>
<a href="#l36.300"></a><span id="l36.300">       return;</span>
<a href="#l36.301"></a><span id="l36.301"> </span>
<a href="#l36.302"></a><span id="l36.302">     // Create the new preference value from the richlistbox list</span>
<a href="#l36.303"></a><span id="l36.303">     let items = accountList.itemChildren;</span>
<a href="#l36.304"></a><span id="l36.304">     let selectedID = accountList.selectedItem.id;</span>
<a href="#l36.305"></a><span id="l36.305">     let array = [];</span>
<a href="#l36.306"></a><span id="l36.306" class="difflineat">@@ -451,28 +451,28 @@ var gAccountManager = {</span>
<a href="#l36.307"></a><span id="l36.307">       newIndex = 0;</span>
<a href="#l36.308"></a><span id="l36.308">     else if (newIndex &gt;= accountList.itemCount)</span>
<a href="#l36.309"></a><span id="l36.309">       newIndex = accountList.itemCount - 1;</span>
<a href="#l36.310"></a><span id="l36.310">     array.splice(newIndex, 0, selectedID);</span>
<a href="#l36.311"></a><span id="l36.311"> </span>
<a href="#l36.312"></a><span id="l36.312">     Services.prefs.setCharPref(&quot;messenger.accounts&quot;, array.join(&quot;,&quot;));</span>
<a href="#l36.313"></a><span id="l36.313">   },</span>
<a href="#l36.314"></a><span id="l36.314"> </span>
<a href="#l36.315"></a><span id="l36.315" class="difflineminus">-  getAccounts: function* am_getAccounts() {</span>
<a href="#l36.316"></a><span id="l36.316" class="difflineplus">+  * getAccounts() {</span>
<a href="#l36.317"></a><span id="l36.317">     let accounts = Services.accounts.getAccounts();</span>
<a href="#l36.318"></a><span id="l36.318">     while (accounts.hasMoreElements())</span>
<a href="#l36.319"></a><span id="l36.319">       yield accounts.getNext();</span>
<a href="#l36.320"></a><span id="l36.320">   },</span>
<a href="#l36.321"></a><span id="l36.321"> </span>
<a href="#l36.322"></a><span id="l36.322" class="difflineminus">-  openDialog: function am_openDialog(aUrl, aArgs) {</span>
<a href="#l36.323"></a><span id="l36.323" class="difflineplus">+  openDialog(aUrl, aArgs) {</span>
<a href="#l36.324"></a><span id="l36.324">     this.modalDialog = true;</span>
<a href="#l36.325"></a><span id="l36.325">     window.openDialog(aUrl, &quot;&quot;, &quot;chrome,modal,titlebar,centerscreen&quot;, aArgs);</span>
<a href="#l36.326"></a><span id="l36.326">     this.modalDialog = false;</span>
<a href="#l36.327"></a><span id="l36.327">   },</span>
<a href="#l36.328"></a><span id="l36.328" class="difflineminus">-  setAutoLoginNotification: function am_setAutoLoginNotification() {</span>
<a href="#l36.329"></a><span id="l36.329" class="difflineplus">+  setAutoLoginNotification() {</span>
<a href="#l36.330"></a><span id="l36.330">     var as = Services.accounts;</span>
<a href="#l36.331"></a><span id="l36.331">     var autoLoginStatus = as.autoLoginStatus;</span>
<a href="#l36.332"></a><span id="l36.332">     let isOffline = false;</span>
<a href="#l36.333"></a><span id="l36.333">     let crashCount = 0;</span>
<a href="#l36.334"></a><span id="l36.334">     for (let acc of this.getAccounts())</span>
<a href="#l36.335"></a><span id="l36.335">       if (acc.autoLogin &amp;&amp; acc.firstConnectionState == acc.FIRST_CONNECTION_CRASHED)</span>
<a href="#l36.336"></a><span id="l36.336">         ++crashCount;</span>
<a href="#l36.337"></a><span id="l36.337"> </span>
<a href="#l36.338"></a><span id="l36.338" class="difflineat">@@ -525,41 +525,41 @@ var gAccountManager = {</span>
<a href="#l36.339"></a><span id="l36.339">       default:</span>
<a href="#l36.340"></a><span id="l36.340">         label = bundle.getString(&quot;accountsManager.notification.other.label&quot;);</span>
<a href="#l36.341"></a><span id="l36.341">     }</span>
<a href="#l36.342"></a><span id="l36.342">     let status = Services.core.globalUserStatus.statusType;</span>
<a href="#l36.343"></a><span id="l36.343">     this.setOffline(isOffline || status == Ci.imIStatusInfo.STATUS_OFFLINE);</span>
<a href="#l36.344"></a><span id="l36.344"> </span>
<a href="#l36.345"></a><span id="l36.345">     box.appendNotification(label, &quot;autologinStatus&quot;, null, priority, [connectNowButton]);</span>
<a href="#l36.346"></a><span id="l36.346">   },</span>
<a href="#l36.347"></a><span id="l36.347" class="difflineminus">-  processAutoLogin: function am_processAutoLogin() {</span>
<a href="#l36.348"></a><span id="l36.348" class="difflineplus">+  processAutoLogin() {</span>
<a href="#l36.349"></a><span id="l36.349">     var ioService = Services.io;</span>
<a href="#l36.350"></a><span id="l36.350">     if (ioService.offline) {</span>
<a href="#l36.351"></a><span id="l36.351">       ioService.manageOfflineStatus = false;</span>
<a href="#l36.352"></a><span id="l36.352">       ioService.offline = false;</span>
<a href="#l36.353"></a><span id="l36.353">     }</span>
<a href="#l36.354"></a><span id="l36.354"> </span>
<a href="#l36.355"></a><span id="l36.355">     Services.accounts.processAutoLogin();</span>
<a href="#l36.356"></a><span id="l36.356"> </span>
<a href="#l36.357"></a><span id="l36.357">     gAccountManager.accountList.selectedItem.buttons.setFocus();</span>
<a href="#l36.358"></a><span id="l36.358">   },</span>
<a href="#l36.359"></a><span id="l36.359" class="difflineminus">-  processCrashedAccountsLogin: function am_processCrashedAccountsLogin() {</span>
<a href="#l36.360"></a><span id="l36.360" class="difflineplus">+  processCrashedAccountsLogin() {</span>
<a href="#l36.361"></a><span id="l36.361">     for (let acc in gAccountManager.getAccounts())</span>
<a href="#l36.362"></a><span id="l36.362">       if (acc.disconnected &amp;&amp; acc.autoLogin &amp;&amp;</span>
<a href="#l36.363"></a><span id="l36.363">           acc.firstConnectionState == acc.FIRST_CONNECTION_CRASHED)</span>
<a href="#l36.364"></a><span id="l36.364">         acc.connect();</span>
<a href="#l36.365"></a><span id="l36.365"> </span>
<a href="#l36.366"></a><span id="l36.366">     let notification = document.getElementById(&quot;accountsNotificationBox&quot;)</span>
<a href="#l36.367"></a><span id="l36.367">                                .getNotificationWithValue(&quot;autoLoginStatus&quot;);</span>
<a href="#l36.368"></a><span id="l36.368">     if (notification)</span>
<a href="#l36.369"></a><span id="l36.369">       notification.close();</span>
<a href="#l36.370"></a><span id="l36.370"> </span>
<a href="#l36.371"></a><span id="l36.371">     gAccountManager.accountList.selectedItem.buttons.setFocus();</span>
<a href="#l36.372"></a><span id="l36.372">   },</span>
<a href="#l36.373"></a><span id="l36.373" class="difflineminus">-  setOffline: function am_setOffline(aState) {</span>
<a href="#l36.374"></a><span id="l36.374" class="difflineplus">+  setOffline(aState) {</span>
<a href="#l36.375"></a><span id="l36.375">     this.isOffline = aState;</span>
<a href="#l36.376"></a><span id="l36.376">     if (aState)</span>
<a href="#l36.377"></a><span id="l36.377">       this.accountList.setAttribute(&quot;offline&quot;, &quot;true&quot;);</span>
<a href="#l36.378"></a><span id="l36.378">     else</span>
<a href="#l36.379"></a><span id="l36.379">       this.accountList.removeAttribute(&quot;offline&quot;);</span>
<a href="#l36.380"></a><span id="l36.380">     this.disableCommandItems();</span>
<a href="#l36.381"></a><span id="l36.381">   },</span>
<a href="#l36.382"></a><span id="l36.382"> };</span>
<a href="#l36.383"></a><span id="l36.383" class="difflineat">@@ -572,30 +572,30 @@ var gAMDragAndDrop = {</span>
<a href="#l36.384"></a><span id="l36.384"> </span>
<a href="#l36.385"></a><span id="l36.385">   // A preference already exists to define scroll speed, let's use it.</span>
<a href="#l36.386"></a><span id="l36.386">   get SCROLL_SPEED() {</span>
<a href="#l36.387"></a><span id="l36.387">     delete this.SCROLL_SPEED;</span>
<a href="#l36.388"></a><span id="l36.388">     this.SCROLL_SPEED = Services.prefs.getIntPref(&quot;toolkit.scrollbox.scrollIncrement&quot;, 20);</span>
<a href="#l36.389"></a><span id="l36.389">     return this.SCROLL_SPEED;</span>
<a href="#l36.390"></a><span id="l36.390">   },</span>
<a href="#l36.391"></a><span id="l36.391"> </span>
<a href="#l36.392"></a><span id="l36.392" class="difflineminus">-  onDragStart: function amdnd_onDragStart(aEvent, aTransferData, aAction) {</span>
<a href="#l36.393"></a><span id="l36.393" class="difflineplus">+  onDragStart(aEvent, aTransferData, aAction) {</span>
<a href="#l36.394"></a><span id="l36.394">     let accountElement = aEvent.explicitOriginalTarget;</span>
<a href="#l36.395"></a><span id="l36.395">     // This stops the dragging session.</span>
<a href="#l36.396"></a><span id="l36.396">     if (!(accountElement instanceof Ci.nsIDOMXULSelectControlItemElement))</span>
<a href="#l36.397"></a><span id="l36.397">       throw &quot;Element is not draggable!&quot;;</span>
<a href="#l36.398"></a><span id="l36.398">     if (gAccountManager.accountList.itemCount == 1)</span>
<a href="#l36.399"></a><span id="l36.399">       throw &quot;Can't drag while there is only one account!&quot;;</span>
<a href="#l36.400"></a><span id="l36.400"> </span>
<a href="#l36.401"></a><span id="l36.401">     // Transferdata is never used, but we need to transfer something.</span>
<a href="#l36.402"></a><span id="l36.402">     aTransferData.data = new TransferData();</span>
<a href="#l36.403"></a><span id="l36.403">     aTransferData.data.addDataForFlavour(this.ACCOUNT_MIME_TYPE, accountElement);</span>
<a href="#l36.404"></a><span id="l36.404">   },</span>
<a href="#l36.405"></a><span id="l36.405"> </span>
<a href="#l36.406"></a><span id="l36.406" class="difflineminus">-  onDragOver: function amdnd_onDragOver(aEvent, aFlavour, aSession) {</span>
<a href="#l36.407"></a><span id="l36.407" class="difflineplus">+  onDragOver(aEvent, aFlavour, aSession) {</span>
<a href="#l36.408"></a><span id="l36.408">     let accountElement = aEvent.explicitOriginalTarget;</span>
<a href="#l36.409"></a><span id="l36.409">     // We are dragging over the account manager, consider it is the same as</span>
<a href="#l36.410"></a><span id="l36.410">     // the last element.</span>
<a href="#l36.411"></a><span id="l36.411">     if (accountElement == gAccountManager.accountList)</span>
<a href="#l36.412"></a><span id="l36.412">       accountElement = gAccountManager.accountList.lastChild;</span>
<a href="#l36.413"></a><span id="l36.413"> </span>
<a href="#l36.414"></a><span id="l36.414">     // Auto scroll the account list if we are dragging at the top/bottom</span>
<a href="#l36.415"></a><span id="l36.415">     this.checkForMagicScroll(aEvent.clientY);</span>
<a href="#l36.416"></a><span id="l36.416" class="difflineat">@@ -623,54 +623,54 @@ var gAMDragAndDrop = {</span>
<a href="#l36.417"></a><span id="l36.417">           accountElement.getAttribute(&quot;dragover&quot;) == &quot;up&quot;)</span>
<a href="#l36.418"></a><span id="l36.418">         this.cleanBorders();</span>
<a href="#l36.419"></a><span id="l36.419">       accountElement.setAttribute(&quot;dragover&quot;, &quot;down&quot;);</span>
<a href="#l36.420"></a><span id="l36.420">     }</span>
<a href="#l36.421"></a><span id="l36.421"> </span>
<a href="#l36.422"></a><span id="l36.422">     this._accountElement = accountElement;</span>
<a href="#l36.423"></a><span id="l36.423">   },</span>
<a href="#l36.424"></a><span id="l36.424"> </span>
<a href="#l36.425"></a><span id="l36.425" class="difflineminus">-  cleanBorders: function amdnd_cleanBorders(aIsEnd) {</span>
<a href="#l36.426"></a><span id="l36.426" class="difflineplus">+  cleanBorders(aIsEnd) {</span>
<a href="#l36.427"></a><span id="l36.427">     if (!this._accountElement)</span>
<a href="#l36.428"></a><span id="l36.428">       return;</span>
<a href="#l36.429"></a><span id="l36.429"> </span>
<a href="#l36.430"></a><span id="l36.430">     this._accountElement.removeAttribute(&quot;dragover&quot;);</span>
<a href="#l36.431"></a><span id="l36.431">     // reset the border of the previous element</span>
<a href="#l36.432"></a><span id="l36.432">     let previousItem = this._accountElement.previousSibling;</span>
<a href="#l36.433"></a><span id="l36.433">     if (previousItem) {</span>
<a href="#l36.434"></a><span id="l36.434">       if (aIsEnd &amp;&amp; !previousItem.style.borderBottom &amp;&amp; previousItem.previousSibling)</span>
<a href="#l36.435"></a><span id="l36.435">         previousItem = previousItem.previousSibling;</span>
<a href="#l36.436"></a><span id="l36.436">       previousItem.style.borderBottom = &quot;&quot;;</span>
<a href="#l36.437"></a><span id="l36.437">     }</span>
<a href="#l36.438"></a><span id="l36.438"> </span>
<a href="#l36.439"></a><span id="l36.439">     if (aIsEnd)</span>
<a href="#l36.440"></a><span id="l36.440">       delete this._accountElement;</span>
<a href="#l36.441"></a><span id="l36.441">   },</span>
<a href="#l36.442"></a><span id="l36.442"> </span>
<a href="#l36.443"></a><span id="l36.443" class="difflineminus">-  canDrop: function amdnd_canDrop(aEvent, aSession) {</span>
<a href="#l36.444"></a><span id="l36.444" class="difflineplus">+  canDrop(aEvent, aSession) {</span>
<a href="#l36.445"></a><span id="l36.445">     let accountElement = aEvent.explicitOriginalTarget;</span>
<a href="#l36.446"></a><span id="l36.446">     if (accountElement == gAccountManager.accountList)</span>
<a href="#l36.447"></a><span id="l36.447">       accountElement = gAccountManager.accountList.lastChild;</span>
<a href="#l36.448"></a><span id="l36.448">     return (accountElement != gAccountManager.accountList.selectedItem);</span>
<a href="#l36.449"></a><span id="l36.449">   },</span>
<a href="#l36.450"></a><span id="l36.450"> </span>
<a href="#l36.451"></a><span id="l36.451" class="difflineminus">-  checkForMagicScroll: function amdnd_checkForMagicScroll(aClientY) {</span>
<a href="#l36.452"></a><span id="l36.452" class="difflineplus">+  checkForMagicScroll(aClientY) {</span>
<a href="#l36.453"></a><span id="l36.453">     let accountList = gAccountManager.accountList;</span>
<a href="#l36.454"></a><span id="l36.454">     let listSize = accountList.getBoundingClientRect();</span>
<a href="#l36.455"></a><span id="l36.455">     let direction = 1;</span>
<a href="#l36.456"></a><span id="l36.456">     if (aClientY &lt; listSize.top + this.MAGIC_SCROLL_HEIGHT)</span>
<a href="#l36.457"></a><span id="l36.457">       direction = -1;</span>
<a href="#l36.458"></a><span id="l36.458">     else if (aClientY &lt; listSize.bottom - this.MAGIC_SCROLL_HEIGHT)</span>
<a href="#l36.459"></a><span id="l36.459">       // We are not on a scroll zone</span>
<a href="#l36.460"></a><span id="l36.460">       return;</span>
<a href="#l36.461"></a><span id="l36.461"> </span>
<a href="#l36.462"></a><span id="l36.462">     accountList._scrollbox.scrollTop += direction * this.SCROLL_SPEED;</span>
<a href="#l36.463"></a><span id="l36.463">   },</span>
<a href="#l36.464"></a><span id="l36.464"> </span>
<a href="#l36.465"></a><span id="l36.465" class="difflineminus">-  onDrop: function amdnd_onDrop(aEvent, aTransferData, aSession) {</span>
<a href="#l36.466"></a><span id="l36.466" class="difflineplus">+  onDrop(aEvent, aTransferData, aSession) {</span>
<a href="#l36.467"></a><span id="l36.467">     let accountElement = aEvent.explicitOriginalTarget;</span>
<a href="#l36.468"></a><span id="l36.468">     if (accountElement == gAccountManager.accountList)</span>
<a href="#l36.469"></a><span id="l36.469">       accountElement = gAccountManager.accountList.lastChild;</span>
<a href="#l36.470"></a><span id="l36.470"> </span>
<a href="#l36.471"></a><span id="l36.471">      if (!aSession.canDrop)</span>
<a href="#l36.472"></a><span id="l36.472">       return;</span>
<a href="#l36.473"></a><span id="l36.473"> </span>
<a href="#l36.474"></a><span id="l36.474">     // compute the destination</span>
<a href="#l36.475"></a><span id="l36.475" class="difflineat">@@ -682,17 +682,17 @@ var gAMDragAndDrop = {</span>
<a href="#l36.476"></a><span id="l36.476">                        accountElement.clientHeight / 2;</span>
<a href="#l36.477"></a><span id="l36.477">     if (offset &gt; 0)</span>
<a href="#l36.478"></a><span id="l36.478">       offset -= isDroppingAbove;</span>
<a href="#l36.479"></a><span id="l36.479">     else</span>
<a href="#l36.480"></a><span id="l36.480">       offset += !isDroppingAbove;</span>
<a href="#l36.481"></a><span id="l36.481">     gAccountManager.moveCurrentItem(offset);</span>
<a href="#l36.482"></a><span id="l36.482">   },</span>
<a href="#l36.483"></a><span id="l36.483"> </span>
<a href="#l36.484"></a><span id="l36.484" class="difflineminus">-  getSupportedFlavours: function amdnd_getSupportedFlavours() {</span>
<a href="#l36.485"></a><span id="l36.485" class="difflineplus">+  getSupportedFlavours() {</span>
<a href="#l36.486"></a><span id="l36.486">     var flavours = new FlavourSet();</span>
<a href="#l36.487"></a><span id="l36.487">     flavours.appendFlavour(this.ACCOUNT_MIME_TYPE,</span>
<a href="#l36.488"></a><span id="l36.488">                            &quot;nsIDOMXULSelectControlItemElement&quot;);</span>
<a href="#l36.489"></a><span id="l36.489">     return flavours;</span>
<a href="#l36.490"></a><span id="l36.490">   },</span>
<a href="#l36.491"></a><span id="l36.491"> };</span>
<a href="#l36.492"></a><span id="l36.492"> </span>
<a href="#l36.493"></a><span id="l36.493"> window.addEventListener(&quot;DOMContentLoaded&quot;, () =&gt; { gAccountManager.load(); });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mail/components/im/content/imContextMenu.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mail/components/im/content/imContextMenu.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -40,17 +40,17 @@ imContextMenu.prototype = {</span>
<a href="#l37.4"></a><span id="l37.4">     while (elt &amp;&amp; elt.localName != &quot;menuseparator&quot;) {</span>
<a href="#l37.5"></a><span id="l37.5">       let tmp = elt.nextSibling;</span>
<a href="#l37.6"></a><span id="l37.6">       elt.remove();</span>
<a href="#l37.7"></a><span id="l37.7">       elt = tmp;</span>
<a href="#l37.8"></a><span id="l37.8">     }</span>
<a href="#l37.9"></a><span id="l37.9">   },</span>
<a href="#l37.10"></a><span id="l37.10"> </span>
<a href="#l37.11"></a><span id="l37.11">   // Initialize context menu.</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-  initMenu: function CM_initMenu(aPopup) {</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+  initMenu(aPopup) {</span>
<a href="#l37.14"></a><span id="l37.14">     this.menu = aPopup;</span>
<a href="#l37.15"></a><span id="l37.15"> </span>
<a href="#l37.16"></a><span id="l37.16">     // Get contextual info.</span>
<a href="#l37.17"></a><span id="l37.17">     let node = document.popupNode;</span>
<a href="#l37.18"></a><span id="l37.18">     this.setTarget(node);</span>
<a href="#l37.19"></a><span id="l37.19"> </span>
<a href="#l37.20"></a><span id="l37.20">     let actions = [];</span>
<a href="#l37.21"></a><span id="l37.21">     while (node) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mail/components/im/content/imStatusSelector.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mail/components/im/content/imStatusSelector.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -4,91 +4,91 @@</span>
<a href="#l38.4"></a><span id="l38.4"> </span>
<a href="#l38.5"></a><span id="l38.5"> // chat/modules/imTextboxUtils.jsm</span>
<a href="#l38.6"></a><span id="l38.6"> /* globals TextboxSpellChecker */</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8"> var { Status } = ChromeUtils.import(&quot;resource:///modules/imStatusUtils.jsm&quot;, null);</span>
<a href="#l38.9"></a><span id="l38.9"> var { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;, null);</span>
<a href="#l38.10"></a><span id="l38.10"> </span>
<a href="#l38.11"></a><span id="l38.11"> var statusSelector = {</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-  observe: function ss_observe(aSubject, aTopic, aMsg) {</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+  observe(aSubject, aTopic, aMsg) {</span>
<a href="#l38.14"></a><span id="l38.14">     if (aTopic == &quot;status-changed&quot;)</span>
<a href="#l38.15"></a><span id="l38.15">       this.displayCurrentStatus();</span>
<a href="#l38.16"></a><span id="l38.16">     else if (aTopic == &quot;user-icon-changed&quot;)</span>
<a href="#l38.17"></a><span id="l38.17">       this.displayUserIcon();</span>
<a href="#l38.18"></a><span id="l38.18">     else if (aTopic == &quot;user-display-name-changed&quot;)</span>
<a href="#l38.19"></a><span id="l38.19">       this.displayUserDisplayName();</span>
<a href="#l38.20"></a><span id="l38.20">   },</span>
<a href="#l38.21"></a><span id="l38.21"> </span>
<a href="#l38.22"></a><span id="l38.22" class="difflineminus">-  displayUserIcon: function ss_displayUserIcon() {</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineplus">+  displayUserIcon() {</span>
<a href="#l38.24"></a><span id="l38.24">     let icon = Services.core.globalUserStatus.getUserIcon();</span>
<a href="#l38.25"></a><span id="l38.25">     document.getElementById(&quot;userIcon&quot;).src = icon ? icon.spec : &quot;&quot;;</span>
<a href="#l38.26"></a><span id="l38.26">   },</span>
<a href="#l38.27"></a><span id="l38.27"> </span>
<a href="#l38.28"></a><span id="l38.28" class="difflineminus">-  displayUserDisplayName: function ss_displayUserDisplayName() {</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineplus">+  displayUserDisplayName() {</span>
<a href="#l38.30"></a><span id="l38.30">     let displayName = Services.core.globalUserStatus.displayName;</span>
<a href="#l38.31"></a><span id="l38.31">     let elt = document.getElementById(&quot;displayName&quot;);</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineminus">-    if (displayName)</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineplus">+    if (displayName) {</span>
<a href="#l38.34"></a><span id="l38.34">       elt.removeAttribute(&quot;usingDefault&quot;);</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">-    else {</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineplus">+    } else {</span>
<a href="#l38.37"></a><span id="l38.37">       let bundle = document.getElementById(&quot;chatBundle&quot;);</span>
<a href="#l38.38"></a><span id="l38.38">       displayName = bundle.getString(&quot;displayNameEmptyText&quot;);</span>
<a href="#l38.39"></a><span id="l38.39">       elt.setAttribute(&quot;usingDefault&quot;, displayName);</span>
<a href="#l38.40"></a><span id="l38.40">     }</span>
<a href="#l38.41"></a><span id="l38.41">     elt.setAttribute(&quot;value&quot;, displayName);</span>
<a href="#l38.42"></a><span id="l38.42">   },</span>
<a href="#l38.43"></a><span id="l38.43"> </span>
<a href="#l38.44"></a><span id="l38.44" class="difflineminus">-  displayStatusType: function ss_displayStatusType(aStatusType) {</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineplus">+  displayStatusType(aStatusType) {</span>
<a href="#l38.46"></a><span id="l38.46">     document.getElementById(&quot;statusMessage&quot;)</span>
<a href="#l38.47"></a><span id="l38.47">             .setAttribute(&quot;statusType&quot;, aStatusType);</span>
<a href="#l38.48"></a><span id="l38.48">     let statusString = Status.toLabel(aStatusType);</span>
<a href="#l38.49"></a><span id="l38.49">     let statusTypeIcon = document.getElementById(&quot;statusTypeIcon&quot;);</span>
<a href="#l38.50"></a><span id="l38.50">     statusTypeIcon.setAttribute(&quot;status&quot;, aStatusType);</span>
<a href="#l38.51"></a><span id="l38.51">     statusTypeIcon.setAttribute(&quot;tooltiptext&quot;, statusString);</span>
<a href="#l38.52"></a><span id="l38.52">     return statusString;</span>
<a href="#l38.53"></a><span id="l38.53">   },</span>
<a href="#l38.54"></a><span id="l38.54"> </span>
<a href="#l38.55"></a><span id="l38.55" class="difflineminus">-  displayCurrentStatus: function ss_displayCurrentStatus() {</span>
<a href="#l38.56"></a><span id="l38.56" class="difflineplus">+  displayCurrentStatus() {</span>
<a href="#l38.57"></a><span id="l38.57">     let us = Services.core.globalUserStatus;</span>
<a href="#l38.58"></a><span id="l38.58">     let status = Status.toAttribute(us.statusType);</span>
<a href="#l38.59"></a><span id="l38.59">     let message = status == &quot;offline&quot; ? &quot;&quot; : us.statusText;</span>
<a href="#l38.60"></a><span id="l38.60">     let statusMessage = document.getElementById(&quot;statusMessage&quot;);</span>
<a href="#l38.61"></a><span id="l38.61">     if (!statusMessage) // Chat toolbar not in the DOM yet</span>
<a href="#l38.62"></a><span id="l38.62">       return;</span>
<a href="#l38.63"></a><span id="l38.63" class="difflineminus">-    if (message)</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineplus">+    if (message) {</span>
<a href="#l38.65"></a><span id="l38.65">       statusMessage.removeAttribute(&quot;usingDefault&quot;);</span>
<a href="#l38.66"></a><span id="l38.66" class="difflineminus">-    else {</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineplus">+    } else {</span>
<a href="#l38.68"></a><span id="l38.68">       let statusString = this.displayStatusType(status);</span>
<a href="#l38.69"></a><span id="l38.69">       statusMessage.setAttribute(&quot;usingDefault&quot;, statusString);</span>
<a href="#l38.70"></a><span id="l38.70">       message = statusString;</span>
<a href="#l38.71"></a><span id="l38.71">     }</span>
<a href="#l38.72"></a><span id="l38.72">     statusMessage.setAttribute(&quot;value&quot;, message);</span>
<a href="#l38.73"></a><span id="l38.73">     statusMessage.setAttribute(&quot;tooltiptext&quot;, message);</span>
<a href="#l38.74"></a><span id="l38.74">   },</span>
<a href="#l38.75"></a><span id="l38.75"> </span>
<a href="#l38.76"></a><span id="l38.76" class="difflineminus">-  editStatus: function ss_editStatus(aEvent) {</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineplus">+  editStatus(aEvent) {</span>
<a href="#l38.78"></a><span id="l38.78">     let status = aEvent.originalTarget.getAttribute(&quot;status&quot;);</span>
<a href="#l38.79"></a><span id="l38.79">     if (status == &quot;offline&quot;)</span>
<a href="#l38.80"></a><span id="l38.80">       Services.core.globalUserStatus.setStatus(Ci.imIStatusInfo.STATUS_OFFLINE, &quot;&quot;);</span>
<a href="#l38.81"></a><span id="l38.81">     else if (status)</span>
<a href="#l38.82"></a><span id="l38.82">       this.startEditStatus(status);</span>
<a href="#l38.83"></a><span id="l38.83">   },</span>
<a href="#l38.84"></a><span id="l38.84"> </span>
<a href="#l38.85"></a><span id="l38.85" class="difflineminus">-  startEditStatus: function ss_startEditStatus(aStatusType) {</span>
<a href="#l38.86"></a><span id="l38.86" class="difflineplus">+  startEditStatus(aStatusType) {</span>
<a href="#l38.87"></a><span id="l38.87">     let currentStatusType =</span>
<a href="#l38.88"></a><span id="l38.88">       document.getElementById(&quot;statusTypeIcon&quot;).getAttribute(&quot;status&quot;);</span>
<a href="#l38.89"></a><span id="l38.89">     if (aStatusType != currentStatusType) {</span>
<a href="#l38.90"></a><span id="l38.90">       this._statusTypeBeforeEditing = currentStatusType;</span>
<a href="#l38.91"></a><span id="l38.91">       this._statusTypeEditing = aStatusType;</span>
<a href="#l38.92"></a><span id="l38.92">       this.displayStatusType(aStatusType);</span>
<a href="#l38.93"></a><span id="l38.93">     }</span>
<a href="#l38.94"></a><span id="l38.94">     this.statusMessageClick();</span>
<a href="#l38.95"></a><span id="l38.95">   },</span>
<a href="#l38.96"></a><span id="l38.96"> </span>
<a href="#l38.97"></a><span id="l38.97" class="difflineminus">-  statusMessageClick: function ss_statusMessageClick() {</span>
<a href="#l38.98"></a><span id="l38.98" class="difflineplus">+  statusMessageClick() {</span>
<a href="#l38.99"></a><span id="l38.99">     let elt = document.getElementById(&quot;statusMessage&quot;);</span>
<a href="#l38.100"></a><span id="l38.100">     let statusType =</span>
<a href="#l38.101"></a><span id="l38.101">       document.getElementById(&quot;statusTypeIcon&quot;).getAttribute(&quot;status&quot;);</span>
<a href="#l38.102"></a><span id="l38.102">     if (statusType == &quot;offline&quot; || elt.disabled)</span>
<a href="#l38.103"></a><span id="l38.103">       return;</span>
<a href="#l38.104"></a><span id="l38.104"> </span>
<a href="#l38.105"></a><span id="l38.105">     if (!elt.hasAttribute(&quot;editing&quot;)) {</span>
<a href="#l38.106"></a><span id="l38.106">       elt.setAttribute(&quot;editing&quot;, &quot;true&quot;);</span>
<a href="#l38.107"></a><span id="l38.107" class="difflineat">@@ -106,30 +106,30 @@ var statusSelector = {</span>
<a href="#l38.108"></a><span id="l38.108">       // force binding attachment by forcing layout</span>
<a href="#l38.109"></a><span id="l38.109">       elt.getBoundingClientRect();</span>
<a href="#l38.110"></a><span id="l38.110">       elt.select();</span>
<a href="#l38.111"></a><span id="l38.111">     }</span>
<a href="#l38.112"></a><span id="l38.112"> </span>
<a href="#l38.113"></a><span id="l38.113">     this.statusMessageRefreshTimer();</span>
<a href="#l38.114"></a><span id="l38.114">   },</span>
<a href="#l38.115"></a><span id="l38.115"> </span>
<a href="#l38.116"></a><span id="l38.116" class="difflineminus">-  statusMessageRefreshTimer: function ss_statusMessageRefreshTimer() {</span>
<a href="#l38.117"></a><span id="l38.117" class="difflineplus">+  statusMessageRefreshTimer() {</span>
<a href="#l38.118"></a><span id="l38.118">     const timeBeforeAutoValidate = 20 * 1000;</span>
<a href="#l38.119"></a><span id="l38.119">     if (&quot;_stopEditStatusTimeout&quot; in this)</span>
<a href="#l38.120"></a><span id="l38.120">       clearTimeout(this._stopEditStatusTimeout);</span>
<a href="#l38.121"></a><span id="l38.121">     this._stopEditStatusTimeout = setTimeout(this.finishEditStatusMessage,</span>
<a href="#l38.122"></a><span id="l38.122">                                              timeBeforeAutoValidate, true);</span>
<a href="#l38.123"></a><span id="l38.123">   },</span>
<a href="#l38.124"></a><span id="l38.124"> </span>
<a href="#l38.125"></a><span id="l38.125" class="difflineminus">-  statusMessageBlur: function ss_statusMessageBlur(aEvent) {</span>
<a href="#l38.126"></a><span id="l38.126" class="difflineplus">+  statusMessageBlur(aEvent) {</span>
<a href="#l38.127"></a><span id="l38.127">     if (aEvent.originalTarget == document.getElementById(&quot;statusMessage&quot;).inputField)</span>
<a href="#l38.128"></a><span id="l38.128">       statusSelector.finishEditStatusMessage(true);</span>
<a href="#l38.129"></a><span id="l38.129">   },</span>
<a href="#l38.130"></a><span id="l38.130"> </span>
<a href="#l38.131"></a><span id="l38.131" class="difflineminus">-  statusMessageKeyPress: function ss_statusMessageKeyPress(aEvent) {</span>
<a href="#l38.132"></a><span id="l38.132" class="difflineplus">+  statusMessageKeyPress(aEvent) {</span>
<a href="#l38.133"></a><span id="l38.133">     if (!this.hasAttribute(&quot;editing&quot;)) {</span>
<a href="#l38.134"></a><span id="l38.134">       if (aEvent.keyCode == aEvent.DOM_VK_DOWN) {</span>
<a href="#l38.135"></a><span id="l38.135">         let button = document.getElementById(&quot;statusTypeIcon&quot;);</span>
<a href="#l38.136"></a><span id="l38.136">         document.getElementById(&quot;setStatusTypeMenupopup&quot;).openPopup(button);</span>
<a href="#l38.137"></a><span id="l38.137">       }</span>
<a href="#l38.138"></a><span id="l38.138">       return;</span>
<a href="#l38.139"></a><span id="l38.139">     }</span>
<a href="#l38.140"></a><span id="l38.140"> </span>
<a href="#l38.141"></a><span id="l38.141" class="difflineat">@@ -142,17 +142,17 @@ var statusSelector = {</span>
<a href="#l38.142"></a><span id="l38.142">         statusSelector.finishEditStatusMessage(false);</span>
<a href="#l38.143"></a><span id="l38.143">         break;</span>
<a href="#l38.144"></a><span id="l38.144"> </span>
<a href="#l38.145"></a><span id="l38.145">       default:</span>
<a href="#l38.146"></a><span id="l38.146">         statusSelector.statusMessageRefreshTimer();</span>
<a href="#l38.147"></a><span id="l38.147">     }</span>
<a href="#l38.148"></a><span id="l38.148">   },</span>
<a href="#l38.149"></a><span id="l38.149"> </span>
<a href="#l38.150"></a><span id="l38.150" class="difflineminus">-  finishEditStatusMessage: function ss_finishEditStatusMessage(aSave) {</span>
<a href="#l38.151"></a><span id="l38.151" class="difflineplus">+  finishEditStatusMessage(aSave) {</span>
<a href="#l38.152"></a><span id="l38.152">     clearTimeout(this._stopEditStatusTimeout);</span>
<a href="#l38.153"></a><span id="l38.153">     delete this._stopEditStatusTimeout;</span>
<a href="#l38.154"></a><span id="l38.154">     let elt = document.getElementById(&quot;statusMessage&quot;);</span>
<a href="#l38.155"></a><span id="l38.155">     if (aSave) {</span>
<a href="#l38.156"></a><span id="l38.156">       let newStatus = Ci.imIStatusInfo.STATUS_UNKNOWN;</span>
<a href="#l38.157"></a><span id="l38.157">       if (&quot;_statusTypeEditing&quot; in this) {</span>
<a href="#l38.158"></a><span id="l38.158">         let statusType = this._statusTypeEditing;</span>
<a href="#l38.159"></a><span id="l38.159">         if (statusType == &quot;available&quot;)</span>
<a href="#l38.160"></a><span id="l38.160" class="difflineat">@@ -183,91 +183,91 @@ var statusSelector = {</span>
<a href="#l38.161"></a><span id="l38.161">     // We need to put the focus back on the label after the textbox</span>
<a href="#l38.162"></a><span id="l38.162">     // binding has been detached, otherwise the focus gets lost (it's</span>
<a href="#l38.163"></a><span id="l38.163">     // on none of the elements in the document), but before that we</span>
<a href="#l38.164"></a><span id="l38.164">     // need to flush the layout.</span>
<a href="#l38.165"></a><span id="l38.165">     elt.getBoundingClientRect();</span>
<a href="#l38.166"></a><span id="l38.166">     elt.focus();</span>
<a href="#l38.167"></a><span id="l38.167">   },</span>
<a href="#l38.168"></a><span id="l38.168"> </span>
<a href="#l38.169"></a><span id="l38.169" class="difflineminus">-  userIconClick: function ss_userIconClick() {</span>
<a href="#l38.170"></a><span id="l38.170" class="difflineplus">+  userIconClick() {</span>
<a href="#l38.171"></a><span id="l38.171">     const nsIFilePicker = Ci.nsIFilePicker;</span>
<a href="#l38.172"></a><span id="l38.172">     let fp = Cc[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l38.173"></a><span id="l38.173">                .createInstance(nsIFilePicker);</span>
<a href="#l38.174"></a><span id="l38.174">     let bundle = document.getElementById(&quot;chatBundle&quot;);</span>
<a href="#l38.175"></a><span id="l38.175">     fp.init(window, bundle.getString(&quot;userIconFilePickerTitle&quot;),</span>
<a href="#l38.176"></a><span id="l38.176">             nsIFilePicker.modeOpen);</span>
<a href="#l38.177"></a><span id="l38.177">     fp.appendFilters(nsIFilePicker.filterImages);</span>
<a href="#l38.178"></a><span id="l38.178">     fp.open(rv =&gt; {</span>
<a href="#l38.179"></a><span id="l38.179">       if (rv != nsIFilePicker.returnOK || !fp.file) {</span>
<a href="#l38.180"></a><span id="l38.180">         return;</span>
<a href="#l38.181"></a><span id="l38.181">       }</span>
<a href="#l38.182"></a><span id="l38.182">       Services.core.globalUserStatus.setUserIcon(fp.file);</span>
<a href="#l38.183"></a><span id="l38.183">     });</span>
<a href="#l38.184"></a><span id="l38.184">   },</span>
<a href="#l38.185"></a><span id="l38.185"> </span>
<a href="#l38.186"></a><span id="l38.186" class="difflineminus">-  displayNameClick: function ss_displayNameClick() {</span>
<a href="#l38.187"></a><span id="l38.187" class="difflineplus">+  displayNameClick() {</span>
<a href="#l38.188"></a><span id="l38.188">     let elt = document.getElementById(&quot;displayName&quot;);</span>
<a href="#l38.189"></a><span id="l38.189">     if (!elt.hasAttribute(&quot;editing&quot;)) {</span>
<a href="#l38.190"></a><span id="l38.190">       elt.setAttribute(&quot;editing&quot;, &quot;true&quot;);</span>
<a href="#l38.191"></a><span id="l38.191">       if (elt.hasAttribute(&quot;usingDefault&quot;))</span>
<a href="#l38.192"></a><span id="l38.192">         elt.removeAttribute(&quot;value&quot;);</span>
<a href="#l38.193"></a><span id="l38.193">       elt.addEventListener(&quot;keypress&quot;, this.displayNameKeyPress);</span>
<a href="#l38.194"></a><span id="l38.194">       elt.addEventListener(&quot;blur&quot;, this.displayNameBlur);</span>
<a href="#l38.195"></a><span id="l38.195">       // force binding attachmant by forcing layout</span>
<a href="#l38.196"></a><span id="l38.196">       elt.getBoundingClientRect();</span>
<a href="#l38.197"></a><span id="l38.197">       elt.select();</span>
<a href="#l38.198"></a><span id="l38.198">     }</span>
<a href="#l38.199"></a><span id="l38.199"> </span>
<a href="#l38.200"></a><span id="l38.200">     this.displayNameRefreshTimer();</span>
<a href="#l38.201"></a><span id="l38.201">   },</span>
<a href="#l38.202"></a><span id="l38.202"> </span>
<a href="#l38.203"></a><span id="l38.203">   _stopEditDisplayNameTimeout: 0,</span>
<a href="#l38.204"></a><span id="l38.204" class="difflineminus">-  displayNameRefreshTimer: function ss_displayNameRefreshTimer() {</span>
<a href="#l38.205"></a><span id="l38.205" class="difflineplus">+  displayNameRefreshTimer() {</span>
<a href="#l38.206"></a><span id="l38.206">     const timeBeforeAutoValidate = 20 * 1000;</span>
<a href="#l38.207"></a><span id="l38.207">     clearTimeout(this._stopEditDisplayNameTimeout);</span>
<a href="#l38.208"></a><span id="l38.208">     this._stopEditDisplayNameTimeout =</span>
<a href="#l38.209"></a><span id="l38.209">       setTimeout(this.finishEditDisplayName, timeBeforeAutoValidate, true);</span>
<a href="#l38.210"></a><span id="l38.210">   },</span>
<a href="#l38.211"></a><span id="l38.211"> </span>
<a href="#l38.212"></a><span id="l38.212" class="difflineminus">-  displayNameBlur: function ss_displayNameBlur(aEvent) {</span>
<a href="#l38.213"></a><span id="l38.213" class="difflineplus">+  displayNameBlur(aEvent) {</span>
<a href="#l38.214"></a><span id="l38.214">     if (aEvent.originalTarget == document.getElementById(&quot;displayName&quot;).inputField)</span>
<a href="#l38.215"></a><span id="l38.215">       statusSelector.finishEditDisplayName(true);</span>
<a href="#l38.216"></a><span id="l38.216">   },</span>
<a href="#l38.217"></a><span id="l38.217"> </span>
<a href="#l38.218"></a><span id="l38.218" class="difflineminus">-  displayNameKeyPress: function ss_displayNameKeyPress(aEvent) {</span>
<a href="#l38.219"></a><span id="l38.219" class="difflineplus">+  displayNameKeyPress(aEvent) {</span>
<a href="#l38.220"></a><span id="l38.220">     switch (aEvent.keyCode) {</span>
<a href="#l38.221"></a><span id="l38.221">       case aEvent.DOM_VK_RETURN:</span>
<a href="#l38.222"></a><span id="l38.222">         statusSelector.finishEditDisplayName(true);</span>
<a href="#l38.223"></a><span id="l38.223">         break;</span>
<a href="#l38.224"></a><span id="l38.224"> </span>
<a href="#l38.225"></a><span id="l38.225">       case aEvent.DOM_VK_ESCAPE:</span>
<a href="#l38.226"></a><span id="l38.226">         statusSelector.finishEditDisplayName(false);</span>
<a href="#l38.227"></a><span id="l38.227">         break;</span>
<a href="#l38.228"></a><span id="l38.228"> </span>
<a href="#l38.229"></a><span id="l38.229">       default:</span>
<a href="#l38.230"></a><span id="l38.230">         statusSelector.displayNameRefreshTimer();</span>
<a href="#l38.231"></a><span id="l38.231">     }</span>
<a href="#l38.232"></a><span id="l38.232">   },</span>
<a href="#l38.233"></a><span id="l38.233"> </span>
<a href="#l38.234"></a><span id="l38.234" class="difflineminus">-  finishEditDisplayName: function ss_finishEditDisplayName(aSave) {</span>
<a href="#l38.235"></a><span id="l38.235" class="difflineplus">+  finishEditDisplayName(aSave) {</span>
<a href="#l38.236"></a><span id="l38.236">     clearTimeout(this._stopEditDisplayNameTimeout);</span>
<a href="#l38.237"></a><span id="l38.237">     let elt = document.getElementById(&quot;displayName&quot;);</span>
<a href="#l38.238"></a><span id="l38.238">     // Apply the new display name only if it is different from the current one.</span>
<a href="#l38.239"></a><span id="l38.239">     if (aSave &amp;&amp; elt.value != elt.getAttribute(&quot;value&quot;))</span>
<a href="#l38.240"></a><span id="l38.240">       Services.core.globalUserStatus.displayName = elt.value;</span>
<a href="#l38.241"></a><span id="l38.241">     else if (elt.hasAttribute(&quot;usingDefault&quot;))</span>
<a href="#l38.242"></a><span id="l38.242">       elt.setAttribute(&quot;value&quot;, elt.getAttribute(&quot;usingDefault&quot;));</span>
<a href="#l38.243"></a><span id="l38.243"> </span>
<a href="#l38.244"></a><span id="l38.244">     elt.removeAttribute(&quot;editing&quot;);</span>
<a href="#l38.245"></a><span id="l38.245">     elt.removeEventListener(&quot;keypress&quot;, this.displayNameKeyPress);</span>
<a href="#l38.246"></a><span id="l38.246">     elt.removeEventListener(&quot;blur&quot;, this.displayNameBlur);</span>
<a href="#l38.247"></a><span id="l38.247">   },</span>
<a href="#l38.248"></a><span id="l38.248"> </span>
<a href="#l38.249"></a><span id="l38.249" class="difflineminus">-  init: function ss_load() {</span>
<a href="#l38.250"></a><span id="l38.250" class="difflineplus">+  init() {</span>
<a href="#l38.251"></a><span id="l38.251">     let events = [&quot;status-changed&quot;];</span>
<a href="#l38.252"></a><span id="l38.252">     statusSelector.displayCurrentStatus();</span>
<a href="#l38.253"></a><span id="l38.253"> </span>
<a href="#l38.254"></a><span id="l38.254">     if (document.getElementById(&quot;displayName&quot;)) {</span>
<a href="#l38.255"></a><span id="l38.255">       events.push(&quot;user-display-name-changed&quot;);</span>
<a href="#l38.256"></a><span id="l38.256">       statusSelector.displayUserDisplayName();</span>
<a href="#l38.257"></a><span id="l38.257">     }</span>
<a href="#l38.258"></a><span id="l38.258"> </span>
<a href="#l38.259"></a><span id="l38.259" class="difflineat">@@ -282,13 +282,13 @@ var statusSelector = {</span>
<a href="#l38.260"></a><span id="l38.260"> </span>
<a href="#l38.261"></a><span id="l38.261">     for (let event of events)</span>
<a href="#l38.262"></a><span id="l38.262">       Services.obs.addObserver(statusSelector, event);</span>
<a href="#l38.263"></a><span id="l38.263">     statusSelector._events = events;</span>
<a href="#l38.264"></a><span id="l38.264"> </span>
<a href="#l38.265"></a><span id="l38.265">     window.addEventListener(&quot;unload&quot;, statusSelector.unload);</span>
<a href="#l38.266"></a><span id="l38.266">   },</span>
<a href="#l38.267"></a><span id="l38.267"> </span>
<a href="#l38.268"></a><span id="l38.268" class="difflineminus">-  unload: function ss_unload() {</span>
<a href="#l38.269"></a><span id="l38.269" class="difflineplus">+  unload() {</span>
<a href="#l38.270"></a><span id="l38.270">     for (let event of statusSelector._events)</span>
<a href="#l38.271"></a><span id="l38.271">       Services.obs.removeObserver(statusSelector, event);</span>
<a href="#l38.272"></a><span id="l38.272">    },</span>
<a href="#l38.273"></a><span id="l38.273"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mail/components/im/content/imconversation.xml</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mail/components/im/content/imconversation.xml</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -626,19 +626,19 @@</span>
<a href="#l39.4"></a><span id="l39.4">           // there is no need to complete - just jump to the end of the nick.</span>
<a href="#l39.5"></a><span id="l39.5">           let wholeWord = text.substring(inputBox.selectionStart - word.length);</span>
<a href="#l39.6"></a><span id="l39.6">           for (let completion of matchingCompletions) {</span>
<a href="#l39.7"></a><span id="l39.7">             if (wholeWord.lastIndexOf(completion, 0) == 0) {</span>
<a href="#l39.8"></a><span id="l39.8">               let moveCursor = completion.length - word.length;</span>
<a href="#l39.9"></a><span id="l39.9">               inputBox.selectionStart += moveCursor;</span>
<a href="#l39.10"></a><span id="l39.10">               let separator = text.substring(inputBox.selectionStart,</span>
<a href="#l39.11"></a><span id="l39.11">                                              inputBox.selectionStart + 2);</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-              if (separator == &quot;: &quot; || separator == &quot;, &quot;)</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+              if (separator == &quot;: &quot; || separator == &quot;, &quot;) {</span>
<a href="#l39.14"></a><span id="l39.14">                 inputBox.selectionStart += 2;</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineminus">-              else if (!moveCursor) {</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineplus">+              } else if (!moveCursor) {</span>
<a href="#l39.17"></a><span id="l39.17">                 // If we're already at the end of a nick, carry on to display</span>
<a href="#l39.18"></a><span id="l39.18">                 // a list of possible alternatives and/or apply punctuation.</span>
<a href="#l39.19"></a><span id="l39.19">                 break;</span>
<a href="#l39.20"></a><span id="l39.20">               }</span>
<a href="#l39.21"></a><span id="l39.21">               return;</span>
<a href="#l39.22"></a><span id="l39.22">             }</span>
<a href="#l39.23"></a><span id="l39.23">           }</span>
<a href="#l39.24"></a><span id="l39.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mail/components/im/content/joinchat.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mail/components/im/content/joinchat.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l40.4"></a><span id="l40.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l40.5"></a><span id="l40.5"> </span>
<a href="#l40.6"></a><span id="l40.6"> var { fixIterator } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;, null);</span>
<a href="#l40.7"></a><span id="l40.7"> var { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;, null);</span>
<a href="#l40.8"></a><span id="l40.8"> </span>
<a href="#l40.9"></a><span id="l40.9"> var autoJoinPref = &quot;autoJoin&quot;;</span>
<a href="#l40.10"></a><span id="l40.10"> </span>
<a href="#l40.11"></a><span id="l40.11"> var joinChat = {</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  onload: function jc_onload() {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+  onload() {</span>
<a href="#l40.14"></a><span id="l40.14">     var accountList = document.getElementById(&quot;accountlist&quot;);</span>
<a href="#l40.15"></a><span id="l40.15">     for (let acc of fixIterator(Services.accounts.getAccounts())) {</span>
<a href="#l40.16"></a><span id="l40.16">       if (!acc.connected || !acc.canJoinChat)</span>
<a href="#l40.17"></a><span id="l40.17">         continue;</span>
<a href="#l40.18"></a><span id="l40.18">       var proto = acc.protocol;</span>
<a href="#l40.19"></a><span id="l40.19">       var item = accountList.appendItem(acc.name, acc.id, proto.name);</span>
<a href="#l40.20"></a><span id="l40.20">       item.setAttribute(&quot;image&quot;, proto.iconBaseURI + &quot;icon.png&quot;);</span>
<a href="#l40.21"></a><span id="l40.21">       item.setAttribute(&quot;class&quot;, &quot;menuitem-iconic&quot;);</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineat">@@ -21,17 +21,17 @@ var joinChat = {</span>
<a href="#l40.23"></a><span id="l40.23">     }</span>
<a href="#l40.24"></a><span id="l40.24">     if (!accountList.itemCount) {</span>
<a href="#l40.25"></a><span id="l40.25">       document.getElementById(&quot;joinChatDialog&quot;).cancelDialog();</span>
<a href="#l40.26"></a><span id="l40.26">       throw &quot;No connected MUC enabled account!&quot;;</span>
<a href="#l40.27"></a><span id="l40.27">     }</span>
<a href="#l40.28"></a><span id="l40.28">     accountList.selectedIndex = 0;</span>
<a href="#l40.29"></a><span id="l40.29">   },</span>
<a href="#l40.30"></a><span id="l40.30"> </span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-  onAccountSelect: function jc_onAccountSelect() {</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+  onAccountSelect() {</span>
<a href="#l40.33"></a><span id="l40.33">     let ab = document.getElementById(&quot;separatorRow1&quot;);</span>
<a href="#l40.34"></a><span id="l40.34">     while (ab.nextSibling &amp;&amp; ab.nextSibling.id != &quot;separatorRow2&quot;)</span>
<a href="#l40.35"></a><span id="l40.35">       ab.nextSibling.remove();</span>
<a href="#l40.36"></a><span id="l40.36"> </span>
<a href="#l40.37"></a><span id="l40.37">     let acc = document.getElementById(&quot;accountlist&quot;).selectedItem.account;</span>
<a href="#l40.38"></a><span id="l40.38">     let sep = document.getElementById(&quot;separatorRow2&quot;);</span>
<a href="#l40.39"></a><span id="l40.39">     let defaultValues = acc.getChatRoomDefaultFieldValues();</span>
<a href="#l40.40"></a><span id="l40.40">     joinChat._values = defaultValues;</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineat">@@ -57,19 +57,19 @@ var joinChat = {</span>
<a href="#l40.42"></a><span id="l40.42">       label.setAttribute(&quot;control&quot;, &quot;field-&quot; + field.identifier);</span>
<a href="#l40.43"></a><span id="l40.43">       row.appendChild(label);</span>
<a href="#l40.44"></a><span id="l40.44"> </span>
<a href="#l40.45"></a><span id="l40.45">       let textbox = document.createElement(&quot;textbox&quot;);</span>
<a href="#l40.46"></a><span id="l40.46">       textbox.setAttribute(&quot;id&quot;, &quot;field-&quot; + field.identifier);</span>
<a href="#l40.47"></a><span id="l40.47">       let val = defaultValues.getValue(field.identifier);</span>
<a href="#l40.48"></a><span id="l40.48">       if (val)</span>
<a href="#l40.49"></a><span id="l40.49">         textbox.setAttribute(&quot;value&quot;, val);</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-      if (field.type == Ci.prplIChatRoomField.TYPE_PASSWORD)</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineplus">+      if (field.type == Ci.prplIChatRoomField.TYPE_PASSWORD) {</span>
<a href="#l40.52"></a><span id="l40.52">         textbox.setAttribute(&quot;type&quot;, &quot;password&quot;);</span>
<a href="#l40.53"></a><span id="l40.53" class="difflineminus">-      else if (field.type == Ci.prplIChatRoomField.TYPE_INT) {</span>
<a href="#l40.54"></a><span id="l40.54" class="difflineplus">+      } else if (field.type == Ci.prplIChatRoomField.TYPE_INT) {</span>
<a href="#l40.55"></a><span id="l40.55">         textbox.setAttribute(&quot;type&quot;, &quot;number&quot;);</span>
<a href="#l40.56"></a><span id="l40.56">         textbox.setAttribute(&quot;min&quot;, field.min);</span>
<a href="#l40.57"></a><span id="l40.57">         textbox.setAttribute(&quot;max&quot;, field.max);</span>
<a href="#l40.58"></a><span id="l40.58">       }</span>
<a href="#l40.59"></a><span id="l40.59">       row.appendChild(textbox);</span>
<a href="#l40.60"></a><span id="l40.60"> </span>
<a href="#l40.61"></a><span id="l40.61">       if (!field.required) {</span>
<a href="#l40.62"></a><span id="l40.62">         label = document.createElement(&quot;label&quot;);</span>
<a href="#l40.63"></a><span id="l40.63" class="difflineat">@@ -82,17 +82,17 @@ var joinChat = {</span>
<a href="#l40.64"></a><span id="l40.64">       row.setAttribute(&quot;align&quot;, &quot;baseline&quot;);</span>
<a href="#l40.65"></a><span id="l40.65">       sep.parentNode.insertBefore(row, sep);</span>
<a href="#l40.66"></a><span id="l40.66">       joinChat._fields.push({field, textbox});</span>
<a href="#l40.67"></a><span id="l40.67">     }</span>
<a href="#l40.68"></a><span id="l40.68"> </span>
<a href="#l40.69"></a><span id="l40.69">     window.sizeToContent();</span>
<a href="#l40.70"></a><span id="l40.70">   },</span>
<a href="#l40.71"></a><span id="l40.71"> </span>
<a href="#l40.72"></a><span id="l40.72" class="difflineminus">-  join: function jc_join() {</span>
<a href="#l40.73"></a><span id="l40.73" class="difflineplus">+  join() {</span>
<a href="#l40.74"></a><span id="l40.74">     let values = joinChat._values;</span>
<a href="#l40.75"></a><span id="l40.75">     for (let field of joinChat._fields) {</span>
<a href="#l40.76"></a><span id="l40.76">       let val = field.textbox.value.trim();</span>
<a href="#l40.77"></a><span id="l40.77">       if (!val &amp;&amp; field.field.required) {</span>
<a href="#l40.78"></a><span id="l40.78">         field.textbox.focus();</span>
<a href="#l40.79"></a><span id="l40.79">         // FIXME: why isn't the return false enough?</span>
<a href="#l40.80"></a><span id="l40.80">         throw &quot;Some required fields are empty!&quot;;</span>
<a href="#l40.81"></a><span id="l40.81">         // return false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mail/components/im/messages/papersheets/Footer.html</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mail/components/im/messages/papersheets/Footer.html</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -40,19 +40,19 @@ function setColors(target) {</span>
<a href="#l41.4"></a><span id="l41.4">       body.className = &quot;event-color&quot;;</span>
<a href="#l41.5"></a><span id="l41.5">       body.removeAttribute(&quot;style&quot;);</span>
<a href="#l41.6"></a><span id="l41.6">     }</span>
<a href="#l41.7"></a><span id="l41.7">   }</span>
<a href="#l41.8"></a><span id="l41.8"> }</span>
<a href="#l41.9"></a><span id="l41.9"> </span>
<a href="#l41.10"></a><span id="l41.10"> </span>
<a href="#l41.11"></a><span id="l41.11"> function checkNewText(target) {</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-  if (target.tagName == &quot;DIV&quot;)</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+  if (target.tagName == &quot;DIV&quot;) {</span>
<a href="#l41.14"></a><span id="l41.14">     setColors(target);</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineminus">-  else if (target.tagName == &quot;P&quot; &amp;&amp; target.className == &quot;event&quot;) {</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineplus">+  } else if (target.tagName == &quot;P&quot; &amp;&amp; target.className == &quot;event&quot;) {</span>
<a href="#l41.17"></a><span id="l41.17">     let parent = target.parentNode;</span>
<a href="#l41.18"></a><span id="l41.18">     // We need to start a group with this element if there are at least 3</span>
<a href="#l41.19"></a><span id="l41.19">     // system messages and they aren't already grouped.</span>
<a href="#l41.20"></a><span id="l41.20">     if (!parent.grouped &amp;&amp; parent.querySelector(&quot;p.event:nth-of-type(3)&quot;)) {</span>
<a href="#l41.21"></a><span id="l41.21">       var div = document.createElement(&quot;div&quot;);</span>
<a href="#l41.22"></a><span id="l41.22">       div.className = &quot;eventToggle&quot;;</span>
<a href="#l41.23"></a><span id="l41.23">       div.addEventListener(&quot;click&quot;, event =&gt;</span>
<a href="#l41.24"></a><span id="l41.24">         event.target.parentNode.classList.toggle(&quot;hide-children&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mail/components/im/modules/index_im.jsm</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mail/components/im/modules/index_im.jsm</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -453,17 +453,17 @@ var GlodaIMIndexer = {</span>
<a href="#l42.4"></a><span id="l42.4">       }</span>
<a href="#l42.5"></a><span id="l42.5">       conv.logFileCount = logFiles.length;</span>
<a href="#l42.6"></a><span id="l42.6">     })().catch(Cu.reportError);</span>
<a href="#l42.7"></a><span id="l42.7"> </span>
<a href="#l42.8"></a><span id="l42.8">     // Now clear the job, so we can index in the future.</span>
<a href="#l42.9"></a><span id="l42.9">     this._knownConversations[convId].scheduledIndex = null;</span>
<a href="#l42.10"></a><span id="l42.10">   },</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  observe: function logger_observe(aSubject, aTopic, aData) {</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+  observe(aSubject, aTopic, aData) {</span>
<a href="#l42.14"></a><span id="l42.14">     if (aTopic == &quot;new-ui-conversation&quot;) {</span>
<a href="#l42.15"></a><span id="l42.15">       // Add ourselves to the ui-conversation's list of observers for the</span>
<a href="#l42.16"></a><span id="l42.16">       // unread-message-count-changed notification.</span>
<a href="#l42.17"></a><span id="l42.17">       // For this notification, aSubject is the ui-conversation that is opened.</span>
<a href="#l42.18"></a><span id="l42.18">       aSubject.addObserver(this);</span>
<a href="#l42.19"></a><span id="l42.19">       return;</span>
<a href="#l42.20"></a><span id="l42.20">     }</span>
<a href="#l42.21"></a><span id="l42.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mail/components/im/modules/search_im.jsm</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mail/components/im/modules/search_im.jsm</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -200,17 +200,17 @@ GlodaIMSearcher.prototype = {</span>
<a href="#l43.4"></a><span id="l43.4">     return Services.prefs.getIntPref(</span>
<a href="#l43.5"></a><span id="l43.5">       &quot;mailnews.database.global.search.im.limit&quot;</span>
<a href="#l43.6"></a><span id="l43.6">     );</span>
<a href="#l43.7"></a><span id="l43.7">   },</span>
<a href="#l43.8"></a><span id="l43.8"> </span>
<a href="#l43.9"></a><span id="l43.9">   /**</span>
<a href="#l43.10"></a><span id="l43.10">    * Parse the string into terms/phrases by finding matching double-quotes.</span>
<a href="#l43.11"></a><span id="l43.11">    */</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  parseSearchString: function GlodaIMSearcher_parseSearchString(aSearchString) {</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+  parseSearchString(aSearchString) {</span>
<a href="#l43.14"></a><span id="l43.14">     aSearchString = aSearchString.trim();</span>
<a href="#l43.15"></a><span id="l43.15">     let terms = [];</span>
<a href="#l43.16"></a><span id="l43.16"> </span>
<a href="#l43.17"></a><span id="l43.17">     /*</span>
<a href="#l43.18"></a><span id="l43.18">      * Add the term as long as the trim on the way in didn't obliterate it.</span>
<a href="#l43.19"></a><span id="l43.19">      *</span>
<a href="#l43.20"></a><span id="l43.20">      * In the future this might have other helper logic; it did once before.</span>
<a href="#l43.21"></a><span id="l43.21">      */</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineat">@@ -241,17 +241,17 @@ GlodaIMSearcher.prototype = {</span>
<a href="#l43.23"></a><span id="l43.23"> </span>
<a href="#l43.24"></a><span id="l43.24">       addTerm(aSearchString.substring(0, spaceIndex));</span>
<a href="#l43.25"></a><span id="l43.25">       aSearchString = aSearchString.substring(spaceIndex + 1);</span>
<a href="#l43.26"></a><span id="l43.26">     }</span>
<a href="#l43.27"></a><span id="l43.27"> </span>
<a href="#l43.28"></a><span id="l43.28">     return terms;</span>
<a href="#l43.29"></a><span id="l43.29">   },</span>
<a href="#l43.30"></a><span id="l43.30"> </span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-  buildFulltextQuery: function GlodaIMSearcher_buildFulltextQuery() {</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+  buildFulltextQuery() {</span>
<a href="#l43.33"></a><span id="l43.33">     let query = Gloda.newQuery(Gloda.lookupNoun(&quot;im-conversation&quot;), {</span>
<a href="#l43.34"></a><span id="l43.34">       noMagic: true,</span>
<a href="#l43.35"></a><span id="l43.35">       explicitSQL: NUEVO_FULLTEXT_SQL,</span>
<a href="#l43.36"></a><span id="l43.36">       limitClauseAlreadyIncluded: true,</span>
<a href="#l43.37"></a><span id="l43.37">       // osets is 0-based column number 4 (volatile to column changes)</span>
<a href="#l43.38"></a><span id="l43.38">       // save the offset column for extra analysis</span>
<a href="#l43.39"></a><span id="l43.39">       stashColumns: [6],</span>
<a href="#l43.40"></a><span id="l43.40">     });</span>
<a href="#l43.41"></a><span id="l43.41" class="difflineat">@@ -283,54 +283,51 @@ GlodaIMSearcher.prototype = {</span>
<a href="#l43.42"></a><span id="l43.42">     }</span>
<a href="#l43.43"></a><span id="l43.43"> </span>
<a href="#l43.44"></a><span id="l43.44">     query.fulltextMatches(fulltextQueryString);</span>
<a href="#l43.45"></a><span id="l43.45">     query.limit(this.retrievalLimit);</span>
<a href="#l43.46"></a><span id="l43.46"> </span>
<a href="#l43.47"></a><span id="l43.47">     return query;</span>
<a href="#l43.48"></a><span id="l43.48">   },</span>
<a href="#l43.49"></a><span id="l43.49"> </span>
<a href="#l43.50"></a><span id="l43.50" class="difflineminus">-  getCollection: function GlodaIMSearcher_getCollection(</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineminus">-      aListenerOverride, aData) {</span>
<a href="#l43.52"></a><span id="l43.52" class="difflineplus">+  getCollection(aListenerOverride, aData) {</span>
<a href="#l43.53"></a><span id="l43.53">     if (aListenerOverride)</span>
<a href="#l43.54"></a><span id="l43.54">       this.listener = aListenerOverride;</span>
<a href="#l43.55"></a><span id="l43.55"> </span>
<a href="#l43.56"></a><span id="l43.56">     this.query = this.buildFulltextQuery();</span>
<a href="#l43.57"></a><span id="l43.57">     this.collection = this.query.getCollection(this, aData);</span>
<a href="#l43.58"></a><span id="l43.58">     this.completed = false;</span>
<a href="#l43.59"></a><span id="l43.59"> </span>
<a href="#l43.60"></a><span id="l43.60">     return this.collection;</span>
<a href="#l43.61"></a><span id="l43.61">   },</span>
<a href="#l43.62"></a><span id="l43.62"> </span>
<a href="#l43.63"></a><span id="l43.63">   sortBy: &quot;-dascore&quot;,</span>
<a href="#l43.64"></a><span id="l43.64"> </span>
<a href="#l43.65"></a><span id="l43.65" class="difflineminus">-  onItemsAdded: function GlodaIMSearcher_onItemsAdded(aItems, aCollection) {</span>
<a href="#l43.66"></a><span id="l43.66" class="difflineplus">+  onItemsAdded(aItems, aCollection) {</span>
<a href="#l43.67"></a><span id="l43.67">     let newScores = Gloda.scoreNounItems(</span>
<a href="#l43.68"></a><span id="l43.68">       aItems,</span>
<a href="#l43.69"></a><span id="l43.69">       {</span>
<a href="#l43.70"></a><span id="l43.70">         terms: this.fulltextTerms,</span>
<a href="#l43.71"></a><span id="l43.71">         stashedColumns: aCollection.stashedColumns,</span>
<a href="#l43.72"></a><span id="l43.72">       },</span>
<a href="#l43.73"></a><span id="l43.73">       [scoreOffsets]);</span>
<a href="#l43.74"></a><span id="l43.74">     if (this.scores)</span>
<a href="#l43.75"></a><span id="l43.75">       this.scores = this.scores.concat(newScores);</span>
<a href="#l43.76"></a><span id="l43.76">     else</span>
<a href="#l43.77"></a><span id="l43.77">       this.scores = newScores;</span>
<a href="#l43.78"></a><span id="l43.78"> </span>
<a href="#l43.79"></a><span id="l43.79">     if (this.listener)</span>
<a href="#l43.80"></a><span id="l43.80">       this.listener.onItemsAdded(aItems, aCollection);</span>
<a href="#l43.81"></a><span id="l43.81">   },</span>
<a href="#l43.82"></a><span id="l43.82" class="difflineminus">-  onItemsModified: function GlodaIMSearcher_onItemsModified(aItems,</span>
<a href="#l43.83"></a><span id="l43.83" class="difflineminus">-                                                            aCollection) {</span>
<a href="#l43.84"></a><span id="l43.84" class="difflineplus">+  onItemsModified(aItems, aCollection) {</span>
<a href="#l43.85"></a><span id="l43.85">     if (this.listener)</span>
<a href="#l43.86"></a><span id="l43.86">       this.listener.onItemsModified(aItems, aCollection);</span>
<a href="#l43.87"></a><span id="l43.87">   },</span>
<a href="#l43.88"></a><span id="l43.88" class="difflineminus">-  onItemsRemoved: function GlodaIMSearcher_onItemsRemoved(aItems,</span>
<a href="#l43.89"></a><span id="l43.89" class="difflineminus">-                                                          aCollection) {</span>
<a href="#l43.90"></a><span id="l43.90" class="difflineplus">+  onItemsRemoved(aItems, aCollection) {</span>
<a href="#l43.91"></a><span id="l43.91">     if (this.listener)</span>
<a href="#l43.92"></a><span id="l43.92">       this.listener.onItemsRemoved(aItems, aCollection);</span>
<a href="#l43.93"></a><span id="l43.93">   },</span>
<a href="#l43.94"></a><span id="l43.94" class="difflineminus">-  onQueryCompleted: function GlodaIMSearcher_onQueryCompleted(aCollection) {</span>
<a href="#l43.95"></a><span id="l43.95" class="difflineplus">+  onQueryCompleted(aCollection) {</span>
<a href="#l43.96"></a><span id="l43.96">     this.completed = true;</span>
<a href="#l43.97"></a><span id="l43.97">     if (this.listener)</span>
<a href="#l43.98"></a><span id="l43.98">       this.listener.onQueryCompleted(aCollection);</span>
<a href="#l43.99"></a><span id="l43.99">   },</span>
<a href="#l43.100"></a><span id="l43.100"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mail/components/mailContentHandler.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mail/components/mailContentHandler.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -8,35 +8,34 @@ ChromeUtils.import(&quot;resource://gre/modul</span>
<a href="#l44.4"></a><span id="l44.4"> var NS_ERROR_WONT_HANDLE_CONTENT = 0x805d0001;</span>
<a href="#l44.5"></a><span id="l44.5"> </span>
<a href="#l44.6"></a><span id="l44.6"> function mailContentHandler() {</span>
<a href="#l44.7"></a><span id="l44.7"> }</span>
<a href="#l44.8"></a><span id="l44.8"> mailContentHandler.prototype = {</span>
<a href="#l44.9"></a><span id="l44.9">   classID: Components.ID(&quot;{1c73f03a-b817-4640-b984-18c3478a9ae3}&quot;),</span>
<a href="#l44.10"></a><span id="l44.10"> </span>
<a href="#l44.11"></a><span id="l44.11">   _xpcom_factory: {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-    createInstance: function mch_factory_ci(outer, iid) {</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+    createInstance(outer, iid) {</span>
<a href="#l44.14"></a><span id="l44.14">       if (outer)</span>
<a href="#l44.15"></a><span id="l44.15">         throw Cr.NS_ERROR_NO_AGGREGATION;</span>
<a href="#l44.16"></a><span id="l44.16">       return gMailContentHandler.QueryInterface(iid);</span>
<a href="#l44.17"></a><span id="l44.17">     },</span>
<a href="#l44.18"></a><span id="l44.18">   },</span>
<a href="#l44.19"></a><span id="l44.19"> </span>
<a href="#l44.20"></a><span id="l44.20">   QueryInterface: ChromeUtils.generateQI([Ci.nsIContentHandler]),</span>
<a href="#l44.21"></a><span id="l44.21"> </span>
<a href="#l44.22"></a><span id="l44.22" class="difflineminus">-  openInExternal: function mch_OpenInExternal(uri) {</span>
<a href="#l44.23"></a><span id="l44.23" class="difflineplus">+  openInExternal(uri) {</span>
<a href="#l44.24"></a><span id="l44.24">     Cc[&quot;@mozilla.org/uriloader/external-protocol-service;1&quot;]</span>
<a href="#l44.25"></a><span id="l44.25">       .getService(Ci.nsIExternalProtocolService)</span>
<a href="#l44.26"></a><span id="l44.26">       .loadURI(uri);</span>
<a href="#l44.27"></a><span id="l44.27">   },</span>
<a href="#l44.28"></a><span id="l44.28"> </span>
<a href="#l44.29"></a><span id="l44.29">   // nsIContentHandler</span>
<a href="#l44.30"></a><span id="l44.30"> </span>
<a href="#l44.31"></a><span id="l44.31" class="difflineminus">-  handleContent: function mch_HandleContent(aContentType, aWindowContext,</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineminus">-                                            aRequest) {</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineplus">+  handleContent(aContentType, aWindowContext, aRequest) {</span>
<a href="#l44.34"></a><span id="l44.34">     try {</span>
<a href="#l44.35"></a><span id="l44.35">       if (!Cc[&quot;@mozilla.org/webnavigation-info;1&quot;]</span>
<a href="#l44.36"></a><span id="l44.36">              .getService(Ci.nsIWebNavigationInfo)</span>
<a href="#l44.37"></a><span id="l44.37">              .isTypeSupported(aContentType, null))</span>
<a href="#l44.38"></a><span id="l44.38">         throw NS_ERROR_WONT_HANDLE_CONTENT;</span>
<a href="#l44.39"></a><span id="l44.39">     } catch (e) {</span>
<a href="#l44.40"></a><span id="l44.40">       throw NS_ERROR_WONT_HANDLE_CONTENT;</span>
<a href="#l44.41"></a><span id="l44.41">     }</span>
<a href="#l44.42"></a><span id="l44.42" class="difflineat">@@ -50,22 +49,22 @@ mailContentHandler.prototype = {</span>
<a href="#l44.43"></a><span id="l44.43">     if (!aRequest.URI.schemeIs(&quot;http&quot;) &amp;&amp; !aRequest.URI.schemeIs(&quot;https&quot;))</span>
<a href="#l44.44"></a><span id="l44.44">       throw NS_ERROR_WONT_HANDLE_CONTENT;</span>
<a href="#l44.45"></a><span id="l44.45"> </span>
<a href="#l44.46"></a><span id="l44.46">     this.openInExternal(aRequest.URI);</span>
<a href="#l44.47"></a><span id="l44.47">     aRequest.cancel(Cr.NS_BINDING_ABORTED);</span>
<a href="#l44.48"></a><span id="l44.48">   },</span>
<a href="#l44.49"></a><span id="l44.49"> </span>
<a href="#l44.50"></a><span id="l44.50">   // nsIFactory</span>
<a href="#l44.51"></a><span id="l44.51" class="difflineminus">-  createInstance: function mch_CI(outer, iid) {</span>
<a href="#l44.52"></a><span id="l44.52" class="difflineplus">+  createInstance(outer, iid) {</span>
<a href="#l44.53"></a><span id="l44.53">     if (outer != null)</span>
<a href="#l44.54"></a><span id="l44.54">       throw Cr.NS_ERROR_NO_AGGREGATION;</span>
<a href="#l44.55"></a><span id="l44.55"> </span>
<a href="#l44.56"></a><span id="l44.56">     return this.QueryInterface(iid);</span>
<a href="#l44.57"></a><span id="l44.57">   },</span>
<a href="#l44.58"></a><span id="l44.58"> </span>
<a href="#l44.59"></a><span id="l44.59" class="difflineminus">-  lockFactory: function mch_lock(lock) {</span>
<a href="#l44.60"></a><span id="l44.60" class="difflineplus">+  lockFactory(lock) {</span>
<a href="#l44.61"></a><span id="l44.61">     // No-op.</span>
<a href="#l44.62"></a><span id="l44.62">   },</span>
<a href="#l44.63"></a><span id="l44.63"> };</span>
<a href="#l44.64"></a><span id="l44.64"> var gMailContentHandler = new mailContentHandler();</span>
<a href="#l44.65"></a><span id="l44.65"> </span>
<a href="#l44.66"></a><span id="l44.66"> var NSGetFactory = XPCOMUtils.generateNSGetFactory([mailContentHandler]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mail/components/mailGlue.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mail/components/mailGlue.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -50,17 +50,17 @@ function MailGlue() {</span>
<a href="#l45.4"></a><span id="l45.4">       return sanitizerScope.Sanitizer;</span>
<a href="#l45.5"></a><span id="l45.5">     });</span>
<a href="#l45.6"></a><span id="l45.6"> </span>
<a href="#l45.7"></a><span id="l45.7">   this._init();</span>
<a href="#l45.8"></a><span id="l45.8"> }</span>
<a href="#l45.9"></a><span id="l45.9"> </span>
<a href="#l45.10"></a><span id="l45.10"> MailGlue.prototype = {</span>
<a href="#l45.11"></a><span id="l45.11">   // init (called at app startup)</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  _init: function MailGlue__init() {</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  _init() {</span>
<a href="#l45.14"></a><span id="l45.14">     Services.obs.addObserver(this, &quot;xpcom-shutdown&quot;);</span>
<a href="#l45.15"></a><span id="l45.15">     Services.obs.addObserver(this, &quot;final-ui-startup&quot;);</span>
<a href="#l45.16"></a><span id="l45.16">     Services.obs.addObserver(this, &quot;mail-startup-done&quot;);</span>
<a href="#l45.17"></a><span id="l45.17">     Services.obs.addObserver(this, &quot;handle-xul-text-link&quot;);</span>
<a href="#l45.18"></a><span id="l45.18">     Services.obs.addObserver(this, &quot;chrome-document-global-created&quot;);</span>
<a href="#l45.19"></a><span id="l45.19"> </span>
<a href="#l45.20"></a><span id="l45.20">     // Inject scripts into some devtools windows.</span>
<a href="#l45.21"></a><span id="l45.21">     function _setupBrowserConsole(domWindow) {</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineat">@@ -87,29 +87,29 @@ MailGlue.prototype = {</span>
<a href="#l45.23"></a><span id="l45.23">         onLoadWindow: _setupToolbox,</span>
<a href="#l45.24"></a><span id="l45.24">       });</span>
<a href="#l45.25"></a><span id="l45.25"> </span>
<a href="#l45.26"></a><span id="l45.26">     ActorManagerParent.addActors(ACTORS);</span>
<a href="#l45.27"></a><span id="l45.27">     ActorManagerParent.flush();</span>
<a href="#l45.28"></a><span id="l45.28">   },</span>
<a href="#l45.29"></a><span id="l45.29"> </span>
<a href="#l45.30"></a><span id="l45.30">   // cleanup (called at shutdown)</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-  _dispose: function MailGlue__dispose() {</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineplus">+  _dispose() {</span>
<a href="#l45.33"></a><span id="l45.33">     Services.obs.removeObserver(this, &quot;xpcom-shutdown&quot;);</span>
<a href="#l45.34"></a><span id="l45.34">     Services.obs.removeObserver(this, &quot;final-ui-startup&quot;);</span>
<a href="#l45.35"></a><span id="l45.35">     Services.obs.removeObserver(this, &quot;mail-startup-done&quot;);</span>
<a href="#l45.36"></a><span id="l45.36">     Services.obs.removeObserver(this, &quot;handle-xul-text-link&quot;);</span>
<a href="#l45.37"></a><span id="l45.37">     Services.obs.removeObserver(this, &quot;chrome-document-global-created&quot;);</span>
<a href="#l45.38"></a><span id="l45.38"> </span>
<a href="#l45.39"></a><span id="l45.39">     ExtensionSupport.unregisterWindowListener(&quot;Thunderbird-internal-Toolbox&quot;);</span>
<a href="#l45.40"></a><span id="l45.40">     ExtensionSupport.unregisterWindowListener(&quot;Thunderbird-internal-BrowserConsole&quot;);</span>
<a href="#l45.41"></a><span id="l45.41">   },</span>
<a href="#l45.42"></a><span id="l45.42"> </span>
<a href="#l45.43"></a><span id="l45.43">   // nsIObserver implementation</span>
<a href="#l45.44"></a><span id="l45.44" class="difflineminus">-  observe: function MailGlue_observe(aSubject, aTopic, aData) {</span>
<a href="#l45.45"></a><span id="l45.45" class="difflineplus">+  observe(aSubject, aTopic, aData) {</span>
<a href="#l45.46"></a><span id="l45.46">     switch (aTopic) {</span>
<a href="#l45.47"></a><span id="l45.47">     case &quot;xpcom-shutdown&quot;:</span>
<a href="#l45.48"></a><span id="l45.48">       this._dispose();</span>
<a href="#l45.49"></a><span id="l45.49">       break;</span>
<a href="#l45.50"></a><span id="l45.50">     case &quot;final-ui-startup&quot;:</span>
<a href="#l45.51"></a><span id="l45.51">       this._onProfileStartup();</span>
<a href="#l45.52"></a><span id="l45.52">       break;</span>
<a href="#l45.53"></a><span id="l45.53">     case &quot;mail-startup-done&quot;:</span>
<a href="#l45.54"></a><span id="l45.54" class="difflineat">@@ -138,21 +138,21 @@ MailGlue.prototype = {</span>
<a href="#l45.55"></a><span id="l45.55">             &quot;chrome://messenger/content/customElements.js&quot;, doc.ownerGlobal);</span>
<a href="#l45.56"></a><span id="l45.56">         }</span>
<a href="#l45.57"></a><span id="l45.57">       }, {once: true});</span>
<a href="#l45.58"></a><span id="l45.58">       break;</span>
<a href="#l45.59"></a><span id="l45.59">     }</span>
<a href="#l45.60"></a><span id="l45.60">   },</span>
<a href="#l45.61"></a><span id="l45.61"> </span>
<a href="#l45.62"></a><span id="l45.62">   // nsIMailGlue implementation</span>
<a href="#l45.63"></a><span id="l45.63" class="difflineminus">-  sanitize: function MG_sanitize(aParentWindow) {</span>
<a href="#l45.64"></a><span id="l45.64" class="difflineplus">+  sanitize(aParentWindow) {</span>
<a href="#l45.65"></a><span id="l45.65">     this._sanitizer.sanitize(aParentWindow);</span>
<a href="#l45.66"></a><span id="l45.66">   },</span>
<a href="#l45.67"></a><span id="l45.67"> </span>
<a href="#l45.68"></a><span id="l45.68" class="difflineminus">-  _onProfileStartup: function MailGlue__onProfileStartup() {</span>
<a href="#l45.69"></a><span id="l45.69" class="difflineplus">+  _onProfileStartup() {</span>
<a href="#l45.70"></a><span id="l45.70">     TBDistCustomizer.applyPrefDefaults();</span>
<a href="#l45.71"></a><span id="l45.71"> </span>
<a href="#l45.72"></a><span id="l45.72">     let locales = Services.locale.packagedLocales;</span>
<a href="#l45.73"></a><span id="l45.73">     const appSource = new FileSource(&quot;app&quot;, locales, &quot;resource:///localization/{locale}/&quot;);</span>
<a href="#l45.74"></a><span id="l45.74">     L10nRegistry.registerSource(appSource);</span>
<a href="#l45.75"></a><span id="l45.75"> </span>
<a href="#l45.76"></a><span id="l45.76">     // handle any migration work that has to happen at profile startup</span>
<a href="#l45.77"></a><span id="l45.77">     MailMigrator.migrateAtProfileStartup();</span>
<a href="#l45.78"></a><span id="l45.78" class="difflineat">@@ -205,30 +205,30 @@ MailGlue.prototype = {</span>
<a href="#l45.79"></a><span id="l45.79">       sidebar_text: &quot;rgb(249, 249, 250)&quot;,</span>
<a href="#l45.80"></a><span id="l45.80">       sidebar_border: &quot;rgba(255, 255, 255, 0.2)&quot;,</span>
<a href="#l45.81"></a><span id="l45.81">       author: vendorShortName,</span>
<a href="#l45.82"></a><span id="l45.82">     }, {</span>
<a href="#l45.83"></a><span id="l45.83">       useInDarkMode: true,</span>
<a href="#l45.84"></a><span id="l45.84">     });</span>
<a href="#l45.85"></a><span id="l45.85">   },</span>
<a href="#l45.86"></a><span id="l45.86"> </span>
<a href="#l45.87"></a><span id="l45.87" class="difflineminus">-  _onMailStartupDone: function MailGlue__onMailStartupDone() {</span>
<a href="#l45.88"></a><span id="l45.88" class="difflineplus">+  _onMailStartupDone() {</span>
<a href="#l45.89"></a><span id="l45.89">     // On Windows 7 and above, initialize the jump list module.</span>
<a href="#l45.90"></a><span id="l45.90">     const WINTASKBAR_CONTRACTID = &quot;@mozilla.org/windows-taskbar;1&quot;;</span>
<a href="#l45.91"></a><span id="l45.91">     if (WINTASKBAR_CONTRACTID in Cc &amp;&amp;</span>
<a href="#l45.92"></a><span id="l45.92">         Cc[WINTASKBAR_CONTRACTID].getService(Ci.nsIWinTaskbar).available) {</span>
<a href="#l45.93"></a><span id="l45.93">       const { WinTaskbarJumpList } = ChromeUtils.import(&quot;resource:///modules/windowsJumpLists.js&quot;, null);</span>
<a href="#l45.94"></a><span id="l45.94">       WinTaskbarJumpList.startup();</span>
<a href="#l45.95"></a><span id="l45.95">     }</span>
<a href="#l45.96"></a><span id="l45.96"> </span>
<a href="#l45.97"></a><span id="l45.97">     ChromeUtils.import(&quot;resource:///modules/ExtensionsUI.jsm&quot;);</span>
<a href="#l45.98"></a><span id="l45.98">     ExtensionsUI.checkForSideloadedExtensions();</span>
<a href="#l45.99"></a><span id="l45.99">   },</span>
<a href="#l45.100"></a><span id="l45.100"> </span>
<a href="#l45.101"></a><span id="l45.101" class="difflineminus">-  _handleLink: function MailGlue__handleLink(aSubject, aData) {</span>
<a href="#l45.102"></a><span id="l45.102" class="difflineplus">+  _handleLink(aSubject, aData) {</span>
<a href="#l45.103"></a><span id="l45.103">     let linkHandled = aSubject.QueryInterface(Ci.nsISupportsPRBool);</span>
<a href="#l45.104"></a><span id="l45.104">     if (!linkHandled.data) {</span>
<a href="#l45.105"></a><span id="l45.105">       let win = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l45.106"></a><span id="l45.106">       aData = JSON.parse(aData);</span>
<a href="#l45.107"></a><span id="l45.107">       let tabParams = { contentPage: aData.href, clickHandler: null };</span>
<a href="#l45.108"></a><span id="l45.108">       if (win) {</span>
<a href="#l45.109"></a><span id="l45.109">         let tabmail = win.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l45.110"></a><span id="l45.110">         if (tabmail) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mail/components/migration/content/migration.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mail/components/migration/content/migration.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -115,19 +115,19 @@ var MigrationWizard = {</span>
<a href="#l46.4"></a><span id="l46.4"> </span>
<a href="#l46.5"></a><span id="l46.5">       this._itemsFlags = kIMig.ALL;</span>
<a href="#l46.6"></a><span id="l46.6">       this._selectedProfile = null;</span>
<a href="#l46.7"></a><span id="l46.7">     }</span>
<a href="#l46.8"></a><span id="l46.8"> </span>
<a href="#l46.9"></a><span id="l46.9">       this._source = newSource;</span>
<a href="#l46.10"></a><span id="l46.10"> </span>
<a href="#l46.11"></a><span id="l46.11">     // check for more than one source profile</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-    if (this._migrator.sourceHasMultipleProfiles)</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+    if (this._migrator.sourceHasMultipleProfiles) {</span>
<a href="#l46.14"></a><span id="l46.14">       this._wiz.currentPage.next = &quot;selectProfile&quot;;</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineminus">-    else {</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineplus">+    } else {</span>
<a href="#l46.17"></a><span id="l46.17">       this._wiz.currentPage.next = &quot;migrating&quot;;</span>
<a href="#l46.18"></a><span id="l46.18">       var sourceProfiles = this._migrator.sourceProfiles;</span>
<a href="#l46.19"></a><span id="l46.19">       if (sourceProfiles &amp;&amp; sourceProfiles.length == 1)</span>
<a href="#l46.20"></a><span id="l46.20">         this._selectedProfile =</span>
<a href="#l46.21"></a><span id="l46.21">           sourceProfiles.queryElementAt(0, nsISupportsString).data;</span>
<a href="#l46.22"></a><span id="l46.22">       else</span>
<a href="#l46.23"></a><span id="l46.23">         this._selectedProfile = &quot;&quot;;</span>
<a href="#l46.24"></a><span id="l46.24">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mail/components/newmailaccount/content/accountProvisioner.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mail/components/newmailaccount/content/accountProvisioner.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -118,46 +118,46 @@ var EmailAccountProvisioner = {</span>
<a href="#l47.4"></a><span id="l47.4">    */</span>
<a href="#l47.5"></a><span id="l47.5">   get userLanguage() {</span>
<a href="#l47.6"></a><span id="l47.6">     return Services.locale.requestedLocale;</span>
<a href="#l47.7"></a><span id="l47.7">   },</span>
<a href="#l47.8"></a><span id="l47.8"> </span>
<a href="#l47.9"></a><span id="l47.9">   /**</span>
<a href="#l47.10"></a><span id="l47.10">    * A helper function to enable or disable the Search button.</span>
<a href="#l47.11"></a><span id="l47.11">    */</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  searchButtonEnabled: function EAP_searchButtonEnabled(aVal) {</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+  searchButtonEnabled(aVal) {</span>
<a href="#l47.14"></a><span id="l47.14">     document.getElementById(&quot;searchSubmit&quot;).disabled = !aVal;</span>
<a href="#l47.15"></a><span id="l47.15">   },</span>
<a href="#l47.16"></a><span id="l47.16"> </span>
<a href="#l47.17"></a><span id="l47.17">   /**</span>
<a href="#l47.18"></a><span id="l47.18">    * A setter for enabling / disabling the search fields.</span>
<a href="#l47.19"></a><span id="l47.19">    */</span>
<a href="#l47.20"></a><span id="l47.20" class="difflineminus">-  searchEnabled: function EAP_searchEnabled(aVal) {</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineplus">+  searchEnabled(aVal) {</span>
<a href="#l47.22"></a><span id="l47.22">     document.getElementById(&quot;name&quot;).disabled = !aVal;</span>
<a href="#l47.23"></a><span id="l47.23">     for (let node of document.querySelectorAll(&quot;.providerCheckbox&quot;)) {</span>
<a href="#l47.24"></a><span id="l47.24">       node.disabled = !aVal;</span>
<a href="#l47.25"></a><span id="l47.25">     }</span>
<a href="#l47.26"></a><span id="l47.26">     this.searchButtonEnabled(aVal);</span>
<a href="#l47.27"></a><span id="l47.27">   },</span>
<a href="#l47.28"></a><span id="l47.28"> </span>
<a href="#l47.29"></a><span id="l47.29">   /**</span>
<a href="#l47.30"></a><span id="l47.30">    * If aVal is true, show the spinner, else hide.</span>
<a href="#l47.31"></a><span id="l47.31">    */</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">-  spinning: function EAP_spinning(aVal) {</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineplus">+  spinning(aVal) {</span>
<a href="#l47.34"></a><span id="l47.34">     let display = aVal ? &quot;block&quot; : &quot;none&quot;;</span>
<a href="#l47.35"></a><span id="l47.35">     for (let node of document.querySelectorAll(&quot;#notifications .spinner&quot;)) {</span>
<a href="#l47.36"></a><span id="l47.36">       node.style.display = display;</span>
<a href="#l47.37"></a><span id="l47.37">     }</span>
<a href="#l47.38"></a><span id="l47.38">   },</span>
<a href="#l47.39"></a><span id="l47.39"> </span>
<a href="#l47.40"></a><span id="l47.40">   /**</span>
<a href="#l47.41"></a><span id="l47.41">    * Sets the current window state to display the &quot;success&quot; page, with options</span>
<a href="#l47.42"></a><span id="l47.42">    * for composing messages, setting a signature, finding add-ons, etc.</span>
<a href="#l47.43"></a><span id="l47.43">    */</span>
<a href="#l47.44"></a><span id="l47.44" class="difflineminus">-  showSuccessPage: function EAP_showSuccessPage() {</span>
<a href="#l47.45"></a><span id="l47.45" class="difflineplus">+  showSuccessPage() {</span>
<a href="#l47.46"></a><span id="l47.46">     gLog.info(&quot;Showing the success page&quot;);</span>
<a href="#l47.47"></a><span id="l47.47">     let engine = Services.search.getEngineByName(window.arguments[0].search_engine);</span>
<a href="#l47.48"></a><span id="l47.48">     let account = window.arguments[0].account;</span>
<a href="#l47.49"></a><span id="l47.49"> </span>
<a href="#l47.50"></a><span id="l47.50">     if (engine &amp;&amp; Services.search.defaultEngine != engine) {</span>
<a href="#l47.51"></a><span id="l47.51">       // Expose the search engine checkbox</span>
<a href="#l47.52"></a><span id="l47.52">       let searchEngineWrap = document.getElementById(&quot;search_engine_wrap&quot;);</span>
<a href="#l47.53"></a><span id="l47.53">       let searchEngineCheck = document.getElementById(&quot;search_engine_check&quot;);</span>
<a href="#l47.54"></a><span id="l47.54" class="difflineat">@@ -210,34 +210,34 @@ var EmailAccountProvisioner = {</span>
<a href="#l47.55"></a><span id="l47.55">     document.getElementById(&quot;window&quot;).style.display = &quot;none&quot;;</span>
<a href="#l47.56"></a><span id="l47.56">     document.getElementById(&quot;successful_account&quot;).style.display = &quot;block&quot;;</span>
<a href="#l47.57"></a><span id="l47.57">   },</span>
<a href="#l47.58"></a><span id="l47.58"> </span>
<a href="#l47.59"></a><span id="l47.59">   /**</span>
<a href="#l47.60"></a><span id="l47.60">    * Save the name inputted in the search field to localstorage, so we can</span>
<a href="#l47.61"></a><span id="l47.61">    * reconstitute it on respawn later.</span>
<a href="#l47.62"></a><span id="l47.62">    */</span>
<a href="#l47.63"></a><span id="l47.63" class="difflineminus">-  saveName: function EAP_saveName() {</span>
<a href="#l47.64"></a><span id="l47.64" class="difflineplus">+  saveName() {</span>
<a href="#l47.65"></a><span id="l47.65">     let name = document.getElementById(&quot;name&quot;).value.trim();</span>
<a href="#l47.66"></a><span id="l47.66">     this.storage.setItem(&quot;name&quot;, name);</span>
<a href="#l47.67"></a><span id="l47.67">   },</span>
<a href="#l47.68"></a><span id="l47.68"> </span>
<a href="#l47.69"></a><span id="l47.69" class="difflineminus">-  onSearchInputOrProvidersChanged: function EAP_onSearchInputOrProvidersChanged(event) {</span>
<a href="#l47.70"></a><span id="l47.70" class="difflineplus">+  onSearchInputOrProvidersChanged(event) {</span>
<a href="#l47.71"></a><span id="l47.71">     let emptyName = document.getElementById(&quot;name&quot;).value == &quot;&quot;;</span>
<a href="#l47.72"></a><span id="l47.72">     EmailAccountProvisioner.searchButtonEnabled(!emptyName &amp;&amp;</span>
<a href="#l47.73"></a><span id="l47.73">       EmailAccountProvisioner.someProvidersChecked);</span>
<a href="#l47.74"></a><span id="l47.74">   },</span>
<a href="#l47.75"></a><span id="l47.75"> </span>
<a href="#l47.76"></a><span id="l47.76">   /**</span>
<a href="#l47.77"></a><span id="l47.77">    * Hook up our events, populate the DOM, set our hooks, do all of our</span>
<a href="#l47.78"></a><span id="l47.78">    * prep work.  Since this is called via jQuery on document ready,</span>
<a href="#l47.79"></a><span id="l47.79">    * the value for &quot;this&quot; is the actual window document, hence the need</span>
<a href="#l47.80"></a><span id="l47.80">    * to explicitly refer to EmailAccountProvisioner.</span>
<a href="#l47.81"></a><span id="l47.81">    */</span>
<a href="#l47.82"></a><span id="l47.82" class="difflineminus">-  init: function EAP_init() {</span>
<a href="#l47.83"></a><span id="l47.83" class="difflineplus">+  init() {</span>
<a href="#l47.84"></a><span id="l47.84">     // We can only init once, so bail out if we've been called again.</span>
<a href="#l47.85"></a><span id="l47.85">     if (EmailAccountProvisioner._inited)</span>
<a href="#l47.86"></a><span id="l47.86">       return;</span>
<a href="#l47.87"></a><span id="l47.87"> </span>
<a href="#l47.88"></a><span id="l47.88">     gLog.info(&quot;Initializing Email Account Provisioner&quot;);</span>
<a href="#l47.89"></a><span id="l47.89"> </span>
<a href="#l47.90"></a><span id="l47.90">     // For any anchor element that gets the &quot;external&quot; class, make it so that</span>
<a href="#l47.91"></a><span id="l47.91">     // when we click on that element, instead of loading up the href in the</span>
<a href="#l47.92"></a><span id="l47.92" class="difflineat">@@ -439,17 +439,17 @@ var EmailAccountProvisioner = {</span>
<a href="#l47.93"></a><span id="l47.93"> </span>
<a href="#l47.94"></a><span id="l47.94">     EmailAccountProvisioner._inited = true;</span>
<a href="#l47.95"></a><span id="l47.95">   },</span>
<a href="#l47.96"></a><span id="l47.96"> </span>
<a href="#l47.97"></a><span id="l47.97">   /**</span>
<a href="#l47.98"></a><span id="l47.98">    * Event handler for when the user submits the search request for their</span>
<a href="#l47.99"></a><span id="l47.99">    * name to the suggestFromName service.</span>
<a href="#l47.100"></a><span id="l47.100">    */</span>
<a href="#l47.101"></a><span id="l47.101" class="difflineminus">-  onSearchSubmit: function EAP_onSearchSubmit() {</span>
<a href="#l47.102"></a><span id="l47.102" class="difflineplus">+  onSearchSubmit() {</span>
<a href="#l47.103"></a><span id="l47.103">     for (let node of document.getElementById(&quot;notifications&quot;).children) {</span>
<a href="#l47.104"></a><span id="l47.104">       node.style.display = &quot;none&quot;;</span>
<a href="#l47.105"></a><span id="l47.105">     }</span>
<a href="#l47.106"></a><span id="l47.106">     document.getElementById(&quot;instructions&quot;).classList.add(&quot;hide&quot;);</span>
<a href="#l47.107"></a><span id="l47.107">     EmailAccountProvisioner.saveName();</span>
<a href="#l47.108"></a><span id="l47.108"> </span>
<a href="#l47.109"></a><span id="l47.109">     // Here's where we do some kind of hack-y client-side sanitization.</span>
<a href="#l47.110"></a><span id="l47.110">     // Believe it or not, this is how you sanitize stuff to HTML elements</span>
<a href="#l47.111"></a><span id="l47.111" class="difflineat">@@ -507,17 +507,17 @@ var EmailAccountProvisioner = {</span>
<a href="#l47.112"></a><span id="l47.112">   },</span>
<a href="#l47.113"></a><span id="l47.113"> </span>
<a href="#l47.114"></a><span id="l47.114">   /**</span>
<a href="#l47.115"></a><span id="l47.115">    * Event handler for when the user selects an address by clicking on</span>
<a href="#l47.116"></a><span id="l47.116">    * the price button for that address.  This function spawns the content</span>
<a href="#l47.117"></a><span id="l47.117">    * tab for the address order form, and then closes the Account Provisioner</span>
<a href="#l47.118"></a><span id="l47.118">    * window.</span>
<a href="#l47.119"></a><span id="l47.119">    */</span>
<a href="#l47.120"></a><span id="l47.120" class="difflineminus">-  onAddressSelected: function EAP_onAddressSelected(aTarget) {</span>
<a href="#l47.121"></a><span id="l47.121" class="difflineplus">+  onAddressSelected(aTarget) {</span>
<a href="#l47.122"></a><span id="l47.122">     gLog.info(&quot;An address was selected by the user.&quot;);</span>
<a href="#l47.123"></a><span id="l47.123">     let provider = EmailAccountProvisioner.providers[aTarget.dataset.provider];</span>
<a href="#l47.124"></a><span id="l47.124"> </span>
<a href="#l47.125"></a><span id="l47.125">     // Replace the variables in the url.</span>
<a href="#l47.126"></a><span id="l47.126">     let url = provider.api;</span>
<a href="#l47.127"></a><span id="l47.127">     let [firstName, lastName] = splitName(document.getElementById(&quot;name&quot;).value.trim());</span>
<a href="#l47.128"></a><span id="l47.128">     let email = aTarget.getAttribute(&quot;address&quot;);</span>
<a href="#l47.129"></a><span id="l47.129">     url = url.replace(&quot;{firstname}&quot;, firstName);</span>
<a href="#l47.130"></a><span id="l47.130" class="difflineat">@@ -553,17 +553,17 @@ var EmailAccountProvisioner = {</span>
<a href="#l47.131"></a><span id="l47.131">       node.style.display = &quot;none&quot;;</span>
<a href="#l47.132"></a><span id="l47.132">     }</span>
<a href="#l47.133"></a><span id="l47.133">   },</span>
<a href="#l47.134"></a><span id="l47.134"> </span>
<a href="#l47.135"></a><span id="l47.135">   /**</span>
<a href="#l47.136"></a><span id="l47.136">    * Attempt to fetch the provider list from the server.  If it fails,</span>
<a href="#l47.137"></a><span id="l47.137">    * display an error message, and queue for retry.</span>
<a href="#l47.138"></a><span id="l47.138">    */</span>
<a href="#l47.139"></a><span id="l47.139" class="difflineminus">-  tryToPopulateProviderList: function EAP_tryToPopulateProviderList() {</span>
<a href="#l47.140"></a><span id="l47.140" class="difflineplus">+  tryToPopulateProviderList() {</span>
<a href="#l47.141"></a><span id="l47.141">     // If we're already in the middle of getting the provider list, or</span>
<a href="#l47.142"></a><span id="l47.142">     // we already got it before, bail out.</span>
<a href="#l47.143"></a><span id="l47.143">     if (this._loadingProviders || this._loadedProviders)</span>
<a href="#l47.144"></a><span id="l47.144">       return;</span>
<a href="#l47.145"></a><span id="l47.145"> </span>
<a href="#l47.146"></a><span id="l47.146">     gLog.info(&quot;Trying to populate provider list...&quot;);</span>
<a href="#l47.147"></a><span id="l47.147"> </span>
<a href="#l47.148"></a><span id="l47.148">     // If there's a timeout ID for waking the account provisioner, clear it.</span>
<a href="#l47.149"></a><span id="l47.149" class="difflineat">@@ -609,17 +609,17 @@ var EmailAccountProvisioner = {</span>
<a href="#l47.150"></a><span id="l47.150">       request.onError();</span>
<a href="#l47.151"></a><span id="l47.151">     };</span>
<a href="#l47.152"></a><span id="l47.152">     request.send(null);</span>
<a href="#l47.153"></a><span id="l47.153"> </span>
<a href="#l47.154"></a><span id="l47.154">     EmailAccountProvisioner._loadingProviders = true;</span>
<a href="#l47.155"></a><span id="l47.155">     gLog.info(&quot;We've kicked off a request for the provider list JSON file...&quot;);</span>
<a href="#l47.156"></a><span id="l47.156">   },</span>
<a href="#l47.157"></a><span id="l47.157"> </span>
<a href="#l47.158"></a><span id="l47.158" class="difflineminus">-  providerHasCorrectFields: function EAP_providerHasCorrectFields(provider) {</span>
<a href="#l47.159"></a><span id="l47.159" class="difflineplus">+  providerHasCorrectFields(provider) {</span>
<a href="#l47.160"></a><span id="l47.160">     let result = true;</span>
<a href="#l47.161"></a><span id="l47.161"> </span>
<a href="#l47.162"></a><span id="l47.162">     let required = [&quot;id&quot;, &quot;label&quot;, &quot;paid&quot;, &quot;languages&quot;, &quot;api&quot;, &quot;tos_url&quot;,</span>
<a href="#l47.163"></a><span id="l47.163">                     &quot;privacy_url&quot;];</span>
<a href="#l47.164"></a><span id="l47.164"> </span>
<a href="#l47.165"></a><span id="l47.165">     for (let aField of required) {</span>
<a href="#l47.166"></a><span id="l47.166">       let fieldExists = (aField in provider);</span>
<a href="#l47.167"></a><span id="l47.167">       result &amp;= fieldExists;</span>
<a href="#l47.168"></a><span id="l47.168" class="difflineat">@@ -631,17 +631,17 @@ var EmailAccountProvisioner = {</span>
<a href="#l47.169"></a><span id="l47.169"> </span>
<a href="#l47.170"></a><span id="l47.170">     return result;</span>
<a href="#l47.171"></a><span id="l47.171">   },</span>
<a href="#l47.172"></a><span id="l47.172"> </span>
<a href="#l47.173"></a><span id="l47.173">   /**</span>
<a href="#l47.174"></a><span id="l47.174">    * Take the fetched providers, create checkboxes, icons and labels,</span>
<a href="#l47.175"></a><span id="l47.175">    * and insert them below the search input.</span>
<a href="#l47.176"></a><span id="l47.176">    */</span>
<a href="#l47.177"></a><span id="l47.177" class="difflineminus">-  populateProviderList: function EAP_populateProviderList(data) {</span>
<a href="#l47.178"></a><span id="l47.178" class="difflineplus">+  populateProviderList(data) {</span>
<a href="#l47.179"></a><span id="l47.179">     gLog.info(&quot;Populating the provider list&quot;);</span>
<a href="#l47.180"></a><span id="l47.180"> </span>
<a href="#l47.181"></a><span id="l47.181">     if (!data || !data.length) {</span>
<a href="#l47.182"></a><span id="l47.182">       gLog.error(&quot;The provider list we got back from the server was empty!&quot;);</span>
<a href="#l47.183"></a><span id="l47.183">       EmailAccountProvisioner.beOffline();</span>
<a href="#l47.184"></a><span id="l47.184">       return;</span>
<a href="#l47.185"></a><span id="l47.185">     }</span>
<a href="#l47.186"></a><span id="l47.186"> </span>
<a href="#l47.187"></a><span id="l47.187" class="difflineat">@@ -730,17 +730,17 @@ var EmailAccountProvisioner = {</span>
<a href="#l47.188"></a><span id="l47.188">     EmailAccountProvisioner._loadedProviders = true;</span>
<a href="#l47.189"></a><span id="l47.189">     EmailAccountProvisioner.onSearchInputOrProvidersChanged();</span>
<a href="#l47.190"></a><span id="l47.190">   },</span>
<a href="#l47.191"></a><span id="l47.191"> </span>
<a href="#l47.192"></a><span id="l47.192">   /**</span>
<a href="#l47.193"></a><span id="l47.193">    * Go through each of the checked providers, and add the appropriate</span>
<a href="#l47.194"></a><span id="l47.194">    * ToS and privacy links to the disclaimer.</span>
<a href="#l47.195"></a><span id="l47.195">    */</span>
<a href="#l47.196"></a><span id="l47.196" class="difflineminus">-  populateTermsAndPrivacyLinks: function EAP_populateTOSandPrivacyLinks() {</span>
<a href="#l47.197"></a><span id="l47.197" class="difflineplus">+  populateTermsAndPrivacyLinks() {</span>
<a href="#l47.198"></a><span id="l47.198">     gLog.info(&quot;Refreshing terms and privacy links&quot;);</span>
<a href="#l47.199"></a><span id="l47.199">     // Empty the Terms of Service and Privacy links placeholder.</span>
<a href="#l47.200"></a><span id="l47.200">     let placeholder = document.querySelector(&quot;.commentary .placeholder&quot;);</span>
<a href="#l47.201"></a><span id="l47.201"> </span>
<a href="#l47.202"></a><span id="l47.202">     let selectedProviders =</span>
<a href="#l47.203"></a><span id="l47.203">       [...document.querySelectorAll(&quot;.provider input:checked&quot;)];</span>
<a href="#l47.204"></a><span id="l47.204">     let len = selectedProviders.length;</span>
<a href="#l47.205"></a><span id="l47.205"> </span>
<a href="#l47.206"></a><span id="l47.206" class="difflineat">@@ -977,33 +977,33 @@ var EmailAccountProvisioner = {</span>
<a href="#l47.207"></a><span id="l47.207">       storedData[provider.provider] = provider;</span>
<a href="#l47.208"></a><span id="l47.208">     }</span>
<a href="#l47.209"></a><span id="l47.209">   },</span>
<a href="#l47.210"></a><span id="l47.210"> </span>
<a href="#l47.211"></a><span id="l47.211">   /**</span>
<a href="#l47.212"></a><span id="l47.212">    * If we cannot retrieve the provider list from the server, display a</span>
<a href="#l47.213"></a><span id="l47.213">    * message about connection problems, and disable the search fields.</span>
<a href="#l47.214"></a><span id="l47.214">    */</span>
<a href="#l47.215"></a><span id="l47.215" class="difflineminus">-  beOffline: function EAP_beOffline() {</span>
<a href="#l47.216"></a><span id="l47.216" class="difflineplus">+  beOffline() {</span>
<a href="#l47.217"></a><span id="l47.217">     let offlineMsg = stringBundle.get(&quot;cannotConnect&quot;);</span>
<a href="#l47.218"></a><span id="l47.218">     let element = document.getElementById(&quot;cannotConnectMessage&quot;);</span>
<a href="#l47.219"></a><span id="l47.219">     if (!element.hasChildNodes()) {</span>
<a href="#l47.220"></a><span id="l47.220">       element.appendChild(document.createTextNode(offlineMsg));</span>
<a href="#l47.221"></a><span id="l47.221">     }</span>
<a href="#l47.222"></a><span id="l47.222">     element.style.display = &quot;block&quot;;</span>
<a href="#l47.223"></a><span id="l47.223">     element.style.opacity = 1;</span>
<a href="#l47.224"></a><span id="l47.224">     this.searchEnabled(false);</span>
<a href="#l47.225"></a><span id="l47.225">     gLog.info(&quot;Email Account Provisioner is in offline mode.&quot;);</span>
<a href="#l47.226"></a><span id="l47.226">   },</span>
<a href="#l47.227"></a><span id="l47.227"> </span>
<a href="#l47.228"></a><span id="l47.228">   /**</span>
<a href="#l47.229"></a><span id="l47.229">    * If we're suddenly able to get the provider list, hide the connection</span>
<a href="#l47.230"></a><span id="l47.230">    * error message and re-enable the search fields.</span>
<a href="#l47.231"></a><span id="l47.231">    */</span>
<a href="#l47.232"></a><span id="l47.232" class="difflineminus">-  beOnline: function EAP_beOnline() {</span>
<a href="#l47.233"></a><span id="l47.233" class="difflineplus">+  beOnline() {</span>
<a href="#l47.234"></a><span id="l47.234">     let element = document.getElementById(&quot;cannotConnectMessage&quot;);</span>
<a href="#l47.235"></a><span id="l47.235">     element.style.display = &quot;none&quot;;</span>
<a href="#l47.236"></a><span id="l47.236">     element.textContent = &quot;&quot;;</span>
<a href="#l47.237"></a><span id="l47.237">     this.searchEnabled(true);</span>
<a href="#l47.238"></a><span id="l47.238">     gLog.info(&quot;Email Account Provisioner is in online mode.&quot;);</span>
<a href="#l47.239"></a><span id="l47.239">   },</span>
<a href="#l47.240"></a><span id="l47.240"> };</span>
<a href="#l47.241"></a><span id="l47.241"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mail/components/newmailaccount/content/accountProvisionerTab.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mail/components/newmailaccount/content/accountProvisionerTab.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -77,21 +77,23 @@ accountProvisionerTabType.persistTab = f</span>
<a href="#l48.4"></a><span id="l48.4"> };</span>
<a href="#l48.5"></a><span id="l48.5"> </span>
<a href="#l48.6"></a><span id="l48.6"> /**</span>
<a href="#l48.7"></a><span id="l48.7">  * Re-open the accountProvisionerTab with all of the stuff we stashed in</span>
<a href="#l48.8"></a><span id="l48.8">  * persistTab. This will automatically hook up our monitoring again.</span>
<a href="#l48.9"></a><span id="l48.9">  */</span>
<a href="#l48.10"></a><span id="l48.10"> accountProvisionerTabType.restoreTab = function(aTabmail, aPersistedState) {</span>
<a href="#l48.11"></a><span id="l48.11">   aTabmail.openTab(&quot;accountProvisionerTab&quot;,</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-                   { contentPage: aPersistedState.tabURI,</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+                   {</span>
<a href="#l48.14"></a><span id="l48.14" class="difflineplus">+                     contentPage: aPersistedState.tabURI,</span>
<a href="#l48.15"></a><span id="l48.15">                      realName: aPersistedState.realName,</span>
<a href="#l48.16"></a><span id="l48.16">                      email: aPersistedState.email,</span>
<a href="#l48.17"></a><span id="l48.17">                      searchEngine: aPersistedState.searchEngine,</span>
<a href="#l48.18"></a><span id="l48.18" class="difflineminus">-                     background: true } );</span>
<a href="#l48.19"></a><span id="l48.19" class="difflineplus">+                     background: true,</span>
<a href="#l48.20"></a><span id="l48.20" class="difflineplus">+                   });</span>
<a href="#l48.21"></a><span id="l48.21"> };</span>
<a href="#l48.22"></a><span id="l48.22"> </span>
<a href="#l48.23"></a><span id="l48.23"> /**</span>
<a href="#l48.24"></a><span id="l48.24">  * This function registers an observer to watch for HTTP requests where the</span>
<a href="#l48.25"></a><span id="l48.25">  * contentType contains text/xml.</span>
<a href="#l48.26"></a><span id="l48.26">  */</span>
<a href="#l48.27"></a><span id="l48.27"> accountProvisionerTabType._setMonitoring = function(aBrowser, aRealName,</span>
<a href="#l48.28"></a><span id="l48.28">                                                     aEmail, aSearchEngine) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mail/components/preferences/applicationManager.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mail/components/preferences/applicationManager.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l49.4"></a><span id="l49.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l49.5"></a><span id="l49.5"> </span>
<a href="#l49.6"></a><span id="l49.6"> // applications.js</span>
<a href="#l49.7"></a><span id="l49.7"> /* globals gApplicationsPane */</span>
<a href="#l49.8"></a><span id="l49.8"> </span>
<a href="#l49.9"></a><span id="l49.9"> var gAppManagerDialog = {</span>
<a href="#l49.10"></a><span id="l49.10">   _removed: [],</span>
<a href="#l49.11"></a><span id="l49.11"> </span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  init: function appManager_init() {</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+  init() {</span>
<a href="#l49.14"></a><span id="l49.14">     this.handlerInfo = window.arguments[0];</span>
<a href="#l49.15"></a><span id="l49.15">     var bundle = document.getElementById(&quot;appManagerBundle&quot;);</span>
<a href="#l49.16"></a><span id="l49.16">     gApplicationsPane._prefsBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l49.17"></a><span id="l49.17">     var description = this.handlerInfo.typeDescription;</span>
<a href="#l49.18"></a><span id="l49.18">     var key = (this.handlerInfo.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo) ?</span>
<a href="#l49.19"></a><span id="l49.19">                 &quot;handleFile&quot; : &quot;handleProtocol&quot;;</span>
<a href="#l49.20"></a><span id="l49.20">     var contentText = bundle.getFormattedString(key, [description]);</span>
<a href="#l49.21"></a><span id="l49.21">     contentText = bundle.getFormattedString(&quot;descriptionApplications&quot;, [contentText]);</span>
<a href="#l49.22"></a><span id="l49.22" class="difflineat">@@ -41,50 +41,50 @@ var gAppManagerDialog = {</span>
<a href="#l49.23"></a><span id="l49.23">       let label = document.createElement(&quot;label&quot;);</span>
<a href="#l49.24"></a><span id="l49.24">       label.setAttribute(&quot;value&quot;, app.name);</span>
<a href="#l49.25"></a><span id="l49.25">       item.appendChild(label);</span>
<a href="#l49.26"></a><span id="l49.26">     }</span>
<a href="#l49.27"></a><span id="l49.27"> </span>
<a href="#l49.28"></a><span id="l49.28">     list.selectedIndex = 0;</span>
<a href="#l49.29"></a><span id="l49.29">   },</span>
<a href="#l49.30"></a><span id="l49.30"> </span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-  onOK: function appManager_onOK() {</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineplus">+  onOK() {</span>
<a href="#l49.33"></a><span id="l49.33">     if (!this._removed.length) {</span>
<a href="#l49.34"></a><span id="l49.34">       // return early to avoid calling the |store| method.</span>
<a href="#l49.35"></a><span id="l49.35">       return;</span>
<a href="#l49.36"></a><span id="l49.36">     }</span>
<a href="#l49.37"></a><span id="l49.37"> </span>
<a href="#l49.38"></a><span id="l49.38">     for (var i = 0; i &lt; this._removed.length; ++i)</span>
<a href="#l49.39"></a><span id="l49.39">       this.handlerInfo.removePossibleApplicationHandler(this._removed[i]);</span>
<a href="#l49.40"></a><span id="l49.40"> </span>
<a href="#l49.41"></a><span id="l49.41">     this.handlerInfo.store();</span>
<a href="#l49.42"></a><span id="l49.42">   },</span>
<a href="#l49.43"></a><span id="l49.43"> </span>
<a href="#l49.44"></a><span id="l49.44" class="difflineminus">-  onCancel: function appManager_onCancel() {</span>
<a href="#l49.45"></a><span id="l49.45" class="difflineplus">+  onCancel() {</span>
<a href="#l49.46"></a><span id="l49.46">     // do nothing</span>
<a href="#l49.47"></a><span id="l49.47">   },</span>
<a href="#l49.48"></a><span id="l49.48"> </span>
<a href="#l49.49"></a><span id="l49.49" class="difflineminus">-  remove: function appManager_remove() {</span>
<a href="#l49.50"></a><span id="l49.50" class="difflineplus">+  remove() {</span>
<a href="#l49.51"></a><span id="l49.51">     var list = document.getElementById(&quot;appList&quot;);</span>
<a href="#l49.52"></a><span id="l49.52">     this._removed.push(list.selectedItem.app);</span>
<a href="#l49.53"></a><span id="l49.53">     var index = list.selectedIndex;</span>
<a href="#l49.54"></a><span id="l49.54">     list.selectedItem.remove();</span>
<a href="#l49.55"></a><span id="l49.55">     if (list.getRowCount() == 0) {</span>
<a href="#l49.56"></a><span id="l49.56">       // The list is now empty, make the bottom part disappear</span>
<a href="#l49.57"></a><span id="l49.57">       document.getElementById(&quot;appDetails&quot;).hidden = true;</span>
<a href="#l49.58"></a><span id="l49.58">     } else {</span>
<a href="#l49.59"></a><span id="l49.59">       // Select the item at the same index, if we removed the last</span>
<a href="#l49.60"></a><span id="l49.60">       // item of the list, select the previous item</span>
<a href="#l49.61"></a><span id="l49.61">       if (index == list.getRowCount())</span>
<a href="#l49.62"></a><span id="l49.62">         --index;</span>
<a href="#l49.63"></a><span id="l49.63">       list.selectedIndex = index;</span>
<a href="#l49.64"></a><span id="l49.64">     }</span>
<a href="#l49.65"></a><span id="l49.65">   },</span>
<a href="#l49.66"></a><span id="l49.66"> </span>
<a href="#l49.67"></a><span id="l49.67" class="difflineminus">-  onSelect: function appManager_onSelect() {</span>
<a href="#l49.68"></a><span id="l49.68" class="difflineplus">+  onSelect() {</span>
<a href="#l49.69"></a><span id="l49.69">     var list = document.getElementById(&quot;appList&quot;);</span>
<a href="#l49.70"></a><span id="l49.70">     if (!list.selectedItem) {</span>
<a href="#l49.71"></a><span id="l49.71">       document.getElementById(&quot;remove&quot;).disabled = true;</span>
<a href="#l49.72"></a><span id="l49.72">       return;</span>
<a href="#l49.73"></a><span id="l49.73">     }</span>
<a href="#l49.74"></a><span id="l49.74">     document.getElementById(&quot;remove&quot;).disabled = false;</span>
<a href="#l49.75"></a><span id="l49.75">     var app = list.selectedItem.app;</span>
<a href="#l49.76"></a><span id="l49.76">     var address = &quot;&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mail/components/preferences/applications.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mail/components/preferences/applications.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -1115,30 +1115,32 @@ var gApplicationsPane = {</span>
<a href="#l50.4"></a><span id="l50.4">     menuItem.setAttribute(&quot;oncommand&quot;, &quot;gApplicationsPane.confirmDelete(event)&quot;);</span>
<a href="#l50.5"></a><span id="l50.5">     menuItem.setAttribute(&quot;label&quot;, this._prefsBundle.getString(&quot;delete&quot;));</span>
<a href="#l50.6"></a><span id="l50.6">     menuPopup.appendChild(menuItem);</span>
<a href="#l50.7"></a><span id="l50.7"> </span>
<a href="#l50.8"></a><span id="l50.8">     // Select the item corresponding to the preferred action.  If the always</span>
<a href="#l50.9"></a><span id="l50.9">     // ask flag is set, it overrides the preferred action.  Otherwise we pick</span>
<a href="#l50.10"></a><span id="l50.10">     // the item identified by the preferred action (when the preferred action</span>
<a href="#l50.11"></a><span id="l50.11">     // is to use a helper app, we have to pick the specific helper app item).</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-    if (handlerInfo.alwaysAskBeforeHandling)</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+    if (handlerInfo.alwaysAskBeforeHandling) {</span>
<a href="#l50.14"></a><span id="l50.14">       menu.selectedItem = askMenuItem;</span>
<a href="#l50.15"></a><span id="l50.15" class="difflineminus">-    else switch (handlerInfo.preferredAction) {</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineminus">-      case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l50.17"></a><span id="l50.17" class="difflineminus">-        menu.selectedItem = defaultMenuItem;</span>
<a href="#l50.18"></a><span id="l50.18" class="difflineminus">-        break;</span>
<a href="#l50.19"></a><span id="l50.19" class="difflineminus">-      case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l50.20"></a><span id="l50.20" class="difflineminus">-        if (preferredApp)</span>
<a href="#l50.21"></a><span id="l50.21" class="difflineminus">-          menu.selectedItem =</span>
<a href="#l50.22"></a><span id="l50.22" class="difflineminus">-            possibleAppMenuItems.filter(v =&gt; v.handlerApp.equals(preferredApp))[0];</span>
<a href="#l50.23"></a><span id="l50.23" class="difflineminus">-        break;</span>
<a href="#l50.24"></a><span id="l50.24" class="difflineminus">-      case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l50.25"></a><span id="l50.25" class="difflineminus">-        menu.selectedItem = saveMenuItem;</span>
<a href="#l50.26"></a><span id="l50.26" class="difflineminus">-        break;</span>
<a href="#l50.27"></a><span id="l50.27" class="difflineplus">+    } else {</span>
<a href="#l50.28"></a><span id="l50.28" class="difflineplus">+      switch (handlerInfo.preferredAction) {</span>
<a href="#l50.29"></a><span id="l50.29" class="difflineplus">+        case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l50.30"></a><span id="l50.30" class="difflineplus">+          menu.selectedItem = defaultMenuItem;</span>
<a href="#l50.31"></a><span id="l50.31" class="difflineplus">+          break;</span>
<a href="#l50.32"></a><span id="l50.32" class="difflineplus">+        case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l50.33"></a><span id="l50.33" class="difflineplus">+          if (preferredApp)</span>
<a href="#l50.34"></a><span id="l50.34" class="difflineplus">+            menu.selectedItem =</span>
<a href="#l50.35"></a><span id="l50.35" class="difflineplus">+              possibleAppMenuItems.filter(v =&gt; v.handlerApp.equals(preferredApp))[0];</span>
<a href="#l50.36"></a><span id="l50.36" class="difflineplus">+          break;</span>
<a href="#l50.37"></a><span id="l50.37" class="difflineplus">+        case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l50.38"></a><span id="l50.38" class="difflineplus">+          menu.selectedItem = saveMenuItem;</span>
<a href="#l50.39"></a><span id="l50.39" class="difflineplus">+          break;</span>
<a href="#l50.40"></a><span id="l50.40" class="difflineplus">+      }</span>
<a href="#l50.41"></a><span id="l50.41">     }</span>
<a href="#l50.42"></a><span id="l50.42">     // menu.selectedItem may be null if the preferredAction is</span>
<a href="#l50.43"></a><span id="l50.43">     // useSystemDefault, but handlerInfo.hasDefaultHandler returns false.</span>
<a href="#l50.44"></a><span id="l50.44">     // For now, we'll just use the askMenuItem to avoid ugly exceptions.</span>
<a href="#l50.45"></a><span id="l50.45">     menu.previousSelectedItem = menu.selectedItem || askMenuItem;</span>
<a href="#l50.46"></a><span id="l50.46">   },</span>
<a href="#l50.47"></a><span id="l50.47"> </span>
<a href="#l50.48"></a><span id="l50.48">   // -------------------</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mail/components/preferences/cookies.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mail/components/preferences/cookies.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -672,19 +672,19 @@ var gCookiesWindow = {</span>
<a href="#l51.4"></a><span id="l51.4">     if (Services.prefs.prefHasUserValue(&quot;network.cookie.blockFutureCookies&quot;))</span>
<a href="#l51.5"></a><span id="l51.5">       blockFutureCookies = Services.prefs</span>
<a href="#l51.6"></a><span id="l51.6">         .getBoolPref(&quot;network.cookie.blockFutureCookies&quot;);</span>
<a href="#l51.7"></a><span id="l51.7">     for (let item of deleteItems) {</span>
<a href="#l51.8"></a><span id="l51.8">       Services.cookies.remove(item.host, item.name, item.path,</span>
<a href="#l51.9"></a><span id="l51.9">                               blockFutureCookies, item.originAttributes);</span>
<a href="#l51.10"></a><span id="l51.10">     }</span>
<a href="#l51.11"></a><span id="l51.11"> </span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-    if (nextSelected &lt; 0)</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+    if (nextSelected &lt; 0) {</span>
<a href="#l51.14"></a><span id="l51.14">       seln.clearSelection();</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineminus">-    else {</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineplus">+    } else {</span>
<a href="#l51.17"></a><span id="l51.17">       seln.select(nextSelected);</span>
<a href="#l51.18"></a><span id="l51.18">       this._tree.focus();</span>
<a href="#l51.19"></a><span id="l51.19">     }</span>
<a href="#l51.20"></a><span id="l51.20">   },</span>
<a href="#l51.21"></a><span id="l51.21"> </span>
<a href="#l51.22"></a><span id="l51.22">   deleteAllCookies() {</span>
<a href="#l51.23"></a><span id="l51.23">     Services.cookies.removeAll();</span>
<a href="#l51.24"></a><span id="l51.24">     this._tree.focus();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mail/components/preferences/display.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mail/components/preferences/display.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -140,17 +140,17 @@ var gDisplayPane = {</span>
<a href="#l52.4"></a><span id="l52.4"> </span>
<a href="#l52.5"></a><span id="l52.5">   /**</span>
<a href="#l52.6"></a><span id="l52.6">    * Determine the appropriate value to select for defaultFont, for the</span>
<a href="#l52.7"></a><span id="l52.7">    * following cases:</span>
<a href="#l52.8"></a><span id="l52.8">    * - there is no setting</span>
<a href="#l52.9"></a><span id="l52.9">    * - the font selected by the user is no longer present (e.g. deleted from</span>
<a href="#l52.10"></a><span id="l52.10">    *   fonts folder)</span>
<a href="#l52.11"></a><span id="l52.11">    */</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  readFontSelection: function gDisplayPane_readFontSelection() {</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  readFontSelection() {</span>
<a href="#l52.14"></a><span id="l52.14">     let element = document.getElementById(&quot;defaultFont&quot;);</span>
<a href="#l52.15"></a><span id="l52.15">     let preference = document.getElementById(element.getAttribute(&quot;preference&quot;));</span>
<a href="#l52.16"></a><span id="l52.16">     if (preference.value) {</span>
<a href="#l52.17"></a><span id="l52.17">       let fontItem = element.querySelector('[value=&quot;' + preference.value + '&quot;]');</span>
<a href="#l52.18"></a><span id="l52.18"> </span>
<a href="#l52.19"></a><span id="l52.19">       // There is a setting that actually is in the list. Respect it.</span>
<a href="#l52.20"></a><span id="l52.20">       if (fontItem)</span>
<a href="#l52.21"></a><span id="l52.21">         return undefined;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mail/components/preferences/messagestyle.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mail/components/preferences/messagestyle.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -132,19 +132,19 @@ var previewObserver = {</span>
<a href="#l53.4"></a><span id="l53.4">       if (displayName != defaultVariant) {</span>
<a href="#l53.5"></a><span id="l53.5">         let menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l53.6"></a><span id="l53.6">         menuitem.setAttribute(&quot;label&quot;, displayName);</span>
<a href="#l53.7"></a><span id="l53.7">         menuitem.setAttribute(&quot;value&quot;, aVariantName);</span>
<a href="#l53.8"></a><span id="l53.8">         popup.appendChild(menuitem);</span>
<a href="#l53.9"></a><span id="l53.9">       }</span>
<a href="#l53.10"></a><span id="l53.10">     });</span>
<a href="#l53.11"></a><span id="l53.11">     this._ignoreVariantChange = true;</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-    if (!this._loaded)</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+    if (!this._loaded) {</span>
<a href="#l53.14"></a><span id="l53.14">       menulist.value = this.theme.variant = menulist.value;</span>
<a href="#l53.15"></a><span id="l53.15" class="difflineminus">-    else {</span>
<a href="#l53.16"></a><span id="l53.16" class="difflineplus">+    } else {</span>
<a href="#l53.17"></a><span id="l53.17">       menulist.value = this.theme.variant; // (reset to &quot;default&quot;)</span>
<a href="#l53.18"></a><span id="l53.18">       document.getElementById(&quot;paneChat&quot;).userChangedValue(menulist);</span>
<a href="#l53.19"></a><span id="l53.19">     }</span>
<a href="#l53.20"></a><span id="l53.20">     this._ignoreVariantChange = false;</span>
<a href="#l53.21"></a><span id="l53.21"> </span>
<a href="#l53.22"></a><span id="l53.22">     // disable the variant menulist if there's no variant, or only one</span>
<a href="#l53.23"></a><span id="l53.23">     // which is the default</span>
<a href="#l53.24"></a><span id="l53.24">     menulist.disabled = variants.length == 0 ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mail/components/preferences/preferences.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mail/components/preferences/preferences.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -37,17 +37,17 @@ function selectPaneAndTab(prefWindow, aP</span>
<a href="#l54.4"></a><span id="l54.4">   if (aPaneID) {</span>
<a href="#l54.5"></a><span id="l54.5">     let prefPane = document.getElementById(aPaneID);</span>
<a href="#l54.6"></a><span id="l54.6">     let tabOnEvent = false;</span>
<a href="#l54.7"></a><span id="l54.7">     // The prefwindow element selects the pane specified in window.arguments[0]</span>
<a href="#l54.8"></a><span id="l54.8">     // automatically. But let's check it and if the prefs window was already</span>
<a href="#l54.9"></a><span id="l54.9">     // open, the current prefpane may not be the wanted one.</span>
<a href="#l54.10"></a><span id="l54.10">     if (prefWindow.currentPane.id != prefPane.id) {</span>
<a href="#l54.11"></a><span id="l54.11">       if (aTabID &amp;&amp; !prefPane.loaded) {</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-        prefPane.addEventListener(&quot;paneload&quot;, function showTabOnLoad() {</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+        prefPane.addEventListener(&quot;paneload&quot;, function() {</span>
<a href="#l54.14"></a><span id="l54.14">           showTab(prefPane, aTabID);</span>
<a href="#l54.15"></a><span id="l54.15">         }, {once: true});</span>
<a href="#l54.16"></a><span id="l54.16">         tabOnEvent = true;</span>
<a href="#l54.17"></a><span id="l54.17">       }</span>
<a href="#l54.18"></a><span id="l54.18">       prefWindow.showPane(prefPane);</span>
<a href="#l54.19"></a><span id="l54.19">     }</span>
<a href="#l54.20"></a><span id="l54.20">     if (aTabID &amp;&amp; !tabOnEvent)</span>
<a href="#l54.21"></a><span id="l54.21">       showTab(prefPane, aTabID, aSubdialogID);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mail/components/preferences/preferencesTab.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mail/components/preferences/preferencesTab.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -36,30 +36,30 @@ var preferencesTabType = {</span>
<a href="#l55.4"></a><span id="l55.4">     },</span>
<a href="#l55.5"></a><span id="l55.5">   },</span>
<a href="#l55.6"></a><span id="l55.6"> </span>
<a href="#l55.7"></a><span id="l55.7">   initialize() {</span>
<a href="#l55.8"></a><span id="l55.8">     let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l55.9"></a><span id="l55.9">     tabmail.registerTabType(this);</span>
<a href="#l55.10"></a><span id="l55.10">   },</span>
<a href="#l55.11"></a><span id="l55.11"> </span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  shouldSwitchTo: function shouldSwitchTo(aArgs) {</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+  shouldSwitchTo(aArgs) {</span>
<a href="#l55.14"></a><span id="l55.14">     if (!gPrefTab) {</span>
<a href="#l55.15"></a><span id="l55.15">       return -1;</span>
<a href="#l55.16"></a><span id="l55.16">     }</span>
<a href="#l55.17"></a><span id="l55.17">     let prefWindow = gPrefTab.browser.contentDocument.getElementById(&quot;MailPreferences&quot;);</span>
<a href="#l55.18"></a><span id="l55.18">     gPrefTab.browser.contentWindow.selectPaneAndTab(prefWindow, aArgs.paneID, aArgs.tabID, aArgs.otherArgs);</span>
<a href="#l55.19"></a><span id="l55.19">     return document.getElementById(&quot;tabmail&quot;).tabInfo.indexOf(gPrefTab);</span>
<a href="#l55.20"></a><span id="l55.20">   },</span>
<a href="#l55.21"></a><span id="l55.21"> </span>
<a href="#l55.22"></a><span id="l55.22">   closeTab(aTab) {</span>
<a href="#l55.23"></a><span id="l55.23">     gPrefTab = null;</span>
<a href="#l55.24"></a><span id="l55.24">   },</span>
<a href="#l55.25"></a><span id="l55.25"> </span>
<a href="#l55.26"></a><span id="l55.26" class="difflineminus">-  openTab: function onTabOpened(aTab, aArgs) {</span>
<a href="#l55.27"></a><span id="l55.27" class="difflineplus">+  openTab(aTab, aArgs) {</span>
<a href="#l55.28"></a><span id="l55.28">     if (!(&quot;contentPage&quot; in aArgs)) {</span>
<a href="#l55.29"></a><span id="l55.29">       throw (&quot;contentPage must be specified&quot;);</span>
<a href="#l55.30"></a><span id="l55.30">     }</span>
<a href="#l55.31"></a><span id="l55.31"> </span>
<a href="#l55.32"></a><span id="l55.32">     // First clone the page and set up the basics.</span>
<a href="#l55.33"></a><span id="l55.33">     let clone = document.getElementById(&quot;preferencesTab&quot;).firstChild</span>
<a href="#l55.34"></a><span id="l55.34">                         .cloneNode(true);</span>
<a href="#l55.35"></a><span id="l55.35"> </span>
<a href="#l55.36"></a><span id="l55.36" class="difflineat">@@ -86,17 +86,17 @@ var preferencesTabType = {</span>
<a href="#l55.37"></a><span id="l55.37"> </span>
<a href="#l55.38"></a><span id="l55.38">     // Now set up the listeners.</span>
<a href="#l55.39"></a><span id="l55.39">     this._setUpTitleListener(aTab);</span>
<a href="#l55.40"></a><span id="l55.40">     this._setUpCloseWindowListener(aTab);</span>
<a href="#l55.41"></a><span id="l55.41"> </span>
<a href="#l55.42"></a><span id="l55.42">     // Wait for full loading of the tab and the automatic selecting of last tab.</span>
<a href="#l55.43"></a><span id="l55.43">     // Then run the given onload code.</span>
<a href="#l55.44"></a><span id="l55.44">     aTab.browser.addEventListener(&quot;paneSelected&quot;,</span>
<a href="#l55.45"></a><span id="l55.45" class="difflineminus">-      function _contentTab_onLoad(event) {</span>
<a href="#l55.46"></a><span id="l55.46" class="difflineplus">+      function(event) {</span>
<a href="#l55.47"></a><span id="l55.47">         aTab.pageLoading = false;</span>
<a href="#l55.48"></a><span id="l55.48">         aTab.pageLoaded = true;</span>
<a href="#l55.49"></a><span id="l55.49"> </span>
<a href="#l55.50"></a><span id="l55.50">         if (&quot;onLoad&quot; in aArgs) {</span>
<a href="#l55.51"></a><span id="l55.51">           // Let selection of the initial pane complete before selecting another.</span>
<a href="#l55.52"></a><span id="l55.52">           // Otherwise we can end up with two panes selected at once.</span>
<a href="#l55.53"></a><span id="l55.53">           setTimeout(() =&gt; {</span>
<a href="#l55.54"></a><span id="l55.54">             aArgs.onLoad(event, aTab.browser);</span>
<a href="#l55.55"></a><span id="l55.55" class="difflineat">@@ -118,29 +118,29 @@ var preferencesTabType = {</span>
<a href="#l55.56"></a><span id="l55.56">       postData: aArgs.postData || null,</span>
<a href="#l55.57"></a><span id="l55.57">     };</span>
<a href="#l55.58"></a><span id="l55.58">     aTab.browser.loadURI(aArgs.contentPage, params);</span>
<a href="#l55.59"></a><span id="l55.59"> </span>
<a href="#l55.60"></a><span id="l55.60">     gPrefTab = aTab;</span>
<a href="#l55.61"></a><span id="l55.61">     this.lastBrowserId++;</span>
<a href="#l55.62"></a><span id="l55.62">   },</span>
<a href="#l55.63"></a><span id="l55.63"> </span>
<a href="#l55.64"></a><span id="l55.64" class="difflineminus">-  persistTab: function onPersistTab(aTab) {</span>
<a href="#l55.65"></a><span id="l55.65" class="difflineplus">+  persistTab(aTab) {</span>
<a href="#l55.66"></a><span id="l55.66">     if (aTab.browser.currentURI.spec == &quot;about:blank&quot;)</span>
<a href="#l55.67"></a><span id="l55.67">       return null;</span>
<a href="#l55.68"></a><span id="l55.68"> </span>
<a href="#l55.69"></a><span id="l55.69">     return {</span>
<a href="#l55.70"></a><span id="l55.70">       tabURI: aTab.url,</span>
<a href="#l55.71"></a><span id="l55.71">       paneID: aTab.paneID,</span>
<a href="#l55.72"></a><span id="l55.72">       tabID: aTab.tabID,</span>
<a href="#l55.73"></a><span id="l55.73">       otherArgs: aTab.otherArgs,</span>
<a href="#l55.74"></a><span id="l55.74">     };</span>
<a href="#l55.75"></a><span id="l55.75">   },</span>
<a href="#l55.76"></a><span id="l55.76"> </span>
<a href="#l55.77"></a><span id="l55.77" class="difflineminus">-  restoreTab: function onRestoreTab(aTabmail, aPersistedState) {</span>
<a href="#l55.78"></a><span id="l55.78" class="difflineplus">+  restoreTab(aTabmail, aPersistedState) {</span>
<a href="#l55.79"></a><span id="l55.79">     aTabmail.openTab(&quot;preferencesTab&quot;, {</span>
<a href="#l55.80"></a><span id="l55.80">       contentPage: aPersistedState.tabURI,</span>
<a href="#l55.81"></a><span id="l55.81">       paneID: aPersistedState.paneID,</span>
<a href="#l55.82"></a><span id="l55.82">       tabID: aPersistedState.tabID,</span>
<a href="#l55.83"></a><span id="l55.83">       otherArgs: aPersistedState.otherArgs,</span>
<a href="#l55.84"></a><span id="l55.84">     });</span>
<a href="#l55.85"></a><span id="l55.85">   },</span>
<a href="#l55.86"></a><span id="l55.86"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mail/components/search/SearchIntegration.jsm</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mail/components/search/SearchIntegration.jsm</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -267,17 +267,17 @@ var SearchSupport = {</span>
<a href="#l56.4"></a><span id="l56.4">    *</span>
<a href="#l56.5"></a><span id="l56.5">    * Next, it looks for the next folder after the lastFolderIndexedUri. If it is</span>
<a href="#l56.6"></a><span id="l56.6">    * in such a folder, it'll yield return that folder, then set the</span>
<a href="#l56.7"></a><span id="l56.7">    * lastFolderIndexedUrl to the URI of that folder.</span>
<a href="#l56.8"></a><span id="l56.8">    *</span>
<a href="#l56.9"></a><span id="l56.9">    * It resets lastFolderIndexedUri to an empty string, then yield returns null</span>
<a href="#l56.10"></a><span id="l56.10">    * once iteration across all folders is complete.</span>
<a href="#l56.11"></a><span id="l56.11">    */</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  _foldersToIndexGenerator: function* search_find_next_folder() {</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+  * _foldersToIndexGenerator() {</span>
<a href="#l56.14"></a><span id="l56.14">     let servers = MailServices.accounts.allServers;</span>
<a href="#l56.15"></a><span id="l56.15"> </span>
<a href="#l56.16"></a><span id="l56.16">     // Stores whether we're after the last folder indexed or before that --</span>
<a href="#l56.17"></a><span id="l56.17">     // if the last folder indexed is empty, this needs to be true initially</span>
<a href="#l56.18"></a><span id="l56.18">     let afterLastFolderIndexed = (this._lastFolderIndexedUri.length == 0);</span>
<a href="#l56.19"></a><span id="l56.19"> </span>
<a href="#l56.20"></a><span id="l56.20">     for (var server of fixIterator(servers, Ci.nsIMsgIncomingServer)) {</span>
<a href="#l56.21"></a><span id="l56.21">       let allFolders = server.rootFolder.descendants;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mail/components/wintaskbar/windowsJumpLists.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mail/components/wintaskbar/windowsJumpLists.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -54,53 +54,53 @@ var gTasks = [</span>
<a href="#l57.4"></a><span id="l57.4"> </span>
<a href="#l57.5"></a><span id="l57.5"> </span>
<a href="#l57.6"></a><span id="l57.6"> var WinTaskbarJumpList = {</span>
<a href="#l57.7"></a><span id="l57.7"> </span>
<a href="#l57.8"></a><span id="l57.8">   /**</span>
<a href="#l57.9"></a><span id="l57.9">    * Startup, shutdown, and update</span>
<a href="#l57.10"></a><span id="l57.10">    */</span>
<a href="#l57.11"></a><span id="l57.11"> </span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-  startup: function WTBJL_startup() {</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+  startup() {</span>
<a href="#l57.14"></a><span id="l57.14">     // exit if this isn't win7 or higher.</span>
<a href="#l57.15"></a><span id="l57.15">     if (!this._initTaskbar())</span>
<a href="#l57.16"></a><span id="l57.16">       return;</span>
<a href="#l57.17"></a><span id="l57.17"> </span>
<a href="#l57.18"></a><span id="l57.18">     // Store our task list config data</span>
<a href="#l57.19"></a><span id="l57.19">     this._tasks = gTasks;</span>
<a href="#l57.20"></a><span id="l57.20"> </span>
<a href="#l57.21"></a><span id="l57.21">     // retrieve taskbar related prefs.</span>
<a href="#l57.22"></a><span id="l57.22">     this._refreshPrefs();</span>
<a href="#l57.23"></a><span id="l57.23"> </span>
<a href="#l57.24"></a><span id="l57.24">     // observer for our prefs branch</span>
<a href="#l57.25"></a><span id="l57.25">     this._initObs();</span>
<a href="#l57.26"></a><span id="l57.26"> </span>
<a href="#l57.27"></a><span id="l57.27">     this.update();</span>
<a href="#l57.28"></a><span id="l57.28">   },</span>
<a href="#l57.29"></a><span id="l57.29"> </span>
<a href="#l57.30"></a><span id="l57.30" class="difflineminus">-  update: function WTBJL_update() {</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineplus">+  update() {</span>
<a href="#l57.32"></a><span id="l57.32">     // are we disabled via prefs? don't do anything!</span>
<a href="#l57.33"></a><span id="l57.33">     if (!this._enabled)</span>
<a href="#l57.34"></a><span id="l57.34">       return;</span>
<a href="#l57.35"></a><span id="l57.35"> </span>
<a href="#l57.36"></a><span id="l57.36">     // do what we came here to do, update the taskbar jumplist</span>
<a href="#l57.37"></a><span id="l57.37">     this._buildList();</span>
<a href="#l57.38"></a><span id="l57.38">   },</span>
<a href="#l57.39"></a><span id="l57.39"> </span>
<a href="#l57.40"></a><span id="l57.40" class="difflineminus">-  _shutdown: function WTBJL__shutdown() {</span>
<a href="#l57.41"></a><span id="l57.41" class="difflineplus">+  _shutdown() {</span>
<a href="#l57.42"></a><span id="l57.42">     this._shuttingDown = true;</span>
<a href="#l57.43"></a><span id="l57.43"> </span>
<a href="#l57.44"></a><span id="l57.44">     this._free();</span>
<a href="#l57.45"></a><span id="l57.45">   },</span>
<a href="#l57.46"></a><span id="l57.46"> </span>
<a href="#l57.47"></a><span id="l57.47">   /**</span>
<a href="#l57.48"></a><span id="l57.48">    * List building</span>
<a href="#l57.49"></a><span id="l57.49">    */</span>
<a href="#l57.50"></a><span id="l57.50"> </span>
<a href="#l57.51"></a><span id="l57.51" class="difflineminus">-  _buildList: function WTBJL__buildList() {</span>
<a href="#l57.52"></a><span id="l57.52" class="difflineplus">+  _buildList() {</span>
<a href="#l57.53"></a><span id="l57.53">     // anything to build?</span>
<a href="#l57.54"></a><span id="l57.54">     if (!this._showTasks) {</span>
<a href="#l57.55"></a><span id="l57.55">       // don't leave the last list hanging on the taskbar.</span>
<a href="#l57.56"></a><span id="l57.56">       this._deleteActiveJumpList();</span>
<a href="#l57.57"></a><span id="l57.57">       return;</span>
<a href="#l57.58"></a><span id="l57.58">     }</span>
<a href="#l57.59"></a><span id="l57.59"> </span>
<a href="#l57.60"></a><span id="l57.60">     if (!this._startBuild())</span>
<a href="#l57.61"></a><span id="l57.61" class="difflineat">@@ -111,53 +111,53 @@ var WinTaskbarJumpList = {</span>
<a href="#l57.62"></a><span id="l57.62"> </span>
<a href="#l57.63"></a><span id="l57.63">     this._commitBuild();</span>
<a href="#l57.64"></a><span id="l57.64">   },</span>
<a href="#l57.65"></a><span id="l57.65"> </span>
<a href="#l57.66"></a><span id="l57.66">   /**</span>
<a href="#l57.67"></a><span id="l57.67">    * Taskbar api wrappers</span>
<a href="#l57.68"></a><span id="l57.68">    */</span>
<a href="#l57.69"></a><span id="l57.69"> </span>
<a href="#l57.70"></a><span id="l57.70" class="difflineminus">-  _startBuild: function WTBJL__startBuild() {</span>
<a href="#l57.71"></a><span id="l57.71" class="difflineplus">+  _startBuild() {</span>
<a href="#l57.72"></a><span id="l57.72">     // This is useful if there are any async tasks pending. Since we don't right</span>
<a href="#l57.73"></a><span id="l57.73">     // now, it's just harmless.</span>
<a href="#l57.74"></a><span id="l57.74">     this._builder.abortListBuild();</span>
<a href="#l57.75"></a><span id="l57.75">     // Since our list is static right now, we won't actually get back any</span>
<a href="#l57.76"></a><span id="l57.76">     // removed items.</span>
<a href="#l57.77"></a><span id="l57.77">     let removedItems = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l57.78"></a><span id="l57.78">                          .createInstance(Ci.nsIMutableArray);</span>
<a href="#l57.79"></a><span id="l57.79">     return this._builder.initListBuild(removedItems);</span>
<a href="#l57.80"></a><span id="l57.80">   },</span>
<a href="#l57.81"></a><span id="l57.81"> </span>
<a href="#l57.82"></a><span id="l57.82" class="difflineminus">-  _commitBuild: function WTBJL__commitBuild() {</span>
<a href="#l57.83"></a><span id="l57.83" class="difflineplus">+  _commitBuild() {</span>
<a href="#l57.84"></a><span id="l57.84">     this._builder.commitListBuild(succeed =&gt; {</span>
<a href="#l57.85"></a><span id="l57.85">       if (!succeed) {</span>
<a href="#l57.86"></a><span id="l57.86">         this._builder.abortListBuild();</span>
<a href="#l57.87"></a><span id="l57.87">       }</span>
<a href="#l57.88"></a><span id="l57.88">     });</span>
<a href="#l57.89"></a><span id="l57.89">   },</span>
<a href="#l57.90"></a><span id="l57.90"> </span>
<a href="#l57.91"></a><span id="l57.91" class="difflineminus">-  _buildTasks: function WTBJL__buildTasks() {</span>
<a href="#l57.92"></a><span id="l57.92" class="difflineplus">+  _buildTasks() {</span>
<a href="#l57.93"></a><span id="l57.93">     if (this._tasks.length &gt; 0) {</span>
<a href="#l57.94"></a><span id="l57.94">       let items = toXPCOMArray(this._tasks.map(task =&gt;</span>
<a href="#l57.95"></a><span id="l57.95">                                  this._createHandlerAppItem(task)),</span>
<a href="#l57.96"></a><span id="l57.96">                                Ci.nsIMutableArray);</span>
<a href="#l57.97"></a><span id="l57.97">       this._builder.addListToBuild(this._builder.JUMPLIST_CATEGORY_TASKS, items);</span>
<a href="#l57.98"></a><span id="l57.98">     }</span>
<a href="#l57.99"></a><span id="l57.99">   },</span>
<a href="#l57.100"></a><span id="l57.100"> </span>
<a href="#l57.101"></a><span id="l57.101" class="difflineminus">-  _deleteActiveJumpList: function WTBJL__deleteAJL() {</span>
<a href="#l57.102"></a><span id="l57.102" class="difflineplus">+  _deleteActiveJumpList() {</span>
<a href="#l57.103"></a><span id="l57.103">     this._builder.deleteActiveList();</span>
<a href="#l57.104"></a><span id="l57.104">   },</span>
<a href="#l57.105"></a><span id="l57.105"> </span>
<a href="#l57.106"></a><span id="l57.106">   /**</span>
<a href="#l57.107"></a><span id="l57.107">    * Jump list item creation helpers</span>
<a href="#l57.108"></a><span id="l57.108">    */</span>
<a href="#l57.109"></a><span id="l57.109"> </span>
<a href="#l57.110"></a><span id="l57.110" class="difflineminus">-  _createHandlerAppItem: function WTBJL__createHandlerAppItem(aTask) {</span>
<a href="#l57.111"></a><span id="l57.111" class="difflineplus">+  _createHandlerAppItem(aTask) {</span>
<a href="#l57.112"></a><span id="l57.112">     let file = Services.dirsvc.get(&quot;XCurProcD&quot;, Ci.nsIFile);</span>
<a href="#l57.113"></a><span id="l57.113"> </span>
<a href="#l57.114"></a><span id="l57.114">     // XXX where can we grab this from in the build? Do we need to?</span>
<a href="#l57.115"></a><span id="l57.115">     file.append(&quot;thunderbird.exe&quot;);</span>
<a href="#l57.116"></a><span id="l57.116"> </span>
<a href="#l57.117"></a><span id="l57.117">     let handlerApp = Cc[&quot;@mozilla.org/uriloader/local-handler-app;1&quot;]</span>
<a href="#l57.118"></a><span id="l57.118">                        .createInstance(Ci.nsILocalHandlerApp);</span>
<a href="#l57.119"></a><span id="l57.119">     handlerApp.executable = file;</span>
<a href="#l57.120"></a><span id="l57.120" class="difflineat">@@ -170,64 +170,64 @@ var WinTaskbarJumpList = {</span>
<a href="#l57.121"></a><span id="l57.121"> </span>
<a href="#l57.122"></a><span id="l57.122">     let item = Cc[&quot;@mozilla.org/windows-jumplistshortcut;1&quot;]</span>
<a href="#l57.123"></a><span id="l57.123">                  .createInstance(Ci.nsIJumpListShortcut);</span>
<a href="#l57.124"></a><span id="l57.124">     item.app = handlerApp;</span>
<a href="#l57.125"></a><span id="l57.125">     item.iconIndex = aTask.iconIndex;</span>
<a href="#l57.126"></a><span id="l57.126">     return item;</span>
<a href="#l57.127"></a><span id="l57.127">   },</span>
<a href="#l57.128"></a><span id="l57.128"> </span>
<a href="#l57.129"></a><span id="l57.129" class="difflineminus">-  _createSeparatorItem: function WTBJL__createSeparatorItem() {</span>
<a href="#l57.130"></a><span id="l57.130" class="difflineplus">+  _createSeparatorItem() {</span>
<a href="#l57.131"></a><span id="l57.131">     return Cc[&quot;@mozilla.org/windows-jumplistseparator;1&quot;]</span>
<a href="#l57.132"></a><span id="l57.132">              .createInstance(Ci.nsIJumpListSeparator);</span>
<a href="#l57.133"></a><span id="l57.133">   },</span>
<a href="#l57.134"></a><span id="l57.134"> </span>
<a href="#l57.135"></a><span id="l57.135">   /**</span>
<a href="#l57.136"></a><span id="l57.136">    * Prefs utilities</span>
<a href="#l57.137"></a><span id="l57.137">    */</span>
<a href="#l57.138"></a><span id="l57.138"> </span>
<a href="#l57.139"></a><span id="l57.139" class="difflineminus">-  _refreshPrefs: function WTBJL__refreshPrefs() {</span>
<a href="#l57.140"></a><span id="l57.140" class="difflineplus">+  _refreshPrefs() {</span>
<a href="#l57.141"></a><span id="l57.141">     this._enabled = _prefs.getBoolPref(PREF_TASKBAR_ENABLED);</span>
<a href="#l57.142"></a><span id="l57.142">     this._showTasks = _prefs.getBoolPref(PREF_TASKBAR_TASKS);</span>
<a href="#l57.143"></a><span id="l57.143">   },</span>
<a href="#l57.144"></a><span id="l57.144"> </span>
<a href="#l57.145"></a><span id="l57.145">   /**</span>
<a href="#l57.146"></a><span id="l57.146">    * Init and shutdown utilities</span>
<a href="#l57.147"></a><span id="l57.147">    */</span>
<a href="#l57.148"></a><span id="l57.148"> </span>
<a href="#l57.149"></a><span id="l57.149" class="difflineminus">-  _initTaskbar: function WTBJL__initTaskbar() {</span>
<a href="#l57.150"></a><span id="l57.150" class="difflineplus">+  _initTaskbar() {</span>
<a href="#l57.151"></a><span id="l57.151">     this._builder = _taskbarService.createJumpListBuilder();</span>
<a href="#l57.152"></a><span id="l57.152">     if (!this._builder || !this._builder.available)</span>
<a href="#l57.153"></a><span id="l57.153">       return false;</span>
<a href="#l57.154"></a><span id="l57.154"> </span>
<a href="#l57.155"></a><span id="l57.155">     return true;</span>
<a href="#l57.156"></a><span id="l57.156">   },</span>
<a href="#l57.157"></a><span id="l57.157"> </span>
<a href="#l57.158"></a><span id="l57.158" class="difflineminus">-  _initObs: function WTBJL__initObs() {</span>
<a href="#l57.159"></a><span id="l57.159" class="difflineplus">+  _initObs() {</span>
<a href="#l57.160"></a><span id="l57.160">     Services.obs.addObserver(this, &quot;profile-before-change&quot;);</span>
<a href="#l57.161"></a><span id="l57.161">     _prefs.addObserver(&quot;&quot;, this);</span>
<a href="#l57.162"></a><span id="l57.162">   },</span>
<a href="#l57.163"></a><span id="l57.163"> </span>
<a href="#l57.164"></a><span id="l57.164" class="difflineminus">-  _freeObs: function WTBJL__freeObs() {</span>
<a href="#l57.165"></a><span id="l57.165" class="difflineplus">+  _freeObs() {</span>
<a href="#l57.166"></a><span id="l57.166">     Services.obs.removeObserver(this, &quot;profile-before-change&quot;);</span>
<a href="#l57.167"></a><span id="l57.167">     _prefs.removeObserver(&quot;&quot;, this);</span>
<a href="#l57.168"></a><span id="l57.168">   },</span>
<a href="#l57.169"></a><span id="l57.169"> </span>
<a href="#l57.170"></a><span id="l57.170" class="difflineminus">-  observe: function WTBJL_observe(aSubject, aTopic, aData) {</span>
<a href="#l57.171"></a><span id="l57.171" class="difflineplus">+  observe(aSubject, aTopic, aData) {</span>
<a href="#l57.172"></a><span id="l57.172">     switch (aTopic) {</span>
<a href="#l57.173"></a><span id="l57.173">       case &quot;nsPref:changed&quot;:</span>
<a href="#l57.174"></a><span id="l57.174">         if (this._enabled &amp;&amp; !_prefs.getBoolPref(PREF_TASKBAR_ENABLED))</span>
<a href="#l57.175"></a><span id="l57.175">           this._deleteActiveJumpList();</span>
<a href="#l57.176"></a><span id="l57.176">         this._refreshPrefs();</span>
<a href="#l57.177"></a><span id="l57.177">         this.update();</span>
<a href="#l57.178"></a><span id="l57.178">       break;</span>
<a href="#l57.179"></a><span id="l57.179"> </span>
<a href="#l57.180"></a><span id="l57.180">       case &quot;profile-before-change&quot;:</span>
<a href="#l57.181"></a><span id="l57.181">         this._shutdown();</span>
<a href="#l57.182"></a><span id="l57.182">       break;</span>
<a href="#l57.183"></a><span id="l57.183">     }</span>
<a href="#l57.184"></a><span id="l57.184">   },</span>
<a href="#l57.185"></a><span id="l57.185"> </span>
<a href="#l57.186"></a><span id="l57.186" class="difflineminus">-  _free: function WTBJL__free() {</span>
<a href="#l57.187"></a><span id="l57.187" class="difflineplus">+  _free() {</span>
<a href="#l57.188"></a><span id="l57.188">     this._freeObs();</span>
<a href="#l57.189"></a><span id="l57.189">     delete this._builder;</span>
<a href="#l57.190"></a><span id="l57.190">   },</span>
<a href="#l57.191"></a><span id="l57.191"> };</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

