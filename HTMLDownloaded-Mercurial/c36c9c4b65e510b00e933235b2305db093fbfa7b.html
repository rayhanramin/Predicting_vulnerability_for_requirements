<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 16080:c36c9c4b65e510b00e933235b2305db093fbfa7b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ c36c9c4b65e510b00e933235b2305db093fbfa7b" />
<meta property="og:url" content="/comm-central/rev/c36c9c4b65e510b00e933235b2305db093fbfa7b" />
<meta property="og:description" content="Bug 937056 - Add UTF-7 converters to comm-central. r=Standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / c36c9c4b65e510b00e933235b2305db093fbfa7b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/c36c9c4b65e510b00e933235b2305db093fbfa7b">shortlog</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/c36c9c4b65e510b00e933235b2305db093fbfa7b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b">files</a> |
changeset |
<a href="/comm-central/raw-rev/c36c9c4b65e510b00e933235b2305db093fbfa7b">raw</a>  | <a href="/comm-central/archive/c36c9c4b65e510b00e933235b2305db093fbfa7b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=937056">Bug 937056</a> - Add UTF-7 converters to comm-central. r=Standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#72;&#101;&#110;&#114;&#105;&#32;&#83;&#105;&#118;&#111;&#110;&#101;&#110;&#32;&#60;&#104;&#115;&#105;&#118;&#111;&#110;&#101;&#110;&#64;&#104;&#115;&#105;&#118;&#111;&#110;&#101;&#110;&#46;&#102;&#105;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 14 Apr 2014 17:04:02 +0300</td></tr>

<tr>
 <td>changeset 16080</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/c36c9c4b65e510b00e933235b2305db093fbfa7b">c36c9c4b65e510b00e933235b2305db093fbfa7b</a></td>
</tr>



<tr>
<td>parent 16079</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3bf3e1ea970280b5a9fee3bdae5a5494e28f7640">3bf3e1ea970280b5a9fee3bdae5a5494e28f7640</a>
</td>
</tr>

<tr>
<td>child 16081</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e3b89706dfb6c58b0e31671024e432b867f5c786">e3b89706dfb6c58b0e31671024e432b867f5c786</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=c36c9c4b65e510b00e933235b2305db093fbfa7b">10065</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 24 Apr 2014 17:36:21 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1ed1687e45b3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1ed1687e45b391e978c5c66d4d57296b7fe0fe94">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1ed1687e45b391e978c5c66d4d57296b7fe0fe94&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1ed1687e45b391e978c5c66d4d57296b7fe0fe94&newProject=comm-central&newRevision=c36c9c4b65e510b00e933235b2305db093fbfa7b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1ed1687e45b391e978c5c66d4d57296b7fe0fe94&newProject=comm-central&newRevision=c36c9c4b65e510b00e933235b2305db093fbfa7b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1ed1687e45b391e978c5c66d4d57296b7fe0fe94&newProject=comm-central&newRevision=c36c9c4b65e510b00e933235b2305db093fbfa7b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=937056">937056</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=937056">Bug 937056</a> - Add UTF-7 converters to comm-central. r=Standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/Makefile.in">mailnews/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/nsMailModule.cpp">mailnews/build/nsMailModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/nsMailModule.cpp">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/nsMailModule.cpp">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/nsMailModule.cpp">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/nsMailModule.cpp">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/build/nsMailModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/moz.build">mailnews/intl/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/moz.build">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/moz.build">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/moz.build">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/moz.build">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsCommUConvCID.h">mailnews/intl/nsCommUConvCID.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsCommUConvCID.h">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsCommUConvCID.h">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsCommUConvCID.h">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsCommUConvCID.h">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsCommUConvCID.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.cpp">mailnews/intl/nsMUTF7ToUnicode.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.cpp">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.cpp">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.cpp">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.cpp">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.h">mailnews/intl/nsMUTF7ToUnicode.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.h">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.h">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.h">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.h">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsMUTF7ToUnicode.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.cpp">mailnews/intl/nsUTF7ToUnicode.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.cpp">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.cpp">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.cpp">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.cpp">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.h">mailnews/intl/nsUTF7ToUnicode.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.h">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.h">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.h">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.h">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUTF7ToUnicode.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.cpp">mailnews/intl/nsUnicodeToMUTF7.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.cpp">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.cpp">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.cpp">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.cpp">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.h">mailnews/intl/nsUnicodeToMUTF7.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.h">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.h">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.h">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.h">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToMUTF7.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.cpp">mailnews/intl/nsUnicodeToUTF7.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.cpp">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.cpp">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.cpp">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.cpp">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.h">mailnews/intl/nsUnicodeToUTF7.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.h">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.h">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.h">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.h">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/nsUnicodeToUTF7.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/Makefile">mailnews/intl/test/Makefile</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/Makefile">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/Makefile">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/Makefile">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/Makefile">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/Makefile">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/moz.build">mailnews/intl/test/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/moz.build">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/moz.build">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/moz.build">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/moz.build">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7.js">mailnews/intl/test/unit/test_decode_utf-7.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7.js">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7.js">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7.js">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7.js">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7_internal.js">mailnews/intl/test/unit/test_decode_utf-7_internal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7_internal.js">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7_internal.js">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7_internal.js">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7_internal.js">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_decode_utf-7_internal.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7.js">mailnews/intl/test/unit/test_encode_utf-7.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7.js">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7.js">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7.js">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7.js">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7_internal.js">mailnews/intl/test/unit/test_encode_utf-7_internal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7_internal.js">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7_internal.js">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7_internal.js">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7_internal.js">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/test_encode_utf-7_internal.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/xpcshell.ini">mailnews/intl/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/intl/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/moz.build">mailnews/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/moz.build">file</a> |
<a href="/comm-central/annotate/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/moz.build">annotate</a> |
<a href="/comm-central/diff/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/moz.build">diff</a> |
<a href="/comm-central/comparison/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/moz.build">comparison</a> |
<a href="/comm-central/log/c36c9c4b65e510b00e933235b2305db093fbfa7b/mailnews/moz.build">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/build/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/build/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -37,16 +37,17 @@ EXTRA_DSO_LDOPTS += \</span>
<a href="#l1.4"></a><span id="l1.4"> endif </span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> LOCAL_INCLUDES = -I$(srcdir) \</span>
<a href="#l1.7"></a><span id="l1.7">                  -I$(srcdir)/../base/src \</span>
<a href="#l1.8"></a><span id="l1.8">                  -I$(srcdir)/../base/util \</span>
<a href="#l1.9"></a><span id="l1.9">                  -I$(srcdir)/../local/src \</span>
<a href="#l1.10"></a><span id="l1.10">                  -I$(srcdir)/../addrbook/src \</span>
<a href="#l1.11"></a><span id="l1.11">                  -I$(srcdir)/../imap/src \</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+                 -I$(srcdir)/../intl \</span>
<a href="#l1.13"></a><span id="l1.13">                  -I$(srcdir)/../compose/src \</span>
<a href="#l1.14"></a><span id="l1.14">                  -I$(srcdir)/../base/search/src \</span>
<a href="#l1.15"></a><span id="l1.15">                  -I$(srcdir)/../mime/src \</span>
<a href="#l1.16"></a><span id="l1.16">                  -I$(srcdir)/../mime/emitters \</span>
<a href="#l1.17"></a><span id="l1.17">                  -I$(srcdir)/../news/src \</span>
<a href="#l1.18"></a><span id="l1.18">                  -I$(srcdir)/../extensions/bayesian-spam-filter/src \</span>
<a href="#l1.19"></a><span id="l1.19">                  -I$(srcdir)/../extensions/fts3/src \</span>
<a href="#l1.20"></a><span id="l1.20">                  -I$(srcdir)/../extensions/mailviews/src \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/build/nsMailModule.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/build/nsMailModule.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -295,16 +295,27 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsFts3Tokenizer.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.7"></a><span id="l2.7"> // PGP/MIME includes</span>
<a href="#l2.8"></a><span id="l2.8"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsPgpMimeProxy.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+// i18n includes</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+#include &quot;nsEncoderDecoderUtils.h&quot;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+#include &quot;nsCommUConvCID.h&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+#include &quot;nsUTF7ToUnicode.h&quot;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+#include &quot;nsMUTF7ToUnicode.h&quot;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+#include &quot;nsUnicodeToUTF7.h&quot;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+#include &quot;nsUnicodeToMUTF7.h&quot;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.23"></a><span id="l2.23"> // mailnews base factories</span>
<a href="#l2.24"></a><span id="l2.24"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.25"></a><span id="l2.25"> using namespace mozilla::mailnews;</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMessengerBootstrap)</span>
<a href="#l2.28"></a><span id="l2.28"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgMailSession, Init)</span>
<a href="#l2.29"></a><span id="l2.29"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMessenger)</span>
<a href="#l2.30"></a><span id="l2.30"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgAccountManager, Init)</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineat">@@ -800,16 +811,30 @@ nsPgpMimeMimeContentTypeHandlerConstruct</span>
<a href="#l2.32"></a><span id="l2.32">     new nsMimeContentTypeHandler(&quot;mulitpart/encrypted&quot;,</span>
<a href="#l2.33"></a><span id="l2.33">                                  &amp;MIME_PgpMimeCreateContentTypeHandlerClass));</span>
<a href="#l2.34"></a><span id="l2.34"> </span>
<a href="#l2.35"></a><span id="l2.35">   NS_ENSURE_TRUE(inst, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l2.36"></a><span id="l2.36"> </span>
<a href="#l2.37"></a><span id="l2.37">   return inst-&gt;QueryInterface(aIID, aResult);</span>
<a href="#l2.38"></a><span id="l2.38"> }</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+// i18n factories</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR(nsUTF7ToUnicode)</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR(nsMUTF7ToUnicode)</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR(nsUnicodeToUTF7)</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR(nsUnicodeToMUTF7)</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+NS_DEFINE_NAMED_CID(NS_UTF7TOUNICODE_CID);</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+NS_DEFINE_NAMED_CID(NS_MUTF7TOUNICODE_CID);</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+NS_DEFINE_NAMED_CID(NS_UNICODETOUTF7_CID);</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+NS_DEFINE_NAMED_CID(NS_UNICODETOMUTF7_CID);</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+</span>
<a href="#l2.54"></a><span id="l2.54"> const mozilla::Module::CIDEntry kMailNewsCIDs[] = {</span>
<a href="#l2.55"></a><span id="l2.55">   // MailNews Base Entries</span>
<a href="#l2.56"></a><span id="l2.56">   { &amp;kNS_MESSENGERBOOTSTRAP_CID, false, NULL, nsMessengerBootstrapConstructor },</span>
<a href="#l2.57"></a><span id="l2.57">   { &amp;kNS_MESSENGERWINDOWSERVICE_CID, false, NULL, nsMessengerBootstrapConstructor},</span>
<a href="#l2.58"></a><span id="l2.58">   { &amp;kNS_MSGMAILSESSION_CID, false, NULL, nsMsgMailSessionConstructor},</span>
<a href="#l2.59"></a><span id="l2.59">   { &amp;kNS_MESSENGER_CID, false, NULL,nsMessengerConstructor},</span>
<a href="#l2.60"></a><span id="l2.60">   { &amp;kNS_MSGACCOUNTMANAGER_CID, false, NULL, nsMsgAccountManagerConstructor},</span>
<a href="#l2.61"></a><span id="l2.61">   { &amp;kNS_MSGACCOUNT_CID, false, NULL, nsMsgAccountConstructor},</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineat">@@ -999,16 +1024,21 @@ const mozilla::Module::CIDEntry kMailNew</span>
<a href="#l2.63"></a><span id="l2.63">   { &amp;kNS_MSGSMIMECOMPFIELDS_CID, false, NULL, nsMsgSMIMEComposeFieldsConstructor },</span>
<a href="#l2.64"></a><span id="l2.64">   { &amp;kNS_SMIMEJSJELPER_CID, false, NULL, nsSMimeJSHelperConstructor },</span>
<a href="#l2.65"></a><span id="l2.65">   { &amp;kNS_SMIMEENCRYPTURISERVICE_CID, false, NULL, nsEncryptedSMIMEURIsServiceConstructor },</span>
<a href="#l2.66"></a><span id="l2.66">   // Vcard Entries</span>
<a href="#l2.67"></a><span id="l2.67">   { &amp;kNS_VCARD_CONTENT_TYPE_HANDLER_CID, false, NULL, nsVCardMimeContentTypeHandlerConstructor},</span>
<a href="#l2.68"></a><span id="l2.68">   // PGP/MIME Entries</span>
<a href="#l2.69"></a><span id="l2.69">   { &amp;kNS_PGPMIME_CONTENT_TYPE_HANDLER_CID, false, NULL, nsPgpMimeMimeContentTypeHandlerConstructor },</span>
<a href="#l2.70"></a><span id="l2.70">   { &amp;kNS_PGPMIMEPROXY_CID, false, NULL, nsPgpMimeProxyConstructor },</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+  // i18n Entries</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+  { &amp;kNS_UTF7TOUNICODE_CID, false, nullptr, nsUTF7ToUnicodeConstructor },</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+  { &amp;kNS_MUTF7TOUNICODE_CID, false, nullptr, nsMUTF7ToUnicodeConstructor },</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+  { &amp;kNS_UNICODETOUTF7_CID, false, nullptr, nsUnicodeToUTF7Constructor },</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+  { &amp;kNS_UNICODETOMUTF7_CID, false, nullptr, nsUnicodeToMUTF7Constructor },</span>
<a href="#l2.76"></a><span id="l2.76">   // Tokenizer Entries</span>
<a href="#l2.77"></a><span id="l2.77">   { NULL }</span>
<a href="#l2.78"></a><span id="l2.78"> };</span>
<a href="#l2.79"></a><span id="l2.79"> </span>
<a href="#l2.80"></a><span id="l2.80"> const mozilla::Module::ContractIDEntry kMailNewsContracts[] = {</span>
<a href="#l2.81"></a><span id="l2.81">   // MailNews Base Entries</span>
<a href="#l2.82"></a><span id="l2.82">   { NS_MESSENGERBOOTSTRAP_CONTRACTID, &amp;kNS_MESSENGERBOOTSTRAP_CID },</span>
<a href="#l2.83"></a><span id="l2.83">   { NS_MESSENGERWINDOWSERVICE_CONTRACTID, &amp;kNS_MESSENGERWINDOWSERVICE_CID },</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineat">@@ -1229,16 +1259,21 @@ const mozilla::Module::ContractIDEntry k</span>
<a href="#l2.85"></a><span id="l2.85">   { NS_MSGSMIMECOMPFIELDS_CONTRACTID, &amp;kNS_MSGSMIMECOMPFIELDS_CID },</span>
<a href="#l2.86"></a><span id="l2.86">   { NS_SMIMEJSHELPER_CONTRACTID, &amp;kNS_SMIMEJSJELPER_CID },</span>
<a href="#l2.87"></a><span id="l2.87">   { NS_SMIMEENCRYPTURISERVICE_CONTRACTID, &amp;kNS_SMIMEENCRYPTURISERVICE_CID },</span>
<a href="#l2.88"></a><span id="l2.88">   // Vcard Entries</span>
<a href="#l2.89"></a><span id="l2.89">   { &quot;@mozilla.org/mimecth;1?type=text/x-vcard&quot;, &amp;kNS_VCARD_CONTENT_TYPE_HANDLER_CID },</span>
<a href="#l2.90"></a><span id="l2.90">   // PGP/MIME Entries</span>
<a href="#l2.91"></a><span id="l2.91">   { &quot;@mozilla.org/mimecth;1?type=multipart/encrypted&quot;, &amp;kNS_PGPMIME_CONTENT_TYPE_HANDLER_CID },</span>
<a href="#l2.92"></a><span id="l2.92">   { NS_PGPMIMEPROXY_CONTRACTID, &amp;kNS_PGPMIMEPROXY_CID },</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+  // i18n Entries</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+  { NS_UNICODEDECODER_CONTRACTID_BASE &quot;UTF-7&quot;, &amp;kNS_UTF7TOUNICODE_CID },</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+  { NS_UNICODEDECODER_CONTRACTID_BASE &quot;x-imap4-modified-utf7&quot;, &amp;kNS_MUTF7TOUNICODE_CID },</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+  { NS_UNICODEENCODER_CONTRACTID_BASE &quot;UTF-7&quot;, &amp;kNS_UNICODETOUTF7_CID },</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+  { NS_UNICODEENCODER_CONTRACTID_BASE &quot;x-imap4-modified-utf7&quot;, &amp;kNS_UNICODETOMUTF7_CID },</span>
<a href="#l2.98"></a><span id="l2.98">   // Tokenizer Entries</span>
<a href="#l2.99"></a><span id="l2.99">   { NULL }</span>
<a href="#l2.100"></a><span id="l2.100"> };</span>
<a href="#l2.101"></a><span id="l2.101"> </span>
<a href="#l2.102"></a><span id="l2.102"> static const mozilla::Module::CategoryEntry kMailNewsCategories[] = {</span>
<a href="#l2.103"></a><span id="l2.103">   // MailNews Base Entries</span>
<a href="#l2.104"></a><span id="l2.104">   { XPCOM_DIRECTORY_PROVIDER_CATEGORY, &quot;mail-directory-provider&quot;, NS_MAILDIRPROVIDER_CONTRACTID },</span>
<a href="#l2.105"></a><span id="l2.105">   { &quot;content-policy&quot;, NS_MSGCONTENTPOLICY_CONTRACTID, NS_MSGCONTENTPOLICY_CONTRACTID },</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineat">@@ -1259,16 +1294,19 @@ static const mozilla::Module::CategoryEn</span>
<a href="#l2.107"></a><span id="l2.107">   { &quot;mime-emitter&quot;, NS_HTML_MIME_EMITTER_CONTRACTID, NS_HTML_MIME_EMITTER_CONTRACTID },</span>
<a href="#l2.108"></a><span id="l2.108">   { &quot;mime-emitter&quot;, NS_XML_MIME_EMITTER_CONTRACTID, NS_XML_MIME_EMITTER_CONTRACTID },</span>
<a href="#l2.109"></a><span id="l2.109">   { &quot;mime-emitter&quot;, NS_PLAIN_MIME_EMITTER_CONTRACTID, NS_PLAIN_MIME_EMITTER_CONTRACTID },</span>
<a href="#l2.110"></a><span id="l2.110">   { &quot;mime-emitter&quot;, NS_RAW_MIME_EMITTER_CONTRACTID, NS_RAW_MIME_EMITTER_CONTRACTID },</span>
<a href="#l2.111"></a><span id="l2.111">   // News Entries</span>
<a href="#l2.112"></a><span id="l2.112">   { &quot;command-line-handler&quot;, &quot;m-news&quot;, NS_NEWSSTARTUPHANDLER_CONTRACTID },</span>
<a href="#l2.113"></a><span id="l2.113">   // Mail View Entries</span>
<a href="#l2.114"></a><span id="l2.114">   // mdn Entries</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+  // i18n Entries</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+  NS_UCONV_REG_UNREG(&quot;UTF-7&quot;, NS_UTF7TOUNICODE_CID, NS_UNICODETOUTF7_CID)</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+  NS_UCONV_REG_UNREG(&quot;x-imap4-modified-utf7&quot;, NS_MUTF7TOUNICODE_CID, NS_UNICODETOMUTF7_CID)</span>
<a href="#l2.118"></a><span id="l2.118">   // Tokenizer Entries</span>
<a href="#l2.119"></a><span id="l2.119">   { NULL }</span>
<a href="#l2.120"></a><span id="l2.120"> };</span>
<a href="#l2.121"></a><span id="l2.121"> </span>
<a href="#l2.122"></a><span id="l2.122"> static void</span>
<a href="#l2.123"></a><span id="l2.123"> msgMailNewsModuleDtor()</span>
<a href="#l2.124"></a><span id="l2.124"> {</span>
<a href="#l2.125"></a><span id="l2.125">   nsAddrDatabase::CleanupCache();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mailnews/intl/moz.build</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,19 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+# -*- Mode: python; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+# vim: set filetype=python:</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+UNIFIED_SOURCES += [</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    'nsMUTF7ToUnicode.cpp',</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    'nsUnicodeToMUTF7.cpp',</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    'nsUnicodeToUTF7.cpp',</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+    'nsUTF7ToUnicode.cpp',</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+]</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+MSVC_ENABLE_PGO = True</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+FINAL_LIBRARY = 'mail'</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+# Tests need more attention before they can be enabled.</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+# TEST_DIRS += ['test']</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- /dev/null</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ b/mailnews/intl/nsCommUConvCID.h</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -0,0 +1,26 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+// Class ID for our UTF7ToUnicode charset converter</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+// {77CFAAF1-1CF4-11d3-8AAF-00600811A836}</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+#define NS_UTF7TOUNICODE_CID \</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  { 0x77cfaaf1, 0x1cf4, 0x11d3, {0x8a, 0xaf, 0x0, 0x60, 0x8, 0x11, 0xa8, 0x36}}</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+// Class ID for our MUTF7ToUnicode charset converter</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+// {B57F97C1-0D70-11d3-8AAE-00600811A836}</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+#define NS_MUTF7TOUNICODE_CID \</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+  { 0xb57f97c1, 0xd70, 0x11d3, {0x8a, 0xae, 0x0, 0x60, 0x8, 0x11, 0xa8, 0x36}}</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+// Class ID for our UnicodeToUTF7 charset converter</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+// {77CFAAF2-1CF4-11d3-8AAF-00600811A836}</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+#define NS_UNICODETOUTF7_CID \</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+  { 0x77cfaaf2, 0x1cf4, 0x11d3, {0x8a, 0xaf, 0x0, 0x60, 0x8, 0x11, 0xa8, 0x36}}</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+// Class ID for our UnicodeToMUTF7 charset converter</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+// {B57F97C2-0D70-11d3-8AAE-00600811A836}</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+#define NS_UNICODETOMUTF7_CID \</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+  { 0xb57f97c2, 0xd70, 0x11d3, {0x8a, 0xae, 0x0, 0x60, 0x8, 0x11, 0xa8, 0x36}}</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/mailnews/intl/nsMUTF7ToUnicode.cpp</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+#include &quot;nsMUTF7ToUnicode.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+// Class nsMUTF7ToUnicode [implementation]</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+nsMUTF7ToUnicode::nsMUTF7ToUnicode()</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+: nsBasicUTF7Decoder(',', '&amp;')</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+{</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mailnews/intl/nsMUTF7ToUnicode.h</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,31 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+#ifndef nsMUTF7ToUnicode_h___</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+#define nsMUTF7ToUnicode_h___</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+#include &quot;nsUTF7ToUnicode.h&quot;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+// Class nsMUTF7ToUnicode [declaration]</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+/**</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+ * A character set converter from Modified UTF7 to Unicode.</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+ *</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+ * @created         18/May/1999</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+ * @author  Catalin Rotaru [CATA]</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+ */</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+class nsMUTF7ToUnicode : public nsBasicUTF7Decoder</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+{</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+public:</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+  /**</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+   * Class constructor.</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+   */</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+  nsMUTF7ToUnicode();</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+};</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+#endif /* nsMUTF7ToUnicode_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- /dev/null</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ b/mailnews/intl/nsUTF7ToUnicode.cpp</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -0,0 +1,228 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+#include &quot;nsUTF7ToUnicode.h&quot;</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+#define ENC_DIRECT      0</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+#define ENC_BASE64      1</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+// Class nsBasicUTF7Decoder [implementation]</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+nsBasicUTF7Decoder::nsBasicUTF7Decoder(char aLastChar, char aEscChar)</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+: nsBufferDecoderSupport(1)</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+{</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+  mLastChar = aLastChar;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+  mEscChar = aEscChar;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+  Reset();</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+}</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+nsresult nsBasicUTF7Decoder::DecodeDirect(</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+                             const char * aSrc,</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+                             int32_t * aSrcLength,</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+                             char16_t * aDest,</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+                             int32_t * aDestLength)</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+{</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  const char * srcEnd = aSrc + *aSrcLength;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+  const char * src = aSrc;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+  char16_t * destEnd = aDest + *aDestLength;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+  char16_t * dest = aDest;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+  nsresult res = NS_OK;</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+  char ch;</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+  while (src &lt; srcEnd) {</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+    ch = *src;</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+    // stop when we meet other chars or end of direct encoded seq.</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+    // if (!(DirectEncodable(ch)) || (ch == mEscChar)) {</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+    // but we are decoding; so we should be lax; pass everything until escchar</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+    if (ch == mEscChar) {</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+      res = NS_ERROR_UDEC_ILLEGALINPUT;</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+      break;</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+    }</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+    if (dest &gt;= destEnd) {</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+      res = NS_OK_UDEC_MOREOUTPUT;</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+      break;</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+    } else {</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+      *dest++ = ch;</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+      src++;</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+    }</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+  }</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+  *aSrcLength = src - aSrc;</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+  *aDestLength = dest - aDest;</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+  return res;</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+}</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+nsresult nsBasicUTF7Decoder::DecodeBase64(</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+                             const char * aSrc,</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+                             int32_t * aSrcLength,</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+                             char16_t * aDest,</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+                             int32_t * aDestLength)</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+{</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+  const char * srcEnd = aSrc + *aSrcLength;</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+  const char * src = aSrc;</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+  char16_t * destEnd = aDest + *aDestLength;</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+  char16_t * dest = aDest;</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+  nsresult res = NS_OK;</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+  char ch;</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+  uint32_t value;</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+  while (src &lt; srcEnd) {</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+    ch = *src;</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+    // stop when we meet other chars or end of direct encoded seq.</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+    value = CharToValue(ch);</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+    if (value &gt; 0xff) {</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+      res = NS_ERROR_UDEC_ILLEGALINPUT;</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+      break;</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+    }</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+    switch (mEncStep) {</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+      case 0:</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineplus">+        mEncBits = value &lt;&lt; 10;</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineplus">+        break;</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineplus">+      case 1:</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineplus">+        mEncBits += value &lt;&lt; 4;</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineplus">+        break;</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+      case 2:</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineplus">+        if (dest &gt;= destEnd) {</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineplus">+          res = NS_OK_UDEC_MOREOUTPUT;</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineplus">+          break;</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+        }</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineplus">+        mEncBits += value &gt;&gt; 2;</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+        *(dest++) = (char16_t) mEncBits;</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+        mEncBits = (value &amp; 0x03) &lt;&lt; 14;</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+        break;</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+      case 3:</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+        mEncBits += value &lt;&lt; 8;</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+        break;</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+      case 4:</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+        mEncBits += value &lt;&lt; 2;</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+        break;</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+      case 5:</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineplus">+        if (dest &gt;= destEnd) {</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineplus">+          res = NS_OK_UDEC_MOREOUTPUT;</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineplus">+          break;</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineplus">+        }</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineplus">+        mEncBits += value &gt;&gt; 4;</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineplus">+        *(dest++) = (char16_t) mEncBits;</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineplus">+        mEncBits = (value &amp; 0x0f) &lt;&lt; 12;</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineplus">+        break;</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineplus">+      case 6:</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineplus">+        mEncBits += value &lt;&lt; 6;</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineplus">+        break;</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineplus">+      case 7:</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineplus">+        if (dest &gt;= destEnd) {</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineplus">+          res = NS_OK_UDEC_MOREOUTPUT;</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineplus">+          break;</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineplus">+        }</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineplus">+        mEncBits += value;</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineplus">+        *(dest++) = (char16_t) mEncBits;</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineplus">+        mEncBits = 0;</span>
<a href="#l7.130"></a><span id="l7.130" class="difflineplus">+        break;</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineplus">+    }</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineplus">+</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineplus">+    if (res != NS_OK) break;</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineplus">+</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineplus">+    src++;</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineplus">+    (++mEncStep)%=8;</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineplus">+  }</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineplus">+</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineplus">+  *aSrcLength = src - aSrc;</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineplus">+  *aDestLength = dest - aDest;</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineplus">+  return res;</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineplus">+}</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineplus">+</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineplus">+uint32_t nsBasicUTF7Decoder::CharToValue(char aChar) {</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineplus">+  if ((aChar&gt;='A')&amp;&amp;(aChar&lt;='Z'))</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineplus">+    return (uint8_t)(aChar-'A');</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineplus">+  else if ((aChar&gt;='a')&amp;&amp;(aChar&lt;='z'))</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineplus">+    return (uint8_t)(26+aChar-'a');</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineplus">+  else if ((aChar&gt;='0')&amp;&amp;(aChar&lt;='9'))</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineplus">+    return (uint8_t)(26+26+aChar-'0');</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineplus">+  else if (aChar=='+')</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineplus">+    return (uint8_t)(26+26+10);</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineplus">+  else if (aChar==mLastChar)</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineplus">+    return (uint8_t)(26+26+10+1);</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineplus">+  else</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineplus">+    return 0xffff;</span>
<a href="#l7.157"></a><span id="l7.157" class="difflineplus">+}</span>
<a href="#l7.158"></a><span id="l7.158" class="difflineplus">+</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineplus">+// Subclassing of nsBufferDecoderSupport class [implementation]</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineplus">+</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineplus">+NS_IMETHODIMP nsBasicUTF7Decoder::ConvertNoBuff(const char * aSrc,</span>
<a href="#l7.163"></a><span id="l7.163" class="difflineplus">+                                                int32_t * aSrcLength,</span>
<a href="#l7.164"></a><span id="l7.164" class="difflineplus">+                                                char16_t * aDest,</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineplus">+                                                int32_t * aDestLength)</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineplus">+{</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineplus">+  const char * srcEnd = aSrc + *aSrcLength;</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineplus">+  const char * src = aSrc;</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineplus">+  char16_t * destEnd = aDest + *aDestLength;</span>
<a href="#l7.170"></a><span id="l7.170" class="difflineplus">+  char16_t * dest = aDest;</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineplus">+  int32_t bcr,bcw;</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineplus">+  nsresult res = NS_OK;</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineplus">+</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineplus">+  while (src &lt; srcEnd) {</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineplus">+</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineplus">+    // fist, attept to decode in the current mode</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineplus">+    bcr = srcEnd - src;</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineplus">+    bcw = destEnd - dest;</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineplus">+    if (mEncoding == ENC_DIRECT)</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineplus">+      res = DecodeDirect(src, &amp;bcr, dest, &amp;bcw);</span>
<a href="#l7.181"></a><span id="l7.181" class="difflineplus">+    else if ((mFreshBase64) &amp;&amp; (*src == '-')) {</span>
<a href="#l7.182"></a><span id="l7.182" class="difflineplus">+      *dest = mEscChar;</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineplus">+      bcr = 0;</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineplus">+      bcw = 1;</span>
<a href="#l7.185"></a><span id="l7.185" class="difflineplus">+      res = NS_ERROR_UDEC_ILLEGALINPUT;</span>
<a href="#l7.186"></a><span id="l7.186" class="difflineplus">+    } else {</span>
<a href="#l7.187"></a><span id="l7.187" class="difflineplus">+      mFreshBase64 = false;</span>
<a href="#l7.188"></a><span id="l7.188" class="difflineplus">+      res = DecodeBase64(src, &amp;bcr, dest, &amp;bcw);</span>
<a href="#l7.189"></a><span id="l7.189" class="difflineplus">+    }</span>
<a href="#l7.190"></a><span id="l7.190" class="difflineplus">+    src += bcr;</span>
<a href="#l7.191"></a><span id="l7.191" class="difflineplus">+    dest += bcw;</span>
<a href="#l7.192"></a><span id="l7.192" class="difflineplus">+</span>
<a href="#l7.193"></a><span id="l7.193" class="difflineplus">+    // if an illegal char was encountered, test if it is an escape seq.</span>
<a href="#l7.194"></a><span id="l7.194" class="difflineplus">+    if (res == NS_ERROR_UDEC_ILLEGALINPUT) {</span>
<a href="#l7.195"></a><span id="l7.195" class="difflineplus">+      if (mEncoding == ENC_DIRECT) {</span>
<a href="#l7.196"></a><span id="l7.196" class="difflineplus">+        if (*src == mEscChar) {</span>
<a href="#l7.197"></a><span id="l7.197" class="difflineplus">+          mEncoding = ENC_BASE64;</span>
<a href="#l7.198"></a><span id="l7.198" class="difflineplus">+          mFreshBase64 = true;</span>
<a href="#l7.199"></a><span id="l7.199" class="difflineplus">+          mEncBits = 0;</span>
<a href="#l7.200"></a><span id="l7.200" class="difflineplus">+          mEncStep = 0;</span>
<a href="#l7.201"></a><span id="l7.201" class="difflineplus">+          src++;</span>
<a href="#l7.202"></a><span id="l7.202" class="difflineplus">+          res = NS_OK;</span>
<a href="#l7.203"></a><span id="l7.203" class="difflineplus">+        } else break;</span>
<a href="#l7.204"></a><span id="l7.204" class="difflineplus">+      } else {</span>
<a href="#l7.205"></a><span id="l7.205" class="difflineplus">+        mEncoding = ENC_DIRECT;</span>
<a href="#l7.206"></a><span id="l7.206" class="difflineplus">+        res = NS_OK;</span>
<a href="#l7.207"></a><span id="l7.207" class="difflineplus">+        // absorbe end of escape sequence</span>
<a href="#l7.208"></a><span id="l7.208" class="difflineplus">+        if (*src == '-') src++;</span>
<a href="#l7.209"></a><span id="l7.209" class="difflineplus">+      }</span>
<a href="#l7.210"></a><span id="l7.210" class="difflineplus">+    } else if (res != NS_OK) break;</span>
<a href="#l7.211"></a><span id="l7.211" class="difflineplus">+  }</span>
<a href="#l7.212"></a><span id="l7.212" class="difflineplus">+</span>
<a href="#l7.213"></a><span id="l7.213" class="difflineplus">+  *aSrcLength = src - aSrc;</span>
<a href="#l7.214"></a><span id="l7.214" class="difflineplus">+  *aDestLength = dest - aDest;</span>
<a href="#l7.215"></a><span id="l7.215" class="difflineplus">+  return res;</span>
<a href="#l7.216"></a><span id="l7.216" class="difflineplus">+}</span>
<a href="#l7.217"></a><span id="l7.217" class="difflineplus">+</span>
<a href="#l7.218"></a><span id="l7.218" class="difflineplus">+NS_IMETHODIMP nsBasicUTF7Decoder::Reset()</span>
<a href="#l7.219"></a><span id="l7.219" class="difflineplus">+{</span>
<a href="#l7.220"></a><span id="l7.220" class="difflineplus">+  mEncoding = ENC_DIRECT;</span>
<a href="#l7.221"></a><span id="l7.221" class="difflineplus">+  mEncBits = 0;</span>
<a href="#l7.222"></a><span id="l7.222" class="difflineplus">+  mEncStep = 0;</span>
<a href="#l7.223"></a><span id="l7.223" class="difflineplus">+  return nsBufferDecoderSupport::Reset();</span>
<a href="#l7.224"></a><span id="l7.224" class="difflineplus">+}</span>
<a href="#l7.225"></a><span id="l7.225" class="difflineplus">+</span>
<a href="#l7.226"></a><span id="l7.226" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l7.227"></a><span id="l7.227" class="difflineplus">+// Class nsUTF7ToUnicode [implementation]</span>
<a href="#l7.228"></a><span id="l7.228" class="difflineplus">+</span>
<a href="#l7.229"></a><span id="l7.229" class="difflineplus">+nsUTF7ToUnicode::nsUTF7ToUnicode()</span>
<a href="#l7.230"></a><span id="l7.230" class="difflineplus">+: nsBasicUTF7Decoder('/', '+')</span>
<a href="#l7.231"></a><span id="l7.231" class="difflineplus">+{</span>
<a href="#l7.232"></a><span id="l7.232" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/mailnews/intl/nsUTF7ToUnicode.h</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,72 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+#ifndef nsUTF7ToUnicode_h___</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+#define nsUTF7ToUnicode_h___</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+#include &quot;nsUCSupport.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+// Class nsBasicUTF7Decoder [declaration]</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+/**</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+ * Basic class for a character set converter from UTF-7 to Unicode.</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+ *</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+ * @created         03/Jun/1999</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+ * @author  Catalin Rotaru [CATA]</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+ */</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+class nsBasicUTF7Decoder : public nsBufferDecoderSupport</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+{</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+public:</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+  /**</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+   * Class constructor.</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+   */</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+  nsBasicUTF7Decoder(char aLastChar, char aEscChar);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+protected:</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+  int32_t                   mEncoding;      // current encoding</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+  uint32_t                  mEncBits;</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+  int32_t                   mEncStep;</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  char                      mLastChar;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  char                      mEscChar;</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+  bool                      mFreshBase64;</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+  nsresult DecodeDirect(const char * aSrc, int32_t * aSrcLength,</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+      char16_t * aDest, int32_t * aDestLength);</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+  nsresult DecodeBase64(const char * aSrc, int32_t * aSrcLength,</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+      char16_t * aDest, int32_t * aDestLength);</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+  uint32_t CharToValue(char aChar);</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+  //--------------------------------------------------------------------</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+  // Subclassing of nsBufferDecoderSupport class [declaration]</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+  NS_IMETHOD ConvertNoBuff(const char * aSrc, int32_t * aSrcLength,</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+      char16_t * aDest, int32_t * aDestLength);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+  NS_IMETHOD Reset();</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+};</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+// Class nsUTF7ToUnicode [declaration]</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+/**</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+ * A character set converter from Modified UTF7 to Unicode.</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+ *</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+ * @created         18/May/1999</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+ * @author  Catalin Rotaru [CATA]</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+ */</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+class nsUTF7ToUnicode : public nsBasicUTF7Decoder</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+{</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+public:</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+  /**</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+   * Class constructor.</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+   */</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+  nsUTF7ToUnicode();</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+};</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+#endif /* nsUTF7ToUnicode_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mailnews/intl/nsUnicodeToMUTF7.cpp</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+#include &quot;nsUnicodeToMUTF7.h&quot;</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+// Class nsUnicodeToMUTF7 [implementation]</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+nsUnicodeToMUTF7::nsUnicodeToMUTF7()</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+: nsBasicUTF7Encoder(',', '&amp;')</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+{</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/mailnews/intl/nsUnicodeToMUTF7.h</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,31 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+#ifndef nsUnicodeToMUTF7_h___</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+#define nsUnicodeToMUTF7_h___</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+#include &quot;nsUnicodeToUTF7.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+// Class nsUnicodeToMUTF7 [declaration]</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+/**</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+ * A character set converter from Unicode to Modified UTF-7.</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+ *</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+ * @created         18/May/1999</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+ * @author  Catalin Rotaru [CATA]</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+ */</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+class nsUnicodeToMUTF7 : public nsBasicUTF7Encoder</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+{</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+public:</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+  /**</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+   * Class constructor.</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+   */</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+  nsUnicodeToMUTF7();</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+};</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+#endif /* nsUnicodeToMUTF7_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/mailnews/intl/nsUnicodeToUTF7.cpp</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,298 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+#include &quot;nsUnicodeToUTF7.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+#include &lt;string.h&gt;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+// Global functions and data [declaration]</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+#define ENC_DIRECT      0</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+#define ENC_BASE64      1</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+// Class nsBasicUTF7Encoder [implementation]</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+nsBasicUTF7Encoder::nsBasicUTF7Encoder(char aLastChar, char aEscChar)</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+: nsEncoderSupport(5)</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+{</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+  mLastChar = aLastChar;</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+  mEscChar = aEscChar;</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+  Reset();</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+}</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+nsresult nsBasicUTF7Encoder::ShiftEncoding(int32_t aEncoding,</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+                                          char * aDest,</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+                                          int32_t * aDestLength)</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+{</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  if (aEncoding == mEncoding) {</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+    *aDestLength = 0;</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+    return NS_OK;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+  }</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+  nsresult res = NS_OK;</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+  char * dest = aDest;</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+  char * destEnd = aDest + *aDestLength;</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+  if (mEncStep != 0) {</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+    if (dest &gt;= destEnd) return NS_OK_UENC_MOREOUTPUT;</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+    *(dest++)=ValueToChar(mEncBits);</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+    mEncStep = 0;</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+    mEncBits = 0;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+  }</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+  if (dest &gt;= destEnd) {</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+    res = NS_OK_UENC_MOREOUTPUT;</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+  } else {</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+    switch (aEncoding) {</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+      case 0:</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+        *(dest++) = '-';</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+        mEncStep = 0;</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+        mEncBits = 0;</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+        break;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+      case 1:</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+        *(dest++) = mEscChar;</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+        break;</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineplus">+    }</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+    mEncoding = aEncoding;</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineplus">+  }</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineplus">+</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+  *aDestLength  = dest - aDest;</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+  return res;</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+}</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+nsresult nsBasicUTF7Encoder::EncodeDirect(</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineplus">+                            const char16_t * aSrc,</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+                            int32_t * aSrcLength,</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+                            char * aDest,</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+                            int32_t * aDestLength)</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+{</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+  nsresult res = NS_OK;</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+  const char16_t * src = aSrc;</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+  const char16_t * srcEnd = aSrc + *aSrcLength;</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+  char * dest = aDest;</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineplus">+  char * destEnd = aDest + *aDestLength;</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineplus">+  char16_t ch;</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineplus">+</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+  while (src &lt; srcEnd) {</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+    ch = *src;</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+    // stop when we reach Unicode chars</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+    if (!DirectEncodable(ch)) break;</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+    if (ch == mEscChar) {</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+      // special case for the escape char</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+      if (destEnd - dest &lt; 1) {</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+        res = NS_OK_UENC_MOREOUTPUT;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+        break;</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+      } else {</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+        *dest++ = (char)ch;</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+        *dest++ = (char)'-';</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+        src++;</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineplus">+      }</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+    } else {</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+      //classic direct encoding</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineplus">+      if (dest &gt;= destEnd) {</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineplus">+        res = NS_OK_UENC_MOREOUTPUT;</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineplus">+        break;</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineplus">+      } else {</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+        *dest++ = (char)ch;</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineplus">+        src++;</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+      }</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineplus">+    }</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineplus">+  }</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineplus">+</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+  *aSrcLength = src - aSrc;</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineplus">+  *aDestLength  = dest - aDest;</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineplus">+  return res;</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineplus">+}</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineplus">+</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineplus">+nsresult nsBasicUTF7Encoder::EncodeBase64(</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineplus">+                             const char16_t * aSrc,</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+                             int32_t * aSrcLength,</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineplus">+                             char * aDest,</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineplus">+                             int32_t * aDestLength)</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineplus">+{</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineplus">+  nsresult res = NS_OK;</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineplus">+  const char16_t * src = aSrc;</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineplus">+  const char16_t * srcEnd = aSrc + *aSrcLength;</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineplus">+  char * dest = aDest;</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineplus">+  char * destEnd = aDest + *aDestLength;</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+  char16_t ch;</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineplus">+  uint32_t value;</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineplus">+</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineplus">+  while (src &lt; srcEnd) {</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineplus">+    ch = *src;</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineplus">+</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineplus">+    // stop when we reach printable US-ASCII chars</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineplus">+    if (DirectEncodable(ch)) break;</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineplus">+</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+    switch (mEncStep) {</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineplus">+      case 0:</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineplus">+        if (destEnd - dest &lt; 2) {</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineplus">+          res = NS_OK_UENC_MOREOUTPUT;</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineplus">+          break;</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineplus">+        }</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineplus">+        value=ch&gt;&gt;10;</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineplus">+        *(dest++)=ValueToChar(value);</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+        value=(ch&gt;&gt;4)&amp;0x3f;</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineplus">+        *(dest++)=ValueToChar(value);</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineplus">+        mEncBits=(ch&amp;0x0f)&lt;&lt;2;</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineplus">+        break;</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineplus">+      case 1:</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineplus">+        if (destEnd - dest &lt; 3) {</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineplus">+          res = NS_OK_UENC_MOREOUTPUT;</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineplus">+          break;</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineplus">+        }</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineplus">+        value=mEncBits+(ch&gt;&gt;14);</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineplus">+        *(dest++)=ValueToChar(value);</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineplus">+        value=(ch&gt;&gt;8)&amp;0x3f;</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineplus">+        *(dest++)=ValueToChar(value);</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineplus">+        value=(ch&gt;&gt;2)&amp;0x3f;</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineplus">+        *(dest++)=ValueToChar(value);</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineplus">+        mEncBits=(ch&amp;0x03)&lt;&lt;4;</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineplus">+        break;</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineplus">+      case 2:</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineplus">+        if (destEnd - dest &lt; 3) {</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineplus">+          res = NS_OK_UENC_MOREOUTPUT;</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineplus">+          break;</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineplus">+        }</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineplus">+        value=mEncBits+(ch&gt;&gt;12);</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineplus">+        *(dest++)=ValueToChar(value);</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineplus">+        value=(ch&gt;&gt;6)&amp;0x3f;</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineplus">+        *(dest++)=ValueToChar(value);</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineplus">+        value=ch&amp;0x3f;</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineplus">+        *(dest++)=ValueToChar(value);</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineplus">+        mEncBits=0;</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineplus">+        break;</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineplus">+    }</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineplus">+</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineplus">+    if (res != NS_OK) break;</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineplus">+</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineplus">+    src++;</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineplus">+    (++mEncStep)%=3;</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineplus">+  }</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineplus">+</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineplus">+  *aSrcLength = src - aSrc;</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineplus">+  *aDestLength  = dest - aDest;</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineplus">+  return res;</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineplus">+}</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineplus">+</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineplus">+char nsBasicUTF7Encoder::ValueToChar(uint32_t aValue) {</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineplus">+  if (aValue &lt; 26)</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineplus">+    return (char)('A'+aValue);</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineplus">+  else if (aValue &lt; 26 + 26)</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineplus">+    return (char)('a' + aValue - 26);</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineplus">+  else if (aValue &lt; 26 + 26 + 10)</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineplus">+    return (char)('0' + aValue - 26 - 26);</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineplus">+  else if (aValue == 26 + 26 + 10)</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineplus">+    return '+';</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineplus">+  else if (aValue == 26 + 26 + 10 + 1)</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineplus">+    return mLastChar;</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineplus">+  else</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineplus">+    return -1;</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineplus">+}</span>
<a href="#l11.201"></a><span id="l11.201" class="difflineplus">+</span>
<a href="#l11.202"></a><span id="l11.202" class="difflineplus">+bool nsBasicUTF7Encoder::DirectEncodable(char16_t aChar) {</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineplus">+  // spec says: printable US-ASCII chars</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineplus">+  if ((aChar &gt;= 0x20) &amp;&amp; (aChar &lt;= 0x7e)) return true;</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineplus">+  else return false;</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineplus">+}</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineplus">+</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineplus">+// Subclassing of nsEncoderSupport class [implementation]</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineplus">+</span>
<a href="#l11.211"></a><span id="l11.211" class="difflineplus">+NS_IMETHODIMP nsBasicUTF7Encoder::ConvertNoBuffNoErr(</span>
<a href="#l11.212"></a><span id="l11.212" class="difflineplus">+                                  const char16_t * aSrc,</span>
<a href="#l11.213"></a><span id="l11.213" class="difflineplus">+                                  int32_t * aSrcLength,</span>
<a href="#l11.214"></a><span id="l11.214" class="difflineplus">+                                  char * aDest,</span>
<a href="#l11.215"></a><span id="l11.215" class="difflineplus">+                                  int32_t * aDestLength)</span>
<a href="#l11.216"></a><span id="l11.216" class="difflineplus">+{</span>
<a href="#l11.217"></a><span id="l11.217" class="difflineplus">+  nsresult res = NS_OK;</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineplus">+  const char16_t * src = aSrc;</span>
<a href="#l11.219"></a><span id="l11.219" class="difflineplus">+  const char16_t * srcEnd = aSrc + *aSrcLength;</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineplus">+  char * dest = aDest;</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineplus">+  char * destEnd = aDest + *aDestLength;</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineplus">+  int32_t bcr,bcw;</span>
<a href="#l11.223"></a><span id="l11.223" class="difflineplus">+  char16_t ch;</span>
<a href="#l11.224"></a><span id="l11.224" class="difflineplus">+  int32_t enc;</span>
<a href="#l11.225"></a><span id="l11.225" class="difflineplus">+</span>
<a href="#l11.226"></a><span id="l11.226" class="difflineplus">+  while (src &lt; srcEnd) {</span>
<a href="#l11.227"></a><span id="l11.227" class="difflineplus">+    // find the encoding for the next char</span>
<a href="#l11.228"></a><span id="l11.228" class="difflineplus">+    ch = *src;</span>
<a href="#l11.229"></a><span id="l11.229" class="difflineplus">+    if (DirectEncodable(ch))</span>
<a href="#l11.230"></a><span id="l11.230" class="difflineplus">+      enc = ENC_DIRECT;</span>
<a href="#l11.231"></a><span id="l11.231" class="difflineplus">+    else</span>
<a href="#l11.232"></a><span id="l11.232" class="difflineplus">+      enc = ENC_BASE64;</span>
<a href="#l11.233"></a><span id="l11.233" class="difflineplus">+</span>
<a href="#l11.234"></a><span id="l11.234" class="difflineplus">+    // if necessary, shift into the required encoding</span>
<a href="#l11.235"></a><span id="l11.235" class="difflineplus">+    bcw = destEnd - dest;</span>
<a href="#l11.236"></a><span id="l11.236" class="difflineplus">+    res = ShiftEncoding(enc, dest, &amp;bcw);</span>
<a href="#l11.237"></a><span id="l11.237" class="difflineplus">+    dest += bcw;</span>
<a href="#l11.238"></a><span id="l11.238" class="difflineplus">+    if (res != NS_OK) break;</span>
<a href="#l11.239"></a><span id="l11.239" class="difflineplus">+</span>
<a href="#l11.240"></a><span id="l11.240" class="difflineplus">+    // now encode (as much as you can)</span>
<a href="#l11.241"></a><span id="l11.241" class="difflineplus">+    bcr = srcEnd - src;</span>
<a href="#l11.242"></a><span id="l11.242" class="difflineplus">+    bcw = destEnd - dest;</span>
<a href="#l11.243"></a><span id="l11.243" class="difflineplus">+    if (enc == ENC_DIRECT)</span>
<a href="#l11.244"></a><span id="l11.244" class="difflineplus">+      res = EncodeDirect(src, &amp;bcr, dest, &amp;bcw);</span>
<a href="#l11.245"></a><span id="l11.245" class="difflineplus">+    else</span>
<a href="#l11.246"></a><span id="l11.246" class="difflineplus">+      res = EncodeBase64(src, &amp;bcr, dest, &amp;bcw);</span>
<a href="#l11.247"></a><span id="l11.247" class="difflineplus">+    src += bcr;</span>
<a href="#l11.248"></a><span id="l11.248" class="difflineplus">+    dest += bcw;</span>
<a href="#l11.249"></a><span id="l11.249" class="difflineplus">+</span>
<a href="#l11.250"></a><span id="l11.250" class="difflineplus">+    if (res != NS_OK) break;</span>
<a href="#l11.251"></a><span id="l11.251" class="difflineplus">+  }</span>
<a href="#l11.252"></a><span id="l11.252" class="difflineplus">+</span>
<a href="#l11.253"></a><span id="l11.253" class="difflineplus">+  *aSrcLength = src - aSrc;</span>
<a href="#l11.254"></a><span id="l11.254" class="difflineplus">+  *aDestLength  = dest - aDest;</span>
<a href="#l11.255"></a><span id="l11.255" class="difflineplus">+  return res;</span>
<a href="#l11.256"></a><span id="l11.256" class="difflineplus">+}</span>
<a href="#l11.257"></a><span id="l11.257" class="difflineplus">+</span>
<a href="#l11.258"></a><span id="l11.258" class="difflineplus">+NS_IMETHODIMP nsBasicUTF7Encoder::FinishNoBuff(char * aDest,</span>
<a href="#l11.259"></a><span id="l11.259" class="difflineplus">+                                               int32_t * aDestLength)</span>
<a href="#l11.260"></a><span id="l11.260" class="difflineplus">+{</span>
<a href="#l11.261"></a><span id="l11.261" class="difflineplus">+  return ShiftEncoding(ENC_DIRECT, aDest, aDestLength);</span>
<a href="#l11.262"></a><span id="l11.262" class="difflineplus">+}</span>
<a href="#l11.263"></a><span id="l11.263" class="difflineplus">+</span>
<a href="#l11.264"></a><span id="l11.264" class="difflineplus">+NS_IMETHODIMP nsBasicUTF7Encoder::Reset()</span>
<a href="#l11.265"></a><span id="l11.265" class="difflineplus">+{</span>
<a href="#l11.266"></a><span id="l11.266" class="difflineplus">+  mEncoding = ENC_DIRECT;</span>
<a href="#l11.267"></a><span id="l11.267" class="difflineplus">+  mEncBits = 0;</span>
<a href="#l11.268"></a><span id="l11.268" class="difflineplus">+  mEncStep = 0;</span>
<a href="#l11.269"></a><span id="l11.269" class="difflineplus">+  return nsEncoderSupport::Reset();</span>
<a href="#l11.270"></a><span id="l11.270" class="difflineplus">+}</span>
<a href="#l11.271"></a><span id="l11.271" class="difflineplus">+</span>
<a href="#l11.272"></a><span id="l11.272" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l11.273"></a><span id="l11.273" class="difflineplus">+// Class nsUnicodeToUTF7 [implementation]</span>
<a href="#l11.274"></a><span id="l11.274" class="difflineplus">+</span>
<a href="#l11.275"></a><span id="l11.275" class="difflineplus">+nsUnicodeToUTF7::nsUnicodeToUTF7()</span>
<a href="#l11.276"></a><span id="l11.276" class="difflineplus">+: nsBasicUTF7Encoder('/', '+')</span>
<a href="#l11.277"></a><span id="l11.277" class="difflineplus">+{</span>
<a href="#l11.278"></a><span id="l11.278" class="difflineplus">+}</span>
<a href="#l11.279"></a><span id="l11.279" class="difflineplus">+</span>
<a href="#l11.280"></a><span id="l11.280" class="difflineplus">+</span>
<a href="#l11.281"></a><span id="l11.281" class="difflineplus">+bool nsUnicodeToUTF7::DirectEncodable(char16_t aChar) {</span>
<a href="#l11.282"></a><span id="l11.282" class="difflineplus">+  if ((aChar &gt;= 'A') &amp;&amp; (aChar &lt;= 'Z')) return true;</span>
<a href="#l11.283"></a><span id="l11.283" class="difflineplus">+  else if ((aChar &gt;= 'a') &amp;&amp; (aChar &lt;= 'z')) return true;</span>
<a href="#l11.284"></a><span id="l11.284" class="difflineplus">+  else if ((aChar &gt;= '0') &amp;&amp; (aChar &lt;= '9')) return true;</span>
<a href="#l11.285"></a><span id="l11.285" class="difflineplus">+  else if ((aChar &gt;= 39) &amp;&amp; (aChar &lt;= 41)) return true;</span>
<a href="#l11.286"></a><span id="l11.286" class="difflineplus">+  else if ((aChar &gt;= 44) &amp;&amp; (aChar &lt;= 47)) return true;</span>
<a href="#l11.287"></a><span id="l11.287" class="difflineplus">+  else if (aChar == 58) return true;</span>
<a href="#l11.288"></a><span id="l11.288" class="difflineplus">+  else if (aChar == 63) return true;</span>
<a href="#l11.289"></a><span id="l11.289" class="difflineplus">+  else if (aChar == ' ') return true;</span>
<a href="#l11.290"></a><span id="l11.290" class="difflineplus">+  else if (aChar == 9) return true;</span>
<a href="#l11.291"></a><span id="l11.291" class="difflineplus">+  else if (aChar == 13) return true;</span>
<a href="#l11.292"></a><span id="l11.292" class="difflineplus">+  else if (aChar == 10) return true;</span>
<a href="#l11.293"></a><span id="l11.293" class="difflineplus">+  else if (aChar == 60) return true;  // '&lt;'</span>
<a href="#l11.294"></a><span id="l11.294" class="difflineplus">+  else if (aChar == 33) return true;  // '!'</span>
<a href="#l11.295"></a><span id="l11.295" class="difflineplus">+  else if (aChar == 34) return true;  // '&quot;'</span>
<a href="#l11.296"></a><span id="l11.296" class="difflineplus">+  else if (aChar == 62) return true;  // '&gt;'</span>
<a href="#l11.297"></a><span id="l11.297" class="difflineplus">+  else if (aChar == 61) return true;  // '='</span>
<a href="#l11.298"></a><span id="l11.298" class="difflineplus">+  else if (aChar == 59) return true;  // ';'</span>
<a href="#l11.299"></a><span id="l11.299" class="difflineplus">+  else if (aChar == 91) return true;  // '['</span>
<a href="#l11.300"></a><span id="l11.300" class="difflineplus">+  else if (aChar == 93) return true;  // ']'</span>
<a href="#l11.301"></a><span id="l11.301" class="difflineplus">+  else return false;</span>
<a href="#l11.302"></a><span id="l11.302" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/mailnews/intl/nsUnicodeToUTF7.h</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,78 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+#ifndef nsUnicodeToUTF7_h___</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+#define nsUnicodeToUTF7_h___</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+#include &quot;nsUCSupport.h&quot;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+// Class nsBasicUTF7Encoder [declaration]</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+/**</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+ * Basic class for a character set converter from Unicode to UTF-7.</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+ *</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+ * @created         03/Jun/1999</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+ * @author  Catalin Rotaru [CATA]</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+ */</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+class nsBasicUTF7Encoder : public nsEncoderSupport</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+{</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+public:</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+  /**</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+   * Class constructor.</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+   */</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+  nsBasicUTF7Encoder(char aLastChar, char aEscChar);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+protected:</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  int32_t                   mEncoding;      // current encoding</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+  uint32_t                  mEncBits;</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+  int32_t                   mEncStep;</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+  char                      mLastChar;</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+  char                      mEscChar;</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+  nsresult ShiftEncoding(int32_t aEncoding, char * aDest,</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+      int32_t * aDestLength);</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+  nsresult EncodeDirect(const char16_t * aSrc, int32_t * aSrcLength,</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+      char * aDest, int32_t * aDestLength);</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+  nsresult EncodeBase64(const char16_t * aSrc, int32_t * aSrcLength,</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+      char * aDest, int32_t * aDestLength);</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+  char ValueToChar(uint32_t aValue);</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+  virtual bool DirectEncodable(char16_t aChar);</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+  //--------------------------------------------------------------------</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+  // Subclassing of nsEncoderSupport class [declaration]</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+  NS_IMETHOD ConvertNoBuffNoErr(const char16_t * aSrc, int32_t * aSrcLength,</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+      char * aDest, int32_t * aDestLength);</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+  NS_IMETHOD FinishNoBuff(char * aDest, int32_t * aDestLength);</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+  NS_IMETHOD Reset();</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+};</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+//----------------------------------------------------------------------</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+// Class nsUnicodeToUTF7 [declaration]</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+/**</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+ * A character set converter from Unicode to UTF-7.</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineplus">+ *</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+ * @created         03/Jun/1999</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+ * @author  Catalin Rotaru [CATA]</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+ */</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+class nsUnicodeToUTF7 : public nsBasicUTF7Encoder</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+{</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+public:</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+  /**</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+   * Class constructor.</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineplus">+   */</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+  nsUnicodeToUTF7();</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+protected:</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineplus">+</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineplus">+  virtual bool DirectEncodable(char16_t aChar);</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineplus">+};</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineplus">+</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineplus">+#endif /* nsUnicodeToUTF7_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/mailnews/intl/test/Makefile</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,16 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+DEPTH		= ../../..</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+topsrcdir	= ../../..</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+srcdir		= .</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+VPATH		= .</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+relativesrcdir = mailnews/intl/test</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+include $(DEPTH)/config/autoconf.mk</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+XPCSHELL_TESTS = unit</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+include $(topsrcdir)/config/rules.mk</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/mailnews/intl/test/moz.build</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,7 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+# vim: set filetype=python:</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineplus">+XPCSHELL_TESTS_MANIFESTS += ['unit/xpcshell.ini']</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- /dev/null</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ b/mailnews/intl/test/unit/test_decode_utf-7.js</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineplus">+// Tests conversion from UTF-7 to Unicode. The conversion should fail!</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+load('CharsetConversionTests.js');</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineplus">+</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineplus">+const inString = &quot;+LGI--+ITIipSIp- +AocCeQ-oddns +Ad0CjQ- s+ATECZQKH- p+AlAB3QJ5- u+AlACVA- no+Ao4- +Al8-I&quot;;</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+const expectedString = &quot;+LGI--+ITIipSIp- +AocCeQ-oddns +Ad0CjQ- s+ATECZQKH- p+AlAB3QJ5- u+AlACVA- no+Ao4- +Al8-I&quot;;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+const aliases = [ &quot;UTF-7&quot;, &quot;utf-7&quot;, &quot;x-unicode-2-0-utf-7&quot;, &quot;unicode-2-0-utf-7&quot;,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+		  &quot;unicode-1-1-utf-7&quot;, &quot;csunicode11utf7&quot; ];</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+function run_test() {</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+  testDecodeAliases();</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- /dev/null</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ b/mailnews/intl/test/unit/test_decode_utf-7_internal.js</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineplus">+// Tests conversion from UTF-7 to Unicode.</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineplus">+</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineplus">+load('CharsetConversionTests.js');</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineplus">+</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+const inString = &quot;+LGI--+ITIipSIp- +AocCeQ-oddns +Ad0CjQ- s+ATECZQKH- p+AlAB3QJ5- u+AlACVA- no+Ao4- +Al8-I&quot;;</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineplus">+</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+const expectedString = &quot;\u2C62-\u2132\u22A5\u2229 \u0287\u0279oddns \u01DD\u028D s\u0131\u0265\u0287 p\u0250\u01DD\u0279 u\u0250\u0254 no\u028E \u025FI&quot;;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+const aliases = [ &quot;UTF-7&quot;, &quot;utf-7&quot;, &quot;x-unicode-2-0-utf-7&quot;, &quot;unicode-2-0-utf-7&quot;,</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+		  &quot;unicode-1-1-utf-7&quot;, &quot;csunicode11utf7&quot; ];</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+function run_test() {</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+  testDecodeAliasesInternal();</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/mailnews/intl/test/unit/test_encode_utf-7.js</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+// Tests conversion from Unicode to UTF-7. The conversion should fail!</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+load('CharsetConversionTests.js');</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+const inString = &quot;\u2C62-\u2132\u22A5\u2229 \u0287\u0279oddns \u01DD\u028D s\u0131\u0265\u0287 p\u0250\u01DD\u0279 u\u0250\u0254 no\u028E \u025FI&quot;;</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+const expectedString = &quot;?-??? ??oddns ?? s??? p??? u?? no? ?I&quot;;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+const aliases = [ &quot;UTF-7&quot;, &quot;utf-7&quot;, &quot;x-unicode-2-0-utf-7&quot;, &quot;unicode-2-0-utf-7&quot;,</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+		  &quot;unicode-1-1-utf-7&quot;, &quot;csunicode11utf7&quot; ];</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+function run_test() {</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+  testEncodeAliases();</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/mailnews/intl/test/unit/test_encode_utf-7_internal.js</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+// Tests conversion from Unicode to UTF-7.</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineplus">+</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineplus">+load('CharsetConversionTests.js');</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+const inString = &quot;\u2C62-\u2132\u22A5\u2229 \u0287\u0279oddns \u01DD\u028D s\u0131\u0265\u0287 p\u0250\u01DD\u0279 u\u0250\u0254 no\u028E \u025FI&quot;;</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+const expectedString = &quot;+LGI--+ITIipSIp- +AocCeQ-oddns +Ad0CjQ- s+ATECZQKH- p+AlAB3QJ5- u+AlACVA- no+Ao4- +Al8-I&quot;;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+const aliases = [ &quot;UTF-7&quot;, &quot;utf-7&quot;, &quot;x-unicode-2-0-utf-7&quot;, &quot;unicode-2-0-utf-7&quot;,</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+		  &quot;unicode-1-1-utf-7&quot;, &quot;csunicode11utf7&quot; ];</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+function run_test() {</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+  testEncodeAliasesInternal();</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">new file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- /dev/null</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ b/mailnews/intl/test/unit/xpcshell.ini</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -0,0 +1,6 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineplus">+[DEFAULT]</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineplus">+</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineplus">+[test_decode_utf-7.js]</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineplus">+[test_decode_utf-7_internal.js]</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineplus">+[test_encode_utf-7.js]</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineplus">+[test_encode_utf-7_internal.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/moz.build</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/moz.build</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -11,16 +11,17 @@ PARALLEL_DIRS += [</span>
<a href="#l20.4"></a><span id="l20.4">     'db/msgdb',</span>
<a href="#l20.5"></a><span id="l20.5">     'extensions',</span>
<a href="#l20.6"></a><span id="l20.6">     'imap/public',</span>
<a href="#l20.7"></a><span id="l20.7">     'imap/src',</span>
<a href="#l20.8"></a><span id="l20.8">     'import/public',</span>
<a href="#l20.9"></a><span id="l20.9">     'import/src',</span>
<a href="#l20.10"></a><span id="l20.10">     'import/text/src',</span>
<a href="#l20.11"></a><span id="l20.11">     'import/vcard/src',</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+    'intl',</span>
<a href="#l20.13"></a><span id="l20.13">     'local/public',</span>
<a href="#l20.14"></a><span id="l20.14">     'local/src',</span>
<a href="#l20.15"></a><span id="l20.15">     'mime',</span>
<a href="#l20.16"></a><span id="l20.16">     'news',</span>
<a href="#l20.17"></a><span id="l20.17"> ]</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19"> if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'cocoa':</span>
<a href="#l20.20"></a><span id="l20.20">     PARALLEL_DIRS += [</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

