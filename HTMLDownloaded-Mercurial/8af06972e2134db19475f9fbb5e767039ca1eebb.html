<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18612:8af06972e2134db19475f9fbb5e767039ca1eebb</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 8af06972e2134db19475f9fbb5e767039ca1eebb" />
<meta property="og:url" content="/comm-central/rev/8af06972e2134db19475f9fbb5e767039ca1eebb" />
<meta property="og:description" content="Bug 1171979 - Thunderbird: Change usage of draggesture to dragstart, dragdrop to drop. r=bwinton, Fallen" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 8af06972e2134db19475f9fbb5e767039ca1eebb 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/8af06972e2134db19475f9fbb5e767039ca1eebb">shortlog</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/8af06972e2134db19475f9fbb5e767039ca1eebb">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb">files</a> |
changeset |
<a href="/comm-central/raw-rev/8af06972e2134db19475f9fbb5e767039ca1eebb">raw</a>  | <a href="/comm-central/archive/8af06972e2134db19475f9fbb5e767039ca1eebb.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1171979">Bug 1171979</a> - Thunderbird: Change usage of draggesture to dragstart, dragdrop to drop. r=bwinton, Fallen
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#103;&#110;&#117;&#115;&#32;&#77;&#101;&#108;&#105;&#110;&#32;&#60;&#109;&#107;&#109;&#101;&#108;&#105;&#110;&#43;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#105;&#107;&#105;&#46;&#102;&#105;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 19 Nov 2015 23:04:54 +0200</td></tr>

<tr>
 <td>changeset 18612</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/8af06972e2134db19475f9fbb5e767039ca1eebb">8af06972e2134db19475f9fbb5e767039ca1eebb</a></td>
</tr>



<tr>
<td>parent 18611</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/79b18e6b5e34a2bf02985999a8304cef675c74ba">79b18e6b5e34a2bf02985999a8304cef675c74ba</a>
</td>
</tr>

<tr>
<td>child 18613</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7c24277d79ad70104a09d8869a900424f2e407bf">7c24277d79ad70104a09d8869a900424f2e407bf</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=8af06972e2134db19475f9fbb5e767039ca1eebb">11395</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Thu, 19 Nov 2015 21:06:57 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8af06972e213 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8af06972e2134db19475f9fbb5e767039ca1eebb">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8af06972e2134db19475f9fbb5e767039ca1eebb&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8af06972e2134db19475f9fbb5e767039ca1eebb&newProject=comm-central&newRevision=8af06972e2134db19475f9fbb5e767039ca1eebb&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8af06972e2134db19475f9fbb5e767039ca1eebb&newProject=comm-central&newRevision=8af06972e2134db19475f9fbb5e767039ca1eebb&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8af06972e2134db19475f9fbb5e767039ca1eebb&newProject=comm-central&newRevision=8af06972e2134db19475f9fbb5e767039ca1eebb&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bwinton%29&revcount=50">bwinton</a>, <a href="/comm-central/log?rev=reviewer%28Fallen%29&revcount=50">Fallen</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1171979">1171979</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1171979">Bug 1171979</a> - Thunderbird: Change usage of draggesture to dragstart, dragdrop to drop. r=bwinton, Fallen

Mostly
 find ./mail ./mailnews ./calendar -type f -readable -writable -exec sed -i &quot;s/draggesture/dragstart/g&quot; {} \;
 find ./mail ./mailnews ./calendar -type f -readable -writable -exec sed -i &quot;s/dragdrop/drop/g&quot; {} \;</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/agenda-listbox.xml">calendar/base/content/agenda-listbox.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/agenda-listbox.xml">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/agenda-listbox.xml">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/agenda-listbox.xml">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/agenda-listbox.xml">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/agenda-listbox.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-view-core.xml">calendar/base/content/calendar-view-core.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-view-core.xml">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-view-core.xml">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-view-core.xml">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-view-core.xml">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/calendar-view-core.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/today-pane.xul">calendar/base/content/today-pane.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/today-pane.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/today-pane.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/today-pane.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/today-pane.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/today-pane.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/widgets/calendar-widgets.xml">calendar/base/content/widgets/calendar-widgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/widgets/calendar-widgets.xml">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/widgets/calendar-widgets.xml">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/widgets/calendar-widgets.xml">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/widgets/calendar-widgets.xml">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/base/content/widgets/calendar-widgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/resources/content/calendarCreation.xul">calendar/resources/content/calendarCreation.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/resources/content/calendarCreation.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/resources/content/calendarCreation.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/resources/content/calendarCreation.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/resources/content/calendarCreation.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/calendar/resources/content/calendarCreation.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/ABSearchDialog.xul">mail/base/content/ABSearchDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/ABSearchDialog.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/ABSearchDialog.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/ABSearchDialog.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/ABSearchDialog.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/ABSearchDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/SearchDialog.xul">mail/base/content/SearchDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/SearchDialog.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/SearchDialog.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/SearchDialog.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/SearchDialog.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/SearchDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messageWindow.xul">mail/base/content/messageWindow.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messageWindow.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messageWindow.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messageWindow.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messageWindow.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messageWindow.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messenger.xul">mail/base/content/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messenger.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messenger.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messenger.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messenger.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/msgHdrViewOverlay.xul">mail/base/content/msgHdrViewOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/msgHdrViewOverlay.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/msgHdrViewOverlay.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/msgHdrViewOverlay.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/msgHdrViewOverlay.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/msgHdrViewOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/nsDragAndDrop.js">mail/base/content/nsDragAndDrop.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/nsDragAndDrop.js">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/nsDragAndDrop.js">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/nsDragAndDrop.js">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/nsDragAndDrop.js">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/content/nsDragAndDrop.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/jar.mn">mail/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/jar.mn">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/jar.mn">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abContactsPanel.xul">mail/components/addrbook/content/abContactsPanel.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abContactsPanel.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abContactsPanel.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abContactsPanel.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abContactsPanel.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abContactsPanel.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abEditListDialog.xul">mail/components/addrbook/content/abEditListDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abEditListDialog.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abEditListDialog.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abEditListDialog.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abEditListDialog.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abEditListDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abMailListDialog.xul">mail/components/addrbook/content/abMailListDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abMailListDialog.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abMailListDialog.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abMailListDialog.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abMailListDialog.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/abMailListDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/addressbook.xul">mail/components/addrbook/content/addressbook.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/addressbook.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/addressbook.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/addressbook.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/addressbook.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/addrbook/content/addressbook.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/compose/content/messengercompose.xul">mail/components/compose/content/messengercompose.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/compose/content/messengercompose.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/compose/content/messengercompose.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/compose/content/messengercompose.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/compose/content/messengercompose.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/compose/content/messengercompose.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/im/content/imAccounts.xul">mail/components/im/content/imAccounts.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/im/content/imAccounts.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/im/content/imAccounts.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/im/content/imAccounts.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/im/content/imAccounts.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mail/components/im/content/imAccounts.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mailnews/addrbook/content/abResultsPaneOverlay.xul">mailnews/addrbook/content/abResultsPaneOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8af06972e2134db19475f9fbb5e767039ca1eebb/mailnews/addrbook/content/abResultsPaneOverlay.xul">file</a> |
<a href="/comm-central/annotate/8af06972e2134db19475f9fbb5e767039ca1eebb/mailnews/addrbook/content/abResultsPaneOverlay.xul">annotate</a> |
<a href="/comm-central/diff/8af06972e2134db19475f9fbb5e767039ca1eebb/mailnews/addrbook/content/abResultsPaneOverlay.xul">diff</a> |
<a href="/comm-central/comparison/8af06972e2134db19475f9fbb5e767039ca1eebb/mailnews/addrbook/content/abResultsPaneOverlay.xul">comparison</a> |
<a href="/comm-central/log/8af06972e2134db19475f9fbb5e767039ca1eebb/mailnews/addrbook/content/abResultsPaneOverlay.xul">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -164,17 +164,17 @@</span>
<a href="#l1.4"></a><span id="l1.4">             addWrap.classList.add(&quot;wrap&quot;);</span>
<a href="#l1.5"></a><span id="l1.5">             addWrap = document.getAnonymousElementByAttribute(this.mAllDayItem, &quot;anonid&quot;, &quot;event-detail-box&quot;);</span>
<a href="#l1.6"></a><span id="l1.6">             addWrap.classList.add(&quot;wrap&quot;);</span>
<a href="#l1.7"></a><span id="l1.7">             allDayDateLabel.value = date;</span>
<a href="#l1.8"></a><span id="l1.8">         ]]&gt;&lt;/body&gt;</span>
<a href="#l1.9"></a><span id="l1.9">       &lt;/method&gt;</span>
<a href="#l1.10"></a><span id="l1.10">     &lt;/implementation&gt;</span>
<a href="#l1.11"></a><span id="l1.11">     &lt;handlers&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      &lt;handler event=&quot;draggesture&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      &lt;handler event=&quot;dragstart&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l1.14"></a><span id="l1.14">         invokeEventDragSession(this.mAllDayItem.occurrence.clone(), this);</span>
<a href="#l1.15"></a><span id="l1.15">         event.stopPropagation();</span>
<a href="#l1.16"></a><span id="l1.16">         event.preventDefault();</span>
<a href="#l1.17"></a><span id="l1.17">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l1.18"></a><span id="l1.18">     &lt;/handlers&gt;</span>
<a href="#l1.19"></a><span id="l1.19">   &lt;/binding&gt;</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21">   &lt;binding id=&quot;agenda-richlist-item&quot;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -276,14 +276,14 @@</span>
<a href="#l1.23"></a><span id="l1.23">                             &quot;#a8c2e1&quot;);</span>
<a href="#l1.24"></a><span id="l1.24">   </span>
<a href="#l1.25"></a><span id="l1.25">             var imagebox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-calendar-image&quot;);</span>
<a href="#l1.26"></a><span id="l1.26">             imagebox.setAttribute(&quot;style&quot;, &quot;background-color: &quot; + calcolor + &quot;;&quot;);</span>
<a href="#l1.27"></a><span id="l1.27">         ]]&gt;&lt;/body&gt;</span>
<a href="#l1.28"></a><span id="l1.28">       &lt;/method&gt;</span>
<a href="#l1.29"></a><span id="l1.29">     &lt;/implementation&gt;</span>
<a href="#l1.30"></a><span id="l1.30">     &lt;handlers&gt;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-      &lt;handler event=&quot;draggesture&quot;&gt;&lt;![CDATA[</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+      &lt;handler event=&quot;dragstart&quot;&gt;&lt;![CDATA[</span>
<a href="#l1.33"></a><span id="l1.33">         invokeEventDragSession(this.mOccurrence.clone(), this);</span>
<a href="#l1.34"></a><span id="l1.34">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l1.35"></a><span id="l1.35">     &lt;/handlers&gt;</span>
<a href="#l1.36"></a><span id="l1.36">   &lt;/binding&gt;</span>
<a href="#l1.37"></a><span id="l1.37"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -672,17 +672,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">           // IsSeparator is used to determine if the row at index is a separator.</span>
<a href="#l2.5"></a><span id="l2.5">           // A value of true will result in the tree drawing a horizontal separator.</span>
<a href="#l2.6"></a><span id="l2.6">           // The tree uses the ::moz-tree-separator pseudoclass to draw the separator.</span>
<a href="#l2.7"></a><span id="l2.7">           isSeparator: function mTV_isSeparator(aRow) {</span>
<a href="#l2.8"></a><span id="l2.8">               return false;</span>
<a href="#l2.9"></a><span id="l2.9">           },</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">           // Specifies if there is currently a sort on any column.</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-          // Used mostly by dragdrop to affect drop feedback.</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+          // Used mostly by drag'n'drop to affect drop feedback.</span>
<a href="#l2.14"></a><span id="l2.14">           isSorted: function mTV_isSorted(aRow) {</span>
<a href="#l2.15"></a><span id="l2.15">               return false;</span>
<a href="#l2.16"></a><span id="l2.16">           },</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">           canDrop: function mTV_canDrop() { return false; },</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20">           drop: function mTV_drop(aRow, aOrientation) {},</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -1127,17 +1127,17 @@</span>
<a href="#l2.23"></a><span id="l2.23">         this.updateFocus();</span>
<a href="#l2.24"></a><span id="l2.24">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l2.25"></a><span id="l2.25">       &lt;handler event=&quot;keypress&quot;&gt;&lt;![CDATA[</span>
<a href="#l2.26"></a><span id="l2.26">         this.mTreeView.onKeyPress(event);</span>
<a href="#l2.27"></a><span id="l2.27">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l2.28"></a><span id="l2.28">       &lt;handler event=&quot;mousedown&quot;&gt;&lt;![CDATA[</span>
<a href="#l2.29"></a><span id="l2.29">         this.mTreeView.onMouseDown(event);</span>
<a href="#l2.30"></a><span id="l2.30">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-      &lt;handler event=&quot;draggesture&quot;&gt;&lt;![CDATA[</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+      &lt;handler event=&quot;dragstart&quot;&gt;&lt;![CDATA[</span>
<a href="#l2.33"></a><span id="l2.33">         if (event.originalTarget.localName != &quot;treechildren&quot;) {</span>
<a href="#l2.34"></a><span id="l2.34">             // We should only drag treechildren, not for example the scrollbar.</span>
<a href="#l2.35"></a><span id="l2.35">             return;</span>
<a href="#l2.36"></a><span id="l2.36">         }</span>
<a href="#l2.37"></a><span id="l2.37">         var item = this.mTreeView._getItemFromEvent(event);</span>
<a href="#l2.38"></a><span id="l2.38">         if (!item || item.calendar.readOnly) {</span>
<a href="#l2.39"></a><span id="l2.39">             return;</span>
<a href="#l2.40"></a><span id="l2.40">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -351,17 +351,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">         }</span>
<a href="#l3.5"></a><span id="l3.5">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l3.6"></a><span id="l3.6">       &lt;handler event=&quot;mouseover&quot;&gt;&lt;![CDATA[</span>
<a href="#l3.7"></a><span id="l3.7">         if (this.calendarView &amp;&amp; this.calendarView.controller) {</span>
<a href="#l3.8"></a><span id="l3.8">             event.stopPropagation();</span>
<a href="#l3.9"></a><span id="l3.9">             onMouseOverItem(event);</span>
<a href="#l3.10"></a><span id="l3.10">         }</span>
<a href="#l3.11"></a><span id="l3.11">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-      &lt;handler event=&quot;draggesture&quot;&gt;&lt;![CDATA[</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+      &lt;handler event=&quot;dragstart&quot;&gt;&lt;![CDATA[</span>
<a href="#l3.14"></a><span id="l3.14">         if( event.target.localName == &quot;calendar-event-box&quot;) {</span>
<a href="#l3.15"></a><span id="l3.15">             return;</span>
<a href="#l3.16"></a><span id="l3.16">         }</span>
<a href="#l3.17"></a><span id="l3.17">         let item = this.occurrence;</span>
<a href="#l3.18"></a><span id="l3.18">         if (!isCalendarWritable(item.calendar)</span>
<a href="#l3.19"></a><span id="l3.19">             || !userCanModifyItem(item)</span>
<a href="#l3.20"></a><span id="l3.20">             || (item.calendar instanceof Components.interfaces.calISchedulingSupport &amp;&amp; item.calendar.isInvitation(item))) {</span>
<a href="#l3.21"></a><span id="l3.21">             return;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/today-pane.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/today-pane.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -184,19 +184,19 @@</span>
<a href="#l4.4"></a><span id="l4.4">                                                checked=&quot;false&quot;</span>
<a href="#l4.5"></a><span id="l4.5">                                                persist=&quot;checked&quot;/&gt;</span>
<a href="#l4.6"></a><span id="l4.6">               &lt;/vbox&gt;</span>
<a href="#l4.7"></a><span id="l4.7">               &lt;richlistbox id=&quot;agenda-listbox&quot; flex=&quot;1&quot; context=&quot;_child&quot;</span>
<a href="#l4.8"></a><span id="l4.8">                            onblur=&quot;agendaListbox.onBlur();&quot;</span>
<a href="#l4.9"></a><span id="l4.9">                            onfocus=&quot;agendaListbox.onFocus();&quot;</span>
<a href="#l4.10"></a><span id="l4.10">                            onkeypress=&quot;agendaListbox.onKeyPress(event);&quot;</span>
<a href="#l4.11"></a><span id="l4.11">                            ondblclick=&quot;agendaListbox.createNewEvent(event);&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                           ondraggesture=&quot;nsDragAndDrop.startDrag(event, calendarCalendarButtonDNDObserver);&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                           ondragstart=&quot;nsDragAndDrop.startDrag(event, calendarCalendarButtonDNDObserver);&quot;</span>
<a href="#l4.14"></a><span id="l4.14">                            ondragover=&quot;nsDragAndDrop.dragOver(event, calendarCalendarButtonDNDObserver);&quot;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-                           ondragdrop=&quot;nsDragAndDrop.drop(event, calendarCalendarButtonDNDObserver);&quot;&gt;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+                           ondrop=&quot;nsDragAndDrop.drop(event, calendarCalendarButtonDNDObserver);&quot;&gt;</span>
<a href="#l4.17"></a><span id="l4.17">                 &lt;menupopup id=&quot;agenda-menupopup&quot; onpopupshowing=&quot;return agendaListbox.setupContextMenu(event.target)&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18">                   &lt;menuitem label=&quot;&amp;calendar.context.modifyorviewitem.label;&quot;</span>
<a href="#l4.19"></a><span id="l4.19">                            accesskey=&quot;&amp;calendar.context.modifyorviewitem.accesskey;&quot;</span>
<a href="#l4.20"></a><span id="l4.20">                            observes=&quot;agenda_edit_event_command&quot;/&gt;</span>
<a href="#l4.21"></a><span id="l4.21">                   &lt;menu id=&quot;agenda-context-menu-convert-menu&quot;</span>
<a href="#l4.22"></a><span id="l4.22">                        label=&quot;&amp;calendar.context.convertmenu.label;&quot;</span>
<a href="#l4.23"></a><span id="l4.23">                        accesskey=&quot;&amp;calendar.context.convertmenu.accesskey.calendar;&quot;&gt;</span>
<a href="#l4.24"></a><span id="l4.24">                    &lt;menupopup id=&quot;agenda-context-menu-convert-menupopup&quot;&gt;</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineat">@@ -277,18 +277,18 @@</span>
<a href="#l4.26"></a><span id="l4.26">               &lt;/richlistbox&gt;</span>
<a href="#l4.27"></a><span id="l4.27">             &lt;/vbox&gt;</span>
<a href="#l4.28"></a><span id="l4.28">         &lt;/modevbox&gt;</span>
<a href="#l4.29"></a><span id="l4.29">         &lt;splitter id=&quot;today-pane-splitter&quot; persist=&quot;hidden&quot;/&gt;</span>
<a href="#l4.30"></a><span id="l4.30">         &lt;modevbox id=&quot;todo-tab-panel&quot; flex=&quot;1&quot; mode=&quot;mail,calendar&quot;</span>
<a href="#l4.31"></a><span id="l4.31">                   collapsedinmodes=&quot;mail,task&quot;</span>
<a href="#l4.32"></a><span id="l4.32">                   broadcaster=&quot;modeBroadcaster&quot;</span>
<a href="#l4.33"></a><span id="l4.33">                   persist=&quot;height collapsedinmodes&quot;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-                  ondraggesture=&quot;nsDragAndDrop.startDrag(event, calendarTaskButtonDNDObserver);&quot;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                  ondragstart=&quot;nsDragAndDrop.startDrag(event, calendarTaskButtonDNDObserver);&quot;</span>
<a href="#l4.36"></a><span id="l4.36">                   ondragover=&quot;nsDragAndDrop.dragOver(event, calendarTaskButtonDNDObserver);&quot;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-                  ondragdrop=&quot;nsDragAndDrop.drop(event, calendarTaskButtonDNDObserver);&quot;/&gt;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+                  ondrop=&quot;nsDragAndDrop.drop(event, calendarTaskButtonDNDObserver);&quot;/&gt;</span>
<a href="#l4.39"></a><span id="l4.39">     &lt;/vbox&gt;</span>
<a href="#l4.40"></a><span id="l4.40">   &lt;/modevbox&gt;</span>
<a href="#l4.41"></a><span id="l4.41"> </span>
<a href="#l4.42"></a><span id="l4.42">   &lt;commandset id=&quot;calendar_commands&quot;&gt;</span>
<a href="#l4.43"></a><span id="l4.43">     &lt;command id=&quot;calendar_toggle_todaypane_command&quot; oncommand=&quot;TodayPane.toggleVisibility(event)&quot;/&gt;</span>
<a href="#l4.44"></a><span id="l4.44">   &lt;/commandset&gt;</span>
<a href="#l4.45"></a><span id="l4.45"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -654,17 +654,17 @@</span>
<a href="#l5.4"></a><span id="l5.4">                    // the today-pane.</span>
<a href="#l5.5"></a><span id="l5.5">                    currentView().removeDropShadows();</span>
<a href="#l5.6"></a><span id="l5.6">                }</span>
<a href="#l5.7"></a><span id="l5.7">                this.setAttribute(&quot;dropbox&quot;, &quot;true&quot;);</span>
<a href="#l5.8"></a><span id="l5.8">            }</span>
<a href="#l5.9"></a><span id="l5.9">        }</span>
<a href="#l5.10"></a><span id="l5.10">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-      &lt;handler event=&quot;dragdrop&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+      &lt;handler event=&quot;drop&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.14"></a><span id="l5.14">          let session = cal.getDragService().getCurrentSession();</span>
<a href="#l5.15"></a><span id="l5.15">          if (!session || !session.sourceNode || !session.sourceNode.sourceObject) {</span>
<a href="#l5.16"></a><span id="l5.16">             // No source node? Not our drag.</span>
<a href="#l5.17"></a><span id="l5.17">             return;</span>
<a href="#l5.18"></a><span id="l5.18">          }</span>
<a href="#l5.19"></a><span id="l5.19">          let item = session.sourceNode.sourceObject.clone();</span>
<a href="#l5.20"></a><span id="l5.20">          this.setAttribute(&quot;dropbox&quot;, &quot;false&quot;);</span>
<a href="#l5.21"></a><span id="l5.21">          let transfer = Components.classes[&quot;@mozilla.org/widget/transferable;1&quot;].</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/resources/content/calendarCreation.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/resources/content/calendarCreation.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -56,17 +56,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">                         &lt;radio id=&quot;wcap-radio&quot; value=&quot;wcap&quot; label=&quot;&amp;calendarproperties.wcap.label;&quot;/&gt;</span>
<a href="#l6.5"></a><span id="l6.5">                     &lt;/radiogroup&gt;</span>
<a href="#l6.6"></a><span id="l6.6">                 &lt;/row&gt;</span>
<a href="#l6.7"></a><span id="l6.7">                 &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.8"></a><span id="l6.8">                     &lt;label value=&quot;&amp;calendarproperties.location.label;&quot; control=&quot;calendar-uri&quot;/&gt;</span>
<a href="#l6.9"></a><span id="l6.9">                     &lt;!--  Due to bug 128066, dropping urls here doesn't trigger</span>
<a href="#l6.10"></a><span id="l6.10">                           events. To work around, we use the dragexit handler,</span>
<a href="#l6.11"></a><span id="l6.11">                           which is triggered. Unfortunately, the more logical</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                          choice of dragdrop doesn't work here either.--&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+                          choice of drag'n'drop doesn't work here either.--&gt;</span>
<a href="#l6.14"></a><span id="l6.14">                     &lt;textbox id=&quot;calendar-uri&quot;</span>
<a href="#l6.15"></a><span id="l6.15">                              required=&quot;true&quot;</span>
<a href="#l6.16"></a><span id="l6.16">                              type=&quot;search&quot;</span>
<a href="#l6.17"></a><span id="l6.17">                              oncommand=&quot;checkRequired();&quot;</span>
<a href="#l6.18"></a><span id="l6.18">                              ondragexit=&quot;checkRequired();&quot;/&gt;</span>
<a href="#l6.19"></a><span id="l6.19">                 &lt;/row&gt;</span>
<a href="#l6.20"></a><span id="l6.20">                 &lt;row&gt;</span>
<a href="#l6.21"></a><span id="l6.21">                      &lt;label/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/content/ABSearchDialog.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/content/ABSearchDialog.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -158,17 +158,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">             &lt;treecol id=&quot;_PhoneticName&quot;</span>
<a href="#l7.5"></a><span id="l7.5">                      persist=&quot;hidden ordinal width sortDirection&quot;</span>
<a href="#l7.6"></a><span id="l7.6">                      hidden=&quot;true&quot;</span>
<a href="#l7.7"></a><span id="l7.7">                      flex=&quot;1&quot; label=&quot;&amp;_PhoneticName.label;&quot;/&gt;</span>
<a href="#l7.8"></a><span id="l7.8">             &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l7.9"></a><span id="l7.9">            --&gt;</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">           &lt;/treecols&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-          &lt;treechildren ondraggesture=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+          &lt;treechildren ondragstart=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l7.14"></a><span id="l7.14">         &lt;/tree&gt;</span>
<a href="#l7.15"></a><span id="l7.15">       &lt;/vbox&gt;</span>
<a href="#l7.16"></a><span id="l7.16">       &lt;hbox align=&quot;start&quot;&gt;</span>
<a href="#l7.17"></a><span id="l7.17">         &lt;button label=&quot;&amp;propertiesButton.label;&quot;</span>
<a href="#l7.18"></a><span id="l7.18">                 accesskey=&quot;&amp;propertiesButton.accesskey;&quot;</span>
<a href="#l7.19"></a><span id="l7.19">                 command=&quot;cmd_properties&quot;/&gt;</span>
<a href="#l7.20"></a><span id="l7.20">         &lt;button label=&quot;&amp;composeButton.label;&quot;</span>
<a href="#l7.21"></a><span id="l7.21">                 accesskey=&quot;&amp;composeButton.accesskey;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/content/SearchDialog.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/content/SearchDialog.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -173,17 +173,17 @@</span>
<a href="#l8.4"></a><span id="l8.4">                      label=&quot;&amp;totalColumn.label;&quot; tooltiptext=&quot;&amp;totalColumn2.tooltip;&quot;/&gt;</span>
<a href="#l8.5"></a><span id="l8.5">             &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.6"></a><span id="l8.6">             &lt;treecol id=&quot;locationCol&quot; persist=&quot;width&quot; flex=&quot;1&quot; hidden=&quot;true&quot; ignoreincolumnpicker=&quot;true&quot;</span>
<a href="#l8.7"></a><span id="l8.7">                      label=&quot;&amp;locationColumn.label;&quot; tooltiptext=&quot;&amp;locationColumn2.tooltip;&quot;/&gt;</span>
<a href="#l8.8"></a><span id="l8.8">             &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.9"></a><span id="l8.9">             &lt;treecol id=&quot;idCol&quot; persist=&quot;hidden ordinal width&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l8.10"></a><span id="l8.10">                      label=&quot;&amp;idColumn.label;&quot; tooltiptext=&quot;&amp;idColumn2.tooltip;&quot;/&gt;</span>
<a href="#l8.11"></a><span id="l8.11">           &lt;/treecols&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-          &lt;treechildren ondraggesture=&quot;ThreadPaneOnDragStart(event);&quot;/&gt;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+          &lt;treechildren ondragstart=&quot;ThreadPaneOnDragStart(event);&quot;/&gt;</span>
<a href="#l8.14"></a><span id="l8.14">         &lt;/tree&gt;</span>
<a href="#l8.15"></a><span id="l8.15">       &lt;/vbox&gt;</span>
<a href="#l8.16"></a><span id="l8.16">       &lt;hbox align=&quot;start&quot;&gt;</span>
<a href="#l8.17"></a><span id="l8.17">         &lt;button label=&quot;&amp;openButton.label;&quot; id=&quot;openButton&quot; command=&quot;cmd_open&quot; accesskey=&quot;&amp;openButton.accesskey;&quot;/&gt;</span>
<a href="#l8.18"></a><span id="l8.18">         &lt;button id=&quot;fileMessageButton&quot; type=&quot;menu&quot; label=&quot;&amp;moveButton.label;&quot;</span>
<a href="#l8.19"></a><span id="l8.19">                 accesskey=&quot;&amp;moveButton.accesskey;&quot;</span>
<a href="#l8.20"></a><span id="l8.20">                 observes=&quot;file_message_button&quot;&gt;</span>
<a href="#l8.21"></a><span id="l8.21">           &lt;menupopup type=&quot;folder&quot; showFileHereLabel=&quot;true&quot; mode=&quot;filing&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/base/content/messageWindow.xul</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/base/content/messageWindow.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -135,17 +135,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">   &lt;tooltip id=&quot;aHTMLTooltip&quot; page=&quot;true&quot;/&gt;</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">  &lt;!-- msg header view --&gt;</span>
<a href="#l9.8"></a><span id="l9.8">   &lt;!-- a convenience box for ease of extension overlaying --&gt;</span>
<a href="#l9.9"></a><span id="l9.9">   &lt;hbox id=&quot;messagepaneboxwrapper&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l9.10"></a><span id="l9.10">     &lt;vbox id=&quot;messagepanebox&quot; flex=&quot;3&quot;</span>
<a href="#l9.11"></a><span id="l9.11">           ondragover=&quot;nsDragAndDrop.dragOver(event, messagepaneObserver);&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-          ondragdrop=&quot;nsDragAndDrop.drop(event, messagepaneObserver);&quot;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+          ondrop=&quot;nsDragAndDrop.drop(event, messagepaneObserver);&quot;</span>
<a href="#l9.14"></a><span id="l9.14">           ondragexit=&quot;nsDragAndDrop.dragExit(event, messagepaneObserver);&quot;&gt;</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16">       &lt;hbox id=&quot;msgHeaderView&quot;/&gt;</span>
<a href="#l9.17"></a><span id="l9.17">       &lt;!-- The msgNotificationBar appears on top of the message and displays</span>
<a href="#l9.18"></a><span id="l9.18">            information like: junk, mdn, remote content and phishing warnings --&gt;</span>
<a href="#l9.19"></a><span id="l9.19">       &lt;notificationbox id=&quot;msgNotificationBar&quot; notificationside=&quot;top&quot;/&gt;</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21">       &lt;!-- message view --&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/content/messenger.xul</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/content/messenger.xul</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -331,17 +331,17 @@</span>
<a href="#l10.4"></a><span id="l10.4">                                onclick=&quot;gFolderTreeView.cycleMode(true);&quot;/&gt;</span>
<a href="#l10.5"></a><span id="l10.5">               &lt;/sidebarheader&gt;</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7">               &lt;tree id=&quot;folderTree&quot; class=&quot;plain&quot; flex=&quot;1&quot;</span>
<a href="#l10.8"></a><span id="l10.8">                     hidecolumnpicker=&quot;true&quot; persist=&quot;mode&quot; mode=&quot;all&quot;</span>
<a href="#l10.9"></a><span id="l10.9">                     keepcurrentinview=&quot;true&quot;</span>
<a href="#l10.10"></a><span id="l10.10">                     context=&quot;folderPaneContext&quot;</span>
<a href="#l10.11"></a><span id="l10.11">                     disableKeyNavigation=&quot;true&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-                    ondraggesture=&quot;gFolderTreeView._onDragStart(event);&quot;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+                    ondragstart=&quot;gFolderTreeView._onDragStart(event);&quot;</span>
<a href="#l10.14"></a><span id="l10.14">                     ondragover=&quot;gFolderTreeView._onDragOver(event);&quot;</span>
<a href="#l10.15"></a><span id="l10.15">                     ondblclick=&quot;gFolderTreeView.onDoubleClick(event);&quot;</span>
<a href="#l10.16"></a><span id="l10.16">                     onselect=&quot;FolderPaneSelectionChange();&quot;&gt;</span>
<a href="#l10.17"></a><span id="l10.17">                 &lt;treecols id=&quot;folderPaneCols&quot;&gt;</span>
<a href="#l10.18"></a><span id="l10.18">                   &lt;treecol id=&quot;folderNameCol&quot;</span>
<a href="#l10.19"></a><span id="l10.19">                            label2=&quot;&amp;folderNameColumn.label;&quot;</span>
<a href="#l10.20"></a><span id="l10.20">                            flex=&quot;5&quot;</span>
<a href="#l10.21"></a><span id="l10.21">                            crop=&quot;center&quot;</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -488,17 +488,17 @@</span>
<a href="#l10.23"></a><span id="l10.23">                                  label=&quot;&amp;totalColumn.label;&quot; tooltiptext=&quot;&amp;totalColumn2.tooltip;&quot;/&gt;</span>
<a href="#l10.24"></a><span id="l10.24">                         &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l10.25"></a><span id="l10.25">                         &lt;treecol id=&quot;locationCol&quot; persist=&quot;width&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l10.26"></a><span id="l10.26">                                  label=&quot;&amp;locationColumn.label;&quot; tooltiptext=&quot;&amp;locationColumn2.tooltip;&quot;/&gt;</span>
<a href="#l10.27"></a><span id="l10.27">                         &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l10.28"></a><span id="l10.28">                         &lt;treecol id=&quot;idCol&quot; persist=&quot;width&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l10.29"></a><span id="l10.29">                                  label=&quot;&amp;idColumn.label;&quot; tooltiptext=&quot;&amp;idColumn2.tooltip;&quot;/&gt;</span>
<a href="#l10.30"></a><span id="l10.30">                       &lt;/treecols&gt;</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-                    &lt;treechildren ondraggesture=&quot;ThreadPaneOnDragStart(event);&quot;</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+                    &lt;treechildren ondragstart=&quot;ThreadPaneOnDragStart(event);&quot;</span>
<a href="#l10.33"></a><span id="l10.33">                                   ondragover=&quot;ThreadPaneOnDragOver(event);&quot;</span>
<a href="#l10.34"></a><span id="l10.34">                                   ondrop=&quot;ThreadPaneOnDrop(event);&quot;/&gt;</span>
<a href="#l10.35"></a><span id="l10.35">                   &lt;/tree&gt;</span>
<a href="#l10.36"></a><span id="l10.36">                  &lt;/vbox&gt;</span>
<a href="#l10.37"></a><span id="l10.37">                 &lt;/hbox&gt;</span>
<a href="#l10.38"></a><span id="l10.38">                 &lt;!-- extensions may overlay in additional panels; don't assume that there are only 2! --&gt;</span>
<a href="#l10.39"></a><span id="l10.39">                 &lt;/deck&gt; &lt;!-- displayDeck --&gt;</span>
<a href="#l10.40"></a><span id="l10.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.xul</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.xul</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -569,17 +569,17 @@</span>
<a href="#l11.4"></a><span id="l11.4">             onclick=&quot;event.stopPropagation();&quot;</span>
<a href="#l11.5"></a><span id="l11.5">             oncommand=&quot;toggleAttachmentList(this.checked, true);&quot;/&gt;</span>
<a href="#l11.6"></a><span id="l11.6">     &lt;hbox align=&quot;center&quot; id=&quot;attachmentInfo&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l11.7"></a><span id="l11.7">       &lt;image id=&quot;attachmentIcon&quot;/&gt;</span>
<a href="#l11.8"></a><span id="l11.8">       &lt;label id=&quot;attachmentCount&quot;/&gt;</span>
<a href="#l11.9"></a><span id="l11.9">       &lt;label id=&quot;attachmentName&quot; crop=&quot;center&quot; flex=&quot;1&quot;</span>
<a href="#l11.10"></a><span id="l11.10">              tooltiptext=&quot;&amp;openAttachment.tooltip;&quot;</span>
<a href="#l11.11"></a><span id="l11.11">              onclick=&quot;OpenAttachmentFromBar(event);&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-             ondraggesture=&quot;nsDragAndDrop.startDrag(event,attachmentNameDNDObserver);&quot;/&gt;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+             ondragstart=&quot;nsDragAndDrop.startDrag(event,attachmentNameDNDObserver);&quot;/&gt;</span>
<a href="#l11.14"></a><span id="l11.14">       &lt;label id=&quot;attachmentSize&quot;/&gt;</span>
<a href="#l11.15"></a><span id="l11.15">     &lt;/hbox&gt;</span>
<a href="#l11.16"></a><span id="l11.16">     &lt;!-- Use a very large flex value here so that attachmentCount doesn't take</span>
<a href="#l11.17"></a><span id="l11.17">          up more space than necessary, but still crops itself if there's not</span>
<a href="#l11.18"></a><span id="l11.18">          enough space. --&gt;</span>
<a href="#l11.19"></a><span id="l11.19">     &lt;spacer flex=&quot;9999&quot;/&gt;</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">     &lt;toolbox id=&quot;attachment-view-toolbox&quot;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -654,13 +654,13 @@</span>
<a href="#l11.23"></a><span id="l11.23">                context=&quot;attachment-toolbar-context-menu&quot;</span>
<a href="#l11.24"></a><span id="l11.24">                defaulticonsize=&quot;small&quot; defaultmode=&quot;full&quot;</span>
<a href="#l11.25"></a><span id="l11.25">                defaultset=&quot;attachmentSaveAll&quot;/&gt;</span>
<a href="#l11.26"></a><span id="l11.26">     &lt;/toolbox&gt;</span>
<a href="#l11.27"></a><span id="l11.27">   &lt;/hbox&gt;</span>
<a href="#l11.28"></a><span id="l11.28">   &lt;attachmentlist orient=&quot;horizontal&quot; id=&quot;attachmentList&quot; flex=&quot;1&quot;</span>
<a href="#l11.29"></a><span id="l11.29">                   seltype=&quot;multiple&quot; context=&quot;attachmentListContext&quot;</span>
<a href="#l11.30"></a><span id="l11.30">                   itemcontext=&quot;attachmentItemContext&quot;</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-                  ondraggesture=&quot;nsDragAndDrop.startDrag(event,attachmentListDNDObserver);&quot;</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+                  ondragstart=&quot;nsDragAndDrop.startDrag(event,attachmentListDNDObserver);&quot;</span>
<a href="#l11.33"></a><span id="l11.33">                   ondragover=&quot;nsDragAndDrop.dragOver(event, attachmentListDNDObserver);&quot;/&gt;</span>
<a href="#l11.34"></a><span id="l11.34"> &lt;/vbox&gt;</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/mail/base/content/nsDragAndDrop.js</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,607 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+// -*- indent-tabs-mode: nil; js-indent-level: 2 -*-</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+////////////////////////////////////////////////////////////////////////</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+//</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+// USE OF THIS API FOR DRAG AND DROP IS DEPRECATED!</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+// Do not use this file for new code.</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+// </span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+// Toolkit dropped nsDragAndDrop.js in bug 1162050.</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+// Mapped to content/global/nsDragAndDrop.js until we can remove this usage.</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+//</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+// For documentation about what to use instead, see:</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+//   http://developer.mozilla.org/En/DragDrop/Drag_and_Drop</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+//</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+////////////////////////////////////////////////////////////////////////</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+/** </span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+ *  nsTransferable - a wrapper for nsITransferable that simplifies</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+ *                   javascript clipboard and drag&amp;drop. for use in</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+ *                   these situations you should use the nsClipboard</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+ *                   and nsDragAndDrop wrappers for more convenience</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+ **/ </span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+ </span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+var nsTransferable = {</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+  /**</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+   * nsITransferable set (TransferData aTransferData) ;</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+   *</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+   * Creates a transferable with data for a list of supported types (&quot;flavours&quot;)</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+   * </span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+   * @param TransferData aTransferData</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+   *        a javascript object in the format described above </span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+   **/ </span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+  set: function (aTransferDataSet)</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+    {</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+      var trans = this.createTransferable();</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+      for (var i = 0; i &lt; aTransferDataSet.dataList.length; ++i) </span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+        {</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+          var currData = aTransferDataSet.dataList[i];</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+          var currFlavour = currData.flavour.contentType;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+          trans.addDataFlavor(currFlavour);</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+          var supports = null; // nsISupports data</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+          var length = 0;</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+          if (currData.flavour.dataIIDKey == &quot;nsISupportsString&quot;)</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+            {</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+              supports = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+                                   .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+              supports.data = currData.supports;</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+              length = supports.data.length;</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+            }</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+          else </span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+            {</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+              // non-string data.</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+              supports = currData.supports;</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+              length = 0; // kFlavorHasDataProvider</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineplus">+            }</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+          trans.setTransferData(currFlavour, supports, length * 2);</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+        }</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+      return trans;</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+    },</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+  </span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+  /**</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+   * TransferData/TransferDataSet get (FlavourSet aFlavourSet, </span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+   *                                   Function aRetrievalFunc, Boolean aAnyFlag) ;</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+   *</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineplus">+   * Retrieves data from the transferable provided in aRetrievalFunc, formatted</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+   * for more convenient access.</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+   *</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+   * @param FlavourSet aFlavourSet</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineplus">+   *        a FlavourSet object that contains a list of supported flavours.</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineplus">+   * @param Function aRetrievalFunc</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineplus">+   *        a reference to a function that returns a nsISupportsArray of nsITransferables</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineplus">+   *        for each item from the specified source (clipboard/drag&amp;drop etc)</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineplus">+   * @param Boolean aAnyFlag</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineplus">+   *        a flag specifying whether or not a specific flavour is requested. If false,</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineplus">+   *        data of the type of the first flavour in the flavourlist parameter is returned,</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineplus">+   *        otherwise the best flavour supported will be returned.</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineplus">+   **/</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineplus">+  get: function (aFlavourSet, aRetrievalFunc, aAnyFlag)</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+    {</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+      if (!aRetrievalFunc) </span>
<a href="#l12.90"></a><span id="l12.90" class="difflineplus">+        throw &quot;No data retrieval handler provided!&quot;;</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineplus">+      </span>
<a href="#l12.92"></a><span id="l12.92" class="difflineplus">+      var supportsArray = aRetrievalFunc(aFlavourSet);</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineplus">+      var dataArray = [];</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+      var count = supportsArray.Count();</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineplus">+      </span>
<a href="#l12.96"></a><span id="l12.96" class="difflineplus">+      // Iterate over the number of items returned from aRetrievalFunc. For</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineplus">+      // clipboard operations, this is 1, for drag and drop (where multiple</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineplus">+      // items may have been dragged) this could be &gt;1.</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineplus">+      for (var i = 0; i &lt; count; i++)</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineplus">+        {</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineplus">+          var trans = supportsArray.GetElementAt(i);</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineplus">+          if (!trans) continue;</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineplus">+          trans = trans.QueryInterface(Components.interfaces.nsITransferable);</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+            </span>
<a href="#l12.105"></a><span id="l12.105" class="difflineplus">+          var data = { };</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineplus">+          var length = { };</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineplus">+          </span>
<a href="#l12.108"></a><span id="l12.108" class="difflineplus">+          var currData = null;</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineplus">+          if (aAnyFlag)</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineplus">+            { </span>
<a href="#l12.111"></a><span id="l12.111" class="difflineplus">+              var flavour = { };</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineplus">+              trans.getAnyTransferData(flavour, data, length);</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineplus">+              if (data &amp;&amp; flavour)</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineplus">+                {</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineplus">+                  var selectedFlavour = aFlavourSet.flavourTable[flavour.value];</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineplus">+                  if (selectedFlavour) </span>
<a href="#l12.117"></a><span id="l12.117" class="difflineplus">+                    dataArray[i] = FlavourToXfer(data.value, length.value, selectedFlavour);</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineplus">+                }</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineplus">+            }</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineplus">+          else</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+            {</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineplus">+              var firstFlavour = aFlavourSet.flavours[0];</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+              trans.getTransferData(firstFlavour, data, length);</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineplus">+              if (data &amp;&amp; firstFlavour)</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineplus">+                dataArray[i] = FlavourToXfer(data.value, length.value, firstFlavour);</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineplus">+            }</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineplus">+        }</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineplus">+      return new TransferDataSet(dataArray);</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineplus">+    },</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineplus">+</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineplus">+  /** </span>
<a href="#l12.132"></a><span id="l12.132" class="difflineplus">+   * nsITransferable createTransferable (void) ;</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineplus">+   *</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineplus">+   * Creates and returns a transferable object.</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineplus">+   **/    </span>
<a href="#l12.136"></a><span id="l12.136" class="difflineplus">+  createTransferable: function ()</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineplus">+    {</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineplus">+      const kXferableContractID = &quot;@mozilla.org/widget/transferable;1&quot;;</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineplus">+      const kXferableIID = Components.interfaces.nsITransferable;</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineplus">+      var trans = Components.classes[kXferableContractID].createInstance(kXferableIID);</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineplus">+      trans.init(null);</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineplus">+      return trans;</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineplus">+    }</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineplus">+};  </span>
<a href="#l12.145"></a><span id="l12.145" class="difflineplus">+</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineplus">+/** </span>
<a href="#l12.147"></a><span id="l12.147" class="difflineplus">+ * A FlavourSet is a simple type that represents a collection of Flavour objects.</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineplus">+ * FlavourSet is constructed from an array of Flavours, and stores this list as</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineplus">+ * an array and a hashtable. The rationale for the dual storage is as follows:</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineplus">+ * </span>
<a href="#l12.151"></a><span id="l12.151" class="difflineplus">+ * Array: Ordering is important when adding data flavours to a transferable. </span>
<a href="#l12.152"></a><span id="l12.152" class="difflineplus">+ *        Flavours added first are deemed to be 'preferred' by the client. </span>
<a href="#l12.153"></a><span id="l12.153" class="difflineplus">+ * Hash:  Convenient lookup of flavour data using the content type (MIME type)</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineplus">+ *        of data as a key. </span>
<a href="#l12.155"></a><span id="l12.155" class="difflineplus">+ */</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineplus">+function FlavourSet(aFlavourList)</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineplus">+{</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineplus">+  this.flavours = aFlavourList || [];</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineplus">+  this.flavourTable = { };</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineplus">+</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineplus">+  this._XferID = &quot;FlavourSet&quot;;</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineplus">+  </span>
<a href="#l12.163"></a><span id="l12.163" class="difflineplus">+  for (var i = 0; i &lt; this.flavours.length; ++i)</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineplus">+    this.flavourTable[this.flavours[i].contentType] = this.flavours[i];</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineplus">+}</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineplus">+</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineplus">+FlavourSet.prototype = {</span>
<a href="#l12.168"></a><span id="l12.168" class="difflineplus">+  appendFlavour: function (aFlavour, aFlavourIIDKey)</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineplus">+  {</span>
<a href="#l12.170"></a><span id="l12.170" class="difflineplus">+    var flavour = new Flavour (aFlavour, aFlavourIIDKey);</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineplus">+    this.flavours.push(flavour);</span>
<a href="#l12.172"></a><span id="l12.172" class="difflineplus">+    this.flavourTable[flavour.contentType] = flavour;</span>
<a href="#l12.173"></a><span id="l12.173" class="difflineplus">+  }</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineplus">+};</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineplus">+</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineplus">+/** </span>
<a href="#l12.177"></a><span id="l12.177" class="difflineplus">+ * A Flavour is a simple type that represents a data type that can be handled. </span>
<a href="#l12.178"></a><span id="l12.178" class="difflineplus">+ * It takes a content type (MIME type) which is used when storing data on the</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineplus">+ * system clipboard/drag and drop, and an IIDKey (string interface name</span>
<a href="#l12.180"></a><span id="l12.180" class="difflineplus">+ * which is used to QI data to an appropriate form. The default interface is</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineplus">+ * assumed to be wide-string.</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineplus">+ */ </span>
<a href="#l12.183"></a><span id="l12.183" class="difflineplus">+function Flavour(aContentType, aDataIIDKey)</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineplus">+{</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineplus">+  this.contentType = aContentType;</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineplus">+  this.dataIIDKey = aDataIIDKey || &quot;nsISupportsString&quot;;</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineplus">+</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineplus">+  this._XferID = &quot;Flavour&quot;;</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineplus">+}</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineplus">+</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineplus">+function TransferDataBase() {}</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineplus">+TransferDataBase.prototype = {</span>
<a href="#l12.193"></a><span id="l12.193" class="difflineplus">+  push: function (aItems)</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineplus">+  {</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineplus">+    this.dataList.push(aItems);</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineplus">+  },</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineplus">+</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineplus">+  get first ()</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineplus">+  {</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineplus">+    return &quot;dataList&quot; in this &amp;&amp; this.dataList.length ? this.dataList[0] : null;</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineplus">+  }</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineplus">+};</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineplus">+</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineplus">+/** </span>
<a href="#l12.205"></a><span id="l12.205" class="difflineplus">+ * TransferDataSet is a list (array) of TransferData objects, which represents</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineplus">+ * data dragged from one or more elements. </span>
<a href="#l12.207"></a><span id="l12.207" class="difflineplus">+ */</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineplus">+function TransferDataSet(aTransferDataList)</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineplus">+{</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineplus">+  this.dataList = aTransferDataList || [];</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineplus">+</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineplus">+  this._XferID = &quot;TransferDataSet&quot;;</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineplus">+}</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineplus">+TransferDataSet.prototype = TransferDataBase.prototype;</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineplus">+</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineplus">+/** </span>
<a href="#l12.217"></a><span id="l12.217" class="difflineplus">+ * TransferData is a list (array) of FlavourData for all the applicable content</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineplus">+ * types associated with a drag from a single item. </span>
<a href="#l12.219"></a><span id="l12.219" class="difflineplus">+ */</span>
<a href="#l12.220"></a><span id="l12.220" class="difflineplus">+function TransferData(aFlavourDataList)</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineplus">+{</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineplus">+  this.dataList = aFlavourDataList || [];</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineplus">+</span>
<a href="#l12.224"></a><span id="l12.224" class="difflineplus">+  this._XferID = &quot;TransferData&quot;;</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineplus">+}</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineplus">+TransferData.prototype = {</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineplus">+  __proto__: TransferDataBase.prototype,</span>
<a href="#l12.228"></a><span id="l12.228" class="difflineplus">+  </span>
<a href="#l12.229"></a><span id="l12.229" class="difflineplus">+  addDataForFlavour: function (aFlavourString, aData, aLength, aDataIIDKey)</span>
<a href="#l12.230"></a><span id="l12.230" class="difflineplus">+  {</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineplus">+    this.dataList.push(new FlavourData(aData, aLength, </span>
<a href="#l12.232"></a><span id="l12.232" class="difflineplus">+                       new Flavour(aFlavourString, aDataIIDKey)));</span>
<a href="#l12.233"></a><span id="l12.233" class="difflineplus">+  }</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineplus">+};</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineplus">+</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineplus">+/** </span>
<a href="#l12.237"></a><span id="l12.237" class="difflineplus">+ * FlavourData is a type that represents data retrieved from the system </span>
<a href="#l12.238"></a><span id="l12.238" class="difflineplus">+ * clipboard or drag and drop. It is constructed internally by the Transferable</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineplus">+ * using the raw (nsISupports) data from the clipboard, the length of the data,</span>
<a href="#l12.240"></a><span id="l12.240" class="difflineplus">+ * and an object of type Flavour representing the type. Clients implementing</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineplus">+ * IDragDropObserver receive an object of this type in their implementation of</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineplus">+ * onDrop. They access the 'data' property to retrieve data, which is either data </span>
<a href="#l12.243"></a><span id="l12.243" class="difflineplus">+ * QI'ed to a usable form, or unicode string. </span>
<a href="#l12.244"></a><span id="l12.244" class="difflineplus">+ */</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineplus">+function FlavourData(aData, aLength, aFlavour) </span>
<a href="#l12.246"></a><span id="l12.246" class="difflineplus">+{</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineplus">+  this.supports = aData;</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineplus">+  this.contentLength = aLength;</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineplus">+  this.flavour = aFlavour || null;</span>
<a href="#l12.250"></a><span id="l12.250" class="difflineplus">+  </span>
<a href="#l12.251"></a><span id="l12.251" class="difflineplus">+  this._XferID = &quot;FlavourData&quot;;</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineplus">+}</span>
<a href="#l12.253"></a><span id="l12.253" class="difflineplus">+</span>
<a href="#l12.254"></a><span id="l12.254" class="difflineplus">+FlavourData.prototype = {</span>
<a href="#l12.255"></a><span id="l12.255" class="difflineplus">+  get data ()</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineplus">+  {</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineplus">+    if (this.flavour &amp;&amp;</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineplus">+        this.flavour.dataIIDKey != &quot;nsISupportsString&quot;)</span>
<a href="#l12.259"></a><span id="l12.259" class="difflineplus">+      return this.supports.QueryInterface(Components.interfaces[this.flavour.dataIIDKey]); </span>
<a href="#l12.260"></a><span id="l12.260" class="difflineplus">+</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineplus">+    var supports = this.supports;</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineplus">+    if (supports instanceof Components.interfaces.nsISupportsString)</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineplus">+      return supports.data.substring(0, this.contentLength/2);</span>
<a href="#l12.264"></a><span id="l12.264" class="difflineplus">+     </span>
<a href="#l12.265"></a><span id="l12.265" class="difflineplus">+    return supports;</span>
<a href="#l12.266"></a><span id="l12.266" class="difflineplus">+  }</span>
<a href="#l12.267"></a><span id="l12.267" class="difflineplus">+}</span>
<a href="#l12.268"></a><span id="l12.268" class="difflineplus">+</span>
<a href="#l12.269"></a><span id="l12.269" class="difflineplus">+/** </span>
<a href="#l12.270"></a><span id="l12.270" class="difflineplus">+ * Create a TransferData object with a single FlavourData entry. Used when </span>
<a href="#l12.271"></a><span id="l12.271" class="difflineplus">+ * unwrapping data of a specific flavour from the drag service. </span>
<a href="#l12.272"></a><span id="l12.272" class="difflineplus">+ */</span>
<a href="#l12.273"></a><span id="l12.273" class="difflineplus">+function FlavourToXfer(aData, aLength, aFlavour) </span>
<a href="#l12.274"></a><span id="l12.274" class="difflineplus">+{</span>
<a href="#l12.275"></a><span id="l12.275" class="difflineplus">+  return new TransferData([new FlavourData(aData, aLength, aFlavour)]);</span>
<a href="#l12.276"></a><span id="l12.276" class="difflineplus">+}</span>
<a href="#l12.277"></a><span id="l12.277" class="difflineplus">+</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineplus">+var transferUtils = {</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineplus">+</span>
<a href="#l12.280"></a><span id="l12.280" class="difflineplus">+  retrieveURLFromData: function (aData, flavour)</span>
<a href="#l12.281"></a><span id="l12.281" class="difflineplus">+  {</span>
<a href="#l12.282"></a><span id="l12.282" class="difflineplus">+    switch (flavour) {</span>
<a href="#l12.283"></a><span id="l12.283" class="difflineplus">+      case &quot;text/unicode&quot;:</span>
<a href="#l12.284"></a><span id="l12.284" class="difflineplus">+      case &quot;text/plain&quot;:</span>
<a href="#l12.285"></a><span id="l12.285" class="difflineplus">+      case &quot;text/x-moz-text-internal&quot;:</span>
<a href="#l12.286"></a><span id="l12.286" class="difflineplus">+        return aData.replace(/^\s+|\s+$/g, &quot;&quot;);</span>
<a href="#l12.287"></a><span id="l12.287" class="difflineplus">+      case &quot;text/x-moz-url&quot;:</span>
<a href="#l12.288"></a><span id="l12.288" class="difflineplus">+        return ((aData instanceof Components.interfaces.nsISupportsString) ? aData.toString() : aData).split(&quot;\n&quot;)[0];</span>
<a href="#l12.289"></a><span id="l12.289" class="difflineplus">+      case &quot;application/x-moz-file&quot;:</span>
<a href="#l12.290"></a><span id="l12.290" class="difflineplus">+        var ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l12.291"></a><span id="l12.291" class="difflineplus">+                                  .getService(Components.interfaces.nsIIOService);</span>
<a href="#l12.292"></a><span id="l12.292" class="difflineplus">+        var fileHandler = ioService.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l12.293"></a><span id="l12.293" class="difflineplus">+                                   .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l12.294"></a><span id="l12.294" class="difflineplus">+        return fileHandler.getURLSpecFromFile(aData);</span>
<a href="#l12.295"></a><span id="l12.295" class="difflineplus">+    }</span>
<a href="#l12.296"></a><span id="l12.296" class="difflineplus">+    return null;                                                   </span>
<a href="#l12.297"></a><span id="l12.297" class="difflineplus">+  }</span>
<a href="#l12.298"></a><span id="l12.298" class="difflineplus">+</span>
<a href="#l12.299"></a><span id="l12.299" class="difflineplus">+}</span>
<a href="#l12.300"></a><span id="l12.300" class="difflineplus">+</span>
<a href="#l12.301"></a><span id="l12.301" class="difflineplus">+/**</span>
<a href="#l12.302"></a><span id="l12.302" class="difflineplus">+ * nsDragAndDrop - a convenience wrapper for nsTransferable, nsITransferable</span>
<a href="#l12.303"></a><span id="l12.303" class="difflineplus">+ *                 and nsIDragService/nsIDragSession. </span>
<a href="#l12.304"></a><span id="l12.304" class="difflineplus">+ *</span>
<a href="#l12.305"></a><span id="l12.305" class="difflineplus">+ * Use: map the handler functions to the 'ondraggesture', 'ondragover' and</span>
<a href="#l12.306"></a><span id="l12.306" class="difflineplus">+ *   'ondragdrop' event handlers on your XML element, e.g.                   </span>
<a href="#l12.307"></a><span id="l12.307" class="difflineplus">+ *   &lt;xmlelement ondraggesture=&quot;nsDragAndDrop.startDrag(event, observer);&quot;   </span>
<a href="#l12.308"></a><span id="l12.308" class="difflineplus">+ *               ondragover=&quot;nsDragAndDrop.dragOver(event, observer);&quot;      </span>
<a href="#l12.309"></a><span id="l12.309" class="difflineplus">+ *               ondragdrop=&quot;nsDragAndDrop.drop(event, observer);&quot;/&gt;         </span>
<a href="#l12.310"></a><span id="l12.310" class="difflineplus">+ *                                                                           </span>
<a href="#l12.311"></a><span id="l12.311" class="difflineplus">+ *   You need to create an observer js object with the following member      </span>
<a href="#l12.312"></a><span id="l12.312" class="difflineplus">+ *   functions:                                                              </span>
<a href="#l12.313"></a><span id="l12.313" class="difflineplus">+ *     Object onDragStart (event)        // called when drag initiated,      </span>
<a href="#l12.314"></a><span id="l12.314" class="difflineplus">+ *                                       // returns flavour list with data   </span>
<a href="#l12.315"></a><span id="l12.315" class="difflineplus">+ *                                       // to stuff into transferable      </span>
<a href="#l12.316"></a><span id="l12.316" class="difflineplus">+ *     void onDragOver (Object flavour)  // called when element is dragged   </span>
<a href="#l12.317"></a><span id="l12.317" class="difflineplus">+ *                                       // over, so that it can perform     </span>
<a href="#l12.318"></a><span id="l12.318" class="difflineplus">+ *                                       // any drag-over feedback for provided</span>
<a href="#l12.319"></a><span id="l12.319" class="difflineplus">+ *                                       // flavour                          </span>
<a href="#l12.320"></a><span id="l12.320" class="difflineplus">+ *     void onDrop (Object data)         // formatted data object dropped.   </span>
<a href="#l12.321"></a><span id="l12.321" class="difflineplus">+ *     Object getSupportedFlavours ()    // returns a flavour list so that   </span>
<a href="#l12.322"></a><span id="l12.322" class="difflineplus">+ *                                       // nsTransferable can determine</span>
<a href="#l12.323"></a><span id="l12.323" class="difflineplus">+ *                                       // whether or not to accept drop. </span>
<a href="#l12.324"></a><span id="l12.324" class="difflineplus">+ **/   </span>
<a href="#l12.325"></a><span id="l12.325" class="difflineplus">+</span>
<a href="#l12.326"></a><span id="l12.326" class="difflineplus">+var nsDragAndDrop = {</span>
<a href="#l12.327"></a><span id="l12.327" class="difflineplus">+  </span>
<a href="#l12.328"></a><span id="l12.328" class="difflineplus">+  _mDS: null,</span>
<a href="#l12.329"></a><span id="l12.329" class="difflineplus">+  get mDragService()</span>
<a href="#l12.330"></a><span id="l12.330" class="difflineplus">+    {</span>
<a href="#l12.331"></a><span id="l12.331" class="difflineplus">+      if (!this._mDS) </span>
<a href="#l12.332"></a><span id="l12.332" class="difflineplus">+        {</span>
<a href="#l12.333"></a><span id="l12.333" class="difflineplus">+          const kDSContractID = &quot;@mozilla.org/widget/dragservice;1&quot;;</span>
<a href="#l12.334"></a><span id="l12.334" class="difflineplus">+          const kDSIID = Components.interfaces.nsIDragService;</span>
<a href="#l12.335"></a><span id="l12.335" class="difflineplus">+          this._mDS = Components.classes[kDSContractID].getService(kDSIID);</span>
<a href="#l12.336"></a><span id="l12.336" class="difflineplus">+        }</span>
<a href="#l12.337"></a><span id="l12.337" class="difflineplus">+      return this._mDS;</span>
<a href="#l12.338"></a><span id="l12.338" class="difflineplus">+    },</span>
<a href="#l12.339"></a><span id="l12.339" class="difflineplus">+</span>
<a href="#l12.340"></a><span id="l12.340" class="difflineplus">+  /**</span>
<a href="#l12.341"></a><span id="l12.341" class="difflineplus">+   * void startDrag (DOMEvent aEvent, Object aDragDropObserver) ;</span>
<a href="#l12.342"></a><span id="l12.342" class="difflineplus">+   *</span>
<a href="#l12.343"></a><span id="l12.343" class="difflineplus">+   * called when a drag on an element is started.</span>
<a href="#l12.344"></a><span id="l12.344" class="difflineplus">+   *</span>
<a href="#l12.345"></a><span id="l12.345" class="difflineplus">+   * @param DOMEvent aEvent</span>
<a href="#l12.346"></a><span id="l12.346" class="difflineplus">+   *        the DOM event fired by the drag init</span>
<a href="#l12.347"></a><span id="l12.347" class="difflineplus">+   * @param Object aDragDropObserver</span>
<a href="#l12.348"></a><span id="l12.348" class="difflineplus">+   *        javascript object of format described above that specifies</span>
<a href="#l12.349"></a><span id="l12.349" class="difflineplus">+   *        the way in which the element responds to drag events.</span>
<a href="#l12.350"></a><span id="l12.350" class="difflineplus">+   **/  </span>
<a href="#l12.351"></a><span id="l12.351" class="difflineplus">+  startDrag: function (aEvent, aDragDropObserver)</span>
<a href="#l12.352"></a><span id="l12.352" class="difflineplus">+    {</span>
<a href="#l12.353"></a><span id="l12.353" class="difflineplus">+      if (!(&quot;onDragStart&quot; in aDragDropObserver))</span>
<a href="#l12.354"></a><span id="l12.354" class="difflineplus">+        return;</span>
<a href="#l12.355"></a><span id="l12.355" class="difflineplus">+</span>
<a href="#l12.356"></a><span id="l12.356" class="difflineplus">+      const kDSIID = Components.interfaces.nsIDragService;</span>
<a href="#l12.357"></a><span id="l12.357" class="difflineplus">+      var dragAction = { action: kDSIID.DRAGDROP_ACTION_COPY + kDSIID.DRAGDROP_ACTION_MOVE + kDSIID.DRAGDROP_ACTION_LINK };</span>
<a href="#l12.358"></a><span id="l12.358" class="difflineplus">+</span>
<a href="#l12.359"></a><span id="l12.359" class="difflineplus">+      var transferData = { data: null };</span>
<a href="#l12.360"></a><span id="l12.360" class="difflineplus">+      try </span>
<a href="#l12.361"></a><span id="l12.361" class="difflineplus">+        {</span>
<a href="#l12.362"></a><span id="l12.362" class="difflineplus">+          aDragDropObserver.onDragStart(aEvent, transferData, dragAction);</span>
<a href="#l12.363"></a><span id="l12.363" class="difflineplus">+        }</span>
<a href="#l12.364"></a><span id="l12.364" class="difflineplus">+      catch (e) </span>
<a href="#l12.365"></a><span id="l12.365" class="difflineplus">+        {</span>
<a href="#l12.366"></a><span id="l12.366" class="difflineplus">+          return;  // not a draggable item, bail!</span>
<a href="#l12.367"></a><span id="l12.367" class="difflineplus">+        }</span>
<a href="#l12.368"></a><span id="l12.368" class="difflineplus">+</span>
<a href="#l12.369"></a><span id="l12.369" class="difflineplus">+      if (!transferData.data) return;</span>
<a href="#l12.370"></a><span id="l12.370" class="difflineplus">+      transferData = transferData.data;</span>
<a href="#l12.371"></a><span id="l12.371" class="difflineplus">+</span>
<a href="#l12.372"></a><span id="l12.372" class="difflineplus">+      var dt = aEvent.dataTransfer;</span>
<a href="#l12.373"></a><span id="l12.373" class="difflineplus">+      var count = 0;</span>
<a href="#l12.374"></a><span id="l12.374" class="difflineplus">+      do {</span>
<a href="#l12.375"></a><span id="l12.375" class="difflineplus">+        var tds = transferData._XferID == &quot;TransferData&quot; </span>
<a href="#l12.376"></a><span id="l12.376" class="difflineplus">+                                         ? transferData </span>
<a href="#l12.377"></a><span id="l12.377" class="difflineplus">+                                         : transferData.dataList[count]</span>
<a href="#l12.378"></a><span id="l12.378" class="difflineplus">+        for (var i = 0; i &lt; tds.dataList.length; ++i) </span>
<a href="#l12.379"></a><span id="l12.379" class="difflineplus">+        {</span>
<a href="#l12.380"></a><span id="l12.380" class="difflineplus">+          var currData = tds.dataList[i];</span>
<a href="#l12.381"></a><span id="l12.381" class="difflineplus">+          var currFlavour = currData.flavour.contentType;</span>
<a href="#l12.382"></a><span id="l12.382" class="difflineplus">+          var value = currData.supports;</span>
<a href="#l12.383"></a><span id="l12.383" class="difflineplus">+          if (value instanceof Components.interfaces.nsISupportsString)</span>
<a href="#l12.384"></a><span id="l12.384" class="difflineplus">+            value = value.toString();</span>
<a href="#l12.385"></a><span id="l12.385" class="difflineplus">+          dt.mozSetDataAt(currFlavour, value, count);</span>
<a href="#l12.386"></a><span id="l12.386" class="difflineplus">+        }</span>
<a href="#l12.387"></a><span id="l12.387" class="difflineplus">+</span>
<a href="#l12.388"></a><span id="l12.388" class="difflineplus">+        count++;</span>
<a href="#l12.389"></a><span id="l12.389" class="difflineplus">+      }</span>
<a href="#l12.390"></a><span id="l12.390" class="difflineplus">+      while (transferData._XferID == &quot;TransferDataSet&quot; &amp;&amp; </span>
<a href="#l12.391"></a><span id="l12.391" class="difflineplus">+             count &lt; transferData.dataList.length);</span>
<a href="#l12.392"></a><span id="l12.392" class="difflineplus">+</span>
<a href="#l12.393"></a><span id="l12.393" class="difflineplus">+      dt.effectAllowed = &quot;all&quot;;</span>
<a href="#l12.394"></a><span id="l12.394" class="difflineplus">+      // a drag targeted at a tree should instead use the treechildren so that</span>
<a href="#l12.395"></a><span id="l12.395" class="difflineplus">+      // the current selection is used as the drag feedback</span>
<a href="#l12.396"></a><span id="l12.396" class="difflineplus">+      dt.addElement(aEvent.originalTarget.localName == &quot;treechildren&quot; ?</span>
<a href="#l12.397"></a><span id="l12.397" class="difflineplus">+                    aEvent.originalTarget : aEvent.target);</span>
<a href="#l12.398"></a><span id="l12.398" class="difflineplus">+      aEvent.stopPropagation();</span>
<a href="#l12.399"></a><span id="l12.399" class="difflineplus">+    },</span>
<a href="#l12.400"></a><span id="l12.400" class="difflineplus">+</span>
<a href="#l12.401"></a><span id="l12.401" class="difflineplus">+  /** </span>
<a href="#l12.402"></a><span id="l12.402" class="difflineplus">+   * void dragOver (DOMEvent aEvent, Object aDragDropObserver) ;</span>
<a href="#l12.403"></a><span id="l12.403" class="difflineplus">+   *</span>
<a href="#l12.404"></a><span id="l12.404" class="difflineplus">+   * called when a drag passes over this element</span>
<a href="#l12.405"></a><span id="l12.405" class="difflineplus">+   *</span>
<a href="#l12.406"></a><span id="l12.406" class="difflineplus">+   * @param DOMEvent aEvent</span>
<a href="#l12.407"></a><span id="l12.407" class="difflineplus">+   *        the DOM event fired by passing over the element</span>
<a href="#l12.408"></a><span id="l12.408" class="difflineplus">+   * @param Object aDragDropObserver</span>
<a href="#l12.409"></a><span id="l12.409" class="difflineplus">+   *        javascript object of format described above that specifies</span>
<a href="#l12.410"></a><span id="l12.410" class="difflineplus">+   *        the way in which the element responds to drag events.</span>
<a href="#l12.411"></a><span id="l12.411" class="difflineplus">+   **/</span>
<a href="#l12.412"></a><span id="l12.412" class="difflineplus">+  dragOver: function (aEvent, aDragDropObserver)</span>
<a href="#l12.413"></a><span id="l12.413" class="difflineplus">+    { </span>
<a href="#l12.414"></a><span id="l12.414" class="difflineplus">+      if (!(&quot;onDragOver&quot; in aDragDropObserver)) </span>
<a href="#l12.415"></a><span id="l12.415" class="difflineplus">+        return;</span>
<a href="#l12.416"></a><span id="l12.416" class="difflineplus">+      if (!this.checkCanDrop(aEvent, aDragDropObserver))</span>
<a href="#l12.417"></a><span id="l12.417" class="difflineplus">+        return;</span>
<a href="#l12.418"></a><span id="l12.418" class="difflineplus">+      var flavourSet = aDragDropObserver.getSupportedFlavours();</span>
<a href="#l12.419"></a><span id="l12.419" class="difflineplus">+      for (var flavour in flavourSet.flavourTable)</span>
<a href="#l12.420"></a><span id="l12.420" class="difflineplus">+        {</span>
<a href="#l12.421"></a><span id="l12.421" class="difflineplus">+          if (this.mDragSession.isDataFlavorSupported(flavour))</span>
<a href="#l12.422"></a><span id="l12.422" class="difflineplus">+            {</span>
<a href="#l12.423"></a><span id="l12.423" class="difflineplus">+              aDragDropObserver.onDragOver(aEvent, </span>
<a href="#l12.424"></a><span id="l12.424" class="difflineplus">+                                           flavourSet.flavourTable[flavour], </span>
<a href="#l12.425"></a><span id="l12.425" class="difflineplus">+                                           this.mDragSession);</span>
<a href="#l12.426"></a><span id="l12.426" class="difflineplus">+              aEvent.stopPropagation();</span>
<a href="#l12.427"></a><span id="l12.427" class="difflineplus">+              aEvent.preventDefault();</span>
<a href="#l12.428"></a><span id="l12.428" class="difflineplus">+              break;</span>
<a href="#l12.429"></a><span id="l12.429" class="difflineplus">+            }</span>
<a href="#l12.430"></a><span id="l12.430" class="difflineplus">+        }</span>
<a href="#l12.431"></a><span id="l12.431" class="difflineplus">+    },</span>
<a href="#l12.432"></a><span id="l12.432" class="difflineplus">+</span>
<a href="#l12.433"></a><span id="l12.433" class="difflineplus">+  mDragSession: null,</span>
<a href="#l12.434"></a><span id="l12.434" class="difflineplus">+</span>
<a href="#l12.435"></a><span id="l12.435" class="difflineplus">+  /** </span>
<a href="#l12.436"></a><span id="l12.436" class="difflineplus">+   * void drop (DOMEvent aEvent, Object aDragDropObserver) ;</span>
<a href="#l12.437"></a><span id="l12.437" class="difflineplus">+   *</span>
<a href="#l12.438"></a><span id="l12.438" class="difflineplus">+   * called when the user drops on the element</span>
<a href="#l12.439"></a><span id="l12.439" class="difflineplus">+   *</span>
<a href="#l12.440"></a><span id="l12.440" class="difflineplus">+   * @param DOMEvent aEvent</span>
<a href="#l12.441"></a><span id="l12.441" class="difflineplus">+   *        the DOM event fired by the drop</span>
<a href="#l12.442"></a><span id="l12.442" class="difflineplus">+   * @param Object aDragDropObserver</span>
<a href="#l12.443"></a><span id="l12.443" class="difflineplus">+   *        javascript object of format described above that specifies</span>
<a href="#l12.444"></a><span id="l12.444" class="difflineplus">+   *        the way in which the element responds to drag events.</span>
<a href="#l12.445"></a><span id="l12.445" class="difflineplus">+   **/</span>
<a href="#l12.446"></a><span id="l12.446" class="difflineplus">+  drop: function (aEvent, aDragDropObserver)</span>
<a href="#l12.447"></a><span id="l12.447" class="difflineplus">+    {</span>
<a href="#l12.448"></a><span id="l12.448" class="difflineplus">+      if (!(&quot;onDrop&quot; in aDragDropObserver))</span>
<a href="#l12.449"></a><span id="l12.449" class="difflineplus">+        return;</span>
<a href="#l12.450"></a><span id="l12.450" class="difflineplus">+      if (!this.checkCanDrop(aEvent, aDragDropObserver))</span>
<a href="#l12.451"></a><span id="l12.451" class="difflineplus">+        return;  </span>
<a href="#l12.452"></a><span id="l12.452" class="difflineplus">+</span>
<a href="#l12.453"></a><span id="l12.453" class="difflineplus">+      var flavourSet = aDragDropObserver.getSupportedFlavours();</span>
<a href="#l12.454"></a><span id="l12.454" class="difflineplus">+</span>
<a href="#l12.455"></a><span id="l12.455" class="difflineplus">+      var dt = aEvent.dataTransfer;</span>
<a href="#l12.456"></a><span id="l12.456" class="difflineplus">+      var dataArray = [];</span>
<a href="#l12.457"></a><span id="l12.457" class="difflineplus">+      var count = dt.mozItemCount;</span>
<a href="#l12.458"></a><span id="l12.458" class="difflineplus">+      for (var i = 0; i &lt; count; ++i) {</span>
<a href="#l12.459"></a><span id="l12.459" class="difflineplus">+        var types = dt.mozTypesAt(i);</span>
<a href="#l12.460"></a><span id="l12.460" class="difflineplus">+        for (var j = 0; j &lt; flavourSet.flavours.length; j++) {</span>
<a href="#l12.461"></a><span id="l12.461" class="difflineplus">+          var type = flavourSet.flavours[j].contentType;</span>
<a href="#l12.462"></a><span id="l12.462" class="difflineplus">+          // dataTransfer uses text/plain but older code used text/unicode, so</span>
<a href="#l12.463"></a><span id="l12.463" class="difflineplus">+          // switch this for compatibility</span>
<a href="#l12.464"></a><span id="l12.464" class="difflineplus">+          var modtype = (type == &quot;text/unicode&quot;) ? &quot;text/plain&quot; : type;</span>
<a href="#l12.465"></a><span id="l12.465" class="difflineplus">+          if (Array.indexOf(types, modtype) &gt;= 0) {</span>
<a href="#l12.466"></a><span id="l12.466" class="difflineplus">+            var data = dt.mozGetDataAt(modtype, i);</span>
<a href="#l12.467"></a><span id="l12.467" class="difflineplus">+            if (data) {</span>
<a href="#l12.468"></a><span id="l12.468" class="difflineplus">+              // Non-strings need some non-zero value used for their data length.</span>
<a href="#l12.469"></a><span id="l12.469" class="difflineplus">+              const kNonStringDataLength = 4;</span>
<a href="#l12.470"></a><span id="l12.470" class="difflineplus">+</span>
<a href="#l12.471"></a><span id="l12.471" class="difflineplus">+              var length = (typeof data == &quot;string&quot;) ? data.length : kNonStringDataLength;</span>
<a href="#l12.472"></a><span id="l12.472" class="difflineplus">+              dataArray[i] = FlavourToXfer(data, length, flavourSet.flavourTable[type]);</span>
<a href="#l12.473"></a><span id="l12.473" class="difflineplus">+              break;</span>
<a href="#l12.474"></a><span id="l12.474" class="difflineplus">+            }</span>
<a href="#l12.475"></a><span id="l12.475" class="difflineplus">+          }</span>
<a href="#l12.476"></a><span id="l12.476" class="difflineplus">+        }</span>
<a href="#l12.477"></a><span id="l12.477" class="difflineplus">+      }</span>
<a href="#l12.478"></a><span id="l12.478" class="difflineplus">+</span>
<a href="#l12.479"></a><span id="l12.479" class="difflineplus">+      var transferData = new TransferDataSet(dataArray)</span>
<a href="#l12.480"></a><span id="l12.480" class="difflineplus">+</span>
<a href="#l12.481"></a><span id="l12.481" class="difflineplus">+      // hand over to the client to respond to dropped data</span>
<a href="#l12.482"></a><span id="l12.482" class="difflineplus">+      var multiple = &quot;canHandleMultipleItems&quot; in aDragDropObserver &amp;&amp; aDragDropObserver.canHandleMultipleItems;</span>
<a href="#l12.483"></a><span id="l12.483" class="difflineplus">+      var dropData = multiple ? transferData : transferData.first.first;</span>
<a href="#l12.484"></a><span id="l12.484" class="difflineplus">+      aDragDropObserver.onDrop(aEvent, dropData, this.mDragSession);</span>
<a href="#l12.485"></a><span id="l12.485" class="difflineplus">+      aEvent.stopPropagation();</span>
<a href="#l12.486"></a><span id="l12.486" class="difflineplus">+    },</span>
<a href="#l12.487"></a><span id="l12.487" class="difflineplus">+</span>
<a href="#l12.488"></a><span id="l12.488" class="difflineplus">+  /** </span>
<a href="#l12.489"></a><span id="l12.489" class="difflineplus">+   * void dragExit (DOMEvent aEvent, Object aDragDropObserver) ;</span>
<a href="#l12.490"></a><span id="l12.490" class="difflineplus">+   *</span>
<a href="#l12.491"></a><span id="l12.491" class="difflineplus">+   * called when a drag leaves this element</span>
<a href="#l12.492"></a><span id="l12.492" class="difflineplus">+   *</span>
<a href="#l12.493"></a><span id="l12.493" class="difflineplus">+   * @param DOMEvent aEvent</span>
<a href="#l12.494"></a><span id="l12.494" class="difflineplus">+   *        the DOM event fired by leaving the element</span>
<a href="#l12.495"></a><span id="l12.495" class="difflineplus">+   * @param Object aDragDropObserver</span>
<a href="#l12.496"></a><span id="l12.496" class="difflineplus">+   *        javascript object of format described above that specifies</span>
<a href="#l12.497"></a><span id="l12.497" class="difflineplus">+   *        the way in which the element responds to drag events.</span>
<a href="#l12.498"></a><span id="l12.498" class="difflineplus">+   **/</span>
<a href="#l12.499"></a><span id="l12.499" class="difflineplus">+  dragExit: function (aEvent, aDragDropObserver)</span>
<a href="#l12.500"></a><span id="l12.500" class="difflineplus">+    {</span>
<a href="#l12.501"></a><span id="l12.501" class="difflineplus">+      if (!this.checkCanDrop(aEvent, aDragDropObserver))</span>
<a href="#l12.502"></a><span id="l12.502" class="difflineplus">+        return;</span>
<a href="#l12.503"></a><span id="l12.503" class="difflineplus">+      if (&quot;onDragExit&quot; in aDragDropObserver)</span>
<a href="#l12.504"></a><span id="l12.504" class="difflineplus">+        aDragDropObserver.onDragExit(aEvent, this.mDragSession);</span>
<a href="#l12.505"></a><span id="l12.505" class="difflineplus">+    },  </span>
<a href="#l12.506"></a><span id="l12.506" class="difflineplus">+    </span>
<a href="#l12.507"></a><span id="l12.507" class="difflineplus">+  /** </span>
<a href="#l12.508"></a><span id="l12.508" class="difflineplus">+   * void dragEnter (DOMEvent aEvent, Object aDragDropObserver) ;</span>
<a href="#l12.509"></a><span id="l12.509" class="difflineplus">+   *</span>
<a href="#l12.510"></a><span id="l12.510" class="difflineplus">+   * called when a drag enters in this element</span>
<a href="#l12.511"></a><span id="l12.511" class="difflineplus">+   *</span>
<a href="#l12.512"></a><span id="l12.512" class="difflineplus">+   * @param DOMEvent aEvent</span>
<a href="#l12.513"></a><span id="l12.513" class="difflineplus">+   *        the DOM event fired by entering in the element</span>
<a href="#l12.514"></a><span id="l12.514" class="difflineplus">+   * @param Object aDragDropObserver</span>
<a href="#l12.515"></a><span id="l12.515" class="difflineplus">+   *        javascript object of format described above that specifies</span>
<a href="#l12.516"></a><span id="l12.516" class="difflineplus">+   *        the way in which the element responds to drag events.</span>
<a href="#l12.517"></a><span id="l12.517" class="difflineplus">+   **/</span>
<a href="#l12.518"></a><span id="l12.518" class="difflineplus">+  dragEnter: function (aEvent, aDragDropObserver)</span>
<a href="#l12.519"></a><span id="l12.519" class="difflineplus">+    {</span>
<a href="#l12.520"></a><span id="l12.520" class="difflineplus">+      if (!this.checkCanDrop(aEvent, aDragDropObserver))</span>
<a href="#l12.521"></a><span id="l12.521" class="difflineplus">+        return;</span>
<a href="#l12.522"></a><span id="l12.522" class="difflineplus">+      if (&quot;onDragEnter&quot; in aDragDropObserver)</span>
<a href="#l12.523"></a><span id="l12.523" class="difflineplus">+        aDragDropObserver.onDragEnter(aEvent, this.mDragSession);</span>
<a href="#l12.524"></a><span id="l12.524" class="difflineplus">+    },  </span>
<a href="#l12.525"></a><span id="l12.525" class="difflineplus">+</span>
<a href="#l12.526"></a><span id="l12.526" class="difflineplus">+  /** </span>
<a href="#l12.527"></a><span id="l12.527" class="difflineplus">+   * Boolean checkCanDrop (DOMEvent aEvent, Object aDragDropObserver) ;</span>
<a href="#l12.528"></a><span id="l12.528" class="difflineplus">+   *</span>
<a href="#l12.529"></a><span id="l12.529" class="difflineplus">+   * Sets the canDrop attribute for the drag session.</span>
<a href="#l12.530"></a><span id="l12.530" class="difflineplus">+   * returns false if there is no current drag session.</span>
<a href="#l12.531"></a><span id="l12.531" class="difflineplus">+   *</span>
<a href="#l12.532"></a><span id="l12.532" class="difflineplus">+   * @param DOMEvent aEvent</span>
<a href="#l12.533"></a><span id="l12.533" class="difflineplus">+   *        the DOM event fired by the drop</span>
<a href="#l12.534"></a><span id="l12.534" class="difflineplus">+   * @param Object aDragDropObserver</span>
<a href="#l12.535"></a><span id="l12.535" class="difflineplus">+   *        javascript object of format described above that specifies</span>
<a href="#l12.536"></a><span id="l12.536" class="difflineplus">+   *        the way in which the element responds to drag events.</span>
<a href="#l12.537"></a><span id="l12.537" class="difflineplus">+   **/</span>
<a href="#l12.538"></a><span id="l12.538" class="difflineplus">+  checkCanDrop: function (aEvent, aDragDropObserver)</span>
<a href="#l12.539"></a><span id="l12.539" class="difflineplus">+    {</span>
<a href="#l12.540"></a><span id="l12.540" class="difflineplus">+      if (!this.mDragSession) </span>
<a href="#l12.541"></a><span id="l12.541" class="difflineplus">+        this.mDragSession = this.mDragService.getCurrentSession();</span>
<a href="#l12.542"></a><span id="l12.542" class="difflineplus">+      if (!this.mDragSession) </span>
<a href="#l12.543"></a><span id="l12.543" class="difflineplus">+        return false;</span>
<a href="#l12.544"></a><span id="l12.544" class="difflineplus">+      this.mDragSession.canDrop = this.mDragSession.sourceNode != aEvent.target;</span>
<a href="#l12.545"></a><span id="l12.545" class="difflineplus">+      if (&quot;canDrop&quot; in aDragDropObserver)</span>
<a href="#l12.546"></a><span id="l12.546" class="difflineplus">+        this.mDragSession.canDrop &amp;= aDragDropObserver.canDrop(aEvent, this.mDragSession);</span>
<a href="#l12.547"></a><span id="l12.547" class="difflineplus">+      return true;</span>
<a href="#l12.548"></a><span id="l12.548" class="difflineplus">+    },</span>
<a href="#l12.549"></a><span id="l12.549" class="difflineplus">+</span>
<a href="#l12.550"></a><span id="l12.550" class="difflineplus">+  /**</span>
<a href="#l12.551"></a><span id="l12.551" class="difflineplus">+   * Do a security check for drag n' drop. Make sure the source document</span>
<a href="#l12.552"></a><span id="l12.552" class="difflineplus">+   * can load the dragged link.</span>
<a href="#l12.553"></a><span id="l12.553" class="difflineplus">+   *</span>
<a href="#l12.554"></a><span id="l12.554" class="difflineplus">+   * @param DOMEvent aEvent</span>
<a href="#l12.555"></a><span id="l12.555" class="difflineplus">+   *        the DOM event fired by leaving the element</span>
<a href="#l12.556"></a><span id="l12.556" class="difflineplus">+   * @param Object aDragDropObserver</span>
<a href="#l12.557"></a><span id="l12.557" class="difflineplus">+   *        javascript object of format described above that specifies</span>
<a href="#l12.558"></a><span id="l12.558" class="difflineplus">+   *        the way in which the element responds to drag events.</span>
<a href="#l12.559"></a><span id="l12.559" class="difflineplus">+   * @param String aDraggedText</span>
<a href="#l12.560"></a><span id="l12.560" class="difflineplus">+   *        the text being dragged</span>
<a href="#l12.561"></a><span id="l12.561" class="difflineplus">+   **/</span>
<a href="#l12.562"></a><span id="l12.562" class="difflineplus">+  dragDropSecurityCheck: function (aEvent, aDragSession, aDraggedText)</span>
<a href="#l12.563"></a><span id="l12.563" class="difflineplus">+    {</span>
<a href="#l12.564"></a><span id="l12.564" class="difflineplus">+      // Strip leading and trailing whitespace, then try to create a</span>
<a href="#l12.565"></a><span id="l12.565" class="difflineplus">+      // URI from the dropped string. If that succeeds, we're</span>
<a href="#l12.566"></a><span id="l12.566" class="difflineplus">+      // dropping a URI and we need to do a security check to make</span>
<a href="#l12.567"></a><span id="l12.567" class="difflineplus">+      // sure the source document can load the dropped URI. We don't</span>
<a href="#l12.568"></a><span id="l12.568" class="difflineplus">+      // so much care about creating the real URI here</span>
<a href="#l12.569"></a><span id="l12.569" class="difflineplus">+      // (i.e. encoding differences etc don't matter), we just want</span>
<a href="#l12.570"></a><span id="l12.570" class="difflineplus">+      // to know if aDraggedText really is a URI.</span>
<a href="#l12.571"></a><span id="l12.571" class="difflineplus">+</span>
<a href="#l12.572"></a><span id="l12.572" class="difflineplus">+      aDraggedText = aDraggedText.replace(/^\s*|\s*$/g, '');</span>
<a href="#l12.573"></a><span id="l12.573" class="difflineplus">+</span>
<a href="#l12.574"></a><span id="l12.574" class="difflineplus">+      var uri;</span>
<a href="#l12.575"></a><span id="l12.575" class="difflineplus">+      var ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l12.576"></a><span id="l12.576" class="difflineplus">+                                .getService(Components.interfaces.nsIIOService);</span>
<a href="#l12.577"></a><span id="l12.577" class="difflineplus">+      try {</span>
<a href="#l12.578"></a><span id="l12.578" class="difflineplus">+        uri = ioService.newURI(aDraggedText, null, null);</span>
<a href="#l12.579"></a><span id="l12.579" class="difflineplus">+      } catch (e) {</span>
<a href="#l12.580"></a><span id="l12.580" class="difflineplus">+      }</span>
<a href="#l12.581"></a><span id="l12.581" class="difflineplus">+</span>
<a href="#l12.582"></a><span id="l12.582" class="difflineplus">+      if (!uri)</span>
<a href="#l12.583"></a><span id="l12.583" class="difflineplus">+        return;</span>
<a href="#l12.584"></a><span id="l12.584" class="difflineplus">+</span>
<a href="#l12.585"></a><span id="l12.585" class="difflineplus">+      // aDraggedText is a URI, do the security check.</span>
<a href="#l12.586"></a><span id="l12.586" class="difflineplus">+      const nsIScriptSecurityManager = Components.interfaces</span>
<a href="#l12.587"></a><span id="l12.587" class="difflineplus">+                                                 .nsIScriptSecurityManager;</span>
<a href="#l12.588"></a><span id="l12.588" class="difflineplus">+      var secMan = Components.classes[&quot;@mozilla.org/scriptsecuritymanager;1&quot;]</span>
<a href="#l12.589"></a><span id="l12.589" class="difflineplus">+                             .getService(nsIScriptSecurityManager);</span>
<a href="#l12.590"></a><span id="l12.590" class="difflineplus">+</span>
<a href="#l12.591"></a><span id="l12.591" class="difflineplus">+      if (!aDragSession)</span>
<a href="#l12.592"></a><span id="l12.592" class="difflineplus">+        aDragSession = this.mDragService.getCurrentSession();</span>
<a href="#l12.593"></a><span id="l12.593" class="difflineplus">+</span>
<a href="#l12.594"></a><span id="l12.594" class="difflineplus">+      var sourceDoc = aDragSession.sourceDocument;</span>
<a href="#l12.595"></a><span id="l12.595" class="difflineplus">+      // Use &quot;file:///&quot; as the default sourceURI so that drops of file:// URIs</span>
<a href="#l12.596"></a><span id="l12.596" class="difflineplus">+      // are always allowed.</span>
<a href="#l12.597"></a><span id="l12.597" class="difflineplus">+      var principal = sourceDoc ? sourceDoc.nodePrincipal</span>
<a href="#l12.598"></a><span id="l12.598" class="difflineplus">+                                : secMan.getSimpleCodebasePrincipal(ioService.newURI(&quot;file:///&quot;, null, null));</span>
<a href="#l12.599"></a><span id="l12.599" class="difflineplus">+</span>
<a href="#l12.600"></a><span id="l12.600" class="difflineplus">+      try {</span>
<a href="#l12.601"></a><span id="l12.601" class="difflineplus">+        secMan.checkLoadURIStrWithPrincipal(principal, aDraggedText,</span>
<a href="#l12.602"></a><span id="l12.602" class="difflineplus">+                                            nsIScriptSecurityManager.STANDARD);</span>
<a href="#l12.603"></a><span id="l12.603" class="difflineplus">+      } catch (e) {</span>
<a href="#l12.604"></a><span id="l12.604" class="difflineplus">+        // Stop event propagation right here.</span>
<a href="#l12.605"></a><span id="l12.605" class="difflineplus">+        aEvent.stopPropagation();</span>
<a href="#l12.606"></a><span id="l12.606" class="difflineplus">+</span>
<a href="#l12.607"></a><span id="l12.607" class="difflineplus">+        throw &quot;Drop of &quot; + aDraggedText + &quot; denied.&quot;;</span>
<a href="#l12.608"></a><span id="l12.608" class="difflineplus">+      }</span>
<a href="#l12.609"></a><span id="l12.609" class="difflineplus">+    }</span>
<a href="#l12.610"></a><span id="l12.610" class="difflineplus">+};</span>
<a href="#l12.611"></a><span id="l12.611" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/base/jar.mn</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/base/jar.mn</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -117,10 +117,12 @@ comm.jar:</span>
<a href="#l13.4"></a><span id="l13.4"> % content communicator %content/communicator/</span>
<a href="#l13.5"></a><span id="l13.5">    content/communicator/charsetOverlay.xul          (content/charsetOverlay.xul)</span>
<a href="#l13.6"></a><span id="l13.6">    content/communicator/contentAreaClick.js         (content/contentAreaClick.js)</span>
<a href="#l13.7"></a><span id="l13.7">    content/communicator/labelsencodings.properties  (/mozilla/dom/encoding/labelsencodings.properties)</span>
<a href="#l13.8"></a><span id="l13.8"> *  content/communicator/utilityOverlay.xul          (content/utilityOverlay.xul)</span>
<a href="#l13.9"></a><span id="l13.9">    content/communicator/utilityOverlay.js           (content/utilityOverlay.js)</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11"> toolkit.jar:</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+# toolkit dropped nsDragAndDrop.js in bug 1162050. ship a copy until we can remove it.</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+ content/global/nsDragAndDrop.js                    (content/nsDragAndDrop.js)</span>
<a href="#l13.14"></a><span id="l13.14"> % overlay chrome://global/content/customizeToolbar.xul chrome://messenger/content/customizeToolbarOverlay.xul</span>
<a href="#l13.15"></a><span id="l13.15"> % overlay chrome://mozapps/content/downloads/downloads.xul chrome://messenger/content/downloadsOverlay.xul</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/addrbook/content/abContactsPanel.xul</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/addrbook/content/abContactsPanel.xul</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -101,17 +101,17 @@</span>
<a href="#l14.4"></a><span id="l14.4">         &lt;treecol id=&quot;addrbook&quot;</span>
<a href="#l14.5"></a><span id="l14.5">                  persist=&quot;hidden ordinal width sortDirection&quot; hidden=&quot;true&quot;</span>
<a href="#l14.6"></a><span id="l14.6">                  flex=&quot;1&quot; label=&quot;&amp;Addrbook.label;&quot;/&gt;</span>
<a href="#l14.7"></a><span id="l14.7">         &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l14.8"></a><span id="l14.8">         &lt;treecol id=&quot;PrimaryEmail&quot;</span>
<a href="#l14.9"></a><span id="l14.9">                  persist=&quot;hidden ordinal width sortDirection&quot; hidden=&quot;true&quot;</span>
<a href="#l14.10"></a><span id="l14.10">                  flex=&quot;1&quot; label=&quot;&amp;PrimaryEmail.label;&quot;/&gt;</span>
<a href="#l14.11"></a><span id="l14.11">       &lt;/treecols&gt;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-      &lt;treechildren ondraggesture=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+      &lt;treechildren ondragstart=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l14.14"></a><span id="l14.14">     &lt;/tree&gt;</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16">     &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18">     &lt;hbox&gt;</span>
<a href="#l14.19"></a><span id="l14.19">       &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l14.20"></a><span id="l14.20">       &lt;grid&gt;</span>
<a href="#l14.21"></a><span id="l14.21">         &lt;columns&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/addrbook/content/abEditListDialog.xul</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/addrbook/content/abEditListDialog.xul</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -9,17 +9,17 @@</span>
<a href="#l15.4"></a><span id="l15.4"> &lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/addressbook/abMailListDialog.dtd&quot;&gt;</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6"> &lt;dialog xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l15.7"></a><span id="l15.7">         id=&quot;ablistWindow&quot;</span>
<a href="#l15.8"></a><span id="l15.8">         title=&quot;&amp;mailListWindow.title;&quot;</span>
<a href="#l15.9"></a><span id="l15.9">         onload=&quot;OnLoadEditList();&quot;</span>
<a href="#l15.10"></a><span id="l15.10">         ondialogaccept=&quot;return EditListOKButton();&quot;</span>
<a href="#l15.11"></a><span id="l15.11">         ondragover=&quot;DragOverAddressListTree(event);&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        ondragdrop=&quot;DropOnAddressListTree(event);&quot;&gt;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+        ondrop=&quot;DropOnAddressListTree(event);&quot;&gt;</span>
<a href="#l15.14"></a><span id="l15.14"> </span>
<a href="#l15.15"></a><span id="l15.15">   &lt;stringbundleset id=&quot;stringbundleset&quot;&gt;</span>
<a href="#l15.16"></a><span id="l15.16">     &lt;stringbundle id=&quot;bundle_addressBook&quot; src=&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;/&gt;</span>
<a href="#l15.17"></a><span id="l15.17">   &lt;/stringbundleset&gt;</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19">   &lt;!-- move needed functions into a single js file --&gt;</span>
<a href="#l15.20"></a><span id="l15.20">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/messengercompose/addressingWidgetOverlay.js&quot;/&gt;</span>
<a href="#l15.21"></a><span id="l15.21">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/addressbook/abCommon.js&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/components/addrbook/content/abMailListDialog.xul</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/components/addrbook/content/abMailListDialog.xul</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -9,17 +9,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> &lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/addressbook/abMailListDialog.dtd&quot;&gt;</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> &lt;dialog xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l16.7"></a><span id="l16.7">         id=&quot;ablistWindow&quot;</span>
<a href="#l16.8"></a><span id="l16.8">         title=&quot;&amp;mailListWindow.title;&quot;</span>
<a href="#l16.9"></a><span id="l16.9">         ondialogaccept=&quot;return MailListOKButton();&quot;</span>
<a href="#l16.10"></a><span id="l16.10">         onload=&quot;OnLoadNewMailList();&quot;</span>
<a href="#l16.11"></a><span id="l16.11">         ondragover=&quot;DragOverAddressListTree(event);&quot;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        ondragdrop=&quot;DropOnAddressListTree(event);&quot;&gt;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+        ondrop=&quot;DropOnAddressListTree(event);&quot;&gt;</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15">   &lt;stringbundleset id=&quot;stringbundleset&quot;&gt;</span>
<a href="#l16.16"></a><span id="l16.16">     &lt;stringbundle id=&quot;bundle_addressBook&quot; src=&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;/&gt;</span>
<a href="#l16.17"></a><span id="l16.17">   &lt;/stringbundleset&gt;</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">   &lt;!-- move needed functions into a single js file --&gt;</span>
<a href="#l16.20"></a><span id="l16.20">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/messengercompose/addressingWidgetOverlay.js&quot;/&gt;</span>
<a href="#l16.21"></a><span id="l16.21">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/addressbook/abCommon.js&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -724,17 +724,17 @@</span>
<a href="#l17.4"></a><span id="l17.4">           &lt;!--</span>
<a href="#l17.5"></a><span id="l17.5">           &lt;treecol id=&quot;_PhoneticName&quot;</span>
<a href="#l17.6"></a><span id="l17.6">                    persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l17.7"></a><span id="l17.7">                    label=&quot;&amp;_PhoneticName.label;&quot; hiddenbydefault=&quot;true&quot;/&gt;</span>
<a href="#l17.8"></a><span id="l17.8">           &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l17.9"></a><span id="l17.9">           --&gt;</span>
<a href="#l17.10"></a><span id="l17.10">         &lt;/treecols&gt;</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-        &lt;treechildren ondraggesture=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+        &lt;treechildren ondragstart=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l17.14"></a><span id="l17.14">       &lt;/tree&gt;</span>
<a href="#l17.15"></a><span id="l17.15"> </span>
<a href="#l17.16"></a><span id="l17.16">       &lt;splitter id=&quot;results-splitter&quot; collapse=&quot;after&quot; persist=&quot;state&quot;/&gt;</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18">       &lt;!-- card view --&gt;</span>
<a href="#l17.19"></a><span id="l17.19">       &lt;hbox id=&quot;CardViewOuterBox&quot; flex=&quot;1&quot; minheight=&quot;100&quot; height=&quot;200&quot; persist=&quot;height&quot;&gt;</span>
<a href="#l17.20"></a><span id="l17.20">         &lt;vbox id=&quot;CardViewBox&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l17.21"></a><span id="l17.21">           &lt;vbox id=&quot;CardViewInnerBox&quot; collapsed=&quot;true&quot; flex=&quot;1&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/components/compose/content/messengercompose.xul</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/components/compose/content/messengercompose.xul</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -744,17 +744,17 @@</span>
<a href="#l18.4"></a><span id="l18.4">                tooltiptext=&quot;&amp;addressButton.tooltip;&quot;</span>
<a href="#l18.5"></a><span id="l18.5">                observes=&quot;viewAddressPicker&quot;/&gt;</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7">     &lt;toolbarbutton class=&quot;toolbarbutton-1&quot; type=&quot;menu-button&quot;</span>
<a href="#l18.8"></a><span id="l18.8">                id=&quot;button-attach&quot; label=&quot;&amp;attachButton.label;&quot;</span>
<a href="#l18.9"></a><span id="l18.9">                tooltiptext=&quot;&amp;attachButton.tooltip;&quot;</span>
<a href="#l18.10"></a><span id="l18.10">                command=&quot;cmd_attachFile&quot;</span>
<a href="#l18.11"></a><span id="l18.11">                ondragover=&quot;nsDragAndDrop.dragOver(event, envelopeDragObserver);&quot;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-               ondragdrop=&quot;nsDragAndDrop.drop(event, envelopeDragObserver);&quot;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+               ondrop=&quot;nsDragAndDrop.drop(event, envelopeDragObserver);&quot;</span>
<a href="#l18.14"></a><span id="l18.14">                ondragexit=&quot;nsDragAndDrop.dragExit(event, envelopeDragObserver);&quot;&gt;</span>
<a href="#l18.15"></a><span id="l18.15">       &lt;menupopup id=&quot;button-attachPopup&quot; onpopupshowing=&quot;updateAttachmentItems();&quot;&gt;</span>
<a href="#l18.16"></a><span id="l18.16">         &lt;menuitem id=&quot;button-attachPopup_attachFileItem&quot;</span>
<a href="#l18.17"></a><span id="l18.17">                   label=&quot;&amp;attachFileCmd.label;&quot;</span>
<a href="#l18.18"></a><span id="l18.18">                   accesskey=&quot;&amp;attachFileCmd.accesskey;&quot;</span>
<a href="#l18.19"></a><span id="l18.19">                   command=&quot;cmd_attachFile&quot;/&gt;</span>
<a href="#l18.20"></a><span id="l18.20">         &lt;menu id=&quot;button-attachPopup_attachCloudMenu&quot;</span>
<a href="#l18.21"></a><span id="l18.21">               label=&quot;&amp;attachCloudCmd.label;&quot;</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -900,17 +900,17 @@</span>
<a href="#l18.23"></a><span id="l18.23"> </span>
<a href="#l18.24"></a><span id="l18.24">     &lt;splitter id=&quot;sidebar-splitter&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26">     &lt;vbox id=&quot;headers-parent&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l18.27"></a><span id="l18.27">     &lt;toolbox id=&quot;headers-box&quot; class=&quot;toolbox-top&quot; mode=&quot;icons&quot;&gt;</span>
<a href="#l18.28"></a><span id="l18.28">     &lt;toolbar id=&quot;MsgHeadersToolbar&quot; persist=&quot;collapsed&quot; flex=&quot;1&quot;</span>
<a href="#l18.29"></a><span id="l18.29">              customizable=&quot;true&quot; nowindowdrag=&quot;true&quot;</span>
<a href="#l18.30"></a><span id="l18.30">              ondragover=&quot;nsDragAndDrop.dragOver(event, envelopeDragObserver);&quot;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-             ondragdrop=&quot;nsDragAndDrop.drop(event, envelopeDragObserver);&quot;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+             ondrop=&quot;nsDragAndDrop.drop(event, envelopeDragObserver);&quot;</span>
<a href="#l18.33"></a><span id="l18.33">              ondragexit=&quot;nsDragAndDrop.dragExit(event, envelopeDragObserver);&quot;&gt;</span>
<a href="#l18.34"></a><span id="l18.34">       &lt;hbox id=&quot;msgheaderstoolbar-box&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l18.35"></a><span id="l18.35">         &lt;vbox flex=&quot;1&quot; id=&quot;addresses-box&quot;&gt;</span>
<a href="#l18.36"></a><span id="l18.36">           &lt;hbox id=&quot;top-gradient-box&quot;&gt;</span>
<a href="#l18.37"></a><span id="l18.37">             &lt;hbox align=&quot;center&quot; pack=&quot;end&quot; style=&quot;&amp;headersSpace.style;&quot;&gt;</span>
<a href="#l18.38"></a><span id="l18.38">               &lt;label id=&quot;identityLabel&quot; value=&quot;&amp;fromAddr.label;&quot;</span>
<a href="#l18.39"></a><span id="l18.39">                      accesskey=&quot;&amp;fromAddr.accesskey;&quot; control=&quot;msgIdentity&quot;/&gt;</span>
<a href="#l18.40"></a><span id="l18.40">             &lt;/hbox&gt;</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineat">@@ -980,17 +980,17 @@</span>
<a href="#l18.42"></a><span id="l18.42">           &lt;/hbox&gt;</span>
<a href="#l18.43"></a><span id="l18.43">           &lt;attachmentlist orient=&quot;vertical&quot; id=&quot;attachmentBucket&quot;</span>
<a href="#l18.44"></a><span id="l18.44">                           disableonsend=&quot;true&quot;</span>
<a href="#l18.45"></a><span id="l18.45">                           seltype=&quot;multiple&quot; flex=&quot;1&quot; height=&quot;0&quot;</span>
<a href="#l18.46"></a><span id="l18.46">                           context=&quot;msgComposeAttachmentListContext&quot;</span>
<a href="#l18.47"></a><span id="l18.47">                           itemcontext=&quot;msgComposeAttachmentItemContext&quot;</span>
<a href="#l18.48"></a><span id="l18.48">                           onclick=&quot;AttachmentBucketClicked(event);&quot;</span>
<a href="#l18.49"></a><span id="l18.49">                           onselect=&quot;updateAttachmentItems();&quot;</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-                          ondraggesture=&quot;nsDragAndDrop.startDrag(event, attachmentBucketDNDObserver);&quot;/&gt;</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+                          ondragstart=&quot;nsDragAndDrop.startDrag(event, attachmentBucketDNDObserver);&quot;/&gt;</span>
<a href="#l18.52"></a><span id="l18.52">         &lt;/vbox&gt;</span>
<a href="#l18.53"></a><span id="l18.53">       &lt;/hbox&gt;</span>
<a href="#l18.54"></a><span id="l18.54">     &lt;/toolbar&gt;</span>
<a href="#l18.55"></a><span id="l18.55"> </span>
<a href="#l18.56"></a><span id="l18.56">     &lt;!-- These toolbar items get filled out from the editorOverlay --&gt;</span>
<a href="#l18.57"></a><span id="l18.57">     &lt;toolbox id=&quot;FormatToolbox&quot; mode=&quot;icons&quot;&gt;</span>
<a href="#l18.58"></a><span id="l18.58">       &lt;toolbar class=&quot;chromeclass-toolbar&quot; id=&quot;FormatToolbar&quot; persist=&quot;collapsed&quot;</span>
<a href="#l18.59"></a><span id="l18.59">                customizable=&quot;true&quot; nowindowdrag=&quot;true&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/components/im/content/imAccounts.xul</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/components/im/content/imAccounts.xul</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -140,17 +140,17 @@</span>
<a href="#l19.4"></a><span id="l19.4">      &lt;/hbox&gt;</span>
<a href="#l19.5"></a><span id="l19.5">    &lt;/vbox&gt;</span>
<a href="#l19.6"></a><span id="l19.6">    &lt;notificationbox id=&quot;accountsNotificationBox&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l19.7"></a><span id="l19.7">      &lt;richlistbox id=&quot;accountlist&quot; flex=&quot;1&quot; context=&quot;accountsContextMenu&quot;</span>
<a href="#l19.8"></a><span id="l19.8">                   onselect=&quot;gAccountManager.onAccountSelect();&quot;</span>
<a href="#l19.9"></a><span id="l19.9">                   ondragstart=&quot;nsDragAndDrop.startDrag(event, gAMDragAndDrop);&quot;</span>
<a href="#l19.10"></a><span id="l19.10">                   ondragover=&quot;nsDragAndDrop.dragOver(event, gAMDragAndDrop);&quot;</span>
<a href="#l19.11"></a><span id="l19.11">                   ondragend=&quot;gAMDragAndDrop.cleanBorders(true);&quot;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-                  ondragdrop=&quot;nsDragAndDrop.drop(event, gAMDragAndDrop);&quot;/&gt;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+                  ondrop=&quot;nsDragAndDrop.drop(event, gAMDragAndDrop);&quot;/&gt;</span>
<a href="#l19.14"></a><span id="l19.14">    &lt;/notificationbox&gt;</span>
<a href="#l19.15"></a><span id="l19.15">  &lt;/deck&gt;</span>
<a href="#l19.16"></a><span id="l19.16">  &lt;windowdragbox id=&quot;bottombuttons&quot; align=&quot;center&quot;&gt;</span>
<a href="#l19.17"></a><span id="l19.17">   &lt;button id=&quot;newaccount&quot; command=&quot;cmd_new&quot;/&gt;</span>
<a href="#l19.18"></a><span id="l19.18">   &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l19.19"></a><span id="l19.19">   &lt;button id=&quot;close&quot; command=&quot;cmd_close&quot;/&gt;</span>
<a href="#l19.20"></a><span id="l19.20">  &lt;/windowdragbox&gt;</span>
<a href="#l19.21"></a><span id="l19.21"> &lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/addrbook/content/abResultsPaneOverlay.xul</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/addrbook/content/abResultsPaneOverlay.xul</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -80,13 +80,13 @@</span>
<a href="#l20.4"></a><span id="l20.4">     &lt;!--</span>
<a href="#l20.5"></a><span id="l20.5">     &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l20.6"></a><span id="l20.6">     &lt;treecol id=&quot;_PhoneticName&quot;</span>
<a href="#l20.7"></a><span id="l20.7">              persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l20.8"></a><span id="l20.8">              label=&quot;&amp;_PhoneticName.label;&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l20.9"></a><span id="l20.9">      --&gt;</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">   &lt;/treecols&gt;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  &lt;treechildren ondraggesture=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  &lt;treechildren ondragstart=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l20.14"></a><span id="l20.14"> &lt;/tree&gt;</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16"> &lt;/overlay&gt;</span>
<a href="#l20.17"></a><span id="l20.17"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

