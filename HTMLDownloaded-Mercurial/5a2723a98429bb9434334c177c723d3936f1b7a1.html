<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 1965:5a2723a98429bb9434334c177c723d3936f1b7a1</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 5a2723a98429bb9434334c177c723d3936f1b7a1" />
<meta property="og:url" content="/comm-central/rev/5a2723a98429bb9434334c177c723d3936f1b7a1" />
<meta property="og:description" content="Merge commit" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 5a2723a98429bb9434334c177c723d3936f1b7a1 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/5a2723a98429bb9434334c177c723d3936f1b7a1">shortlog</a> |
<a href="/comm-central/log/5a2723a98429bb9434334c177c723d3936f1b7a1">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/5a2723a98429bb9434334c177c723d3936f1b7a1">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/5a2723a98429bb9434334c177c723d3936f1b7a1">files</a> |
changeset |
<a href="/comm-central/raw-rev/5a2723a98429bb9434334c177c723d3936f1b7a1">raw</a>  | <a href="/comm-central/archive/5a2723a98429bb9434334c177c723d3936f1b7a1.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Merge commit
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#105;&#109;&#111;&#110;&#32;&#80;&#97;&#113;&#117;&#101;&#116;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#98;&#97;&#98;&#121;&#108;&#111;&#110;&#115;&#111;&#117;&#110;&#100;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 16 Feb 2009 21:44:10 +0100</td></tr>

<tr>
 <td>changeset 1965</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/5a2723a98429bb9434334c177c723d3936f1b7a1">5a2723a98429bb9434334c177c723d3936f1b7a1</a></td>
</tr>



<tr>
<td>parent 1964</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f479f330b57b61652938c9edd52442d5846ceb13">f479f330b57b61652938c9edd52442d5846ceb13</a> (current diff)
</td>
</tr>
<tr>
<td>parent 1963</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2ab21ba79df95604f2494bb7bb18188946a41534">2ab21ba79df95604f2494bb7bb18188946a41534</a> (<a href="/comm-central/rev/2ab21ba79df95604f2494bb7bb18188946a41534:5a2723a98429">diff</a>)
</td>
</tr>

<tr>
<td>child 1966</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/51a765135d91a448892f8f88740970f63f096d05">51a765135d91a448892f8f88740970f63f096d05</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=5a2723a98429bb9434334c177c723d3936f1b7a1">1591</a></td></tr>
<tr><td>push user</td><td>bugzilla@babylonsounds.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 16 Feb 2009 20:49:40 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@5a2723a98429 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=5a2723a98429bb9434334c177c723d3936f1b7a1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=5a2723a98429bb9434334c177c723d3936f1b7a1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=5a2723a98429bb9434334c177c723d3936f1b7a1&newProject=comm-central&newRevision=f479f330b57b61652938c9edd52442d5846ceb13&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=5a2723a98429bb9434334c177c723d3936f1b7a1&newProject=comm-central&newRevision=f479f330b57b61652938c9edd52442d5846ceb13&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=5a2723a98429bb9434334c177c723d3936f1b7a1&newProject=comm-central&newRevision=f479f330b57b61652938c9edd52442d5846ceb13&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>






</table></div>

<div class="page_body description">Merge commit</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/macMenuOverlay.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/macMenuOverlay.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -45,15 +45,14 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;overlay xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">   &lt;menupopup id=&quot;windowPopup&quot;&gt;</span>
<a href="#l1.7"></a><span id="l1.7">     &lt;menuseparator insertbefore=&quot;sep-window-list&quot;/&gt;</span>
<a href="#l1.8"></a><span id="l1.8">     &lt;menuitem accesskey=&quot;&amp;messengerCmd.accesskey;&quot;</span>
<a href="#l1.9"></a><span id="l1.9">               label=&quot;&amp;messengerCmd.label;&quot;  key=&quot;key_mail&quot;</span>
<a href="#l1.10"></a><span id="l1.10">               oncommand=&quot;toMessengerWindow();&quot; id=&quot;tasksMenuMail&quot;</span>
<a href="#l1.11"></a><span id="l1.11">               insertbefore=&quot;sep-window-list&quot;/&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    &lt;menuitem id=&quot;tasksMenuAddressBook&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-              label=&quot;&amp;addressBookCmd.label;&quot;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-              accesskey=&quot;&amp;addressBookCmd.accesskey;&quot;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-              oncommand=&quot;toAddressBook();&quot;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+    &lt;menuitem label=&quot;&amp;addressBookCmd.label;&quot;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+              accesskey=&quot;&amp;addressBookCmd.accesskey;&quot; key=&quot;key_addressbook&quot;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+              oncommand=&quot;toAddressBook();&quot; id=&quot;tasksMenuAddressBook&quot;</span>
<a href="#l1.19"></a><span id="l1.19">               insertbefore=&quot;sep-window-list&quot;/&gt;</span>
<a href="#l1.20"></a><span id="l1.20">   &lt;/menupopup&gt;</span>
<a href="#l1.21"></a><span id="l1.21"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/mailWindow.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/mailWindow.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -49,166 +49,20 @@ var accountManager;</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> var gMessengerBundle;</span>
<a href="#l2.6"></a><span id="l2.6"> var gBrandBundle;</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> var gContextMenu;</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> var gAccountCentralLoaded = true;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-var gAutoSyncManager;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-const nsIAutoSyncMgrListener = Components.interfaces.nsIAutoSyncMgrListener;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-var gAutoSyncMonitor = {</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-  logEnabled : false,</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-  msgWindow : null,</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-  inQFolderList : new Array(),</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-  runnning : false,</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-  </span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-  onStateChanged : function(running)</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-    {</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-      this.runnning = running;</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-      this.log(&quot;***Auto_Sync OnStatusChanged: &quot; + (running ? &quot;running&quot; : &quot;sleeping&quot;) + &quot;\n&quot;);</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-      if (!this.running)</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-        this.clearStatusString();</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-    },</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-  onFolderAddedIntoQ : function(queue, folder)</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineminus">-    {</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-      if (folder instanceof Components.interfaces.nsIMsgFolder) </span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-      {</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-        if (queue == nsIAutoSyncMgrListener.PriorityQueue)</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-        {</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-          this.inQFolderList.push(folder);</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-          this.log(&quot;***Auto_Sync OnFolderAddedIntoQ [&quot; + this.inQFolderList.length + &quot;] &quot; + </span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-                          folder.prettiestName + &quot; of &quot; + folder.server.prettyName + &quot;\n&quot;);</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-        }</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-      }</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-    },</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-  onFolderRemovedFromQ : function(queue, folder)</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-    {</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-      if (folder instanceof Components.interfaces.nsIMsgFolder) </span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-      {        </span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-        if (queue == nsIAutoSyncMgrListener.PriorityQueue)</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-        { </span>
<a href="#l2.46"></a><span id="l2.46" class="difflineminus">-          var i = this.inQFolderList.indexOf(folder);</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-          if (i &gt; -1)</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-            this.inQFolderList.splice(i,1);</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-         </span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-          this.log(&quot;***Auto_Sync OnFolderRemovedFromQ [&quot; + this.inQFolderList.length + &quot;] &quot; + </span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-                          folder.prettiestName + &quot; of &quot; + folder.server.prettyName + &quot;\n&quot;);</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-        </span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-          if (this.inQFolderList.length &gt; 0)</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-            this.showStatusString();</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-          else</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-            this.clearStatusString();</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-        }</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-      }</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-    },</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-  onDownloadStarted : function(folder, numOfMessages, totalPending)</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-    {</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-      if (folder instanceof Components.interfaces.nsIMsgFolder) </span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-      {        </span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-        this.log(&quot;***Auto_Sync OnDownloadStarted (&quot; + numOfMessages + &quot;/&quot; + totalPending + &quot;): &quot; + </span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-                                folder.prettiestName + &quot; of &quot; + folder.server.prettyName + &quot;\n&quot;);</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-                </span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-        this.showStatusString();</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-      }</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-    },</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-  onDownloadCompleted : function(folder)</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-    {</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-      if (folder instanceof Components.interfaces.nsIMsgFolder) </span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-      {         </span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-        this.log(&quot;***Auto_Sync OnDownloadCompleted: &quot; + folder.prettiestName + &quot; of &quot; + </span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-                                                                  folder.server.prettyName + &quot;\n&quot;);</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-        if (this.runnning)</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-          this.showStatusString();     </span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-      }</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-    },</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-  onDownloadError : function(folder)</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-    {</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-      if (folder instanceof Components.interfaces.nsIMsgFolder) </span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-      {         </span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-        this.log(&quot;***Auto_Sync OnDownloadError: &quot; + folder.prettiestName + &quot; of &quot; + </span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-                                                                    folder.server.prettyName + &quot;\n&quot;);</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-      }</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-    },</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-  onDiscoveryQProcessed : function (folder, numOfHdrsProcessed, leftToProcess)</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-    {</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-      this.log(&quot;***Auto_Sync onDiscoveryQProcessed: Processed &quot; + numOfHdrsProcessed + &quot;/&quot; + </span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-                            (leftToProcess+numOfHdrsProcessed) + &quot; of &quot; + folder.prettiestName + &quot;\n&quot;);</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-    },</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-  onAutoSyncInitiated : function (folder)</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-    {</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">-      this.log(&quot;***Auto_Sync onAutoSyncInitiated: &quot; + folder.prettiestName + &quot; of &quot; +</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineminus">-                                                  folder.server.prettyName + &quot; has been updated.\n&quot;); </span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">-    },</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineminus">-  getFolderListString : function()</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-    {</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-      var folderList;</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-      if (this.inQFolderList.length &gt; 0)</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineminus">-        folderList = this.inQFolderList[0].prettiestName;</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineminus">-          </span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-      for (var i = 1; i &lt; this.inQFolderList.length; i++)</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-        folderList = folderList + &quot;, &quot; + this.inQFolderList[i].prettiestName;</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-        </span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-      return folderList;</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-    },</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-  getAccountListString : function()</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineminus">-    {</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineminus">-      var accountList;</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineminus">-      if (this.inQFolderList.length &gt; 0)</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineminus">-        accountList = this.inQFolderList[0].server.prettyName;</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineminus">-          </span>
<a href="#l2.115"></a><span id="l2.115" class="difflineminus">-      for (var i = 1; i &lt; this.inQFolderList.length; i++)</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineminus">-      {</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineminus">-        // no do repeat already existing account names</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineminus">-        if (accountList.search(this.inQFolderList[i].server.prettyName) == -1)</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineminus">-          accountList = accountList + &quot;, &quot; + this.inQFolderList[i].server.prettyName;</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineminus">-      }</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-      return accountList;</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-    },</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-  showStatusString : function()</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-    {</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-      if (this.msgWindow &amp;&amp; this.msgWindow.statusFeedback)</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-      {</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineminus">-        this.msgWindow.statusFeedback.showStatusString(</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineminus">-                this.formatStatusString(this.getFolderListString(), this.getAccountListString()));</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineminus">-      }</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineminus">-    },</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineminus">-  clearStatusString : function()</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineminus">-    {</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineminus">-      if (this.msgWindow &amp;&amp; this.msgWindow.statusFeedback)</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineminus">-        this.msgWindow.statusFeedback.showStatusString(&quot;&quot;);</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineminus">-    },</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineminus">-  formatStatusString : function(folderList, accountList)</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineminus">-    {</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineminus">-      if (!gMessengerBundle)</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineminus">-        gMessengerBundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineminus">-          </span>
<a href="#l2.141"></a><span id="l2.141" class="difflineminus">-      return gMessengerBundle.getFormattedString(&quot;autosyncProgress&quot;, </span>
<a href="#l2.142"></a><span id="l2.142" class="difflineminus">-                                                  [folderList, accountList]);</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-    },</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-  log : function(text)</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-    {</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-      if (this.logEnabled)</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-        dump(text);</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-    } </span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-};</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-</span>
<a href="#l2.151"></a><span id="l2.151"> function OnMailWindowUnload()</span>
<a href="#l2.152"></a><span id="l2.152"> {</span>
<a href="#l2.153"></a><span id="l2.153">   MailOfflineMgr.uninit();</span>
<a href="#l2.154"></a><span id="l2.154">   ClearPendingReadTimer();</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineminus">-  </span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">-  try {</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineminus">-    gAutoSyncManager.removeListener(gAutoSyncMonitor);</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineminus">-  }</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-  catch(ex) {</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineminus">-    dump(&quot;error while removing auto-sync listener: &quot; + ex);</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineminus">-  }</span>
<a href="#l2.162"></a><span id="l2.162"> </span>
<a href="#l2.163"></a><span id="l2.163">   var searchSession = GetSearchSession();</span>
<a href="#l2.164"></a><span id="l2.164">   if (searchSession)</span>
<a href="#l2.165"></a><span id="l2.165">   {</span>
<a href="#l2.166"></a><span id="l2.166">     removeGlobalListeners();</span>
<a href="#l2.167"></a><span id="l2.167">     if (gPreQuickSearchView)     //close the cached pre quick search view</span>
<a href="#l2.168"></a><span id="l2.168">       gPreQuickSearchView.close();</span>
<a href="#l2.169"></a><span id="l2.169">   }</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineat">@@ -258,20 +112,16 @@ function CreateMailWindowGlobals()</span>
<a href="#l2.171"></a><span id="l2.171"> </span>
<a href="#l2.172"></a><span id="l2.172">   msgComposeService = Components.classes['@mozilla.org/messengercompose;1']</span>
<a href="#l2.173"></a><span id="l2.173">                                 .getService(Components.interfaces.nsIMsgComposeService);</span>
<a href="#l2.174"></a><span id="l2.174"> </span>
<a href="#l2.175"></a><span id="l2.175">   accountManager = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;].getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l2.176"></a><span id="l2.176"> </span>
<a href="#l2.177"></a><span id="l2.177">   gMessengerBundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l2.178"></a><span id="l2.178">   gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineminus">-  gAutoSyncManager = Components.classes[&quot;@mozilla.org/imap/autosyncmgr;1&quot;]</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineminus">-                                       .getService(Components.interfaces.nsIAutoSyncManager);</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineminus">-  gAutoSyncMonitor.msgWindow = msgWindow;</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineminus">-  gAutoSyncManager.addListener(gAutoSyncMonitor);</span>
<a href="#l2.183"></a><span id="l2.183"> </span>
<a href="#l2.184"></a><span id="l2.184">   msgWindow.notificationCallbacks = new BadCertHandler();</span>
<a href="#l2.185"></a><span id="l2.185"> }</span>
<a href="#l2.186"></a><span id="l2.186"> </span>
<a href="#l2.187"></a><span id="l2.187"> function InitMsgWindow()</span>
<a href="#l2.188"></a><span id="l2.188"> {</span>
<a href="#l2.189"></a><span id="l2.189">   msgWindow.windowCommands = new nsMsgWindowCommands();</span>
<a href="#l2.190"></a><span id="l2.190">   // set the domWindow before setting the status feedback and header sink objects</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1300,19 +1300,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">     &lt;/menu&gt;</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">     &lt;!-- Tools --&gt;</span>
<a href="#l3.7"></a><span id="l3.7">     &lt;menu id=&quot;tasksMenu&quot; label=&quot;&amp;tasksMenu.label;&quot; accesskey=&quot;&amp;tasksMenu.accesskey;&quot;&gt;</span>
<a href="#l3.8"></a><span id="l3.8">       &lt;menupopup id=&quot;taskPopup&quot; onpopupshowing=&quot;document.commandDispatcher.updateCommands('create-menu-tasks')&quot;&gt;</span>
<a href="#l3.9"></a><span id="l3.9"> #ifndef XP_MACOSX</span>
<a href="#l3.10"></a><span id="l3.10">         &lt;menuitem hidden=&quot;true&quot; accesskey=&quot;&amp;messengerCmd.accesskey;&quot; label=&quot;&amp;messengerCmd.label;&quot;</span>
<a href="#l3.11"></a><span id="l3.11">                   key=&quot;key_mail&quot; oncommand=&quot;toMessengerWindow();&quot; id=&quot;tasksMenuMail&quot; class=&quot;menuitem-iconic menu-iconic&quot;/&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-        &lt;menuitem id=&quot;addressBook&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                  label=&quot;&amp;addressBookCmd.label;&quot;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                  accesskey=&quot;&amp;addressBookCmd.accesskey;&quot;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+        &lt;menuitem id=&quot;addressBook&quot; label=&quot;&amp;addressBookCmd.label;&quot; accesskey=&quot;&amp;addressBookCmd.accesskey;&quot; key=&quot;key_addressbook&quot;</span>
<a href="#l3.16"></a><span id="l3.16">                   oncommand=&quot;toOpenWindowByType('mail:addressbook', 'chrome://messenger/content/addressbook/addressbook.xul');&quot;/&gt;</span>
<a href="#l3.17"></a><span id="l3.17"> #endif</span>
<a href="#l3.18"></a><span id="l3.18">         &lt;menuitem id=&quot;addonsManager&quot; label=&quot;&amp;addons.label;&quot; accesskey=&quot;&amp;addons.accesskey;&quot;</span>
<a href="#l3.19"></a><span id="l3.19">                   oncommand=&quot;openAddonsMgr();&quot;/&gt;</span>
<a href="#l3.20"></a><span id="l3.20">         &lt;!--Commented out until we land some activities--&gt;</span>
<a href="#l3.21"></a><span id="l3.21">         &lt;!--&lt;menuitem id=&quot;activityManager&quot; label=&quot;&amp;activitymanager.label;&quot;--&gt;</span>
<a href="#l3.22"></a><span id="l3.22">         &lt;!--          accesskey=&quot;&amp;activitymanager.accesskey;&quot;--&gt;</span>
<a href="#l3.23"></a><span id="l3.23">         &lt;!--          oncommand=&quot;openActivityMgr();&quot;/&gt;--&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/activity/modules/activityModules.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/activity/modules/activityModules.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -40,8 +40,10 @@</span>
<a href="#l4.4"></a><span id="l4.4"> // modules.</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> const EXPORTED_SYMBOLS = [];</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> Components.utils.import(&quot;resource://app/modules/activity/sendLater.js&quot;);</span>
<a href="#l4.9"></a><span id="l4.9"> sendLaterModule.init();</span>
<a href="#l4.10"></a><span id="l4.10"> Components.utils.import(&quot;resource://app/modules/activity/moveCopy.js&quot;);</span>
<a href="#l4.11"></a><span id="l4.11"> moveCopyModule.init();</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+Components.utils.import(&quot;resource://app/modules/activity/autosync.js&quot;);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+autosyncModule.init();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/mail/components/activity/modules/autosync.js</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,390 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+ *</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+ *</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+ * License.</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+ *</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+ * The Original Code is Thunderbird Activity Manager.</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+ *</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+ * Mozilla Messaging.</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+ *</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+ * Contributor(s):</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+ *   Mark Banner &lt;bugzilla@standard8.plus.com&gt;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+ *   Emre Birol &lt;ebirol@gmail.com&gt;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+ *   David Ascher &lt;dascher@mozillamessaging.com&gt;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+ *</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+ *</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+const EXPORTED_SYMBOLS = ['autosyncModule'];</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+const Cc = Components.classes;</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+const Ci = Components.interfaces;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+const Cr = Components.results;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+const nsActProcess = Components.Constructor(&quot;@mozilla.org/activity-process;1&quot;,</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+                                            &quot;nsIActivityProcess&quot;, &quot;init&quot;);</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+const nsActEvent = Components.Constructor(&quot;@mozilla.org/activity-event;1&quot;,</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+                                          &quot;nsIActivityEvent&quot;, &quot;init&quot;);</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+const nsActWarning = Components.Constructor(&quot;@mozilla.org/activity-warning;1&quot;,</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+                                            &quot;nsIActivityWarning&quot;, &quot;init&quot;);</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+Components.utils.import(&quot;resource://app/modules/gloda/log4moz.js&quot;);</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+const nsIAutoSyncMgrListener = Components.interfaces.nsIAutoSyncMgrListener;</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+/**</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+ * This code aims to mediate between the auto-sync code and the activity mgr.</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+ *</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+ * Not every auto-sync activity is directly  mapped to a process or event.</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+ * To prevent a possible event overflow, Auto-Sync monitor generates one</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+ * sync'd event per account when after all its _pending_ folders are sync'd,</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+ * rather than generating one event per folder sync.</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+ */</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+let autosyncModule =</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+{</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+  _inQFolderList : new Array(),</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+  _runnning : false,</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+  _syncInfoPerFolder: {},</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+  _syncInfoPerServer: {},</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+  get log() {</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+    delete this.log;</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+    return this.log = Log4Moz.getConfiguredLogger(&quot;autosyncActivities&quot;);</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+  },</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+  get activityMgr() {</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+    delete this.activityMgr;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+    return this.activityMgr = Cc[&quot;@mozilla.org/activity-manager;1&quot;]</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+                                .getService(Ci.nsIActivityManager);</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+  },</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+  get bundle() {</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+    delete this.bundle;</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+    let bundleSvc = Cc[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+                      .getService(Ci.nsIStringBundleService);</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+    return this.bundle = bundleSvc</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+      .createBundle(&quot;chrome://messenger/locale/activity.properties&quot;);</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+  },</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+  getString: function(stringName) {</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+    try {</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+      return this.bundle.GetStringFromName(stringName)</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+    } catch (e) {</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+      this.log.error(&quot;error trying to get a string called: &quot; + stringName);</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+      throw(e);</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+    }</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+  },</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+  createSyncMailProcess : function(folder) {</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+    try {</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+      // create an activity process for this folder</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+      let msg = this.bundle.formatStringFromName(&quot;autosyncProcessDisplayText&quot;,</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+                                                 [folder.prettiestName], 1)</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+      let process = new nsActProcess(msg, this.autoSyncManager);</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+      // we want to use default auto-sync icon</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+      process.iconClass = &quot;syncMail&quot;;</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+      process.addSubject(folder);</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+      // group processes under folder's imap account</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+      process.contextType = &quot;account&quot;;</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineplus">+      process.contextDisplayText = this.bundle.formatStringFromName(&quot;autosyncContextDisplayText&quot;,</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+                                        [folder.server.prettyName], 1)</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineplus">+</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineplus">+      process.contextObj = folder.server;</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineplus">+</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineplus">+      return process;</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineplus">+    } catch (e) {</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineplus">+      this.log.error(&quot;createSyncMailProcess: &quot; + e);</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+      throw(e);</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineplus">+    }</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineplus">+  },</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineplus">+</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineplus">+  createSyncMailEvent : function(syncItem) {</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineplus">+    try {</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineplus">+      // extract the relevant parts</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineplus">+      let process = syncItem.activity;</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineplus">+      let folder = syncItem.syncFolder;</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineplus">+</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineplus">+      // create an activity event</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineplus">+</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+      let msg = this.bundle.formatStringFromName(&quot;autosyncEventDisplayText&quot;,</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+                                                 [folder.server.prettyName], 1);</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+      let statusMsg;</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+      let numOfMessages = this._syncInfoPerServer[folder.server].totalDownloads;</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+      if (numOfMessages)</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineplus">+        statusMsg = this.bundle.formatStringFromName(&quot;autosyncEventStatusText&quot;,</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineplus">+                                                     [numOfMessages], 1);</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineplus">+      else</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+        statusMsg = this.bundle.getString(&quot;autosyncEventStatusTextNoMsgs&quot;);</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+      let event = new nsActEvent(msg, this.autoSyncManager, statusMsg,</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+                                 this._syncInfoPerServer[folder.server].startTime,</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineplus">+                                 Date.now());               // completion time</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineplus">+</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineplus">+      // since auto-sync events do not have undo option by nature,</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineplus">+      // setting these values are informational only.</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineplus">+      event.contextType = process.contextType;</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+      event.contextDisplayText = this.bundle.formatStringFromName(&quot;autosyncContextDisplayText&quot;,</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+                                        [folder.server.prettyName], 1)</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+      event.contextObj = process.contextObj;</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+      // transfer all subjects.</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineplus">+      // same as above, not mandatory</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+      let subjects = process.getSubjects({});</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineplus">+      for each (let [, subject] in Iterator(subjects))</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineplus">+        event.addSubject(subject);</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineplus">+</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineplus">+      return event;</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineplus">+    } catch (e) {</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineplus">+      this.log.error(&quot;createSyncMailEvent: &quot; + e);</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineplus">+      throw(e);</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineplus">+    }</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineplus">+  },</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineplus">+</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineplus">+  onStateChanged : function(running) {</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineplus">+    try {</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineplus">+      this._runnning = running;</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineplus">+      this.log.info(&quot;OnStatusChanged: &quot; + (running ? &quot;running&quot; : &quot;sleeping&quot;) + &quot;\n&quot;);</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineplus">+    } catch (e) {</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineplus">+      this.log.error(&quot;onStateChanged: &quot; + e);</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineplus">+      throw(e);</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineplus">+    }</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineplus">+  },</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineplus">+</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineplus">+  onFolderAddedIntoQ : function(queue, folder) {</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineplus">+    try {</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineplus">+      if (folder instanceof Components.interfaces.nsIMsgFolder &amp;&amp;</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineplus">+          queue == nsIAutoSyncMgrListener.PriorityQueue) {</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineplus">+        this._inQFolderList.push(folder);</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineplus">+        this.log.info(&quot;Auto_Sync OnFolderAddedIntoQ [&quot; + this._inQFolderList.length + &quot;] &quot; +</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineplus">+                        folder.prettiestName + &quot; of &quot; + folder.server.prettyName);</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineplus">+        // create an activity process for this folder</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineplus">+        let process = this.createSyncMailProcess(folder);</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineplus">+</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineplus">+        // create a sync object to keep track of the process of this folder</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineplus">+        let imapFolder = folder.QueryInterface(Components.interfaces.nsIMsgImapMailFolder);</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineplus">+        let syncItem = { syncFolder: folder,</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+                         activity: process,</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineplus">+                         percentComplete: 0,</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineplus">+                         totalDownloaded: 0,</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineplus">+                         pendingMsgCount: imapFolder.autoSyncStateObj.pendingMessageCount</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineplus">+                       };</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineplus">+</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineplus">+        // if this is the first folder of this server in the queue, then set the sync start time</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+        // for activity event</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineplus">+        if (!this._syncInfoPerServer[folder.server]) {</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineplus">+          this._syncInfoPerServer[folder.server] = { startTime: Date.now(),</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+                                                     totalDownloads: 0</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineplus">+                                                   };</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+        }</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineplus">+</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineplus">+        // associate the sync object with the folder in question</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineplus">+        // use folder.URI as key</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineplus">+        this._syncInfoPerFolder[folder.URI] = syncItem;</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineplus">+      }</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineplus">+    } catch (e) {</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineplus">+      this.log.error(&quot;onFolderAddedIntoQ: &quot; + e);</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineplus">+      throw(e);</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineplus">+    }</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineplus">+  },</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineplus">+  onFolderRemovedFromQ : function(queue, folder) {</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineplus">+    try {</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineplus">+      if (folder instanceof Components.interfaces.nsIMsgFolder &amp;&amp;</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineplus">+          queue == nsIAutoSyncMgrListener.PriorityQueue) {</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineplus">+        let i = this._inQFolderList.indexOf(folder);</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineplus">+        if (i &gt; -1)</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineplus">+          this._inQFolderList.splice(i, 1);</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineplus">+</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineplus">+        this.log.info(&quot;OnFolderRemovedFromQ [&quot; + this._inQFolderList.length + &quot;] &quot; +</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineplus">+                        folder.prettiestName + &quot; of &quot; + folder.server.prettyName + &quot;\n&quot;);</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineplus">+</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineplus">+        let syncItem = this._syncInfoPerFolder[folder.URI];</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineplus">+        let process = syncItem.activity;</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineplus">+        if (process instanceof Components.interfaces.nsIActivityProcess)</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineplus">+        {</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineplus">+          canceled = (process.state == Components.interfaces.nsIActivityProcess.STATE_CANCELED);</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineplus">+          process.state = Components.interfaces.nsIActivityProcess.STATE_COMPLETED;</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineplus">+</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineplus">+          try {</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineplus">+            this.activityMgr.removeActivity(process.id);</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineplus">+          }</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineplus">+          catch(e) {</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineplus">+            // It is OK to end up here; If the folder is queued and the</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineplus">+            // message get manually downloaded by the user, we might get</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineplus">+            // a folder removed notification even before a donwload</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineplus">+            // started for this folder. This behavior stems from the fact</span>
<a href="#l5.249"></a><span id="l5.249" class="difflineplus">+            // that we add activities into the activity manager in</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineplus">+            // onDownloadStarted notification rather than onFolderAddedIntoQ.</span>
<a href="#l5.251"></a><span id="l5.251" class="difflineplus">+            // This is an expected side effect.</span>
<a href="#l5.252"></a><span id="l5.252" class="difflineplus">+          }</span>
<a href="#l5.253"></a><span id="l5.253" class="difflineplus">+</span>
<a href="#l5.254"></a><span id="l5.254" class="difflineplus">+          // remove the folder/syncItem association from the table</span>
<a href="#l5.255"></a><span id="l5.255" class="difflineplus">+          delete this._syncInfoPerFolder[folder.URI];</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineplus">+        }</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineplus">+</span>
<a href="#l5.258"></a><span id="l5.258" class="difflineplus">+        // if this is the last folder of this server in the queue</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineplus">+        // create a sync event and clean the sync start time</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineplus">+        let found = false;</span>
<a href="#l5.261"></a><span id="l5.261" class="difflineplus">+        for each(let [key, value] in Iterator(this._syncInfoPerFolder))</span>
<a href="#l5.262"></a><span id="l5.262" class="difflineplus">+        {</span>
<a href="#l5.263"></a><span id="l5.263" class="difflineplus">+          if (value.syncFolder.server == folder.server)</span>
<a href="#l5.264"></a><span id="l5.264" class="difflineplus">+          {</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineplus">+            found = true;</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineplus">+            break;</span>
<a href="#l5.267"></a><span id="l5.267" class="difflineplus">+          }</span>
<a href="#l5.268"></a><span id="l5.268" class="difflineplus">+        }</span>
<a href="#l5.269"></a><span id="l5.269" class="difflineplus">+        this.log.info(&quot;Auto_Sync OnFolderRemovedFromQ Last folder of the server: &quot; + !found);</span>
<a href="#l5.270"></a><span id="l5.270" class="difflineplus">+        if (!found) {</span>
<a href="#l5.271"></a><span id="l5.271" class="difflineplus">+          // create an sync event for the completed process if it's not canceled</span>
<a href="#l5.272"></a><span id="l5.272" class="difflineplus">+          if (!canceled)</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineplus">+            this.activityMgr.addActivity(this.createSyncMailEvent(syncItem));</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineplus">+            </span>
<a href="#l5.275"></a><span id="l5.275" class="difflineplus">+          delete this._syncInfoPerServer[folder.server];</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineplus">+        }</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineplus">+      }</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineplus">+    } catch (e) {</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineplus">+      this.log.error(&quot;onFolderRemovedFromQ: &quot; + e);</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineplus">+      throw(e);</span>
<a href="#l5.281"></a><span id="l5.281" class="difflineplus">+    }</span>
<a href="#l5.282"></a><span id="l5.282" class="difflineplus">+  },</span>
<a href="#l5.283"></a><span id="l5.283" class="difflineplus">+  onDownloadStarted : function(folder, numOfMessages, totalPending) {</span>
<a href="#l5.284"></a><span id="l5.284" class="difflineplus">+    try {</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineplus">+      if (folder instanceof Components.interfaces.nsIMsgFolder) {</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineplus">+        this.log.info(&quot;OnDownloadStarted (&quot; + numOfMessages + &quot;/&quot; + totalPending + &quot;): &quot; +</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineplus">+                                folder.prettiestName + &quot; of &quot; + folder.server.prettyName + &quot;\n&quot;);</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineplus">+</span>
<a href="#l5.289"></a><span id="l5.289" class="difflineplus">+        let syncItem = this._syncInfoPerFolder[folder.URI];</span>
<a href="#l5.290"></a><span id="l5.290" class="difflineplus">+        let process = syncItem.activity;</span>
<a href="#l5.291"></a><span id="l5.291" class="difflineplus">+</span>
<a href="#l5.292"></a><span id="l5.292" class="difflineplus">+        // Update the totalPending number. if new messages have been discovered in the folder</span>
<a href="#l5.293"></a><span id="l5.293" class="difflineplus">+        // after we added the folder into the q, totalPending might be greater than what we have</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineplus">+        // initially set</span>
<a href="#l5.295"></a><span id="l5.295" class="difflineplus">+        if (totalPending &gt; syncItem.pendingMsgCount)</span>
<a href="#l5.296"></a><span id="l5.296" class="difflineplus">+          syncItem.pendingMsgCount = totalPending;</span>
<a href="#l5.297"></a><span id="l5.297" class="difflineplus">+</span>
<a href="#l5.298"></a><span id="l5.298" class="difflineplus">+        if (process instanceof Components.interfaces.nsIActivityProcess) {</span>
<a href="#l5.299"></a><span id="l5.299" class="difflineplus">+          // if the process has not beed added to activity manager already, add now</span>
<a href="#l5.300"></a><span id="l5.300" class="difflineplus">+          if (!this.activityMgr.containsActivity(process.id)) {</span>
<a href="#l5.301"></a><span id="l5.301" class="difflineplus">+            this.log.info(&quot;Auto_Sync OnDownloadStarted: No process, adding a new process&quot;);</span>
<a href="#l5.302"></a><span id="l5.302" class="difflineplus">+            this.activityMgr.addActivity(process);</span>
<a href="#l5.303"></a><span id="l5.303" class="difflineplus">+          }</span>
<a href="#l5.304"></a><span id="l5.304" class="difflineplus">+</span>
<a href="#l5.305"></a><span id="l5.305" class="difflineplus">+          syncItem.totalDownloaded += numOfMessages;</span>
<a href="#l5.306"></a><span id="l5.306" class="difflineplus">+</span>
<a href="#l5.307"></a><span id="l5.307" class="difflineplus">+          process.state = Components.interfaces.nsIActivityProcess.STATE_INPROGRESS;</span>
<a href="#l5.308"></a><span id="l5.308" class="difflineplus">+          let percent = (syncItem.totalDownloaded/syncItem.pendingMsgCount)*100;</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineplus">+          if (percent &gt; syncItem.percentComplete)</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineplus">+            syncItem.percentComplete = percent;</span>
<a href="#l5.311"></a><span id="l5.311" class="difflineplus">+</span>
<a href="#l5.312"></a><span id="l5.312" class="difflineplus">+          let msg = this.bundle.formatStringFromName(&quot;autosyncProcessProgress&quot;,</span>
<a href="#l5.313"></a><span id="l5.313" class="difflineplus">+                                                 [syncItem.totalDownloaded,</span>
<a href="#l5.314"></a><span id="l5.314" class="difflineplus">+                                                  syncItem.pendingMsgCount,</span>
<a href="#l5.315"></a><span id="l5.315" class="difflineplus">+                                                  folder.prettiestName], 3);</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineplus">+</span>
<a href="#l5.317"></a><span id="l5.317" class="difflineplus">+          process.setProgress(msg, numOfMessages, totalPending);</span>
<a href="#l5.318"></a><span id="l5.318" class="difflineplus">+</span>
<a href="#l5.319"></a><span id="l5.319" class="difflineplus">+          this._syncInfoPerServer[syncItem.syncFolder.server].totalDownloads += numOfMessages;</span>
<a href="#l5.320"></a><span id="l5.320" class="difflineplus">+        }</span>
<a href="#l5.321"></a><span id="l5.321" class="difflineplus">+      }</span>
<a href="#l5.322"></a><span id="l5.322" class="difflineplus">+    } catch (e) {</span>
<a href="#l5.323"></a><span id="l5.323" class="difflineplus">+      this.log.error(&quot;onDownloadStarted: &quot; + e);</span>
<a href="#l5.324"></a><span id="l5.324" class="difflineplus">+      throw(e);</span>
<a href="#l5.325"></a><span id="l5.325" class="difflineplus">+    }</span>
<a href="#l5.326"></a><span id="l5.326" class="difflineplus">+  },</span>
<a href="#l5.327"></a><span id="l5.327" class="difflineplus">+</span>
<a href="#l5.328"></a><span id="l5.328" class="difflineplus">+  onDownloadCompleted : function(folder) {</span>
<a href="#l5.329"></a><span id="l5.329" class="difflineplus">+    try {</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineplus">+      if (folder instanceof Components.interfaces.nsIMsgFolder) {</span>
<a href="#l5.331"></a><span id="l5.331" class="difflineplus">+        this.log.info(&quot;OnDownloadCompleted: &quot; + folder.prettiestName + &quot; of &quot; +</span>
<a href="#l5.332"></a><span id="l5.332" class="difflineplus">+                      folder.server.prettyName);</span>
<a href="#l5.333"></a><span id="l5.333" class="difflineplus">+</span>
<a href="#l5.334"></a><span id="l5.334" class="difflineplus">+        let process = this._syncInfoPerFolder[folder.URI].activity;</span>
<a href="#l5.335"></a><span id="l5.335" class="difflineplus">+        if (process instanceof Components.interfaces.nsIActivityProcess &amp;&amp;</span>
<a href="#l5.336"></a><span id="l5.336" class="difflineplus">+           !this._running) {</span>
<a href="#l5.337"></a><span id="l5.337" class="difflineplus">+          this.log.info(&quot;OnDownloadCompleted: Auto-Sync Manager is paused, pausing the process&quot;);</span>
<a href="#l5.338"></a><span id="l5.338" class="difflineplus">+          process.state = Components.interfaces.nsIActivityProcess.STATE_PAUSED;</span>
<a href="#l5.339"></a><span id="l5.339" class="difflineplus">+        }</span>
<a href="#l5.340"></a><span id="l5.340" class="difflineplus">+      }</span>
<a href="#l5.341"></a><span id="l5.341" class="difflineplus">+    } catch (e) {</span>
<a href="#l5.342"></a><span id="l5.342" class="difflineplus">+      this.log.error(&quot;onDownloadCompleted: &quot; + e);</span>
<a href="#l5.343"></a><span id="l5.343" class="difflineplus">+      throw(e);</span>
<a href="#l5.344"></a><span id="l5.344" class="difflineplus">+    }</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineplus">+  },</span>
<a href="#l5.346"></a><span id="l5.346" class="difflineplus">+</span>
<a href="#l5.347"></a><span id="l5.347" class="difflineplus">+  onDownloadError : function(folder) {</span>
<a href="#l5.348"></a><span id="l5.348" class="difflineplus">+    if (folder instanceof Components.interfaces.nsIMsgFolder) {</span>
<a href="#l5.349"></a><span id="l5.349" class="difflineplus">+      this.log.error(&quot;OnDownloadError: &quot; + folder.prettiestName + &quot; of &quot; +</span>
<a href="#l5.350"></a><span id="l5.350" class="difflineplus">+                     folder.server.prettyName + &quot;\n&quot;);</span>
<a href="#l5.351"></a><span id="l5.351" class="difflineplus">+    }</span>
<a href="#l5.352"></a><span id="l5.352" class="difflineplus">+  },</span>
<a href="#l5.353"></a><span id="l5.353" class="difflineplus">+</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineplus">+  onDiscoveryQProcessed : function (folder, numOfHdrsProcessed, leftToProcess) {</span>
<a href="#l5.355"></a><span id="l5.355" class="difflineplus">+    this.log.info(&quot;onDiscoveryQProcessed: Processed &quot; + numOfHdrsProcessed + &quot;/&quot; +</span>
<a href="#l5.356"></a><span id="l5.356" class="difflineplus">+                  (leftToProcess+numOfHdrsProcessed) + &quot; of &quot; + folder.prettiestName + &quot;\n&quot;);</span>
<a href="#l5.357"></a><span id="l5.357" class="difflineplus">+  },</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineplus">+</span>
<a href="#l5.359"></a><span id="l5.359" class="difflineplus">+  onAutoSyncInitiated : function (folder) {</span>
<a href="#l5.360"></a><span id="l5.360" class="difflineplus">+      this.log.info(&quot;onAutoSyncInitiated: &quot; + folder.prettiestName + &quot; of &quot; +</span>
<a href="#l5.361"></a><span id="l5.361" class="difflineplus">+                    folder.server.prettyName + &quot; has been updated.\n&quot;);</span>
<a href="#l5.362"></a><span id="l5.362" class="difflineplus">+  },</span>
<a href="#l5.363"></a><span id="l5.363" class="difflineplus">+</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineplus">+  getFolderListString : function() {</span>
<a href="#l5.365"></a><span id="l5.365" class="difflineplus">+    let folderList;</span>
<a href="#l5.366"></a><span id="l5.366" class="difflineplus">+    if (this._inQFolderList.length &gt; 0)</span>
<a href="#l5.367"></a><span id="l5.367" class="difflineplus">+      folderList = this._inQFolderList[0].prettiestName;</span>
<a href="#l5.368"></a><span id="l5.368" class="difflineplus">+</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineplus">+    for (let i = 1; i &lt; this._inQFolderList.length; i++)</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineplus">+      folderList = folderList + &quot;, &quot; + this._inQFolderList[i].prettiestName;</span>
<a href="#l5.371"></a><span id="l5.371" class="difflineplus">+</span>
<a href="#l5.372"></a><span id="l5.372" class="difflineplus">+    return folderList;</span>
<a href="#l5.373"></a><span id="l5.373" class="difflineplus">+  },</span>
<a href="#l5.374"></a><span id="l5.374" class="difflineplus">+</span>
<a href="#l5.375"></a><span id="l5.375" class="difflineplus">+  getAccountListString : function() {</span>
<a href="#l5.376"></a><span id="l5.376" class="difflineplus">+    let accountList;</span>
<a href="#l5.377"></a><span id="l5.377" class="difflineplus">+    if (this._inQFolderList.length &gt; 0)</span>
<a href="#l5.378"></a><span id="l5.378" class="difflineplus">+      accountList = this._inQFolderList[0].server.prettyName;</span>
<a href="#l5.379"></a><span id="l5.379" class="difflineplus">+</span>
<a href="#l5.380"></a><span id="l5.380" class="difflineplus">+    for (let i = 1; i &lt; this._inQFolderList.length; i++) {</span>
<a href="#l5.381"></a><span id="l5.381" class="difflineplus">+      // do not include already existing account names</span>
<a href="#l5.382"></a><span id="l5.382" class="difflineplus">+      if (accountList.search(this._inQFolderList[i].server.prettyName) == -1)</span>
<a href="#l5.383"></a><span id="l5.383" class="difflineplus">+        accountList = accountList + &quot;, &quot; + this._inQFolderList[i].server.prettyName;</span>
<a href="#l5.384"></a><span id="l5.384" class="difflineplus">+    }</span>
<a href="#l5.385"></a><span id="l5.385" class="difflineplus">+    return accountList;</span>
<a href="#l5.386"></a><span id="l5.386" class="difflineplus">+  },</span>
<a href="#l5.387"></a><span id="l5.387" class="difflineplus">+</span>
<a href="#l5.388"></a><span id="l5.388" class="difflineplus">+  init: function() {</span>
<a href="#l5.389"></a><span id="l5.389" class="difflineplus">+    // XXX when do we need to remove ourselves?</span>
<a href="#l5.390"></a><span id="l5.390" class="difflineplus">+    this.log.info('initing');</span>
<a href="#l5.391"></a><span id="l5.391" class="difflineplus">+    Components.classes[&quot;@mozilla.org/imap/autosyncmgr;1&quot;]</span>
<a href="#l5.392"></a><span id="l5.392" class="difflineplus">+      .getService(Components.interfaces.nsIAutoSyncManager).addListener(this);</span>
<a href="#l5.393"></a><span id="l5.393" class="difflineplus">+  },</span>
<a href="#l5.394"></a><span id="l5.394" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/activity/modules/moveCopy.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/activity/modules/moveCopy.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -172,16 +172,19 @@ let moveCopyModule =</span>
<a href="#l6.4"></a><span id="l6.4">         event.addSubject(msgHdr.messageId);</span>
<a href="#l6.5"></a><span id="l6.5">       }</span>
<a href="#l6.6"></a><span id="l6.6">       this.activityMgr.addActivity(event);</span>
<a href="#l6.7"></a><span id="l6.7">     } catch (e) {</span>
<a href="#l6.8"></a><span id="l6.8">       this.log.error(&quot;Exception: &quot; + e)</span>
<a href="#l6.9"></a><span id="l6.9">     }</span>
<a href="#l6.10"></a><span id="l6.10">   },</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+  folderAdded: function(aFolder) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  },</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15">   folderDeleted : function(aFolder) {</span>
<a href="#l6.16"></a><span id="l6.16">     let displayText = this.getString(&quot;deletedFolder&quot;).replace(&quot;#1&quot;, aFolder.prettiestName);</span>
<a href="#l6.17"></a><span id="l6.17">     let statusText = aFolder.server.prettyName;</span>
<a href="#l6.18"></a><span id="l6.18">     </span>
<a href="#l6.19"></a><span id="l6.19">     // create an activity event</span>
<a href="#l6.20"></a><span id="l6.20">     let event = new nsActEvent(displayText,</span>
<a href="#l6.21"></a><span id="l6.21">                                aFolder.server,</span>
<a href="#l6.22"></a><span id="l6.22">                                statusText,</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineat">@@ -244,14 +247,19 @@ let moveCopyModule =</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25">   itemEvent: function(aItem, aEvent, aData) {</span>
<a href="#l6.26"></a><span id="l6.26">   },</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28">   init: function() {</span>
<a href="#l6.29"></a><span id="l6.29">     // XXX when do we need to remove ourselves?</span>
<a href="#l6.30"></a><span id="l6.30">     let notificationService = Components.classes[&quot;@mozilla.org/messenger/msgnotificationservice;1&quot;]</span>
<a href="#l6.31"></a><span id="l6.31">                                  .getService(Components.interfaces.nsIMsgFolderNotificationService);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-    notificationService.addListener(this, notificationService.all);</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+    notificationService.addListener(this,</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+                                    notificationService.msgsDeleted |</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+                                    notificationService.msgsMoveCopyCompleted |</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+                                    notificationService.folderDeleted |</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+                                    notificationService.folderMoveCopyCompleted |</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+                                    notificationService.folderRenamed);</span>
<a href="#l6.39"></a><span id="l6.39">   }</span>
<a href="#l6.40"></a><span id="l6.40"> }</span>
<a href="#l6.41"></a><span id="l6.41"> </span>
<a href="#l6.42"></a><span id="l6.42"> </span>
<a href="#l6.43"></a><span id="l6.43"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/compose/content/messengercompose.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/compose/content/messengercompose.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -228,16 +228,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">   &lt;key id=&quot;key_checkspelling&quot; key=&quot;&amp;checkSpellingCmd2.key;&quot; command=&quot;cmd_spelling&quot; modifiers=&quot;accel,shift&quot;/&gt;</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> #ifdef XP_WIN</span>
<a href="#l7.7"></a><span id="l7.7">   &lt;key keycode=&quot;&amp;checkSpellingCmd2.key2;&quot; command=&quot;cmd_spelling&quot;/&gt;</span>
<a href="#l7.8"></a><span id="l7.8"> #endif</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">    &lt;!-- Tools Menu --&gt;</span>
<a href="#l7.11"></a><span id="l7.11">   &lt;key id=&quot;key_mail&quot;  key=&quot;&amp;messengerCmd.commandkey;&quot; oncommand=&quot;toMessengerWindow();&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  &lt;key id=&quot;key_addressbook&quot;  key=&quot;&amp;addressBookCmd.commandkey;&quot; oncommand=&quot;toAddressBook();&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l7.13"></a><span id="l7.13"> </span>
<a href="#l7.14"></a><span id="l7.14">   &lt;!-- Tab/F6 Keys --&gt;</span>
<a href="#l7.15"></a><span id="l7.15">   &lt;key keycode=&quot;VK_TAB&quot; oncommand=&quot;SwitchElementFocus(event);&quot; modifiers=&quot;control&quot;/&gt;</span>
<a href="#l7.16"></a><span id="l7.16">   &lt;key keycode=&quot;VK_TAB&quot; oncommand=&quot;SwitchElementFocus(event);&quot; modifiers=&quot;control,shift&quot;/&gt;</span>
<a href="#l7.17"></a><span id="l7.17">   &lt;key keycode=&quot;VK_F6&quot; oncommand=&quot;SwitchElementFocus(event);&quot; modifiers=&quot;control&quot;/&gt;</span>
<a href="#l7.18"></a><span id="l7.18">   &lt;key keycode=&quot;VK_F6&quot; oncommand=&quot;SwitchElementFocus(event);&quot; modifiers=&quot;control,shift&quot;/&gt;</span>
<a href="#l7.19"></a><span id="l7.19">   &lt;key keycode=&quot;VK_F6&quot; oncommand=&quot;SwitchElementFocus(event);&quot; modifiers=&quot;shift&quot;/&gt;</span>
<a href="#l7.20"></a><span id="l7.20">   &lt;key keycode=&quot;VK_F6&quot; oncommand=&quot;SwitchElementFocus(event);&quot;/&gt;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -481,21 +482,17 @@</span>
<a href="#l7.22"></a><span id="l7.22">         &lt;/menupopup&gt;</span>
<a href="#l7.23"></a><span id="l7.23">       &lt;/menu&gt;</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25">       &lt;menu id=&quot;tasksMenu&quot; label=&quot;&amp;tasksMenu.label;&quot; accesskey=&quot;&amp;tasksMenu.accesskey;&quot;&gt;</span>
<a href="#l7.26"></a><span id="l7.26">           &lt;menupopup id=&quot;taskPopup&quot;&gt;</span>
<a href="#l7.27"></a><span id="l7.27">             &lt;!-- Moving the first two items to the Window menu on the Mac --&gt;</span>
<a href="#l7.28"></a><span id="l7.28"> #ifndef XP_MACOSX</span>
<a href="#l7.29"></a><span id="l7.29">             &lt;menuitem accesskey=&quot;&amp;messengerCmd.accesskey;&quot; label=&quot;&amp;messengerCmd.label;&quot;  key=&quot;key_mail&quot; oncommand=&quot;toMessengerWindow();&quot; id=&quot;tasksMenuMail&quot; class=&quot;menuitem-iconic icon-mail16 menu-iconic&quot;/&gt;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-            &lt;menuitem id=&quot;tasksMenuAddressBook&quot;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-                      label=&quot;&amp;addressBookCmd.label;&quot;</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-                      accesskey=&quot;&amp;addressBookCmd.accesskey;&quot;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-                      oncommand=&quot;toAddressBook();&quot;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-                      class=&quot;menuitem-iconic icon-addressbook16 menu-iconic&quot;/&gt;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+            &lt;menuitem label=&quot;&amp;addressBookCmd.label;&quot; accesskey=&quot;&amp;addressBookCmd.accesskey;&quot; key=&quot;key_addressbook&quot; oncommand=&quot;toAddressBook();&quot; id=&quot;tasksMenuAddressBook&quot; class=&quot;menuitem-iconic icon-addressbook16 menu-iconic&quot;/&gt;</span>
<a href="#l7.36"></a><span id="l7.36"> #endif</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38"> #ifndef XP_UNIX</span>
<a href="#l7.39"></a><span id="l7.39">             &lt;menuseparator id=&quot;prefSep&quot;/&gt;</span>
<a href="#l7.40"></a><span id="l7.40">             &lt;menuitem label=&quot;&amp;accountManagerCmd.label;&quot; accesskey=&quot;&amp;accountManagerCmd.accesskey;&quot; command=&quot;cmd_account&quot;/&gt;</span>
<a href="#l7.41"></a><span id="l7.41">             &lt;menuitem id=&quot;menu_preferences&quot; label=&quot;&amp;preferencesCmd.label;&quot; accesskey=&quot;&amp;preferencesCmd.accesskey;&quot;</span>
<a href="#l7.42"></a><span id="l7.42">                       oncommand=&quot;openOptionsDialog('paneCompose');&quot;/&gt;</span>
<a href="#l7.43"></a><span id="l7.43"> #else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -157,16 +157,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> &lt;!-- Tools Menu --&gt;</span>
<a href="#l8.5"></a><span id="l8.5"> &lt;!ENTITY tasksMenu.label &quot;Tools&quot;&gt;</span>
<a href="#l8.6"></a><span id="l8.6"> &lt;!ENTITY tasksMenu.accesskey &quot;T&quot;&gt;</span>
<a href="#l8.7"></a><span id="l8.7"> &lt;!ENTITY messengerCmd.label &quot;Mail &amp;amp; Newsgroups&quot;&gt;</span>
<a href="#l8.8"></a><span id="l8.8"> &lt;!ENTITY messengerCmd.accesskey &quot;m&quot;&gt;</span>
<a href="#l8.9"></a><span id="l8.9"> &lt;!ENTITY messengerCmd.commandkey &quot;1&quot;&gt;</span>
<a href="#l8.10"></a><span id="l8.10"> &lt;!ENTITY addressBookCmd.label &quot;Address Book&quot;&gt;</span>
<a href="#l8.11"></a><span id="l8.11"> &lt;!ENTITY addressBookCmd.accesskey &quot;a&quot;&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+&lt;!ENTITY addressBookCmd.commandkey &quot;2&quot;&gt;</span>
<a href="#l8.13"></a><span id="l8.13"> &lt;!ENTITY accountManagerCmd.label &quot;Account Settings&quot;&gt;</span>
<a href="#l8.14"></a><span id="l8.14"> &lt;!ENTITY accountManagerCmd.accesskey &quot;c&quot;&gt;</span>
<a href="#l8.15"></a><span id="l8.15"> &lt;!ENTITY accountManagerCmdUnix.accesskey &quot;S&quot;&gt;</span>
<a href="#l8.16"></a><span id="l8.16"> &lt;!ENTITY preferencesCmd.label &quot;Options&quot;&gt;</span>
<a href="#l8.17"></a><span id="l8.17"> &lt;!ENTITY preferencesCmd.accesskey &quot;O&quot;&gt;</span>
<a href="#l8.18"></a><span id="l8.18"> &lt;!ENTITY preferencesCmdUnix.label       &quot;Preferences&quot;&gt;</span>
<a href="#l8.19"></a><span id="l8.19"> &lt;!ENTITY preferencesCmdUnix.accesskey   &quot;n&quot;&gt; </span>
<a href="#l8.20"></a><span id="l8.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/themes/qute/jar.mn</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/themes/qute/jar.mn</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -27,16 +27,31 @@ classic.jar:</span>
<a href="#l9.4"></a><span id="l9.4">   skin/classic/messenger/dialogs.css                          (mail/dialogs.css)</span>
<a href="#l9.5"></a><span id="l9.5">   skin/classic/messenger/newmailalert.css                     (mail/newmailalert.css)</span>
<a href="#l9.6"></a><span id="l9.6"> * skin/classic/messenger/tabmailBindings.xml                  (mail/tabmailBindings.xml)</span>
<a href="#l9.7"></a><span id="l9.7">   skin/classic/messenger/tabmail.css                          (mail/tabmail.css)</span>
<a href="#l9.8"></a><span id="l9.8">   skin/classic/messenger/editContactOverlay.css               (mail/editContactOverlay.css)</span>
<a href="#l9.9"></a><span id="l9.9">   skin/classic/messenger/starred48.png                        (mail/starred48.png)</span>
<a href="#l9.10"></a><span id="l9.10">   skin/classic/messenger/contactStarred.png                   (mail/contactStarred.png)</span>
<a href="#l9.11"></a><span id="l9.11">   skin/classic/messenger/starContact.png                      (mail/starContact.png)</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+  skin/classic/messenger/activity/activity.css                   (mail/activity/activity.css)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  skin/classic/messenger/activity/buttons.png                    (mail/activity/buttons.png)  </span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  skin/classic/messenger/activity/defaultProcessIcon.png         (mail/activity/defaultProcessIcon.png)</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+  skin/classic/messenger/activity/defaultEventIcon.png           (mail/activity/defaultEventIcon.png)</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+  skin/classic/messenger/activity/defaultWarningIcon.png         (mail/activity/defaultWarningIcon.png)</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+  skin/classic/messenger/activity/undoIcon.png                   (mail/activity/undoIcon.png)</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+  skin/classic/messenger/activity/syncMailIcon.png               (mail/activity/syncMailIcon.png)</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+  skin/classic/messenger/activity/sendMailIcon.png               (mail/activity/sendMailIcon.png)</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+  skin/classic/messenger/activity/removeItemIcon.png             (mail/activity/removeItemIcon.png)</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+  skin/classic/messenger/activity/addItemIcon.png                (mail/activity/addItemIcon.png)</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+  skin/classic/messenger/activity/moveMailIcon.png               (mail/activity/moveMailIcon.png)</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+  skin/classic/messenger/activity/copyMailIcon.png               (mail/activity/copyMailIcon.png)</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+  skin/classic/messenger/activity/deleteMailIcon.png             (mail/activity/deleteMailIcon.png)</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+  skin/classic/messenger/activity/compactMailIcon.png            (mail/activity/compactMailIcon.png)</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  skin/classic/messenger/activity/indexMailIcon.png              (mail/activity/indexMailIcon.png)</span>
<a href="#l9.27"></a><span id="l9.27">   skin/classic/messenger/addressbook/addressbook.css          (mail/addrbook/addressbook.css)</span>
<a href="#l9.28"></a><span id="l9.28">   skin/classic/messenger/addressbook/abContactsPanel.css      (mail/addrbook/abContactsPanel.css)</span>
<a href="#l9.29"></a><span id="l9.29">   skin/classic/messenger/addressbook/cardDialog.css           (mail/addrbook/cardDialog.css)</span>
<a href="#l9.30"></a><span id="l9.30">   skin/classic/messenger/addressbook/abResultsPane.css        (mail/addrbook/abResultsPane.css)</span>
<a href="#l9.31"></a><span id="l9.31">   skin/classic/messenger/addressbook/icons/abcard.png         (mail/addrbook/abcard.png)</span>
<a href="#l9.32"></a><span id="l9.32">   skin/classic/messenger/addressbook/icons/addrbook.png       (mail/addrbook/addrbook.png)</span>
<a href="#l9.33"></a><span id="l9.33">   skin/classic/messenger/addressbook/icons/ablist.png         (mail/addrbook/ablist.png)</span>
<a href="#l9.34"></a><span id="l9.34">   skin/classic/messenger/addressbook/icons/addressbook-toolbar.png         (mail/addrbook/addressbook-toolbar.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/mail/themes/qute/mail/activity/activity.css</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,359 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ *</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+ *</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+ * License.</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+ *</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+ * The Original Code is mozilla.org code.</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+ *</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+ * Netscape Communications Corporation.</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+ *</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+ *   David Ascher &lt;dascher@mozillamessaging.com&gt;</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+ *   Emre Birol &lt;ebirol@gmail.com&gt;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+ *</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+ *</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+.activityview {</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+  margin: 0;</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+  padding: 0;</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+  border-width: 0;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+}</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+#search {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+  -moz-box-pack: end;</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+  padding-top: 4px;</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+  padding-right: 4px;</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+  padding-bottom: 4px;</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+  background-image: url(&quot;chrome://global/skin/toolbar/toolbar-background.gif&quot;);</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+  background-color: #9f9f9f;</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+  background-repeat: repeat-x;</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+  background-position: top left;</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+}</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+#activityManager:not([active=&quot;true&quot;]) #search {</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+  background-image: url(&quot;chrome://global/skin/toolbar/toolbar-background-inactive.png&quot;);</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+  background-color: #cfcfcf;</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+}</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+#activityManager:not([active=&quot;true&quot;]) #search &gt; * {</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+  opacity: 0.7;</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+}</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+#clearListButton {</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+  border: 1px solid #5F5F5F;</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+  -moz-border-radius: 4px;</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+  background: url(chrome://global/skin/icons/white-gray-gradient.gif) #A09E9D repeat-x top center;</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+  min-height: 0;</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+  min-width: 0;</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+  padding: 2px;</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+  margin: 0 6px;</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+}</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+#clearListButton:hover:active:not([disabled=&quot;true&quot;]) {</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+  background: url(chrome://global/skin/icons/white-gray-gradient-active.gif);</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+}</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+/**</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+ * Images for buttons in the interface</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+ */</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+activity-process button {</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/buttons.png);</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+}</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+.cancel {</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+  -moz-image-region: rect(0px, 16px, 16px, 0px);</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+}</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+.cancel:hover {</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+  -moz-image-region: rect(0px, 32px, 16px, 16px);</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+}</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+.cancel:hover:active {</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+  -moz-image-region: rect(0px, 48px, 16px, 32px);</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+}</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+.pause {</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+  -moz-image-region: rect(48px, 16px, 64px, 0px);</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+}</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+.pause:hover {</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+  -moz-image-region: rect(48px, 32px, 64px, 16px);</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+}</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+.pause:not([disabled=&quot;true&quot;]):hover:active {</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+  -moz-image-region: rect(48px, 48px, 64px, 32px);</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+}</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+.pause[disabled=&quot;true&quot;] {</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+  -moz-image-region: rect(48px, 16px, 64px, 0px);</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+}</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+.resume {</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineplus">+  -moz-image-region: rect(16px, 16px, 32px, 0px);</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+}</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+.resume:hover {</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+  -moz-image-region: rect(16px, 32px, 32px, 16px);</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineplus">+}</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+.resume:hover:active {</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+  -moz-image-region: rect(16px, 48px, 32px, 32px);</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+}</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineplus">+.retry {</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineplus">+  -moz-image-region: rect(32px, 16px, 48px, 0px);</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+  display: none;</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineplus">+}</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineplus">+.retry:hover {</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineplus">+  -moz-image-region: rect(32px, 32px, 48px, 16px);</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineplus">+}</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+.retry:hover:active {</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineplus">+  -moz-image-region: rect(32px, 48px, 48px, 32px);</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineplus">+}</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineplus">+.retry[enabled=&quot;true&quot;] {</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineplus">+  display: inline;</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineplus">+}</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineplus">+.blockedIcon {</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineplus">+  list-style-image: url(chrome://global/skin/icons/Error.png);</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+}</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineplus">+</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineplus">+activity-process button {</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineplus">+  min-height: 16px;</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+  min-width: 16px;</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineplus">+  max-height: 16px;</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+  max-width: 16px;</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineplus">+  padding: 0;</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineplus">+  margin: 0 1px 0 1px;</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+}</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineplus">+</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineplus">+activity-event button {</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/buttons.png);</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineplus">+}</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineplus">+.undo {</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineplus">+  -moz-image-region: rect(32px, 16px, 48px, 0px);</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineplus">+}</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineplus">+.undo:hover {</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineplus">+  -moz-image-region: rect(32px, 32px, 48px, 16px);</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineplus">+}</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineplus">+.undo:hover:active {</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineplus">+  -moz-image-region: rect(32px, 48px, 48px, 32px);</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineplus">+}</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineplus">+</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineplus">+activity-event button {</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineplus">+  min-height: 16px;</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineplus">+  min-width: 16px;</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineplus">+  max-height: 16px;</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineplus">+  max-width: 16px;</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineplus">+  padding: 0;</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineplus">+  margin: 0 1px 0 1px;</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineplus">+}</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineplus">+</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineplus">+activity-warning button {</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/buttons.png);</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineplus">+}</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineplus">+.recover {</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+  -moz-image-region: rect(32px, 16px, 48px, 0px);</span>
<a href="#l10.181"></a><span id="l10.181" class="difflineplus">+}</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineplus">+.recover:hover {</span>
<a href="#l10.183"></a><span id="l10.183" class="difflineplus">+  -moz-image-region: rect(32px, 32px, 48px, 16px);</span>
<a href="#l10.184"></a><span id="l10.184" class="difflineplus">+}</span>
<a href="#l10.185"></a><span id="l10.185" class="difflineplus">+.recover:hover:active {</span>
<a href="#l10.186"></a><span id="l10.186" class="difflineplus">+  -moz-image-region: rect(32px, 48px, 48px, 32px);</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineplus">+}</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineplus">+</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineplus">+activity-warning button {</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l10.191"></a><span id="l10.191" class="difflineplus">+  min-height: 16px;</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineplus">+  min-width: 16px;</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineplus">+  max-height: 16px;</span>
<a href="#l10.194"></a><span id="l10.194" class="difflineplus">+  max-width: 16px;</span>
<a href="#l10.195"></a><span id="l10.195" class="difflineplus">+  padding: 0;</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineplus">+  margin: 0 1px 0 1px;</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineplus">+}</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineplus">+</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineplus">+.activitygroupbox activity-event,</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineplus">+.activitygroupbox activity-warning,</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineplus">+.activitygroupbox activity-process {</span>
<a href="#l10.202"></a><span id="l10.202" class="difflineplus">+  padding-left: 2em;</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineplus">+}</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineplus">+</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineplus">+activity-group button {</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/buttons.png);</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineplus">+}</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineplus">+.retry {</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineplus">+  -moz-image-region: rect(32px, 16px, 48px, 0px);</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineplus">+}</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineplus">+.retry:hover {</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineplus">+  -moz-image-region: rect(32px, 32px, 48px, 16px);</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineplus">+}</span>
<a href="#l10.214"></a><span id="l10.214" class="difflineplus">+.retry:hover:active {</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineplus">+  -moz-image-region: rect(32px, 48px, 48px, 32px);</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineplus">+}</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineplus">+</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineplus">+activity-group button {</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineplus">+  min-height: 16px;</span>
<a href="#l10.221"></a><span id="l10.221" class="difflineplus">+  min-width: 16px;</span>
<a href="#l10.222"></a><span id="l10.222" class="difflineplus">+  max-height: 16px;</span>
<a href="#l10.223"></a><span id="l10.223" class="difflineplus">+  max-width: 16px;</span>
<a href="#l10.224"></a><span id="l10.224" class="difflineplus">+  padding: 0;</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineplus">+  margin: 0 1px 0 1px;</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineplus">+}</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineplus">+</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineplus">+/* Specialized Activity Bindings */</span>
<a href="#l10.229"></a><span id="l10.229" class="difflineplus">+</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineplus">+activity-process {</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineplus">+  padding: 3px 8px;</span>
<a href="#l10.232"></a><span id="l10.232" class="difflineplus">+  min-height: 40px !important;</span>
<a href="#l10.233"></a><span id="l10.233" class="difflineplus">+}</span>
<a href="#l10.234"></a><span id="l10.234" class="difflineplus">+</span>
<a href="#l10.235"></a><span id="l10.235" class="difflineplus">+activity-event[selected=&quot;true&quot;] {</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineplus">+}</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineplus">+</span>
<a href="#l10.238"></a><span id="l10.238" class="difflineplus">+activity-process .statusText {</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineplus">+  font-size: smaller;</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineplus">+  color: #555;</span>
<a href="#l10.241"></a><span id="l10.241" class="difflineplus">+}</span>
<a href="#l10.242"></a><span id="l10.242" class="difflineplus">+</span>
<a href="#l10.243"></a><span id="l10.243" class="difflineplus">+activity-event .dateTime,</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineplus">+activity-event .statusText {</span>
<a href="#l10.245"></a><span id="l10.245" class="difflineplus">+  font-size: smaller;</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineplus">+  color: #555;</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineplus">+}</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineplus">+</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineplus">+activity-warning .dateTime,</span>
<a href="#l10.250"></a><span id="l10.250" class="difflineplus">+activity-warning .statusText {</span>
<a href="#l10.251"></a><span id="l10.251" class="difflineplus">+  font-size: smaller;</span>
<a href="#l10.252"></a><span id="l10.252" class="difflineplus">+  color: #555;</span>
<a href="#l10.253"></a><span id="l10.253" class="difflineplus">+}</span>
<a href="#l10.254"></a><span id="l10.254" class="difflineplus">+</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineplus">+</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineplus">+.processIconBox image {</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/defaultProcessIcon.png);</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineplus">+}</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineplus">+</span>
<a href="#l10.260"></a><span id="l10.260" class="difflineplus">+.eventIconBox image {</span>
<a href="#l10.261"></a><span id="l10.261" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/defaultEventIcon.png);</span>
<a href="#l10.262"></a><span id="l10.262" class="difflineplus">+}</span>
<a href="#l10.263"></a><span id="l10.263" class="difflineplus">+</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineplus">+.warningIconBox image {</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/defaultWarningIcon.png);</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineplus">+}</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineplus">+</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineplus">+image.syncMail {</span>
<a href="#l10.269"></a><span id="l10.269" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/syncMailIcon.png);</span>
<a href="#l10.270"></a><span id="l10.270" class="difflineplus">+}</span>
<a href="#l10.271"></a><span id="l10.271" class="difflineplus">+</span>
<a href="#l10.272"></a><span id="l10.272" class="difflineplus">+image.sendMail {</span>
<a href="#l10.273"></a><span id="l10.273" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/sendMailIcon.png);</span>
<a href="#l10.274"></a><span id="l10.274" class="difflineplus">+}</span>
<a href="#l10.275"></a><span id="l10.275" class="difflineplus">+</span>
<a href="#l10.276"></a><span id="l10.276" class="difflineplus">+image.copyMail {</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/copyMailIcon.png);</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineplus">+}</span>
<a href="#l10.279"></a><span id="l10.279" class="difflineplus">+</span>
<a href="#l10.280"></a><span id="l10.280" class="difflineplus">+image.moveMail {</span>
<a href="#l10.281"></a><span id="l10.281" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/moveMailIcon.png);</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineplus">+}</span>
<a href="#l10.283"></a><span id="l10.283" class="difflineplus">+</span>
<a href="#l10.284"></a><span id="l10.284" class="difflineplus">+image.deleteMail {</span>
<a href="#l10.285"></a><span id="l10.285" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/deleteMailIcon.png);</span>
<a href="#l10.286"></a><span id="l10.286" class="difflineplus">+}</span>
<a href="#l10.287"></a><span id="l10.287" class="difflineplus">+</span>
<a href="#l10.288"></a><span id="l10.288" class="difflineplus">+image.addItem {</span>
<a href="#l10.289"></a><span id="l10.289" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/addItemIcon.png);</span>
<a href="#l10.290"></a><span id="l10.290" class="difflineplus">+}</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineplus">+</span>
<a href="#l10.292"></a><span id="l10.292" class="difflineplus">+image.removeItem {</span>
<a href="#l10.293"></a><span id="l10.293" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/removeItemIcon.png);</span>
<a href="#l10.294"></a><span id="l10.294" class="difflineplus">+}</span>
<a href="#l10.295"></a><span id="l10.295" class="difflineplus">+</span>
<a href="#l10.296"></a><span id="l10.296" class="difflineplus">+image.undo {</span>
<a href="#l10.297"></a><span id="l10.297" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/undoIcon.png);</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineplus">+}</span>
<a href="#l10.299"></a><span id="l10.299" class="difflineplus">+</span>
<a href="#l10.300"></a><span id="l10.300" class="difflineplus">+image.indexMail {</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/indexMailIcon.png);</span>
<a href="#l10.302"></a><span id="l10.302" class="difflineplus">+}</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineplus">+</span>
<a href="#l10.304"></a><span id="l10.304" class="difflineplus">+image.compactMail {</span>
<a href="#l10.305"></a><span id="l10.305" class="difflineplus">+  list-style-image: url(chrome://messenger/skin/activity/compactMailIcon.png);</span>
<a href="#l10.306"></a><span id="l10.306" class="difflineplus">+}</span>
<a href="#l10.307"></a><span id="l10.307" class="difflineplus">+</span>
<a href="#l10.308"></a><span id="l10.308" class="difflineplus">+/* prevent flickering when changing states */</span>
<a href="#l10.309"></a><span id="l10.309" class="difflineplus">+.activityTypeIcon {</span>
<a href="#l10.310"></a><span id="l10.310" class="difflineplus">+  min-height: 32px;</span>
<a href="#l10.311"></a><span id="l10.311" class="difflineplus">+  min-width: 32px;</span>
<a href="#l10.312"></a><span id="l10.312" class="difflineplus">+  -moz-padding-end: 2px;</span>
<a href="#l10.313"></a><span id="l10.313" class="difflineplus">+}</span>
<a href="#l10.314"></a><span id="l10.314" class="difflineplus">+</span>
<a href="#l10.315"></a><span id="l10.315" class="difflineplus">+</span>
<a href="#l10.316"></a><span id="l10.316" class="difflineplus">+/* these are copied from richlistbox.css, to give us a starting point on selection */</span>
<a href="#l10.317"></a><span id="l10.317" class="difflineplus">+</span>
<a href="#l10.318"></a><span id="l10.318" class="difflineplus">+activity-process, activity-warning, activity-event {</span>
<a href="#l10.319"></a><span id="l10.319" class="difflineplus">+  padding: 2px 4px;</span>
<a href="#l10.320"></a><span id="l10.320" class="difflineplus">+  background-color: -moz-Field;</span>
<a href="#l10.321"></a><span id="l10.321" class="difflineplus">+  color: -moz-FieldText;</span>
<a href="#l10.322"></a><span id="l10.322" class="difflineplus">+}</span>
<a href="#l10.323"></a><span id="l10.323" class="difflineplus">+</span>
<a href="#l10.324"></a><span id="l10.324" class="difflineplus">+activity-event[selected=&quot;true&quot;],activity-warning[selected=&quot;true&quot;],activity-process[selected=&quot;true&quot;]{</span>
<a href="#l10.325"></a><span id="l10.325" class="difflineplus">+  background-color: -moz-Dialog;</span>
<a href="#l10.326"></a><span id="l10.326" class="difflineplus">+  color: -moz-DialogText;</span>
<a href="#l10.327"></a><span id="l10.327" class="difflineplus">+}</span>
<a href="#l10.328"></a><span id="l10.328" class="difflineplus">+</span>
<a href="#l10.329"></a><span id="l10.329" class="difflineplus">+richlistbox.activitygroupbox:focus activity-process[selected=&quot;true&quot;]{</span>
<a href="#l10.330"></a><span id="l10.330" class="difflineplus">+  background-color: Highlight;</span>
<a href="#l10.331"></a><span id="l10.331" class="difflineplus">+  color: Highlight;</span>
<a href="#l10.332"></a><span id="l10.332" class="difflineplus">+}</span>
<a href="#l10.333"></a><span id="l10.333" class="difflineplus">+</span>
<a href="#l10.334"></a><span id="l10.334" class="difflineplus">+richlistbox:focus activity-event[selected=&quot;true&quot;],activity-warning[selected=&quot;true&quot;]{</span>
<a href="#l10.335"></a><span id="l10.335" class="difflineplus">+  background-color: Highlight;</span>
<a href="#l10.336"></a><span id="l10.336" class="difflineplus">+  color: Highlight;</span>
<a href="#l10.337"></a><span id="l10.337" class="difflineplus">+}</span>
<a href="#l10.338"></a><span id="l10.338" class="difflineplus">+</span>
<a href="#l10.339"></a><span id="l10.339" class="difflineplus">+richlistbox:focus activity-group[selected=&quot;true&quot;] {</span>
<a href="#l10.340"></a><span id="l10.340" class="difflineplus">+  background-color: Highlight;</span>
<a href="#l10.341"></a><span id="l10.341" class="difflineplus">+}</span>
<a href="#l10.342"></a><span id="l10.342" class="difflineplus">+</span>
<a href="#l10.343"></a><span id="l10.343" class="difflineplus">+</span>
<a href="#l10.344"></a><span id="l10.344" class="difflineplus">+richlistbox.activitygroupbox:focus activity-process[selected=&quot;true&quot;] .statusText,</span>
<a href="#l10.345"></a><span id="l10.345" class="difflineplus">+richlistbox.activitygroupbox:focus activity-process[selected=&quot;true&quot;] .dateTime,</span>
<a href="#l10.346"></a><span id="l10.346" class="difflineplus">+richlistbox.activitygroupbox:focus activity-process[selected=&quot;true&quot;] .displayText {</span>
<a href="#l10.347"></a><span id="l10.347" class="difflineplus">+  color: HighlightText;</span>
<a href="#l10.348"></a><span id="l10.348" class="difflineplus">+}</span>
<a href="#l10.349"></a><span id="l10.349" class="difflineplus">+</span>
<a href="#l10.350"></a><span id="l10.350" class="difflineplus">+richlistbox:focus activity-event[selected=&quot;true&quot;] .completionTime,</span>
<a href="#l10.351"></a><span id="l10.351" class="difflineplus">+richlistbox:focus activity-event[selected=&quot;true&quot;] .displayText,</span>
<a href="#l10.352"></a><span id="l10.352" class="difflineplus">+richlistbox:focus activity-event[selected=&quot;true&quot;] .dateTime,</span>
<a href="#l10.353"></a><span id="l10.353" class="difflineplus">+richlistbox:focus activity-event[selected=&quot;true&quot;] .statusText {</span>
<a href="#l10.354"></a><span id="l10.354" class="difflineplus">+  color: HighlightText;</span>
<a href="#l10.355"></a><span id="l10.355" class="difflineplus">+}</span>
<a href="#l10.356"></a><span id="l10.356" class="difflineplus">+</span>
<a href="#l10.357"></a><span id="l10.357" class="difflineplus">+richlistbox:focus activity-warning[selected=&quot;true&quot;] .dateTime,</span>
<a href="#l10.358"></a><span id="l10.358" class="difflineplus">+richlistbox:focus activity-warning[selected=&quot;true&quot;] .displayText,</span>
<a href="#l10.359"></a><span id="l10.359" class="difflineplus">+richlistbox:focus activity-warning[selected=&quot;true&quot;] .dateTime,</span>
<a href="#l10.360"></a><span id="l10.360" class="difflineplus">+richlistbox:focus activity-warning[selected=&quot;true&quot;] .statusText {</span>
<a href="#l10.361"></a><span id="l10.361" class="difflineplus">+  color: HighlightText;</span>
<a href="#l10.362"></a><span id="l10.362" class="difflineplus">+}</span>
<a href="#l10.363"></a><span id="l10.363" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..297ef4500381c8579d0cd86ba880eb0837a6af0d</span>
<a href="#l11.3"></a><span id="l11.3">GIT binary patch
literal 596
zc$@)L0;~OrP)&lt;h;3K|Lk000e1NJLTq001BW001Be1^@s6b9#F800004b3#c}2nYxW
zd&lt;bNS0000PbVXQnQ*UN;cVTj60C#tHE@^ISb7Ns}WiD@WXPfRk8UO$R=1D|BR9J=W
zm)&amp;aAa1h1M`On0}tlNTgy&gt;OugAF8Zv-@?+OXe-qs-qr``MG^I&gt;42VMaqZ=)1Z9c{e
z7j3uO-8EU7n&gt;`RnAT#F&amp;nK?;lW~frGQujFk04-X$zR`-3G+icX0L-cT{O;((%8db}
zS=M~Hw@-jHGweKnx?H4Bxko^v(``evc$?BQP&lt;D-HHiSh%D&amp;K-RK;-}&lt;b6|brVU%WR
za}Y8BV1okyj3m_4oFqtsAi~?&gt;uh!aXGTiIpaH`6ew@2?Uh1E!aBu!Rc?Z3X@4H)dt
zDFHLU(ZLC!s&amp;L}4^K93jv&lt;Hu$Y+nhhYm-n_(CKz2v;;&amp;1y&lt;TtZJtVQT)EMn^UD0`x
zU~yq_BEWI`7&gt;&amp;j~IC9AK@&lt;o!IPY)m&gt;{k&lt;2v;W*&gt;4b|&gt;4~+zvg@gQtpvHwWMQ@rh&lt;x
zMv^eIzX*Ar)6Afv{iy(gTjBjUj)QRkNs@NRe&gt;2eOwgbz4G@Yye{C0Y3zVBNQ1Qy4!
z1wml7TFs&amp;;N~Z!iJUl!Da5fI0wYCaz4yp&lt;f0RZ^^-LHe%sZ}ZmoCrMiAWn++C&lt;WjM
zCk}KKzK+XkMgRs5ui;Gr6g8d+K%V8O*B3C9I{&amp;4@AEoMfA2+uiJs`&lt;E&amp;#9s((Wk3&gt;
iK1rPan#}&gt;K2KWtUKc8m0j#Od*0000&lt;MNUMnLSTaZ%?Nt{</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..04da26a25248313c15a6088cdb192bf8fab01301</span>
<a href="#l12.3"></a><span id="l12.3">GIT binary patch
literal 2288
zc$@+72oLv(P)&lt;h;3K|Lk000e1NJLTq001xm002M;1^@s6Tp;vD00004XF*Lt007q5
z)K6G40000PbVXQnQ*UN;cVTj606}DLVr3vnZDD6+Qe|Oed2z{QJOBU)f=NU{RCwC#
zS_@27R~CIx9|~66hIDL&amp;`a@EsRti&gt;!$0vZ&amp;VzsXzMWrN-MhjA$s2LqUX{1GE8k5?X
zR{YV18rzg2ZT*xKtql^ZI5WzFf-TB`d`4S3F{$#G=`d@*oI}nW&amp;bjwu(&lt;UZwCp+id
zeeb&amp;W?DO60?dLTxFkrivWrS?-^710v6zCtI4&gt;I%5(4U}9aQHt)F9hC&gt;;z{UZ&gt;&gt;W0S
zZG+YV-*18+i6R;r1bu{=e}pzdzX87Q|DG2|0APO&lt;PeJ`O@9&amp;0I19MaJ@kdd_LC0wD
z9ndqt|DeHBqhEkNpuyjQ9tXa0hywtVx3evd+&amp;_T(QTq5K6wg}3p8~#F!p}gFY7t)o
zd&gt;vK1g&lt;%ilcXM-dLu7&lt;x3u72@*yH*2+O=z^%6Q2Z&amp;oCVC$9mo^ixw@KAmb(53k+kk
zu@RUCb&amp;}@g&lt;!ym&amp;;L@c_pL5&amp;Uvu8gd+y4Fgw{sg|2+Qy^a+##-*ROwzo;`Es%vao2
zT3SlOK7e=Ua~oj&lt;JdNBNq^YT?g&gt;`jx1N-*vJI`&amp;qcI_%B+sc(IKjt&gt;V5Y|0~;7u$H
zW4U`(RaF^bVPQ^`N4p`&gt;(b4Hwu3Y&amp;#JUskeT&gt;h6mb{p6V)`Ksi@aK3qyabqe6%`ey
zySlo17A#ocbh%vT9S+CgzP&gt;(=zX|-O48I!1!yJF$z=6c5sHh0MrxM@mOH53R1HO92
ziWSHE`}_H#{WtLW+&lt;}FBI&gt;}B@UD0@weqhU3174Bw+zF~H8c%Wu_zxI9N5*p}7+!8X
zNgwcUa?mgGoI}rbh;^y)?(YiqAzSP1+qb*Ly3}|XKV)m|?Ck6n&gt;OE592l3p29;x@z
z__V31sVPP8Cu2&gt;lP;9B&lt;_Bbe*^Uw2X11XP&lt;jZMIsSS&lt;UfsoOB;WBIhHtgQTdOiYXe
zYvNhOmO6A1@7%fbHCk}&gt;_4TLy{QQ#0hUw&amp;9ga;2E{Hxg_-n41c+w?3j=SGeknMF2q
z$Z4|S-TTZI@zSMB57B}&gt;eE6`-Znx)&gt;4b!QTY?+yvpXe5`4-E78$&amp;7|N)~#FjH*wmK
z4KJt^rp(vC-eGfi6pELi?yVIK4a&gt;&gt;NsS&amp;3Q+2EW@m@*#&amp;-^=j#qgVr_cG&amp;Qp&gt;4k-b
z_2RT48`|(aUq8@yfbSF!GCD&lt;{ws??SluuLODf~#Vh^G;0lJGN8q*%m%2K=|GP=dCy
znI@qG#WO!?LV-XOF(#n|#WQUh{NpGVn1m8v(hOI|LP9VXqzUF4Ee3O;&amp;_F4e`xmsv
zVlYSN(q!nP%uJ(w4O(Fs%-xIPZM(&lt;C!v{Qk;J4rdB#n)Ye~FBY)b)fRA0Vl%t&lt;4Ax
z4b_c=As-+qDk@5yG-=Xk4StXh@I@RXuZJm9ro@z&amp;m+zqyShIG5gzK676y`Ex#*C*g
zT)6N$oxlpbong2{^HW&amp;BKXK&amp;9kyq&amp;iR^WXYX3&amp;9gDmQ(6d&gt;+Wi$k@`&lt;)U-)48X{(b
z3O{Pps4*KiZp^xT`SL2oXo#3#72em^cl4SyYnBuj7cW+fMzH9&gt;{YDdR^5n@;iqY^D
z&gt;JJ&amp;=LqbBr6{8_K&lt;ZprxQH;h|(ScvAtQ&lt;s_BdqcP4gNl&gt;d_XfJyk-0dfe+Yqz?PPl
z%JlT~y@&gt;5^8SnvZFCsK|rKP2P1a8q`zy}^Sz&lt;&lt;AC!-mr4=H@P$4{!(CMNT}(`R?4g
zh27xbvSrK8D&amp;E^J)LT^!^!E04AeJveXns+FZx!kdDhGOcdb$oBI`rk9J$o)I@C~8^
zO)PjCVbbg3lo7+&gt;TG}|oQPlLhIAv;u&gt;+&gt;v&gt;_c7^po4^Oo%Lkc&lt;4|w&gt;1hYxu8!0*oo
zyd|(dn}3h9@W89Ox;o3x&amp;(ELPV%ak`13r+-b~B2Vyw06F_YzKEzQd)mXKV(1Ae(Ij
z&lt;EecG1qBQ3c6$J`WwU37I&gt;7iqq`U(m2wQmd&gt;eZZCvu2H9_afP|HU%GW$~zE(z&lt;306
zf0{mh`e=5~$)2?-_`u8Z4&amp;-n+=9H9_qz48D`m%d3vuABuJ}`g&amp;e1GBt-QC@VbR7^7
z5Ps~~vGrE@02=)u@qvzxj-BpUJt*jj6DLlrw8{sjO`A4`_y7XHKQsK){QUeBOMGDY
z^5p?Xj~;!yt*xykB_(BpJ7#EauS-fw+GT|gBqt}2J9X;RYuBz_yPlYs_$Jx#uB%R`
z^L;CPAR;2dAK^o0Yinye+ET#q&amp;8t_h{!GOOhU5n*_Q&amp;zvICt*c61v73ScM)fQ2aWr
z%nwlP-_X#|0!Q3Gy&lt;-ie;a$awU#FG%0gC&lt;6h95R&gt;-uw++V+}l)ot&lt;5#_;p&amp;HA3y+C
z6c-n_N)rRw%&lt;=&lt;h=&lt;Ydl=4{o(KsK}dKvh-MW{mv1ni$AtIX@r^F*5W*@!j$PVr1x?
zckY%C5F&gt;NBTw6@@12=BmsM)b&amp;$20N^wr$%s@A~!YF0=dqhQB^HH#bVg=j7x#urYjR
zmLCAVDJv^$2#*G}4F$eY&lt;^$exY@e5x_aS=QdGh4R&lt;oNjbhe)X&amp;9UYxS_YC-eTefc9
zdMqI!VIC-8!tB|z$C6SV3;G$lXTS&amp;CvU~ULa(wfT+qZ9z2o4S&amp;O-gmV(?R!Sj50q!
z+vwiCdtVtpetZZUmG7{S-YY9ByJ;mqK-(x5-_nT_Cr)MD;-BcjPq40jwvr#9Z4@Iu
zANUCj--;0|14roa&lt;Oe)_z{3YTe87_*@Z&lt;+9&lt;p)f}G(TV&gt;ruhLAG0qRbI~u0rx@)ui
z0G&gt;TSs=GGJ57gDwy-upTwwxa@5!3vDiJ0aGOvHMAKqHp(0~)cMAJE9~^8@mxG2Hxs
z0lxok@yh=TSrqO6g)EBp|3Vf;%?E}d?V8x$swnxuFhtJ&gt;EQlc=upowfz=90&amp;0dKa=
zk)e7R-dFR+Gdwk&lt;Vi@=e-gt)ZMDfKi@Lw&gt;DhYxu8z^|462`~VMhV18mi%}8)0000&lt;
KMNUMnLSTZewr+U&lt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..e4f9cc0c3885806917bb306ee11a1ee4fb6e69f8</span>
<a href="#l13.3"></a><span id="l13.3">GIT binary patch
literal 1533
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..e4f9cc0c3885806917bb306ee11a1ee4fb6e69f8</span>
<a href="#l14.3"></a><span id="l14.3">GIT binary patch
literal 1533
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..033e7ec1b3ec4d719573aa227ee10e0d83b8c523</span>
<a href="#l15.3"></a><span id="l15.3">GIT binary patch
literal 1203
zc$@*V1WfyhP)&lt;h;3K|Lk000e1NJLTq001BW001Be1^@s6b9#F800004b3#c}2nYxW
zd&lt;bNS0000PbVXQnQ*UN;cVTj60C#tHE@^ISb7Ns}WiD@WXPfRk8UO$UMM*?KR9J&lt;@
zS6xUPR~S8a?ylnxQ+JE9Y?iIax=C!BTD!)o585hSSy5;yB0kk(F%M!OPo-d`O$nyZ
zK6Gs#Txb_G1@WOY7Od!lR!nHDVElbh)^6J*4UJ}PTyZz!-04G|WU|i8jv*xnhGp*0
zcg~#qefQoavMl3Sf_tXy04!RK0|Nu4k|dQ=N)Po(k^}%?jOn(?vMd3Z&amp;&amp;tYLX=`gs
z7zrR+OAro+J6c*=NM&gt;fHCb&lt;#f@i@lD#sC1@+uIK^GBU2Tx3}NZ8?WgA0Fs@Zjc7Cq
z0N}VsE2ZU1DtMkpNl6LT*Vi+m(db)!eSJT6b#&gt;j&lt;8fz*C7-J9Zl_bfO6CRHTE|&amp;{l
zuh(j^SQ&lt;m2P_}6S&gt;h%Twb3k!{QmX5MGLBLTQ4~QbMP6PW91cf@D2lbF1*8U5phc{Z
zD&amp;rVq;CUWas}&amp;xPM-c!@sVf)^dQA&amp;pj2V)190vxF&gt;r1!um40PRGMU8a=qSd=$1yiI
zhe#x%EaMxYP{?{D2lU7R;ET)GE6;y9@#(KCck-1!tJR9~@^ZM{ZaAGzxZQ4)mX@Ni
zu@Qt2*&gt;1NJbu7&amp;)P$!ulIi(b&gt;{+AYIS-xCa?A%hj#c&gt;=Q4##5-3W5Ma$f26oE5o$p
z08r?%#Xow#W=3nSn%oGcx8hWCBa+lgG1@yc9ndPnbmZ#3+1c3_rl+TC5{blf-QC?^
z&gt;$2+!FiS3qBAK6`w^deF#&amp;&amp;mits^5NXI58NtCPuOZc$OuOmlPdh?dwR31AFlCGxlJ
zm6OhxI@rd&gt;Mz-JY|8Qq#$L{rd|EQ{}a@g(m-zq99MgxJsGRIlug|)wIg(~t?X90tq
zP?98Y9EZ=p`=#RSXFv5`TfCL8{*wOw{?mdW+*?~)J0FQe+&lt;w15*wfSVRZ~;bqQzoi
z7rvRSdhfyyy;m1*=4)}7cHr%r6U&amp;LDICQ4ixutGzXlRHG4i2_fS66=^2tpzd2&gt;cE_
zTB_#SQ_JE5HuT!5V_O&lt;wjU7&lt;$11Agfc0M`#`V`Mw9{NWqMQv^E=Frg4MW4@ir@p&gt;k
zn3$M&amp;QJp6*A9wz9&gt;70Lx=dH}B3XXguQi5?Dhq}7DyTM&gt;^FefMH{^aE3JCY&lt;3_1U04
zBc7UoRM_qIWLa6+m3Tbv8Xg|5)Fd$wVfr}M1EmzLt*zGtLAbfJv{Y?MwF*btic&lt;wK
z2C}er+xBYlu~=tkXK-_KQ%Iec?(&amp;j035{^^+n+1m{rLOdnHzuR7ZeoS_xXIc)H!1G
z5em|lp%Gf%JiVMq?x!ua|4qR0g6DTGo%2s=^=a*TS};sPvrC~y&gt;YQ{jbRA%fAvZVI
zaI%&gt;zx_S&amp;_jKpHG$1WwB0`~X!=fdG|8PD@+3Cv&lt;|Zx5m&lt;u5@&amp;Ci0XFDe?|a62q6II
zfk@@oqI#zQ$iV{u41f$k0&lt;f&gt;~NU|&amp;+N(@~A&gt;2M$r2LfaOke?vf6AO4+_!m0)osrQZ
RuHygz002ovPDHLkV1fr+E~5Yd</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..97fa67ed3c90ad6957b3634e8ffb2685352e171f</span>
<a href="#l16.3"></a><span id="l16.3">GIT binary patch
literal 2497
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
LNkvXXu0mjf$&lt;?Jx</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..42d053a9c4c3564463109a60c243b54013380d5e</span>
<a href="#l17.3"></a><span id="l17.3">GIT binary patch
literal 1447
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
Bsr~=}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..e4f9cc0c3885806917bb306ee11a1ee4fb6e69f8</span>
<a href="#l18.3"></a><span id="l18.3">GIT binary patch
literal 1533
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">new file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..e4f9cc0c3885806917bb306ee11a1ee4fb6e69f8</span>
<a href="#l19.3"></a><span id="l19.3">GIT binary patch
literal 1533
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">new file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..e4f9cc0c3885806917bb306ee11a1ee4fb6e69f8</span>
<a href="#l20.3"></a><span id="l20.3">GIT binary patch
literal 1533
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">new file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..abc465e62201adc1f36b20178c9e374cdcab6af6</span>
<a href="#l21.3"></a><span id="l21.3">GIT binary patch
literal 335
zc%17D@N?(olHy`uVBq!ia0vp^3LwnE1|*BCs=fdzmSQK*5Dp-y;YjHK@+C`LBT9nv
z(@M${i&amp;7cN%ggmL^RkPR6AM!H@{7`Ezq647DthSY;usRq`u3VVcawv}@sIaQ+r6Ch
zwprXboz)TNe&amp;s@d%NHx97pXTdB~4J#n^(#^)%D*=gAEUNI`&amp;mxd7o~xY&gt;Lz5)mJm-
zGO#ExFmin0XP8)SA@Qx;v#796PPk@&amp;WPY_gW6-?2Pm`v~Zm4SbnDQhoz*V37;6wR8
zRY!j(^&amp;H%``{&amp;$6{YjdMrEBuFmL_XHe#LO^XQA2rZHy0!sy9SGmJIZoDklH=I(Pqr
zM-iL}8M*3RO0o&lt;lzTW=@&lt;{c_o|GH|IIgc}=g8&lt;7+V+I4?V8({$l_#saFHY@&amp;IOu}O
a1FoM8_E(OIbcg^w%i!ti=d#Wzp$P!1g@U30</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">new file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..ab6edceb7d2671b13191a974add88dd88372b793</span>
<a href="#l22.3"></a><span id="l22.3">GIT binary patch
literal 1824
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
O0000&lt;MNUMnLSTY_09mX6</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">new file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..e4f9cc0c3885806917bb306ee11a1ee4fb6e69f8</span>
<a href="#l23.3"></a><span id="l23.3">GIT binary patch
literal 1533
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">new file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..e4f9cc0c3885806917bb306ee11a1ee4fb6e69f8</span>
<a href="#l24.3"></a><span id="l24.3">GIT binary patch
literal 1533
zc$@+K1p@ksP)&lt;h;3K|Lk000e1NJLTq001BW001Be1^@s6b9#F800009a7bBm000XU
z000XU0RWnu7ytkO1ZP1_K&gt;z@;j(q!3lK=n!AY({UO#lFTB&gt;(_`g8%^e{{R4h=&gt;PzA
zFaQARU;qF*m;eA5Z&lt;1fdMgRZ&gt;b4f%&amp;RCwC#ms@NUWfaH%-(_cZJG&lt;@f_R6IoEyx3x
z2-?PI&lt;RVz46is-nnn)CdKtpUyBoY;aHxy}?ZMh`+&lt;RwB)2vLa^h#)*cfwn*t!In~J
zmtMC!o!!ptd^0|@VlQk&lt;5#kHy%XvBTKRLheGCAKzY}&gt;~FY2*RGcmWn{StR&gt;BDKCmX
zv6z6efv|A7UB^?E)US8Hx+`{H0E#|axjx=ul&lt;J+vRJUJYzD(bc@7*`M5$%o&amp;XR5PF
znc&amp;`8wQ+yoo&amp;XemUbIYaHNJFk$E4Z$voLq=96+|wp?AQ71puI+NR!h5ouIz{JT9EN
z2uoNuJX74SSCv%#bk_hYwiRuOHAgqkUp9~D&amp;3_D+waaMK8W0uQZS_e^!89cYGn5%P
zeYOVYeyKD4IsQ+pO80LbH^A}_m+wLhYYSg^mRPcd)8SKy^~DhHHDT%EwmDR0aJV^K
zP8agL`Jg(*p&gt;KY+CAaj&amp;!A%EWyJLVA+l$udt$lk|tzAXitPn1!=K%nEmyRC_4vo5H
zE2|43`(*&amp;YY|k8I&amp;@3F-d%#M`_Lh9Vv1-={=;49Fvcie#Uutks@j}{(cGRi05Cg-|
z&lt;6|BwLyzCm*QvGWL^~E0FQDzex9un_E1WncK)fsd-NZ+-&lt;djqo&amp;PHk=h`8kz5n}&gt;a
zgY&lt;$3oQ&gt;2V+3&amp;%Gd0Daui+!U4JQsX^QnWSpME=wHIHR6{0RsZ&amp;5Fg8i&gt;kSw&lt;qn&lt;(D
z!aVfcP#=GC&gt;r&lt;%-0gQ;g*`MoWajqj|gdkuIbNdbe&gt;=Ah(BZQcwL7u|7ZCdXp1n7(C
z&amp;tyHEiEDZ@tbrvT?DidOfqk1i)rz1-twF}jbeO7HFj&amp;ur?7wDarDvz(PxB85VvU^L
zZDPZ%)eM0f4EDevAh2P&gt;GA+!T{3sfZU7eH=K&lt;K6`DMf)A)nI4_MAU*U{#kY#(az|Y
z0P(IktU;iJ0n|m&amp;o74+;svANVNeKZgVKFI*BNox{a^`BhGGooSyW7&gt;(%_CyLO951L
z?u6uYz_x9c@C*=6%-*O5?r&gt;o5^*yMpt@zLFHgK*CfotWE91@~&gt;43tul5P&amp;&amp;ZUr(e5
z%)!u?97B1&gt;4g_k;?!I_!87ex1;64ULRuJwAgE?t5Aplo+=*IOHIJt~CkAwLsD!PJq
z1rew%Lq%5*%uhia1Sygi9W5Q;NsiWp01gj79J&amp;-jsv`}c0CA9hh;R^rx;uvm)Rmzk
z{BLnkAWO&lt;Z*X3@=$#Qi&lt;0P18PXpK=pO$tBvgAfABDY%cJGF*W`efikM&gt;&amp;sCYt^oHj
zP)&lt;PzfuH-qOa`qnDkMezI3d8{(&amp;`o^Q#pC%L&lt;4eN(?KX1vJ#a&amp;!BHUs_2sDS89H-9
z336T2apgn&lt;luYI1;nM1sQJay=n^dfwjrM6_4LPpde#Kx2HHg6Zkr09N&lt;)~DL76%1#
zT)EJ~8nkm!-Q`Ux9&lt;v)BF0F3yPW5hR+Se&gt;R!h&gt;un8z2A(KsW*OjfA*W+($t;xuwsR
zvf&amp;XPH0^5^-YMSo!)HJ0jcCzFiz_uVvhJbcsU+?&amp;&amp;}cNmwEMfEEo_Kx3mg0;0MLKh
zeH4U|{=bQEOp~U;5tnfF+a_D#$-9re{p&lt;R1-wBs|vgDm`TlhVHftO{&gt;N=KV{6CI)h
zhHbzWHf*Cmmq-MJ5lBQr8cRb4&amp;qUkBc63#Tg*U_d{?ScGx8C)wxL|uhQKVhnE#&amp;xQ
zZ@w3)Gkp+F0o786=-ku|-pA2-sT&lt;)_VKCisJvrU8uKLaDAMeS#VClA{C0e)kh91$g
znU8TfQvwJX=u&lt;ZIn+8O;Fy&amp;;qS@9`lN8UOTyl*cf$&lt;1Ceb+OR4!2o~|2rjeZMz8ql
jw=Ku?2anV7*xv&amp;HbCb1r-i^O=00000NkvXXu0mjf4z&lt;II</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/suite/browser/fullScreen.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/suite/browser/fullScreen.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -37,17 +37,16 @@</span>
<a href="#l25.4"></a><span id="l25.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6"> var FullScreen = </span>
<a href="#l25.7"></a><span id="l25.7"> {</span>
<a href="#l25.8"></a><span id="l25.8">   toggle: function()</span>
<a href="#l25.9"></a><span id="l25.9">   {</span>
<a href="#l25.10"></a><span id="l25.10">     var show = window.fullScreen;</span>
<a href="#l25.11"></a><span id="l25.11">     // show/hide all menubars, toolbars, and statusbars (except the full screen toolbar)</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    this.showXULChrome(&quot;menubar&quot;, show);</span>
<a href="#l25.13"></a><span id="l25.13">     this.showXULChrome(&quot;toolbar&quot;, show);</span>
<a href="#l25.14"></a><span id="l25.14">     this.showXULChrome(&quot;statusbar&quot;, show);</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16">     var toolbox = getNavToolbox();</span>
<a href="#l25.17"></a><span id="l25.17">     if (show)</span>
<a href="#l25.18"></a><span id="l25.18">       toolbox.removeAttribute(&quot;inFullscreen&quot;);</span>
<a href="#l25.19"></a><span id="l25.19">     else</span>
<a href="#l25.20"></a><span id="l25.20">       toolbox.setAttribute(&quot;inFullscreen&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/suite/browser/navigator.xul</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/suite/browser/navigator.xul</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -146,17 +146,26 @@</span>
<a href="#l26.4"></a><span id="l26.4">   &lt;popup id=&quot;feedsPopup&quot; popupanchor=&quot;bottomright&quot; popupalign=&quot;topright&quot;</span>
<a href="#l26.5"></a><span id="l26.5">          onpopupshowing=&quot;window.XULBrowserWindow.populateFeeds(this);&quot;</span>
<a href="#l26.6"></a><span id="l26.6">          oncommand=&quot;subscribeToFeed('feed:' + event.target.statusText /*, gBrowser.currentURI*/);&quot;/&gt;</span>
<a href="#l26.7"></a><span id="l26.7">   &lt;panel type=&quot;autocomplete&quot; id=&quot;PopupAutoComplete&quot; level=&quot;top&quot;/&gt;</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">   &lt;toolbox id=&quot;navigator-toolbox&quot; class=&quot;toolbox-top&quot; deferattached=&quot;true&quot;</span>
<a href="#l26.10"></a><span id="l26.10">            mode=&quot;full&quot; defaultmode=&quot;full&quot;&gt;</span>
<a href="#l26.11"></a><span id="l26.11">     &lt;!-- Menu --&gt;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-    &lt;menubar id=&quot;main-menubar&quot; persist=&quot;collapsed&quot; grippytooltiptext=&quot;&amp;menuBar.tooltip;&quot;/&gt;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+    &lt;toolbar type=&quot;menubar&quot; id=&quot;toolbar-menubar&quot; class=&quot;chromeclass-menubar&quot;</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+             persist=&quot;collapsed&quot; grippytooltiptext=&quot;&amp;menuBar.tooltip;&quot; customizable=&quot;true&quot;</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+             defaultset=&quot;menubar-items&quot;</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+             mode=&quot;icons&quot; iconsize=&quot;small&quot;</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+             defaultmode=&quot;icons&quot; defaulticonsize=&quot;small&quot;</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+             context=&quot;toolbar-context-menu&quot;&gt;</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+      &lt;toolbaritem id=&quot;menubar-items&quot; class=&quot;menubar-items&quot; align=&quot;center&quot;&gt;</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+        &lt;menubar id=&quot;main-menubar&quot;/&gt;</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineplus">+      &lt;/toolbaritem&gt;</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+    &lt;/toolbar&gt;</span>
<a href="#l26.23"></a><span id="l26.23"> </span>
<a href="#l26.24"></a><span id="l26.24">     &lt;toolbar class=&quot;toolbar-primary chromeclass-toolbar&quot; id=&quot;nav-bar&quot; persist=&quot;collapsed&quot; </span>
<a href="#l26.25"></a><span id="l26.25">              grippytooltiptext=&quot;&amp;navigationToolbar.tooltip;&quot;</span>
<a href="#l26.26"></a><span id="l26.26">              fullscreentoolbar=&quot;true&quot; customizable=&quot;true&quot;</span>
<a href="#l26.27"></a><span id="l26.27">              toolbarname=&quot;&amp;navbarCmd.label;&quot; accesskey=&quot;&amp;navbarCmd.accesskey;&quot;</span>
<a href="#l26.28"></a><span id="l26.28">              togglemenuitem=&quot;cmd_viewnavbar&quot;</span>
<a href="#l26.29"></a><span id="l26.29">              defaultset=&quot;back-button,forward-button,reload-button,stop-button,nav-bar-inner,print-button,throbber-box,window-controls&quot;</span>
<a href="#l26.30"></a><span id="l26.30">              context=&quot;toolbar-context-menu&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/suite/browser/navigatorOverlay.xul</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/suite/browser/navigatorOverlay.xul</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -116,17 +116,17 @@</span>
<a href="#l27.4"></a><span id="l27.4">     &lt;key id=&quot;addBookmarkAsKb&quot; key=&quot;&amp;addCurPageAsCmd.commandkey;&quot; command=&quot;Browser:AddBookmarkAs&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l27.5"></a><span id="l27.5">     &lt;key id=&quot;manBookmarkKb&quot; key=&quot;&amp;manBookmarksCmd.commandkey;&quot; command=&quot;Browser:ManageBookmark&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l27.6"></a><span id="l27.6"> </span>
<a href="#l27.7"></a><span id="l27.7">     &lt;!-- Tools Menu --&gt;</span>
<a href="#l27.8"></a><span id="l27.8">     &lt;key id=&quot;searchInternetKb&quot; key=&quot;&amp;searchInternet.commandKey;&quot; modifiers=&quot;accel,shift&quot; command=&quot;Browser:SearchInternet&quot;/&gt;</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10">     &lt;!-- Misc --&gt;</span>
<a href="#l27.11"></a><span id="l27.11">           &lt;!-- the amazing fishcam dept. --&gt;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    &lt;key key=&quot;f&quot; modifiers=&quot;control,alt&quot; oncommand=&quot;loadURI('http://wp.netscape.com/fishcam/fishcam.html');&quot;/&gt;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+    &lt;key key=&quot;f&quot; modifiers=&quot;control,alt&quot; oncommand=&quot;loadURI('http://www.fishcam.com/');&quot;/&gt;</span>
<a href="#l27.14"></a><span id="l27.14">     &lt;key id=&quot;goUpKb&quot; keycode=&quot;VK_UP&quot; command=&quot;Browser:Up&quot; modifiers=&quot;alt&quot;/&gt;</span>
<a href="#l27.15"></a><span id="l27.15">     &lt;key id=&quot;key_gotoHistory&quot;  key=&quot;&amp;history.commandKey;&quot;        oncommand=&quot;toHistory();&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l27.16"></a><span id="l27.16">     &lt;keyset id=&quot;viewZoomKeys&quot;/&gt;</span>
<a href="#l27.17"></a><span id="l27.17">     &lt;keyset id=&quot;navigationKeys&quot;/&gt;  </span>
<a href="#l27.18"></a><span id="l27.18">     &lt;keyset id=&quot;tasksKeys&quot;/&gt;</span>
<a href="#l27.19"></a><span id="l27.19">     &lt;key id=&quot;key_sanitize&quot; command=&quot;Tools:Sanitize&quot; keycode=&quot;VK_DELETE&quot; modifiers=&quot;accel,shift&quot;/&gt;</span>
<a href="#l27.20"></a><span id="l27.20">   &lt;/keyset&gt;</span>
<a href="#l27.21"></a><span id="l27.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/suite/common/aboutSessionRestore.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/suite/common/aboutSessionRestore.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -51,18 +51,17 @@ window.onload = function() {</span>
<a href="#l28.4"></a><span id="l28.4">       return;</span>
<a href="#l28.5"></a><span id="l28.5">     }</span>
<a href="#l28.6"></a><span id="l28.6">   }</span>
<a href="#l28.7"></a><span id="l28.7">   // make sure the data is tracked to be restored in case of a subsequent crash</span>
<a href="#l28.8"></a><span id="l28.8">   var event = document.createEvent(&quot;UIEvents&quot;);</span>
<a href="#l28.9"></a><span id="l28.9">   event.initUIEvent(&quot;input&quot;, true, true, window, 0);</span>
<a href="#l28.10"></a><span id="l28.10">   sessionData.dispatchEvent(event);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  var s = new Components.utils.Sandbox(&quot;about:blank&quot;);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-  gStateObject = Components.utils.evalInSandbox(&quot;(&quot; + sessionData.value + &quot;)&quot;, s);</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+  gStateObject = JSON.parse(sessionData.value);</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16">   initTreeView();</span>
<a href="#l28.17"></a><span id="l28.17"> </span>
<a href="#l28.18"></a><span id="l28.18">   document.getElementById(&quot;errorTryAgain&quot;).focus();</span>
<a href="#l28.19"></a><span id="l28.19"> };</span>
<a href="#l28.20"></a><span id="l28.20"> </span>
<a href="#l28.21"></a><span id="l28.21"> function initTreeView() {</span>
<a href="#l28.22"></a><span id="l28.22">   var tabList = document.getElementById(&quot;tabList&quot;);</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineat">@@ -113,17 +112,17 @@ function restoreSession() {</span>
<a href="#l28.24"></a><span id="l28.24">           gStateObject.windows[ix].tabs.filter(function(aTabData, aIx)</span>
<a href="#l28.25"></a><span id="l28.25">                                                  gTreeData[t].tabs[aIx].checked);</span>
<a href="#l28.26"></a><span id="l28.26">       else if (!gTreeData[t].checked)</span>
<a href="#l28.27"></a><span id="l28.27">         // this window won't be restored at all</span>
<a href="#l28.28"></a><span id="l28.28">         gStateObject.windows.splice(ix, 1);</span>
<a href="#l28.29"></a><span id="l28.29">       ix--;</span>
<a href="#l28.30"></a><span id="l28.30">     }</span>
<a href="#l28.31"></a><span id="l28.31">   }</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-  var stateString = gStateObject.toSource();</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+  var stateString = JSON.stringify(gStateObject);</span>
<a href="#l28.34"></a><span id="l28.34"> </span>
<a href="#l28.35"></a><span id="l28.35">   var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l28.36"></a><span id="l28.36">   var top = getBrowserWindow();</span>
<a href="#l28.37"></a><span id="l28.37"> </span>
<a href="#l28.38"></a><span id="l28.38">   // if there's only this page open, reuse the window for restoring the session</span>
<a href="#l28.39"></a><span id="l28.39">   if (top.gBrowser.tabContainer.childNodes.length == 1) {</span>
<a href="#l28.40"></a><span id="l28.40">     ss.setWindowState(top, stateString, true);</span>
<a href="#l28.41"></a><span id="l28.41">     return;</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineat">@@ -219,17 +218,17 @@ function toggleRowChecked(aIx) {</span>
<a href="#l28.43"></a><span id="l28.43"> function restoreSingleTab(aIx, aShifted) {</span>
<a href="#l28.44"></a><span id="l28.44">   var tabbrowser = getBrowserWindow().gBrowser;</span>
<a href="#l28.45"></a><span id="l28.45">   var newTab = tabbrowser.addTab();</span>
<a href="#l28.46"></a><span id="l28.46">   var item = gTreeData[aIx];</span>
<a href="#l28.47"></a><span id="l28.47"> </span>
<a href="#l28.48"></a><span id="l28.48">   var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l28.49"></a><span id="l28.49">   var tabState = gStateObject.windows[item.parent.ix]</span>
<a href="#l28.50"></a><span id="l28.50">                              .tabs[aIx - gTreeData.indexOf(item.parent) - 1];</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineminus">-  ss.setTabState(newTab, tabState.toSource());</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+  ss.setTabState(newTab, JSON.stringify(tabState));</span>
<a href="#l28.53"></a><span id="l28.53"> </span>
<a href="#l28.54"></a><span id="l28.54">   // respect the preference as to whether to select the tab (the Shift key inverses)</span>
<a href="#l28.55"></a><span id="l28.55">   var prefBranch = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l28.56"></a><span id="l28.56">   if (prefBranch.getBoolPref(&quot;browser.tabs.loadInBackground&quot;) != !aShifted)</span>
<a href="#l28.57"></a><span id="l28.57">     tabbrowser.selectedTab = newTab;</span>
<a href="#l28.58"></a><span id="l28.58"> }</span>
<a href="#l28.59"></a><span id="l28.59"> </span>
<a href="#l28.60"></a><span id="l28.60"> // Tree controller</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/common/bindings/toolbar.xml</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/common/bindings/toolbar.xml</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -266,16 +266,20 @@</span>
<a href="#l29.4"></a><span id="l29.4">               return !this.parentNode.customizing; // Don't move while customizing.</span>
<a href="#l29.5"></a><span id="l29.5">             }</span>
<a href="#l29.6"></a><span id="l29.6">           } catch (e) {}</span>
<a href="#l29.7"></a><span id="l29.7">         ]]&gt;</span>
<a href="#l29.8"></a><span id="l29.8">       &lt;/constructor&gt;</span>
<a href="#l29.9"></a><span id="l29.9">     &lt;/implementation&gt;</span>
<a href="#l29.10"></a><span id="l29.10">   &lt;/binding&gt;</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+  &lt;binding id=&quot;grippytoolbar-menubar&quot;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+           extends=&quot;chrome://communicator/content/bindings/toolbar.xml#grippytoolbar&quot;</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+           display=&quot;xul:menubar&quot;/&gt;</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+</span>
<a href="#l29.16"></a><span id="l29.16">   &lt;binding id=&quot;grippymenubar&quot; extends=&quot;chrome://global/content/bindings/toolbar.xml#menubar&quot;&gt;</span>
<a href="#l29.17"></a><span id="l29.17">     &lt;content&gt;</span>
<a href="#l29.18"></a><span id="l29.18">       &lt;xul:hbox flex=&quot;1&quot; class=&quot;toolbar-box&quot;&gt;</span>
<a href="#l29.19"></a><span id="l29.19">         &lt;xul:toolbargrippy xbl:inherits=&quot;last-toolbar,hidden=grippyhidden&quot;</span>
<a href="#l29.20"></a><span id="l29.20">                            tbattr=&quot;toolbar-grippy&quot; class=&quot;toolbar-grippy&quot;/&gt;</span>
<a href="#l29.21"></a><span id="l29.21">         &lt;xul:hbox flex=&quot;1&quot; class=&quot;toolbar-holder&quot; xbl:inherits=&quot;collapsed,last-toolbar&quot;&gt;</span>
<a href="#l29.22"></a><span id="l29.22">           &lt;children/&gt;</span>
<a href="#l29.23"></a><span id="l29.23">         &lt;/xul:hbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/suite/common/communicator.css</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/suite/common/communicator.css</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -57,16 +57,17 @@ toolbar[printpreview=&quot;true&quot;] {</span>
<a href="#l30.4"></a><span id="l30.4">  */</span>
<a href="#l30.5"></a><span id="l30.5"> </span>
<a href="#l30.6"></a><span id="l30.6"> /******* toolkit access layer *******/</span>
<a href="#l30.7"></a><span id="l30.7"> /* These rules reintroduce the toolkit bindings overwritten later below */</span>
<a href="#l30.8"></a><span id="l30.8"> toolbox[xpfe=&quot;false&quot;] { </span>
<a href="#l30.9"></a><span id="l30.9">   -moz-binding: url(&quot;chrome://global/content/bindings/toolbar.xml#toolbox&quot;);</span>
<a href="#l30.10"></a><span id="l30.10"> }</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+toolbar[xpfe=&quot;false&quot;][type=&quot;menubar&quot;],</span>
<a href="#l30.13"></a><span id="l30.13"> toolbar[xpfe=&quot;false&quot;] {</span>
<a href="#l30.14"></a><span id="l30.14">   -moz-binding: url(&quot;chrome://global/content/bindings/toolbar.xml#toolbar&quot;);</span>
<a href="#l30.15"></a><span id="l30.15"> }</span>
<a href="#l30.16"></a><span id="l30.16"> </span>
<a href="#l30.17"></a><span id="l30.17"> menubar[xpfe=&quot;false&quot;],</span>
<a href="#l30.18"></a><span id="l30.18"> toolbar &gt; toolbaritem &gt; menubar {</span>
<a href="#l30.19"></a><span id="l30.19">   -moz-binding: url(&quot;chrome://global/content/bindings/toolbar.xml#menubar&quot;);</span>
<a href="#l30.20"></a><span id="l30.20"> }</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineat">@@ -96,16 +97,20 @@ prefpane[xpfe=&quot;false&quot;] {</span>
<a href="#l30.22"></a><span id="l30.22"> toolbox { </span>
<a href="#l30.23"></a><span id="l30.23">   -moz-binding: url(&quot;chrome://communicator/content/bindings/toolbar.xml#grippytoolbox&quot;);</span>
<a href="#l30.24"></a><span id="l30.24"> }</span>
<a href="#l30.25"></a><span id="l30.25">   </span>
<a href="#l30.26"></a><span id="l30.26"> toolbar {</span>
<a href="#l30.27"></a><span id="l30.27">   -moz-binding: url(&quot;chrome://communicator/content/bindings/toolbar.xml#grippytoolbar&quot;);</span>
<a href="#l30.28"></a><span id="l30.28"> }</span>
<a href="#l30.29"></a><span id="l30.29"> </span>
<a href="#l30.30"></a><span id="l30.30" class="difflineplus">+toolbar[type=&quot;menubar&quot;] {</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+  -moz-binding: url(&quot;chrome://communicator/content/bindings/toolbar.xml#grippytoolbar-menubar&quot;);</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+}</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+</span>
<a href="#l30.34"></a><span id="l30.34"> toolbargrippy {</span>
<a href="#l30.35"></a><span id="l30.35">   -moz-binding: url(&quot;chrome://communicator/content/bindings/toolbar.xml#toolbargrippy&quot;);</span>
<a href="#l30.36"></a><span id="l30.36"> }</span>
<a href="#l30.37"></a><span id="l30.37"> </span>
<a href="#l30.38"></a><span id="l30.38"> menubar {</span>
<a href="#l30.39"></a><span id="l30.39">   -moz-binding: url(&quot;chrome://communicator/content/bindings/toolbar.xml#grippymenubar&quot;);</span>
<a href="#l30.40"></a><span id="l30.40"> }</span>
<a href="#l30.41"></a><span id="l30.41"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/common/src/nsSessionStartup.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/common/src/nsSessionStartup.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -93,17 +93,17 @@ SessionStartup.prototype = {</span>
<a href="#l31.4"></a><span id="l31.4">     let prefBranch = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l31.5"></a><span id="l31.5">                                .getService(Components.interfaces.nsIPrefService)</span>
<a href="#l31.6"></a><span id="l31.6">                                .getBranch(&quot;browser.&quot;);</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8">     // get file references</span>
<a href="#l31.9"></a><span id="l31.9">     var dirService = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l31.10"></a><span id="l31.10">                                .getService(Components.interfaces.nsIProperties);</span>
<a href="#l31.11"></a><span id="l31.11">     let sessionFile = dirService.get(&quot;ProfD&quot;, Components.interfaces.nsILocalFile);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    sessionFile.append(&quot;sessionstore.js&quot;);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+    sessionFile.append(&quot;sessionstore.json&quot;);</span>
<a href="#l31.14"></a><span id="l31.14"> </span>
<a href="#l31.15"></a><span id="l31.15">     let doResumeSession = prefBranch.getBoolPref(&quot;sessionstore.resume_session_once&quot;) ||</span>
<a href="#l31.16"></a><span id="l31.16">                           prefBranch.getIntPref(&quot;startup.page&quot;) == 3;</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18">     // only read the session file if config allows possibility of restoring</span>
<a href="#l31.19"></a><span id="l31.19">     var resumeFromCrash = prefBranch.getBoolPref(&quot;sessionstore.resume_from_crash&quot;);</span>
<a href="#l31.20"></a><span id="l31.20">     if ((!resumeFromCrash &amp;&amp; !doResumeSession) || !sessionFile.exists())</span>
<a href="#l31.21"></a><span id="l31.21">       return;</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineat">@@ -112,18 +112,17 @@ SessionStartup.prototype = {</span>
<a href="#l31.23"></a><span id="l31.23">     this._iniString = this._readStateFile(sessionFile);</span>
<a href="#l31.24"></a><span id="l31.24">     if (!this._iniString)</span>
<a href="#l31.25"></a><span id="l31.25">       return;</span>
<a href="#l31.26"></a><span id="l31.26"> </span>
<a href="#l31.27"></a><span id="l31.27">     var initialState;</span>
<a href="#l31.28"></a><span id="l31.28"> </span>
<a href="#l31.29"></a><span id="l31.29">     try {</span>
<a href="#l31.30"></a><span id="l31.30">       // parse the session state into JS objects</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-      var s = new Components.utils.Sandbox(&quot;about:blank&quot;);</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineminus">-      initialState = Components.utils.evalInSandbox(this._iniString, s);</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineplus">+      initialState = JSON.parse(this._iniString);</span>
<a href="#l31.34"></a><span id="l31.34">     }</span>
<a href="#l31.35"></a><span id="l31.35">     catch (ex) {</span>
<a href="#l31.36"></a><span id="l31.36">       doResumeSession = false;</span>
<a href="#l31.37"></a><span id="l31.37">       debug(&quot;The session file is invalid: &quot; + ex);</span>
<a href="#l31.38"></a><span id="l31.38">     }</span>
<a href="#l31.39"></a><span id="l31.39"> </span>
<a href="#l31.40"></a><span id="l31.40">     let lastSessionCrashed =</span>
<a href="#l31.41"></a><span id="l31.41">       initialState &amp;&amp; initialState.session &amp;&amp; initialState.session.state &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/suite/common/src/nsSessionStore.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/suite/common/src/nsSessionStore.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -189,33 +189,33 @@ SessionStoreService.prototype = {</span>
<a href="#l32.4"></a><span id="l32.4">     this._sessionhistory_max_entries =</span>
<a href="#l32.5"></a><span id="l32.5">       this._prefBranch.getIntPref(&quot;sessionhistory.max_entries&quot;);</span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7">     // get file references</span>
<a href="#l32.8"></a><span id="l32.8">     var dirService = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l32.9"></a><span id="l32.9">                                .getService(Components.interfaces.nsIProperties);</span>
<a href="#l32.10"></a><span id="l32.10">     this._sessionFile = dirService.get(&quot;ProfD&quot;, Components.interfaces.nsILocalFile);</span>
<a href="#l32.11"></a><span id="l32.11">     this._sessionFileBackup = this._sessionFile.clone();</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    this._sessionFile.append(&quot;sessionstore.js&quot;);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+    this._sessionFile.append(&quot;sessionstore.json&quot;);</span>
<a href="#l32.14"></a><span id="l32.14">     this._sessionFileBackup.append(&quot;sessionstore.bak&quot;);</span>
<a href="#l32.15"></a><span id="l32.15"> </span>
<a href="#l32.16"></a><span id="l32.16">     // get string containing session state</span>
<a href="#l32.17"></a><span id="l32.17">     var iniString;</span>
<a href="#l32.18"></a><span id="l32.18">     try {</span>
<a href="#l32.19"></a><span id="l32.19">       var ss = Components.classes[&quot;@mozilla.org/suite/sessionstartup;1&quot;]</span>
<a href="#l32.20"></a><span id="l32.20">                          .getService(Components.interfaces.nsISessionStartup);</span>
<a href="#l32.21"></a><span id="l32.21">       if (ss.doRestore())</span>
<a href="#l32.22"></a><span id="l32.22">         iniString = ss.state;</span>
<a href="#l32.23"></a><span id="l32.23">     }</span>
<a href="#l32.24"></a><span id="l32.24">     catch(ex) { dump(ex + &quot;\n&quot;); } // no state to restore, which is ok</span>
<a href="#l32.25"></a><span id="l32.25"> </span>
<a href="#l32.26"></a><span id="l32.26">     if (iniString) {</span>
<a href="#l32.27"></a><span id="l32.27">       try {</span>
<a href="#l32.28"></a><span id="l32.28">         // parse the session state into JS objects</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineminus">-        this._initialState = this._safeEval(iniString);</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+        this._initialState = JSON.parse(iniString);</span>
<a href="#l32.31"></a><span id="l32.31">       }</span>
<a href="#l32.32"></a><span id="l32.32">       catch (ex) { debug(&quot;The session file is invalid: &quot; + ex); }</span>
<a href="#l32.33"></a><span id="l32.33"> </span>
<a href="#l32.34"></a><span id="l32.34">       let lastSessionCrashed =</span>
<a href="#l32.35"></a><span id="l32.35">         this._initialState &amp;&amp; this._initialState.session &amp;&amp; this._initialState.session.state &amp;&amp;</span>
<a href="#l32.36"></a><span id="l32.36">         this._initialState.session.state == STATE_RUNNING_STR;</span>
<a href="#l32.37"></a><span id="l32.37">        // if last session crashed, backup the session</span>
<a href="#l32.38"></a><span id="l32.38">        if (lastSessionCrashed) {</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineat">@@ -301,23 +301,16 @@ SessionStoreService.prototype = {</span>
<a href="#l32.40"></a><span id="l32.40">       });</span>
<a href="#l32.41"></a><span id="l32.41">       this._dirtyWindows = [];</span>
<a href="#l32.42"></a><span id="l32.42">       break;</span>
<a href="#l32.43"></a><span id="l32.43">     case &quot;quit-application-granted&quot;:</span>
<a href="#l32.44"></a><span id="l32.44">       // freeze the data at what we've got (ignoring closing windows)</span>
<a href="#l32.45"></a><span id="l32.45">       this._loadState = STATE_QUITTING;</span>
<a href="#l32.46"></a><span id="l32.46">       break;</span>
<a href="#l32.47"></a><span id="l32.47">     case &quot;quit-application&quot;:</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineminus">-      // duplicate of quit-application request. Seamonkey doesn't have these yet.</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineminus">-      this._forEachBrowserWindow(function(aWindow) {</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-        this._collectWindowData(aWindow);</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineminus">-      });</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineminus">-      this._dirtyWindows = [];</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineminus">-      this._dirty = false;</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineminus">-</span>
<a href="#l32.55"></a><span id="l32.55">       if (aData == &quot;restart&quot;)</span>
<a href="#l32.56"></a><span id="l32.56">         this._prefBranch.setBoolPref(&quot;sessionstore.resume_session_once&quot;, true);</span>
<a href="#l32.57"></a><span id="l32.57">       this._loadState = STATE_QUITTING; // just to be sure</span>
<a href="#l32.58"></a><span id="l32.58">       this._uninit();</span>
<a href="#l32.59"></a><span id="l32.59">       break;</span>
<a href="#l32.60"></a><span id="l32.60">     case &quot;browser:purge-session-history&quot;: // catch sanitization</span>
<a href="#l32.61"></a><span id="l32.61">       let openWindows = {};</span>
<a href="#l32.62"></a><span id="l32.62">       this._forEachBrowserWindow(function(aWindow) {</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineat">@@ -604,17 +597,17 @@ SessionStoreService.prototype = {</span>
<a href="#l32.64"></a><span id="l32.64">    */</span>
<a href="#l32.65"></a><span id="l32.65">   onTabClose: function sss_onTabClose(aWindow, aTab) {</span>
<a href="#l32.66"></a><span id="l32.66">     // notify the tabbrowser that the tab state will be retrieved for the last time</span>
<a href="#l32.67"></a><span id="l32.67">     // (so that extension authors can easily set data on soon-to-be-closed tabs)</span>
<a href="#l32.68"></a><span id="l32.68">     var event = aWindow.document.createEvent(&quot;Events&quot;);</span>
<a href="#l32.69"></a><span id="l32.69">     event.initEvent(&quot;SSTabClosing&quot;, true, false);</span>
<a href="#l32.70"></a><span id="l32.70">     aTab.dispatchEvent(event);</span>
<a href="#l32.71"></a><span id="l32.71"> </span>
<a href="#l32.72"></a><span id="l32.72" class="difflineminus">-    var maxTabsUndo = this._prefBranch.getIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l32.73"></a><span id="l32.73" class="difflineplus">+    var maxTabsUndo = this._prefBranch.getIntPref(&quot;sessionstore.max_tabs_undo&quot;);</span>
<a href="#l32.74"></a><span id="l32.74">     // don't update our internal state if we don't have to</span>
<a href="#l32.75"></a><span id="l32.75">     if (maxTabsUndo == 0) {</span>
<a href="#l32.76"></a><span id="l32.76">       return;</span>
<a href="#l32.77"></a><span id="l32.77">     }</span>
<a href="#l32.78"></a><span id="l32.78"> </span>
<a href="#l32.79"></a><span id="l32.79">     // make sure that the tab related data is up-to-date</span>
<a href="#l32.80"></a><span id="l32.80">     var tabState = this._collectTabData(aTab);</span>
<a href="#l32.81"></a><span id="l32.81">     this._updateTextAndScrollDataForTab(aWindow, aTab.linkedBrowser, tabState);</span>
<a href="#l32.82"></a><span id="l32.82" class="difflineat">@@ -705,17 +698,17 @@ SessionStoreService.prototype = {</span>
<a href="#l32.83"></a><span id="l32.83"> /* ........ nsISessionStore API .............. */</span>
<a href="#l32.84"></a><span id="l32.84"> </span>
<a href="#l32.85"></a><span id="l32.85">   getBrowserState: function sss_getBrowserState() {</span>
<a href="#l32.86"></a><span id="l32.86">     return this._toJSONString(this._getCurrentState());</span>
<a href="#l32.87"></a><span id="l32.87">   },</span>
<a href="#l32.88"></a><span id="l32.88"> </span>
<a href="#l32.89"></a><span id="l32.89">   setBrowserState: function sss_setBrowserState(aState) {</span>
<a href="#l32.90"></a><span id="l32.90">     try {</span>
<a href="#l32.91"></a><span id="l32.91" class="difflineminus">-      var state = this._safeEval(&quot;(&quot; + aState + &quot;)&quot;);</span>
<a href="#l32.92"></a><span id="l32.92" class="difflineplus">+      var state = JSON.parse(aState);</span>
<a href="#l32.93"></a><span id="l32.93">     }</span>
<a href="#l32.94"></a><span id="l32.94">     catch (ex) { /* invalid state object - don't restore anything */ }</span>
<a href="#l32.95"></a><span id="l32.95">     if (!state || !state.windows)</span>
<a href="#l32.96"></a><span id="l32.96">       throw (Components.returnCode = Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l32.97"></a><span id="l32.97"> </span>
<a href="#l32.98"></a><span id="l32.98">     var window = this._getMostRecentBrowserWindow();</span>
<a href="#l32.99"></a><span id="l32.99">     if (!window) {</span>
<a href="#l32.100"></a><span id="l32.100">       this._openWindowWithState(state);</span>
<a href="#l32.101"></a><span id="l32.101" class="difflineat">@@ -741,33 +734,33 @@ SessionStoreService.prototype = {</span>
<a href="#l32.102"></a><span id="l32.102">       return this._toJSONString({ windows: [aWindow.__SS_dyingCache] });</span>
<a href="#l32.103"></a><span id="l32.103">     return this._toJSONString(this._getWindowState(aWindow));</span>
<a href="#l32.104"></a><span id="l32.104">   },</span>
<a href="#l32.105"></a><span id="l32.105"> </span>
<a href="#l32.106"></a><span id="l32.106">   setWindowState: function sss_setWindowState(aWindow, aState, aOverwrite) {</span>
<a href="#l32.107"></a><span id="l32.107">     if (!aWindow.__SSi)</span>
<a href="#l32.108"></a><span id="l32.108">       throw (Components.returnCode = Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l32.109"></a><span id="l32.109"> </span>
<a href="#l32.110"></a><span id="l32.110" class="difflineminus">-    this.restoreWindow(aWindow, &quot;(&quot; + aState + &quot;)&quot;, aOverwrite);</span>
<a href="#l32.111"></a><span id="l32.111" class="difflineplus">+    this.restoreWindow(aWindow, aState, aOverwrite);</span>
<a href="#l32.112"></a><span id="l32.112">   },</span>
<a href="#l32.113"></a><span id="l32.113"> </span>
<a href="#l32.114"></a><span id="l32.114">   getTabState: function sss_getTabState(aTab) {</span>
<a href="#l32.115"></a><span id="l32.115">     if (!aTab.ownerDocument || !aTab.ownerDocument.defaultView.__SSi)</span>
<a href="#l32.116"></a><span id="l32.116">       throw (Components.returnCode = Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l32.117"></a><span id="l32.117"> </span>
<a href="#l32.118"></a><span id="l32.118">     var tabState = this._collectTabData(aTab);</span>
<a href="#l32.119"></a><span id="l32.119"> </span>
<a href="#l32.120"></a><span id="l32.120">     var window = aTab.ownerDocument.defaultView;</span>
<a href="#l32.121"></a><span id="l32.121">     this._updateTextAndScrollDataForTab(window, aTab.linkedBrowser, tabState);</span>
<a href="#l32.122"></a><span id="l32.122"> </span>
<a href="#l32.123"></a><span id="l32.123">     return this._toJSONString(tabState);</span>
<a href="#l32.124"></a><span id="l32.124">   },</span>
<a href="#l32.125"></a><span id="l32.125"> </span>
<a href="#l32.126"></a><span id="l32.126">   setTabState: function sss_setTabState(aTab, aState) {</span>
<a href="#l32.127"></a><span id="l32.127" class="difflineminus">-    var tabState = this._safeEval(&quot;(&quot; + aState + &quot;)&quot;);</span>
<a href="#l32.128"></a><span id="l32.128" class="difflineplus">+    var tabState = JSON.parse(aState);</span>
<a href="#l32.129"></a><span id="l32.129">     if (!tabState.entries || !aTab.ownerDocument || !aTab.ownerDocument.defaultView.__SSi)</span>
<a href="#l32.130"></a><span id="l32.130">       throw (Components.returnCode = Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l32.131"></a><span id="l32.131"> </span>
<a href="#l32.132"></a><span id="l32.132">     var window = aTab.ownerDocument.defaultView;</span>
<a href="#l32.133"></a><span id="l32.133">     this.restoreHistoryPrecursor(window, [aTab], [tabState], 0, 0, 0);</span>
<a href="#l32.134"></a><span id="l32.134">   },</span>
<a href="#l32.135"></a><span id="l32.135"> </span>
<a href="#l32.136"></a><span id="l32.136">   duplicateTab: function sss_duplicateTab(aWindow, aTab) {</span>
<a href="#l32.137"></a><span id="l32.137" class="difflineat">@@ -788,35 +781,35 @@ SessionStoreService.prototype = {</span>
<a href="#l32.138"></a><span id="l32.138">   getClosedTabCount: function sss_getClosedTabCount(aWindow) {</span>
<a href="#l32.139"></a><span id="l32.139">     if (!aWindow.__SSi &amp;&amp; aWindow.__SS_dyingCache)</span>
<a href="#l32.140"></a><span id="l32.140">       return aWindow.__SS_dyingCache._closedTabs.length;</span>
<a href="#l32.141"></a><span id="l32.141"> </span>
<a href="#l32.142"></a><span id="l32.142">     if (!aWindow.__SSi)</span>
<a href="#l32.143"></a><span id="l32.143">       // XXXzeniko shouldn't we throw here?</span>
<a href="#l32.144"></a><span id="l32.144">       return 0; // not a browser window, or not otherwise tracked by SS.</span>
<a href="#l32.145"></a><span id="l32.145"> </span>
<a href="#l32.146"></a><span id="l32.146" class="difflineminus">-    let closedTabs = aWindow.getBrowser().savedBrowsers.map(function(e) { return e.tabData; });</span>
<a href="#l32.147"></a><span id="l32.147" class="difflineplus">+    let closedTabs = this._getClosedTabs(aWindow);</span>
<a href="#l32.148"></a><span id="l32.148">     return closedTabs.length;</span>
<a href="#l32.149"></a><span id="l32.149">   },</span>
<a href="#l32.150"></a><span id="l32.150"> </span>
<a href="#l32.151"></a><span id="l32.151">   getClosedTabData: function sss_getClosedTabDataAt(aWindow) {</span>
<a href="#l32.152"></a><span id="l32.152">     if (!aWindow.__SSi &amp;&amp; !aWindow.__SS_dyingCache)</span>
<a href="#l32.153"></a><span id="l32.153">       throw (Components.returnCode = Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l32.154"></a><span id="l32.154"> </span>
<a href="#l32.155"></a><span id="l32.155">     if (!aWindow.__SSi)</span>
<a href="#l32.156"></a><span id="l32.156">       return this._toJSONString(aWindow.__SS_dyingCache._closedTabs);</span>
<a href="#l32.157"></a><span id="l32.157" class="difflineminus">-    let closedTabs = aWindow.getBrowser().savedBrowsers.map(function(e) { return e.tabData; });</span>
<a href="#l32.158"></a><span id="l32.158" class="difflineplus">+    let closedTabs = this._getClosedTabs(aWindow);</span>
<a href="#l32.159"></a><span id="l32.159">     return this._toJSONString(closedTabs);</span>
<a href="#l32.160"></a><span id="l32.160">   },</span>
<a href="#l32.161"></a><span id="l32.161"> </span>
<a href="#l32.162"></a><span id="l32.162">   undoCloseTab: function sss_undoCloseTab(aWindow, aIndex) {</span>
<a href="#l32.163"></a><span id="l32.163">     if (!aWindow.__SSi)</span>
<a href="#l32.164"></a><span id="l32.164">       throw (Components.returnCode = Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l32.165"></a><span id="l32.165"> </span>
<a href="#l32.166"></a><span id="l32.166" class="difflineminus">-    var closedTabs = aWindow.getBrowser().savedBrowsers.map(function(e) { return e.tabData; });</span>
<a href="#l32.167"></a><span id="l32.167" class="difflineplus">+    var closedTabs = this._getClosedTabs(aWindow);</span>
<a href="#l32.168"></a><span id="l32.168">     // default to the most-recently closed tab</span>
<a href="#l32.169"></a><span id="l32.169"> </span>
<a href="#l32.170"></a><span id="l32.170">     aIndex = aIndex || 0;</span>
<a href="#l32.171"></a><span id="l32.171">     if (!(aIndex in closedTabs))</span>
<a href="#l32.172"></a><span id="l32.172">       throw (Components.returnCode = Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l32.173"></a><span id="l32.173"> </span>
<a href="#l32.174"></a><span id="l32.174">     //var browser = aWindow.getBrowser();</span>
<a href="#l32.175"></a><span id="l32.175">     let browser = aWindow.gBrowser;</span>
<a href="#l32.176"></a><span id="l32.176" class="difflineat">@@ -1481,33 +1474,33 @@ SessionStoreService.prototype = {</span>
<a href="#l32.177"></a><span id="l32.177">     if (!this._isWindowLoaded(aWindow))</span>
<a href="#l32.178"></a><span id="l32.178">       return this._statesToRestore[aWindow.__SS_restoreID];</span>
<a href="#l32.179"></a><span id="l32.179"> </span>
<a href="#l32.180"></a><span id="l32.180">     if (this._loadState == STATE_RUNNING) {</span>
<a href="#l32.181"></a><span id="l32.181">       this._collectWindowData(aWindow);</span>
<a href="#l32.182"></a><span id="l32.182">     }</span>
<a href="#l32.183"></a><span id="l32.183"> </span>
<a href="#l32.184"></a><span id="l32.184">     var total = [this._windows[aWindow.__SSi]];</span>
<a href="#l32.185"></a><span id="l32.185" class="difflineminus">-    total._closedTabs = this._windows[aWindow.__SSi].getBrowser().savedBrowsers.map(function(e) { return e.tabData; });</span>
<a href="#l32.186"></a><span id="l32.186" class="difflineplus">+    total._closedTabs = this._getClosedTabs(this._windows[aWindow.__SSi]);</span>
<a href="#l32.187"></a><span id="l32.187">     this._updateCookies(total);</span>
<a href="#l32.188"></a><span id="l32.188"> </span>
<a href="#l32.189"></a><span id="l32.189">     return { windows: total };</span>
<a href="#l32.190"></a><span id="l32.190">   },</span>
<a href="#l32.191"></a><span id="l32.191"> </span>
<a href="#l32.192"></a><span id="l32.192">   _collectWindowData: function sss_collectWindowData(aWindow) {</span>
<a href="#l32.193"></a><span id="l32.193">     if (!this._isWindowLoaded(aWindow))</span>
<a href="#l32.194"></a><span id="l32.194">       return;</span>
<a href="#l32.195"></a><span id="l32.195"> </span>
<a href="#l32.196"></a><span id="l32.196">     // update the internal state data for this window</span>
<a href="#l32.197"></a><span id="l32.197">     this._saveWindowHistory(aWindow);</span>
<a href="#l32.198"></a><span id="l32.198">     this._updateTextAndScrollData(aWindow);</span>
<a href="#l32.199"></a><span id="l32.199">     this._updateCookieHosts(aWindow);</span>
<a href="#l32.200"></a><span id="l32.200">     this._updateWindowFeatures(aWindow);</span>
<a href="#l32.201"></a><span id="l32.201"> </span>
<a href="#l32.202"></a><span id="l32.202" class="difflineminus">-    this._windows[aWindow.__SSi]._closedTabs = aWindow.getBrowser().savedBrowsers.map(function(e) { return e.tabData; });</span>
<a href="#l32.203"></a><span id="l32.203" class="difflineplus">+    this._windows[aWindow.__SSi]._closedTabs = this._getClosedTabs(aWindow);</span>
<a href="#l32.204"></a><span id="l32.204"> </span>
<a href="#l32.205"></a><span id="l32.205">     this._dirtyWindows[aWindow.__SSi] = false;</span>
<a href="#l32.206"></a><span id="l32.206">   },</span>
<a href="#l32.207"></a><span id="l32.207"> </span>
<a href="#l32.208"></a><span id="l32.208"> /* ........ Restoring Functionality .............. */</span>
<a href="#l32.209"></a><span id="l32.209"> </span>
<a href="#l32.210"></a><span id="l32.210">   /**</span>
<a href="#l32.211"></a><span id="l32.211">    * restore features to a single window</span>
<a href="#l32.212"></a><span id="l32.212" class="difflineat">@@ -1524,17 +1517,17 @@ SessionStoreService.prototype = {</span>
<a href="#l32.213"></a><span id="l32.213">     if (!aFollowUp) {</span>
<a href="#l32.214"></a><span id="l32.214">       this.windowToFocus = aWindow;</span>
<a href="#l32.215"></a><span id="l32.215">     }</span>
<a href="#l32.216"></a><span id="l32.216">     // initialize window if necessary</span>
<a href="#l32.217"></a><span id="l32.217">     if (aWindow &amp;&amp; (!aWindow.__SSi || !this._windows[aWindow.__SSi]))</span>
<a href="#l32.218"></a><span id="l32.218">       this.onLoad(aWindow);</span>
<a href="#l32.219"></a><span id="l32.219"> </span>
<a href="#l32.220"></a><span id="l32.220">     try {</span>
<a href="#l32.221"></a><span id="l32.221" class="difflineminus">-      var root = typeof aState == &quot;string&quot; ? this._safeEval(aState) : aState;</span>
<a href="#l32.222"></a><span id="l32.222" class="difflineplus">+      var root = typeof aState == &quot;string&quot; ? JSON.parse(aState) : aState;</span>
<a href="#l32.223"></a><span id="l32.223">       if (!root.windows[0]) {</span>
<a href="#l32.224"></a><span id="l32.224">         this._notifyIfAllWindowsRestored();</span>
<a href="#l32.225"></a><span id="l32.225">         return; // nothing to restore</span>
<a href="#l32.226"></a><span id="l32.226">       }</span>
<a href="#l32.227"></a><span id="l32.227">     }</span>
<a href="#l32.228"></a><span id="l32.228">     catch (ex) { // invalid state object - don't restore anything</span>
<a href="#l32.229"></a><span id="l32.229">       debug(ex);</span>
<a href="#l32.230"></a><span id="l32.230">       this._notifyIfAllWindowsRestored();</span>
<a href="#l32.231"></a><span id="l32.231" class="difflineat">@@ -1594,20 +1587,19 @@ SessionStoreService.prototype = {</span>
<a href="#l32.232"></a><span id="l32.232">     if (winData.extData) {</span>
<a href="#l32.233"></a><span id="l32.233">       if (aOverwriteTabs  || !this._windows[aWindow.__SSi].extData) {</span>
<a href="#l32.234"></a><span id="l32.234">         this._windows[aWindow.__SSi].extData = {};</span>
<a href="#l32.235"></a><span id="l32.235">       }</span>
<a href="#l32.236"></a><span id="l32.236">       for (var key in winData.extData) {</span>
<a href="#l32.237"></a><span id="l32.237">         this._windows[aWindow.__SSi].extData[key] = winData.extData[key];</span>
<a href="#l32.238"></a><span id="l32.238">       }</span>
<a href="#l32.239"></a><span id="l32.239">     }</span>
<a href="#l32.240"></a><span id="l32.240" class="difflineminus">-    //this is firefox part of code, keeping it for reference only. Will be removed in final patch</span>
<a href="#l32.241"></a><span id="l32.241" class="difflineminus">-    //misak if (winData._closedTabs &amp;&amp; (root._firstTabs || aOverwriteTabs)) {</span>
<a href="#l32.242"></a><span id="l32.242" class="difflineminus">-    //  this._windows[aWindow.__SSi]._closedTabs = winData._closedTabs;</span>
<a href="#l32.243"></a><span id="l32.243" class="difflineminus">-    //}</span>
<a href="#l32.244"></a><span id="l32.244" class="difflineplus">+    if (winData._closedTabs &amp;&amp; (root._firstTabs || aOverwriteTabs)) {</span>
<a href="#l32.245"></a><span id="l32.245" class="difflineplus">+      this._windows[aWindow.__SSi]._closedTabs = winData._closedTabs;</span>
<a href="#l32.246"></a><span id="l32.246" class="difflineplus">+    }</span>
<a href="#l32.247"></a><span id="l32.247"> </span>
<a href="#l32.248"></a><span id="l32.248">     // this part of code should reconstruct savedBrowsers from session</span>
<a href="#l32.249"></a><span id="l32.249">     // file. Commenting out now, will file separate bug for this.</span>
<a href="#l32.250"></a><span id="l32.250">     //if (winData._closedTabs &amp;&amp; (root._firstTabs || aOverwriteTabs)) {</span>
<a href="#l32.251"></a><span id="l32.251">       //aWindow.getBrowser().savedBrowsers.tabData = winData._closedTabs;</span>
<a href="#l32.252"></a><span id="l32.252">       //aWindow.getBrowser().savedBrowsers.map(function(e) { return e.tabData; })</span>
<a href="#l32.253"></a><span id="l32.253">     //  for ( var iix = winData._closedTabs.length - 1; iix &gt;= 0 ; iix--) {</span>
<a href="#l32.254"></a><span id="l32.254">         //aWindow.getBrowser().savedBrowsers[iix].tabData = winData._closedTabs[iix];</span>
<a href="#l32.255"></a><span id="l32.255" class="difflineat">@@ -1671,19 +1663,16 @@ SessionStoreService.prototype = {</span>
<a href="#l32.256"></a><span id="l32.256">         browser.contentDocument.location = &quot;about:blank&quot;;</span>
<a href="#l32.257"></a><span id="l32.257">         continue;</span>
<a href="#l32.258"></a><span id="l32.258">       }</span>
<a href="#l32.259"></a><span id="l32.259"> </span>
<a href="#l32.260"></a><span id="l32.260">       browser.stop(); // in case about:blank isn't done yet</span>
<a href="#l32.261"></a><span id="l32.261"> </span>
<a href="#l32.262"></a><span id="l32.262">       tab.setAttribute(&quot;busy&quot;, &quot;true&quot;);</span>
<a href="#l32.263"></a><span id="l32.263">       tab.removeAttribute(&quot;image&quot;);</span>
<a href="#l32.264"></a><span id="l32.264" class="difflineminus">-      // not implemented in suite - replacing with two lines tabbrowser.setTabTitleLoading(tab);</span>
<a href="#l32.265"></a><span id="l32.265" class="difflineminus">-      // tab.label = this.mStringBundle.getString(&quot;tabs.loading&quot;);</span>
<a href="#l32.266"></a><span id="l32.266" class="difflineminus">-      // tab.setAttribute(&quot;crop&quot;, &quot;end&quot;);</span>
<a href="#l32.267"></a><span id="l32.267"> </span>
<a href="#l32.268"></a><span id="l32.268">       // wall-paper fix for bug 439675: make sure that the URL to be loaded</span>
<a href="#l32.269"></a><span id="l32.269">       // is always visible in the address bar</span>
<a href="#l32.270"></a><span id="l32.270">       let activeIndex = (aTabData[t].index || aTabData[t].entries.length) - 1;</span>
<a href="#l32.271"></a><span id="l32.271">       let activePageData = aTabData[t].entries[activeIndex] || null;</span>
<a href="#l32.272"></a><span id="l32.272">       browser.userTypedValue = activePageData ? activePageData.url || null : null;</span>
<a href="#l32.273"></a><span id="l32.273"> </span>
<a href="#l32.274"></a><span id="l32.274">       // keep the data around to prevent dataloss in case</span>
<a href="#l32.275"></a><span id="l32.275" class="difflineat">@@ -1866,32 +1855,27 @@ SessionStoreService.prototype = {</span>
<a href="#l32.276"></a><span id="l32.276"> </span>
<a href="#l32.277"></a><span id="l32.277">     if (postdata) {</span>
<a href="#l32.278"></a><span id="l32.278">       var stream = Components.classes[&quot;@mozilla.org/io/string-input-stream;1&quot;]</span>
<a href="#l32.279"></a><span id="l32.279">                              .createInstance(Components.interfaces.nsIStringInputStream);</span>
<a href="#l32.280"></a><span id="l32.280">       stream.setData(postdata, postdata.length);</span>
<a href="#l32.281"></a><span id="l32.281">       shEntry.postData = stream;</span>
<a href="#l32.282"></a><span id="l32.282">     }</span>
<a href="#l32.283"></a><span id="l32.283"> </span>
<a href="#l32.284"></a><span id="l32.284" class="difflineminus">-    if (aEntry.owner_b64) {  // Firefox 3</span>
<a href="#l32.285"></a><span id="l32.285" class="difflineplus">+    if (aEntry.owner_b64) {</span>
<a href="#l32.286"></a><span id="l32.286">       var ownerInput = Components.classes[&quot;@mozilla.org/io/string-input-stream;1&quot;]</span>
<a href="#l32.287"></a><span id="l32.287">                                  .createInstance(Components.interfaces.nsIStringInputStream);</span>
<a href="#l32.288"></a><span id="l32.288">       var binaryData = atob(aEntry.owner_b64);</span>
<a href="#l32.289"></a><span id="l32.289">       ownerInput.setData(binaryData, binaryData.length);</span>
<a href="#l32.290"></a><span id="l32.290">       var binaryStream = Components.classes[&quot;@mozilla.org/binaryinputstream;1&quot;]</span>
<a href="#l32.291"></a><span id="l32.291">                                    .createInstance(Components.interfaces.nsIObjectInputStream);</span>
<a href="#l32.292"></a><span id="l32.292">       binaryStream.setInputStream(ownerInput);</span>
<a href="#l32.293"></a><span id="l32.293">       try { // Catch possible deserialization exceptions</span>
<a href="#l32.294"></a><span id="l32.294">         shEntry.owner = binaryStream.readObject(true);</span>
<a href="#l32.295"></a><span id="l32.295">       } catch (ex) { debug(ex); }</span>
<a href="#l32.296"></a><span id="l32.296" class="difflineminus">-    } else if (aEntry.ownerURI) { // Firefox 2</span>
<a href="#l32.297"></a><span id="l32.297" class="difflineminus">-      var uriObj = ioService.newURI(aEntry.ownerURI, null, null);</span>
<a href="#l32.298"></a><span id="l32.298" class="difflineminus">-      shEntry.owner = Components.classes[&quot;@mozilla.org/scriptsecuritymanager;1&quot;]</span>
<a href="#l32.299"></a><span id="l32.299" class="difflineminus">-                                .getService(Components.interfaces.nsIScriptSecurityManager)</span>
<a href="#l32.300"></a><span id="l32.300" class="difflineminus">-                                .getCodebasePrincipal(uriObj);</span>
<a href="#l32.301"></a><span id="l32.301">     }</span>
<a href="#l32.302"></a><span id="l32.302"> </span>
<a href="#l32.303"></a><span id="l32.303">     if (aEntry.children &amp;&amp; shEntry instanceof Components.interfaces.nsISHContainer) {</span>
<a href="#l32.304"></a><span id="l32.304">       for (var i = 0; i &lt; aEntry.children.length; i++) {</span>
<a href="#l32.305"></a><span id="l32.305">         shEntry.AddChild(this._deserializeHistoryEntry(aEntry.children[i], aIdMap), i);</span>
<a href="#l32.306"></a><span id="l32.306">       }</span>
<a href="#l32.307"></a><span id="l32.307">     }</span>
<a href="#l32.308"></a><span id="l32.308"> </span>
<a href="#l32.309"></a><span id="l32.309" class="difflineat">@@ -1929,35 +1913,16 @@ SessionStoreService.prototype = {</span>
<a href="#l32.310"></a><span id="l32.310">     if (!aEvent || !aEvent.originalTarget || !aEvent.originalTarget.defaultView || aEvent.originalTarget.defaultView != aEvent.originalTarget.defaultView.top) {</span>
<a href="#l32.311"></a><span id="l32.311">       return;</span>
<a href="#l32.312"></a><span id="l32.312">     }</span>
<a href="#l32.313"></a><span id="l32.313"> </span>
<a href="#l32.314"></a><span id="l32.314">     // always call this before injecting content into a document!</span>
<a href="#l32.315"></a><span id="l32.315">     function hasExpectedURL(aDocument, aURL)</span>
<a href="#l32.316"></a><span id="l32.316">       !aURL || aURL.replace(/#.*/, &quot;&quot;) == aDocument.location.href.replace(/#.*/, &quot;&quot;);</span>
<a href="#l32.317"></a><span id="l32.317"> </span>
<a href="#l32.318"></a><span id="l32.318" class="difflineminus">-    // restore text data saved by SeaMonkey</span>
<a href="#l32.319"></a><span id="l32.319" class="difflineminus">-    var textArray = this.__SS_restore_text ? this.__SS_restore_text.split(&quot; &quot;) : [];</span>
<a href="#l32.320"></a><span id="l32.320" class="difflineminus">-    function restoreTextData(aContent, aPrefix, aURL) {</span>
<a href="#l32.321"></a><span id="l32.321" class="difflineminus">-      textArray.forEach(function(aEntry) {</span>
<a href="#l32.322"></a><span id="l32.322" class="difflineminus">-        if (/^((?:\d+\|)*)(#?)([^\s=]+)=(.*)$/.test(aEntry) &amp;&amp;</span>
<a href="#l32.323"></a><span id="l32.323" class="difflineminus">-            RegExp.$1 == aPrefix &amp;&amp; hasExpectedURL(aContent.document, aURL)) {</span>
<a href="#l32.324"></a><span id="l32.324" class="difflineminus">-          var document = aContent.document;</span>
<a href="#l32.325"></a><span id="l32.325" class="difflineminus">-          var node = RegExp.$2 ? document.getElementById(RegExp.$3) : document.getElementsByName(RegExp.$3)[0] || null;</span>
<a href="#l32.326"></a><span id="l32.326" class="difflineminus">-          if (node &amp;&amp; &quot;value&quot; in node &amp;&amp; node.type != &quot;file&quot;) {</span>
<a href="#l32.327"></a><span id="l32.327" class="difflineminus">-            node.value = decodeURI(RegExp.$4);</span>
<a href="#l32.328"></a><span id="l32.328" class="difflineminus">-</span>
<a href="#l32.329"></a><span id="l32.329" class="difflineminus">-            var event = document.createEvent(&quot;UIEvents&quot;);</span>
<a href="#l32.330"></a><span id="l32.330" class="difflineminus">-            event.initUIEvent(&quot;input&quot;, true, true, aContent, 0);</span>
<a href="#l32.331"></a><span id="l32.331" class="difflineminus">-            node.dispatchEvent(event);</span>
<a href="#l32.332"></a><span id="l32.332" class="difflineminus">-          }</span>
<a href="#l32.333"></a><span id="l32.333" class="difflineminus">-        }</span>
<a href="#l32.334"></a><span id="l32.334" class="difflineminus">-      });</span>
<a href="#l32.335"></a><span id="l32.335" class="difflineminus">-    }</span>
<a href="#l32.336"></a><span id="l32.336" class="difflineminus">-</span>
<a href="#l32.337"></a><span id="l32.337">     function restoreFormData(aDocument, aData, aURL) {</span>
<a href="#l32.338"></a><span id="l32.338">       for (let key in aData) {</span>
<a href="#l32.339"></a><span id="l32.339">         if (!hasExpectedURL(aDocument, aURL))</span>
<a href="#l32.340"></a><span id="l32.340">           return;</span>
<a href="#l32.341"></a><span id="l32.341"> </span>
<a href="#l32.342"></a><span id="l32.342">         let node = key.charAt(0) == &quot;#&quot; ? aDocument.getElementById(key.slice(1)) :</span>
<a href="#l32.343"></a><span id="l32.343">                                           XPathHelper.resolve(aDocument, key);</span>
<a href="#l32.344"></a><span id="l32.344">         if (!node)</span>
<a href="#l32.345"></a><span id="l32.345" class="difflineat">@@ -1991,18 +1956,16 @@ SessionStoreService.prototype = {</span>
<a href="#l32.346"></a><span id="l32.346">       }</span>
<a href="#l32.347"></a><span id="l32.347">     }</span>
<a href="#l32.348"></a><span id="l32.348"> </span>
<a href="#l32.349"></a><span id="l32.349">     let selectedPageStyle = this.__SS_restore_pageStyle;</span>
<a href="#l32.350"></a><span id="l32.350">     let window = this.ownerDocument.defaultView;</span>
<a href="#l32.351"></a><span id="l32.351">     function restoreTextDataAndScrolling(aContent, aData, aPrefix) {</span>
<a href="#l32.352"></a><span id="l32.352">       if (aData.formdata)</span>
<a href="#l32.353"></a><span id="l32.353">         restoreFormData(aContent.document, aData.formdata, aData.url);</span>
<a href="#l32.354"></a><span id="l32.354" class="difflineminus">-      else</span>
<a href="#l32.355"></a><span id="l32.355" class="difflineminus">-        restoreTextData(aContent, aPrefix, aData.url);</span>
<a href="#l32.356"></a><span id="l32.356">       if (aData.innerHTML) {</span>
<a href="#l32.357"></a><span id="l32.357">         window.setTimeout(function() {</span>
<a href="#l32.358"></a><span id="l32.358">           if (aContent.document.designMode == &quot;on&quot; &amp;&amp;</span>
<a href="#l32.359"></a><span id="l32.359">               hasExpectedURL(aContent.document, aData.url)) {</span>
<a href="#l32.360"></a><span id="l32.360">             aContent.document.body.innerHTML = aData.innerHTML;</span>
<a href="#l32.361"></a><span id="l32.361">           }</span>
<a href="#l32.362"></a><span id="l32.362">         }, 0);</span>
<a href="#l32.363"></a><span id="l32.363">       }</span>
<a href="#l32.364"></a><span id="l32.364" class="difflineat">@@ -2214,17 +2177,17 @@ SessionStoreService.prototype = {</span>
<a href="#l32.365"></a><span id="l32.365"> </span>
<a href="#l32.366"></a><span id="l32.366">   /**</span>
<a href="#l32.367"></a><span id="l32.367">    * write a state object to disk</span>
<a href="#l32.368"></a><span id="l32.368">    */</span>
<a href="#l32.369"></a><span id="l32.369">   _saveStateObject: function sss_saveStateObject(aStateObj) {</span>
<a href="#l32.370"></a><span id="l32.370">     var stateString = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l32.371"></a><span id="l32.371">                                 .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l32.372"></a><span id="l32.372">     // parentheses are for backwards compatibility with older sessionstore files</span>
<a href="#l32.373"></a><span id="l32.373" class="difflineminus">-    stateString.data = &quot;(&quot; + this._toJSONString(aStateObj) + &quot;)&quot;;</span>
<a href="#l32.374"></a><span id="l32.374" class="difflineplus">+    stateString.data = this._toJSONString(aStateObj);</span>
<a href="#l32.375"></a><span id="l32.375"> </span>
<a href="#l32.376"></a><span id="l32.376">     var observerService = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l32.377"></a><span id="l32.377">                                     .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l32.378"></a><span id="l32.378">     observerService.notifyObservers(stateString, &quot;sessionstore-state-write&quot;, &quot;&quot;);</span>
<a href="#l32.379"></a><span id="l32.379"> </span>
<a href="#l32.380"></a><span id="l32.380">     // don't touch the file if an observer has deleted all state data</span>
<a href="#l32.381"></a><span id="l32.381">     if (stateString.data)</span>
<a href="#l32.382"></a><span id="l32.382">       this._writeFile(this._sessionFile, stateString.data);</span>
<a href="#l32.383"></a><span id="l32.383" class="difflineat">@@ -2375,29 +2338,16 @@ SessionStoreService.prototype = {</span>
<a href="#l32.384"></a><span id="l32.384"> </span>
<a href="#l32.385"></a><span id="l32.385">     if (aWindow.windowState == aWindow.STATE_NORMAL) {</span>
<a href="#l32.386"></a><span id="l32.386">       return dimension;</span>
<a href="#l32.387"></a><span id="l32.387">     }</span>
<a href="#l32.388"></a><span id="l32.388">     return aWindow.document.documentElement.getAttribute(aAttribute) || dimension;</span>
<a href="#l32.389"></a><span id="l32.389">   },</span>
<a href="#l32.390"></a><span id="l32.390"> </span>
<a href="#l32.391"></a><span id="l32.391">   /**</span>
<a href="#l32.392"></a><span id="l32.392" class="difflineminus">-   * Convenience method to get localized string bundles</span>
<a href="#l32.393"></a><span id="l32.393" class="difflineminus">-   * @param aURI</span>
<a href="#l32.394"></a><span id="l32.394" class="difflineminus">-   * @returns nsIStringBundle</span>
<a href="#l32.395"></a><span id="l32.395" class="difflineminus">-   */</span>
<a href="#l32.396"></a><span id="l32.396" class="difflineminus">-  _getStringBundle: function sss_getStringBundle(aURI) {</span>
<a href="#l32.397"></a><span id="l32.397" class="difflineminus">-     var bundleService = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l32.398"></a><span id="l32.398" class="difflineminus">-                                   .getService(Components.interfaces.nsIStringBundleService);</span>
<a href="#l32.399"></a><span id="l32.399" class="difflineminus">-     var appLocale = Components.classes[&quot;@mozilla.org/intl/nslocaleservice;1&quot;]</span>
<a href="#l32.400"></a><span id="l32.400" class="difflineminus">-                               .getService(Components.interfaces.nsILocaleService).getApplicationLocale();</span>
<a href="#l32.401"></a><span id="l32.401" class="difflineminus">-     return bundleService.createBundle(aURI, appLocale);</span>
<a href="#l32.402"></a><span id="l32.402" class="difflineminus">-  },</span>
<a href="#l32.403"></a><span id="l32.403" class="difflineminus">-</span>
<a href="#l32.404"></a><span id="l32.404" class="difflineminus">-  /**</span>
<a href="#l32.405"></a><span id="l32.405">    * Get nsIURI from string</span>
<a href="#l32.406"></a><span id="l32.406">    * @param string</span>
<a href="#l32.407"></a><span id="l32.407">    * @returns nsIURI</span>
<a href="#l32.408"></a><span id="l32.408">    */</span>
<a href="#l32.409"></a><span id="l32.409">   _getURIFromString: function sss_getURIFromString(aString) {</span>
<a href="#l32.410"></a><span id="l32.410">     var ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l32.411"></a><span id="l32.411">                               .getService(Components.interfaces.nsIIOService);</span>
<a href="#l32.412"></a><span id="l32.412">     return ioService.newURI(aString, null, null);</span>
<a href="#l32.413"></a><span id="l32.413" class="difflineat">@@ -2457,23 +2407,16 @@ SessionStoreService.prototype = {</span>
<a href="#l32.414"></a><span id="l32.414">                      (Date.now() - aState.session.lastUpdate);</span>
<a href="#l32.415"></a><span id="l32.415"> </span>
<a href="#l32.416"></a><span id="l32.416">     return max_resumed_crashes != -1 &amp;&amp;</span>
<a href="#l32.417"></a><span id="l32.417">            (aRecentCrashes &gt; max_resumed_crashes ||</span>
<a href="#l32.418"></a><span id="l32.418">             sessionAge &amp;&amp; sessionAge &gt;= SIX_HOURS_IN_MS);</span>
<a href="#l32.419"></a><span id="l32.419">   },</span>
<a href="#l32.420"></a><span id="l32.420"> </span>
<a href="#l32.421"></a><span id="l32.421">   /**</span>
<a href="#l32.422"></a><span id="l32.422" class="difflineminus">-   * safe eval'ing</span>
<a href="#l32.423"></a><span id="l32.423" class="difflineminus">-   */</span>
<a href="#l32.424"></a><span id="l32.424" class="difflineminus">-  _safeEval: function sss_safeEval(aStr) {</span>
<a href="#l32.425"></a><span id="l32.425" class="difflineminus">-    return Components.utils.evalInSandbox(aStr, new Components.utils.Sandbox(&quot;about:blank&quot;));</span>
<a href="#l32.426"></a><span id="l32.426" class="difflineminus">-  },</span>
<a href="#l32.427"></a><span id="l32.427" class="difflineminus">-</span>
<a href="#l32.428"></a><span id="l32.428" class="difflineminus">-  /**</span>
<a href="#l32.429"></a><span id="l32.429">    * Converts a JavaScript object into a JSON string</span>
<a href="#l32.430"></a><span id="l32.430">    * (see http://www.json.org/ for more information).</span>
<a href="#l32.431"></a><span id="l32.431">    *</span>
<a href="#l32.432"></a><span id="l32.432">    * The inverse operation consists of JSON.parse(JSON_string).</span>
<a href="#l32.433"></a><span id="l32.433">    *</span>
<a href="#l32.434"></a><span id="l32.434">    * @param aJSObject is the object to be converted</span>
<a href="#l32.435"></a><span id="l32.435">    * @returns the object's JSON representation</span>
<a href="#l32.436"></a><span id="l32.436">    */</span>
<a href="#l32.437"></a><span id="l32.437" class="difflineat">@@ -2500,16 +2443,25 @@ SessionStoreService.prototype = {</span>
<a href="#l32.438"></a><span id="l32.438">    *        Window reference</span>
<a href="#l32.439"></a><span id="l32.439">    * @returns whether this window's data is still cached in _statesToRestore</span>
<a href="#l32.440"></a><span id="l32.440">    *          because it's not fully loaded yet</span>
<a href="#l32.441"></a><span id="l32.441">    */</span>
<a href="#l32.442"></a><span id="l32.442">   _isWindowLoaded: function sss_isWindowLoaded(aWindow) {</span>
<a href="#l32.443"></a><span id="l32.443">     return !aWindow.__SS_restoreID;</span>
<a href="#l32.444"></a><span id="l32.444">   },</span>
<a href="#l32.445"></a><span id="l32.445"> </span>
<a href="#l32.446"></a><span id="l32.446" class="difflineplus">+  /**</span>
<a href="#l32.447"></a><span id="l32.447" class="difflineplus">+   * gets SeaMonkey's closed tabs</span>
<a href="#l32.448"></a><span id="l32.448" class="difflineplus">+   * param aWindow</span>
<a href="#l32.449"></a><span id="l32.449" class="difflineplus">+   *       Window reference</span>
<a href="#l32.450"></a><span id="l32.450" class="difflineplus">+   */</span>
<a href="#l32.451"></a><span id="l32.451" class="difflineplus">+  _getClosedTabs: function sss_getClosedTabs(aWindow) {</span>
<a href="#l32.452"></a><span id="l32.452" class="difflineplus">+    return aWindow.getBrowser().savedBrowsers.map(function(e) { return e.tabData; });</span>
<a href="#l32.453"></a><span id="l32.453" class="difflineplus">+  },</span>
<a href="#l32.454"></a><span id="l32.454" class="difflineplus">+</span>
<a href="#l32.455"></a><span id="l32.455"> /* ........ Storage API .............. */</span>
<a href="#l32.456"></a><span id="l32.456"> </span>
<a href="#l32.457"></a><span id="l32.457">   /**</span>
<a href="#l32.458"></a><span id="l32.458">    * write file to disk</span>
<a href="#l32.459"></a><span id="l32.459">    * @param aFile</span>
<a href="#l32.460"></a><span id="l32.460">    *        nsIFile</span>
<a href="#l32.461"></a><span id="l32.461">    * @param aData</span>
<a href="#l32.462"></a><span id="l32.462">    *        String data</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/suite/themes/classic/communicator/mac/toolbar.css</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/suite/themes/classic/communicator/mac/toolbar.css</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -47,17 +47,17 @@</span>
<a href="#l33.4"></a><span id="l33.4"> </span>
<a href="#l33.5"></a><span id="l33.5"> toolbar {</span>
<a href="#l33.6"></a><span id="l33.6">   background: none;</span>
<a href="#l33.7"></a><span id="l33.7">   -moz-appearance: none;</span>
<a href="#l33.8"></a><span id="l33.8">   border-top: 1px solid rgba(255,255,255,0.45);</span>
<a href="#l33.9"></a><span id="l33.9">   border-bottom: 1px solid rgba(0,0,0,0.35);</span>
<a href="#l33.10"></a><span id="l33.10"> }</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-toolbar:not([nowindowdrag=&quot;true&quot;]) {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+toolbar:not([nowindowdrag=&quot;true&quot;]):not([type=&quot;menubar&quot;]) {</span>
<a href="#l33.14"></a><span id="l33.14">   -moz-binding: url(&quot;chrome://communicator/content/bindings/toolbar.xml#grippytoolbar-drag&quot;);</span>
<a href="#l33.15"></a><span id="l33.15"> }</span>
<a href="#l33.16"></a><span id="l33.16"> </span>
<a href="#l33.17"></a><span id="l33.17"> .toolbar-holder {</span>
<a href="#l33.18"></a><span id="l33.18">   border-left: 1px solid ThreeDHighlight;</span>
<a href="#l33.19"></a><span id="l33.19"> }</span>
<a href="#l33.20"></a><span id="l33.20"> </span>
<a href="#l33.21"></a><span id="l33.21"> /* ::::: toolbargrippy ::::: */</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

