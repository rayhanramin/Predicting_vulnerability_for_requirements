<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 4207:4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135" />
<meta property="og:url" content="/comm-central/rev/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135" />
<meta property="og:description" content="Bug 472764 - &quot;gloda full-text search always uses SQLite's porter stemmer without regard to effective locale, etc.&quot; &quot;patch v5&quot; [r=asuth, sr=bienvenu, a=blocking-thunderbird3]" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135">shortlog</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135">files</a> |
changeset |
<a href="/comm-central/raw-rev/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135">raw</a>  | <a href="/comm-central/archive/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=472764">Bug 472764</a> - &quot;gloda full-text search always uses SQLite's porter stemmer without regard to effective locale, etc.&quot; &quot;patch v5&quot; [r=asuth, sr=bienvenu, a=blocking-thunderbird3]
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#107;&#111;&#116;&#111;&#32;&#75;&#97;&#116;&#111;&#32;&#60;&#109;&#95;&#107;&#97;&#116;&#111;&#64;&#103;&#97;&#50;&#46;&#115;&#111;&#45;&#110;&#101;&#116;&#46;&#110;&#101;&#46;&#106;&#112;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 20 Oct 2009 17:52:00 -0700</td></tr>

<tr>
 <td>changeset 4207</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135">4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135</a></td>
</tr>



<tr>
<td>parent 4206</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/839c5e5860263f87fd415092513a1b38947b3ff4">839c5e5860263f87fd415092513a1b38947b3ff4</a>
</td>
</tr>

<tr>
<td>child 4208</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1ef3fd69325ae769bc160626d0cd92257b619cc1">1ef3fd69325ae769bc160626d0cd92257b619cc1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135">3288</a></td></tr>
<tr><td>push user</td><td>bugmail@asutherland.org</td></tr>
<tr><td>push date</td><td class="date age">Wed, 21 Oct 2009 00:52:32 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@810cd547ef75 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=810cd547ef753c1f4c68838c6708c7f1f052340a">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=810cd547ef753c1f4c68838c6708c7f1f052340a&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=810cd547ef753c1f4c68838c6708c7f1f052340a&newProject=comm-central&newRevision=4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=810cd547ef753c1f4c68838c6708c7f1f052340a&newProject=comm-central&newRevision=4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=810cd547ef753c1f4c68838c6708c7f1f052340a&newProject=comm-central&newRevision=4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28asuth%29&revcount=50">asuth</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a>, <a href="/comm-central/log?rev=reviewer%28blocking-thunderbird3%29&revcount=50">blocking-thunderbird3</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=472764">472764</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=472764">Bug 472764</a> - &quot;gloda full-text search always uses SQLite's porter stemmer without regard to effective locale, etc.&quot; &quot;patch v5&quot; [r=asuth, sr=bienvenu, a=blocking-thunderbird3]</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mail/installer/windows/packages-static">mail/installer/windows/packages-static</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mail/installer/windows/packages-static">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mail/installer/windows/packages-static">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mail/installer/windows/packages-static">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mail/installer/windows/packages-static">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mail/installer/windows/packages-static">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/Makefile.in">mailnews/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/nsMailModule.cpp">mailnews/build/nsMailModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/nsMailModule.cpp">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/nsMailModule.cpp">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/nsMailModule.cpp">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/nsMailModule.cpp">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/build/nsMailModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/datastore.js">mailnews/db/gloda/modules/datastore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/datastore.js">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/datastore.js">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/datastore.js">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/datastore.js">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/datastore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/msg_search.js">mailnews/db/gloda/modules/msg_search.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/msg_search.js">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/msg_search.js">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/msg_search.js">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/msg_search.js">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/modules/msg_search.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/test/unit/test_intl.js">mailnews/db/gloda/test/unit/test_intl.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/test/unit/test_intl.js">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/test/unit/test_intl.js">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/test/unit/test_intl.js">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/test/unit/test_intl.js">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/db/gloda/test/unit/test_intl.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/Makefile.in">mailnews/extensions/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/Makefile.in">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/Makefile.in">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/Makefile.in">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/Makefile.in">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/Makefile.in">mailnews/extensions/fts3/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/Makefile.in">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/Makefile.in">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/Makefile.in">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/Makefile.in">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/Makefile.in">mailnews/extensions/fts3/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/nsFts3TokenizerFactory.cpp">mailnews/extensions/fts3/build/nsFts3TokenizerFactory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/nsFts3TokenizerFactory.cpp">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/nsFts3TokenizerFactory.cpp">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/nsFts3TokenizerFactory.cpp">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/nsFts3TokenizerFactory.cpp">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/build/nsFts3TokenizerFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/Makefile.in">mailnews/extensions/fts3/public/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/Makefile.in">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/Makefile.in">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/Makefile.in">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/Makefile.in">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/nsIFts3Tokenizer.idl">mailnews/extensions/fts3/public/nsIFts3Tokenizer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/nsIFts3Tokenizer.idl">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/nsIFts3Tokenizer.idl">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/nsIFts3Tokenizer.idl">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/nsIFts3Tokenizer.idl">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/public/nsIFts3Tokenizer.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/Makefile.in">mailnews/extensions/fts3/src/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/Makefile.in">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/Makefile.in">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/README.mozilla">mailnews/extensions/fts3/src/README.mozilla</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/README.mozilla">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/README.mozilla">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/README.mozilla">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/README.mozilla">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/README.mozilla">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_porter.c">mailnews/extensions/fts3/src/fts3_porter.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_porter.c">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_porter.c">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_porter.c">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_porter.c">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_porter.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_tokenizer.h">mailnews/extensions/fts3/src/fts3_tokenizer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_tokenizer.h">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_tokenizer.h">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_tokenizer.h">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_tokenizer.h">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/fts3_tokenizer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.cpp">mailnews/extensions/fts3/src/nsFts3Tokenizer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.cpp">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.cpp">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.cpp">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.cpp">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.h">mailnews/extensions/fts3/src/nsFts3Tokenizer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.h">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.h">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.h">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.h">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3Tokenizer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3TokenizerCID.h">mailnews/extensions/fts3/src/nsFts3TokenizerCID.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3TokenizerCID.h">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3TokenizerCID.h">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3TokenizerCID.h">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3TokenizerCID.h">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/extensions/fts3/src/nsFts3TokenizerCID.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/makefiles.sh">mailnews/makefiles.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/makefiles.sh">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/makefiles.sh">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/makefiles.sh">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/makefiles.sh">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/mailnews/makefiles.sh">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/unix/packages">suite/installer/unix/packages</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/unix/packages">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/unix/packages">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/unix/packages">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/unix/packages">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/unix/packages">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/windows/packages">suite/installer/windows/packages</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/windows/packages">file</a> |
<a href="/comm-central/annotate/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/windows/packages">annotate</a> |
<a href="/comm-central/diff/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/windows/packages">diff</a> |
<a href="/comm-central/comparison/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/windows/packages">comparison</a> |
<a href="/comm-central/log/4aab2fb7d9e1a218fe2d6bb666f54ffdcbff9135/suite/installer/windows/packages">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/installer/windows/packages-static</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/installer/windows/packages-static</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -77,16 +77,17 @@ bin\defaults\profile\localstore.rdf</span>
<a href="#l1.4"></a><span id="l1.4"> bin\defaults\profile\prefs.js</span>
<a href="#l1.5"></a><span id="l1.5"> bin\defaults\profile\mimeTypes.rdf</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> bin\isp\*</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> bin\components\aboutRights.js</span>
<a href="#l1.10"></a><span id="l1.10"> bin\components\activity.xpt</span>
<a href="#l1.11"></a><span id="l1.11"> bin\components\addrbook.xpt</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+bin\components\fts3tok.xpt</span>
<a href="#l1.13"></a><span id="l1.13"> bin\components\mime.xpt</span>
<a href="#l1.14"></a><span id="l1.14"> bin\components\steel.xpt</span>
<a href="#l1.15"></a><span id="l1.15"> bin\components\msgbase.xpt</span>
<a href="#l1.16"></a><span id="l1.16"> bin\components\msgcompo.xpt</span>
<a href="#l1.17"></a><span id="l1.17"> bin\components\msgdb.xpt</span>
<a href="#l1.18"></a><span id="l1.18"> bin\components\msgimap.xpt</span>
<a href="#l1.19"></a><span id="l1.19"> bin\components\msglocal.xpt</span>
<a href="#l1.20"></a><span id="l1.20"> bin\components\msgnews.xpt</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/build/Makefile.in</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/build/Makefile.in</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -64,16 +64,17 @@ MODULE_NAME	= nsMailModule</span>
<a href="#l2.4"></a><span id="l2.4"> REQUIRES	= xpcom \</span>
<a href="#l2.5"></a><span id="l2.5"> 		  addrbook \</span>
<a href="#l2.6"></a><span id="l2.6"> 		  appcomps \</span>
<a href="#l2.7"></a><span id="l2.7"> 		  toolkitcomps \</span>
<a href="#l2.8"></a><span id="l2.8"> 		  content \</span>
<a href="#l2.9"></a><span id="l2.9"> 		  dom \</span>
<a href="#l2.10"></a><span id="l2.10"> 		  docshell \</span>
<a href="#l2.11"></a><span id="l2.11"> 		  editor \</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+		  fts3tok \</span>
<a href="#l2.13"></a><span id="l2.13"> 		  gfx \</span>
<a href="#l2.14"></a><span id="l2.14"> 		  intl \</span>
<a href="#l2.15"></a><span id="l2.15"> 	     	  locale \</span>
<a href="#l2.16"></a><span id="l2.16"> 		  layout \</span>
<a href="#l2.17"></a><span id="l2.17"> 		  lwbrk \</span>
<a href="#l2.18"></a><span id="l2.18"> 	          mailview \</span>
<a href="#l2.19"></a><span id="l2.19"> 	          msglocal \</span>
<a href="#l2.20"></a><span id="l2.20"> 		  msgcompose \</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -84,16 +85,17 @@ REQUIRES	= xpcom \</span>
<a href="#l2.22"></a><span id="l2.22"> 		  mime \</span>
<a href="#l2.23"></a><span id="l2.23"> 		  mork \</span>
<a href="#l2.24"></a><span id="l2.24"> 		  necko \</span>
<a href="#l2.25"></a><span id="l2.25"> 		  nkcache \</span>
<a href="#l2.26"></a><span id="l2.26"> 		  pref \</span>
<a href="#l2.27"></a><span id="l2.27"> 		  rdf \</span>
<a href="#l2.28"></a><span id="l2.28"> 		  rdfutil \</span>
<a href="#l2.29"></a><span id="l2.29"> 		  string \</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+		  sqlite3 \</span>
<a href="#l2.31"></a><span id="l2.31"> 		  txmgr \</span>
<a href="#l2.32"></a><span id="l2.32"> 		  widget \</span>
<a href="#l2.33"></a><span id="l2.33"> 		  webbrwsr \</span>
<a href="#l2.34"></a><span id="l2.34"> 		  uconv \</span>
<a href="#l2.35"></a><span id="l2.35"> 		  uriloader \</span>
<a href="#l2.36"></a><span id="l2.36"> 		  $(ZLIB_REQUIRES) \</span>
<a href="#l2.37"></a><span id="l2.37"> 		  $(NULL)</span>
<a href="#l2.38"></a><span id="l2.38"> </span>
<a href="#l2.39"></a><span id="l2.39" class="difflineat">@@ -122,16 +124,17 @@ SHARED_LIBRARY_LIBS = \</span>
<a href="#l2.40"></a><span id="l2.40"> 	        ../compose/src/$(LIB_PREFIX)msgcompose_s.$(LIB_SUFFIX) \</span>
<a href="#l2.41"></a><span id="l2.41"> 	        ../db/msgdb/src/$(LIB_PREFIX)msgdb_s.$(LIB_SUFFIX) \</span>
<a href="#l2.42"></a><span id="l2.42"> 	        ../imap/src/$(LIB_PREFIX)msgimap_s.$(LIB_SUFFIX) \</span>
<a href="#l2.43"></a><span id="l2.43"> 	        ../addrbook/src/$(LIB_PREFIX)addrbook_s.$(LIB_SUFFIX) \</span>
<a href="#l2.44"></a><span id="l2.44"> 	        ../news/src/$(LIB_PREFIX)msgnews_s.$(LIB_SUFFIX) \</span>
<a href="#l2.45"></a><span id="l2.45"> 	        ../mime/src/$(LIB_PREFIX)mime_s.$(LIB_SUFFIX) \</span>
<a href="#l2.46"></a><span id="l2.46"> 	        ../mime/emitters/src/$(LIB_PREFIX)emitterutil_s.$(LIB_SUFFIX) \</span>
<a href="#l2.47"></a><span id="l2.47"> 	        ../extensions/bayesian-spam-filter/src/$(LIB_PREFIX)bayesflt_s.$(LIB_SUFFIX) \</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+	        ../extensions/fts3/src/$(LIB_PREFIX)fts3tok_s.$(LIB_SUFFIX) \</span>
<a href="#l2.49"></a><span id="l2.49"> 	        ../extensions/mailviews/src/$(LIB_PREFIX)mailview_s.$(LIB_SUFFIX) \</span>
<a href="#l2.50"></a><span id="l2.50">                 ../extensions/mdn/src/$(LIB_PREFIX)msgmdn_s.$(LIB_SUFFIX) \</span>
<a href="#l2.51"></a><span id="l2.51">                 ../mime/cthandlers/vcard/$(LIB_PREFIX)vcard_s.$(LIB_SUFFIX) \</span>
<a href="#l2.52"></a><span id="l2.52">                 ../mime/cthandlers/glue/$(LIB_PREFIX)mimecthglue_s.$(LIB_SUFFIX) \</span>
<a href="#l2.53"></a><span id="l2.53">                 $(NULL)</span>
<a href="#l2.54"></a><span id="l2.54"> </span>
<a href="#l2.55"></a><span id="l2.55"> ifdef MOZILLA_INTERNAL_API</span>
<a href="#l2.56"></a><span id="l2.56"> EXTRA_DSO_LDOPTS = \</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineat">@@ -167,16 +170,17 @@ LOCAL_INCLUDES = -I$(srcdir) \</span>
<a href="#l2.58"></a><span id="l2.58">                  -I$(srcdir)/../addrbook/src \</span>
<a href="#l2.59"></a><span id="l2.59">                  -I$(srcdir)/../imap/src \</span>
<a href="#l2.60"></a><span id="l2.60">                  -I$(srcdir)/../compose/src \</span>
<a href="#l2.61"></a><span id="l2.61">                  -I$(srcdir)/../base/search/src \</span>
<a href="#l2.62"></a><span id="l2.62">                  -I$(srcdir)/../mime/src \</span>
<a href="#l2.63"></a><span id="l2.63">                  -I$(srcdir)/../mime/emitters/src \</span>
<a href="#l2.64"></a><span id="l2.64">                  -I$(srcdir)/../news/src \</span>
<a href="#l2.65"></a><span id="l2.65">                  -I$(srcdir)/../extensions/bayesian-spam-filter/src \</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+                 -I$(srcdir)/../extensions/fts3/src \</span>
<a href="#l2.67"></a><span id="l2.67">                  -I$(srcdir)/../extensions/mailviews/src \</span>
<a href="#l2.68"></a><span id="l2.68">                  -I$(srcdir)/../extensions/mdn/src \</span>
<a href="#l2.69"></a><span id="l2.69">                  $(NULL)</span>
<a href="#l2.70"></a><span id="l2.70"> </span>
<a href="#l2.71"></a><span id="l2.71"> include $(topsrcdir)/config/rules.mk</span>
<a href="#l2.72"></a><span id="l2.72"> </span>
<a href="#l2.73"></a><span id="l2.73"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l2.74"></a><span id="l2.74"> OS_LIBS	+= $(call EXPAND_LIBNAME,shell32)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/build/nsMailModule.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/build/nsMailModule.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -311,16 +311,22 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsMsgMdnCID.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsMsgMdnGenerator.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.8"></a><span id="l3.8"> // vcard includes</span>
<a href="#l3.9"></a><span id="l3.9"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsMimeContentTypeHandler.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+// FTS3 Tokenizer</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+#include &quot;nsFts3TokenizerCID.h&quot;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+#include &quot;nsFts3Tokenizer.h&quot;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+</span>
<a href="#l3.18"></a><span id="l3.18"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.19"></a><span id="l3.19"> // mailnews base factories</span>
<a href="#l3.20"></a><span id="l3.20"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.21"></a><span id="l3.21"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMessengerBootstrap)</span>
<a href="#l3.22"></a><span id="l3.22"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgMailSession, Init)</span>
<a href="#l3.23"></a><span id="l3.23"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMessenger)</span>
<a href="#l3.24"></a><span id="l3.24"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgAccountManager, Init)</span>
<a href="#l3.25"></a><span id="l3.25"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMsgAccount)</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineat">@@ -514,16 +520,20 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsMimeHea</span>
<a href="#l3.27"></a><span id="l3.27"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.28"></a><span id="l3.28"> // mime emitter factories</span>
<a href="#l3.29"></a><span id="l3.29"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.30"></a><span id="l3.30"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMimeRawEmitter)</span>
<a href="#l3.31"></a><span id="l3.31"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMimeXmlEmitter)</span>
<a href="#l3.32"></a><span id="l3.32"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMimePlainEmitter)</span>
<a href="#l3.33"></a><span id="l3.33"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMimeHtmlDisplayEmitter, Init)</span>
<a href="#l3.34"></a><span id="l3.34"> </span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR(nsFts3Tokenizer)</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+</span>
<a href="#l3.39"></a><span id="l3.39"> static NS_METHOD RegisterMimeEmitter(nsIComponentManager *aCompMgr, nsIFile *aPath, const char *registryLocation,</span>
<a href="#l3.40"></a><span id="l3.40">                                      const char *componentType, const nsModuleComponentInfo *info)</span>
<a href="#l3.41"></a><span id="l3.41"> {</span>
<a href="#l3.42"></a><span id="l3.42">   nsresult rv;</span>
<a href="#l3.43"></a><span id="l3.43">   nsCOMPtr&lt;nsICategoryManager&gt; catman = do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l3.44"></a><span id="l3.44">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.45"></a><span id="l3.45">   nsCString previous;</span>
<a href="#l3.46"></a><span id="l3.46">   return catman-&gt;AddCategoryEntry(&quot;mime-emitter&quot;, info-&gt;mContractID, info-&gt;mContractID,</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineat">@@ -1265,16 +1275,22 @@ static const nsModuleComponentInfo gComp</span>
<a href="#l3.48"></a><span id="l3.48">       NS_MSGMDNGENERATOR_CONTRACTID, nsMsgMdnGeneratorConstructor },</span>
<a href="#l3.49"></a><span id="l3.49"> </span>
<a href="#l3.50"></a><span id="l3.50">     ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.51"></a><span id="l3.51">     // mdn  components</span>
<a href="#l3.52"></a><span id="l3.52">     ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.53"></a><span id="l3.53">     { &quot;MIME VCard Handler&quot;, NS_VCARD_CONTENT_TYPE_HANDLER_CID, &quot;@mozilla.org/mimecth;1?type=text/x-vcard&quot;,</span>
<a href="#l3.54"></a><span id="l3.54">        nsVCardMimeContentTypeHandlerConstructor, },</span>
<a href="#l3.55"></a><span id="l3.55"> </span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+    ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+    // FTS3 tokenizer components</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+    ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+    { &quot;FTS3 Tokenier&quot;, NS_FTS3TOKENIZER_CID,</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+      NS_FTS3TOKENIZER_CONTRACTID, nsFts3TokenizerConstructor },</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+</span>
<a href="#l3.62"></a><span id="l3.62"> #ifdef MOZ_SUITE</span>
<a href="#l3.63"></a><span id="l3.63">     ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.64"></a><span id="l3.64">     // suite general startup</span>
<a href="#l3.65"></a><span id="l3.65">     ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.66"></a><span id="l3.66">     { &quot;Address Book Manager Startup Handler&quot;, NS_ABMANAGER_CID,</span>
<a href="#l3.67"></a><span id="l3.67">       NS_ABMANAGERSTARTUPHANDLER_CONTRACTID, nsAbManagerConstructor },</span>
<a href="#l3.68"></a><span id="l3.68">     { &quot;Compose Service&quot;, NS_MSGCOMPOSESERVICE_CID,</span>
<a href="#l3.69"></a><span id="l3.69">       NS_MSGCOMPOSESTARTUPHANDLER_CONTRACTID, nsMsgComposeServiceConstructor },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/db/gloda/modules/datastore.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/datastore.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -503,17 +503,17 @@ var GlodaDatastore = {</span>
<a href="#l4.4"></a><span id="l4.4">   kConstraintIn: 1,</span>
<a href="#l4.5"></a><span id="l4.5">   kConstraintRanges: 2,</span>
<a href="#l4.6"></a><span id="l4.6">   kConstraintEquals: 3,</span>
<a href="#l4.7"></a><span id="l4.7">   kConstraintStringLike: 4,</span>
<a href="#l4.8"></a><span id="l4.8">   kConstraintFulltext: 5,</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">   /* ******************* SCHEMA ******************* */</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  _schemaVersion: 13,</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  _schemaVersion: 14,</span>
<a href="#l4.14"></a><span id="l4.14">   _schema: {</span>
<a href="#l4.15"></a><span id="l4.15">     tables: {</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">       // ----- Messages</span>
<a href="#l4.18"></a><span id="l4.18">       folderLocations: {</span>
<a href="#l4.19"></a><span id="l4.19">         columns: [</span>
<a href="#l4.20"></a><span id="l4.20">           [&quot;id&quot;, &quot;INTEGER PRIMARY KEY&quot;],</span>
<a href="#l4.21"></a><span id="l4.21">           [&quot;folderURI&quot;, &quot;TEXT NOT NULL&quot;],</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -737,16 +737,21 @@ var GlodaDatastore = {</span>
<a href="#l4.23"></a><span id="l4.23">     // It does exist, but we (someday) might need to upgrade the schema</span>
<a href="#l4.24"></a><span id="l4.24">     else {</span>
<a href="#l4.25"></a><span id="l4.25">       // (Exceptions may be thrown if the database is corrupt)</span>
<a href="#l4.26"></a><span id="l4.26">       { // try {</span>
<a href="#l4.27"></a><span id="l4.27">         dbConnection = dbService.openUnsharedDatabase(dbFile);</span>
<a href="#l4.28"></a><span id="l4.28">         // see _createDB...</span>
<a href="#l4.29"></a><span id="l4.29">         dbConnection.executeSimpleSQL(&quot;PRAGMA cache_size = 8192&quot;);</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+        // Register custom tokenizer to index all language text</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+        var tokenizer = Cc[&quot;@mozilla.org/messenger/fts3tokenizer;1&quot;].</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+                          getService(Ci.nsIFts3Tokenizer);</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+        tokenizer.registerTokenizer(dbConnection);</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+</span>
<a href="#l4.36"></a><span id="l4.36">         if (dbConnection.schemaVersion != this._schemaVersion) {</span>
<a href="#l4.37"></a><span id="l4.37">           this._log.debug(&quot;Need to migrate database.  (DB version: &quot; +</span>
<a href="#l4.38"></a><span id="l4.38">             dbConnection.schemaVersion + &quot; desired version: &quot; +</span>
<a href="#l4.39"></a><span id="l4.39">             this._schemaVersion);</span>
<a href="#l4.40"></a><span id="l4.40">           dbConnection = this._migrate(dbService, dbFile,</span>
<a href="#l4.41"></a><span id="l4.41">                                        dbConnection,</span>
<a href="#l4.42"></a><span id="l4.42">                                        dbConnection.schemaVersion,</span>
<a href="#l4.43"></a><span id="l4.43">                                        this._schemaVersion);</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineat">@@ -858,16 +863,20 @@ var GlodaDatastore = {</span>
<a href="#l4.45"></a><span id="l4.45">     //  windows).  Increasing the page size to 4096 increases the actual byte</span>
<a href="#l4.46"></a><span id="l4.46">     //  turnover significantly for rollback journals than a page size of 1024,</span>
<a href="#l4.47"></a><span id="l4.47">     //  and since the rollback journal has to be fsynced, that is undesirable.</span>
<a href="#l4.48"></a><span id="l4.48">     dbConnection.executeSimpleSQL(&quot;PRAGMA page_size = 1024&quot;);</span>
<a href="#l4.49"></a><span id="l4.49">     // This is a maximum number of pages to be used.  If the database does not</span>
<a href="#l4.50"></a><span id="l4.50">     //  get this large, then the memory does not get used.</span>
<a href="#l4.51"></a><span id="l4.51">     // Do not forget to update the code in _init if you change this value.</span>
<a href="#l4.52"></a><span id="l4.52">     dbConnection.executeSimpleSQL(&quot;PRAGMA cache_size = 8192&quot;);</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+    // Register custom tokenizer to index all language text</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+    var tokenizer = Cc[&quot;@mozilla.org/messenger/fts3tokenizer;1&quot;].</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+                      getService(Ci.nsIFts3Tokenizer);</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+    tokenizer.registerTokenizer(dbConnection);</span>
<a href="#l4.57"></a><span id="l4.57"> </span>
<a href="#l4.58"></a><span id="l4.58">     dbConnection.beginTransaction();</span>
<a href="#l4.59"></a><span id="l4.59">     try {</span>
<a href="#l4.60"></a><span id="l4.60">       this._createSchema(dbConnection);</span>
<a href="#l4.61"></a><span id="l4.61">       dbConnection.commitTransaction();</span>
<a href="#l4.62"></a><span id="l4.62">     }</span>
<a href="#l4.63"></a><span id="l4.63">     catch(ex) {</span>
<a href="#l4.64"></a><span id="l4.64">       dbConnection.rollbackTransaction();</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineat">@@ -883,17 +892,17 @@ var GlodaDatastore = {</span>
<a href="#l4.66"></a><span id="l4.66">     this._log.info(&quot;Creating table: &quot; + aTableName);</span>
<a href="#l4.67"></a><span id="l4.67">     aDBConnection.createTable(aTableName,</span>
<a href="#l4.68"></a><span id="l4.68">       [(coldef[0] + &quot; &quot; + coldef[1]) for each</span>
<a href="#l4.69"></a><span id="l4.69">        ([i, coldef] in Iterator(aTableDef.columns))].join(&quot;, &quot;));</span>
<a href="#l4.70"></a><span id="l4.70"> </span>
<a href="#l4.71"></a><span id="l4.71">     // - Create the fulltext table if applicable</span>
<a href="#l4.72"></a><span id="l4.72">     if (aTableDef.fulltextColumns) {</span>
<a href="#l4.73"></a><span id="l4.73">       let createFulltextSQL = &quot;CREATE VIRTUAL TABLE &quot; + aTableName + &quot;Text&quot; +</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-        &quot; USING fts3(tokenize porter, &quot; +</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+        &quot; USING fts3(tokenize mozporter, &quot; +</span>
<a href="#l4.76"></a><span id="l4.76">         [(coldef[0] + &quot; &quot; + coldef[1]) for each</span>
<a href="#l4.77"></a><span id="l4.77">          ([i, coldef] in Iterator(aTableDef.fulltextColumns))].join(&quot;, &quot;) +</span>
<a href="#l4.78"></a><span id="l4.78">         &quot;)&quot;;</span>
<a href="#l4.79"></a><span id="l4.79">       this._log.info(&quot;Creating fulltext table: &quot; + createFulltextSQL);</span>
<a href="#l4.80"></a><span id="l4.80">       aDBConnection.executeSimpleSQL(createFulltextSQL);</span>
<a href="#l4.81"></a><span id="l4.81">     }</span>
<a href="#l4.82"></a><span id="l4.82"> </span>
<a href="#l4.83"></a><span id="l4.83">     // - Create its indices</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineat">@@ -989,17 +998,19 @@ var GlodaDatastore = {</span>
<a href="#l4.85"></a><span id="l4.85">     // - note that I screwed up and failed to mark the schema change; apparently</span>
<a href="#l4.86"></a><span id="l4.86">     //   no database will claim to be version 13...</span>
<a href="#l4.87"></a><span id="l4.87">     // version 14:</span>
<a href="#l4.88"></a><span id="l4.88">     // - new attributes: forwarded, repliedTo, bcc, recipients</span>
<a href="#l4.89"></a><span id="l4.89">     // - altered fromMeTo and fromMeCc to fromMe</span>
<a href="#l4.90"></a><span id="l4.90">     // - altered toMe and ccMe to just be toMe</span>
<a href="#l4.91"></a><span id="l4.91">     // - exposes bcc to cc-related attributes</span>
<a href="#l4.92"></a><span id="l4.92">     // - MIME type DB schema overhaul</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-    if (aCurVersion &lt; 14) {</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+    // version 15:</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+    // - change tokenizer to mozporter to support CJK</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+    if (aCurVersion &lt; 15) {</span>
<a href="#l4.97"></a><span id="l4.97">       aDBConnection.close();</span>
<a href="#l4.98"></a><span id="l4.98">       aDBFile.remove(false);</span>
<a href="#l4.99"></a><span id="l4.99">       this._log.warn(&quot;Global database has been purged due to schema change.&quot;);</span>
<a href="#l4.100"></a><span id="l4.100">       return this._createDB(aDBService, aDBFile);</span>
<a href="#l4.101"></a><span id="l4.101">     }</span>
<a href="#l4.102"></a><span id="l4.102"> </span>
<a href="#l4.103"></a><span id="l4.103">     aDBConnection.schemaVersion = aNewVersion;</span>
<a href="#l4.104"></a><span id="l4.104"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/db/gloda/modules/msg_search.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/msg_search.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -249,21 +249,51 @@ GlodaMsgSearcher.prototype = {</span>
<a href="#l5.4"></a><span id="l5.4">       explicitSQL: FULLTEXT_QUERY_EXPLICIT_SQL,</span>
<a href="#l5.5"></a><span id="l5.5">       // osets is 0-based column number 14 (volatile to column changes)</span>
<a href="#l5.6"></a><span id="l5.6">       // dascore becomes 0-based column number 15</span>
<a href="#l5.7"></a><span id="l5.7">       outerWrapColumns: [DASCORE_SQL_SNIPPET + &quot; AS dascore&quot;],</span>
<a href="#l5.8"></a><span id="l5.8">       // save the offset column for extra analysis</span>
<a href="#l5.9"></a><span id="l5.9">       stashColumns: [14]</span>
<a href="#l5.10"></a><span id="l5.10">     });</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+    // CJK character is indexed by bi-gram, so we need split it if CJK</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    let querywords = new Array();</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+    this.fulltextTerms.forEach(function (term) {</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+        let lastpos = 0;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+        let code;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+        for (var i = 1; i &lt; term.length - 1; i++) {</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+            code = term.charCodeAt(i);</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+            // not CJK. Don't use bi-gram</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+            if (code &lt; 0x2000 || (code &gt;= 0xa000 &amp;&amp; c &lt; 0xac00))</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+                continue;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+            // bi-gram search text</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+            querywords.push(term.substring(lastpos, i+1));</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+            lastpos = i;</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+        }</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+        if (term.length) {</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+            let querylast = term.substring(lastpos);</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+            if (querylast.length == 1) {</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+               code = querylast.charCodeAt(0);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+               if (code &gt;= 0x2000 &amp;&amp; !(code &gt;= 0xa000 &amp;&amp; code &lt; 0xac00))</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+               // Users uses just 1 character as search string.</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+               // We have to consider it  for CJK (there is 1 character word in CJK)</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+               querylast += &quot;*&quot;;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+            }</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+            querywords.push(querylast);</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+        }</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+    });</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+</span>
<a href="#l5.41"></a><span id="l5.41">     let fulltextQueryString;</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+</span>
<a href="#l5.43"></a><span id="l5.43">     if (this.andTerms)</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-      fulltextQueryString = '&quot;' + this.fulltextTerms.join('&quot; &quot;') + '&quot;';</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+      fulltextQueryString = '&quot;' + querywords.join('&quot; &quot;') + '&quot;';</span>
<a href="#l5.46"></a><span id="l5.46">     else</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-      fulltextQueryString = '&quot;' + this.fulltextTerms.join('&quot; OR &quot;') + '&quot;';</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+      fulltextQueryString = '&quot;' + querywords.join('&quot; OR &quot;') + '&quot;';</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50">     query.fulltextMatches(fulltextQueryString);</span>
<a href="#l5.51"></a><span id="l5.51">     query.orderBy(this.sortBy);</span>
<a href="#l5.52"></a><span id="l5.52">     query.limit(this.retrievalLimit);</span>
<a href="#l5.53"></a><span id="l5.53"> </span>
<a href="#l5.54"></a><span id="l5.54">     return query;</span>
<a href="#l5.55"></a><span id="l5.55">   },</span>
<a href="#l5.56"></a><span id="l5.56"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_intl.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_intl.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -21,16 +21,18 @@ var intlPhrases = [</span>
<a href="#l6.4"></a><span id="l6.4">       'euc-jp': ['=?shift-jis?b?jqmTrppTid2LQA==?=',</span>
<a href="#l6.5"></a><span id="l6.5">                  '\xbc\xab\xc6\xb0\xd3\xb4\xb2\xdf\xb5\xa1'],</span>
<a href="#l6.6"></a><span id="l6.6">       'shift-jis': ['=?shift-jis?b?jqmTrppTid2LQA==?=',</span>
<a href="#l6.7"></a><span id="l6.7">                     '\x8e\xa9\x93\xae\x9aS\x89\xdd\x8b@']</span>
<a href="#l6.8"></a><span id="l6.8">     }</span>
<a href="#l6.9"></a><span id="l6.9">   }</span>
<a href="#l6.10"></a><span id="l6.10"> ];</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+var resultList = [];</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+</span>
<a href="#l6.14"></a><span id="l6.14"> /**</span>
<a href="#l6.15"></a><span id="l6.15">  * For each phrase in the intlPhrases array (we are parameterized over it using</span>
<a href="#l6.16"></a><span id="l6.16">  *  parameterizeTest in the 'tests' declaration), create a message where the</span>
<a href="#l6.17"></a><span id="l6.17">  *  subject, body, and attachment name are populated using the encodings in</span>
<a href="#l6.18"></a><span id="l6.18">  *  the phrase's &quot;encodings&quot; attribute, one encoding per message.  Make sure</span>
<a href="#l6.19"></a><span id="l6.19">  *  that the strings as exposed by the gloda representation are equal to the</span>
<a href="#l6.20"></a><span id="l6.20">  *  expected/actual value.</span>
<a href="#l6.21"></a><span id="l6.21">  */</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -46,16 +48,17 @@ function test_index(aPhrase) {</span>
<a href="#l6.23"></a><span id="l6.23">       attachments: [</span>
<a href="#l6.24"></a><span id="l6.24">         {filename: quoted, body: &quot;gabba gabba hey&quot;},</span>
<a href="#l6.25"></a><span id="l6.25">       ],</span>
<a href="#l6.26"></a><span id="l6.26">       // save off the actual value for checking</span>
<a href="#l6.27"></a><span id="l6.27">       callerData: [charset, aPhrase.actual]</span>
<a href="#l6.28"></a><span id="l6.28">     });</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30">     messages.push(smsg);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+    resultList.push(smsg);</span>
<a href="#l6.32"></a><span id="l6.32">   }</span>
<a href="#l6.33"></a><span id="l6.33"> </span>
<a href="#l6.34"></a><span id="l6.34">   indexMessages(messages, verify_index, next_test);</span>
<a href="#l6.35"></a><span id="l6.35"> }</span>
<a href="#l6.36"></a><span id="l6.36"> </span>
<a href="#l6.37"></a><span id="l6.37"> /**</span>
<a href="#l6.38"></a><span id="l6.38">  * Does the per-message verification for test_index.  Knows what is right for</span>
<a href="#l6.39"></a><span id="l6.39">  *  each message because of the callerData attribute on the synthetic message.</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineat">@@ -71,19 +74,29 @@ function verify_index(smsg, gmsg) {</span>
<a href="#l6.41"></a><span id="l6.41">   LOG.debug(&quot;body: &quot; + indexedBodyText +</span>
<a href="#l6.42"></a><span id="l6.42">       &quot; (len: &quot; + indexedBodyText.length + &quot;)&quot;);</span>
<a href="#l6.43"></a><span id="l6.43">   do_check_eq(actual, indexedBodyText);</span>
<a href="#l6.44"></a><span id="l6.44">   LOG.debug(&quot;attachment name:&quot; + attachmentName +</span>
<a href="#l6.45"></a><span id="l6.45">       &quot; (len: &quot; + attachmentName.length + &quot;)&quot;);</span>
<a href="#l6.46"></a><span id="l6.46">   do_check_eq(actual, attachmentName);</span>
<a href="#l6.47"></a><span id="l6.47"> }</span>
<a href="#l6.48"></a><span id="l6.48"> </span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+function test_intl_fulltextsearch()</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+{</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+  var query = Gloda.newQuery(Gloda.NOUN_MESSAGE);</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+  /* CJK text is bi-gram */</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+  query.bodyMatches('\u81ea\u52d5');</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+  queryExpect(query, resultList);</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+}</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+</span>
<a href="#l6.58"></a><span id="l6.58"> /* ===== Driver ===== */</span>
<a href="#l6.59"></a><span id="l6.59"> </span>
<a href="#l6.60"></a><span id="l6.60"> var tests = [</span>
<a href="#l6.61"></a><span id="l6.61">   parameterizeTest(test_index, intlPhrases),</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+  test_intl_fulltextsearch,</span>
<a href="#l6.63"></a><span id="l6.63"> ];</span>
<a href="#l6.64"></a><span id="l6.64"> </span>
<a href="#l6.65"></a><span id="l6.65"> function run_test() {</span>
<a href="#l6.66"></a><span id="l6.66">   // use mbox injection because the fake server chokes sometimes right now</span>
<a href="#l6.67"></a><span id="l6.67">   injectMessagesUsing(INJECT_MBOX);</span>
<a href="#l6.68"></a><span id="l6.68">   glodaHelperRunTests(tests);</span>
<a href="#l6.69"></a><span id="l6.69"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/extensions/Makefile.in</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/extensions/Makefile.in</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -38,17 +38,17 @@</span>
<a href="#l7.4"></a><span id="l7.4"> DEPTH		= ../..</span>
<a href="#l7.5"></a><span id="l7.5"> topsrcdir	= @top_srcdir@</span>
<a href="#l7.6"></a><span id="l7.6"> srcdir		= @srcdir@</span>
<a href="#l7.7"></a><span id="l7.7"> VPATH		= @srcdir@</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> # these extensions are not optional</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-PARALLEL_DIRS	= mdn mailviews bayesian-spam-filter offline-startup newsblog</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+PARALLEL_DIRS	= mdn mailviews bayesian-spam-filter offline-startup newsblog fts3</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15"> ifdef MOZ_PSM</span>
<a href="#l7.16"></a><span id="l7.16"> BUILD_SMIME=1</span>
<a href="#l7.17"></a><span id="l7.17"> endif</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19"> ifdef BUILD_SMIME</span>
<a href="#l7.20"></a><span id="l7.20"> PARALLEL_DIRS	+= smime</span>
<a href="#l7.21"></a><span id="l7.21"> endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/mailnews/extensions/fts3/Makefile.in</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,55 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+#</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+#</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+#</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+# License.</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+#</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+# The Original Code is mozilla.org code.</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+#</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+# Mozilla Japan.</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+#</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+# Contributor(s):</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+#   Makoto Kato &lt;m_kato@ga2.so-net.ne.jp&gt;</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+#</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+#</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+DEPTH		= ../../..</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+topsrcdir	= @top_srcdir@</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+srcdir		= @srcdir@</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+VPATH		= @srcdir@</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+include $(DEPTH)/config/autoconf.mk</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+MODULE		= fts3tok</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+PARALLEL_DIRS	= public src</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+ifndef MOZ_STATIC_MAIL_BUILD</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+DIRS	= build</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+endif</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mailnews/extensions/fts3/build/Makefile.in</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,92 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+#</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+#</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+#</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+# License.</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+#</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+# The Original Code is mozilla.org code.</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+#</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+# Mozilla Japan.</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+#</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+# Contributor(s):</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+#   Makoto Kato &lt;m_kato@ga2.so-net.ne.jp&gt;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+#</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+#</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+DEPTH		= ../../../..</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+topsrcdir	= @top_srcdir@</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+srcdir		= @srcdir@</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+VPATH		= @srcdir@</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+include $(DEPTH)/config/autoconf.mk</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+MODULE		= fts3tok</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+LIBRARY_NAME	= fts3tok</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+META_COMPONENT = mail</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+EXPORT_LIBRARY = 1</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+SHORT_LIBNAME	= fts3tok</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+IS_COMPONENT	= 1</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+MODULE_NAME	= nsFts3TokenizerModule</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+ifndef MOZ_INCOMPLETE_EXTERNAL_LINKAGE</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+MOZILLA_INTERNAL_API = 1</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+endif</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+REQUIRES	= xpcom \</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+		  string \</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+		  sqlite3 \</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+		  storage \</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+		  $(NULL)</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+ifeq ($(USE_SHORT_LIBNAME),1)</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+EXTRA_DSO_LIBS = msgbsutl</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+else</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+EXTRA_DSO_LIBS = msgbaseutil</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+endif</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+CPPSRCS		= nsFts3TokenizerFactory.cpp</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+LOCAL_INCLUDES += -I$(srcdir)/../src</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+SHARED_LIBRARY_LIBS = \</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+		../src/$(LIB_PREFIX)fts3tok_s.$(LIB_SUFFIX) \</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+		$(NULL)</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+ifdef MOZILLA_INTERNAL_API</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+EXTRA_DSO_LDOPTS = \</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+		$(LIBS_DIR) \</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+		$(EXTRA_DSO_LIBS) \</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+		$(MOZ_COMPONENT_LIBS) \</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+		$(NULL)</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+else</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+EXTRA_DSO_LDOPTS = \</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+	$(LIBS_DIR) \</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+	$(EXTRA_DSO_LIBS) \</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+	$(XPCOM_GLUE_LDOPTS) \</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+	$(NSPR_LIBS) \</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+	$(NULL)</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+endif</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/mailnews/extensions/fts3/build/nsFts3TokenizerFactory.cpp</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,61 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+ *</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+ *</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+ * License.</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+ *</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+ * The Original Code is mozilla.org code.</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+ *</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+ * Mozilla Japan.</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+ *</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+ * Contributor(s):</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+ *   Makoto Kato &lt;m_kato@ga2.so-net.ne.jp&gt;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+ *</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+ * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+ * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+ *</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+#include &quot;nsISupports.h&quot;</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+#include &quot;nsIFactory.h&quot;</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+#include &quot;nsIGenericFactory.h&quot;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+#include &quot;nsIModule.h&quot;</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+#include &quot;nsFts3TokenizerCID.h&quot;</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+#include &quot;nsFts3Tokenizer.h&quot;</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR(nsFts3Tokenizer)</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+static const nsModuleComponentInfo components[] =</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+{</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+    {&quot;FTS3 Tokenizer&quot;,</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+     NS_FTS3TOKENIZER_CID,</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+     NS_FTS3TOKENIZER_CONTRACTID,</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+     nsFts3TokenizerConstructor}</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+};</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+NS_IMPL_NSGETMODULE(nsFts3TokenizerModule, components)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/mailnews/extensions/fts3/public/Makefile.in</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,52 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+#</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+#</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+#</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+# License.</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+#</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+# The Original Code is mozilla.org code.</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+#</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+# Mozilla Japan.</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+#</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+# Contributor(s):</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+#   Makoto Kato &lt;m_kato@ga2.so-net.ne.jp&gt;</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+#</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+#</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+DEPTH		= ../../../..</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+topsrcdir	= @top_srcdir@</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+srcdir		= @srcdir@</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+VPATH		= @srcdir@</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+include $(DEPTH)/config/autoconf.mk</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+MODULE		= fts3tok</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+XPIDLSRCS	= \</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+		nsIFts3Tokenizer.idl \</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+		$(NULL)</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/mailnews/extensions/fts3/public/nsIFts3Tokenizer.idl</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,48 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+ *</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+ *</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+ * License.</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+ *</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+ * The Original Code is mozilla.org code.</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+ *</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+ * Mozilla Japan.</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+ *</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+ * Contributor(s):</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+ *   Makoto Kato &lt;m_kato@ga2.so-net.ne.jp&gt;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+ *</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+ * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+ * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+ *</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+#include &quot;nsISupports.idl&quot;</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+interface mozIStorageConnection;</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+[scriptable, uuid(136c88ea-7003-4fe8-8835-333fd18e598c)]</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+interface nsIFts3Tokenizer : nsISupports {</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+    // register FTS3 tokenizer module for &quot;mozporter&quot; tokenizer</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+    // mozporter is based by porter tokenizer with bi-gram tokenizer for CJK</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+    void registerTokenizer(in mozIStorageConnection connection);</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/mailnews/extensions/fts3/src/Makefile.in</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,74 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+#</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+#</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+#</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+# License.</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+#</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+# The Original Code is mozilla.org code.</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+#</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+# Mozilla Japan.</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+#</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+# Contributor(s):</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+#   Makoto Kato &lt;m_kato@ga2.so-net.ne.jp&gt;</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+#</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+#</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+DEPTH		= ../../../..</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+topsrcdir       = @top_srcdir@</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+srcdir          = @srcdir@</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+VPATH           = @srcdir@</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+include $(DEPTH)/config/autoconf.mk</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+MODULE		= fts3tok</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+LIBRARY_NAME	= fts3tok_s</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+META_COMPONENT = mail</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+ifndef MOZ_INCOMPLETE_EXTERNAL_LINKAGE</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+MOZILLA_INTERNAL_API = 1</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+endif</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+REQUIRES	= \</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+		xpcom \</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+		string \</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+		sqlite3 \</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+		storage \</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+		$(NULL)</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+CPPSRCS		= \</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+		nsFts3Tokenizer.cpp \</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+		$(NULL)</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+CSRCS		= \</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+		fts3_porter.c \</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+		$(NULL)</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+LOCAL_INCLUDES = \</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+		$(SQLITE_CFLAGS)</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+# we don't want the shared lib, but we want to force the creation of a static lib.</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+FORCE_STATIC_LIB = 1</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/mailnews/extensions/fts3/src/README.mozilla</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+fts3_porter.c code is from SQLite3.</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+This customized tokenizer &quot;mozporter&quot; by Mozilla supports CJK indexing using bi-gram. So you have to use bi-gram search string if you wanto to search CJK character.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- /dev/null</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ b/mailnews/extensions/fts3/src/fts3_porter.c</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -0,0 +1,768 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineplus">+/*</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+** 2006 September 30</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+**</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineplus">+** The author disclaims copyright to this source code.  In place of</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineplus">+** a legal notice, here is a blessing:</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+**</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+**    May you do good and not evil.</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+**    May you find forgiveness for yourself and forgive others.</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+**    May you share freely, never taking more than you give.</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+**</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+*************************************************************************</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+** Implementation of the full-text-search tokenizer that implements</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+** a Porter stemmer.</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+*/</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+/*</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+** The code in this file is only compiled if:</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+**</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+**     * The FTS3 module is being built as an extension</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+**       (in which case SQLITE_CORE is not defined), or</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+**</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+**     * The FTS3 module is being built into the core of</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+**       SQLite (in which case SQLITE_ENABLE_FTS3 is defined).</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineplus">+*/</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+#if !defined(SQLITE_CORE) || defined(SQLITE_ENABLE_FTS3)</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+#include &lt;assert.h&gt;</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+#include &lt;stdlib.h&gt;</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+#include &lt;stdio.h&gt;</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+#include &lt;string.h&gt;</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+#include &lt;ctype.h&gt;</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+#include &quot;fts3_tokenizer.h&quot;</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+/* need some defined to compile without sqlite3 code */</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+#define sqlite3_malloc malloc</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+#define sqlite3_free free</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+#define sqlite3_realloc realloc</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+static const unsigned char sqlite3Utf8Trans1[] = {</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineplus">+  0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+  0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineplus">+  0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f,</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+  0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineplus">+  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+  0x00, 0x01, 0x02, 0x03, 0x00, 0x01, 0x00, 0x00,</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineplus">+};</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineplus">+</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+#define READ_UTF8(zIn, zTerm, c)                           \</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+  c = *(zIn++);                                            \</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineplus">+  if( c&gt;=0xc0 ){                                           \</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineplus">+    c = sqlite3Utf8Trans1[c-0xc0];                         \</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineplus">+    while( zIn!=zTerm &amp;&amp; (*zIn &amp; 0xc0)==0x80 ){            \</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineplus">+      c = (c&lt;&lt;6) + (0x3f &amp; *(zIn++));                      \</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineplus">+    }                                                      \</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+    if( c&lt;0x80                                             \</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineplus">+        || (c&amp;0xFFFFF800)==0xD800                          \</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineplus">+        || (c&amp;0xFFFFFFFE)==0xFFFE ){  c = 0xFFFD; }        \</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineplus">+  }</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineplus">+</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+/* end of compatible block to complie codes */</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineplus">+</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+/*</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineplus">+** Class derived from sqlite3_tokenizer</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineplus">+*/</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+typedef struct porter_tokenizer {</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineplus">+  sqlite3_tokenizer base;      /* Base class */</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineplus">+} porter_tokenizer;</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineplus">+</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+/*</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+** Class derived from sqlit3_tokenizer_cursor</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+*/</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+typedef struct porter_tokenizer_cursor {</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+  sqlite3_tokenizer_cursor base;</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+  const char *zInput;          /* input we are tokenizing */</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+  int nInput;                  /* size of the input */</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineplus">+  int iOffset;                 /* current position in zInput */</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+  int iToken;                  /* index of next token to be returned */</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineplus">+  char *zToken;                /* storage for current token */</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+  int nAllocated;              /* space allocated to zToken buffer */</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+  int iPrevBigramOffset;       /* previous result was bi-gram */</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+} porter_tokenizer_cursor;</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineplus">+/* Forward declaration */</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineplus">+static const sqlite3_tokenizer_module porterTokenizerModule;</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineplus">+</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineplus">+</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+/*</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineplus">+** Create a new tokenizer instance.</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineplus">+*/</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineplus">+static int porterCreate(</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineplus">+  int argc, const char * const *argv,</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineplus">+  sqlite3_tokenizer **ppTokenizer</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineplus">+){</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineplus">+  porter_tokenizer *t;</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineplus">+  t = (porter_tokenizer *) sqlite3_malloc(sizeof(*t));</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineplus">+  if( t==NULL ) return SQLITE_NOMEM;</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineplus">+  memset(t, 0, sizeof(*t));</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineplus">+  *ppTokenizer = &amp;t-&gt;base;</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineplus">+  return SQLITE_OK;</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineplus">+}</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineplus">+</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineplus">+/*</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineplus">+** Destroy a tokenizer</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineplus">+*/</span>
<a href="#l15.115"></a><span id="l15.115" class="difflineplus">+static int porterDestroy(sqlite3_tokenizer *pTokenizer){</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineplus">+  sqlite3_free(pTokenizer);</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineplus">+  return SQLITE_OK;</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineplus">+}</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineplus">+</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineplus">+/*</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineplus">+** Prepare to begin tokenizing a particular string.  The input</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineplus">+** string to be tokenized is zInput[0..nInput-1].  A cursor</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+** used to incrementally tokenize this string is returned in </span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+** *ppCursor.</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineplus">+*/</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineplus">+static int porterOpen(</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineplus">+  sqlite3_tokenizer *pTokenizer,         /* The tokenizer */</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineplus">+  const char *zInput, int nInput,        /* String to be tokenized */</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineplus">+  sqlite3_tokenizer_cursor **ppCursor    /* OUT: Tokenization cursor */</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineplus">+){</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineplus">+  porter_tokenizer_cursor *c;</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineplus">+</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineplus">+  c = (porter_tokenizer_cursor *) sqlite3_malloc(sizeof(*c));</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineplus">+  if( c==NULL ) return SQLITE_NOMEM;</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineplus">+</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineplus">+  c-&gt;zInput = zInput;</span>
<a href="#l15.137"></a><span id="l15.137" class="difflineplus">+  if( zInput==0 ){</span>
<a href="#l15.138"></a><span id="l15.138" class="difflineplus">+    c-&gt;nInput = 0;</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineplus">+  }else if( nInput&lt;0 ){</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineplus">+    c-&gt;nInput = (int)strlen(zInput);</span>
<a href="#l15.141"></a><span id="l15.141" class="difflineplus">+  }else{</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineplus">+    c-&gt;nInput = nInput;</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineplus">+  }</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineplus">+  c-&gt;iOffset = 0;                 /* start tokenizing at the beginning */</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineplus">+  c-&gt;iToken = 0;</span>
<a href="#l15.146"></a><span id="l15.146" class="difflineplus">+  c-&gt;zToken = NULL;               /* no space allocated, yet. */</span>
<a href="#l15.147"></a><span id="l15.147" class="difflineplus">+  c-&gt;nAllocated = 0;</span>
<a href="#l15.148"></a><span id="l15.148" class="difflineplus">+  c-&gt;iPrevBigramOffset = 0;</span>
<a href="#l15.149"></a><span id="l15.149" class="difflineplus">+</span>
<a href="#l15.150"></a><span id="l15.150" class="difflineplus">+  *ppCursor = &amp;c-&gt;base;</span>
<a href="#l15.151"></a><span id="l15.151" class="difflineplus">+  return SQLITE_OK;</span>
<a href="#l15.152"></a><span id="l15.152" class="difflineplus">+}</span>
<a href="#l15.153"></a><span id="l15.153" class="difflineplus">+</span>
<a href="#l15.154"></a><span id="l15.154" class="difflineplus">+/*</span>
<a href="#l15.155"></a><span id="l15.155" class="difflineplus">+** Close a tokenization cursor previously opened by a call to</span>
<a href="#l15.156"></a><span id="l15.156" class="difflineplus">+** porterOpen() above.</span>
<a href="#l15.157"></a><span id="l15.157" class="difflineplus">+*/</span>
<a href="#l15.158"></a><span id="l15.158" class="difflineplus">+static int porterClose(sqlite3_tokenizer_cursor *pCursor){</span>
<a href="#l15.159"></a><span id="l15.159" class="difflineplus">+  porter_tokenizer_cursor *c = (porter_tokenizer_cursor *) pCursor;</span>
<a href="#l15.160"></a><span id="l15.160" class="difflineplus">+  sqlite3_free(c-&gt;zToken);</span>
<a href="#l15.161"></a><span id="l15.161" class="difflineplus">+  sqlite3_free(c);</span>
<a href="#l15.162"></a><span id="l15.162" class="difflineplus">+  return SQLITE_OK;</span>
<a href="#l15.163"></a><span id="l15.163" class="difflineplus">+}</span>
<a href="#l15.164"></a><span id="l15.164" class="difflineplus">+/*</span>
<a href="#l15.165"></a><span id="l15.165" class="difflineplus">+** Vowel or consonant</span>
<a href="#l15.166"></a><span id="l15.166" class="difflineplus">+*/</span>
<a href="#l15.167"></a><span id="l15.167" class="difflineplus">+static const char cType[] = {</span>
<a href="#l15.168"></a><span id="l15.168" class="difflineplus">+   0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0,</span>
<a href="#l15.169"></a><span id="l15.169" class="difflineplus">+   1, 1, 1, 2, 1</span>
<a href="#l15.170"></a><span id="l15.170" class="difflineplus">+};</span>
<a href="#l15.171"></a><span id="l15.171" class="difflineplus">+</span>
<a href="#l15.172"></a><span id="l15.172" class="difflineplus">+/*</span>
<a href="#l15.173"></a><span id="l15.173" class="difflineplus">+** isConsonant() and isVowel() determine if their first character in</span>
<a href="#l15.174"></a><span id="l15.174" class="difflineplus">+** the string they point to is a consonant or a vowel, according</span>
<a href="#l15.175"></a><span id="l15.175" class="difflineplus">+** to Porter ruls.  </span>
<a href="#l15.176"></a><span id="l15.176" class="difflineplus">+**</span>
<a href="#l15.177"></a><span id="l15.177" class="difflineplus">+** A consonate is any letter other than 'a', 'e', 'i', 'o', or 'u'.</span>
<a href="#l15.178"></a><span id="l15.178" class="difflineplus">+** 'Y' is a consonant unless it follows another consonant,</span>
<a href="#l15.179"></a><span id="l15.179" class="difflineplus">+** in which case it is a vowel.</span>
<a href="#l15.180"></a><span id="l15.180" class="difflineplus">+**</span>
<a href="#l15.181"></a><span id="l15.181" class="difflineplus">+** In these routine, the letters are in reverse order.  So the 'y' rule</span>
<a href="#l15.182"></a><span id="l15.182" class="difflineplus">+** is that 'y' is a consonant unless it is followed by another</span>
<a href="#l15.183"></a><span id="l15.183" class="difflineplus">+** consonent.</span>
<a href="#l15.184"></a><span id="l15.184" class="difflineplus">+*/</span>
<a href="#l15.185"></a><span id="l15.185" class="difflineplus">+static int isVowel(const char*);</span>
<a href="#l15.186"></a><span id="l15.186" class="difflineplus">+static int isConsonant(const char *z){</span>
<a href="#l15.187"></a><span id="l15.187" class="difflineplus">+  int j;</span>
<a href="#l15.188"></a><span id="l15.188" class="difflineplus">+  char x = *z;</span>
<a href="#l15.189"></a><span id="l15.189" class="difflineplus">+  if( x==0 ) return 0;</span>
<a href="#l15.190"></a><span id="l15.190" class="difflineplus">+  assert( x&gt;='a' &amp;&amp; x&lt;='z' );</span>
<a href="#l15.191"></a><span id="l15.191" class="difflineplus">+  j = cType[x-'a'];</span>
<a href="#l15.192"></a><span id="l15.192" class="difflineplus">+  if( j&lt;2 ) return j;</span>
<a href="#l15.193"></a><span id="l15.193" class="difflineplus">+  return z[1]==0 || isVowel(z + 1);</span>
<a href="#l15.194"></a><span id="l15.194" class="difflineplus">+}</span>
<a href="#l15.195"></a><span id="l15.195" class="difflineplus">+static int isVowel(const char *z){</span>
<a href="#l15.196"></a><span id="l15.196" class="difflineplus">+  int j;</span>
<a href="#l15.197"></a><span id="l15.197" class="difflineplus">+  char x = *z;</span>
<a href="#l15.198"></a><span id="l15.198" class="difflineplus">+  if( x==0 ) return 0;</span>
<a href="#l15.199"></a><span id="l15.199" class="difflineplus">+  assert( x&gt;='a' &amp;&amp; x&lt;='z' );</span>
<a href="#l15.200"></a><span id="l15.200" class="difflineplus">+  j = cType[x-'a'];</span>
<a href="#l15.201"></a><span id="l15.201" class="difflineplus">+  if( j&lt;2 ) return 1-j;</span>
<a href="#l15.202"></a><span id="l15.202" class="difflineplus">+  return isConsonant(z + 1);</span>
<a href="#l15.203"></a><span id="l15.203" class="difflineplus">+}</span>
<a href="#l15.204"></a><span id="l15.204" class="difflineplus">+</span>
<a href="#l15.205"></a><span id="l15.205" class="difflineplus">+/*</span>
<a href="#l15.206"></a><span id="l15.206" class="difflineplus">+** Let any sequence of one or more vowels be represented by V and let</span>
<a href="#l15.207"></a><span id="l15.207" class="difflineplus">+** C be sequence of one or more consonants.  Then every word can be</span>
<a href="#l15.208"></a><span id="l15.208" class="difflineplus">+** represented as:</span>
<a href="#l15.209"></a><span id="l15.209" class="difflineplus">+**</span>
<a href="#l15.210"></a><span id="l15.210" class="difflineplus">+**           [C] (VC){m} [V]</span>
<a href="#l15.211"></a><span id="l15.211" class="difflineplus">+**</span>
<a href="#l15.212"></a><span id="l15.212" class="difflineplus">+** In prose:  A word is an optional consonant followed by zero or</span>
<a href="#l15.213"></a><span id="l15.213" class="difflineplus">+** vowel-consonant pairs followed by an optional vowel.  &quot;m&quot; is the</span>
<a href="#l15.214"></a><span id="l15.214" class="difflineplus">+** number of vowel consonant pairs.  This routine computes the value</span>
<a href="#l15.215"></a><span id="l15.215" class="difflineplus">+** of m for the first i bytes of a word.</span>
<a href="#l15.216"></a><span id="l15.216" class="difflineplus">+**</span>
<a href="#l15.217"></a><span id="l15.217" class="difflineplus">+** Return true if the m-value for z is 1 or more.  In other words,</span>
<a href="#l15.218"></a><span id="l15.218" class="difflineplus">+** return true if z contains at least one vowel that is followed</span>
<a href="#l15.219"></a><span id="l15.219" class="difflineplus">+** by a consonant.</span>
<a href="#l15.220"></a><span id="l15.220" class="difflineplus">+**</span>
<a href="#l15.221"></a><span id="l15.221" class="difflineplus">+** In this routine z[] is in reverse order.  So we are really looking</span>
<a href="#l15.222"></a><span id="l15.222" class="difflineplus">+** for an instance of of a consonant followed by a vowel.</span>
<a href="#l15.223"></a><span id="l15.223" class="difflineplus">+*/</span>
<a href="#l15.224"></a><span id="l15.224" class="difflineplus">+static int m_gt_0(const char *z){</span>
<a href="#l15.225"></a><span id="l15.225" class="difflineplus">+  while( isVowel(z) ){ z++; }</span>
<a href="#l15.226"></a><span id="l15.226" class="difflineplus">+  if( *z==0 ) return 0;</span>
<a href="#l15.227"></a><span id="l15.227" class="difflineplus">+  while( isConsonant(z) ){ z++; }</span>
<a href="#l15.228"></a><span id="l15.228" class="difflineplus">+  return *z!=0;</span>
<a href="#l15.229"></a><span id="l15.229" class="difflineplus">+}</span>
<a href="#l15.230"></a><span id="l15.230" class="difflineplus">+</span>
<a href="#l15.231"></a><span id="l15.231" class="difflineplus">+/* Like mgt0 above except we are looking for a value of m which is</span>
<a href="#l15.232"></a><span id="l15.232" class="difflineplus">+** exactly 1</span>
<a href="#l15.233"></a><span id="l15.233" class="difflineplus">+*/</span>
<a href="#l15.234"></a><span id="l15.234" class="difflineplus">+static int m_eq_1(const char *z){</span>
<a href="#l15.235"></a><span id="l15.235" class="difflineplus">+  while( isVowel(z) ){ z++; }</span>
<a href="#l15.236"></a><span id="l15.236" class="difflineplus">+  if( *z==0 ) return 0;</span>
<a href="#l15.237"></a><span id="l15.237" class="difflineplus">+  while( isConsonant(z) ){ z++; }</span>
<a href="#l15.238"></a><span id="l15.238" class="difflineplus">+  if( *z==0 ) return 0;</span>
<a href="#l15.239"></a><span id="l15.239" class="difflineplus">+  while( isVowel(z) ){ z++; }</span>
<a href="#l15.240"></a><span id="l15.240" class="difflineplus">+  if( *z==0 ) return 1;</span>
<a href="#l15.241"></a><span id="l15.241" class="difflineplus">+  while( isConsonant(z) ){ z++; }</span>
<a href="#l15.242"></a><span id="l15.242" class="difflineplus">+  return *z==0;</span>
<a href="#l15.243"></a><span id="l15.243" class="difflineplus">+}</span>
<a href="#l15.244"></a><span id="l15.244" class="difflineplus">+</span>
<a href="#l15.245"></a><span id="l15.245" class="difflineplus">+/* Like mgt0 above except we are looking for a value of m&gt;1 instead</span>
<a href="#l15.246"></a><span id="l15.246" class="difflineplus">+** or m&gt;0</span>
<a href="#l15.247"></a><span id="l15.247" class="difflineplus">+*/</span>
<a href="#l15.248"></a><span id="l15.248" class="difflineplus">+static int m_gt_1(const char *z){</span>
<a href="#l15.249"></a><span id="l15.249" class="difflineplus">+  while( isVowel(z) ){ z++; }</span>
<a href="#l15.250"></a><span id="l15.250" class="difflineplus">+  if( *z==0 ) return 0;</span>
<a href="#l15.251"></a><span id="l15.251" class="difflineplus">+  while( isConsonant(z) ){ z++; }</span>
<a href="#l15.252"></a><span id="l15.252" class="difflineplus">+  if( *z==0 ) return 0;</span>
<a href="#l15.253"></a><span id="l15.253" class="difflineplus">+  while( isVowel(z) ){ z++; }</span>
<a href="#l15.254"></a><span id="l15.254" class="difflineplus">+  if( *z==0 ) return 0;</span>
<a href="#l15.255"></a><span id="l15.255" class="difflineplus">+  while( isConsonant(z) ){ z++; }</span>
<a href="#l15.256"></a><span id="l15.256" class="difflineplus">+  return *z!=0;</span>
<a href="#l15.257"></a><span id="l15.257" class="difflineplus">+}</span>
<a href="#l15.258"></a><span id="l15.258" class="difflineplus">+</span>
<a href="#l15.259"></a><span id="l15.259" class="difflineplus">+/*</span>
<a href="#l15.260"></a><span id="l15.260" class="difflineplus">+** Return TRUE if there is a vowel anywhere within z[0..n-1]</span>
<a href="#l15.261"></a><span id="l15.261" class="difflineplus">+*/</span>
<a href="#l15.262"></a><span id="l15.262" class="difflineplus">+static int hasVowel(const char *z){</span>
<a href="#l15.263"></a><span id="l15.263" class="difflineplus">+  while( isConsonant(z) ){ z++; }</span>
<a href="#l15.264"></a><span id="l15.264" class="difflineplus">+  return *z!=0;</span>
<a href="#l15.265"></a><span id="l15.265" class="difflineplus">+}</span>
<a href="#l15.266"></a><span id="l15.266" class="difflineplus">+</span>
<a href="#l15.267"></a><span id="l15.267" class="difflineplus">+/*</span>
<a href="#l15.268"></a><span id="l15.268" class="difflineplus">+** Return TRUE if the word ends in a double consonant.</span>
<a href="#l15.269"></a><span id="l15.269" class="difflineplus">+**</span>
<a href="#l15.270"></a><span id="l15.270" class="difflineplus">+** The text is reversed here. So we are really looking at</span>
<a href="#l15.271"></a><span id="l15.271" class="difflineplus">+** the first two characters of z[].</span>
<a href="#l15.272"></a><span id="l15.272" class="difflineplus">+*/</span>
<a href="#l15.273"></a><span id="l15.273" class="difflineplus">+static int doubleConsonant(const char *z){</span>
<a href="#l15.274"></a><span id="l15.274" class="difflineplus">+  return isConsonant(z) &amp;&amp; z[0]==z[1] &amp;&amp; isConsonant(z+1);</span>
<a href="#l15.275"></a><span id="l15.275" class="difflineplus">+}</span>
<a href="#l15.276"></a><span id="l15.276" class="difflineplus">+</span>
<a href="#l15.277"></a><span id="l15.277" class="difflineplus">+/*</span>
<a href="#l15.278"></a><span id="l15.278" class="difflineplus">+** Return TRUE if the word ends with three letters which</span>
<a href="#l15.279"></a><span id="l15.279" class="difflineplus">+** are consonant-vowel-consonent and where the final consonant</span>
<a href="#l15.280"></a><span id="l15.280" class="difflineplus">+** is not 'w', 'x', or 'y'.</span>
<a href="#l15.281"></a><span id="l15.281" class="difflineplus">+**</span>
<a href="#l15.282"></a><span id="l15.282" class="difflineplus">+** The word is reversed here.  So we are really checking the</span>
<a href="#l15.283"></a><span id="l15.283" class="difflineplus">+** first three letters and the first one cannot be in [wxy].</span>
<a href="#l15.284"></a><span id="l15.284" class="difflineplus">+*/</span>
<a href="#l15.285"></a><span id="l15.285" class="difflineplus">+static int star_oh(const char *z){</span>
<a href="#l15.286"></a><span id="l15.286" class="difflineplus">+  return</span>
<a href="#l15.287"></a><span id="l15.287" class="difflineplus">+    z[0]!=0 &amp;&amp; isConsonant(z) &amp;&amp;</span>
<a href="#l15.288"></a><span id="l15.288" class="difflineplus">+    z[0]!='w' &amp;&amp; z[0]!='x' &amp;&amp; z[0]!='y' &amp;&amp;</span>
<a href="#l15.289"></a><span id="l15.289" class="difflineplus">+    z[1]!=0 &amp;&amp; isVowel(z+1) &amp;&amp;</span>
<a href="#l15.290"></a><span id="l15.290" class="difflineplus">+    z[2]!=0 &amp;&amp; isConsonant(z+2);</span>
<a href="#l15.291"></a><span id="l15.291" class="difflineplus">+}</span>
<a href="#l15.292"></a><span id="l15.292" class="difflineplus">+</span>
<a href="#l15.293"></a><span id="l15.293" class="difflineplus">+/*</span>
<a href="#l15.294"></a><span id="l15.294" class="difflineplus">+** If the word ends with zFrom and xCond() is true for the stem</span>
<a href="#l15.295"></a><span id="l15.295" class="difflineplus">+** of the word that preceeds the zFrom ending, then change the </span>
<a href="#l15.296"></a><span id="l15.296" class="difflineplus">+** ending to zTo.</span>
<a href="#l15.297"></a><span id="l15.297" class="difflineplus">+**</span>
<a href="#l15.298"></a><span id="l15.298" class="difflineplus">+** The input word *pz and zFrom are both in reverse order.  zTo</span>
<a href="#l15.299"></a><span id="l15.299" class="difflineplus">+** is in normal order. </span>
<a href="#l15.300"></a><span id="l15.300" class="difflineplus">+**</span>
<a href="#l15.301"></a><span id="l15.301" class="difflineplus">+** Return TRUE if zFrom matches.  Return FALSE if zFrom does not</span>
<a href="#l15.302"></a><span id="l15.302" class="difflineplus">+** match.  Not that TRUE is returned even if xCond() fails and</span>
<a href="#l15.303"></a><span id="l15.303" class="difflineplus">+** no substitution occurs.</span>
<a href="#l15.304"></a><span id="l15.304" class="difflineplus">+*/</span>
<a href="#l15.305"></a><span id="l15.305" class="difflineplus">+static int stem(</span>
<a href="#l15.306"></a><span id="l15.306" class="difflineplus">+  char **pz,             /* The word being stemmed (Reversed) */</span>
<a href="#l15.307"></a><span id="l15.307" class="difflineplus">+  const char *zFrom,     /* If the ending matches this... (Reversed) */</span>
<a href="#l15.308"></a><span id="l15.308" class="difflineplus">+  const char *zTo,       /* ... change the ending to this (not reversed) */</span>
<a href="#l15.309"></a><span id="l15.309" class="difflineplus">+  int (*xCond)(const char*)   /* Condition that must be true */</span>
<a href="#l15.310"></a><span id="l15.310" class="difflineplus">+){</span>
<a href="#l15.311"></a><span id="l15.311" class="difflineplus">+  char *z = *pz;</span>
<a href="#l15.312"></a><span id="l15.312" class="difflineplus">+  while( *zFrom &amp;&amp; *zFrom==*z ){ z++; zFrom++; }</span>
<a href="#l15.313"></a><span id="l15.313" class="difflineplus">+  if( *zFrom!=0 ) return 0;</span>
<a href="#l15.314"></a><span id="l15.314" class="difflineplus">+  if( xCond &amp;&amp; !xCond(z) ) return 1;</span>
<a href="#l15.315"></a><span id="l15.315" class="difflineplus">+  while( *zTo ){</span>
<a href="#l15.316"></a><span id="l15.316" class="difflineplus">+    *(--z) = *(zTo++);</span>
<a href="#l15.317"></a><span id="l15.317" class="difflineplus">+  }</span>
<a href="#l15.318"></a><span id="l15.318" class="difflineplus">+  *pz = z;</span>
<a href="#l15.319"></a><span id="l15.319" class="difflineplus">+  return 1;</span>
<a href="#l15.320"></a><span id="l15.320" class="difflineplus">+}</span>
<a href="#l15.321"></a><span id="l15.321" class="difflineplus">+</span>
<a href="#l15.322"></a><span id="l15.322" class="difflineplus">+/*</span>
<a href="#l15.323"></a><span id="l15.323" class="difflineplus">+** This is the fallback stemmer used when the porter stemmer is</span>
<a href="#l15.324"></a><span id="l15.324" class="difflineplus">+** inappropriate.  The input word is copied into the output with</span>
<a href="#l15.325"></a><span id="l15.325" class="difflineplus">+** US-ASCII case folding.  If the input word is too long (more</span>
<a href="#l15.326"></a><span id="l15.326" class="difflineplus">+** than 20 bytes if it contains no digits or more than 6 bytes if</span>
<a href="#l15.327"></a><span id="l15.327" class="difflineplus">+** it contains digits) then word is truncated to 20 or 6 bytes</span>
<a href="#l15.328"></a><span id="l15.328" class="difflineplus">+** by taking 10 or 3 bytes from the beginning and end.</span>
<a href="#l15.329"></a><span id="l15.329" class="difflineplus">+*/</span>
<a href="#l15.330"></a><span id="l15.330" class="difflineplus">+static void copy_stemmer(const char *zIn, int nIn, char *zOut, int *pnOut){</span>
<a href="#l15.331"></a><span id="l15.331" class="difflineplus">+  int i, mx, j;</span>
<a href="#l15.332"></a><span id="l15.332" class="difflineplus">+  int hasDigit = 0;</span>
<a href="#l15.333"></a><span id="l15.333" class="difflineplus">+  for(i=0; i&lt;nIn; i++){</span>
<a href="#l15.334"></a><span id="l15.334" class="difflineplus">+    int c = zIn[i];</span>
<a href="#l15.335"></a><span id="l15.335" class="difflineplus">+    if( c&gt;='A' &amp;&amp; c&lt;='Z' ){</span>
<a href="#l15.336"></a><span id="l15.336" class="difflineplus">+      zOut[i] = c - 'A' + 'a';</span>
<a href="#l15.337"></a><span id="l15.337" class="difflineplus">+    }else{</span>
<a href="#l15.338"></a><span id="l15.338" class="difflineplus">+      if( c&gt;='0' &amp;&amp; c&lt;='9' ) hasDigit = 1;</span>
<a href="#l15.339"></a><span id="l15.339" class="difflineplus">+      zOut[i] = c;</span>
<a href="#l15.340"></a><span id="l15.340" class="difflineplus">+    }</span>
<a href="#l15.341"></a><span id="l15.341" class="difflineplus">+  }</span>
<a href="#l15.342"></a><span id="l15.342" class="difflineplus">+  mx = hasDigit ? 3 : 10;</span>
<a href="#l15.343"></a><span id="l15.343" class="difflineplus">+  if( nIn&gt;mx*2 ){</span>
<a href="#l15.344"></a><span id="l15.344" class="difflineplus">+    for(j=mx, i=nIn-mx; i&lt;nIn; i++, j++){</span>
<a href="#l15.345"></a><span id="l15.345" class="difflineplus">+      zOut[j] = zOut[i];</span>
<a href="#l15.346"></a><span id="l15.346" class="difflineplus">+    }</span>
<a href="#l15.347"></a><span id="l15.347" class="difflineplus">+    i = j;</span>
<a href="#l15.348"></a><span id="l15.348" class="difflineplus">+  }</span>
<a href="#l15.349"></a><span id="l15.349" class="difflineplus">+  zOut[i] = 0;</span>
<a href="#l15.350"></a><span id="l15.350" class="difflineplus">+  *pnOut = i;</span>
<a href="#l15.351"></a><span id="l15.351" class="difflineplus">+}</span>
<a href="#l15.352"></a><span id="l15.352" class="difflineplus">+</span>
<a href="#l15.353"></a><span id="l15.353" class="difflineplus">+</span>
<a href="#l15.354"></a><span id="l15.354" class="difflineplus">+/*</span>
<a href="#l15.355"></a><span id="l15.355" class="difflineplus">+** Stem the input word zIn[0..nIn-1].  Store the output in zOut.</span>
<a href="#l15.356"></a><span id="l15.356" class="difflineplus">+** zOut is at least big enough to hold nIn bytes.  Write the actual</span>
<a href="#l15.357"></a><span id="l15.357" class="difflineplus">+** size of the output word (exclusive of the '\0' terminator) into *pnOut.</span>
<a href="#l15.358"></a><span id="l15.358" class="difflineplus">+**</span>
<a href="#l15.359"></a><span id="l15.359" class="difflineplus">+** Any upper-case characters in the US-ASCII character set ([A-Z])</span>
<a href="#l15.360"></a><span id="l15.360" class="difflineplus">+** are converted to lower case.  Upper-case UTF characters are</span>
<a href="#l15.361"></a><span id="l15.361" class="difflineplus">+** unchanged.</span>
<a href="#l15.362"></a><span id="l15.362" class="difflineplus">+**</span>
<a href="#l15.363"></a><span id="l15.363" class="difflineplus">+** Words that are longer than about 20 bytes are stemmed by retaining</span>
<a href="#l15.364"></a><span id="l15.364" class="difflineplus">+** a few bytes from the beginning and the end of the word.  If the</span>
<a href="#l15.365"></a><span id="l15.365" class="difflineplus">+** word contains digits, 3 bytes are taken from the beginning and</span>
<a href="#l15.366"></a><span id="l15.366" class="difflineplus">+** 3 bytes from the end.  For long words without digits, 10 bytes</span>
<a href="#l15.367"></a><span id="l15.367" class="difflineplus">+** are taken from each end.  US-ASCII case folding still applies.</span>
<a href="#l15.368"></a><span id="l15.368" class="difflineplus">+** </span>
<a href="#l15.369"></a><span id="l15.369" class="difflineplus">+** If the input word contains not digits but does characters not </span>
<a href="#l15.370"></a><span id="l15.370" class="difflineplus">+** in [a-zA-Z] then no stemming is attempted and this routine just </span>
<a href="#l15.371"></a><span id="l15.371" class="difflineplus">+** copies the input into the input into the output with US-ASCII</span>
<a href="#l15.372"></a><span id="l15.372" class="difflineplus">+** case folding.</span>
<a href="#l15.373"></a><span id="l15.373" class="difflineplus">+**</span>
<a href="#l15.374"></a><span id="l15.374" class="difflineplus">+** Stemming never increases the length of the word.  So there is</span>
<a href="#l15.375"></a><span id="l15.375" class="difflineplus">+** no chance of overflowing the zOut buffer.</span>
<a href="#l15.376"></a><span id="l15.376" class="difflineplus">+*/</span>
<a href="#l15.377"></a><span id="l15.377" class="difflineplus">+static void porter_stemmer(const char *zIn, int nIn, char *zOut, int *pnOut){</span>
<a href="#l15.378"></a><span id="l15.378" class="difflineplus">+  int i, j, c;</span>
<a href="#l15.379"></a><span id="l15.379" class="difflineplus">+  char zReverse[28];</span>
<a href="#l15.380"></a><span id="l15.380" class="difflineplus">+  char *z, *z2;</span>
<a href="#l15.381"></a><span id="l15.381" class="difflineplus">+  if( nIn&lt;3 || nIn&gt;=sizeof(zReverse)-7 ){</span>
<a href="#l15.382"></a><span id="l15.382" class="difflineplus">+    /* The word is too big or too small for the porter stemmer.</span>
<a href="#l15.383"></a><span id="l15.383" class="difflineplus">+    ** Fallback to the copy stemmer */</span>
<a href="#l15.384"></a><span id="l15.384" class="difflineplus">+    copy_stemmer(zIn, nIn, zOut, pnOut);</span>
<a href="#l15.385"></a><span id="l15.385" class="difflineplus">+    return;</span>
<a href="#l15.386"></a><span id="l15.386" class="difflineplus">+  }</span>
<a href="#l15.387"></a><span id="l15.387" class="difflineplus">+  for(i=0, j=sizeof(zReverse)-6; i&lt;nIn; i++, j--){</span>
<a href="#l15.388"></a><span id="l15.388" class="difflineplus">+    c = zIn[i];</span>
<a href="#l15.389"></a><span id="l15.389" class="difflineplus">+    if( c&gt;='A' &amp;&amp; c&lt;='Z' ){</span>
<a href="#l15.390"></a><span id="l15.390" class="difflineplus">+      zReverse[j] = c + 'a' - 'A';</span>
<a href="#l15.391"></a><span id="l15.391" class="difflineplus">+    }else if( c&gt;='a' &amp;&amp; c&lt;='z' ){</span>
<a href="#l15.392"></a><span id="l15.392" class="difflineplus">+      zReverse[j] = c;</span>
<a href="#l15.393"></a><span id="l15.393" class="difflineplus">+    }else{</span>
<a href="#l15.394"></a><span id="l15.394" class="difflineplus">+      /* The use of a character not in [a-zA-Z] means that we fallback</span>
<a href="#l15.395"></a><span id="l15.395" class="difflineplus">+      ** to the copy stemmer */</span>
<a href="#l15.396"></a><span id="l15.396" class="difflineplus">+      copy_stemmer(zIn, nIn, zOut, pnOut);</span>
<a href="#l15.397"></a><span id="l15.397" class="difflineplus">+      return;</span>
<a href="#l15.398"></a><span id="l15.398" class="difflineplus">+    }</span>
<a href="#l15.399"></a><span id="l15.399" class="difflineplus">+  }</span>
<a href="#l15.400"></a><span id="l15.400" class="difflineplus">+  memset(&amp;zReverse[sizeof(zReverse)-5], 0, 5);</span>
<a href="#l15.401"></a><span id="l15.401" class="difflineplus">+  z = &amp;zReverse[j+1];</span>
<a href="#l15.402"></a><span id="l15.402" class="difflineplus">+</span>
<a href="#l15.403"></a><span id="l15.403" class="difflineplus">+</span>
<a href="#l15.404"></a><span id="l15.404" class="difflineplus">+  /* Step 1a */</span>
<a href="#l15.405"></a><span id="l15.405" class="difflineplus">+  if( z[0]=='s' ){</span>
<a href="#l15.406"></a><span id="l15.406" class="difflineplus">+    if(</span>
<a href="#l15.407"></a><span id="l15.407" class="difflineplus">+     !stem(&amp;z, &quot;sess&quot;, &quot;ss&quot;, 0) &amp;&amp;</span>
<a href="#l15.408"></a><span id="l15.408" class="difflineplus">+     !stem(&amp;z, &quot;sei&quot;, &quot;i&quot;, 0)  &amp;&amp;</span>
<a href="#l15.409"></a><span id="l15.409" class="difflineplus">+     !stem(&amp;z, &quot;ss&quot;, &quot;ss&quot;, 0)</span>
<a href="#l15.410"></a><span id="l15.410" class="difflineplus">+    ){</span>
<a href="#l15.411"></a><span id="l15.411" class="difflineplus">+      z++;</span>
<a href="#l15.412"></a><span id="l15.412" class="difflineplus">+    }</span>
<a href="#l15.413"></a><span id="l15.413" class="difflineplus">+  }</span>
<a href="#l15.414"></a><span id="l15.414" class="difflineplus">+</span>
<a href="#l15.415"></a><span id="l15.415" class="difflineplus">+  /* Step 1b */  </span>
<a href="#l15.416"></a><span id="l15.416" class="difflineplus">+  z2 = z;</span>
<a href="#l15.417"></a><span id="l15.417" class="difflineplus">+  if( stem(&amp;z, &quot;dee&quot;, &quot;ee&quot;, m_gt_0) ){</span>
<a href="#l15.418"></a><span id="l15.418" class="difflineplus">+    /* Do nothing.  The work was all in the test */</span>
<a href="#l15.419"></a><span id="l15.419" class="difflineplus">+  }else if( </span>
<a href="#l15.420"></a><span id="l15.420" class="difflineplus">+     (stem(&amp;z, &quot;gni&quot;, &quot;&quot;, hasVowel) || stem(&amp;z, &quot;de&quot;, &quot;&quot;, hasVowel))</span>
<a href="#l15.421"></a><span id="l15.421" class="difflineplus">+      &amp;&amp; z!=z2</span>
<a href="#l15.422"></a><span id="l15.422" class="difflineplus">+  ){</span>
<a href="#l15.423"></a><span id="l15.423" class="difflineplus">+     if( stem(&amp;z, &quot;ta&quot;, &quot;ate&quot;, 0) ||</span>
<a href="#l15.424"></a><span id="l15.424" class="difflineplus">+         stem(&amp;z, &quot;lb&quot;, &quot;ble&quot;, 0) ||</span>
<a href="#l15.425"></a><span id="l15.425" class="difflineplus">+         stem(&amp;z, &quot;zi&quot;, &quot;ize&quot;, 0) ){</span>
<a href="#l15.426"></a><span id="l15.426" class="difflineplus">+       /* Do nothing.  The work was all in the test */</span>
<a href="#l15.427"></a><span id="l15.427" class="difflineplus">+     }else if( doubleConsonant(z) &amp;&amp; (*z!='l' &amp;&amp; *z!='s' &amp;&amp; *z!='z') ){</span>
<a href="#l15.428"></a><span id="l15.428" class="difflineplus">+       z++;</span>
<a href="#l15.429"></a><span id="l15.429" class="difflineplus">+     }else if( m_eq_1(z) &amp;&amp; star_oh(z) ){</span>
<a href="#l15.430"></a><span id="l15.430" class="difflineplus">+       *(--z) = 'e';</span>
<a href="#l15.431"></a><span id="l15.431" class="difflineplus">+     }</span>
<a href="#l15.432"></a><span id="l15.432" class="difflineplus">+  }</span>
<a href="#l15.433"></a><span id="l15.433" class="difflineplus">+</span>
<a href="#l15.434"></a><span id="l15.434" class="difflineplus">+  /* Step 1c */</span>
<a href="#l15.435"></a><span id="l15.435" class="difflineplus">+  if( z[0]=='y' &amp;&amp; hasVowel(z+1) ){</span>
<a href="#l15.436"></a><span id="l15.436" class="difflineplus">+    z[0] = 'i';</span>
<a href="#l15.437"></a><span id="l15.437" class="difflineplus">+  }</span>
<a href="#l15.438"></a><span id="l15.438" class="difflineplus">+</span>
<a href="#l15.439"></a><span id="l15.439" class="difflineplus">+  /* Step 2 */</span>
<a href="#l15.440"></a><span id="l15.440" class="difflineplus">+  switch( z[1] ){</span>
<a href="#l15.441"></a><span id="l15.441" class="difflineplus">+   case 'a':</span>
<a href="#l15.442"></a><span id="l15.442" class="difflineplus">+     stem(&amp;z, &quot;lanoita&quot;, &quot;ate&quot;, m_gt_0) ||</span>
<a href="#l15.443"></a><span id="l15.443" class="difflineplus">+     stem(&amp;z, &quot;lanoit&quot;, &quot;tion&quot;, m_gt_0);</span>
<a href="#l15.444"></a><span id="l15.444" class="difflineplus">+     break;</span>
<a href="#l15.445"></a><span id="l15.445" class="difflineplus">+   case 'c':</span>
<a href="#l15.446"></a><span id="l15.446" class="difflineplus">+     stem(&amp;z, &quot;icne&quot;, &quot;ence&quot;, m_gt_0) ||</span>
<a href="#l15.447"></a><span id="l15.447" class="difflineplus">+     stem(&amp;z, &quot;icna&quot;, &quot;ance&quot;, m_gt_0);</span>
<a href="#l15.448"></a><span id="l15.448" class="difflineplus">+     break;</span>
<a href="#l15.449"></a><span id="l15.449" class="difflineplus">+   case 'e':</span>
<a href="#l15.450"></a><span id="l15.450" class="difflineplus">+     stem(&amp;z, &quot;rezi&quot;, &quot;ize&quot;, m_gt_0);</span>
<a href="#l15.451"></a><span id="l15.451" class="difflineplus">+     break;</span>
<a href="#l15.452"></a><span id="l15.452" class="difflineplus">+   case 'g':</span>
<a href="#l15.453"></a><span id="l15.453" class="difflineplus">+     stem(&amp;z, &quot;igol&quot;, &quot;log&quot;, m_gt_0);</span>
<a href="#l15.454"></a><span id="l15.454" class="difflineplus">+     break;</span>
<a href="#l15.455"></a><span id="l15.455" class="difflineplus">+   case 'l':</span>
<a href="#l15.456"></a><span id="l15.456" class="difflineplus">+     stem(&amp;z, &quot;ilb&quot;, &quot;ble&quot;, m_gt_0) ||</span>
<a href="#l15.457"></a><span id="l15.457" class="difflineplus">+     stem(&amp;z, &quot;illa&quot;, &quot;al&quot;, m_gt_0) ||</span>
<a href="#l15.458"></a><span id="l15.458" class="difflineplus">+     stem(&amp;z, &quot;iltne&quot;, &quot;ent&quot;, m_gt_0) ||</span>
<a href="#l15.459"></a><span id="l15.459" class="difflineplus">+     stem(&amp;z, &quot;ile&quot;, &quot;e&quot;, m_gt_0) ||</span>
<a href="#l15.460"></a><span id="l15.460" class="difflineplus">+     stem(&amp;z, &quot;ilsuo&quot;, &quot;ous&quot;, m_gt_0);</span>
<a href="#l15.461"></a><span id="l15.461" class="difflineplus">+     break;</span>
<a href="#l15.462"></a><span id="l15.462" class="difflineplus">+   case 'o':</span>
<a href="#l15.463"></a><span id="l15.463" class="difflineplus">+     stem(&amp;z, &quot;noitazi&quot;, &quot;ize&quot;, m_gt_0) ||</span>
<a href="#l15.464"></a><span id="l15.464" class="difflineplus">+     stem(&amp;z, &quot;noita&quot;, &quot;ate&quot;, m_gt_0) ||</span>
<a href="#l15.465"></a><span id="l15.465" class="difflineplus">+     stem(&amp;z, &quot;rota&quot;, &quot;ate&quot;, m_gt_0);</span>
<a href="#l15.466"></a><span id="l15.466" class="difflineplus">+     break;</span>
<a href="#l15.467"></a><span id="l15.467" class="difflineplus">+   case 's':</span>
<a href="#l15.468"></a><span id="l15.468" class="difflineplus">+     stem(&amp;z, &quot;msila&quot;, &quot;al&quot;, m_gt_0) ||</span>
<a href="#l15.469"></a><span id="l15.469" class="difflineplus">+     stem(&amp;z, &quot;ssenevi&quot;, &quot;ive&quot;, m_gt_0) ||</span>
<a href="#l15.470"></a><span id="l15.470" class="difflineplus">+     stem(&amp;z, &quot;ssenluf&quot;, &quot;ful&quot;, m_gt_0) ||</span>
<a href="#l15.471"></a><span id="l15.471" class="difflineplus">+     stem(&amp;z, &quot;ssensuo&quot;, &quot;ous&quot;, m_gt_0);</span>
<a href="#l15.472"></a><span id="l15.472" class="difflineplus">+     break;</span>
<a href="#l15.473"></a><span id="l15.473" class="difflineplus">+   case 't':</span>
<a href="#l15.474"></a><span id="l15.474" class="difflineplus">+     stem(&amp;z, &quot;itila&quot;, &quot;al&quot;, m_gt_0) ||</span>
<a href="#l15.475"></a><span id="l15.475" class="difflineplus">+     stem(&amp;z, &quot;itivi&quot;, &quot;ive&quot;, m_gt_0) ||</span>
<a href="#l15.476"></a><span id="l15.476" class="difflineplus">+     stem(&amp;z, &quot;itilib&quot;, &quot;ble&quot;, m_gt_0);</span>
<a href="#l15.477"></a><span id="l15.477" class="difflineplus">+     break;</span>
<a href="#l15.478"></a><span id="l15.478" class="difflineplus">+  }</span>
<a href="#l15.479"></a><span id="l15.479" class="difflineplus">+</span>
<a href="#l15.480"></a><span id="l15.480" class="difflineplus">+  /* Step 3 */</span>
<a href="#l15.481"></a><span id="l15.481" class="difflineplus">+  switch( z[0] ){</span>
<a href="#l15.482"></a><span id="l15.482" class="difflineplus">+   case 'e':</span>
<a href="#l15.483"></a><span id="l15.483" class="difflineplus">+     stem(&amp;z, &quot;etaci&quot;, &quot;ic&quot;, m_gt_0) ||</span>
<a href="#l15.484"></a><span id="l15.484" class="difflineplus">+     stem(&amp;z, &quot;evita&quot;, &quot;&quot;, m_gt_0)   ||</span>
<a href="#l15.485"></a><span id="l15.485" class="difflineplus">+     stem(&amp;z, &quot;ezila&quot;, &quot;al&quot;, m_gt_0);</span>
<a href="#l15.486"></a><span id="l15.486" class="difflineplus">+     break;</span>
<a href="#l15.487"></a><span id="l15.487" class="difflineplus">+   case 'i':</span>
<a href="#l15.488"></a><span id="l15.488" class="difflineplus">+     stem(&amp;z, &quot;itici&quot;, &quot;ic&quot;, m_gt_0);</span>
<a href="#l15.489"></a><span id="l15.489" class="difflineplus">+     break;</span>
<a href="#l15.490"></a><span id="l15.490" class="difflineplus">+   case 'l':</span>
<a href="#l15.491"></a><span id="l15.491" class="difflineplus">+     stem(&amp;z, &quot;laci&quot;, &quot;ic&quot;, m_gt_0) ||</span>
<a href="#l15.492"></a><span id="l15.492" class="difflineplus">+     stem(&amp;z, &quot;luf&quot;, &quot;&quot;, m_gt_0);</span>
<a href="#l15.493"></a><span id="l15.493" class="difflineplus">+     break;</span>
<a href="#l15.494"></a><span id="l15.494" class="difflineplus">+   case 's':</span>
<a href="#l15.495"></a><span id="l15.495" class="difflineplus">+     stem(&amp;z, &quot;ssen&quot;, &quot;&quot;, m_gt_0);</span>
<a href="#l15.496"></a><span id="l15.496" class="difflineplus">+     break;</span>
<a href="#l15.497"></a><span id="l15.497" class="difflineplus">+  }</span>
<a href="#l15.498"></a><span id="l15.498" class="difflineplus">+</span>
<a href="#l15.499"></a><span id="l15.499" class="difflineplus">+  /* Step 4 */</span>
<a href="#l15.500"></a><span id="l15.500" class="difflineplus">+  switch( z[1] ){</span>
<a href="#l15.501"></a><span id="l15.501" class="difflineplus">+   case 'a':</span>
<a href="#l15.502"></a><span id="l15.502" class="difflineplus">+     if( z[0]=='l' &amp;&amp; m_gt_1(z+2) ){</span>
<a href="#l15.503"></a><span id="l15.503" class="difflineplus">+       z += 2;</span>
<a href="#l15.504"></a><span id="l15.504" class="difflineplus">+     }</span>
<a href="#l15.505"></a><span id="l15.505" class="difflineplus">+     break;</span>
<a href="#l15.506"></a><span id="l15.506" class="difflineplus">+   case 'c':</span>
<a href="#l15.507"></a><span id="l15.507" class="difflineplus">+     if( z[0]=='e' &amp;&amp; z[2]=='n' &amp;&amp; (z[3]=='a' || z[3]=='e')  &amp;&amp; m_gt_1(z+4)  ){</span>
<a href="#l15.508"></a><span id="l15.508" class="difflineplus">+       z += 4;</span>
<a href="#l15.509"></a><span id="l15.509" class="difflineplus">+     }</span>
<a href="#l15.510"></a><span id="l15.510" class="difflineplus">+     break;</span>
<a href="#l15.511"></a><span id="l15.511" class="difflineplus">+   case 'e':</span>
<a href="#l15.512"></a><span id="l15.512" class="difflineplus">+     if( z[0]=='r' &amp;&amp; m_gt_1(z+2) ){</span>
<a href="#l15.513"></a><span id="l15.513" class="difflineplus">+       z += 2;</span>
<a href="#l15.514"></a><span id="l15.514" class="difflineplus">+     }</span>
<a href="#l15.515"></a><span id="l15.515" class="difflineplus">+     break;</span>
<a href="#l15.516"></a><span id="l15.516" class="difflineplus">+   case 'i':</span>
<a href="#l15.517"></a><span id="l15.517" class="difflineplus">+     if( z[0]=='c' &amp;&amp; m_gt_1(z+2) ){</span>
<a href="#l15.518"></a><span id="l15.518" class="difflineplus">+       z += 2;</span>
<a href="#l15.519"></a><span id="l15.519" class="difflineplus">+     }</span>
<a href="#l15.520"></a><span id="l15.520" class="difflineplus">+     break;</span>
<a href="#l15.521"></a><span id="l15.521" class="difflineplus">+   case 'l':</span>
<a href="#l15.522"></a><span id="l15.522" class="difflineplus">+     if( z[0]=='e' &amp;&amp; z[2]=='b' &amp;&amp; (z[3]=='a' || z[3]=='i') &amp;&amp; m_gt_1(z+4) ){</span>
<a href="#l15.523"></a><span id="l15.523" class="difflineplus">+       z += 4;</span>
<a href="#l15.524"></a><span id="l15.524" class="difflineplus">+     }</span>
<a href="#l15.525"></a><span id="l15.525" class="difflineplus">+     break;</span>
<a href="#l15.526"></a><span id="l15.526" class="difflineplus">+   case 'n':</span>
<a href="#l15.527"></a><span id="l15.527" class="difflineplus">+     if( z[0]=='t' ){</span>
<a href="#l15.528"></a><span id="l15.528" class="difflineplus">+       if( z[2]=='a' ){</span>
<a href="#l15.529"></a><span id="l15.529" class="difflineplus">+         if( m_gt_1(z+3) ){</span>
<a href="#l15.530"></a><span id="l15.530" class="difflineplus">+           z += 3;</span>
<a href="#l15.531"></a><span id="l15.531" class="difflineplus">+         }</span>
<a href="#l15.532"></a><span id="l15.532" class="difflineplus">+       }else if( z[2]=='e' ){</span>
<a href="#l15.533"></a><span id="l15.533" class="difflineplus">+         stem(&amp;z, &quot;tneme&quot;, &quot;&quot;, m_gt_1) ||</span>
<a href="#l15.534"></a><span id="l15.534" class="difflineplus">+         stem(&amp;z, &quot;tnem&quot;, &quot;&quot;, m_gt_1) ||</span>
<a href="#l15.535"></a><span id="l15.535" class="difflineplus">+         stem(&amp;z, &quot;tne&quot;, &quot;&quot;, m_gt_1);</span>
<a href="#l15.536"></a><span id="l15.536" class="difflineplus">+       }</span>
<a href="#l15.537"></a><span id="l15.537" class="difflineplus">+     }</span>
<a href="#l15.538"></a><span id="l15.538" class="difflineplus">+     break;</span>
<a href="#l15.539"></a><span id="l15.539" class="difflineplus">+   case 'o':</span>
<a href="#l15.540"></a><span id="l15.540" class="difflineplus">+     if( z[0]=='u' ){</span>
<a href="#l15.541"></a><span id="l15.541" class="difflineplus">+       if( m_gt_1(z+2) ){</span>
<a href="#l15.542"></a><span id="l15.542" class="difflineplus">+         z += 2;</span>
<a href="#l15.543"></a><span id="l15.543" class="difflineplus">+       }</span>
<a href="#l15.544"></a><span id="l15.544" class="difflineplus">+     }else if( z[3]=='s' || z[3]=='t' ){</span>
<a href="#l15.545"></a><span id="l15.545" class="difflineplus">+       stem(&amp;z, &quot;noi&quot;, &quot;&quot;, m_gt_1);</span>
<a href="#l15.546"></a><span id="l15.546" class="difflineplus">+     }</span>
<a href="#l15.547"></a><span id="l15.547" class="difflineplus">+     break;</span>
<a href="#l15.548"></a><span id="l15.548" class="difflineplus">+   case 's':</span>
<a href="#l15.549"></a><span id="l15.549" class="difflineplus">+     if( z[0]=='m' &amp;&amp; z[2]=='i' &amp;&amp; m_gt_1(z+3) ){</span>
<a href="#l15.550"></a><span id="l15.550" class="difflineplus">+       z += 3;</span>
<a href="#l15.551"></a><span id="l15.551" class="difflineplus">+     }</span>
<a href="#l15.552"></a><span id="l15.552" class="difflineplus">+     break;</span>
<a href="#l15.553"></a><span id="l15.553" class="difflineplus">+   case 't':</span>
<a href="#l15.554"></a><span id="l15.554" class="difflineplus">+     stem(&amp;z, &quot;eta&quot;, &quot;&quot;, m_gt_1) ||</span>
<a href="#l15.555"></a><span id="l15.555" class="difflineplus">+     stem(&amp;z, &quot;iti&quot;, &quot;&quot;, m_gt_1);</span>
<a href="#l15.556"></a><span id="l15.556" class="difflineplus">+     break;</span>
<a href="#l15.557"></a><span id="l15.557" class="difflineplus">+   case 'u':</span>
<a href="#l15.558"></a><span id="l15.558" class="difflineplus">+     if( z[0]=='s' &amp;&amp; z[2]=='o' &amp;&amp; m_gt_1(z+3) ){</span>
<a href="#l15.559"></a><span id="l15.559" class="difflineplus">+       z += 3;</span>
<a href="#l15.560"></a><span id="l15.560" class="difflineplus">+     }</span>
<a href="#l15.561"></a><span id="l15.561" class="difflineplus">+     break;</span>
<a href="#l15.562"></a><span id="l15.562" class="difflineplus">+   case 'v':</span>
<a href="#l15.563"></a><span id="l15.563" class="difflineplus">+   case 'z':</span>
<a href="#l15.564"></a><span id="l15.564" class="difflineplus">+     if( z[0]=='e' &amp;&amp; z[2]=='i' &amp;&amp; m_gt_1(z+3) ){</span>
<a href="#l15.565"></a><span id="l15.565" class="difflineplus">+       z += 3;</span>
<a href="#l15.566"></a><span id="l15.566" class="difflineplus">+     }</span>
<a href="#l15.567"></a><span id="l15.567" class="difflineplus">+     break;</span>
<a href="#l15.568"></a><span id="l15.568" class="difflineplus">+  }</span>
<a href="#l15.569"></a><span id="l15.569" class="difflineplus">+</span>
<a href="#l15.570"></a><span id="l15.570" class="difflineplus">+  /* Step 5a */</span>
<a href="#l15.571"></a><span id="l15.571" class="difflineplus">+  if( z[0]=='e' ){</span>
<a href="#l15.572"></a><span id="l15.572" class="difflineplus">+    if( m_gt_1(z+1) ){</span>
<a href="#l15.573"></a><span id="l15.573" class="difflineplus">+      z++;</span>
<a href="#l15.574"></a><span id="l15.574" class="difflineplus">+    }else if( m_eq_1(z+1) &amp;&amp; !star_oh(z+1) ){</span>
<a href="#l15.575"></a><span id="l15.575" class="difflineplus">+      z++;</span>
<a href="#l15.576"></a><span id="l15.576" class="difflineplus">+    }</span>
<a href="#l15.577"></a><span id="l15.577" class="difflineplus">+  }</span>
<a href="#l15.578"></a><span id="l15.578" class="difflineplus">+</span>
<a href="#l15.579"></a><span id="l15.579" class="difflineplus">+  /* Step 5b */</span>
<a href="#l15.580"></a><span id="l15.580" class="difflineplus">+  if( m_gt_1(z) &amp;&amp; z[0]=='l' &amp;&amp; z[1]=='l' ){</span>
<a href="#l15.581"></a><span id="l15.581" class="difflineplus">+    z++;</span>
<a href="#l15.582"></a><span id="l15.582" class="difflineplus">+  }</span>
<a href="#l15.583"></a><span id="l15.583" class="difflineplus">+</span>
<a href="#l15.584"></a><span id="l15.584" class="difflineplus">+  /* z[] is now the stemmed word in reverse order.  Flip it back</span>
<a href="#l15.585"></a><span id="l15.585" class="difflineplus">+  ** around into forward order and return.</span>
<a href="#l15.586"></a><span id="l15.586" class="difflineplus">+  */</span>
<a href="#l15.587"></a><span id="l15.587" class="difflineplus">+  *pnOut = i = strlen(z);</span>
<a href="#l15.588"></a><span id="l15.588" class="difflineplus">+  zOut[i] = 0;</span>
<a href="#l15.589"></a><span id="l15.589" class="difflineplus">+  while( *z ){</span>
<a href="#l15.590"></a><span id="l15.590" class="difflineplus">+    zOut[--i] = *(z++);</span>
<a href="#l15.591"></a><span id="l15.591" class="difflineplus">+  }</span>
<a href="#l15.592"></a><span id="l15.592" class="difflineplus">+}</span>
<a href="#l15.593"></a><span id="l15.593" class="difflineplus">+</span>
<a href="#l15.594"></a><span id="l15.594" class="difflineplus">+/*</span>
<a href="#l15.595"></a><span id="l15.595" class="difflineplus">+** Characters that can be part of a token.  We assume any character</span>
<a href="#l15.596"></a><span id="l15.596" class="difflineplus">+** whose value is greater than 0x80 (any UTF character) can be</span>
<a href="#l15.597"></a><span id="l15.597" class="difflineplus">+** part of a token.  In other words, delimiters all must have</span>
<a href="#l15.598"></a><span id="l15.598" class="difflineplus">+** values of 0x7f or lower.</span>
<a href="#l15.599"></a><span id="l15.599" class="difflineplus">+*/</span>
<a href="#l15.600"></a><span id="l15.600" class="difflineplus">+static const char porterIdChar[] = {</span>
<a href="#l15.601"></a><span id="l15.601" class="difflineplus">+/* x0 x1 x2 x3 x4 x5 x6 x7 x8 x9 xA xB xC xD xE xF */</span>
<a href="#l15.602"></a><span id="l15.602" class="difflineplus">+    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,  /* 3x */</span>
<a href="#l15.603"></a><span id="l15.603" class="difflineplus">+    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  /* 4x */</span>
<a href="#l15.604"></a><span id="l15.604" class="difflineplus">+    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1,  /* 5x */</span>
<a href="#l15.605"></a><span id="l15.605" class="difflineplus">+    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  /* 6x */</span>
<a href="#l15.606"></a><span id="l15.606" class="difflineplus">+    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,  /* 7x */</span>
<a href="#l15.607"></a><span id="l15.607" class="difflineplus">+};</span>
<a href="#l15.608"></a><span id="l15.608" class="difflineplus">+</span>
<a href="#l15.609"></a><span id="l15.609" class="difflineplus">+#define IS_SPACE(x)    (((x)&gt;=0x2000&amp;&amp;(x)&lt;=0x200a) || (x)==0x205f)</span>
<a href="#l15.610"></a><span id="l15.610" class="difflineplus">+#define IS_JA_DELIM(x) (((x)==0x3001)||((x)==0xFF64)||((x)==0xFF0E)||((x)==0x3002)||((x)==0xFF61)||((x)==0xFF0C))</span>
<a href="#l15.611"></a><span id="l15.611" class="difflineplus">+</span>
<a href="#l15.612"></a><span id="l15.612" class="difflineplus">+#define BIGRAM_RESET   0</span>
<a href="#l15.613"></a><span id="l15.613" class="difflineplus">+#define BIGRAM_UNKNOWN 1</span>
<a href="#l15.614"></a><span id="l15.614" class="difflineplus">+#define BIGRAM_USE     2</span>
<a href="#l15.615"></a><span id="l15.615" class="difflineplus">+#define BIGRAM_ASCII   3</span>
<a href="#l15.616"></a><span id="l15.616" class="difflineplus">+</span>
<a href="#l15.617"></a><span id="l15.617" class="difflineplus">+static int isDelim(</span>
<a href="#l15.618"></a><span id="l15.618" class="difflineplus">+  const unsigned char *zCur,    /* IN: current pointer of token */</span>
<a href="#l15.619"></a><span id="l15.619" class="difflineplus">+  const unsigned char *zTerm,   /* IN: last pointer of token */</span>
<a href="#l15.620"></a><span id="l15.620" class="difflineplus">+  int *len,                     /* OUT: analyzed bytes in this token */</span>
<a href="#l15.621"></a><span id="l15.621" class="difflineplus">+  int *state                    /* IN/OUT: analyze state */</span>
<a href="#l15.622"></a><span id="l15.622" class="difflineplus">+){</span>
<a href="#l15.623"></a><span id="l15.623" class="difflineplus">+  const unsigned char *zIn;</span>
<a href="#l15.624"></a><span id="l15.624" class="difflineplus">+  unsigned short c;</span>
<a href="#l15.625"></a><span id="l15.625" class="difflineplus">+  int delim;</span>
<a href="#l15.626"></a><span id="l15.626" class="difflineplus">+</span>
<a href="#l15.627"></a><span id="l15.627" class="difflineplus">+  /* ASCII character range has rule */</span>
<a href="#l15.628"></a><span id="l15.628" class="difflineplus">+  if( !(*zCur &amp; 0x80) ){</span>
<a href="#l15.629"></a><span id="l15.629" class="difflineplus">+    *len = 1;</span>
<a href="#l15.630"></a><span id="l15.630" class="difflineplus">+    delim = (*zCur&lt;0x30 || !porterIdChar[*zCur-0x30]);</span>
<a href="#l15.631"></a><span id="l15.631" class="difflineplus">+    if( *state==BIGRAM_USE || *state==BIGRAM_UNKNOWN ){</span>
<a href="#l15.632"></a><span id="l15.632" class="difflineplus">+      /* previous maybe CJK and current is ascii */</span>
<a href="#l15.633"></a><span id="l15.633" class="difflineplus">+      *state = BIGRAM_ASCII; /*ascii*/</span>
<a href="#l15.634"></a><span id="l15.634" class="difflineplus">+      delim = 1; /* must break */</span>
<a href="#l15.635"></a><span id="l15.635" class="difflineplus">+    }else if( delim==1 ){</span>
<a href="#l15.636"></a><span id="l15.636" class="difflineplus">+      /* this is delimtter character */</span>
<a href="#l15.637"></a><span id="l15.637" class="difflineplus">+      *state = BIGRAM_RESET; /*reset*/</span>
<a href="#l15.638"></a><span id="l15.638" class="difflineplus">+    }else{</span>
<a href="#l15.639"></a><span id="l15.639" class="difflineplus">+      *state = BIGRAM_ASCII; /*ascii*/</span>
<a href="#l15.640"></a><span id="l15.640" class="difflineplus">+    }</span>
<a href="#l15.641"></a><span id="l15.641" class="difflineplus">+    return delim;</span>
<a href="#l15.642"></a><span id="l15.642" class="difflineplus">+  }</span>
<a href="#l15.643"></a><span id="l15.643" class="difflineplus">+</span>
<a href="#l15.644"></a><span id="l15.644" class="difflineplus">+  /* convert to UTF-16 to analyze character */</span>
<a href="#l15.645"></a><span id="l15.645" class="difflineplus">+  zIn = zCur;</span>
<a href="#l15.646"></a><span id="l15.646" class="difflineplus">+  READ_UTF8(zIn, zTerm, c);</span>
<a href="#l15.647"></a><span id="l15.647" class="difflineplus">+  *len = zIn - zCur;</span>
<a href="#l15.648"></a><span id="l15.648" class="difflineplus">+</span>
<a href="#l15.649"></a><span id="l15.649" class="difflineplus">+  /* this isn't CJK range, so return as no delim */</span>
<a href="#l15.650"></a><span id="l15.650" class="difflineplus">+  if( c&lt;0x2000 || (c&gt;=0xa000 &amp;&amp; c&lt;0xac00) ){</span>
<a href="#l15.651"></a><span id="l15.651" class="difflineplus">+    *state = BIGRAM_RESET; /*reset*/</span>
<a href="#l15.652"></a><span id="l15.652" class="difflineplus">+    return 0;</span>
<a href="#l15.653"></a><span id="l15.653" class="difflineplus">+  }</span>
<a href="#l15.654"></a><span id="l15.654" class="difflineplus">+</span>
<a href="#l15.655"></a><span id="l15.655" class="difflineplus">+  /* this is space character or delim character */</span>
<a href="#l15.656"></a><span id="l15.656" class="difflineplus">+  if( IS_SPACE(c) || IS_JA_DELIM(c) ){</span>
<a href="#l15.657"></a><span id="l15.657" class="difflineplus">+    *state = BIGRAM_RESET; /* reset */</span>
<a href="#l15.658"></a><span id="l15.658" class="difflineplus">+    return 1;</span>
<a href="#l15.659"></a><span id="l15.659" class="difflineplus">+  }</span>
<a href="#l15.660"></a><span id="l15.660" class="difflineplus">+</span>
<a href="#l15.661"></a><span id="l15.661" class="difflineplus">+  if( *state==BIGRAM_ASCII ){</span>
<a href="#l15.662"></a><span id="l15.662" class="difflineplus">+    /* Previous is ascii and current maybe CJK */</span>
<a href="#l15.663"></a><span id="l15.663" class="difflineplus">+    *state = BIGRAM_UNKNOWN; /* mark as unknown */</span>
<a href="#l15.664"></a><span id="l15.664" class="difflineplus">+    return 1; /* must break */</span>
<a href="#l15.665"></a><span id="l15.665" class="difflineplus">+  }</span>
<a href="#l15.666"></a><span id="l15.666" class="difflineplus">+</span>
<a href="#l15.667"></a><span id="l15.667" class="difflineplus">+  /* We have no rule for CJK!. use bi-gram */</span>
<a href="#l15.668"></a><span id="l15.668" class="difflineplus">+  if( *state==BIGRAM_UNKNOWN || *state==BIGRAM_USE ){</span>
<a href="#l15.669"></a><span id="l15.669" class="difflineplus">+    /* previous state is unknown.  mark as bi-gram */</span>
<a href="#l15.670"></a><span id="l15.670" class="difflineplus">+    *state = BIGRAM_USE;</span>
<a href="#l15.671"></a><span id="l15.671" class="difflineplus">+    return 1;</span>
<a href="#l15.672"></a><span id="l15.672" class="difflineplus">+  }</span>
<a href="#l15.673"></a><span id="l15.673" class="difflineplus">+</span>
<a href="#l15.674"></a><span id="l15.674" class="difflineplus">+  *state = BIGRAM_UNKNOWN; /* mark as unknown */</span>
<a href="#l15.675"></a><span id="l15.675" class="difflineplus">+  return 0;</span>
<a href="#l15.676"></a><span id="l15.676" class="difflineplus">+}</span>
<a href="#l15.677"></a><span id="l15.677" class="difflineplus">+</span>
<a href="#l15.678"></a><span id="l15.678" class="difflineplus">+/*</span>
<a href="#l15.679"></a><span id="l15.679" class="difflineplus">+** Extract the next token from a tokenization cursor.  The cursor must</span>
<a href="#l15.680"></a><span id="l15.680" class="difflineplus">+** have been opened by a prior call to porterOpen().</span>
<a href="#l15.681"></a><span id="l15.681" class="difflineplus">+*/</span>
<a href="#l15.682"></a><span id="l15.682" class="difflineplus">+static int porterNext(</span>
<a href="#l15.683"></a><span id="l15.683" class="difflineplus">+  sqlite3_tokenizer_cursor *pCursor,  /* Cursor returned by porterOpen */</span>
<a href="#l15.684"></a><span id="l15.684" class="difflineplus">+  const char **pzToken,               /* OUT: *pzToken is the token text */</span>
<a href="#l15.685"></a><span id="l15.685" class="difflineplus">+  int *pnBytes,                       /* OUT: Number of bytes in token */</span>
<a href="#l15.686"></a><span id="l15.686" class="difflineplus">+  int *piStartOffset,                 /* OUT: Starting offset of token */</span>
<a href="#l15.687"></a><span id="l15.687" class="difflineplus">+  int *piEndOffset,                   /* OUT: Ending offset of token */</span>
<a href="#l15.688"></a><span id="l15.688" class="difflineplus">+  int *piPosition                     /* OUT: Position integer of token */</span>
<a href="#l15.689"></a><span id="l15.689" class="difflineplus">+){</span>
<a href="#l15.690"></a><span id="l15.690" class="difflineplus">+  porter_tokenizer_cursor *c = (porter_tokenizer_cursor *) pCursor;</span>
<a href="#l15.691"></a><span id="l15.691" class="difflineplus">+  const unsigned char *z = c-&gt;zInput;</span>
<a href="#l15.692"></a><span id="l15.692" class="difflineplus">+  int len = 0;</span>
<a href="#l15.693"></a><span id="l15.693" class="difflineplus">+  int state;</span>
<a href="#l15.694"></a><span id="l15.694" class="difflineplus">+</span>
<a href="#l15.695"></a><span id="l15.695" class="difflineplus">+  while( c-&gt;iOffset&lt;c-&gt;nInput ){</span>
<a href="#l15.696"></a><span id="l15.696" class="difflineplus">+    int iStartOffset, ch;</span>
<a href="#l15.697"></a><span id="l15.697" class="difflineplus">+</span>
<a href="#l15.698"></a><span id="l15.698" class="difflineplus">+    if (c-&gt;iPrevBigramOffset == 0) {</span>
<a href="#l15.699"></a><span id="l15.699" class="difflineplus">+      /* Scan past delimiter characters */</span>
<a href="#l15.700"></a><span id="l15.700" class="difflineplus">+      state = BIGRAM_RESET; /* reset */</span>
<a href="#l15.701"></a><span id="l15.701" class="difflineplus">+      while( c-&gt;iOffset&lt;c-&gt;nInput &amp;&amp; isDelim(z + c-&gt;iOffset, z + c-&gt;nInput - 1, &amp;len, &amp;state)){</span>
<a href="#l15.702"></a><span id="l15.702" class="difflineplus">+        c-&gt;iOffset += len;</span>
<a href="#l15.703"></a><span id="l15.703" class="difflineplus">+      }</span>
<a href="#l15.704"></a><span id="l15.704" class="difflineplus">+</span>
<a href="#l15.705"></a><span id="l15.705" class="difflineplus">+    } else {</span>
<a href="#l15.706"></a><span id="l15.706" class="difflineplus">+      /* for bigram indexing, use previous offset */</span>
<a href="#l15.707"></a><span id="l15.707" class="difflineplus">+      c-&gt;iOffset = c-&gt;iPrevBigramOffset;</span>
<a href="#l15.708"></a><span id="l15.708" class="difflineplus">+    }</span>
<a href="#l15.709"></a><span id="l15.709" class="difflineplus">+</span>
<a href="#l15.710"></a><span id="l15.710" class="difflineplus">+    /* Count non-delimiter characters. */</span>
<a href="#l15.711"></a><span id="l15.711" class="difflineplus">+    iStartOffset = c-&gt;iOffset;</span>
<a href="#l15.712"></a><span id="l15.712" class="difflineplus">+</span>
<a href="#l15.713"></a><span id="l15.713" class="difflineplus">+    state = BIGRAM_RESET; /* state is reset */</span>
<a href="#l15.714"></a><span id="l15.714" class="difflineplus">+    while( c-&gt;iOffset&lt;c-&gt;nInput &amp;&amp; !isDelim(z + c-&gt;iOffset, z + c-&gt;nInput - 1, &amp;len, &amp;state)){</span>
<a href="#l15.715"></a><span id="l15.715" class="difflineplus">+      c-&gt;iOffset += len;</span>
<a href="#l15.716"></a><span id="l15.716" class="difflineplus">+    }</span>
<a href="#l15.717"></a><span id="l15.717" class="difflineplus">+</span>
<a href="#l15.718"></a><span id="l15.718" class="difflineplus">+    if( state==BIGRAM_USE ){</span>
<a href="#l15.719"></a><span id="l15.719" class="difflineplus">+      /* Split word by bigram */</span>
<a href="#l15.720"></a><span id="l15.720" class="difflineplus">+      c-&gt;iPrevBigramOffset = c-&gt;iOffset;</span>
<a href="#l15.721"></a><span id="l15.721" class="difflineplus">+      c-&gt;iOffset += len;</span>
<a href="#l15.722"></a><span id="l15.722" class="difflineplus">+    } else {</span>
<a href="#l15.723"></a><span id="l15.723" class="difflineplus">+      /* Reset bigram offset */</span>
<a href="#l15.724"></a><span id="l15.724" class="difflineplus">+      c-&gt;iPrevBigramOffset = 0;</span>
<a href="#l15.725"></a><span id="l15.725" class="difflineplus">+    }</span>
<a href="#l15.726"></a><span id="l15.726" class="difflineplus">+</span>
<a href="#l15.727"></a><span id="l15.727" class="difflineplus">+    if( c-&gt;iOffset&gt;iStartOffset ){</span>
<a href="#l15.728"></a><span id="l15.728" class="difflineplus">+      int n = c-&gt;iOffset-iStartOffset;</span>
<a href="#l15.729"></a><span id="l15.729" class="difflineplus">+      if( n&gt;c-&gt;nAllocated ){</span>
<a href="#l15.730"></a><span id="l15.730" class="difflineplus">+        c-&gt;nAllocated = n+20;</span>
<a href="#l15.731"></a><span id="l15.731" class="difflineplus">+        c-&gt;zToken = sqlite3_realloc(c-&gt;zToken, c-&gt;nAllocated);</span>
<a href="#l15.732"></a><span id="l15.732" class="difflineplus">+        if( c-&gt;zToken==NULL ) return SQLITE_NOMEM;</span>
<a href="#l15.733"></a><span id="l15.733" class="difflineplus">+      }</span>
<a href="#l15.734"></a><span id="l15.734" class="difflineplus">+      if( state==BIGRAM_USE ){</span>
<a href="#l15.735"></a><span id="l15.735" class="difflineplus">+        /* This is by bigram. So it is unnecessary to convert word */</span>
<a href="#l15.736"></a><span id="l15.736" class="difflineplus">+        copy_stemmer(&amp;z[iStartOffset], n, c-&gt;zToken, pnBytes);</span>
<a href="#l15.737"></a><span id="l15.737" class="difflineplus">+      } else {</span>
<a href="#l15.738"></a><span id="l15.738" class="difflineplus">+        porter_stemmer(&amp;z[iStartOffset], n, c-&gt;zToken, pnBytes);</span>
<a href="#l15.739"></a><span id="l15.739" class="difflineplus">+      }</span>
<a href="#l15.740"></a><span id="l15.740" class="difflineplus">+      *pzToken = c-&gt;zToken;</span>
<a href="#l15.741"></a><span id="l15.741" class="difflineplus">+      *piStartOffset = iStartOffset;</span>
<a href="#l15.742"></a><span id="l15.742" class="difflineplus">+      *piEndOffset = c-&gt;iOffset;</span>
<a href="#l15.743"></a><span id="l15.743" class="difflineplus">+      *piPosition = c-&gt;iToken++;</span>
<a href="#l15.744"></a><span id="l15.744" class="difflineplus">+      return SQLITE_OK;</span>
<a href="#l15.745"></a><span id="l15.745" class="difflineplus">+    }</span>
<a href="#l15.746"></a><span id="l15.746" class="difflineplus">+  }</span>
<a href="#l15.747"></a><span id="l15.747" class="difflineplus">+  return SQLITE_DONE;</span>
<a href="#l15.748"></a><span id="l15.748" class="difflineplus">+}</span>
<a href="#l15.749"></a><span id="l15.749" class="difflineplus">+</span>
<a href="#l15.750"></a><span id="l15.750" class="difflineplus">+/*</span>
<a href="#l15.751"></a><span id="l15.751" class="difflineplus">+** The set of routines that implement the porter-stemmer tokenizer</span>
<a href="#l15.752"></a><span id="l15.752" class="difflineplus">+*/</span>
<a href="#l15.753"></a><span id="l15.753" class="difflineplus">+static const sqlite3_tokenizer_module porterTokenizerModule = {</span>
<a href="#l15.754"></a><span id="l15.754" class="difflineplus">+  0,</span>
<a href="#l15.755"></a><span id="l15.755" class="difflineplus">+  porterCreate,</span>
<a href="#l15.756"></a><span id="l15.756" class="difflineplus">+  porterDestroy,</span>
<a href="#l15.757"></a><span id="l15.757" class="difflineplus">+  porterOpen,</span>
<a href="#l15.758"></a><span id="l15.758" class="difflineplus">+  porterClose,</span>
<a href="#l15.759"></a><span id="l15.759" class="difflineplus">+  porterNext,</span>
<a href="#l15.760"></a><span id="l15.760" class="difflineplus">+};</span>
<a href="#l15.761"></a><span id="l15.761" class="difflineplus">+</span>
<a href="#l15.762"></a><span id="l15.762" class="difflineplus">+/*</span>
<a href="#l15.763"></a><span id="l15.763" class="difflineplus">+** Allocate a new porter tokenizer.  Return a pointer to the new</span>
<a href="#l15.764"></a><span id="l15.764" class="difflineplus">+** tokenizer in *ppModule</span>
<a href="#l15.765"></a><span id="l15.765" class="difflineplus">+*/</span>
<a href="#l15.766"></a><span id="l15.766" class="difflineplus">+void sqlite3Fts3PorterTokenizerModule(</span>
<a href="#l15.767"></a><span id="l15.767" class="difflineplus">+  sqlite3_tokenizer_module const**ppModule</span>
<a href="#l15.768"></a><span id="l15.768" class="difflineplus">+){</span>
<a href="#l15.769"></a><span id="l15.769" class="difflineplus">+  *ppModule = &amp;porterTokenizerModule;</span>
<a href="#l15.770"></a><span id="l15.770" class="difflineplus">+}</span>
<a href="#l15.771"></a><span id="l15.771" class="difflineplus">+</span>
<a href="#l15.772"></a><span id="l15.772" class="difflineplus">+#endif /* !defined(SQLITE_CORE) || defined(SQLITE_ENABLE_FTS3) */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- /dev/null</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ b/mailnews/extensions/fts3/src/fts3_tokenizer.h</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -0,0 +1,148 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineplus">+/*</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineplus">+** 2006 July 10</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineplus">+**</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineplus">+** The author disclaims copyright to this source code.</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+**</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineplus">+*************************************************************************</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+** Defines the interface to tokenizers used by fulltext-search.  There</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+** are three basic components:</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+**</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+** sqlite3_tokenizer_module is a singleton defining the tokenizer</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+** interface functions.  This is essentially the class structure for</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+** tokenizers.</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+**</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+** sqlite3_tokenizer is used to define a particular tokenizer, perhaps</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+** including customization information defined at creation time.</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+**</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+** sqlite3_tokenizer_cursor is generated by a tokenizer to generate</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+** tokens from a particular input.</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+*/</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+#ifndef _FTS3_TOKENIZER_H_</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineplus">+#define _FTS3_TOKENIZER_H_</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+/* TODO(shess) Only used for SQLITE_OK and SQLITE_DONE at this time.</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineplus">+** If tokenizers are to be allowed to call sqlite3_*() functions, then</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+** we will need a way to register the API consistently.</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+*/</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+#include &quot;sqlite3.h&quot;</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+/*</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+** Structures used by the tokenizer interface. When a new tokenizer</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+** implementation is registered, the caller provides a pointer to</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+** an sqlite3_tokenizer_module containing pointers to the callback</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+** functions that make up an implementation.</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+**</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+** When an fts3 table is created, it passes any arguments passed to</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+** the tokenizer clause of the CREATE VIRTUAL TABLE statement to the</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineplus">+** sqlite3_tokenizer_module.xCreate() function of the requested tokenizer</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineplus">+** implementation. The xCreate() function in turn returns an </span>
<a href="#l16.43"></a><span id="l16.43" class="difflineplus">+** sqlite3_tokenizer structure representing the specific tokenizer to</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+** be used for the fts3 table (customized by the tokenizer clause arguments).</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+**</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+** To tokenize an input buffer, the sqlite3_tokenizer_module.xOpen()</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+** method is called. It returns an sqlite3_tokenizer_cursor object</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+** that may be used to tokenize a specific input buffer based on</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineplus">+** the tokenization rules supplied by a specific sqlite3_tokenizer</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+** object.</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+*/</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+typedef struct sqlite3_tokenizer_module sqlite3_tokenizer_module;</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+typedef struct sqlite3_tokenizer sqlite3_tokenizer;</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+typedef struct sqlite3_tokenizer_cursor sqlite3_tokenizer_cursor;</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+struct sqlite3_tokenizer_module {</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+  /*</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+  ** Structure version. Should always be set to 0.</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineplus">+  */</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineplus">+  int iVersion;</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineplus">+  /*</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineplus">+  ** Create a new tokenizer. The values in the argv[] array are the</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+  ** arguments passed to the &quot;tokenizer&quot; clause of the CREATE VIRTUAL</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+  ** TABLE statement that created the fts3 table. For example, if</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+  ** the following SQL is executed:</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineplus">+  **</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+  **   CREATE .. USING fts3( ... , tokenizer &lt;tokenizer-name&gt; arg1 arg2)</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+  **</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+  ** then argc is set to 2, and the argv[] array contains pointers</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineplus">+  ** to the strings &quot;arg1&quot; and &quot;arg2&quot;.</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+  **</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+  ** This method should return either SQLITE_OK (0), or an SQLite error </span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+  ** code. If SQLITE_OK is returned, then *ppTokenizer should be set</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineplus">+  ** to point at the newly created tokenizer structure. The generic</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineplus">+  ** sqlite3_tokenizer.pModule variable should not be initialised by</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+  ** this callback. The caller will do so.</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineplus">+  */</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineplus">+  int (*xCreate)(</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineplus">+    int argc,                           /* Size of argv array */</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineplus">+    const char *const*argv,             /* Tokenizer argument strings */</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineplus">+    sqlite3_tokenizer **ppTokenizer     /* OUT: Created tokenizer */</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+  );</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineplus">+</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineplus">+  /*</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineplus">+  ** Destroy an existing tokenizer. The fts3 module calls this method</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineplus">+  ** exactly once for each successful call to xCreate().</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+  */</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+  int (*xDestroy)(sqlite3_tokenizer *pTokenizer);</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineplus">+  /*</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+  ** Create a tokenizer cursor to tokenize an input buffer. The caller</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+  ** is responsible for ensuring that the input buffer remains valid</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+  ** until the cursor is closed (using the xClose() method). </span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+  */</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineplus">+  int (*xOpen)(</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+    sqlite3_tokenizer *pTokenizer,       /* Tokenizer object */</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+    const char *pInput, int nBytes,      /* Input buffer */</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+    sqlite3_tokenizer_cursor **ppCursor  /* OUT: Created tokenizer cursor */</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineplus">+  );</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+  /*</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineplus">+  ** Destroy an existing tokenizer cursor. The fts3 module calls this </span>
<a href="#l16.105"></a><span id="l16.105" class="difflineplus">+  ** method exactly once for each successful call to xOpen().</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineplus">+  */</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineplus">+  int (*xClose)(sqlite3_tokenizer_cursor *pCursor);</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineplus">+</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineplus">+  /*</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineplus">+  ** Retrieve the next token from the tokenizer cursor pCursor. This</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineplus">+  ** method should either return SQLITE_OK and set the values of the</span>
<a href="#l16.112"></a><span id="l16.112" class="difflineplus">+  ** &quot;OUT&quot; variables identified below, or SQLITE_DONE to indicate that</span>
<a href="#l16.113"></a><span id="l16.113" class="difflineplus">+  ** the end of the buffer has been reached, or an SQLite error code.</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineplus">+  **</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineplus">+  ** *ppToken should be set to point at a buffer containing the </span>
<a href="#l16.116"></a><span id="l16.116" class="difflineplus">+  ** normalized version of the token (i.e. after any case-folding and/or</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineplus">+  ** stemming has been performed). *pnBytes should be set to the length</span>
<a href="#l16.118"></a><span id="l16.118" class="difflineplus">+  ** of this buffer in bytes. The input text that generated the token is</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineplus">+  ** identified by the byte offsets returned in *piStartOffset and</span>
<a href="#l16.120"></a><span id="l16.120" class="difflineplus">+  ** *piEndOffset. *piStartOffset should be set to the index of the first</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineplus">+  ** byte of the token in the input buffer. *piEndOffset should be set</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineplus">+  ** to the index of the first byte just past the end of the token in</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineplus">+  ** the input buffer.</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineplus">+  **</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineplus">+  ** The buffer *ppToken is set to point at is managed by the tokenizer</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineplus">+  ** implementation. It is only required to be valid until the next call</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineplus">+  ** to xNext() or xClose(). </span>
<a href="#l16.128"></a><span id="l16.128" class="difflineplus">+  */</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineplus">+  /* TODO(shess) current implementation requires pInput to be</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineplus">+  ** nul-terminated.  This should either be fixed, or pInput/nBytes</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineplus">+  ** should be converted to zInput.</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineplus">+  */</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineplus">+  int (*xNext)(</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineplus">+    sqlite3_tokenizer_cursor *pCursor,   /* Tokenizer cursor */</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineplus">+    const char **ppToken, int *pnBytes,  /* OUT: Normalized text for token */</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineplus">+    int *piStartOffset,  /* OUT: Byte offset of token in input buffer */</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineplus">+    int *piEndOffset,    /* OUT: Byte offset of end of token in input buffer */</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineplus">+    int *piPosition      /* OUT: Number of tokens returned before this one */</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineplus">+  );</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineplus">+};</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineplus">+</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineplus">+struct sqlite3_tokenizer {</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineplus">+  const sqlite3_tokenizer_module *pModule;  /* The module for this tokenizer */</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineplus">+  /* Tokenizer implementations will typically add additional fields */</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineplus">+};</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineplus">+</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineplus">+struct sqlite3_tokenizer_cursor {</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineplus">+  sqlite3_tokenizer *pTokenizer;       /* Tokenizer for this cursor. */</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineplus">+  /* Tokenizer implementations will typically add additional fields */</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineplus">+};</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineplus">+</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+#endif /* _FTS3_TOKENIZER_H_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/mailnews/extensions/fts3/src/nsFts3Tokenizer.cpp</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,83 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+ *</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+ *</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+ * License.</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+ *</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+ * The Original Code is mozilla.org code.</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+ *</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+ * Mozilla Japan.</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+ *</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+ * Contributor(s):</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+ *   Makoto Kato &lt;m_kato@ga2.so-net.ne.jp&gt;</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+ *</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+ * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+ * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+ *</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+#include &quot;nsFts3Tokenizer.h&quot;</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+#include &quot;nsIFts3Tokenizer.h&quot;</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+#include &quot;mozIStorageConnection.h&quot;</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+#include &quot;mozIStorageStatement.h&quot;</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+#include &quot;nsString.h&quot;</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+extern &quot;C&quot; void sqlite3Fts3PorterTokenizerModule(</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+  sqlite3_tokenizer_module const**ppModule);</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+NS_IMPL_ISUPPORTS1(nsFts3Tokenizer,nsIFts3Tokenizer)</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+nsFts3Tokenizer::nsFts3Tokenizer()</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+{</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+}</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+nsFts3Tokenizer::~nsFts3Tokenizer()</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+{</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+}</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineplus">+nsFts3Tokenizer::RegisterTokenizer(mozIStorageConnection *connection)</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+{</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+    nsresult rv;</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+    nsCOMPtr &lt;mozIStorageStatement&gt; selectStatement;</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+    rv = connection-&gt;CreateStatement(NS_LITERAL_CSTRING(</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+      &quot;SELECT fts3_tokenizer(?1, ?2)&quot;),</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+      getter_AddRefs(selectStatement));</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineplus">+</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+    const sqlite3_tokenizer_module* module = nsnull;</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+    sqlite3Fts3PorterTokenizerModule(&amp;module);</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+    if (!module)</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineplus">+        return NS_ERROR_FAILURE;</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+    rv = selectStatement-&gt;BindStringParameter(0, NS_LITERAL_STRING(&quot;mozporter&quot;));</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineplus">+    rv = selectStatement-&gt;BindBlobParameter(1, (PRUint8*)&amp;module, sizeof(module));</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+    PRBool hasMore;</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+    rv = selectStatement-&gt;ExecuteStep(&amp;hasMore);</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+    return rv;</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/mailnews/extensions/fts3/src/nsFts3Tokenizer.h</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,59 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+ *</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+ *</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+ * License.</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+ *</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+ * The Original Code is mozilla.org code.</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+ *</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+ * Mozilla Japan.</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+ *</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+ * Contributor(s):</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+ *   Makoto Kato &lt;m_kato@ga2.so-net.ne.jp&gt;</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+ *</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+ * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+ * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+ *</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+#ifndef nsFts3Tokenizer_h__</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineplus">+#define nsFts3Tokenizer_h__</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineplus">+</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+#include &quot;nsIFts3Tokenizer.h&quot;</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+#include &quot;fts3_tokenizer.h&quot;</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineplus">+extern const sqlite3_tokenizer_module* getWindowsTokenizer();</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineplus">+class nsFts3Tokenizer : public nsIFts3Tokenizer {</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineplus">+public:</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineplus">+    NS_DECL_ISUPPORTS</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+    NS_DECL_NSIFTS3TOKENIZER</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+    nsFts3Tokenizer();</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+private:</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineplus">+  ~nsFts3Tokenizer();</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineplus">+};</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineplus">+</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineplus">+#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">new file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- /dev/null</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ b/mailnews/extensions/fts3/src/nsFts3TokenizerCID.h</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -0,0 +1,49 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineplus">+ *</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+ *</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+ * License.</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+ *</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+ * The Original Code is mozilla.org code.</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+ *</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+ * Mozilla Japan.</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineplus">+ *</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineplus">+ * Contributor(s):</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineplus">+ *   Makoto Kato &lt;m_kato@ga2.so-net.ne.jp&gt;</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineplus">+ *</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+ * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+ * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+ *</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+ </span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+#ifndef nsFts3TokenizerCID_h__</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+#define nsFts3TokenizerCID_h__</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+#define NS_FTS3TOKENIZER_CONTRACTID \</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+  &quot;@mozilla.org/messenger/fts3tokenizer;1&quot;</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+#define NS_FTS3TOKENIZER_CID			\</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+{ /* a67d724d-0015-4e2e-8cad-b84775330924 */	\</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+  0xa67d724d, 0x0015, 0x4e2e,			\</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+  { 0x8c, 0xad, 0xb8, 0x47, 0x75, 0x33, 0x09, 0x24 }}</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineplus">+</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+#endif /* nsFts3TokenizerCID_h__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/makefiles.sh</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/makefiles.sh</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -68,16 +68,20 @@ mailnews/db/msgdb/build/Makefile</span>
<a href="#l20.4"></a><span id="l20.4"> mailnews/db/msgdb/public/Makefile</span>
<a href="#l20.5"></a><span id="l20.5"> mailnews/db/msgdb/src/Makefile</span>
<a href="#l20.6"></a><span id="l20.6"> mailnews/db/msgdb/test/Makefile</span>
<a href="#l20.7"></a><span id="l20.7"> mailnews/extensions/Makefile</span>
<a href="#l20.8"></a><span id="l20.8"> mailnews/extensions/bayesian-spam-filter/Makefile</span>
<a href="#l20.9"></a><span id="l20.9"> mailnews/extensions/bayesian-spam-filter/build/Makefile</span>
<a href="#l20.10"></a><span id="l20.10"> mailnews/extensions/bayesian-spam-filter/src/Makefile</span>
<a href="#l20.11"></a><span id="l20.11"> mailnews/extensions/bayesian-spam-filter/test/Makefile</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+mailnews/extensions/fts3/Makefile</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+mailnews/extensions/fts3/build/Makefile</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+mailnews/extensions/fts3/public/Makefile</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+mailnews/extensions/fts3/src/Makefile</span>
<a href="#l20.16"></a><span id="l20.16"> mailnews/extensions/mailviews/Makefile</span>
<a href="#l20.17"></a><span id="l20.17"> mailnews/extensions/mailviews/build/Makefile</span>
<a href="#l20.18"></a><span id="l20.18"> mailnews/extensions/mailviews/public/Makefile</span>
<a href="#l20.19"></a><span id="l20.19"> mailnews/extensions/mailviews/content/Makefile</span>
<a href="#l20.20"></a><span id="l20.20"> mailnews/extensions/mailviews/src/Makefile</span>
<a href="#l20.21"></a><span id="l20.21"> mailnews/extensions/mdn/Makefile</span>
<a href="#l20.22"></a><span id="l20.22"> mailnews/extensions/mdn/build/Makefile</span>
<a href="#l20.23"></a><span id="l20.23"> mailnews/extensions/mdn/src/Makefile</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/installer/unix/packages</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/installer/unix/packages</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -517,16 +517,17 @@ bin/updater</span>
<a href="#l21.4"></a><span id="l21.4"> ; component binaries</span>
<a href="#l21.5"></a><span id="l21.5"> bin/components/libimport.so</span>
<a href="#l21.6"></a><span id="l21.6"> bin/components/libmail.so</span>
<a href="#l21.7"></a><span id="l21.7"> bin/components/libmsgsmime.so</span>
<a href="#l21.8"></a><span id="l21.8"> #endif</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10"> ; component xpts</span>
<a href="#l21.11"></a><span id="l21.11"> bin/components/addrbook.xpt</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+bin/components/fts3tok.xpt</span>
<a href="#l21.13"></a><span id="l21.13"> bin/components/import.xpt</span>
<a href="#l21.14"></a><span id="l21.14"> bin/components/impComm4xMail.xpt</span>
<a href="#l21.15"></a><span id="l21.15"> bin/components/mailview.xpt</span>
<a href="#l21.16"></a><span id="l21.16"> bin/components/mime.xpt</span>
<a href="#l21.17"></a><span id="l21.17"> bin/components/msgbase.xpt</span>
<a href="#l21.18"></a><span id="l21.18"> bin/components/msgcompose.xpt</span>
<a href="#l21.19"></a><span id="l21.19"> bin/components/msgdb.xpt</span>
<a href="#l21.20"></a><span id="l21.20"> bin/components/msgimap.xpt</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/installer/windows/packages</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/installer/windows/packages</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -527,16 +527,17 @@ bin\updater.exe</span>
<a href="#l22.4"></a><span id="l22.4"> bin\components\import.dll</span>
<a href="#l22.5"></a><span id="l22.5"> bin\components\mail.dll</span>
<a href="#l22.6"></a><span id="l22.6"> bin\components\msgMapi.dll</span>
<a href="#l22.7"></a><span id="l22.7"> bin\components\msgsmime.dll</span>
<a href="#l22.8"></a><span id="l22.8"> #endif</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10"> ; component xpts</span>
<a href="#l22.11"></a><span id="l22.11"> bin\components\addrbook.xpt</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+bin\components\fts3tok.xpt</span>
<a href="#l22.13"></a><span id="l22.13"> bin\components\import.xpt</span>
<a href="#l22.14"></a><span id="l22.14"> bin\components\impComm4xMail.xpt</span>
<a href="#l22.15"></a><span id="l22.15"> bin\components\mailview.xpt</span>
<a href="#l22.16"></a><span id="l22.16"> bin\components\mapihook.xpt</span>
<a href="#l22.17"></a><span id="l22.17"> bin\components\mime.xpt</span>
<a href="#l22.18"></a><span id="l22.18"> bin\components\msgbase.xpt</span>
<a href="#l22.19"></a><span id="l22.19"> bin\components\msgcompo.xpt</span>
<a href="#l22.20"></a><span id="l22.20"> bin\components\msgdb.xpt</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

