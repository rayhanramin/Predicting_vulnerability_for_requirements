<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8044:ae84f8b74c90e52908360b1fd5cc7077b3b0ad57</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ae84f8b74c90e52908360b1fd5cc7077b3b0ad57" />
<meta property="og:url" content="/comm-central/rev/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57" />
<meta property="og:description" content="Bug 665603 - Centralise sound preferences r=mnyromyr" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ae84f8b74c90e52908360b1fd5cc7077b3b0ad57 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57">shortlog</a> |
<a href="/comm-central/log/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57">files</a> |
changeset |
<a href="/comm-central/raw-rev/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57">raw</a>  | <a href="/comm-central/archive/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=665603">Bug 665603</a> - Centralise sound preferences r=mnyromyr
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#73;&#97;&#110;&#32;&#78;&#101;&#97;&#108;&#32;&#60;&#105;&#97;&#110;&#110;&#95;&#99;&#118;&#115;&#64;&#98;&#108;&#117;&#101;&#121;&#111;&#110;&#100;&#101;&#114;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 05 Jul 2011 00:51:46 +0100</td></tr>

<tr>
 <td>changeset 8044</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57">ae84f8b74c90e52908360b1fd5cc7077b3b0ad57</a></td>
</tr>



<tr>
<td>parent 8043</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e3f147cb26aae09acd4909e62a06d1d33e6097fb">e3f147cb26aae09acd4909e62a06d1d33e6097fb</a>
</td>
</tr>

<tr>
<td>child 8045</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2ffa1a8f346375e9f23d798f7707023748e8e585">2ffa1a8f346375e9f23d798f7707023748e8e585</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ae84f8b74c90e52908360b1fd5cc7077b3b0ad57">6190</a></td></tr>
<tr><td>push user</td><td>iann_cvs@blueyonder.co.uk</td></tr>
<tr><td>push date</td><td class="date age">Mon, 04 Jul 2011 23:51:57 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ae84f8b74c90 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ae84f8b74c90e52908360b1fd5cc7077b3b0ad57">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ae84f8b74c90e52908360b1fd5cc7077b3b0ad57&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ae84f8b74c90e52908360b1fd5cc7077b3b0ad57&newProject=comm-central&newRevision=ae84f8b74c90e52908360b1fd5cc7077b3b0ad57&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ae84f8b74c90e52908360b1fd5cc7077b3b0ad57&newProject=comm-central&newRevision=ae84f8b74c90e52908360b1fd5cc7077b3b0ad57&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ae84f8b74c90e52908360b1fd5cc7077b3b0ad57&newProject=comm-central&newRevision=ae84f8b74c90e52908360b1fd5cc7077b3b0ad57&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mnyromyr%29&revcount=50">mnyromyr</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=665603">665603</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=665603">Bug 665603</a> - Centralise sound preferences r=mnyromyr</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.js">suite/common/pref/pref-download.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.js">file</a> |
<a href="/comm-central/annotate/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.js">annotate</a> |
<a href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.js">diff</a> |
<a href="/comm-central/comparison/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.js">comparison</a> |
<a href="/comm-central/log/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.xul">suite/common/pref/pref-download.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.xul">file</a> |
<a href="/comm-central/annotate/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.xul">annotate</a> |
<a href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.xul">diff</a> |
<a href="/comm-central/comparison/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.xul">comparison</a> |
<a href="/comm-central/log/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-download.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.js">suite/common/pref/pref-popups.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.js">file</a> |
<a href="/comm-central/annotate/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.js">annotate</a> |
<a href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.js">diff</a> |
<a href="/comm-central/comparison/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.js">comparison</a> |
<a href="/comm-central/log/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.xul">suite/common/pref/pref-popups.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.xul">file</a> |
<a href="/comm-central/annotate/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.xul">annotate</a> |
<a href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.xul">diff</a> |
<a href="/comm-central/comparison/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.xul">comparison</a> |
<a href="/comm-central/log/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/pref-popups.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/preferences.js">suite/common/pref/preferences.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/preferences.js">file</a> |
<a href="/comm-central/annotate/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/preferences.js">annotate</a> |
<a href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/preferences.js">diff</a> |
<a href="/comm-central/comparison/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/preferences.js">comparison</a> |
<a href="/comm-central/log/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/common/pref/preferences.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/locales/en-US/chrome/common/pref/pref-popups.dtd">suite/locales/en-US/chrome/common/pref/pref-popups.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/locales/en-US/chrome/common/pref/pref-popups.dtd">file</a> |
<a href="/comm-central/annotate/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/locales/en-US/chrome/common/pref/pref-popups.dtd">annotate</a> |
<a href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/locales/en-US/chrome/common/pref/pref-popups.dtd">diff</a> |
<a href="/comm-central/comparison/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/locales/en-US/chrome/common/pref/pref-popups.dtd">comparison</a> |
<a href="/comm-central/log/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/locales/en-US/chrome/common/pref/pref-popups.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.js">suite/mailnews/prefs/pref-notifications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.js">file</a> |
<a href="/comm-central/annotate/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.js">annotate</a> |
<a href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.js">diff</a> |
<a href="/comm-central/comparison/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.js">comparison</a> |
<a href="/comm-central/log/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.xul">suite/mailnews/prefs/pref-notifications.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.xul">file</a> |
<a href="/comm-central/annotate/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.xul">annotate</a> |
<a href="/comm-central/diff/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.xul">diff</a> |
<a href="/comm-central/comparison/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.xul">comparison</a> |
<a href="/comm-central/log/ae84f8b74c90e52908360b1fd5cc7077b3b0ad57/suite/mailnews/prefs/pref-notifications.xul">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/common/pref/pref-download.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/common/pref/pref-download.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -37,23 +37,24 @@</span>
<a href="#l1.4"></a><span id="l1.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l1.5"></a><span id="l1.5">  *</span>
<a href="#l1.6"></a><span id="l1.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> const kDesktop = 0;</span>
<a href="#l1.9"></a><span id="l1.9"> const kDownloads = 1;</span>
<a href="#l1.10"></a><span id="l1.10"> const kUserDir = 2;</span>
<a href="#l1.11"></a><span id="l1.11"> var gFPHandler;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+var gSoundUrlPref;</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14"> function Startup()</span>
<a href="#l1.15"></a><span id="l1.15"> {</span>
<a href="#l1.16"></a><span id="l1.16">   // Define globals</span>
<a href="#l1.17"></a><span id="l1.17">   gFPHandler = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l1.18"></a><span id="l1.18">                           .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+  gSoundUrlPref = document.getElementById(&quot;browser.download.finished_sound_url&quot;);</span>
<a href="#l1.21"></a><span id="l1.21">   SetSoundEnabled(document.getElementById(&quot;browser.download.finished_download_sound&quot;).value);</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23">   // if we don't have the alert service, hide the pref UI for using alerts to</span>
<a href="#l1.24"></a><span id="l1.24">   // notify on download completion</span>
<a href="#l1.25"></a><span id="l1.25">   // see bug #158711</span>
<a href="#l1.26"></a><span id="l1.26">   var downloadDoneNotificationAlertUI = document.getElementById(&quot;finishedNotificationAlert&quot;);</span>
<a href="#l1.27"></a><span id="l1.27">   downloadDoneNotificationAlertUI.hidden = !(&quot;@mozilla.org/alerts-service;1&quot; in Components.classes);</span>
<a href="#l1.28"></a><span id="l1.28"> }</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineat">@@ -184,59 +185,8 @@ function IndexToFolder(aIndex)</span>
<a href="#l1.30"></a><span id="l1.30">   }</span>
<a href="#l1.31"></a><span id="l1.31"> }</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33"> function SetSoundEnabled(aEnable)</span>
<a href="#l1.34"></a><span id="l1.34"> {</span>
<a href="#l1.35"></a><span id="l1.35">   EnableElementById(&quot;downloadSndURL&quot;, aEnable, false);</span>
<a href="#l1.36"></a><span id="l1.36">   document.getElementById(&quot;downloadSndPlay&quot;).disabled = !aEnable;</span>
<a href="#l1.37"></a><span id="l1.37"> }</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-function BrowseSound()</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-{</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-  var pref = document.getElementById(&quot;browser.download.finished_sound_url&quot;);</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-  const nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-  const nsILocalFile = Components.interfaces.nsILocalFile;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-  var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-                     .createInstance(nsIFilePicker);</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-  var prefutilitiesBundle = document.getElementById(&quot;bundle_prefutilities&quot;);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-  var title = prefutilitiesBundle.getString(&quot;choosesound&quot;);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-  fp.init(window, title, nsIFilePicker.modeOpen);</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-  if (pref.value)</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-    fp.displayDirectory = gFPHandler.getFileFromURLSpec(pref.value)</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-                                    .parent.QueryInterface(nsILocalFile);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-  var ftype = prefutilitiesBundle.getString(&quot;SoundFiles&quot;);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-  fp.appendFilter(ftype, &quot;*.wav; *.wave&quot;);</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-  fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-  if (fp.show() == nsIFilePicker.returnOK)</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-    pref.value = fp.fileURL.spec;</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-}</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-function PlaySound()</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-{</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-  var pref = document.getElementById(&quot;browser.download.finished_sound_url&quot;);</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-  var sound = Components.classes[&quot;@mozilla.org/sound;1&quot;]</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-                        .createInstance(Components.interfaces.nsISound);</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-  if (pref.value)</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-  {</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-    var ioservice = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-                              .getService(Components.interfaces.nsIIOService);</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-    sound.play(ioservice.newURI(pref.value, null, null));</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineminus">-  }</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-  else</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-    sound.beep();</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-}</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-function ReadSndFile(aField)</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-{</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-  var pref = document.getElementById(&quot;browser.download.finished_sound_url&quot;);</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-  if (pref.value)</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-  {</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineminus">-    var file = gFPHandler.getFileFromURLSpec(pref.value);</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineminus">-    aField.file = file;</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-    aField.label = (/Mac/.test(navigator.platform)) ? file.leafName : file.path;</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-  }</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/common/pref/pref-download.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/common/pref/pref-download.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -159,25 +159,25 @@</span>
<a href="#l2.4"></a><span id="l2.4">                   accesskey=&quot;&amp;showAlert.accesskey;&quot;/&gt;</span>
<a href="#l2.5"></a><span id="l2.5">       &lt;/hbox&gt;</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">       &lt;hbox align=&quot;center&quot; class=&quot;indent&quot;&gt;</span>
<a href="#l2.8"></a><span id="l2.8">         &lt;filefield id=&quot;downloadSndURL&quot;</span>
<a href="#l2.9"></a><span id="l2.9">                    flex=&quot;1&quot;</span>
<a href="#l2.10"></a><span id="l2.10">                    preference=&quot;browser.download.finished_sound_url&quot;</span>
<a href="#l2.11"></a><span id="l2.11">                    preference-editable=&quot;true&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                   onsyncfrompreference=&quot;return document.getElementById('download_pane').ReadSndFile(this);&quot;/&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                   onsyncfrompreference=&quot;return WriteSoundField(this, document.getElementById('download_pane').gSoundUrlPref.value);&quot;/&gt;</span>
<a href="#l2.14"></a><span id="l2.14">         &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.15"></a><span id="l2.15">           &lt;button id=&quot;downloadSndBrowse&quot;</span>
<a href="#l2.16"></a><span id="l2.16">                   label=&quot;&amp;browse.label;&quot;</span>
<a href="#l2.17"></a><span id="l2.17">                   accesskey=&quot;&amp;browse.accesskey;&quot;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-                  oncommand=&quot;BrowseSound();&quot;&gt;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+                  oncommand=&quot;SelectSound(gSoundUrlPref);&quot;&gt;</span>
<a href="#l2.20"></a><span id="l2.20">             &lt;observes element=&quot;downloadSndURL&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l2.21"></a><span id="l2.21">           &lt;/button&gt;</span>
<a href="#l2.22"></a><span id="l2.22">           &lt;button id=&quot;downloadSndPlay&quot;</span>
<a href="#l2.23"></a><span id="l2.23">                   label=&quot;&amp;playButton.label;&quot;</span>
<a href="#l2.24"></a><span id="l2.24">                   accesskey=&quot;&amp;playButton.accesskey;&quot;</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-                  oncommand=&quot;PlaySound();&quot;/&gt;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+                  oncommand=&quot;PlaySound(gSoundUrlPref.value, false);&quot;/&gt;</span>
<a href="#l2.27"></a><span id="l2.27">         &lt;/hbox&gt;</span>
<a href="#l2.28"></a><span id="l2.28">       &lt;/hbox&gt;</span>
<a href="#l2.29"></a><span id="l2.29">     &lt;/groupbox&gt;</span>
<a href="#l2.30"></a><span id="l2.30">   &lt;/prefpane&gt;</span>
<a href="#l2.31"></a><span id="l2.31"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/common/pref/pref-popups.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/common/pref/pref-popups.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -30,33 +30,21 @@</span>
<a href="#l3.4"></a><span id="l3.4"> * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l3.5"></a><span id="l3.5"> * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l3.6"></a><span id="l3.6"> * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l3.7"></a><span id="l3.7"> * the provisions above, a recipient may use your version of this file under</span>
<a href="#l3.8"></a><span id="l3.8"> * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.9"></a><span id="l3.9"> *</span>
<a href="#l3.10"></a><span id="l3.10"> * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-const nsIFileProtocolHandler = Components.interfaces.nsIFileProtocolHandler;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-</span>
<a href="#l3.14"></a><span id="l3.14"> var gSoundUrlPref;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-var gSelectSound;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-var gIOService;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-var gFileHandler;</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20"> function Startup()</span>
<a href="#l3.21"></a><span id="l3.21"> {</span>
<a href="#l3.22"></a><span id="l3.22">   gSoundUrlPref = document.getElementById(&quot;privacy.popups.sound_url&quot;);</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-  gSelectSound = document.getElementById(&quot;selectSound&quot;);</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-  gIOService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-                         .getService(Components.interfaces.nsIIOService);</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-  gFileHandler = gIOService.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-                           .QueryInterface(nsIFileProtocolHandler);</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30">   SetLists();</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32">   SetButtons();</span>
<a href="#l3.33"></a><span id="l3.33"> }</span>
<a href="#l3.34"></a><span id="l3.34"> </span>
<a href="#l3.35"></a><span id="l3.35"> function SetLists()</span>
<a href="#l3.36"></a><span id="l3.36"> {</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineat">@@ -136,50 +124,11 @@ function EnableSoundRadio(aSoundChecked)</span>
<a href="#l3.38"></a><span id="l3.38">   EnableElement(element, aSoundChecked, false);</span>
<a href="#l3.39"></a><span id="l3.39">   var pref = document.getElementById(element.getAttribute(&quot;preference&quot;));</span>
<a href="#l3.40"></a><span id="l3.40">   EnableSoundUrl(aSoundChecked &amp;&amp; (pref.value == kCustomSound));</span>
<a href="#l3.41"></a><span id="l3.41"> }</span>
<a href="#l3.42"></a><span id="l3.42"> </span>
<a href="#l3.43"></a><span id="l3.43"> function EnableSoundUrl(aCustomSelected)</span>
<a href="#l3.44"></a><span id="l3.44"> {</span>
<a href="#l3.45"></a><span id="l3.45">   EnableElementById(&quot;playSoundUrl&quot;, aCustomSelected, false);</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-  EnableElement(gSelectSound, aCustomSelected, false);</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+  EnableElementById(&quot;selectSound&quot;, aCustomSelected, false);</span>
<a href="#l3.48"></a><span id="l3.48">   EnableElementById(&quot;playSoundButton&quot;, aCustomSelected, false);</span>
<a href="#l3.49"></a><span id="l3.49"> }</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-function ReadSoundLocation(aElement)</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-{</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-  aElement.value = gSoundUrlPref.value;</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-  if (aElement.value)</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-    aElement.file = gFileHandler.getFileFromURLSpec(aElement.value);</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-}</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-function SelectSound()</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-{</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-  const nsILocalFile = Components.interfaces.nsILocalFile;</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-  const nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-  var filepicker = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-                             .createInstance(nsIFilePicker);</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-  filepicker.init(window,</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-                  gSelectSound.getAttribute(&quot;filepickertitle&quot;),</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-                  nsIFilePicker.modeOpen);</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-  if (gSoundUrlPref.value)</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-    filepicker.displayDirectory = gFileHandler.getFileFromURLSpec(gSoundUrlPref.value).parent;</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-  filepicker.appendFilter(gSelectSound.getAttribute(&quot;filepickerfilter&quot;),</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-                          &quot;*.wav; *.wave&quot;);</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-  filepicker.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-  if (filepicker.show() == nsIFilePicker.returnOK)</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-    gSoundUrlPref.value = filepicker.fileURL.spec;</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-}</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-function PlaySound()</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-{</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-  var soundUrl = gSoundUrlPref.value;</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-  var sound = Components.classes[&quot;@mozilla.org/sound;1&quot;]</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-                        .createInstance(Components.interfaces.nsISound);</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-  if (soundUrl)</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-    sound.play(gIOService.newURI(soundUrl, null, null));</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-  else</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-    sound.beep();</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/common/pref/pref-popups.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/common/pref/pref-popups.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -130,30 +130,28 @@</span>
<a href="#l4.4"></a><span id="l4.4">                  accesskey=&quot;&amp;customSound.accesskey;&quot;/&gt;</span>
<a href="#l4.5"></a><span id="l4.5">         &lt;/radiogroup&gt;</span>
<a href="#l4.6"></a><span id="l4.6">       &lt;/hbox&gt;</span>
<a href="#l4.7"></a><span id="l4.7">       &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l4.8"></a><span id="l4.8">         &lt;filefield id=&quot;playSoundUrl&quot;</span>
<a href="#l4.9"></a><span id="l4.9">                    flex=&quot;1&quot;</span>
<a href="#l4.10"></a><span id="l4.10">                    preference=&quot;privacy.popups.sound_url&quot;</span>
<a href="#l4.11"></a><span id="l4.11">                    preference-editable=&quot;true&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                   onsyncfrompreference=&quot;return document.getElementById('popups_pane').ReadSoundLocation(this);&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                   onsyncfrompreference=&quot;return WriteSoundField(this, document.getElementById('popups_pane').gSoundUrlPref.value);&quot;</span>
<a href="#l4.14"></a><span id="l4.14">                    aria-labelledby=&quot;popupCustomSound&quot;/&gt;</span>
<a href="#l4.15"></a><span id="l4.15">         &lt;button id=&quot;selectSound&quot;</span>
<a href="#l4.16"></a><span id="l4.16">                 label=&quot;&amp;selectSound.label;&quot;</span>
<a href="#l4.17"></a><span id="l4.17">                 accesskey=&quot;&amp;selectSound.accesskey;&quot;</span>
<a href="#l4.18"></a><span id="l4.18">                 preference=&quot;pref.advanced.popups.disable_button.select_sound&quot;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-                filepickertitle=&quot;&amp;selectSound.title;&quot;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-                filepickerfilter=&quot;&amp;selectSound.filter;&quot;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-                oncommand=&quot;SelectSound();&quot;/&gt;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+                oncommand=&quot;SelectSound(gSoundUrlPref);&quot;/&gt;</span>
<a href="#l4.23"></a><span id="l4.23">         &lt;button id=&quot;playSoundButton&quot;</span>
<a href="#l4.24"></a><span id="l4.24">                 label=&quot;&amp;playSoundButton.label;&quot;</span>
<a href="#l4.25"></a><span id="l4.25">                 accesskey=&quot;&amp;playSoundButton.accesskey;&quot;</span>
<a href="#l4.26"></a><span id="l4.26">                 preference=&quot;pref.advanced.popups.disable_button.preview_sound&quot;</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-                oncommand=&quot;PlaySound();&quot;/&gt;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+                oncommand=&quot;PlaySound(gSoundUrlPref.value, false);&quot;/&gt;</span>
<a href="#l4.29"></a><span id="l4.29">       &lt;/hbox&gt;</span>
<a href="#l4.30"></a><span id="l4.30">       &lt;hbox&gt;</span>
<a href="#l4.31"></a><span id="l4.31">         &lt;checkbox id=&quot;displayIcon&quot;</span>
<a href="#l4.32"></a><span id="l4.32">                   label=&quot;&amp;displayIcon.label;&quot;</span>
<a href="#l4.33"></a><span id="l4.33">                   accesskey=&quot;&amp;displayIcon.accesskey;&quot;</span>
<a href="#l4.34"></a><span id="l4.34">                   preference=&quot;privacy.popups.statusbar_icon_enabled&quot;/&gt;</span>
<a href="#l4.35"></a><span id="l4.35">       &lt;/hbox&gt;</span>
<a href="#l4.36"></a><span id="l4.36">       &lt;hbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/common/pref/preferences.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/common/pref/preferences.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -49,8 +49,56 @@ function EnableElement(aElement, aEnable</span>
<a href="#l5.4"></a><span id="l5.4">   let pref = document.getElementById(aElement.getAttribute(&quot;preference&quot;));</span>
<a href="#l5.5"></a><span id="l5.5">   let enabled = aEnable &amp;&amp; !pref.locked;</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7">   aElement.disabled = !enabled;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   if (enabled &amp;&amp; aFocus)</span>
<a href="#l5.10"></a><span id="l5.10">     aElement.focus();</span>
<a href="#l5.11"></a><span id="l5.11"> }</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+function WriteSoundField(aField, aValue)</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+{</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+  var file = GetFileFromString(aValue);</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+  if (file)</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+  {</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+    aField.file = file;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+    aField.label = (/Mac/.test(navigator.platform)) ? file.leafName : file.path;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+  }</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+}</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+function SelectSound(aSoundUrlPref)</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+{</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+  const nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+  var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+                     .createInstance(nsIFilePicker);</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+  var prefutilitiesBundle = document.getElementById(&quot;bundle_prefutilities&quot;);</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+  fp.init(window, prefutilitiesBundle.getString(&quot;choosesound&quot;),</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+          nsIFilePicker.modeOpen);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  var file = GetFileFromString(aSoundUrlPref.value);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+  if (file &amp;&amp; file.parent &amp;&amp; file.parent.exists())</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+    fp.displayDirectory = file.parent;</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+  var filterExts = &quot;*.wav; *.wave&quot;;</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+  // On Mac, allow AIFF files too.</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+  if (/Mac/.test(navigator.platform))</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+    filterExts += &quot;; *.aif; *.aiff&quot;;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+  fp.appendFilter(prefutilitiesBundle.getString(&quot;SoundFiles&quot;), filterExts);</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+  if (fp.show() == nsIFilePicker.returnOK)</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+    aSoundUrlPref.value = fp.fileURL.spec;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+}</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+function PlaySound(aValue, aMail)</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+{</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+  const nsISound = Components.interfaces.nsISound;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+  var sound = Components.classes[&quot;@mozilla.org/sound;1&quot;]</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+                        .createInstance(nsISound);</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+  if (aValue)</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+    sound.play(Services.io.newURI(aValue, null, null));</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+  else if (aMail &amp;&amp; !/Mac/.test(navigator.platform))</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+    sound.playEventSound(nsISound.EVENT_NEW_MAIL_RECEIVED);</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+  else</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+    sound.beep();</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/pref/pref-popups.dtd</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/pref/pref-popups.dtd</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -15,18 +15,16 @@</span>
<a href="#l6.4"></a><span id="l6.4"> &lt;!ENTITY systemSound.accesskey          &quot;S&quot;&gt;</span>
<a href="#l6.5"></a><span id="l6.5"> &lt;!ENTITY customSound.label              &quot;Custom sound file&quot;&gt;</span>
<a href="#l6.6"></a><span id="l6.6"> &lt;!ENTITY customSound.accesskey          &quot;C&quot;&gt;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> &lt;!ENTITY selectSound.label              &quot;Browse…&quot;&gt;</span>
<a href="#l6.9"></a><span id="l6.9"> &lt;!ENTITY selectSound.accesskey          &quot;o&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10"> &lt;!ENTITY playSoundButton.label          &quot;Play&quot;&gt;</span>
<a href="#l6.11"></a><span id="l6.11"> &lt;!ENTITY playSoundButton.accesskey      &quot;l&quot;&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-&lt;!ENTITY selectSound.title              &quot;Select Popup Block Sound&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-&lt;!ENTITY selectSound.filter             &quot;Sounds&quot;&gt;</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15"> &lt;!ENTITY displayIcon.label              &quot;Display an icon in the browser status bar&quot;&gt;</span>
<a href="#l6.16"></a><span id="l6.16"> &lt;!ENTITY displayIcon.accesskey          &quot;D&quot;&gt;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> &lt;!ENTITY displayNotification.label      &quot;Display a notification bar at the top of the content area&quot;&gt;</span>
<a href="#l6.19"></a><span id="l6.19"> &lt;!ENTITY displayNotification.accesskey  &quot;N&quot;&gt;</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21"> &lt;!ENTITY popupNote.description          &quot;Note: Blocking all popups may prevent important features of some websites from working, such as login windows for banks and shopping websites. For details of how to allow specific websites to use popups while blocking all others, click Help. Even if blocked, websites may use other methods to show popups.&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/mailnews/prefs/pref-notifications.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/mailnews/prefs/pref-notifications.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -33,36 +33,30 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l7.5"></a><span id="l7.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.6"></a><span id="l7.6">  *</span>
<a href="#l7.7"></a><span id="l7.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> // The contents of this file will be loaded into the scope of the object</span>
<a href="#l7.10"></a><span id="l7.10"> // &lt;prefpane id=&quot;notifications_pane&quot;&gt;!</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-const nsIFileProtocolHandler = Components.interfaces.nsIFileProtocolHandler;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-var gSound = null;</span>
<a href="#l7.15"></a><span id="l7.15"> var gSoundUrlPref = null;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-var gFileHandler = null;</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> function Startup()</span>
<a href="#l7.19"></a><span id="l7.19"> {</span>
<a href="#l7.20"></a><span id="l7.20">   // if we don't have the alert service, hide the pref UI for using alerts to notify on new mail</span>
<a href="#l7.21"></a><span id="l7.21">   // see bug #158711</span>
<a href="#l7.22"></a><span id="l7.22">   var newMailNotificationAlertUI = document.getElementById(&quot;newMailNotificationAlert&quot;);</span>
<a href="#l7.23"></a><span id="l7.23">   newMailNotificationAlertUI.hidden = !(&quot;@mozilla.org/alerts-service;1&quot; in Components.classes);</span>
<a href="#l7.24"></a><span id="l7.24">   if (!/Mac/.test(navigator.platform))</span>
<a href="#l7.25"></a><span id="l7.25">     document.getElementById('newMailNotificationBounce').setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l7.26"></a><span id="l7.26">   // show tray icon option currently available for Windows only</span>
<a href="#l7.27"></a><span id="l7.27">   var newMailNotificationTrayIconPref = document.getElementById(&quot;newMailNotificationTrayIcon&quot;);</span>
<a href="#l7.28"></a><span id="l7.28">   newMailNotificationTrayIconPref.hidden = !/^Win/.test(navigator.platform);</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-  gFileHandler = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-                            .QueryInterface(nsIFileProtocolHandler);</span>
<a href="#l7.32"></a><span id="l7.32">   gSoundUrlPref = document.getElementById(&quot;mail.biff.play_sound.url&quot;);</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34">   PlaySoundCheck(document.getElementById(&quot;mail.biff.play_sound&quot;).value);</span>
<a href="#l7.35"></a><span id="l7.35"> }</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37"> function PlaySoundCheck(aPlaySound)</span>
<a href="#l7.38"></a><span id="l7.38"> {</span>
<a href="#l7.39"></a><span id="l7.39">   let playSoundType = document.getElementById(&quot;mail.biff.play_sound.type&quot;).value;</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineat">@@ -70,50 +64,8 @@ function PlaySoundCheck(aPlaySound)</span>
<a href="#l7.41"></a><span id="l7.41">   EnableElementById(&quot;newMailNotificationType&quot;, aPlaySound, false);</span>
<a href="#l7.42"></a><span id="l7.42">   EnableSoundURL(aPlaySound &amp;&amp; (playSoundType == 1));</span>
<a href="#l7.43"></a><span id="l7.43"> }</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45"> function EnableSoundURL(aEnable)</span>
<a href="#l7.46"></a><span id="l7.46"> {</span>
<a href="#l7.47"></a><span id="l7.47">   EnableElementById(&quot;mailnewsSoundFileUrl&quot;, aEnable, false);</span>
<a href="#l7.48"></a><span id="l7.48"> }</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-function SelectSound()</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-{</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-  var prefBundle = document.getElementById(&quot;bundle_prefutilities&quot;);</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-  var nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-  var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-                     .createInstance(nsIFilePicker);</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-  fp.init(window, prefBundle.getString(&quot;choosesound&quot;), nsIFilePicker.modeOpen);</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-  if (gSoundUrlPref.value != &quot;&quot;)</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-    fp.displayDirectory = gFileHandler.getFileFromURLSpec(gSoundUrlPref.value).parent;</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-  fp.appendFilter(prefBundle.getString(&quot;SoundFiles&quot;), &quot;*.wav; *.wave&quot;);</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineminus">-  fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-  if (fp.show() == nsIFilePicker.returnOK)</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-    gSoundUrlPref.value = fp.fileURL.spec;</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-}</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-function ReadSoundLocation(aElement)</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-{</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-  aElement.value = gSoundUrlPref.value;</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineminus">-  if (aElement.value)</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-    aElement.file = gFileHandler.getFileFromURLSpec(aElement.value);</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-}</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-function PlaySound()</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-{</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-  const nsISound = Components.interfaces.nsISound;</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineminus">-  if (!gSound)</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-    gSound = Components.classes[&quot;@mozilla.org/sound;1&quot;]</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-                       .createInstance(nsISound);</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-  var soundURL = gSoundUrlPref.value;</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineminus">-  if (soundURL)</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-    gSound.play(Services.io.newURI(soundURL, null, null));</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-  else if (/Mac/.test(navigator.platform))</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineminus">-    gSound.beep();</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-  else</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineminus">-    gSound.playEventSound(nsISound.EVENT_NEW_MAIL_RECEIVED);</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/mailnews/prefs/pref-notifications.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/mailnews/prefs/pref-notifications.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -115,29 +115,29 @@</span>
<a href="#l8.4"></a><span id="l8.4">         &lt;/radiogroup&gt;</span>
<a href="#l8.5"></a><span id="l8.5">       &lt;/hbox&gt;</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7">       &lt;hbox align=&quot;center&quot; class=&quot;indent&quot;&gt;</span>
<a href="#l8.8"></a><span id="l8.8">         &lt;filefield id=&quot;mailnewsSoundFileUrl&quot;</span>
<a href="#l8.9"></a><span id="l8.9">                    flex=&quot;1&quot;</span>
<a href="#l8.10"></a><span id="l8.10">                    preference=&quot;mail.biff.play_sound.url&quot;</span>
<a href="#l8.11"></a><span id="l8.11">                    preference-editable=&quot;true&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-                   onsyncfrompreference=&quot;return document.getElementById('notifications_pane').ReadSoundLocation(this);&quot;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                   onsyncfrompreference=&quot;return WriteSoundField(this, document.getElementById('notifications_pane').gSoundUrlPref.value);&quot;</span>
<a href="#l8.14"></a><span id="l8.14">                    aria-labelledby=&quot;custom&quot;/&gt;</span>
<a href="#l8.15"></a><span id="l8.15">         &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l8.16"></a><span id="l8.16">           &lt;button id=&quot;browse&quot;</span>
<a href="#l8.17"></a><span id="l8.17">                   label=&quot;&amp;browse.label;&quot;</span>
<a href="#l8.18"></a><span id="l8.18">                   filepickertitle=&quot;&amp;browse.title;&quot;</span>
<a href="#l8.19"></a><span id="l8.19">                   accesskey=&quot;&amp;browse.accesskey;&quot;</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-                  oncommand=&quot;SelectSound();&quot;&gt;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+                  oncommand=&quot;SelectSound(gSoundUrlPref);&quot;&gt;</span>
<a href="#l8.22"></a><span id="l8.22">             &lt;observes element=&quot;mailnewsSoundFileUrl&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l8.23"></a><span id="l8.23">           &lt;/button&gt;</span>
<a href="#l8.24"></a><span id="l8.24">           &lt;button id=&quot;playButton&quot;</span>
<a href="#l8.25"></a><span id="l8.25">                   label=&quot;&amp;playButton.label;&quot;</span>
<a href="#l8.26"></a><span id="l8.26">                   accesskey=&quot;&amp;playButton.accesskey;&quot;</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-                  oncommand=&quot;PlaySound();&quot;&gt;</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+                  oncommand=&quot;PlaySound(gSoundUrlPref.value, true);&quot;&gt;</span>
<a href="#l8.29"></a><span id="l8.29">             &lt;observes element=&quot;mailnewsSoundFileUrl&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l8.30"></a><span id="l8.30">           &lt;/button&gt;</span>
<a href="#l8.31"></a><span id="l8.31">         &lt;/hbox&gt;</span>
<a href="#l8.32"></a><span id="l8.32">       &lt;/hbox&gt;</span>
<a href="#l8.33"></a><span id="l8.33">     &lt;/groupbox&gt;</span>
<a href="#l8.34"></a><span id="l8.34">   &lt;/prefpane&gt;</span>
<a href="#l8.35"></a><span id="l8.35"> &lt;/overlay&gt;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

