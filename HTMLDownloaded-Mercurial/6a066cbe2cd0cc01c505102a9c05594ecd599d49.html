<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 7030:6a066cbe2cd0cc01c505102a9c05594ecd599d49</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6a066cbe2cd0cc01c505102a9c05594ecd599d49" />
<meta property="og:url" content="/comm-central/rev/6a066cbe2cd0cc01c505102a9c05594ecd599d49" />
<meta property="og:description" content="Bug 576970 - Port Sync UI to SeaMonkey. Part 9: about:sync-tabs. r=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6a066cbe2cd0cc01c505102a9c05594ecd599d49 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6a066cbe2cd0cc01c505102a9c05594ecd599d49">shortlog</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6a066cbe2cd0cc01c505102a9c05594ecd599d49">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49">files</a> |
changeset |
<a href="/comm-central/raw-rev/6a066cbe2cd0cc01c505102a9c05594ecd599d49">raw</a>  | <a href="/comm-central/archive/6a066cbe2cd0cc01c505102a9c05594ecd599d49.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=576970">Bug 576970</a> - Port Sync UI to SeaMonkey. Part 9: about:sync-tabs. r=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#101;&#110;&#115;&#32;&#72;&#97;&#116;&#108;&#97;&#107;&#32;&#60;&#106;&#104;&#64;&#106;&#117;&#110;&#101;&#116;&#122;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 27 Jan 2011 23:32:33 +0100</td></tr>

<tr>
 <td>changeset 7030</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6a066cbe2cd0cc01c505102a9c05594ecd599d49">6a066cbe2cd0cc01c505102a9c05594ecd599d49</a></td>
</tr>



<tr>
<td>parent 7029</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a3c015715a4d6845cdf2236eebb221ed0887ef90">a3c015715a4d6845cdf2236eebb221ed0887ef90</a>
</td>
</tr>

<tr>
<td>child 7031</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0f313f7b192e43778d922ce4b4b34d72186b3839">0f313f7b192e43778d922ce4b4b34d72186b3839</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6a066cbe2cd0cc01c505102a9c05594ecd599d49">5380</a></td></tr>
<tr><td>push user</td><td>jh@junetz.de</td></tr>
<tr><td>push date</td><td class="date age">Thu, 27 Jan 2011 22:37:38 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6a066cbe2cd0 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6a066cbe2cd0cc01c505102a9c05594ecd599d49">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6a066cbe2cd0cc01c505102a9c05594ecd599d49&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6a066cbe2cd0cc01c505102a9c05594ecd599d49&newProject=comm-central&newRevision=c11d58cfe431ca22ae8c198b249971372add76bc&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6a066cbe2cd0cc01c505102a9c05594ecd599d49&newProject=comm-central&newRevision=c11d58cfe431ca22ae8c198b249971372add76bc&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6a066cbe2cd0cc01c505102a9c05594ecd599d49&newProject=comm-central&newRevision=c11d58cfe431ca22ae8c198b249971372add76bc&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=576970">576970</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=576970">Bug 576970</a> - Port Sync UI to SeaMonkey. Part 9: about:sync-tabs. r=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigator.js">suite/browser/navigator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigator.js">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigator.js">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigator.js">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigator.js">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigatorOverlay.xul">suite/browser/navigatorOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigatorOverlay.xul">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigatorOverlay.xul">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigatorOverlay.xul">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigatorOverlay.xul">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/navigatorOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/sessionHistoryUI.js">suite/browser/sessionHistoryUI.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/sessionHistoryUI.js">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/sessionHistoryUI.js">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/sessionHistoryUI.js">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/sessionHistoryUI.js">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/browser/sessionHistoryUI.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/Makefile.in">suite/common/src/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/Makefile.in">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/Makefile.in">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/SuiteCommon.manifest">suite/common/src/SuiteCommon.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/SuiteCommon.manifest">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/SuiteCommon.manifest">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/SuiteCommon.manifest">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/SuiteCommon.manifest">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/SuiteCommon.manifest">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsAboutSyncTabs.js">suite/common/src/nsAboutSyncTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsAboutSyncTabs.js">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsAboutSyncTabs.js">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsAboutSyncTabs.js">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsAboutSyncTabs.js">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsAboutSyncTabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsSuiteGlue.js">suite/common/src/nsSuiteGlue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsSuiteGlue.js">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsSuiteGlue.js">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsSuiteGlue.js">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsSuiteGlue.js">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/src/nsSuiteGlue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs-bindings.xml">suite/common/sync/aboutSyncTabs-bindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs-bindings.xml">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs-bindings.xml">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs-bindings.xml">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs-bindings.xml">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs-bindings.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.css">suite/common/sync/aboutSyncTabs.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.css">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.css">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.css">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.css">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.js">suite/common/sync/aboutSyncTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.js">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.js">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.js">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.js">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.xul">suite/common/sync/aboutSyncTabs.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.xul">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.xul">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.xul">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.xul">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/common/sync/aboutSyncTabs.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/mailnews/msgMail3PaneWindow.js">suite/mailnews/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/mailnews/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/mailnews/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/mailnews/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/mailnews/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/6a066cbe2cd0cc01c505102a9c05594ecd599d49/suite/mailnews/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/browser/navigator.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/browser/navigator.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -713,16 +713,19 @@ function Startup()</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   // bookmark-all-tabs command</span>
<a href="#l1.6"></a><span id="l1.6">   gBookmarkAllTabsHandler.init();</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">   gBrowser.mPanelContainer.addEventListener(&quot;InstallBrowserTheme&quot;, LightWeightThemeWebInstaller, false, true);</span>
<a href="#l1.9"></a><span id="l1.9">   gBrowser.mPanelContainer.addEventListener(&quot;PreviewBrowserTheme&quot;, LightWeightThemeWebInstaller, false, true);</span>
<a href="#l1.10"></a><span id="l1.10">   gBrowser.mPanelContainer.addEventListener(&quot;ResetBrowserThemePreview&quot;, LightWeightThemeWebInstaller, false, true);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+  // initialize the sync UI</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  gSyncUI.init();</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">   // initialize the session-restore service</span>
<a href="#l1.16"></a><span id="l1.16">   setTimeout(InitSessionStoreCallback, 0);</span>
<a href="#l1.17"></a><span id="l1.17"> }</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> function UpdateNavBar()</span>
<a href="#l1.20"></a><span id="l1.20"> {</span>
<a href="#l1.21"></a><span id="l1.21">   var elements = getNavToolbox().getElementsByClassName(&quot;nav-bar-class&quot;);</span>
<a href="#l1.22"></a><span id="l1.22">   for (var i = 0; i &lt; elements.length; i++) {</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -1316,16 +1319,21 @@ function BrowserOpenTab()</span>
<a href="#l1.24"></a><span id="l1.24">     gBrowser.selectedTab = gBrowser.addTab(uriToLoad);</span>
<a href="#l1.25"></a><span id="l1.25">     if (uriToLoad == &quot;about:blank&quot; &amp;&amp; isElementVisible(gURLBar))</span>
<a href="#l1.26"></a><span id="l1.26">       setTimeout(WindowFocusTimerCallback, 0, gURLBar);</span>
<a href="#l1.27"></a><span id="l1.27">     else</span>
<a href="#l1.28"></a><span id="l1.28">       setTimeout(WindowFocusTimerCallback, 0, content);</span>
<a href="#l1.29"></a><span id="l1.29">   }</span>
<a href="#l1.30"></a><span id="l1.30"> }</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+function BrowserOpenSyncTabs()</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+{</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+  switchToTabHavingURI(&quot;about:sync-tabs&quot;, true);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+}</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+</span>
<a href="#l1.37"></a><span id="l1.37"> /* Show file picker dialog configured for opening a file, and return </span>
<a href="#l1.38"></a><span id="l1.38">  * the selected nsIFileURL instance. */</span>
<a href="#l1.39"></a><span id="l1.39"> function selectFileToOpen(label, prefRoot)</span>
<a href="#l1.40"></a><span id="l1.40"> {</span>
<a href="#l1.41"></a><span id="l1.41">   var fileURL = null;</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43">   // Get filepicker component.</span>
<a href="#l1.44"></a><span id="l1.44">   const nsIFilePicker = Components.interfaces.nsIFilePicker;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/browser/navigatorOverlay.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/browser/navigatorOverlay.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -417,16 +417,20 @@</span>
<a href="#l2.4"></a><span id="l2.4">                   key=&quot;key_gotoHistory&quot;/&gt;</span>
<a href="#l2.5"></a><span id="l2.5">         &lt;menuseparator id=&quot;startHistorySeparator&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l2.6"></a><span id="l2.6">         &lt;menuseparator id=&quot;endHistorySeparator&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l2.7"></a><span id="l2.7">         &lt;menuitem id=&quot;historyRestoreLastSession&quot;</span>
<a href="#l2.8"></a><span id="l2.8">                   label=&quot;&amp;historyRestoreLastSession.label;&quot;</span>
<a href="#l2.9"></a><span id="l2.9">                   accesskey=&quot;&amp;historyRestoreLastSession.accesskey;&quot;</span>
<a href="#l2.10"></a><span id="l2.10">                   oncommand=&quot;restoreLastSession();&quot;</span>
<a href="#l2.11"></a><span id="l2.11">                   disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+        &lt;menuitem id=&quot;sync-tabs-menuitem&quot;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                  label=&quot;&amp;syncTabsMenu.label;&quot;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+                  oncommand=&quot;BrowserOpenSyncTabs();&quot;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+                  disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.16"></a><span id="l2.16">       &lt;/menupopup&gt;</span>
<a href="#l2.17"></a><span id="l2.17">     &lt;/menu&gt;</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">     &lt;menu id=&quot;bookmarksMenu&quot;</span>
<a href="#l2.20"></a><span id="l2.20">           label=&quot;&amp;bookmarksMenu.label;&quot;</span>
<a href="#l2.21"></a><span id="l2.21">           accesskey=&quot;&amp;bookmarksMenu.accesskey;&quot;</span>
<a href="#l2.22"></a><span id="l2.22">           ondragenter=&quot;PlacesMenuDNDHandler.onDragEnter(event);&quot;</span>
<a href="#l2.23"></a><span id="l2.23">           ondragover=&quot;PlacesMenuDNDHandler.onDragOver(event);&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/browser/sessionHistoryUI.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/browser/sessionHistoryUI.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -37,16 +37,36 @@</span>
<a href="#l3.4"></a><span id="l3.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l3.5"></a><span id="l3.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.6"></a><span id="l3.6">  *</span>
<a href="#l3.7"></a><span id="l3.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.8"></a><span id="l3.8"> const MAX_HISTORY_MENU_ITEMS = 15;</span>
<a href="#l3.9"></a><span id="l3.9"> const MAX_URLBAR_HISTORY_MENU_ITEMS = 30;</span>
<a href="#l3.10"></a><span id="l3.10"> const MAX_URLBAR_HISTORY_ITEMS = 100;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+function toggleTabsFromOtherComputers()</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    // enable/disable the Tabs From Other Computers menu</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+    let menuitem = document.getElementById(&quot;sync-tabs-menuitem&quot;);</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+    // If Sync isn't configured yet, then don't show the menuitem.</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+    if (Weave.Status.service == Weave.CLIENT_NOT_CONFIGURED ||</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+        Weave.Svc.Prefs.get(&quot;firstSync&quot;, &quot;&quot;) == &quot;notReady&quot;) {</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+      menuitem.hidden = true;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+      return;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+    }</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+    // The tabs engine might never be inited (if services.sync.registerEngines</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+    // is modified), so make sure we avoid undefined errors.</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+    let enabled = Weave.Service.isLoggedIn &amp;&amp; Weave.Engines.get(&quot;tabs&quot;) &amp;&amp;</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+                  Weave.Engines.get(&quot;tabs&quot;).enabled;</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+    menuitem.setAttribute(&quot;disabled&quot;, !enabled);</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+    menuitem.hidden = false;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+  }</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+</span>
<a href="#l3.32"></a><span id="l3.32"> function FillHistoryMenu(aParent, aMenu)</span>
<a href="#l3.33"></a><span id="l3.33">   {</span>
<a href="#l3.34"></a><span id="l3.34">     // Remove old entries if any</span>
<a href="#l3.35"></a><span id="l3.35">     deleteHistoryItems(aParent);</span>
<a href="#l3.36"></a><span id="l3.36"> </span>
<a href="#l3.37"></a><span id="l3.37">     var sessionHistory = getWebNavigation().sessionHistory;</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39">     var count = sessionHistory.count;</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineat">@@ -84,16 +104,17 @@ function FillHistoryMenu(aParent, aMenu)</span>
<a href="#l3.41"></a><span id="l3.41">           endHistory.hidden = (endHistory == aParent.lastChild);</span>
<a href="#l3.42"></a><span id="l3.42">           end = count &gt; MAX_HISTORY_MENU_ITEMS ? count - MAX_HISTORY_MENU_ITEMS : 0;</span>
<a href="#l3.43"></a><span id="l3.43">           for (j = count - 1; j &gt;= end; j--)</span>
<a href="#l3.44"></a><span id="l3.44">             {</span>
<a href="#l3.45"></a><span id="l3.45">               entry = sessionHistory.getEntryAtIndex(j, false);</span>
<a href="#l3.46"></a><span id="l3.46">               if (entry)</span>
<a href="#l3.47"></a><span id="l3.47">                 createRadioMenuItem(aParent, endHistory, j, entry.title, j == index);</span>
<a href="#l3.48"></a><span id="l3.48">             }</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+          toggleTabsFromOtherComputers();</span>
<a href="#l3.50"></a><span id="l3.50">           break;</span>
<a href="#l3.51"></a><span id="l3.51">       }</span>
<a href="#l3.52"></a><span id="l3.52">     return true;</span>
<a href="#l3.53"></a><span id="l3.53">   }</span>
<a href="#l3.54"></a><span id="l3.54"> </span>
<a href="#l3.55"></a><span id="l3.55"> function executeUrlBarHistoryCommand( aTarget )</span>
<a href="#l3.56"></a><span id="l3.56">   {</span>
<a href="#l3.57"></a><span id="l3.57">     var index = aTarget.getAttribute(&quot;index&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/common/src/Makefile.in</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/common/src/Makefile.in</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -45,16 +45,17 @@ include $(DEPTH)/config/autoconf.mk</span>
<a href="#l4.4"></a><span id="l4.4"> MODULE		= suitecommon</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> EXTRA_COMPONENTS = \</span>
<a href="#l4.7"></a><span id="l4.7"> 	nsAbout.js \</span>
<a href="#l4.8"></a><span id="l4.8"> 	nsAboutCertError.js \</span>
<a href="#l4.9"></a><span id="l4.9"> 	nsAboutData.js \</span>
<a href="#l4.10"></a><span id="l4.10"> 	nsAboutLife.js \</span>
<a href="#l4.11"></a><span id="l4.11"> 	nsAboutSessionRestore.js \</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+	nsAboutSyncTabs.js \</span>
<a href="#l4.13"></a><span id="l4.13"> 	nsSessionStartup.js \</span>
<a href="#l4.14"></a><span id="l4.14"> 	nsSidebar.js \</span>
<a href="#l4.15"></a><span id="l4.15"> 	SuiteCommon.manifest \</span>
<a href="#l4.16"></a><span id="l4.16"> 	nsSuiteDownloadManagerUI.js \</span>
<a href="#l4.17"></a><span id="l4.17"> 	nsSuiteGlue.js \</span>
<a href="#l4.18"></a><span id="l4.18"> 	$(NULL)</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20"> EXTRA_PP_COMPONENTS = \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/common/src/SuiteCommon.manifest</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/common/src/SuiteCommon.manifest</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -19,8 +19,10 @@ component {bbbbe845-5a1b-40ee-813c-f84b8</span>
<a href="#l5.4"></a><span id="l5.4"> contract @mozilla.org/suite/suiteglue;1 {bbbbe845-5a1b-40ee-813c-f84b8faaa07c}</span>
<a href="#l5.5"></a><span id="l5.5"> category app-startup nsSuiteGlue service,@mozilla.org/suite/suiteglue;1</span>
<a href="#l5.6"></a><span id="l5.6"> component {9d4c845d-3f09-402a-b66d-50f291d7d50f} nsSuiteGlue.js</span>
<a href="#l5.7"></a><span id="l5.7"> contract @mozilla.org/content-permission/prompt;1 {9d4c845d-3f09-402a-b66d-50f291d7d50f}</span>
<a href="#l5.8"></a><span id="l5.8"> component {22117140-9c6e-11d3-aaf1-00805f8a4905} nsSidebar.js</span>
<a href="#l5.9"></a><span id="l5.9"> contract @mozilla.org/sidebar;1 {22117140-9c6e-11d3-aaf1-00805f8a4905}</span>
<a href="#l5.10"></a><span id="l5.10"> category JavaScript-global-property sidebar @mozilla.org/sidebar;1</span>
<a href="#l5.11"></a><span id="l5.11"> category JavaScript-global-property external @mozilla.org/sidebar;1</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+component {145dc3f6-f44a-4517-806a-9bec989400b4} nsAboutSyncTabs.js</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+contract @mozilla.org/network/protocol/about;1?what=sync-tabs {145dc3f6-f44a-4517-806a-9bec989400b4}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/suite/common/src/nsAboutSyncTabs.js</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,58 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+ *</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+ *</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+ * License.</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+ *</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+ * The Original Code is the Sync component.</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+ *</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+ * Jens Hatlak &lt;jh@junetz.de&gt;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+ *</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+ *</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+ *</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+function AboutSyncTabs() { }</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+AboutSyncTabs.prototype = {</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+  classID: Components.ID(&quot;{145dc3f6-f44a-4517-806a-9bec989400b4}&quot;),</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIAboutModule]),</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+  getURIFlags: function(aURI) {</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+    return Components.interfaces.nsIAboutModule.ALLOW_SCRIPT;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+  },</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+  newChannel: function(aURI) {</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+    let ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+                        .getService(Components.interfaces.nsIIOService);</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+    let channel = ios.newChannel(&quot;chrome://communicator/content/aboutSyncTabs.xul&quot;,</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+                                 null, null);</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+    channel.originalURI = aURI;</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+    return channel;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+  }</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+};</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+var NSGetFactory = XPCOMUtils.generateNSGetFactory([AboutSyncTabs]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/common/src/nsSuiteGlue.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/common/src/nsSuiteGlue.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -73,16 +73,39 @@ SuiteGlue.prototype = {</span>
<a href="#l7.4"></a><span id="l7.4">   _isPlacesShutdownObserver: false,</span>
<a href="#l7.5"></a><span id="l7.5">   _isPlacesDatabaseLocked: false,</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">   _setPrefToSaveSession: function()</span>
<a href="#l7.8"></a><span id="l7.8">   {</span>
<a href="#l7.9"></a><span id="l7.9">     Services.prefs.setBoolPref(&quot;browser.sessionstore.resume_session_once&quot;, true);</span>
<a href="#l7.10"></a><span id="l7.10">   },</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  _setSyncAutoconnectDelay: function BG__setSyncAutoconnectDelay() {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    // Assume that a non-zero value for services.sync.autoconnectDelay should override</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+    if (Services.prefs.prefHasUserValue(&quot;services.sync.autoconnectDelay&quot;)) {</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+      let prefDelay = Services.prefs.getIntPref(&quot;services.sync.autoconnectDelay&quot;);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+      if (prefDelay &gt; 0)</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+        return;</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+    }</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+    // delays are in seconds</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+    const MAX_DELAY = 300;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+    let delay = 3;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+    let enum = Services.wm.getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+    while (enum.hasMoreElements()) {</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+      delay += enum.getNext().gBrowser.tabs.length;</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+    }</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+    delay = delay &lt;= MAX_DELAY ? delay : MAX_DELAY;</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+    let syncTemp = {};</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+    Components.utils.import(&quot;resource://services-sync/service.js&quot;, syncTemp);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+    syncTemp.Weave.Service.delayedAutoConnect(delay);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+  },</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+</span>
<a href="#l7.35"></a><span id="l7.35">   // nsIObserver implementation</span>
<a href="#l7.36"></a><span id="l7.36">   observe: function(subject, topic, data)</span>
<a href="#l7.37"></a><span id="l7.37">   {</span>
<a href="#l7.38"></a><span id="l7.38">     switch(topic) {</span>
<a href="#l7.39"></a><span id="l7.39">       case &quot;xpcom-shutdown&quot;:</span>
<a href="#l7.40"></a><span id="l7.40">         this._dispose();</span>
<a href="#l7.41"></a><span id="l7.41">         break;</span>
<a href="#l7.42"></a><span id="l7.42">       case &quot;final-ui-startup&quot;:</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineat">@@ -110,16 +133,19 @@ SuiteGlue.prototype = {</span>
<a href="#l7.44"></a><span id="l7.44">         // The application is not actually quitting, but the last full browser</span>
<a href="#l7.45"></a><span id="l7.45">         // window is about to be closed.</span>
<a href="#l7.46"></a><span id="l7.46">         this._onQuitRequest(subject, &quot;lastwindow&quot;);</span>
<a href="#l7.47"></a><span id="l7.47">         break;</span>
<a href="#l7.48"></a><span id="l7.48">       case &quot;browser-lastwindow-close-granted&quot;:</span>
<a href="#l7.49"></a><span id="l7.49">         if (this._saveSession)</span>
<a href="#l7.50"></a><span id="l7.50">           this._setPrefToSaveSession();</span>
<a href="#l7.51"></a><span id="l7.51">         break;</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+      case &quot;weave:service:ready&quot;:</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+        this._setSyncAutoconnectDelay();</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+        break;</span>
<a href="#l7.55"></a><span id="l7.55">       case &quot;session-save&quot;:</span>
<a href="#l7.56"></a><span id="l7.56">         this._setPrefToSaveSession();</span>
<a href="#l7.57"></a><span id="l7.57">         subject.QueryInterface(Components.interfaces.nsISupportsPRBool);</span>
<a href="#l7.58"></a><span id="l7.58">         subject.data = true;</span>
<a href="#l7.59"></a><span id="l7.59">         break;</span>
<a href="#l7.60"></a><span id="l7.60">       case &quot;dl-done&quot;:</span>
<a href="#l7.61"></a><span id="l7.61">         this._playDownloadSound();</span>
<a href="#l7.62"></a><span id="l7.62">         break;</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineat">@@ -167,16 +193,17 @@ SuiteGlue.prototype = {</span>
<a href="#l7.64"></a><span id="l7.64">     Services.obs.addObserver(this, &quot;xpcom-shutdown&quot;, false);</span>
<a href="#l7.65"></a><span id="l7.65">     Services.obs.addObserver(this, &quot;final-ui-startup&quot;, false);</span>
<a href="#l7.66"></a><span id="l7.66">     Services.obs.addObserver(this, &quot;sessionstore-windows-restored&quot;, false);</span>
<a href="#l7.67"></a><span id="l7.67">     Services.obs.addObserver(this, &quot;browser:purge-session-history&quot;, false);</span>
<a href="#l7.68"></a><span id="l7.68">     Services.obs.addObserver(this, &quot;quit-application-requested&quot;, false);</span>
<a href="#l7.69"></a><span id="l7.69">     Services.obs.addObserver(this, &quot;quit-application-granted&quot;, false);</span>
<a href="#l7.70"></a><span id="l7.70">     Services.obs.addObserver(this, &quot;browser-lastwindow-close-requested&quot;, false);</span>
<a href="#l7.71"></a><span id="l7.71">     Services.obs.addObserver(this, &quot;browser-lastwindow-close-granted&quot;, false);</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+    Services.obs.addObserver(this, &quot;weave:service:ready&quot;, false);</span>
<a href="#l7.73"></a><span id="l7.73">     Services.obs.addObserver(this, &quot;session-save&quot;, false);</span>
<a href="#l7.74"></a><span id="l7.74">     Services.obs.addObserver(this, &quot;dl-done&quot;, false);</span>
<a href="#l7.75"></a><span id="l7.75">     Services.obs.addObserver(this, &quot;places-init-complete&quot;, false);</span>
<a href="#l7.76"></a><span id="l7.76">     this._isPlacesInitObserver = true;</span>
<a href="#l7.77"></a><span id="l7.77">     Services.obs.addObserver(this, &quot;places-database-locked&quot;, false);</span>
<a href="#l7.78"></a><span id="l7.78">     this._isPlacesLockedObserver = true;</span>
<a href="#l7.79"></a><span id="l7.79">     Services.obs.addObserver(this, &quot;places-shutdown&quot;, false);</span>
<a href="#l7.80"></a><span id="l7.80">     this._isPlacesShutdownObserver = true;</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineat">@@ -195,16 +222,17 @@ SuiteGlue.prototype = {</span>
<a href="#l7.82"></a><span id="l7.82">     Services.obs.removeObserver(this, &quot;xpcom-shutdown&quot;);</span>
<a href="#l7.83"></a><span id="l7.83">     Services.obs.removeObserver(this, &quot;final-ui-startup&quot;);</span>
<a href="#l7.84"></a><span id="l7.84">     Services.obs.removeObserver(this, &quot;sessionstore-windows-restored&quot;);</span>
<a href="#l7.85"></a><span id="l7.85">     Services.obs.removeObserver(this, &quot;browser:purge-session-history&quot;);</span>
<a href="#l7.86"></a><span id="l7.86">     Services.obs.removeObserver(this, &quot;quit-application-requested&quot;);</span>
<a href="#l7.87"></a><span id="l7.87">     Services.obs.removeObserver(this, &quot;quit-application-granted&quot;);</span>
<a href="#l7.88"></a><span id="l7.88">     Services.obs.removeObserver(this, &quot;browser-lastwindow-close-requested&quot;);</span>
<a href="#l7.89"></a><span id="l7.89">     Services.obs.removeObserver(this, &quot;browser-lastwindow-close-granted&quot;);</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineplus">+    Services.obs.removeObserver(this, &quot;weave:service:ready&quot;);</span>
<a href="#l7.91"></a><span id="l7.91">     Services.obs.removeObserver(this, &quot;session-save&quot;);</span>
<a href="#l7.92"></a><span id="l7.92">     Services.obs.removeObserver(this, &quot;dl-done&quot;);</span>
<a href="#l7.93"></a><span id="l7.93">     if (this._isIdleObserver)</span>
<a href="#l7.94"></a><span id="l7.94">       this._idleService.removeIdleObserver(this, BOOKMARKS_BACKUP_IDLE_TIME);</span>
<a href="#l7.95"></a><span id="l7.95">     if (this._isPlacesInitObserver)</span>
<a href="#l7.96"></a><span id="l7.96">       Services.obs.removeObserver(this, &quot;places-init-complete&quot;);</span>
<a href="#l7.97"></a><span id="l7.97">     if (this._isPlacesLockedObserver)</span>
<a href="#l7.98"></a><span id="l7.98">       Services.obs.removeObserver(this, &quot;places-database-locked&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/suite/common/sync/aboutSyncTabs-bindings.xml</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,80 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+   -</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+   -</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+   - License.</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+   -</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+   - The Original Code is Weave.</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+   -</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+   - The Initial Developer of the Original Code is the Mozilla Foundation.</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+   -</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+   - Contributor(s):</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+   -   Edward Lee &lt;edilee@mozilla.com&gt;</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+   -   Mike Connor &lt;mconnor@mozilla.com&gt;</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+   -   Paul O’Shannessy &lt;paul@oshannessy.com&gt;</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+   -</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+   -</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+&lt;bindings id=&quot;tabBindings&quot;</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+  &lt;binding id=&quot;tab-listing&quot; extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistitem&quot;&gt;</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+    &lt;content&gt;</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+      &lt;xul:hbox flex=&quot;1&quot;&gt;</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+        &lt;xul:vbox&gt;</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+          &lt;xul:image class=&quot;tabIcon&quot;</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+                     xbl:inherits=&quot;src=icon&quot;/&gt;</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+        &lt;/xul:vbox&gt;</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+        &lt;xul:vbox flex=&quot;1&quot;&gt;</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+            &lt;xul:label xbl:inherits=&quot;value=title,selected&quot;</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+                       crop=&quot;end&quot; flex=&quot;1&quot; class=&quot;title&quot;/&gt;</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+            &lt;xul:label xbl:inherits=&quot;value=url,selected&quot;</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+                       crop=&quot;end&quot; flex=&quot;1&quot; class=&quot;url&quot;/&gt;</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+        &lt;/xul:vbox&gt;</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+      &lt;/xul:hbox&gt;</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+    &lt;handlers&gt;</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+      &lt;handler event=&quot;dblclick&quot; button=&quot;0&quot;&gt;</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+          RemoteTabViewer.openSelected();</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+        ]]&gt;</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+    &lt;/handlers&gt;</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+  &lt;binding id=&quot;client-listing&quot; extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistitem&quot;&gt;</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+    &lt;content&gt;</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+      &lt;xul:hbox align=&quot;center&quot; onfocus=&quot;event.target.blur();&quot; onselect=&quot;return false;&quot;&gt;</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+        &lt;xul:image/&gt;</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+        &lt;xul:label xbl:inherits=&quot;value=clientName&quot;</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+                   class=&quot;clientName&quot;</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+                   crop=&quot;center&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+      &lt;/xul:hbox&gt;</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/suite/common/sync/aboutSyncTabs.css</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,7 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+richlistitem[type=&quot;tab&quot;] {</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+  -moz-binding: url(chrome://communicator/content/aboutSyncTabs-bindings.xml#tab-listing);</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+}</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+richlistitem[type=&quot;client&quot;] {</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+  -moz-binding: url(chrome://communicator/content/aboutSyncTabs-bindings.xml#client-listing);</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/suite/common/sync/aboutSyncTabs.js</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,264 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ *</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+ *</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+ * License.</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+ *</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+ * The Original Code is Weave.</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+ *</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+ * The Initial Developer of the Original Code is the Mozilla Foundation.</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+ *</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+ * Contributor(s):</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+ *   Edward Lee &lt;edilee@mozilla.com&gt;</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+ *   Mike Connor &lt;mconnor@mozilla.com&gt;</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+ *   Paul O’Shannessy &lt;paul@oshannessy.com&gt;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+ *</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+ *</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+const Cu = Components.utils;</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+Cu.import(&quot;resource://services-sync/main.js&quot;);</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+Cu.import(&quot;resource:///modules/PlacesUIUtils.jsm&quot;);</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+let RemoteTabViewer = {</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+  _tabsList: null,</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+  init: function () {</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+    Services.obs.addObserver(this, &quot;weave:service:login:finish&quot;, false);</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+    Services.obs.addObserver(this, &quot;weave:engine:sync:finish&quot;, false);</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+    this._tabsList = document.getElementById(&quot;tabsList&quot;);</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+    this.buildList(true);</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+  },</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+  uninit: function () {</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+    Services.obs.removeObserver(this, &quot;weave:service:login:finish&quot;);</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+    Services.obs.removeObserver(this, &quot;weave:engine:sync:finish&quot;);</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+  },</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+  buildList: function(force) {</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+    if (!Weave.Service.isLoggedIn || !this._refetchTabs(force))</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+      return;</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+    //XXXzpao We should say something about not being logged in &amp; not having data</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+    //        or tell the appropriate condition. (bug 583344)</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+    this._generateTabList();</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+  },</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+  createItem: function(attrs) {</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+    let item = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+    // Copy the attributes from the argument into the item</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+    for (let attr in attrs)</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+      item.setAttribute(attr, attrs[attr]);</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+    if (attrs[&quot;type&quot;] == &quot;tab&quot;)</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+      item.label = attrs.title || attrs.url;</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+    return item;</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+  },</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+  filterTabs: function(event) {</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+    let val = event.target.value.toLowerCase();</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+    let numTabs = this._tabsList.getRowCount();</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+    let client = null;</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+    for (let i = 0; i &lt; numTabs; i++) {</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+      let item = this._tabsList.getItemAtIndex(i);</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+      let hide = false; // By default, make sure the item is visible.</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+      switch (item.getAttribute(&quot;type&quot;)) {</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+        case &quot;tab&quot;:</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+          if (item.getAttribute(&quot;url&quot;).toLowerCase().indexOf(val) == -1 &amp;&amp;</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+              item.getAttribute(&quot;title&quot;).toLowerCase().indexOf(val) == -1)</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+            hide = true;</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+          else</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+            client = null; // This client should not be hidden.</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+          break;</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+        case &quot;client&quot;:</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+          if (client)</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+            client.hidden = true; // Hide the last client, it had no visible tabs.</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+          client = item;</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+          break;</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+      }</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+      item.hidden = hide;</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+    }</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+    if (client)</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+      client.hidden = true; // Hide the last client, it had no visible tabs.</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+  },</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+  openSelected: function() {</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineplus">+    let items = this._tabsList.selectedItems;</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+    let urls = [];</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+    for (let i = 0; i &lt; items.length; i++) {</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+      if (items[i].getAttribute(&quot;type&quot;) == &quot;tab&quot;) {</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineplus">+        urls.push(items[i].getAttribute(&quot;url&quot;));</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+        let index = this._tabsList.getIndexOfItem(items[i]);</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+        this._tabsList.removeItemAt(index);</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+      }</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+    }</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineplus">+    if (urls.length) {</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineplus">+      getTopWin().getBrowser().loadTabs(urls);</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+      this._tabsList.clearSelection();</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineplus">+    }</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineplus">+  },</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineplus">+</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineplus">+  bookmarkSingleTab: function() {</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+    let item = this._tabsList.selectedItems[0];</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineplus">+    let uri = Weave.Utils.makeURI(item.getAttribute(&quot;url&quot;));</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineplus">+    let title = item.getAttribute(&quot;title&quot;);</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineplus">+    PlacesUIUtils.showMinimalAddBookmarkUI(uri, title);</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineplus">+  },</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineplus">+</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+  bookmarkSelectedTabs: function() {</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineplus">+    let items = this._tabsList.selectedItems;</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineplus">+    let URIs = [];</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+    for (let i = 0; i &lt; items.length; i++) {</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineplus">+      if (items[i].getAttribute(&quot;type&quot;) == &quot;tab&quot;) {</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineplus">+        let uri = Weave.Utils.makeURI(items[i].getAttribute(&quot;url&quot;));</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineplus">+        if (!uri)</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineplus">+          continue;</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineplus">+        URIs.push(uri);</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+      }</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineplus">+    }</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineplus">+    if (URIs.length)</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+      PlacesUIUtils.showMinimalAddMultiBookmarkUI(URIs);</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineplus">+  },</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineplus">+</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineplus">+  _generateTabList: function() {</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineplus">+    let engine = Weave.Engines.get(&quot;tabs&quot;);</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineplus">+    let list = this._tabsList;</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineplus">+</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineplus">+    // clear out existing richlistitems</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineplus">+    let count = list.getRowCount();</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineplus">+    if (count &gt; 0) {</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineplus">+      for (let i = count - 1; i &gt;= 0; i--)</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineplus">+        list.removeItemAt(i);</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineplus">+    }</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineplus">+</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineplus">+    for (let [guid, client] in Iterator(engine.getAllClients())) {</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineplus">+      let appendClient = true;</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineplus">+      let seenURLs = {};</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineplus">+      client.tabs.forEach(function({title, urlHistory, icon}) {</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineplus">+        let url = urlHistory[0];</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineplus">+        if (engine.locallyOpenTabMatchesURL(url) || url in seenURLs)</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineplus">+          return;</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineplus">+</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineplus">+        seenURLs[url] = null;</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineplus">+</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineplus">+        if (appendClient) {</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineplus">+          let attrs = {</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineplus">+            type: &quot;client&quot;,</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineplus">+            clientName: client.clientName,</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineplus">+            class: Weave.Clients.isMobile(client.id) ? &quot;mobile&quot; : &quot;desktop&quot;</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+          };</span>
<a href="#l10.181"></a><span id="l10.181" class="difflineplus">+          let clientEnt = this.createItem(attrs);</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineplus">+          list.appendChild(clientEnt);</span>
<a href="#l10.183"></a><span id="l10.183" class="difflineplus">+          appendClient = false;</span>
<a href="#l10.184"></a><span id="l10.184" class="difflineplus">+          clientEnt.disabled = true;</span>
<a href="#l10.185"></a><span id="l10.185" class="difflineplus">+        }</span>
<a href="#l10.186"></a><span id="l10.186" class="difflineplus">+        let attrs = {</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineplus">+          type:  &quot;tab&quot;,</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineplus">+          title: title || url,</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineplus">+          url:   url,</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineplus">+          icon:  Weave.Utils.getIcon(icon)</span>
<a href="#l10.191"></a><span id="l10.191" class="difflineplus">+        }</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineplus">+        let tab = this.createItem(attrs);</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineplus">+        list.appendChild(tab);</span>
<a href="#l10.194"></a><span id="l10.194" class="difflineplus">+      }, this);</span>
<a href="#l10.195"></a><span id="l10.195" class="difflineplus">+    }</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineplus">+  },</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineplus">+</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineplus">+  adjustContextMenu: function(event) {</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineplus">+    let mode = &quot;all&quot;;</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineplus">+    switch (this._tabsList.selectedItems.length) {</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineplus">+      case 0:</span>
<a href="#l10.202"></a><span id="l10.202" class="difflineplus">+        break;</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineplus">+      case 1:</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineplus">+        mode = &quot;single&quot;</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineplus">+        break;</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineplus">+      default:</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineplus">+        mode = &quot;multiple&quot;;</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineplus">+        break;</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineplus">+    }</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineplus">+    let menu = document.getElementById(&quot;tabListContext&quot;);</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineplus">+    let el = menu.firstChild;</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineplus">+    while (el) {</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineplus">+      let showFor = el.getAttribute(&quot;showFor&quot;);</span>
<a href="#l10.214"></a><span id="l10.214" class="difflineplus">+      if (showFor)</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineplus">+        el.hidden = showFor != mode &amp;&amp; showFor != &quot;all&quot;;</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineplus">+</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineplus">+      el = el.nextSibling;</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineplus">+    }</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineplus">+  },</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineplus">+</span>
<a href="#l10.221"></a><span id="l10.221" class="difflineplus">+  _refetchTabs: function(force) {</span>
<a href="#l10.222"></a><span id="l10.222" class="difflineplus">+    if (!force) {</span>
<a href="#l10.223"></a><span id="l10.223" class="difflineplus">+      // Don't bother refetching tabs if we already did so recently</span>
<a href="#l10.224"></a><span id="l10.224" class="difflineplus">+      let lastFetch = 0;</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineplus">+      try {</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineplus">+        lastFetch = Services.prefs.getIntPref(&quot;services.sync.lastTabFetch&quot;);</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineplus">+      }</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineplus">+      catch (e) { /* Just use the default value of 0 */ }</span>
<a href="#l10.229"></a><span id="l10.229" class="difflineplus">+      let now = Math.floor(Date.now() / 1000);</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineplus">+      if (now - lastFetch &lt; 30)</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineplus">+        return false;</span>
<a href="#l10.232"></a><span id="l10.232" class="difflineplus">+    }</span>
<a href="#l10.233"></a><span id="l10.233" class="difflineplus">+</span>
<a href="#l10.234"></a><span id="l10.234" class="difflineplus">+    // if Clients hasn't synced yet this session, need to sync it as well</span>
<a href="#l10.235"></a><span id="l10.235" class="difflineplus">+    if (Weave.Clients.lastSync == 0)</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineplus">+      Weave.Clients.sync();</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineplus">+</span>
<a href="#l10.238"></a><span id="l10.238" class="difflineplus">+    // Force a sync only for the tabs engine</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineplus">+    let engine = Weave.Engines.get(&quot;tabs&quot;);</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineplus">+    engine.lastModified = null;</span>
<a href="#l10.241"></a><span id="l10.241" class="difflineplus">+    engine.sync();</span>
<a href="#l10.242"></a><span id="l10.242" class="difflineplus">+    Services.prefs.setIntPref(&quot;services.sync.lastTabFetch&quot;,</span>
<a href="#l10.243"></a><span id="l10.243" class="difflineplus">+                              Math.floor(Date.now() / 1000));</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineplus">+</span>
<a href="#l10.245"></a><span id="l10.245" class="difflineplus">+    return true;</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineplus">+  },</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineplus">+</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineplus">+  observe: function(subject, topic, data) {</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineplus">+    switch (topic) {</span>
<a href="#l10.250"></a><span id="l10.250" class="difflineplus">+      case &quot;weave:service:login:finish&quot;:</span>
<a href="#l10.251"></a><span id="l10.251" class="difflineplus">+        this.buildList(true);</span>
<a href="#l10.252"></a><span id="l10.252" class="difflineplus">+        break;</span>
<a href="#l10.253"></a><span id="l10.253" class="difflineplus">+      case &quot;weave:engine:sync:finish&quot;:</span>
<a href="#l10.254"></a><span id="l10.254" class="difflineplus">+        if (subject == &quot;tabs&quot;)</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineplus">+          this._generateTabList();</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineplus">+        break;</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineplus">+    }</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineplus">+  },</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineplus">+</span>
<a href="#l10.260"></a><span id="l10.260" class="difflineplus">+  handleClick: function(event) {</span>
<a href="#l10.261"></a><span id="l10.261" class="difflineplus">+    if (event.target.getAttribute(&quot;type&quot;) == &quot;tab&quot; &amp;&amp; event.button == 1) {</span>
<a href="#l10.262"></a><span id="l10.262" class="difflineplus">+      let url = event.target.getAttribute(&quot;url&quot;);</span>
<a href="#l10.263"></a><span id="l10.263" class="difflineplus">+      openUILink(url, event);</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineplus">+      let index = this._tabsList.getIndexOfItem(event.target);</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineplus">+      this._tabsList.removeItemAt(index);</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineplus">+    }</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineplus">+  }</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/suite/common/sync/aboutSyncTabs.xul</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,100 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+   -</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+   -</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+   - License.</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+   -</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+   - The Original Code is Weave.</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+   -</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+   - The Initial Developer of the Original Code is the Mozilla Foundation.</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+   -</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+   - Contributor(s):</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+   -   Edward Lee &lt;edilee@mozilla.com&gt;</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+   -   Mike Connor &lt;mconnor@mozilla.com&gt;</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+   -   Paul O’Shannessy &lt;paul@oshannessy.com&gt;</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+   -</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+   -</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/aboutSyncTabs.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/content/aboutSyncTabs.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+&lt;!DOCTYPE window [</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+  &lt;!ENTITY % aboutSyncTabsDTD SYSTEM &quot;chrome://communicator/locale/aboutSyncTabs.dtd&quot;&gt;</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+  %aboutSyncTabsDTD;</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+]&gt;</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+&lt;window id=&quot;tabs-display&quot;</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+        onload=&quot;RemoteTabViewer.init();&quot;</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+        onunload=&quot;RemoteTabViewer.uninit();&quot;</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+        xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+        title=&quot;&amp;tabs.otherComputers.label;&quot;&gt;</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+  &lt;script type=&quot;application/javascript;version=1.8&quot; src=&quot;chrome://communicator/content/aboutSyncTabs.js&quot;/&gt;</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/utilityOverlay.js&quot;/&gt;</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineplus">+  &lt;html:head&gt;</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+    &lt;html:link rel=&quot;icon&quot; href=&quot;chrome://communicator/skin/sync/sync-16.png&quot;/&gt;</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineplus">+  &lt;/html:head&gt;</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineplus">+</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+  &lt;popupset id=&quot;contextmenus&quot;&gt;</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+    &lt;menupopup id=&quot;tabListContext&quot;&gt;</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+      &lt;menuitem label=&quot;&amp;tabs.context.openTab.label;&quot;</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+                accesskey=&quot;&amp;tabs.context.openTab.accesskey;&quot;</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+                oncommand=&quot;RemoteTabViewer.openSelected();&quot;</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineplus">+                showFor=&quot;single&quot;/&gt;</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+      &lt;menuitem label=&quot;&amp;tabs.context.bookmarkSingleTab.label;&quot;</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+                accesskey=&quot;&amp;tabs.context.bookmarkSingleTab.accesskey;&quot;</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+                oncommand=&quot;RemoteTabViewer.bookmarkSingleTab(event);&quot;</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+                showFor=&quot;single&quot;/&gt;</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+      &lt;menuitem label=&quot;&amp;tabs.context.openMultipleTabs.label;&quot;</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+                accesskey=&quot;&amp;tabs.context.openMultipleTabs.accesskey;&quot;</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+                oncommand=&quot;RemoteTabViewer.openSelected();&quot;</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+                showFor=&quot;multiple&quot;/&gt;</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineplus">+      &lt;menuitem label=&quot;&amp;tabs.context.bookmarkMultipleTabs.label;&quot;</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineplus">+                accesskey=&quot;&amp;tabs.context.bookmarkMultipleTabs.accesskey;&quot;</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineplus">+                oncommand=&quot;RemoteTabViewer.bookmarkSelectedTabs();&quot;</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+                showFor=&quot;multiple&quot;/&gt;</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+      &lt;menuseparator/&gt;</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+      &lt;menuitem label=&quot;&amp;tabs.context.refreshList.label;&quot;</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+                accesskey=&quot;&amp;tabs.context.refreshList.accesskey;&quot;</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+                oncommand=&quot;RemoteTabViewer.buildList();&quot;</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+                showFor=&quot;all&quot;/&gt;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+    &lt;/menupopup&gt;</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+  &lt;/popupset&gt;</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+  &lt;richlistbox context=&quot;tabListContext&quot; id=&quot;tabsList&quot; seltype=&quot;multiple&quot;</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+               align=&quot;center&quot; flex=&quot;1&quot;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+               onclick=&quot;RemoteTabViewer.handleClick(event);&quot;</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+               oncontextmenu=&quot;RemoteTabViewer.adjustContextMenu(event);&quot;&gt;</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+    &lt;hbox id=&quot;headers&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+      &lt;label id=&quot;tabsListHeading&quot;</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+             value=&quot;&amp;tabs.otherComputers.label;&quot;/&gt;</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineplus">+      &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+      &lt;textbox type=&quot;search&quot;</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+               emptytext=&quot;&amp;tabs.searchText.label;&quot;</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineplus">+               oncommand=&quot;RemoteTabViewer.filterTabs(event);&quot;/&gt;</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineplus">+  &lt;/richlistbox&gt;</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineplus">+&lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/mailnews/msgMail3PaneWindow.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/mailnews/msgMail3PaneWindow.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -763,16 +763,19 @@ function OnLoadMessenger()</span>
<a href="#l12.4"></a><span id="l12.4">   SetFocusThreadPane();</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">   // Before and after callbacks for the customizeToolbar code</span>
<a href="#l12.7"></a><span id="l12.7">   var mailToolbox = getMailToolbox();</span>
<a href="#l12.8"></a><span id="l12.8">   mailToolbox.customizeInit = MailToolboxCustomizeInit;</span>
<a href="#l12.9"></a><span id="l12.9">   mailToolbox.customizeDone = MailToolboxCustomizeDone;</span>
<a href="#l12.10"></a><span id="l12.10">   mailToolbox.customizeChange = MailToolboxCustomizeChange;</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+  // initialize the sync UI</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  gSyncUI.init();</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+</span>
<a href="#l12.15"></a><span id="l12.15">   window.addEventListener(&quot;AppCommand&quot;, HandleAppCommandEvent, true);</span>
<a href="#l12.16"></a><span id="l12.16"> }</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18"> function HandleAppCommandEvent(evt)</span>
<a href="#l12.19"></a><span id="l12.19"> {</span>
<a href="#l12.20"></a><span id="l12.20">   evt.stopPropagation();</span>
<a href="#l12.21"></a><span id="l12.21">   switch (evt.command)</span>
<a href="#l12.22"></a><span id="l12.22">   {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

