<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26914:686ff7f6f966a57217bef39351503db397669c36</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 686ff7f6f966a57217bef39351503db397669c36" />
<meta property="og:url" content="/comm-central/rev/686ff7f6f966a57217bef39351503db397669c36" />
<meta property="og:description" content="Bug 1557102 - Work around inline styles being ignored. r=darktrojan" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 686ff7f6f966a57217bef39351503db397669c36 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/686ff7f6f966a57217bef39351503db397669c36">shortlog</a> |
<a href="/comm-central/log/686ff7f6f966a57217bef39351503db397669c36">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/686ff7f6f966a57217bef39351503db397669c36">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/686ff7f6f966a57217bef39351503db397669c36">files</a> |
changeset |
<a href="/comm-central/raw-rev/686ff7f6f966a57217bef39351503db397669c36">raw</a>  | <a href="/comm-central/archive/686ff7f6f966a57217bef39351503db397669c36.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557102">Bug 1557102</a> - Work around inline styles being ignored. r=darktrojan
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#105;&#114;&#107;&#32;&#83;&#116;&#101;&#105;&#110;&#109;&#101;&#116;&#122;&#32;&#60;&#112;&#117;&#98;&#108;&#105;&#99;&#64;&#114;&#115;&#106;&#116;&#100;&#114;&#106;&#103;&#102;&#117;&#122;&#107;&#102;&#103;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 17 Jun 2019 10:09:57 +0200</td></tr>

<tr>
 <td>changeset 26914</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/686ff7f6f966a57217bef39351503db397669c36">686ff7f6f966a57217bef39351503db397669c36</a></td>
</tr>



<tr>
<td>parent 26913</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f72f5ad61b913c02d8eae1c700cfcf5d964cd3eb">f72f5ad61b913c02d8eae1c700cfcf5d964cd3eb</a>
</td>
</tr>

<tr>
<td>child 26915</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/65c086fce57ed6fa4f8f7865a400036fdd484874">65c086fce57ed6fa4f8f7865a400036fdd484874</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=686ff7f6f966a57217bef39351503db397669c36">16061</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 17 Jun 2019 08:11:27 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@cbd50b617d7f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=cbd50b617d7f08f3c895564c2451fc4272b636bc">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=cbd50b617d7f08f3c895564c2451fc4272b636bc&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=cbd50b617d7f08f3c895564c2451fc4272b636bc&newProject=comm-central&newRevision=686ff7f6f966a57217bef39351503db397669c36&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=cbd50b617d7f08f3c895564c2451fc4272b636bc&newProject=comm-central&newRevision=686ff7f6f966a57217bef39351503db397669c36&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=cbd50b617d7f08f3c895564c2451fc4272b636bc&newProject=comm-central&newRevision=686ff7f6f966a57217bef39351503db397669c36&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557102">1557102</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557102">Bug 1557102</a> - Work around inline styles being ignored. r=darktrojan

For some unknown reason, inline styles in overlays are ignored until something
triggers re-evaluation of the element style. This causes inline styles to be
invisible whenever an add-on uses inline styles, but does not alter the styled
element using code.

To work around the issue, this commit forces styles to be evaluated by
setting the 'display' style to the already evaluated value. That forces any
inline styles to become visible immediately.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/686ff7f6f966a57217bef39351503db397669c36/common/src/Overlays.jsm">common/src/Overlays.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/686ff7f6f966a57217bef39351503db397669c36/common/src/Overlays.jsm">file</a> |
<a href="/comm-central/annotate/686ff7f6f966a57217bef39351503db397669c36/common/src/Overlays.jsm">annotate</a> |
<a href="/comm-central/diff/686ff7f6f966a57217bef39351503db397669c36/common/src/Overlays.jsm">diff</a> |
<a href="/comm-central/comparison/686ff7f6f966a57217bef39351503db397669c36/common/src/Overlays.jsm">comparison</a> |
<a href="/comm-central/log/686ff7f6f966a57217bef39351503db397669c36/common/src/Overlays.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/common/src/Overlays.jsm</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/common/src/Overlays.jsm</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -103,16 +103,24 @@ class Overlays {</span>
<a href="#l1.4"></a><span id="l1.4">       }</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">       let commentNodes = doc.evaluate(&quot;//comment()&quot;, doc, null, 7, null);</span>
<a href="#l1.7"></a><span id="l1.7">       for (let i = 0, len = commentNodes.snapshotLength; i &lt; len; ++i) {</span>
<a href="#l1.8"></a><span id="l1.8">         let node = commentNodes.snapshotItem(i);</span>
<a href="#l1.9"></a><span id="l1.9">         node.remove();</span>
<a href="#l1.10"></a><span id="l1.10">       }</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+      // Force a re-evaluation of inline styles to work around an issue</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      // causing inline styles to be initially ignored.</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      let styledNodes = doc.evaluate(&quot;//*[@style]&quot;, doc, null, 7, null);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+      for (let i = 0, len = styledNodes.snapshotLength; i &lt; len; ++i) {</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+        let node = styledNodes.snapshotItem(i);</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+        node.style.display = node.style.display;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+      }</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+</span>
<a href="#l1.20"></a><span id="l1.20">       // Load css styles from the registry</span>
<a href="#l1.21"></a><span id="l1.21">       for (let sheet of this.overlayProvider.style.get(url, false)) {</span>
<a href="#l1.22"></a><span id="l1.22">         unloadedSheets.push(sheet);</span>
<a href="#l1.23"></a><span id="l1.23">       }</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">       // Load css processing instructions from the overlay</span>
<a href="#l1.26"></a><span id="l1.26">       let stylesheets = doc.evaluate(&quot;/processing-instruction('xml-stylesheet')&quot;, doc, null, 7, null);</span>
<a href="#l1.27"></a><span id="l1.27">       for (let i = 0, len = stylesheets.snapshotLength; i &lt; len; ++i) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

