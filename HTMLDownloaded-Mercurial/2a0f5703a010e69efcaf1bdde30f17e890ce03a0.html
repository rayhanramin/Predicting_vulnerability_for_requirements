<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28209:2a0f5703a010e69efcaf1bdde30f17e890ce03a0</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2a0f5703a010e69efcaf1bdde30f17e890ce03a0" />
<meta property="og:url" content="/comm-central/rev/2a0f5703a010e69efcaf1bdde30f17e890ce03a0" />
<meta property="og:description" content="Bug 1557504 - remove [array] use in xpidl from calICalendarManager.idl and calICalendar.idl. r=pmorris" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2a0f5703a010e69efcaf1bdde30f17e890ce03a0 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2a0f5703a010e69efcaf1bdde30f17e890ce03a0">shortlog</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2a0f5703a010e69efcaf1bdde30f17e890ce03a0">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0">files</a> |
changeset |
<a href="/comm-central/raw-rev/2a0f5703a010e69efcaf1bdde30f17e890ce03a0">raw</a>  | <a href="/comm-central/archive/2a0f5703a010e69efcaf1bdde30f17e890ce03a0.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557504">Bug 1557504</a> - remove [array] use in xpidl from calICalendarManager.idl and calICalendar.idl. r=pmorris
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#104;&#117;&#115;&#104;&#105;&#108;&#32;&#77;&#105;&#115;&#116;&#114;&#121;&#32;&#60;&#107;&#104;&#117;&#115;&#104;&#105;&#108;&#51;&#50;&#52;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 18 Nov 2019 13:14:00 +0100</td></tr>

<tr>
 <td>changeset 28209</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2a0f5703a010e69efcaf1bdde30f17e890ce03a0">2a0f5703a010e69efcaf1bdde30f17e890ce03a0</a></td>
</tr>



<tr>
<td>parent 28208</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/65758d4222c29d8f8f85841e26b2c1fac4fbaa17">65758d4222c29d8f8f85841e26b2c1fac4fbaa17</a>
</td>
</tr>

<tr>
<td>child 28210</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1628c49941d6699b96b2fff5688c9b8625133f4b">1628c49941d6699b96b2fff5688c9b8625133f4b</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2a0f5703a010e69efcaf1bdde30f17e890ce03a0">16703</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 18 Nov 2019 21:43:07 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f5bd174b047b [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f5bd174b047b170cec34c4a4b465efb182fec971">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f5bd174b047b170cec34c4a4b465efb182fec971&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f5bd174b047b170cec34c4a4b465efb182fec971&newProject=comm-central&newRevision=d72ce60b5f76cff7526af1e5ac662ce25c497264&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f5bd174b047b170cec34c4a4b465efb182fec971&newProject=comm-central&newRevision=d72ce60b5f76cff7526af1e5ac662ce25c497264&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f5bd174b047b170cec34c4a4b465efb182fec971&newProject=comm-central&newRevision=d72ce60b5f76cff7526af1e5ac662ce25c497264&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28pmorris%29&revcount=50">pmorris</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557504">1557504</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557504">Bug 1557504</a> - remove [array] use in xpidl from calICalendarManager.idl and calICalendar.idl. r=pmorris</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/agenda-listbox-utils.js">calendar/base/content/agenda-listbox-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/agenda-listbox-utils.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/agenda-listbox-utils.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/agenda-listbox-utils.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/agenda-listbox-utils.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/agenda-listbox-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-base-view.js">calendar/base/content/calendar-base-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-base-view.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-base-view.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-base-view.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-base-view.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-base-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-clipboard.js">calendar/base/content/calendar-clipboard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-clipboard.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-clipboard.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-clipboard.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-clipboard.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-clipboard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-command-controller.js">calendar/base/content/calendar-command-controller.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-command-controller.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-command-controller.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-command-controller.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-command-controller.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-command-controller.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-invitations-manager.js">calendar/base/content/calendar-invitations-manager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-invitations-manager.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-invitations-manager.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-invitations-manager.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-invitations-manager.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-invitations-manager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-task-tree.js">calendar/base/content/calendar-task-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-task-tree.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-task-tree.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-task-tree.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-task-tree.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-task-tree.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-views-utils.js">calendar/base/content/calendar-views-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-views-utils.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-views-utils.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-views-utils.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-views-utils.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/calendar-views-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-creation.js">calendar/base/content/dialogs/calendar-creation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-creation.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-creation.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-creation.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-creation.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-creation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-invitations-dialog.js">calendar/base/content/dialogs/calendar-invitations-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-invitations-dialog.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-invitations-dialog.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-invitations-dialog.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-invitations-dialog.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-invitations-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-migration-dialog.js">calendar/base/content/dialogs/calendar-migration-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-migration-dialog.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-migration-dialog.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-migration-dialog.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-migration-dialog.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-migration-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-providerUninstall-dialog.js">calendar/base/content/dialogs/calendar-providerUninstall-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-providerUninstall-dialog.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-providerUninstall-dialog.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-providerUninstall-dialog.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-providerUninstall-dialog.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-providerUninstall-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">calendar/base/content/dialogs/calendar-subscriptions-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/chooseCalendarDialog.js">calendar/base/content/dialogs/chooseCalendarDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/chooseCalendarDialog.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/chooseCalendarDialog.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/chooseCalendarDialog.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/chooseCalendarDialog.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/dialogs/chooseCalendarDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/import-export.js">calendar/base/content/import-export.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/import-export.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/import-export.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/import-export.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/import-export.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/import-export.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/widgets/calendar-minimonth.js">calendar/base/content/widgets/calendar-minimonth.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/widgets/calendar-minimonth.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/widgets/calendar-minimonth.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/widgets/calendar-minimonth.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/widgets/calendar-minimonth.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/content/widgets/calendar-minimonth.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calAsyncUtils.jsm">calendar/base/modules/utils/calAsyncUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calAsyncUtils.jsm">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calAsyncUtils.jsm">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calAsyncUtils.jsm">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calAsyncUtils.jsm">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calAsyncUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calItipUtils.jsm">calendar/base/modules/utils/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calViewUtils.jsm">calendar/base/modules/utils/calViewUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calViewUtils.jsm">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calViewUtils.jsm">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calViewUtils.jsm">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calViewUtils.jsm">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/modules/utils/calViewUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendar.idl">calendar/base/public/calICalendar.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendar.idl">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendar.idl">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendar.idl">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendar.idl">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendar.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendarManager.idl">calendar/base/public/calICalendarManager.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendarManager.idl">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendarManager.idl">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendarManager.idl">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendarManager.idl">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/public/calICalendarManager.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calTransactionManager.js">calendar/base/src/calTransactionManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calTransactionManager.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calTransactionManager.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calTransactionManager.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calTransactionManager.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/base/src/calTransactionManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/components/calItipProtocolHandler.js">calendar/lightning/components/calItipProtocolHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/components/calItipProtocolHandler.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/components/calItipProtocolHandler.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/components/calItipProtocolHandler.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/components/calItipProtocolHandler.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/components/calItipProtocolHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/imip-bar.js">calendar/lightning/content/imip-bar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/imip-bar.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/imip-bar.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/imip-bar.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/imip-bar.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/imip-bar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/composite/calCompositeCalendar.js">calendar/providers/composite/calCompositeCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/composite/calCompositeCalendar.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/composite/calCompositeCalendar.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/composite/calCompositeCalendar.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/composite/calCompositeCalendar.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/composite/calCompositeCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/memory/calMemoryCalendar.js">calendar/providers/memory/calMemoryCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/memory/calMemoryCalendar.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/memory/calMemoryCalendar.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/memory/calMemoryCalendar.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/memory/calMemoryCalendar.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/memory/calMemoryCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/calendarCreation.js">calendar/resources/content/calendarCreation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/calendarCreation.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/calendarCreation.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/calendarCreation.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/calendarCreation.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/calendarCreation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_calendarList.js">calendar/test/browser/browser_calendarList.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_calendarList.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_calendarList.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_calendarList.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_calendarList.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_calendarList.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_import.js">calendar/test/browser/browser_import.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_import.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_import.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_import.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_import.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/browser/browser_import.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/modules/CalendarUtils.jsm">calendar/test/modules/CalendarUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/modules/CalendarUtils.jsm">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/modules/CalendarUtils.jsm">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/modules/CalendarUtils.jsm">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/modules/CalendarUtils.jsm">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/modules/CalendarUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_bug494140.js">calendar/test/unit/test_bug494140.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_bug494140.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_bug494140.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_bug494140.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_bug494140.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_bug494140.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_calmgr.js">calendar/test/unit/test_calmgr.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_calmgr.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_calmgr.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_calmgr.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_calmgr.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_calmgr.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_providers.js">calendar/test/unit/test_providers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_providers.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_providers.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_providers.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_providers.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_providers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_storage.js">calendar/test/unit/test_storage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_storage.js">file</a> |
<a href="/comm-central/annotate/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_storage.js">annotate</a> |
<a href="/comm-central/diff/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_storage.js">diff</a> |
<a href="/comm-central/comparison/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_storage.js">comparison</a> |
<a href="/comm-central/log/2a0f5703a010e69efcaf1bdde30f17e890ce03a0/calendar/test/unit/test_storage.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox-utils.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox-utils.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -620,17 +620,17 @@ agendaListbox.refreshCalendarQuery = fun</span>
<a href="#l1.4"></a><span id="l1.4">         this.agendaListbox.mPendingRefreshJobs.delete(this.calId);</span>
<a href="#l1.5"></a><span id="l1.5">       }</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">       if (!this.cancelled) {</span>
<a href="#l1.8"></a><span id="l1.8">         setCurrentEvent();</span>
<a href="#l1.9"></a><span id="l1.9">       }</span>
<a href="#l1.10"></a><span id="l1.10">     },</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l1.14"></a><span id="l1.14">       if (this.cancelled || !Components.isSuccessCode(aStatus)) {</span>
<a href="#l1.15"></a><span id="l1.15">         return;</span>
<a href="#l1.16"></a><span id="l1.16">       }</span>
<a href="#l1.17"></a><span id="l1.17">       for (let item of aItems) {</span>
<a href="#l1.18"></a><span id="l1.18">         this.agendaListbox.addItem(item);</span>
<a href="#l1.19"></a><span id="l1.19">       }</span>
<a href="#l1.20"></a><span id="l1.20">     },</span>
<a href="#l1.21"></a><span id="l1.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -216,17 +216,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">         this.calView.mPendingRefreshJobs.delete(this.calId);</span>
<a href="#l2.5"></a><span id="l2.5">       }</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">       if (!this.cancelled) {</span>
<a href="#l2.8"></a><span id="l2.8">         this.calView.fireEvent(&quot;viewloaded&quot;, operationType);</span>
<a href="#l2.9"></a><span id="l2.9">       }</span>
<a href="#l2.10"></a><span id="l2.10">     }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    onGetResult(opCalendar, status, itemType, detail, count, items) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    onGetResult(opCalendar, status, itemType, detail, items) {</span>
<a href="#l2.14"></a><span id="l2.14">       if (this.cancelled || !Components.isSuccessCode(status)) {</span>
<a href="#l2.15"></a><span id="l2.15">         return;</span>
<a href="#l2.16"></a><span id="l2.16">       }</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">       for (const item of items) {</span>
<a href="#l2.19"></a><span id="l2.19">         if (!cal.item.isToDo(item) || item.entryDate || item.dueDate) {</span>
<a href="#l2.20"></a><span id="l2.20">           this.calView.doAddItem(item);</span>
<a href="#l2.21"></a><span id="l2.21">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-clipboard.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-clipboard.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -27,17 +27,17 @@ function canPaste() {</span>
<a href="#l3.4"></a><span id="l3.4">       !cal.acl.isCalendarWritable(selectedCal) ||</span>
<a href="#l3.5"></a><span id="l3.5">       !cal.acl.userCanAddItemsToCalendar(selectedCal)</span>
<a href="#l3.6"></a><span id="l3.6">     ) {</span>
<a href="#l3.7"></a><span id="l3.7">       return false;</span>
<a href="#l3.8"></a><span id="l3.8">     }</span>
<a href="#l3.9"></a><span id="l3.9">   } else {</span>
<a href="#l3.10"></a><span id="l3.10">     let calendars = cal</span>
<a href="#l3.11"></a><span id="l3.11">       .getCalendarManager()</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-      .getCalendars({})</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+      .getCalendars()</span>
<a href="#l3.14"></a><span id="l3.14">       .filter(cal.acl.isCalendarWritable)</span>
<a href="#l3.15"></a><span id="l3.15">       .filter(cal.acl.userCanAddItemsToCalendar);</span>
<a href="#l3.16"></a><span id="l3.16">     if (!calendars.length) {</span>
<a href="#l3.17"></a><span id="l3.17">       return false;</span>
<a href="#l3.18"></a><span id="l3.18">     }</span>
<a href="#l3.19"></a><span id="l3.19">   }</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">   const flavors = [&quot;text/calendar&quot;, &quot;text/unicode&quot;];</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -229,17 +229,17 @@ function pasteFromClipboard() {</span>
<a href="#l3.23"></a><span id="l3.23">             pasteText += &quot;s&quot;;</span>
<a href="#l3.24"></a><span id="l3.24">           }</span>
<a href="#l3.25"></a><span id="l3.25">         }</span>
<a href="#l3.26"></a><span id="l3.26">         let validPasteText = pasteText != &quot;paste&quot; &amp;&amp; !pasteText.endsWith(&quot;Item&quot;);</span>
<a href="#l3.27"></a><span id="l3.27">         pasteText += items.length == withAttendees.length ? &quot;Only&quot; : &quot;Also&quot;;</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29">         let calendars = cal</span>
<a href="#l3.30"></a><span id="l3.30">           .getCalendarManager()</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-          .getCalendars({})</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+          .getCalendars()</span>
<a href="#l3.33"></a><span id="l3.33">           .filter(cal.acl.isCalendarWritable)</span>
<a href="#l3.34"></a><span id="l3.34">           .filter(cal.acl.userCanAddItemsToCalendar)</span>
<a href="#l3.35"></a><span id="l3.35">           .filter(aCal =&gt; {</span>
<a href="#l3.36"></a><span id="l3.36">             let status = aCal.getProperty(&quot;currentStatus&quot;);</span>
<a href="#l3.37"></a><span id="l3.37">             return Components.isSuccessCode(status);</span>
<a href="#l3.38"></a><span id="l3.38">           });</span>
<a href="#l3.39"></a><span id="l3.39">         if (calendars.length &gt; 1) {</span>
<a href="#l3.40"></a><span id="l3.40">           let args = {};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-command-controller.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-command-controller.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -540,17 +540,17 @@ var calendarController = {</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">   /**</span>
<a href="#l4.6"></a><span id="l4.6">    * Returns a boolean indicating if its possible to write items to any</span>
<a href="#l4.7"></a><span id="l4.7">    * calendar.</span>
<a href="#l4.8"></a><span id="l4.8">    */</span>
<a href="#l4.9"></a><span id="l4.9">   get writable() {</span>
<a href="#l4.10"></a><span id="l4.10">     return cal</span>
<a href="#l4.11"></a><span id="l4.11">       .getCalendarManager()</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      .getCalendars({})</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      .getCalendars()</span>
<a href="#l4.14"></a><span id="l4.14">       .some(cal.acl.isCalendarWritable);</span>
<a href="#l4.15"></a><span id="l4.15">   },</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">   /**</span>
<a href="#l4.18"></a><span id="l4.18">    * Returns a boolean indicating if the application is currently in offline</span>
<a href="#l4.19"></a><span id="l4.19">    * mode.</span>
<a href="#l4.20"></a><span id="l4.20">    */</span>
<a href="#l4.21"></a><span id="l4.21">   get offline() {</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -582,17 +582,17 @@ var calendarController = {</span>
<a href="#l4.23"></a><span id="l4.23">   },</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">   /**</span>
<a href="#l4.26"></a><span id="l4.26">    * Returns a boolean indicating if there are cached calendars and thus that don't require</span>
<a href="#l4.27"></a><span id="l4.27">    * network access.</span>
<a href="#l4.28"></a><span id="l4.28">    */</span>
<a href="#l4.29"></a><span id="l4.29">   get has_cached_calendars() {</span>
<a href="#l4.30"></a><span id="l4.30">     let calMgr = cal.getCalendarManager();</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    let calendars = calMgr.getCalendars({});</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    let calendars = calMgr.getCalendars();</span>
<a href="#l4.33"></a><span id="l4.33">     for (let calendar of calendars) {</span>
<a href="#l4.34"></a><span id="l4.34">       if (calendar.getProperty(&quot;cache.enabled&quot;) || calendar.getProperty(&quot;cache.always&quot;)) {</span>
<a href="#l4.35"></a><span id="l4.35">         return true;</span>
<a href="#l4.36"></a><span id="l4.36">       }</span>
<a href="#l4.37"></a><span id="l4.37">     }</span>
<a href="#l4.38"></a><span id="l4.38">     return false;</span>
<a href="#l4.39"></a><span id="l4.39">   },</span>
<a href="#l4.40"></a><span id="l4.40"> </span>
<a href="#l4.41"></a><span id="l4.41" class="difflineat">@@ -604,17 +604,17 @@ var calendarController = {</span>
<a href="#l4.42"></a><span id="l4.42">   },</span>
<a href="#l4.43"></a><span id="l4.43"> </span>
<a href="#l4.44"></a><span id="l4.44">   /**</span>
<a href="#l4.45"></a><span id="l4.45">    * Returns a boolean indicating that all local calendars are readonly</span>
<a href="#l4.46"></a><span id="l4.46">    */</span>
<a href="#l4.47"></a><span id="l4.47">   get all_local_calendars_readonly() {</span>
<a href="#l4.48"></a><span id="l4.48">     // We might want to speed this part up by keeping track of this in the</span>
<a href="#l4.49"></a><span id="l4.49">     // calendar manager.</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-    let calendars = cal.getCalendarManager().getCalendars({});</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+    let calendars = cal.getCalendarManager().getCalendars();</span>
<a href="#l4.52"></a><span id="l4.52">     let count = calendars.length;</span>
<a href="#l4.53"></a><span id="l4.53">     for (let calendar of calendars) {</span>
<a href="#l4.54"></a><span id="l4.54">       if (!cal.acl.isCalendarWritable(calendar)) {</span>
<a href="#l4.55"></a><span id="l4.55">         count--;</span>
<a href="#l4.56"></a><span id="l4.56">       }</span>
<a href="#l4.57"></a><span id="l4.57">     }</span>
<a href="#l4.58"></a><span id="l4.58">     return count == 0;</span>
<a href="#l4.59"></a><span id="l4.59">   },</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineat">@@ -886,17 +886,17 @@ function calendarUpdateNewItemsCommand()</span>
<a href="#l4.61"></a><span id="l4.61">     &quot;calendar_new_todo_todaypane_command&quot;,</span>
<a href="#l4.62"></a><span id="l4.62">   ];</span>
<a href="#l4.63"></a><span id="l4.63"> </span>
<a href="#l4.64"></a><span id="l4.64">   // re-calculate command status</span>
<a href="#l4.65"></a><span id="l4.65">   CalendarNewEventsCommandEnabled = false;</span>
<a href="#l4.66"></a><span id="l4.66">   CalendarNewTasksCommandEnabled = false;</span>
<a href="#l4.67"></a><span id="l4.67">   let calendars = cal</span>
<a href="#l4.68"></a><span id="l4.68">     .getCalendarManager()</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-    .getCalendars({})</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+    .getCalendars()</span>
<a href="#l4.71"></a><span id="l4.71">     .filter(cal.acl.isCalendarWritable)</span>
<a href="#l4.72"></a><span id="l4.72">     .filter(cal.acl.userCanAddItemsToCalendar);</span>
<a href="#l4.73"></a><span id="l4.73">   if (calendars.some(cal.item.isEventCalendar)) {</span>
<a href="#l4.74"></a><span id="l4.74">     CalendarNewEventsCommandEnabled = true;</span>
<a href="#l4.75"></a><span id="l4.75">   }</span>
<a href="#l4.76"></a><span id="l4.76">   if (calendars.some(cal.item.isTaskCalendar)) {</span>
<a href="#l4.77"></a><span id="l4.77">     CalendarNewTasksCommandEnabled = true;</span>
<a href="#l4.78"></a><span id="l4.78">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -120,17 +120,17 @@ InvitationsManager.prototype = {</span>
<a href="#l5.4"></a><span id="l5.4">     if (operationListener2) {</span>
<a href="#l5.5"></a><span id="l5.5">       listeners.push(operationListener2);</span>
<a href="#l5.6"></a><span id="l5.6">     }</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">     gInvitationsRequestManager.cancelPendingRequests();</span>
<a href="#l5.9"></a><span id="l5.9">     this.updateStartDate();</span>
<a href="#l5.10"></a><span id="l5.10">     this.deleteAllItems();</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    let cals = cal.getCalendarManager().getCalendars({});</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    let cals = cal.getCalendarManager().getCalendars();</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15">     let opListener = {</span>
<a href="#l5.16"></a><span id="l5.16">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l5.17"></a><span id="l5.17">       mCount: cals.length,</span>
<a href="#l5.18"></a><span id="l5.18">       mRequestManager: gInvitationsRequestManager,</span>
<a href="#l5.19"></a><span id="l5.19">       mInvitationsManager: this,</span>
<a href="#l5.20"></a><span id="l5.20">       mHandledItems: {},</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -144,17 +144,16 @@ InvitationsManager.prototype = {</span>
<a href="#l5.23"></a><span id="l5.23">             try {</span>
<a href="#l5.24"></a><span id="l5.24">               if (this.mInvitationsManager.mItemList.length) {</span>
<a href="#l5.25"></a><span id="l5.25">                 // Only call if there are actually items</span>
<a href="#l5.26"></a><span id="l5.26">                 listener.onGetResult(</span>
<a href="#l5.27"></a><span id="l5.27">                   null,</span>
<a href="#l5.28"></a><span id="l5.28">                   Cr.NS_OK,</span>
<a href="#l5.29"></a><span id="l5.29">                   Ci.calIItemBase,</span>
<a href="#l5.30"></a><span id="l5.30">                   null,</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-                  this.mInvitationsManager.mItemList.length,</span>
<a href="#l5.32"></a><span id="l5.32">                   this.mInvitationsManager.mItemList</span>
<a href="#l5.33"></a><span id="l5.33">                 );</span>
<a href="#l5.34"></a><span id="l5.34">               }</span>
<a href="#l5.35"></a><span id="l5.35">               listener.onOperationComplete(</span>
<a href="#l5.36"></a><span id="l5.36">                 null,</span>
<a href="#l5.37"></a><span id="l5.37">                 Cr.NS_OK,</span>
<a href="#l5.38"></a><span id="l5.38">                 Ci.calIOperationListener.GET,</span>
<a href="#l5.39"></a><span id="l5.39">                 null,</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineat">@@ -162,17 +161,17 @@ InvitationsManager.prototype = {</span>
<a href="#l5.41"></a><span id="l5.41">               );</span>
<a href="#l5.42"></a><span id="l5.42">             } catch (exc) {</span>
<a href="#l5.43"></a><span id="l5.43">               cal.ERROR(exc);</span>
<a href="#l5.44"></a><span id="l5.44">             }</span>
<a href="#l5.45"></a><span id="l5.45">           }</span>
<a href="#l5.46"></a><span id="l5.46">         }</span>
<a href="#l5.47"></a><span id="l5.47">       },</span>
<a href="#l5.48"></a><span id="l5.48"> </span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l5.51"></a><span id="l5.51">         if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l5.52"></a><span id="l5.52">           for (let item of aItems) {</span>
<a href="#l5.53"></a><span id="l5.53">             // we need to retrieve by occurrence to properly filter exceptions,</span>
<a href="#l5.54"></a><span id="l5.54">             // should be fixed with bug 416975</span>
<a href="#l5.55"></a><span id="l5.55">             item = item.parentItem;</span>
<a href="#l5.56"></a><span id="l5.56">             let hid = item.hashId;</span>
<a href="#l5.57"></a><span id="l5.57">             if (!this.mHandledItems[hid]) {</span>
<a href="#l5.58"></a><span id="l5.58">               this.mHandledItems[hid] = true;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineat">@@ -277,17 +276,17 @@ InvitationsManager.prototype = {</span>
<a href="#l5.60"></a><span id="l5.60">           this.mInvitationsManager.addItem(aDetail);</span>
<a href="#l5.61"></a><span id="l5.61">         }</span>
<a href="#l5.62"></a><span id="l5.62">         this.mInvitationsManager.mJobsPending--;</span>
<a href="#l5.63"></a><span id="l5.63">         if (this.mInvitationsManager.mJobsPending == 0 &amp;&amp; this.mJobQueueFinishedCallBack) {</span>
<a href="#l5.64"></a><span id="l5.64">           this.mJobQueueFinishedCallBack();</span>
<a href="#l5.65"></a><span id="l5.65">         }</span>
<a href="#l5.66"></a><span id="l5.66">       },</span>
<a href="#l5.67"></a><span id="l5.67"> </span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {},</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l5.70"></a><span id="l5.70">     };</span>
<a href="#l5.71"></a><span id="l5.71"> </span>
<a href="#l5.72"></a><span id="l5.72">     this.mJobsPending = 0;</span>
<a href="#l5.73"></a><span id="l5.73">     for (let i = 0; i &lt; queue.length; i++) {</span>
<a href="#l5.74"></a><span id="l5.74">       let job = queue[i];</span>
<a href="#l5.75"></a><span id="l5.75">       let oldItem = job.oldItem;</span>
<a href="#l5.76"></a><span id="l5.76">       let newItem = job.newItem;</span>
<a href="#l5.77"></a><span id="l5.77">       switch (job.action) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -416,17 +416,17 @@ function openEventDialog(</span>
<a href="#l6.4"></a><span id="l6.4">     dlg.focus();</span>
<a href="#l6.5"></a><span id="l6.5">     disposeJob(job);</span>
<a href="#l6.6"></a><span id="l6.6">     return;</span>
<a href="#l6.7"></a><span id="l6.7">   }</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9">   // Set up some defaults</span>
<a href="#l6.10"></a><span id="l6.10">   mode = mode || &quot;new&quot;;</span>
<a href="#l6.11"></a><span id="l6.11">   calendar = calendar || getSelectedCalendar();</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  let calendars = cal.getCalendarManager().getCalendars({});</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  let calendars = cal.getCalendarManager().getCalendars();</span>
<a href="#l6.14"></a><span id="l6.14">   calendars = calendars.filter(cal.acl.isCalendarWritable);</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16">   let isItemSupported;</span>
<a href="#l6.17"></a><span id="l6.17">   if (cal.item.isToDo(calendarItem)) {</span>
<a href="#l6.18"></a><span id="l6.18">     isItemSupported = function(aCalendar) {</span>
<a href="#l6.19"></a><span id="l6.19">       return aCalendar.getProperty(&quot;capabilities.tasks.supported&quot;) !== false;</span>
<a href="#l6.20"></a><span id="l6.20">     };</span>
<a href="#l6.21"></a><span id="l6.21">   } else if (cal.item.isEvent(calendarItem)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -32,17 +32,17 @@ function getSelectedCalendar() {</span>
<a href="#l7.4"></a><span id="l7.4">  *</span>
<a href="#l7.5"></a><span id="l7.5">  * @param aCalendar     The calendar to delete.</span>
<a href="#l7.6"></a><span id="l7.6">  */</span>
<a href="#l7.7"></a><span id="l7.7"> function promptDeleteCalendar(aCalendar) {</span>
<a href="#l7.8"></a><span id="l7.8">   const nIPS = Ci.nsIPromptService;</span>
<a href="#l7.9"></a><span id="l7.9">   const cICM = Ci.calICalendarManager;</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">   let calMgr = cal.getCalendarManager();</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  let calendars = calMgr.getCalendars({});</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  let calendars = calMgr.getCalendars();</span>
<a href="#l7.14"></a><span id="l7.14">   if (calendars.length &lt;= 1) {</span>
<a href="#l7.15"></a><span id="l7.15">     // If this is the last calendar, don't delete it.</span>
<a href="#l7.16"></a><span id="l7.16">     return;</span>
<a href="#l7.17"></a><span id="l7.17">   }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">   let modes = new Set(aCalendar.getProperty(&quot;capabilities.removeModes&quot;) || [&quot;unsubscribe&quot;]);</span>
<a href="#l7.20"></a><span id="l7.20">   let title = cal.l10n.getCalString(&quot;removeCalendarTitle&quot;);</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -101,17 +101,17 @@ function loadCalendarManager() {</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24">   // Set up the composite calendar in the calendar list widget.</span>
<a href="#l7.25"></a><span id="l7.25">   let compositeCalendar = cal.view.getCompositeCalendar(window);</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">   // Initialize our composite observer</span>
<a href="#l7.28"></a><span id="l7.28">   compositeCalendar.addObserver(compositeObserver);</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30">   // Create the home calendar if no calendar exists.</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  let calendars = cal.getCalendarManager().getCalendars({});</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  let calendars = cal.getCalendarManager().getCalendars();</span>
<a href="#l7.33"></a><span id="l7.33">   if (calendars.length) {</span>
<a href="#l7.34"></a><span id="l7.34">     // migration code to make sure calendars, which do not support caching have cache enabled</span>
<a href="#l7.35"></a><span id="l7.35">     // required to further clean up on top of bug 1182264</span>
<a href="#l7.36"></a><span id="l7.36">     for (let calendar of calendars) {</span>
<a href="#l7.37"></a><span id="l7.37">       if (</span>
<a href="#l7.38"></a><span id="l7.38">         calendar.getProperty(&quot;cache.supported&quot;) === false &amp;&amp;</span>
<a href="#l7.39"></a><span id="l7.39">         calendar.getProperty(&quot;cache.enabled&quot;) === true</span>
<a href="#l7.40"></a><span id="l7.40">       ) {</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineat">@@ -119,17 +119,17 @@ function loadCalendarManager() {</span>
<a href="#l7.42"></a><span id="l7.42">       }</span>
<a href="#l7.43"></a><span id="l7.43">     }</span>
<a href="#l7.44"></a><span id="l7.44">   } else {</span>
<a href="#l7.45"></a><span id="l7.45">     initHomeCalendar();</span>
<a href="#l7.46"></a><span id="l7.46">   }</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48">   let calendarManager = cal.getCalendarManager();</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-  for (let calendar of sortCalendarArray(cal.getCalendarManager().getCalendars({}))) {</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+  for (let calendar of sortCalendarArray(cal.getCalendarManager().getCalendars())) {</span>
<a href="#l7.52"></a><span id="l7.52">     addCalendarItem(calendar);</span>
<a href="#l7.53"></a><span id="l7.53">   }</span>
<a href="#l7.54"></a><span id="l7.54"> </span>
<a href="#l7.55"></a><span id="l7.55">   function addCalendarItem(calendar) {</span>
<a href="#l7.56"></a><span id="l7.56">     let item = document.createXULElement(&quot;richlistitem&quot;);</span>
<a href="#l7.57"></a><span id="l7.57">     item.searchLabel = calendar.name;</span>
<a href="#l7.58"></a><span id="l7.58">     item.setAttribute(&quot;calendar-id&quot;, calendar.id);</span>
<a href="#l7.59"></a><span id="l7.59">     if (calendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineat">@@ -387,17 +387,17 @@ function loadCalendarManager() {</span>
<a href="#l7.61"></a><span id="l7.61">       addCalendarItem(calendar);</span>
<a href="#l7.62"></a><span id="l7.62">       saveSortOrder();</span>
<a href="#l7.63"></a><span id="l7.63">     },</span>
<a href="#l7.64"></a><span id="l7.64">     onCalendarUnregistering(calendar) {</span>
<a href="#l7.65"></a><span id="l7.65">       compositeCalendar.removeCalendar(calendar);</span>
<a href="#l7.66"></a><span id="l7.66">       let item = calendarList.getElementsByAttribute(&quot;calendar-id&quot;, calendar.id)[0];</span>
<a href="#l7.67"></a><span id="l7.67">       item.remove();</span>
<a href="#l7.68"></a><span id="l7.68">       if (compositeCalendar.defaultCalendar.id == calendar.id) {</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-        compositeCalendar.defaultCalendar = compositeCalendar.getCalendars({})[0];</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+        compositeCalendar.defaultCalendar = compositeCalendar.getCalendars()[0];</span>
<a href="#l7.71"></a><span id="l7.71">       }</span>
<a href="#l7.72"></a><span id="l7.72">       saveSortOrder();</span>
<a href="#l7.73"></a><span id="l7.73">     },</span>
<a href="#l7.74"></a><span id="l7.74">     onCalendarDeleting(calendar) {},</span>
<a href="#l7.75"></a><span id="l7.75">   };</span>
<a href="#l7.76"></a><span id="l7.76">   calendarManager.addObserver(calendarList._calendarManagerObserver);</span>
<a href="#l7.77"></a><span id="l7.77"> }</span>
<a href="#l7.78"></a><span id="l7.78"> </span>
<a href="#l7.79"></a><span id="l7.79" class="difflineat">@@ -574,17 +574,17 @@ function toggleCalendarVisible(aCalendar</span>
<a href="#l7.80"></a><span id="l7.80">   }</span>
<a href="#l7.81"></a><span id="l7.81"> }</span>
<a href="#l7.82"></a><span id="l7.82"> </span>
<a href="#l7.83"></a><span id="l7.83"> /**</span>
<a href="#l7.84"></a><span id="l7.84">  * Shows all hidden calendars.</span>
<a href="#l7.85"></a><span id="l7.85">  */</span>
<a href="#l7.86"></a><span id="l7.86"> function showAllCalendars() {</span>
<a href="#l7.87"></a><span id="l7.87">   let composite = cal.view.getCompositeCalendar(window);</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-  let cals = cal.getCalendarManager().getCalendars({});</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+  let cals = cal.getCalendarManager().getCalendars();</span>
<a href="#l7.90"></a><span id="l7.90"> </span>
<a href="#l7.91"></a><span id="l7.91">   composite.startBatch();</span>
<a href="#l7.92"></a><span id="l7.92">   for (let calendar of cals) {</span>
<a href="#l7.93"></a><span id="l7.93">     if (!composite.getCalendarById(calendar.id)) {</span>
<a href="#l7.94"></a><span id="l7.94">       composite.addCalendar(calendar);</span>
<a href="#l7.95"></a><span id="l7.95">     }</span>
<a href="#l7.96"></a><span id="l7.96">   }</span>
<a href="#l7.97"></a><span id="l7.97">   composite.endBatch();</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineat">@@ -592,17 +592,17 @@ function showAllCalendars() {</span>
<a href="#l7.99"></a><span id="l7.99"> </span>
<a href="#l7.100"></a><span id="l7.100"> /**</span>
<a href="#l7.101"></a><span id="l7.101">  * Shows only the specified calendar, and hides all others.</span>
<a href="#l7.102"></a><span id="l7.102">  *</span>
<a href="#l7.103"></a><span id="l7.103">  * @param aCalendar   The calendar to show as the only visible calendar</span>
<a href="#l7.104"></a><span id="l7.104">  */</span>
<a href="#l7.105"></a><span id="l7.105"> function showOnlyCalendar(aCalendar) {</span>
<a href="#l7.106"></a><span id="l7.106">   let composite = cal.view.getCompositeCalendar(window);</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineminus">-  let cals = composite.getCalendars({}) || [];</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+  let cals = composite.getCalendars() || [];</span>
<a href="#l7.109"></a><span id="l7.109"> </span>
<a href="#l7.110"></a><span id="l7.110">   composite.startBatch();</span>
<a href="#l7.111"></a><span id="l7.111">   for (let calendar of cals) {</span>
<a href="#l7.112"></a><span id="l7.112">     if (calendar.id != aCalendar.id) {</span>
<a href="#l7.113"></a><span id="l7.113">       composite.removeCalendar(calendar);</span>
<a href="#l7.114"></a><span id="l7.114">     }</span>
<a href="#l7.115"></a><span id="l7.115">   }</span>
<a href="#l7.116"></a><span id="l7.116">   composite.addCalendar(aCalendar);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -462,17 +462,17 @@</span>
<a href="#l8.4"></a><span id="l8.4">           if (opCalendar.id in this.tree.mPendingRefreshJobs) {</span>
<a href="#l8.5"></a><span id="l8.5">             delete this.tree.mPendingRefreshJobs[opCalendar.id];</span>
<a href="#l8.6"></a><span id="l8.6">           }</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">           let oldItems = this.tree.mTaskArray.filter(item =&gt; item.calendar.id == opCalendar.id);</span>
<a href="#l8.9"></a><span id="l8.9">           this.tree.mTreeView.modifyItems(this.items, oldItems);</span>
<a href="#l8.10"></a><span id="l8.10">         },</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        onGetResult(opCalendar, status, itemType, detail, count, items) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+        onGetResult(opCalendar, status, itemType, detail, items) {</span>
<a href="#l8.14"></a><span id="l8.14">           this.items = this.items.concat(items);</span>
<a href="#l8.15"></a><span id="l8.15">         },</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">         cancel() {</span>
<a href="#l8.18"></a><span id="l8.18">           if (this.operation &amp;&amp; this.operation.isPending) {</span>
<a href="#l8.19"></a><span id="l8.19">             this.operation.cancel();</span>
<a href="#l8.20"></a><span id="l8.20">             this.operation = null;</span>
<a href="#l8.21"></a><span id="l8.21">             this.items = [];</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -513,17 +513,17 @@</span>
<a href="#l8.23"></a><span id="l8.23">      */</span>
<a href="#l8.24"></a><span id="l8.24">     refresh() {</span>
<a href="#l8.25"></a><span id="l8.25">       this.view = this.mTreeView;</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27">       cal.view.getCompositeCalendar(window).addObserver(this.mTaskTreeObserver);</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29">       Services.prefs.getBranch(&quot;&quot;).addObserver(&quot;calendar.&quot;, this.mPrefObserver);</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-      const cals = cal.view.getCompositeCalendar(window).getCalendars({}) || [];</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+      const cals = cal.view.getCompositeCalendar(window).getCalendars() || [];</span>
<a href="#l8.33"></a><span id="l8.33">       const enabledCals = cals.filter(calendar =&gt; !calendar.getProperty(&quot;disabled&quot;));</span>
<a href="#l8.34"></a><span id="l8.34"> </span>
<a href="#l8.35"></a><span id="l8.35">       enabledCals.forEach(calendar =&gt; this.refreshFromCalendar(calendar));</span>
<a href="#l8.36"></a><span id="l8.36">     }</span>
<a href="#l8.37"></a><span id="l8.37"> </span>
<a href="#l8.38"></a><span id="l8.38">     onCalendarAdded(calendar) {</span>
<a href="#l8.39"></a><span id="l8.39">       if (!calendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l8.40"></a><span id="l8.40">         this.refreshFromCalendar(calendar);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -208,17 +208,17 @@ function sortCalendarArray(calendars) {</span>
<a href="#l9.4"></a><span id="l9.4">   }</span>
<a href="#l9.5"></a><span id="l9.5">   ret.sort(sortFunc);</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">   // check and repair pref when an array of all calendars has been passed:</span>
<a href="#l9.8"></a><span id="l9.8">   let sortOrderString = Services.prefs.getStringPref(&quot;calendar.list.sortOrder&quot;, &quot;&quot;);</span>
<a href="#l9.9"></a><span id="l9.9">   let wantedOrderString = ret.map(calendar =&gt; calendar.id).join(&quot; &quot;);</span>
<a href="#l9.10"></a><span id="l9.10">   if (</span>
<a href="#l9.11"></a><span id="l9.11">     wantedOrderString != sortOrderString &amp;&amp;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    cal.getCalendarManager().getCalendars({}).length == ret.length</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    cal.getCalendarManager().getCalendars().length == ret.length</span>
<a href="#l9.14"></a><span id="l9.14">   ) {</span>
<a href="#l9.15"></a><span id="l9.15">     Services.prefs.setStringPref(&quot;calendar.list.sortOrder&quot;, wantedOrderString);</span>
<a href="#l9.16"></a><span id="l9.16">   }</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">   return ret;</span>
<a href="#l9.19"></a><span id="l9.19"> }</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21"> /**</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -231,17 +231,17 @@ function sortCalendarArray(calendars) {</span>
<a href="#l9.23"></a><span id="l9.23">  * @param aCalendarToUse        The default-calendar</span>
<a href="#l9.24"></a><span id="l9.24">  * @param aOnCommand            A string that is applied to the &quot;oncommand&quot;</span>
<a href="#l9.25"></a><span id="l9.25">  *                                attribute of each menuitem</span>
<a href="#l9.26"></a><span id="l9.26">  * @return                      The index of the calendar that matches the</span>
<a href="#l9.27"></a><span id="l9.27">  *                                default-calendar. By default 0 is returned.</span>
<a href="#l9.28"></a><span id="l9.28">  */</span>
<a href="#l9.29"></a><span id="l9.29"> function appendCalendarItems(aItem, aCalendarMenuParent, aCalendarToUse, aOnCommand) {</span>
<a href="#l9.30"></a><span id="l9.30">   let calendarToUse = aCalendarToUse || aItem.calendar;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-  let calendars = sortCalendarArray(cal.getCalendarManager().getCalendars({}));</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  let calendars = sortCalendarArray(cal.getCalendarManager().getCalendars());</span>
<a href="#l9.33"></a><span id="l9.33">   let indexToSelect = 0;</span>
<a href="#l9.34"></a><span id="l9.34">   let index = -1;</span>
<a href="#l9.35"></a><span id="l9.35">   for (let i = 0; i &lt; calendars.length; ++i) {</span>
<a href="#l9.36"></a><span id="l9.36">     let calendar = calendars[i];</span>
<a href="#l9.37"></a><span id="l9.37">     if (</span>
<a href="#l9.38"></a><span id="l9.38">       calendar.id == calendarToUse.id ||</span>
<a href="#l9.39"></a><span id="l9.39">       (calendar &amp;&amp;</span>
<a href="#l9.40"></a><span id="l9.40">         cal.acl.isCalendarWritable(calendar) &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -912,17 +912,17 @@ function addItemsFromCalendar(aCalendar,</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5">     onOperationComplete: function(aOpCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l10.6"></a><span id="l10.6">       let refreshTreeInternalFunc = function() {</span>
<a href="#l10.7"></a><span id="l10.7">         aAddItemsInternalFunc(refreshListener.mEventArray);</span>
<a href="#l10.8"></a><span id="l10.8">       };</span>
<a href="#l10.9"></a><span id="l10.9">       setTimeout(refreshTreeInternalFunc, 0);</span>
<a href="#l10.10"></a><span id="l10.10">     },</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l10.14"></a><span id="l10.14">       refreshListener.mEventArray = refreshListener.mEventArray.concat(aItems);</span>
<a href="#l10.15"></a><span id="l10.15">     },</span>
<a href="#l10.16"></a><span id="l10.16">   };</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18">   let filter = 0;</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20">   filter |= aCalendar.ITEM_FILTER_TYPE_EVENT;</span>
<a href="#l10.21"></a><span id="l10.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-views-utils.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-views-utils.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -558,17 +558,17 @@ function editSelectedEvents() {</span>
<a href="#l11.4"></a><span id="l11.4">  */</span>
<a href="#l11.5"></a><span id="l11.5"> function selectAllEvents() {</span>
<a href="#l11.6"></a><span id="l11.6">   let items = [];</span>
<a href="#l11.7"></a><span id="l11.7">   let listener = {</span>
<a href="#l11.8"></a><span id="l11.8">     QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l11.9"></a><span id="l11.9">     onOperationComplete: function(calendar, status, operationType, id, detail) {</span>
<a href="#l11.10"></a><span id="l11.10">       currentView().setSelectedItems(items.length, items, false);</span>
<a href="#l11.11"></a><span id="l11.11">     },</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    onGetResult: function(calendar, status, itemType, detail, count, itemsArg) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    onGetResult: function(calendar, status, itemType, detail, itemsArg) {</span>
<a href="#l11.14"></a><span id="l11.14">       for (let item of itemsArg) {</span>
<a href="#l11.15"></a><span id="l11.15">         items.push(item);</span>
<a href="#l11.16"></a><span id="l11.16">       }</span>
<a href="#l11.17"></a><span id="l11.17">     },</span>
<a href="#l11.18"></a><span id="l11.18">   };</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">   let composite = cal.view.getCompositeCalendar(window);</span>
<a href="#l11.21"></a><span id="l11.21">   let filter = composite.ITEM_FILTER_CLASS_OCCURRENCES;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-creation.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-creation.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -20,17 +20,17 @@ function openLocalCalendar() {</span>
<a href="#l12.4"></a><span id="l12.4">   picker.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">   picker.open(rv =&gt; {</span>
<a href="#l12.7"></a><span id="l12.7">     if (rv != nsIFilePicker.returnOK || !picker.file) {</span>
<a href="#l12.8"></a><span id="l12.8">       return;</span>
<a href="#l12.9"></a><span id="l12.9">     }</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">     let calMgr = cal.getCalendarManager();</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    let calendars = calMgr.getCalendars({});</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    let calendars = calMgr.getCalendars();</span>
<a href="#l12.14"></a><span id="l12.14">     let calendar = calendars.find(x =&gt; x.uri.equals(picker.fileURL));</span>
<a href="#l12.15"></a><span id="l12.15">     if (!calendar) {</span>
<a href="#l12.16"></a><span id="l12.16">       calendar = calMgr.createCalendar(&quot;ics&quot;, picker.fileURL);</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18">       // Strip &quot;.ics&quot; from filename for use as calendar name, taken from</span>
<a href="#l12.19"></a><span id="l12.19">       // calendarCreation.js</span>
<a href="#l12.20"></a><span id="l12.20">       let fullPathRegex = new RegExp(&quot;([^/:]+)[.]ics$&quot;);</span>
<a href="#l12.21"></a><span id="l12.21">       let prettyName = picker.fileURL.spec.match(fullPathRegex);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-invitations-dialog.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-invitations-dialog.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -216,21 +216,21 @@ function onLoad() {</span>
<a href="#l13.4"></a><span id="l13.4">       let richListBox = document.getElementById(&quot;invitations-listbox&quot;);</span>
<a href="#l13.5"></a><span id="l13.5">       if (richListBox.getRowCount() &gt; 0) {</span>
<a href="#l13.6"></a><span id="l13.6">         richListBox.selectedIndex = 0;</span>
<a href="#l13.7"></a><span id="l13.7">       } else {</span>
<a href="#l13.8"></a><span id="l13.8">         let noInvitationsBox = document.getElementById(&quot;noinvitations-box&quot;);</span>
<a href="#l13.9"></a><span id="l13.9">         noInvitationsBox.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l13.10"></a><span id="l13.10">       }</span>
<a href="#l13.11"></a><span id="l13.11">     },</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l13.14"></a><span id="l13.14">       if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l13.15"></a><span id="l13.15">         return;</span>
<a href="#l13.16"></a><span id="l13.16">       }</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-      document.title = invitationsText + &quot; (&quot; + aCount + &quot;)&quot;;</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+      document.title = invitationsText + &quot; (&quot; + aItems.length + &quot;)&quot;;</span>
<a href="#l13.19"></a><span id="l13.19">       let updatingBox = document.getElementById(&quot;updating-box&quot;);</span>
<a href="#l13.20"></a><span id="l13.20">       updatingBox.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l13.21"></a><span id="l13.21">       let richListBox = document.getElementById(&quot;invitations-listbox&quot;);</span>
<a href="#l13.22"></a><span id="l13.22">       for (let item of aItems) {</span>
<a href="#l13.23"></a><span id="l13.23">         let newNode = document.createXULElement(&quot;richlistitem&quot;, {</span>
<a href="#l13.24"></a><span id="l13.24">           is: &quot;calendar-invitations-richlistitem&quot;,</span>
<a href="#l13.25"></a><span id="l13.25">         });</span>
<a href="#l13.26"></a><span id="l13.26">         richListBox.appendChild(newNode);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -243,17 +243,17 @@ var gDataMigrator = {</span>
<a href="#l14.4"></a><span id="l14.4">     function parseAndMigrate(aDoc, aCallback) {</span>
<a href="#l14.5"></a><span id="l14.5">       function getRDFAttr(aNode, aAttr) {</span>
<a href="#l14.6"></a><span id="l14.6">         return aNode.getAttributeNS(&quot;http://home.netscape.com/NC-rdf#&quot;, aAttr);</span>
<a href="#l14.7"></a><span id="l14.7">       }</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">       // For duplicate detection</span>
<a href="#l14.10"></a><span id="l14.10">       let calManager = cal.getCalendarManager();</span>
<a href="#l14.11"></a><span id="l14.11">       let uris = [];</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-      for (let oldCal of calManager.getCalendars({})) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+      for (let oldCal of calManager.getCalendars()) {</span>
<a href="#l14.14"></a><span id="l14.14">         uris.push(oldCal.uri);</span>
<a href="#l14.15"></a><span id="l14.15">       }</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">       const RDFNS = &quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;;</span>
<a href="#l14.18"></a><span id="l14.18">       let nodes = aDoc.getElementsByTagNameNS(RDFNS, &quot;Description&quot;);</span>
<a href="#l14.19"></a><span id="l14.19">       migLOG(&quot;nodes: &quot; + nodes.length);</span>
<a href="#l14.20"></a><span id="l14.20">       for (let i = 0; i &lt; nodes.length; i++) {</span>
<a href="#l14.21"></a><span id="l14.21">         migLOG(&quot;Beginning calendar node&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -147,17 +147,17 @@ function getPrintSettings(receiverFunc) </span>
<a href="#l15.4"></a><span id="l15.4">   // Some filters above might have filled the events list themselves. If not,</span>
<a href="#l15.5"></a><span id="l15.5">   // then fetch the items here.</span>
<a href="#l15.6"></a><span id="l15.6">   if (requiresFetch) {</span>
<a href="#l15.7"></a><span id="l15.7">     let listener = {</span>
<a href="#l15.8"></a><span id="l15.8">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l15.9"></a><span id="l15.9">       onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l15.10"></a><span id="l15.10">         receiverFunc(settings);</span>
<a href="#l15.11"></a><span id="l15.11">       },</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l15.14"></a><span id="l15.14">         settings.eventList = settings.eventList.concat(aItems);</span>
<a href="#l15.15"></a><span id="l15.15">         if (!settings.printTasksWithNoDueDate) {</span>
<a href="#l15.16"></a><span id="l15.16">           let eventWithDueDate = [];</span>
<a href="#l15.17"></a><span id="l15.17">           for (let item of settings.eventList) {</span>
<a href="#l15.18"></a><span id="l15.18">             if (item.dueDate || item.endDate) {</span>
<a href="#l15.19"></a><span id="l15.19">               eventWithDueDate.push(item);</span>
<a href="#l15.20"></a><span id="l15.20">             }</span>
<a href="#l15.21"></a><span id="l15.21">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-providerUninstall-dialog.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-providerUninstall-dialog.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -7,17 +7,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> function onLoad() {</span>
<a href="#l16.7"></a><span id="l16.7">   let extension = window.arguments[0].extension;</span>
<a href="#l16.8"></a><span id="l16.8">   document.getElementById(&quot;provider-name-label&quot;).value = extension.name;</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10">   let calendarList = document.getElementById(&quot;calendar-list&quot;);</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  for (let calendar of cal.getCalendarManager().getCalendars({})) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  for (let calendar of cal.getCalendarManager().getCalendars()) {</span>
<a href="#l16.14"></a><span id="l16.14">     if (calendar.providerID != extension.id) {</span>
<a href="#l16.15"></a><span id="l16.15">       continue;</span>
<a href="#l16.16"></a><span id="l16.16">     }</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18">     let item = document.createXULElement(&quot;richlistitem&quot;);</span>
<a href="#l16.19"></a><span id="l16.19">     item.setAttribute(&quot;calendar-id&quot;, calendar.id);</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21">     let checkbox = document.createXULElement(&quot;checkbox&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-subscriptions-dialog.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-subscriptions-dialog.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -90,17 +90,17 @@ function onSearch() {</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5">   let richListBox = document.getElementById(&quot;subscriptions-listbox&quot;);</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">   while (richListBox.hasChildNodes()) {</span>
<a href="#l17.8"></a><span id="l17.8">     richListBox.lastChild.remove();</span>
<a href="#l17.9"></a><span id="l17.9">   }</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">   let registeredCals = {};</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  for (let calendar of cal.getCalendarManager().getCalendars({})) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  for (let calendar of cal.getCalendarManager().getCalendars()) {</span>
<a href="#l17.14"></a><span id="l17.14">     registeredCals[calendar.id] = true;</span>
<a href="#l17.15"></a><span id="l17.15">   }</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17">   let opListener = {</span>
<a href="#l17.18"></a><span id="l17.18">     onResult: function(operation, result) {</span>
<a href="#l17.19"></a><span id="l17.19">       if (result) {</span>
<a href="#l17.20"></a><span id="l17.20">         for (let calendar of result) {</span>
<a href="#l17.21"></a><span id="l17.21">           let newNode = document.createXULElement(&quot;richlistitem&quot;, {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/dialogs/chooseCalendarDialog.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/dialogs/chooseCalendarDialog.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -13,17 +13,17 @@ function loadCalendars() {</span>
<a href="#l18.4"></a><span id="l18.4">   let listbox = document.getElementById(&quot;calendar-list&quot;);</span>
<a href="#l18.5"></a><span id="l18.5">   let composite = cal.view.getCompositeCalendar(window.opener);</span>
<a href="#l18.6"></a><span id="l18.6">   let selectedIndex = 0;</span>
<a href="#l18.7"></a><span id="l18.7">   let calendars;</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">   if (window.arguments[0].calendars) {</span>
<a href="#l18.10"></a><span id="l18.10">     calendars = window.arguments[0].calendars;</span>
<a href="#l18.11"></a><span id="l18.11">   } else {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    calendars = calendarManager.getCalendars({});</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    calendars = calendarManager.getCalendars();</span>
<a href="#l18.14"></a><span id="l18.14">   }</span>
<a href="#l18.15"></a><span id="l18.15">   calendars = sortCalendarArray(calendars);</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">   for (let i = 0; i &lt; calendars.length; i++) {</span>
<a href="#l18.18"></a><span id="l18.18">     let calendar = calendars[i];</span>
<a href="#l18.19"></a><span id="l18.19">     let listItem = document.createXULElement(&quot;richlistitem&quot;);</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21">     let colorCell = document.createXULElement(&quot;box&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/import-export.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/import-export.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -96,17 +96,17 @@ function loadEventsFromFile(aCalendar) {</span>
<a href="#l19.4"></a><span id="l19.4">       }</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6">       if (aCalendar) {</span>
<a href="#l19.7"></a><span id="l19.7">         await putItemsIntoCal(aCalendar, items);</span>
<a href="#l19.8"></a><span id="l19.8">         resolve();</span>
<a href="#l19.9"></a><span id="l19.9">         return;</span>
<a href="#l19.10"></a><span id="l19.10">       }</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-      let calendars = cal.getCalendarManager().getCalendars({});</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+      let calendars = cal.getCalendarManager().getCalendars();</span>
<a href="#l19.14"></a><span id="l19.14">       calendars = calendars.filter(cal.acl.isCalendarWritable);</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16">       if (calendars.length == 1) {</span>
<a href="#l19.17"></a><span id="l19.17">         // There's only one calendar, so it's silly to ask what calendar</span>
<a href="#l19.18"></a><span id="l19.18">         // the user wants to import into.</span>
<a href="#l19.19"></a><span id="l19.19">         await putItemsIntoCal(calendars[0], items, filePath);</span>
<a href="#l19.20"></a><span id="l19.20">         resolve();</span>
<a href="#l19.21"></a><span id="l19.21">       } else if (calendars.length &gt; 1) {</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -303,34 +303,33 @@ function saveEventsToFile(calendarEventA</span>
<a href="#l19.23"></a><span id="l19.23">  */</span>
<a href="#l19.24"></a><span id="l19.24"> function exportEntireCalendar(aCalendar) {</span>
<a href="#l19.25"></a><span id="l19.25">   let itemArray = [];</span>
<a href="#l19.26"></a><span id="l19.26">   let getListener = {</span>
<a href="#l19.27"></a><span id="l19.27">     QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l19.28"></a><span id="l19.28">     onOperationComplete: function(aOpCalendar, aStatus, aOperationType, aId, aDetail) {</span>
<a href="#l19.29"></a><span id="l19.29">       saveEventsToFile(itemArray, aOpCalendar.name);</span>
<a href="#l19.30"></a><span id="l19.30">     },</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-    onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+    onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l19.33"></a><span id="l19.33">       for (let item of aItems) {</span>
<a href="#l19.34"></a><span id="l19.34">         itemArray.push(item);</span>
<a href="#l19.35"></a><span id="l19.35">       }</span>
<a href="#l19.36"></a><span id="l19.36">     },</span>
<a href="#l19.37"></a><span id="l19.37">   };</span>
<a href="#l19.38"></a><span id="l19.38"> </span>
<a href="#l19.39"></a><span id="l19.39">   let getItemsFromCal = function(aCal) {</span>
<a href="#l19.40"></a><span id="l19.40">     aCal.getItems(Ci.calICalendar.ITEM_FILTER_ALL_ITEMS, 0, null, null, getListener);</span>
<a href="#l19.41"></a><span id="l19.41">   };</span>
<a href="#l19.42"></a><span id="l19.42"> </span>
<a href="#l19.43"></a><span id="l19.43">   if (aCalendar) {</span>
<a href="#l19.44"></a><span id="l19.44">     getItemsFromCal(aCalendar);</span>
<a href="#l19.45"></a><span id="l19.45">   } else {</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-    let count = {};</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineminus">-    let calendars = cal.getCalendarManager().getCalendars(count);</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+    let calendars = cal.getCalendarManager().getCalendars();</span>
<a href="#l19.49"></a><span id="l19.49"> </span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-    if (count.value == 1) {</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+    if (calendars.length == 1) {</span>
<a href="#l19.52"></a><span id="l19.52">       // There's only one calendar, so it's silly to ask what calendar</span>
<a href="#l19.53"></a><span id="l19.53">       // the user wants to import into.</span>
<a href="#l19.54"></a><span id="l19.54">       getItemsFromCal(calendars[0]);</span>
<a href="#l19.55"></a><span id="l19.55">     } else {</span>
<a href="#l19.56"></a><span id="l19.56">       // Ask what calendar to import into</span>
<a href="#l19.57"></a><span id="l19.57">       let args = {};</span>
<a href="#l19.58"></a><span id="l19.58">       args.onOk = getItemsFromCal;</span>
<a href="#l19.59"></a><span id="l19.59">       args.promptText = cal.l10n.getCalString(&quot;exportPrompt&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-minimonth.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-minimonth.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -304,17 +304,17 @@</span>
<a href="#l20.4"></a><span id="l20.4">     get mReadOnlyHeader() {</span>
<a href="#l20.5"></a><span id="l20.5">       return this.querySelector(&quot;.minimonth-readonly-header&quot;);</span>
<a href="#l20.6"></a><span id="l20.6">     }</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8">     // calIOperationListener methods.</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10">     onOperationComplete(aCalendar, aStatus, aOperationType, aId, aDetail) {}</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+    onGetResult(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l20.14"></a><span id="l20.14">       if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l20.15"></a><span id="l20.15">         aItems.forEach(item =&gt; this.setBusyDaysForOccurrence(item, true));</span>
<a href="#l20.16"></a><span id="l20.16">       }</span>
<a href="#l20.17"></a><span id="l20.17">     }</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19">     setBusyDaysForItem(aItem, aState) {</span>
<a href="#l20.20"></a><span id="l20.20">       let items = aItem.recurrenceInfo</span>
<a href="#l20.21"></a><span id="l20.21">         ? aItem.getOccurrencesBetween(this.firstDate, this.lastDate)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/modules/utils/calAsyncUtils.jsm</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/modules/utils/calAsyncUtils.jsm</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -105,17 +105,17 @@ var calasync = {</span>
<a href="#l21.4"></a><span id="l21.4">    *     return calendar.addItem(aItem);</span>
<a href="#l21.5"></a><span id="l21.5">    *   }</span>
<a href="#l21.6"></a><span id="l21.6">    */</span>
<a href="#l21.7"></a><span id="l21.7">   promiseOperationListener: function(deferred) {</span>
<a href="#l21.8"></a><span id="l21.8">     return {</span>
<a href="#l21.9"></a><span id="l21.9">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l21.10"></a><span id="l21.10">       items: [],</span>
<a href="#l21.11"></a><span id="l21.11">       itemStatus: Cr.NS_OK,</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l21.14"></a><span id="l21.14">         this.itemStatus = aStatus;</span>
<a href="#l21.15"></a><span id="l21.15">         if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l21.16"></a><span id="l21.16">           this.items = this.items.concat(aItems);</span>
<a href="#l21.17"></a><span id="l21.17">         } else {</span>
<a href="#l21.18"></a><span id="l21.18">           this.itemSuccess = aStatus;</span>
<a href="#l21.19"></a><span id="l21.19">         }</span>
<a href="#l21.20"></a><span id="l21.20">       },</span>
<a href="#l21.21"></a><span id="l21.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/modules/utils/calItipUtils.jsm</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/modules/utils/calItipUtils.jsm</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -198,17 +198,17 @@ var calitip = {</span>
<a href="#l22.4"></a><span id="l22.4">       /* TODO: missing ACL check for existing items (require callback API) */</span>
<a href="#l22.5"></a><span id="l22.5">       return (</span>
<a href="#l22.6"></a><span id="l22.6">         calitip.isSchedulingCalendar(aCalendar) &amp;&amp; cal.acl.userCanAddItemsToCalendar(aCalendar)</span>
<a href="#l22.7"></a><span id="l22.7">       );</span>
<a href="#l22.8"></a><span id="l22.8">     };</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10">     let writableCalendars = cal</span>
<a href="#l22.11"></a><span id="l22.11">       .getCalendarManager()</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-      .getCalendars({})</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+      .getCalendars()</span>
<a href="#l22.14"></a><span id="l22.14">       .filter(isWritableCalendar);</span>
<a href="#l22.15"></a><span id="l22.15">     if (writableCalendars.length &gt; 0) {</span>
<a href="#l22.16"></a><span id="l22.16">       let compCal = Cc[&quot;@mozilla.org/calendar/calendar;1?type=composite&quot;].createInstance(</span>
<a href="#l22.17"></a><span id="l22.17">         Ci.calICompositeCalendar</span>
<a href="#l22.18"></a><span id="l22.18">       );</span>
<a href="#l22.19"></a><span id="l22.19">       writableCalendars.forEach(compCal.addCalendar, compCal);</span>
<a href="#l22.20"></a><span id="l22.20">       itipItem.targetCalendar = compCal;</span>
<a href="#l22.21"></a><span id="l22.21">     }</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineat">@@ -594,17 +594,17 @@ var calitip = {</span>
<a href="#l22.23"></a><span id="l22.23">       default:</span>
<a href="#l22.24"></a><span id="l22.24">         needsCalendar = true;</span>
<a href="#l22.25"></a><span id="l22.25">         break;</span>
<a href="#l22.26"></a><span id="l22.26">     }</span>
<a href="#l22.27"></a><span id="l22.27"> </span>
<a href="#l22.28"></a><span id="l22.28">     if (needsCalendar) {</span>
<a href="#l22.29"></a><span id="l22.29">       let calendars = cal</span>
<a href="#l22.30"></a><span id="l22.30">         .getCalendarManager()</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-        .getCalendars({})</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+        .getCalendars()</span>
<a href="#l22.33"></a><span id="l22.33">         .filter(calitip.isSchedulingCalendar);</span>
<a href="#l22.34"></a><span id="l22.34"> </span>
<a href="#l22.35"></a><span id="l22.35">       if (aItipItem.receivedMethod == &quot;REQUEST&quot;) {</span>
<a href="#l22.36"></a><span id="l22.36">         // try to further limit down the list to those calendars that</span>
<a href="#l22.37"></a><span id="l22.37">         // are configured to a matching attendee;</span>
<a href="#l22.38"></a><span id="l22.38">         let item = aItipItem.getItemList()[0];</span>
<a href="#l22.39"></a><span id="l22.39">         let matchingCals = calendars.filter(</span>
<a href="#l22.40"></a><span id="l22.40">           calendar =&gt; calitip.getInvitedAttendee(item, calendar) != null</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineat">@@ -1533,17 +1533,17 @@ ItipOpListener.prototype = {</span>
<a href="#l22.42"></a><span id="l22.42">     cal.ASSERT(Components.isSuccessCode(aStatus), &quot;error on iTIP processing&quot;);</span>
<a href="#l22.43"></a><span id="l22.43">     if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l22.44"></a><span id="l22.44">       calitip.checkAndSend(aOperationType, aDetail, this.mOldItem, this.mExtResponse);</span>
<a href="#l22.45"></a><span id="l22.45">     }</span>
<a href="#l22.46"></a><span id="l22.46">     if (this.mOpListener) {</span>
<a href="#l22.47"></a><span id="l22.47">       this.mOpListener.onOperationComplete(aCalendar, aStatus, aOperationType, aId, aDetail);</span>
<a href="#l22.48"></a><span id="l22.48">     }</span>
<a href="#l22.49"></a><span id="l22.49">   },</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-  onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {},</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineplus">+  onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l22.52"></a><span id="l22.52"> };</span>
<a href="#l22.53"></a><span id="l22.53"> </span>
<a href="#l22.54"></a><span id="l22.54"> /** local to this module file</span>
<a href="#l22.55"></a><span id="l22.55">  * Add a parameter SCHEDULE-AGENT=CLIENT to the item before it is</span>
<a href="#l22.56"></a><span id="l22.56">  * created or updated so that the providers knows scheduling will</span>
<a href="#l22.57"></a><span id="l22.57">  * be handled by the client.</span>
<a href="#l22.58"></a><span id="l22.58">  *</span>
<a href="#l22.59"></a><span id="l22.59">  * @param {calIItemBase} item       item about to be added or updated</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineat">@@ -2024,14 +2024,14 @@ ItipItemFinder.prototype = {</span>
<a href="#l22.61"></a><span id="l22.61">         }</span>
<a href="#l22.62"></a><span id="l22.62">       };</span>
<a href="#l22.63"></a><span id="l22.63">       actionFunc.method = actionMethod;</span>
<a href="#l22.64"></a><span id="l22.64">     }</span>
<a href="#l22.65"></a><span id="l22.65"> </span>
<a href="#l22.66"></a><span id="l22.66">     this.mOptionsFunc(this.mItipItem, rc, actionFunc, this.mFoundItems);</span>
<a href="#l22.67"></a><span id="l22.67">   },</span>
<a href="#l22.68"></a><span id="l22.68"> </span>
<a href="#l22.69"></a><span id="l22.69" class="difflineminus">-  onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineplus">+  onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l22.71"></a><span id="l22.71">     if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l22.72"></a><span id="l22.72">       this.mFoundItems = this.mFoundItems.concat(aItems);</span>
<a href="#l22.73"></a><span id="l22.73">     }</span>
<a href="#l22.74"></a><span id="l22.74">   },</span>
<a href="#l22.75"></a><span id="l22.75"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/modules/utils/calViewUtils.jsm</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/modules/utils/calViewUtils.jsm</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -355,17 +355,17 @@ calview.colorTracker = {</span>
<a href="#l23.4"></a><span id="l23.4">   categoryBranch: null,</span>
<a href="#l23.5"></a><span id="l23.5">   windows: new Set(),</span>
<a href="#l23.6"></a><span id="l23.6">   QueryInterface: cal.generateQI([Ci.calICalendarManagerObserver, Ci.calIObserver]),</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8">   // Deregistration is not required.</span>
<a href="#l23.9"></a><span id="l23.9">   registerWindow(aWindow) {</span>
<a href="#l23.10"></a><span id="l23.10">     if (this.calendars === null) {</span>
<a href="#l23.11"></a><span id="l23.11">       let manager = cal.getCalendarManager();</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-      this.calendars = new Set(manager.getCalendars({}));</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+      this.calendars = new Set(manager.getCalendars());</span>
<a href="#l23.14"></a><span id="l23.14">       manager.addObserver(this);</span>
<a href="#l23.15"></a><span id="l23.15">       manager.addCalendarObserver(this);</span>
<a href="#l23.16"></a><span id="l23.16">       this.categoryBranch = Services.prefs.getBranch(&quot;calendar.category.color.&quot;);</span>
<a href="#l23.17"></a><span id="l23.17">       this.categoryBranch.addObserver(&quot;&quot;, this);</span>
<a href="#l23.18"></a><span id="l23.18">       Services.obs.addObserver(this, &quot;xpcom-shutdown&quot;);</span>
<a href="#l23.19"></a><span id="l23.19">     }</span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21">     this.windows.add(aWindow);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/public/calICalendar.idl</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/public/calICalendar.idl</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -511,18 +511,17 @@ interface calICompositeCalendar : calICa</span>
<a href="#l24.4"></a><span id="l24.4">    * return it; otherwise return null.</span>
<a href="#l24.5"></a><span id="l24.5">    *</span>
<a href="#l24.6"></a><span id="l24.6">    * @param aId id of calendar</span>
<a href="#l24.7"></a><span id="l24.7">    * @return calendar, or null if none</span>
<a href="#l24.8"></a><span id="l24.8">    */</span>
<a href="#l24.9"></a><span id="l24.9">   calICalendar getCalendarById(in AUTF8String aId);</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11">   /* return a list of all calendars currently registered */</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  void getCalendars(out uint32_t count,</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-                    [array, size_is(count), retval] out calICalendar aCalendars);</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+  Array&lt;calICalendar&gt; getCalendars();</span>
<a href="#l24.15"></a><span id="l24.15"> </span>
<a href="#l24.16"></a><span id="l24.16">   /**</span>
<a href="#l24.17"></a><span id="l24.17">    * In order for addItem() to be called on this object, it is first necessary</span>
<a href="#l24.18"></a><span id="l24.18">    * to set this attribute to specify which underlying calendar the item is</span>
<a href="#l24.19"></a><span id="l24.19">    * to be added to.</span>
<a href="#l24.20"></a><span id="l24.20">    */</span>
<a href="#l24.21"></a><span id="l24.21">   attribute calICalendar defaultCalendar;</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23" class="difflineat">@@ -622,20 +621,18 @@ interface calIOperationListener : nsISup</span>
<a href="#l24.24"></a><span id="l24.24">    * For getItem and getItems.</span>
<a href="#l24.25"></a><span id="l24.25">    *</span>
<a href="#l24.26"></a><span id="l24.26">    * @param aStatus   status code summarizing what happened.</span>
<a href="#l24.27"></a><span id="l24.27">    * @param aItemType type of interface returned in the array (@see</span>
<a href="#l24.28"></a><span id="l24.28">    *                  calICalendar::GetItems).</span>
<a href="#l24.29"></a><span id="l24.29">    * @param aDetail   not yet fully specified.  If aStatus is an error</span>
<a href="#l24.30"></a><span id="l24.30">    *                  result, this will probably be an extended error</span>
<a href="#l24.31"></a><span id="l24.31">    *                  string (eg one returned by a server).</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">-   * @param aCount    size of array returned, in items</span>
<a href="#l24.33"></a><span id="l24.33">    * @param aItems    array of immutable items</span>
<a href="#l24.34"></a><span id="l24.34">    *</span>
<a href="#l24.35"></a><span id="l24.35">    * Multiple onGetResults might be called</span>
<a href="#l24.36"></a><span id="l24.36">    */</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-  void onGetResult (in calICalendar aCalendar,</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">-                    in nsresult aStatus,</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-                    in nsIIDRef aItemType,</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-                    in nsIVariant aDetail,</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-                    in uint32_t aCount,</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-                    [array, size_is(aCount), iid_is(aItemType)]  in nsQIResult aItems );</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+  void onGetResult(in calICalendar aCalendar,</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+                   in nsresult aStatus,</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+                   in nsIIDRef aItemType,</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineplus">+                   in nsIVariant aDetail,</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+                   [iid_is(aItemType)] in Array&lt;nsQIResult&gt; aItems);</span>
<a href="#l24.48"></a><span id="l24.48"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/public/calICalendarManager.idl</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/public/calICalendarManager.idl</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -61,18 +61,17 @@ interface calICalendarManager : nsISuppo</span>
<a href="#l25.4"></a><span id="l25.4">    * @param aMode           A combination of the above mode flags.</span>
<a href="#l25.5"></a><span id="l25.5">    */</span>
<a href="#l25.6"></a><span id="l25.6">   void removeCalendar(in calICalendar aCalendar, [optional] in uint8_t aMode);</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8">   /* get a calendar by its id */</span>
<a href="#l25.9"></a><span id="l25.9">   calICalendar getCalendarById(in AUTF8String aId);</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11">   /* return a list of all calendars currently registered */</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  void getCalendars(out uint32_t count,</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-                    [array, size_is(count), retval] out calICalendar aCalendars);</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+  Array&lt;calICalendar&gt; getCalendars();</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16">   /** Add an observer for the calendar manager, i.e when calendars are registered */</span>
<a href="#l25.17"></a><span id="l25.17">   void addObserver(in calICalendarManagerObserver aObserver);</span>
<a href="#l25.18"></a><span id="l25.18">   /** Remove an observer for the calendar manager */</span>
<a href="#l25.19"></a><span id="l25.19">   void removeObserver(in calICalendarManagerObserver aObserver);</span>
<a href="#l25.20"></a><span id="l25.20"> </span>
<a href="#l25.21"></a><span id="l25.21">   /** Add an observer to handle changes to all calendars (even disabled or unchecked ones) */</span>
<a href="#l25.22"></a><span id="l25.22">   void addCalendarObserver(in calIObserver aObserver);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -226,17 +226,17 @@ calAlarmService.prototype = {</span>
<a href="#l26.4"></a><span id="l26.4"> </span>
<a href="#l26.5"></a><span id="l26.5">     // Make sure the alarm monitor is alive so it's observing the notification.</span>
<a href="#l26.6"></a><span id="l26.6">     Cc[&quot;@mozilla.org/calendar/alarm-monitor;1&quot;].getService(Ci.calIAlarmServiceObserver);</span>
<a href="#l26.7"></a><span id="l26.7">     // Tell people that we're alive so they can start monitoring alarms.</span>
<a href="#l26.8"></a><span id="l26.8">     Services.obs.notifyObservers(null, &quot;alarm-service-startup&quot;);</span>
<a href="#l26.9"></a><span id="l26.9"> </span>
<a href="#l26.10"></a><span id="l26.10">     cal.getCalendarManager().addObserver(this.calendarManagerObserver);</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-    for (let calendar of cal.getCalendarManager().getCalendars({})) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+    for (let calendar of cal.getCalendarManager().getCalendars()) {</span>
<a href="#l26.14"></a><span id="l26.14">       this.observeCalendar(calendar);</span>
<a href="#l26.15"></a><span id="l26.15">     }</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17">     /* set up a timer to update alarms every N hours */</span>
<a href="#l26.18"></a><span id="l26.18">     let timerCallback = {</span>
<a href="#l26.19"></a><span id="l26.19">       alarmService: this,</span>
<a href="#l26.20"></a><span id="l26.20">       notify: function() {</span>
<a href="#l26.21"></a><span id="l26.21">         let now = nowUTC();</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -256,17 +256,17 @@ calAlarmService.prototype = {</span>
<a href="#l26.23"></a><span id="l26.23">         let until = now.clone();</span>
<a href="#l26.24"></a><span id="l26.24">         until.month += Ci.calIAlarmService.MAX_SNOOZE_MONTHS;</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26">         // We don't set timers for every future alarm, only those within 6 hours</span>
<a href="#l26.27"></a><span id="l26.27">         let end = now.clone();</span>
<a href="#l26.28"></a><span id="l26.28">         end.hour += kHoursBetweenUpdates;</span>
<a href="#l26.29"></a><span id="l26.29">         this.alarmService.mRangeEnd = end.getInTimezone(cal.dtz.UTC);</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-        this.alarmService.findAlarms(cal.getCalendarManager().getCalendars({}), start, until);</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+        this.alarmService.findAlarms(cal.getCalendarManager().getCalendars(), start, until);</span>
<a href="#l26.33"></a><span id="l26.33">       },</span>
<a href="#l26.34"></a><span id="l26.34">     };</span>
<a href="#l26.35"></a><span id="l26.35">     timerCallback.notify();</span>
<a href="#l26.36"></a><span id="l26.36"> </span>
<a href="#l26.37"></a><span id="l26.37">     this.mUpdateTimer = newTimerWithCallback(timerCallback, kHoursBetweenUpdates * 3600000, true);</span>
<a href="#l26.38"></a><span id="l26.38"> </span>
<a href="#l26.39"></a><span id="l26.39">     this.mStarted = true;</span>
<a href="#l26.40"></a><span id="l26.40">   },</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineat">@@ -283,17 +283,17 @@ calAlarmService.prototype = {</span>
<a href="#l26.42"></a><span id="l26.42">       this.mUpdateTimer.cancel();</span>
<a href="#l26.43"></a><span id="l26.43">       this.mUpdateTimer = null;</span>
<a href="#l26.44"></a><span id="l26.44">     }</span>
<a href="#l26.45"></a><span id="l26.45"> </span>
<a href="#l26.46"></a><span id="l26.46">     let calmgr = cal.getCalendarManager();</span>
<a href="#l26.47"></a><span id="l26.47">     calmgr.removeObserver(this.calendarManagerObserver);</span>
<a href="#l26.48"></a><span id="l26.48"> </span>
<a href="#l26.49"></a><span id="l26.49">     // Stop observing all calendars. This will also clear the timers.</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineminus">-    for (let calendar of calmgr.getCalendars({})) {</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+    for (let calendar of calmgr.getCalendars()) {</span>
<a href="#l26.52"></a><span id="l26.52">       this.unobserveCalendar(calendar);</span>
<a href="#l26.53"></a><span id="l26.53">     }</span>
<a href="#l26.54"></a><span id="l26.54"> </span>
<a href="#l26.55"></a><span id="l26.55">     this.mRangeEnd = null;</span>
<a href="#l26.56"></a><span id="l26.56"> </span>
<a href="#l26.57"></a><span id="l26.57">     Services.obs.removeObserver(this, &quot;profile-after-change&quot;);</span>
<a href="#l26.58"></a><span id="l26.58">     Services.obs.removeObserver(this, &quot;xpcom-shutdown&quot;);</span>
<a href="#l26.59"></a><span id="l26.59">     Services.obs.removeObserver(this, &quot;wake_notification&quot;);</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineat">@@ -515,17 +515,17 @@ calAlarmService.prototype = {</span>
<a href="#l26.61"></a><span id="l26.61">           }</span>
<a href="#l26.62"></a><span id="l26.62">         );</span>
<a href="#l26.63"></a><span id="l26.63"> </span>
<a href="#l26.64"></a><span id="l26.64">         // if no results were returned we still need to resolve the promise</span>
<a href="#l26.65"></a><span id="l26.65">         if (!this.results) {</span>
<a href="#l26.66"></a><span id="l26.66">           this.addRemovePromise.resolve();</span>
<a href="#l26.67"></a><span id="l26.67">         }</span>
<a href="#l26.68"></a><span id="l26.68">       },</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l26.71"></a><span id="l26.71">         let promise = this.addRemovePromise;</span>
<a href="#l26.72"></a><span id="l26.72">         this.batchCount++;</span>
<a href="#l26.73"></a><span id="l26.73">         this.results = true;</span>
<a href="#l26.74"></a><span id="l26.74"> </span>
<a href="#l26.75"></a><span id="l26.75">         cal.iterate.forEach(</span>
<a href="#l26.76"></a><span id="l26.76">           aItems,</span>
<a href="#l26.77"></a><span id="l26.77">           item =&gt; {</span>
<a href="#l26.78"></a><span id="l26.78">             try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -6,17 +6,17 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l27.4"></a><span id="l27.4"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6"> var calICalendar = Ci.calICalendar;</span>
<a href="#l27.7"></a><span id="l27.7"> var cICL = Ci.calIChangeLog;</span>
<a href="#l27.8"></a><span id="l27.8"> var cIOL = Ci.calIOperationListener;</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10"> var gNoOpListener = {</span>
<a href="#l27.11"></a><span id="l27.11">   QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  onGetResult: function(calendar, status, itemType, detail, count, items) {},</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l27.14"></a><span id="l27.14"> </span>
<a href="#l27.15"></a><span id="l27.15">   onOperationComplete: function(calendar, status, opType, id, detail) {},</span>
<a href="#l27.16"></a><span id="l27.16"> };</span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18"> /**</span>
<a href="#l27.19"></a><span id="l27.19">  * Returns true if the exception passed is one that should cause the cache</span>
<a href="#l27.20"></a><span id="l27.20">  * layer to retry the operation. This is usually a network error or other</span>
<a href="#l27.21"></a><span id="l27.21">  * temporary error.</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -224,17 +224,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.23"></a><span id="l27.23">     }</span>
<a href="#l27.24"></a><span id="l27.24">   },</span>
<a href="#l27.25"></a><span id="l27.25"> </span>
<a href="#l27.26"></a><span id="l27.26">   getOfflineAddedItems: function(callbackFunc) {</span>
<a href="#l27.27"></a><span id="l27.27">     let self = this;</span>
<a href="#l27.28"></a><span id="l27.28">     self.offlineCachedItems = {};</span>
<a href="#l27.29"></a><span id="l27.29">     let getListener = {</span>
<a href="#l27.30"></a><span id="l27.30">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l27.33"></a><span id="l27.33">         for (let item of aItems) {</span>
<a href="#l27.34"></a><span id="l27.34">           self.offlineCachedItems[item.hashId] = item;</span>
<a href="#l27.35"></a><span id="l27.35">           self.offlineCachedItemFlags[item.hashId] = cICL.OFFLINE_FLAG_CREATED_RECORD;</span>
<a href="#l27.36"></a><span id="l27.36">         }</span>
<a href="#l27.37"></a><span id="l27.37">       },</span>
<a href="#l27.38"></a><span id="l27.38"> </span>
<a href="#l27.39"></a><span id="l27.39">       onOperationComplete: function(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l27.40"></a><span id="l27.40">         self.getOfflineModifiedItems(callbackFunc);</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineat">@@ -248,17 +248,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.42"></a><span id="l27.42">       getListener</span>
<a href="#l27.43"></a><span id="l27.43">     );</span>
<a href="#l27.44"></a><span id="l27.44">   },</span>
<a href="#l27.45"></a><span id="l27.45"> </span>
<a href="#l27.46"></a><span id="l27.46">   getOfflineModifiedItems: function(callbackFunc) {</span>
<a href="#l27.47"></a><span id="l27.47">     let self = this;</span>
<a href="#l27.48"></a><span id="l27.48">     let getListener = {</span>
<a href="#l27.49"></a><span id="l27.49">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l27.52"></a><span id="l27.52">         for (let item of aItems) {</span>
<a href="#l27.53"></a><span id="l27.53">           self.offlineCachedItems[item.hashId] = item;</span>
<a href="#l27.54"></a><span id="l27.54">           self.offlineCachedItemFlags[item.hashId] = cICL.OFFLINE_FLAG_MODIFIED_RECORD;</span>
<a href="#l27.55"></a><span id="l27.55">         }</span>
<a href="#l27.56"></a><span id="l27.56">       },</span>
<a href="#l27.57"></a><span id="l27.57"> </span>
<a href="#l27.58"></a><span id="l27.58">       onOperationComplete: function(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l27.59"></a><span id="l27.59">         self.getOfflineDeletedItems(callbackFunc);</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineat">@@ -272,17 +272,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.61"></a><span id="l27.61">       getListener</span>
<a href="#l27.62"></a><span id="l27.62">     );</span>
<a href="#l27.63"></a><span id="l27.63">   },</span>
<a href="#l27.64"></a><span id="l27.64"> </span>
<a href="#l27.65"></a><span id="l27.65">   getOfflineDeletedItems: function(callbackFunc) {</span>
<a href="#l27.66"></a><span id="l27.66">     let self = this;</span>
<a href="#l27.67"></a><span id="l27.67">     let getListener = {</span>
<a href="#l27.68"></a><span id="l27.68">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l27.71"></a><span id="l27.71">         for (let item of aItems) {</span>
<a href="#l27.72"></a><span id="l27.72">           self.offlineCachedItems[item.hashId] = item;</span>
<a href="#l27.73"></a><span id="l27.73">           self.offlineCachedItemFlags[item.hashId] = cICL.OFFLINE_FLAG_DELETED_RECORD;</span>
<a href="#l27.74"></a><span id="l27.74">         }</span>
<a href="#l27.75"></a><span id="l27.75">       },</span>
<a href="#l27.76"></a><span id="l27.76"> </span>
<a href="#l27.77"></a><span id="l27.77">       onOperationComplete: function(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l27.78"></a><span id="l27.78">         if (callbackFunc) {</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineat">@@ -366,17 +366,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.80"></a><span id="l27.80">     let completeListener = {</span>
<a href="#l27.81"></a><span id="l27.81">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l27.82"></a><span id="l27.82">       modifiedTimes: {},</span>
<a href="#l27.83"></a><span id="l27.83">       hasRenewedCalendar: false,</span>
<a href="#l27.84"></a><span id="l27.84">       getsCompleted: 0,</span>
<a href="#l27.85"></a><span id="l27.85">       getsReceived: 0,</span>
<a href="#l27.86"></a><span id="l27.86">       opCompleted: false,</span>
<a href="#l27.87"></a><span id="l27.87"> </span>
<a href="#l27.88"></a><span id="l27.88" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l27.89"></a><span id="l27.89" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l27.90"></a><span id="l27.90">         if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l27.91"></a><span id="l27.91">           if (!this.hasRenewedCalendar) {</span>
<a href="#l27.92"></a><span id="l27.92">             // TODO instead of deleting the calendar and creating a new</span>
<a href="#l27.93"></a><span id="l27.93">             // one, maybe we want to do a &quot;real&quot; sync between the</span>
<a href="#l27.94"></a><span id="l27.94">             // existing local calendar and the remote calendar.</span>
<a href="#l27.95"></a><span id="l27.95">             self.setupCachedCalendar();</span>
<a href="#l27.96"></a><span id="l27.96">             this.hasRenewedCalendar = true;</span>
<a href="#l27.97"></a><span id="l27.97">           }</span>
<a href="#l27.98"></a><span id="l27.98" class="difflineat">@@ -574,17 +574,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.99"></a><span id="l27.99">         filter = calICalendar.ITEM_FILTER_OFFLINE_DELETED;</span>
<a href="#l27.100"></a><span id="l27.100">         break;</span>
<a href="#l27.101"></a><span id="l27.101">       default:</span>
<a href="#l27.102"></a><span id="l27.102">         cal.ERROR(&quot;[calCachedCalendar] Invalid playback type: &quot; + aPlaybackType);</span>
<a href="#l27.103"></a><span id="l27.103">         return;</span>
<a href="#l27.104"></a><span id="l27.104">     }</span>
<a href="#l27.105"></a><span id="l27.105"> </span>
<a href="#l27.106"></a><span id="l27.106">     let opListener = {</span>
<a href="#l27.107"></a><span id="l27.107" class="difflineminus">-      onGetResult: function(calendar, status, itemType, detail, count, items) {},</span>
<a href="#l27.108"></a><span id="l27.108" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l27.109"></a><span id="l27.109">       onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l27.110"></a><span id="l27.110">         if (Components.isSuccessCode(status)) {</span>
<a href="#l27.111"></a><span id="l27.111">           if (aPlaybackType == cICL.OFFLINE_FLAG_DELETED_RECORD) {</span>
<a href="#l27.112"></a><span id="l27.112">             self.mCachedCalendar.deleteItem(detail, resetListener);</span>
<a href="#l27.113"></a><span id="l27.113">           } else {</span>
<a href="#l27.114"></a><span id="l27.114">             storage.resetItemOfflineFlag(detail, resetListener);</span>
<a href="#l27.115"></a><span id="l27.115">           }</span>
<a href="#l27.116"></a><span id="l27.116">         } else {</span>
<a href="#l27.117"></a><span id="l27.117" class="difflineat">@@ -628,17 +628,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.118"></a><span id="l27.118">               e</span>
<a href="#l27.119"></a><span id="l27.119">           );</span>
<a href="#l27.120"></a><span id="l27.120">           opListener.onOperationComplete(self, e.result, listenerOp, item.id, e.message);</span>
<a href="#l27.121"></a><span id="l27.121">         }</span>
<a href="#l27.122"></a><span id="l27.122">       }</span>
<a href="#l27.123"></a><span id="l27.123">     }</span>
<a href="#l27.124"></a><span id="l27.124"> </span>
<a href="#l27.125"></a><span id="l27.125">     let getListener = {</span>
<a href="#l27.126"></a><span id="l27.126" class="difflineminus">-      onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l27.127"></a><span id="l27.127" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {</span>
<a href="#l27.128"></a><span id="l27.128">         itemQueue = itemQueue.concat(items);</span>
<a href="#l27.129"></a><span id="l27.129">       },</span>
<a href="#l27.130"></a><span id="l27.130">       onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l27.131"></a><span id="l27.131">         if (self.offline) {</span>
<a href="#l27.132"></a><span id="l27.132">           cal.LOG(&quot;[calCachedCalendar] back to offline mode, reconciliation aborted&quot;);</span>
<a href="#l27.133"></a><span id="l27.133">           if (aCallback) {</span>
<a href="#l27.134"></a><span id="l27.134">             aCallback();</span>
<a href="#l27.135"></a><span id="l27.135">           }</span>
<a href="#l27.136"></a><span id="l27.136" class="difflineat">@@ -736,17 +736,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.137"></a><span id="l27.137">     // calIOperationListener, e.g. *before* it fires on calIObservers</span>
<a href="#l27.138"></a><span id="l27.138">     // (because that order is undefined). Firing onOperationComplete before onAddItem et al</span>
<a href="#l27.139"></a><span id="l27.139">     // would result in this facade firing onOperationComplete even though the modification</span>
<a href="#l27.140"></a><span id="l27.140">     // hasn't yet been performed on the cached calendar (which happens in onAddItem et al).</span>
<a href="#l27.141"></a><span id="l27.141">     // Result is that we currently stick to firing onOperationComplete if the cached calendar</span>
<a href="#l27.142"></a><span id="l27.142">     // has performed the modification, see below:</span>
<a href="#l27.143"></a><span id="l27.143">     let self = this;</span>
<a href="#l27.144"></a><span id="l27.144">     let cacheListener = {</span>
<a href="#l27.145"></a><span id="l27.145" class="difflineminus">-      onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l27.146"></a><span id="l27.146" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {</span>
<a href="#l27.147"></a><span id="l27.147">         cal.ASSERT(false, &quot;unexpected!&quot;);</span>
<a href="#l27.148"></a><span id="l27.148">       },</span>
<a href="#l27.149"></a><span id="l27.149">       onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l27.150"></a><span id="l27.150">         if (isUnavailableCode(status)) {</span>
<a href="#l27.151"></a><span id="l27.151">           // The item couldn't be added to the (remote) location,</span>
<a href="#l27.152"></a><span id="l27.152">           // this is like being offline. Add the item to the cached</span>
<a href="#l27.153"></a><span id="l27.153">           // calendar instead.</span>
<a href="#l27.154"></a><span id="l27.154">           cal.LOG(</span>
<a href="#l27.155"></a><span id="l27.155" class="difflineat">@@ -770,17 +770,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.156"></a><span id="l27.156">     } else {</span>
<a href="#l27.157"></a><span id="l27.157">       // Otherwise ask the provider to add the item now.</span>
<a href="#l27.158"></a><span id="l27.158">       this.mUncachedCalendar.adoptItem(item, cacheListener);</span>
<a href="#l27.159"></a><span id="l27.159">     }</span>
<a href="#l27.160"></a><span id="l27.160">   },</span>
<a href="#l27.161"></a><span id="l27.161">   adoptOfflineItem: function(item, listener) {</span>
<a href="#l27.162"></a><span id="l27.162">     let self = this;</span>
<a href="#l27.163"></a><span id="l27.163">     let opListener = {</span>
<a href="#l27.164"></a><span id="l27.164" class="difflineminus">-      onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l27.165"></a><span id="l27.165" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {</span>
<a href="#l27.166"></a><span id="l27.166">         cal.ASSERT(false, &quot;unexpected!&quot;);</span>
<a href="#l27.167"></a><span id="l27.167">       },</span>
<a href="#l27.168"></a><span id="l27.168">       onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l27.169"></a><span id="l27.169">         if (Components.isSuccessCode(status)) {</span>
<a href="#l27.170"></a><span id="l27.170">           let storage = self.mCachedCalendar.QueryInterface(Ci.calIOfflineStorage);</span>
<a href="#l27.171"></a><span id="l27.171">           storage.addOfflineItem(detail, listener);</span>
<a href="#l27.172"></a><span id="l27.172">         } else if (listener) {</span>
<a href="#l27.173"></a><span id="l27.173">           listener.onOperationComplete(self, status, opType, id, detail);</span>
<a href="#l27.174"></a><span id="l27.174" class="difflineat">@@ -791,17 +791,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.175"></a><span id="l27.175">   },</span>
<a href="#l27.176"></a><span id="l27.176"> </span>
<a href="#l27.177"></a><span id="l27.177">   modifyItem: function(newItem, oldItem, listener) {</span>
<a href="#l27.178"></a><span id="l27.178">     let self = this;</span>
<a href="#l27.179"></a><span id="l27.179"> </span>
<a href="#l27.180"></a><span id="l27.180">     // First of all, we should find out if the item to modify is</span>
<a href="#l27.181"></a><span id="l27.181">     // already an offline item or not.</span>
<a href="#l27.182"></a><span id="l27.182">     let flagListener = {</span>
<a href="#l27.183"></a><span id="l27.183" class="difflineminus">-      onGetResult: function() {},</span>
<a href="#l27.184"></a><span id="l27.184" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l27.185"></a><span id="l27.185">       onOperationComplete: function(calendar, status, opType, id, offline_flag) {</span>
<a href="#l27.186"></a><span id="l27.186">         if (</span>
<a href="#l27.187"></a><span id="l27.187">           offline_flag == cICL.OFFLINE_FLAG_CREATED_RECORD ||</span>
<a href="#l27.188"></a><span id="l27.188">           offline_flag == cICL.OFFLINE_FLAG_MODIFIED_RECORD</span>
<a href="#l27.189"></a><span id="l27.189">         ) {</span>
<a href="#l27.190"></a><span id="l27.190">           // The item is already offline, just modify it in the cache</span>
<a href="#l27.191"></a><span id="l27.191">           self.modifyOfflineItem(newItem, oldItem, listener);</span>
<a href="#l27.192"></a><span id="l27.192">         } else {</span>
<a href="#l27.193"></a><span id="l27.193" class="difflineat">@@ -817,17 +817,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.194"></a><span id="l27.194">      * But this would mean the uncached provider fires on the passed</span>
<a href="#l27.195"></a><span id="l27.195">      * calIOperationListener, e.g. *before* it fires on calIObservers</span>
<a href="#l27.196"></a><span id="l27.196">      * (because that order is undefined). Firing onOperationComplete before onAddItem et al</span>
<a href="#l27.197"></a><span id="l27.197">      * would result in this facade firing onOperationComplete even though the modification</span>
<a href="#l27.198"></a><span id="l27.198">      * hasn't yet been performed on the cached calendar (which happens in onAddItem et al).</span>
<a href="#l27.199"></a><span id="l27.199">      * Result is that we currently stick to firing onOperationComplete if the cached calendar</span>
<a href="#l27.200"></a><span id="l27.200">      * has performed the modification, see below: */</span>
<a href="#l27.201"></a><span id="l27.201">     let cacheListener = {</span>
<a href="#l27.202"></a><span id="l27.202" class="difflineminus">-      onGetResult: function() {},</span>
<a href="#l27.203"></a><span id="l27.203" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l27.204"></a><span id="l27.204">       onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l27.205"></a><span id="l27.205">         if (isUnavailableCode(status)) {</span>
<a href="#l27.206"></a><span id="l27.206">           // The item couldn't be modified at the (remote) location,</span>
<a href="#l27.207"></a><span id="l27.207">           // this is like being offline. Add the item to the cache</span>
<a href="#l27.208"></a><span id="l27.208">           // instead.</span>
<a href="#l27.209"></a><span id="l27.209">           cal.LOG(</span>
<a href="#l27.210"></a><span id="l27.210">             &quot;[calCachedCalendar] Calendar &quot; +</span>
<a href="#l27.211"></a><span id="l27.211">               calendar.name +</span>
<a href="#l27.212"></a><span id="l27.212" class="difflineat">@@ -852,17 +852,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.213"></a><span id="l27.213">       // process the item.</span>
<a href="#l27.214"></a><span id="l27.214">       this.mCachedCalendar.getItemOfflineFlag(oldItem, flagListener);</span>
<a href="#l27.215"></a><span id="l27.215">     }</span>
<a href="#l27.216"></a><span id="l27.216">   },</span>
<a href="#l27.217"></a><span id="l27.217"> </span>
<a href="#l27.218"></a><span id="l27.218">   modifyOfflineItem: function(newItem, oldItem, listener) {</span>
<a href="#l27.219"></a><span id="l27.219">     let self = this;</span>
<a href="#l27.220"></a><span id="l27.220">     let opListener = {</span>
<a href="#l27.221"></a><span id="l27.221" class="difflineminus">-      onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l27.222"></a><span id="l27.222" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {</span>
<a href="#l27.223"></a><span id="l27.223">         cal.ASSERT(false, &quot;unexpected!&quot;);</span>
<a href="#l27.224"></a><span id="l27.224">       },</span>
<a href="#l27.225"></a><span id="l27.225">       onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l27.226"></a><span id="l27.226">         if (Components.isSuccessCode(status)) {</span>
<a href="#l27.227"></a><span id="l27.227">           // Modify the offline item in the storage, passing the</span>
<a href="#l27.228"></a><span id="l27.228">           // listener will make sure its notified</span>
<a href="#l27.229"></a><span id="l27.229">           let storage = self.mCachedCalendar.QueryInterface(Ci.calIOfflineStorage);</span>
<a href="#l27.230"></a><span id="l27.230">           storage.modifyOfflineItem(detail, listener);</span>
<a href="#l27.231"></a><span id="l27.231" class="difflineat">@@ -878,17 +878,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.232"></a><span id="l27.232">   },</span>
<a href="#l27.233"></a><span id="l27.233"> </span>
<a href="#l27.234"></a><span id="l27.234">   deleteItem: function(item, listener) {</span>
<a href="#l27.235"></a><span id="l27.235">     let self = this;</span>
<a href="#l27.236"></a><span id="l27.236"> </span>
<a href="#l27.237"></a><span id="l27.237">     // First of all, we should find out if the item to delete is</span>
<a href="#l27.238"></a><span id="l27.238">     // already an offline item or not.</span>
<a href="#l27.239"></a><span id="l27.239">     let flagListener = {</span>
<a href="#l27.240"></a><span id="l27.240" class="difflineminus">-      onGetResult: function() {},</span>
<a href="#l27.241"></a><span id="l27.241" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l27.242"></a><span id="l27.242">       onOperationComplete: function(calendar, status, opType, id, offline_flag) {</span>
<a href="#l27.243"></a><span id="l27.243">         if (</span>
<a href="#l27.244"></a><span id="l27.244">           offline_flag == cICL.OFFLINE_FLAG_CREATED_RECORD ||</span>
<a href="#l27.245"></a><span id="l27.245">           offline_flag == cICL.OFFLINE_FLAG_MODIFIED_RECORD</span>
<a href="#l27.246"></a><span id="l27.246">         ) {</span>
<a href="#l27.247"></a><span id="l27.247">           // The item is already offline, just mark it deleted it in</span>
<a href="#l27.248"></a><span id="l27.248">           // the cache</span>
<a href="#l27.249"></a><span id="l27.249">           self.deleteOfflineItem(item, listener);</span>
<a href="#l27.250"></a><span id="l27.250" class="difflineat">@@ -904,17 +904,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l27.251"></a><span id="l27.251">     // But this would mean the uncached provider fires on the passed</span>
<a href="#l27.252"></a><span id="l27.252">     // calIOperationListener, e.g. *before* it fires on calIObservers</span>
<a href="#l27.253"></a><span id="l27.253">     // (because that order is undefined). Firing onOperationComplete before onAddItem et al</span>
<a href="#l27.254"></a><span id="l27.254">     // would result in this facade firing onOperationComplete even though the modification</span>
<a href="#l27.255"></a><span id="l27.255">     // hasn't yet been performed on the cached calendar (which happens in onAddItem et al).</span>
<a href="#l27.256"></a><span id="l27.256">     // Result is that we currently stick to firing onOperationComplete if the cached calendar</span>
<a href="#l27.257"></a><span id="l27.257">     // has performed the modification, see below:</span>
<a href="#l27.258"></a><span id="l27.258">     let cacheListener = {</span>
<a href="#l27.259"></a><span id="l27.259" class="difflineminus">-      onGetResult: function() {},</span>
<a href="#l27.260"></a><span id="l27.260" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l27.261"></a><span id="l27.261">       onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l27.262"></a><span id="l27.262">         if (isUnavailableCode(status)) {</span>
<a href="#l27.263"></a><span id="l27.263">           // The item couldn't be deleted at the (remote) location,</span>
<a href="#l27.264"></a><span id="l27.264">           // this is like being offline. Mark the item deleted in the</span>
<a href="#l27.265"></a><span id="l27.265">           // cache instead.</span>
<a href="#l27.266"></a><span id="l27.266">           cal.LOG(</span>
<a href="#l27.267"></a><span id="l27.267">             &quot;[calCachedCalendar] Calendar &quot; +</span>
<a href="#l27.268"></a><span id="l27.268">               calendar.name +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -93,17 +93,17 @@ calCalendarManager.prototype = {</span>
<a href="#l28.4"></a><span id="l28.4">   cleanupOfflineObservers: function() {</span>
<a href="#l28.5"></a><span id="l28.5">     Services.obs.removeObserver(this, &quot;network:offline-status-changed&quot;);</span>
<a href="#l28.6"></a><span id="l28.6">   },</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8">   observe: function(aSubject, aTopic, aData) {</span>
<a href="#l28.9"></a><span id="l28.9">     switch (aTopic) {</span>
<a href="#l28.10"></a><span id="l28.10">       case &quot;timer-callback&quot;: {</span>
<a href="#l28.11"></a><span id="l28.11">         // Refresh all the calendars that can be refreshed.</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        for (let calendar of this.getCalendars({})) {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+        for (let calendar of this.getCalendars()) {</span>
<a href="#l28.14"></a><span id="l28.14">           if (!calendar.getProperty(&quot;disabled&quot;) &amp;&amp; calendar.canRefresh) {</span>
<a href="#l28.15"></a><span id="l28.15">             calendar.refresh();</span>
<a href="#l28.16"></a><span id="l28.16">           }</span>
<a href="#l28.17"></a><span id="l28.17">         }</span>
<a href="#l28.18"></a><span id="l28.18">         break;</span>
<a href="#l28.19"></a><span id="l28.19">       }</span>
<a href="#l28.20"></a><span id="l28.20">       case &quot;network:offline-status-changed&quot;: {</span>
<a href="#l28.21"></a><span id="l28.21">         for (let id in this.mCache) {</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -409,24 +409,23 @@ calCalendarManager.prototype = {</span>
<a href="#l28.23"></a><span id="l28.23">   getCalendarById: function(aId) {</span>
<a href="#l28.24"></a><span id="l28.24">     if (aId in this.mCache) {</span>
<a href="#l28.25"></a><span id="l28.25">       return this.mCache[aId];</span>
<a href="#l28.26"></a><span id="l28.26">     } else {</span>
<a href="#l28.27"></a><span id="l28.27">       return null;</span>
<a href="#l28.28"></a><span id="l28.28">     }</span>
<a href="#l28.29"></a><span id="l28.29">   },</span>
<a href="#l28.30"></a><span id="l28.30"> </span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-  getCalendars: function(count) {</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+  getCalendars: function() {</span>
<a href="#l28.33"></a><span id="l28.33">     this.assureCache();</span>
<a href="#l28.34"></a><span id="l28.34">     let calendars = [];</span>
<a href="#l28.35"></a><span id="l28.35">     for (let id in this.mCache) {</span>
<a href="#l28.36"></a><span id="l28.36">       let calendar = this.mCache[id];</span>
<a href="#l28.37"></a><span id="l28.37">       calendars.push(calendar);</span>
<a href="#l28.38"></a><span id="l28.38">     }</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">-    count.value = calendars.length;</span>
<a href="#l28.40"></a><span id="l28.40">     return calendars;</span>
<a href="#l28.41"></a><span id="l28.41">   },</span>
<a href="#l28.42"></a><span id="l28.42"> </span>
<a href="#l28.43"></a><span id="l28.43">   assureCache: function() {</span>
<a href="#l28.44"></a><span id="l28.44">     if (!this.mCache) {</span>
<a href="#l28.45"></a><span id="l28.45">       this.mCache = {};</span>
<a href="#l28.46"></a><span id="l28.46">       this.mCalObservers = {};</span>
<a href="#l28.47"></a><span id="l28.47"> </span>
<a href="#l28.48"></a><span id="l28.48" class="difflineat">@@ -869,17 +868,17 @@ var gCalendarManagerAddonListener = {</span>
<a href="#l28.49"></a><span id="l28.49">     }</span>
<a href="#l28.50"></a><span id="l28.50">   },</span>
<a href="#l28.51"></a><span id="l28.51"> </span>
<a href="#l28.52"></a><span id="l28.52">   queryUninstallProvider: function(aAddon) {</span>
<a href="#l28.53"></a><span id="l28.53">     const uri = &quot;chrome://calendar/content/calendar-providerUninstall-dialog.xul&quot;;</span>
<a href="#l28.54"></a><span id="l28.54">     const features = &quot;chrome,titlebar,resizable,modal&quot;;</span>
<a href="#l28.55"></a><span id="l28.55">     let calMgr = cal.getCalendarManager();</span>
<a href="#l28.56"></a><span id="l28.56">     let affectedCalendars = calMgr</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineminus">-      .getCalendars({})</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineplus">+      .getCalendars()</span>
<a href="#l28.59"></a><span id="l28.59">       .filter(calendar =&gt; calendar.providerID == aAddon.id);</span>
<a href="#l28.60"></a><span id="l28.60">     if (!affectedCalendars.length) {</span>
<a href="#l28.61"></a><span id="l28.61">       // If no calendars are affected, then everything is fine.</span>
<a href="#l28.62"></a><span id="l28.62">       return true;</span>
<a href="#l28.63"></a><span id="l28.63">     }</span>
<a href="#l28.64"></a><span id="l28.64"> </span>
<a href="#l28.65"></a><span id="l28.65">     let args = { shouldUninstall: false, extension: aAddon };</span>
<a href="#l28.66"></a><span id="l28.66"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -886,33 +886,33 @@ calFilter.prototype = {</span>
<a href="#l29.4"></a><span id="l29.4">     // we use a local proxy listener for the calICalendar.getItems() call, and use it</span>
<a href="#l29.5"></a><span id="l29.5">     // to handle occurrence expansion and filter the results before forwarding them to</span>
<a href="#l29.6"></a><span id="l29.6">     // the listener passed in the aListener argument.</span>
<a href="#l29.7"></a><span id="l29.7">     let self = this;</span>
<a href="#l29.8"></a><span id="l29.8">     let listener = {</span>
<a href="#l29.9"></a><span id="l29.9">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l29.10"></a><span id="l29.10">       onOperationComplete: aListener.onOperationComplete.bind(aListener),</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-      onGetResult: function(aOpCalendar, aStatus, aOpItemType, aDetail, aCount, aItems) {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+      onGetResult: function(aOpCalendar, aStatus, aOpItemType, aDetail, aItems) {</span>
<a href="#l29.14"></a><span id="l29.14">         let items;</span>
<a href="#l29.15"></a><span id="l29.15">         if (props.occurrences == props.FILTER_OCCURRENCES_PAST_AND_NEXT) {</span>
<a href="#l29.16"></a><span id="l29.16">           // with the FILTER_OCCURRENCES_PAST_AND_NEXT occurrence filter we will</span>
<a href="#l29.17"></a><span id="l29.17">           // get parent items returned here, so we need to let the getOccurrences</span>
<a href="#l29.18"></a><span id="l29.18">           // function handle occurrence expansion.</span>
<a href="#l29.19"></a><span id="l29.19">           items = [];</span>
<a href="#l29.20"></a><span id="l29.20">           for (let item of aItems) {</span>
<a href="#l29.21"></a><span id="l29.21">             items = items.concat(self.getOccurrences(item));</span>
<a href="#l29.22"></a><span id="l29.22">           }</span>
<a href="#l29.23"></a><span id="l29.23">         } else {</span>
<a href="#l29.24"></a><span id="l29.24">           // with other occurrence filters the calICalendar.getItems() function will</span>
<a href="#l29.25"></a><span id="l29.25">           // return expanded occurrences appropriately, we only need to filter them.</span>
<a href="#l29.26"></a><span id="l29.26">           items = self.filterItems(aItems);</span>
<a href="#l29.27"></a><span id="l29.27">         }</span>
<a href="#l29.28"></a><span id="l29.28"> </span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">-        aListener.onGetResult(aOpCalendar, aStatus, aOpItemType, aDetail, items.length, items);</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+        aListener.onGetResult(aOpCalendar, aStatus, aOpItemType, aDetail, items);</span>
<a href="#l29.31"></a><span id="l29.31">       },</span>
<a href="#l29.32"></a><span id="l29.32">     };</span>
<a href="#l29.33"></a><span id="l29.33"> </span>
<a href="#l29.34"></a><span id="l29.34">     // build the filter argument for calICalendar.getItems() from the filter properties</span>
<a href="#l29.35"></a><span id="l29.35">     let filter = aItemType || aCalendar.FILTER_TYPE_ALL;</span>
<a href="#l29.36"></a><span id="l29.36">     if (</span>
<a href="#l29.37"></a><span id="l29.37">       !props.status ||</span>
<a href="#l29.38"></a><span id="l29.38">       props.status &amp; (props.FILTER_STATUS_COMPLETED_TODAY | props.FILTER_STATUS_COMPLETED_BEFORE)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/src/calTransactionManager.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/src/calTransactionManager.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -113,19 +113,19 @@ calTransaction.prototype = {</span>
<a href="#l30.4"></a><span id="l30.4">         }</span>
<a href="#l30.5"></a><span id="l30.5">       }</span>
<a href="#l30.6"></a><span id="l30.6">     }</span>
<a href="#l30.7"></a><span id="l30.7">     if (this.mListener) {</span>
<a href="#l30.8"></a><span id="l30.8">       this.mListener.onOperationComplete(aCalendar, aStatus, aOperationType, aId, aDetail);</span>
<a href="#l30.9"></a><span id="l30.9">     }</span>
<a href="#l30.10"></a><span id="l30.10">   },</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+  onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l30.14"></a><span id="l30.14">     if (this.mListener) {</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineminus">-      this.mListener.onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems);</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+      this.mListener.onGetResult(aCalendar, aStatus, aItemType, aDetail, aItems);</span>
<a href="#l30.17"></a><span id="l30.17">     }</span>
<a href="#l30.18"></a><span id="l30.18">   },</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20">   doTransaction: function() {</span>
<a href="#l30.21"></a><span id="l30.21">     this.mIsDoTransaction = true;</span>
<a href="#l30.22"></a><span id="l30.22">     switch (this.mAction) {</span>
<a href="#l30.23"></a><span id="l30.23">       case &quot;add&quot;:</span>
<a href="#l30.24"></a><span id="l30.24">         this.mCalendar.addItem(this.mItem, this);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -94,15 +94,15 @@ ItipContentHandler.prototype = {</span>
<a href="#l31.4"></a><span id="l31.4">         event.title +</span>
<a href="#l31.5"></a><span id="l31.5">         &quot;' from &quot; +</span>
<a href="#l31.6"></a><span id="l31.6">         event.organizer.id +</span>
<a href="#l31.7"></a><span id="l31.7">         &quot; (&quot; +</span>
<a href="#l31.8"></a><span id="l31.8">         event.id +</span>
<a href="#l31.9"></a><span id="l31.9">         &quot;)\n&quot;</span>
<a href="#l31.10"></a><span id="l31.10">     );</span>
<a href="#l31.11"></a><span id="l31.11">     let calMgr = cal.getCalendarManager();</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    let cals = calMgr.getCalendars({});</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+    let cals = calMgr.getCalendars();</span>
<a href="#l31.14"></a><span id="l31.14">     cals[0].addItem(event, null);</span>
<a href="#l31.15"></a><span id="l31.15">   },</span>
<a href="#l31.16"></a><span id="l31.16"> };</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18"> var components = [ItipChannel, ItipProtocolHandler, ItipContentHandler];</span>
<a href="#l31.19"></a><span id="l31.19"> this.NSGetFactory = XPCOMUtils.generateNSGetFactory(components);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/lightning/content/imip-bar.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/lightning/content/imip-bar.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -398,17 +398,17 @@ var ltnImipBar = {</span>
<a href="#l32.4"></a><span id="l32.4">             // For now, we just state the status for the user something very simple</span>
<a href="#l32.5"></a><span id="l32.5">             let label = cal.itip.getCompleteText(aStatus, aOperationType);</span>
<a href="#l32.6"></a><span id="l32.6">             imipBar.label = label;</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8">             if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l32.9"></a><span id="l32.9">               cal.showError(label);</span>
<a href="#l32.10"></a><span id="l32.10">             }</span>
<a href="#l32.11"></a><span id="l32.11">           },</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-          onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {},</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+          onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l32.14"></a><span id="l32.14">         };</span>
<a href="#l32.15"></a><span id="l32.15"> </span>
<a href="#l32.16"></a><span id="l32.16">         try {</span>
<a href="#l32.17"></a><span id="l32.17">           aActionFunc(opListener, aParticipantStatus, aExtResponse);</span>
<a href="#l32.18"></a><span id="l32.18">         } catch (exc) {</span>
<a href="#l32.19"></a><span id="l32.19">           Cu.reportError(exc);</span>
<a href="#l32.20"></a><span id="l32.20">         }</span>
<a href="#l32.21"></a><span id="l32.21">         return true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -621,17 +621,17 @@ function loadDialog(aItem) {</span>
<a href="#l33.4"></a><span id="l33.4">   } else {</span>
<a href="#l33.5"></a><span id="l33.5">     setElementValue(&quot;item-title&quot;, aItem.title);</span>
<a href="#l33.6"></a><span id="l33.6">     setElementValue(&quot;item-location&quot;, aItem.getProperty(&quot;LOCATION&quot;));</span>
<a href="#l33.7"></a><span id="l33.7">   }</span>
<a href="#l33.8"></a><span id="l33.8"> </span>
<a href="#l33.9"></a><span id="l33.9">   // add calendars to the calendar menulist</span>
<a href="#l33.10"></a><span id="l33.10">   if (gNewItemUI) {</span>
<a href="#l33.11"></a><span id="l33.11">     let calendarToUse = aItem.calendar || window.arguments[0].calendar;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    let unfilteredList = sortCalendarArray(cal.getCalendarManager().getCalendars({}));</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+    let unfilteredList = sortCalendarArray(cal.getCalendarManager().getCalendars());</span>
<a href="#l33.14"></a><span id="l33.14"> </span>
<a href="#l33.15"></a><span id="l33.15">     // filter out calendars that should not be included</span>
<a href="#l33.16"></a><span id="l33.16">     let calendarList = unfilteredList.filter(</span>
<a href="#l33.17"></a><span id="l33.17">       calendar =&gt;</span>
<a href="#l33.18"></a><span id="l33.18">         calendar.id == calendarToUse.id ||</span>
<a href="#l33.19"></a><span id="l33.19">         (calendar &amp;&amp;</span>
<a href="#l33.20"></a><span id="l33.20">           cal.acl.isCalendarWritable(calendar) &amp;&amp;</span>
<a href="#l33.21"></a><span id="l33.21">           (cal.acl.userCanAddItemsToCalendar(calendar) ||</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -3264,17 +3264,17 @@ function onCommandSave(aIsClosing) {</span>
<a href="#l33.23"></a><span id="l33.23">           eventDialogCalendarObserver.observe(window.calendarItem.calendar);</span>
<a href="#l33.24"></a><span id="l33.24">         }</span>
<a href="#l33.25"></a><span id="l33.25">       }</span>
<a href="#l33.26"></a><span id="l33.26">       // this triggers the update of the imipbar in case this is a rescheduling case</span>
<a href="#l33.27"></a><span id="l33.27">       if (window.counterProposal &amp;&amp; window.counterProposal.onReschedule) {</span>
<a href="#l33.28"></a><span id="l33.28">         window.counterProposal.onReschedule();</span>
<a href="#l33.29"></a><span id="l33.29">       }</span>
<a href="#l33.30"></a><span id="l33.30">     },</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-    onGetResult: function() {},</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+    onGetResult: function(calendarItem, status, itemType, detail, items) {},</span>
<a href="#l33.33"></a><span id="l33.33">   };</span>
<a href="#l33.34"></a><span id="l33.34">   let resp = document.getElementById(&quot;notify-attendees-checkbox&quot;).checked</span>
<a href="#l33.35"></a><span id="l33.35">     ? Ci.calIItipItem.AUTO</span>
<a href="#l33.36"></a><span id="l33.36">     : Ci.calIItipItem.NONE;</span>
<a href="#l33.37"></a><span id="l33.37">   let extResponse = { responseMode: resp };</span>
<a href="#l33.38"></a><span id="l33.38">   window.onAcceptCallback(item, calendar, originalItem, listener, extResponse);</span>
<a href="#l33.39"></a><span id="l33.39"> }</span>
<a href="#l33.40"></a><span id="l33.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -580,19 +580,19 @@ var gInvitationsOperationListener = {</span>
<a href="#l34.4"></a><span id="l34.4">       document.getElementById(&quot;calendar-invitations-label&quot;).value = value;</span>
<a href="#l34.5"></a><span id="l34.5">       setElementValue(invitationsBox, this.mCount &lt; 1 &amp;&amp; &quot;true&quot;, &quot;hidden&quot;);</span>
<a href="#l34.6"></a><span id="l34.6">     } else {</span>
<a href="#l34.7"></a><span id="l34.7">       invitationsBox.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l34.8"></a><span id="l34.8">     }</span>
<a href="#l34.9"></a><span id="l34.9">     this.mCount = 0;</span>
<a href="#l34.10"></a><span id="l34.10">   },</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l34.14"></a><span id="l34.14">     if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineminus">-      this.mCount += aCount;</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+      this.mCount += aItems.length;</span>
<a href="#l34.17"></a><span id="l34.17">     }</span>
<a href="#l34.18"></a><span id="l34.18">   },</span>
<a href="#l34.19"></a><span id="l34.19"> };</span>
<a href="#l34.20"></a><span id="l34.20"> </span>
<a href="#l34.21"></a><span id="l34.21"> var gInvitationsCalendarManagerObserver = {</span>
<a href="#l34.22"></a><span id="l34.22">   mSideBar: this,</span>
<a href="#l34.23"></a><span id="l34.23"> </span>
<a href="#l34.24"></a><span id="l34.24">   QueryInterface: ChromeUtils.generateQI([Ci.calICalendarManagerObserver]),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -261,17 +261,17 @@ calDavCalendar.prototype = {</span>
<a href="#l35.4"></a><span id="l35.4">    * Ensure that cached items have associated meta data, otherwise server side</span>
<a href="#l35.5"></a><span id="l35.5">    * changes may not be reflected</span>
<a href="#l35.6"></a><span id="l35.6">    */</span>
<a href="#l35.7"></a><span id="l35.7">   ensureMetaData: function() {</span>
<a href="#l35.8"></a><span id="l35.8">     let self = this;</span>
<a href="#l35.9"></a><span id="l35.9">     let refreshNeeded = false;</span>
<a href="#l35.10"></a><span id="l35.10">     let getMetaListener = {</span>
<a href="#l35.11"></a><span id="l35.11">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l35.14"></a><span id="l35.14">         for (let item of aItems) {</span>
<a href="#l35.15"></a><span id="l35.15">           if (!(item.id in self.mItemInfoCache)) {</span>
<a href="#l35.16"></a><span id="l35.16">             let path = self.getItemLocationPath(item);</span>
<a href="#l35.17"></a><span id="l35.17">             cal.LOG(&quot;Adding meta-data for cached item &quot; + item.id);</span>
<a href="#l35.18"></a><span id="l35.18">             self.mItemInfoCache[item.id] = {</span>
<a href="#l35.19"></a><span id="l35.19">               etag: null,</span>
<a href="#l35.20"></a><span id="l35.20">               isNew: false,</span>
<a href="#l35.21"></a><span id="l35.21">               locationPath: path,</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -1387,17 +1387,17 @@ calDavCalendar.prototype = {</span>
<a href="#l35.23"></a><span id="l35.23">         aChangeLogListener.onResult({ status: status }, status);</span>
<a href="#l35.24"></a><span id="l35.24">       }</span>
<a href="#l35.25"></a><span id="l35.25">     };</span>
<a href="#l35.26"></a><span id="l35.26"> </span>
<a href="#l35.27"></a><span id="l35.27">     if (!this.mACLEntry) {</span>
<a href="#l35.28"></a><span id="l35.28">       let self = this;</span>
<a href="#l35.29"></a><span id="l35.29">       let opListener = {</span>
<a href="#l35.30"></a><span id="l35.30">         QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-        onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+        onGetResult: function(calendar, status, itemType, detail, items) {</span>
<a href="#l35.33"></a><span id="l35.33">           cal.ASSERT(false, &quot;unexpected!&quot;);</span>
<a href="#l35.34"></a><span id="l35.34">         },</span>
<a href="#l35.35"></a><span id="l35.35">         onOperationComplete: function(opCalendar, opStatus, opType, opId, opDetail) {</span>
<a href="#l35.36"></a><span id="l35.36">           self.mACLEntry = opDetail;</span>
<a href="#l35.37"></a><span id="l35.37">           self.fillACLProperties();</span>
<a href="#l35.38"></a><span id="l35.38">           self.safeRefresh(aChangeLogListener);</span>
<a href="#l35.39"></a><span id="l35.39">         },</span>
<a href="#l35.40"></a><span id="l35.40">       };</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineat">@@ -1531,17 +1531,17 @@ calDavCalendar.prototype = {</span>
<a href="#l35.42"></a><span id="l35.42">     );</span>
<a href="#l35.43"></a><span id="l35.43">   },</span>
<a href="#l35.44"></a><span id="l35.44"> </span>
<a href="#l35.45"></a><span id="l35.45">   refresh: function() {</span>
<a href="#l35.46"></a><span id="l35.46">     this.replayChangesOn(null);</span>
<a href="#l35.47"></a><span id="l35.47">   },</span>
<a href="#l35.48"></a><span id="l35.48"> </span>
<a href="#l35.49"></a><span id="l35.49">   firstInRealm: function() {</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineminus">-    let calendars = cal.getCalendarManager().getCalendars({});</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineplus">+    let calendars = cal.getCalendarManager().getCalendars();</span>
<a href="#l35.52"></a><span id="l35.52">     for (let i = 0; i &lt; calendars.length; i++) {</span>
<a href="#l35.53"></a><span id="l35.53">       if (calendars[i].type != &quot;caldav&quot; || calendars[i].getProperty(&quot;disabled&quot;)) {</span>
<a href="#l35.54"></a><span id="l35.54">         continue;</span>
<a href="#l35.55"></a><span id="l35.55">       }</span>
<a href="#l35.56"></a><span id="l35.56">       // XXX We should probably expose the inner calendar via an</span>
<a href="#l35.57"></a><span id="l35.57">       // interface, but for now use wrappedJSObject.</span>
<a href="#l35.58"></a><span id="l35.58">       let calendar = calendars[i].wrappedJSObject;</span>
<a href="#l35.59"></a><span id="l35.59">       if (calendar.mUncachedCalendar) {</span>
<a href="#l35.60"></a><span id="l35.60" class="difflineat">@@ -2863,17 +2863,17 @@ calDavCalendar.prototype = {</span>
<a href="#l35.61"></a><span id="l35.61">     getItemListener.QueryInterface = ChromeUtils.generateQI([Ci.calIOperationListener]);</span>
<a href="#l35.62"></a><span id="l35.62">     getItemListener.onOperationComplete = function(</span>
<a href="#l35.63"></a><span id="l35.63">       aCalendar,</span>
<a href="#l35.64"></a><span id="l35.64">       aStatus,</span>
<a href="#l35.65"></a><span id="l35.65">       aOperationType,</span>
<a href="#l35.66"></a><span id="l35.66">       aId,</span>
<a href="#l35.67"></a><span id="l35.67">       aDetail</span>
<a href="#l35.68"></a><span id="l35.68">     ) {};</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineminus">-    getItemListener.onGetResult = function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineplus">+    getItemListener.onGetResult = function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l35.71"></a><span id="l35.71">       let itemToUpdate = aItems[0];</span>
<a href="#l35.72"></a><span id="l35.72">       if (aItem.recurrenceId &amp;&amp; itemToUpdate.recurrenceInfo) {</span>
<a href="#l35.73"></a><span id="l35.73">         itemToUpdate = itemToUpdate.recurrenceInfo.getOccurrenceFor(aItem.recurrenceId);</span>
<a href="#l35.74"></a><span id="l35.74">       }</span>
<a href="#l35.75"></a><span id="l35.75">       let newItem = itemToUpdate.clone();</span>
<a href="#l35.76"></a><span id="l35.76"> </span>
<a href="#l35.77"></a><span id="l35.77">       for (let attendee of aItem.getAttendees()) {</span>
<a href="#l35.78"></a><span id="l35.78">         let att = newItem.getAttendeeById(attendee.id);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -129,17 +129,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l36.4"></a><span id="l36.4">       for (let calendar of this.mCalendars) {</span>
<a href="#l36.5"></a><span id="l36.5">         this.removeCalendar(calendar);</span>
<a href="#l36.6"></a><span id="l36.6">       }</span>
<a href="#l36.7"></a><span id="l36.7">     }</span>
<a href="#l36.8"></a><span id="l36.8">     this.mPrefPrefix = aPrefPrefix;</span>
<a href="#l36.9"></a><span id="l36.9">     this.mActivePref = aPrefPrefix + &quot;-in-composite&quot;;</span>
<a href="#l36.10"></a><span id="l36.10">     this.mDefaultPref = aPrefPrefix + &quot;-default&quot;;</span>
<a href="#l36.11"></a><span id="l36.11">     let mgr = cal.getCalendarManager();</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-    let cals = mgr.getCalendars({});</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+    let cals = mgr.getCalendars();</span>
<a href="#l36.14"></a><span id="l36.14"> </span>
<a href="#l36.15"></a><span id="l36.15">     cals.forEach(function(calendar) {</span>
<a href="#l36.16"></a><span id="l36.16">       if (calendar.getProperty(this.mActivePref)) {</span>
<a href="#l36.17"></a><span id="l36.17">         this.addCalendar(calendar);</span>
<a href="#l36.18"></a><span id="l36.18">       }</span>
<a href="#l36.19"></a><span id="l36.19">       if (calendar.getProperty(this.mDefaultPref)) {</span>
<a href="#l36.20"></a><span id="l36.20">         this.setDefaultCalendar(calendar, false);</span>
<a href="#l36.21"></a><span id="l36.21">       }</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineat">@@ -191,18 +191,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l36.23"></a><span id="l36.23">     for (let calendar of this.mCalendars) {</span>
<a href="#l36.24"></a><span id="l36.24">       if (calendar.id == aId) {</span>
<a href="#l36.25"></a><span id="l36.25">         return calendar;</span>
<a href="#l36.26"></a><span id="l36.26">       }</span>
<a href="#l36.27"></a><span id="l36.27">     }</span>
<a href="#l36.28"></a><span id="l36.28">     return null;</span>
<a href="#l36.29"></a><span id="l36.29">   },</span>
<a href="#l36.30"></a><span id="l36.30"> </span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-  getCalendars: function(count) {</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineminus">-    count.value = this.mCalendars.length;</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineplus">+  getCalendars: function() {</span>
<a href="#l36.34"></a><span id="l36.34">     return this.mCalendars;</span>
<a href="#l36.35"></a><span id="l36.35">   },</span>
<a href="#l36.36"></a><span id="l36.36"> </span>
<a href="#l36.37"></a><span id="l36.37">   get defaultCalendar() {</span>
<a href="#l36.38"></a><span id="l36.38">     return this.mDefaultCalendar;</span>
<a href="#l36.39"></a><span id="l36.39">   },</span>
<a href="#l36.40"></a><span id="l36.40"> </span>
<a href="#l36.41"></a><span id="l36.41">   setDefaultCalendar: function(calendar, usePref) {</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineat">@@ -479,56 +478,58 @@ calCompositeGetListenerHelper.prototype </span>
<a href="#l36.43"></a><span id="l36.43">     }</span>
<a href="#l36.44"></a><span id="l36.44">     if (this.mCompositeCalendar.statusDisplayed) {</span>
<a href="#l36.45"></a><span id="l36.45">       this.mCompositeCalendar.mStatusObserver.calendarCompleted(aCalendar);</span>
<a href="#l36.46"></a><span id="l36.46">     }</span>
<a href="#l36.47"></a><span id="l36.47">     if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l36.48"></a><span id="l36.48">       // proxy this to a onGetResult</span>
<a href="#l36.49"></a><span id="l36.49">       // XXX - do we want to give the real calendar? or this?</span>
<a href="#l36.50"></a><span id="l36.50">       // XXX - get rid of iid param</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineminus">-      this.mRealListener.onGetResult(aCalendar, aStatus, Ci.nsISupports, aDetail, 0, []);</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineplus">+      this.mRealListener.onGetResult(aCalendar, aStatus, Ci.nsISupports, aDetail, []);</span>
<a href="#l36.53"></a><span id="l36.53">     }</span>
<a href="#l36.54"></a><span id="l36.54"> </span>
<a href="#l36.55"></a><span id="l36.55">     this.mReceivedCompletes++;</span>
<a href="#l36.56"></a><span id="l36.56">     if (this.mReceivedCompletes == this.mNumQueries) {</span>
<a href="#l36.57"></a><span id="l36.57">       if (this.mCompositeCalendar.statusDisplayed) {</span>
<a href="#l36.58"></a><span id="l36.58">         this.mCompositeCalendar.mStatusObserver.stopMeteors();</span>
<a href="#l36.59"></a><span id="l36.59">       }</span>
<a href="#l36.60"></a><span id="l36.60">       // we're done here.</span>
<a href="#l36.61"></a><span id="l36.61">       this.mFinished = true;</span>
<a href="#l36.62"></a><span id="l36.62">       this.opGroup.notifyCompleted();</span>
<a href="#l36.63"></a><span id="l36.63">       this.mRealListener.onOperationComplete(this, aStatus, calIOperationListener.GET, null, null);</span>
<a href="#l36.64"></a><span id="l36.64">     }</span>
<a href="#l36.65"></a><span id="l36.65">   },</span>
<a href="#l36.66"></a><span id="l36.66"> </span>
<a href="#l36.67"></a><span id="l36.67" class="difflineminus">-  onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l36.68"></a><span id="l36.68" class="difflineplus">+  onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l36.69"></a><span id="l36.69">     if (!this.mRealListener) {</span>
<a href="#l36.70"></a><span id="l36.70">       // has been cancelled, ignore any providers firing on this...</span>
<a href="#l36.71"></a><span id="l36.71">       return;</span>
<a href="#l36.72"></a><span id="l36.72">     }</span>
<a href="#l36.73"></a><span id="l36.73">     if (this.mFinished) {</span>
<a href="#l36.74"></a><span id="l36.74">       dump(&quot;+++ calCompositeGetListenerHelper.onGetResult: called with mFinished == true!&quot;);</span>
<a href="#l36.75"></a><span id="l36.75">       return;</span>
<a href="#l36.76"></a><span id="l36.76">     }</span>
<a href="#l36.77"></a><span id="l36.77"> </span>
<a href="#l36.78"></a><span id="l36.78">     // ignore if we have a max and we're past it</span>
<a href="#l36.79"></a><span id="l36.79">     if (this.mMaxItems &amp;&amp; this.mItemsReceived &gt;= this.mMaxItems) {</span>
<a href="#l36.80"></a><span id="l36.80">       return;</span>
<a href="#l36.81"></a><span id="l36.81">     }</span>
<a href="#l36.82"></a><span id="l36.82"> </span>
<a href="#l36.83"></a><span id="l36.83" class="difflineplus">+    let itemsCount = aItems.length;</span>
<a href="#l36.84"></a><span id="l36.84" class="difflineplus">+</span>
<a href="#l36.85"></a><span id="l36.85">     if (</span>
<a href="#l36.86"></a><span id="l36.86">       Components.isSuccessCode(aStatus) &amp;&amp;</span>
<a href="#l36.87"></a><span id="l36.87">       this.mMaxItems &amp;&amp;</span>
<a href="#l36.88"></a><span id="l36.88" class="difflineminus">-      this.mItemsReceived + aCount &gt; this.mMaxItems</span>
<a href="#l36.89"></a><span id="l36.89" class="difflineplus">+      this.mItemsReceived + itemsCount &gt; this.mMaxItems</span>
<a href="#l36.90"></a><span id="l36.90">     ) {</span>
<a href="#l36.91"></a><span id="l36.91">       // this will blow past the limit</span>
<a href="#l36.92"></a><span id="l36.92" class="difflineminus">-      aCount = this.mMaxItems - this.mItemsReceived;</span>
<a href="#l36.93"></a><span id="l36.93" class="difflineminus">-      aItems = aItems.slice(0, aCount);</span>
<a href="#l36.94"></a><span id="l36.94" class="difflineplus">+      itemsCount = this.mMaxItems - this.mItemsReceived;</span>
<a href="#l36.95"></a><span id="l36.95" class="difflineplus">+      aItems = aItems.slice(0, itemsCount);</span>
<a href="#l36.96"></a><span id="l36.96">     }</span>
<a href="#l36.97"></a><span id="l36.97"> </span>
<a href="#l36.98"></a><span id="l36.98">     // send GetResults to the real listener</span>
<a href="#l36.99"></a><span id="l36.99" class="difflineminus">-    this.mRealListener.onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems);</span>
<a href="#l36.100"></a><span id="l36.100" class="difflineminus">-    this.mItemsReceived += aCount;</span>
<a href="#l36.101"></a><span id="l36.101" class="difflineplus">+    this.mRealListener.onGetResult(aCalendar, aStatus, aItemType, aDetail, aItems);</span>
<a href="#l36.102"></a><span id="l36.102" class="difflineplus">+    this.mItemsReceived += itemsCount;</span>
<a href="#l36.103"></a><span id="l36.103">   },</span>
<a href="#l36.104"></a><span id="l36.104"> };</span>
<a href="#l36.105"></a><span id="l36.105"> </span>
<a href="#l36.106"></a><span id="l36.106"> /** Module Registration */</span>
<a href="#l36.107"></a><span id="l36.107"> this.NSGetFactory = XPCOMUtils.generateNSGetFactory([calCompositeCalendar]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -361,18 +361,18 @@ calICSCalendar.prototype = {</span>
<a href="#l37.4"></a><span id="l37.4">             ex.result,</span>
<a href="#l37.5"></a><span id="l37.5">             &quot;The calendar could not be saved; there was a failure: 0x&quot; + ex.result.toString(16)</span>
<a href="#l37.6"></a><span id="l37.6">           );</span>
<a href="#l37.7"></a><span id="l37.7">           self.mObserver.onError(self.superCalendar, calIErrors.MODIFICATION_FAILED, &quot;&quot;);</span>
<a href="#l37.8"></a><span id="l37.8">           self.unlock(calIErrors.MODIFICATION_FAILED);</span>
<a href="#l37.9"></a><span id="l37.9">           self.forceRefresh();</span>
<a href="#l37.10"></a><span id="l37.10">         }</span>
<a href="#l37.11"></a><span id="l37.11">       },</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-        this.serializer.addItems(aItems, aCount);</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineplus">+      onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+        this.serializer.addItems(aItems, aItems.length);</span>
<a href="#l37.16"></a><span id="l37.16">       },</span>
<a href="#l37.17"></a><span id="l37.17">     };</span>
<a href="#l37.18"></a><span id="l37.18">     listener.serializer = Cc[&quot;@mozilla.org/calendar/ics-serializer;1&quot;].createInstance(</span>
<a href="#l37.19"></a><span id="l37.19">       Ci.calIIcsSerializer</span>
<a href="#l37.20"></a><span id="l37.20">     );</span>
<a href="#l37.21"></a><span id="l37.21">     for (let comp of this.unmappedComponents) {</span>
<a href="#l37.22"></a><span id="l37.22">       listener.serializer.addComponent(comp);</span>
<a href="#l37.23"></a><span id="l37.23">     }</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineat">@@ -524,17 +524,17 @@ calICSCalendar.prototype = {</span>
<a href="#l37.25"></a><span id="l37.25">       return;</span>
<a href="#l37.26"></a><span id="l37.26">     }</span>
<a href="#l37.27"></a><span id="l37.27"> </span>
<a href="#l37.28"></a><span id="l37.28">     function modListener(action) {</span>
<a href="#l37.29"></a><span id="l37.29">       this.mAction = action;</span>
<a href="#l37.30"></a><span id="l37.30">     }</span>
<a href="#l37.31"></a><span id="l37.31">     modListener.prototype = {</span>
<a href="#l37.32"></a><span id="l37.32">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l37.33"></a><span id="l37.33" class="difflineminus">-      onGetResult: function() {},</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l37.35"></a><span id="l37.35">       onOperationComplete: function() {</span>
<a href="#l37.36"></a><span id="l37.36">         this.mAction.opCompleteArgs = arguments;</span>
<a href="#l37.37"></a><span id="l37.37">       },</span>
<a href="#l37.38"></a><span id="l37.38">     };</span>
<a href="#l37.39"></a><span id="l37.39"> </span>
<a href="#l37.40"></a><span id="l37.40">     let a;</span>
<a href="#l37.41"></a><span id="l37.41">     let writeICS = false;</span>
<a href="#l37.42"></a><span id="l37.42">     let refreshAction = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -352,17 +352,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l38.4"></a><span id="l38.4">         Cr.NS_ERROR_FAILURE,</span>
<a href="#l38.5"></a><span id="l38.5">         Ci.calIOperationListener.GET,</span>
<a href="#l38.6"></a><span id="l38.6">         aId,</span>
<a href="#l38.7"></a><span id="l38.7">         &quot;Can't deduce item type based on QI&quot;</span>
<a href="#l38.8"></a><span id="l38.8">       );</span>
<a href="#l38.9"></a><span id="l38.9">       return;</span>
<a href="#l38.10"></a><span id="l38.10">     }</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    aListener.onGetResult(this.superCalendar, Cr.NS_OK, iid, null, 1, [item]);</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+    aListener.onGetResult(this.superCalendar, Cr.NS_OK, iid, null, [item]);</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15">     this.notifyOperationComplete(aListener, Cr.NS_OK, Ci.calIOperationListener.GET, aId, null);</span>
<a href="#l38.16"></a><span id="l38.16">   },</span>
<a href="#l38.17"></a><span id="l38.17"> </span>
<a href="#l38.18"></a><span id="l38.18">   // void getItems( in unsigned long aItemFilter, in unsigned long aCount,</span>
<a href="#l38.19"></a><span id="l38.19">   //                in calIDateTime aRangeStart, in calIDateTime aRangeEnd,</span>
<a href="#l38.20"></a><span id="l38.20">   //                in calIOperationListener aListener );</span>
<a href="#l38.21"></a><span id="l38.21">   getItems: function(aItemFilter, aCount, aRangeStart, aRangeEnd, aListener) {</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineat">@@ -510,24 +510,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l38.23"></a><span id="l38.23">           itemsFound.push(item);</span>
<a href="#l38.24"></a><span id="l38.24">         }</span>
<a href="#l38.25"></a><span id="l38.25">         if (aCount &amp;&amp; itemsFound.length &gt;= aCount) {</span>
<a href="#l38.26"></a><span id="l38.26">           return cal.iterate.forEach.BREAK;</span>
<a href="#l38.27"></a><span id="l38.27">         }</span>
<a href="#l38.28"></a><span id="l38.28">         return cal.iterate.forEach.CONTINUE;</span>
<a href="#l38.29"></a><span id="l38.29">       },</span>
<a href="#l38.30"></a><span id="l38.30">       () =&gt; {</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-        aListener.onGetResult(</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineminus">-          this.superCalendar,</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineminus">-          Cr.NS_OK,</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineminus">-          typeIID,</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">-          null,</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineminus">-          itemsFound.length,</span>
<a href="#l38.37"></a><span id="l38.37" class="difflineminus">-          itemsFound</span>
<a href="#l38.38"></a><span id="l38.38" class="difflineminus">-        );</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineplus">+        aListener.onGetResult(this.superCalendar, Cr.NS_OK, typeIID, null, itemsFound);</span>
<a href="#l38.40"></a><span id="l38.40">         this.notifyOperationComplete(aListener, Cr.NS_OK, Ci.calIOperationListener.GET, null, null);</span>
<a href="#l38.41"></a><span id="l38.41">       }</span>
<a href="#l38.42"></a><span id="l38.42">     );</span>
<a href="#l38.43"></a><span id="l38.43">   },</span>
<a href="#l38.44"></a><span id="l38.44"> </span>
<a href="#l38.45"></a><span id="l38.45">   //</span>
<a href="#l38.46"></a><span id="l38.46">   // calIOfflineStorage interface</span>
<a href="#l38.47"></a><span id="l38.47">   //</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -561,17 +561,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l39.4"></a><span id="l39.4">         Cr.NS_ERROR_FAILURE,</span>
<a href="#l39.5"></a><span id="l39.5">         Ci.calIOperationListener.GET,</span>
<a href="#l39.6"></a><span id="l39.6">         aId,</span>
<a href="#l39.7"></a><span id="l39.7">         &quot;Can't deduce item type based on QI&quot;</span>
<a href="#l39.8"></a><span id="l39.8">       );</span>
<a href="#l39.9"></a><span id="l39.9">       return;</span>
<a href="#l39.10"></a><span id="l39.10">     }</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-    aListener.onGetResult(this.superCalendar, Cr.NS_OK, item_iid, null, 1, [item]);</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+    aListener.onGetResult(this.superCalendar, Cr.NS_OK, item_iid, null, [item]);</span>
<a href="#l39.14"></a><span id="l39.14"> </span>
<a href="#l39.15"></a><span id="l39.15">     this.notifyOperationComplete(aListener, Cr.NS_OK, Ci.calIOperationListener.GET, aId, null);</span>
<a href="#l39.16"></a><span id="l39.16">   },</span>
<a href="#l39.17"></a><span id="l39.17"> </span>
<a href="#l39.18"></a><span id="l39.18">   // void getItems( in unsigned long aItemFilter, in unsigned long aCount,</span>
<a href="#l39.19"></a><span id="l39.19">   //                in calIDateTime aRangeStart, in calIDateTime aRangeEnd,</span>
<a href="#l39.20"></a><span id="l39.20">   //                in calIOperationListener aListener );</span>
<a href="#l39.21"></a><span id="l39.21">   getItems: async function(aItemFilter, aCount, aRangeStart, aRangeEnd, aListener) {</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineat">@@ -652,24 +652,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l39.23"></a><span id="l39.23">         queuedItemsIID = theIID;</span>
<a href="#l39.24"></a><span id="l39.24">       }</span>
<a href="#l39.25"></a><span id="l39.25"> </span>
<a href="#l39.26"></a><span id="l39.26">       if (theItems) {</span>
<a href="#l39.27"></a><span id="l39.27">         queuedItems = queuedItems.concat(theItems);</span>
<a href="#l39.28"></a><span id="l39.28">       }</span>
<a href="#l39.29"></a><span id="l39.29"> </span>
<a href="#l39.30"></a><span id="l39.30">       if (queuedItems.length != 0 &amp;&amp; (!theItems || queuedItems.length &gt; maxQueueSize)) {</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-        aListener.onGetResult(</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineminus">-          self.superCalendar,</span>
<a href="#l39.33"></a><span id="l39.33" class="difflineminus">-          Cr.NS_OK,</span>
<a href="#l39.34"></a><span id="l39.34" class="difflineminus">-          queuedItemsIID,</span>
<a href="#l39.35"></a><span id="l39.35" class="difflineminus">-          null,</span>
<a href="#l39.36"></a><span id="l39.36" class="difflineminus">-          queuedItems.length,</span>
<a href="#l39.37"></a><span id="l39.37" class="difflineminus">-          queuedItems</span>
<a href="#l39.38"></a><span id="l39.38" class="difflineminus">-        );</span>
<a href="#l39.39"></a><span id="l39.39" class="difflineplus">+        aListener.onGetResult(self.superCalendar, Cr.NS_OK, queuedItemsIID, null, queuedItems);</span>
<a href="#l39.40"></a><span id="l39.40">         queuedItems = [];</span>
<a href="#l39.41"></a><span id="l39.41">       }</span>
<a href="#l39.42"></a><span id="l39.42">     }</span>
<a href="#l39.43"></a><span id="l39.43"> </span>
<a href="#l39.44"></a><span id="l39.44">     // helper function to handle converting a row to an item,</span>
<a href="#l39.45"></a><span id="l39.45">     // expanding occurrences, and queue the items for the listener</span>
<a href="#l39.46"></a><span id="l39.46">     function handleResultItem(item, theIID, optionalFilterFunc) {</span>
<a href="#l39.47"></a><span id="l39.47">       let expandedItems = [];</span>
<a href="#l39.48"></a><span id="l39.48" class="difflineat">@@ -897,17 +890,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l39.49"></a><span id="l39.49">       aItem</span>
<a href="#l39.50"></a><span id="l39.50">     );</span>
<a href="#l39.51"></a><span id="l39.51">   },</span>
<a href="#l39.52"></a><span id="l39.52"> </span>
<a href="#l39.53"></a><span id="l39.53">   modifyOfflineItem: function(aItem, aListener) {</span>
<a href="#l39.54"></a><span id="l39.54">     let self = this;</span>
<a href="#l39.55"></a><span id="l39.55">     let opListener = {</span>
<a href="#l39.56"></a><span id="l39.56">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l39.57"></a><span id="l39.57" class="difflineminus">-      onGetResult: function(calendar, status, itemType, detail, count, items) {},</span>
<a href="#l39.58"></a><span id="l39.58" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l39.59"></a><span id="l39.59">       onOperationComplete: async function(calendar, status, opType, id, oldOfflineJournalFlag) {</span>
<a href="#l39.60"></a><span id="l39.60">         let newOfflineJournalFlag = cICL.OFFLINE_FLAG_MODIFIED_RECORD;</span>
<a href="#l39.61"></a><span id="l39.61">         if (</span>
<a href="#l39.62"></a><span id="l39.62">           oldOfflineJournalFlag == cICL.OFFLINE_FLAG_CREATED_RECORD ||</span>
<a href="#l39.63"></a><span id="l39.63">           oldOfflineJournalFlag == cICL.OFFLINE_FLAG_DELETED_RECORD</span>
<a href="#l39.64"></a><span id="l39.64">         ) {</span>
<a href="#l39.65"></a><span id="l39.65">           // Do nothing since a flag of &quot;created&quot; or &quot;deleted&quot; exists</span>
<a href="#l39.66"></a><span id="l39.66">         } else {</span>
<a href="#l39.67"></a><span id="l39.67" class="difflineat">@@ -924,17 +917,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l39.68"></a><span id="l39.68">     };</span>
<a href="#l39.69"></a><span id="l39.69">     this.getItemOfflineFlag(aItem, opListener);</span>
<a href="#l39.70"></a><span id="l39.70">   },</span>
<a href="#l39.71"></a><span id="l39.71"> </span>
<a href="#l39.72"></a><span id="l39.72">   deleteOfflineItem: function(aItem, aListener) {</span>
<a href="#l39.73"></a><span id="l39.73">     let self = this;</span>
<a href="#l39.74"></a><span id="l39.74">     let opListener = {</span>
<a href="#l39.75"></a><span id="l39.75">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l39.76"></a><span id="l39.76" class="difflineminus">-      onGetResult: function(calendar, status, itemType, detail, count, items) {},</span>
<a href="#l39.77"></a><span id="l39.77" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l39.78"></a><span id="l39.78">       onOperationComplete: async function(calendar, status, opType, id, oldOfflineJournalFlag) {</span>
<a href="#l39.79"></a><span id="l39.79">         if (oldOfflineJournalFlag) {</span>
<a href="#l39.80"></a><span id="l39.80">           // Delete item if flag is c</span>
<a href="#l39.81"></a><span id="l39.81">           if (oldOfflineJournalFlag == cICL.OFFLINE_FLAG_CREATED_RECORD) {</span>
<a href="#l39.82"></a><span id="l39.82">             await self.deleteItemById(aItem.id);</span>
<a href="#l39.83"></a><span id="l39.83">           } else if (oldOfflineJournalFlag == cICL.OFFLINE_FLAG_MODIFIED_RECORD) {</span>
<a href="#l39.84"></a><span id="l39.84">             await self.setOfflineJournalFlag(aItem, cICL.OFFLINE_FLAG_DELETED_RECORD);</span>
<a href="#l39.85"></a><span id="l39.85">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -1139,17 +1139,16 @@ calWcapCalendar.prototype.getItem = func</span>
<a href="#l40.4"></a><span id="l40.4">             this.notifyError(NS_ERROR_UNEXPECTED, &quot;unexpected number of items: &quot; + items.length);</span>
<a href="#l40.5"></a><span id="l40.5">           }</span>
<a href="#l40.6"></a><span id="l40.6">           if (listener) {</span>
<a href="#l40.7"></a><span id="l40.7">             listener.onGetResult(</span>
<a href="#l40.8"></a><span id="l40.8">               this.superCalendar,</span>
<a href="#l40.9"></a><span id="l40.9">               NS_OK,</span>
<a href="#l40.10"></a><span id="l40.10">               calIItemBase,</span>
<a href="#l40.11"></a><span id="l40.11">               log(&quot;getItem(): success. id=&quot; + id, this),</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-              items.length,</span>
<a href="#l40.13"></a><span id="l40.13">               items</span>
<a href="#l40.14"></a><span id="l40.14">             );</span>
<a href="#l40.15"></a><span id="l40.15">           }</span>
<a href="#l40.16"></a><span id="l40.16">           request.execRespFunc(null, items[0]);</span>
<a href="#l40.17"></a><span id="l40.17">         };</span>
<a href="#l40.18"></a><span id="l40.18">         if (err) {</span>
<a href="#l40.19"></a><span id="l40.19">           if (</span>
<a href="#l40.20"></a><span id="l40.20">             !checkErrorCode(err, calIWcapErrors.WCAP_FETCH_EVENTS_BY_ID_FAILED) &amp;&amp;</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineat">@@ -1266,17 +1265,16 @@ calWcapCalendar.prototype.getItems = fun</span>
<a href="#l40.22"></a><span id="l40.22">       ) {</span>
<a href="#l40.23"></a><span id="l40.23">         log(&quot;reusing last getItems() cached data.&quot;, this);</span>
<a href="#l40.24"></a><span id="l40.24">         if (listener) {</span>
<a href="#l40.25"></a><span id="l40.25">           listener.onGetResult(</span>
<a href="#l40.26"></a><span id="l40.26">             this.superCalendar,</span>
<a href="#l40.27"></a><span id="l40.27">             NS_OK,</span>
<a href="#l40.28"></a><span id="l40.28">             calIItemBase,</span>
<a href="#l40.29"></a><span id="l40.29">             &quot;getItems()&quot;,</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineminus">-            entry.results.length,</span>
<a href="#l40.31"></a><span id="l40.31">             entry.results</span>
<a href="#l40.32"></a><span id="l40.32">           );</span>
<a href="#l40.33"></a><span id="l40.33">         }</span>
<a href="#l40.34"></a><span id="l40.34">         request.execRespFunc(null, entry.results);</span>
<a href="#l40.35"></a><span id="l40.35">         return request;</span>
<a href="#l40.36"></a><span id="l40.36">       }</span>
<a href="#l40.37"></a><span id="l40.37">     }</span>
<a href="#l40.38"></a><span id="l40.38">   }</span>
<a href="#l40.39"></a><span id="l40.39" class="difflineat">@@ -1320,17 +1318,16 @@ calWcapCalendar.prototype.getItems = fun</span>
<a href="#l40.40"></a><span id="l40.40">                     item.makeImmutable();</span>
<a href="#l40.41"></a><span id="l40.41">                     items.push(item);</span>
<a href="#l40.42"></a><span id="l40.42">                   }</span>
<a href="#l40.43"></a><span id="l40.43">                   listener.onGetResult(</span>
<a href="#l40.44"></a><span id="l40.44">                     this.superCalendar,</span>
<a href="#l40.45"></a><span id="l40.45">                     NS_OK,</span>
<a href="#l40.46"></a><span id="l40.46">                     calIItemBase,</span>
<a href="#l40.47"></a><span id="l40.47">                     &quot;getItems()/free-busy&quot;,</span>
<a href="#l40.48"></a><span id="l40.48" class="difflineminus">-                    items.length,</span>
<a href="#l40.49"></a><span id="l40.49">                     items</span>
<a href="#l40.50"></a><span id="l40.50">                   );</span>
<a href="#l40.51"></a><span id="l40.51">                 }.bind(this),</span>
<a href="#l40.52"></a><span id="l40.52">               };</span>
<a href="#l40.53"></a><span id="l40.53">               request.attachSubRequest(</span>
<a href="#l40.54"></a><span id="l40.54">                 this.session.getFreeBusyIntervals(</span>
<a href="#l40.55"></a><span id="l40.55">                   this.calId,</span>
<a href="#l40.56"></a><span id="l40.56">                   rangeStart,</span>
<a href="#l40.57"></a><span id="l40.57" class="difflineat">@@ -1398,24 +1395,17 @@ calWcapCalendar.prototype.getItems = fun</span>
<a href="#l40.58"></a><span id="l40.58">               results: items,</span>
<a href="#l40.59"></a><span id="l40.59">             };</span>
<a href="#l40.60"></a><span id="l40.60">             this.m_cachedResults.unshift(cacheEntry);</span>
<a href="#l40.61"></a><span id="l40.61">             if (this.m_cachedResults.length &gt; CACHE_LAST_RESULTS) {</span>
<a href="#l40.62"></a><span id="l40.62">               this.m_cachedResults.length = CACHE_LAST_RESULTS;</span>
<a href="#l40.63"></a><span id="l40.63">             }</span>
<a href="#l40.64"></a><span id="l40.64">           }</span>
<a href="#l40.65"></a><span id="l40.65"> </span>
<a href="#l40.66"></a><span id="l40.66" class="difflineminus">-          listener.onGetResult(</span>
<a href="#l40.67"></a><span id="l40.67" class="difflineminus">-            this.superCalendar,</span>
<a href="#l40.68"></a><span id="l40.68" class="difflineminus">-            NS_OK,</span>
<a href="#l40.69"></a><span id="l40.69" class="difflineminus">-            calIItemBase,</span>
<a href="#l40.70"></a><span id="l40.70" class="difflineminus">-            &quot;getItems()&quot;,</span>
<a href="#l40.71"></a><span id="l40.71" class="difflineminus">-            items.length,</span>
<a href="#l40.72"></a><span id="l40.72" class="difflineminus">-            items</span>
<a href="#l40.73"></a><span id="l40.73" class="difflineminus">-          );</span>
<a href="#l40.74"></a><span id="l40.74" class="difflineplus">+          listener.onGetResult(this.superCalendar, NS_OK, calIItemBase, &quot;getItems()&quot;, items);</span>
<a href="#l40.75"></a><span id="l40.75">         }</span>
<a href="#l40.76"></a><span id="l40.76">       },</span>
<a href="#l40.77"></a><span id="l40.77">       stringToIcal,</span>
<a href="#l40.78"></a><span id="l40.78">       &quot;fetchcomponents_by_range&quot;,</span>
<a href="#l40.79"></a><span id="l40.79">       params,</span>
<a href="#l40.80"></a><span id="l40.80">       calIWcapCalendar.AC_COMP_READ</span>
<a href="#l40.81"></a><span id="l40.81">     );</span>
<a href="#l40.82"></a><span id="l40.82">   } catch (exc) {</span>
<a href="#l40.83"></a><span id="l40.83" class="difflineat">@@ -1447,17 +1437,17 @@ calWcapCalendar.prototype.replayChangesO</span>
<a href="#l40.84"></a><span id="l40.84">     if (listener) {</span>
<a href="#l40.85"></a><span id="l40.85">       listener.onResult(request, null);</span>
<a href="#l40.86"></a><span id="l40.86">     }</span>
<a href="#l40.87"></a><span id="l40.87">   }, log(&quot;replayChangesOn():\n\titemFilter=0x&quot; + itemFilter.toString(0x10) + &quot;\n\tdtFrom=&quot; + getIcalUTC(dtFrom), this));</span>
<a href="#l40.88"></a><span id="l40.88"> </span>
<a href="#l40.89"></a><span id="l40.89">   try {</span>
<a href="#l40.90"></a><span id="l40.90">     let writeListener = {</span>
<a href="#l40.91"></a><span id="l40.91">       QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l40.92"></a><span id="l40.92" class="difflineminus">-      onGetResult: function() {},</span>
<a href="#l40.93"></a><span id="l40.93" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l40.94"></a><span id="l40.94">       onOperationComplete: function(aCalendar, status, opType, id, detail) {</span>
<a href="#l40.95"></a><span id="l40.95">         if (!Components.isSuccessCode(status)) {</span>
<a href="#l40.96"></a><span id="l40.96">           request.execRespFunc(status); // any error on writing breaks whole operation</span>
<a href="#l40.97"></a><span id="l40.97">         }</span>
<a href="#l40.98"></a><span id="l40.98">       },</span>
<a href="#l40.99"></a><span id="l40.99">     };</span>
<a href="#l40.100"></a><span id="l40.100">     let request = new calWcapRequest((err, data) =&gt; {</span>
<a href="#l40.101"></a><span id="l40.101">       let modifiedIds = {};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -880,17 +880,17 @@ calWcapSession.prototype = {</span>
<a href="#l41.4"></a><span id="l41.4">       // Fall through to the return statement below in case the uncached</span>
<a href="#l41.5"></a><span id="l41.5">       // calendar can't be retrieved.</span>
<a href="#l41.6"></a><span id="l41.6">     }</span>
<a href="#l41.7"></a><span id="l41.7">     return null;</span>
<a href="#l41.8"></a><span id="l41.8">   },</span>
<a href="#l41.9"></a><span id="l41.9"> </span>
<a href="#l41.10"></a><span id="l41.10">   getRegisteredCalendars: function(asAssocObj) {</span>
<a href="#l41.11"></a><span id="l41.11">     let registeredCalendars = asAssocObj ? {} : [];</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-    let cals = cal.getCalendarManager().getCalendars({});</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+    let cals = cal.getCalendarManager().getCalendars();</span>
<a href="#l41.14"></a><span id="l41.14">     for (let calendar of cals) {</span>
<a href="#l41.15"></a><span id="l41.15">       calendar = this.belongsTo(calendar);</span>
<a href="#l41.16"></a><span id="l41.16">       if (calendar) {</span>
<a href="#l41.17"></a><span id="l41.17">         if (asAssocObj) {</span>
<a href="#l41.18"></a><span id="l41.18">           registeredCalendars[calendar.calId] = calendar;</span>
<a href="#l41.19"></a><span id="l41.19">         } else {</span>
<a href="#l41.20"></a><span id="l41.20">           registeredCalendars.push(calendar);</span>
<a href="#l41.21"></a><span id="l41.21">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/resources/content/calendarCreation.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/resources/content/calendarCreation.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -279,17 +279,17 @@ function parseUri(aUri) {</span>
<a href="#l42.4"></a><span id="l42.4">   try {</span>
<a href="#l42.5"></a><span id="l42.5">     // Test if the entered uri can be parsed.</span>
<a href="#l42.6"></a><span id="l42.6">     uri = Services.io.newURI(aUri);</span>
<a href="#l42.7"></a><span id="l42.7">   } catch (ex) {</span>
<a href="#l42.8"></a><span id="l42.8">     return [errorConstants.INVALID_URI, null];</span>
<a href="#l42.9"></a><span id="l42.9">   }</span>
<a href="#l42.10"></a><span id="l42.10"> </span>
<a href="#l42.11"></a><span id="l42.11">   let calManager = cal.getCalendarManager();</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  let cals = calManager.getCalendars({});</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+  let cals = calManager.getCalendars();</span>
<a href="#l42.14"></a><span id="l42.14">   let type = document.getElementById(&quot;calendar-type&quot;).selectedItem.value;</span>
<a href="#l42.15"></a><span id="l42.15">   if (type != &quot;local&quot; &amp;&amp; cals.some(calendar =&gt; calendar.uri.spec == uri.spec)) {</span>
<a href="#l42.16"></a><span id="l42.16">     // If the calendar is not local, we check if there is already a calendar</span>
<a href="#l42.17"></a><span id="l42.17">     // with the same uri spec. Storage calendars all have the same uri, so</span>
<a href="#l42.18"></a><span id="l42.18">     // we have to specialcase them.</span>
<a href="#l42.19"></a><span id="l42.19">     return [errorConstants.ALREADY_EXISTS, null];</span>
<a href="#l42.20"></a><span id="l42.20">   }</span>
<a href="#l42.21"></a><span id="l42.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -45,20 +45,19 @@ function publishCalendarDataDialogRespon</span>
<a href="#l43.4"></a><span id="l43.4">  * publishEntireCalendar</span>
<a href="#l43.5"></a><span id="l43.5">  * Show publish dialog, ask for URL and publish all items from the calendar.</span>
<a href="#l43.6"></a><span id="l43.6">  *</span>
<a href="#l43.7"></a><span id="l43.7">  * @param aCalendar   (optional) The calendar that will be published. If omitted</span>
<a href="#l43.8"></a><span id="l43.8">  *                               the user will be prompted to select a calendar.</span>
<a href="#l43.9"></a><span id="l43.9">  */</span>
<a href="#l43.10"></a><span id="l43.10"> function publishEntireCalendar(aCalendar) {</span>
<a href="#l43.11"></a><span id="l43.11">   if (!aCalendar) {</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-    let count = {};</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">-    let calendars = cal.getCalendarManager().getCalendars(count);</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineplus">+    let calendars = cal.getCalendarManager().getCalendars();</span>
<a href="#l43.15"></a><span id="l43.15"> </span>
<a href="#l43.16"></a><span id="l43.16" class="difflineminus">-    if (count.value == 1) {</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineplus">+    if (calendars.length == 1) {</span>
<a href="#l43.18"></a><span id="l43.18">       // Do not ask user for calendar if only one calendar exists</span>
<a href="#l43.19"></a><span id="l43.19">       aCalendar = calendars[0];</span>
<a href="#l43.20"></a><span id="l43.20">     } else {</span>
<a href="#l43.21"></a><span id="l43.21">       // Ask user to select the calendar that should be published.</span>
<a href="#l43.22"></a><span id="l43.22">       // publishEntireCalendar() will be called again if OK is pressed</span>
<a href="#l43.23"></a><span id="l43.23">       // in the dialog and the selected calendar will be passed in.</span>
<a href="#l43.24"></a><span id="l43.24">       // Therefore return after openDialog().</span>
<a href="#l43.25"></a><span id="l43.25">       let args = {};</span>
<a href="#l43.26"></a><span id="l43.26" class="difflineat">@@ -106,22 +105,22 @@ function publishEntireCalendarDialogResp</span>
<a href="#l43.27"></a><span id="l43.27">   CalendarPublishObject.calendar.setProperty(&quot;remote-ics-path&quot;, CalendarPublishObject.remotePath);</span>
<a href="#l43.28"></a><span id="l43.28"> </span>
<a href="#l43.29"></a><span id="l43.29">   let itemArray = [];</span>
<a href="#l43.30"></a><span id="l43.30">   let getListener = {</span>
<a href="#l43.31"></a><span id="l43.31">     QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l43.32"></a><span id="l43.32">     onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail) {</span>
<a href="#l43.33"></a><span id="l43.33">       publishItemArray(itemArray, CalendarPublishObject.remotePath, aProgressDialog);</span>
<a href="#l43.34"></a><span id="l43.34">     },</span>
<a href="#l43.35"></a><span id="l43.35" class="difflineminus">-    onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l43.36"></a><span id="l43.36" class="difflineplus">+    onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l43.37"></a><span id="l43.37">       if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l43.38"></a><span id="l43.38">         return;</span>
<a href="#l43.39"></a><span id="l43.39">       }</span>
<a href="#l43.40"></a><span id="l43.40" class="difflineminus">-      if (aCount) {</span>
<a href="#l43.41"></a><span id="l43.41" class="difflineminus">-        for (let i = 0; i &lt; aCount; ++i) {</span>
<a href="#l43.42"></a><span id="l43.42" class="difflineplus">+      if (aItems.length) {</span>
<a href="#l43.43"></a><span id="l43.43" class="difflineplus">+        for (let i = 0; i &lt; aItems.length; ++i) {</span>
<a href="#l43.44"></a><span id="l43.44">           // Store a (short living) reference to the item.</span>
<a href="#l43.45"></a><span id="l43.45">           let itemCopy = aItems[i].clone();</span>
<a href="#l43.46"></a><span id="l43.46">           itemArray.push(itemCopy);</span>
<a href="#l43.47"></a><span id="l43.47">         }</span>
<a href="#l43.48"></a><span id="l43.48">       }</span>
<a href="#l43.49"></a><span id="l43.49">     },</span>
<a href="#l43.50"></a><span id="l43.50">   };</span>
<a href="#l43.51"></a><span id="l43.51">   aProgressDialog.onStartUpload();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/test/browser/browser_calendarList.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/test/browser/browser_calendarList.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -103,17 +103,17 @@ add_task(async () =&gt; {</span>
<a href="#l44.4"></a><span id="l44.4">   let calendarList = document.getElementById(&quot;calendar-list&quot;);</span>
<a href="#l44.5"></a><span id="l44.5">   let contextMenu = document.getElementById(&quot;list-calendars-context-menu&quot;);</span>
<a href="#l44.6"></a><span id="l44.6">   let manager = cal.getCalendarManager();</span>
<a href="#l44.7"></a><span id="l44.7">   let composite = cal.view.getCompositeCalendar(window);</span>
<a href="#l44.8"></a><span id="l44.8"> </span>
<a href="#l44.9"></a><span id="l44.9">   await openCalendarTab();</span>
<a href="#l44.10"></a><span id="l44.10"> </span>
<a href="#l44.11"></a><span id="l44.11">   // Check the default calendar.</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  let calendars = manager.getCalendars({});</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+  let calendars = manager.getCalendars();</span>
<a href="#l44.14"></a><span id="l44.14">   is(calendars.length, 1);</span>
<a href="#l44.15"></a><span id="l44.15">   is(calendarList.itemCount, 1);</span>
<a href="#l44.16"></a><span id="l44.16">   checkProperties(0, {</span>
<a href="#l44.17"></a><span id="l44.17">     color: &quot;rgb(168, 194, 225)&quot;,</span>
<a href="#l44.18"></a><span id="l44.18">     name: &quot;Home&quot;,</span>
<a href="#l44.19"></a><span id="l44.19">   });</span>
<a href="#l44.20"></a><span id="l44.20">   checkSortOrder(0);</span>
<a href="#l44.21"></a><span id="l44.21"> </span>
<a href="#l44.22"></a><span id="l44.22" class="difflineat">@@ -129,17 +129,17 @@ add_task(async () =&gt; {</span>
<a href="#l44.23"></a><span id="l44.23">   // Add some new calendars, check their properties.</span>
<a href="#l44.24"></a><span id="l44.24">   let uri = Services.io.newURI(&quot;moz-memory-calendar://&quot;);</span>
<a href="#l44.25"></a><span id="l44.25">   for (let i = 1; i &lt;= 3; i++) {</span>
<a href="#l44.26"></a><span id="l44.26">     calendars[i] = manager.createCalendar(&quot;memory&quot;, uri);</span>
<a href="#l44.27"></a><span id="l44.27">     calendars[i].name = `Mochitest ${i}`;</span>
<a href="#l44.28"></a><span id="l44.28">     manager.registerCalendar(calendars[i]);</span>
<a href="#l44.29"></a><span id="l44.29">   }</span>
<a href="#l44.30"></a><span id="l44.30"> </span>
<a href="#l44.31"></a><span id="l44.31" class="difflineminus">-  is(manager.getCalendars({}).length, 4);</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineplus">+  is(manager.getCalendars().length, 4);</span>
<a href="#l44.33"></a><span id="l44.33">   is(calendarList.itemCount, 4);</span>
<a href="#l44.34"></a><span id="l44.34"> </span>
<a href="#l44.35"></a><span id="l44.35">   for (let i = 1; i &lt;= 3; i++) {</span>
<a href="#l44.36"></a><span id="l44.36">     checkProperties(i, {</span>
<a href="#l44.37"></a><span id="l44.37">       id: calendars[i].id,</span>
<a href="#l44.38"></a><span id="l44.38">       displayed: true,</span>
<a href="#l44.39"></a><span id="l44.39">       color: &quot;rgb(168, 194, 225)&quot;,</span>
<a href="#l44.40"></a><span id="l44.40">       name: `Mochitest ${i}`,</span>
<a href="#l44.41"></a><span id="l44.41" class="difflineat">@@ -296,42 +296,42 @@ add_task(async () =&gt; {</span>
<a href="#l44.42"></a><span id="l44.42"> </span>
<a href="#l44.43"></a><span id="l44.43">   is(document.activeElement, calendarList);</span>
<a href="#l44.44"></a><span id="l44.44">   is(calendarList.selectedItem, calendarList.itemChildren[0]);</span>
<a href="#l44.45"></a><span id="l44.45"> </span>
<a href="#l44.46"></a><span id="l44.46">   // Test deleting calendars.</span>
<a href="#l44.47"></a><span id="l44.47"> </span>
<a href="#l44.48"></a><span id="l44.48">   // Delete a calendar by unregistering it.</span>
<a href="#l44.49"></a><span id="l44.49">   manager.unregisterCalendar(calendars[3]);</span>
<a href="#l44.50"></a><span id="l44.50" class="difflineminus">-  is(manager.getCalendars({}).length, 3);</span>
<a href="#l44.51"></a><span id="l44.51" class="difflineplus">+  is(manager.getCalendars().length, 3);</span>
<a href="#l44.52"></a><span id="l44.52">   is(calendarList.itemCount, 3);</span>
<a href="#l44.53"></a><span id="l44.53">   checkSortOrder(0, 1, 2);</span>
<a href="#l44.54"></a><span id="l44.54"> </span>
<a href="#l44.55"></a><span id="l44.55">   // Start to remove a calendar. Cancel the prompt.</span>
<a href="#l44.56"></a><span id="l44.56">   EventUtils.synthesizeMouseAtCenter(calendarList.itemChildren[1], {});</span>
<a href="#l44.57"></a><span id="l44.57">   await withMockPromptService(1, () =&gt; {</span>
<a href="#l44.58"></a><span id="l44.58">     EventUtils.synthesizeKey(&quot;VK_DELETE&quot;);</span>
<a href="#l44.59"></a><span id="l44.59">   });</span>
<a href="#l44.60"></a><span id="l44.60" class="difflineminus">-  is(manager.getCalendars({}).length, 3);</span>
<a href="#l44.61"></a><span id="l44.61" class="difflineplus">+  is(manager.getCalendars().length, 3);</span>
<a href="#l44.62"></a><span id="l44.62">   is(calendarList.itemCount, 3);</span>
<a href="#l44.63"></a><span id="l44.63">   checkSortOrder(0, 1, 2);</span>
<a href="#l44.64"></a><span id="l44.64"> </span>
<a href="#l44.65"></a><span id="l44.65">   // Remove a calendar with the keyboard.</span>
<a href="#l44.66"></a><span id="l44.66">   await withMockPromptService(0, () =&gt; {</span>
<a href="#l44.67"></a><span id="l44.67">     EventUtils.synthesizeKey(&quot;VK_DELETE&quot;);</span>
<a href="#l44.68"></a><span id="l44.68">   });</span>
<a href="#l44.69"></a><span id="l44.69" class="difflineminus">-  is(manager.getCalendars({}).length, 2);</span>
<a href="#l44.70"></a><span id="l44.70" class="difflineplus">+  is(manager.getCalendars().length, 2);</span>
<a href="#l44.71"></a><span id="l44.71">   is(calendarList.itemCount, 2);</span>
<a href="#l44.72"></a><span id="l44.72">   checkSortOrder(0, 2);</span>
<a href="#l44.73"></a><span id="l44.73"> </span>
<a href="#l44.74"></a><span id="l44.74">   // Remove a calendar with the context menu.</span>
<a href="#l44.75"></a><span id="l44.75">   await withMockPromptService(0, async () =&gt; {</span>
<a href="#l44.76"></a><span id="l44.76">     EventUtils.synthesizeMouseAtCenter(calendarList.itemChildren[1], {});</span>
<a href="#l44.77"></a><span id="l44.77">     await calendarListContextMenu(calendarList.itemChildren[1], &quot;list-calendars-context-delete&quot;);</span>
<a href="#l44.78"></a><span id="l44.78">   });</span>
<a href="#l44.79"></a><span id="l44.79" class="difflineminus">-  is(manager.getCalendars({}).length, 1);</span>
<a href="#l44.80"></a><span id="l44.80" class="difflineplus">+  is(manager.getCalendars().length, 1);</span>
<a href="#l44.81"></a><span id="l44.81">   is(calendarList.itemCount, 1);</span>
<a href="#l44.82"></a><span id="l44.82">   checkSortOrder(0);</span>
<a href="#l44.83"></a><span id="l44.83"> </span>
<a href="#l44.84"></a><span id="l44.84">   is(composite.defaultCalendar.id, calendars[0].id);</span>
<a href="#l44.85"></a><span id="l44.85">   is(calendarList.selectedItem, calendarList.itemChildren[0]);</span>
<a href="#l44.86"></a><span id="l44.86">   await closeCalendarTab();</span>
<a href="#l44.87"></a><span id="l44.87"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/test/browser/browser_import.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/test/browser/browser_import.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -15,17 +15,17 @@ add_task(async () =&gt; {</span>
<a href="#l45.4"></a><span id="l45.4">   let file = fileUrl.QueryInterface(Ci.nsIFileURL).file;</span>
<a href="#l45.5"></a><span id="l45.5"> </span>
<a href="#l45.6"></a><span id="l45.6">   MockFilePicker.init(content);</span>
<a href="#l45.7"></a><span id="l45.7">   MockFilePicker.setFiles([file]);</span>
<a href="#l45.8"></a><span id="l45.8">   MockFilePicker.returnValue = MockFilePicker.returnOK;</span>
<a href="#l45.9"></a><span id="l45.9"> </span>
<a href="#l45.10"></a><span id="l45.10">   await loadEventsFromFile();</span>
<a href="#l45.11"></a><span id="l45.11"> </span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  let calendar = cal.getCalendarManager().getCalendars({})[0];</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  let calendar = cal.getCalendarManager().getCalendars()[0];</span>
<a href="#l45.14"></a><span id="l45.14">   let promiseCalendar = cal.async.promisifyCalendar(calendar);</span>
<a href="#l45.15"></a><span id="l45.15">   let result = await promiseCalendar.getItems(</span>
<a href="#l45.16"></a><span id="l45.16">     Ci.calICalendar.ITEM_FILTER_ALL_ITEMS,</span>
<a href="#l45.17"></a><span id="l45.17">     0,</span>
<a href="#l45.18"></a><span id="l45.18">     cal.createDateTime(&quot;20190101T000000&quot;),</span>
<a href="#l45.19"></a><span id="l45.19">     cal.createDateTime(&quot;20190102T000000&quot;)</span>
<a href="#l45.20"></a><span id="l45.20">   );</span>
<a href="#l45.21"></a><span id="l45.21">   is(result.length, 4);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/test/modules/CalendarUtils.jsm</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/test/modules/CalendarUtils.jsm</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -482,17 +482,17 @@ function closeAllEventDialogs() {</span>
<a href="#l46.4"></a><span id="l46.4">  * @param name          calendar name</span>
<a href="#l46.5"></a><span id="l46.5">  */</span>
<a href="#l46.6"></a><span id="l46.6"> function deleteCalendars(controller, name) {</span>
<a href="#l46.7"></a><span id="l46.7">   let { eid } = helpersForController(controller);</span>
<a href="#l46.8"></a><span id="l46.8"> </span>
<a href="#l46.9"></a><span id="l46.9">   let win = eid(&quot;messengerWindow&quot;).getNode().ownerGlobal;</span>
<a href="#l46.10"></a><span id="l46.10">   let manager = win.cal.getCalendarManager();</span>
<a href="#l46.11"></a><span id="l46.11"> </span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-  for (let calendar of manager.getCalendars({})) {</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+  for (let calendar of manager.getCalendars()) {</span>
<a href="#l46.14"></a><span id="l46.14">     if (calendar.name == name) {</span>
<a href="#l46.15"></a><span id="l46.15">       manager.removeCalendar(calendar);</span>
<a href="#l46.16"></a><span id="l46.16">     }</span>
<a href="#l46.17"></a><span id="l46.17">   }</span>
<a href="#l46.18"></a><span id="l46.18"> }</span>
<a href="#l46.19"></a><span id="l46.19"> </span>
<a href="#l46.20"></a><span id="l46.20"> /**</span>
<a href="#l46.21"></a><span id="l46.21">  * Creates local calendar with given name and select it in calendars list.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/test/unit/test_bug494140.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/test/unit/test_bug494140.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -44,23 +44,23 @@ add_task(async () =&gt; {</span>
<a href="#l47.4"></a><span id="l47.4">   // There should still be one alarm, one relation and one attachment</span>
<a href="#l47.5"></a><span id="l47.5">   equal(item.getAlarms().length, 1);</span>
<a href="#l47.6"></a><span id="l47.6">   equal(item.getRelations().length, 1);</span>
<a href="#l47.7"></a><span id="l47.7">   equal(item.getAttachments().length, 1);</span>
<a href="#l47.8"></a><span id="l47.8"> </span>
<a href="#l47.9"></a><span id="l47.9">   // Add the item to the storage calendar and retrieve it again</span>
<a href="#l47.10"></a><span id="l47.10">   await new Promise(resolve =&gt; {</span>
<a href="#l47.11"></a><span id="l47.11">     storageCal.adoptItem(item, {</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-      onGetResult: function() {},</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+      onGetResult: function(calendar, status, itemType, detail, items) {},</span>
<a href="#l47.14"></a><span id="l47.14">       onOperationComplete: resolve,</span>
<a href="#l47.15"></a><span id="l47.15">     });</span>
<a href="#l47.16"></a><span id="l47.16">   });</span>
<a href="#l47.17"></a><span id="l47.17">   let retrievedItem = await new Promise(resolve =&gt; {</span>
<a href="#l47.18"></a><span id="l47.18">     storageCal.getItem(&quot;c1a6cfe7-7fbb-4bfb-a00d-861e07c649a5&quot;, {</span>
<a href="#l47.19"></a><span id="l47.19" class="difflineminus">-      onGetResult: function(cal, stat, type, detail, count, items) {</span>
<a href="#l47.20"></a><span id="l47.20" class="difflineplus">+      onGetResult: function(cal, stat, type, detail, items) {</span>
<a href="#l47.21"></a><span id="l47.21">         resolve(items[0]);</span>
<a href="#l47.22"></a><span id="l47.22">       },</span>
<a href="#l47.23"></a><span id="l47.23">       onOperationComplete: function() {},</span>
<a href="#l47.24"></a><span id="l47.24">     });</span>
<a href="#l47.25"></a><span id="l47.25">   });</span>
<a href="#l47.26"></a><span id="l47.26"> </span>
<a href="#l47.27"></a><span id="l47.27">   // There should still be one alarm, one relation and one attachment</span>
<a href="#l47.28"></a><span id="l47.28">   equal(retrievedItem.getAlarms().length, 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/test/unit/test_calmgr.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/test/unit/test_calmgr.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -72,30 +72,30 @@ add_test(function test_registration() {</span>
<a href="#l48.4"></a><span id="l48.4">   checkRegistration(true, false, false);</span>
<a href="#l48.5"></a><span id="l48.5">   checkCalendarCount(0, 0, 1);</span>
<a href="#l48.6"></a><span id="l48.6"> </span>
<a href="#l48.7"></a><span id="l48.7">   // The calendar should now have an id</span>
<a href="#l48.8"></a><span id="l48.8">   notEqual(memory.id, null);</span>
<a href="#l48.9"></a><span id="l48.9"> </span>
<a href="#l48.10"></a><span id="l48.10">   // And be in the list of calendars</span>
<a href="#l48.11"></a><span id="l48.11">   equal(memory, calmgr.getCalendarById(memory.id));</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  ok(calmgr.getCalendars({}).some(x =&gt; x.id == memory.id));</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+  ok(calmgr.getCalendars().some(x =&gt; x.id == memory.id));</span>
<a href="#l48.14"></a><span id="l48.14"> </span>
<a href="#l48.15"></a><span id="l48.15">   // Make it readonly and check if the observer caught it</span>
<a href="#l48.16"></a><span id="l48.16">   memory.setProperty(&quot;readOnly&quot;, true);</span>
<a href="#l48.17"></a><span id="l48.17">   equal(readOnly, true);</span>
<a href="#l48.18"></a><span id="l48.18"> </span>
<a href="#l48.19"></a><span id="l48.19">   // Now unregister it</span>
<a href="#l48.20"></a><span id="l48.20">   calmgr.unregisterCalendar(memory);</span>
<a href="#l48.21"></a><span id="l48.21">   checkRegistration(false, true, false);</span>
<a href="#l48.22"></a><span id="l48.22">   checkCalendarCount(0, 0, 0);</span>
<a href="#l48.23"></a><span id="l48.23"> </span>
<a href="#l48.24"></a><span id="l48.24">   // The calendar shouldn't be in the list of ids</span>
<a href="#l48.25"></a><span id="l48.25">   equal(calmgr.getCalendarById(memory.id), null);</span>
<a href="#l48.26"></a><span id="l48.26" class="difflineminus">-  ok(calmgr.getCalendars({}).every(x =&gt; x.id != memory.id));</span>
<a href="#l48.27"></a><span id="l48.27" class="difflineplus">+  ok(calmgr.getCalendars().every(x =&gt; x.id != memory.id));</span>
<a href="#l48.28"></a><span id="l48.28"> </span>
<a href="#l48.29"></a><span id="l48.29">   // And finally delete it</span>
<a href="#l48.30"></a><span id="l48.30">   calmgr.removeCalendar(memory, Ci.calICalendarManager.REMOVE_NO_UNREGISTER);</span>
<a href="#l48.31"></a><span id="l48.31">   checkRegistration(false, false, true);</span>
<a href="#l48.32"></a><span id="l48.32">   checkCalendarCount(0, 0, 0);</span>
<a href="#l48.33"></a><span id="l48.33"> </span>
<a href="#l48.34"></a><span id="l48.34">   // Now remove the observer again</span>
<a href="#l48.35"></a><span id="l48.35">   calmgr.removeObserver(mgrobs);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/test/unit/test_providers.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/test/unit/test_providers.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -213,20 +213,20 @@ add_task(async function testIcalData() {</span>
<a href="#l49.4"></a><span id="l49.4">           if (aOperationType == Ci.calIOperationListener.ADD) {</span>
<a href="#l49.5"></a><span id="l49.5">             // perform getItems() on calendar</span>
<a href="#l49.6"></a><span id="l49.6">             aCalendar.getItems(filter, 0, rangeStart, rangeEnd, listener);</span>
<a href="#l49.7"></a><span id="l49.7">           } else if (aOperationType == Ci.calIOperationListener.GET) {</span>
<a href="#l49.8"></a><span id="l49.8">             equal(count, aResult);</span>
<a href="#l49.9"></a><span id="l49.9">             resolve();</span>
<a href="#l49.10"></a><span id="l49.10">           }</span>
<a href="#l49.11"></a><span id="l49.11">         },</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-        onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineminus">-          if (aCount) {</span>
<a href="#l49.14"></a><span id="l49.14" class="difflineminus">-            count += aCount;</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineminus">-            for (let i = 0; i &lt; aCount; i++) {</span>
<a href="#l49.16"></a><span id="l49.16" class="difflineplus">+        onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l49.17"></a><span id="l49.17" class="difflineplus">+          if (aItems.length) {</span>
<a href="#l49.18"></a><span id="l49.18" class="difflineplus">+            count += aItems.length;</span>
<a href="#l49.19"></a><span id="l49.19" class="difflineplus">+            for (let i = 0; i &lt; aItems.length; i++) {</span>
<a href="#l49.20"></a><span id="l49.20">               // Don't check creationDate as it changed when we added the item to the database.</span>
<a href="#l49.21"></a><span id="l49.21">               compareItemsSpecific(aItems[i].parentItem, aItem, [</span>
<a href="#l49.22"></a><span id="l49.22">                 &quot;start&quot;,</span>
<a href="#l49.23"></a><span id="l49.23">                 &quot;end&quot;,</span>
<a href="#l49.24"></a><span id="l49.24">                 &quot;duration&quot;,</span>
<a href="#l49.25"></a><span id="l49.25">                 &quot;title&quot;,</span>
<a href="#l49.26"></a><span id="l49.26">                 &quot;priority&quot;,</span>
<a href="#l49.27"></a><span id="l49.27">                 &quot;privacy&quot;,</span>
<a href="#l49.28"></a><span id="l49.28" class="difflineat">@@ -282,19 +282,19 @@ add_task(async function testIcalData() {</span>
<a href="#l49.29"></a><span id="l49.29">               &quot;privacy&quot;,</span>
<a href="#l49.30"></a><span id="l49.30">               &quot;status&quot;,</span>
<a href="#l49.31"></a><span id="l49.31">               &quot;alarmLastAck&quot;,</span>
<a href="#l49.32"></a><span id="l49.32">               &quot;recurrenceStartDate&quot;,</span>
<a href="#l49.33"></a><span id="l49.33">             ]);</span>
<a href="#l49.34"></a><span id="l49.34">           }</span>
<a href="#l49.35"></a><span id="l49.35">           this.promises.pop()();</span>
<a href="#l49.36"></a><span id="l49.36">         },</span>
<a href="#l49.37"></a><span id="l49.37" class="difflineminus">-        onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l49.38"></a><span id="l49.38" class="difflineminus">-          if (aCount) {</span>
<a href="#l49.39"></a><span id="l49.39" class="difflineminus">-            count += aCount;</span>
<a href="#l49.40"></a><span id="l49.40" class="difflineplus">+        onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aItems) {</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineplus">+          if (aItems.length) {</span>
<a href="#l49.42"></a><span id="l49.42" class="difflineplus">+            count += aItems.length;</span>
<a href="#l49.43"></a><span id="l49.43">             returnedItem = aItems[0];</span>
<a href="#l49.44"></a><span id="l49.44">           }</span>
<a href="#l49.45"></a><span id="l49.45">         },</span>
<a href="#l49.46"></a><span id="l49.46">       };</span>
<a href="#l49.47"></a><span id="l49.47"> </span>
<a href="#l49.48"></a><span id="l49.48">       await new Promise(resolve =&gt; {</span>
<a href="#l49.49"></a><span id="l49.49">         listener.promises.push(resolve);</span>
<a href="#l49.50"></a><span id="l49.50">         // add item to calendar</span>
<a href="#l49.51"></a><span id="l49.51" class="difflineat">@@ -309,29 +309,29 @@ add_task(async function testMetaData() {</span>
<a href="#l49.52"></a><span id="l49.52">     dump(&quot;testMetaData_() calendar type: &quot; + aCalendar.type + &quot;\n&quot;);</span>
<a href="#l49.53"></a><span id="l49.53">     let event1 = createEventFromIcalString(</span>
<a href="#l49.54"></a><span id="l49.54">       &quot;BEGIN:VEVENT\n&quot; + &quot;DTSTART;VALUE=DATE:20020402\n&quot; + &quot;END:VEVENT\n&quot;</span>
<a href="#l49.55"></a><span id="l49.55">     );</span>
<a href="#l49.56"></a><span id="l49.56"> </span>
<a href="#l49.57"></a><span id="l49.57">     event1.id = &quot;item1&quot;;</span>
<a href="#l49.58"></a><span id="l49.58">     await new Promise(resolve =&gt; {</span>
<a href="#l49.59"></a><span id="l49.59">       aCalendar.addItem(event1, {</span>
<a href="#l49.60"></a><span id="l49.60" class="difflineminus">-        onGetResult: function() {},</span>
<a href="#l49.61"></a><span id="l49.61" class="difflineplus">+        onGetResult: function(calendar, aStatus, aItemType, aDetail, aItems) {},</span>
<a href="#l49.62"></a><span id="l49.62">         onOperationComplete: resolve,</span>
<a href="#l49.63"></a><span id="l49.63">       });</span>
<a href="#l49.64"></a><span id="l49.64">     });</span>
<a href="#l49.65"></a><span id="l49.65">     aCalendar.setMetaData(&quot;item1&quot;, &quot;meta1&quot;);</span>
<a href="#l49.66"></a><span id="l49.66">     equal(aCalendar.getMetaData(&quot;item1&quot;), &quot;meta1&quot;);</span>
<a href="#l49.67"></a><span id="l49.67">     equal(aCalendar.getMetaData(&quot;unknown&quot;), null);</span>
<a href="#l49.68"></a><span id="l49.68"> </span>
<a href="#l49.69"></a><span id="l49.69">     let event2 = event1.clone();</span>
<a href="#l49.70"></a><span id="l49.70">     event2.id = &quot;item2&quot;;</span>
<a href="#l49.71"></a><span id="l49.71">     await new Promise(resolve =&gt; {</span>
<a href="#l49.72"></a><span id="l49.72">       aCalendar.addItem(event2, {</span>
<a href="#l49.73"></a><span id="l49.73" class="difflineminus">-        onGetResult: function() {},</span>
<a href="#l49.74"></a><span id="l49.74" class="difflineplus">+        onGetResult: function(calendar, aStatus, aItemType, aDetail, aItems) {},</span>
<a href="#l49.75"></a><span id="l49.75">         onOperationComplete: resolve,</span>
<a href="#l49.76"></a><span id="l49.76">       });</span>
<a href="#l49.77"></a><span id="l49.77">     });</span>
<a href="#l49.78"></a><span id="l49.78">     aCalendar.setMetaData(&quot;item2&quot;, &quot;meta2-&quot;);</span>
<a href="#l49.79"></a><span id="l49.79">     equal(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2-&quot;);</span>
<a href="#l49.80"></a><span id="l49.80"> </span>
<a href="#l49.81"></a><span id="l49.81">     aCalendar.setMetaData(&quot;item2&quot;, &quot;meta2&quot;);</span>
<a href="#l49.82"></a><span id="l49.82">     equal(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2&quot;);</span>
<a href="#l49.83"></a><span id="l49.83" class="difflineat">@@ -343,17 +343,17 @@ add_task(async function testMetaData() {</span>
<a href="#l49.84"></a><span id="l49.84">     equal(count.value, 2);</span>
<a href="#l49.85"></a><span id="l49.85">     ok(ids.value[0] == &quot;item1&quot; || ids.value[1] == &quot;item1&quot;);</span>
<a href="#l49.86"></a><span id="l49.86">     ok(ids.value[0] == &quot;item2&quot; || ids.value[1] == &quot;item2&quot;);</span>
<a href="#l49.87"></a><span id="l49.87">     ok(values.value[0] == &quot;meta1&quot; || values.value[1] == &quot;meta1&quot;);</span>
<a href="#l49.88"></a><span id="l49.88">     ok(values.value[0] == &quot;meta2&quot; || values.value[1] == &quot;meta2&quot;);</span>
<a href="#l49.89"></a><span id="l49.89"> </span>
<a href="#l49.90"></a><span id="l49.90">     await new Promise(resolve =&gt; {</span>
<a href="#l49.91"></a><span id="l49.91">       aCalendar.deleteItem(event1, {</span>
<a href="#l49.92"></a><span id="l49.92" class="difflineminus">-        onGetResult: () =&gt; {},</span>
<a href="#l49.93"></a><span id="l49.93" class="difflineplus">+        onGetResult: (calendar, aStatus, aItemType, aDetail, aItems) =&gt; {},</span>
<a href="#l49.94"></a><span id="l49.94">         onOperationComplete: resolve,</span>
<a href="#l49.95"></a><span id="l49.95">       });</span>
<a href="#l49.96"></a><span id="l49.96">     });</span>
<a href="#l49.97"></a><span id="l49.97">     equal(aCalendar.getMetaData(&quot;item1&quot;), null);</span>
<a href="#l49.98"></a><span id="l49.98">     aCalendar.getAllMetaData(count, ids, values);</span>
<a href="#l49.99"></a><span id="l49.99">     equal(count.value, 1);</span>
<a href="#l49.100"></a><span id="l49.100">     ok(ids.value[0] == &quot;item2&quot;);</span>
<a href="#l49.101"></a><span id="l49.101">     ok(values.value[0] == &quot;meta2&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/test/unit/test_storage.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/test/unit/test_storage.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -33,17 +33,17 @@ add_task(async () =&gt; {</span>
<a href="#l50.4"></a><span id="l50.4">   });</span>
<a href="#l50.5"></a><span id="l50.5"> </span>
<a href="#l50.6"></a><span id="l50.6">   // Make sure the cache is cleared, otherwise we'll get the cached item.</span>
<a href="#l50.7"></a><span id="l50.7">   delete storage.wrappedJSObject.mItemCache[addedItemId];</span>
<a href="#l50.8"></a><span id="l50.8"> </span>
<a href="#l50.9"></a><span id="l50.9">   await new Promise(resolve =&gt; {</span>
<a href="#l50.10"></a><span id="l50.10">     storage.getItem(addedItemId, {</span>
<a href="#l50.11"></a><span id="l50.11">       found: false,</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-      onGetResult: function(calendar, status, type, detail, count, items) {</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+      onGetResult: function(calendar, status, type, detail, items) {</span>
<a href="#l50.14"></a><span id="l50.14">         let item = items[0];</span>
<a href="#l50.15"></a><span id="l50.15"> </span>
<a href="#l50.16"></a><span id="l50.16">         // Check start date</span>
<a href="#l50.17"></a><span id="l50.17">         equal(item.startDate.compare(cal.createDateTime(&quot;20120101T010101Z&quot;)), 0);</span>
<a href="#l50.18"></a><span id="l50.18"> </span>
<a href="#l50.19"></a><span id="l50.19">         // Check attachment</span>
<a href="#l50.20"></a><span id="l50.20">         let attaches = item.getAttachments();</span>
<a href="#l50.21"></a><span id="l50.21">         let attach = attaches[0];</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

