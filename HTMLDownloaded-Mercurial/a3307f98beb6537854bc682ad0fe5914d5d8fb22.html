<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 10140:a3307f98beb6537854bc682ad0fe5914d5d8fb22</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a3307f98beb6537854bc682ad0fe5914d5d8fb22" />
<meta property="og:url" content="/comm-central/rev/a3307f98beb6537854bc682ad0fe5914d5d8fb22" />
<meta property="og:description" content="IMAP: capability flag variable needs to be bigger than 32bit -- bug 558659 part 1, r=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a3307f98beb6537854bc682ad0fe5914d5d8fb22 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a3307f98beb6537854bc682ad0fe5914d5d8fb22">shortlog</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a3307f98beb6537854bc682ad0fe5914d5d8fb22">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22">files</a> |
changeset |
<a href="/comm-central/raw-rev/a3307f98beb6537854bc682ad0fe5914d5d8fb22">raw</a>  | <a href="/comm-central/archive/a3307f98beb6537854bc682ad0fe5914d5d8fb22.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
IMAP: capability flag variable needs to be bigger than 32bit -- <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=558659">bug 558659</a> part 1, r=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#66;&#101;&#110;&#32;&#66;&#117;&#99;&#107;&#115;&#99;&#104;&#32;&#60;&#98;&#101;&#110;&#46;&#98;&#117;&#99;&#107;&#115;&#99;&#104;&#64;&#98;&#101;&#111;&#110;&#101;&#120;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 12 May 2012 00:58:59 +0200</td></tr>

<tr>
 <td>changeset 10140</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a3307f98beb6537854bc682ad0fe5914d5d8fb22">a3307f98beb6537854bc682ad0fe5914d5d8fb22</a></td>
</tr>



<tr>
<td>parent 10139</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8f22d9d7d6921131edfb1ab4cae3090d8e54da45">8f22d9d7d6921131edfb1ab4cae3090d8e54da45</a>
</td>
</tr>

<tr>
<td>child 10141</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9d5996744bca63985c54647fdfc8ce4e11334642">9d5996744bca63985c54647fdfc8ce4e11334642</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a3307f98beb6537854bc682ad0fe5914d5d8fb22">7712</a></td></tr>
<tr><td>push user</td><td>mozilla.BenB@bucksch.org</td></tr>
<tr><td>push date</td><td class="date age">Fri, 11 May 2012 23:20:13 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9d5996744bca [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9d5996744bca63985c54647fdfc8ce4e11334642">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9d5996744bca63985c54647fdfc8ce4e11334642&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9d5996744bca63985c54647fdfc8ce4e11334642&newProject=comm-central&newRevision=a3307f98beb6537854bc682ad0fe5914d5d8fb22&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9d5996744bca63985c54647fdfc8ce4e11334642&newProject=comm-central&newRevision=a3307f98beb6537854bc682ad0fe5914d5d8fb22&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9d5996744bca63985c54647fdfc8ce4e11334642&newProject=comm-central&newRevision=a3307f98beb6537854bc682ad0fe5914d5d8fb22&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=558659">558659</a></td></tr>




</table></div>

<div class="page_body description">IMAP: capability flag variable needs to be bigger than 32bit -- <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=558659">bug 558659</a> part 1, r=bienvenu

We're storing IMAP server capabilities in a variable. That used to be a
32bit integer used as bitflag. We also saved it in prefs as integer.
Now, we need more than 32 flags, so we're enlarging it to a 64bit integer,
and use a typedef.
That means we can't store the varible in prefs anymore, but we only needed
to remember 2 capabilities, and that only for some UI dialog, so we pick out
what we actually needed to know and store it as 2 bool prefs.

This breaks trySTARTTLS somewhat, so another patch will follow which fixes that.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIIMAPHostSessionList.h">mailnews/imap/public/nsIIMAPHostSessionList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIIMAPHostSessionList.h">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIIMAPHostSessionList.h">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIIMAPHostSessionList.h">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIIMAPHostSessionList.h">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIIMAPHostSessionList.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapIncomingServer.idl">mailnews/imap/public/nsIImapIncomingServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapIncomingServer.idl">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapIncomingServer.idl">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapIncomingServer.idl">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapIncomingServer.idl">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapIncomingServer.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapServerSink.idl">mailnews/imap/public/nsIImapServerSink.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapServerSink.idl">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapServerSink.idl">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapServerSink.idl">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapServerSink.idl">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/public/nsIImapServerSink.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.cpp">mailnews/imap/src/nsIMAPHostSessionList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.cpp">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.cpp">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.cpp">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.cpp">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.h">mailnews/imap/src/nsIMAPHostSessionList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.h">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.h">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.h">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.h">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsIMAPHostSessionList.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapCore.h">mailnews/imap/src/nsImapCore.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapCore.h">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapCore.h">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapCore.h">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapCore.h">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapCore.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.h">mailnews/imap/src/nsImapIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.h">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.h">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapIncomingServer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.h">mailnews/imap/src/nsImapProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.h">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.h">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.h">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.h">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.cpp">mailnews/imap/src/nsImapServerResponseParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.cpp">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.cpp">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.cpp">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.cpp">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.h">mailnews/imap/src/nsImapServerResponseParser.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.h">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.h">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.h">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.h">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsImapServerResponseParser.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsSyncRunnableHelpers.cpp">mailnews/imap/src/nsSyncRunnableHelpers.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsSyncRunnableHelpers.cpp">file</a> |
<a href="/comm-central/annotate/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsSyncRunnableHelpers.cpp">annotate</a> |
<a href="/comm-central/diff/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsSyncRunnableHelpers.cpp">diff</a> |
<a href="/comm-central/comparison/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsSyncRunnableHelpers.cpp">comparison</a> |
<a href="/comm-central/log/a3307f98beb6537854bc682ad0fe5914d5d8fb22/mailnews/imap/src/nsSyncRunnableHelpers.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/imap/public/nsIIMAPHostSessionList.h</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/imap/public/nsIIMAPHostSessionList.h</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -40,34 +40,31 @@</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> #include &quot;nsISupports.h&quot;</span>
<a href="#l1.6"></a><span id="l1.6"> #include &quot;nsImapCore.h&quot;</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> class nsIMAPBodyShellCache;</span>
<a href="#l1.9"></a><span id="l1.9"> class nsIMAPBodyShell;</span>
<a href="#l1.10"></a><span id="l1.10"> class nsIImapIncomingServer;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-// 2a8e21fe-e3c4-11d2-a504-0060b0fc04b7</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+// f4d89e3e-77da-492c-962b-7835f0742c22</span>
<a href="#l1.15"></a><span id="l1.15"> #define NS_IIMAPHOSTSESSIONLIST_IID \</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-{ 0x2a8e21fe, 0xe3c4, 0x11d2, {0xa5, 0x04, 0x00, 0x60, 0xb0, 0xfc, 0x04, 0xb7 } }</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+{ 0xf4d89e3e, 0x77da, 0x492c, {0x96, 0x2b, 0x78, 0x35, 0xf0, 0x74, 0x2c, 0x22 } }</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> // this is an interface to a linked list of host info's    </span>
<a href="#l1.20"></a><span id="l1.20"> class nsIImapHostSessionList : public nsISupports</span>
<a href="#l1.21"></a><span id="l1.21"> {</span>
<a href="#l1.22"></a><span id="l1.22"> public:</span>
<a href="#l1.23"></a><span id="l1.23">   NS_DECLARE_STATIC_IID_ACCESSOR(NS_IIMAPHOSTSESSIONLIST_IID)</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">   // Host List</span>
<a href="#l1.26"></a><span id="l1.26">   NS_IMETHOD  AddHostToList(const char *serverKey, nsIImapIncomingServer *server) = 0;</span>
<a href="#l1.27"></a><span id="l1.27">   NS_IMETHOD ResetAll() = 0;</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29">   // Capabilities</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-  NS_IMETHOD  GetCapabilityForHost(const char *serverKey, PRUint32 &amp;result) = 0;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-  NS_IMETHOD  SetCapabilityForHost(const char *serverKey, PRUint32 capability) = 0;</span>
<a href="#l1.32"></a><span id="l1.32">   NS_IMETHOD  GetHostHasAdminURL(const char *serverKey, bool &amp;result) = 0;</span>
<a href="#l1.33"></a><span id="l1.33">   NS_IMETHOD  SetHostHasAdminURL(const char *serverKey, bool hasAdminUrl) = 0;</span>
<a href="#l1.34"></a><span id="l1.34">   // Subscription</span>
<a href="#l1.35"></a><span id="l1.35">   NS_IMETHOD  GetHostIsUsingSubscription(const char *serverKey, bool &amp;result) = 0;</span>
<a href="#l1.36"></a><span id="l1.36">   NS_IMETHOD  SetHostIsUsingSubscription(const char *serverKey, bool usingSubscription) = 0;</span>
<a href="#l1.37"></a><span id="l1.37"> </span>
<a href="#l1.38"></a><span id="l1.38">   // Passwords</span>
<a href="#l1.39"></a><span id="l1.39">   NS_IMETHOD  GetPasswordForHost(const char *serverKey, nsString &amp;result) = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/imap/public/nsIImapIncomingServer.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/imap/public/nsIImapIncomingServer.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -49,24 +49,23 @@ typedef long nsMsgImapDeleteModel;</span>
<a href="#l2.4"></a><span id="l2.4"> [scriptable, uuid(bbfc33de-fe89-11d3-a564-0060b0fc04b7)]</span>
<a href="#l2.5"></a><span id="l2.5"> interface nsMsgImapDeleteModels</span>
<a href="#l2.6"></a><span id="l2.6"> {</span>
<a href="#l2.7"></a><span id="l2.7">   const long IMAPDelete = 0;    /* delete with a big red x */</span>
<a href="#l2.8"></a><span id="l2.8">   const long MoveToTrash = 1;   /* delete moves message to the trash */</span>
<a href="#l2.9"></a><span id="l2.9">   const long DeleteNoTrash = 2; /* delete is shift delete - don't create or use trash */</span>
<a href="#l2.10"></a><span id="l2.10"> };</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-[scriptable, uuid(3f02221b-d556-48ef-8b4f-7e50bfe9813d)]</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+[scriptable, uuid(ea6a0765-07b8-40df-924c-9004ed707251)]</span>
<a href="#l2.14"></a><span id="l2.14"> interface nsIImapIncomingServer : nsISupports {</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16">   attribute long maximumConnectionsNumber;</span>
<a href="#l2.17"></a><span id="l2.17">   attribute long timeOutLimits;</span>
<a href="#l2.18"></a><span id="l2.18">   attribute ACString adminUrl;</span>
<a href="#l2.19"></a><span id="l2.19">   attribute ACString serverDirectory;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-  attribute long capabilityPref;</span>
<a href="#l2.21"></a><span id="l2.21">   /// RFC 2971 ID response stored as a pref</span>
<a href="#l2.22"></a><span id="l2.22">   attribute ACString serverIDPref;</span>
<a href="#l2.23"></a><span id="l2.23">   attribute boolean cleanupInboxOnExit;</span>
<a href="#l2.24"></a><span id="l2.24">   attribute nsMsgImapDeleteModel deleteModel;</span>
<a href="#l2.25"></a><span id="l2.25">   attribute boolean dualUseFolders;</span>
<a href="#l2.26"></a><span id="l2.26">   attribute long emptyTrashThreshhold;</span>
<a href="#l2.27"></a><span id="l2.27">   attribute ACString personalNamespace;</span>
<a href="#l2.28"></a><span id="l2.28">   attribute ACString publicNamespace;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineat">@@ -74,16 +73,18 @@ interface nsIImapIncomingServer : nsISup</span>
<a href="#l2.30"></a><span id="l2.30">   attribute boolean offlineDownload;</span>
<a href="#l2.31"></a><span id="l2.31">   attribute boolean overrideNamespaces;</span>
<a href="#l2.32"></a><span id="l2.32">   attribute boolean usingSubscription;</span>
<a href="#l2.33"></a><span id="l2.33">   attribute ACString manageMailAccountUrl;</span>
<a href="#l2.34"></a><span id="l2.34">   attribute boolean fetchByChunks;</span>
<a href="#l2.35"></a><span id="l2.35">   attribute boolean mimePartsOnDemand;</span>
<a href="#l2.36"></a><span id="l2.36">   attribute boolean sendID;</span>
<a href="#l2.37"></a><span id="l2.37">   attribute boolean isAOLServer;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+  attribute boolean capabilityACL;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+  attribute boolean capabilityQuota;</span>
<a href="#l2.40"></a><span id="l2.40">   attribute boolean useIdle;</span>
<a href="#l2.41"></a><span id="l2.41">   attribute boolean checkAllFoldersForNew;</span>
<a href="#l2.42"></a><span id="l2.42"> </span>
<a href="#l2.43"></a><span id="l2.43">   /// Is this a GMail Server?</span>
<a href="#l2.44"></a><span id="l2.44">   attribute boolean isGMailServer;</span>
<a href="#l2.45"></a><span id="l2.45"> </span>
<a href="#l2.46"></a><span id="l2.46">   /**</span>
<a href="#l2.47"></a><span id="l2.47">    * See IMAP RFC 4551</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/imap/public/nsIImapServerSink.idl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/imap/public/nsIImapServerSink.idl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -67,17 +67,17 @@ interface nsIImapServerSink : nsISupport</span>
<a href="#l3.4"></a><span id="l3.4">   void discoveryDone();</span>
<a href="#l3.5"></a><span id="l3.5">   void onlineFolderDelete(in ACString folderName);</span>
<a href="#l3.6"></a><span id="l3.6">   void onlineFolderCreateFailed(in ACString aFolderName);</span>
<a href="#l3.7"></a><span id="l3.7">   void onlineFolderRename(in nsIMsgWindow msgWindow, in ACString oldName, in ACString newName);</span>
<a href="#l3.8"></a><span id="l3.8">   boolean folderIsNoSelect(in ACString folderName);</span>
<a href="#l3.9"></a><span id="l3.9">   void setFolderAdminURL(in ACString folderName, in ACString adminUrl);</span>
<a href="#l3.10"></a><span id="l3.10">   boolean folderVerifiedOnline(in ACString folderName);</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  void setCapability(in unsigned long capability);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  void setCapability(in unsigned long long capability);</span>
<a href="#l3.14"></a><span id="l3.14">   /// RFC 2971 ID server response</span>
<a href="#l3.15"></a><span id="l3.15">   void setServerID(in ACString aServerID);</span>
<a href="#l3.16"></a><span id="l3.16">   boolean loadNextQueuedUrl(in nsIImapProtocol protocol);</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18">   /**</span>
<a href="#l3.19"></a><span id="l3.19">    * Prepare to retry the given URL.</span>
<a href="#l3.20"></a><span id="l3.20">    * @param imapUrl the url we're going to retry</span>
<a href="#l3.21"></a><span id="l3.21">    * @return channel to associate with the url. We return this because access</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -178,36 +178,16 @@ nsIMAPHostSessionList::AddHostToList(con</span>
<a href="#l4.4"></a><span id="l4.4">       newHost-&gt;fNextHost = fHostInfoList;</span>
<a href="#l4.5"></a><span id="l4.5">       fHostInfoList = newHost;</span>
<a href="#l4.6"></a><span id="l4.6">     }</span>
<a href="#l4.7"></a><span id="l4.7">   }</span>
<a href="#l4.8"></a><span id="l4.8">   PR_ExitMonitor(gCachedHostInfoMonitor);</span>
<a href="#l4.9"></a><span id="l4.9">   return (newHost == NULL) ? NS_ERROR_ILLEGAL_VALUE : NS_OK;</span>
<a href="#l4.10"></a><span id="l4.10"> }</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-NS_IMETHODIMP nsIMAPHostSessionList::GetCapabilityForHost(const char *serverKey, PRUint32 &amp;result)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-{</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-  PR_EnterMonitor(gCachedHostInfoMonitor);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-  nsIMAPHostInfo *host = FindHost(serverKey);</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-  result = (host) ? host-&gt;fCapabilityFlags : 0;</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-  PR_ExitMonitor(gCachedHostInfoMonitor);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-  return (host == NULL) ? NS_ERROR_ILLEGAL_VALUE : NS_OK;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-}</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-NS_IMETHODIMP nsIMAPHostSessionList::SetCapabilityForHost(const char *serverKey, PRUint32 capability)</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-{</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-  PR_EnterMonitor(gCachedHostInfoMonitor);</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-  nsIMAPHostInfo *host = FindHost(serverKey);</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-  if (host)</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-    host-&gt;fCapabilityFlags = capability;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-  PR_ExitMonitor(gCachedHostInfoMonitor);</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-  return (host == NULL) ? NS_ERROR_ILLEGAL_VALUE : NS_OK;</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-}</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-</span>
<a href="#l4.32"></a><span id="l4.32"> NS_IMETHODIMP nsIMAPHostSessionList::GetPasswordForHost(const char *serverKey, nsString &amp;result)</span>
<a href="#l4.33"></a><span id="l4.33"> {</span>
<a href="#l4.34"></a><span id="l4.34">   PR_EnterMonitor(gCachedHostInfoMonitor);</span>
<a href="#l4.35"></a><span id="l4.35">   nsIMAPHostInfo *host = FindHost(serverKey);</span>
<a href="#l4.36"></a><span id="l4.36">   if (host)</span>
<a href="#l4.37"></a><span id="l4.37">     CopyASCIItoUTF16(nsDependentCString(host-&gt;fCachedPassword), result);</span>
<a href="#l4.38"></a><span id="l4.38">   PR_ExitMonitor(gCachedHostInfoMonitor);</span>
<a href="#l4.39"></a><span id="l4.39">   return (host == NULL) ? NS_ERROR_ILLEGAL_VALUE : NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPHostSessionList.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPHostSessionList.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -54,17 +54,17 @@ public:</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">   nsIMAPHostInfo(const char *serverKey, nsIImapIncomingServer *server);</span>
<a href="#l5.6"></a><span id="l5.6">   ~nsIMAPHostInfo();</span>
<a href="#l5.7"></a><span id="l5.7"> protected:</span>
<a href="#l5.8"></a><span id="l5.8">   nsCString fServerKey;</span>
<a href="#l5.9"></a><span id="l5.9">   char *fCachedPassword;</span>
<a href="#l5.10"></a><span id="l5.10">   nsCString fOnlineDir;</span>
<a href="#l5.11"></a><span id="l5.11">   nsIMAPHostInfo *fNextHost;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  PRUint32 fCapabilityFlags;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  eIMAPCapabilityFlags fCapabilityFlags;</span>
<a href="#l5.14"></a><span id="l5.14">   char *fHierarchyDelimiters;// string of top-level hierarchy delimiters</span>
<a href="#l5.15"></a><span id="l5.15">   bool fHaveWeEverDiscoveredFolders;</span>
<a href="#l5.16"></a><span id="l5.16">   char *fCanonicalOnlineSubDir;</span>
<a href="#l5.17"></a><span id="l5.17">   nsIMAPNamespaceList *fNamespaceList, *fTempNamespaceList;</span>
<a href="#l5.18"></a><span id="l5.18">   bool fNamespacesOverridable;</span>
<a href="#l5.19"></a><span id="l5.19">   bool fUsingSubscription;</span>
<a href="#l5.20"></a><span id="l5.20">   bool fOnlineTrashFolderExists;</span>
<a href="#l5.21"></a><span id="l5.21">   bool fShouldAlwaysListInbox;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -87,18 +87,16 @@ public:</span>
<a href="#l5.23"></a><span id="l5.23">   virtual ~nsIMAPHostSessionList();</span>
<a href="#l5.24"></a><span id="l5.24">   nsresult Init();</span>
<a href="#l5.25"></a><span id="l5.25">   // Host List</span>
<a href="#l5.26"></a><span id="l5.26">   NS_IMETHOD AddHostToList(const char *serverKey, </span>
<a href="#l5.27"></a><span id="l5.27">                             nsIImapIncomingServer *server);</span>
<a href="#l5.28"></a><span id="l5.28">   NS_IMETHOD ResetAll();</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30">   // Capabilities</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-  NS_IMETHOD GetCapabilityForHost(const char *serverKey, PRUint32 &amp;result);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-  NS_IMETHOD SetCapabilityForHost(const char *serverKey, PRUint32 capability);</span>
<a href="#l5.33"></a><span id="l5.33">   NS_IMETHOD GetHostHasAdminURL(const char *serverKey, bool &amp;result);</span>
<a href="#l5.34"></a><span id="l5.34">   NS_IMETHOD SetHostHasAdminURL(const char *serverKey, bool hasAdminUrl);</span>
<a href="#l5.35"></a><span id="l5.35">   // Subscription</span>
<a href="#l5.36"></a><span id="l5.36">   NS_IMETHOD GetHostIsUsingSubscription(const char *serverKey, bool &amp;result);</span>
<a href="#l5.37"></a><span id="l5.37">   NS_IMETHOD SetHostIsUsingSubscription(const char *serverKey, bool usingSubscription);</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">   // Passwords</span>
<a href="#l5.40"></a><span id="l5.40">   NS_IMETHOD GetPasswordForHost(const char *serverKey, nsString &amp;result);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/imap/src/nsImapCore.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapCore.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -115,51 +115,68 @@ typedef enum {</span>
<a href="#l6.4"></a><span id="l6.4"> typedef enum {</span>
<a href="#l6.5"></a><span id="l6.5">     kPersonalNamespace = 0,</span>
<a href="#l6.6"></a><span id="l6.6">     kOtherUsersNamespace,</span>
<a href="#l6.7"></a><span id="l6.7">     kPublicNamespace,</span>
<a href="#l6.8"></a><span id="l6.8">     kDefaultNamespace,</span>
<a href="#l6.9"></a><span id="l6.9">     kUnknownNamespace</span>
<a href="#l6.10"></a><span id="l6.10"> } EIMAPNamespaceType;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-typedef enum {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-    kCapabilityUndefined = 0x00000000,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-    kCapabilityDefined = 0x00000001,</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-    kHasAuthLoginCapability = 0x00000002, /* AUTH LOGIN (not the same as kHasAuthOldLoginCapability) */</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-    kHasAuthOldLoginCapability = 0x00000004, /* original IMAP login method */</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-    kHasXSenderCapability = 0x00000008,</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-    kIMAP4Capability = 0x00000010,          /* RFC1734 */</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-    kIMAP4rev1Capability = 0x00000020,      /* RFC2060 */</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-    kIMAP4other = 0x00000040,                       /* future rev?? */</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-    kNoHierarchyRename = 0x00000080,                        /* no hierarchy rename */</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-    kACLCapability = 0x00000100,          /* ACL extension */</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-    kNamespaceCapability = 0x00000200,    /* IMAP4 Namespace Extension */</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-    kHasIDCapability = 0x00000400,  /* client user agent id extension */</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-    kXServerInfoCapability = 0x00000800,  /* XSERVERINFO extension for admin urls */</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-    kHasAuthPlainCapability = 0x00001000, /* new form of auth plain base64 login */</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-    kUidplusCapability = 0x00002000,   /* RFC 2359 UIDPLUS extension */</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-    kLiteralPlusCapability = 0x00004000, /* RFC 2088 LITERAL+ extension */</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-    kAOLImapCapability = 0x00008000,     /* aol imap extensions */</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-    kHasLanguageCapability = 0x00010000, /* language extensions */</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-    kHasCRAMCapability     = 0x00020000, /* CRAM auth extension */</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-    kQuotaCapability       = 0x00040000, /* RFC 2087 quota extension */</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-    kHasIdleCapability       = 0x00080000,  /* RFC 2177 idle extension */</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-    kHasAuthNTLMCapability = 0x00100000,  /* AUTH NTLM extension */</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-    kHasAuthMSNCapability = 0x00200000,   /* AUTH MSN extension */</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-    kHasStartTLSCapability = 0x00400000,   /* STARTTLS support */</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-    kHasAuthNoneCapability = 0x00800000, /* needs no login */</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-    kHasAuthGssApiCapability = 0x01000000, /* GSSAPI AUTH */</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-    kHasCondStoreCapability =  0x02000000, /* RFC 3551 CondStore extension */</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-    kHasEnableCapability    =  0x04000000, /* RFC 5161 ENABLE extension */</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-    kHasXListCapability    =  0x08000000,  /* XLIST extension */</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-    kHasCompressDeflateCapability  = 0x10000000,  /* RFC 4978 COMPRESS extension */</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-    kHasAuthExternalCapability  = 0x20000000,  /* RFC 2222 SASL AUTH EXTERNAL */</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">-    kHasMoveCapability  = 0x40000000,  /* Proposed MOVE RFC */</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-    kHasHighestModSeqCapability  = 0x80000000  /* Subset of RFC 3551 */</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-} eIMAPCapabilityFlag;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+/**</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+ * IMAP server feature, mostly CAPABILITY responses</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+ *</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+ * one of the cap flags below</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+ */</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+typedef PRUint64 eIMAPCapabilityFlag;</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+/**</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+ * IMAP server features, mostly CAPABILITY responses</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+ *</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+ * any set of the cap flags below, i.e.</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+ * i.e. 0, 1 or more |eIMAPCapabilityFlag|.</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+ */</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+typedef PRUint64 eIMAPCapabilityFlags;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+const eIMAPCapabilityFlag kCapabilityUndefined = 0x00000000;</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+const eIMAPCapabilityFlag kCapabilityDefined = 0x00000001;</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+const eIMAPCapabilityFlag kHasAuthLoginCapability = 0x00000002;  /* AUTH LOGIN (not the same as kHasAuthOldLoginCapability) */</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+const eIMAPCapabilityFlag kHasAuthOldLoginCapability = 0x00000004;  /* original IMAP login method */</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+const eIMAPCapabilityFlag kHasXSenderCapability = 0x00000008;</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+const eIMAPCapabilityFlag kIMAP4Capability = 0x00000010;           /* RFC1734 */</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+const eIMAPCapabilityFlag kIMAP4rev1Capability = 0x00000020;       /* RFC2060 */</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+const eIMAPCapabilityFlag kIMAP4other = 0x00000040;                        /* future rev?? */</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+const eIMAPCapabilityFlag kNoHierarchyRename = 0x00000080;                         /* no hierarchy rename */</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+const eIMAPCapabilityFlag kACLCapability = 0x00000100;           /* ACL extension */</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+const eIMAPCapabilityFlag kNamespaceCapability = 0x00000200;     /* IMAP4 Namespace Extension */</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+const eIMAPCapabilityFlag kHasIDCapability = 0x00000400;  /* client user agent id extension */</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+const eIMAPCapabilityFlag kXServerInfoCapability = 0x00000800;  /* XSERVERINFO extension for admin urls */</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+const eIMAPCapabilityFlag kHasAuthPlainCapability = 0x00001000; /* new form of auth plain base64 login */</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+const eIMAPCapabilityFlag kUidplusCapability = 0x00002000;   /* RFC 2359 UIDPLUS extension */</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+const eIMAPCapabilityFlag kLiteralPlusCapability = 0x00004000; /* RFC 2088 LITERAL+ extension */</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+const eIMAPCapabilityFlag kAOLImapCapability = 0x00008000;     /* aol imap extensions */</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+const eIMAPCapabilityFlag kHasLanguageCapability = 0x00010000; /* language extensions */</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+const eIMAPCapabilityFlag kHasCRAMCapability = 0x00020000; /* CRAM auth extension */</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+const eIMAPCapabilityFlag kQuotaCapability = 0x00040000; /* RFC 2087 quota extension */</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+const eIMAPCapabilityFlag kHasIdleCapability = 0x00080000;  /* RFC 2177 idle extension */</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+const eIMAPCapabilityFlag kHasAuthNTLMCapability = 0x00100000;  /* AUTH NTLM extension */</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+const eIMAPCapabilityFlag kHasAuthMSNCapability = 0x00200000;   /* AUTH MSN extension */</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+const eIMAPCapabilityFlag kHasStartTLSCapability =0x00400000;   /* STARTTLS support */</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+const eIMAPCapabilityFlag kHasAuthNoneCapability = 0x00800000; /* needs no login */</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+const eIMAPCapabilityFlag kHasAuthGssApiCapability = 0x01000000; /* GSSAPI AUTH */</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+const eIMAPCapabilityFlag kHasCondStoreCapability = 0x02000000; /* RFC 3551 CondStore extension */</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+const eIMAPCapabilityFlag kHasEnableCapability = 0x04000000; /* RFC 5161 ENABLE extension */</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+const eIMAPCapabilityFlag kHasXListCapability = 0x08000000;  /* XLIST extension */</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineplus">+const eIMAPCapabilityFlag kHasCompressDeflateCapability = 0x10000000;  /* RFC 4978 COMPRESS extension */</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineplus">+const eIMAPCapabilityFlag kHasAuthExternalCapability = 0x20000000;  /* RFC 2222 SASL AUTH EXTERNAL */</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineplus">+const eIMAPCapabilityFlag kHasMoveCapability = 0x40000000;  /* Proposed MOVE RFC */</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineplus">+const eIMAPCapabilityFlag kHasHighestModSeqCapability = 0x80000000;  /* Subset of RFC 3551 */</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+// above are 32bit; below start the PRUint64 bits 33-64</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+const eIMAPCapabilityFlag kHasExtendedListCapability = 0x100000000LL;  /* RFC 5258 */</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+const eIMAPCapabilityFlag kHasSpecialUseCapability = 0x200000000LL;  /* RFC 6154: Sent, Draft etc. folders */</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+</span>
<a href="#l6.99"></a><span id="l6.99"> </span>
<a href="#l6.100"></a><span id="l6.100"> // this used to be part of the connection object class - maybe we should move it into </span>
<a href="#l6.101"></a><span id="l6.101"> // something similar</span>
<a href="#l6.102"></a><span id="l6.102"> typedef enum {</span>
<a href="#l6.103"></a><span id="l6.103">     kEveryThingRFC822,</span>
<a href="#l6.104"></a><span id="l6.104">     kEveryThingRFC822Peek,</span>
<a href="#l6.105"></a><span id="l6.105">     kHeadersRFC822andUid,</span>
<a href="#l6.106"></a><span id="l6.106">     kUid,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -170,20 +170,16 @@ NS_IMETHODIMP nsImapIncomingServer::SetK</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">   if (!publicNamespace.IsEmpty())</span>
<a href="#l7.6"></a><span id="l7.6">       hostSession-&gt;SetNamespaceFromPrefForHost(key.get(), publicNamespace.get(),</span>
<a href="#l7.7"></a><span id="l7.7">                                                kPublicNamespace);</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">   if (!otherUsersNamespace.IsEmpty())</span>
<a href="#l7.10"></a><span id="l7.10">       hostSession-&gt;SetNamespaceFromPrefForHost(key.get(), otherUsersNamespace.get(),</span>
<a href="#l7.11"></a><span id="l7.11">                                                kOtherUsersNamespace);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  PRInt32 capability;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-  rv = GetCapabilityPref(&amp;capability);</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-  hostSession-&gt;SetCapabilityForHost(key.get(), capability);</span>
<a href="#l7.16"></a><span id="l7.16">   return rv;</span>
<a href="#l7.17"></a><span id="l7.17"> }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19"> // construct the pretty name to show to the user if they haven't</span>
<a href="#l7.20"></a><span id="l7.20"> // specified one. This should be overridden for news and mail.</span>
<a href="#l7.21"></a><span id="l7.21"> NS_IMETHODIMP</span>
<a href="#l7.22"></a><span id="l7.22"> nsImapIncomingServer::GetConstructedPrettyName(nsAString&amp; retval)</span>
<a href="#l7.23"></a><span id="l7.23"> {</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -394,19 +390,16 @@ nsImapIncomingServer::SetDeleteModel(PRI</span>
<a href="#l7.25"></a><span id="l7.25">     }</span>
<a href="#l7.26"></a><span id="l7.26">   }</span>
<a href="#l7.27"></a><span id="l7.27">   return rv;</span>
<a href="#l7.28"></a><span id="l7.28"> }</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30"> NS_IMPL_SERVERPREF_INT(nsImapIncomingServer, TimeOutLimits,</span>
<a href="#l7.31"></a><span id="l7.31">                        &quot;timeout&quot;)</span>
<a href="#l7.32"></a><span id="l7.32"> </span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-NS_IMPL_SERVERPREF_INT(nsImapIncomingServer, CapabilityPref,</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-                       &quot;capability&quot;)</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-</span>
<a href="#l7.36"></a><span id="l7.36"> NS_IMPL_SERVERPREF_STR(nsImapIncomingServer, ServerIDPref,</span>
<a href="#l7.37"></a><span id="l7.37">                        &quot;serverIDResponse&quot;)</span>
<a href="#l7.38"></a><span id="l7.38"> </span>
<a href="#l7.39"></a><span id="l7.39"> NS_IMPL_SERVERPREF_STR(nsImapIncomingServer, PersonalNamespace,</span>
<a href="#l7.40"></a><span id="l7.40">                        &quot;namespace.personal&quot;)</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42"> NS_IMPL_SERVERPREF_STR(nsImapIncomingServer, PublicNamespace,</span>
<a href="#l7.43"></a><span id="l7.43">                        &quot;namespace.public&quot;)</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineat">@@ -418,16 +411,21 @@ NS_IMPL_SERVERPREF_BOOL(nsImapIncomingSe</span>
<a href="#l7.45"></a><span id="l7.45">                        &quot;fetch_by_chunks&quot;)</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47"> NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, MimePartsOnDemand,</span>
<a href="#l7.48"></a><span id="l7.48">                        &quot;mime_parts_on_demand&quot;)</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50"> NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, SendID,</span>
<a href="#l7.51"></a><span id="l7.51">                        &quot;send_client_info&quot;)</span>
<a href="#l7.52"></a><span id="l7.52"> </span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, CapabilityACL,</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+                       &quot;cacheCapa.acl&quot;)</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, CapabilityQuota,</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+                       &quot;cacheCapa.quota&quot;)</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+</span>
<a href="#l7.58"></a><span id="l7.58"> NS_IMETHODIMP</span>
<a href="#l7.59"></a><span id="l7.59"> nsImapIncomingServer::GetIsAOLServer(bool *aBool)</span>
<a href="#l7.60"></a><span id="l7.60"> {</span>
<a href="#l7.61"></a><span id="l7.61">   NS_ENSURE_ARG_POINTER(aBool);</span>
<a href="#l7.62"></a><span id="l7.62">   *aBool = ((m_capability &amp; kAOLImapCapability) != 0);</span>
<a href="#l7.63"></a><span id="l7.63">   return NS_OK;</span>
<a href="#l7.64"></a><span id="l7.64"> }</span>
<a href="#l7.65"></a><span id="l7.65"> </span>
<a href="#l7.66"></a><span id="l7.66" class="difflineat">@@ -2204,20 +2202,21 @@ nsImapIncomingServer::PromptPassword(nsI</span>
<a href="#l7.67"></a><span id="l7.67"> </span>
<a href="#l7.68"></a><span id="l7.68">   rv = GetPasswordWithUI(passwordText, passwordTitle, aMsgWindow, aPassword);</span>
<a href="#l7.69"></a><span id="l7.69">   if (NS_SUCCEEDED(rv))</span>
<a href="#l7.70"></a><span id="l7.70">     m_password = aPassword;</span>
<a href="#l7.71"></a><span id="l7.71">   return rv;</span>
<a href="#l7.72"></a><span id="l7.72"> }</span>
<a href="#l7.73"></a><span id="l7.73"> </span>
<a href="#l7.74"></a><span id="l7.74"> // for the nsIImapServerSink interface</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-NS_IMETHODIMP nsImapIncomingServer::SetCapability(PRUint32 capability)</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+NS_IMETHODIMP nsImapIncomingServer::SetCapability(eIMAPCapabilityFlags capability)</span>
<a href="#l7.77"></a><span id="l7.77"> {</span>
<a href="#l7.78"></a><span id="l7.78">   m_capability = capability;</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-  SetCapabilityPref(capability);</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+  SetCapabilityACL(capability &amp; kACLCapability);</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+  SetCapabilityQuota(capability &amp; kQuotaCapability);</span>
<a href="#l7.82"></a><span id="l7.82">   return NS_OK;</span>
<a href="#l7.83"></a><span id="l7.83"> }</span>
<a href="#l7.84"></a><span id="l7.84"> </span>
<a href="#l7.85"></a><span id="l7.85"> NS_IMETHODIMP nsImapIncomingServer::SetServerID(const nsACString &amp;aServerID)</span>
<a href="#l7.86"></a><span id="l7.86"> {</span>
<a href="#l7.87"></a><span id="l7.87">   return SetServerIDPref(aServerID);</span>
<a href="#l7.88"></a><span id="l7.88"> }</span>
<a href="#l7.89"></a><span id="l7.89"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -132,17 +132,17 @@ private:</span>
<a href="#l8.4"></a><span id="l8.4">                             PRUint32 folderFlag, nsCString &amp;existingUri);</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6">   nsCOMArray&lt;nsIImapProtocol&gt; m_connectionCache;</span>
<a href="#l8.7"></a><span id="l8.7">   nsCOMArray&lt;nsIImapUrl&gt; m_urlQueue;</span>
<a href="#l8.8"></a><span id="l8.8">   nsCOMPtr&lt;nsIStringBundle&gt;	m_stringBundle;</span>
<a href="#l8.9"></a><span id="l8.9">   nsCOMArray&lt;nsIMsgFolder&gt; m_subscribeFolders; // used to keep folder resources around while subscribe UI is up.</span>
<a href="#l8.10"></a><span id="l8.10">   nsCOMArray&lt;nsIMsgImapMailFolder&gt; m_foldersToStat; // folders to check for new mail with Status</span>
<a href="#l8.11"></a><span id="l8.11">   nsVoidArray       m_urlConsumers;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  PRUint32          m_capability;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  eIMAPCapabilityFlags          m_capability;</span>
<a href="#l8.14"></a><span id="l8.14">   nsCString         m_manageMailAccountUrl;</span>
<a href="#l8.15"></a><span id="l8.15">   bool              m_userAuthenticated;</span>
<a href="#l8.16"></a><span id="l8.16">   bool              mDoingSubscribeDialog;</span>
<a href="#l8.17"></a><span id="l8.17">   bool              mDoingLsub;</span>
<a href="#l8.18"></a><span id="l8.18">   bool              m_shuttingDown;</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">   mozilla::Mutex mLock;</span>
<a href="#l8.21"></a><span id="l8.21">   // subscribe dialog stuff</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -5926,29 +5926,31 @@ nsImapMailFolder::FillInFolderProps(nsIM</span>
<a href="#l9.4"></a><span id="l9.4">   nsString folderType;</span>
<a href="#l9.5"></a><span id="l9.5">   nsString folderTypeDesc;</span>
<a href="#l9.6"></a><span id="l9.6">   nsString folderQuotaStatusDesc;</span>
<a href="#l9.7"></a><span id="l9.7">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l9.8"></a><span id="l9.8">   nsresult rv = IMAPGetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l9.9"></a><span id="l9.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11">   // get the host session list and get server capabilities.</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  PRUint32 capability = kCapabilityUndefined;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-  nsCOMPtr&lt;nsIImapHostSessionList&gt; hostSession = do_GetService(kCImapHostSessionList, &amp;rv);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+  eIMAPCapabilityFlags capability = kCapabilityUndefined;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+  nsCOMPtr&lt;nsIImapIncomingServer&gt; imapServer;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+  rv = GetImapIncomingServer(getter_AddRefs(imapServer));</span>
<a href="#l9.19"></a><span id="l9.19">   // if for some bizarre reason this fails, we'll still fall through to the normal sharing code</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; hostSession)</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-  {</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-    nsCString serverKey;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-    GetServerKey(serverKey);</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-    hostSession-&gt;GetCapabilityForHost(serverKey.get(), capability);</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+  if (NS_SUCCEEDED(rv))</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  {</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+    bool haveACL = false;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+    bool haveQuota = false;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+    imapServer-&gt;GetCapabilityACL(&amp;haveACL);</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+    imapServer-&gt;GetCapabilityQuota(&amp;haveQuota);</span>
<a href="#l9.31"></a><span id="l9.31"> </span>
<a href="#l9.32"></a><span id="l9.32">     // Figure out what to display in the Quota tab of the folder properties.</span>
<a href="#l9.33"></a><span id="l9.33">     // Does the server support quotas?</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">-    if(capability &amp; kQuotaCapability)</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+    if (haveQuota)</span>
<a href="#l9.36"></a><span id="l9.36">     {</span>
<a href="#l9.37"></a><span id="l9.37">       // Have we asked the server for quota information?</span>
<a href="#l9.38"></a><span id="l9.38">       if(m_folderQuotaCommandIssued)</span>
<a href="#l9.39"></a><span id="l9.39">       {</span>
<a href="#l9.40"></a><span id="l9.40">         // Has the server replied with storage quota info?</span>
<a href="#l9.41"></a><span id="l9.41">         if(m_folderQuotaDataIsValid)</span>
<a href="#l9.42"></a><span id="l9.42">         {</span>
<a href="#l9.43"></a><span id="l9.43">           // If so, set quota data</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineat">@@ -5989,17 +5991,17 @@ nsImapMailFolder::FillInFolderProps(nsIM</span>
<a href="#l9.45"></a><span id="l9.45">       rv = IMAPGetStringByID(folderQuotaStatusStringID, getter_Copies(folderQuotaStatusDesc));</span>
<a href="#l9.46"></a><span id="l9.46">       if (NS_SUCCEEDED(rv))</span>
<a href="#l9.47"></a><span id="l9.47">         aFolderProps-&gt;SetQuotaStatus(folderQuotaStatusDesc);</span>
<a href="#l9.48"></a><span id="l9.48">     }</span>
<a href="#l9.49"></a><span id="l9.49"> </span>
<a href="#l9.50"></a><span id="l9.50">     // See if the server supports ACL.</span>
<a href="#l9.51"></a><span id="l9.51">     // If not, just set the folder description to a string that says</span>
<a href="#l9.52"></a><span id="l9.52">     // the server doesn't support sharing, and return.</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-    if (! (capability &amp; kACLCapability))</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+    if (!haveACL)</span>
<a href="#l9.55"></a><span id="l9.55">     {</span>
<a href="#l9.56"></a><span id="l9.56">       rv = IMAPGetStringByID(IMAP_SERVER_DOESNT_SUPPORT_ACL, getter_Copies(folderTypeDesc));</span>
<a href="#l9.57"></a><span id="l9.57">       if (NS_SUCCEEDED(rv))</span>
<a href="#l9.58"></a><span id="l9.58">         aFolderProps-&gt;SetFolderTypeDescription(folderTypeDesc);</span>
<a href="#l9.59"></a><span id="l9.59">       aFolderProps-&gt;ServerDoesntSupportACL();</span>
<a href="#l9.60"></a><span id="l9.60">       return NS_OK;</span>
<a href="#l9.61"></a><span id="l9.61">     }</span>
<a href="#l9.62"></a><span id="l9.62">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -747,20 +747,16 @@ nsresult nsImapProtocol::SetupWithUrl(ns</span>
<a href="#l10.4"></a><span id="l10.4">     // we need to turn it into a proxy object....we'll assume that the listener is on the same thread</span>
<a href="#l10.5"></a><span id="l10.5">     // as the event sink queue</span>
<a href="#l10.6"></a><span id="l10.6">     if (aRealStreamListener)</span>
<a href="#l10.7"></a><span id="l10.7">     {</span>
<a href="#l10.8"></a><span id="l10.8">       NS_ASSERTION(!m_channelListener, &quot;shouldn't already have a channel listener&quot;);</span>
<a href="#l10.9"></a><span id="l10.9">       m_channelListener = new StreamListenerProxy(aRealStreamListener);</span>
<a href="#l10.10"></a><span id="l10.10">     }</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    PRUint32 capability = kCapabilityUndefined;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-    m_hostSessionList-&gt;GetCapabilityForHost(GetImapServerKey(), capability);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-</span>
<a href="#l10.16"></a><span id="l10.16">     server-&gt;GetRealHostName(m_realHostName);</span>
<a href="#l10.17"></a><span id="l10.17">     PRInt32 authMethod;</span>
<a href="#l10.18"></a><span id="l10.18">     (void) server-&gt;GetAuthMethod(&amp;authMethod);</span>
<a href="#l10.19"></a><span id="l10.19">     InitPrefAuthMethods(authMethod);</span>
<a href="#l10.20"></a><span id="l10.20">     (void) server-&gt;GetSocketType(&amp;m_socketType);</span>
<a href="#l10.21"></a><span id="l10.21">     bool shuttingDown;</span>
<a href="#l10.22"></a><span id="l10.22">     (void) imapServer-&gt;GetShuttingDown(&amp;shuttingDown);</span>
<a href="#l10.23"></a><span id="l10.23">     if (!shuttingDown)</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineat">@@ -809,19 +805,17 @@ nsresult nsImapProtocol::SetupWithUrl(ns</span>
<a href="#l10.25"></a><span id="l10.25">         aURL-&gt;GetPort(&amp;port);</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27">         Log(&quot;SetupWithUrl&quot;, nsnull, &quot;clearing IMAP_CONNECTION_IS_OPEN&quot;);</span>
<a href="#l10.28"></a><span id="l10.28">         ClearFlag(IMAP_CONNECTION_IS_OPEN);</span>
<a href="#l10.29"></a><span id="l10.29">         const char *connectionType = nsnull;</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31">         if (m_socketType == nsMsgSocketType::SSL)</span>
<a href="#l10.32"></a><span id="l10.32">           connectionType = &quot;ssl&quot;;</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-        else if ((m_socketType == nsMsgSocketType::trySTARTTLS &amp;&amp;</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-                 (capability &amp; kHasStartTLSCapability))</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-                 || m_socketType == nsMsgSocketType::alwaysSTARTTLS)</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+        else if (m_socketType == nsMsgSocketType::alwaysSTARTTLS)</span>
<a href="#l10.37"></a><span id="l10.37">           connectionType = &quot;starttls&quot;;</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39">         nsCOMPtr&lt;nsIProxyInfo&gt; proxyInfo;</span>
<a href="#l10.40"></a><span id="l10.40">         rv = MsgExamineForProxy(&quot;imap&quot;, m_realHostName.get(), port, getter_AddRefs(proxyInfo));</span>
<a href="#l10.41"></a><span id="l10.41">         if (NS_FAILED(rv))</span>
<a href="#l10.42"></a><span id="l10.42">           proxyInfo = nsnull;</span>
<a href="#l10.43"></a><span id="l10.43"> </span>
<a href="#l10.44"></a><span id="l10.44">         const nsACString *socketHost;</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineat">@@ -1654,29 +1648,36 @@ bool nsImapProtocol::ProcessCurrentURL()</span>
<a href="#l10.46"></a><span id="l10.46">             {</span>
<a href="#l10.47"></a><span id="l10.47">               nsCOMPtr&lt;nsISSLSocketControl&gt; sslControl = do_QueryInterface(secInfo, &amp;rv);</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49">               if (NS_SUCCEEDED(rv) &amp;&amp; sslControl)</span>
<a href="#l10.50"></a><span id="l10.50">               {</span>
<a href="#l10.51"></a><span id="l10.51">                 rv = sslControl-&gt;StartTLS();</span>
<a href="#l10.52"></a><span id="l10.52">                 if (NS_SUCCEEDED(rv))</span>
<a href="#l10.53"></a><span id="l10.53">                 {</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+                  // Upgrade &quot;trySTARTTLS&quot; accounts to &quot;alwaysSTARTTLS&quot; in prefs</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+                  if (m_socketType == nsMsgSocketType::trySTARTTLS)</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+                  {</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+                    nsCOMPtr&lt;nsIMsgIncomingServer&gt; imapServer =</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+                        do_QueryReferent(m_server);</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+                    imapServer-&gt;SetSocketType(nsMsgSocketType::alwaysSTARTTLS);</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+                  }</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+</span>
<a href="#l10.62"></a><span id="l10.62">                   // force re-issue of &quot;capability&quot;, because servers may</span>
<a href="#l10.63"></a><span id="l10.63">                   // enable other auth features (e.g. remove LOGINDISABLED</span>
<a href="#l10.64"></a><span id="l10.64">                   // and add AUTH=PLAIN) after we upgraded to SSL.</span>
<a href="#l10.65"></a><span id="l10.65">                   Capability();</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-                  PRInt32 capabilityFlag = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+                  eIMAPCapabilityFlags capabilityFlag = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.68"></a><span id="l10.68">                   // Courier imap doesn't return STARTTLS capability if we've done</span>
<a href="#l10.69"></a><span id="l10.69">                   // a STARTTLS! But we need to remember this capability so we'll</span>
<a href="#l10.70"></a><span id="l10.70">                   // try to use STARTTLS next time.</span>
<a href="#l10.71"></a><span id="l10.71">                   if (!(capabilityFlag &amp; kHasStartTLSCapability))</span>
<a href="#l10.72"></a><span id="l10.72">                   {</span>
<a href="#l10.73"></a><span id="l10.73">                     capabilityFlag |= kHasStartTLSCapability;</span>
<a href="#l10.74"></a><span id="l10.74">                     GetServerStateParser().SetCapabilityFlag(capabilityFlag);</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-                    m_hostSessionList-&gt;SetCapabilityForHost(GetImapServerKey(), capabilityFlag);</span>
<a href="#l10.76"></a><span id="l10.76">                     CommitCapability();</span>
<a href="#l10.77"></a><span id="l10.77">                   }</span>
<a href="#l10.78"></a><span id="l10.78">                 }</span>
<a href="#l10.79"></a><span id="l10.79">               }</span>
<a href="#l10.80"></a><span id="l10.80">             }</span>
<a href="#l10.81"></a><span id="l10.81">             if (NS_FAILED(rv))</span>
<a href="#l10.82"></a><span id="l10.82">             {</span>
<a href="#l10.83"></a><span id="l10.83">               nsCAutoString logLine(&quot;STARTTLS negotiation failed. Error 0x&quot;);</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineat">@@ -3364,17 +3365,17 @@ nsImapProtocol::FetchMessage(const nsCSt</span>
<a href="#l10.85"></a><span id="l10.85">     }</span>
<a href="#l10.86"></a><span id="l10.86">     commandString.Append(&quot;)&quot;);</span>
<a href="#l10.87"></a><span id="l10.87"> </span>
<a href="#l10.88"></a><span id="l10.88">     break;</span>
<a href="#l10.89"></a><span id="l10.89"> </span>
<a href="#l10.90"></a><span id="l10.90">   case kEveryThingRFC822Peek:</span>
<a href="#l10.91"></a><span id="l10.91">     {</span>
<a href="#l10.92"></a><span id="l10.92">       const char *formatString = &quot;&quot;;</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-      PRUint32 server_capabilityFlags = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+      eIMAPCapabilityFlags server_capabilityFlags = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.95"></a><span id="l10.95"> </span>
<a href="#l10.96"></a><span id="l10.96">       GetServerStateParser().SetFetchingEverythingRFC822(true);</span>
<a href="#l10.97"></a><span id="l10.97">       if (server_capabilityFlags &amp; kIMAP4rev1Capability)</span>
<a href="#l10.98"></a><span id="l10.98">       {</span>
<a href="#l10.99"></a><span id="l10.99">         // use body[].peek since rfc822.peek is not in IMAP4rev1</span>
<a href="#l10.100"></a><span id="l10.100">         if (server_capabilityFlags &amp; kHasXSenderCapability)</span>
<a href="#l10.101"></a><span id="l10.101">           formatString = &quot; %s (XSENDER UID RFC822.SIZE BODY.PEEK[]&quot;;</span>
<a href="#l10.102"></a><span id="l10.102">         else</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineat">@@ -3400,17 +3401,17 @@ nsImapProtocol::FetchMessage(const nsCSt</span>
<a href="#l10.104"></a><span id="l10.104">         }</span>
<a href="#l10.105"></a><span id="l10.105">       }</span>
<a href="#l10.106"></a><span id="l10.106">       commandString.Append(&quot;)&quot;);</span>
<a href="#l10.107"></a><span id="l10.107">     }</span>
<a href="#l10.108"></a><span id="l10.108">     break;</span>
<a href="#l10.109"></a><span id="l10.109">   case kHeadersRFC822andUid:</span>
<a href="#l10.110"></a><span id="l10.110">     if (GetServerStateParser().ServerHasIMAP4Rev1Capability())</span>
<a href="#l10.111"></a><span id="l10.111">     {</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">-      PRUint32 server_capabilityFlags = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+      eIMAPCapabilityFlags server_capabilityFlags = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.114"></a><span id="l10.114">       bool aolImapServer = ((server_capabilityFlags &amp; kAOLImapCapability) != 0);</span>
<a href="#l10.115"></a><span id="l10.115">       bool downloadAllHeaders = false;</span>
<a href="#l10.116"></a><span id="l10.116">       // checks if we're filtering on &quot;any header&quot; or running a spam filter requiring all headers</span>
<a href="#l10.117"></a><span id="l10.117">       GetShouldDownloadAllHeaders(&amp;downloadAllHeaders);</span>
<a href="#l10.118"></a><span id="l10.118"> </span>
<a href="#l10.119"></a><span id="l10.119">       if (!downloadAllHeaders)  // if it's ok -- no filters on any header, etc.</span>
<a href="#l10.120"></a><span id="l10.120">       {</span>
<a href="#l10.121"></a><span id="l10.121">         char *headersToDL = nsnull;</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineat">@@ -5337,21 +5338,20 @@ void nsImapProtocol::Capability()</span>
<a href="#l10.123"></a><span id="l10.123"> </span>
<a href="#l10.124"></a><span id="l10.124">     command.Append(&quot; capability&quot; CRLF);</span>
<a href="#l10.125"></a><span id="l10.125"> </span>
<a href="#l10.126"></a><span id="l10.126">     nsresult rv = SendData(command.get());</span>
<a href="#l10.127"></a><span id="l10.127">     if (NS_SUCCEEDED(rv))</span>
<a href="#l10.128"></a><span id="l10.128">         ParseIMAPandCheckForNewMail();</span>
<a href="#l10.129"></a><span id="l10.129">     if (!gUseLiteralPlus)</span>
<a href="#l10.130"></a><span id="l10.130">     {</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-      PRUint32 capabilityFlag = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+      eIMAPCapabilityFlags capabilityFlag = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.133"></a><span id="l10.133">       if (capabilityFlag &amp; kLiteralPlusCapability)</span>
<a href="#l10.134"></a><span id="l10.134">       {</span>
<a href="#l10.135"></a><span id="l10.135">         GetServerStateParser().SetCapabilityFlag(capabilityFlag &amp; ~kLiteralPlusCapability);</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineminus">-        m_hostSessionList-&gt;SetCapabilityForHost(GetImapServerKey(), capabilityFlag &amp; ~kLiteralPlusCapability);</span>
<a href="#l10.137"></a><span id="l10.137">       }</span>
<a href="#l10.138"></a><span id="l10.138">     }</span>
<a href="#l10.139"></a><span id="l10.139"> }</span>
<a href="#l10.140"></a><span id="l10.140"> </span>
<a href="#l10.141"></a><span id="l10.141"> void nsImapProtocol::ID()</span>
<a href="#l10.142"></a><span id="l10.142"> {</span>
<a href="#l10.143"></a><span id="l10.143">   if (!gAppName[0])</span>
<a href="#l10.144"></a><span id="l10.144">     return;</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineat">@@ -5542,18 +5542,18 @@ void nsImapProtocol::InitPrefAuthMethods</span>
<a href="#l10.146"></a><span id="l10.146"> </span>
<a href="#l10.147"></a><span id="l10.147"> /**</span>
<a href="#l10.148"></a><span id="l10.148">  * Changes m_currentAuthMethod to pick the best remaining one</span>
<a href="#l10.149"></a><span id="l10.149">  * which is allowed by server and prefs and not marked failed.</span>
<a href="#l10.150"></a><span id="l10.150">  * The order of preference and trying of auth methods is encoded here.</span>
<a href="#l10.151"></a><span id="l10.151">  */</span>
<a href="#l10.152"></a><span id="l10.152"> nsresult nsImapProtocol::ChooseAuthMethod()</span>
<a href="#l10.153"></a><span id="l10.153"> {</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineminus">-  PRInt32 serverCaps = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineminus">-  PRInt32 availCaps = serverCaps &amp; m_prefAuthMethods &amp; ~m_failedAuthMethods;</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineplus">+  eIMAPCapabilityFlags serverCaps = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineplus">+  eIMAPCapabilityFlags availCaps = serverCaps &amp; m_prefAuthMethods &amp; ~m_failedAuthMethods;</span>
<a href="#l10.158"></a><span id="l10.158"> </span>
<a href="#l10.159"></a><span id="l10.159">   PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;IMAP auth: server caps 0x%X, pref 0x%X, failed 0x%X, avail caps 0x%X&quot;,</span>
<a href="#l10.160"></a><span id="l10.160">         serverCaps, m_prefAuthMethods, m_failedAuthMethods, availCaps));</span>
<a href="#l10.161"></a><span id="l10.161">   PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;(GSSAPI = 0x%X, CRAM = 0x%X, NTLM = 0x%X, &quot;</span>
<a href="#l10.162"></a><span id="l10.162">         &quot;MSN =  0x%X, PLAIN = 0x%X, LOGIN = 0x%X, old-style IMAP login = 0x%X)&quot;</span>
<a href="#l10.163"></a><span id="l10.163">         &quot;auth external IMAP login = 0x%X&quot;,</span>
<a href="#l10.164"></a><span id="l10.164">         kHasAuthGssApiCapability, kHasCRAMCapability, kHasAuthNTLMCapability,</span>
<a href="#l10.165"></a><span id="l10.165">         kHasAuthMSNCapability, kHasAuthPlainCapability, kHasAuthLoginCapability,</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineat">@@ -5580,17 +5580,17 @@ nsresult nsImapProtocol::ChooseAuthMetho</span>
<a href="#l10.167"></a><span id="l10.167">     PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;no remaining auth method&quot;));</span>
<a href="#l10.168"></a><span id="l10.168">     m_currentAuthMethod = kCapabilityUndefined;</span>
<a href="#l10.169"></a><span id="l10.169">     return NS_ERROR_FAILURE;</span>
<a href="#l10.170"></a><span id="l10.170">   }</span>
<a href="#l10.171"></a><span id="l10.171">   PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;trying auth method 0x%X&quot;, m_currentAuthMethod));</span>
<a href="#l10.172"></a><span id="l10.172">   return NS_OK;</span>
<a href="#l10.173"></a><span id="l10.173"> }</span>
<a href="#l10.174"></a><span id="l10.174"> </span>
<a href="#l10.175"></a><span id="l10.175" class="difflineminus">-void nsImapProtocol::MarkAuthMethodAsFailed(PRInt32 failedAuthMethod)</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineplus">+void nsImapProtocol::MarkAuthMethodAsFailed(eIMAPCapabilityFlags failedAuthMethod)</span>
<a href="#l10.177"></a><span id="l10.177"> {</span>
<a href="#l10.178"></a><span id="l10.178">   PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;marking auth method 0x%X failed&quot;, failedAuthMethod));</span>
<a href="#l10.179"></a><span id="l10.179">   m_failedAuthMethods |= failedAuthMethod;</span>
<a href="#l10.180"></a><span id="l10.180"> }</span>
<a href="#l10.181"></a><span id="l10.181"> </span>
<a href="#l10.182"></a><span id="l10.182"> /**</span>
<a href="#l10.183"></a><span id="l10.183">  * Start over, trying all auth methods again</span>
<a href="#l10.184"></a><span id="l10.184">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -492,17 +492,17 @@ private:</span>
<a href="#l11.4"></a><span id="l11.4">   const char *GetServerCommandTag();</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">   void StartTLS();</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8">   // login related methods.</span>
<a href="#l11.9"></a><span id="l11.9">   nsresult GetPassword(nsCString &amp;password, bool aNewPasswordRequested);</span>
<a href="#l11.10"></a><span id="l11.10">   void InitPrefAuthMethods(PRInt32 authMethodPrefValue);</span>
<a href="#l11.11"></a><span id="l11.11">   nsresult ChooseAuthMethod();</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  void MarkAuthMethodAsFailed(PRInt32 failedAuthMethod);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  void MarkAuthMethodAsFailed(eIMAPCapabilityFlags failedAuthMethod);</span>
<a href="#l11.14"></a><span id="l11.14">   void ResetAuthMethods();</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16">   // All of these methods actually issue protocol</span>
<a href="#l11.17"></a><span id="l11.17">   void Capability(); // query host for capabilities.</span>
<a href="#l11.18"></a><span id="l11.18">   void ID(); // send RFC 2971 app info to server</span>
<a href="#l11.19"></a><span id="l11.19">   void EnableCondStore(); </span>
<a href="#l11.20"></a><span id="l11.20">   void StartCompressDeflate();</span>
<a href="#l11.21"></a><span id="l11.21">   nsresult BeginCompressing();</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -618,18 +618,18 @@ private:</span>
<a href="#l11.23"></a><span id="l11.23">   PRInt32 m_tooFastTime;</span>
<a href="#l11.24"></a><span id="l11.24">   PRInt32 m_idealTime;</span>
<a href="#l11.25"></a><span id="l11.25">   PRInt32 m_chunkAddSize;</span>
<a href="#l11.26"></a><span id="l11.26">   PRInt32 m_chunkStartSize;</span>
<a href="#l11.27"></a><span id="l11.27">   bool    m_fetchByChunks;</span>
<a href="#l11.28"></a><span id="l11.28">   bool    m_sendID;</span>
<a href="#l11.29"></a><span id="l11.29">   PRInt32 m_curFetchSize;</span>
<a href="#l11.30"></a><span id="l11.30">   bool    m_ignoreExpunges;</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  PRInt32 m_prefAuthMethods; // set of capability flags (in nsImapCore.h) for auth methods</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-  PRInt32 m_failedAuthMethods; // ditto</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+  eIMAPCapabilityFlags m_prefAuthMethods; // set of capability flags (in nsImapCore.h) for auth methods</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  eIMAPCapabilityFlags m_failedAuthMethods; // ditto</span>
<a href="#l11.35"></a><span id="l11.35">   eIMAPCapabilityFlag m_currentAuthMethod; // exactly one capability flag, or 0</span>
<a href="#l11.36"></a><span id="l11.36">   PRInt32 m_socketType;</span>
<a href="#l11.37"></a><span id="l11.37">   PRInt32 m_chunkSize;</span>
<a href="#l11.38"></a><span id="l11.38">   PRInt32 m_chunkThreshold;</span>
<a href="#l11.39"></a><span id="l11.39">   nsRefPtr &lt;nsMsgImapLineDownloadCache&gt; m_downloadLineCache;</span>
<a href="#l11.40"></a><span id="l11.40">   nsRefPtr &lt;nsMsgImapHdrXferInfo&gt; m_hdrDownloadCache;</span>
<a href="#l11.41"></a><span id="l11.41">   nsCOMPtr &lt;nsIImapHeaderInfo&gt; m_curHdrInfo;</span>
<a href="#l11.42"></a><span id="l11.42">   // mapping between special xlist mailboxes and the corresponding folder flag</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -2247,31 +2247,31 @@ void nsImapServerResponseParser::capabil</span>
<a href="#l12.4"></a><span id="l12.4">       else if (token.Equals(&quot;LANGUAGE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.5"></a><span id="l12.5">         fCapabilityFlag |= kHasLanguageCapability;</span>
<a href="#l12.6"></a><span id="l12.6">       else if (token.Equals(&quot;IDLE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.7"></a><span id="l12.7">         fCapabilityFlag |= kHasIdleCapability;</span>
<a href="#l12.8"></a><span id="l12.8">       else if (token.Equals(&quot;CONDSTORE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.9"></a><span id="l12.9">         fCapabilityFlag |= kHasCondStoreCapability;</span>
<a href="#l12.10"></a><span id="l12.10">       else if (token.Equals(&quot;ENABLE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.11"></a><span id="l12.11">         fCapabilityFlag |= kHasEnableCapability;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+      else if (token.Equals(&quot;EXTENDED-LIST&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+        fCapabilityFlag |= kHasExtendedListCapability;</span>
<a href="#l12.14"></a><span id="l12.14">       else if (token.Equals(&quot;XLIST&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.15"></a><span id="l12.15">         fCapabilityFlag |= kHasXListCapability;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+      else if (token.Equals(&quot;SPECIAL-USE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+        fCapabilityFlag |= kHasSpecialUseCapability;</span>
<a href="#l12.18"></a><span id="l12.18">       else if (token.Equals(&quot;COMPRESS=DEFLATE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.19"></a><span id="l12.19">         fCapabilityFlag |= kHasCompressDeflateCapability;</span>
<a href="#l12.20"></a><span id="l12.20">       else if (token.Equals(&quot;MOVE&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.21"></a><span id="l12.21">         fCapabilityFlag |= kHasMoveCapability;</span>
<a href="#l12.22"></a><span id="l12.22">       else if (token.Equals(&quot;HIGHESTMODSEQ&quot;, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l12.23"></a><span id="l12.23">         fCapabilityFlag |= kHasHighestModSeqCapability;</span>
<a href="#l12.24"></a><span id="l12.24">     }</span>
<a href="#l12.25"></a><span id="l12.25">   } while (fNextToken &amp;&amp; endToken &lt; 0 &amp;&amp; !fAtEndOfLine &amp;&amp; ContinueParse());</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-  if (fHostSessionList)</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-    fHostSessionList-&gt;SetCapabilityForHost(</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-    fServerConnection.GetImapServerKey(), </span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-    fCapabilityFlag);</span>
<a href="#l12.31"></a><span id="l12.31">   nsImapProtocol *navCon = &amp;fServerConnection;</span>
<a href="#l12.32"></a><span id="l12.32">   NS_ASSERTION(navCon, &quot;null imap protocol connection while parsing capability response&quot;);	// we should always have this</span>
<a href="#l12.33"></a><span id="l12.33">   if (navCon)</span>
<a href="#l12.34"></a><span id="l12.34">     navCon-&gt;CommitCapability();</span>
<a href="#l12.35"></a><span id="l12.35">   skip_to_CRLF();</span>
<a href="#l12.36"></a><span id="l12.36"> }</span>
<a href="#l12.37"></a><span id="l12.37"> </span>
<a href="#l12.38"></a><span id="l12.38"> void nsImapServerResponseParser::xmailboxinfo_data()</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineat">@@ -3037,21 +3037,16 @@ void	nsImapServerResponseParser::UseCach</span>
<a href="#l12.40"></a><span id="l12.40"> 		NS_ASSERTION(false, &quot;shell collision&quot;);</span>
<a href="#l12.41"></a><span id="l12.41"> 	}</span>
<a href="#l12.42"></a><span id="l12.42"> 	m_shell = cachedShell;</span>
<a href="#l12.43"></a><span id="l12.43"> }</span>
<a href="#l12.44"></a><span id="l12.44"> </span>
<a href="#l12.45"></a><span id="l12.45"> </span>
<a href="#l12.46"></a><span id="l12.46"> void nsImapServerResponseParser::ResetCapabilityFlag() </span>
<a href="#l12.47"></a><span id="l12.47"> {</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-    if (fHostSessionList)</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-    {</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-        fHostSessionList-&gt;SetCapabilityForHost(</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-            fServerConnection.GetImapServerKey(), kCapabilityUndefined);</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-    }</span>
<a href="#l12.53"></a><span id="l12.53"> }</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55"> /*</span>
<a href="#l12.56"></a><span id="l12.56">  literal         ::= &quot;{&quot; number &quot;}&quot; CRLF *CHAR8</span>
<a href="#l12.57"></a><span id="l12.57">                               ;; Number represents the number of CHAR8 octets</span>
<a href="#l12.58"></a><span id="l12.58"> */</span>
<a href="#l12.59"></a><span id="l12.59"> // returns true if this is the last chunk and we should close the stream</span>
<a href="#l12.60"></a><span id="l12.60"> bool nsImapServerResponseParser::msg_fetch_literal(bool chunk, PRInt32 origin)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/imap/src/nsImapServerResponseParser.h</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapServerResponseParser.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -116,18 +116,18 @@ public:</span>
<a href="#l13.4"></a><span id="l13.4">   // Resets the flags state.</span>
<a href="#l13.5"></a><span id="l13.5">   void ResetFlagInfo();</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7">   // set this to false if you don't want to alert the user to server</span>
<a href="#l13.8"></a><span id="l13.8">   // error messages</span>
<a href="#l13.9"></a><span id="l13.9">   void SetReportingErrors(bool reportThem) { fReportingErrors=reportThem;}</span>
<a href="#l13.10"></a><span id="l13.10">   bool GetReportingErrors() { return fReportingErrors; }</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  PRUint32 GetCapabilityFlag() { return fCapabilityFlag; }</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-  void   SetCapabilityFlag(PRUint32 capability) {fCapabilityFlag = capability;}</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  eIMAPCapabilityFlags GetCapabilityFlag() { return fCapabilityFlag; }</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+  void   SetCapabilityFlag(eIMAPCapabilityFlags capability) {fCapabilityFlag = capability;}</span>
<a href="#l13.16"></a><span id="l13.16">   bool ServerHasIMAP4Rev1Capability() { return ((fCapabilityFlag &amp; kIMAP4rev1Capability) != 0); }</span>
<a href="#l13.17"></a><span id="l13.17">   bool ServerHasACLCapability() { return ((fCapabilityFlag &amp; kACLCapability) != 0); }</span>
<a href="#l13.18"></a><span id="l13.18">   bool ServerHasNamespaceCapability() { return ((fCapabilityFlag &amp; kNamespaceCapability) != 0); }</span>
<a href="#l13.19"></a><span id="l13.19">   bool ServerIsNetscape3xServer() { return fServerIsNetscape3xServer; }</span>
<a href="#l13.20"></a><span id="l13.20">   bool ServerHasServerInfo() {return ((fCapabilityFlag &amp; kXServerInfoCapability) != 0); }</span>
<a href="#l13.21"></a><span id="l13.21">   bool ServerIsAOLServer() {return ((fCapabilityFlag &amp; kAOLImapCapability) != 0); }</span>
<a href="#l13.22"></a><span id="l13.22">   void SetFetchingFlags(bool aFetchFlags) { fFetchingAllFlags = aFetchFlags;}</span>
<a href="#l13.23"></a><span id="l13.23">   void ResetCapabilityFlag() ;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineat">@@ -267,17 +267,17 @@ private:</span>
<a href="#l13.25"></a><span id="l13.25">   char              *fSelectedMailboxName;</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27">   nsImapSearchResultSequence    *fSearchResults;</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29">   nsCOMPtr &lt;nsIImapFlagAndUidState&gt; fFlagState;		// NOT owned by us, it's a copy, do not destroy</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31">   eIMAPstate               fIMAPstate;</span>
<a href="#l13.32"></a><span id="l13.32"> </span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-  PRUint32      fCapabilityFlag;</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+  eIMAPCapabilityFlags      fCapabilityFlag;</span>
<a href="#l13.35"></a><span id="l13.35">   nsCString     fMailAccountUrl;</span>
<a href="#l13.36"></a><span id="l13.36">   char          *fNetscapeServerVersionString;</span>
<a href="#l13.37"></a><span id="l13.37">   char          *fXSenderInfo; /* changed per message download */</span>
<a href="#l13.38"></a><span id="l13.38">   char          *fLastAlert; /* used to avoid displaying the same alert over and over */</span>
<a href="#l13.39"></a><span id="l13.39">   nsCString     fManageListsUrl;</span>
<a href="#l13.40"></a><span id="l13.40">   nsCString    fManageFiltersUrl;</span>
<a href="#l13.41"></a><span id="l13.41">   char          *fFolderAdminUrl;</span>
<a href="#l13.42"></a><span id="l13.42">   nsCString    fServerIdResponse; // RFC </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -453,17 +453,17 @@ NS_SYNCRUNNABLEMETHOD3(ImapServerSink, A</span>
<a href="#l14.4"></a><span id="l14.4"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, RefreshFolderRights, const nsACString &amp;)</span>
<a href="#l14.5"></a><span id="l14.5"> NS_SYNCRUNNABLEMETHOD0(ImapServerSink, DiscoveryDone)</span>
<a href="#l14.6"></a><span id="l14.6"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, OnlineFolderDelete, const nsACString &amp;)</span>
<a href="#l14.7"></a><span id="l14.7"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, OnlineFolderCreateFailed, const nsACString &amp;)</span>
<a href="#l14.8"></a><span id="l14.8"> NS_SYNCRUNNABLEMETHOD3(ImapServerSink, OnlineFolderRename, nsIMsgWindow *, const nsACString &amp;, const nsACString &amp;)</span>
<a href="#l14.9"></a><span id="l14.9"> NS_SYNCRUNNABLEMETHOD2(ImapServerSink, FolderIsNoSelect, const nsACString &amp;, bool *)</span>
<a href="#l14.10"></a><span id="l14.10"> NS_SYNCRUNNABLEMETHOD2(ImapServerSink, SetFolderAdminURL, const nsACString &amp;, const nsACString &amp;)</span>
<a href="#l14.11"></a><span id="l14.11"> NS_SYNCRUNNABLEMETHOD2(ImapServerSink, FolderVerifiedOnline, const nsACString &amp;, bool *)</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-NS_SYNCRUNNABLEMETHOD1(ImapServerSink, SetCapability, PRUint32)</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+NS_SYNCRUNNABLEMETHOD1(ImapServerSink, SetCapability, eIMAPCapabilityFlags)</span>
<a href="#l14.14"></a><span id="l14.14"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, SetServerID, const nsACString &amp;)</span>
<a href="#l14.15"></a><span id="l14.15"> NS_SYNCRUNNABLEMETHOD2(ImapServerSink, LoadNextQueuedUrl, nsIImapProtocol *, bool *)</span>
<a href="#l14.16"></a><span id="l14.16"> NS_SYNCRUNNABLEMETHOD2(ImapServerSink, PrepareToRetryUrl, nsIImapUrl *, nsIImapMockChannel **)</span>
<a href="#l14.17"></a><span id="l14.17"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, SuspendUrl, nsIImapUrl *)</span>
<a href="#l14.18"></a><span id="l14.18"> NS_SYNCRUNNABLEMETHOD2(ImapServerSink, RetryUrl, nsIImapUrl *, nsIImapMockChannel *)</span>
<a href="#l14.19"></a><span id="l14.19"> NS_SYNCRUNNABLEMETHOD0(ImapServerSink, AbortQueuedUrls)</span>
<a href="#l14.20"></a><span id="l14.20"> NS_SYNCRUNNABLEMETHOD2(ImapServerSink, GetImapStringByID, PRInt32, nsAString &amp;)</span>
<a href="#l14.21"></a><span id="l14.21"> NS_SYNCRUNNABLEMETHOD2(ImapServerSink, PromptLoginFailed, nsIMsgWindow *, PRInt32 *)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

