<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 1742:176d86062c81fe326726efa986eb29b9830c1845</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 176d86062c81fe326726efa986eb29b9830c1845" />
<meta property="og:url" content="/comm-central/rev/176d86062c81fe326726efa986eb29b9830c1845" />
<meta property="og:description" content="Bug 474759 Trunk builds broken due to ParseString and nsStringEnumerator change r=Standard8 rs=dmose in anticipation of forthcoming sr" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 176d86062c81fe326726efa986eb29b9830c1845 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/176d86062c81fe326726efa986eb29b9830c1845">shortlog</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/176d86062c81fe326726efa986eb29b9830c1845">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845">files</a> |
changeset |
<a href="/comm-central/raw-rev/176d86062c81fe326726efa986eb29b9830c1845">raw</a>  | <a href="/comm-central/archive/176d86062c81fe326726efa986eb29b9830c1845.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=474759">Bug 474759</a> Trunk builds broken due to ParseString and nsStringEnumerator change r=Standard8 rs=dmose in anticipation of forthcoming sr
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#78;&#101;&#105;&#108;&#32;&#82;&#97;&#115;&#104;&#98;&#114;&#111;&#111;&#107;&#32;&#60;&#110;&#101;&#105;&#108;&#64;&#112;&#97;&#114;&#107;&#119;&#97;&#121;&#99;&#99;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 23 Jan 2009 23:53:01 +0000</td></tr>

<tr>
 <td>changeset 1742</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/176d86062c81fe326726efa986eb29b9830c1845">176d86062c81fe326726efa986eb29b9830c1845</a></td>
</tr>



<tr>
<td>parent 1741</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/854ed8a08a062b479f233fa73fb2e257dd44d9f4">854ed8a08a062b479f233fa73fb2e257dd44d9f4</a>
</td>
</tr>

<tr>
<td>child 1743</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b9cd225d077e0a05a667baec4c55c77877c3ffc9">b9cd225d077e0a05a667baec4c55c77877c3ffc9</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=176d86062c81fe326726efa986eb29b9830c1845">1398</a></td></tr>
<tr><td>push user</td><td>neil@parkwaycc.co.uk</td></tr>
<tr><td>push date</td><td class="date age">Fri, 23 Jan 2009 23:53:11 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@176d86062c81 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=176d86062c81fe326726efa986eb29b9830c1845">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=176d86062c81fe326726efa986eb29b9830c1845&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=176d86062c81fe326726efa986eb29b9830c1845&newProject=comm-central&newRevision=176d86062c81fe326726efa986eb29b9830c1845&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=176d86062c81fe326726efa986eb29b9830c1845&newProject=comm-central&newRevision=176d86062c81fe326726efa986eb29b9830c1845&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=176d86062c81fe326726efa986eb29b9830c1845&newProject=comm-central&newRevision=176d86062c81fe326726efa986eb29b9830c1845&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a>, <a href="/comm-central/log?rev=reviewer%28dmose%29&revcount=50">dmose</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=474759">474759</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=474759">Bug 474759</a> Trunk builds broken due to ParseString and nsStringEnumerator change r=Standard8 rs=dmose in anticipation of forthcoming sr</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">mailnews/addrbook/src/nsAbLDAPDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.h">mailnews/addrbook/src/nsAbLDAPDirectory.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.h">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.h">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.h">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.h">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/addrbook/src/nsAbLDAPDirectory.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/public/nsIMsgTagService.idl">mailnews/base/public/nsIMsgTagService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/public/nsIMsgTagService.idl">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/public/nsIMsgTagService.idl">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/public/nsIMsgTagService.idl">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/public/nsIMsgTagService.idl">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/public/nsIMsgTagService.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/public/nsIMsgSearchTerm.idl">mailnews/base/search/public/nsIMsgSearchTerm.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/public/nsIMsgSearchTerm.idl">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/public/nsIMsgSearchTerm.idl">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/public/nsIMsgSearchTerm.idl">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/public/nsIMsgSearchTerm.idl">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/public/nsIMsgSearchTerm.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgLocalSearch.cpp">mailnews/base/search/src/nsMsgLocalSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgLocalSearch.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgLocalSearch.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgLocalSearch.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgLocalSearch.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgLocalSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.h">mailnews/base/src/nsMsgAccountManager.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.h">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.h">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.h">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.h">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgAccountManager.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.h">mailnews/base/src/nsMsgDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.h">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.h">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.h">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.h">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgDBView.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgTagService.cpp">mailnews/base/src/nsMsgTagService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgTagService.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgTagService.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgTagService.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgTagService.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/src/nsMsgTagService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgCompUtils.cpp">mailnews/compose/src/nsMsgCompUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgCompUtils.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgCompUtils.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgCompUtils.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgCompUtils.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgCompUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgSendLater.cpp">mailnews/compose/src/nsMsgSendLater.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgSendLater.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgSendLater.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgSendLater.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgSendLater.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsMsgSendLater.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsSmtpService.cpp">mailnews/compose/src/nsSmtpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsSmtpService.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsSmtpService.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsSmtpService.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsSmtpService.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/compose/src/nsSmtpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/src/mimeobj.cpp">mailnews/mime/src/mimeobj.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/src/mimeobj.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/src/mimeobj.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/src/mimeobj.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/src/mimeobj.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/mime/src/mimeobj.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/build/Makefile.in">mailnews/news/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/public/nsINntpService.idl">mailnews/news/public/nsINntpService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/public/nsINntpService.idl">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/public/nsINntpService.idl">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/public/nsINntpService.idl">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/public/nsINntpService.idl">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/public/nsINntpService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNNTPNewsgroupList.cpp">mailnews/news/src/nsNNTPNewsgroupList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNNTPNewsgroupList.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNNTPNewsgroupList.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNNTPNewsgroupList.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNNTPNewsgroupList.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNNTPNewsgroupList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNntpService.cpp">mailnews/news/src/nsNntpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNntpService.cpp">file</a> |
<a href="/comm-central/annotate/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNntpService.cpp">annotate</a> |
<a href="/comm-central/diff/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNntpService.cpp">diff</a> |
<a href="/comm-central/comparison/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNntpService.cpp">comparison</a> |
<a href="/comm-central/log/176d86062c81fe326726efa986eb29b9830c1845/mailnews/news/src/nsNntpService.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -64,16 +64,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #include &quot;nsILDAPModification.h&quot;</span>
<a href="#l1.5"></a><span id="l1.5"> #include &quot;nsILDAPService.h&quot;</span>
<a href="#l1.6"></a><span id="l1.6"> #include &quot;nsIAbLDAPCard.h&quot;</span>
<a href="#l1.7"></a><span id="l1.7"> #include &quot;nsAbUtils.h&quot;</span>
<a href="#l1.8"></a><span id="l1.8"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14"> #define kDefaultMaxHits 100</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> nsAbLDAPDirectory::nsAbLDAPDirectory() :</span>
<a href="#l1.17"></a><span id="l1.17">   nsAbDirectoryRDFResource(),</span>
<a href="#l1.18"></a><span id="l1.18">   mPerformingQuery(PR_FALSE),</span>
<a href="#l1.19"></a><span id="l1.19">   mContext(0),</span>
<a href="#l1.20"></a><span id="l1.20">   mLock(0)</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -747,25 +748,25 @@ NS_IMETHODIMP nsAbLDAPDirectory::AddCard</span>
<a href="#l1.22"></a><span id="l1.22">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.23"></a><span id="l1.23">   </span>
<a href="#l1.24"></a><span id="l1.24">   // Retrieve preferences</span>
<a href="#l1.25"></a><span id="l1.25">   nsCAutoString prefString;</span>
<a href="#l1.26"></a><span id="l1.26">   rv = GetRdnAttributes(prefString);</span>
<a href="#l1.27"></a><span id="l1.27">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29">   CharPtrArrayGuard rdnAttrs;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-  rv = SplitStringList(prefString.get(), rdnAttrs.GetSizeAddr(),</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+  rv = SplitStringList(prefString, rdnAttrs.GetSizeAddr(),</span>
<a href="#l1.32"></a><span id="l1.32">     rdnAttrs.GetArrayAddr());</span>
<a href="#l1.33"></a><span id="l1.33">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.34"></a><span id="l1.34">   </span>
<a href="#l1.35"></a><span id="l1.35">   rv = GetObjectClasses(prefString);</span>
<a href="#l1.36"></a><span id="l1.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.37"></a><span id="l1.37">   </span>
<a href="#l1.38"></a><span id="l1.38">   CharPtrArrayGuard objClass;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-  rv = SplitStringList(prefString.get(), objClass.GetSizeAddr(),</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+  rv = SplitStringList(prefString, objClass.GetSizeAddr(),</span>
<a href="#l1.41"></a><span id="l1.41">     objClass.GetArrayAddr());</span>
<a href="#l1.42"></a><span id="l1.42">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.43"></a><span id="l1.43"> </span>
<a href="#l1.44"></a><span id="l1.44">   // Process updates</span>
<a href="#l1.45"></a><span id="l1.45">   nsCOMPtr&lt;nsIArray&gt; modArray;</span>
<a href="#l1.46"></a><span id="l1.46">   rv = card-&gt;GetLDAPMessageInfo(attrMap, objClass.GetSize(), objClass.GetArray(),</span>
<a href="#l1.47"></a><span id="l1.47">     nsILDAPModification::MOD_ADD, getter_AddRefs(modArray));</span>
<a href="#l1.48"></a><span id="l1.48">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineat">@@ -849,17 +850,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::ModifyC</span>
<a href="#l1.50"></a><span id="l1.50">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.51"></a><span id="l1.51">   </span>
<a href="#l1.52"></a><span id="l1.52">   // Retrieve preferences</span>
<a href="#l1.53"></a><span id="l1.53">   nsCAutoString prefString;</span>
<a href="#l1.54"></a><span id="l1.54">   rv = GetObjectClasses(prefString);</span>
<a href="#l1.55"></a><span id="l1.55">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.56"></a><span id="l1.56">   </span>
<a href="#l1.57"></a><span id="l1.57">   CharPtrArrayGuard objClass;</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-  rv = SplitStringList(prefString.get(), objClass.GetSizeAddr(),</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+  rv = SplitStringList(prefString, objClass.GetSizeAddr(),</span>
<a href="#l1.60"></a><span id="l1.60">     objClass.GetArrayAddr());</span>
<a href="#l1.61"></a><span id="l1.61">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.62"></a><span id="l1.62"> </span>
<a href="#l1.63"></a><span id="l1.63">   // Process updates</span>
<a href="#l1.64"></a><span id="l1.64">   nsCOMPtr&lt;nsIArray&gt; modArray;</span>
<a href="#l1.65"></a><span id="l1.65">   rv = card-&gt;GetLDAPMessageInfo(attrMap, objClass.GetSize(), objClass.GetArray(),</span>
<a href="#l1.66"></a><span id="l1.66">     nsILDAPModification::MOD_REPLACE, getter_AddRefs(modArray));</span>
<a href="#l1.67"></a><span id="l1.67">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineat">@@ -929,26 +930,25 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetObje</span>
<a href="#l1.69"></a><span id="l1.69"> }</span>
<a href="#l1.70"></a><span id="l1.70"> </span>
<a href="#l1.71"></a><span id="l1.71"> NS_IMETHODIMP nsAbLDAPDirectory::SetObjectClasses(const nsACString &amp;aObjectClasses)</span>
<a href="#l1.72"></a><span id="l1.72"> {</span>
<a href="#l1.73"></a><span id="l1.73">   return SetStringValue(&quot;objectClasses&quot;, aObjectClasses);</span>
<a href="#l1.74"></a><span id="l1.74"> }</span>
<a href="#l1.75"></a><span id="l1.75"> </span>
<a href="#l1.76"></a><span id="l1.76"> nsresult nsAbLDAPDirectory::SplitStringList(</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-  const char *aString,</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+  const nsACString&amp; aString,</span>
<a href="#l1.79"></a><span id="l1.79">   PRUint32 *aCount,</span>
<a href="#l1.80"></a><span id="l1.80">   char ***aValues)</span>
<a href="#l1.81"></a><span id="l1.81"> {</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-  NS_ENSURE_ARG_POINTER(aString);</span>
<a href="#l1.83"></a><span id="l1.83">   NS_ENSURE_ARG_POINTER(aCount);</span>
<a href="#l1.84"></a><span id="l1.84">   NS_ENSURE_ARG_POINTER(aValues);</span>
<a href="#l1.85"></a><span id="l1.85"> </span>
<a href="#l1.86"></a><span id="l1.86">   nsCStringArray strarr;</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-  strarr.ParseString(aString, &quot;,&quot;);</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+  ParseString(aString, ',', strarr);</span>
<a href="#l1.89"></a><span id="l1.89"> </span>
<a href="#l1.90"></a><span id="l1.90">   char **cArray = nsnull;</span>
<a href="#l1.91"></a><span id="l1.91">   if (!(cArray = static_cast&lt;char **&gt;(nsMemory::Alloc(</span>
<a href="#l1.92"></a><span id="l1.92">       strarr.Count() * sizeof(char *)))))</span>
<a href="#l1.93"></a><span id="l1.93">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l1.94"></a><span id="l1.94"> </span>
<a href="#l1.95"></a><span id="l1.95">   for (PRInt32 i = 0; i &lt; strarr.Count(); ++i)</span>
<a href="#l1.96"></a><span id="l1.96">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectory.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectory.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -84,17 +84,17 @@ public:</span>
<a href="#l2.4"></a><span id="l2.4">   // nsIAbDirectorySearch methods</span>
<a href="#l2.5"></a><span id="l2.5">   NS_DECL_NSIABDIRECTORYSEARCH</span>
<a href="#l2.6"></a><span id="l2.6">   NS_DECL_NSIABLDAPDIRECTORY</span>
<a href="#l2.7"></a><span id="l2.7">   NS_DECL_NSIABDIRSEARCHLISTENER</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> protected:</span>
<a href="#l2.10"></a><span id="l2.10">   nsresult Initiate();</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  nsresult SplitStringList(const char *aString,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  nsresult SplitStringList(const nsACString&amp; aString,</span>
<a href="#l2.14"></a><span id="l2.14">                            PRUint32 *aCount,</span>
<a href="#l2.15"></a><span id="l2.15">                            char ***aValues);</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17">   PRPackedBool mPerformingQuery;</span>
<a href="#l2.18"></a><span id="l2.18">   PRInt32 mContext;</span>
<a href="#l2.19"></a><span id="l2.19">   PRInt32 mMaxHits;</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">   nsInterfaceHashtable&lt;nsISupportsHashKey, nsIAbCard&gt; mCache;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgTagService.idl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgTagService.idl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -64,26 +64,26 @@</span>
<a href="#l3.4"></a><span id="l3.4"> [scriptable, uuid(84d593a3-5d8a-45e6-96e2-9189acd422e1)]</span>
<a href="#l3.5"></a><span id="l3.5"> interface nsIMsgTag : nsISupports {</span>
<a href="#l3.6"></a><span id="l3.6">   readonly attribute ACString key;     // distinct tag identifier</span>
<a href="#l3.7"></a><span id="l3.7">   readonly attribute AString  tag;     // human readable tag name</span>
<a href="#l3.8"></a><span id="l3.8">   readonly attribute ACString color;   // tag color</span>
<a href="#l3.9"></a><span id="l3.9">   readonly attribute ACString ordinal; // custom sort string (usually empty)</span>
<a href="#l3.10"></a><span id="l3.10"> };</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-[scriptable, uuid(88BBCA01-9BA2-4185-9634-F82DA583D4AA)]</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+[scriptable, uuid(97360ce3-0fba-4f1c-8214-af7bdc6f8587)]</span>
<a href="#l3.14"></a><span id="l3.14"> interface nsIMsgTagService : nsISupports {</span>
<a href="#l3.15"></a><span id="l3.15">   // create new tag by deriving the key from the tag</span>
<a href="#l3.16"></a><span id="l3.16">   void addTag(in AString tag, in ACString color, in ACString ordinal);</span>
<a href="#l3.17"></a><span id="l3.17">   // create/update tag with known key</span>
<a href="#l3.18"></a><span id="l3.18">   void addTagForKey(in ACString key, in AString tag, in ACString color, in ACString ordinal);</span>
<a href="#l3.19"></a><span id="l3.19">   // get the key representation of a given tag</span>
<a href="#l3.20"></a><span id="l3.20">   ACString getKeyForTag(in AString tag);</span>
<a href="#l3.21"></a><span id="l3.21">   // get the first key by ordinal order</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-  ACString getTopKey(in string keyList);</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+  ACString getTopKey(in ACString keyList);</span>
<a href="#l3.24"></a><span id="l3.24">   // support functions for single tag aspects</span>
<a href="#l3.25"></a><span id="l3.25">   AString getTagForKey(in ACString key); // look up the tag for a key.</span>
<a href="#l3.26"></a><span id="l3.26">   void setTagForKey(in ACString key, in AString tag); // this can be used to &quot;rename&quot; a tag</span>
<a href="#l3.27"></a><span id="l3.27">   ACString getColorForKey(in ACString key);</span>
<a href="#l3.28"></a><span id="l3.28">   void setColorForKey(in ACString key, in ACString color);</span>
<a href="#l3.29"></a><span id="l3.29">   ACString getOrdinalForKey(in ACString key);</span>
<a href="#l3.30"></a><span id="l3.30">   void setOrdinalForKey(in ACString key, in ACString ordinal);</span>
<a href="#l3.31"></a><span id="l3.31">   // delete a tag from the list of known tags (but not from any messages)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgSearchTerm.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchTerm.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -39,17 +39,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l4.5"></a><span id="l4.5"> #include &quot;nsMsgSearchCore.idl&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;nsIMsgSearchValue.idl&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> interface nsIMsgDBHdr;</span>
<a href="#l4.9"></a><span id="l4.9"> interface nsIMsgDatabase;</span>
<a href="#l4.10"></a><span id="l4.10"> interface nsIMsgSearchScopeTerm;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-[scriptable, uuid(59db8e90-cd6e-11dc-95ff-0800200c9a66)]</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+[scriptable, uuid(2dd082e7-faa4-4e46-81ba-9c636bc9315a)]</span>
<a href="#l4.14"></a><span id="l4.14"> interface nsIMsgSearchTerm : nsISupports {</span>
<a href="#l4.15"></a><span id="l4.15">     attribute nsMsgSearchAttribValue attrib;</span>
<a href="#l4.16"></a><span id="l4.16">     attribute nsMsgSearchOpValue op;</span>
<a href="#l4.17"></a><span id="l4.17">     attribute nsIMsgSearchValue value;</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">     attribute boolean booleanAnd;</span>
<a href="#l4.20"></a><span id="l4.20">     attribute ACString arbitraryHeader;</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -100,12 +100,12 @@ interface nsIMsgSearchTerm : nsISupports</span>
<a href="#l4.23"></a><span id="l4.23">                                  //[array, size_is(headerLength)] in string headers,</span>
<a href="#l4.24"></a><span id="l4.24">                                  in string headers,</span>
<a href="#l4.25"></a><span id="l4.25">                                  in unsigned long headerLength,</span>
<a href="#l4.26"></a><span id="l4.26">                                  in boolean forFilters);</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">     readonly attribute boolean matchAllBeforeDeciding;</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">     readonly attribute ACString termAsString;</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    boolean matchKeyword(in string keyword); // used for tag searches</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    boolean matchKeyword(in ACString keyword); // used for tag searches</span>
<a href="#l4.33"></a><span id="l4.33">     attribute boolean matchAll;</span>
<a href="#l4.34"></a><span id="l4.34"> };</span>
<a href="#l4.35"></a><span id="l4.35"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -560,17 +560,17 @@ nsresult nsMsgSearchOfflineMail::Process</span>
<a href="#l5.4"></a><span id="l5.4">           msgToMatch-&gt;GetLabel(&amp;label);</span>
<a href="#l5.5"></a><span id="l5.5">           if (label &gt;= 1)</span>
<a href="#l5.6"></a><span id="l5.6">           {</span>
<a href="#l5.7"></a><span id="l5.7">             if (!keywords.IsEmpty())</span>
<a href="#l5.8"></a><span id="l5.8">               keywords.Append(' ');</span>
<a href="#l5.9"></a><span id="l5.9">             keywords.Append(&quot;$label&quot;);</span>
<a href="#l5.10"></a><span id="l5.10">             keywords.Append(label + '0');</span>
<a href="#l5.11"></a><span id="l5.11">           }</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-          err = aTerm-&gt;MatchKeyword(keywords.get(), &amp;result);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+          err = aTerm-&gt;MatchKeyword(keywords, &amp;result);</span>
<a href="#l5.14"></a><span id="l5.14">           break;</span>
<a href="#l5.15"></a><span id="l5.15">       }</span>
<a href="#l5.16"></a><span id="l5.16">       case nsMsgSearchAttrib::JunkStatus:</span>
<a href="#l5.17"></a><span id="l5.17">       {</span>
<a href="#l5.18"></a><span id="l5.18">          nsCString junkScoreStr;</span>
<a href="#l5.19"></a><span id="l5.19">          msgToMatch-&gt;GetStringProperty(&quot;junkscore&quot;, getter_Copies(junkScoreStr));</span>
<a href="#l5.20"></a><span id="l5.20">          err = aTerm-&gt;MatchJunkStatus(junkScoreStr.get(), &amp;result);</span>
<a href="#l5.21"></a><span id="l5.21">          break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1431,41 +1431,42 @@ nsresult nsMsgSearchTerm::MatchStatus(PR</span>
<a href="#l6.4"></a><span id="l6.4">  *</span>
<a href="#l6.5"></a><span id="l6.5">  *         # Valid Tokens IsEmpty Contains DoesntContain Is     Isnt</span>
<a href="#l6.6"></a><span id="l6.6">  *                0           +       -         +         -       +</span>
<a href="#l6.7"></a><span id="l6.7">  * Term found?                      N   Y     N   Y     N   Y   N   Y</span>
<a href="#l6.8"></a><span id="l6.8">  *                1           -     -   +     +   -     -   +   +   -</span>
<a href="#l6.9"></a><span id="l6.9">  *               &gt;1           -     -   +     +   -     -   -   +   +</span>
<a href="#l6.10"></a><span id="l6.10">  */</span>
<a href="#l6.11"></a><span id="l6.11"> // look up nsMsgSearchTerm::m_value in space-delimited keywordList</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-nsresult nsMsgSearchTerm::MatchKeyword(const char *keywordList, PRBool *pResult)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+nsresult nsMsgSearchTerm::MatchKeyword(const nsACString&amp; keywordList, PRBool *pResult)</span>
<a href="#l6.14"></a><span id="l6.14"> {</span>
<a href="#l6.15"></a><span id="l6.15">   NS_ENSURE_ARG_POINTER(pResult);</span>
<a href="#l6.16"></a><span id="l6.16">   PRBool matches = PR_FALSE;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">   // special-case empty for performance reasons</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-  if (!keywordList || !*keywordList)</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+  if (keywordList.IsEmpty())</span>
<a href="#l6.21"></a><span id="l6.21">   {</span>
<a href="#l6.22"></a><span id="l6.22">     *pResult =  m_operator != nsMsgSearchOp::Contains &amp;&amp;</span>
<a href="#l6.23"></a><span id="l6.23">                 m_operator != nsMsgSearchOp::Is;</span>
<a href="#l6.24"></a><span id="l6.24">     return NS_OK;</span>
<a href="#l6.25"></a><span id="l6.25">   }</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27">   // check if we can skip expensive valid keywordList test</span>
<a href="#l6.28"></a><span id="l6.28">   if (m_operator == nsMsgSearchOp::DoesntContain ||</span>
<a href="#l6.29"></a><span id="l6.29">       m_operator == nsMsgSearchOp::Contains)</span>
<a href="#l6.30"></a><span id="l6.30">   {</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+    nsCString keywordString(keywordList);</span>
<a href="#l6.32"></a><span id="l6.32">     const PRUint32 kKeywordLen = PL_strlen(m_value.string);</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-    const char* matchStart = PL_strstr(keywordList, m_value.string);</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+    const char* matchStart = PL_strstr(keywordString.get(), m_value.string);</span>
<a href="#l6.35"></a><span id="l6.35">     while (matchStart)</span>
<a href="#l6.36"></a><span id="l6.36">     {</span>
<a href="#l6.37"></a><span id="l6.37">       // For a real match, matchStart must be the start of the keywordList or</span>
<a href="#l6.38"></a><span id="l6.38">       // preceded by a space and matchEnd must point to a \0 or space.</span>
<a href="#l6.39"></a><span id="l6.39">       const char* matchEnd = matchStart + kKeywordLen;</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-      if ((matchStart == keywordList || matchStart[-1] == ' ') &amp;&amp;</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+      if ((matchStart == keywordString.get() || matchStart[-1] == ' ') &amp;&amp;</span>
<a href="#l6.42"></a><span id="l6.42">           (!*matchEnd || *matchEnd == ' '))</span>
<a href="#l6.43"></a><span id="l6.43">       {</span>
<a href="#l6.44"></a><span id="l6.44">         // found the keyword</span>
<a href="#l6.45"></a><span id="l6.45">         *pResult = m_operator == nsMsgSearchOp::Contains;</span>
<a href="#l6.46"></a><span id="l6.46">         return NS_OK;</span>
<a href="#l6.47"></a><span id="l6.47">       }</span>
<a href="#l6.48"></a><span id="l6.48">       // no match yet, so search on</span>
<a href="#l6.49"></a><span id="l6.49">       matchStart = PL_strstr(matchEnd, m_value.string);</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineat">@@ -1473,17 +1474,17 @@ nsresult nsMsgSearchTerm::MatchKeyword(c</span>
<a href="#l6.51"></a><span id="l6.51">     // keyword not found</span>
<a href="#l6.52"></a><span id="l6.52">     *pResult = m_operator == nsMsgSearchOp::DoesntContain;</span>
<a href="#l6.53"></a><span id="l6.53">     return NS_OK;</span>
<a href="#l6.54"></a><span id="l6.54">   }</span>
<a href="#l6.55"></a><span id="l6.55"> </span>
<a href="#l6.56"></a><span id="l6.56">   // Only accept valid keys in tokens.</span>
<a href="#l6.57"></a><span id="l6.57">   nsresult rv = NS_OK;</span>
<a href="#l6.58"></a><span id="l6.58">   nsCStringArray keywordArray;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-  keywordArray.ParseString(keywordList, &quot; &quot;);</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+  ParseString(keywordList, ' ', keywordArray);</span>
<a href="#l6.61"></a><span id="l6.61">   nsCOMPtr&lt;nsIMsgTagService&gt; tagService(do_GetService(NS_MSGTAGSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l6.62"></a><span id="l6.62">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.63"></a><span id="l6.63"> </span>
<a href="#l6.64"></a><span id="l6.64">   // Loop through tokens in keywords</span>
<a href="#l6.65"></a><span id="l6.65">   PRUint32 count = keywordArray.Count();</span>
<a href="#l6.66"></a><span id="l6.66">   for (PRUint32 i = 0; i &lt; count; i++)</span>
<a href="#l6.67"></a><span id="l6.67">   {</span>
<a href="#l6.68"></a><span id="l6.68">     // is this token a valid tag? Otherwise ignore it</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1258,17 +1258,17 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l7.4"></a><span id="l7.4">       // Get a list of pre-configured accounts</span>
<a href="#l7.5"></a><span id="l7.5">       nsCString appendAccountList;</span>
<a href="#l7.6"></a><span id="l7.6">       rv = m_prefs-&gt;GetCharPref(PREF_MAIL_ACCOUNTMANAGER_APPEND_ACCOUNTS, getter_Copies(appendAccountList));</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">       // If there are pre-configured accounts, we need to add them to the existing list.</span>
<a href="#l7.9"></a><span id="l7.9">       if (!appendAccountList.IsEmpty()) {</span>
<a href="#l7.10"></a><span id="l7.10">         if (!accountList.IsEmpty()) {</span>
<a href="#l7.11"></a><span id="l7.11">           nsCStringArray existingAccountsArray;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-          existingAccountsArray.ParseString(accountList.get(), ACCOUNT_DELIMITER);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+          ParseString(accountList.get(), ACCOUNT_DELIMITER, existingAccountsArray);</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15">           // Tokenize the data and add each account if it is not already there</span>
<a href="#l7.16"></a><span id="l7.16">           // in the user's current mailnews account list</span>
<a href="#l7.17"></a><span id="l7.17">           char *newAccountStr = appendAccountList.BeginWriting();</span>
<a href="#l7.18"></a><span id="l7.18">           char *token = NS_strtok(ACCOUNT_DELIMITER, &amp;newAccountStr);</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20">           nsCAutoString newAccount;</span>
<a href="#l7.21"></a><span id="l7.21">           while (token) {</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -2803,17 +2803,17 @@ NS_IMETHODIMP nsMsgAccountManager::LoadV</span>
<a href="#l7.23"></a><span id="l7.23">         else if (dbFolderInfo &amp;&amp; Substring(buffer, 0, 6).Equals(&quot;scope=&quot;))</span>
<a href="#l7.24"></a><span id="l7.24">         {</span>
<a href="#l7.25"></a><span id="l7.25">           buffer.Cut(0, 6);</span>
<a href="#l7.26"></a><span id="l7.26">           // if this is a cross folder virtual folder, we have a list of folders uris,</span>
<a href="#l7.27"></a><span id="l7.27">           // and we have to add a pending listener for each of them.</span>
<a href="#l7.28"></a><span id="l7.28">           if (buffer.Length())</span>
<a href="#l7.29"></a><span id="l7.29">           {</span>
<a href="#l7.30"></a><span id="l7.30">             dbFolderInfo-&gt;SetCharProperty(&quot;searchFolderUri&quot;, buffer);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-            AddVFListenersForVF(virtualFolder, buffer.get(), rdf, msgDBService);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+            AddVFListenersForVF(virtualFolder, buffer, rdf, msgDBService);</span>
<a href="#l7.33"></a><span id="l7.33">           }</span>
<a href="#l7.34"></a><span id="l7.34">           else // this folder is useless</span>
<a href="#l7.35"></a><span id="l7.35">           {</span>
<a href="#l7.36"></a><span id="l7.36">           }</span>
<a href="#l7.37"></a><span id="l7.37">         }</span>
<a href="#l7.38"></a><span id="l7.38">         else if (dbFolderInfo &amp;&amp; Substring(buffer, 0, 6).Equals(&quot;terms=&quot;))</span>
<a href="#l7.39"></a><span id="l7.39">         {</span>
<a href="#l7.40"></a><span id="l7.40">           buffer.Cut(0, 6);</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineat">@@ -2912,22 +2912,22 @@ nsresult nsMsgAccountManager::WriteLineT</span>
<a href="#l7.42"></a><span id="l7.42">   PRUint32 writeCount;</span>
<a href="#l7.43"></a><span id="l7.43">   outputStream-&gt;Write(prefix, strlen(prefix), &amp;writeCount);</span>
<a href="#l7.44"></a><span id="l7.44">   outputStream-&gt;Write(line, strlen(line), &amp;writeCount);</span>
<a href="#l7.45"></a><span id="l7.45">   outputStream-&gt;Write(&quot;\n&quot;, 1, &amp;writeCount);</span>
<a href="#l7.46"></a><span id="l7.46">   return NS_OK;</span>
<a href="#l7.47"></a><span id="l7.47"> }</span>
<a href="#l7.48"></a><span id="l7.48"> </span>
<a href="#l7.49"></a><span id="l7.49"> nsresult nsMsgAccountManager::AddVFListenersForVF(nsIMsgFolder *virtualFolder,</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-                                                  const char *srchFolderUris,</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+                                                  const nsCString&amp; srchFolderUris,</span>
<a href="#l7.52"></a><span id="l7.52">                                                   nsIRDFService *rdf,</span>
<a href="#l7.53"></a><span id="l7.53">                                                   nsIMsgDBService *msgDBService)</span>
<a href="#l7.54"></a><span id="l7.54"> {</span>
<a href="#l7.55"></a><span id="l7.55">   nsCStringArray folderUris;</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-  folderUris.ParseString(srchFolderUris, &quot;|&quot;);</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+  ParseString(srchFolderUris, '|', folderUris);</span>
<a href="#l7.58"></a><span id="l7.58">   nsCOMPtr &lt;nsIRDFResource&gt; resource;</span>
<a href="#l7.59"></a><span id="l7.59"> </span>
<a href="#l7.60"></a><span id="l7.60">   for (PRInt32 i = 0; i &lt; folderUris.Count(); i++)</span>
<a href="#l7.61"></a><span id="l7.61">   {</span>
<a href="#l7.62"></a><span id="l7.62">     rdf-&gt;GetResource(*(folderUris[i]), getter_AddRefs(resource));</span>
<a href="#l7.63"></a><span id="l7.63">     nsCOMPtr &lt;nsIMsgFolder&gt; realFolder = do_QueryInterface(resource);</span>
<a href="#l7.64"></a><span id="l7.64">     VirtualFolderChangeListener *dbListener = new VirtualFolderChangeListener();</span>
<a href="#l7.65"></a><span id="l7.65">     NS_ENSURE_TRUE(dbListener, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineat">@@ -2958,17 +2958,17 @@ NS_IMETHODIMP nsMsgAccountManager::OnIte</span>
<a href="#l7.67"></a><span id="l7.67">     {</span>
<a href="#l7.68"></a><span id="l7.68">       nsCOMPtr &lt;nsIMsgDatabase&gt; virtDatabase;</span>
<a href="#l7.69"></a><span id="l7.69">       nsCOMPtr &lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l7.70"></a><span id="l7.70">       rv = folder-&gt;GetDBFolderInfoAndDB(getter_AddRefs(dbFolderInfo), getter_AddRefs(virtDatabase));</span>
<a href="#l7.71"></a><span id="l7.71">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.72"></a><span id="l7.72">       nsCString srchFolderUri;</span>
<a href="#l7.73"></a><span id="l7.73">       dbFolderInfo-&gt;GetCharProperty(&quot;searchFolderUri&quot;, srchFolderUri);</span>
<a href="#l7.74"></a><span id="l7.74">       nsCOMPtr&lt;nsIRDFService&gt; rdf(do_GetService(&quot;@mozilla.org/rdf/rdf-service;1&quot;, &amp;rv));</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-      AddVFListenersForVF(folder, srchFolderUri.get(), rdf, msgDBService);</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+      AddVFListenersForVF(folder, srchFolderUri, rdf, msgDBService);</span>
<a href="#l7.77"></a><span id="l7.77">     }</span>
<a href="#l7.78"></a><span id="l7.78">     rv = SaveVirtualFolders();</span>
<a href="#l7.79"></a><span id="l7.79">   }</span>
<a href="#l7.80"></a><span id="l7.80">   return rv;</span>
<a href="#l7.81"></a><span id="l7.81"> }</span>
<a href="#l7.82"></a><span id="l7.82"> </span>
<a href="#l7.83"></a><span id="l7.83"> NS_IMETHODIMP nsMsgAccountManager::OnItemRemoved(nsIMsgFolder *parentItem, nsISupports *item)</span>
<a href="#l7.84"></a><span id="l7.84"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -180,17 +180,17 @@ private:</span>
<a href="#l8.4"></a><span id="l8.4">                               PRInt32 port,</span>
<a href="#l8.5"></a><span id="l8.5">                               PRBool aRealFlag,</span>
<a href="#l8.6"></a><span id="l8.6">                               nsIMsgIncomingServer** aResult);</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">   // handle virtual folders</span>
<a href="#l8.9"></a><span id="l8.9">   nsresult GetVirtualFoldersFile(nsCOMPtr&lt;nsILocalFile&gt;&amp; file);</span>
<a href="#l8.10"></a><span id="l8.10">   nsresult WriteLineToOutputStream(const char *prefix, const char * line, nsIOutputStream *outputStream);</span>
<a href="#l8.11"></a><span id="l8.11">   nsresult AddVFListenersForVF(nsIMsgFolder *virtualFolder, </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-                               const char *srchFolderUris,</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                               const nsCString&amp; srchFolderUris,</span>
<a href="#l8.14"></a><span id="l8.14">                                nsIRDFService *rdf,</span>
<a href="#l8.15"></a><span id="l8.15">                                nsIMsgDBService *msgDBService);</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">   static void getUniqueAccountKey(const char * prefix,</span>
<a href="#l8.18"></a><span id="l8.18">                                   nsISupportsArray *accounts,</span>
<a href="#l8.19"></a><span id="l8.19">                                   nsCString&amp; aResult);</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -333,17 +333,17 @@ nsresult nsMsgDBView::GetPrefLocalizedSt</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">   rv = prefBranch-&gt;GetComplexValue(aPrefName, NS_GET_IID(nsIPrefLocalizedString), getter_AddRefs(pls));</span>
<a href="#l9.6"></a><span id="l9.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.7"></a><span id="l9.7">   pls-&gt;ToString(getter_Copies(ucsval));</span>
<a href="#l9.8"></a><span id="l9.8">   aResult = ucsval.get();</span>
<a href="#l9.9"></a><span id="l9.9">   return rv;</span>
<a href="#l9.10"></a><span id="l9.10"> }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-nsresult nsMsgDBView::AppendKeywordProperties(const char *keywords, nsISupportsArray *properties, PRBool addSelectedTextProperty)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+nsresult nsMsgDBView::AppendKeywordProperties(const nsACString&amp; keywords, nsISupportsArray *properties, PRBool addSelectedTextProperty)</span>
<a href="#l9.14"></a><span id="l9.14"> {</span>
<a href="#l9.15"></a><span id="l9.15">   // get the top most keyword's color and append that as a property.</span>
<a href="#l9.16"></a><span id="l9.16">   nsresult rv;</span>
<a href="#l9.17"></a><span id="l9.17">   if (!mTagService)</span>
<a href="#l9.18"></a><span id="l9.18">   {</span>
<a href="#l9.19"></a><span id="l9.19">     mTagService = do_GetService(NS_MSGTAGSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l9.20"></a><span id="l9.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.21"></a><span id="l9.21">   }</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -699,17 +699,17 @@ nsresult nsMsgDBView::FetchTags(nsIMsgDB</span>
<a href="#l9.23"></a><span id="l9.23">   {</span>
<a href="#l9.24"></a><span id="l9.24">     nsCAutoString labelStr(&quot;$label&quot;);</span>
<a href="#l9.25"></a><span id="l9.25">     labelStr.Append((char) (label + '0'));</span>
<a href="#l9.26"></a><span id="l9.26">     if (keywords.Find(labelStr, PR_TRUE) == -1)</span>
<a href="#l9.27"></a><span id="l9.27">       FetchLabel(aHdr, tags);</span>
<a href="#l9.28"></a><span id="l9.28">   }</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30">   nsCStringArray keywordsArray;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-  keywordsArray.ParseString(keywords.get(), &quot; &quot;);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  ParseString(keywords, ' ', keywordsArray);</span>
<a href="#l9.33"></a><span id="l9.33">   nsAutoString tag;</span>
<a href="#l9.34"></a><span id="l9.34"> </span>
<a href="#l9.35"></a><span id="l9.35">   for (PRInt32 i = 0; i &lt; keywordsArray.Count(); i++)</span>
<a href="#l9.36"></a><span id="l9.36">   {</span>
<a href="#l9.37"></a><span id="l9.37">     rv = mTagService-&gt;GetTagForKey(*(keywordsArray[i]), tag);</span>
<a href="#l9.38"></a><span id="l9.38">     if (NS_SUCCEEDED(rv) &amp;&amp; !tag.IsEmpty())</span>
<a href="#l9.39"></a><span id="l9.39">     {</span>
<a href="#l9.40"></a><span id="l9.40">       if (!tags.IsEmpty())</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -1171,17 +1171,17 @@ NS_IMETHODIMP nsMsgDBView::GetRowPropert</span>
<a href="#l9.42"></a><span id="l9.42">   if (NS_FAILED(rv) || !msgHdr) {</span>
<a href="#l9.43"></a><span id="l9.43">     ClearHdrCache();</span>
<a href="#l9.44"></a><span id="l9.44">     return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l9.45"></a><span id="l9.45">   }</span>
<a href="#l9.46"></a><span id="l9.46"> </span>
<a href="#l9.47"></a><span id="l9.47">   nsCString keywordProperty;</span>
<a href="#l9.48"></a><span id="l9.48">   FetchKeywords(msgHdr, keywordProperty);</span>
<a href="#l9.49"></a><span id="l9.49">   if (!keywordProperty.IsEmpty())</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-    AppendKeywordProperties(keywordProperty.get(), properties, PR_FALSE);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+    AppendKeywordProperties(keywordProperty, properties, PR_FALSE);</span>
<a href="#l9.52"></a><span id="l9.52"> </span>
<a href="#l9.53"></a><span id="l9.53">   // give the custom column handlers a chance to style the row.</span>
<a href="#l9.54"></a><span id="l9.54">   for (int i = 0; i &lt; m_customColumnHandlers.Count(); i++)</span>
<a href="#l9.55"></a><span id="l9.55">     m_customColumnHandlers[i]-&gt;GetRowProperties(index, properties);</span>
<a href="#l9.56"></a><span id="l9.56"> </span>
<a href="#l9.57"></a><span id="l9.57">   return NS_OK;</span>
<a href="#l9.58"></a><span id="l9.58"> }</span>
<a href="#l9.59"></a><span id="l9.59"> </span>
<a href="#l9.60"></a><span id="l9.60" class="difflineat">@@ -1256,17 +1256,17 @@ NS_IMETHODIMP nsMsgDBView::GetCellProper</span>
<a href="#l9.61"></a><span id="l9.61">     properties-&gt;AppendElement(junkScoreStr.ToInteger((PRInt32*)&amp;rv) == nsIJunkMailPlugin::IS_SPAM_SCORE ?</span>
<a href="#l9.62"></a><span id="l9.62">                               kJunkMsgAtom : kNotJunkMsgAtom);</span>
<a href="#l9.63"></a><span id="l9.63">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Converting junkScore to integer failed.&quot;);</span>
<a href="#l9.64"></a><span id="l9.64">   }</span>
<a href="#l9.65"></a><span id="l9.65"> </span>
<a href="#l9.66"></a><span id="l9.66">   nsCString keywords;</span>
<a href="#l9.67"></a><span id="l9.67">   FetchKeywords(msgHdr, keywords);</span>
<a href="#l9.68"></a><span id="l9.68">   if (!keywords.IsEmpty())</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-    AppendKeywordProperties(keywords.get(), properties, PR_TRUE);</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+    AppendKeywordProperties(keywords, properties, PR_TRUE);</span>
<a href="#l9.71"></a><span id="l9.71"> </span>
<a href="#l9.72"></a><span id="l9.72">   // this is a double fetch of the keywords property since we also fetch</span>
<a href="#l9.73"></a><span id="l9.73">   // it for the tags - do we want to do this?</span>
<a href="#l9.74"></a><span id="l9.74">   // I'm not sure anyone uses the kw- property, though it could be nice</span>
<a href="#l9.75"></a><span id="l9.75">   // for people wanting to extend the thread pane.</span>
<a href="#l9.76"></a><span id="l9.76">   nsCString keywordProperty;</span>
<a href="#l9.77"></a><span id="l9.77">   msgHdr-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywordProperty));</span>
<a href="#l9.78"></a><span id="l9.78">   if (!keywordProperty.IsEmpty())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -377,17 +377,17 @@ protected:</span>
<a href="#l10.4"></a><span id="l10.4">   PRBool IsValidIndex(nsMsgViewIndex index);</span>
<a href="#l10.5"></a><span id="l10.5">   nsresult ToggleIgnored(nsMsgViewIndex * indices, PRInt32 numIndices, nsMsgViewIndex *resultIndex, PRBool *resultToggleState);</span>
<a href="#l10.6"></a><span id="l10.6">   nsresult ToggleMessageKilled(nsMsgViewIndex * indices, PRInt32 numIndices, nsMsgViewIndex *resultIndex, PRBool *resultToggleState);</span>
<a href="#l10.7"></a><span id="l10.7">   PRBool OfflineMsgSelected(nsMsgViewIndex * indices, PRInt32 numIndices);</span>
<a href="#l10.8"></a><span id="l10.8">   PRBool NonDummyMsgSelected(nsMsgViewIndex * indices, PRInt32 numIndices);</span>
<a href="#l10.9"></a><span id="l10.9">   PRUnichar * GetString(const PRUnichar *aStringName);</span>
<a href="#l10.10"></a><span id="l10.10">   nsresult GetPrefLocalizedString(const char *aPrefName, nsString&amp; aResult);</span>
<a href="#l10.11"></a><span id="l10.11">   nsresult GetLabelPrefStringAndAtom(const char *aPrefName, nsString&amp; aColor, nsIAtom** aColorAtom);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  nsresult AppendKeywordProperties(const char *keywords, nsISupportsArray *properties, PRBool addSelectedTextProperty);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  nsresult AppendKeywordProperties(const nsACString&amp; keywords, nsISupportsArray *properties, PRBool addSelectedTextProperty);</span>
<a href="#l10.14"></a><span id="l10.14">   nsresult InitLabelStrings(void);</span>
<a href="#l10.15"></a><span id="l10.15">   nsresult CopyDBView(nsMsgDBView *aNewMsgDBView, nsIMessenger *aMessengerInstance, nsIMsgWindow *aMsgWindow, nsIMsgDBViewCommandUpdater *aCmdUpdater);</span>
<a href="#l10.16"></a><span id="l10.16">   void InitializeAtomsAndLiterals();</span>
<a href="#l10.17"></a><span id="l10.17">   virtual PRInt32 FindLevelInThread(nsIMsgDBHdr *msgHdr, nsMsgViewIndex startOfThread, nsMsgViewIndex viewIndex);</span>
<a href="#l10.18"></a><span id="l10.18">   nsresult GetImapDeleteModel(nsIMsgFolder *folder);</span>
<a href="#l10.19"></a><span id="l10.19">   nsresult UpdateDisplayMessage(nsMsgViewIndex viewPosition);</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21">   PRBool AdjustReadFlag(nsIMsgDBHdr *msgHdr, PRUint32 *msgFlags);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -41,16 +41,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> #include &quot;nsMsgTagService.h&quot;</span>
<a href="#l11.5"></a><span id="l11.5"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l11.6"></a><span id="l11.6"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l11.7"></a><span id="l11.7"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10"> #include &quot;nsMsgDBView.h&quot; // for labels migration</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;nsQuickSort.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13"> </span>
<a href="#l11.14"></a><span id="l11.14"> #define STRLEN(s) (sizeof(s) - 1)</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16"> #define TAG_PREF_VERSION        &quot;version&quot;</span>
<a href="#l11.17"></a><span id="l11.17"> #define TAG_PREF_SUFFIX_TAG     &quot;.tag&quot;</span>
<a href="#l11.18"></a><span id="l11.18"> #define TAG_PREF_SUFFIX_COLOR   &quot;.color&quot;</span>
<a href="#l11.19"></a><span id="l11.19"> #define TAG_PREF_SUFFIX_ORDINAL &quot;.ordinal&quot;</span>
<a href="#l11.20"></a><span id="l11.20"> #define TAG_CMP_LESSER          -1</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -210,23 +211,23 @@ NS_IMETHODIMP nsMsgTagService::GetKeyFor</span>
<a href="#l11.22"></a><span id="l11.22">       }</span>
<a href="#l11.23"></a><span id="l11.23">     }</span>
<a href="#l11.24"></a><span id="l11.24">   }</span>
<a href="#l11.25"></a><span id="l11.25">   NS_FREE_XPCOM_ALLOCATED_POINTER_ARRAY(count, prefList);</span>
<a href="#l11.26"></a><span id="l11.26">   ToLowerCase(aKey);</span>
<a href="#l11.27"></a><span id="l11.27">   return NS_OK;</span>
<a href="#l11.28"></a><span id="l11.28"> }</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-/* ACString getTopKey (in string keylist); */</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-NS_IMETHODIMP nsMsgTagService::GetTopKey(const char * keyList, nsACString &amp; _retval)</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+/* ACString getTopKey (in ACString keylist); */</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+NS_IMETHODIMP nsMsgTagService::GetTopKey(const nsACString &amp; keyList, nsACString &amp; _retval)</span>
<a href="#l11.34"></a><span id="l11.34"> {</span>
<a href="#l11.35"></a><span id="l11.35">   _retval.Truncate();</span>
<a href="#l11.36"></a><span id="l11.36">   // find the most important key</span>
<a href="#l11.37"></a><span id="l11.37">   nsCStringArray keyArray;</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-  keyArray.ParseString(keyList, &quot; &quot;);</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+  ParseString(keyList, ' ', keyArray);</span>
<a href="#l11.40"></a><span id="l11.40">   PRUint32 keyCount = keyArray.Count();</span>
<a href="#l11.41"></a><span id="l11.41">   nsCString *topKey = nsnull, *key, topOrdinal, ordinal;</span>
<a href="#l11.42"></a><span id="l11.42">   for (PRUint32 i = 0; i &lt; keyCount; ++i)</span>
<a href="#l11.43"></a><span id="l11.43">   {</span>
<a href="#l11.44"></a><span id="l11.44">     key = keyArray[i];</span>
<a href="#l11.45"></a><span id="l11.45">     if (key-&gt;IsEmpty())</span>
<a href="#l11.46"></a><span id="l11.46">       continue;</span>
<a href="#l11.47"></a><span id="l11.47"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -2080,17 +2080,17 @@ nsMsgDBFolder::CallFilterPlugins(nsIMsgW</span>
<a href="#l12.4"></a><span id="l12.4">     spamSettings-&gt;GetWhiteListAbURI(getter_Copies(whiteListAbURI));</span>
<a href="#l12.5"></a><span id="l12.5">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.6"></a><span id="l12.6">     if (!whiteListAbURI.IsEmpty())</span>
<a href="#l12.7"></a><span id="l12.7">     {</span>
<a href="#l12.8"></a><span id="l12.8">       nsCOMPtr &lt;nsIRDFService&gt; rdfService = do_GetService(&quot;@mozilla.org/rdf/rdf-service;1&quot;,&amp;rv);</span>
<a href="#l12.9"></a><span id="l12.9">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">       nsCStringArray whiteListArray;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-      whiteListArray.ParseString(whiteListAbURI.get(), &quot; &quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+      ParseString(whiteListAbURI, ' ', whiteListArray);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">       for (PRInt32 index = 0; index &lt; whiteListArray.Count(); index++)</span>
<a href="#l12.16"></a><span id="l12.16">       {</span>
<a href="#l12.17"></a><span id="l12.17">         nsCOMPtr&lt;nsIRDFResource&gt; resource;</span>
<a href="#l12.18"></a><span id="l12.18">         rv = rdfService-&gt;GetResource(*whiteListArray[index], getter_AddRefs(resource));</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20">         nsCOMPtr&lt;nsIAbDirectory&gt; whiteListDirectory =</span>
<a href="#l12.21"></a><span id="l12.21">           do_QueryInterface(resource, &amp;rv);</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -5272,17 +5272,17 @@ NS_IMETHODIMP nsMsgDBFolder::AddKeywords</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">     for(PRUint32 i = 0; i &lt; count; i++)</span>
<a href="#l12.25"></a><span id="l12.25">     {</span>
<a href="#l12.26"></a><span id="l12.26">       nsCOMPtr&lt;nsIMsgDBHdr&gt; message = do_QueryElementAt(aMessages, i, &amp;rv);</span>
<a href="#l12.27"></a><span id="l12.27">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.28"></a><span id="l12.28"> </span>
<a href="#l12.29"></a><span id="l12.29">       message-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywords));</span>
<a href="#l12.30"></a><span id="l12.30">       nsCStringArray keywordArray;</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-      keywordArray.ParseString(nsCString(aKeywords).get(), &quot; &quot;);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+      ParseString(aKeywords, ' ', keywordArray);</span>
<a href="#l12.33"></a><span id="l12.33">       PRUint32 addCount = 0;</span>
<a href="#l12.34"></a><span id="l12.34">       for (PRInt32 j = 0; j &lt; keywordArray.Count(); j++)</span>
<a href="#l12.35"></a><span id="l12.35">       {</span>
<a href="#l12.36"></a><span id="l12.36">         PRInt32 start, length;</span>
<a href="#l12.37"></a><span id="l12.37">         if (!MsgFindKeyword(*(keywordArray[j]), keywords, &amp;start, &amp;length))</span>
<a href="#l12.38"></a><span id="l12.38">         {</span>
<a href="#l12.39"></a><span id="l12.39">           if (!keywords.IsEmpty())</span>
<a href="#l12.40"></a><span id="l12.40">             keywords.Append(' ');</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineat">@@ -5317,17 +5317,17 @@ NS_IMETHODIMP nsMsgDBFolder::RemoveKeywo</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43">     for(PRUint32 i = 0; i &lt; count; i++)</span>
<a href="#l12.44"></a><span id="l12.44">     {</span>
<a href="#l12.45"></a><span id="l12.45">       nsCOMPtr&lt;nsIMsgDBHdr&gt; message = do_QueryElementAt(aMessages, i, &amp;rv);</span>
<a href="#l12.46"></a><span id="l12.46">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.47"></a><span id="l12.47">       rv = message-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywords));</span>
<a href="#l12.48"></a><span id="l12.48">       nsCAutoString originalKeywords(keywords);</span>
<a href="#l12.49"></a><span id="l12.49">       nsCStringArray keywordArray;</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-      keywordArray.ParseString(nsCString(aKeywords).get(), &quot; &quot;);</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+      ParseString(aKeywords, ' ', keywordArray);</span>
<a href="#l12.52"></a><span id="l12.52">       PRUint32 removeCount = 0;</span>
<a href="#l12.53"></a><span id="l12.53">       for (PRInt32 j = 0; j &lt; keywordArray.Count(); j++)</span>
<a href="#l12.54"></a><span id="l12.54">       {</span>
<a href="#l12.55"></a><span id="l12.55">         PRBool keywordIsLabel = (StringBeginsWith(*(keywordArray[j]), NS_LITERAL_CSTRING(&quot;$label&quot;))</span>
<a href="#l12.56"></a><span id="l12.56">           &amp;&amp; keywordArray[j]-&gt;CharAt(6) &gt;= '1' &amp;&amp; keywordArray[j]-&gt;CharAt(6) &lt;= '5');</span>
<a href="#l12.57"></a><span id="l12.57">         if (keywordIsLabel)</span>
<a href="#l12.58"></a><span id="l12.58">         {</span>
<a href="#l12.59"></a><span id="l12.59">           nsMsgLabelValue labelValue;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1854,8 +1854,69 @@ NS_MSG_BASE nsresult MsgGetHeadersFromKe</span>
<a href="#l13.4"></a><span id="l13.4">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6">       aHeaders-&gt;AppendElement(msgHdr, PR_FALSE);</span>
<a href="#l13.7"></a><span id="l13.7">     }</span>
<a href="#l13.8"></a><span id="l13.8">   }</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10">   return rv;</span>
<a href="#l13.11"></a><span id="l13.11"> }</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+NS_MSG_BASE PRBool ParseString(const char *string, const char *delims, nsCStringArray&amp; array)</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+{</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+  if (string &amp;&amp; *string &amp;&amp; delims &amp;&amp; *delims) {</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+    PRInt32 count = array.Count();</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+    nsCString copy(string);</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+    char *buffer = copy.BeginWriting();</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+    char *token;</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+    while ((token = NS_strtok(delims, &amp;buffer)) != nsnull) {</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+      if (!array.AppendCString(nsDependentCString(token))) {</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+        while (array.Count() &gt; count)</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+          array.RemoveCStringAt(array.Count() - 1);</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+        return PR_FALSE;</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+      }</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+    }</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+  }</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+  return PR_TRUE;</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+}</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+NS_MSG_BASE PRBool ParseString(const nsACString&amp; string, char delimiter, nsCStringArray&amp; array)</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+{</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+  if (string.IsEmpty())</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+    return PR_TRUE;</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+  PRInt32 count = array.Count();</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+  PRInt32 start = 0;</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+  for (;;) {</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+    PRInt32 end = string.FindChar(delimiter, start);</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+    if (end != start &amp;&amp; !array.AppendCString(Substring(string, start, end)))</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+      break;</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+    if (end == -1)</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+      return PR_TRUE;</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+    start = end + 1;</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+  }</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+  while (array.Count() &gt; count)</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+    array.RemoveCStringAt(array.Count() - 1);</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+  return PR_FALSE;</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+}</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+#ifdef MOZILLA_1_9_1_BRANCH</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+NS_MSG_BASE PRBool ParseString(const nsACString&amp; string, char delimiter, nsTArray&lt;nsCString&gt;&amp; array)</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+{</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+  if (string.IsEmpty())</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+    return PR_TRUE;</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+  PRUint32 count = array.Length();</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+  PRInt32 start = 0;</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+  for (;;) {</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+    PRInt32 end = string.FindChar(delimiter, start);</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+    if (end != start &amp;&amp; !array.AppendElement(Substring(string, start, end)))</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+      break;</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+    if (end == -1)</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+      return PR_TRUE;</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+    start = end + 1;</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+  }</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+  array.RemoveElementsAt(count, array.Length() - count);</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+  return PR_FALSE;</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+}</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -207,10 +207,54 @@ NS_MSG_BASE char *MsgEscapeHTML(const ch</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> NS_MSG_BASE PRUnichar *MsgEscapeHTML(const PRUnichar *aSourceBuffer,</span>
<a href="#l14.6"></a><span id="l14.6">                                      PRInt32 aSourceBufferLen);</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> // Converts an array of nsMsgKeys plus a database, to an array of nsIMsgDBHdrs.</span>
<a href="#l14.9"></a><span id="l14.9"> NS_MSG_BASE nsresult MsgGetHeadersFromKeys(nsIMsgDatabase *aDB, const nsTArray&lt;nsMsgKey&gt; &amp;aKeys,</span>
<a href="#l14.10"></a><span id="l14.10">                                            nsIMutableArray *aHeaders);</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+/**</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+ * Parses a given string using the delimiters passed in. Items parsed from the</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+ * string will be appended to the array.</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+ *</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+ * @param string</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+ *        The string to parse.</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+ * @param delims</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+ *        A set of delimter characters.</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+ * @param array</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+ *        The array to append tokens to.</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+ * @deprecated This call needs to be converted to the nsTArray&lt;nsCString&gt; api.</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+ */</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+NS_MSG_BASE PRBool ParseString(const char *string, const char *delims, nsCStringArray&amp; array);</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+/**</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+ * Parses a given string using the delimiter passed in. Items parsed from the</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+ * string will be appended to the array.</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+ *</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+ * @param string</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+ *        The string to parse.</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+ * @param delimiter</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+ *        A delimter character.</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+ * @param array</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+ *        The array to append tokens to.</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+ * @deprecated Use an nsTArray&lt;nsCString&gt; instead of an nsCStringArray.</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+ */</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+NS_MSG_BASE PRBool ParseString(const nsACString&amp; string, char delimiter, nsCStringArray&amp; array);</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+#ifdef MOZILLA_1_9_1_BRANCH</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+/**</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+ * Parses a given string using the delimiter passed in. Items parsed from the</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+ * string will be appended to the array. This version is only used on the</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+ * MOZILLA_1_9_1_BRANCH as the trunk already has a suitable function.</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+ *</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+ * @param string</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+ *        The string to parse.</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+ * @param delimiter</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+ *        A delimter character.</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+ * @param array</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+ *        The array to append tokens to.</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+ */</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+NS_MSG_BASE PRBool ParseString(const nsACString&amp; string, char delimiter, nsTArray&lt;nsCString&gt;&amp; array);</span>
<a href="#l14.54"></a><span id="l14.54"> #endif</span>
<a href="#l14.55"></a><span id="l14.55"> </span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+#endif</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -529,17 +529,17 @@ mime_generate_headers (nsMsgCompFields *</span>
<a href="#l15.4"></a><span id="l15.4">     nsCOMPtr &lt;nsINntpService&gt; nntpService = do_GetService(&quot;@mozilla.org/messenger/nntpservice;1&quot;);</span>
<a href="#l15.5"></a><span id="l15.5">     if (NS_FAILED(rv) || !nntpService) {</span>
<a href="#l15.6"></a><span id="l15.6">       *status = NS_ERROR_FAILURE;</span>
<a href="#l15.7"></a><span id="l15.7">       return nsnull;</span>
<a href="#l15.8"></a><span id="l15.8">     }</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">     nsCString newsgroupsHeaderVal;</span>
<a href="#l15.11"></a><span id="l15.11">     nsCString newshostHeaderVal;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    rv = nntpService-&gt;GenerateNewsHeaderValsForPosting(n2, getter_Copies(newsgroupsHeaderVal), getter_Copies(newshostHeaderVal));</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+    rv = nntpService-&gt;GenerateNewsHeaderValsForPosting(nsDependentCString(n2), getter_Copies(newsgroupsHeaderVal), getter_Copies(newshostHeaderVal));</span>
<a href="#l15.14"></a><span id="l15.14">     if (NS_FAILED(rv)) </span>
<a href="#l15.15"></a><span id="l15.15">     {</span>
<a href="#l15.16"></a><span id="l15.16">       *status = rv;</span>
<a href="#l15.17"></a><span id="l15.17">       return nsnull;</span>
<a href="#l15.18"></a><span id="l15.18">     }</span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20">     // fixme:the newsgroups header had better be encoded as the server-side</span>
<a href="#l15.21"></a><span id="l15.21">     // character encoding, but this |charset| might be different from it.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1388,27 +1388,27 @@ nsresult nsMsgComposeService::AddGlobalH</span>
<a href="#l16.4"></a><span id="l16.4">       nsCString currentHtmlDomainList;</span>
<a href="#l16.5"></a><span id="l16.5">       rv = prefBranch-&gt;GetCharPref(USER_CURRENT_HTMLDOMAINLIST_PREF_NAME, getter_Copies(currentHtmlDomainList));</span>
<a href="#l16.6"></a><span id="l16.6">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">       nsCAutoString newHtmlDomainList(currentHtmlDomainList);</span>
<a href="#l16.9"></a><span id="l16.9">       // Get the current html domain list into new list var</span>
<a href="#l16.10"></a><span id="l16.10">       nsCStringArray htmlDomainArray;</span>
<a href="#l16.11"></a><span id="l16.11">       if (!currentHtmlDomainList.IsEmpty())</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        htmlDomainArray.ParseString(currentHtmlDomainList.get(), DOMAIN_DELIMITER);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+        ParseString(currentHtmlDomainList.get(), DOMAIN_DELIMITER, htmlDomainArray);</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15">       // Get user's current Plaintext domain set for send format</span>
<a href="#l16.16"></a><span id="l16.16">       nsCString currentPlaintextDomainList;</span>
<a href="#l16.17"></a><span id="l16.17">       rv = prefBranch-&gt;GetCharPref(USER_CURRENT_PLAINTEXTDOMAINLIST_PREF_NAME, getter_Copies(currentPlaintextDomainList));</span>
<a href="#l16.18"></a><span id="l16.18">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20">       // Get the current plaintext domain list into new list var</span>
<a href="#l16.21"></a><span id="l16.21">       nsCStringArray plaintextDomainArray;</span>
<a href="#l16.22"></a><span id="l16.22">       if (!currentPlaintextDomainList.IsEmpty())</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-        plaintextDomainArray.ParseString(currentPlaintextDomainList.get(), DOMAIN_DELIMITER);</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+        ParseString(currentPlaintextDomainList.get(), DOMAIN_DELIMITER, plaintextDomainArray);</span>
<a href="#l16.25"></a><span id="l16.25"> </span>
<a href="#l16.26"></a><span id="l16.26">       if (htmlDomainArray.Count() || plaintextDomainArray.Count()) {</span>
<a href="#l16.27"></a><span id="l16.27">         // Tokenize the data and add each html domain if it is not alredy there in</span>
<a href="#l16.28"></a><span id="l16.28">         // the user's current html or plaintext domain lists</span>
<a href="#l16.29"></a><span id="l16.29">         char *newData = globalHtmlDomainList.BeginWriting();</span>
<a href="#l16.30"></a><span id="l16.30">         char *token = NS_strtok(DOMAIN_DELIMITER, &amp;newData);</span>
<a href="#l16.31"></a><span id="l16.31"> </span>
<a href="#l16.32"></a><span id="l16.32">         nsCAutoString htmlDomain;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -706,17 +706,17 @@ nsresult nsMsgSendLater::SetOrigMsgDispo</span>
<a href="#l17.4"></a><span id="l17.4">   // or forward of.</span>
<a href="#l17.5"></a><span id="l17.5">   nsCString originalMsgURIs;</span>
<a href="#l17.6"></a><span id="l17.6">   nsCString queuedDisposition;</span>
<a href="#l17.7"></a><span id="l17.7">   mMessage-&gt;GetStringProperty(ORIG_URI_PROPERTY, getter_Copies(originalMsgURIs));</span>
<a href="#l17.8"></a><span id="l17.8">   mMessage-&gt;GetStringProperty(QUEUED_DISPOSITION_PROPERTY, getter_Copies(queuedDisposition));</span>
<a href="#l17.9"></a><span id="l17.9">   if (!queuedDisposition.IsEmpty())</span>
<a href="#l17.10"></a><span id="l17.10">   {</span>
<a href="#l17.11"></a><span id="l17.11">     nsCStringArray uriArray;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    uriArray.ParseString(originalMsgURIs.get(), &quot;,&quot;);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    ParseString(originalMsgURIs, ',', uriArray);</span>
<a href="#l17.14"></a><span id="l17.14">     for (PRInt32 i = 0; i &lt; uriArray.Count(); i++)</span>
<a href="#l17.15"></a><span id="l17.15">     {</span>
<a href="#l17.16"></a><span id="l17.16">       nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l17.17"></a><span id="l17.17">       nsresult rv = GetMsgDBHdrFromURI(uriArray[i]-&gt;get(), getter_AddRefs(msgHdr));</span>
<a href="#l17.18"></a><span id="l17.18">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l17.19"></a><span id="l17.19">       if (msgHdr)</span>
<a href="#l17.20"></a><span id="l17.20">       {</span>
<a href="#l17.21"></a><span id="l17.21">         // get the folder for the message resource</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -400,17 +400,17 @@ nsSmtpService::loadSmtpServers()</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">     //Get the pref in a tempServerList and then parse it to see if it has dupes.</span>
<a href="#l18.6"></a><span id="l18.6">     //if so remove the dupes and then create the serverList.</span>
<a href="#l18.7"></a><span id="l18.7">     if (!tempServerList.IsEmpty()) {</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">       // Tokenize the data and add each smtp server if it is not already there </span>
<a href="#l18.10"></a><span id="l18.10">       // in the user's current smtp server list</span>
<a href="#l18.11"></a><span id="l18.11">       nsCStringArray servers;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-      servers.ParseString(tempServerList.get(), SERVER_DELIMITER);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+      ParseString(tempServerList.get(), SERVER_DELIMITER, servers);</span>
<a href="#l18.14"></a><span id="l18.14">       nsCAutoString tempSmtpServer;</span>
<a href="#l18.15"></a><span id="l18.15">       for (PRInt32 i = 0; i &lt; servers.Count(); i++)</span>
<a href="#l18.16"></a><span id="l18.16">       {</span>
<a href="#l18.17"></a><span id="l18.17">           if (servers.IndexOf(* (servers[i])) == i) {</span>
<a href="#l18.18"></a><span id="l18.18">             tempSmtpServer.Assign(* (servers[i]));</span>
<a href="#l18.19"></a><span id="l18.19">             tempSmtpServer.StripWhitespace();</span>
<a href="#l18.20"></a><span id="l18.20">             if (!serverList.IsEmpty())</span>
<a href="#l18.21"></a><span id="l18.21">               serverList += SERVER_DELIMITER;</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -463,17 +463,17 @@ nsSmtpService::loadSmtpServers()</span>
<a href="#l18.23"></a><span id="l18.23">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l18.24"></a><span id="l18.24"> </span>
<a href="#l18.25"></a><span id="l18.25">       // Update the smtp server list if needed</span>
<a href="#l18.26"></a><span id="l18.26">       if ((appendSmtpServersCurrentVersion &lt;= appendSmtpServersDefaultVersion)) {</span>
<a href="#l18.27"></a><span id="l18.27">         // If there are pre-configured servers, add them to the existing server list</span>
<a href="#l18.28"></a><span id="l18.28">         if (!appendServerList.IsEmpty()) {</span>
<a href="#l18.29"></a><span id="l18.29">           if (!serverList.IsEmpty()) {</span>
<a href="#l18.30"></a><span id="l18.30">             nsCStringArray existingSmtpServersArray;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-            existingSmtpServersArray.ParseString(serverList.get(), SERVER_DELIMITER);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+            ParseString(serverList.get(), SERVER_DELIMITER, existingSmtpServersArray);</span>
<a href="#l18.33"></a><span id="l18.33"> </span>
<a href="#l18.34"></a><span id="l18.34">             // Tokenize the data and add each smtp server if it is not already there </span>
<a href="#l18.35"></a><span id="l18.35">             // in the user's current smtp server list</span>
<a href="#l18.36"></a><span id="l18.36">             char *newSmtpServerStr = appendServerList.BeginWriting(); </span>
<a href="#l18.37"></a><span id="l18.37">             char *token = NS_strtok(SERVER_DELIMITER, &amp;newSmtpServerStr);</span>
<a href="#l18.38"></a><span id="l18.38"> </span>
<a href="#l18.39"></a><span id="l18.39">             nsCAutoString newSmtpServer;</span>
<a href="#l18.40"></a><span id="l18.40">             while (token) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -392,17 +392,17 @@ nsImapProtocol::nsImapProtocol() : nsMsg</span>
<a href="#l19.4"></a><span id="l19.4">                                 getter_AddRefs(prefString));</span>
<a href="#l19.5"></a><span id="l19.5">     if (prefString)</span>
<a href="#l19.6"></a><span id="l19.6">       prefString-&gt;ToString(getter_Copies(mAcceptLanguages));</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8">     nsCString customDBHeaders;</span>
<a href="#l19.9"></a><span id="l19.9">     prefBranch-&gt;GetCharPref(&quot;mailnews.customDBHeaders&quot;,</span>
<a href="#l19.10"></a><span id="l19.10">                             getter_Copies(customDBHeaders));</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    mCustomDBHeaders.ParseString(customDBHeaders.get(), &quot; &quot;);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    ParseString(customDBHeaders, ' ', mCustomDBHeaders);</span>
<a href="#l19.14"></a><span id="l19.14">   }</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16">     // ***** Thread support *****</span>
<a href="#l19.17"></a><span id="l19.17">   m_thread = nsnull;</span>
<a href="#l19.18"></a><span id="l19.18">   m_dataAvailableMonitor = nsnull;</span>
<a href="#l19.19"></a><span id="l19.19">   m_urlReadyToRunMonitor = nsnull;</span>
<a href="#l19.20"></a><span id="l19.20">   m_pseudoInterruptMonitor = nsnull;</span>
<a href="#l19.21"></a><span id="l19.21">   m_dataMemberMonitor = nsnull;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -3902,17 +3902,17 @@ nsresult nsMsgLocalMailFolder::ChangeKey</span>
<a href="#l20.4"></a><span id="l20.4">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.5"></a><span id="l20.5">       PRUint32 messageOffset;</span>
<a href="#l20.6"></a><span id="l20.6">       message-&gt;GetMessageOffset(&amp;messageOffset);</span>
<a href="#l20.7"></a><span id="l20.7">       PRUint32 statusOffset = 0;</span>
<a href="#l20.8"></a><span id="l20.8">       (void)message-&gt;GetStatusOffset(&amp;statusOffset);</span>
<a href="#l20.9"></a><span id="l20.9">       PRUint32 desiredOffset = messageOffset + statusOffset;</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">       nsCStringArray keywordArray;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-      keywordArray.ParseString(nsCString(aKeywords).get(), &quot; &quot;);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+      ParseString(aKeywords, ' ', keywordArray);</span>
<a href="#l20.14"></a><span id="l20.14">       for (PRInt32 j = 0; j &lt; keywordArray.Count(); j++)</span>
<a href="#l20.15"></a><span id="l20.15">       {</span>
<a href="#l20.16"></a><span id="l20.16">         nsCAutoString header;</span>
<a href="#l20.17"></a><span id="l20.17">         nsCAutoString keywords;</span>
<a href="#l20.18"></a><span id="l20.18">         PRBool done = PR_FALSE;</span>
<a href="#l20.19"></a><span id="l20.19">         PRUint32 len = 0;</span>
<a href="#l20.20"></a><span id="l20.20">         nsCAutoString keywordToWrite(&quot; &quot;);</span>
<a href="#l20.21"></a><span id="l20.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -521,17 +521,17 @@ nsParseMailMessageState::nsParseMailMess</span>
<a href="#l21.4"></a><span id="l21.4">   // &quot;x-spam-score&quot; property of nsMsgHdr to the value of the header.</span>
<a href="#l21.5"></a><span id="l21.5">   m_customDBHeaderValues = nsnull;</span>
<a href="#l21.6"></a><span id="l21.6">   nsCString customDBHeaders;</span>
<a href="#l21.7"></a><span id="l21.7">   nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l21.8"></a><span id="l21.8">   if (pPrefBranch)</span>
<a href="#l21.9"></a><span id="l21.9">   {</span>
<a href="#l21.10"></a><span id="l21.10">      pPrefBranch-&gt;GetCharPref(&quot;mailnews.customDBHeaders&quot;,  getter_Copies(customDBHeaders));</span>
<a href="#l21.11"></a><span id="l21.11">      ToLowerCase(customDBHeaders);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-     m_customDBHeaders.ParseString(customDBHeaders.get(), &quot; &quot;);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+     ParseString(customDBHeaders, ' ', m_customDBHeaders);</span>
<a href="#l21.14"></a><span id="l21.14">      if (m_customDBHeaders.Count())</span>
<a href="#l21.15"></a><span id="l21.15">      {</span>
<a href="#l21.16"></a><span id="l21.16">        m_customDBHeaderValues = new struct message_header [m_customDBHeaders.Count()];</span>
<a href="#l21.17"></a><span id="l21.17">        if (!m_customDBHeaderValues)</span>
<a href="#l21.18"></a><span id="l21.18">          m_customDBHeaders.Clear();</span>
<a href="#l21.19"></a><span id="l21.19">      }</span>
<a href="#l21.20"></a><span id="l21.20">   }</span>
<a href="#l21.21"></a><span id="l21.21">   Clear();</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -1535,18 +1535,18 @@ int nsParseMailMessageState::FinalizeHea</span>
<a href="#l21.23"></a><span id="l21.23">           m_newMsgHdr-&gt;SetPriority(nsMsgPriority::none);</span>
<a href="#l21.24"></a><span id="l21.24">         if (keywords)</span>
<a href="#l21.25"></a><span id="l21.25">         {</span>
<a href="#l21.26"></a><span id="l21.26">           // When there are many keywords, some may not have been written</span>
<a href="#l21.27"></a><span id="l21.27">           // to the message file, so add extra keywords from the backup</span>
<a href="#l21.28"></a><span id="l21.28">           nsCAutoString oldKeywords;</span>
<a href="#l21.29"></a><span id="l21.29">           m_newMsgHdr-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(oldKeywords));</span>
<a href="#l21.30"></a><span id="l21.30">           nsCStringArray newKeywordArray, oldKeywordArray;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-          newKeywordArray.ParseString(keywords-&gt;value, &quot; &quot;);</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-          oldKeywordArray.ParseString(oldKeywords.get(), &quot; &quot;);</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+          ParseString(Substring(keywords-&gt;value, keywords-&gt;value + keywords-&gt;length), ' ', newKeywordArray);</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+          ParseString(oldKeywords, ' ', oldKeywordArray);</span>
<a href="#l21.35"></a><span id="l21.35">           for (PRInt32 i = 0; i &lt; oldKeywordArray.Count(); i++)</span>
<a href="#l21.36"></a><span id="l21.36">             if (newKeywordArray.IndexOf(*oldKeywordArray.CStringAt(i)) &lt; 0)</span>
<a href="#l21.37"></a><span id="l21.37">               newKeywordArray.AppendCString(*oldKeywordArray.CStringAt(i));</span>
<a href="#l21.38"></a><span id="l21.38">           nsCAutoString newKeywords;</span>
<a href="#l21.39"></a><span id="l21.39">           for (PRInt32 i = 0; i &lt; newKeywordArray.Count(); i++)</span>
<a href="#l21.40"></a><span id="l21.40">           {</span>
<a href="#l21.41"></a><span id="l21.41">             if (i)</span>
<a href="#l21.42"></a><span id="l21.42">               newKeywords.Append(&quot; &quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -271,17 +271,17 @@ net_pop3_load_state(const char* searchho</span>
<a href="#l22.4"></a><span id="l22.4">       }</span>
<a href="#l22.5"></a><span id="l22.5">     }</span>
<a href="#l22.6"></a><span id="l22.6">     else</span>
<a href="#l22.7"></a><span id="l22.7">     {</span>
<a href="#l22.8"></a><span id="l22.8">       /* It's a line with a UIDL on it. */</span>
<a href="#l22.9"></a><span id="l22.9">       if (current)</span>
<a href="#l22.10"></a><span id="l22.10">       {</span>
<a href="#l22.11"></a><span id="l22.11">         nsCStringArray lineElems;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-        lineElems.ParseString(line.get(), &quot; \t&quot;);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+        ParseString(line.get(), &quot; \t&quot;, lineElems);</span>
<a href="#l22.14"></a><span id="l22.14">         if (lineElems.Count() &lt; 2)</span>
<a href="#l22.15"></a><span id="l22.15">           continue;</span>
<a href="#l22.16"></a><span id="l22.16">         nsCString *flags = lineElems[0];</span>
<a href="#l22.17"></a><span id="l22.17">         nsCString *uidl = lineElems[1];</span>
<a href="#l22.18"></a><span id="l22.18">         nsCString *dateReceivedStr = lineElems[2]; // will be null if only 2 elements.</span>
<a href="#l22.19"></a><span id="l22.19">         PRUint32 dateReceived = TimeInSecondsFromPRTime(PR_Now()); // if we don't find a date str, assume now.</span>
<a href="#l22.20"></a><span id="l22.20">         if (dateReceivedStr &amp;&amp; !dateReceivedStr-&gt;IsEmpty())</span>
<a href="#l22.21"></a><span id="l22.21">           dateReceived = atoi(dateReceivedStr-&gt;get());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -56,21 +56,60 @@</span>
<a href="#l23.4"></a><span id="l23.4"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l23.5"></a><span id="l23.5"> // hack: include this to fix opening news attachments.</span>
<a href="#l23.6"></a><span id="l23.6"> #include &quot;nsINntpUrl.h&quot;</span>
<a href="#l23.7"></a><span id="l23.7"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l23.8"></a><span id="l23.8"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l23.9"></a><span id="l23.9"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l23.10"></a><span id="l23.10"> #include &quot;nsDateTimeFormatCID.h&quot;</span>
<a href="#l23.11"></a><span id="l23.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+#include &quot;nsAutoPtr.h&quot;</span>
<a href="#l23.13"></a><span id="l23.13"> #include &quot;nsINetUtil.h&quot;</span>
<a href="#l23.14"></a><span id="l23.14"> #include &quot;nsMemory.h&quot;</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16"> #define VIEW_ALL_HEADERS 2</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18" class="difflineplus">+/**</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineplus">+ * A helper class to implement nsIUTF8StringEnumerator</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineplus">+ */</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineplus">+</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineplus">+class nsMimeStringEnumerator : public nsIUTF8StringEnumerator {</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineplus">+public:</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineplus">+  NS_DECL_ISUPPORTS</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineplus">+  NS_DECL_NSIUTF8STRINGENUMERATOR</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineplus">+</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineplus">+  template&lt;class T&gt;</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineplus">+  nsCString* Append(T value) { return values.AppendElement(value); }</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineplus">+</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineplus">+protected:</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineplus">+  nsTArray&lt;nsCString&gt; values;</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+};</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineplus">+</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+NS_IMPL_ISUPPORTS1(nsMimeStringEnumerator, nsIUTF8StringEnumerator)</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineplus">+nsMimeStringEnumerator::HasMore(PRBool *result)</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineplus">+{</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineplus">+  NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineplus">+  *result = values.Length() != 0;</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineplus">+  return NS_OK;</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineplus">+}</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineplus">+</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineplus">+NS_IMETHODIMP nsMimeStringEnumerator::GetNext(nsACString&amp; result)</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineplus">+{</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineplus">+  PRUint32 length = values.Length();</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineplus">+  if (!length)</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineplus">+    return NS_ERROR_UNEXPECTED;</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineplus">+</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineplus">+  length--;</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+  result = values[length];</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineplus">+  values.RemoveElementAt(length);</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineplus">+  return NS_OK;</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineplus">+}</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineplus">+</span>
<a href="#l23.56"></a><span id="l23.56"> /*</span>
<a href="#l23.57"></a><span id="l23.57">  * nsMimeHtmlEmitter definitions....</span>
<a href="#l23.58"></a><span id="l23.58">  */</span>
<a href="#l23.59"></a><span id="l23.59"> nsMimeHtmlDisplayEmitter::nsMimeHtmlDisplayEmitter() : nsMimeBaseEmitter()</span>
<a href="#l23.60"></a><span id="l23.60"> {</span>
<a href="#l23.61"></a><span id="l23.61">   mFirst = PR_TRUE;</span>
<a href="#l23.62"></a><span id="l23.62">   mSkipAttachment = PR_FALSE;</span>
<a href="#l23.63"></a><span id="l23.63"> }</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineat">@@ -150,38 +189,37 @@ nsMimeHtmlDisplayEmitter::GetHeaderSink(</span>
<a href="#l23.65"></a><span id="l23.65">   *aHeaderSink = mHeaderSink;</span>
<a href="#l23.66"></a><span id="l23.66">   NS_IF_ADDREF(*aHeaderSink);</span>
<a href="#l23.67"></a><span id="l23.67">   return rv;</span>
<a href="#l23.68"></a><span id="l23.68"> }</span>
<a href="#l23.69"></a><span id="l23.69"> </span>
<a href="#l23.70"></a><span id="l23.70"> nsresult nsMimeHtmlDisplayEmitter::BroadcastHeaders(nsIMsgHeaderSink * aHeaderSink, PRInt32 aHeaderMode, PRBool aFromNewsgroup)</span>
<a href="#l23.71"></a><span id="l23.71"> {</span>
<a href="#l23.72"></a><span id="l23.72">   // two string enumerators to pass out to the header sink</span>
<a href="#l23.73"></a><span id="l23.73" class="difflineminus">-  nsCOMPtr&lt;nsIUTF8StringEnumerator&gt; headerNameEnumerator;</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineminus">-  nsCOMPtr&lt;nsIUTF8StringEnumerator&gt; headerValueEnumerator;</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineplus">+  nsRefPtr&lt;nsMimeStringEnumerator&gt; headerNameEnumerator = new nsMimeStringEnumerator();</span>
<a href="#l23.76"></a><span id="l23.76" class="difflineplus">+  NS_ENSURE_TRUE(headerNameEnumerator, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineplus">+  nsRefPtr&lt;nsMimeStringEnumerator&gt; headerValueEnumerator = new nsMimeStringEnumerator();</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineplus">+  NS_ENSURE_TRUE(headerValueEnumerator, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l23.79"></a><span id="l23.79"> </span>
<a href="#l23.80"></a><span id="l23.80" class="difflineminus">-  // CStringArrays which we can pass into the enumerators</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineminus">-  nsCStringArray headerNameArray;</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineminus">-  nsCStringArray headerValueArray;</span>
<a href="#l23.83"></a><span id="l23.83">   nsCString extraExpandedHeaders;</span>
<a href="#l23.84"></a><span id="l23.84">   nsCStringArray extraExpandedHeadersArray;</span>
<a href="#l23.85"></a><span id="l23.85">   nsCAutoString convertedDateString;</span>
<a href="#l23.86"></a><span id="l23.86"> </span>
<a href="#l23.87"></a><span id="l23.87">   PRBool displayOriginalDate = PR_FALSE;</span>
<a href="#l23.88"></a><span id="l23.88">   nsresult rv;</span>
<a href="#l23.89"></a><span id="l23.89">   nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l23.90"></a><span id="l23.90">   if (pPrefBranch)</span>
<a href="#l23.91"></a><span id="l23.91">   {</span>
<a href="#l23.92"></a><span id="l23.92">     pPrefBranch-&gt;GetBoolPref(&quot;mailnews.display.original_date&quot;, &amp;displayOriginalDate);</span>
<a href="#l23.93"></a><span id="l23.93">     pPrefBranch-&gt;GetCharPref(&quot;mailnews.headers.extraExpandedHeaders&quot;, getter_Copies(extraExpandedHeaders));</span>
<a href="#l23.94"></a><span id="l23.94">     // todo - should make this upper case</span>
<a href="#l23.95"></a><span id="l23.95">     if (!extraExpandedHeaders.IsEmpty())</span>
<a href="#l23.96"></a><span id="l23.96">     {</span>
<a href="#l23.97"></a><span id="l23.97">       ToLowerCase(extraExpandedHeaders);</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineminus">-      extraExpandedHeadersArray.ParseString(extraExpandedHeaders.get(), &quot; &quot;);</span>
<a href="#l23.99"></a><span id="l23.99" class="difflineplus">+      ParseString(extraExpandedHeaders, ' ', extraExpandedHeadersArray);</span>
<a href="#l23.100"></a><span id="l23.100">     }</span>
<a href="#l23.101"></a><span id="l23.101"> </span>
<a href="#l23.102"></a><span id="l23.102">   }</span>
<a href="#l23.103"></a><span id="l23.103"> </span>
<a href="#l23.104"></a><span id="l23.104">   for (PRInt32 i=0; i&lt;mHeaderArray-&gt;Count(); i++)</span>
<a href="#l23.105"></a><span id="l23.105">   {</span>
<a href="#l23.106"></a><span id="l23.106">     headerInfoType * headerInfo = (headerInfoType *) mHeaderArray-&gt;ElementAt(i);</span>
<a href="#l23.107"></a><span id="l23.107">     if ( (!headerInfo) || (!headerInfo-&gt;name) || (!(*headerInfo-&gt;name)) || (!headerInfo-&gt;value) || (!(*headerInfo-&gt;value)))</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineat">@@ -208,31 +246,24 @@ nsresult nsMimeHtmlDisplayEmitter::Broad</span>
<a href="#l23.109"></a><span id="l23.109">          (!extraExpandedHeadersArray.Count() || (ToLowerCase(headerStr),</span>
<a href="#l23.110"></a><span id="l23.110">             extraExpandedHeadersArray.IndexOf(headerStr) == -1)))</span>
<a href="#l23.111"></a><span id="l23.111">             continue;</span>
<a href="#l23.112"></a><span id="l23.112">     }</span>
<a href="#l23.113"></a><span id="l23.113"> </span>
<a href="#l23.114"></a><span id="l23.114">     if (!PL_strcasecmp(&quot;Date&quot;, headerInfo-&gt;name) &amp;&amp; !displayOriginalDate)</span>
<a href="#l23.115"></a><span id="l23.115">     {</span>
<a href="#l23.116"></a><span id="l23.116">       GenerateDateString(headerValue, convertedDateString);</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineminus">-      headerValueArray.AppendCString(convertedDateString);</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineplus">+      headerValueEnumerator-&gt;Append(convertedDateString);</span>
<a href="#l23.119"></a><span id="l23.119">     }</span>
<a href="#l23.120"></a><span id="l23.120">     else // append the header value as is</span>
<a href="#l23.121"></a><span id="l23.121" class="difflineminus">-      headerValueArray.AppendCString(nsCString(headerValue));</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineplus">+      headerValueEnumerator-&gt;Append(headerValue);</span>
<a href="#l23.123"></a><span id="l23.123"> </span>
<a href="#l23.124"></a><span id="l23.124" class="difflineminus">-    // XXX: TODO If nsCStringArray were converted over to take nsACStrings instead of nsCStrings, we can just</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineminus">-    // wrap these strings with a nsDependentCString which would avoid making a duplicate copy of the string</span>
<a href="#l23.126"></a><span id="l23.126" class="difflineminus">-    // like we are doing here....</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineminus">-    headerNameArray.AppendCString(nsCString(headerInfo-&gt;name));</span>
<a href="#l23.128"></a><span id="l23.128" class="difflineplus">+    headerNameEnumerator-&gt;Append(headerInfo-&gt;name);</span>
<a href="#l23.129"></a><span id="l23.129">   }</span>
<a href="#l23.130"></a><span id="l23.130"> </span>
<a href="#l23.131"></a><span id="l23.131" class="difflineminus">-  // turn our string arrays into enumerators</span>
<a href="#l23.132"></a><span id="l23.132" class="difflineminus">-  NS_NewUTF8StringEnumerator(getter_AddRefs(headerNameEnumerator), &amp;headerNameArray);</span>
<a href="#l23.133"></a><span id="l23.133" class="difflineminus">-  NS_NewUTF8StringEnumerator(getter_AddRefs(headerValueEnumerator), &amp;headerValueArray);</span>
<a href="#l23.134"></a><span id="l23.134" class="difflineminus">-</span>
<a href="#l23.135"></a><span id="l23.135">   aHeaderSink-&gt;ProcessHeaders(headerNameEnumerator, headerValueEnumerator, aFromNewsgroup);</span>
<a href="#l23.136"></a><span id="l23.136">   return rv;</span>
<a href="#l23.137"></a><span id="l23.137"> }</span>
<a href="#l23.138"></a><span id="l23.138"> </span>
<a href="#l23.139"></a><span id="l23.139"> NS_IMETHODIMP nsMimeHtmlDisplayEmitter::WriteHTMLHeaders()</span>
<a href="#l23.140"></a><span id="l23.140"> {</span>
<a href="#l23.141"></a><span id="l23.141">   // if we aren't broadcasting headers OR printing...just do whatever</span>
<a href="#l23.142"></a><span id="l23.142">   // our base class does...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/mime/src/mimeobj.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/mime/src/mimeobj.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -46,16 +46,17 @@</span>
<a href="#l24.4"></a><span id="l24.4"> #include &quot;mimeobj.h&quot;</span>
<a href="#l24.5"></a><span id="l24.5"> #include &quot;prmem.h&quot;</span>
<a href="#l24.6"></a><span id="l24.6"> #include &quot;plstr.h&quot;</span>
<a href="#l24.7"></a><span id="l24.7"> #include &quot;prio.h&quot;</span>
<a href="#l24.8"></a><span id="l24.8"> #include &quot;mimebuf.h&quot;</span>
<a href="#l24.9"></a><span id="l24.9"> #include &quot;prlog.h&quot;</span>
<a href="#l24.10"></a><span id="l24.10"> #include &quot;nsMimeTypes.h&quot;</span>
<a href="#l24.11"></a><span id="l24.11"> #include &quot;nsMimeStringResources.h&quot;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l24.13"></a><span id="l24.13"> #include &quot;mimemsg.h&quot;</span>
<a href="#l24.14"></a><span id="l24.14"> #include &quot;mimemapl.h&quot;</span>
<a href="#l24.15"></a><span id="l24.15"> </span>
<a href="#l24.16"></a><span id="l24.16"> /* Way to destroy any notions of modularity or class hierarchy, Terry! */</span>
<a href="#l24.17"></a><span id="l24.17"> # include &quot;mimetpla.h&quot;</span>
<a href="#l24.18"></a><span id="l24.18"> # include &quot;mimethtm.h&quot;</span>
<a href="#l24.19"></a><span id="l24.19"> # include &quot;mimecont.h&quot;</span>
<a href="#l24.20"></a><span id="l24.20"> </span>
<a href="#l24.21"></a><span id="l24.21" class="difflineat">@@ -207,23 +208,22 @@ MimeObject_parse_begin (MimeObject *obj)</span>
<a href="#l24.22"></a><span id="l24.22">     obj-&gt;options-&gt;state-&gt;separator_suppressed_p = PR_TRUE; /* no first sep */</span>
<a href="#l24.23"></a><span id="l24.23">     const char *delParts = PL_strcasestr(obj-&gt;options-&gt;url, &quot;&amp;del=&quot;);</span>
<a href="#l24.24"></a><span id="l24.24">     const char *detachLocations = PL_strcasestr(obj-&gt;options-&gt;url, &quot;&amp;detachTo=&quot;);</span>
<a href="#l24.25"></a><span id="l24.25">     if (delParts)</span>
<a href="#l24.26"></a><span id="l24.26">     {</span>
<a href="#l24.27"></a><span id="l24.27">       const char *delEnd = PL_strcasestr(delParts + 1, &quot;&amp;&quot;);</span>
<a href="#l24.28"></a><span id="l24.28">       if (!delEnd)</span>
<a href="#l24.29"></a><span id="l24.29">         delEnd = delParts + strlen(delParts);</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-      nsCAutoString partsToDel(Substring(delParts + 5, delEnd));</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-      obj-&gt;options-&gt;state-&gt;partsToStrip.ParseString(partsToDel.get(), &quot;,&quot;);</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+      ParseString(Substring(delParts + 5, delEnd), ',', obj-&gt;options-&gt;state-&gt;partsToStrip);</span>
<a href="#l24.33"></a><span id="l24.33">     }</span>
<a href="#l24.34"></a><span id="l24.34">     if (detachLocations)</span>
<a href="#l24.35"></a><span id="l24.35">     {</span>
<a href="#l24.36"></a><span id="l24.36">       detachLocations += 10; // advance past &quot;&amp;detachTo=&quot;</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-      obj-&gt;options-&gt;state-&gt;detachToFiles.ParseString(detachLocations, &quot;,&quot;);</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+      ParseString(nsDependentCString(detachLocations), ',', obj-&gt;options-&gt;state-&gt;detachToFiles);</span>
<a href="#l24.39"></a><span id="l24.39">     }</span>
<a href="#l24.40"></a><span id="l24.40">   }</span>
<a href="#l24.41"></a><span id="l24.41"> </span>
<a href="#l24.42"></a><span id="l24.42">   /* Decide whether this object should be output or not... */</span>
<a href="#l24.43"></a><span id="l24.43">   if (!obj-&gt;options || !obj-&gt;options-&gt;output_fn</span>
<a href="#l24.44"></a><span id="l24.44">     /* if we are decomposing the message in files and processing a multipart object,</span>
<a href="#l24.45"></a><span id="l24.45">        we must not output it without parsing it first */</span>
<a href="#l24.46"></a><span id="l24.46">      || (obj-&gt;options-&gt;decompose_file_p &amp;&amp; obj-&gt;options-&gt;decompose_file_output_fn &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/news/build/Makefile.in</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/news/build/Makefile.in</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -77,18 +77,17 @@ SHARED_LIBRARY_LIBS = ../src/$(LIB_PREFI</span>
<a href="#l25.4"></a><span id="l25.4"> </span>
<a href="#l25.5"></a><span id="l25.5"> ifeq ($(USE_SHORT_LIBNAME),1)</span>
<a href="#l25.6"></a><span id="l25.6"> EXTRA_DSO_LIBS += msgbsutl</span>
<a href="#l25.7"></a><span id="l25.7"> else</span>
<a href="#l25.8"></a><span id="l25.8"> EXTRA_DSO_LIBS += msgbaseutil</span>
<a href="#l25.9"></a><span id="l25.9"> endif</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11"> EXTRA_DSO_LDOPTS = \</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-		-L$(DIST)/bin \</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-		-L$(DIST)/lib \</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+		$(LIBS_DIR) \</span>
<a href="#l25.15"></a><span id="l25.15"> 		$(MOZDEPTH)/rdf/util/src/internal/$(LIB_PREFIX)rdfutil_s.$(LIB_SUFFIX) \</span>
<a href="#l25.16"></a><span id="l25.16"> 		$(EXTRA_DSO_LIBS) \</span>
<a href="#l25.17"></a><span id="l25.17"> 		$(MOZ_COMPONENT_LIBS) \</span>
<a href="#l25.18"></a><span id="l25.18"> 		$(MOZ_UNICHARUTIL_LIBS) \</span>
<a href="#l25.19"></a><span id="l25.19"> 		$(NULL)</span>
<a href="#l25.20"></a><span id="l25.20"> </span>
<a href="#l25.21"></a><span id="l25.21"> include $(topsrcdir)/config/rules.mk</span>
<a href="#l25.22"></a><span id="l25.22"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/news/public/nsINntpService.idl</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/news/public/nsINntpService.idl</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -44,30 +44,30 @@</span>
<a href="#l26.4"></a><span id="l26.4"> </span>
<a href="#l26.5"></a><span id="l26.5"> interface nsIURI;</span>
<a href="#l26.6"></a><span id="l26.6"> interface nsIStreamListener;  </span>
<a href="#l26.7"></a><span id="l26.7"> interface nsIFile;</span>
<a href="#l26.8"></a><span id="l26.8"> interface nsIMsgWindow;</span>
<a href="#l26.9"></a><span id="l26.9"> interface nsIMsgFolder;</span>
<a href="#l26.10"></a><span id="l26.10"> interface nsICacheSession;</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-[scriptable, uuid(2777d192-fb8b-46b1-8c4c-8aa8ca62b011)]</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+[scriptable, uuid(ecd8087f-f71a-4d44-a285-4caacd57f217)]</span>
<a href="#l26.14"></a><span id="l26.14"> interface nsINntpService : nsISupports {</span>
<a href="#l26.15"></a><span id="l26.15">   </span>
<a href="#l26.16"></a><span id="l26.16">   /* newsgroupsList is a comma separated list of newsgroups, which may be</span>
<a href="#l26.17"></a><span id="l26.17">    * in news://host/group or group form</span>
<a href="#l26.18"></a><span id="l26.18">    * &quot;news://host/group1,news://host/group2&quot; or &quot;group1,group2&quot;</span>
<a href="#l26.19"></a><span id="l26.19">    *</span>
<a href="#l26.20"></a><span id="l26.20">    * newsgroupsHeaderVal is a comma separated list of groups in the group form</span>
<a href="#l26.21"></a><span id="l26.21">    * &quot;group1,group2&quot;</span>
<a href="#l26.22"></a><span id="l26.22">    *</span>
<a href="#l26.23"></a><span id="l26.23">    * newshostHeaderVal is a single hostname.</span>
<a href="#l26.24"></a><span id="l26.24">    * &quot;host&quot;</span>
<a href="#l26.25"></a><span id="l26.25">    */</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineminus">-  void generateNewsHeaderValsForPosting(in string newsgroupsList, out string newsgroupsHeaderVal, out string newshostHeaderVal);</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineplus">+  void generateNewsHeaderValsForPosting(in ACString newsgroupsList, out string newsgroupsHeaderVal, out string newshostHeaderVal);</span>
<a href="#l26.28"></a><span id="l26.28"> </span>
<a href="#l26.29"></a><span id="l26.29">   nsIURI postMessage(in nsIFile aFileToPost, in string newsgroupNames, in string aAccountKey, in nsIUrlListener aUrlListener, in nsIMsgWindow aMsgWindow);</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31">   nsIURI getNewNews(in nsINntpIncomingServer nntpServer, in string uri, in boolean getOld, in nsIUrlListener aUrlListener, in nsIMsgWindow aMsgWindow);</span>
<a href="#l26.32"></a><span id="l26.32"> </span>
<a href="#l26.33"></a><span id="l26.33">   nsIURI cancelMessage(in string cancelURL, in string messageURI, in nsISupports aConsumer, in nsIUrlListener aUrlListener, in nsIMsgWindow aMsgWindow);</span>
<a href="#l26.34"></a><span id="l26.34">  </span>
<a href="#l26.35"></a><span id="l26.35">   void getListOfGroupsOnServer(in nsINntpIncomingServer nntpServer, in nsIMsgWindow aMsgWindow, in boolean getOnlyNew);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -134,29 +134,29 @@ nsNNTPNewsgroupList::Initialize(nsINntpU</span>
<a href="#l27.4"></a><span id="l27.4"> </span>
<a href="#l27.5"></a><span id="l27.5">   nsCOMPtr &lt;nsIMsgFolder&gt; folder = do_QueryInterface(m_newsFolder, &amp;rv);</span>
<a href="#l27.6"></a><span id="l27.6">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8">   rv = folder-&gt;GetFilterList(m_msgWindow, getter_AddRefs(m_filterList));</span>
<a href="#l27.9"></a><span id="l27.9">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l27.10"></a><span id="l27.10">   nsCString ngHeaders;</span>
<a href="#l27.11"></a><span id="l27.11">   m_filterList-&gt;GetArbitraryHeaders(ngHeaders);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  m_filterHeaders.ParseString(ngHeaders.get(), &quot; &quot;);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  ParseString(ngHeaders, ' ', m_filterHeaders);</span>
<a href="#l27.14"></a><span id="l27.14"> </span>
<a href="#l27.15"></a><span id="l27.15">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l27.16"></a><span id="l27.16">   rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l27.17"></a><span id="l27.17">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19">   rv = server-&gt;GetFilterList(m_msgWindow, getter_AddRefs(m_serverFilterList));</span>
<a href="#l27.20"></a><span id="l27.20">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l27.21"></a><span id="l27.21">   nsCAutoString servHeaders;</span>
<a href="#l27.22"></a><span id="l27.22">   m_serverFilterList-&gt;GetArbitraryHeaders(servHeaders);</span>
<a href="#l27.23"></a><span id="l27.23"> </span>
<a href="#l27.24"></a><span id="l27.24">   nsCStringArray servArray;</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineminus">-  servArray.ParseString(servHeaders.get(), &quot; &quot;);</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineplus">+  ParseString(servHeaders, ' ', servArray);</span>
<a href="#l27.27"></a><span id="l27.27"> </span>
<a href="#l27.28"></a><span id="l27.28">   // servArray may have duplicates already in m_filterHeaders.</span>
<a href="#l27.29"></a><span id="l27.29">   for (PRInt32 i = 0; i &lt; servArray.Count(); i++)</span>
<a href="#l27.30"></a><span id="l27.30">   {</span>
<a href="#l27.31"></a><span id="l27.31">     if (m_filterHeaders.IndexOf(*(servArray[i])) == -1)</span>
<a href="#l27.32"></a><span id="l27.32">       m_filterHeaders.AppendCString(*(servArray[i]));</span>
<a href="#l27.33"></a><span id="l27.33">   }</span>
<a href="#l27.34"></a><span id="l27.34">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -819,40 +819,38 @@ nsNntpService::SetUpNntpUrlForPosting(co</span>
<a href="#l28.4"></a><span id="l28.4">   if (!*newsUrlSpec) return NS_ERROR_FAILURE;</span>
<a href="#l28.5"></a><span id="l28.5">   return NS_OK;</span>
<a href="#l28.6"></a><span id="l28.6"> }</span>
<a href="#l28.7"></a><span id="l28.7"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l28.8"></a><span id="l28.8"> // nsINntpService support</span>
<a href="#l28.9"></a><span id="l28.9"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l28.10"></a><span id="l28.10"> // XXX : may not work with non-ASCII newsgroup names and IDN hostnames</span>
<a href="#l28.11"></a><span id="l28.11"> NS_IMETHODIMP</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-nsNntpService::GenerateNewsHeaderValsForPosting(const char *newsgroupsList, char **newsgroupsHeaderVal, char **newshostHeaderVal)</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+nsNntpService::GenerateNewsHeaderValsForPosting(const nsACString&amp; newsgroupsList, char **newsgroupsHeaderVal, char **newshostHeaderVal)</span>
<a href="#l28.14"></a><span id="l28.14"> {</span>
<a href="#l28.15"></a><span id="l28.15">   nsresult rv = NS_OK;</span>
<a href="#l28.16"></a><span id="l28.16"> </span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">-  NS_ENSURE_ARG_POINTER(newsgroupsList);</span>
<a href="#l28.18"></a><span id="l28.18">   NS_ENSURE_ARG_POINTER(newsgroupsHeaderVal);</span>
<a href="#l28.19"></a><span id="l28.19">   NS_ENSURE_ARG_POINTER(newshostHeaderVal);</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineminus">-  NS_ENSURE_ARG_POINTER(*newsgroupsList);</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22">   // newsgroupsList can be a comma separated list of these:</span>
<a href="#l28.23"></a><span id="l28.23">   // news://host/group</span>
<a href="#l28.24"></a><span id="l28.24">   // news://group</span>
<a href="#l28.25"></a><span id="l28.25">   // host/group</span>
<a href="#l28.26"></a><span id="l28.26">   // group</span>
<a href="#l28.27"></a><span id="l28.27">   //</span>
<a href="#l28.28"></a><span id="l28.28">   // we are not going to allow the user to cross post to multiple hosts.</span>
<a href="#l28.29"></a><span id="l28.29">   // if we detect that, we stop and return error.</span>
<a href="#l28.30"></a><span id="l28.30"> </span>
<a href="#l28.31"></a><span id="l28.31">   nsCAutoString host;</span>
<a href="#l28.32"></a><span id="l28.32">   nsCAutoString str;</span>
<a href="#l28.33"></a><span id="l28.33">   nsCAutoString newsgroups;</span>
<a href="#l28.34"></a><span id="l28.34"> </span>
<a href="#l28.35"></a><span id="l28.35">   nsCStringArray list;</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">-  list.ParseString(newsgroupsList, &quot;,&quot;);</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+  ParseString(newsgroupsList, ',', list);</span>
<a href="#l28.38"></a><span id="l28.38">   for (PRInt32 index = 0; index &lt; list.Count(); index++)</span>
<a href="#l28.39"></a><span id="l28.39">   {</span>
<a href="#l28.40"></a><span id="l28.40">     list[index]-&gt;StripWhitespace();</span>
<a href="#l28.41"></a><span id="l28.41">     if (!list[index]-&gt;IsEmpty())</span>
<a href="#l28.42"></a><span id="l28.42">     {</span>
<a href="#l28.43"></a><span id="l28.43">       nsCAutoString currentHost;</span>
<a href="#l28.44"></a><span id="l28.44">       nsCAutoString theRest;</span>
<a href="#l28.45"></a><span id="l28.45">       // does str start with &quot;news:/&quot;?</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

