<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28579:bfcc947899e561eb23756dba6841cb17f758d2e3</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ bfcc947899e561eb23756dba6841cb17f758d2e3" />
<meta property="og:url" content="/comm-central/rev/bfcc947899e561eb23756dba6841cb17f758d2e3" />
<meta property="og:description" content="Bug 1609987 - Initial support for extending taskgraph with hooks. r=darktrojan" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / bfcc947899e561eb23756dba6841cb17f758d2e3 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/bfcc947899e561eb23756dba6841cb17f758d2e3">shortlog</a> |
<a href="/comm-central/log/bfcc947899e561eb23756dba6841cb17f758d2e3">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/bfcc947899e561eb23756dba6841cb17f758d2e3">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/bfcc947899e561eb23756dba6841cb17f758d2e3">files</a> |
changeset |
<a href="/comm-central/raw-rev/bfcc947899e561eb23756dba6841cb17f758d2e3">raw</a>  | <a href="/comm-central/archive/bfcc947899e561eb23756dba6841cb17f758d2e3.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609987">Bug 1609987</a> - Initial support for extending taskgraph with hooks. r=darktrojan
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#111;&#98;&#32;&#76;&#101;&#109;&#108;&#101;&#121;&#32;&#60;&#114;&#111;&#98;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 18 Jan 2020 14:48:22 -0500</td></tr>

<tr>
 <td>changeset 28579</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/bfcc947899e561eb23756dba6841cb17f758d2e3">bfcc947899e561eb23756dba6841cb17f758d2e3</a></td>
</tr>



<tr>
<td>parent 28578</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/04d95196247e3a348898c8fcff0ea5bccd7bd76c">04d95196247e3a348898c8fcff0ea5bccd7bd76c</a>
</td>
</tr>

<tr>
<td>child 28580</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0b3a6c10489b6d0aa70cb27f8fefa37bbe80b298">0b3a6c10489b6d0aa70cb27f8fefa37bbe80b298</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=bfcc947899e561eb23756dba6841cb17f758d2e3">16937</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Fri, 24 Jan 2020 03:58:31 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@bfcc947899e5 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bfcc947899e561eb23756dba6841cb17f758d2e3">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bfcc947899e561eb23756dba6841cb17f758d2e3&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bfcc947899e561eb23756dba6841cb17f758d2e3&newProject=comm-central&newRevision=bfcc947899e561eb23756dba6841cb17f758d2e3&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bfcc947899e561eb23756dba6841cb17f758d2e3&newProject=comm-central&newRevision=bfcc947899e561eb23756dba6841cb17f758d2e3&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bfcc947899e561eb23756dba6841cb17f758d2e3&newProject=comm-central&newRevision=bfcc947899e561eb23756dba6841cb17f758d2e3&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609987">1609987</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609987">Bug 1609987</a> - Initial support for extending taskgraph with hooks. r=darktrojan

The comm_taskgraph.register function will get called early in the Decision
task. The Fenix project uses this to add functionality in key places via
hooks that aid in customizing the taskgraph.
This is just initial support, extension modules will be added as needed.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bfcc947899e561eb23756dba6841cb17f758d2e3/build/virtualenv_packages.txt">build/virtualenv_packages.txt</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfcc947899e561eb23756dba6841cb17f758d2e3/build/virtualenv_packages.txt">file</a> |
<a href="/comm-central/annotate/bfcc947899e561eb23756dba6841cb17f758d2e3/build/virtualenv_packages.txt">annotate</a> |
<a href="/comm-central/diff/bfcc947899e561eb23756dba6841cb17f758d2e3/build/virtualenv_packages.txt">diff</a> |
<a href="/comm-central/comparison/bfcc947899e561eb23756dba6841cb17f758d2e3/build/virtualenv_packages.txt">comparison</a> |
<a href="/comm-central/log/bfcc947899e561eb23756dba6841cb17f758d2e3/build/virtualenv_packages.txt">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/ci/config.yml">taskcluster/ci/config.yml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/ci/config.yml">file</a> |
<a href="/comm-central/annotate/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/ci/config.yml">annotate</a> |
<a href="/comm-central/diff/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/ci/config.yml">diff</a> |
<a href="/comm-central/comparison/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/ci/config.yml">comparison</a> |
<a href="/comm-central/log/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/ci/config.yml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/comm_taskgraph/__init__.py">taskcluster/comm_taskgraph/__init__.py</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/comm_taskgraph/__init__.py">file</a> |
<a href="/comm-central/annotate/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/comm_taskgraph/__init__.py">annotate</a> |
<a href="/comm-central/diff/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/comm_taskgraph/__init__.py">diff</a> |
<a href="/comm-central/comparison/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/comm_taskgraph/__init__.py">comparison</a> |
<a href="/comm-central/log/bfcc947899e561eb23756dba6841cb17f758d2e3/taskcluster/comm_taskgraph/__init__.py">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/build/virtualenv_packages.txt</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/build/virtualenv_packages.txt</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,2 +1,1 @@</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineminus">-comm.pth:comm/taskcluster</span>
<a href="#l1.5"></a><span id="l1.5"> comm.pth:comm/testing/marionette</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/taskcluster/ci/config.yml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/taskcluster/ci/config.yml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -81,16 +81,19 @@ partner-urls:</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> task-priority:</span>
<a href="#l2.6"></a><span id="l2.6">     by-project:</span>
<a href="#l2.7"></a><span id="l2.7">         'comm-esr68': 'very-high'</span>
<a href="#l2.8"></a><span id="l2.8">         'comm-beta': 'high'</span>
<a href="#l2.9"></a><span id="l2.9">         'comm-central': 'medium'</span>
<a href="#l2.10"></a><span id="l2.10">         'default': 'low'</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+taskgraph:</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    register: comm_taskgraph:register</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+</span>
<a href="#l2.15"></a><span id="l2.15"> workers:</span>
<a href="#l2.16"></a><span id="l2.16">     aliases:</span>
<a href="#l2.17"></a><span id="l2.17">         b-linux.*:</span>
<a href="#l2.18"></a><span id="l2.18">             provisioner: 'comm-{level}'</span>
<a href="#l2.19"></a><span id="l2.19">             implementation: docker-worker</span>
<a href="#l2.20"></a><span id="l2.20">             os: linux</span>
<a href="#l2.21"></a><span id="l2.21">             worker-type: '{alias}'</span>
<a href="#l2.22"></a><span id="l2.22">         b-win2012:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/taskcluster/comm_taskgraph/__init__.py</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/taskcluster/comm_taskgraph/__init__.py</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,3 +1,29 @@</span>
<a href="#l3.4"></a><span id="l3.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.5"></a><span id="l3.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.6"></a><span id="l3.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+from __future__ import absolute_import, print_function, unicode_literals</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+import os</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+import logging</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+from importlib import import_module</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+from taskgraph import GECKO</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+logger = logging.getLogger(__name__)</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+COMM = os.path.join(GECKO, 'comm')</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+def register(graph_config):</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+    &quot;&quot;&quot;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+    Import all modules that are siblings of this one, triggering decorators in</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+    the process.</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+    &quot;&quot;&quot;</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+    logger.info(&quot;{} path registered&quot;.format(__name__))</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+    _import_modules([])</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+def _import_modules(modules):</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+    for module in modules:</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+        import_module(&quot;.{}&quot;.format(module), package=__name__)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

