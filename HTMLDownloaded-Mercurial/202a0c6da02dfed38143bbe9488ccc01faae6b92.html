<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25256:202a0c6da02dfed38143bbe9488ccc01faae6b92</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 202a0c6da02dfed38143bbe9488ccc01faae6b92" />
<meta property="og:url" content="/comm-central/rev/202a0c6da02dfed38143bbe9488ccc01faae6b92" />
<meta property="og:description" content="Bug 1498041 - Turn on ESLint in mail/base/content: enable no-undef rule; r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 202a0c6da02dfed38143bbe9488ccc01faae6b92 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/202a0c6da02dfed38143bbe9488ccc01faae6b92">shortlog</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/202a0c6da02dfed38143bbe9488ccc01faae6b92">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92">files</a> |
changeset |
<a href="/comm-central/raw-rev/202a0c6da02dfed38143bbe9488ccc01faae6b92">raw</a>  | <a href="/comm-central/archive/202a0c6da02dfed38143bbe9488ccc01faae6b92.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1498041">Bug 1498041</a> - Turn on ESLint in mail/base/content: enable no-undef rule; r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 23 Nov 2018 10:55:17 +1300</td></tr>

<tr>
 <td>changeset 25256</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/202a0c6da02dfed38143bbe9488ccc01faae6b92">202a0c6da02dfed38143bbe9488ccc01faae6b92</a></td>
</tr>



<tr>
<td>parent 25255</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/854e46a4c5f226a20fb42f14a2c50af188038289">854e46a4c5f226a20fb42f14a2c50af188038289</a>
</td>
</tr>

<tr>
<td>child 25257</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9ec06d5d2638767467fec74475ac1ab0f7abda43">9ec06d5d2638767467fec74475ac1ab0f7abda43</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=202a0c6da02dfed38143bbe9488ccc01faae6b92">15158</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Thu, 22 Nov 2018 21:56:55 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@202a0c6da02d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=202a0c6da02dfed38143bbe9488ccc01faae6b92">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=202a0c6da02dfed38143bbe9488ccc01faae6b92&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=202a0c6da02dfed38143bbe9488ccc01faae6b92&newProject=comm-central&newRevision=854e46a4c5f226a20fb42f14a2c50af188038289&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=202a0c6da02dfed38143bbe9488ccc01faae6b92&newProject=comm-central&newRevision=854e46a4c5f226a20fb42f14a2c50af188038289&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=202a0c6da02dfed38143bbe9488ccc01faae6b92&newProject=comm-central&newRevision=854e46a4c5f226a20fb42f14a2c50af188038289&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1498041">1498041</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1498041">Bug 1498041</a> - Turn on ESLint in mail/base/content: enable no-undef rule; r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/.eslintrc.js">mail/base/content/.eslintrc.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/ABSearchDialog.js">mail/base/content/ABSearchDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/ABSearchDialog.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/ABSearchDialog.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/ABSearchDialog.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/ABSearchDialog.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/ABSearchDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/FilterListDialog.js">mail/base/content/FilterListDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/FilterListDialog.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/FilterListDialog.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/FilterListDialog.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/FilterListDialog.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/FilterListDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/SearchDialog.js">mail/base/content/SearchDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/SearchDialog.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/SearchDialog.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/SearchDialog.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/SearchDialog.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/SearchDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutAddonsExtra.js">mail/base/content/aboutAddonsExtra.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutAddonsExtra.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutAddonsExtra.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutAddonsExtra.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutAddonsExtra.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutAddonsExtra.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog-appUpdater.js">mail/base/content/aboutDialog-appUpdater.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog-appUpdater.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog-appUpdater.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog-appUpdater.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog-appUpdater.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog-appUpdater.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog.js">mail/base/content/aboutDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/aboutDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/commandglue.js">mail/base/content/commandglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/commandglue.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/commandglue.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/commandglue.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/commandglue.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/commandglue.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/contentAreaClick.js">mail/base/content/contentAreaClick.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/contentAreaClick.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/contentAreaClick.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/contentAreaClick.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/contentAreaClick.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/contentAreaClick.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/editContactPanel.js">mail/base/content/editContactPanel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/editContactPanel.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/editContactPanel.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/editContactPanel.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/editContactPanel.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/editContactPanel.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/extensions.xml">mail/base/content/extensions.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/extensions.xml">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/extensions.xml">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/extensions.xml">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/extensions.xml">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/extensions.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderDisplay.js">mail/base/content/folderDisplay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderDisplay.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderDisplay.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderDisplay.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderDisplay.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderDisplay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderPane.js">mail/base/content/folderPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderPane.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderPane.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderPane.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderPane.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/folderPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/foldersummary.js">mail/base/content/foldersummary.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/foldersummary.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/foldersummary.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/foldersummary.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/foldersummary.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/foldersummary.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetBindings.xml">mail/base/content/glodaFacetBindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetBindings.xml">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetBindings.xml">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetBindings.xml">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetBindings.xml">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetBindings.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetTab.js">mail/base/content/glodaFacetTab.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetTab.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetTab.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetTab.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetTab.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetTab.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetView.js">mail/base/content/glodaFacetView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetView.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetView.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetView.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetView.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetVis.js">mail/base/content/glodaFacetVis.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetVis.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetVis.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetVis.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetVis.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/glodaFacetVis.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/macMessengerMenu.js">mail/base/content/macMessengerMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/macMessengerMenu.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/macMessengerMenu.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/macMessengerMenu.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/macMessengerMenu.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/macMessengerMenu.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-compacttheme.js">mail/base/content/mail-compacttheme.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-compacttheme.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-compacttheme.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-compacttheme.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-compacttheme.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-compacttheme.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-offline.js">mail/base/content/mail-offline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-offline.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-offline.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-offline.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-offline.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail-offline.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail3PaneWindowCommands.js">mail/base/content/mail3PaneWindowCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail3PaneWindowCommands.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail3PaneWindowCommands.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail3PaneWindowCommands.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail3PaneWindowCommands.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mail3PaneWindowCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCommands.js">mail/base/content/mailCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCommands.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCommands.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCommands.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCommands.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailContextMenus.js">mail/base/content/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCore.js">mail/base/content/mailCore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCore.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCore.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCore.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCore.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailCore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailTabs.js">mail/base/content/mailTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailTabs.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailTabs.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailTabs.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailTabs.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailTabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWidgets.xml">mail/base/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindow.js">mail/base/content/mailWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindow.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindow.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindow.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindow.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageDisplay.js">mail/base/content/messageDisplay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageDisplay.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageDisplay.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageDisplay.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageDisplay.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageDisplay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageWindow.js">mail/base/content/messageWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageWindow.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageWindow.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageWindow.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageWindow.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/messageWindow.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgHdrView.js">mail/base/content/msgHdrView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgHdrView.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgHdrView.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgHdrView.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgHdrView.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgHdrView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgMail3PaneWindow.js">mail/base/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgViewNavigation.js">mail/base/content/msgViewNavigation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgViewNavigation.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgViewNavigation.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgViewNavigation.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgViewNavigation.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/msgViewNavigation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/multimessageview.js">mail/base/content/multimessageview.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/multimessageview.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/multimessageview.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/multimessageview.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/multimessageview.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/multimessageview.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsContextMenu.js">mail/base/content/nsContextMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsContextMenu.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsContextMenu.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsContextMenu.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsContextMenu.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsContextMenu.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsDragAndDrop.js">mail/base/content/nsDragAndDrop.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsDragAndDrop.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsDragAndDrop.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsDragAndDrop.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsDragAndDrop.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/nsDragAndDrop.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/phishingDetector.js">mail/base/content/phishingDetector.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/phishingDetector.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/phishingDetector.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/phishingDetector.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/phishingDetector.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/phishingDetector.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/plugins.js">mail/base/content/plugins.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/plugins.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/plugins.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/plugins.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/plugins.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/plugins.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/quickFilterBar.js">mail/base/content/quickFilterBar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/quickFilterBar.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/quickFilterBar.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/quickFilterBar.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/quickFilterBar.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/quickFilterBar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/sanitizeDialog.js">mail/base/content/sanitizeDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/sanitizeDialog.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/sanitizeDialog.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/sanitizeDialog.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/sanitizeDialog.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/sanitizeDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/search.xml">mail/base/content/search.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/search.xml">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/search.xml">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/search.xml">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/search.xml">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/search.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/selectionsummaries.js">mail/base/content/selectionsummaries.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/selectionsummaries.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/selectionsummaries.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/selectionsummaries.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/selectionsummaries.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/selectionsummaries.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/specialTabs.js">mail/base/content/specialTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/specialTabs.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/specialTabs.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/specialTabs.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/specialTabs.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/specialTabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/tabmail.xml">mail/base/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPane.js">mail/base/content/threadPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPane.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPane.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPane.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPane.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPaneColumnPicker.xml">mail/base/content/threadPaneColumnPicker.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPaneColumnPicker.xml">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPaneColumnPicker.xml">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPaneColumnPicker.xml">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPaneColumnPicker.xml">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/threadPaneColumnPicker.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/toolbarIconColor.js">mail/base/content/toolbarIconColor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/toolbarIconColor.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/toolbarIconColor.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/toolbarIconColor.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/toolbarIconColor.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/toolbarIconColor.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/utilityOverlay.js">mail/base/content/utilityOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/utilityOverlay.js">file</a> |
<a href="/comm-central/annotate/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/utilityOverlay.js">annotate</a> |
<a href="/comm-central/diff/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/utilityOverlay.js">diff</a> |
<a href="/comm-central/comparison/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/utilityOverlay.js">comparison</a> |
<a href="/comm-central/log/202a0c6da02dfed38143bbe9488ccc01faae6b92/mail/base/content/utilityOverlay.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1">deleted file mode 100644</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineminus">--- a/mail/base/content/.eslintrc.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineplus">+++ /dev/null</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineat">@@ -1,7 +0,0 @@</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineminus">-&quot;use strict&quot;;</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineminus">-</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineminus">-module.exports = {</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineminus">-  &quot;rules&quot;: {</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineminus">-    &quot;no-undef&quot;: &quot;off&quot;,</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-  },</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/ABSearchDialog.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/ABSearchDialog.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,13 +1,23 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/ABQueryUtils.jsm&quot;);</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+/* import-globals-from ../../../../toolkit/content/globalOverlay.js */</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+/* import-globals-from ../../../mailnews/addrbook/content/abResultsPane.js */</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+/* import-globals-from ../../../mailnews/base/content/dateFormat.js */</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+/* import-globals-from ../../../mailnews/base/search/content/searchTermOverlay.js */</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+/* import-globals-from ../../components/addrbook/content/abCommon.js */</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+/* import-globals-from msgMail3PaneWindow.js */</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+/* import-globals-from nsDragAndDrop.js */</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+var { encodeABTermValue } = ChromeUtils.import(&quot;resource:///modules/ABQueryUtils.jsm&quot;, null);</span>
<a href="#l2.20"></a><span id="l2.20"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l2.21"></a><span id="l2.21"> ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l2.22"></a><span id="l2.22"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24"> var searchSessionContractID = &quot;@mozilla.org/messenger/searchSession;1&quot;;</span>
<a href="#l2.25"></a><span id="l2.25"> var gSearchSession;</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27"> var nsMsgSearchScope = Ci.nsMsgSearchScope;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/FilterListDialog.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/FilterListDialog.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l3.5"></a><span id="l3.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+var { fixIterator } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;, null);</span>
<a href="#l3.12"></a><span id="l3.12"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l3.13"></a><span id="l3.13"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> var gFilterListMsgWindow = null;</span>
<a href="#l3.16"></a><span id="l3.16"> var gCurrentFilterList;</span>
<a href="#l3.17"></a><span id="l3.17"> var gServerMenu = null;</span>
<a href="#l3.18"></a><span id="l3.18"> var gFilterListbox = null;</span>
<a href="#l3.19"></a><span id="l3.19"> var gEditButton = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/SearchDialog.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/SearchDialog.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,25 +1,31 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+/* import-globals-from ../../../../toolkit/content/globalOverlay.js */</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+/* import-globals-from ../../../mailnews/base/search/content/searchTermOverlay.js */</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+/* import-globals-from mailWindowOverlay.js */</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+/* import-globals-from messageDisplay.js */</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+/* import-globals-from threadPane.js */</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+</span>
<a href="#l4.16"></a><span id="l4.16"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l4.17"></a><span id="l4.17"> ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l4.18"></a><span id="l4.18"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20"> var gCurrentFolder;</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22"> var gFolderDisplay;</span>
<a href="#l4.23"></a><span id="l4.23"> // Although we don't display messages, we have a message display object to</span>
<a href="#l4.24"></a><span id="l4.24"> //  simplify our code.  It's just always disabled.</span>
<a href="#l4.25"></a><span id="l4.25"> var gMessageDisplay;</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-var nsIMsgWindow = Ci.nsIMsgWindow;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-</span>
<a href="#l4.29"></a><span id="l4.29"> var gFolderPicker;</span>
<a href="#l4.30"></a><span id="l4.30"> var gStatusFeedback;</span>
<a href="#l4.31"></a><span id="l4.31"> var gTimelineEnabled = false;</span>
<a href="#l4.32"></a><span id="l4.32"> var RDF;</span>
<a href="#l4.33"></a><span id="l4.33"> var gSearchBundle;</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35"> // Datasource search listener -- made global as it has to be registered</span>
<a href="#l4.36"></a><span id="l4.36"> // and unregistered in different functions.</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineat">@@ -84,34 +90,34 @@ var nsSearchResultsController = {</span>
<a href="#l4.38"></a><span id="l4.38">     doCommand(command) {</span>
<a href="#l4.39"></a><span id="l4.39">         switch (command) {</span>
<a href="#l4.40"></a><span id="l4.40">         case &quot;cmd_open&quot;:</span>
<a href="#l4.41"></a><span id="l4.41">             MsgOpenSelectedMessages();</span>
<a href="#l4.42"></a><span id="l4.42">             return true;</span>
<a href="#l4.43"></a><span id="l4.43"> </span>
<a href="#l4.44"></a><span id="l4.44">         case &quot;cmd_delete&quot;:</span>
<a href="#l4.45"></a><span id="l4.45">         case &quot;button_delete&quot;:</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-            MsgDeleteSelectedMessages(nsMsgViewCommandType.deleteMsg);</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+            MsgDeleteSelectedMessages(Ci.nsMsgViewCommandType.deleteMsg);</span>
<a href="#l4.48"></a><span id="l4.48">             return true;</span>
<a href="#l4.49"></a><span id="l4.49">         case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-            MsgDeleteSelectedMessages(nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+            MsgDeleteSelectedMessages(Ci.nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l4.52"></a><span id="l4.52">             return true;</span>
<a href="#l4.53"></a><span id="l4.53"> </span>
<a href="#l4.54"></a><span id="l4.54">         case &quot;open_in_folder_button&quot;:</span>
<a href="#l4.55"></a><span id="l4.55">             OpenInFolder();</span>
<a href="#l4.56"></a><span id="l4.56">             return true;</span>
<a href="#l4.57"></a><span id="l4.57"> </span>
<a href="#l4.58"></a><span id="l4.58">         case &quot;saveas_vf_button&quot;:</span>
<a href="#l4.59"></a><span id="l4.59">             saveAsVirtualFolder();</span>
<a href="#l4.60"></a><span id="l4.60">             return true;</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62">         case &quot;cmd_selectAll&quot;:</span>
<a href="#l4.63"></a><span id="l4.63">             // move the focus to the search results pane</span>
<a href="#l4.64"></a><span id="l4.64">             GetThreadTree().focus();</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-            gFolderDisplay.doCommand(nsMsgViewCommandType.selectAll);</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+            gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.selectAll);</span>
<a href="#l4.67"></a><span id="l4.67">             return true;</span>
<a href="#l4.68"></a><span id="l4.68"> </span>
<a href="#l4.69"></a><span id="l4.69">         default:</span>
<a href="#l4.70"></a><span id="l4.70">             return false;</span>
<a href="#l4.71"></a><span id="l4.71">         }</span>
<a href="#l4.72"></a><span id="l4.72"> </span>
<a href="#l4.73"></a><span id="l4.73">     },</span>
<a href="#l4.74"></a><span id="l4.74"> </span>
<a href="#l4.75"></a><span id="l4.75" class="difflineat">@@ -256,17 +262,17 @@ function searchOnUnload() {</span>
<a href="#l4.76"></a><span id="l4.76"> }</span>
<a href="#l4.77"></a><span id="l4.77"> </span>
<a href="#l4.78"></a><span id="l4.78"> function initializeSearchWindowWidgets() {</span>
<a href="#l4.79"></a><span id="l4.79">     gFolderPicker = document.getElementById(&quot;searchableFolders&quot;);</span>
<a href="#l4.80"></a><span id="l4.80">     gSearchStopButton = document.getElementById(&quot;search-button&quot;);</span>
<a href="#l4.81"></a><span id="l4.81">     hideMatchAllItem();</span>
<a href="#l4.82"></a><span id="l4.82"> </span>
<a href="#l4.83"></a><span id="l4.83">     msgWindow = Cc[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-                  .createInstance(nsIMsgWindow);</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+                  .createInstance(Ci.nsIMsgWindow);</span>
<a href="#l4.86"></a><span id="l4.86">     msgWindow.domWindow = window;</span>
<a href="#l4.87"></a><span id="l4.87">     msgWindow.rootDocShell.appType = Ci.nsIDocShell.APP_TYPE_MAIL;</span>
<a href="#l4.88"></a><span id="l4.88"> </span>
<a href="#l4.89"></a><span id="l4.89">     gStatusFeedback = new nsMsgStatusFeedback();</span>
<a href="#l4.90"></a><span id="l4.90">     msgWindow.statusFeedback = gStatusFeedback;</span>
<a href="#l4.91"></a><span id="l4.91"> </span>
<a href="#l4.92"></a><span id="l4.92">     // functionality to enable/disable buttons using nsSearchResultsController</span>
<a href="#l4.93"></a><span id="l4.93">     // depending of whether items are selected in the search results thread pane.</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineat">@@ -485,21 +491,16 @@ function GetScopeForFolder(folder) {</span>
<a href="#l4.95"></a><span id="l4.95">         return nsMsgSearchScope.onlineManual;</span>
<a href="#l4.96"></a><span id="l4.96">         // fall through to default</span>
<a href="#l4.97"></a><span id="l4.97">     default:</span>
<a href="#l4.98"></a><span id="l4.98">       return nsMsgSearchScope.offlineMail;</span>
<a href="#l4.99"></a><span id="l4.99">   }</span>
<a href="#l4.100"></a><span id="l4.100"> </span>
<a href="#l4.101"></a><span id="l4.101"> }</span>
<a href="#l4.102"></a><span id="l4.102"> </span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-var nsMsgViewSortType = Ci.nsMsgViewSortType;</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-var nsMsgViewSortOrder = Ci.nsMsgViewSortOrder;</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-var nsMsgViewFlagsType = Ci.nsMsgViewFlagsType;</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-var nsMsgViewCommandType = Ci.nsMsgViewCommandType;</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-</span>
<a href="#l4.108"></a><span id="l4.108"> function goUpdateSearchItems(commandset) {</span>
<a href="#l4.109"></a><span id="l4.109">   for (var i = 0; i &lt; commandset.childNodes.length; i++) {</span>
<a href="#l4.110"></a><span id="l4.110">     var commandID = commandset.childNodes[i].getAttribute(&quot;id&quot;);</span>
<a href="#l4.111"></a><span id="l4.111">     if (commandID) {</span>
<a href="#l4.112"></a><span id="l4.112">       goUpdateCommand(commandID);</span>
<a href="#l4.113"></a><span id="l4.113">     }</span>
<a href="#l4.114"></a><span id="l4.114">   }</span>
<a href="#l4.115"></a><span id="l4.115"> }</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineat">@@ -523,17 +524,17 @@ function MoveMessageInSearch(destFolder)</span>
<a href="#l4.117"></a><span id="l4.117">   // &quot;File Here&quot;.</span>
<a href="#l4.118"></a><span id="l4.118">   let destUri = destFolder.getAttribute(&quot;id&quot;);</span>
<a href="#l4.119"></a><span id="l4.119">   if (destUri.length == 0)</span>
<a href="#l4.120"></a><span id="l4.120">     destUri = destFolder.getAttribute(&quot;file-uri&quot;);</span>
<a href="#l4.121"></a><span id="l4.121"> </span>
<a href="#l4.122"></a><span id="l4.122">   let destMsgFolder = MailUtils.getOrCreateFolder(destUri);</span>
<a href="#l4.123"></a><span id="l4.123"> </span>
<a href="#l4.124"></a><span id="l4.124">   gFolderDisplay.hintAboutToDeleteMessages();</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-  gFolderDisplay.doCommandWithFolder(nsMsgViewCommandType.moveMessages,</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+  gFolderDisplay.doCommandWithFolder(Ci.nsMsgViewCommandType.moveMessages,</span>
<a href="#l4.127"></a><span id="l4.127">                                      destMsgFolder);</span>
<a href="#l4.128"></a><span id="l4.128"> }</span>
<a href="#l4.129"></a><span id="l4.129"> </span>
<a href="#l4.130"></a><span id="l4.130"> function OpenInFolder() {</span>
<a href="#l4.131"></a><span id="l4.131">   MailUtils.displayMessageInFolderTab(gFolderDisplay.selectedMessage);</span>
<a href="#l4.132"></a><span id="l4.132"> }</span>
<a href="#l4.133"></a><span id="l4.133"> </span>
<a href="#l4.134"></a><span id="l4.134"> function saveAsVirtualFolder() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/aboutAddonsExtra.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/aboutAddonsExtra.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">-/* globals AddonManager, Services, gDetailView, gListView, gStrings */</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+/* import-globals-from ../../../../toolkit/mozapps/extensions/content/extensions.js */</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> const { ExtensionSupport } = ChromeUtils.import(&quot;resource:///modules/extensionSupport.jsm&quot;, null);</span>
<a href="#l5.12"></a><span id="l5.12"> </span>
<a href="#l5.13"></a><span id="l5.13"> gStrings.mailExt =</span>
<a href="#l5.14"></a><span id="l5.14">   Services.strings.createBundle(&quot;chrome://messenger/locale/extensionsOverlay.properties&quot;);</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> (function() {</span>
<a href="#l5.17"></a><span id="l5.17">   window.isCorrectlySigned = function() { return true; };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/aboutDialog-appUpdater.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/aboutDialog-appUpdater.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> // Note: this file is included in aboutDialog.xul and preferences/advanced.xul</span>
<a href="#l6.9"></a><span id="l6.9"> // if MOZ_UPDATER is defined.</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.12"></a><span id="l6.12"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l6.13"></a><span id="l6.13"> ChromeUtils.import(&quot;resource://gre/modules/DownloadUtils.jsm&quot;);</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15"> const PREF_APP_UPDATE_CANCELATIONS_OSX = &quot;app.update.cancelations.osx&quot;;</span>
<a href="#l6.16"></a><span id="l6.16"> const PREF_APP_UPDATE_ELEVATE_NEVER    = &quot;app.update.elevate.never&quot;;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> var gAppUpdater;</span>
<a href="#l6.19"></a><span id="l6.19"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/content/aboutDialog.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/content/aboutDialog.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+/* import-globals-from aboutDialog-appUpdater.js */</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+</span>
<a href="#l7.10"></a><span id="l7.10"> &quot;use strict&quot;;</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12"> // Services = object with smart getters for common XPCOM services</span>
<a href="#l7.13"></a><span id="l7.13"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.14"></a><span id="l7.14"> ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16"> function init(aEvent) {</span>
<a href="#l7.17"></a><span id="l7.17">   if (aEvent.target != document)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/content/commandglue.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/content/commandglue.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,18 +1,20 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> /*</span>
<a href="#l8.9"></a><span id="l8.9">  * Command-specific code. This stuff should be called by the widgets</span>
<a href="#l8.10"></a><span id="l8.10">  */</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+/* import-globals-from folderPane.js */</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+</span>
<a href="#l8.15"></a><span id="l8.15"> var { MailViewConstants } = ChromeUtils.import(&quot;resource:///modules/MailViewManager.jsm&quot;, null);</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l8.17"></a><span id="l8.17"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19"> function UpdateMailToolbar(caller) {</span>
<a href="#l8.20"></a><span id="l8.20">   // If we have a transient selection, we shouldn't update the toolbar. We'll</span>
<a href="#l8.21"></a><span id="l8.21">   // update it once we've restored the original selection.</span>
<a href="#l8.22"></a><span id="l8.22">   if (&quot;gRightMouseButtonSavedSelection&quot; in window &amp;&amp;</span>
<a href="#l8.23"></a><span id="l8.23">       window.gRightMouseButtonSavedSelection)</span>
<a href="#l8.24"></a><span id="l8.24">     return;</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineat">@@ -20,20 +22,20 @@ function UpdateMailToolbar(caller) {</span>
<a href="#l8.26"></a><span id="l8.26">   // dump(&quot;XXX update mail-toolbar &quot; + caller + &quot;\n&quot;);</span>
<a href="#l8.27"></a><span id="l8.27">   document.commandDispatcher.updateCommands(&quot;mail-toolbar&quot;);</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29">   // hook for extra toolbar items</span>
<a href="#l8.30"></a><span id="l8.30">   Services.obs.notifyObservers(window, &quot;mail:updateToolbarItems&quot;);</span>
<a href="#l8.31"></a><span id="l8.31"> }</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33"> function isNewsURI(uri) {</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-    if (!uri) {</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-        return false;</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-    }</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-    return uri.startsWith(&quot;news:/&quot;) || uri.startsWith(&quot;news-message:/&quot;);</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  if (!uri) {</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+      return false;</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+  }</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+  return uri.startsWith(&quot;news:/&quot;) || uri.startsWith(&quot;news-message:/&quot;);</span>
<a href="#l8.42"></a><span id="l8.42"> }</span>
<a href="#l8.43"></a><span id="l8.43"> </span>
<a href="#l8.44"></a><span id="l8.44"> function SwitchView(command) {</span>
<a href="#l8.45"></a><span id="l8.45">   // when switching thread views, we might be coming out of quick search</span>
<a href="#l8.46"></a><span id="l8.46">   // or a message view.</span>
<a href="#l8.47"></a><span id="l8.47">   // first set view picker to all</span>
<a href="#l8.48"></a><span id="l8.48">   if (gFolderDisplay.view.mailViewIndex != MailViewConstants.kViewItemAll)</span>
<a href="#l8.49"></a><span id="l8.49">     gFolderDisplay.view.setMailView(MailViewConstants.kViewItemAll);</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineat">@@ -178,102 +180,94 @@ function ConvertSortTypeToColumnID(sortK</span>
<a href="#l8.51"></a><span id="l8.51">   // Hack to turn this into an integer, if it was a string.</span>
<a href="#l8.52"></a><span id="l8.52">   // It would be a string if it came from XULStore.json.</span>
<a href="#l8.53"></a><span id="l8.53">   sortKey = sortKey - 0;</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55">   switch (sortKey) {</span>
<a href="#l8.56"></a><span id="l8.56">     // In the case of None, we default to the date column</span>
<a href="#l8.57"></a><span id="l8.57">     // This appears to be the case in such instances as</span>
<a href="#l8.58"></a><span id="l8.58">     // Global search, so don't complain about it.</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-    case nsMsgViewSortType.byNone:</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-    case nsMsgViewSortType.byDate:</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+    case Ci.nsMsgViewSortType.byNone:</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+    case Ci.nsMsgViewSortType.byDate:</span>
<a href="#l8.63"></a><span id="l8.63">       columnID = &quot;dateCol&quot;;</span>
<a href="#l8.64"></a><span id="l8.64">       break;</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-    case nsMsgViewSortType.byReceived:</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+    case Ci.nsMsgViewSortType.byReceived:</span>
<a href="#l8.67"></a><span id="l8.67">       columnID = &quot;receivedCol&quot;;</span>
<a href="#l8.68"></a><span id="l8.68">       break;</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-    case nsMsgViewSortType.byAuthor:</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+    case Ci.nsMsgViewSortType.byAuthor:</span>
<a href="#l8.71"></a><span id="l8.71">       columnID = &quot;senderCol&quot;;</span>
<a href="#l8.72"></a><span id="l8.72">       break;</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-    case nsMsgViewSortType.byRecipient:</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+    case Ci.nsMsgViewSortType.byRecipient:</span>
<a href="#l8.75"></a><span id="l8.75">       columnID = &quot;recipientCol&quot;;</span>
<a href="#l8.76"></a><span id="l8.76">       break;</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-    case nsMsgViewSortType.bySubject:</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+    case Ci.nsMsgViewSortType.bySubject:</span>
<a href="#l8.79"></a><span id="l8.79">       columnID = &quot;subjectCol&quot;;</span>
<a href="#l8.80"></a><span id="l8.80">       break;</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-    case nsMsgViewSortType.byLocation:</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+    case Ci.nsMsgViewSortType.byLocation:</span>
<a href="#l8.83"></a><span id="l8.83">       columnID = &quot;locationCol&quot;;</span>
<a href="#l8.84"></a><span id="l8.84">       break;</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-    case nsMsgViewSortType.byAccount:</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+    case Ci.nsMsgViewSortType.byAccount:</span>
<a href="#l8.87"></a><span id="l8.87">       columnID = &quot;accountCol&quot;;</span>
<a href="#l8.88"></a><span id="l8.88">       break;</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineminus">-    case nsMsgViewSortType.byUnread:</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+    case Ci.nsMsgViewSortType.byUnread:</span>
<a href="#l8.91"></a><span id="l8.91">       columnID = &quot;unreadButtonColHeader&quot;;</span>
<a href="#l8.92"></a><span id="l8.92">       break;</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineminus">-    case nsMsgViewSortType.byStatus:</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineplus">+    case Ci.nsMsgViewSortType.byStatus:</span>
<a href="#l8.95"></a><span id="l8.95">       columnID = &quot;statusCol&quot;;</span>
<a href="#l8.96"></a><span id="l8.96">       break;</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineminus">-    case nsMsgViewSortType.byTags:</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineplus">+    case Ci.nsMsgViewSortType.byTags:</span>
<a href="#l8.99"></a><span id="l8.99">       columnID = &quot;tagsCol&quot;;</span>
<a href="#l8.100"></a><span id="l8.100">       break;</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-    case nsMsgViewSortType.bySize:</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineplus">+    case Ci.nsMsgViewSortType.bySize:</span>
<a href="#l8.103"></a><span id="l8.103">       columnID = &quot;sizeCol&quot;;</span>
<a href="#l8.104"></a><span id="l8.104">       break;</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-    case nsMsgViewSortType.byPriority:</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineplus">+    case Ci.nsMsgViewSortType.byPriority:</span>
<a href="#l8.107"></a><span id="l8.107">       columnID = &quot;priorityCol&quot;;</span>
<a href="#l8.108"></a><span id="l8.108">       break;</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-    case nsMsgViewSortType.byFlagged:</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineplus">+    case Ci.nsMsgViewSortType.byFlagged:</span>
<a href="#l8.111"></a><span id="l8.111">       columnID = &quot;flaggedCol&quot;;</span>
<a href="#l8.112"></a><span id="l8.112">       break;</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-    case nsMsgViewSortType.byThread:</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineplus">+    case Ci.nsMsgViewSortType.byThread:</span>
<a href="#l8.115"></a><span id="l8.115">       columnID = &quot;threadCol&quot;;</span>
<a href="#l8.116"></a><span id="l8.116">       break;</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-    case nsMsgViewSortType.byId:</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+    case Ci.nsMsgViewSortType.byId:</span>
<a href="#l8.119"></a><span id="l8.119">       columnID = &quot;idCol&quot;;</span>
<a href="#l8.120"></a><span id="l8.120">       break;</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineminus">-    case nsMsgViewSortType.byJunkStatus:</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineplus">+    case Ci.nsMsgViewSortType.byJunkStatus:</span>
<a href="#l8.123"></a><span id="l8.123">       columnID = &quot;junkStatusCol&quot;;</span>
<a href="#l8.124"></a><span id="l8.124">       break;</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineminus">-    case nsMsgViewSortType.byAttachments:</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineplus">+    case Ci.nsMsgViewSortType.byAttachments:</span>
<a href="#l8.127"></a><span id="l8.127">       columnID = &quot;attachmentCol&quot;;</span>
<a href="#l8.128"></a><span id="l8.128">       break;</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineminus">-    case nsMsgViewSortType.byCustom:</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineplus">+    case Ci.nsMsgViewSortType.byCustom:</span>
<a href="#l8.131"></a><span id="l8.131"> </span>
<a href="#l8.132"></a><span id="l8.132">       // TODO: either change try() catch to if (property exists) or restore the getColumnHandler() check</span>
<a href="#l8.133"></a><span id="l8.133">       try { // getColumnHandler throws an error when the ID is not handled</span>
<a href="#l8.134"></a><span id="l8.134">         columnID = gDBView.curCustomColumn;</span>
<a href="#l8.135"></a><span id="l8.135">       } catch (err) { // error - means no handler</span>
<a href="#l8.136"></a><span id="l8.136">         dump(&quot;ConvertSortTypeToColumnID: custom sort key but no handler for column '&quot; + columnID + &quot;'\n&quot;);</span>
<a href="#l8.137"></a><span id="l8.137">         columnID = &quot;dateCol&quot;;</span>
<a href="#l8.138"></a><span id="l8.138">       }</span>
<a href="#l8.139"></a><span id="l8.139"> </span>
<a href="#l8.140"></a><span id="l8.140">       break;</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineminus">-    case nsMsgViewSortType.byCorrespondent:</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineplus">+    case Ci.nsMsgViewSortType.byCorrespondent:</span>
<a href="#l8.143"></a><span id="l8.143">       columnID = &quot;correspondentCol&quot;;</span>
<a href="#l8.144"></a><span id="l8.144">       break;</span>
<a href="#l8.145"></a><span id="l8.145">     default:</span>
<a href="#l8.146"></a><span id="l8.146">       dump(&quot;unsupported sort key: &quot; + sortKey + &quot;\n&quot;);</span>
<a href="#l8.147"></a><span id="l8.147">       columnID = &quot;dateCol&quot;;</span>
<a href="#l8.148"></a><span id="l8.148">       break;</span>
<a href="#l8.149"></a><span id="l8.149">   }</span>
<a href="#l8.150"></a><span id="l8.150">   return columnID;</span>
<a href="#l8.151"></a><span id="l8.151"> }</span>
<a href="#l8.152"></a><span id="l8.152"> </span>
<a href="#l8.153"></a><span id="l8.153" class="difflineminus">-var nsMsgViewSortType = Ci.nsMsgViewSortType;</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineminus">-var nsMsgViewSortOrder = Ci.nsMsgViewSortOrder;</span>
<a href="#l8.155"></a><span id="l8.155" class="difflineminus">-var nsMsgViewFlagsType = Ci.nsMsgViewFlagsType;</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineminus">-var nsMsgViewCommandType = Ci.nsMsgViewCommandType;</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineminus">-var nsMsgViewType = Ci.nsMsgViewType;</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineminus">-var nsMsgNavigationType = Ci.nsMsgNavigationType;</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineminus">-</span>
<a href="#l8.160"></a><span id="l8.160"> var gDBView = null;</span>
<a href="#l8.161"></a><span id="l8.161"> var gCurViewFlags;</span>
<a href="#l8.162"></a><span id="l8.162"> var gCurSortType;</span>
<a href="#l8.163"></a><span id="l8.163"> </span>
<a href="#l8.164"></a><span id="l8.164" class="difflineminus">-</span>
<a href="#l8.165"></a><span id="l8.165"> function ChangeMessagePaneVisibility(now_hidden) {</span>
<a href="#l8.166"></a><span id="l8.166">   // We also have to disable the Message/Attachments menuitem.</span>
<a href="#l8.167"></a><span id="l8.167">   // It will be enabled when loading a message with attachments</span>
<a href="#l8.168"></a><span id="l8.168">   // (see messageHeaderSink.handleAttachment).</span>
<a href="#l8.169"></a><span id="l8.169">   var node = document.getElementById(&quot;msgAttachmentMenu&quot;);</span>
<a href="#l8.170"></a><span id="l8.170">   if (node &amp;&amp; now_hidden)</span>
<a href="#l8.171"></a><span id="l8.171">     node.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l8.172"></a><span id="l8.172"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/base/content/contentAreaClick.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/base/content/contentAreaClick.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,13 +1,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /**</span>
<a href="#l9.5"></a><span id="l9.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+/* import-globals-from ../../../../toolkit/content/contentAreaUtils.js */</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+/* import-globals-from phishingDetector.js */</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+</span>
<a href="#l9.13"></a><span id="l9.13">   /**</span>
<a href="#l9.14"></a><span id="l9.14">    * Extract the href from the link click event.</span>
<a href="#l9.15"></a><span id="l9.15">    * We look for HTMLAnchorElement, HTMLAreaElement, HTMLLinkElement,</span>
<a href="#l9.16"></a><span id="l9.16">    * HTMLInputElement.form.action, and nested anchor tags.</span>
<a href="#l9.17"></a><span id="l9.17">    * If the clicked element was a HTMLInputElement or HTMLButtonElement</span>
<a href="#l9.18"></a><span id="l9.18">    * we return the form action.</span>
<a href="#l9.19"></a><span id="l9.19">    *</span>
<a href="#l9.20"></a><span id="l9.20">    * @return href for the url being clicked</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/content/editContactPanel.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/content/editContactPanel.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.5"></a><span id="l10.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l10.10"></a><span id="l10.10"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+var { fixIterator } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;, null);</span>
<a href="#l10.12"></a><span id="l10.12"> </span>
<a href="#l10.13"></a><span id="l10.13"> var editContactInlineUI = {</span>
<a href="#l10.14"></a><span id="l10.14">   _overlayLoaded: false,</span>
<a href="#l10.15"></a><span id="l10.15">   _overlayLoading: false,</span>
<a href="#l10.16"></a><span id="l10.16">   _cardDetails: null,</span>
<a href="#l10.17"></a><span id="l10.17">   _writeable: true,</span>
<a href="#l10.18"></a><span id="l10.18">   _blockedCommands: [&quot;cmd_close&quot;],</span>
<a href="#l10.19"></a><span id="l10.19"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/base/content/extensions.xml</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/base/content/extensions.xml</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,9 +1,14 @@</span>
<a href="#l11.4"></a><span id="l11.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+  - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+  - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+&lt;!-- import-globals-from aboutAddonsExtra.js --&gt;</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11"> &lt;!DOCTYPE bindings&gt;</span>
<a href="#l11.12"></a><span id="l11.12"> </span>
<a href="#l11.13"></a><span id="l11.13"> &lt;bindings id=&quot;thunderbird-addon-bindings&quot;</span>
<a href="#l11.14"></a><span id="l11.14">           xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l11.15"></a><span id="l11.15">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l11.16"></a><span id="l11.16">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l11.17"></a><span id="l11.17">   &lt;binding id=&quot;thunderbird-addon-generic&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/base/content/folderDisplay.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/base/content/folderDisplay.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,14 +1,18 @@</span>
<a href="#l12.4"></a><span id="l12.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.5"></a><span id="l12.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.6"></a><span id="l12.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+/* import-globals-from ../../extensions/mailviews/content/msgViewPickerOverlay.js */</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+</span>
<a href="#l12.12"></a><span id="l12.12"> ChromeUtils.import(&quot;resource:///modules/DBViewWrapper.jsm&quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/jsTreeSelection.js&quot;);</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+var { JSTreeSelection } = ChromeUtils.import(&quot;resource:///modules/jsTreeSelection.js&quot;, null);</span>
<a href="#l12.15"></a><span id="l12.15"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l12.16"></a><span id="l12.16"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18"> var gFolderDisplay = null;</span>
<a href="#l12.19"></a><span id="l12.19"> var gMessageDisplay = null;</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21"> /**</span>
<a href="#l12.22"></a><span id="l12.22">  * Maintains a list of listeners for all FolderDisplayWidget instances in this</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineat">@@ -352,20 +356,20 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l12.24"></a><span id="l12.24">    * Restore the last expandAll/collapseAll state, for both grouped and threaded</span>
<a href="#l12.25"></a><span id="l12.25">    * views. Not all views respect viewFlags, ie single folder non-virtual.</span>
<a href="#l12.26"></a><span id="l12.26">    */</span>
<a href="#l12.27"></a><span id="l12.27">   restoreThreadState() {</span>
<a href="#l12.28"></a><span id="l12.28">     if (!this._active || !this.tree || !this.view.dbView.viewFolder)</span>
<a href="#l12.29"></a><span id="l12.29">       return;</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31">     if (this.view._threadExpandAll &amp;&amp;</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-        !(this.view.dbView.viewFlags &amp; nsMsgViewFlagsType.kExpandAll))</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+        !(this.view.dbView.viewFlags &amp; Ci.nsMsgViewFlagsType.kExpandAll))</span>
<a href="#l12.34"></a><span id="l12.34">       this.view.dbView.doCommand(Ci.nsMsgViewCommandType.expandAll);</span>
<a href="#l12.35"></a><span id="l12.35">     if (!this.view._threadExpandAll &amp;&amp;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-        this.view.dbView.viewFlags &amp; nsMsgViewFlagsType.kExpandAll)</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+        this.view.dbView.viewFlags &amp; Ci.nsMsgViewFlagsType.kExpandAll)</span>
<a href="#l12.38"></a><span id="l12.38">       this.view.dbView.doCommand(Ci.nsMsgViewCommandType.collapseAll);</span>
<a href="#l12.39"></a><span id="l12.39">   },</span>
<a href="#l12.40"></a><span id="l12.40">   // @}</span>
<a href="#l12.41"></a><span id="l12.41"> </span>
<a href="#l12.42"></a><span id="l12.42">   /**</span>
<a href="#l12.43"></a><span id="l12.43">    * @name Columns</span>
<a href="#l12.44"></a><span id="l12.44">    * @protected Folder Display</span>
<a href="#l12.45"></a><span id="l12.45">    */</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineat">@@ -1126,17 +1130,17 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l12.47"></a><span id="l12.47">     if (this.view.dbView.numSelected &gt; 0) {</span>
<a href="#l12.48"></a><span id="l12.48">       this.ensureRowIsVisible(this.view.dbView.viewIndexForFirstSelectedMsg);</span>
<a href="#l12.49"></a><span id="l12.49">       return;</span>
<a href="#l12.50"></a><span id="l12.50">     }</span>
<a href="#l12.51"></a><span id="l12.51"> </span>
<a href="#l12.52"></a><span id="l12.52">     // - new messages</span>
<a href="#l12.53"></a><span id="l12.53">     // if configured to scroll to new messages, try that</span>
<a href="#l12.54"></a><span id="l12.54">     if (Services.prefs.getBoolPref(&quot;mailnews.scroll_to_new_message&quot;) &amp;&amp;</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-        this.navigate(nsMsgNavigationType.firstNew, /* select */ false))</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+        this.navigate(Ci.nsMsgNavigationType.firstNew, /* select */ false))</span>
<a href="#l12.57"></a><span id="l12.57">       return;</span>
<a href="#l12.58"></a><span id="l12.58"> </span>
<a href="#l12.59"></a><span id="l12.59">     // - last selected message</span>
<a href="#l12.60"></a><span id="l12.60">     // if configured to load the last selected message (this is currently more</span>
<a href="#l12.61"></a><span id="l12.61">     //  persistent than our saveSelection/restoreSelection stuff), and the view</span>
<a href="#l12.62"></a><span id="l12.62">     //  is backed by a single underlying folder (the only way having just a</span>
<a href="#l12.63"></a><span id="l12.63">     //  message key works out), try that</span>
<a href="#l12.64"></a><span id="l12.64">     if (Services.prefs.getBoolPref(&quot;mailnews.remember_selected_message&quot;) &amp;&amp;</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineat">@@ -1154,17 +1158,17 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l12.66"></a><span id="l12.66">             this.view.dbView.viewIndexForFirstSelectedMsg);</span>
<a href="#l12.67"></a><span id="l12.67">           return;</span>
<a href="#l12.68"></a><span id="l12.68">         }</span>
<a href="#l12.69"></a><span id="l12.69">       }</span>
<a href="#l12.70"></a><span id="l12.70">     }</span>
<a href="#l12.71"></a><span id="l12.71"> </span>
<a href="#l12.72"></a><span id="l12.72">     // - towards the newest messages, but don't select</span>
<a href="#l12.73"></a><span id="l12.73">     if (this.view.isSortedAscending &amp;&amp; this.view.sortImpliesTemporalOrdering &amp;&amp;</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-      this.navigate(nsMsgNavigationType.lastMessage, /* select */ false))</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+      this.navigate(Ci.nsMsgNavigationType.lastMessage, /* select */ false))</span>
<a href="#l12.76"></a><span id="l12.76">       return;</span>
<a href="#l12.77"></a><span id="l12.77"> </span>
<a href="#l12.78"></a><span id="l12.78">     // - to the top, the coliseum</span>
<a href="#l12.79"></a><span id="l12.79">     this.ensureRowIsVisible(0);</span>
<a href="#l12.80"></a><span id="l12.80">   },</span>
<a href="#l12.81"></a><span id="l12.81"> </span>
<a href="#l12.82"></a><span id="l12.82">   /**</span>
<a href="#l12.83"></a><span id="l12.83">    * The DBViewWrapper tells us when someone (possibly the wrapper itself)</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineat">@@ -1859,17 +1863,17 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l12.85"></a><span id="l12.85">     let treeSelection = this.treeSelection; // potentially magic getter</span>
<a href="#l12.86"></a><span id="l12.86">     let currentIndex = treeSelection ? treeSelection.currentIndex : 0;</span>
<a href="#l12.87"></a><span id="l12.87"> </span>
<a href="#l12.88"></a><span id="l12.88">     let viewIndex;</span>
<a href="#l12.89"></a><span id="l12.89">     // if we're doing next unread, and a collapsed thread is selected, and</span>
<a href="#l12.90"></a><span id="l12.90">     // the top level message is unread, just set the result manually to</span>
<a href="#l12.91"></a><span id="l12.91">     // the top level message, without using viewNavigate.</span>
<a href="#l12.92"></a><span id="l12.92">     if (summarizeSelection &amp;&amp;</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-        aNavType == nsMsgNavigationType.nextUnreadMessage &amp;&amp;</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+        aNavType == Ci.nsMsgNavigationType.nextUnreadMessage &amp;&amp;</span>
<a href="#l12.95"></a><span id="l12.95">         currentIndex != -1 &amp;&amp;</span>
<a href="#l12.96"></a><span id="l12.96">         this.view.isCollapsedThreadAtIndex(currentIndex) &amp;&amp;</span>
<a href="#l12.97"></a><span id="l12.97">         !(this.view.dbView.getFlagsAt(currentIndex) &amp;</span>
<a href="#l12.98"></a><span id="l12.98">           Ci.nsMsgMessageFlags.Read)) {</span>
<a href="#l12.99"></a><span id="l12.99">       viewIndex = currentIndex;</span>
<a href="#l12.100"></a><span id="l12.100">     } else {</span>
<a href="#l12.101"></a><span id="l12.101">       // always 'wrap' because the start index is relative to the selection.</span>
<a href="#l12.102"></a><span id="l12.102">       // (keep in mind that many forms of navigation do not care about the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -2,17 +2,26 @@</span>
<a href="#l13.4"></a><span id="l13.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.5"></a><span id="l13.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> // Implements a tree of folders. It shows icons depending on folder type</span>
<a href="#l13.8"></a><span id="l13.8"> // and other fancy styling.</span>
<a href="#l13.9"></a><span id="l13.9"> // This is used in the main folder pane, but also some dialogs that need</span>
<a href="#l13.10"></a><span id="l13.10"> // to show a nice list of folders.</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/folderUtils.jsm&quot;);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+var {</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+  getFolderProperties,</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+  allAccountsSorted,</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+  getMostRecentFolders,</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+  folderNameCompare,</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/folderUtils.jsm&quot;, null);</span>
<a href="#l13.23"></a><span id="l13.23"> var {</span>
<a href="#l13.24"></a><span id="l13.24">   fixIterator,</span>
<a href="#l13.25"></a><span id="l13.25">   toXPCOMArray,</span>
<a href="#l13.26"></a><span id="l13.26"> } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;, null);</span>
<a href="#l13.27"></a><span id="l13.27"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l13.28"></a><span id="l13.28"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l13.29"></a><span id="l13.29"> ChromeUtils.import(&quot;resource:///modules/IOUtils.js&quot;);</span>
<a href="#l13.30"></a><span id="l13.30"> ChromeUtils.import(&quot;resource:///modules/FeedUtils.jsm&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/base/content/foldersummary.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/base/content/foldersummary.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l14.4"></a><span id="l14.4"> /**</span>
<a href="#l14.5"></a><span id="l14.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.6"></a><span id="l14.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.7"></a><span id="l14.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> /* globals MozXULElement */</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">-/* global gFolderTreeView */</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+/* import-globals-from ../../../mailnews/base/content/newmailalert.js */</span>
<a href="#l14.13"></a><span id="l14.13"> </span>
<a href="#l14.14"></a><span id="l14.14"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l14.15"></a><span id="l14.15"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l14.16"></a><span id="l14.16"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18"> /**</span>
<a href="#l14.19"></a><span id="l14.19">  * MozFolderSummary displays a listing of NEW mails for the folder in question.</span>
<a href="#l14.20"></a><span id="l14.20">  * For each mail the subject, sender and a message preview can be included.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/base/content/glodaFacetBindings.xml</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/base/content/glodaFacetBindings.xml</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l15.4"></a><span id="l15.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineminus">-</span>
<a href="#l15.6"></a><span id="l15.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.7"></a><span id="l15.7">   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.8"></a><span id="l15.8">   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+&lt;!-- import-globals-from glodaFacetView.js --&gt;</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+</span>
<a href="#l15.12"></a><span id="l15.12"> &lt;bindings id=&quot;glodaFacetBindings&quot;</span>
<a href="#l15.13"></a><span id="l15.13">           xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l15.14"></a><span id="l15.14">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l15.15"></a><span id="l15.15">           xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l15.16"></a><span id="l15.16">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l15.17"></a><span id="l15.17">           xmlns:svg=&quot;http://www.w3.org/2000/svg&quot;&gt;</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19"> &lt;!-- ===== Constraints ===== --&gt;</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineat">@@ -1370,26 +1371,16 @@</span>
<a href="#l15.21"></a><span id="l15.21">           msgNode.setAttribute(&quot;class&quot;, &quot;message&quot;);</span>
<a href="#l15.22"></a><span id="l15.22">           messagesNode.appendChild(msgNode);</span>
<a href="#l15.23"></a><span id="l15.23">         }</span>
<a href="#l15.24"></a><span id="l15.24">       } catch (e) {</span>
<a href="#l15.25"></a><span id="l15.25">         logException(e);</span>
<a href="#l15.26"></a><span id="l15.26">       }</span>
<a href="#l15.27"></a><span id="l15.27">       ]]&gt;&lt;/body&gt;</span>
<a href="#l15.28"></a><span id="l15.28">     &lt;/method&gt;</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-    &lt;method name=&quot;ensureNodeVisible&quot;&gt;</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-      &lt;parameter name=&quot;messageIndex&quot;/&gt;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-      &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-        let messagesNode = document.getAnonymousElementByAttribute(</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-                             this, &quot;anonid&quot;, &quot;messages&quot;);</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-        let message = messagesNode.childNodes[messageIndex];</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-        window.scrollTo(0, $(message).position().top + $(window).scrollTop());</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-      ]]&gt;&lt;/body&gt;</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-    &lt;/method&gt;</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-</span>
<a href="#l15.39"></a><span id="l15.39">     &lt;method name=&quot;updateSortLabels&quot;&gt;</span>
<a href="#l15.40"></a><span id="l15.40">       &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.41"></a><span id="l15.41">       try {</span>
<a href="#l15.42"></a><span id="l15.42">         let sortBy = FacetContext.sortBy;</span>
<a href="#l15.43"></a><span id="l15.43">         let sortRelevanceNode = document.getAnonymousElementByAttribute(</span>
<a href="#l15.44"></a><span id="l15.44">                           this, &quot;anonid&quot;, &quot;sort-relevance&quot;);</span>
<a href="#l15.45"></a><span id="l15.45">         let sortDateNode = document.getAnonymousElementByAttribute(</span>
<a href="#l15.46"></a><span id="l15.46">                           this, &quot;anonid&quot;, &quot;sort-date&quot;);</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineat">@@ -1468,16 +1459,19 @@</span>
<a href="#l15.48"></a><span id="l15.48">           subject.textContent = message.subject;</span>
<a href="#l15.49"></a><span id="l15.49">         let authorNode = anonElem(&quot;author&quot;);</span>
<a href="#l15.50"></a><span id="l15.50">         authorNode.setAttribute(&quot;title&quot;, message.from.value);</span>
<a href="#l15.51"></a><span id="l15.51">         authorNode.textContent = message.from.contact.name;</span>
<a href="#l15.52"></a><span id="l15.52">         let toNode = anonElem(&quot;to&quot;);</span>
<a href="#l15.53"></a><span id="l15.53">         toNode.textContent = glodaFacetStrings.get(&quot;glodaFacetView.result.message.toLabel&quot;);</span>
<a href="#l15.54"></a><span id="l15.54"> </span>
<a href="#l15.55"></a><span id="l15.55">         // anonElem(&quot;author&quot;).textContent = ;</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineplus">+        let {</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+          makeFriendlyDateAgo,</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+        } = ChromeUtils.import(&quot;resource:///modules/templateUtils.js&quot;, null);</span>
<a href="#l15.59"></a><span id="l15.59">         anonElem(&quot;date&quot;).textContent = makeFriendlyDateAgo(message.date);</span>
<a href="#l15.60"></a><span id="l15.60"> </span>
<a href="#l15.61"></a><span id="l15.61">         // - Recipients</span>
<a href="#l15.62"></a><span id="l15.62">       try {</span>
<a href="#l15.63"></a><span id="l15.63">         let recipientsNode = anonElem(&quot;recipients&quot;);</span>
<a href="#l15.64"></a><span id="l15.64">         if (message.recipients) {</span>
<a href="#l15.65"></a><span id="l15.65">           let recipientCount = 0;</span>
<a href="#l15.66"></a><span id="l15.66">           const MAX_RECIPIENTS = 3;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/base/content/glodaFacetTab.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/base/content/glodaFacetTab.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l16.5"></a><span id="l16.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.6"></a><span id="l16.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> ChromeUtils.import(&quot;resource:///modules/StringBundle.js&quot;);</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/facet.js&quot;);</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+var { FacetDriver } = ChromeUtils.import(&quot;resource:///modules/gloda/facet.js&quot;, null);</span>
<a href="#l16.12"></a><span id="l16.12"> // needed by search.xml to use us</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/msg_search.js&quot;);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+var { GlodaMsgSearcher } = ChromeUtils.import(&quot;resource:///modules/gloda/msg_search.js&quot;, null);</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16"> var glodaFacetTabType = {</span>
<a href="#l16.17"></a><span id="l16.17">   name: &quot;glodaFacet&quot;,</span>
<a href="#l16.18"></a><span id="l16.18">   perTabPanel: &quot;vbox&quot;,</span>
<a href="#l16.19"></a><span id="l16.19">   lastTabId: 0,</span>
<a href="#l16.20"></a><span id="l16.20">   strings:</span>
<a href="#l16.21"></a><span id="l16.21">     new StringBundle(&quot;chrome://messenger/locale/glodaFacetView.properties&quot;),</span>
<a href="#l16.22"></a><span id="l16.22">   modes: {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/base/content/glodaFacetView.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/base/content/glodaFacetView.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -7,25 +7,30 @@</span>
<a href="#l17.4"></a><span id="l17.4">  *  Model View Controller (paradigm), we are the view and the XBL widgets are</span>
<a href="#l17.5"></a><span id="l17.5">  *  the the view and controller.</span>
<a href="#l17.6"></a><span id="l17.6">  *</span>
<a href="#l17.7"></a><span id="l17.7">  * Because much of the work related to faceting is not UI-specific, we try and</span>
<a href="#l17.8"></a><span id="l17.8">  *  push as much of it into mailnews/db/gloda/facet.js.  In some cases we may</span>
<a href="#l17.9"></a><span id="l17.9">  *  get it wrong and it may eventually want to migrate.</span>
<a href="#l17.10"></a><span id="l17.10">  */</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/log4moz.js&quot;);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+var { Log4Moz } = ChromeUtils.import(&quot;resource:///modules/gloda/log4moz.js&quot;, null);</span>
<a href="#l17.14"></a><span id="l17.14"> ChromeUtils.import(&quot;resource:///modules/StringBundle.js&quot;);</span>
<a href="#l17.15"></a><span id="l17.15"> ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l17.16"></a><span id="l17.16"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;);</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/templateUtils.js&quot;);</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+var {</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+  logObject,</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+  logException,</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;, null);</span>
<a href="#l17.23"></a><span id="l17.23"> </span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/public.js&quot;);</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/facet.js&quot;);</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+var { Gloda } = ChromeUtils.import(&quot;resource:///modules/gloda/public.js&quot;, null);</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+var {</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+  FacetDriver,</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+  FacetUtils,</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/gloda/facet.js&quot;, null);</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32"> var glodaFacetStrings =</span>
<a href="#l17.33"></a><span id="l17.33">   new StringBundle(&quot;chrome://messenger/locale/glodaFacetView.properties&quot;);</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35"> /**</span>
<a href="#l17.36"></a><span id="l17.36">  * Represents the active constraints on a singular facet.  Singular facets can</span>
<a href="#l17.37"></a><span id="l17.37">  *  only have an inclusive set or an exclusive set, but not both.  Non-singular</span>
<a href="#l17.38"></a><span id="l17.38">  *  facets can have both.  Because they are different worlds, non-singular gets</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/base/content/glodaFacetVis.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/base/content/glodaFacetVis.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -3,16 +3,19 @@</span>
<a href="#l18.4"></a><span id="l18.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6"> /*</span>
<a href="#l18.7"></a><span id="l18.7">  * Facet visualizations that would be awkward in XBL.  Allegedly because the</span>
<a href="#l18.8"></a><span id="l18.8">  *  interaciton idiom of a protovis-based visualization is entirely different</span>
<a href="#l18.9"></a><span id="l18.9">  *  from XBL, but also a lot because of the lack of good syntax highlighting.</span>
<a href="#l18.10"></a><span id="l18.10">  */</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+/* import-globals-from glodaFacetView.js */</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+/* import-globals-from protovis-r2.6-modded.js */</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+</span>
<a href="#l18.15"></a><span id="l18.15"> /**</span>
<a href="#l18.16"></a><span id="l18.16">  * A date facet visualization abstraction.</span>
<a href="#l18.17"></a><span id="l18.17">  */</span>
<a href="#l18.18"></a><span id="l18.18"> function DateFacetVis(aBinding, aCanvasNode) {</span>
<a href="#l18.19"></a><span id="l18.19">   this.binding = aBinding;</span>
<a href="#l18.20"></a><span id="l18.20">   this.canvasNode = aCanvasNode;</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22">   this.faceter = aBinding.faceter;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/base/content/macMessengerMenu.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/base/content/macMessengerMenu.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l19.4"></a><span id="l19.4"> /* -*- Mode: Javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l19.5"></a><span id="l19.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.6"></a><span id="l19.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.7"></a><span id="l19.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9" class="difflineplus">+/* import-globals-from mailCore.js */</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineplus">+</span>
<a href="#l19.11"></a><span id="l19.11"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l19.12"></a><span id="l19.12"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l19.13"></a><span id="l19.13"> </span>
<a href="#l19.14"></a><span id="l19.14"> // Load and add the menu item to the OS X Dock icon menu.</span>
<a href="#l19.15"></a><span id="l19.15"> addEventListener(&quot;load&quot;, function() {</span>
<a href="#l19.16"></a><span id="l19.16">   let dockMenuElement = document.getElementById(&quot;menu_mac_dockmenu&quot;);</span>
<a href="#l19.17"></a><span id="l19.17">   let nativeMenu = Cc[&quot;@mozilla.org/widget/standalonenativemenu;1&quot;]</span>
<a href="#l19.18"></a><span id="l19.18">                     .createInstance(Ci.nsIStandaloneNativeMenu);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/base/content/mail-compacttheme.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/base/content/mail-compacttheme.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l20.4"></a><span id="l20.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l20.5"></a><span id="l20.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.6"></a><span id="l20.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineplus">+</span>
<a href="#l20.10"></a><span id="l20.10"> /**</span>
<a href="#l20.11"></a><span id="l20.11">  * Enables compacttheme.css when needed.</span>
<a href="#l20.12"></a><span id="l20.12">  */</span>
<a href="#l20.13"></a><span id="l20.13"> var CompactTheme = {</span>
<a href="#l20.14"></a><span id="l20.14">   get styleSheet() {</span>
<a href="#l20.15"></a><span id="l20.15">     // Change getter into a read/write property.</span>
<a href="#l20.16"></a><span id="l20.16">     delete this.styleSheet;</span>
<a href="#l20.17"></a><span id="l20.17">     for (let styleSheet of document.styleSheets) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/base/content/mail-offline.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/base/content/mail-offline.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l21.4"></a><span id="l21.4"> /* -*- Mode: Javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l21.5"></a><span id="l21.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.6"></a><span id="l21.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.7"></a><span id="l21.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineplus">+</span>
<a href="#l21.11"></a><span id="l21.11"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l21.12"></a><span id="l21.12"> </span>
<a href="#l21.13"></a><span id="l21.13"> var MailOfflineMgr = {</span>
<a href="#l21.14"></a><span id="l21.14">   offlineManager: null,</span>
<a href="#l21.15"></a><span id="l21.15">   offlineBundle: null,</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17">   init() {</span>
<a href="#l21.18"></a><span id="l21.18">     Services.obs.addObserver(this, &quot;network:offline-status-changed&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -2,16 +2,23 @@</span>
<a href="#l22.4"></a><span id="l22.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.5"></a><span id="l22.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7"> /**</span>
<a href="#l22.8"></a><span id="l22.8">  * Functionality for the main application window (aka the 3pane) usually</span>
<a href="#l22.9"></a><span id="l22.9">  * consisting of folder pane, thread pane and message pane.</span>
<a href="#l22.10"></a><span id="l22.10">  */</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+/* import-globals-from ../../components/im/content/chat-messenger.js */</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+/* import-globals-from msgViewNavigation.js */</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+/* import-globals-from threadPane.js */</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+</span>
<a href="#l22.19"></a><span id="l22.19"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l22.20"></a><span id="l22.20"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l22.21"></a><span id="l22.21"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l22.22"></a><span id="l22.22"> ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l22.23"></a><span id="l22.23"> </span>
<a href="#l22.24"></a><span id="l22.24"> // Controller object for folder pane</span>
<a href="#l22.25"></a><span id="l22.25"> var FolderPaneController = {</span>
<a href="#l22.26"></a><span id="l22.26">   supportsCommand(command) {</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineat">@@ -258,42 +265,42 @@ var DefaultController = {</span>
<a href="#l22.28"></a><span id="l22.28"> </span>
<a href="#l22.29"></a><span id="l22.29">   isCommandEnabled(command) {</span>
<a href="#l22.30"></a><span id="l22.30">     switch (command) {</span>
<a href="#l22.31"></a><span id="l22.31">       case &quot;cmd_delete&quot;:</span>
<a href="#l22.32"></a><span id="l22.32">         UpdateDeleteCommand();</span>
<a href="#l22.33"></a><span id="l22.33">         // fall through</span>
<a href="#l22.34"></a><span id="l22.34">       case &quot;button_delete&quot;:</span>
<a href="#l22.35"></a><span id="l22.35">         UpdateDeleteToolbarButton();</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.deleteMsg);</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.deleteMsg);</span>
<a href="#l22.38"></a><span id="l22.38">       case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l22.39"></a><span id="l22.39">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l22.42"></a><span id="l22.42">       case &quot;cmd_cancel&quot;:</span>
<a href="#l22.43"></a><span id="l22.43">         return gFolderDisplay.selectedCount == 1 &amp;&amp;</span>
<a href="#l22.44"></a><span id="l22.44">                gFolderDisplay.selectedMessageIsNews;</span>
<a href="#l22.45"></a><span id="l22.45">       case &quot;cmd_deleteFolder&quot;:</span>
<a href="#l22.46"></a><span id="l22.46">         var folders = gFolderTreeView.getSelectedFolders();</span>
<a href="#l22.47"></a><span id="l22.47">         if (folders.length == 1) {</span>
<a href="#l22.48"></a><span id="l22.48">           let folder = folders[0];</span>
<a href="#l22.49"></a><span id="l22.49">           if (folder.server.type == &quot;nntp&quot;) {</span>
<a href="#l22.50"></a><span id="l22.50">             // Just disable the command for news unless it is a Saved search folder.</span>
<a href="#l22.51"></a><span id="l22.51">             return folder.getFlag(Ci.nsMsgFolderFlags.Virtual);</span>
<a href="#l22.52"></a><span id="l22.52">           }</span>
<a href="#l22.53"></a><span id="l22.53">           return CanDeleteFolder(folder);</span>
<a href="#l22.54"></a><span id="l22.54">         }</span>
<a href="#l22.55"></a><span id="l22.55">         return false;</span>
<a href="#l22.56"></a><span id="l22.56">       case &quot;button_junk&quot;:</span>
<a href="#l22.57"></a><span id="l22.57">         UpdateJunkToolbarButton();</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk);</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.junk);</span>
<a href="#l22.60"></a><span id="l22.60">       case &quot;cmd_killThread&quot;:</span>
<a href="#l22.61"></a><span id="l22.61">       case &quot;cmd_killSubthread&quot;:</span>
<a href="#l22.62"></a><span id="l22.62">         return gFolderDisplay.selectedCount &gt; 0;</span>
<a href="#l22.63"></a><span id="l22.63">       case &quot;cmd_watchThread&quot;:</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.toggleThreadWatched);</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.toggleThreadWatched);</span>
<a href="#l22.66"></a><span id="l22.66">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l22.67"></a><span id="l22.67">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l22.68"></a><span id="l22.68">         return gFolderDisplay.selectedCount == 1 &amp;&amp;</span>
<a href="#l22.69"></a><span id="l22.69">                gFolderDisplay.selectedMessage.folder &amp;&amp;</span>
<a href="#l22.70"></a><span id="l22.70">                gFolderDisplay.selectedMessage.folder.server.canHaveFilters;</span>
<a href="#l22.71"></a><span id="l22.71">       case &quot;cmd_openConversation&quot;:</span>
<a href="#l22.72"></a><span id="l22.72">       case &quot;button_showconversation&quot;:</span>
<a href="#l22.73"></a><span id="l22.73">         return gFolderDisplay.selectedCount == 1 &amp;&amp;</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineat">@@ -330,17 +337,17 @@ var DefaultController = {</span>
<a href="#l22.75"></a><span id="l22.75">         if (command == &quot;cmd_applyFiltersToSelection&quot;) {</span>
<a href="#l22.76"></a><span id="l22.76">           var whichText = &quot;valueMessage&quot;;</span>
<a href="#l22.77"></a><span id="l22.77">           if (numSelected &gt; 1)</span>
<a href="#l22.78"></a><span id="l22.78">             whichText = &quot;valueSelection&quot;;</span>
<a href="#l22.79"></a><span id="l22.79">           goSetMenuValue(command, whichText);</span>
<a href="#l22.80"></a><span id="l22.80">           goSetAccessKey(command, whichText + &quot;AccessKey&quot;);</span>
<a href="#l22.81"></a><span id="l22.81">         }</span>
<a href="#l22.82"></a><span id="l22.82">         if (numSelected &gt; 0) {</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineminus">-          if (!gFolderDisplay.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody))</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineplus">+          if (!gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.cmdRequiringMsgBody))</span>
<a href="#l22.85"></a><span id="l22.85">             return false;</span>
<a href="#l22.86"></a><span id="l22.86"> </span>
<a href="#l22.87"></a><span id="l22.87">           // Check if we have a collapsed thread selected and are summarizing it.</span>
<a href="#l22.88"></a><span id="l22.88">           // If so, selectedIndices.length won't match numSelected. Also check</span>
<a href="#l22.89"></a><span id="l22.89">           // that we're not displaying a message, which handles the case</span>
<a href="#l22.90"></a><span id="l22.90">           // where we failed to summarize the selection and fell back to</span>
<a href="#l22.91"></a><span id="l22.91">           // displaying a message.</span>
<a href="#l22.92"></a><span id="l22.92">           if (gFolderDisplay.selectedIndices.length != numSelected &amp;&amp;</span>
<a href="#l22.93"></a><span id="l22.93" class="difflineat">@@ -352,48 +359,48 @@ var DefaultController = {</span>
<a href="#l22.94"></a><span id="l22.94">             return IsReplyEnabled();</span>
<a href="#l22.95"></a><span id="l22.95">           if (command == &quot;cmd_replylist&quot; || command == &quot;button_replylist&quot;)</span>
<a href="#l22.96"></a><span id="l22.96">             return IsReplyListEnabled();</span>
<a href="#l22.97"></a><span id="l22.97">           return true;</span>
<a href="#l22.98"></a><span id="l22.98">         }</span>
<a href="#l22.99"></a><span id="l22.99">         return false;</span>
<a href="#l22.100"></a><span id="l22.100">       case &quot;cmd_printpreview&quot;:</span>
<a href="#l22.101"></a><span id="l22.101">         if (gFolderDisplay.selectedCount == 1)</span>
<a href="#l22.102"></a><span id="l22.102" class="difflineminus">-          return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody);</span>
<a href="#l22.103"></a><span id="l22.103" class="difflineplus">+          return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.cmdRequiringMsgBody);</span>
<a href="#l22.104"></a><span id="l22.104">         return false;</span>
<a href="#l22.105"></a><span id="l22.105">       case &quot;cmd_newMessage&quot;:</span>
<a href="#l22.106"></a><span id="l22.106">         return CanComposeMessages();</span>
<a href="#l22.107"></a><span id="l22.107">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l22.108"></a><span id="l22.108">       case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l22.109"></a><span id="l22.109">       case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l22.110"></a><span id="l22.110">         return true;</span>
<a href="#l22.111"></a><span id="l22.111">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l22.112"></a><span id="l22.112">       case &quot;button_file&quot;:</span>
<a href="#l22.113"></a><span id="l22.113">         return gFolderDisplay.selectedCount &gt; 0;</span>
<a href="#l22.114"></a><span id="l22.114">       case &quot;cmd_archive&quot;:</span>
<a href="#l22.115"></a><span id="l22.115">       case &quot;button_archive&quot;:</span>
<a href="#l22.116"></a><span id="l22.116">         return gFolderDisplay.canArchiveSelectedMessages;</span>
<a href="#l22.117"></a><span id="l22.117">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l22.118"></a><span id="l22.118">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l22.119"></a><span id="l22.119" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk);</span>
<a href="#l22.120"></a><span id="l22.120" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.junk);</span>
<a href="#l22.121"></a><span id="l22.121">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l22.122"></a><span id="l22.122">         // We're going to take a conservative position here, because we really</span>
<a href="#l22.123"></a><span id="l22.123">         // don't want people running junk controls on folders that are not</span>
<a href="#l22.124"></a><span id="l22.124">         // enabled for junk. The junk type picks up possible dummy message headers,</span>
<a href="#l22.125"></a><span id="l22.125">         // while the runJunkControls will prevent running on XF virtual folders.</span>
<a href="#l22.126"></a><span id="l22.126" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk) &amp;&amp;</span>
<a href="#l22.127"></a><span id="l22.127" class="difflineminus">-               gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l22.128"></a><span id="l22.128" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.junk) &amp;&amp;</span>
<a href="#l22.129"></a><span id="l22.129" class="difflineplus">+               gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.runJunkControls);</span>
<a href="#l22.130"></a><span id="l22.130">       case &quot;cmd_displayMsgFilters&quot;:</span>
<a href="#l22.131"></a><span id="l22.131">         return MailServices.accounts.accounts.length &gt; 0;</span>
<a href="#l22.132"></a><span id="l22.132">       case &quot;cmd_applyFilters&quot;:</span>
<a href="#l22.133"></a><span id="l22.133" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.applyFilters);</span>
<a href="#l22.134"></a><span id="l22.134" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.applyFilters);</span>
<a href="#l22.135"></a><span id="l22.135">       case &quot;cmd_runJunkControls&quot;:</span>
<a href="#l22.136"></a><span id="l22.136" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l22.137"></a><span id="l22.137" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.runJunkControls);</span>
<a href="#l22.138"></a><span id="l22.138">       case &quot;cmd_deleteJunk&quot;:</span>
<a href="#l22.139"></a><span id="l22.139" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.deleteJunk);</span>
<a href="#l22.140"></a><span id="l22.140" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.deleteJunk);</span>
<a href="#l22.141"></a><span id="l22.141">       case &quot;button_mark&quot;:</span>
<a href="#l22.142"></a><span id="l22.142">       case &quot;cmd_tag&quot;:</span>
<a href="#l22.143"></a><span id="l22.143">       case &quot;cmd_addTag&quot;:</span>
<a href="#l22.144"></a><span id="l22.144">       case &quot;cmd_manageTags&quot;:</span>
<a href="#l22.145"></a><span id="l22.145">       case &quot;cmd_removeTags&quot;:</span>
<a href="#l22.146"></a><span id="l22.146">       case &quot;cmd_tag1&quot;:</span>
<a href="#l22.147"></a><span id="l22.147">       case &quot;cmd_tag2&quot;:</span>
<a href="#l22.148"></a><span id="l22.148">       case &quot;cmd_tag3&quot;:</span>
<a href="#l22.149"></a><span id="l22.149" class="difflineat">@@ -420,17 +427,17 @@ var DefaultController = {</span>
<a href="#l22.150"></a><span id="l22.150">       case &quot;button_previous&quot;:</span>
<a href="#l22.151"></a><span id="l22.151">       case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l22.152"></a><span id="l22.152">         return IsViewNavigationItemEnabled();</span>
<a href="#l22.153"></a><span id="l22.153">       case &quot;button_goForward&quot;:</span>
<a href="#l22.154"></a><span id="l22.154">       case &quot;button_goBack&quot;:</span>
<a href="#l22.155"></a><span id="l22.155">       case &quot;cmd_goForward&quot;:</span>
<a href="#l22.156"></a><span id="l22.156">       case &quot;cmd_goBack&quot;:</span>
<a href="#l22.157"></a><span id="l22.157">         if (gDBView)</span>
<a href="#l22.158"></a><span id="l22.158" class="difflineminus">-          return gDBView.navigateStatus((command == &quot;cmd_goBack&quot; || command == &quot;button_goBack&quot;) ? nsMsgNavigationType.back : nsMsgNavigationType.forward);</span>
<a href="#l22.159"></a><span id="l22.159" class="difflineplus">+          return gDBView.navigateStatus((command == &quot;cmd_goBack&quot; || command == &quot;button_goBack&quot;) ? Ci.nsMsgNavigationType.back : Ci.nsMsgNavigationType.forward);</span>
<a href="#l22.160"></a><span id="l22.160">         return false;</span>
<a href="#l22.161"></a><span id="l22.161">       case &quot;cmd_goStartPage&quot;:</span>
<a href="#l22.162"></a><span id="l22.162">         return document.getElementById(&quot;tabmail&quot;).selectedTab.mode.name == &quot;folder&quot; &amp;&amp;</span>
<a href="#l22.163"></a><span id="l22.163">                !IsMessagePaneCollapsed();</span>
<a href="#l22.164"></a><span id="l22.164">       case &quot;cmd_undoCloseTab&quot;:</span>
<a href="#l22.165"></a><span id="l22.165">         return (document.getElementById(&quot;tabmail&quot;).recentlyClosedTabs.length &gt; 0);</span>
<a href="#l22.166"></a><span id="l22.166">       case &quot;cmd_markAllRead&quot;:</span>
<a href="#l22.167"></a><span id="l22.167">         return IsFolderSelected() &amp;&amp; gDBView &amp;&amp; gDBView.msgFolder &amp;&amp;</span>
<a href="#l22.168"></a><span id="l22.168" class="difflineat">@@ -648,92 +655,92 @@ var DefaultController = {</span>
<a href="#l22.169"></a><span id="l22.169">          // this ensures that we clear the biff indicator from the system tray when the user deletes the new message</span>
<a href="#l22.170"></a><span id="l22.170">         MarkSelectedMessagesRead(true);</span>
<a href="#l22.171"></a><span id="l22.171">         // If this is a right-click triggered delete, then do not hint about</span>
<a href="#l22.172"></a><span id="l22.172">         //  the deletion.  Note: The code that swaps the selection back in will</span>
<a href="#l22.173"></a><span id="l22.173">         //  take care of ensuring that this deletion does not make the saved</span>
<a href="#l22.174"></a><span id="l22.174">         //  selection incorrect.</span>
<a href="#l22.175"></a><span id="l22.175">         if (!gRightMouseButtonSavedSelection)</span>
<a href="#l22.176"></a><span id="l22.176">           gFolderDisplay.hintAboutToDeleteMessages();</span>
<a href="#l22.177"></a><span id="l22.177" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.deleteMsg);</span>
<a href="#l22.178"></a><span id="l22.178" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.deleteMsg);</span>
<a href="#l22.179"></a><span id="l22.179">         UpdateDeleteToolbarButton();</span>
<a href="#l22.180"></a><span id="l22.180">         break;</span>
<a href="#l22.181"></a><span id="l22.181">       case &quot;cmd_cancel&quot;:</span>
<a href="#l22.182"></a><span id="l22.182">         let message = gFolderDisplay.selectedMessage;</span>
<a href="#l22.183"></a><span id="l22.183">         message.folder.QueryInterface(Ci.nsIMsgNewsFolder)</span>
<a href="#l22.184"></a><span id="l22.184">                       .cancelMessage(message, msgWindow);</span>
<a href="#l22.185"></a><span id="l22.185">         break;</span>
<a href="#l22.186"></a><span id="l22.186">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l22.187"></a><span id="l22.187">       case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l22.188"></a><span id="l22.188">         MarkSelectedMessagesRead(true);</span>
<a href="#l22.189"></a><span id="l22.189">         gFolderDisplay.hintAboutToDeleteMessages();</span>
<a href="#l22.190"></a><span id="l22.190" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l22.191"></a><span id="l22.191" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l22.192"></a><span id="l22.192">         UpdateDeleteToolbarButton();</span>
<a href="#l22.193"></a><span id="l22.193">         break;</span>
<a href="#l22.194"></a><span id="l22.194">       case &quot;cmd_deleteFolder&quot;:</span>
<a href="#l22.195"></a><span id="l22.195">         gFolderTreeController.deleteFolder();</span>
<a href="#l22.196"></a><span id="l22.196">         break;</span>
<a href="#l22.197"></a><span id="l22.197">       case &quot;cmd_killThread&quot;:</span>
<a href="#l22.198"></a><span id="l22.198">         if (!gFolderDisplay.selectedMessageIsNews) {</span>
<a href="#l22.199"></a><span id="l22.199">           if (!gFolderDisplay.selectedMessageThreadIgnored) {</span>
<a href="#l22.200"></a><span id="l22.200">             ShowIgnoredMessageNotification(gFolderDisplay.selectedMessages, false);</span>
<a href="#l22.201"></a><span id="l22.201">           } else {</span>
<a href="#l22.202"></a><span id="l22.202">             document.getElementById(&quot;msg-footer-notification-box&quot;)</span>
<a href="#l22.203"></a><span id="l22.203">                     .removeTransientNotifications();</span>
<a href="#l22.204"></a><span id="l22.204">           }</span>
<a href="#l22.205"></a><span id="l22.205">         }</span>
<a href="#l22.206"></a><span id="l22.206">         // kill thread kills the thread and then does a next unread</span>
<a href="#l22.207"></a><span id="l22.207" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.toggleThreadKilled, true);</span>
<a href="#l22.208"></a><span id="l22.208" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.toggleThreadKilled, true);</span>
<a href="#l22.209"></a><span id="l22.209">         break;</span>
<a href="#l22.210"></a><span id="l22.210">       case &quot;cmd_killSubthread&quot;:</span>
<a href="#l22.211"></a><span id="l22.211">         if (!gFolderDisplay.selectedMessageIsNews) {</span>
<a href="#l22.212"></a><span id="l22.212">           if (!gFolderDisplay.selectedMessageSubthreadIgnored) {</span>
<a href="#l22.213"></a><span id="l22.213">             ShowIgnoredMessageNotification(gFolderDisplay.selectedMessages, true);</span>
<a href="#l22.214"></a><span id="l22.214">           } else {</span>
<a href="#l22.215"></a><span id="l22.215">             document.getElementById(&quot;msg-footer-notification-box&quot;)</span>
<a href="#l22.216"></a><span id="l22.216">                     .removeTransientNotifications();</span>
<a href="#l22.217"></a><span id="l22.217">           }</span>
<a href="#l22.218"></a><span id="l22.218">         }</span>
<a href="#l22.219"></a><span id="l22.219" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.toggleSubthreadKilled, true);</span>
<a href="#l22.220"></a><span id="l22.220" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.toggleSubthreadKilled, true);</span>
<a href="#l22.221"></a><span id="l22.221">         break;</span>
<a href="#l22.222"></a><span id="l22.222">       case &quot;cmd_watchThread&quot;:</span>
<a href="#l22.223"></a><span id="l22.223" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.toggleThreadWatched);</span>
<a href="#l22.224"></a><span id="l22.224" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.toggleThreadWatched);</span>
<a href="#l22.225"></a><span id="l22.225">         break;</span>
<a href="#l22.226"></a><span id="l22.226">       case &quot;button_next&quot;:</span>
<a href="#l22.227"></a><span id="l22.227">       case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l22.228"></a><span id="l22.228" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.nextUnreadMessage, true);</span>
<a href="#l22.229"></a><span id="l22.229" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.nextUnreadMessage, true);</span>
<a href="#l22.230"></a><span id="l22.230">         break;</span>
<a href="#l22.231"></a><span id="l22.231">       case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l22.232"></a><span id="l22.232" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.nextUnreadThread, true);</span>
<a href="#l22.233"></a><span id="l22.233" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.nextUnreadThread, true);</span>
<a href="#l22.234"></a><span id="l22.234">         break;</span>
<a href="#l22.235"></a><span id="l22.235">       case &quot;button_nextMsg&quot;:</span>
<a href="#l22.236"></a><span id="l22.236">       case &quot;cmd_nextMsg&quot;:</span>
<a href="#l22.237"></a><span id="l22.237" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.nextMessage, false);</span>
<a href="#l22.238"></a><span id="l22.238" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.nextMessage, false);</span>
<a href="#l22.239"></a><span id="l22.239">         break;</span>
<a href="#l22.240"></a><span id="l22.240">       case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l22.241"></a><span id="l22.241" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.nextFlagged, true);</span>
<a href="#l22.242"></a><span id="l22.242" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.nextFlagged, true);</span>
<a href="#l22.243"></a><span id="l22.243">         break;</span>
<a href="#l22.244"></a><span id="l22.244">       case &quot;button_previousMsg&quot;:</span>
<a href="#l22.245"></a><span id="l22.245">       case &quot;cmd_previousMsg&quot;:</span>
<a href="#l22.246"></a><span id="l22.246" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.previousMessage, false);</span>
<a href="#l22.247"></a><span id="l22.247" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.previousMessage, false);</span>
<a href="#l22.248"></a><span id="l22.248">         break;</span>
<a href="#l22.249"></a><span id="l22.249">       case &quot;button_previous&quot;:</span>
<a href="#l22.250"></a><span id="l22.250">       case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l22.251"></a><span id="l22.251" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.previousUnreadMessage, true);</span>
<a href="#l22.252"></a><span id="l22.252" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.previousUnreadMessage, true);</span>
<a href="#l22.253"></a><span id="l22.253">         break;</span>
<a href="#l22.254"></a><span id="l22.254">       case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l22.255"></a><span id="l22.255" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.previousFlagged, true);</span>
<a href="#l22.256"></a><span id="l22.256" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.previousFlagged, true);</span>
<a href="#l22.257"></a><span id="l22.257">         break;</span>
<a href="#l22.258"></a><span id="l22.258">       case &quot;button_goForward&quot;:</span>
<a href="#l22.259"></a><span id="l22.259">       case &quot;cmd_goForward&quot;:</span>
<a href="#l22.260"></a><span id="l22.260" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.forward, true);</span>
<a href="#l22.261"></a><span id="l22.261" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.forward, true);</span>
<a href="#l22.262"></a><span id="l22.262">         break;</span>
<a href="#l22.263"></a><span id="l22.263">       case &quot;button_goBack&quot;:</span>
<a href="#l22.264"></a><span id="l22.264">       case &quot;cmd_goBack&quot;:</span>
<a href="#l22.265"></a><span id="l22.265" class="difflineminus">-        GoNextMessage(nsMsgNavigationType.back, true);</span>
<a href="#l22.266"></a><span id="l22.266" class="difflineplus">+        GoNextMessage(Ci.nsMsgNavigationType.back, true);</span>
<a href="#l22.267"></a><span id="l22.267">         break;</span>
<a href="#l22.268"></a><span id="l22.268">       case &quot;cmd_goStartPage&quot;:</span>
<a href="#l22.269"></a><span id="l22.269">         HideMessageHeaderPane();</span>
<a href="#l22.270"></a><span id="l22.270">         loadStartPage(true);</span>
<a href="#l22.271"></a><span id="l22.271">         break;</span>
<a href="#l22.272"></a><span id="l22.272">       case &quot;cmd_undoCloseTab&quot;:</span>
<a href="#l22.273"></a><span id="l22.273">         document.getElementById(&quot;tabmail&quot;).undoCloseTab();</span>
<a href="#l22.274"></a><span id="l22.274">         break;</span>
<a href="#l22.275"></a><span id="l22.275" class="difflineat">@@ -760,22 +767,22 @@ var DefaultController = {</span>
<a href="#l22.276"></a><span id="l22.276">         break;</span>
<a href="#l22.277"></a><span id="l22.277">       case &quot;cmd_undo&quot;:</span>
<a href="#l22.278"></a><span id="l22.278">         messenger.undo(msgWindow);</span>
<a href="#l22.279"></a><span id="l22.279">         break;</span>
<a href="#l22.280"></a><span id="l22.280">       case &quot;cmd_redo&quot;:</span>
<a href="#l22.281"></a><span id="l22.281">         messenger.redo(msgWindow);</span>
<a href="#l22.282"></a><span id="l22.282">         break;</span>
<a href="#l22.283"></a><span id="l22.283">       case &quot;cmd_expandAllThreads&quot;:</span>
<a href="#l22.284"></a><span id="l22.284" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.expandAll);</span>
<a href="#l22.285"></a><span id="l22.285" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.expandAll);</span>
<a href="#l22.286"></a><span id="l22.286">         gFolderDisplay.ensureSelectionIsVisible();</span>
<a href="#l22.287"></a><span id="l22.287">         break;</span>
<a href="#l22.288"></a><span id="l22.288">       case &quot;cmd_collapseAllThreads&quot;:</span>
<a href="#l22.289"></a><span id="l22.289">         gFolderDisplay.selectSelectedThreadRoots();</span>
<a href="#l22.290"></a><span id="l22.290" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.collapseAll);</span>
<a href="#l22.291"></a><span id="l22.291" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.collapseAll);</span>
<a href="#l22.292"></a><span id="l22.292">         gFolderDisplay.ensureSelectionIsVisible();</span>
<a href="#l22.293"></a><span id="l22.293">         break;</span>
<a href="#l22.294"></a><span id="l22.294">       case &quot;cmd_renameFolder&quot;:</span>
<a href="#l22.295"></a><span id="l22.295">         gFolderTreeController.renameFolder();</span>
<a href="#l22.296"></a><span id="l22.296">         return;</span>
<a href="#l22.297"></a><span id="l22.297">       case &quot;cmd_sendUnsentMsgs&quot;:</span>
<a href="#l22.298"></a><span id="l22.298">         // if offline, prompt for sendUnsentMessages</span>
<a href="#l22.299"></a><span id="l22.299">         if (MailOfflineMgr.isOnline())</span>
<a href="#l22.300"></a><span id="l22.300" class="difflineat">@@ -872,20 +879,20 @@ var DefaultController = {</span>
<a href="#l22.301"></a><span id="l22.301">       case &quot;cmd_markAsRead&quot;:</span>
<a href="#l22.302"></a><span id="l22.302">         MsgMarkMsgAsRead(true);</span>
<a href="#l22.303"></a><span id="l22.303">         return;</span>
<a href="#l22.304"></a><span id="l22.304">       case &quot;cmd_markAsUnread&quot;:</span>
<a href="#l22.305"></a><span id="l22.305">         MsgMarkMsgAsRead(false);</span>
<a href="#l22.306"></a><span id="l22.306">         return;</span>
<a href="#l22.307"></a><span id="l22.307">       case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l22.308"></a><span id="l22.308">         ClearPendingReadTimer();</span>
<a href="#l22.309"></a><span id="l22.309" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.markThreadRead);</span>
<a href="#l22.310"></a><span id="l22.310" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.markThreadRead);</span>
<a href="#l22.311"></a><span id="l22.311">         return;</span>
<a href="#l22.312"></a><span id="l22.312">       case &quot;cmd_markAllRead&quot;:</span>
<a href="#l22.313"></a><span id="l22.313" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.markAllRead);</span>
<a href="#l22.314"></a><span id="l22.314" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.markAllRead);</span>
<a href="#l22.315"></a><span id="l22.315">         return;</span>
<a href="#l22.316"></a><span id="l22.316">       case &quot;button_junk&quot;:</span>
<a href="#l22.317"></a><span id="l22.317">         MsgJunk();</span>
<a href="#l22.318"></a><span id="l22.318">         return;</span>
<a href="#l22.319"></a><span id="l22.319">       case &quot;cmd_stop&quot;:</span>
<a href="#l22.320"></a><span id="l22.320">         msgWindow.StopUrls();</span>
<a href="#l22.321"></a><span id="l22.321">         return;</span>
<a href="#l22.322"></a><span id="l22.322">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l22.323"></a><span id="l22.323" class="difflineat">@@ -928,20 +935,20 @@ var DefaultController = {</span>
<a href="#l22.324"></a><span id="l22.324">         return;</span>
<a href="#l22.325"></a><span id="l22.325">       case &quot;cmd_compactFolder&quot;:</span>
<a href="#l22.326"></a><span id="l22.326">         gFolderTreeController.compactAllFoldersForAccount();</span>
<a href="#l22.327"></a><span id="l22.327">         return;</span>
<a href="#l22.328"></a><span id="l22.328">       case &quot;button_compact&quot;:</span>
<a href="#l22.329"></a><span id="l22.329">         gFolderTreeController.compactFolders();</span>
<a href="#l22.330"></a><span id="l22.330">         return;</span>
<a href="#l22.331"></a><span id="l22.331">       case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l22.332"></a><span id="l22.332" class="difflineminus">-          gFolderDisplay.doCommand(nsMsgViewCommandType.downloadFlaggedForOffline);</span>
<a href="#l22.333"></a><span id="l22.333" class="difflineplus">+          gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.downloadFlaggedForOffline);</span>
<a href="#l22.334"></a><span id="l22.334">           break;</span>
<a href="#l22.335"></a><span id="l22.335">       case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l22.336"></a><span id="l22.336" class="difflineminus">-          gFolderDisplay.doCommand(nsMsgViewCommandType.downloadSelectedForOffline);</span>
<a href="#l22.337"></a><span id="l22.337" class="difflineplus">+          gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.downloadSelectedForOffline);</span>
<a href="#l22.338"></a><span id="l22.338">           break;</span>
<a href="#l22.339"></a><span id="l22.339">       case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l22.340"></a><span id="l22.340">           MsgSynchronizeOffline();</span>
<a href="#l22.341"></a><span id="l22.341">           break;</span>
<a href="#l22.342"></a><span id="l22.342">       case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l22.343"></a><span id="l22.343">           MailOfflineMgr.openOfflineAccountSettings();</span>
<a href="#l22.344"></a><span id="l22.344">           break;</span>
<a href="#l22.345"></a><span id="l22.345">       case &quot;cmd_moveToFolderAgain&quot;:</span>
<a href="#l22.346"></a><span id="l22.346" class="difflineat">@@ -956,23 +963,23 @@ var DefaultController = {</span>
<a href="#l22.347"></a><span id="l22.347">         // XXX If the message pane is selected but the tab focused, this ends</span>
<a href="#l22.348"></a><span id="l22.348">         // closing the message tab. See bug 502834.</span>
<a href="#l22.349"></a><span id="l22.349">         if (aTab.mode.name == &quot;message&quot;)</span>
<a href="#l22.350"></a><span id="l22.350">           break;</span>
<a href="#l22.351"></a><span id="l22.351"> </span>
<a href="#l22.352"></a><span id="l22.352">         // move the focus so the user can delete the newly selected messages, not the folder</span>
<a href="#l22.353"></a><span id="l22.353">         SetFocusThreadPane();</span>
<a href="#l22.354"></a><span id="l22.354">         // if in threaded mode, the view will expand all before selecting all</span>
<a href="#l22.355"></a><span id="l22.355" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.selectAll);</span>
<a href="#l22.356"></a><span id="l22.356" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.selectAll);</span>
<a href="#l22.357"></a><span id="l22.357">         break;</span>
<a href="#l22.358"></a><span id="l22.358">       case &quot;cmd_selectThread&quot;:</span>
<a href="#l22.359"></a><span id="l22.359" class="difflineminus">-          gFolderDisplay.doCommand(nsMsgViewCommandType.selectThread);</span>
<a href="#l22.360"></a><span id="l22.360" class="difflineplus">+          gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.selectThread);</span>
<a href="#l22.361"></a><span id="l22.361">           break;</span>
<a href="#l22.362"></a><span id="l22.362">       case &quot;cmd_selectFlagged&quot;:</span>
<a href="#l22.363"></a><span id="l22.363" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.selectFlagged);</span>
<a href="#l22.364"></a><span id="l22.364" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.selectFlagged);</span>
<a href="#l22.365"></a><span id="l22.365">         break;</span>
<a href="#l22.366"></a><span id="l22.366">       case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l22.367"></a><span id="l22.367">         ZoomManager.reduce();</span>
<a href="#l22.368"></a><span id="l22.368">         break;</span>
<a href="#l22.369"></a><span id="l22.369">       case &quot;cmd_fullZoomEnlarge&quot;:</span>
<a href="#l22.370"></a><span id="l22.370">         ZoomManager.enlarge();</span>
<a href="#l22.371"></a><span id="l22.371">         break;</span>
<a href="#l22.372"></a><span id="l22.372">       case &quot;cmd_fullZoomReset&quot;:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/base/content/mailCommands.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/base/content/mailCommands.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -1,13 +1,17 @@</span>
<a href="#l23.4"></a><span id="l23.4"> /* -*- Mode: Javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l23.5"></a><span id="l23.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l23.6"></a><span id="l23.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l23.7"></a><span id="l23.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+</span>
<a href="#l23.13"></a><span id="l23.13"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l23.14"></a><span id="l23.14"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16"> /**</span>
<a href="#l23.17"></a><span id="l23.17">  * Get the identity that most likely is the best one to use, given the hint.</span>
<a href="#l23.18"></a><span id="l23.18">  * @param identities    nsIArray&lt;nsIMsgIdentity&gt; of identities</span>
<a href="#l23.19"></a><span id="l23.19">  * @param optionalHint  string containing comma separated mailboxes</span>
<a href="#l23.20"></a><span id="l23.20">  * @param useDefault    If true, use the default identity of the default</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineat">@@ -447,21 +451,29 @@ function SaveAsTemplate(uri) {</span>
<a href="#l23.22"></a><span id="l23.22">         return;</span>
<a href="#l23.23"></a><span id="l23.23">     }</span>
<a href="#l23.24"></a><span id="l23.24">     messenger.saveAs(uri, false, identity, null);</span>
<a href="#l23.25"></a><span id="l23.25">   }</span>
<a href="#l23.26"></a><span id="l23.26"> }</span>
<a href="#l23.27"></a><span id="l23.27"> </span>
<a href="#l23.28"></a><span id="l23.28"> function MarkSelectedMessagesRead(markRead) {</span>
<a href="#l23.29"></a><span id="l23.29">   ClearPendingReadTimer();</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">-  gDBView.doCommand(markRead ? nsMsgViewCommandType.markMessagesRead : nsMsgViewCommandType.markMessagesUnread);</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineplus">+  gDBView.doCommand(</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+    markRead ?</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineplus">+    Ci.nsMsgViewCommandType.markMessagesRead :</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+    Ci.nsMsgViewCommandType.markMessagesUnread</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+  );</span>
<a href="#l23.36"></a><span id="l23.36"> }</span>
<a href="#l23.37"></a><span id="l23.37"> </span>
<a href="#l23.38"></a><span id="l23.38"> function MarkSelectedMessagesFlagged(markFlagged) {</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineminus">-  gDBView.doCommand(markFlagged ? nsMsgViewCommandType.flagMessages : nsMsgViewCommandType.unflagMessages);</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineplus">+  gDBView.doCommand(</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineplus">+    markFlagged ?</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineplus">+    Ci.nsMsgViewCommandType.flagMessages :</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineplus">+    Ci.nsMsgViewCommandType.unflagMessages</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineplus">+  );</span>
<a href="#l23.45"></a><span id="l23.45"> }</span>
<a href="#l23.46"></a><span id="l23.46"> </span>
<a href="#l23.47"></a><span id="l23.47"> function ViewPageSource(messages) {</span>
<a href="#l23.48"></a><span id="l23.48">   var numMessages = messages.length;</span>
<a href="#l23.49"></a><span id="l23.49"> </span>
<a href="#l23.50"></a><span id="l23.50">   if (numMessages == 0) {</span>
<a href="#l23.51"></a><span id="l23.51">     dump(&quot;MsgViewPageSource(): No messages selected.\n&quot;);</span>
<a href="#l23.52"></a><span id="l23.52">     return false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/base/content/mailContextMenus.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/base/content/mailContextMenus.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -1,12 +1,17 @@</span>
<a href="#l24.4"></a><span id="l24.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.5"></a><span id="l24.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l24.6"></a><span id="l24.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineplus">+/* import-globals-from nsContextMenu.js */</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+</span>
<a href="#l24.13"></a><span id="l24.13"> ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l24.14"></a><span id="l24.14"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l24.15"></a><span id="l24.15"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17"> var mailtolength = 7;</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19"> /**</span>
<a href="#l24.20"></a><span id="l24.20">  * Function to change the highlighted row back to the row that is currently</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/base/content/mailCore.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/base/content/mailCore.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -7,16 +7,21 @@</span>
<a href="#l25.4"></a><span id="l25.4">  * Core mail routines used by all of the major mail windows (address book,</span>
<a href="#l25.5"></a><span id="l25.5">  * 3-pane, compose and stand alone message window).</span>
<a href="#l25.6"></a><span id="l25.6">  * Routines to support custom toolbars in mail windows, opening up a new window</span>
<a href="#l25.7"></a><span id="l25.7">  * of a particular type all live here.</span>
<a href="#l25.8"></a><span id="l25.8">  * Before adding to this file, ask yourself, is this a JS routine that is going</span>
<a href="#l25.9"></a><span id="l25.9">  * to be used by all of the main mail windows?</span>
<a href="#l25.10"></a><span id="l25.10">  */</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+/* import-globals-from ../../../common/src/customizeToolbar.js */</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+/* import-globals-from ../../extensions/mailviews/content/msgViewPickerOverlay.js */</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+</span>
<a href="#l25.17"></a><span id="l25.17"> ChromeUtils.import(&quot;resource://gre/modules/BrowserUtils.jsm&quot;);</span>
<a href="#l25.18"></a><span id="l25.18"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l25.19"></a><span id="l25.19"> ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l25.20"></a><span id="l25.20"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l25.21"></a><span id="l25.21"> ChromeUtils.import(&quot;resource://gre/modules/CharsetMenu.jsm&quot;);</span>
<a href="#l25.22"></a><span id="l25.22"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l25.23"></a><span id="l25.23"> </span>
<a href="#l25.24"></a><span id="l25.24"> XPCOMUtils.defineLazyGetter(this, &quot;gViewSourceUtils&quot;, function() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/base/content/mailTabs.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/base/content/mailTabs.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -1,16 +1,25 @@</span>
<a href="#l26.4"></a><span id="l26.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l26.5"></a><span id="l26.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l26.6"></a><span id="l26.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineplus">+/* import-globals-from mail3PaneWindowCommands.js */</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineplus">+/* import-globals-from mailContextMenus.js */</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineplus">+/* import-globals-from mailWindowOverlay.js */</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+/* import-globals-from messageDisplay.js */</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+/* import-globals-from msgMail3PaneWindow.js */</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+</span>
<a href="#l26.15"></a><span id="l26.15"> ChromeUtils.import(&quot;resource:///modules/MsgHdrSyntheticView.jsm&quot;);</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;);</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+var { logException } = ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;, null);</span>
<a href="#l26.18"></a><span id="l26.18"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l26.19"></a><span id="l26.19"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+var { getSpecialFolderString } = ChromeUtils.import(&quot;resource:///modules/folderUtils.jsm&quot;, null);</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineplus">+var { MsgHdrToMimeMessage } = ChromeUtils.import(&quot;resource:///modules/gloda/mimemsg.js&quot;, null);</span>
<a href="#l26.22"></a><span id="l26.22"> </span>
<a href="#l26.23"></a><span id="l26.23"> /**</span>
<a href="#l26.24"></a><span id="l26.24">  * Displays message &quot;folder&quot;s, mail &quot;message&quot;s, and &quot;glodaList&quot; results.  The</span>
<a href="#l26.25"></a><span id="l26.25">  *  commonality is that they all use the &quot;mailContent&quot; panel's folder tree,</span>
<a href="#l26.26"></a><span id="l26.26">  *  thread tree, and message pane objects.  This happens for historical reasons,</span>
<a href="#l26.27"></a><span id="l26.27">  *  likely involving the fact that prior to the introduction of this</span>
<a href="#l26.28"></a><span id="l26.28">  *  abstraction, everything was always stored in global objects.  For the 3.0</span>
<a href="#l26.29"></a><span id="l26.29">  *  release cycle we considered avoiding this 'multiplexed' style of operation</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1,13 +1,17 @@</span>
<a href="#l27.4"></a><span id="l27.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l27.5"></a><span id="l27.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l27.6"></a><span id="l27.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l27.7"></a><span id="l27.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9" class="difflineplus">+&lt;!-- globals fillInTags // mailWidgets.xml --&gt;</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineplus">+&lt;!-- import-globals-from ../../../mailnews/base/content/dateFormat.js --&gt;</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineplus">+&lt;!-- import-globals-from mailWindow.js --&gt;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+&lt;!-- import-globals-from SearchDialog.js --&gt;</span>
<a href="#l27.13"></a><span id="l27.13"> </span>
<a href="#l27.14"></a><span id="l27.14"> &lt;!DOCTYPE bindings [</span>
<a href="#l27.15"></a><span id="l27.15"> &lt;!ENTITY % msgHdrViewOverlayDTD SYSTEM &quot;chrome://messenger/locale/msgHdrViewOverlay.dtd&quot; &gt;</span>
<a href="#l27.16"></a><span id="l27.16"> %msgHdrViewOverlayDTD;</span>
<a href="#l27.17"></a><span id="l27.17"> &lt;!ENTITY % messengerDTD SYSTEM &quot;chrome://messenger/locale/messenger.dtd&quot; &gt;</span>
<a href="#l27.18"></a><span id="l27.18"> %messengerDTD;</span>
<a href="#l27.19"></a><span id="l27.19"> ]&gt;</span>
<a href="#l27.20"></a><span id="l27.20"> </span>
<a href="#l27.21"></a><span id="l27.21" class="difflineat">@@ -1930,17 +1934,17 @@</span>
<a href="#l27.22"></a><span id="l27.22">                   index = 0;</span>
<a href="#l27.23"></a><span id="l27.23">                   break;</span>
<a href="#l27.24"></a><span id="l27.24">                 case event.DOM_VK_END:</span>
<a href="#l27.25"></a><span id="l27.25">                   index = box.view.rowCount - 1;</span>
<a href="#l27.26"></a><span id="l27.26">                   break;</span>
<a href="#l27.27"></a><span id="l27.27">                 default:</span>
<a href="#l27.28"></a><span id="l27.28">                   if (event.charCode &gt; 0 &amp;&amp; !event.ctrlKey &amp;&amp; !event.metaKey) {</span>
<a href="#l27.29"></a><span id="l27.29">                     event.preventDefault();</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineminus">-                    index = tree.keyNavigate(event);</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+                    index = this.tree.keyNavigate(event);</span>
<a href="#l27.32"></a><span id="l27.32">                     if (index &gt;= 0)</span>
<a href="#l27.33"></a><span id="l27.33">                       break;</span>
<a href="#l27.34"></a><span id="l27.34">                   }</span>
<a href="#l27.35"></a><span id="l27.35">                   return;</span>
<a href="#l27.36"></a><span id="l27.36">               }</span>
<a href="#l27.37"></a><span id="l27.37">               box.view.selection.select(index);</span>
<a href="#l27.38"></a><span id="l27.38">               if (this.parentNode.hasAttribute(&quot;open&quot;))</span>
<a href="#l27.39"></a><span id="l27.39">                 box.ensureRowIsVisible(index);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/base/content/mailWindow.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/base/content/mailWindow.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1,20 +1,31 @@</span>
<a href="#l28.4"></a><span id="l28.4"> /**</span>
<a href="#l28.5"></a><span id="l28.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l28.6"></a><span id="l28.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l28.7"></a><span id="l28.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9" class="difflineplus">+/* import-globals-from ../../../../toolkit/content/contentAreaUtils.js */</span>
<a href="#l28.10"></a><span id="l28.10" class="difflineplus">+/* import-globals-from ../../../../toolkit/content/globalOverlay.js */</span>
<a href="#l28.11"></a><span id="l28.11" class="difflineplus">+/* import-globals-from ../../../../toolkit/content/viewZoomOverlay.js */</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+/* import-globals-from mail-offline.js */</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+/* import-globals-from mailCore.js */</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+/* import-globals-from mailWindowOverlay.js */</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+/* import-globals-from msgHdrView.js */</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineplus">+/* import-globals-from msgMail3PaneWindow.js */</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineplus">+/* import-globals-from utilityOverlay.js */</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+</span>
<a href="#l28.20"></a><span id="l28.20"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l28.21"></a><span id="l28.21"> ChromeUtils.import(&quot;resource:///modules/appIdleManager.js&quot;);</span>
<a href="#l28.22"></a><span id="l28.22"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l28.23"></a><span id="l28.23"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l28.24"></a><span id="l28.24"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/log4moz.js&quot;);</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/public.js&quot;);</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineplus">+var { Log4Moz } = ChromeUtils.import(&quot;resource:///modules/gloda/log4moz.js&quot;, null);</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineplus">+var { Gloda } = ChromeUtils.import(&quot;resource:///modules/gloda/public.js&quot;, null);</span>
<a href="#l28.29"></a><span id="l28.29"> </span>
<a href="#l28.30"></a><span id="l28.30"> // This file stores variables common to mail windows</span>
<a href="#l28.31"></a><span id="l28.31"> var messenger;</span>
<a href="#l28.32"></a><span id="l28.32"> var statusFeedback;</span>
<a href="#l28.33"></a><span id="l28.33"> var msgWindow;</span>
<a href="#l28.34"></a><span id="l28.34"> </span>
<a href="#l28.35"></a><span id="l28.35"> var accountManager;</span>
<a href="#l28.36"></a><span id="l28.36"> </span>
<a href="#l28.37"></a><span id="l28.37" class="difflineat">@@ -658,17 +669,17 @@ nsBrowserAccess.prototype = {</span>
<a href="#l28.38"></a><span id="l28.38">     if (!win)</span>
<a href="#l28.39"></a><span id="l28.39">       throw new Error(&quot;Couldn't get a suitable window for openURI&quot;);</span>
<a href="#l28.40"></a><span id="l28.40"> </span>
<a href="#l28.41"></a><span id="l28.41">     let loadInBackground =</span>
<a href="#l28.42"></a><span id="l28.42">       Services.prefs.getBoolPref(&quot;browser.tabs.loadDivertedInBackground&quot;);</span>
<a href="#l28.43"></a><span id="l28.43"> </span>
<a href="#l28.44"></a><span id="l28.44">     let tabmail = win.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l28.45"></a><span id="l28.45">     let clickHandler = null;</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineminus">-    let browser = tabmail.getBrowserForDocument(content);</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineplus">+    let browser = tabmail.getBrowserForDocument(window.content);</span>
<a href="#l28.48"></a><span id="l28.48">     if (browser)</span>
<a href="#l28.49"></a><span id="l28.49">       clickHandler = browser.clickHandler;</span>
<a href="#l28.50"></a><span id="l28.50"> </span>
<a href="#l28.51"></a><span id="l28.51">     let newTab = tabmail.openTab(&quot;contentTab&quot;, {contentPage: &quot;about:blank&quot;,</span>
<a href="#l28.52"></a><span id="l28.52">                                                 background: loadInBackground,</span>
<a href="#l28.53"></a><span id="l28.53">                                                 clickHandler});</span>
<a href="#l28.54"></a><span id="l28.54"> </span>
<a href="#l28.55"></a><span id="l28.55">     newWindow = newTab.browser.docShell.domWindow;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -1,21 +1,33 @@</span>
<a href="#l29.4"></a><span id="l29.4"> /* -*- indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l29.5"></a><span id="l29.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l29.6"></a><span id="l29.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l29.7"></a><span id="l29.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l29.8"></a><span id="l29.8"> </span>
<a href="#l29.9"></a><span id="l29.9" class="difflineplus">+/* import-globals-from ../../../mailnews/base/content/junkCommands.js */</span>
<a href="#l29.10"></a><span id="l29.10" class="difflineplus">+/* import-globals-from ../../../mailnews/extensions/newsblog/content/newsblogOverlay.js */</span>
<a href="#l29.11"></a><span id="l29.11" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+/* import-globals-from contentAreaClick.js */</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+/* import-globals-from mail3PaneWindowCommands.js */</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+/* import-globals-from mailCommands.js */</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+/* import-globals-from mailContextMenus.js */</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+/* import-globals-from phishingDetector.js */</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+</span>
<a href="#l29.20"></a><span id="l29.20"> ChromeUtils.import(&quot;resource:///modules/FeedUtils.jsm&quot;);</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/dbview.js&quot;);</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineplus">+var { GlodaSyntheticView } = ChromeUtils.import(&quot;resource:///modules/gloda/dbview.js&quot;, null);</span>
<a href="#l29.23"></a><span id="l29.23"> ChromeUtils.import(&quot;resource:///modules/MailConsts.jsm&quot;);</span>
<a href="#l29.24"></a><span id="l29.24"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l29.25"></a><span id="l29.25"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l29.26"></a><span id="l29.26"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l29.27"></a><span id="l29.27"> ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l29.28"></a><span id="l29.28"> ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineplus">+ChromeUtils.import(&quot;resource://gre/modules/AddonManager.jsm&quot;);</span>
<a href="#l29.30"></a><span id="l29.30"> </span>
<a href="#l29.31"></a><span id="l29.31"> ChromeUtils.defineModuleGetter(this, &quot;BrowserToolboxProcess&quot;, &quot;resource://devtools/client/framework/ToolboxProcess.jsm&quot;);</span>
<a href="#l29.32"></a><span id="l29.32"> ChromeUtils.defineModuleGetter(this, &quot;ScratchpadManager&quot;, &quot;resource://devtools/client/scratchpad/scratchpad-manager.jsm&quot;);</span>
<a href="#l29.33"></a><span id="l29.33"> ChromeUtils.defineModuleGetter(this, &quot;ExtensionParent&quot;, &quot;resource://gre/modules/ExtensionParent.jsm&quot;);</span>
<a href="#l29.34"></a><span id="l29.34"> ChromeUtils.defineModuleGetter(this, &quot;ExtensionSupport&quot;, &quot;resource:///modules/extensionSupport.jsm&quot;);</span>
<a href="#l29.35"></a><span id="l29.35"> Object.defineProperty(this, &quot;HUDService&quot;, {</span>
<a href="#l29.36"></a><span id="l29.36">   get() {</span>
<a href="#l29.37"></a><span id="l29.37">     let { devtools } = ChromeUtils.import(&quot;resource://devtools/shared/Loader.jsm&quot;, null);</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineat">@@ -304,37 +316,37 @@ function setSortByMenuItemCheckState(id,</span>
<a href="#l29.39"></a><span id="l29.39"> </span>
<a href="#l29.40"></a><span id="l29.40"> /**</span>
<a href="#l29.41"></a><span id="l29.41">  * Called when showing the menu_viewSortPopup menupopup, so it should always</span>
<a href="#l29.42"></a><span id="l29.42">  * be up-to-date.</span>
<a href="#l29.43"></a><span id="l29.43">  */</span>
<a href="#l29.44"></a><span id="l29.44"> function InitViewSortByMenu() {</span>
<a href="#l29.45"></a><span id="l29.45">   var sortType = gFolderDisplay.view.primarySortType;</span>
<a href="#l29.46"></a><span id="l29.46"> </span>
<a href="#l29.47"></a><span id="l29.47" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByDateMenuitem&quot;, (sortType == nsMsgViewSortType.byDate));</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByReceivedMenuitem&quot;, (sortType == nsMsgViewSortType.byReceived));</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByFlagMenuitem&quot;, (sortType == nsMsgViewSortType.byFlagged));</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByOrderReceivedMenuitem&quot;, (sortType == nsMsgViewSortType.byId));</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByPriorityMenuitem&quot;, (sortType == nsMsgViewSortType.byPriority));</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortBySizeMenuitem&quot;, (sortType == nsMsgViewSortType.bySize));</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByStatusMenuitem&quot;, (sortType == nsMsgViewSortType.byStatus));</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortBySubjectMenuitem&quot;, (sortType == nsMsgViewSortType.bySubject));</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByUnreadMenuitem&quot;, (sortType == nsMsgViewSortType.byUnread));</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByTagsMenuitem&quot;, (sortType == nsMsgViewSortType.byTags));</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByJunkStatusMenuitem&quot;, (sortType == nsMsgViewSortType.byJunkStatus));</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByFromMenuitem&quot;, (sortType == nsMsgViewSortType.byAuthor));</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByRecipientMenuitem&quot;, (sortType == nsMsgViewSortType.byRecipient));</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByAttachmentsMenuitem&quot;, (sortType == nsMsgViewSortType.byAttachments));</span>
<a href="#l29.61"></a><span id="l29.61" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortByCorrespondentMenuitem&quot;, (sortType == nsMsgViewSortType.byCorrespondent));</span>
<a href="#l29.62"></a><span id="l29.62" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByDateMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byDate));</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByReceivedMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byReceived));</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByFlagMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byFlagged));</span>
<a href="#l29.65"></a><span id="l29.65" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByOrderReceivedMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byId));</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByPriorityMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byPriority));</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortBySizeMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.bySize));</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByStatusMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byStatus));</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortBySubjectMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.bySubject));</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByUnreadMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byUnread));</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByTagsMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byTags));</span>
<a href="#l29.72"></a><span id="l29.72" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByJunkStatusMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byJunkStatus));</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByFromMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byAuthor));</span>
<a href="#l29.74"></a><span id="l29.74" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByRecipientMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byRecipient));</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByAttachmentsMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byAttachments));</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortByCorrespondentMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byCorrespondent));</span>
<a href="#l29.77"></a><span id="l29.77"> </span>
<a href="#l29.78"></a><span id="l29.78">   var sortOrder = gFolderDisplay.view.primarySortOrder;</span>
<a href="#l29.79"></a><span id="l29.79">   var sortTypeSupportsGrouping = isSortTypeValidForGrouping(sortType);</span>
<a href="#l29.80"></a><span id="l29.80"> </span>
<a href="#l29.81"></a><span id="l29.81" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortAscending&quot;, (sortOrder == nsMsgViewSortOrder.ascending));</span>
<a href="#l29.82"></a><span id="l29.82" class="difflineminus">-  setSortByMenuItemCheckState(&quot;sortDescending&quot;, (sortOrder == nsMsgViewSortOrder.descending));</span>
<a href="#l29.83"></a><span id="l29.83" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortAscending&quot;, (sortOrder == Ci.nsMsgViewSortOrder.ascending));</span>
<a href="#l29.84"></a><span id="l29.84" class="difflineplus">+  setSortByMenuItemCheckState(&quot;sortDescending&quot;, (sortOrder == Ci.nsMsgViewSortOrder.descending));</span>
<a href="#l29.85"></a><span id="l29.85"> </span>
<a href="#l29.86"></a><span id="l29.86">   var grouped = gFolderDisplay.view.showGroupedBySort;</span>
<a href="#l29.87"></a><span id="l29.87">   var threaded = gFolderDisplay.view.showThreaded;</span>
<a href="#l29.88"></a><span id="l29.88">   var sortThreadedMenuItem = document.getElementById(&quot;sortThreaded&quot;);</span>
<a href="#l29.89"></a><span id="l29.89">   var sortUnthreadedMenuItem = document.getElementById(&quot;sortUnthreaded&quot;);</span>
<a href="#l29.90"></a><span id="l29.90"> </span>
<a href="#l29.91"></a><span id="l29.91">   sortThreadedMenuItem.setAttribute(&quot;checked&quot;, threaded);</span>
<a href="#l29.92"></a><span id="l29.92">   sortUnthreadedMenuItem.setAttribute(&quot;checked&quot;, !threaded &amp;&amp; !grouped);</span>
<a href="#l29.93"></a><span id="l29.93" class="difflineat">@@ -343,66 +355,66 @@ function InitViewSortByMenu() {</span>
<a href="#l29.94"></a><span id="l29.94"> </span>
<a href="#l29.95"></a><span id="l29.95">   groupBySortOrderMenuItem.setAttribute(&quot;disabled&quot;, !sortTypeSupportsGrouping);</span>
<a href="#l29.96"></a><span id="l29.96">   groupBySortOrderMenuItem.setAttribute(&quot;checked&quot;, grouped);</span>
<a href="#l29.97"></a><span id="l29.97"> }</span>
<a href="#l29.98"></a><span id="l29.98"> </span>
<a href="#l29.99"></a><span id="l29.99"> function InitAppViewSortByMenu() {</span>
<a href="#l29.100"></a><span id="l29.100">   let sortType = gFolderDisplay.view.primarySortType;</span>
<a href="#l29.101"></a><span id="l29.101"> </span>
<a href="#l29.102"></a><span id="l29.102" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByDateMenuitem&quot;, (sortType == nsMsgViewSortType.byDate));</span>
<a href="#l29.103"></a><span id="l29.103" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByReceivedMenuitem&quot;, (sortType == nsMsgViewSortType.byReceived));</span>
<a href="#l29.104"></a><span id="l29.104" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByFlagMenuitem&quot;, (sortType == nsMsgViewSortType.byFlagged));</span>
<a href="#l29.105"></a><span id="l29.105" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByOrderReceivedMenuitem&quot;, (sortType == nsMsgViewSortType.byId));</span>
<a href="#l29.106"></a><span id="l29.106" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByPriorityMenuitem&quot;, (sortType == nsMsgViewSortType.byPriority));</span>
<a href="#l29.107"></a><span id="l29.107" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortBySizeMenuitem&quot;, (sortType == nsMsgViewSortType.bySize));</span>
<a href="#l29.108"></a><span id="l29.108" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByStatusMenuitem&quot;, (sortType == nsMsgViewSortType.byStatus));</span>
<a href="#l29.109"></a><span id="l29.109" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortBySubjectMenuitem&quot;, (sortType == nsMsgViewSortType.bySubject));</span>
<a href="#l29.110"></a><span id="l29.110" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByUnreadMenuitem&quot;, (sortType == nsMsgViewSortType.byUnread));</span>
<a href="#l29.111"></a><span id="l29.111" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByTagsMenuitem&quot;, (sortType == nsMsgViewSortType.byTags));</span>
<a href="#l29.112"></a><span id="l29.112" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByJunkStatusMenuitem&quot;, (sortType == nsMsgViewSortType.byJunkStatus));</span>
<a href="#l29.113"></a><span id="l29.113" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByFromMenuitem&quot;, (sortType == nsMsgViewSortType.byAuthor));</span>
<a href="#l29.114"></a><span id="l29.114" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByRecipientMenuitem&quot;, (sortType == nsMsgViewSortType.byRecipient));</span>
<a href="#l29.115"></a><span id="l29.115" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortByAttachmentsMenuitem&quot;, (sortType == nsMsgViewSortType.byAttachments));</span>
<a href="#l29.116"></a><span id="l29.116" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByDateMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byDate));</span>
<a href="#l29.117"></a><span id="l29.117" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByReceivedMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byReceived));</span>
<a href="#l29.118"></a><span id="l29.118" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByFlagMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byFlagged));</span>
<a href="#l29.119"></a><span id="l29.119" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByOrderReceivedMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byId));</span>
<a href="#l29.120"></a><span id="l29.120" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByPriorityMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byPriority));</span>
<a href="#l29.121"></a><span id="l29.121" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortBySizeMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.bySize));</span>
<a href="#l29.122"></a><span id="l29.122" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByStatusMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byStatus));</span>
<a href="#l29.123"></a><span id="l29.123" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortBySubjectMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.bySubject));</span>
<a href="#l29.124"></a><span id="l29.124" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByUnreadMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byUnread));</span>
<a href="#l29.125"></a><span id="l29.125" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByTagsMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byTags));</span>
<a href="#l29.126"></a><span id="l29.126" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByJunkStatusMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byJunkStatus));</span>
<a href="#l29.127"></a><span id="l29.127" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByFromMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byAuthor));</span>
<a href="#l29.128"></a><span id="l29.128" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByRecipientMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byRecipient));</span>
<a href="#l29.129"></a><span id="l29.129" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortByAttachmentsMenuitem&quot;, (sortType == Ci.nsMsgViewSortType.byAttachments));</span>
<a href="#l29.130"></a><span id="l29.130"> </span>
<a href="#l29.131"></a><span id="l29.131">   let sortOrder = gFolderDisplay.view.primarySortOrder;</span>
<a href="#l29.132"></a><span id="l29.132">   let sortTypeSupportsGrouping = isSortTypeValidForGrouping(sortType);</span>
<a href="#l29.133"></a><span id="l29.133"> </span>
<a href="#l29.134"></a><span id="l29.134" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortAscending&quot;, (sortOrder == nsMsgViewSortOrder.ascending));</span>
<a href="#l29.135"></a><span id="l29.135" class="difflineminus">-  setSortByMenuItemCheckState(&quot;appmenu_sortDescending&quot;, (sortOrder == nsMsgViewSortOrder.descending));</span>
<a href="#l29.136"></a><span id="l29.136" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortAscending&quot;, (sortOrder == Ci.nsMsgViewSortOrder.ascending));</span>
<a href="#l29.137"></a><span id="l29.137" class="difflineplus">+  setSortByMenuItemCheckState(&quot;appmenu_sortDescending&quot;, (sortOrder == Ci.nsMsgViewSortOrder.descending));</span>
<a href="#l29.138"></a><span id="l29.138"> </span>
<a href="#l29.139"></a><span id="l29.139">   let grouped = gFolderDisplay.view.showGroupedBySort;</span>
<a href="#l29.140"></a><span id="l29.140">   let threaded = gFolderDisplay.view.showThreaded;</span>
<a href="#l29.141"></a><span id="l29.141">   let sortThreadedMenuItem = document.getElementById(&quot;appmenu_sortThreaded&quot;);</span>
<a href="#l29.142"></a><span id="l29.142">   let sortUnthreadedMenuItem = document.getElementById(&quot;appmenu_sortUnthreaded&quot;);</span>
<a href="#l29.143"></a><span id="l29.143"> </span>
<a href="#l29.144"></a><span id="l29.144">   sortThreadedMenuItem.setAttribute(&quot;checked&quot;, threaded);</span>
<a href="#l29.145"></a><span id="l29.145">   sortUnthreadedMenuItem.setAttribute(&quot;checked&quot;, !threaded &amp;&amp; !grouped);</span>
<a href="#l29.146"></a><span id="l29.146"> </span>
<a href="#l29.147"></a><span id="l29.147">   let groupBySortOrderMenuItem = document.getElementById(&quot;appmenu_groupBySort&quot;);</span>
<a href="#l29.148"></a><span id="l29.148"> </span>
<a href="#l29.149"></a><span id="l29.149">   groupBySortOrderMenuItem.setAttribute(&quot;disabled&quot;, !sortTypeSupportsGrouping);</span>
<a href="#l29.150"></a><span id="l29.150">   groupBySortOrderMenuItem.setAttribute(&quot;checked&quot;, grouped);</span>
<a href="#l29.151"></a><span id="l29.151"> }</span>
<a href="#l29.152"></a><span id="l29.152"> </span>
<a href="#l29.153"></a><span id="l29.153"> function isSortTypeValidForGrouping(sortType) {</span>
<a href="#l29.154"></a><span id="l29.154" class="difflineminus">-  return Boolean(sortType == nsMsgViewSortType.byAccount ||</span>
<a href="#l29.155"></a><span id="l29.155" class="difflineminus">-                 sortType == nsMsgViewSortType.byAttachments ||</span>
<a href="#l29.156"></a><span id="l29.156" class="difflineminus">-                 sortType == nsMsgViewSortType.byAuthor ||</span>
<a href="#l29.157"></a><span id="l29.157" class="difflineminus">-                 sortType == nsMsgViewSortType.byCorrespondent ||</span>
<a href="#l29.158"></a><span id="l29.158" class="difflineminus">-                 sortType == nsMsgViewSortType.byDate ||</span>
<a href="#l29.159"></a><span id="l29.159" class="difflineminus">-                 sortType == nsMsgViewSortType.byFlagged ||</span>
<a href="#l29.160"></a><span id="l29.160" class="difflineminus">-                 sortType == nsMsgViewSortType.byLocation ||</span>
<a href="#l29.161"></a><span id="l29.161" class="difflineminus">-                 sortType == nsMsgViewSortType.byPriority ||</span>
<a href="#l29.162"></a><span id="l29.162" class="difflineminus">-                 sortType == nsMsgViewSortType.byReceived ||</span>
<a href="#l29.163"></a><span id="l29.163" class="difflineminus">-                 sortType == nsMsgViewSortType.byRecipient ||</span>
<a href="#l29.164"></a><span id="l29.164" class="difflineminus">-                 sortType == nsMsgViewSortType.byStatus ||</span>
<a href="#l29.165"></a><span id="l29.165" class="difflineminus">-                 sortType == nsMsgViewSortType.bySubject ||</span>
<a href="#l29.166"></a><span id="l29.166" class="difflineminus">-                 sortType == nsMsgViewSortType.byTags ||</span>
<a href="#l29.167"></a><span id="l29.167" class="difflineminus">-                 sortType == nsMsgViewSortType.byCustom);</span>
<a href="#l29.168"></a><span id="l29.168" class="difflineplus">+  return Boolean(sortType == Ci.nsMsgViewSortType.byAccount ||</span>
<a href="#l29.169"></a><span id="l29.169" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byAttachments ||</span>
<a href="#l29.170"></a><span id="l29.170" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byAuthor ||</span>
<a href="#l29.171"></a><span id="l29.171" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byCorrespondent ||</span>
<a href="#l29.172"></a><span id="l29.172" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byDate ||</span>
<a href="#l29.173"></a><span id="l29.173" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byFlagged ||</span>
<a href="#l29.174"></a><span id="l29.174" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byLocation ||</span>
<a href="#l29.175"></a><span id="l29.175" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byPriority ||</span>
<a href="#l29.176"></a><span id="l29.176" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byReceived ||</span>
<a href="#l29.177"></a><span id="l29.177" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byRecipient ||</span>
<a href="#l29.178"></a><span id="l29.178" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byStatus ||</span>
<a href="#l29.179"></a><span id="l29.179" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.bySubject ||</span>
<a href="#l29.180"></a><span id="l29.180" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byTags ||</span>
<a href="#l29.181"></a><span id="l29.181" class="difflineplus">+                 sortType == Ci.nsMsgViewSortType.byCustom);</span>
<a href="#l29.182"></a><span id="l29.182"> }</span>
<a href="#l29.183"></a><span id="l29.183"> </span>
<a href="#l29.184"></a><span id="l29.184"> function InitViewMessagesMenu() {</span>
<a href="#l29.185"></a><span id="l29.185">   document.getElementById(&quot;viewAllMessagesMenuItem&quot;).setAttribute(&quot;checked&quot;,</span>
<a href="#l29.186"></a><span id="l29.186">     !gFolderDisplay.view.showUnreadOnly &amp;&amp;</span>
<a href="#l29.187"></a><span id="l29.187">     !gFolderDisplay.view.specialView);</span>
<a href="#l29.188"></a><span id="l29.188"> </span>
<a href="#l29.189"></a><span id="l29.189">   document.getElementById(&quot;viewUnreadMessagesMenuItem&quot;).setAttribute(&quot;checked&quot;,</span>
<a href="#l29.190"></a><span id="l29.190" class="difflineat">@@ -1467,46 +1479,46 @@ function MsgGetNextNMessages() {</span>
<a href="#l29.191"></a><span id="l29.191"> function MsgDeleteMessage(reallyDelete, fromToolbar) {</span>
<a href="#l29.192"></a><span id="l29.192">   // If from the toolbar, return right away if this is a news message</span>
<a href="#l29.193"></a><span id="l29.193">   // only allow cancel from the menu:  &quot;Edit | Cancel / Delete Message&quot;.</span>
<a href="#l29.194"></a><span id="l29.194">   if (fromToolbar &amp;&amp; gFolderDisplay.view.isNewsFolder)</span>
<a href="#l29.195"></a><span id="l29.195">     return;</span>
<a href="#l29.196"></a><span id="l29.196"> </span>
<a href="#l29.197"></a><span id="l29.197">   gFolderDisplay.hintAboutToDeleteMessages();</span>
<a href="#l29.198"></a><span id="l29.198">   if (reallyDelete)</span>
<a href="#l29.199"></a><span id="l29.199" class="difflineminus">-    gDBView.doCommand(nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l29.200"></a><span id="l29.200" class="difflineplus">+    gDBView.doCommand(Ci.nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l29.201"></a><span id="l29.201">   else</span>
<a href="#l29.202"></a><span id="l29.202" class="difflineminus">-    gDBView.doCommand(nsMsgViewCommandType.deleteMsg);</span>
<a href="#l29.203"></a><span id="l29.203" class="difflineplus">+    gDBView.doCommand(Ci.nsMsgViewCommandType.deleteMsg);</span>
<a href="#l29.204"></a><span id="l29.204"> }</span>
<a href="#l29.205"></a><span id="l29.205"> </span>
<a href="#l29.206"></a><span id="l29.206"> /**</span>
<a href="#l29.207"></a><span id="l29.207">  * Copies the selected messages to the destination folder</span>
<a href="#l29.208"></a><span id="l29.208">  * @param aDestFolder  the destination folder</span>
<a href="#l29.209"></a><span id="l29.209">  */</span>
<a href="#l29.210"></a><span id="l29.210"> function MsgCopyMessage(aDestFolder) {</span>
<a href="#l29.211"></a><span id="l29.211">   if (gMessageDisplay.isDummy) {</span>
<a href="#l29.212"></a><span id="l29.212">     let file = window.arguments[0].QueryInterface(Ci.nsIFileURL).file;</span>
<a href="#l29.213"></a><span id="l29.213">     MailServices.copy.CopyFileMessage(file, aDestFolder, null, false,</span>
<a href="#l29.214"></a><span id="l29.214">                                       Ci.nsMsgMessageFlags.Read,</span>
<a href="#l29.215"></a><span id="l29.215">                                       &quot;&quot;, null, msgWindow);</span>
<a href="#l29.216"></a><span id="l29.216">   } else {</span>
<a href="#l29.217"></a><span id="l29.217" class="difflineminus">-    gDBView.doCommandWithFolder(nsMsgViewCommandType.copyMessages, aDestFolder);</span>
<a href="#l29.218"></a><span id="l29.218" class="difflineplus">+    gDBView.doCommandWithFolder(Ci.nsMsgViewCommandType.copyMessages, aDestFolder);</span>
<a href="#l29.219"></a><span id="l29.219">   }</span>
<a href="#l29.220"></a><span id="l29.220"> </span>
<a href="#l29.221"></a><span id="l29.221">   Services.prefs.setCharPref(&quot;mail.last_msg_movecopy_target_uri&quot;, aDestFolder.URI);</span>
<a href="#l29.222"></a><span id="l29.222">   Services.prefs.setBoolPref(&quot;mail.last_msg_movecopy_was_move&quot;, false);</span>
<a href="#l29.223"></a><span id="l29.223"> }</span>
<a href="#l29.224"></a><span id="l29.224"> </span>
<a href="#l29.225"></a><span id="l29.225"> /**</span>
<a href="#l29.226"></a><span id="l29.226">  * Moves the selected messages to the destination folder</span>
<a href="#l29.227"></a><span id="l29.227">  * @param aDestFolder  the destination folder</span>
<a href="#l29.228"></a><span id="l29.228">  */</span>
<a href="#l29.229"></a><span id="l29.229"> function MsgMoveMessage(aDestFolder) {</span>
<a href="#l29.230"></a><span id="l29.230">   gFolderDisplay.hintAboutToDeleteMessages();</span>
<a href="#l29.231"></a><span id="l29.231" class="difflineminus">-  gDBView.doCommandWithFolder(nsMsgViewCommandType.moveMessages, aDestFolder);</span>
<a href="#l29.232"></a><span id="l29.232" class="difflineplus">+  gDBView.doCommandWithFolder(Ci.nsMsgViewCommandType.moveMessages, aDestFolder);</span>
<a href="#l29.233"></a><span id="l29.233">   Services.prefs.setCharPref(&quot;mail.last_msg_movecopy_target_uri&quot;, aDestFolder.URI);</span>
<a href="#l29.234"></a><span id="l29.234">   Services.prefs.setBoolPref(&quot;mail.last_msg_movecopy_was_move&quot;, true);</span>
<a href="#l29.235"></a><span id="l29.235"> }</span>
<a href="#l29.236"></a><span id="l29.236"> </span>
<a href="#l29.237"></a><span id="l29.237"> /**</span>
<a href="#l29.238"></a><span id="l29.238">  * Calls the ComposeMessage function with the desired type, and proper default</span>
<a href="#l29.239"></a><span id="l29.239">  * based on the event that fired it.</span>
<a href="#l29.240"></a><span id="l29.240">  *</span>
<a href="#l29.241"></a><span id="l29.241" class="difflineat">@@ -2185,17 +2197,17 @@ function UpdateJunkButton() {</span>
<a href="#l29.242"></a><span id="l29.242">   // The junk message should slave off the selected message, as the preview pane</span>
<a href="#l29.243"></a><span id="l29.243">   //  may not be visible</span>
<a href="#l29.244"></a><span id="l29.244">   let hdr = gFolderDisplay.selectedMessage;</span>
<a href="#l29.245"></a><span id="l29.245">   // But only the message display knows if we are dealing with a dummy.</span>
<a href="#l29.246"></a><span id="l29.246">   if (!hdr || gMessageDisplay.isDummy) // .eml file</span>
<a href="#l29.247"></a><span id="l29.247">     return;</span>
<a href="#l29.248"></a><span id="l29.248">   let junkScore = hdr.getStringProperty(&quot;junkscore&quot;);</span>
<a href="#l29.249"></a><span id="l29.249">   let hideJunk = (junkScore == Ci.nsIJunkMailPlugin.IS_SPAM_SCORE);</span>
<a href="#l29.250"></a><span id="l29.250" class="difflineminus">-  if (!gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk))</span>
<a href="#l29.251"></a><span id="l29.251" class="difflineplus">+  if (!gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.junk))</span>
<a href="#l29.252"></a><span id="l29.252">     hideJunk = true;</span>
<a href="#l29.253"></a><span id="l29.253">   if (document.getElementById(&quot;hdrJunkButton&quot;)) {</span>
<a href="#l29.254"></a><span id="l29.254">     document.getElementById(&quot;hdrJunkButton&quot;).disabled = hideJunk;</span>
<a href="#l29.255"></a><span id="l29.255">   }</span>
<a href="#l29.256"></a><span id="l29.256"> }</span>
<a href="#l29.257"></a><span id="l29.257"> </span>
<a href="#l29.258"></a><span id="l29.258"> /**</span>
<a href="#l29.259"></a><span id="l29.259">  * Checks if the selected messages can be marked as read or unread</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mail/base/content/messageDisplay.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mail/base/content/messageDisplay.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -1,12 +1,15 @@</span>
<a href="#l30.4"></a><span id="l30.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l30.5"></a><span id="l30.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l30.6"></a><span id="l30.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l30.9"></a><span id="l30.9" class="difflineplus">+/* import-globals-from selectionsummaries.js */</span>
<a href="#l30.10"></a><span id="l30.10" class="difflineplus">+</span>
<a href="#l30.11"></a><span id="l30.11"> /**</span>
<a href="#l30.12"></a><span id="l30.12">  * Base abstraction for message display along the line of FolderDisplayWidget,</span>
<a href="#l30.13"></a><span id="l30.13">  *  but for message display.  This really only exists to keep</span>
<a href="#l30.14"></a><span id="l30.14">  *  FolderDisplayWidget manageable and free from taking on responsibility for</span>
<a href="#l30.15"></a><span id="l30.15">  *  the (different) horrors of message display.  The reality of the situation</span>
<a href="#l30.16"></a><span id="l30.16">  *  is that FolderDisplayWidget still has a lot to do with message display,</span>
<a href="#l30.17"></a><span id="l30.17">  *  and so we are just where helper logic gets to live, but the FDW still</span>
<a href="#l30.18"></a><span id="l30.18">  *  may deal with some things internally.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/base/content/messageWindow.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/base/content/messageWindow.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -1,16 +1,34 @@</span>
<a href="#l31.4"></a><span id="l31.4"> /**</span>
<a href="#l31.5"></a><span id="l31.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l31.6"></a><span id="l31.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l31.7"></a><span id="l31.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l31.8"></a><span id="l31.8"> </span>
<a href="#l31.9"></a><span id="l31.9"> /* This is where functions related to the standalone message window are kept */</span>
<a href="#l31.10"></a><span id="l31.10"> </span>
<a href="#l31.11"></a><span id="l31.11" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/jsTreeSelection.js&quot;);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+/* import-globals-from ../../../../toolkit/components/printing/content/printUtils.js */</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+/* import-globals-from ../../../../toolkit/content/viewZoomOverlay.js */</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+/* import-globals-from ../../../mailnews/base/content/junkCommands.js */</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+/* import-globals-from ../../../mailnews/base/prefs/content/accountUtils.js */</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineplus">+/* import-globals-from mail-offline.js */</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+/* import-globals-from mailCommands.js */</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineplus">+/* import-globals-from mailCore.js */</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineplus">+/* import-globals-from mailWindowOverlay.js */</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineplus">+/* import-globals-from messageDisplay.js */</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineplus">+/* import-globals-from msgHdrView.js */</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineplus">+/* import-globals-from msgViewNavigation.js */</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineplus">+/* import-globals-from nsDragAndDrop.js */</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineplus">+/* import-globals-from phishingDetector.js */</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineplus">+/* import-globals-from toolbarIconColor.js */</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineplus">+</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineplus">+var { JSTreeSelection } = ChromeUtils.import(&quot;resource:///modules/jsTreeSelection.js&quot;, null);</span>
<a href="#l31.31"></a><span id="l31.31"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l31.32"></a><span id="l31.32"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l31.33"></a><span id="l31.33"> ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l31.34"></a><span id="l31.34"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l31.35"></a><span id="l31.35"> ChromeUtils.import(&quot;resource:///modules/MsgHdrSyntheticView.jsm&quot;);</span>
<a href="#l31.36"></a><span id="l31.36"> </span>
<a href="#l31.37"></a><span id="l31.37"> // from MailNewsTypes.h</span>
<a href="#l31.38"></a><span id="l31.38"> var nsMsgKey_None = 0xFFFFFFFF;</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineat">@@ -909,29 +927,29 @@ var MessageWindowController = {</span>
<a href="#l31.40"></a><span id="l31.40">         loadedFolder = gFolderDisplay.displayedFolder;</span>
<a href="#l31.41"></a><span id="l31.41">         if (!(loadedFolder &amp;&amp; loadedFolder.server.canHaveFilters))</span>
<a href="#l31.42"></a><span id="l31.42">           return false;</span>
<a href="#l31.43"></a><span id="l31.43">       case &quot;cmd_delete&quot;:</span>
<a href="#l31.44"></a><span id="l31.44">         UpdateDeleteCommand();</span>
<a href="#l31.45"></a><span id="l31.45">         // fall through</span>
<a href="#l31.46"></a><span id="l31.46">       case &quot;button_delete&quot;:</span>
<a href="#l31.47"></a><span id="l31.47">         UpdateDeleteToolbarButton();</span>
<a href="#l31.48"></a><span id="l31.48" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.deleteMsg);</span>
<a href="#l31.49"></a><span id="l31.49" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.deleteMsg);</span>
<a href="#l31.50"></a><span id="l31.50">       case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l31.51"></a><span id="l31.51">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l31.52"></a><span id="l31.52" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l31.53"></a><span id="l31.53" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l31.54"></a><span id="l31.54">       case &quot;button_junk&quot;:</span>
<a href="#l31.55"></a><span id="l31.55">         UpdateJunkToolbarButton();</span>
<a href="#l31.56"></a><span id="l31.56">         // fall through</span>
<a href="#l31.57"></a><span id="l31.57">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l31.58"></a><span id="l31.58">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineminus">-        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk);</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineplus">+        return gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.junk);</span>
<a href="#l31.61"></a><span id="l31.61">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l31.62"></a><span id="l31.62">         return gFolderDisplay.selectedMessage &amp;&amp;</span>
<a href="#l31.63"></a><span id="l31.63" class="difflineminus">-               gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineplus">+               gFolderDisplay.getCommandStatus(Ci.nsMsgViewCommandType.runJunkControls);</span>
<a href="#l31.65"></a><span id="l31.65">       case &quot;cmd_archive&quot;:</span>
<a href="#l31.66"></a><span id="l31.66">       case &quot;button_archive&quot;:</span>
<a href="#l31.67"></a><span id="l31.67">         return gFolderDisplay.canArchiveSelectedMessages;</span>
<a href="#l31.68"></a><span id="l31.68">       case &quot;cmd_reply&quot;:</span>
<a href="#l31.69"></a><span id="l31.69">       case &quot;button_reply&quot;:</span>
<a href="#l31.70"></a><span id="l31.70">       case &quot;cmd_replyall&quot;:</span>
<a href="#l31.71"></a><span id="l31.71">       case &quot;button_replyall&quot;:</span>
<a href="#l31.72"></a><span id="l31.72">         return gFolderDisplay.selectedMessage &amp;&amp; IsReplyEnabled();</span>
<a href="#l31.73"></a><span id="l31.73" class="difflineat">@@ -1023,17 +1041,17 @@ var MessageWindowController = {</span>
<a href="#l31.74"></a><span id="l31.74">       case &quot;cmd_fullZoomToggle&quot;:</span>
<a href="#l31.75"></a><span id="l31.75">         return true;</span>
<a href="#l31.76"></a><span id="l31.76">       case &quot;button_goForward&quot;:</span>
<a href="#l31.77"></a><span id="l31.77">       case &quot;button_goBack&quot;:</span>
<a href="#l31.78"></a><span id="l31.78">       case &quot;cmd_goForward&quot;:</span>
<a href="#l31.79"></a><span id="l31.79">       case &quot;cmd_goBack&quot;:</span>
<a href="#l31.80"></a><span id="l31.80">         return gFolderDisplay.navigateStatus(</span>
<a href="#l31.81"></a><span id="l31.81">           (command == &quot;cmd_goBack&quot; || command == &quot;button_goBack&quot;) ?</span>
<a href="#l31.82"></a><span id="l31.82" class="difflineminus">-            nsMsgNavigationType.back : nsMsgNavigationType.forward);</span>
<a href="#l31.83"></a><span id="l31.83" class="difflineplus">+            Ci.nsMsgNavigationType.back : Ci.nsMsgNavigationType.forward);</span>
<a href="#l31.84"></a><span id="l31.84">       case &quot;cmd_search&quot;:</span>
<a href="#l31.85"></a><span id="l31.85">         loadedFolder = gFolderDisplay.displayedFolder;</span>
<a href="#l31.86"></a><span id="l31.86">         if (!loadedFolder)</span>
<a href="#l31.87"></a><span id="l31.87">           return false;</span>
<a href="#l31.88"></a><span id="l31.88">         return loadedFolder.server.canSearchMessages;</span>
<a href="#l31.89"></a><span id="l31.89">       case &quot;cmd_undo&quot;:</span>
<a href="#l31.90"></a><span id="l31.90">       case &quot;cmd_redo&quot;:</span>
<a href="#l31.91"></a><span id="l31.91">         return SetupUndoRedoCommand(command);</span>
<a href="#l31.92"></a><span id="l31.92" class="difflineat">@@ -1133,22 +1151,22 @@ var MessageWindowController = {</span>
<a href="#l31.93"></a><span id="l31.93">         break;</span>
<a href="#l31.94"></a><span id="l31.94">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l31.95"></a><span id="l31.95">         break;// This does nothing because the createfilter is invoked from the popupnode oncommand.</span>
<a href="#l31.96"></a><span id="l31.96">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l31.97"></a><span id="l31.97">         MsgCreateFilter();</span>
<a href="#l31.98"></a><span id="l31.98">         break;</span>
<a href="#l31.99"></a><span id="l31.99">       case &quot;button_delete&quot;:</span>
<a href="#l31.100"></a><span id="l31.100">       case &quot;cmd_delete&quot;:</span>
<a href="#l31.101"></a><span id="l31.101" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.deleteMsg);</span>
<a href="#l31.102"></a><span id="l31.102" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.deleteMsg);</span>
<a href="#l31.103"></a><span id="l31.103">         UpdateDeleteToolbarButton();</span>
<a href="#l31.104"></a><span id="l31.104">         break;</span>
<a href="#l31.105"></a><span id="l31.105">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l31.106"></a><span id="l31.106">       case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l31.107"></a><span id="l31.107" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l31.108"></a><span id="l31.108" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.deleteNoTrash);</span>
<a href="#l31.109"></a><span id="l31.109">         UpdateDeleteToolbarButton();</span>
<a href="#l31.110"></a><span id="l31.110">         break;</span>
<a href="#l31.111"></a><span id="l31.111">       case &quot;button_junk&quot;:</span>
<a href="#l31.112"></a><span id="l31.112">         MsgJunk();</span>
<a href="#l31.113"></a><span id="l31.113">         break;</span>
<a href="#l31.114"></a><span id="l31.114">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l31.115"></a><span id="l31.115">         PrintUtils.showPageSetup();</span>
<a href="#l31.116"></a><span id="l31.116">         break;</span>
<a href="#l31.117"></a><span id="l31.117" class="difflineat">@@ -1212,17 +1230,17 @@ var MessageWindowController = {</span>
<a href="#l31.118"></a><span id="l31.118">       case &quot;cmd_markAsRead&quot;:</span>
<a href="#l31.119"></a><span id="l31.119">         MsgMarkMsgAsRead(true);</span>
<a href="#l31.120"></a><span id="l31.120">         return;</span>
<a href="#l31.121"></a><span id="l31.121">       case &quot;cmd_markAsUnread&quot;:</span>
<a href="#l31.122"></a><span id="l31.122">         MsgMarkMsgAsRead(false);</span>
<a href="#l31.123"></a><span id="l31.123">         return;</span>
<a href="#l31.124"></a><span id="l31.124">       case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l31.125"></a><span id="l31.125">         ClearPendingReadTimer();</span>
<a href="#l31.126"></a><span id="l31.126" class="difflineminus">-        gFolderDisplay.doCommand(nsMsgViewCommandType.markThreadRead);</span>
<a href="#l31.127"></a><span id="l31.127" class="difflineplus">+        gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.markThreadRead);</span>
<a href="#l31.128"></a><span id="l31.128">         return;</span>
<a href="#l31.129"></a><span id="l31.129">       case &quot;cmd_markAllRead&quot;:</span>
<a href="#l31.130"></a><span id="l31.130">         MsgMarkAllRead();  // Won't run since always disabled.</span>
<a href="#l31.131"></a><span id="l31.131">         return;</span>
<a href="#l31.132"></a><span id="l31.132">       case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l31.133"></a><span id="l31.133">         MsgMarkReadByDate();</span>
<a href="#l31.134"></a><span id="l31.134">         return;</span>
<a href="#l31.135"></a><span id="l31.135">       case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l31.136"></a><span id="l31.136" class="difflineat">@@ -1240,58 +1258,58 @@ var MessageWindowController = {</span>
<a href="#l31.137"></a><span id="l31.137">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l31.138"></a><span id="l31.138">         JunkSelectedMessages(false);</span>
<a href="#l31.139"></a><span id="l31.139">         return;</span>
<a href="#l31.140"></a><span id="l31.140">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l31.141"></a><span id="l31.141">         analyzeMessagesForJunk();</span>
<a href="#l31.142"></a><span id="l31.142">         return;</span>
<a href="#l31.143"></a><span id="l31.143">       case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l31.144"></a><span id="l31.144">         gFolderDisplay.doCommand(</span>
<a href="#l31.145"></a><span id="l31.145" class="difflineminus">-          nsMsgViewCommandType.downloadFlaggedForOffline);</span>
<a href="#l31.146"></a><span id="l31.146" class="difflineplus">+          Ci.nsMsgViewCommandType.downloadFlaggedForOffline);</span>
<a href="#l31.147"></a><span id="l31.147">         return;</span>
<a href="#l31.148"></a><span id="l31.148">       case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l31.149"></a><span id="l31.149">         gFolderDisplay.doCommand(</span>
<a href="#l31.150"></a><span id="l31.150" class="difflineminus">-          nsMsgViewCommandType.downloadSelectedForOffline);</span>
<a href="#l31.151"></a><span id="l31.151" class="difflineplus">+          Ci.nsMsgViewCommandType.downloadSelectedForOffline);</span>
<a href="#l31.152"></a><span id="l31.152">         return;</span>
<a href="#l31.153"></a><span id="l31.153">       case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l31.154"></a><span id="l31.154">         MsgSynchronizeOffline();</span>
<a href="#l31.155"></a><span id="l31.155">         return;</span>
<a href="#l31.156"></a><span id="l31.156">       case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l31.157"></a><span id="l31.157">         MailOfflineMgr.openOfflineAccountSettings();</span>
<a href="#l31.158"></a><span id="l31.158">         return;</span>
<a href="#l31.159"></a><span id="l31.159">       case &quot;button_next&quot;:</span>
<a href="#l31.160"></a><span id="l31.160">       case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l31.161"></a><span id="l31.161" class="difflineminus">-        performNavigation(nsMsgNavigationType.nextUnreadMessage);</span>
<a href="#l31.162"></a><span id="l31.162" class="difflineplus">+        performNavigation(Ci.nsMsgNavigationType.nextUnreadMessage);</span>
<a href="#l31.163"></a><span id="l31.163">         break;</span>
<a href="#l31.164"></a><span id="l31.164">       case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l31.165"></a><span id="l31.165" class="difflineminus">-        performNavigation(nsMsgNavigationType.nextUnreadThread);</span>
<a href="#l31.166"></a><span id="l31.166" class="difflineplus">+        performNavigation(Ci.nsMsgNavigationType.nextUnreadThread);</span>
<a href="#l31.167"></a><span id="l31.167">         break;</span>
<a href="#l31.168"></a><span id="l31.168">       case &quot;button_nextMsg&quot;:</span>
<a href="#l31.169"></a><span id="l31.169">       case &quot;cmd_nextMsg&quot;:</span>
<a href="#l31.170"></a><span id="l31.170" class="difflineminus">-        performNavigation(nsMsgNavigationType.nextMessage);</span>
<a href="#l31.171"></a><span id="l31.171" class="difflineplus">+        performNavigation(Ci.nsMsgNavigationType.nextMessage);</span>
<a href="#l31.172"></a><span id="l31.172">         break;</span>
<a href="#l31.173"></a><span id="l31.173">       case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l31.174"></a><span id="l31.174" class="difflineminus">-        performNavigation(nsMsgNavigationType.nextFlagged);</span>
<a href="#l31.175"></a><span id="l31.175" class="difflineplus">+        performNavigation(Ci.nsMsgNavigationType.nextFlagged);</span>
<a href="#l31.176"></a><span id="l31.176">         break;</span>
<a href="#l31.177"></a><span id="l31.177">       case &quot;button_previousMsg&quot;:</span>
<a href="#l31.178"></a><span id="l31.178">       case &quot;cmd_previousMsg&quot;:</span>
<a href="#l31.179"></a><span id="l31.179" class="difflineminus">-        performNavigation(nsMsgNavigationType.previousMessage);</span>
<a href="#l31.180"></a><span id="l31.180" class="difflineplus">+        performNavigation(Ci.nsMsgNavigationType.previousMessage);</span>
<a href="#l31.181"></a><span id="l31.181">         break;</span>
<a href="#l31.182"></a><span id="l31.182">       case &quot;button_previous&quot;:</span>
<a href="#l31.183"></a><span id="l31.183">       case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l31.184"></a><span id="l31.184" class="difflineminus">-        performNavigation(nsMsgNavigationType.previousUnreadMessage);</span>
<a href="#l31.185"></a><span id="l31.185" class="difflineplus">+        performNavigation(Ci.nsMsgNavigationType.previousUnreadMessage);</span>
<a href="#l31.186"></a><span id="l31.186">         break;</span>
<a href="#l31.187"></a><span id="l31.187">       case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l31.188"></a><span id="l31.188" class="difflineminus">-        performNavigation(nsMsgNavigationType.previousFlagged);</span>
<a href="#l31.189"></a><span id="l31.189" class="difflineplus">+        performNavigation(Ci.nsMsgNavigationType.previousFlagged);</span>
<a href="#l31.190"></a><span id="l31.190">         break;</span>
<a href="#l31.191"></a><span id="l31.191">       case &quot;cmd_goForward&quot;:</span>
<a href="#l31.192"></a><span id="l31.192" class="difflineminus">-        performNavigation(nsMsgNavigationType.forward);</span>
<a href="#l31.193"></a><span id="l31.193" class="difflineplus">+        performNavigation(Ci.nsMsgNavigationType.forward);</span>
<a href="#l31.194"></a><span id="l31.194">         break;</span>
<a href="#l31.195"></a><span id="l31.195">       case &quot;cmd_goBack&quot;:</span>
<a href="#l31.196"></a><span id="l31.196" class="difflineminus">-        performNavigation(nsMsgNavigationType.back);</span>
<a href="#l31.197"></a><span id="l31.197" class="difflineplus">+        performNavigation(Ci.nsMsgNavigationType.back);</span>
<a href="#l31.198"></a><span id="l31.198">         break;</span>
<a href="#l31.199"></a><span id="l31.199">       case &quot;cmd_applyFiltersToSelection&quot;:</span>
<a href="#l31.200"></a><span id="l31.200">         MsgApplyFiltersToSelection();</span>
<a href="#l31.201"></a><span id="l31.201">         break;</span>
<a href="#l31.202"></a><span id="l31.202">       case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l31.203"></a><span id="l31.203">         ZoomManager.reduce();</span>
<a href="#l31.204"></a><span id="l31.204">         break;</span>
<a href="#l31.205"></a><span id="l31.205">       case &quot;cmd_fullZoomEnlarge&quot;:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/base/content/msgHdrView.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/base/content/msgHdrView.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -2,21 +2,27 @@</span>
<a href="#l32.4"></a><span id="l32.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l32.5"></a><span id="l32.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7"> /**</span>
<a href="#l32.8"></a><span id="l32.8">  * Functions related to displaying the headers for a selected message in the</span>
<a href="#l32.9"></a><span id="l32.9">  * message pane.</span>
<a href="#l32.10"></a><span id="l32.10">  */</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+/* import-globals-from editContactPanel.js */</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+/* import-globals-from messageDisplay.js */</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+/* import-globals-from nsDragAndDrop.js */</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineplus">+</span>
<a href="#l32.18"></a><span id="l32.18"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l32.19"></a><span id="l32.19"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l32.20"></a><span id="l32.20"> ChromeUtils.import(&quot;resource:///modules/DisplayNameUtils.jsm&quot;);</span>
<a href="#l32.21"></a><span id="l32.21"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/utils.js&quot;);</span>
<a href="#l32.23"></a><span id="l32.23" class="difflineplus">+var { GlodaUtils } = ChromeUtils.import(&quot;resource:///modules/gloda/utils.js&quot;, null);</span>
<a href="#l32.24"></a><span id="l32.24"> var {</span>
<a href="#l32.25"></a><span id="l32.25">   Status: statusUtils,</span>
<a href="#l32.26"></a><span id="l32.26"> } = ChromeUtils.import(&quot;resource:///modules/imStatusUtils.jsm&quot;, null);</span>
<a href="#l32.27"></a><span id="l32.27"> </span>
<a href="#l32.28"></a><span id="l32.28"> // Warning: It's critical that the code in here for displaying the message</span>
<a href="#l32.29"></a><span id="l32.29"> // headers for a selected message remain as fast as possible. In particular,</span>
<a href="#l32.30"></a><span id="l32.30"> // right now, we only introduce one reflow per message. i.e. if you click on</span>
<a href="#l32.31"></a><span id="l32.31"> // a message in the thread pane, we batch up all the changes for displaying</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -1,16 +1,34 @@</span>
<a href="#l33.4"></a><span id="l33.4"> /**</span>
<a href="#l33.5"></a><span id="l33.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l33.6"></a><span id="l33.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l33.7"></a><span id="l33.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l33.8"></a><span id="l33.8"> </span>
<a href="#l33.9"></a><span id="l33.9" class="difflineplus">+/* import-globals-from ../../../../toolkit/modules/PageMenu.jsm */</span>
<a href="#l33.10"></a><span id="l33.10" class="difflineplus">+/* import-globals-from ../../../mailnews/base/prefs/content/accountUtils.js */</span>
<a href="#l33.11"></a><span id="l33.11" class="difflineplus">+/* import-globals-from ../../../mailnews/base/util/mailnewsMigrator.js */</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+/* import-globals-from ../../components/newmailaccount/content/accountProvisionerTab.js */</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+/* import-globals-from ../../components/preferences/preferencesTab.js */</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineplus">+/* import-globals-from folderPane.js */</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineplus">+/* import-globals-from glodaFacetTab.js */</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineplus">+/* import-globals-from mail-compacttheme.js */</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineplus">+/* import-globals-from mailTabs.js */</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineplus">+/* import-globals-from plugins.js */</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineplus">+/* import-globals-from quickFilterBar.js */</span>
<a href="#l33.23"></a><span id="l33.23" class="difflineplus">+/* import-globals-from searchBar.js */</span>
<a href="#l33.24"></a><span id="l33.24" class="difflineplus">+/* import-globals-from searchBar.js */</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineplus">+/* import-globals-from specialTabs.js */</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineplus">+/* import-globals-from toolbarIconColor.js */</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineplus">+</span>
<a href="#l33.28"></a><span id="l33.28"> ChromeUtils.import(&quot;resource:///modules/activity/activityModules.jsm&quot;);</span>
<a href="#l33.29"></a><span id="l33.29"> var { logException } = ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;, null);</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/folderUtils.jsm&quot;);</span>
<a href="#l33.31"></a><span id="l33.31"> ChromeUtils.import(&quot;resource:///modules/IOUtils.js&quot;);</span>
<a href="#l33.32"></a><span id="l33.32"> var { JSTreeSelection } = ChromeUtils.import(&quot;resource:///modules/jsTreeSelection.js&quot;, null);</span>
<a href="#l33.33"></a><span id="l33.33"> ChromeUtils.import(&quot;resource:///modules/MailConsts.jsm&quot;);</span>
<a href="#l33.34"></a><span id="l33.34"> ChromeUtils.import(&quot;resource:///modules/MailInstrumentation.jsm&quot;);</span>
<a href="#l33.35"></a><span id="l33.35"> ChromeUtils.import(&quot;resource:///modules/mailnewsMigrator.js&quot;);</span>
<a href="#l33.36"></a><span id="l33.36"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l33.37"></a><span id="l33.37"> ChromeUtils.import(&quot;resource:///modules/msgDBCacheManager.js&quot;);</span>
<a href="#l33.38"></a><span id="l33.38"> ChromeUtils.import(&quot;resource:///modules/SessionStoreManager.jsm&quot;);</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineat">@@ -895,17 +913,19 @@ function loadStartFolder(initialUri) {</span>
<a href="#l33.40"></a><span id="l33.40">             if (gFolderTreeView._rowMap.length)</span>
<a href="#l33.41"></a><span id="l33.41">               gFolderTreeView.selectFolder(gFolderTreeView._rowMap[0]._folder);</span>
<a href="#l33.42"></a><span id="l33.42">           }</span>
<a href="#l33.43"></a><span id="l33.43">         }</span>
<a href="#l33.44"></a><span id="l33.44">     } catch (ex) {</span>
<a href="#l33.45"></a><span id="l33.45">       // this is the case where we're trying to auto-subscribe to a folder.</span>
<a href="#l33.46"></a><span id="l33.46">       if (initialUri &amp;&amp; !startFolder.parent) {</span>
<a href="#l33.47"></a><span id="l33.47">         // hack to force display of thread pane.</span>
<a href="#l33.48"></a><span id="l33.48" class="difflineminus">-        ShowingThreadPane();</span>
<a href="#l33.49"></a><span id="l33.49" class="difflineplus">+        if (IsMessagePaneCollapsed) {</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineplus">+          MsgToggleMessagePane();</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineplus">+        }</span>
<a href="#l33.52"></a><span id="l33.52">         messenger.loadURL(window, initialUri);</span>
<a href="#l33.53"></a><span id="l33.53">         return;</span>
<a href="#l33.54"></a><span id="l33.54">       }</span>
<a href="#l33.55"></a><span id="l33.55"> </span>
<a href="#l33.56"></a><span id="l33.56">       Cu.reportError(ex);</span>
<a href="#l33.57"></a><span id="l33.57">     }</span>
<a href="#l33.58"></a><span id="l33.58"> </span>
<a href="#l33.59"></a><span id="l33.59">     MsgGetMessagesForAllServers(defaultServer);</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineat">@@ -1447,17 +1467,17 @@ function ThreadPaneOnDrop(aEvent) {</span>
<a href="#l33.61"></a><span id="l33.61"> </span>
<a href="#l33.62"></a><span id="l33.62"> var LightWeightThemeWebInstaller = {</span>
<a href="#l33.63"></a><span id="l33.63">   handleEvent(event) {</span>
<a href="#l33.64"></a><span id="l33.64">     switch (event.type) {</span>
<a href="#l33.65"></a><span id="l33.65">       case &quot;InstallBrowserTheme&quot;:</span>
<a href="#l33.66"></a><span id="l33.66">       case &quot;PreviewBrowserTheme&quot;:</span>
<a href="#l33.67"></a><span id="l33.67">       case &quot;ResetBrowserThemePreview&quot;:</span>
<a href="#l33.68"></a><span id="l33.68">         // ignore requests from background tabs</span>
<a href="#l33.69"></a><span id="l33.69" class="difflineminus">-        if (event.target.ownerGlobal.top != content)</span>
<a href="#l33.70"></a><span id="l33.70" class="difflineplus">+        if (event.target.ownerGlobal.top != window.content)</span>
<a href="#l33.71"></a><span id="l33.71">           return;</span>
<a href="#l33.72"></a><span id="l33.72">     }</span>
<a href="#l33.73"></a><span id="l33.73">     switch (event.type) {</span>
<a href="#l33.74"></a><span id="l33.74">       case &quot;InstallBrowserTheme&quot;:</span>
<a href="#l33.75"></a><span id="l33.75">         this._installRequest(event);</span>
<a href="#l33.76"></a><span id="l33.76">         break;</span>
<a href="#l33.77"></a><span id="l33.77">       case &quot;PreviewBrowserTheme&quot;:</span>
<a href="#l33.78"></a><span id="l33.78">         this._preview(event);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/base/content/msgViewNavigation.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/base/content/msgViewNavigation.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -1,16 +1,21 @@</span>
<a href="#l34.4"></a><span id="l34.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l34.5"></a><span id="l34.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l34.6"></a><span id="l34.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l34.7"></a><span id="l34.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l34.8"></a><span id="l34.8"> </span>
<a href="#l34.9"></a><span id="l34.9"> /*  This file contains the js functions necessary to implement view navigation within the 3 pane. */</span>
<a href="#l34.10"></a><span id="l34.10"> </span>
<a href="#l34.11"></a><span id="l34.11" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/folderUtils.jsm&quot;);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+/* import-globals-from messageDisplay.js */</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineplus">+var { allAccountsSorted } = ChromeUtils.import(&quot;resource:///modules/folderUtils.jsm&quot;, null);</span>
<a href="#l34.18"></a><span id="l34.18"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20"> function GetSubFoldersInFolderPaneOrder(folder) {</span>
<a href="#l34.21"></a><span id="l34.21">   var subFolders = folder.subFolders;</span>
<a href="#l34.22"></a><span id="l34.22">   var msgFolders = [];</span>
<a href="#l34.23"></a><span id="l34.23"> </span>
<a href="#l34.24"></a><span id="l34.24">   // get all the subfolders</span>
<a href="#l34.25"></a><span id="l34.25">   while (subFolders.hasMoreElements()) {</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineat">@@ -119,24 +124,24 @@ function GetRootFoldersInFolderPaneOrder</span>
<a href="#l34.27"></a><span id="l34.27">   for (let account of accounts)</span>
<a href="#l34.28"></a><span id="l34.28">     serversMsgFolders.push(account.incomingServer.rootMsgFolder);</span>
<a href="#l34.29"></a><span id="l34.29"> </span>
<a href="#l34.30"></a><span id="l34.30">   return serversMsgFolders;</span>
<a href="#l34.31"></a><span id="l34.31"> }</span>
<a href="#l34.32"></a><span id="l34.32"> </span>
<a href="#l34.33"></a><span id="l34.33"> function CrossFolderNavigation(type) {</span>
<a href="#l34.34"></a><span id="l34.34">   // do cross folder navigation for next unread message/thread and message history</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineminus">-  if (type != nsMsgNavigationType.nextUnreadMessage &amp;&amp;</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineminus">-      type != nsMsgNavigationType.nextUnreadThread &amp;&amp;</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineminus">-      type != nsMsgNavigationType.forward &amp;&amp;</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineminus">-      type != nsMsgNavigationType.back)</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineplus">+  if (type != Ci.nsMsgNavigationType.nextUnreadMessage &amp;&amp;</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineplus">+      type != Ci.nsMsgNavigationType.nextUnreadThread &amp;&amp;</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineplus">+      type != Ci.nsMsgNavigationType.forward &amp;&amp;</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineplus">+      type != Ci.nsMsgNavigationType.back)</span>
<a href="#l34.43"></a><span id="l34.43">     return;</span>
<a href="#l34.44"></a><span id="l34.44"> </span>
<a href="#l34.45"></a><span id="l34.45" class="difflineminus">-  if (type == nsMsgNavigationType.nextUnreadMessage ||</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineminus">-      type == nsMsgNavigationType.nextUnreadThread) {</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineplus">+  if (type == Ci.nsMsgNavigationType.nextUnreadMessage ||</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineplus">+      type == Ci.nsMsgNavigationType.nextUnreadThread) {</span>
<a href="#l34.49"></a><span id="l34.49">     var nextMode = Services.prefs.getIntPref(&quot;mailnews.nav_crosses_folders&quot;);</span>
<a href="#l34.50"></a><span id="l34.50">     // 0: &quot;next&quot; goes to the next folder, without prompting</span>
<a href="#l34.51"></a><span id="l34.51">     // 1: &quot;next&quot; goes to the next folder, and prompts (the default)</span>
<a href="#l34.52"></a><span id="l34.52">     // 2: &quot;next&quot; does nothing when there are no unread messages</span>
<a href="#l34.53"></a><span id="l34.53"> </span>
<a href="#l34.54"></a><span id="l34.54">     // not crossing folders, don't find next</span>
<a href="#l34.55"></a><span id="l34.55">     if (nextMode == 2)</span>
<a href="#l34.56"></a><span id="l34.56">       return;</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineat">@@ -154,24 +159,22 @@ function CrossFolderNavigation(type) {</span>
<a href="#l34.58"></a><span id="l34.58">       }</span>
<a href="#l34.59"></a><span id="l34.59">       gFolderDisplay.pushNavigation(type, true);</span>
<a href="#l34.60"></a><span id="l34.60">       SelectFolder(folder.URI);</span>
<a href="#l34.61"></a><span id="l34.61">     }</span>
<a href="#l34.62"></a><span id="l34.62">   } else {</span>
<a href="#l34.63"></a><span id="l34.63">     // if no message is loaded, relPos should be 0, to</span>
<a href="#l34.64"></a><span id="l34.64">     // go back to the previously loaded message</span>
<a href="#l34.65"></a><span id="l34.65">     var relPos = 0;</span>
<a href="#l34.66"></a><span id="l34.66" class="difflineminus">-    if (type == nsMsgNavigationType.forward) {</span>
<a href="#l34.67"></a><span id="l34.67" class="difflineplus">+    if (type == Ci.nsMsgNavigationType.forward) {</span>
<a href="#l34.68"></a><span id="l34.68">       relPos = 1;</span>
<a href="#l34.69"></a><span id="l34.69">     } else if (gMessageDisplay.displayedMessage) {</span>
<a href="#l34.70"></a><span id="l34.70">       relPos = -1;</span>
<a href="#l34.71"></a><span id="l34.71">     }</span>
<a href="#l34.72"></a><span id="l34.72">     var folderUri = messenger.getFolderUriAtNavigatePos(relPos);</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineminus">-    var msgHdr = messenger.msgHdrFromURI(messenger.getMsgUriAtNavigatePos(relPos));</span>
<a href="#l34.74"></a><span id="l34.74" class="difflineminus">-    gStartMsgKey = msgHdr.messageKey;</span>
<a href="#l34.75"></a><span id="l34.75">     var curPos = messenger.navigatePos;</span>
<a href="#l34.76"></a><span id="l34.76">     curPos += relPos;</span>
<a href="#l34.77"></a><span id="l34.77">     messenger.navigatePos = curPos;</span>
<a href="#l34.78"></a><span id="l34.78">     SelectFolder(folderUri);</span>
<a href="#l34.79"></a><span id="l34.79">   }</span>
<a href="#l34.80"></a><span id="l34.80"> }</span>
<a href="#l34.81"></a><span id="l34.81"> </span>
<a href="#l34.82"></a><span id="l34.82"> function GoNextMessage(type, startFromBeginning) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mail/base/content/multimessageview.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mail/base/content/multimessageview.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -1,19 +1,24 @@</span>
<a href="#l35.4"></a><span id="l35.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l35.5"></a><span id="l35.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l35.6"></a><span id="l35.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l35.7"></a><span id="l35.7"> </span>
<a href="#l35.8"></a><span id="l35.8"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/gloda.js&quot;);</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/connotent.js&quot;);</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/gloda/mimemsg.js&quot;);</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+var { Gloda } = ChromeUtils.import(&quot;resource:///modules/gloda/gloda.js&quot;, null);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+var {</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+  mimeMsgToContentSnippetAndMeta,</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/gloda/connotent.js&quot;, null);</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+var { MsgHdrToMimeMessage } = ChromeUtils.import(&quot;resource:///modules/gloda/mimemsg.js&quot;, null);</span>
<a href="#l35.17"></a><span id="l35.17"> ChromeUtils.import(&quot;resource:///modules/DisplayNameUtils.jsm&quot;);</span>
<a href="#l35.18"></a><span id="l35.18"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/templateUtils.js&quot;);</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+var {</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+  PluralStringFormatter,</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineplus">+  makeFriendlyDateAgo,</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/templateUtils.js&quot;, null);</span>
<a href="#l35.24"></a><span id="l35.24"> </span>
<a href="#l35.25"></a><span id="l35.25"> var gMessenger = Cc[&quot;@mozilla.org/messenger;1&quot;]</span>
<a href="#l35.26"></a><span id="l35.26">                    .createInstance(Ci.nsIMessenger);</span>
<a href="#l35.27"></a><span id="l35.27"> </span>
<a href="#l35.28"></a><span id="l35.28"> // Set up our string formatter for localizing strings.</span>
<a href="#l35.29"></a><span id="l35.29"> XPCOMUtils.defineLazyGetter(this, &quot;formatString&quot;, function() {</span>
<a href="#l35.30"></a><span id="l35.30">   let formatter = new PluralStringFormatter(</span>
<a href="#l35.31"></a><span id="l35.31">     &quot;chrome://messenger/locale/multimessageview.properties&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mail/base/content/nsContextMenu.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mail/base/content/nsContextMenu.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -1,13 +1,18 @@</span>
<a href="#l36.4"></a><span id="l36.4"> /**</span>
<a href="#l36.5"></a><span id="l36.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l36.6"></a><span id="l36.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l36.7"></a><span id="l36.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l36.8"></a><span id="l36.8"> </span>
<a href="#l36.9"></a><span id="l36.9" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l36.10"></a><span id="l36.10" class="difflineplus">+/* import-globals-from mailTabs.js */</span>
<a href="#l36.11"></a><span id="l36.11" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineplus">+/* import-globals-from messageDisplay.js */</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+</span>
<a href="#l36.14"></a><span id="l36.14"> ChromeUtils.import(&quot;resource://gre/modules/InlineSpellChecker.jsm&quot;);</span>
<a href="#l36.15"></a><span id="l36.15"> ChromeUtils.import(&quot;resource://gre/modules/PlacesUtils.jsm&quot;);</span>
<a href="#l36.16"></a><span id="l36.16"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l36.17"></a><span id="l36.17"> ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l36.18"></a><span id="l36.18"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l36.19"></a><span id="l36.19"> ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l36.20"></a><span id="l36.20"> </span>
<a href="#l36.21"></a><span id="l36.21"> XPCOMUtils.defineLazyGetter(this, &quot;PageMenuParent&quot;, function() {</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineat">@@ -826,17 +831,17 @@ nsContextMenu.prototype = {</span>
<a href="#l36.23"></a><span id="l36.23">     if (!text || (text.trim() == &quot;&quot;)) {</span>
<a href="#l36.24"></a><span id="l36.24">       text = this.link.getAttribute(&quot;title&quot;);</span>
<a href="#l36.25"></a><span id="l36.25">       if (!text || (text.trim() == &quot;&quot;)) {</span>
<a href="#l36.26"></a><span id="l36.26">         text = this.link.getAttribute(&quot;alt&quot;);</span>
<a href="#l36.27"></a><span id="l36.27">         if (!text || (text.trim() == &quot;&quot;)) {</span>
<a href="#l36.28"></a><span id="l36.28">           if (this.link.href) {</span>
<a href="#l36.29"></a><span id="l36.29">             text = this.link.href;</span>
<a href="#l36.30"></a><span id="l36.30">           } else {</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-            text = getAttributeNS(&quot;http://www.w3.org/1999/xlink&quot;, &quot;href&quot;);</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineplus">+            text = this.link.getAttributeNS(&quot;http://www.w3.org/1999/xlink&quot;, &quot;href&quot;);</span>
<a href="#l36.33"></a><span id="l36.33">             if (text &amp;&amp; !(text.trim() == &quot;&quot;)) {</span>
<a href="#l36.34"></a><span id="l36.34">               text = this.makeURLAbsolute(this.link.baseURI, text);</span>
<a href="#l36.35"></a><span id="l36.35">             }</span>
<a href="#l36.36"></a><span id="l36.36">           }</span>
<a href="#l36.37"></a><span id="l36.37">         }</span>
<a href="#l36.38"></a><span id="l36.38">       }</span>
<a href="#l36.39"></a><span id="l36.39">     }</span>
<a href="#l36.40"></a><span id="l36.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mail/base/content/nsDragAndDrop.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mail/base/content/nsDragAndDrop.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -8,16 +8,18 @@</span>
<a href="#l37.4"></a><span id="l37.4"> // Do not use this file for new code.</span>
<a href="#l37.5"></a><span id="l37.5"> //</span>
<a href="#l37.6"></a><span id="l37.6"> // Toolkit dropped nsDragAndDrop.js in bug 1162050.</span>
<a href="#l37.7"></a><span id="l37.7"> // Mapped to content/global/nsDragAndDrop.js until we can remove this usage.</span>
<a href="#l37.8"></a><span id="l37.8"> //</span>
<a href="#l37.9"></a><span id="l37.9"> // For documentation about what to use instead, see:</span>
<a href="#l37.10"></a><span id="l37.10"> //   http://developer.mozilla.org/En/DragDrop/Drag_and_Drop</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+ChromeUtils.defineModuleGetter(this, &quot;Services&quot;, &quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+</span>
<a href="#l37.14"></a><span id="l37.14"> /**</span>
<a href="#l37.15"></a><span id="l37.15">  *  nsTransferable - a wrapper for nsITransferable that simplifies</span>
<a href="#l37.16"></a><span id="l37.16">  *                   javascript clipboard and drag&amp;drop. for use in</span>
<a href="#l37.17"></a><span id="l37.17">  *                   these situations you should use the nsClipboard</span>
<a href="#l37.18"></a><span id="l37.18">  *                   and nsDragAndDrop wrappers for more convenience</span>
<a href="#l37.19"></a><span id="l37.19">  **/</span>
<a href="#l37.20"></a><span id="l37.20"> </span>
<a href="#l37.21"></a><span id="l37.21"> var nsTransferable = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mail/base/content/phishingDetector.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mail/base/content/phishingDetector.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l38.4"></a><span id="l38.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l38.5"></a><span id="l38.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l38.6"></a><span id="l38.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8" class="difflineminus">-// Dependencies:</span>
<a href="#l38.9"></a><span id="l38.9" class="difflineminus">-// gatherTextUnder from utilityOverlay.js</span>
<a href="#l38.10"></a><span id="l38.10" class="difflineplus">+/* import-globals-from mailWindowOverlay.js */</span>
<a href="#l38.11"></a><span id="l38.11" class="difflineplus">+/* import-globals-from utilityOverlay.js */</span>
<a href="#l38.12"></a><span id="l38.12"> </span>
<a href="#l38.13"></a><span id="l38.13"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15"> var kPhishingNotSuspicious = 0;</span>
<a href="#l38.16"></a><span id="l38.16"> var kPhishingWithIPAddress = 1;</span>
<a href="#l38.17"></a><span id="l38.17"> var kPhishingWithMismatchedHosts = 2;</span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mail/base/content/plugins.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mail/base/content/plugins.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -1,12 +1,16 @@</span>
<a href="#l39.4"></a><span id="l39.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l39.5"></a><span id="l39.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l39.6"></a><span id="l39.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l39.7"></a><span id="l39.7"> </span>
<a href="#l39.8"></a><span id="l39.8" class="difflineplus">+// This file is scheduled to be demolished to make way for a new hyperspace bypass.</span>
<a href="#l39.9"></a><span id="l39.9" class="difflineplus">+// See bug 1508942.</span>
<a href="#l39.10"></a><span id="l39.10" class="difflineplus">+/* eslint-disable */</span>
<a href="#l39.11"></a><span id="l39.11" class="difflineplus">+</span>
<a href="#l39.12"></a><span id="l39.12"> &quot;use strict&quot;;</span>
<a href="#l39.13"></a><span id="l39.13"> </span>
<a href="#l39.14"></a><span id="l39.14"> /* A note to the curious: a large portion of this code was copied over from</span>
<a href="#l39.15"></a><span id="l39.15">  * mozilla/browser/base/content/browser.js</span>
<a href="#l39.16"></a><span id="l39.16">  */</span>
<a href="#l39.17"></a><span id="l39.17"> </span>
<a href="#l39.18"></a><span id="l39.18"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l39.19"></a><span id="l39.19"> ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mail/base/content/quickFilterBar.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mail/base/content/quickFilterBar.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -1,14 +1,19 @@</span>
<a href="#l40.4"></a><span id="l40.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l40.5"></a><span id="l40.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l40.6"></a><span id="l40.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l40.9"></a><span id="l40.9" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;);</span>
<a href="#l40.10"></a><span id="l40.10" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l40.11"></a><span id="l40.11" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineplus">+</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+var {</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineplus">+  logException,</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+  errorWithDebug,</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;, null);</span>
<a href="#l40.17"></a><span id="l40.17"> var {</span>
<a href="#l40.18"></a><span id="l40.18">   MessageTextFilter,</span>
<a href="#l40.19"></a><span id="l40.19">   QuickFilterManager,</span>
<a href="#l40.20"></a><span id="l40.20">   QuickFilterSearchListener,</span>
<a href="#l40.21"></a><span id="l40.21">   QuickFilterState,</span>
<a href="#l40.22"></a><span id="l40.22"> } = ChromeUtils.import(&quot;resource:///modules/QuickFilterManager.jsm&quot;, null);</span>
<a href="#l40.23"></a><span id="l40.23"> ChromeUtils.import(&quot;resource:///modules/SearchSpec.jsm&quot;);</span>
<a href="#l40.24"></a><span id="l40.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mail/base/content/sanitizeDialog.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mail/base/content/sanitizeDialog.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l41.4"></a><span id="l41.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l41.5"></a><span id="l41.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l41.6"></a><span id="l41.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l41.7"></a><span id="l41.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l41.8"></a><span id="l41.8"> </span>
<a href="#l41.9"></a><span id="l41.9" class="difflineplus">+/* import-globals-from sanitize.js */</span>
<a href="#l41.10"></a><span id="l41.10" class="difflineplus">+</span>
<a href="#l41.11"></a><span id="l41.11"> var gSanitizePromptDialog = {</span>
<a href="#l41.12"></a><span id="l41.12"> </span>
<a href="#l41.13"></a><span id="l41.13">   get bundleBrowser() {</span>
<a href="#l41.14"></a><span id="l41.14">     if (!this._bundleBrowser)</span>
<a href="#l41.15"></a><span id="l41.15">       this._bundleBrowser = document.getElementById(&quot;bundleBrowser&quot;);</span>
<a href="#l41.16"></a><span id="l41.16">     return this._bundleBrowser;</span>
<a href="#l41.17"></a><span id="l41.17">   },</span>
<a href="#l41.18"></a><span id="l41.18"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mail/base/content/search.xml</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mail/base/content/search.xml</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -1,14 +1,16 @@</span>
<a href="#l42.4"></a><span id="l42.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l42.5"></a><span id="l42.5" class="difflineminus">-</span>
<a href="#l42.6"></a><span id="l42.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l42.7"></a><span id="l42.7">   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l42.8"></a><span id="l42.8">   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l42.9"></a><span id="l42.9"> </span>
<a href="#l42.10"></a><span id="l42.10" class="difflineplus">+&lt;!-- import-globals-from mailWindow.js --&gt;</span>
<a href="#l42.11"></a><span id="l42.11" class="difflineplus">+&lt;!-- import-globals-from nsDragAndDrop.js --&gt;</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineplus">+</span>
<a href="#l42.13"></a><span id="l42.13"> &lt;!DOCTYPE bindings [</span>
<a href="#l42.14"></a><span id="l42.14"> &lt;!ENTITY % messengerDTD SYSTEM &quot;chrome://messenger/locale/messenger.dtd&quot;&gt;</span>
<a href="#l42.15"></a><span id="l42.15"> %messengerDTD;</span>
<a href="#l42.16"></a><span id="l42.16"> ]&gt;</span>
<a href="#l42.17"></a><span id="l42.17"> </span>
<a href="#l42.18"></a><span id="l42.18"> &lt;bindings id=&quot;SearchBindings&quot;</span>
<a href="#l42.19"></a><span id="l42.19">    xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l42.20"></a><span id="l42.20">    xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineat">@@ -46,17 +48,16 @@</span>
<a href="#l42.22"></a><span id="l42.22">         this.clearSearch();</span>
<a href="#l42.23"></a><span id="l42.23">         event.preventDefault();</span>
<a href="#l42.24"></a><span id="l42.24">         event.stopPropagation();</span>
<a href="#l42.25"></a><span id="l42.25">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l42.26"></a><span id="l42.26">     &lt;/handlers&gt;</span>
<a href="#l42.27"></a><span id="l42.27"> </span>
<a href="#l42.28"></a><span id="l42.28">     &lt;implementation implements=&quot;nsIObserver&quot;&gt;</span>
<a href="#l42.29"></a><span id="l42.29">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l42.30"></a><span id="l42.30" class="difflineminus">-        ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;);</span>
<a href="#l42.31"></a><span id="l42.31">         ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l42.32"></a><span id="l42.32">         ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l42.33"></a><span id="l42.33"> </span>
<a href="#l42.34"></a><span id="l42.34">         try {</span>
<a href="#l42.35"></a><span id="l42.35">           this.setAttribute(</span>
<a href="#l42.36"></a><span id="l42.36">             &quot;placeholder&quot;,</span>
<a href="#l42.37"></a><span id="l42.37">             this.getAttribute(&quot;emptytextbase&quot;)</span>
<a href="#l42.38"></a><span id="l42.38">                 .replace(&quot;#1&quot;, this.getAttribute(</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineat">@@ -75,16 +76,17 @@</span>
<a href="#l42.40"></a><span id="l42.40">           this.glodaEnabled =</span>
<a href="#l42.41"></a><span id="l42.41">             Services.prefs.getBoolPref(&quot;mailnews.database.global.indexer.enabled&quot;);</span>
<a href="#l42.42"></a><span id="l42.42">           this.collapsed = !this.glodaEnabled;</span>
<a href="#l42.43"></a><span id="l42.43"> </span>
<a href="#l42.44"></a><span id="l42.44">           // make sure we set our emptytext here from the get-go</span>
<a href="#l42.45"></a><span id="l42.45">         if (this.hasAttribute(&quot;placeholder&quot;))</span>
<a href="#l42.46"></a><span id="l42.46">           this.placeholder = this.getAttribute(&quot;placeholder&quot;);</span>
<a href="#l42.47"></a><span id="l42.47">         } catch (e) {</span>
<a href="#l42.48"></a><span id="l42.48" class="difflineplus">+          let { logException } = ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;, null);</span>
<a href="#l42.49"></a><span id="l42.49">           logException(e, true);</span>
<a href="#l42.50"></a><span id="l42.50">         }</span>
<a href="#l42.51"></a><span id="l42.51">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l42.52"></a><span id="l42.52"> </span>
<a href="#l42.53"></a><span id="l42.53">       &lt;destructor&gt;</span>
<a href="#l42.54"></a><span id="l42.54">         &lt;![CDATA[</span>
<a href="#l42.55"></a><span id="l42.55">           ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l42.56"></a><span id="l42.56"> </span>
<a href="#l42.57"></a><span id="l42.57" class="difflineat">@@ -142,16 +144,17 @@</span>
<a href="#l42.58"></a><span id="l42.58">             if (aXferData.data) {</span>
<a href="#l42.59"></a><span id="l42.59">               this.inputSearch.focus();</span>
<a href="#l42.60"></a><span id="l42.60">               this.inputSearch.value = aXferData.data;</span>
<a href="#l42.61"></a><span id="l42.61">               // XXX for some reason the input field is _cleared_ even though</span>
<a href="#l42.62"></a><span id="l42.62">               // the search works.</span>
<a href="#l42.63"></a><span id="l42.63">               this.inputSearch.doSearch();</span>
<a href="#l42.64"></a><span id="l42.64">             }</span>
<a href="#l42.65"></a><span id="l42.65">           } catch (e) {</span>
<a href="#l42.66"></a><span id="l42.66" class="difflineplus">+            let { logException } = ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;, null);</span>
<a href="#l42.67"></a><span id="l42.67">             logException(e);</span>
<a href="#l42.68"></a><span id="l42.68">           }</span>
<a href="#l42.69"></a><span id="l42.69">         },</span>
<a href="#l42.70"></a><span id="l42.70"> </span>
<a href="#l42.71"></a><span id="l42.71">         getSupportedFlavours() {</span>
<a href="#l42.72"></a><span id="l42.72">           var flavourSet = new FlavourSet();</span>
<a href="#l42.73"></a><span id="l42.73">           flavourSet.appendFlavour(&quot;text/unicode&quot;);</span>
<a href="#l42.74"></a><span id="l42.74">           return flavourSet;</span>
<a href="#l42.75"></a><span id="l42.75" class="difflineat">@@ -194,16 +197,17 @@</span>
<a href="#l42.76"></a><span id="l42.76">               }</span>
<a href="#l42.77"></a><span id="l42.77">               theQuery.orderBy(&quot;-date&quot;);</span>
<a href="#l42.78"></a><span id="l42.78">               document.getElementById(&quot;tabmail&quot;).openTab(&quot;glodaFacet&quot;, {</span>
<a href="#l42.79"></a><span id="l42.79">                 query: theQuery,</span>
<a href="#l42.80"></a><span id="l42.80">               });</span>
<a href="#l42.81"></a><span id="l42.81">             }</span>
<a href="#l42.82"></a><span id="l42.82">           }</span>
<a href="#l42.83"></a><span id="l42.83">         } catch (e) {</span>
<a href="#l42.84"></a><span id="l42.84" class="difflineplus">+          let { logException } = ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;, null);</span>
<a href="#l42.85"></a><span id="l42.85">           logException(e);</span>
<a href="#l42.86"></a><span id="l42.86">         }</span>
<a href="#l42.87"></a><span id="l42.87">         ]]&gt;&lt;/body&gt;</span>
<a href="#l42.88"></a><span id="l42.88">       &lt;/method&gt;</span>
<a href="#l42.89"></a><span id="l42.89"> </span>
<a href="#l42.90"></a><span id="l42.90">       &lt;method name=&quot;doSearch&quot;&gt;</span>
<a href="#l42.91"></a><span id="l42.91">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l42.92"></a><span id="l42.92">           ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l42.93"></a><span id="l42.93" class="difflineat">@@ -224,23 +228,25 @@</span>
<a href="#l42.94"></a><span id="l42.94">                 // this tab and starting over</span>
<a href="#l42.95"></a><span id="l42.95">                 tabmail.closeTab();</span>
<a href="#l42.96"></a><span id="l42.96">               }</span>
<a href="#l42.97"></a><span id="l42.97">               this.value = &quot;&quot;; // clear our value, to avoid persistence</span>
<a href="#l42.98"></a><span id="l42.98">               let args = {</span>
<a href="#l42.99"></a><span id="l42.99">                 searcher: new GlodaMsgSearcher(null, searchString),</span>
<a href="#l42.100"></a><span id="l42.100">               };</span>
<a href="#l42.101"></a><span id="l42.101">               if (Services.prefs.getBoolPref(&quot;mail.chat.enabled&quot;)) {</span>
<a href="#l42.102"></a><span id="l42.102" class="difflineminus">-                if (!(&quot;GlodaIMSearcher&quot; in window))</span>
<a href="#l42.103"></a><span id="l42.103" class="difflineminus">-                  ChromeUtils.import(&quot;resource:///modules/search_im.jsm&quot;);</span>
<a href="#l42.104"></a><span id="l42.104" class="difflineplus">+                let {</span>
<a href="#l42.105"></a><span id="l42.105" class="difflineplus">+                  GlodaIMSearcher,</span>
<a href="#l42.106"></a><span id="l42.106" class="difflineplus">+                } = ChromeUtils.import(&quot;resource:///modules/search_im.jsm&quot;, null);</span>
<a href="#l42.107"></a><span id="l42.107">                 args.IMSearcher = new GlodaIMSearcher(null, searchString);</span>
<a href="#l42.108"></a><span id="l42.108">               }</span>
<a href="#l42.109"></a><span id="l42.109">               tabmail.openTab(&quot;glodaFacet&quot;, args);</span>
<a href="#l42.110"></a><span id="l42.110">             }</span>
<a href="#l42.111"></a><span id="l42.111">           } catch (e) {</span>
<a href="#l42.112"></a><span id="l42.112" class="difflineplus">+            let { logException } = ChromeUtils.import(&quot;resource:///modules/errUtils.js&quot;, null);</span>
<a href="#l42.113"></a><span id="l42.113">             logException(e);</span>
<a href="#l42.114"></a><span id="l42.114">           }</span>
<a href="#l42.115"></a><span id="l42.115">         ]]&gt;</span>
<a href="#l42.116"></a><span id="l42.116">         &lt;/body&gt;</span>
<a href="#l42.117"></a><span id="l42.117">       &lt;/method&gt;</span>
<a href="#l42.118"></a><span id="l42.118">       &lt;method name=&quot;clearSearch&quot;&gt;</span>
<a href="#l42.119"></a><span id="l42.119">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l42.120"></a><span id="l42.120">           this.value = &quot;&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mail/base/content/selectionsummaries.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mail/base/content/selectionsummaries.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l43.4"></a><span id="l43.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l43.5"></a><span id="l43.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l43.6"></a><span id="l43.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l43.7"></a><span id="l43.7"> </span>
<a href="#l43.8"></a><span id="l43.8" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l43.9"></a><span id="l43.9" class="difflineplus">+</span>
<a href="#l43.10"></a><span id="l43.10"> /**</span>
<a href="#l43.11"></a><span id="l43.11">  * Summarize a set of selected messages.  This can either be a single thread or</span>
<a href="#l43.12"></a><span id="l43.12">  * multiple threads.</span>
<a href="#l43.13"></a><span id="l43.13">  *</span>
<a href="#l43.14"></a><span id="l43.14">  * @param aMessageDisplay The MessageDisplayWidget object responsible for</span>
<a href="#l43.15"></a><span id="l43.15">  *                         showing messages.</span>
<a href="#l43.16"></a><span id="l43.16">  */</span>
<a href="#l43.17"></a><span id="l43.17"> function summarizeSelection(aMessageDisplay) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mail/base/content/specialTabs.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mail/base/content/specialTabs.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -1,12 +1,16 @@</span>
<a href="#l44.4"></a><span id="l44.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l44.5"></a><span id="l44.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l44.6"></a><span id="l44.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l44.7"></a><span id="l44.7"> </span>
<a href="#l44.8"></a><span id="l44.8" class="difflineplus">+/* import-globals-from ../../../../toolkit/components/printing/content/printUtils.js */</span>
<a href="#l44.9"></a><span id="l44.9" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l44.10"></a><span id="l44.10" class="difflineplus">+/* import-globals-from plugins.js */</span>
<a href="#l44.11"></a><span id="l44.11" class="difflineplus">+</span>
<a href="#l44.12"></a><span id="l44.12"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l44.13"></a><span id="l44.13"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l44.14"></a><span id="l44.14"> ChromeUtils.import(&quot;resource://gre/modules/AddonManager.jsm&quot;);</span>
<a href="#l44.15"></a><span id="l44.15"> ChromeUtils.import(&quot;resource:///modules/StringBundle.js&quot;);</span>
<a href="#l44.16"></a><span id="l44.16"> ChromeUtils.import(&quot;resource://gre/modules/BrowserUtils.jsm&quot;);</span>
<a href="#l44.17"></a><span id="l44.17"> ChromeUtils.import(&quot;resource://gre/modules/NetUtil.jsm&quot;);</span>
<a href="#l44.18"></a><span id="l44.18"> ChromeUtils.import(&quot;resource://gre/modules/ExtensionParent.jsm&quot;);</span>
<a href="#l44.19"></a><span id="l44.19"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -1,13 +1,16 @@</span>
<a href="#l45.4"></a><span id="l45.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l45.5"></a><span id="l45.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l45.6"></a><span id="l45.6">   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l45.7"></a><span id="l45.7">   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l45.8"></a><span id="l45.8"> </span>
<a href="#l45.9"></a><span id="l45.9" class="difflineplus">+&lt;!-- import-globals-from commandglue.js --&gt;</span>
<a href="#l45.10"></a><span id="l45.10" class="difflineplus">+&lt;!-- import-globals-from mailWindow.js --&gt;</span>
<a href="#l45.11"></a><span id="l45.11" class="difflineplus">+</span>
<a href="#l45.12"></a><span id="l45.12"> &lt;!DOCTYPE bindings [</span>
<a href="#l45.13"></a><span id="l45.13"> &lt;!ENTITY % messengerDTD SYSTEM &quot;chrome://messenger/locale/messenger.dtd&quot; &gt;</span>
<a href="#l45.14"></a><span id="l45.14"> %messengerDTD;</span>
<a href="#l45.15"></a><span id="l45.15"> &lt;!ENTITY % tabMailDTD SYSTEM &quot;chrome://messenger/locale/tabmail.dtd&quot; &gt;</span>
<a href="#l45.16"></a><span id="l45.16">  %tabMailDTD;</span>
<a href="#l45.17"></a><span id="l45.17"> ]&gt;</span>
<a href="#l45.18"></a><span id="l45.18"> </span>
<a href="#l45.19"></a><span id="l45.19"> &lt;bindings id=&quot;tabmailBindings&quot;</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineat">@@ -2331,17 +2334,17 @@</span>
<a href="#l45.21"></a><span id="l45.21"> </span>
<a href="#l45.22"></a><span id="l45.22">         dt.mozCursor = &quot;default&quot;;</span>
<a href="#l45.23"></a><span id="l45.23"> </span>
<a href="#l45.24"></a><span id="l45.24">         // Create Drag Image</span>
<a href="#l45.25"></a><span id="l45.25">         let panel = document.getElementById(&quot;tabpanelcontainer&quot;);</span>
<a href="#l45.26"></a><span id="l45.26"> </span>
<a href="#l45.27"></a><span id="l45.27">         let thumbnail = document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;canvas&quot;);</span>
<a href="#l45.28"></a><span id="l45.28">         thumbnail.width = Math.ceil(screen.availWidth / 5.75);</span>
<a href="#l45.29"></a><span id="l45.29" class="difflineminus">-        thumbnail.height = Math.round(width * 0.5625);</span>
<a href="#l45.30"></a><span id="l45.30" class="difflineplus">+        thumbnail.height = Math.round(thumbnail.width * 0.5625);</span>
<a href="#l45.31"></a><span id="l45.31"> </span>
<a href="#l45.32"></a><span id="l45.32">         let snippetWidth = panel.boxObject.width * .6;</span>
<a href="#l45.33"></a><span id="l45.33">         let scale = thumbnail.width / snippetWidth;</span>
<a href="#l45.34"></a><span id="l45.34"> </span>
<a href="#l45.35"></a><span id="l45.35">         let ctx = thumbnail.getContext(&quot;2d&quot;);</span>
<a href="#l45.36"></a><span id="l45.36"> </span>
<a href="#l45.37"></a><span id="l45.37">         ctx.scale(scale, scale);</span>
<a href="#l45.38"></a><span id="l45.38"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mail/base/content/threadPane.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mail/base/content/threadPane.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -1,13 +1,17 @@</span>
<a href="#l46.4"></a><span id="l46.4"> /* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l46.5"></a><span id="l46.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l46.6"></a><span id="l46.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l46.7"></a><span id="l46.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l46.8"></a><span id="l46.8"> </span>
<a href="#l46.9"></a><span id="l46.9" class="difflineplus">+/* import-globals-from commandglue.js */</span>
<a href="#l46.10"></a><span id="l46.10" class="difflineplus">+/* import-globals-from folderDisplay.js */</span>
<a href="#l46.11"></a><span id="l46.11" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineplus">+</span>
<a href="#l46.13"></a><span id="l46.13"> var gLastMessageUriToLoad = null;</span>
<a href="#l46.14"></a><span id="l46.14"> var gThreadPaneCommandUpdater = null;</span>
<a href="#l46.15"></a><span id="l46.15"> </span>
<a href="#l46.16"></a><span id="l46.16"> function ThreadPaneOnClick(event) {</span>
<a href="#l46.17"></a><span id="l46.17">   // We only care about button 0 (left click) events.</span>
<a href="#l46.18"></a><span id="l46.18">   if (event.button != 0) {</span>
<a href="#l46.19"></a><span id="l46.19">     event.stopPropagation();</span>
<a href="#l46.20"></a><span id="l46.20">     return;</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineat">@@ -112,18 +116,18 @@ function HandleColumnClick(columnID) {</span>
<a href="#l46.22"></a><span id="l46.22">   }</span>
<a href="#l46.23"></a><span id="l46.23"> </span>
<a href="#l46.24"></a><span id="l46.24">   if (!simpleColumns &amp;&amp; viewWrapper.showThreaded) {</span>
<a href="#l46.25"></a><span id="l46.25">     viewWrapper.showUnthreaded = true;</span>
<a href="#l46.26"></a><span id="l46.26">     MsgSortThreadPane(sortType);</span>
<a href="#l46.27"></a><span id="l46.27">     return;</span>
<a href="#l46.28"></a><span id="l46.28">   }</span>
<a href="#l46.29"></a><span id="l46.29"> </span>
<a href="#l46.30"></a><span id="l46.30" class="difflineminus">-  if (viewWrapper.primarySortType == nsMsgViewSortType[sortType] &amp;&amp;</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">-      (viewWrapper.primarySortType != nsMsgViewSortType.byCustom ||</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineplus">+  if (viewWrapper.primarySortType == Ci.nsMsgViewSortType[sortType] &amp;&amp;</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineplus">+      (viewWrapper.primarySortType != Ci.nsMsgViewSortType.byCustom ||</span>
<a href="#l46.34"></a><span id="l46.34">        curCustomColumn == columnID)) {</span>
<a href="#l46.35"></a><span id="l46.35">     MsgReverseSortThreadPane();</span>
<a href="#l46.36"></a><span id="l46.36">   } else {</span>
<a href="#l46.37"></a><span id="l46.37">     MsgSortThreadPane(sortType);</span>
<a href="#l46.38"></a><span id="l46.38">   }</span>
<a href="#l46.39"></a><span id="l46.39"> }</span>
<a href="#l46.40"></a><span id="l46.40"> </span>
<a href="#l46.41"></a><span id="l46.41"> function ThreadPaneDoubleClick() {</span>
<a href="#l46.42"></a><span id="l46.42" class="difflineat">@@ -159,23 +163,23 @@ function ThreadPaneKeyDown(event) {</span>
<a href="#l46.43"></a><span id="l46.43"> }</span>
<a href="#l46.44"></a><span id="l46.44"> </span>
<a href="#l46.45"></a><span id="l46.45"> function MsgSortByThread() {</span>
<a href="#l46.46"></a><span id="l46.46">   gFolderDisplay.view.showThreaded = true;</span>
<a href="#l46.47"></a><span id="l46.47">   MsgSortThreadPane(&quot;byDate&quot;);</span>
<a href="#l46.48"></a><span id="l46.48"> }</span>
<a href="#l46.49"></a><span id="l46.49"> </span>
<a href="#l46.50"></a><span id="l46.50"> function MsgSortThreadPane(sortName) {</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineminus">-  let sortType = nsMsgViewSortType[sortName];</span>
<a href="#l46.52"></a><span id="l46.52" class="difflineplus">+  let sortType = Ci.nsMsgViewSortType[sortName];</span>
<a href="#l46.53"></a><span id="l46.53">   let grouped = gFolderDisplay.view.showGroupedBySort;</span>
<a href="#l46.54"></a><span id="l46.54">   gFolderDisplay.view._threadExpandAll =</span>
<a href="#l46.55"></a><span id="l46.55" class="difflineminus">-    Boolean(gFolderDisplay.view._viewFlags &amp; nsMsgViewFlagsType.kExpandAll);</span>
<a href="#l46.56"></a><span id="l46.56" class="difflineplus">+    Boolean(gFolderDisplay.view._viewFlags &amp; Ci.nsMsgViewFlagsType.kExpandAll);</span>
<a href="#l46.57"></a><span id="l46.57"> </span>
<a href="#l46.58"></a><span id="l46.58">   if (!grouped) {</span>
<a href="#l46.59"></a><span id="l46.59" class="difflineminus">-    gFolderDisplay.view.sort(sortType, nsMsgViewSortOrder.ascending);</span>
<a href="#l46.60"></a><span id="l46.60" class="difflineplus">+    gFolderDisplay.view.sort(sortType, Ci.nsMsgViewSortOrder.ascending);</span>
<a href="#l46.61"></a><span id="l46.61">     // Respect user's last expandAll/collapseAll choice, post sort direction change.</span>
<a href="#l46.62"></a><span id="l46.62">     gFolderDisplay.restoreThreadState();</span>
<a href="#l46.63"></a><span id="l46.63">     return;</span>
<a href="#l46.64"></a><span id="l46.64">   }</span>
<a href="#l46.65"></a><span id="l46.65"> </span>
<a href="#l46.66"></a><span id="l46.66">   // legacy behavior dictates we un-group-by-sort if we were.  this probably</span>
<a href="#l46.67"></a><span id="l46.67">   //  deserves a UX call...</span>
<a href="#l46.68"></a><span id="l46.68"> </span>
<a href="#l46.69"></a><span id="l46.69" class="difflineat">@@ -184,43 +188,43 @@ function MsgSortThreadPane(sortName) {</span>
<a href="#l46.70"></a><span id="l46.70">   // For virtual folders, which are rebuilt in the backend in a grouped</span>
<a href="#l46.71"></a><span id="l46.71">   // change, create a new view upfront rather than applying viewFlags. There</span>
<a href="#l46.72"></a><span id="l46.72">   // are oddities just applying viewFlags, for example changing out of a</span>
<a href="#l46.73"></a><span id="l46.73">   // custom column grouped xfvf view with the threads collapsed works (doesn't)</span>
<a href="#l46.74"></a><span id="l46.74">   // differently than other variations.</span>
<a href="#l46.75"></a><span id="l46.75">   // So, first set the desired sortType and sortOrder, then set viewFlags in</span>
<a href="#l46.76"></a><span id="l46.76">   // batch mode, then apply it all (open a new view) with endViewUpdate().</span>
<a href="#l46.77"></a><span id="l46.77">   gFolderDisplay.view.beginViewUpdate();</span>
<a href="#l46.78"></a><span id="l46.78" class="difflineminus">-  gFolderDisplay.view._sort = [[sortType, nsMsgViewSortOrder.ascending]];</span>
<a href="#l46.79"></a><span id="l46.79" class="difflineplus">+  gFolderDisplay.view._sort = [[sortType, Ci.nsMsgViewSortOrder.ascending]];</span>
<a href="#l46.80"></a><span id="l46.80">   gFolderDisplay.view.showGroupedBySort = false;</span>
<a href="#l46.81"></a><span id="l46.81">   gFolderDisplay.view.endViewUpdate();</span>
<a href="#l46.82"></a><span id="l46.82"> </span>
<a href="#l46.83"></a><span id="l46.83">   // Virtual folders don't persist viewFlags well in the back end,</span>
<a href="#l46.84"></a><span id="l46.84">   // due to a virtual folder being either 'real' or synthetic, so make</span>
<a href="#l46.85"></a><span id="l46.85">   // sure it's done here.</span>
<a href="#l46.86"></a><span id="l46.86">   if (gFolderDisplay.view.isVirtual)</span>
<a href="#l46.87"></a><span id="l46.87">     gFolderDisplay.view.dbView.viewFlags = gFolderDisplay.view.viewFlags;</span>
<a href="#l46.88"></a><span id="l46.88"> }</span>
<a href="#l46.89"></a><span id="l46.89"> </span>
<a href="#l46.90"></a><span id="l46.90"> function MsgReverseSortThreadPane() {</span>
<a href="#l46.91"></a><span id="l46.91">   let grouped = gFolderDisplay.view.showGroupedBySort;</span>
<a href="#l46.92"></a><span id="l46.92">   gFolderDisplay.view._threadExpandAll =</span>
<a href="#l46.93"></a><span id="l46.93" class="difflineminus">-    Boolean(gFolderDisplay.view._viewFlags &amp; nsMsgViewFlagsType.kExpandAll);</span>
<a href="#l46.94"></a><span id="l46.94" class="difflineplus">+    Boolean(gFolderDisplay.view._viewFlags &amp; Ci.nsMsgViewFlagsType.kExpandAll);</span>
<a href="#l46.95"></a><span id="l46.95"> </span>
<a href="#l46.96"></a><span id="l46.96">   // Grouped By view is special for column click sort direction changes.</span>
<a href="#l46.97"></a><span id="l46.97">   if (grouped) {</span>
<a href="#l46.98"></a><span id="l46.98">     if (gDBView.selection.count)</span>
<a href="#l46.99"></a><span id="l46.99">       gFolderDisplay._saveSelection();</span>
<a href="#l46.100"></a><span id="l46.100"> </span>
<a href="#l46.101"></a><span id="l46.101">     if (gFolderDisplay.view.isSingleFolder) {</span>
<a href="#l46.102"></a><span id="l46.102">       if (gFolderDisplay.view.isVirtual)</span>
<a href="#l46.103"></a><span id="l46.103">         gFolderDisplay.view.showGroupedBySort = false;</span>
<a href="#l46.104"></a><span id="l46.104">       else</span>
<a href="#l46.105"></a><span id="l46.105">        // Must ensure rows are collapsed and kExpandAll is unset.</span>
<a href="#l46.106"></a><span id="l46.106" class="difflineminus">-       gFolderDisplay.doCommand(nsMsgViewCommandType.collapseAll);</span>
<a href="#l46.107"></a><span id="l46.107" class="difflineplus">+       gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.collapseAll);</span>
<a href="#l46.108"></a><span id="l46.108">     }</span>
<a href="#l46.109"></a><span id="l46.109">   }</span>
<a href="#l46.110"></a><span id="l46.110"> </span>
<a href="#l46.111"></a><span id="l46.111">   if (gFolderDisplay.view.isSortedAscending)</span>
<a href="#l46.112"></a><span id="l46.112">     gFolderDisplay.view.sortDescending();</span>
<a href="#l46.113"></a><span id="l46.113">   else</span>
<a href="#l46.114"></a><span id="l46.114">     gFolderDisplay.view.sortAscending();</span>
<a href="#l46.115"></a><span id="l46.115"> </span>
<a href="#l46.116"></a><span id="l46.116" class="difflineat">@@ -309,17 +313,17 @@ function UpdateSortIndicators(sortType, </span>
<a href="#l46.117"></a><span id="l46.117"> </span>
<a href="#l46.118"></a><span id="l46.118">   // If threading, set the sort direction on the thread column which causes it</span>
<a href="#l46.119"></a><span id="l46.119">   //  to be able to 'light up' or otherwise indicate threading is active.</span>
<a href="#l46.120"></a><span id="l46.120">   if (viewWrapper.showThreaded)</span>
<a href="#l46.121"></a><span id="l46.121">     threadCol.setAttribute(&quot;sortDirection&quot;, &quot;ascending&quot;);</span>
<a href="#l46.122"></a><span id="l46.122"> </span>
<a href="#l46.123"></a><span id="l46.123">   if (sortedColumn)</span>
<a href="#l46.124"></a><span id="l46.124">     sortedColumn.setAttribute(&quot;sortDirection&quot;,</span>
<a href="#l46.125"></a><span id="l46.125" class="difflineminus">-                              sortOrder == nsMsgViewSortOrder.ascending ?</span>
<a href="#l46.126"></a><span id="l46.126" class="difflineplus">+                              sortOrder == Ci.nsMsgViewSortOrder.ascending ?</span>
<a href="#l46.127"></a><span id="l46.127">                                 &quot;ascending&quot; : &quot;descending&quot;);</span>
<a href="#l46.128"></a><span id="l46.128"> }</span>
<a href="#l46.129"></a><span id="l46.129"> </span>
<a href="#l46.130"></a><span id="l46.130"> function IsSpecialFolderSelected(flags, checkAncestors) {</span>
<a href="#l46.131"></a><span id="l46.131">   let folder = GetThreadPaneFolder();</span>
<a href="#l46.132"></a><span id="l46.132">   return folder &amp;&amp; folder.isSpecialFolder(flags, checkAncestors);</span>
<a href="#l46.133"></a><span id="l46.133"> }</span>
<a href="#l46.134"></a><span id="l46.134"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mail/base/content/threadPaneColumnPicker.xml</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mail/base/content/threadPaneColumnPicker.xml</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -1,14 +1,16 @@</span>
<a href="#l47.4"></a><span id="l47.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l47.5"></a><span id="l47.5" class="difflineminus">-</span>
<a href="#l47.6"></a><span id="l47.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l47.7"></a><span id="l47.7">   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l47.8"></a><span id="l47.8">   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l47.9"></a><span id="l47.9"> </span>
<a href="#l47.10"></a><span id="l47.10" class="difflineplus">+&lt;!-- import-globals-from folderDisplay.js --&gt;</span>
<a href="#l47.11"></a><span id="l47.11" class="difflineplus">+&lt;!-- import-globals-from mailWindow.js --&gt;</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineplus">+</span>
<a href="#l47.13"></a><span id="l47.13"> &lt;!DOCTYPE window [</span>
<a href="#l47.14"></a><span id="l47.14"> &lt;!ENTITY % messengerDTD SYSTEM &quot;chrome://messenger/locale/messenger.dtd&quot; &gt;</span>
<a href="#l47.15"></a><span id="l47.15"> %messengerDTD;</span>
<a href="#l47.16"></a><span id="l47.16"> ]&gt;</span>
<a href="#l47.17"></a><span id="l47.17"> </span>
<a href="#l47.18"></a><span id="l47.18"> &lt;bindings id=&quot;threadPaneColumnPickerBindings&quot;</span>
<a href="#l47.19"></a><span id="l47.19">           xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l47.20"></a><span id="l47.20">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mail/base/content/toolbarIconColor.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mail/base/content/toolbarIconColor.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l48.4"></a><span id="l48.4"> /**</span>
<a href="#l48.5"></a><span id="l48.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l48.6"></a><span id="l48.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l48.7"></a><span id="l48.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l48.8"></a><span id="l48.8"> </span>
<a href="#l48.9"></a><span id="l48.9" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l48.10"></a><span id="l48.10" class="difflineplus">+</span>
<a href="#l48.11"></a><span id="l48.11"> var ToolbarIconColor = {</span>
<a href="#l48.12"></a><span id="l48.12">   init() {</span>
<a href="#l48.13"></a><span id="l48.13">     this._initialized = true;</span>
<a href="#l48.14"></a><span id="l48.14"> </span>
<a href="#l48.15"></a><span id="l48.15">     window.addEventListener(&quot;activate&quot;, this);</span>
<a href="#l48.16"></a><span id="l48.16">     window.addEventListener(&quot;deactivate&quot;, this);</span>
<a href="#l48.17"></a><span id="l48.17">     Services.obs.addObserver(this, &quot;lightweight-theme-styling-update&quot;);</span>
<a href="#l48.18"></a><span id="l48.18"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mail/base/content/utilityOverlay.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mail/base/content/utilityOverlay.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l49.4"></a><span id="l49.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l49.5"></a><span id="l49.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l49.6"></a><span id="l49.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l49.7"></a><span id="l49.7"> </span>
<a href="#l49.8"></a><span id="l49.8" class="difflineplus">+/* import-globals-from mailWindow.js */</span>
<a href="#l49.9"></a><span id="l49.9" class="difflineplus">+</span>
<a href="#l49.10"></a><span id="l49.10"> ChromeUtils.import(&quot;resource://gre/modules/PlacesUtils.jsm&quot;);</span>
<a href="#l49.11"></a><span id="l49.11"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l49.12"></a><span id="l49.12"> </span>
<a href="#l49.13"></a><span id="l49.13"> var gShowBiDi = false;</span>
<a href="#l49.14"></a><span id="l49.14"> </span>
<a href="#l49.15"></a><span id="l49.15"> function getBrowserURL() {</span>
<a href="#l49.16"></a><span id="l49.16">   return AppConstants.BROWSER_CHROME_URL;</span>
<a href="#l49.17"></a><span id="l49.17"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

