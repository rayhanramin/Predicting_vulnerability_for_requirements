<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25792:029ec755385fec42b74065b5b67781f5eb18f74a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 029ec755385fec42b74065b5b67781f5eb18f74a" />
<meta property="og:url" content="/comm-central/rev/029ec755385fec42b74065b5b67781f5eb18f74a" />
<meta property="og:description" content="Bug 1521016 - remove threadPaneColumnPicker and instead use customzied built-in thread-pane-treecols and thread-pane-treecolpicker for the purpose. r=arshad" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 029ec755385fec42b74065b5b67781f5eb18f74a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/029ec755385fec42b74065b5b67781f5eb18f74a">shortlog</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/029ec755385fec42b74065b5b67781f5eb18f74a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a">files</a> |
changeset |
<a href="/comm-central/raw-rev/029ec755385fec42b74065b5b67781f5eb18f74a">raw</a>  | <a href="/comm-central/archive/029ec755385fec42b74065b5b67781f5eb18f74a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1521016">Bug 1521016</a> - remove threadPaneColumnPicker and instead use customzied built-in thread-pane-treecols and thread-pane-treecolpicker for the purpose. r=arshad
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#103;&#110;&#117;&#115;&#32;&#77;&#101;&#108;&#105;&#110;&#32;&#60;&#109;&#107;&#109;&#101;&#108;&#105;&#110;&#43;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#105;&#107;&#105;&#46;&#102;&#105;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 07 Feb 2019 22:30:51 +0100</td></tr>

<tr>
 <td>changeset 25792</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/029ec755385fec42b74065b5b67781f5eb18f74a">029ec755385fec42b74065b5b67781f5eb18f74a</a></td>
</tr>



<tr>
<td>parent 25791</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b8273f79234eae97ff8b1527e5ab8a5380a1f1ad">b8273f79234eae97ff8b1527e5ab8a5380a1f1ad</a>
</td>
</tr>

<tr>
<td>child 25793</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c77b06a780fba9dca82b265cdfb89ad844ee2a78">c77b06a780fba9dca82b265cdfb89ad844ee2a78</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=029ec755385fec42b74065b5b67781f5eb18f74a">15477</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 07 Feb 2019 21:52:00 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@029ec755385f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=029ec755385fec42b74065b5b67781f5eb18f74a">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=029ec755385fec42b74065b5b67781f5eb18f74a&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=029ec755385fec42b74065b5b67781f5eb18f74a&newProject=comm-central&newRevision=34d1e86140429a40af1cd0cc352541530f744188&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=029ec755385fec42b74065b5b67781f5eb18f74a&newProject=comm-central&newRevision=34d1e86140429a40af1cd0cc352541530f744188&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=029ec755385fec42b74065b5b67781f5eb18f74a&newProject=comm-central&newRevision=34d1e86140429a40af1cd0cc352541530f744188&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28arshad%29&revcount=50">arshad</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1521016">1521016</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1521016">Bug 1521016</a> - remove threadPaneColumnPicker and instead use customzied built-in thread-pane-treecols and thread-pane-treecolpicker for the purpose. r=arshad</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailContextMenus.js">mail/base/content/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailWidgets.js">mail/base/content/mailWidgets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailWidgets.js">file</a> |
<a href="/comm-central/annotate/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailWidgets.js">annotate</a> |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailWidgets.js">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailWidgets.js">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/mailWidgets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/messenger.xul">mail/base/content/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/messenger.xul">file</a> |
<a href="/comm-central/annotate/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/messenger.xul">annotate</a> |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/messenger.xul">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/messenger.xul">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/tabmail.css">mail/base/content/tabmail.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/tabmail.css">file</a> |
<a href="/comm-central/annotate/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/tabmail.css">annotate</a> |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/tabmail.css">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/tabmail.css">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/tabmail.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/threadPaneColumnPicker.xml">mail/base/content/threadPaneColumnPicker.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/threadPaneColumnPicker.xml">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/threadPaneColumnPicker.xml">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/content/threadPaneColumnPicker.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/jar.mn">mail/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/jar.mn">file</a> |
<a href="/comm-central/annotate/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/jar.mn">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/locales/en-US/chrome/messenger/messenger.dtd">mail/locales/en-US/chrome/messenger/messenger.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a/mail/locales/en-US/chrome/messenger/messenger.dtd">file</a> |
<a href="/comm-central/annotate/029ec755385fec42b74065b5b67781f5eb18f74a/mail/locales/en-US/chrome/messenger/messenger.dtd">annotate</a> |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/locales/en-US/chrome/messenger/messenger.dtd">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/locales/en-US/chrome/messenger/messenger.dtd">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/locales/en-US/chrome/messenger/messenger.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-columns.js">mail/test/mozmill/folder-display/test-columns.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-columns.js">file</a> |
<a href="/comm-central/annotate/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-columns.js">annotate</a> |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-columns.js">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-columns.js">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-columns.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">file</a> |
<a href="/comm-central/annotate/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">annotate</a> |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/shared-modules/test-window-helpers.js">mail/test/mozmill/shared-modules/test-window-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/shared-modules/test-window-helpers.js">file</a> |
<a href="/comm-central/annotate/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/shared-modules/test-window-helpers.js">annotate</a> |
<a href="/comm-central/diff/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/shared-modules/test-window-helpers.js">diff</a> |
<a href="/comm-central/comparison/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/shared-modules/test-window-helpers.js">comparison</a> |
<a href="/comm-central/log/029ec755385fec42b74065b5b67781f5eb18f74a/mail/test/mozmill/shared-modules/test-window-helpers.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailContextMenus.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailContextMenus.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -54,16 +54,25 @@ function mailContextOnPopupHiding(aEvent</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   let wasInThreadPane = gContextMenu.inThreadPane;</span>
<a href="#l1.6"></a><span id="l1.6">   gContextMenu = null;</span>
<a href="#l1.7"></a><span id="l1.7">   if (wasInThreadPane)</span>
<a href="#l1.8"></a><span id="l1.8">     RestoreSelectionWithoutContentLoad(GetThreadTree());</span>
<a href="#l1.9"></a><span id="l1.9"> }</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> function fillMailContextMenu(event) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+  let target = document.popupNode;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  if (target.localName == &quot;treecol&quot;) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+    let treeColPicker = target.parentNode.querySelector(&quot;treecolpicker&quot;);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    let popup = treeColPicker.querySelector(`menupopup[anonid=&quot;popup&quot;]`);</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+    treeColPicker.buildPopup(popup);</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+    popup.openPopup(target, &quot;after_start&quot;, 0, 0, true);</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+    return false;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+  }</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+</span>
<a href="#l1.21"></a><span id="l1.21">   // If the popupshowing was for a submenu, we don't need to do anything.</span>
<a href="#l1.22"></a><span id="l1.22">   if (event.target != event.currentTarget)</span>
<a href="#l1.23"></a><span id="l1.23">     return true;</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">   // No menu on grouped header row currently, any command would be an implied</span>
<a href="#l1.26"></a><span id="l1.26">   // multiselect.</span>
<a href="#l1.27"></a><span id="l1.27">   if (gFolderDisplay.tree) {</span>
<a href="#l1.28"></a><span id="l1.28">     let row = gFolderDisplay.tree.getRowAt(event.clientX, event.clientY);</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineat">@@ -283,23 +292,20 @@ function folderPaneOnPopupHiding() {</span>
<a href="#l1.30"></a><span id="l1.30">   RestoreSelectionWithoutContentLoad(document.getElementById(&quot;folderTree&quot;));</span>
<a href="#l1.31"></a><span id="l1.31"> }</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33"> /* eslint-disable complexity */</span>
<a href="#l1.34"></a><span id="l1.34"> function fillFolderPaneContextMenu(aEvent) {</span>
<a href="#l1.35"></a><span id="l1.35">   let target = document.popupNode;</span>
<a href="#l1.36"></a><span id="l1.36">   // If a column header was clicked, show the column picker.</span>
<a href="#l1.37"></a><span id="l1.37">   if (target.localName == &quot;treecol&quot;) {</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-    let treecols = target.parentNode;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-    let treeColPicker = treecols.querySelector(&quot;treecolpicker&quot;);</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-    if (treeColPicker) {</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-      let popup = document.getAnonymousElementByAttribute(treeColPicker, &quot;anonid&quot;, &quot;popup&quot;);</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-      treeColPicker.buildPopup(popup);</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-      popup.openPopup(target, &quot;after_start&quot;, 0, 0, true);</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-    }</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+    let treeColPicker = target.parentNode.querySelector(&quot;treecolpicker&quot;);</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+    let popup = treeColPicker.querySelector(`menupopup[anonid=&quot;popup&quot;]`);</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+    treeColPicker.buildPopup(popup);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+    popup.openPopup(target, &quot;after_start&quot;, 0, 0, true);</span>
<a href="#l1.49"></a><span id="l1.49">     return false;</span>
<a href="#l1.50"></a><span id="l1.50">   }</span>
<a href="#l1.51"></a><span id="l1.51"> </span>
<a href="#l1.52"></a><span id="l1.52">   // Do not show menu if rows are selected.</span>
<a href="#l1.53"></a><span id="l1.53">   var bundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l1.54"></a><span id="l1.54">   var folders = gFolderTreeView.getSelectedFolders();</span>
<a href="#l1.55"></a><span id="l1.55">   if (!folders.length)</span>
<a href="#l1.56"></a><span id="l1.56">     return false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/mailWidgets.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -3,16 +3,21 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.5"></a><span id="l2.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> /* global MozXULElement */</span>
<a href="#l2.8"></a><span id="l2.8"> /* global openUILink */</span>
<a href="#l2.9"></a><span id="l2.9"> /* global MessageIdClick */</span>
<a href="#l2.10"></a><span id="l2.10"> /* global onClickEmailStar */</span>
<a href="#l2.11"></a><span id="l2.11"> /* global onClickEmailPresence */</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+/* global gFolderDisplay */</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+var {MailUtils} = ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+var {DBViewWrapper} = ChromeUtils.import(&quot;resource:///modules/DBViewWrapper.jsm&quot;);</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> class MozMailHeaderfield extends MozXULElement {</span>
<a href="#l2.19"></a><span id="l2.19">   connectedCallback() {</span>
<a href="#l2.20"></a><span id="l2.20">     this.setAttribute(&quot;context&quot;, &quot;copyPopup&quot;);</span>
<a href="#l2.21"></a><span id="l2.21">     this.classList.add(&quot;headerValue&quot;);</span>
<a href="#l2.22"></a><span id="l2.22">   }</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">   set headerValue(val) {</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineat">@@ -38,17 +43,16 @@ class MozMailHeaderfieldTags extends Moz</span>
<a href="#l2.26"></a><span id="l2.26">     this.classList.add(&quot;headerValue&quot;);</span>
<a href="#l2.27"></a><span id="l2.27">   }</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29">   set headerValue(val) {</span>
<a href="#l2.30"></a><span id="l2.30">     return this.buildTags(val);</span>
<a href="#l2.31"></a><span id="l2.31">   }</span>
<a href="#l2.32"></a><span id="l2.32"> </span>
<a href="#l2.33"></a><span id="l2.33">   buildTags(tags) {</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-    var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l2.35"></a><span id="l2.35">     // tags contains a list of actual tag names (not the keys), delimited by spaces</span>
<a href="#l2.36"></a><span id="l2.36">     // each tag name is encoded.</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38">     // remove any existing tag items we've appended to the list</span>
<a href="#l2.39"></a><span id="l2.39">     while (this.hasChildNodes()) {</span>
<a href="#l2.40"></a><span id="l2.40">       this.lastChild.remove();</span>
<a href="#l2.41"></a><span id="l2.41">     }</span>
<a href="#l2.42"></a><span id="l2.42"> </span>
<a href="#l2.43"></a><span id="l2.43" class="difflineat">@@ -293,18 +297,188 @@ class MozTreecolImage extends customElem</span>
<a href="#l2.44"></a><span id="l2.44"> </span>
<a href="#l2.45"></a><span id="l2.45">     if (src != null) {</span>
<a href="#l2.46"></a><span id="l2.46">       this.image.setAttribute(&quot;src&quot;, src);</span>
<a href="#l2.47"></a><span id="l2.47">     } else {</span>
<a href="#l2.48"></a><span id="l2.48">       this.image.removeAttribute(&quot;src&quot;);</span>
<a href="#l2.49"></a><span id="l2.49">     }</span>
<a href="#l2.50"></a><span id="l2.50">   }</span>
<a href="#l2.51"></a><span id="l2.51"> }</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+customElements.define(&quot;treecol-image&quot;, MozTreecolImage, { extends: &quot;treecol&quot; });</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+/**</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+ * Class extending treecols. This features a customized treecolpicker that</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+ * features a menupopup with more items than the standard one.</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+ * @augments {MozTreecols}</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+ */</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+class MozThreadPaneTreecols extends customElements.get(&quot;treecols&quot;) {</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+  connectedCallback() {</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+    if (this.delayConnectedCallback()) {</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+      return;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+    }</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+    let treecolpicker = this.querySelector(&quot;treecolpicker:not([is]&quot;);</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+    // Can't change the super treecolpicker by setting</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+    // is=&quot;thread-pane-treecolpicker&quot; since that needs to be there at the</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+    // parsing stage to take effect.</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+    // So, remove the existing treecolpicker, and add a new one.</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+    if (treecolpicker) {</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+      treecolpicker.remove();</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+    }</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+    if (!this.querySelector(&quot;treecolpicker[is=thread-pane-treecolpicker]&quot;)) {</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+      this.appendChild(MozXULElement.parseXULToFragment(`</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+        &lt;treecolpicker is=&quot;thread-pane-treecolpicker&quot; class=&quot;treecol-image&quot; fixed=&quot;true&quot;&gt;&lt;/treecolpicker&gt;</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+      `));</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+    }</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+    // Exceptionally apply super late, so we get the other goodness from there</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+    // now that the treecolpicker is corrected.</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+    super.connectedCallback();</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+  }</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+}</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+customElements.define(&quot;thread-pane-treecols&quot;, MozThreadPaneTreecols, { extends: &quot;treecols&quot; });</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+/**</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+ * Class extending treecolpicker. This implements UI to apply column settings</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+ * of the current thread pane to other mail folders too.</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+ * @augments {MozTreecolPicker}</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+ */</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+class MozThreadPaneTreeColpicker extends customElements.get(&quot;treecolpicker&quot;) {</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+  connectedCallback() {</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+    super.connectedCallback();</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+    if (this.delayConnectedCallback()) {</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+      return;</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+    }</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+    let popup = this.querySelector(`menupopup[anonid=&quot;popup&quot;]`);</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+    // We'll add an &quot;Apply columns to...&quot; menu</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+    popup.appendChild(MozXULElement.parseXULToFragment(`</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+      &lt;menu class=&quot;applyTo-menu&quot; label=&quot;&amp;columnPicker.applyTo.label;&quot;&gt;</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+        &lt;menupopup&gt;</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+          &lt;menu class=&quot;applyToFolder-menu&quot; label=&quot;&amp;columnPicker.applyToFolder.label;&quot;&gt;</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+            &lt;menupopup class=&quot;applyToFolder&quot; type=&quot;folder&quot; showFileHereLabel=&quot;true&quot; position=&quot;start_before&quot;&gt;&lt;/menupopup&gt;</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineplus">+          &lt;/menu&gt;</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineplus">+          &lt;menu class=&quot;applyToFolderAndChildren-menu&quot; label=&quot;&amp;columnPicker.applyToFolderAndChildren.label;&quot;&gt;</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineplus">+            &lt;menupopup class=&quot;applyToFolderAndChildren&quot; type=&quot;folder&quot; showFileHereLabel=&quot;true&quot; showAccountsFileHere=&quot;true&quot; position=&quot;start_before&quot;&gt;&lt;/menupopup&gt;</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+          &lt;/menu&gt;</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+        &lt;/menupopup&gt;</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+      &lt;/menu&gt;</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+    `, [&quot;chrome://messenger/locale/messenger.dtd&quot;]));</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+    let confirmApply = (destFolder, useChildren) =&gt; {</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+      // Confirm the action with the user.</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineplus">+      let bundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+      let title = (useChildren) ?</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+        &quot;threadPane.columnPicker.confirmFolder.withChildren.title&quot; :</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+        &quot;threadPane.columnPicker.confirmFolder.noChildren.title&quot;;</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+      let confirmed = Services.prompt.confirm(null, title,</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+        bundle.getFormattedString(title, [destFolder.prettyName]));</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineplus">+      if (confirmed) {</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+        this._applyColumns(destFolder, useChildren);</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+      }</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineplus">+    };</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineplus">+</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineplus">+    let applyToFolderMenu = this.querySelector(&quot;.applyToFolder-menu&quot;);</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+    applyToFolderMenu.addEventListener(&quot;command&quot;, (event) =&gt; {</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+      confirmApply(event.originalTarget._folder, false);</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+    });</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineplus">+    let applyToFolderAndChildrenMenu = this.querySelector(&quot;.applyToFolderAndChildren-menu&quot;);</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+    applyToFolderAndChildrenMenu.addEventListener(&quot;command&quot;, (event) =&gt; {</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+      confirmApply(event.originalTarget._folder, true);</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+    });</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+  }</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineplus">+</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+  // XXX: this shouldn't need to be overridden. ATM, the removal of children</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+  // while aPopup.childNodes.length &gt; 2 is forcing us. We have three since we</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+  // add one menu.</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+  /** @override */</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+  buildPopup(aPopup) {</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+    // We no longer cache the picker content, remove the old content related to</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineplus">+    // the cols - menuitem and separator should stay.</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineplus">+    this.querySelectorAll(&quot;[colindex]&quot;).forEach((e) =&gt; { e.remove(); });</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineplus">+</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineplus">+    var refChild = aPopup.firstChild;</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineplus">+</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineplus">+    var tree = this.parentNode.parentNode;</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineplus">+    for (var currCol = tree.columns.getFirstColumn(); currCol; currCol = currCol.getNext()) {</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineplus">+      // Construct an entry for each column in the row, unless</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineplus">+      // it is not being shown.</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineplus">+      var currElement = currCol.element;</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineplus">+      if (!currElement.hasAttribute(&quot;ignoreincolumnpicker&quot;)) {</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineplus">+        var popupChild = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineplus">+        popupChild.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineplus">+        var columnName = currElement.getAttribute(&quot;display&quot;) ||</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineplus">+          currElement.getAttribute(&quot;label&quot;);</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+        popupChild.setAttribute(&quot;label&quot;, columnName);</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineplus">+        popupChild.setAttribute(&quot;colindex&quot;, currCol.index);</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineplus">+        if (currElement.getAttribute(&quot;hidden&quot;) != &quot;true&quot;)</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineplus">+          popupChild.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineplus">+        if (currCol.primary)</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineplus">+          popupChild.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineplus">+        aPopup.insertBefore(popupChild, refChild);</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineplus">+      }</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineplus">+    }</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineplus">+</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineplus">+    var hidden = !tree.enableColumnDrag;</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineplus">+    this.querySelectorAll(&quot;:not([colindex])&quot;).forEach((e) =&gt; { e.hidden = hidden; });</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineplus">+  }</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineplus">+</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineplus">+  _applyColumns(destFolder, useChildren) {</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+    // Get the current folder's column state, plus the &quot;swapped&quot; column</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+    // state, which swaps &quot;From&quot; and &quot;Recipient&quot; if only one is shown.</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineplus">+    // This is useful for copying an incoming folder's columns to an</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineplus">+    // outgoing folder, or vice versa.</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineplus">+    let colState = gFolderDisplay.getColumnStates();</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineplus">+</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineplus">+    let myColStateString = JSON.stringify(colState);</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineplus">+    let swappedColStateString;</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineplus">+    if (colState.senderCol.visible != colState.recipientCol.visible) {</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineplus">+      let tmp = colState.senderCol;</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineplus">+      colState.senderCol = colState.recipientCol;</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineplus">+      colState.recipientCol = tmp;</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineplus">+      swappedColStateString = JSON.stringify(colState);</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineplus">+    } else {</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineplus">+      swappedColStateString = myColStateString;</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineplus">+    }</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineplus">+    let isOutgoing = function(folder) {</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineplus">+      return folder.isSpecialFolder(</span>
<a href="#l2.191"></a><span id="l2.191" class="difflineplus">+        DBViewWrapper.prototype.OUTGOING_FOLDER_FLAGS, true</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineplus">+      );</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineplus">+    };</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineplus">+</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineplus">+    let amIOutgoing = isOutgoing(gFolderDisplay.displayedFolder);</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineplus">+</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineplus">+    let colStateString = function(folder) {</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineplus">+      return (isOutgoing(folder) == amIOutgoing ? myColStateString :</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineplus">+        swappedColStateString);</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineplus">+    };</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineplus">+</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineplus">+    // Now propagate appropriately...</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineplus">+    const propName = gFolderDisplay.PERSISTED_COLUMN_PROPERTY_NAME;</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineplus">+    if (useChildren) {</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineplus">+      // Generate an observer notification when we have finished</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineplus">+      // configuring all folders.  This is currently done for the benefit</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineplus">+      // of our mozmill tests.</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineplus">+      let observerCallback = function() {</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineplus">+        Services.obs.notifyObservers(gFolderDisplay.displayedFolder,</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineplus">+          &quot;msg-folder-columns-propagated&quot;);</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineplus">+      };</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineplus">+      MailUtils.setStringPropertyOnFolderAndDescendents(</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineplus">+        propName, colStateString, destFolder, observerCallback</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineplus">+      );</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+    } else {</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineplus">+      destFolder.setStringProperty(propName, colStateString(destFolder));</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineplus">+      // null out to avoid memory bloat</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineplus">+      destFolder.msgDatabase = null;</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineplus">+    }</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineplus">+  }</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineplus">+}</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineplus">+customElements.define(&quot;thread-pane-treecolpicker&quot;, MozThreadPaneTreeColpicker, { extends: &quot;treecolpicker&quot; });</span>
<a href="#l2.223"></a><span id="l2.223"> </span>
<a href="#l2.224"></a><span id="l2.224"> customElements.define(&quot;mail-headerfield&quot;, MozMailHeaderfield);</span>
<a href="#l2.225"></a><span id="l2.225"> customElements.define(&quot;mail-urlfield&quot;, MozMailUrlfield);</span>
<a href="#l2.226"></a><span id="l2.226"> customElements.define(&quot;mail-tagfield&quot;, MozMailHeaderfieldTags);</span>
<a href="#l2.227"></a><span id="l2.227"> customElements.define(&quot;mail-newsgroup&quot;, MozMailNewsgroup);</span>
<a href="#l2.228"></a><span id="l2.228"> customElements.define(&quot;mail-newsgroups-headerfield&quot;, MozMailNewsgroupsHeaderfield);</span>
<a href="#l2.229"></a><span id="l2.229"> customElements.define(&quot;mail-messageid&quot;, MozMailMessageid);</span>
<a href="#l2.230"></a><span id="l2.230"> customElements.define(&quot;mail-emailaddress&quot;, MozMailEmailaddress);</span>
<a href="#l2.231"></a><span id="l2.231"> customElements.define(&quot;mail-emailheaderfield&quot;, MozMailEmailheaderfield);</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineminus">-customElements.define(&quot;treecol-image&quot;, MozTreecolImage, { extends: &quot;treecol&quot; });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/messenger.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/messenger.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -553,17 +553,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">                           class=&quot;plain&quot;</span>
<a href="#l3.5"></a><span id="l3.5">                           lastfoldersent=&quot;false&quot;</span>
<a href="#l3.6"></a><span id="l3.6">                           keepcurrentinview=&quot;true&quot;</span>
<a href="#l3.7"></a><span id="l3.7">                           disableKeyNavigation=&quot;true&quot;</span>
<a href="#l3.8"></a><span id="l3.8">                           context=&quot;mailContext&quot;</span>
<a href="#l3.9"></a><span id="l3.9">                           onkeydown=&quot;ThreadPaneKeyDown(event);&quot;</span>
<a href="#l3.10"></a><span id="l3.10">                           onselect=&quot;ThreadPaneSelectionChanged();&quot;</span>
<a href="#l3.11"></a><span id="l3.11">                           &gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-                      &lt;treecols id=&quot;threadCols&quot; pickertooltiptext=&quot;&amp;columnChooser2.tooltip;&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                      &lt;treecols id=&quot;threadCols&quot; is=&quot;thread-pane-treecols&quot; pickertooltiptext=&quot;&amp;columnChooser2.tooltip;&quot;&gt;</span>
<a href="#l3.14"></a><span id="l3.14">                         &lt;treecol is=&quot;treecol-image&quot; id=&quot;threadCol&quot; fixed=&quot;true&quot; cycler=&quot;true&quot;</span>
<a href="#l3.15"></a><span id="l3.15">                                  class=&quot;treecol-image threadColumnHeader&quot; currentView=&quot;unthreaded&quot;</span>
<a href="#l3.16"></a><span id="l3.16">                                  label=&quot;&amp;threadColumn.label;&quot; tooltiptext=&quot;&amp;threadColumn2.tooltip;&quot;/&gt;</span>
<a href="#l3.17"></a><span id="l3.17">                         &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l3.18"></a><span id="l3.18">                         &lt;treecol is=&quot;treecol-image&quot; id=&quot;flaggedCol&quot; fixed=&quot;true&quot; cycler=&quot;true&quot;</span>
<a href="#l3.19"></a><span id="l3.19">                                  class=&quot;treecol-image flagColumnHeader&quot;</span>
<a href="#l3.20"></a><span id="l3.20">                                  label=&quot;&amp;starredColumn.label;&quot; tooltiptext=&quot;&amp;starredColumn2.tooltip;&quot;/&gt;</span>
<a href="#l3.21"></a><span id="l3.21">                         &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/tabmail.css</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/tabmail.css</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -67,17 +67,8 @@</span>
<a href="#l4.4"></a><span id="l4.4"> }</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> .tab-throbber:not([busy]):not([thinking]),</span>
<a href="#l4.7"></a><span id="l4.7"> .tab-throbber[busy] + .tab-icon-image,</span>
<a href="#l4.8"></a><span id="l4.8"> .tab-throbber[thinking] + .tab-icon-image,</span>
<a href="#l4.9"></a><span id="l4.9"> .tab-throbber[busy][thinking] + .tab-icon-image {</span>
<a href="#l4.10"></a><span id="l4.10">   display: none;</span>
<a href="#l4.11"></a><span id="l4.11"> }</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-/**</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">- * Override the thread pane column picker.</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">- * We do it here because we don't want it in the Search dialog.</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">- */</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-#threadCols &gt; treecolpicker {</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/content/threadPaneColumnPicker.xml#threadPaneColumnPicker&quot;);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">deleted file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- a/mail/base/content/threadPaneColumnPicker.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ /dev/null</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -1,243 +0,0 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">-&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">-  - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">-  - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">-&lt;!-- import-globals-from folderDisplay.js --&gt;</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">-&lt;!-- import-globals-from mailWindow.js --&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-&lt;!DOCTYPE window [</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-&lt;!ENTITY % messengerDTD SYSTEM &quot;chrome://messenger/locale/messenger.dtd&quot; &gt;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-%messengerDTD;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-]&gt;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-&lt;bindings id=&quot;threadPaneColumnPickerBindings&quot;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-  &lt;!--</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-    - Because the columnpicker is implicitly created by the treecols binding</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-    - and it does not pass anything in, we are compelled to override the binding</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-    - (via CSS rules in messenger.css) in order to add custom menu options to</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-    - the list.</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-    -</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-    - This is now a cut-paste-modify of the original tree.xml#columnpicker</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-    - since we had to override everything save for the accessibleType anyways.</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    --&gt;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-  &lt;binding id=&quot;threadPaneColumnPicker&quot; display=&quot;xul:button&quot; role=&quot;xul:button&quot;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-           extends=&quot;chrome://global/content/bindings/general.xml#basecontrol&quot;&gt;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-      &lt;xul:image class=&quot;tree-columnpicker-icon&quot;/&gt;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-      &lt;xul:menupopup anonid=&quot;popup&quot;&gt;</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-        &lt;xul:menuseparator anonid=&quot;menuseparator&quot;/&gt;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-        &lt;xul:menuitem anonid=&quot;reset&quot; label=&quot;&amp;columnPicker.resetToInbox.label;&quot;/&gt;</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-        &lt;xul:menu anonid=&quot;applyTo-menu&quot;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-                  label=&quot;&amp;columnPicker.applyTo.label;&quot;&gt;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-          &lt;xul:menupopup&gt;</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-            &lt;xul:menu anonid=&quot;applyToFolder-menu&quot;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-                      label=&quot;&amp;columnPicker.applyToFolder.label;&quot;&gt;</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-              &lt;xul:menupopup anonid=&quot;applyToFolder&quot;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-                             type=&quot;folder&quot;</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-                             showFileHereLabel=&quot;true&quot;</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-                             position=&quot;start_before&quot;</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-                             /&gt;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-            &lt;/xul:menu&gt;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-            &lt;xul:menu anonid=&quot;applyToFolderAndChildren-menu&quot;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-                      label=&quot;&amp;columnPicker.applyToFolderAndChildren.label;&quot;&gt;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-              &lt;xul:menupopup anonid=&quot;applyToFolderAndChildren&quot;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-                             type=&quot;folder&quot;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-                             showFileHereLabel=&quot;true&quot;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-                             showAccountsFileHere=&quot;true&quot;</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-                             position=&quot;start_before&quot;/&gt;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-            &lt;/xul:menu&gt;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-          &lt;/xul:menupopup&gt;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-        &lt;/xul:menu&gt;</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-      &lt;/xul:menupopup&gt;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-    &lt;implementation&gt;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-      &lt;method name=&quot;buildPopup&quot;&gt;</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-        &lt;parameter name=&quot;aPopup&quot;/&gt;</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-          while (aPopup.childNodes.length &gt; 3)</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-            aPopup.firstChild.remove();</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-          let refChild = aPopup.firstChild;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-          let tree = this.parentNode.parentNode;</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-          for (let currCol = tree.columns.getFirstColumn(); currCol;</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-               currCol = currCol.getNext()) {</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-            // Construct an entry for each column in the row, unless</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-            // it is not being shown.</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-            let currElement = currCol.element;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-            if (!currElement.hasAttribute(&quot;ignoreincolumnpicker&quot;)) {</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-              let popupChild = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-              popupChild.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-              let columnName = currElement.getAttribute(&quot;display&quot;) ||</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-                               currElement.getAttribute(&quot;label&quot;);</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-              popupChild.setAttribute(&quot;label&quot;, columnName);</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-              popupChild.setAttribute(&quot;colindex&quot;, currCol.index);</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-              if (currElement.getAttribute(&quot;hidden&quot;) != &quot;true&quot;)</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-                popupChild.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-              if (currCol.primary)</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-                popupChild.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-              aPopup.insertBefore(popupChild, refChild);</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-            }</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-          }</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-      &lt;method name=&quot;_showPopup&quot;&gt;</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-          let popup = document.getAnonymousElementByAttribute(</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-            this, &quot;anonid&quot;, &quot;popup&quot;</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-          );</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-          this.buildPopup(popup);</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-          popup.openPopup(this, &quot;after_end&quot;);</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-      &lt;method name=&quot;_toggleColumn&quot;&gt;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-        &lt;parameter name=&quot;aColIndex&quot;/&gt;</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineminus">-          let tree = this.parentNode.parentNode;</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineminus">-          let column = tree.columns[aColIndex];</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineminus">-          if (column) {</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineminus">-            let element = column.element;</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineminus">-            if (element.getAttribute(&quot;hidden&quot;) == &quot;true&quot;)</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineminus">-              element.setAttribute(&quot;hidden&quot;, &quot;false&quot;);</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-            else</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-              element.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-          }</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineminus">-</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineminus">-      &lt;method name=&quot;_resetColumns&quot;&gt;</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineminus">-          let columnStates =</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-            gFolderDisplay._getDefaultColumnsForCurrentFolder();</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineminus">-          gFolderDisplay.setColumnStates(columnStates, true);</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineminus">-      &lt;method name=&quot;_useChildren&quot;&gt;</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-        &lt;parameter name=&quot;aTarget&quot;/&gt;</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineminus">-          // Let's figure out which of the actions they chose by walking the</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-          // parent chain until we find one of them.</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-          let noChildrenPopup = document.getAnonymousElementByAttribute(</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-            this, &quot;anonid&quot;, &quot;applyToFolder&quot;</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-          );</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-          let yesChildrenPopup = document.getAnonymousElementByAttribute(</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-            this, &quot;anonid&quot;, &quot;applyToFolderAndChildren&quot;</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-          );</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-          let parent = aTarget.parentNode;</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-          while (parent != noChildrenPopup &amp;&amp; parent != yesChildrenPopup) {</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-            parent = parent.parentNode;</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-          }</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineminus">-          return parent == yesChildrenPopup;</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineminus">-</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineminus">-      &lt;method name=&quot;_applyColumns&quot;&gt;</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-        &lt;parameter name=&quot;aDestFolder&quot;/&gt;</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-        &lt;parameter name=&quot;aUseChildren&quot;/&gt;</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-          // Get the current folder's column state, plus the &quot;swapped&quot; column</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-          // state, which swaps &quot;From&quot; and &quot;Recipient&quot; if only one is shown.</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineminus">-          // This is useful for copying an incoming folder's columns to an</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-          // outgoing folder, or vice versa.</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-          let colState = gFolderDisplay.getColumnStates();</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineminus">-          let myColStateString = JSON.stringify(colState);</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineminus">-          let swappedColStateString;</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineminus">-          if (colState.senderCol.visible != colState.recipientCol.visible) {</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineminus">-            let tmp = colState.senderCol;</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineminus">-            colState.senderCol = colState.recipientCol;</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-            colState.recipientCol = tmp;</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineminus">-            swappedColStateString = JSON.stringify(colState);</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-          } else {</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-            swappedColStateString = myColStateString;</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineminus">-          }</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineminus">-          function isOutgoing(folder) {</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineminus">-            return folder.isSpecialFolder(</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-              DBViewWrapper.prototype.OUTGOING_FOLDER_FLAGS, true</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-            );</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineminus">-          }</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineminus">-</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineminus">-          let amIOutgoing = isOutgoing(gFolderDisplay.displayedFolder);</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineminus">-          function colStateString(folder) {</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineminus">-            return (isOutgoing(folder) == amIOutgoing ? myColStateString :</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineminus">-                    swappedColStateString);</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineminus">-          }</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineminus">-</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineminus">-          // Now propagate appropriately...</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineminus">-          const propName = gFolderDisplay.PERSISTED_COLUMN_PROPERTY_NAME;</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineminus">-          if (aUseChildren) {</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineminus">-            // Generate an observer notification when we have finished</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineminus">-            // configuring all folders.  This is currently done for the benefit</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineminus">-            // of our mozmill tests.</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineminus">-            let observerCallback = function() {</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineminus">-              Services.obs.notifyObservers(gFolderDisplay.displayedFolder,</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineminus">-                                           &quot;msg-folder-columns-propagated&quot;);</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineminus">-            };</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineminus">-            MailUtils.setStringPropertyOnFolderAndDescendents(</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineminus">-              propName, colStateString, aDestFolder, observerCallback</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-            );</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineminus">-          } else {</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineminus">-            aDestFolder.setStringProperty(propName,</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineminus">-                                          colStateString(aDestFolder));</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineminus">-            // null out to avoid memory bloat</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineminus">-            aDestFolder.msgDatabase = null;</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineminus">-          }</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineminus">-      &lt;handler event=&quot;command&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineminus">-        const {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineminus">-</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineminus">-        // Are they clicking on our header to get us to show the column list?</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineminus">-        if (event.originalTarget == this) {</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineminus">-          this._showPopup();</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineminus">-          return;</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineminus">-        }</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineminus">-</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineminus">-        // Are they clicking on one of the columns in the list?</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineminus">-        if (event.originalTarget.hasAttribute(&quot;colindex&quot;)) {</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineminus">-          this._toggleColumn(event.originalTarget.getAttribute(&quot;colindex&quot;));</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineminus">-          return;</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineminus">-        }</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineminus">-</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineminus">-        // Did they click the reset button?</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineminus">-        let resetMenu = document.getAnonymousElementByAttribute(</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineminus">-                          this, &quot;anonid&quot;, &quot;reset&quot;);</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineminus">-        if (event.originalTarget == resetMenu) {</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineminus">-          this._resetColumns();</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineminus">-          return;</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineminus">-        }</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineminus">-</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineminus">-        // Otherwise an exciting action has occurred!</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineminus">-        let destFolder = event.originalTarget._folder;</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineminus">-        let useChildren = this._useChildren(event.originalTarget);</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineminus">-</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineminus">-        // Confirm the action with the user.</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineminus">-        let bundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineminus">-        let stringBase = &quot;threadPane.columnPicker.confirmFolder.&quot; +</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineminus">-          (useChildren ? &quot;withChildren.&quot; : &quot;noChildren.&quot;);</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineminus">-        let confirmed = Services.prompt.confirm(null,</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineminus">-          bundle.getString(stringBase + &quot;title&quot;),</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineminus">-          bundle.getFormattedString(stringBase + &quot;message&quot;,</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineminus">-                                    [destFolder.prettyName]));</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineminus">-        if (!confirmed)</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineminus">-          return;</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineminus">-</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineminus">-        this._applyColumns(destFolder, useChildren);</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineminus">-</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineminus">-&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/jar.mn</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/jar.mn</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -81,17 +81,16 @@ messenger.jar:</span>
<a href="#l6.4"></a><span id="l6.4">     content/messenger/search.xml                    (content/search.xml)</span>
<a href="#l6.5"></a><span id="l6.5">     content/messenger/tabmail.xml                   (content/tabmail.xml)</span>
<a href="#l6.6"></a><span id="l6.6">     content/messenger/tabmail.css                   (content/tabmail.css)</span>
<a href="#l6.7"></a><span id="l6.7">     content/messenger/statuspanel.js                (content/statuspanel.js)</span>
<a href="#l6.8"></a><span id="l6.8">     content/messenger/newTagDialog.xul              (content/newTagDialog.xul)</span>
<a href="#l6.9"></a><span id="l6.9">     content/messenger/newTagDialog.js               (content/newTagDialog.js)</span>
<a href="#l6.10"></a><span id="l6.10">     content/messenger/composerOverlay.css           (content/composerOverlay.css)</span>
<a href="#l6.11"></a><span id="l6.11">     content/messenger/threadPane.js                 (content/threadPane.js)</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    content/messenger/threadPaneColumnPicker.xml    (content/threadPaneColumnPicker.xml)</span>
<a href="#l6.13"></a><span id="l6.13">     content/messenger/protovis-r2.6-modded.js       (content/protovis-r2.6-modded.js)</span>
<a href="#l6.14"></a><span id="l6.14">     content/messenger/dark.icon.svg                 (content/dark.icon.svg)</span>
<a href="#l6.15"></a><span id="l6.15">     content/messenger/light.icon.svg                (content/light.icon.svg)</span>
<a href="#l6.16"></a><span id="l6.16"> #ifdef XP_MACOSX</span>
<a href="#l6.17"></a><span id="l6.17">     content/messenger/macMessengerMenu.js           (content/macMessengerMenu.js)</span>
<a href="#l6.18"></a><span id="l6.18"> #endif</span>
<a href="#l6.19"></a><span id="l6.19">     content/messenger/selectionsummaries.js         (content/selectionsummaries.js)</span>
<a href="#l6.20"></a><span id="l6.20">     content/messenger/multimessageview.css          (content/multimessageview.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.dtd</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.dtd</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -808,22 +808,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> &lt;!ENTITY contextWatchThreadMenu.accesskey &quot;&quot;&gt;</span>
<a href="#l7.5"></a><span id="l7.5"> &lt;!ENTITY contextSaveAs.label &quot;Save As…&quot;&gt;</span>
<a href="#l7.6"></a><span id="l7.6"> &lt;!ENTITY contextSaveAs.accesskey &quot;S&quot;&gt;</span>
<a href="#l7.7"></a><span id="l7.7"> &lt;!ENTITY contextPrint.label &quot;Print…&quot;&gt;</span>
<a href="#l7.8"></a><span id="l7.8"> &lt;!ENTITY contextPrint.accesskey &quot;P&quot;&gt;</span>
<a href="#l7.9"></a><span id="l7.9"> &lt;!ENTITY contextPrintPreview.label &quot;Print Preview&quot;&gt;</span>
<a href="#l7.10"></a><span id="l7.10"> &lt;!ENTITY contextPrintPreview.accesskey &quot;v&quot;&gt;</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-&lt;!-- Thread Pane Column Picker --&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-&lt;!-- LOCALIZATION NOTE (columnPicker.resetToInbox.label):</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-     This option in the thread pane column picker causes us to reset the</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-     customizations for the thread pane columns in this folder to their default.</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-  --&gt;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-&lt;!ENTITY columnPicker.resetToInbox.label &quot;Reset columns to default&quot;&gt;</span>
<a href="#l7.18"></a><span id="l7.18"> &lt;!-- LOCALIZATION NOTE (columnPicker.applyTo.label):</span>
<a href="#l7.19"></a><span id="l7.19">      This option in the thread pane column picker pops up a sub-menu containing</span>
<a href="#l7.20"></a><span id="l7.20">      the &quot;columnPicker.applyToFolder.label&quot; and</span>
<a href="#l7.21"></a><span id="l7.21">      &quot;columnPicker.applyToFolderAndChildren.label&quot; options. This item indicates</span>
<a href="#l7.22"></a><span id="l7.22">      a desire to apply the currently displayed set of columns to some other</span>
<a href="#l7.23"></a><span id="l7.23">      folder(s). The sub-menu items indicate whether we want to apply it to just</span>
<a href="#l7.24"></a><span id="l7.24">      a folder or also its children.</span>
<a href="#l7.25"></a><span id="l7.25">   --&gt;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineat">@@ -854,17 +848,16 @@</span>
<a href="#l7.27"></a><span id="l7.27">      in that popup is given this label to indicate that that folder should be</span>
<a href="#l7.28"></a><span id="l7.28">      selected. For example, if folder &quot;A&quot; has two children, &quot;B&quot; and &quot;C&quot;, then</span>
<a href="#l7.29"></a><span id="l7.29">      when the user hovers over &quot;A&quot;, a new popup menu will be displayed whose</span>
<a href="#l7.30"></a><span id="l7.30">      items are &quot;This folder&quot;, &quot;B&quot;, and &quot;C&quot;. This is the equivalent of the</span>
<a href="#l7.31"></a><span id="l7.31">      &quot;File here&quot; option for the move to/copy to widget.</span>
<a href="#l7.32"></a><span id="l7.32">   --&gt;</span>
<a href="#l7.33"></a><span id="l7.33"> &lt;!ENTITY columnPicker.thisFolder.label &quot;This folder&quot;&gt;</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-</span>
<a href="#l7.36"></a><span id="l7.36"> &lt;!-- Media (video/audio) controls --&gt;</span>
<a href="#l7.37"></a><span id="l7.37"> &lt;!ENTITY contextPlay.label &quot;Play&quot;&gt;</span>
<a href="#l7.38"></a><span id="l7.38"> &lt;!ENTITY contextPlay.accesskey &quot;P&quot;&gt;</span>
<a href="#l7.39"></a><span id="l7.39"> &lt;!ENTITY contextPause.label &quot;Pause&quot;&gt;</span>
<a href="#l7.40"></a><span id="l7.40"> &lt;!ENTITY contextPause.accesskey &quot;P&quot;&gt;</span>
<a href="#l7.41"></a><span id="l7.41"> &lt;!ENTITY contextMute.label &quot;Mute&quot;&gt;</span>
<a href="#l7.42"></a><span id="l7.42"> &lt;!ENTITY contextMute.accesskey &quot;M&quot;&gt;</span>
<a href="#l7.43"></a><span id="l7.43"> &lt;!ENTITY contextUnmute.label &quot;Unmute&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-columns.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-columns.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -348,78 +348,77 @@ function test_column_reordering_persists</span>
<a href="#l8.4"></a><span id="l8.4"> function invoke_column_picker_option(aActions) {</span>
<a href="#l8.5"></a><span id="l8.5">   // The treecolpicker element itself doesn't have an id, so we have to walk</span>
<a href="#l8.6"></a><span id="l8.6">   // down from the parent to find it.</span>
<a href="#l8.7"></a><span id="l8.7">   //  treadCols</span>
<a href="#l8.8"></a><span id="l8.8">   //   |- hbox                item 0</span>
<a href="#l8.9"></a><span id="l8.9">   //   |- treecolpicker   &lt;-- item 1 this is the one we want</span>
<a href="#l8.10"></a><span id="l8.10">   let threadCols = mc.window.document.getElementById(&quot;threadCols&quot;);</span>
<a href="#l8.11"></a><span id="l8.11">   let colPicker = threadCols.querySelector(&quot;treecolpicker&quot;);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  let colPickerPopup = mc.window.document.getAnonymousElementByAttribute(</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-                         colPicker, &quot;anonid&quot;, &quot;popup&quot;);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  let colPickerPopup = colPicker.querySelector(&quot;[anonid=popup]&quot;);</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16">   mc.click(new elib.Elem(colPicker));</span>
<a href="#l8.17"></a><span id="l8.17">   mc.click_menus_in_sequence(colPickerPopup, aActions);</span>
<a href="#l8.18"></a><span id="l8.18"> }</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21"> /**</span>
<a href="#l8.22"></a><span id="l8.22">  * The column picker's &quot;reset columns to default&quot; option should set our state</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">- *  back to inbox state.</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+ *  back to the natural state.</span>
<a href="#l8.25"></a><span id="l8.25">  */</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-function disabled_test_reset_to_inbox() {</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+function test_reset_to_inbox() {</span>
<a href="#l8.28"></a><span id="l8.28">   // create the source</span>
<a href="#l8.29"></a><span id="l8.29">   folderSource = create_folder(&quot;ColumnsApplySource&quot;);</span>
<a href="#l8.30"></a><span id="l8.30">   // it better have INBOX defaults</span>
<a href="#l8.31"></a><span id="l8.31">   assert_visible_columns(INBOX_DEFAULTS);</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">   // permute them</span>
<a href="#l8.34"></a><span id="l8.34">   let conExtra = INBOX_DEFAULTS.concat([&quot;sizeCol&quot;]);</span>
<a href="#l8.35"></a><span id="l8.35">   show_column(&quot;sizeCol&quot;);</span>
<a href="#l8.36"></a><span id="l8.36">   assert_visible_columns(conExtra);</span>
<a href="#l8.37"></a><span id="l8.37"> </span>
<a href="#l8.38"></a><span id="l8.38">   // reset!</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-  invoke_column_picker_option([{anonid: &quot;reset&quot;}]);</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+  invoke_column_picker_option([{anonid: &quot;menuitem&quot;}]);</span>
<a href="#l8.41"></a><span id="l8.41"> }</span>
<a href="#l8.42"></a><span id="l8.42"> </span>
<a href="#l8.43"></a><span id="l8.43"> function subtest_say_yes(cwc) {</span>
<a href="#l8.44"></a><span id="l8.44">   cwc.window.document.documentElement.getButton('accept').doCommand();</span>
<a href="#l8.45"></a><span id="l8.45"> }</span>
<a href="#l8.46"></a><span id="l8.46"> </span>
<a href="#l8.47"></a><span id="l8.47"> function _apply_to_folder_common(aChildrenToo, folder) {</span>
<a href="#l8.48"></a><span id="l8.48">   if (aChildrenToo)</span>
<a href="#l8.49"></a><span id="l8.49">     plan_for_observable_event(&quot;msg-folder-columns-propagated&quot;);</span>
<a href="#l8.50"></a><span id="l8.50">   plan_for_modal_dialog(&quot;commonDialog&quot;, subtest_say_yes);</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-  invoke_column_picker_option([{anonid: &quot;applyTo-menu&quot;},</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-                               {anonid: aChildrenToo ?</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+  invoke_column_picker_option([{class: &quot;applyTo-menu&quot;},</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+                               {class: aChildrenToo ?</span>
<a href="#l8.55"></a><span id="l8.55">                                   &quot;applyToFolderAndChildren-menu&quot; :</span>
<a href="#l8.56"></a><span id="l8.56">                                   &quot;applyToFolder-menu&quot;},</span>
<a href="#l8.57"></a><span id="l8.57">                                {label: &quot;Local Folders&quot;},</span>
<a href="#l8.58"></a><span id="l8.58">                                {label: folder.name},</span>
<a href="#l8.59"></a><span id="l8.59">                                {label: folder.name}]);</span>
<a href="#l8.60"></a><span id="l8.60">   wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l8.61"></a><span id="l8.61">   if (aChildrenToo)</span>
<a href="#l8.62"></a><span id="l8.62">     wait_for_observable_event(&quot;msg-folder-columns-propagated&quot;);</span>
<a href="#l8.63"></a><span id="l8.63"> }</span>
<a href="#l8.64"></a><span id="l8.64"> </span>
<a href="#l8.65"></a><span id="l8.65"> /**</span>
<a href="#l8.66"></a><span id="l8.66">  * Change settings in a folder, apply them to another folder that also has</span>
<a href="#l8.67"></a><span id="l8.67">  *  children.  Make sure the folder changes but the children do not.</span>
<a href="#l8.68"></a><span id="l8.68">  */</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-function disabled_test_apply_to_folder_no_children() {</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+function test_apply_to_folder_no_children() {</span>
<a href="#l8.71"></a><span id="l8.71">   folderParent = create_folder(&quot;ColumnsApplyParent&quot;);</span>
<a href="#l8.72"></a><span id="l8.72">   folderParent.createSubfolder(&quot;Child1&quot;, null);</span>
<a href="#l8.73"></a><span id="l8.73">   folderChild1 = folderParent.getChildNamed(&quot;Child1&quot;);</span>
<a href="#l8.74"></a><span id="l8.74">   folderParent.createSubfolder(&quot;Child2&quot;, null);</span>
<a href="#l8.75"></a><span id="l8.75">   folderChild2 = folderParent.getChildNamed(&quot;Child2&quot;);</span>
<a href="#l8.76"></a><span id="l8.76"> </span>
<a href="#l8.77"></a><span id="l8.77">   be_in_folder(folderSource);</span>
<a href="#l8.78"></a><span id="l8.78"> </span>
<a href="#l8.79"></a><span id="l8.79">   // reset!</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-  invoke_column_picker_option([{anonid: &quot;reset&quot;}]);</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+  invoke_column_picker_option([{anonid: &quot;menuitem&quot;}]);</span>
<a href="#l8.82"></a><span id="l8.82"> </span>
<a href="#l8.83"></a><span id="l8.83">   // permute!</span>
<a href="#l8.84"></a><span id="l8.84">   let conExtra = INBOX_DEFAULTS.concat([&quot;sizeCol&quot;]);</span>
<a href="#l8.85"></a><span id="l8.85">   show_column(&quot;sizeCol&quot;);</span>
<a href="#l8.86"></a><span id="l8.86">   assert_visible_columns(conExtra);</span>
<a href="#l8.87"></a><span id="l8.87"> </span>
<a href="#l8.88"></a><span id="l8.88">   // apply to the one dude</span>
<a href="#l8.89"></a><span id="l8.89">   _apply_to_folder_common(false, folderParent);</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineat">@@ -434,24 +433,24 @@ function disabled_test_apply_to_folder_n</span>
<a href="#l8.91"></a><span id="l8.91">   be_in_folder(folderChild2);</span>
<a href="#l8.92"></a><span id="l8.92">   assert_visible_columns(INBOX_DEFAULTS);</span>
<a href="#l8.93"></a><span id="l8.93"> }</span>
<a href="#l8.94"></a><span id="l8.94"> </span>
<a href="#l8.95"></a><span id="l8.95"> /**</span>
<a href="#l8.96"></a><span id="l8.96">  * Change settings in a folder, apply them to another folder and its children.</span>
<a href="#l8.97"></a><span id="l8.97">  *  Make sure the folder and its children change.</span>
<a href="#l8.98"></a><span id="l8.98">  */</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineminus">-function disabled_test_apply_to_folder_and_children() {</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineplus">+function test_apply_to_folder_and_children() {</span>
<a href="#l8.101"></a><span id="l8.101">   // no need to throttle ourselves during testing.</span>
<a href="#l8.102"></a><span id="l8.102">   MailUtils.INTER_FOLDER_PROCESSING_DELAY_MS = 0;</span>
<a href="#l8.103"></a><span id="l8.103"> </span>
<a href="#l8.104"></a><span id="l8.104">   be_in_folder(folderSource);</span>
<a href="#l8.105"></a><span id="l8.105"> </span>
<a href="#l8.106"></a><span id="l8.106">   // reset!</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-  invoke_column_picker_option([{anonid: &quot;reset&quot;}]);</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+  invoke_column_picker_option([{anonid: &quot;menuitem&quot;}]);</span>
<a href="#l8.109"></a><span id="l8.109"> </span>
<a href="#l8.110"></a><span id="l8.110">   // permute!</span>
<a href="#l8.111"></a><span id="l8.111">   let conExtra = INBOX_DEFAULTS.concat([&quot;tagsCol&quot;]);</span>
<a href="#l8.112"></a><span id="l8.112">   show_column(&quot;tagsCol&quot;);</span>
<a href="#l8.113"></a><span id="l8.113">   assert_visible_columns(conExtra);</span>
<a href="#l8.114"></a><span id="l8.114"> </span>
<a href="#l8.115"></a><span id="l8.115">   // apply to the dude and his offspring</span>
<a href="#l8.116"></a><span id="l8.116">   _apply_to_folder_common(true, folderParent);</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineat">@@ -459,34 +458,35 @@ function disabled_test_apply_to_folder_a</span>
<a href="#l8.118"></a><span id="l8.118">   // make sure it copied to the parent and his children</span>
<a href="#l8.119"></a><span id="l8.119">   be_in_folder(folderParent);</span>
<a href="#l8.120"></a><span id="l8.120">   assert_visible_columns(conExtra);</span>
<a href="#l8.121"></a><span id="l8.121">   be_in_folder(folderChild1);</span>
<a href="#l8.122"></a><span id="l8.122">   assert_visible_columns(conExtra);</span>
<a href="#l8.123"></a><span id="l8.123">   be_in_folder(folderChild2);</span>
<a href="#l8.124"></a><span id="l8.124">   assert_visible_columns(conExtra);</span>
<a href="#l8.125"></a><span id="l8.125"> }</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineminus">-disabled_test_apply_to_folder_and_children.EXCLUDED_PLATFORMS = ['linux'];  // See bug 1406717.</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineplus">+test_apply_to_folder_and_children.EXCLUDED_PLATFORMS = ['linux'];  // See bug 1406717.</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineplus">+test_apply_to_folder_and_children.__force_skip__ = true;  // See bug 1521016.</span>
<a href="#l8.129"></a><span id="l8.129"> </span>
<a href="#l8.130"></a><span id="l8.130"> /**</span>
<a href="#l8.131"></a><span id="l8.131">  * Change settings in an incoming folder, apply them to an outgoing folder that</span>
<a href="#l8.132"></a><span id="l8.132">  * also has children. Make sure the folder changes but the children do not.</span>
<a href="#l8.133"></a><span id="l8.133">  */</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineminus">-function disabled_test_apply_to_folder_no_children_swapped() {</span>
<a href="#l8.135"></a><span id="l8.135" class="difflineplus">+function test_apply_to_folder_no_children_swapped() {</span>
<a href="#l8.136"></a><span id="l8.136">   folderParent = create_folder(&quot;ColumnsApplyParentOutgoing&quot;);</span>
<a href="#l8.137"></a><span id="l8.137">   folderParent.setFlag(Ci.nsMsgFolderFlags.SentMail);</span>
<a href="#l8.138"></a><span id="l8.138">   folderParent.createSubfolder(&quot;Child1&quot;, null);</span>
<a href="#l8.139"></a><span id="l8.139">   folderChild1 = folderParent.getChildNamed(&quot;Child1&quot;);</span>
<a href="#l8.140"></a><span id="l8.140">   folderParent.createSubfolder(&quot;Child2&quot;, null);</span>
<a href="#l8.141"></a><span id="l8.141">   folderChild2 = folderParent.getChildNamed(&quot;Child2&quot;);</span>
<a href="#l8.142"></a><span id="l8.142"> </span>
<a href="#l8.143"></a><span id="l8.143">   be_in_folder(folderSource);</span>
<a href="#l8.144"></a><span id="l8.144"> </span>
<a href="#l8.145"></a><span id="l8.145">   // reset!</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineminus">-  invoke_column_picker_option([{anonid: &quot;reset&quot;}]);</span>
<a href="#l8.147"></a><span id="l8.147" class="difflineplus">+  invoke_column_picker_option([{anonid: &quot;menuitem&quot;}]);</span>
<a href="#l8.148"></a><span id="l8.148"> </span>
<a href="#l8.149"></a><span id="l8.149">   // permute!</span>
<a href="#l8.150"></a><span id="l8.150">   let conExtra = [...INBOX_DEFAULTS];</span>
<a href="#l8.151"></a><span id="l8.151">   if (useCorrespondent) {</span>
<a href="#l8.152"></a><span id="l8.152">     conExtra[5] = &quot;senderCol&quot;;</span>
<a href="#l8.153"></a><span id="l8.153">     hide_column(&quot;correspondentCol&quot;);</span>
<a href="#l8.154"></a><span id="l8.154">     show_column(&quot;senderCol&quot;);</span>
<a href="#l8.155"></a><span id="l8.155">   } else {</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineat">@@ -506,30 +506,31 @@ function disabled_test_apply_to_folder_n</span>
<a href="#l8.157"></a><span id="l8.157">   assert_visible_columns(conExtraSwapped);</span>
<a href="#l8.158"></a><span id="l8.158"> </span>
<a href="#l8.159"></a><span id="l8.159">   // But not the children.</span>
<a href="#l8.160"></a><span id="l8.160">   be_in_folder(folderChild1);</span>
<a href="#l8.161"></a><span id="l8.161">   assert_visible_columns(SENT_DEFAULTS);</span>
<a href="#l8.162"></a><span id="l8.162">   be_in_folder(folderChild2);</span>
<a href="#l8.163"></a><span id="l8.163">   assert_visible_columns(SENT_DEFAULTS);</span>
<a href="#l8.164"></a><span id="l8.164"> }</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineminus">-disabled_test_apply_to_folder_no_children_swapped.EXCLUDED_PLATFORMS = ['linux'];  // See bug 1406717.</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineplus">+test_apply_to_folder_no_children_swapped.EXCLUDED_PLATFORMS = ['linux'];  // See bug 1406717.</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineplus">+test_apply_to_folder_no_children_swapped.__force_skip__ = true;  // See bug 1521016.</span>
<a href="#l8.168"></a><span id="l8.168"> </span>
<a href="#l8.169"></a><span id="l8.169"> /**</span>
<a href="#l8.170"></a><span id="l8.170">  * Change settings in an incoming folder, apply them to an outgoing folder and</span>
<a href="#l8.171"></a><span id="l8.171">  * its children. Make sure the folder and its children change.</span>
<a href="#l8.172"></a><span id="l8.172">  */</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineminus">-function disabled_test_apply_to_folder_and_children_swapped() {</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineplus">+function test_apply_to_folder_and_children_swapped() {</span>
<a href="#l8.175"></a><span id="l8.175">   // No need to throttle ourselves during testing.</span>
<a href="#l8.176"></a><span id="l8.176">   MailUtils.INTER_FOLDER_PROCESSING_DELAY_MS = 0;</span>
<a href="#l8.177"></a><span id="l8.177"> </span>
<a href="#l8.178"></a><span id="l8.178">   be_in_folder(folderSource);</span>
<a href="#l8.179"></a><span id="l8.179"> </span>
<a href="#l8.180"></a><span id="l8.180">   // reset!</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineminus">-  invoke_column_picker_option([{anonid: &quot;reset&quot;}]);</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineplus">+  invoke_column_picker_option([{anonid: &quot;menuitem&quot;}]);</span>
<a href="#l8.183"></a><span id="l8.183"> </span>
<a href="#l8.184"></a><span id="l8.184">   // permute!</span>
<a href="#l8.185"></a><span id="l8.185">   let conExtra = [...INBOX_DEFAULTS];</span>
<a href="#l8.186"></a><span id="l8.186">   if (useCorrespondent) {</span>
<a href="#l8.187"></a><span id="l8.187">     conExtra[5] = &quot;senderCol&quot;;</span>
<a href="#l8.188"></a><span id="l8.188">     hide_column(&quot;correspondentCol&quot;);</span>
<a href="#l8.189"></a><span id="l8.189">     show_column(&quot;senderCol&quot;);</span>
<a href="#l8.190"></a><span id="l8.190">   } else {</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineat">@@ -547,18 +548,18 @@ function disabled_test_apply_to_folder_a</span>
<a href="#l8.192"></a><span id="l8.192">   conExtraSwapped[5] = useCorrespondent ? &quot;recipientCol&quot; : &quot;correspondentCol&quot;;</span>
<a href="#l8.193"></a><span id="l8.193">   be_in_folder(folderParent);</span>
<a href="#l8.194"></a><span id="l8.194">   assert_visible_columns(conExtraSwapped);</span>
<a href="#l8.195"></a><span id="l8.195">   be_in_folder(folderChild1);</span>
<a href="#l8.196"></a><span id="l8.196">   assert_visible_columns(conExtraSwapped);</span>
<a href="#l8.197"></a><span id="l8.197">   be_in_folder(folderChild2);</span>
<a href="#l8.198"></a><span id="l8.198">   assert_visible_columns(conExtraSwapped);</span>
<a href="#l8.199"></a><span id="l8.199"> }</span>
<a href="#l8.200"></a><span id="l8.200" class="difflineminus">-disabled_test_apply_to_folder_and_children_swapped.EXCLUDED_PLATFORMS = ['linux'];  // See bug 1406717.</span>
<a href="#l8.201"></a><span id="l8.201" class="difflineminus">-</span>
<a href="#l8.202"></a><span id="l8.202" class="difflineplus">+test_apply_to_folder_and_children_swapped.EXCLUDED_PLATFORMS = ['linux'];  // See bug 1406717.</span>
<a href="#l8.203"></a><span id="l8.203" class="difflineplus">+test_apply_to_folder_and_children_swapped.__force_skip__ = true;  // See bug 1521016.</span>
<a href="#l8.204"></a><span id="l8.204"> </span>
<a href="#l8.205"></a><span id="l8.205"> /**</span>
<a href="#l8.206"></a><span id="l8.206">  * Create a fake gloda collection.</span>
<a href="#l8.207"></a><span id="l8.207">  */</span>
<a href="#l8.208"></a><span id="l8.208"> function FakeCollection() {</span>
<a href="#l8.209"></a><span id="l8.209">   this.items = [];</span>
<a href="#l8.210"></a><span id="l8.210"> }</span>
<a href="#l8.211"></a><span id="l8.211"> </span>
<a href="#l8.212"></a><span id="l8.212" class="difflineat">@@ -599,21 +600,21 @@ function test_persist_columns_gloda_coll</span>
<a href="#l8.213"></a><span id="l8.213">   glodaColumns = GLODA_DEFAULTS.slice(0, -1);</span>
<a href="#l8.214"></a><span id="l8.214">   glodaColumns.push(&quot;accountCol&quot;);</span>
<a href="#l8.215"></a><span id="l8.215"> </span>
<a href="#l8.216"></a><span id="l8.216">   mc.tabmail.openTab(&quot;glodaList&quot;, { collection: fakeCollection });</span>
<a href="#l8.217"></a><span id="l8.217">   wait_for_all_messages_to_load();</span>
<a href="#l8.218"></a><span id="l8.218">   assert_visible_columns(glodaColumns);</span>
<a href="#l8.219"></a><span id="l8.219"> }</span>
<a href="#l8.220"></a><span id="l8.220"> </span>
<a href="#l8.221"></a><span id="l8.221" class="difflineminus">-function disabled_test_reset_columns_gloda_collection() {</span>
<a href="#l8.222"></a><span id="l8.222" class="difflineplus">+function test_reset_columns_gloda_collection() {</span>
<a href="#l8.223"></a><span id="l8.223">   let fakeCollection = new FakeCollection();</span>
<a href="#l8.224"></a><span id="l8.224">   mc.tabmail.openTab(&quot;glodaList&quot;, { collection: fakeCollection });</span>
<a href="#l8.225"></a><span id="l8.225">   wait_for_all_messages_to_load();</span>
<a href="#l8.226"></a><span id="l8.226">   assert_visible_columns(glodaColumns);</span>
<a href="#l8.227"></a><span id="l8.227"> </span>
<a href="#l8.228"></a><span id="l8.228" class="difflineminus">-  invoke_column_picker_option([{anonid: &quot;reset&quot;}]);</span>
<a href="#l8.229"></a><span id="l8.229" class="difflineminus">-  assert_visible_columns(GLODA_DEFAULTS);</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineplus">+  invoke_column_picker_option([{anonid: &quot;menuitem&quot;}]); // reset!</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineplus">+  assert_visible_columns(glodaColumns); // same, only order (would be) reset</span>
<a href="#l8.232"></a><span id="l8.232"> </span>
<a href="#l8.233"></a><span id="l8.233">   mc.tabmail.openTab(&quot;glodaList&quot;, { collection: fakeCollection });</span>
<a href="#l8.234"></a><span id="l8.234">   wait_for_all_messages_to_load();</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineminus">-  assert_visible_columns(GLODA_DEFAULTS);</span>
<a href="#l8.236"></a><span id="l8.236" class="difflineplus">+  assert_visible_columns(glodaColumns);</span>
<a href="#l8.237"></a><span id="l8.237"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -72,18 +72,17 @@ function test_right_click_column_header_</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">   // The treecolpicker element itself doesn't have an id, so we have to walk</span>
<a href="#l9.6"></a><span id="l9.6">   // down from the parent to find it.</span>
<a href="#l9.7"></a><span id="l9.7">   //  treadCols</span>
<a href="#l9.8"></a><span id="l9.8">   //   |- hbox                item 0</span>
<a href="#l9.9"></a><span id="l9.9">   //   |- treecolpicker   &lt;-- item 1 this is the one we want</span>
<a href="#l9.10"></a><span id="l9.10">   let threadCols = mc.window.document.getElementById(&quot;threadCols&quot;);</span>
<a href="#l9.11"></a><span id="l9.11">   let treeColPicker = threadCols.querySelector(&quot;treecolpicker&quot;);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  let popup = mc.window.document.getAnonymousElementByAttribute(</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-                treeColPicker, &quot;anonid&quot;, &quot;popup&quot;);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  let popup = treeColPicker.querySelector(&quot;[anonid=popup]&quot;);</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16">   // Right click the subject column header</span>
<a href="#l9.17"></a><span id="l9.17">   // This should show the column picker popup.</span>
<a href="#l9.18"></a><span id="l9.18">   mc.rightClick(mc.eid(&quot;subjectCol&quot;));</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20">   // Check that the popup opens.</span>
<a href="#l9.21"></a><span id="l9.21">   wait_for_popup_to_open(popup);</span>
<a href="#l9.22"></a><span id="l9.22">   // Hide it again, we just wanted to know it was gonna be shown.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1758,18 +1758,17 @@ function augment_controller(aController,</span>
<a href="#l10.4"></a><span id="l10.4">     for (let i = 0; i &lt; treecolses.length; i++) {</span>
<a href="#l10.5"></a><span id="l10.5">       let treecols = treecolses[i];</span>
<a href="#l10.6"></a><span id="l10.6">       // The treecolpicker element itself doesn't have an id, so we have to walk</span>
<a href="#l10.7"></a><span id="l10.7">       // down from the parent to find it.</span>
<a href="#l10.8"></a><span id="l10.8">       //  treadCols</span>
<a href="#l10.9"></a><span id="l10.9">       //   |- hbox                item 0</span>
<a href="#l10.10"></a><span id="l10.10">       //   |- treecolpicker   &lt;-- item 1 this is the one we want</span>
<a href="#l10.11"></a><span id="l10.11">       let treeColPicker = treecols.querySelector(&quot;treecolpicker&quot;);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-      let popup = doc.getAnonymousElementByAttribute(treeColPicker,</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                                                     &quot;anonid&quot;, &quot;popup&quot;);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+      let popup = treeColPicker.querySelector(`menupopup[anonid=&quot;popup&quot;]`);</span>
<a href="#l10.15"></a><span id="l10.15">       popup.addEventListener(&quot;popupshowing&quot;, __popup_showing, true);</span>
<a href="#l10.16"></a><span id="l10.16">       popup.addEventListener(&quot;popupshown&quot;, __popup_shown, true);</span>
<a href="#l10.17"></a><span id="l10.17">       popup.addEventListener(&quot;popuphiding&quot;, __popup_hiding, true);</span>
<a href="#l10.18"></a><span id="l10.18">       popup.addEventListener(&quot;popuphidden&quot;, __popup_hidden, true);</span>
<a href="#l10.19"></a><span id="l10.19">     }</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21">   }</span>
<a href="#l10.22"></a><span id="l10.22">   catch(ex) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

