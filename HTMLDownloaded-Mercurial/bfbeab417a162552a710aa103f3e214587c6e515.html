<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25028:bfbeab417a162552a710aa103f3e214587c6e515</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ bfbeab417a162552a710aa103f3e214587c6e515" />
<meta property="og:url" content="/comm-central/rev/bfbeab417a162552a710aa103f3e214587c6e515" />
<meta property="og:description" content="Bug 1498041 - Turn on ESLint in mail/base/test. r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / bfbeab417a162552a710aa103f3e214587c6e515 &#x2620;
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/bfbeab417a162552a710aa103f3e214587c6e515">shortlog</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/bfbeab417a162552a710aa103f3e214587c6e515">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515">files</a> |
changeset |
<a href="/comm-central/raw-rev/bfbeab417a162552a710aa103f3e214587c6e515">raw</a>  | <a href="/comm-central/archive/bfbeab417a162552a710aa103f3e214587c6e515.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1498041">Bug 1498041</a> - Turn on ESLint in mail/base/test. r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">
<tr><td colspan="2" style="background:#ff3333;"><strong>&#x2620;&#x2620; backed out by <a style="font-family: monospace" href="/comm-central/rev/1fdc6763b547">1fdc6763b547</a> &#x2620; &#x2620;</strong></td></tr>
<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 18 Oct 2018 16:18:45 +1300</td></tr>

<tr>
 <td>changeset 25028</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/bfbeab417a162552a710aa103f3e214587c6e515">bfbeab417a162552a710aa103f3e214587c6e515</a></td>
</tr>



<tr>
<td>parent 25027</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a341cb829498f62cfad5e025a35a3a99bfae44d2">a341cb829498f62cfad5e025a35a3a99bfae44d2</a>
</td>
</tr>

<tr>
<td>child 25029</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/95f2852bdd11a73e492c3b9d088730ff7865167b">95f2852bdd11a73e492c3b9d088730ff7865167b</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=bfbeab417a162552a710aa103f3e214587c6e515">15040</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 23 Oct 2018 08:20:35 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@617e07ac0498 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=617e07ac0498edf0a03aad617447f7f89abef2a3">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=617e07ac0498edf0a03aad617447f7f89abef2a3&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=617e07ac0498edf0a03aad617447f7f89abef2a3&newProject=comm-central&newRevision=a341cb829498f62cfad5e025a35a3a99bfae44d2&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=617e07ac0498edf0a03aad617447f7f89abef2a3&newProject=comm-central&newRevision=a341cb829498f62cfad5e025a35a3a99bfae44d2&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=617e07ac0498edf0a03aad617447f7f89abef2a3&newProject=comm-central&newRevision=a341cb829498f62cfad5e025a35a3a99bfae44d2&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1498041">1498041</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1498041">Bug 1498041</a> - Turn on ESLint in mail/base/test. r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/.eslintignore">.eslintignore</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/.eslintignore">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/.eslintignore">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/.eslintignore">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/.eslintignore">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/.eslintignore">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/.eslintrc.js">mail/base/test/unit/.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/head_mailbase_maildir.js">mail/base/test/unit/head_mailbase_maildir.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/head_mailbase_maildir.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/head_mailbase_maildir.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/head_mailbase_maildir.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/head_mailbase_maildir.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/head_mailbase_maildir.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/resources/viewWrapperTestUtils.js">mail/base/test/unit/resources/viewWrapperTestUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/resources/viewWrapperTestUtils.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/resources/viewWrapperTestUtils.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/resources/viewWrapperTestUtils.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/resources/viewWrapperTestUtils.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/resources/viewWrapperTestUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_alertHook.js">mail/base/test/unit/test_alertHook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_alertHook.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_alertHook.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_alertHook.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_alertHook.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_alertHook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_attachmentChecker.js">mail/base/test/unit/test_attachmentChecker.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_attachmentChecker.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_attachmentChecker.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_attachmentChecker.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_attachmentChecker.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_attachmentChecker.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_mailGlue_distribution.js">mail/base/test/unit/test_mailGlue_distribution.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_mailGlue_distribution.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_mailGlue_distribution.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_mailGlue_distribution.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_mailGlue_distribution.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_mailGlue_distribution.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_imapFolder.js">mail/base/test/unit/test_viewWrapper_imapFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_imapFolder.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_imapFolder.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_imapFolder.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_imapFolder.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_imapFolder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_logic.js">mail/base/test/unit/test_viewWrapper_logic.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_logic.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_logic.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_logic.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_logic.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_logic.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_realFolder.js">mail/base/test/unit/test_viewWrapper_realFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_realFolder.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_realFolder.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_realFolder.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_realFolder.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_realFolder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolder.js">mail/base/test/unit/test_viewWrapper_virtualFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolder.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolder.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolder.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolder.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">file</a> |
<a href="/comm-central/annotate/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">annotate</a> |
<a href="/comm-central/diff/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">diff</a> |
<a href="/comm-central/comparison/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">comparison</a> |
<a href="/comm-central/log/bfbeab417a162552a710aa103f3e214587c6e515/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.eslintignore</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.eslintignore</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -45,17 +45,16 @@ mailnews/test/*</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> # mailnews/extensions exclusions</span>
<a href="#l1.6"></a><span id="l1.6"> mailnews/extensions/*</span>
<a href="#l1.7"></a><span id="l1.7"> !mailnews/extensions/newsblog</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> # mail exclusions</span>
<a href="#l1.10"></a><span id="l1.10"> mail/app/**</span>
<a href="#l1.11"></a><span id="l1.11"> mail/base/content/**</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-mail/base/test/**</span>
<a href="#l1.13"></a><span id="l1.13"> mail/branding/**</span>
<a href="#l1.14"></a><span id="l1.14"> mail/config/**</span>
<a href="#l1.15"></a><span id="l1.15"> mail/extensions/**</span>
<a href="#l1.16"></a><span id="l1.16"> mail/installer/**</span>
<a href="#l1.17"></a><span id="l1.17"> mail/locales/**</span>
<a href="#l1.18"></a><span id="l1.18"> mail/test/**</span>
<a href="#l1.19"></a><span id="l1.19"> mail/themes/**</span>
<a href="#l1.20"></a><span id="l1.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/mail/base/test/unit/.eslintrc.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,8 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+/* eslint-env node */</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+module.exports = {</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+  &quot;extends&quot;: [</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+    &quot;plugin:mozilla/xpcshell-test&quot;,</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+  ],</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/test/unit/head_mailbase_maildir.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/test/unit/head_mailbase_maildir.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,5 +1,7 @@</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineplus">+/* import-globals-from head_mailbase.js */</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+</span>
<a href="#l3.6"></a><span id="l3.6"> // alternate head to set maildir as default</span>
<a href="#l3.7"></a><span id="l3.7"> load(&quot;head_mailbase.js&quot;);</span>
<a href="#l3.8"></a><span id="l3.8"> info(&quot;Running test with maildir&quot;);</span>
<a href="#l3.9"></a><span id="l3.9"> Services.prefs.setCharPref(&quot;mail.serverDefaultStoreContractID&quot;,</span>
<a href="#l3.10"></a><span id="l3.10">                            &quot;@mozilla.org/msgstore/maildirstore;1&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/test/unit/resources/viewWrapperTestUtils.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/test/unit/resources/viewWrapperTestUtils.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,18 +1,41 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/DBViewWrapper.jsm&quot;);</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/MailViewManager.jsm&quot;);</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-ChromeUtils.import(&quot;resource:///modules/virtualFolderWrapper.js&quot;);</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+const {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+  DBViewWrapper,</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  IDBViewWrapperListener,</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/DBViewWrapper.jsm&quot;, null);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+const {</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+  MailViewManager,</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+  MailViewConstants,</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/MailViewManager.jsm&quot;, null);</span>
<a href="#l4.19"></a><span id="l4.19"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+const {</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+  VirtualFolderHelper,</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/virtualFolderWrapper.js&quot;, null);</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+const {</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+  toXPCOMArray,</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+} = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;, null);</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-var gInbox;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+/* import-globals-from ../../../../../mailnews/test/resources/logHelper.js */</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+load(&quot;../../../../mailnews/resources/logHelper.js&quot;);</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+/* import-globals-from ../../../../../mailnews/test/resources/asyncTestUtils.js */</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+load(&quot;../../../../mailnews/resources/asyncTestUtils.js&quot;);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+/* import-globals-from ../../../../../mailnews/test/resources/messageGenerator.js */</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+/* import-globals-from ../../../../../mailnews/test/resources/messageModifier.js */</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+/* import-globals-from ../../../../../mailnews/test/resources/messageInjection.js */</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+var gInbox, gMessageGenerator, gMessageScenarioFactory;</span>
<a href="#l4.41"></a><span id="l4.41"> </span>
<a href="#l4.42"></a><span id="l4.42"> /**</span>
<a href="#l4.43"></a><span id="l4.43">  * Do initialization for xpcshell-tests; not used by</span>
<a href="#l4.44"></a><span id="l4.44">  *  test-folder-display-helpers.js, our friendly mozmill test helper.</span>
<a href="#l4.45"></a><span id="l4.45">  */</span>
<a href="#l4.46"></a><span id="l4.46"> function initViewWrapperTestUtils(aInjectionConfig) {</span>
<a href="#l4.47"></a><span id="l4.47">   gMessageGenerator = new MessageGenerator();</span>
<a href="#l4.48"></a><span id="l4.48">   gMessageScenarioFactory = new MessageScenarioFactory(gMessageGenerator);</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineat">@@ -56,58 +79,58 @@ function assert_bit_set(aWhat, aBit, aWh</span>
<a href="#l4.50"></a><span id="l4.50"> }</span>
<a href="#l4.51"></a><span id="l4.51"> </span>
<a href="#l4.52"></a><span id="l4.52"> function assert_bit_not_set(aWhat, aBit, aWhy) {</span>
<a href="#l4.53"></a><span id="l4.53">   if (aWhat &amp; aBit)</span>
<a href="#l4.54"></a><span id="l4.54">     do_throw(aWhy);</span>
<a href="#l4.55"></a><span id="l4.55"> }</span>
<a href="#l4.56"></a><span id="l4.56"> </span>
<a href="#l4.57"></a><span id="l4.57"> var gFakeCommandUpdater = {</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-  updateCommandStatus : function() {</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+  updateCommandStatus() {</span>
<a href="#l4.60"></a><span id="l4.60">   },</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-  displayMessageChanged : function(aFolder, aSubject, aKeywords) {</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+  displayMessageChanged(aFolder, aSubject, aKeywords) {</span>
<a href="#l4.64"></a><span id="l4.64">   },</span>
<a href="#l4.65"></a><span id="l4.65"> </span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-  summarizeSelection: function () {</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+  summarizeSelection() {</span>
<a href="#l4.68"></a><span id="l4.68">   },</span>
<a href="#l4.69"></a><span id="l4.69"> </span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-  updateNextMessageAfterDelete : function() {</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-  }</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+  updateNextMessageAfterDelete() {</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+  },</span>
<a href="#l4.74"></a><span id="l4.74"> };</span>
<a href="#l4.75"></a><span id="l4.75"> </span>
<a href="#l4.76"></a><span id="l4.76"> var gMockViewWrapperListener = {</span>
<a href="#l4.77"></a><span id="l4.77">   __proto__: IDBViewWrapperListener.prototype,</span>
<a href="#l4.78"></a><span id="l4.78">   shouldUseMailViews: true,</span>
<a href="#l4.79"></a><span id="l4.79">   shouldDeferMessageDisplayUntilAfterServerConnect: false,</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-  shouldMarkMessagesReadOnLeavingFolder : function(aMsgFolder) {</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+  shouldMarkMessagesReadOnLeavingFolder(aMsgFolder) {</span>
<a href="#l4.82"></a><span id="l4.82">       return Services.prefs</span>
<a href="#l4.83"></a><span id="l4.83">                      .getBoolPref(&quot;mailnews.mark_message_read.&quot; +</span>
<a href="#l4.84"></a><span id="l4.84">                                   aMsgFolder.server.type);</span>
<a href="#l4.85"></a><span id="l4.85">   },</span>
<a href="#l4.86"></a><span id="l4.86">   messenger: null,</span>
<a href="#l4.87"></a><span id="l4.87">   // use no message window!</span>
<a href="#l4.88"></a><span id="l4.88">   msgWindow: null,</span>
<a href="#l4.89"></a><span id="l4.89">   threadPaneCommandUpdater: gFakeCommandUpdater,</span>
<a href="#l4.90"></a><span id="l4.90">   // event handlers</span>
<a href="#l4.91"></a><span id="l4.91">   allMessagesLoadedEventCount: 0,</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-  onMessagesLoaded: function(aAll) {</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+  onMessagesLoaded(aAll) {</span>
<a href="#l4.94"></a><span id="l4.94">     if (!aAll)</span>
<a href="#l4.95"></a><span id="l4.95">       return;</span>
<a href="#l4.96"></a><span id="l4.96">     this.allMessagesLoadedEventCount++;</span>
<a href="#l4.97"></a><span id="l4.97">     if (this.pendingLoad) {</span>
<a href="#l4.98"></a><span id="l4.98">       this.pendingLoad = false;</span>
<a href="#l4.99"></a><span id="l4.99">       async_driver();</span>
<a href="#l4.100"></a><span id="l4.100">     }</span>
<a href="#l4.101"></a><span id="l4.101">   },</span>
<a href="#l4.102"></a><span id="l4.102"> </span>
<a href="#l4.103"></a><span id="l4.103">   messagesRemovedEventCount: 0,</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-  onMessagesRemoved: function() {</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+  onMessagesRemoved() {</span>
<a href="#l4.106"></a><span id="l4.106">     this.messagesRemovedEventCount++;</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-  }</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+  },</span>
<a href="#l4.109"></a><span id="l4.109"> };</span>
<a href="#l4.110"></a><span id="l4.110"> </span>
<a href="#l4.111"></a><span id="l4.111"> function punt() {</span>
<a href="#l4.112"></a><span id="l4.112">   dump(&quot;  ******************************\n&quot;);</span>
<a href="#l4.113"></a><span id="l4.113">   dump(&quot;  *** PUNTING! implement me! ***\n&quot;);</span>
<a href="#l4.114"></a><span id="l4.114">   dump(&quot;  ******************************\n&quot;);</span>
<a href="#l4.115"></a><span id="l4.115"> }</span>
<a href="#l4.116"></a><span id="l4.116"> </span>
<a href="#l4.117"></a><span id="l4.117" class="difflineat">@@ -117,23 +140,23 @@ function punt() {</span>
<a href="#l4.118"></a><span id="l4.118">  *  a test completes, but also so we can provide useful information about the</span>
<a href="#l4.119"></a><span id="l4.119">  *  state of things if a test times out.</span>
<a href="#l4.120"></a><span id="l4.120">  */</span>
<a href="#l4.121"></a><span id="l4.121"> var VWTU_testHelper = {</span>
<a href="#l4.122"></a><span id="l4.122">   active_view_wrappers: [],</span>
<a href="#l4.123"></a><span id="l4.123">   active_real_folders: [],</span>
<a href="#l4.124"></a><span id="l4.124">   active_virtual_folders: [],</span>
<a href="#l4.125"></a><span id="l4.125"> </span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-  onVirtualFolderCreated: function(aVirtualFolder) {</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+  onVirtualFolderCreated(aVirtualFolder) {</span>
<a href="#l4.128"></a><span id="l4.128">     this.active_virtual_folders.push(aVirtualFolder);</span>
<a href="#l4.129"></a><span id="l4.129">   },</span>
<a href="#l4.130"></a><span id="l4.130"> </span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-  postTest: function () {</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+  postTest() {</span>
<a href="#l4.133"></a><span id="l4.133">     // close all the views we opened</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-    this.active_view_wrappers.forEach(function (wrapper) {</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+    this.active_view_wrappers.forEach(function(wrapper) {</span>
<a href="#l4.136"></a><span id="l4.136">       wrapper.close();</span>
<a href="#l4.137"></a><span id="l4.137">     });</span>
<a href="#l4.138"></a><span id="l4.138">     // verify that the notification helper has no outstanding listeners.</span>
<a href="#l4.139"></a><span id="l4.139">     if (IDBViewWrapperListener.prototype._FNH.haveListeners()) {</span>
<a href="#l4.140"></a><span id="l4.140">       let msg = &quot;FolderNotificationHelper has listeners, but should not.&quot;;</span>
<a href="#l4.141"></a><span id="l4.141">       dump(&quot;*** &quot; + msg + &quot;\n&quot;);</span>
<a href="#l4.142"></a><span id="l4.142">       dump(&quot;Pending URIs:\n&quot;);</span>
<a href="#l4.143"></a><span id="l4.143">       for (let folderURI in IDBViewWrapperListener.prototype._FNH</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineat">@@ -144,44 +167,44 @@ var VWTU_testHelper = {</span>
<a href="#l4.145"></a><span id="l4.145">       for (let folderURI in IDBViewWrapperListener.prototype._FNH</span>
<a href="#l4.146"></a><span id="l4.146">                               ._interestedWrappers) {</span>
<a href="#l4.147"></a><span id="l4.147">         dump(&quot;  &quot; + folderURI + &quot;\n&quot;);</span>
<a href="#l4.148"></a><span id="l4.148">       }</span>
<a href="#l4.149"></a><span id="l4.149">       dump(&quot;***\n&quot;);</span>
<a href="#l4.150"></a><span id="l4.150">       do_throw(msg);</span>
<a href="#l4.151"></a><span id="l4.151">     }</span>
<a href="#l4.152"></a><span id="l4.152">     // force the folder to forget about the message database</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-    this.active_virtual_folders.forEach(function (folder) {</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineplus">+    this.active_virtual_folders.forEach(function(folder) {</span>
<a href="#l4.155"></a><span id="l4.155">       folder.msgDatabase = null;</span>
<a href="#l4.156"></a><span id="l4.156">     });</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-    this.active_real_folders.forEach(function (folder) {</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineplus">+    this.active_real_folders.forEach(function(folder) {</span>
<a href="#l4.159"></a><span id="l4.159">       folder.msgDatabase = null;</span>
<a href="#l4.160"></a><span id="l4.160">     });</span>
<a href="#l4.161"></a><span id="l4.161"> </span>
<a href="#l4.162"></a><span id="l4.162">     this.active_view_wrappers.splice(0);</span>
<a href="#l4.163"></a><span id="l4.163">     this.active_real_folders.splice(0);</span>
<a href="#l4.164"></a><span id="l4.164">     this.active_virtual_folders.splice(0);</span>
<a href="#l4.165"></a><span id="l4.165"> </span>
<a href="#l4.166"></a><span id="l4.166">     gMockViewWrapperListener.allMessagesLoadedEventCount = 0;</span>
<a href="#l4.167"></a><span id="l4.167">   },</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineminus">-  onTimeout: function () {</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineplus">+  onTimeout() {</span>
<a href="#l4.170"></a><span id="l4.170">     dump(&quot;-----------------------------------------------------------\n&quot;);</span>
<a href="#l4.171"></a><span id="l4.171">     dump(&quot;Active things at time of timeout:\n&quot;);</span>
<a href="#l4.172"></a><span id="l4.172">     for (let folder of this.active_real_folders) {</span>
<a href="#l4.173"></a><span id="l4.173">       dump(&quot;Real folder: &quot; + folder.prettyName + &quot;\n&quot;);</span>
<a href="#l4.174"></a><span id="l4.174">     }</span>
<a href="#l4.175"></a><span id="l4.175">     for (let virtFolder of this.active_virtual_folders) {</span>
<a href="#l4.176"></a><span id="l4.176">       dump(&quot;Virtual folder: &quot; + virtFolder.prettyName + &quot;\n&quot;);</span>
<a href="#l4.177"></a><span id="l4.177">     }</span>
<a href="#l4.178"></a><span id="l4.178">     for (let [i, viewWrapper] of this.active_view_wrappers.entries()) {</span>
<a href="#l4.179"></a><span id="l4.179">       dump(&quot;-----------------------------------\n&quot;);</span>
<a href="#l4.180"></a><span id="l4.180">       dump(&quot;Active view wrapper &quot; + i + &quot;\n&quot;);</span>
<a href="#l4.181"></a><span id="l4.181">       dump_view_state(viewWrapper);</span>
<a href="#l4.182"></a><span id="l4.182">     }</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineminus">-  }</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+  },</span>
<a href="#l4.185"></a><span id="l4.185"> };</span>
<a href="#l4.186"></a><span id="l4.186"> </span>
<a href="#l4.187"></a><span id="l4.187"> function make_view_wrapper() {</span>
<a href="#l4.188"></a><span id="l4.188">   let wrapper = new DBViewWrapper(gMockViewWrapperListener);</span>
<a href="#l4.189"></a><span id="l4.189">   VWTU_testHelper.active_view_wrappers.push(wrapper);</span>
<a href="#l4.190"></a><span id="l4.190">   return wrapper;</span>
<a href="#l4.191"></a><span id="l4.191"> }</span>
<a href="#l4.192"></a><span id="l4.192"> </span>
<a href="#l4.193"></a><span id="l4.193" class="difflineat">@@ -303,26 +326,25 @@ var MSG_VIEW_FLAG_DUMMY = 0x20000000;</span>
<a href="#l4.194"></a><span id="l4.194"> function dump_view_contents(aViewWrapper) {</span>
<a href="#l4.195"></a><span id="l4.195">   let dbView = aViewWrapper.dbView;</span>
<a href="#l4.196"></a><span id="l4.196">   let treeView = aViewWrapper.dbView.QueryInterface(Ci.nsITreeView);</span>
<a href="#l4.197"></a><span id="l4.197">   let rowCount = treeView.rowCount;</span>
<a href="#l4.198"></a><span id="l4.198"> </span>
<a href="#l4.199"></a><span id="l4.199">   dump(&quot;********* Current View Contents\n&quot;);</span>
<a href="#l4.200"></a><span id="l4.200">   for (let iViewIndex = 0; iViewIndex &lt; rowCount; iViewIndex++) {</span>
<a href="#l4.201"></a><span id="l4.201">     let level = treeView.getLevel(iViewIndex);</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-    let viewFlags = dbView.viewFlags;</span>
<a href="#l4.203"></a><span id="l4.203">     let flags = dbView.getFlagsAt(iViewIndex);</span>
<a href="#l4.204"></a><span id="l4.204">     let msgHdr = dbView.getMsgHdrAt(iViewIndex);</span>
<a href="#l4.205"></a><span id="l4.205"> </span>
<a href="#l4.206"></a><span id="l4.206">     let s = WHITESPACE.substr(0, level * 2);</span>
<a href="#l4.207"></a><span id="l4.207">     if (treeView.isContainer(iViewIndex))</span>
<a href="#l4.208"></a><span id="l4.208">       s += treeView.isContainerOpen(iViewIndex) ? &quot;- &quot; : &quot;+ &quot;;</span>
<a href="#l4.209"></a><span id="l4.209">     else</span>
<a href="#l4.210"></a><span id="l4.210">       s += &quot;. &quot;;</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-    //s += treeView.getCellText(iViewIndex, )</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineplus">+    // s += treeView.getCellText(iViewIndex, )</span>
<a href="#l4.213"></a><span id="l4.213">     if (flags &amp; MSG_VIEW_FLAG_DUMMY)</span>
<a href="#l4.214"></a><span id="l4.214">       s += &quot;dummy: &quot;;</span>
<a href="#l4.215"></a><span id="l4.215">     s += dbView.cellTextForColumn(iViewIndex, &quot;subject&quot;);</span>
<a href="#l4.216"></a><span id="l4.216">     s += &quot; [&quot; + msgHdr.folder.prettyName + &quot;,&quot; + msgHdr.messageKey + &quot;]&quot;;</span>
<a href="#l4.217"></a><span id="l4.217"> </span>
<a href="#l4.218"></a><span id="l4.218">     dump(s + &quot;\n&quot;);</span>
<a href="#l4.219"></a><span id="l4.219">   }</span>
<a href="#l4.220"></a><span id="l4.220">   dump(&quot;********* end view contents\n&quot;);</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineat">@@ -374,17 +396,17 @@ function dump_view_state(aViewWrapper, a</span>
<a href="#l4.222"></a><span id="l4.222">  *  sets or contains messages not in the provided sets, do_throw will be invoked</span>
<a href="#l4.223"></a><span id="l4.223">  *  with a human readable explanation of the problem.</span>
<a href="#l4.224"></a><span id="l4.224">  *</span>
<a href="#l4.225"></a><span id="l4.225">  * @param aSynSets A single SyntheticMessageSet or a list of</span>
<a href="#l4.226"></a><span id="l4.226">  *     SyntheticMessageSets.</span>
<a href="#l4.227"></a><span id="l4.227">  * @param aViewWrapper The DBViewWrapper whose contents you want to validate.</span>
<a href="#l4.228"></a><span id="l4.228">  */</span>
<a href="#l4.229"></a><span id="l4.229"> function verify_messages_in_view(aSynSets, aViewWrapper) {</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineminus">-  if (!('length' in aSynSets))</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineplus">+  if (!(&quot;length&quot; in aSynSets))</span>
<a href="#l4.232"></a><span id="l4.232">     aSynSets = [aSynSets];</span>
<a href="#l4.233"></a><span id="l4.233"> </span>
<a href="#l4.234"></a><span id="l4.234">   // - Iterate over all the message sets, retrieving the message header.  Use</span>
<a href="#l4.235"></a><span id="l4.235">   //  this to construct a URI to populate a dictionary mapping.</span>
<a href="#l4.236"></a><span id="l4.236">   let synMessageURIs = {}; // map URI to message header</span>
<a href="#l4.237"></a><span id="l4.237">   for (let messageSet of aSynSets) {</span>
<a href="#l4.238"></a><span id="l4.238">     for (let msgHdr of messageSet.msgHdrs()) {</span>
<a href="#l4.239"></a><span id="l4.239">       synMessageURIs[msgHdr.folder.getUriForMsg(msgHdr)] = msgHdr;</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineat">@@ -399,19 +421,18 @@ function verify_messages_in_view(aSynSet</span>
<a href="#l4.241"></a><span id="l4.241"> </span>
<a href="#l4.242"></a><span id="l4.242">   for (let iViewIndex = 0; iViewIndex &lt; rowCount; iViewIndex++) {</span>
<a href="#l4.243"></a><span id="l4.243">     let msgHdr = dbView.getMsgHdrAt(iViewIndex);</span>
<a href="#l4.244"></a><span id="l4.244">     let uri = msgHdr.folder.getUriForMsg(msgHdr);</span>
<a href="#l4.245"></a><span id="l4.245">     // expected hit, null it out. (in the dummy case, we will just null out</span>
<a href="#l4.246"></a><span id="l4.246">     //  twice, which is also why we do an 'in' test and not a value test.</span>
<a href="#l4.247"></a><span id="l4.247">     if (uri in synMessageURIs) {</span>
<a href="#l4.248"></a><span id="l4.248">       synMessageURIs[uri] = null;</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineminus">-    }</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineminus">-    // the view is showing a message that should not be shown, explode.</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineminus">-    else {</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineplus">+    } else {</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineplus">+      // the view is showing a message that should not be shown, explode.</span>
<a href="#l4.254"></a><span id="l4.254">       dump(&quot;The view is showing the following message header and should not&quot; +</span>
<a href="#l4.255"></a><span id="l4.255">            &quot; be:\n&quot;);</span>
<a href="#l4.256"></a><span id="l4.256">       dump_message_header(msgHdr);</span>
<a href="#l4.257"></a><span id="l4.257">       dump(&quot;View State:\n&quot;);</span>
<a href="#l4.258"></a><span id="l4.258">       dump_view_state(aViewWrapper);</span>
<a href="#l4.259"></a><span id="l4.259">       mark_failure([&quot;view contains header that should not be present!&quot;,</span>
<a href="#l4.260"></a><span id="l4.260">                     msgHdr]);</span>
<a href="#l4.261"></a><span id="l4.261">     }</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineat">@@ -443,17 +464,16 @@ function verify_empty_view(aViewWrapper)</span>
<a href="#l4.263"></a><span id="l4.263"> /**</span>
<a href="#l4.264"></a><span id="l4.264">  * Build a histogram of the treeview levels and verify it matches the expected</span>
<a href="#l4.265"></a><span id="l4.265">  *  histogram.  Oddly enough, I find this to be a reasonable and concise way to</span>
<a href="#l4.266"></a><span id="l4.266">  *  verify that threading mode is enabled.  Keep in mind that this file is</span>
<a href="#l4.267"></a><span id="l4.267">  *  currently not used to test the actual thread logic.  If/when that day comes,</span>
<a href="#l4.268"></a><span id="l4.268">  *  something less eccentric is certainly the way that should be tested.</span>
<a href="#l4.269"></a><span id="l4.269">  */</span>
<a href="#l4.270"></a><span id="l4.270"> function verify_view_level_histogram(aExpectedHisto, aViewWrapper) {</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">-  let dbView = aViewWrapper.dbView;</span>
<a href="#l4.272"></a><span id="l4.272">   let treeView = aViewWrapper.dbView.QueryInterface(Ci.nsITreeView);</span>
<a href="#l4.273"></a><span id="l4.273">   let rowCount = treeView.rowCount;</span>
<a href="#l4.274"></a><span id="l4.274"> </span>
<a href="#l4.275"></a><span id="l4.275">   let actualHisto = {};</span>
<a href="#l4.276"></a><span id="l4.276">   for (let iViewIndex = 0; iViewIndex &lt; rowCount; iViewIndex++) {</span>
<a href="#l4.277"></a><span id="l4.277">     let level = treeView.getLevel(iViewIndex);</span>
<a href="#l4.278"></a><span id="l4.278">     actualHisto[level] = (actualHisto[level] || 0) + 1;</span>
<a href="#l4.279"></a><span id="l4.279">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/test/unit/test_alertHook.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/test/unit/test_alertHook.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -10,31 +10,30 @@ alertHook.init();</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> // Replace the alerts service with our own. This will let us check if we're</span>
<a href="#l5.6"></a><span id="l5.6"> // prompting or not.</span>
<a href="#l5.7"></a><span id="l5.7"> var gAlertShown = false;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> var mockAlertsService = {</span>
<a href="#l5.10"></a><span id="l5.10">   QueryInterface: ChromeUtils.generateQI([Ci.nsIAlertsService]),</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  showAlertNotification: function(imageUrl, title, text, textClickable, cookie,</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                                  alertListener, name) {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  showAlertNotification(imageUrl, title, text, textClickable, cookie, alertListener, name) {</span>
<a href="#l5.15"></a><span id="l5.15">     gAlertShown = true;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-  }</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+  },</span>
<a href="#l5.18"></a><span id="l5.18"> };</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> var gMsgWindow = {};</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> var mailnewsURL = {</span>
<a href="#l5.23"></a><span id="l5.23">   get msgWindow() {</span>
<a href="#l5.24"></a><span id="l5.24">     if (gMsgWindow)</span>
<a href="#l5.25"></a><span id="l5.25">       return gMsgWindow;</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">     throw Cr.NS_ERROR_INVALID_POINTER;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-  }</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+  },</span>
<a href="#l5.30"></a><span id="l5.30"> };</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32"> function run_test() {</span>
<a href="#l5.33"></a><span id="l5.33">   // First register the mock alerts service</span>
<a href="#l5.34"></a><span id="l5.34">   let uuid = MockFactory.register(&quot;@mozilla.org/alerts-service;1&quot;, mockAlertsService);</span>
<a href="#l5.35"></a><span id="l5.35">   registerCleanupFunction(function() {</span>
<a href="#l5.36"></a><span id="l5.36">     MockFactory.unregister(uuid);</span>
<a href="#l5.37"></a><span id="l5.37">   });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/test/unit/test_attachmentChecker.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/test/unit/test_attachmentChecker.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -15,34 +15,31 @@</span>
<a href="#l6.4"></a><span id="l6.4"> // Globals</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> ChromeUtils.import(&quot;resource:///modules/AttachmentChecker.jsm&quot;);</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> /*</span>
<a href="#l6.9"></a><span id="l6.9">  * UTILITIES</span>
<a href="#l6.10"></a><span id="l6.10">  */</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-function assert(aBeTrue, aWhy)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-{</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+function assert(aBeTrue, aWhy) {</span>
<a href="#l6.15"></a><span id="l6.15">   if (!aBeTrue)</span>
<a href="#l6.16"></a><span id="l6.16">     do_throw(aWhy);</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-};</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+}</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-function assert_equal(aA, aB, aWhy)</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-{</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+function assert_equal(aA, aB, aWhy) {</span>
<a href="#l6.23"></a><span id="l6.23">   assert(aA == aB, aWhy + &quot; (&quot; + unescape(encodeURIComponent(aA)) + &quot; != &quot; +</span>
<a href="#l6.24"></a><span id="l6.24">                                  unescape(encodeURIComponent(aB)) + &quot;).&quot;);</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-};</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+}</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28"> /*</span>
<a href="#l6.29"></a><span id="l6.29">  * TESTS</span>
<a href="#l6.30"></a><span id="l6.30">  */</span>
<a href="#l6.31"></a><span id="l6.31"> </span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-function test_getAttachmentKeywords(desc, mailData, keywords, expected)</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-{</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+function test_getAttachmentKeywords(desc, mailData, keywords, expected) {</span>
<a href="#l6.35"></a><span id="l6.35">   let result = AttachmentChecker.getAttachmentKeywords(mailData, keywords);</span>
<a href="#l6.36"></a><span id="l6.36">   assert_equal(result, expected, desc + &quot; not equal!&quot;);</span>
<a href="#l6.37"></a><span id="l6.37"> }</span>
<a href="#l6.38"></a><span id="l6.38"> </span>
<a href="#l6.39"></a><span id="l6.39"> var tests = [</span>
<a href="#l6.40"></a><span id="l6.40">   // Desc, mail body Data, keywords to search for, expected keywords found.</span>
<a href="#l6.41"></a><span id="l6.41">   [&quot;Simple keyword&quot;, &quot;latte.ca&quot;, &quot;latte&quot;, &quot;latte&quot;],</span>
<a href="#l6.42"></a><span id="l6.42">   [&quot;Extension&quot;, &quot;testing document.pdf&quot;, &quot;.pdf&quot;, &quot;document.pdf&quot;],</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineat">@@ -69,20 +66,19 @@ var tests = [</span>
<a href="#l6.44"></a><span id="l6.44">   [&quot;Should match Japanese&quot;, &quot;a test. a&quot;, &quot;.&quot;, &quot;test.&quot;],</span>
<a href="#l6.45"></a><span id="l6.45">   [&quot;Should match Greek&quot;, &quot;a test. a&quot;, &quot;.&quot;, &quot;test.&quot;],</span>
<a href="#l6.46"></a><span id="l6.46">   [&quot;Should match once&quot;, &quot;a test.pdf.doc a&quot;, &quot;.pdf,.doc&quot;, &quot;test.pdf.doc&quot;],</span>
<a href="#l6.47"></a><span id="l6.47">   [&quot;Should not match kw in url&quot;, &quot;see https://example.org/attachment.cgi?id=1 test&quot;, &quot;attachment&quot;, &quot;&quot;],</span>
<a href="#l6.48"></a><span id="l6.48">   [&quot;Should not match kw in url ending with kw&quot;, &quot;https://example.org/attachment&quot;, &quot;attachment&quot;, &quot;&quot;],</span>
<a href="#l6.49"></a><span id="l6.49">   [&quot;Should match CV and attachment&quot;, &quot;got my CV as attachment&quot;, &quot;CV,attachment&quot;, &quot;CV,attachment&quot;],</span>
<a href="#l6.50"></a><span id="l6.50"> ];</span>
<a href="#l6.51"></a><span id="l6.51"> </span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-function run_test()</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-{</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+function run_test() {</span>
<a href="#l6.55"></a><span id="l6.55">   do_test_pending();</span>
<a href="#l6.56"></a><span id="l6.56"> </span>
<a href="#l6.57"></a><span id="l6.57">   for (var i in tests)</span>
<a href="#l6.58"></a><span id="l6.58">     if (typeof(tests[i]) == &quot;function&quot;)</span>
<a href="#l6.59"></a><span id="l6.59">       tests[i]();</span>
<a href="#l6.60"></a><span id="l6.60">     else</span>
<a href="#l6.61"></a><span id="l6.61">       test_getAttachmentKeywords.apply(null, tests[i]);</span>
<a href="#l6.62"></a><span id="l6.62"> </span>
<a href="#l6.63"></a><span id="l6.63">   do_test_finished();</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-};</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,15 +1,9 @@</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineminus">-load(&quot;../../../../mailnews/resources/logHelper.js&quot;);</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineminus">-load(&quot;../../../../mailnews/resources/asyncTestUtils.js&quot;);</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineminus">-</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">-</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+/* import-globals-from resources/viewWrapperTestUtils.js */</span>
<a href="#l7.12"></a><span id="l7.12"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l7.13"></a><span id="l7.13"> initViewWrapperTestUtils({mode: &quot;imap&quot;, offline: false});</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15"> function* test_real_folder_load_and_move_to_trash() {</span>
<a href="#l7.16"></a><span id="l7.16">   let viewWrapper = make_view_wrapper();</span>
<a href="#l7.17"></a><span id="l7.17">   let [msgFolder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">   yield wait_for_message_injection();</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineat">@@ -36,14 +30,14 @@ function* test_empty_trash() {</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22">   let [msgSet] = make_new_sets_in_folders([trashHandle], [{count: 1}]);</span>
<a href="#l7.23"></a><span id="l7.23">   yield wait_for_message_injection();</span>
<a href="#l7.24"></a><span id="l7.24">   verify_messages_in_view(msgSet, viewWrapper);</span>
<a href="#l7.25"></a><span id="l7.25"> }</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27"> var tests = [</span>
<a href="#l7.28"></a><span id="l7.28">   test_real_folder_load_and_move_to_trash,</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-  test_empty_trash</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+  test_empty_trash,</span>
<a href="#l7.31"></a><span id="l7.31"> ];</span>
<a href="#l7.32"></a><span id="l7.32"> </span>
<a href="#l7.33"></a><span id="l7.33"> function run_test() {</span>
<a href="#l7.34"></a><span id="l7.34">   async_run_tests(tests);</span>
<a href="#l7.35"></a><span id="l7.35"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/test/unit/test_mailGlue_distribution.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/test/unit/test_mailGlue_distribution.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineplus">+// This file uses eval, but really shouldn't. See bug 1498497.</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+/* eslint-disable no-eval */</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+</span>
<a href="#l8.7"></a><span id="l8.7"> ChromeUtils.import(&quot;resource:///modules/TBDistCustomizer.jsm&quot;);</span>
<a href="#l8.8"></a><span id="l8.8"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">-function run_test()</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-{</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+function run_test() {</span>
<a href="#l8.13"></a><span id="l8.13">   do_test_pending();</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">   Services.locale.requestedLocales = [&quot;en-US&quot;];</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">   // Create an instance of nsIFile out of the current process directory</span>
<a href="#l8.18"></a><span id="l8.18">   let distroDir = Services.dirsvc.get(&quot;XCurProcD&quot;, Ci.nsIFile);</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">   // Construct a descendant of the distroDir file</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -20,19 +22,16 @@ function run_test()</span>
<a href="#l8.22"></a><span id="l8.22">   iniFile.append(&quot;distribution.ini&quot;);</span>
<a href="#l8.23"></a><span id="l8.23">   // It's a bug if distribution.ini already exists</span>
<a href="#l8.24"></a><span id="l8.24">   if (iniFile.exists()) {</span>
<a href="#l8.25"></a><span id="l8.25">     do_throw(&quot;distribution.ini already exists in objdir/mozilla/dist/bin/distribution.&quot;);</span>
<a href="#l8.26"></a><span id="l8.26">   }</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">   registerCleanupFunction(function() {</span>
<a href="#l8.29"></a><span id="l8.29">     // Remove the distribution.ini file</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-    let iniFile = Services.dirsvc.get(&quot;XCurProcD&quot;, Ci.nsIFile);</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-    iniFile.append(&quot;distribution&quot;);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-    iniFile.append(&quot;distribution.ini&quot;);</span>
<a href="#l8.33"></a><span id="l8.33">     if (iniFile.exists())</span>
<a href="#l8.34"></a><span id="l8.34">       iniFile.remove(true);</span>
<a href="#l8.35"></a><span id="l8.35">   });</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">   let testDir = Services.dirsvc.get(&quot;CurWorkD&quot;, Ci.nsIFile);</span>
<a href="#l8.38"></a><span id="l8.38">   let testDistributionFile = testDir.clone();</span>
<a href="#l8.39"></a><span id="l8.39"> </span>
<a href="#l8.40"></a><span id="l8.40">   // Construct descendant file</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -56,18 +55,17 @@ function run_test()</span>
<a href="#l8.42"></a><span id="l8.42"> </span>
<a href="#l8.43"></a><span id="l8.43">   iniValue = testIni.getString(&quot;Global&quot;, &quot;version&quot;);</span>
<a href="#l8.44"></a><span id="l8.44">   pref = Services.prefs.getCharPref(&quot;distribution.version&quot;);</span>
<a href="#l8.45"></a><span id="l8.45">   Assert.equal(iniValue, pref);</span>
<a href="#l8.46"></a><span id="l8.46"> </span>
<a href="#l8.47"></a><span id="l8.47">   let aboutLocale;</span>
<a href="#l8.48"></a><span id="l8.48">   try {</span>
<a href="#l8.49"></a><span id="l8.49">     aboutLocale = testIni.getString(&quot;Global&quot;, &quot;about.en-US&quot;);</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-  }</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-  catch (e) {</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+  } catch (e) {</span>
<a href="#l8.53"></a><span id="l8.53">     Cu.reportError(e);</span>
<a href="#l8.54"></a><span id="l8.54">   }</span>
<a href="#l8.55"></a><span id="l8.55"> </span>
<a href="#l8.56"></a><span id="l8.56">   if (aboutLocale == undefined)</span>
<a href="#l8.57"></a><span id="l8.57">     aboutLocale = testIni.getString(&quot;Global&quot;, &quot;about&quot;);</span>
<a href="#l8.58"></a><span id="l8.58"> </span>
<a href="#l8.59"></a><span id="l8.59">   pref = Services.prefs.getCharPref(&quot;distribution.about&quot;);</span>
<a href="#l8.60"></a><span id="l8.60">   Assert.equal(aboutLocale, pref);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_imapFolder.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_imapFolder.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,21 +1,15 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /**</span>
<a href="#l9.5"></a><span id="l9.5">  * Test DBViewWrapper against a single imap folder.  Try and test all the</span>
<a href="#l9.6"></a><span id="l9.6">  *  features we can without having a fake newsgroup.  (Some features are</span>
<a href="#l9.7"></a><span id="l9.7">  *  newsgroup specific.)</span>
<a href="#l9.8"></a><span id="l9.8">  */</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">-load(&quot;../../../../mailnews/resources/logHelper.js&quot;);</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">-load(&quot;../../../../mailnews/resources/asyncTestUtils.js&quot;);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+/* import-globals-from resources/viewWrapperTestUtils.js */</span>
<a href="#l9.18"></a><span id="l9.18"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l9.19"></a><span id="l9.19"> initViewWrapperTestUtils({mode: &quot;imap&quot;, offline: false});</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21"> /**</span>
<a href="#l9.22"></a><span id="l9.22">  * Create an empty folder, inject messages into it without triggering an</span>
<a href="#l9.23"></a><span id="l9.23">  *  updateFolder, sanity check that we believe there are no messages in the</span>
<a href="#l9.24"></a><span id="l9.24">  *  folder, then enter, making sure we immediately enter and that the view</span>
<a href="#l9.25"></a><span id="l9.25">  *  properly updates to reflect there being the right set of messages.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_logic.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_logic.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,24 +1,17 @@</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineminus">-load(&quot;../../../../mailnews/resources/logHelper.js&quot;);</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineminus">-load(&quot;../../../../mailnews/resources/asyncTestUtils.js&quot;);</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">-load(&quot;../../../../mailnews/resources/abSetup.js&quot;);</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineminus">-</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">-</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+/* import-globals-from resources/viewWrapperTestUtils.js */</span>
<a href="#l10.13"></a><span id="l10.13"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l10.14"></a><span id="l10.14"> initViewWrapperTestUtils();</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> /**</span>
<a href="#l10.17"></a><span id="l10.17">  * Verify that flipping between threading and grouped by sort settings properly</span>
<a href="#l10.18"></a><span id="l10.18">  *  clears the other flag.  (Because they're mutually exclusive, you see.)</span>
<a href="#l10.19"></a><span id="l10.19">  */</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-function* test_threading_grouping_mutual_exclusion () {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+function* test_threading_grouping_mutual_exclusion() {</span>
<a href="#l10.22"></a><span id="l10.22">   let viewWrapper = make_view_wrapper();</span>
<a href="#l10.23"></a><span id="l10.23">   let folder = make_empty_folder();</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l10.26"></a><span id="l10.26">   // enter an update that will never conclude.  this is fine.</span>
<a href="#l10.27"></a><span id="l10.27">   viewWrapper.beginViewUpdate();</span>
<a href="#l10.28"></a><span id="l10.28">   viewWrapper.showThreaded = true;</span>
<a href="#l10.29"></a><span id="l10.29">   assert_true(viewWrapper.showThreaded,</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineat">@@ -80,17 +73,17 @@ function* test_threads_special_views_mut</span>
<a href="#l10.31"></a><span id="l10.31">  * Do a quick test of primary sorting to make sure we're actually changing the</span>
<a href="#l10.32"></a><span id="l10.32">  *  sort order.  (However, we are not responsible for verifying correctness of</span>
<a href="#l10.33"></a><span id="l10.33">  *  the sort.)</span>
<a href="#l10.34"></a><span id="l10.34">  */</span>
<a href="#l10.35"></a><span id="l10.35"> function* test_sort_primary() {</span>
<a href="#l10.36"></a><span id="l10.36">   let viewWrapper = make_view_wrapper();</span>
<a href="#l10.37"></a><span id="l10.37">   // we need to put messages in the folder or the sort logic doesn't actually</span>
<a href="#l10.38"></a><span id="l10.38">   //  save the sort state. (this is the C++ view's fault.)</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-  let [folder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+  let [folder] = make_folder_with_sets(1);</span>
<a href="#l10.41"></a><span id="l10.41"> </span>
<a href="#l10.42"></a><span id="l10.42">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l10.43"></a><span id="l10.43">   viewWrapper.sort(Ci.nsMsgViewSortType.byDate,</span>
<a href="#l10.44"></a><span id="l10.44">                    Ci.nsMsgViewSortOrder.ascending);</span>
<a href="#l10.45"></a><span id="l10.45">   assert_equals(viewWrapper.dbView.sortType, Ci.nsMsgViewSortType.byDate,</span>
<a href="#l10.46"></a><span id="l10.46">                 &quot;sort should be by date&quot;, true);</span>
<a href="#l10.47"></a><span id="l10.47">   assert_equals(viewWrapper.dbView.sortOrder, Ci.nsMsgViewSortOrder.ascending,</span>
<a href="#l10.48"></a><span id="l10.48">                 &quot;sort order should be ascending&quot;, true);</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineat">@@ -105,17 +98,17 @@ function* test_sort_primary() {</span>
<a href="#l10.50"></a><span id="l10.50"> </span>
<a href="#l10.51"></a><span id="l10.51"> /**</span>
<a href="#l10.52"></a><span id="l10.52">  * Verify that we handle explicit secondary sorts correctly.</span>
<a href="#l10.53"></a><span id="l10.53">  */</span>
<a href="#l10.54"></a><span id="l10.54"> function* test_sort_secondary_explicit() {</span>
<a href="#l10.55"></a><span id="l10.55">   let viewWrapper = make_view_wrapper();</span>
<a href="#l10.56"></a><span id="l10.56">   // we need to put messages in the folder or the sort logic doesn't actually</span>
<a href="#l10.57"></a><span id="l10.57">   //  save the sort state. (this is the C++ view's fault.)</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-  let [folder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+  let [folder] = make_folder_with_sets(1);</span>
<a href="#l10.60"></a><span id="l10.60"> </span>
<a href="#l10.61"></a><span id="l10.61">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l10.62"></a><span id="l10.62">   viewWrapper.sort(Ci.nsMsgViewSortType.byAuthor,</span>
<a href="#l10.63"></a><span id="l10.63">                    Ci.nsMsgViewSortOrder.ascending,</span>
<a href="#l10.64"></a><span id="l10.64">                    Ci.nsMsgViewSortType.bySubject,</span>
<a href="#l10.65"></a><span id="l10.65">                    Ci.nsMsgViewSortOrder.descending</span>
<a href="#l10.66"></a><span id="l10.66">                    );</span>
<a href="#l10.67"></a><span id="l10.67">   // check once for what we just did, then again after refreshing to make</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineat">@@ -143,17 +136,17 @@ function* test_sort_secondary_explicit()</span>
<a href="#l10.69"></a><span id="l10.69">  *  let's make sure we obey its assumptions unless we have gone and made the UI</span>
<a href="#l10.70"></a><span id="l10.70">  *  be explicit about these things.  We can't simply depend on the view to do</span>
<a href="#l10.71"></a><span id="l10.71">  *  this for us.  Why?  Because we re-create the view all the bloody time.</span>
<a href="#l10.72"></a><span id="l10.72">  */</span>
<a href="#l10.73"></a><span id="l10.73"> function* test_sort_secondary_implicit() {</span>
<a href="#l10.74"></a><span id="l10.74">   let viewWrapper = make_view_wrapper();</span>
<a href="#l10.75"></a><span id="l10.75">   // we need to put messages in the folder or the sort logic doesn't actually</span>
<a href="#l10.76"></a><span id="l10.76">   //  save the sort state. (this is the C++ view's fault.)</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-  let [folder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+  let [folder] = make_folder_with_sets(1);</span>
<a href="#l10.79"></a><span id="l10.79"> </span>
<a href="#l10.80"></a><span id="l10.80">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l10.81"></a><span id="l10.81">   viewWrapper.magicSort(Ci.nsMsgViewSortType.bySubject,</span>
<a href="#l10.82"></a><span id="l10.82">                         Ci.nsMsgViewSortOrder.descending);</span>
<a href="#l10.83"></a><span id="l10.83">   viewWrapper.magicSort(Ci.nsMsgViewSortType.byAuthor,</span>
<a href="#l10.84"></a><span id="l10.84">                         Ci.nsMsgViewSortOrder.ascending);</span>
<a href="#l10.85"></a><span id="l10.85">   // check once for what we just did, then again after refreshing to make</span>
<a href="#l10.86"></a><span id="l10.86">   //  sure the sort order 'stuck'</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineat">@@ -180,17 +173,17 @@ function* test_sort_secondary_implicit()</span>
<a href="#l10.88"></a><span id="l10.88">  *</span>
<a href="#l10.89"></a><span id="l10.89">  * Note: Sorting changes are synchronous, but toggling grouped by sort requries</span>
<a href="#l10.90"></a><span id="l10.90">  *  a view rebuild.</span>
<a href="#l10.91"></a><span id="l10.91">  */</span>
<a href="#l10.92"></a><span id="l10.92"> function* test_sort_group_by_sort() {</span>
<a href="#l10.93"></a><span id="l10.93">   let viewWrapper = make_view_wrapper();</span>
<a href="#l10.94"></a><span id="l10.94">   // we need to put messages in the folder or the sort logic doesn't actually</span>
<a href="#l10.95"></a><span id="l10.95">   //  save the sort state. (this is the C++ view's fault.)</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-  let [folder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+  let [folder] = make_folder_with_sets(1);</span>
<a href="#l10.98"></a><span id="l10.98">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l10.99"></a><span id="l10.99"> </span>
<a href="#l10.100"></a><span id="l10.100">   // - start out by being in an illegal (for group-by-sort) sort mode and</span>
<a href="#l10.101"></a><span id="l10.101">   //  switch to group-by-sort.</span>
<a href="#l10.102"></a><span id="l10.102">   // (sorting changes are synchronous)</span>
<a href="#l10.103"></a><span id="l10.103">   viewWrapper.sort(Ci.nsMsgViewSortType.byId,</span>
<a href="#l10.104"></a><span id="l10.104">                    Ci.nsMsgViewSortOrder.descending);</span>
<a href="#l10.105"></a><span id="l10.105">   yield async_view_group_by_sort(viewWrapper, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_realFolder.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_realFolder.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,21 +1,15 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /**</span>
<a href="#l11.5"></a><span id="l11.5">  * Test DBViewWrapper against a single local folder.  Try and test all the</span>
<a href="#l11.6"></a><span id="l11.6">  *  features we can without having a fake newsgroup.  (Some features are</span>
<a href="#l11.7"></a><span id="l11.7">  *  newsgroup specific.)</span>
<a href="#l11.8"></a><span id="l11.8">  */</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-load(&quot;../../../../mailnews/resources/logHelper.js&quot;);</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">-load(&quot;../../../../mailnews/resources/asyncTestUtils.js&quot;);</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+/* import-globals-from resources/viewWrapperTestUtils.js */</span>
<a href="#l11.18"></a><span id="l11.18"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l11.19"></a><span id="l11.19"> initViewWrapperTestUtils();</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l11.22"></a><span id="l11.22"> </span>
<a href="#l11.23"></a><span id="l11.23"> /* ===== Real Folder, no features ===== */</span>
<a href="#l11.24"></a><span id="l11.24"> </span>
<a href="#l11.25"></a><span id="l11.25"> /**</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineat">@@ -144,18 +138,17 @@ function* test_real_folder_threading_thr</span>
<a href="#l11.27"></a><span id="l11.27"> }</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29"> function* test_real_folder_threading_grouped_by_sort() {</span>
<a href="#l11.30"></a><span id="l11.30">   let viewWrapper = make_view_wrapper();</span>
<a href="#l11.31"></a><span id="l11.31"> </span>
<a href="#l11.32"></a><span id="l11.32">   // create some messages that belong to the 'in this week' bucket when sorting</span>
<a href="#l11.33"></a><span id="l11.33">   //  by date and grouping by date.</span>
<a href="#l11.34"></a><span id="l11.34">   const count = 5;</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-  let [folder, messageSet] = make_folder_with_sets([</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-    {count: count, age: {days: 2}, age_incr: {mins: 1}}]);</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+  let [folder] = make_folder_with_sets([{count, age: {days: 2}, age_incr: {mins: 1}}]);</span>
<a href="#l11.38"></a><span id="l11.38"> </span>
<a href="#l11.39"></a><span id="l11.39">   // group-by-sort sorted by date</span>
<a href="#l11.40"></a><span id="l11.40">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l11.41"></a><span id="l11.41">   viewWrapper.beginViewUpdate();</span>
<a href="#l11.42"></a><span id="l11.42">   viewWrapper.showGroupedBySort = true;</span>
<a href="#l11.43"></a><span id="l11.43">   // whitebox test view flags (we've gotten them wrong before...)</span>
<a href="#l11.44"></a><span id="l11.44">   assert_bit_set(viewWrapper._viewFlags,</span>
<a href="#l11.45"></a><span id="l11.45">                  Ci.nsMsgViewFlagsType.kThreadedDisplay,</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineat">@@ -339,33 +332,33 @@ function* test_real_folder_mail_views_un</span>
<a href="#l11.47"></a><span id="l11.47">   verify_messages_in_view([setOne, setTwo, setThree], viewWrapper);</span>
<a href="#l11.48"></a><span id="l11.48"> }</span>
<a href="#l11.49"></a><span id="l11.49"> </span>
<a href="#l11.50"></a><span id="l11.50"> function* test_real_folder_mail_views_tags() {</span>
<a href="#l11.51"></a><span id="l11.51">   let viewWrapper = make_view_wrapper();</span>
<a href="#l11.52"></a><span id="l11.52"> </span>
<a href="#l11.53"></a><span id="l11.53">   // setup the initial set with the tag</span>
<a href="#l11.54"></a><span id="l11.54">   let [folder, setOne, setTwo] = make_folder_with_sets(2);</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-  setOne.addTag('$label1');</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+  setOne.addTag(&quot;$label1&quot;);</span>
<a href="#l11.57"></a><span id="l11.57"> </span>
<a href="#l11.58"></a><span id="l11.58">   // open, apply mail view constraint, see those messages</span>
<a href="#l11.59"></a><span id="l11.59">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-  yield async_view_set_mail_view(viewWrapper, MailViewConstants.kViewItemTags, '$label1');</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+  yield async_view_set_mail_view(viewWrapper, MailViewConstants.kViewItemTags, &quot;$label1&quot;);</span>
<a href="#l11.62"></a><span id="l11.62">   verify_messages_in_view(setOne, viewWrapper);</span>
<a href="#l11.63"></a><span id="l11.63"> </span>
<a href="#l11.64"></a><span id="l11.64">   // add some more with the tag</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-  setTwo.addTag('$label1');</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+  setTwo.addTag(&quot;$label1&quot;);</span>
<a href="#l11.67"></a><span id="l11.67"> </span>
<a href="#l11.68"></a><span id="l11.68">   // make sure they showed up</span>
<a href="#l11.69"></a><span id="l11.69">   yield async_view_refresh(viewWrapper); // QUICKSEARCH-VIEW-LIMITATION-REMOVE</span>
<a href="#l11.70"></a><span id="l11.70">   verify_messages_in_view([setOne, setTwo], viewWrapper);</span>
<a href="#l11.71"></a><span id="l11.71"> </span>
<a href="#l11.72"></a><span id="l11.72">   // remove them all</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-  setOne.removeTag('$label1');</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-  setTwo.removeTag('$label1');</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+  setOne.removeTag(&quot;$label1&quot;);</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+  setTwo.removeTag(&quot;$label1&quot;);</span>
<a href="#l11.77"></a><span id="l11.77"> </span>
<a href="#l11.78"></a><span id="l11.78">   // make sure they all disappeared. #3</span>
<a href="#l11.79"></a><span id="l11.79">   yield async_view_refresh(viewWrapper);</span>
<a href="#l11.80"></a><span id="l11.80">   verify_empty_view(viewWrapper);</span>
<a href="#l11.81"></a><span id="l11.81"> }</span>
<a href="#l11.82"></a><span id="l11.82"> </span>
<a href="#l11.83"></a><span id="l11.83"> function test_real_folder_mail_views_not_deleted() {</span>
<a href="#l11.84"></a><span id="l11.84">   // not sure how to test this in the absence of an IMAP account with the IMAP</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineat">@@ -378,55 +371,55 @@ function test_real_folder_mail_views_cus</span>
<a href="#l11.86"></a><span id="l11.86">   punt();</span>
<a href="#l11.87"></a><span id="l11.87"> }</span>
<a href="#l11.88"></a><span id="l11.88"> </span>
<a href="#l11.89"></a><span id="l11.89"> // recent mail = less than 1 day</span>
<a href="#l11.90"></a><span id="l11.90"> function* test_real_folder_mail_views_custom_recent_mail() {</span>
<a href="#l11.91"></a><span id="l11.91">   let viewWrapper = make_view_wrapper();</span>
<a href="#l11.92"></a><span id="l11.92"> </span>
<a href="#l11.93"></a><span id="l11.93">   // create a set that meets the threshold and a set that does not</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineminus">-  let [folder, setRecent, setOld] = make_folder_with_sets([</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+  let [folder, setRecent] = make_folder_with_sets([</span>
<a href="#l11.96"></a><span id="l11.96">     {age: {mins: 0}},</span>
<a href="#l11.97"></a><span id="l11.97">     {age: {days: 2}, age_incr: {mins: 1}},</span>
<a href="#l11.98"></a><span id="l11.98">   ]);</span>
<a href="#l11.99"></a><span id="l11.99"> </span>
<a href="#l11.100"></a><span id="l11.100">   // open the folder, ensure only the recent guys show. #1</span>
<a href="#l11.101"></a><span id="l11.101">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l11.102"></a><span id="l11.102">   yield async_view_set_mail_view(viewWrapper, &quot;Recent Mail&quot;);</span>
<a href="#l11.103"></a><span id="l11.103">   verify_messages_in_view(setRecent, viewWrapper);</span>
<a href="#l11.104"></a><span id="l11.104"> </span>
<a href="#l11.105"></a><span id="l11.105">   // add two more sets, one that meets, and one that doesn't. #2</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineminus">-  let [setMoreRecent, setMoreOld] = make_new_sets_in_folder(folder, [</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+  let [setMoreRecent] = make_new_sets_in_folder(folder, [</span>
<a href="#l11.108"></a><span id="l11.108">     {age: {mins: 0}},</span>
<a href="#l11.109"></a><span id="l11.109">     {age: {days: 2, hours: 1}, age_incr: {mins: 1}},</span>
<a href="#l11.110"></a><span id="l11.110">   ]);</span>
<a href="#l11.111"></a><span id="l11.111">   // make sure that all we see is our previous recent set and our new recent set</span>
<a href="#l11.112"></a><span id="l11.112">   verify_messages_in_view([setRecent, setMoreRecent], viewWrapper);</span>
<a href="#l11.113"></a><span id="l11.113"> </span>
<a href="#l11.114"></a><span id="l11.114">   // we aren't going to mess with the system clock, so no #3.</span>
<a href="#l11.115"></a><span id="l11.115">   // (we are assuming that the underlying code handles message deletion.  also,</span>
<a href="#l11.116"></a><span id="l11.116">   //  we are taking the position that message timestamps should not change.)</span>
<a href="#l11.117"></a><span id="l11.117"> }</span>
<a href="#l11.118"></a><span id="l11.118"> </span>
<a href="#l11.119"></a><span id="l11.119"> function* test_real_folder_mail_views_custom_last_5_days() {</span>
<a href="#l11.120"></a><span id="l11.120">   let viewWrapper = make_view_wrapper();</span>
<a href="#l11.121"></a><span id="l11.121"> </span>
<a href="#l11.122"></a><span id="l11.122">   // create a set that meets the threshold and a set that does not</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineminus">-  let [folder, setRecent, setOld] = make_folder_with_sets([</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineplus">+  let [folder, setRecent] = make_folder_with_sets([</span>
<a href="#l11.125"></a><span id="l11.125">     {age: {days: 2}, age_incr: {mins: 1}},</span>
<a href="#l11.126"></a><span id="l11.126">     {age: {days: 6}, age_incr: {mins: 1}},</span>
<a href="#l11.127"></a><span id="l11.127">   ]);</span>
<a href="#l11.128"></a><span id="l11.128"> </span>
<a href="#l11.129"></a><span id="l11.129">   // open the folder, ensure only the recent guys show. #1</span>
<a href="#l11.130"></a><span id="l11.130">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l11.131"></a><span id="l11.131">   yield async_view_set_mail_view(viewWrapper, &quot;Last 5 Days&quot;);</span>
<a href="#l11.132"></a><span id="l11.132">   verify_messages_in_view(setRecent, viewWrapper);</span>
<a href="#l11.133"></a><span id="l11.133"> </span>
<a href="#l11.134"></a><span id="l11.134">   // add two more sets, one that meets, and one that doesn't. #2</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineminus">-  let [setMoreRecent, setMoreOld] = make_new_sets_in_folder(folder, [</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+  let [setMoreRecent] = make_new_sets_in_folder(folder, [</span>
<a href="#l11.137"></a><span id="l11.137">     {age: {mins: 0}},</span>
<a href="#l11.138"></a><span id="l11.138">     {age: {days: 5, hours: 1}, age_incr: {mins: 1}},</span>
<a href="#l11.139"></a><span id="l11.139">   ]);</span>
<a href="#l11.140"></a><span id="l11.140">   // make sure that all we see is our previous recent set and our new recent set</span>
<a href="#l11.141"></a><span id="l11.141">   verify_messages_in_view([setRecent, setMoreRecent], viewWrapper);</span>
<a href="#l11.142"></a><span id="l11.142"> </span>
<a href="#l11.143"></a><span id="l11.143">   // we aren't going to mess with the system clock, so no #3.</span>
<a href="#l11.144"></a><span id="l11.144">   // (we are assuming that the underlying code handles message deletion.  also,</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineat">@@ -455,30 +448,28 @@ function* test_real_folder_mail_views_cu</span>
<a href="#l11.146"></a><span id="l11.146">   setFlippy.setJunk(true);</span>
<a href="#l11.147"></a><span id="l11.147">   yield async_view_refresh(viewWrapper);</span>
<a href="#l11.148"></a><span id="l11.148">   verify_messages_in_view(setNotJunk, viewWrapper);</span>
<a href="#l11.149"></a><span id="l11.149"> }</span>
<a href="#l11.150"></a><span id="l11.150"> </span>
<a href="#l11.151"></a><span id="l11.151"> function* test_real_folder_mail_views_custom_has_attachments() {</span>
<a href="#l11.152"></a><span id="l11.152">   let viewWrapper = make_view_wrapper();</span>
<a href="#l11.153"></a><span id="l11.153"> </span>
<a href="#l11.154"></a><span id="l11.154" class="difflineminus">-  let attachSetDef = {attachments: [{filename: 'foo.png',</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineminus">-                                     contentType: 'image/png',</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineminus">-                                     encoding: 'base64', charset: null,</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineminus">-                                     body: 'YWJj\n', format: null}]};</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineplus">+  let attachSetDef = {attachments: [{filename: &quot;foo.png&quot;,</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineplus">+                                     contentType: &quot;image/png&quot;,</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineplus">+                                     encoding: &quot;base64&quot;, charset: null,</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineplus">+                                     body: &quot;YWJj\n&quot;, format: null}]};</span>
<a href="#l11.162"></a><span id="l11.162">   let noAttachSetDef = {};</span>
<a href="#l11.163"></a><span id="l11.163"> </span>
<a href="#l11.164"></a><span id="l11.164" class="difflineminus">-  let [folder, setNoAttach, setAttach] =</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineminus">-    make_folder_with_sets([noAttachSetDef, attachSetDef]);</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineplus">+  let [folder, , setAttach] = make_folder_with_sets([noAttachSetDef, attachSetDef]);</span>
<a href="#l11.167"></a><span id="l11.167">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l11.168"></a><span id="l11.168">   yield async_view_set_mail_view(viewWrapper, &quot;Has Attachments&quot;);</span>
<a href="#l11.169"></a><span id="l11.169">   verify_messages_in_view(setAttach, viewWrapper);</span>
<a href="#l11.170"></a><span id="l11.170"> </span>
<a href="#l11.171"></a><span id="l11.171" class="difflineminus">-  let [setMoreAttach, setMoreNoAttach] =</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineminus">-    make_new_sets_in_folder(folder, [attachSetDef, noAttachSetDef]);</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineplus">+  let [setMoreAttach] = make_new_sets_in_folder(folder, [attachSetDef, noAttachSetDef]);</span>
<a href="#l11.174"></a><span id="l11.174">   verify_messages_in_view([setAttach, setMoreAttach], viewWrapper);</span>
<a href="#l11.175"></a><span id="l11.175"> }</span>
<a href="#l11.176"></a><span id="l11.176"> </span>
<a href="#l11.177"></a><span id="l11.177"> /* ===== Real Folder, Special Views ===== */</span>
<a href="#l11.178"></a><span id="l11.178"> </span>
<a href="#l11.179"></a><span id="l11.179"> function* test_real_folder_special_views_threads_with_unread() {</span>
<a href="#l11.180"></a><span id="l11.180">   let viewWrapper = make_view_wrapper();</span>
<a href="#l11.181"></a><span id="l11.181">   let folder = make_empty_folder();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_virtualFolder.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_virtualFolder.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -6,23 +6,17 @@</span>
<a href="#l12.4"></a><span id="l12.4">  *   view's problem!  (We test it in the real folder to make sure we are telling</span>
<a href="#l12.5"></a><span id="l12.5">  *   it to do things correctly.)</span>
<a href="#l12.6"></a><span id="l12.6">  * - view flags.  Again, it's a db view issue once we're sure we set the bits.</span>
<a href="#l12.7"></a><span id="l12.7">  * - special view with threads.  same deal.</span>
<a href="#l12.8"></a><span id="l12.8">  *</span>
<a href="#l12.9"></a><span id="l12.9">  * We could test all these things, but my patch is way behind schedule...</span>
<a href="#l12.10"></a><span id="l12.10">  */</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-load(&quot;../../../../mailnews/resources/logHelper.js&quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-load(&quot;../../../../mailnews/resources/asyncTestUtils.js&quot;);</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+/* import-globals-from resources/viewWrapperTestUtils.js */</span>
<a href="#l12.20"></a><span id="l12.20"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l12.21"></a><span id="l12.21"> initViewWrapperTestUtils();</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23"> /**</span>
<a href="#l12.24"></a><span id="l12.24">  * Make sure we open a virtual folder backed by a single underlying folder</span>
<a href="#l12.25"></a><span id="l12.25">  *  correctly; no constraints.</span>
<a href="#l12.26"></a><span id="l12.26">  */</span>
<a href="#l12.27"></a><span id="l12.27"> function* test_virtual_folder_single_load_no_pred() {</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineat">@@ -45,18 +39,17 @@ function* test_virtual_folder_single_loa</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30"> /**</span>
<a href="#l12.31"></a><span id="l12.31">  * Make sure we open a virtual folder backed by a single underlying folder</span>
<a href="#l12.32"></a><span id="l12.32">  *  correctly; one constraint.</span>
<a href="#l12.33"></a><span id="l12.33">  */</span>
<a href="#l12.34"></a><span id="l12.34"> function* test_virtual_folder_single_load_simple_pred() {</span>
<a href="#l12.35"></a><span id="l12.35">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-  let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-    {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+  let [folderOne, oneSubjFoo] = make_folder_with_sets([{subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41">   let virtFolder = make_virtual_folder([folderOne],</span>
<a href="#l12.42"></a><span id="l12.42">                                        {subject: &quot;foo&quot;});</span>
<a href="#l12.43"></a><span id="l12.43">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l12.44"></a><span id="l12.44"> </span>
<a href="#l12.45"></a><span id="l12.45">   verify_messages_in_view(oneSubjFoo, viewWrapper);</span>
<a href="#l12.46"></a><span id="l12.46">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l12.47"></a><span id="l12.47"> }</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineat">@@ -65,17 +58,17 @@ function* test_virtual_folder_single_loa</span>
<a href="#l12.49"></a><span id="l12.49">  * Make sure we open a virtual folder backed by a single underlying folder</span>
<a href="#l12.50"></a><span id="l12.50">  *  correctly; two constraints ANDed together.</span>
<a href="#l12.51"></a><span id="l12.51">  */</span>
<a href="#l12.52"></a><span id="l12.52"> function* test_virtual_folder_single_load_complex_pred() {</span>
<a href="#l12.53"></a><span id="l12.53">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55">   let whoBar = make_person_with_word_in_name(&quot;bar&quot;);</span>
<a href="#l12.56"></a><span id="l12.56"> </span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-  let [folderOne, oneSubjOnly, oneFromOnly, oneBoth, oneNone] =</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+  let [folderOne, , , oneBoth] =</span>
<a href="#l12.59"></a><span id="l12.59">     make_folder_with_sets([{subject: &quot;foo&quot;}, {from: whoBar},</span>
<a href="#l12.60"></a><span id="l12.60">                            {subject: &quot;foo&quot;, from: whoBar}, {}]);</span>
<a href="#l12.61"></a><span id="l12.61"> </span>
<a href="#l12.62"></a><span id="l12.62">   let virtFolder = make_virtual_folder([folderOne],</span>
<a href="#l12.63"></a><span id="l12.63">                                        {subject: &quot;foo&quot;, from: &quot;bar&quot;},</span>
<a href="#l12.64"></a><span id="l12.64">                                        /* and? */ true);</span>
<a href="#l12.65"></a><span id="l12.65">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l12.66"></a><span id="l12.66"> </span>
<a href="#l12.67"></a><span id="l12.67" class="difflineat">@@ -86,26 +79,23 @@ function* test_virtual_folder_single_loa</span>
<a href="#l12.68"></a><span id="l12.68"> /**</span>
<a href="#l12.69"></a><span id="l12.69">  * Open a single-backed virtual folder, verify, open another single-backed</span>
<a href="#l12.70"></a><span id="l12.70">  *  virtual folder, verify.  We are testing our ability to change folders</span>
<a href="#l12.71"></a><span id="l12.71">  *  without exploding.</span>
<a href="#l12.72"></a><span id="l12.72">  */</span>
<a href="#l12.73"></a><span id="l12.73"> function* test_virtual_folder_single_load_after_load() {</span>
<a href="#l12.74"></a><span id="l12.74">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.75"></a><span id="l12.75"> </span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-  let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-    {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-  let virtOne = make_virtual_folder([folderOne],</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-                                    {subject: &quot;foo&quot;});</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineplus">+  let [folderOne, oneSubjFoo] = make_folder_with_sets([{subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineplus">+  let virtOne = make_virtual_folder([folderOne], {subject: &quot;foo&quot;});</span>
<a href="#l12.82"></a><span id="l12.82">   yield async_view_open(viewWrapper, virtOne);</span>
<a href="#l12.83"></a><span id="l12.83">   verify_messages_in_view([oneSubjFoo], viewWrapper);</span>
<a href="#l12.84"></a><span id="l12.84"> </span>
<a href="#l12.85"></a><span id="l12.85">   // use &quot;bar&quot; instead of &quot;foo&quot; to make sure constraints are properly changing</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-  let [folderTwo, twoSubjBar, twoNopers] = make_folder_with_sets([</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-    {subject: &quot;bar&quot;}, {}]);</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+  let [folderTwo, twoSubjBar] = make_folder_with_sets([{subject: &quot;bar&quot;}, {}]);</span>
<a href="#l12.89"></a><span id="l12.89">   let virtTwo = make_virtual_folder([folderTwo],</span>
<a href="#l12.90"></a><span id="l12.90">                                     {subject: &quot;bar&quot;});</span>
<a href="#l12.91"></a><span id="l12.91">   yield async_view_open(viewWrapper, virtTwo);</span>
<a href="#l12.92"></a><span id="l12.92">   verify_messages_in_view([twoSubjBar], viewWrapper);</span>
<a href="#l12.93"></a><span id="l12.93">   virtOne.parent.propagateDelete(virtOne, true, null);</span>
<a href="#l12.94"></a><span id="l12.94">   virtTwo.parent.propagateDelete(virtTwo, true, null);</span>
<a href="#l12.95"></a><span id="l12.95"> }</span>
<a href="#l12.96"></a><span id="l12.96"> </span>
<a href="#l12.97"></a><span id="l12.97" class="difflineat">@@ -155,20 +145,18 @@ function* test_virtual_folder_multi_sort</span>
<a href="#l12.98"></a><span id="l12.98"> </span>
<a href="#l12.99"></a><span id="l12.99"> /**</span>
<a href="#l12.100"></a><span id="l12.100">  * Make sure we open a virtual folder backed by multiple underlying folders</span>
<a href="#l12.101"></a><span id="l12.101">  *  correctly; one constraint.</span>
<a href="#l12.102"></a><span id="l12.102">  */</span>
<a href="#l12.103"></a><span id="l12.103"> function* test_virtual_folder_multi_load_simple_pred() {</span>
<a href="#l12.104"></a><span id="l12.104">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.105"></a><span id="l12.105"> </span>
<a href="#l12.106"></a><span id="l12.106" class="difflineminus">-  let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-    {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-  let [folderTwo, twoSubjFoo, twoNopers] = make_folder_with_sets([</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-    {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineplus">+  let [folderOne, oneSubjFoo] = make_folder_with_sets([{subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineplus">+  let [folderTwo, twoSubjFoo] = make_folder_with_sets([{subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.112"></a><span id="l12.112"> </span>
<a href="#l12.113"></a><span id="l12.113">   let virtFolder = make_virtual_folder([folderOne, folderTwo],</span>
<a href="#l12.114"></a><span id="l12.114">                                        {subject: &quot;foo&quot;});</span>
<a href="#l12.115"></a><span id="l12.115">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l12.116"></a><span id="l12.116"> </span>
<a href="#l12.117"></a><span id="l12.117">   verify_messages_in_view([oneSubjFoo, twoSubjFoo], viewWrapper);</span>
<a href="#l12.118"></a><span id="l12.118">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l12.119"></a><span id="l12.119"> }</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineat">@@ -177,20 +165,20 @@ function* test_virtual_folder_multi_load</span>
<a href="#l12.121"></a><span id="l12.121">  * Make sure we open a virtual folder backed by multiple underlying folders</span>
<a href="#l12.122"></a><span id="l12.122">  *  correctly; two constraints ANDed together.</span>
<a href="#l12.123"></a><span id="l12.123">  */</span>
<a href="#l12.124"></a><span id="l12.124"> function* test_virtual_folder_multi_load_complex_pred() {</span>
<a href="#l12.125"></a><span id="l12.125">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.126"></a><span id="l12.126"> </span>
<a href="#l12.127"></a><span id="l12.127">   let whoBar = make_person_with_word_in_name(&quot;bar&quot;);</span>
<a href="#l12.128"></a><span id="l12.128"> </span>
<a href="#l12.129"></a><span id="l12.129" class="difflineminus">-  let [folderOne, oneSubjOnly, oneFromOnly, oneBoth, oneNone] =</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineplus">+  let [folderOne, , , oneBoth] =</span>
<a href="#l12.131"></a><span id="l12.131">     make_folder_with_sets([{subject: &quot;foo&quot;}, {from: whoBar},</span>
<a href="#l12.132"></a><span id="l12.132">                            {subject: &quot;foo&quot;, from: whoBar}, {}]);</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineminus">-  let [folderTwo, twoSubjOnly, twoFromOnly, twoBoth, twoNone] =</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineplus">+  let [folderTwo, , , twoBoth] =</span>
<a href="#l12.135"></a><span id="l12.135">     make_folder_with_sets([{subject: &quot;foo&quot;}, {from: whoBar},</span>
<a href="#l12.136"></a><span id="l12.136">                            {subject: &quot;foo&quot;, from: whoBar}, {}]);</span>
<a href="#l12.137"></a><span id="l12.137"> </span>
<a href="#l12.138"></a><span id="l12.138">   let virtFolder = make_virtual_folder([folderOne, folderTwo],</span>
<a href="#l12.139"></a><span id="l12.139">                                        {subject: &quot;foo&quot;, from: &quot;bar&quot;},</span>
<a href="#l12.140"></a><span id="l12.140">                                        /* and? */ true);</span>
<a href="#l12.141"></a><span id="l12.141">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l12.142"></a><span id="l12.142"> </span>
<a href="#l12.143"></a><span id="l12.143" class="difflineat">@@ -232,25 +220,23 @@ function* test_virtual_folder_multi_load</span>
<a href="#l12.144"></a><span id="l12.144"> </span>
<a href="#l12.145"></a><span id="l12.145"> /**</span>
<a href="#l12.146"></a><span id="l12.146">  * Make sure that opening a virtual folder backed by multiple real folders, then</span>
<a href="#l12.147"></a><span id="l12.147">  *  opening another virtual folder of the same variety works without explosions.</span>
<a href="#l12.148"></a><span id="l12.148">  */</span>
<a href="#l12.149"></a><span id="l12.149"> function* test_virtual_folder_multi_load_after_load() {</span>
<a href="#l12.150"></a><span id="l12.150">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.151"></a><span id="l12.151"> </span>
<a href="#l12.152"></a><span id="l12.152" class="difflineminus">-  let [foldersOne, oneSubjFoo, oneNopers] = make_folders_with_sets(2, [</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineminus">-    {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineplus">+  let [foldersOne, oneSubjFoo] = make_folders_with_sets(2, [{subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.155"></a><span id="l12.155">   let virtOne = make_virtual_folder(foldersOne, {subject: &quot;foo&quot;});</span>
<a href="#l12.156"></a><span id="l12.156">   yield async_view_open(viewWrapper, virtOne);</span>
<a href="#l12.157"></a><span id="l12.157">   verify_messages_in_view([oneSubjFoo], viewWrapper);</span>
<a href="#l12.158"></a><span id="l12.158"> </span>
<a href="#l12.159"></a><span id="l12.159">   // use &quot;bar&quot; instead of &quot;foo&quot; to make sure constraints are properly changing</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineminus">-  let [foldersTwo, twoSubjBar, twoNopers] = make_folders_with_sets(3, [</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineminus">-    {subject: &quot;bar&quot;}, {}]);</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineplus">+  let [foldersTwo, twoSubjBar] = make_folders_with_sets(3, [{subject: &quot;bar&quot;}, {}]);</span>
<a href="#l12.163"></a><span id="l12.163">   let virtTwo = make_virtual_folder(foldersTwo,</span>
<a href="#l12.164"></a><span id="l12.164">                                     {subject: &quot;bar&quot;});</span>
<a href="#l12.165"></a><span id="l12.165">   yield async_view_open(viewWrapper, virtTwo);</span>
<a href="#l12.166"></a><span id="l12.166">   verify_messages_in_view([twoSubjBar], viewWrapper);</span>
<a href="#l12.167"></a><span id="l12.167"> </span>
<a href="#l12.168"></a><span id="l12.168">   yield async_view_open(viewWrapper, virtOne);</span>
<a href="#l12.169"></a><span id="l12.169">   verify_messages_in_view([oneSubjFoo], viewWrapper);</span>
<a href="#l12.170"></a><span id="l12.170">   virtOne.parent.propagateDelete(virtOne, true, null);</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineat">@@ -262,25 +248,23 @@ function* test_virtual_folder_multi_load</span>
<a href="#l12.172"></a><span id="l12.172">  *  a multi-backed one, then the single-backed one again doesn't explode.</span>
<a href="#l12.173"></a><span id="l12.173">  *</span>
<a href="#l12.174"></a><span id="l12.174">  * This is just test_virtual_folder_multi_load_after_load with foldersOne told</span>
<a href="#l12.175"></a><span id="l12.175">  *  to create just a single folder.</span>
<a href="#l12.176"></a><span id="l12.176">  */</span>
<a href="#l12.177"></a><span id="l12.177"> function* test_virtual_folder_combo_load_after_load() {</span>
<a href="#l12.178"></a><span id="l12.178">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.179"></a><span id="l12.179"> </span>
<a href="#l12.180"></a><span id="l12.180" class="difflineminus">-  let [foldersOne, oneSubjFoo, oneNopers] = make_folders_with_sets(1, [</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineminus">-    {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineplus">+  let [foldersOne, oneSubjFoo] = make_folders_with_sets(1, [{subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.183"></a><span id="l12.183">   let virtOne = make_virtual_folder(foldersOne, {subject: &quot;foo&quot;});</span>
<a href="#l12.184"></a><span id="l12.184">   yield async_view_open(viewWrapper, virtOne);</span>
<a href="#l12.185"></a><span id="l12.185">   verify_messages_in_view([oneSubjFoo], viewWrapper);</span>
<a href="#l12.186"></a><span id="l12.186"> </span>
<a href="#l12.187"></a><span id="l12.187">   // use &quot;bar&quot; instead of &quot;foo&quot; to make sure constraints are properly changing</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineminus">-  let [foldersTwo, twoSubjBar, twoNopers] = make_folders_with_sets(3, [</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineminus">-    {subject: &quot;bar&quot;}, {}]);</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineplus">+  let [foldersTwo, twoSubjBar] = make_folders_with_sets(3, [{subject: &quot;bar&quot;}, {}]);</span>
<a href="#l12.191"></a><span id="l12.191">   let virtTwo = make_virtual_folder(foldersTwo,</span>
<a href="#l12.192"></a><span id="l12.192">                                     {subject: &quot;bar&quot;});</span>
<a href="#l12.193"></a><span id="l12.193">   yield async_view_open(viewWrapper, virtTwo);</span>
<a href="#l12.194"></a><span id="l12.194">   verify_messages_in_view([twoSubjBar], viewWrapper);</span>
<a href="#l12.195"></a><span id="l12.195"> </span>
<a href="#l12.196"></a><span id="l12.196">   yield async_view_open(viewWrapper, virtOne);</span>
<a href="#l12.197"></a><span id="l12.197">   verify_messages_in_view([oneSubjFoo], viewWrapper);</span>
<a href="#l12.198"></a><span id="l12.198">   virtOne.parent.propagateDelete(virtOne, true, null);</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineat">@@ -307,20 +291,18 @@ function* test_virtual_folder_filters_ou</span>
<a href="#l12.200"></a><span id="l12.200"> /**</span>
<a href="#l12.201"></a><span id="l12.201">  * Verify that if one of the folders backing our virtual folder is deleted that</span>
<a href="#l12.202"></a><span id="l12.202">  *  we do not explode.  Then verify that if we remove the rest of them that the</span>
<a href="#l12.203"></a><span id="l12.203">  *  view wrapper closes itself.</span>
<a href="#l12.204"></a><span id="l12.204">  */</span>
<a href="#l12.205"></a><span id="l12.205"> function* test_virtual_folder_underlying_folder_deleted() {</span>
<a href="#l12.206"></a><span id="l12.206">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.207"></a><span id="l12.207"> </span>
<a href="#l12.208"></a><span id="l12.208" class="difflineminus">-  let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineminus">-    {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineminus">-  let [folderTwo, twoSubjFoo, twoNopers] = make_folder_with_sets([</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineminus">-    {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineplus">+  let [folderOne] = make_folder_with_sets([{subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineplus">+  let [folderTwo, twoSubjFoo] = make_folder_with_sets([{subject: &quot;foo&quot;}, {}]);</span>
<a href="#l12.214"></a><span id="l12.214"> </span>
<a href="#l12.215"></a><span id="l12.215">   let virtFolder = make_virtual_folder([folderOne, folderTwo],</span>
<a href="#l12.216"></a><span id="l12.216">                                        {subject: &quot;foo&quot;});</span>
<a href="#l12.217"></a><span id="l12.217">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l12.218"></a><span id="l12.218"> </span>
<a href="#l12.219"></a><span id="l12.219">   // this triggers the search (under the view's hood), so it's async</span>
<a href="#l12.220"></a><span id="l12.220">   yield async_delete_folder(folderOne, viewWrapper);</span>
<a href="#l12.221"></a><span id="l12.221"> </span>
<a href="#l12.222"></a><span id="l12.222" class="difflineat">@@ -329,41 +311,40 @@ function* test_virtual_folder_underlying</span>
<a href="#l12.223"></a><span id="l12.223"> </span>
<a href="#l12.224"></a><span id="l12.224">   // this one is not async though, because we are expecting to close the wrapper</span>
<a href="#l12.225"></a><span id="l12.225">   //  and ignore the view entirely, so do not yield.</span>
<a href="#l12.226"></a><span id="l12.226">   delete_folder(folderTwo);</span>
<a href="#l12.227"></a><span id="l12.227"> </span>
<a href="#l12.228"></a><span id="l12.228">   // now the view wrapper should have closed itself.</span>
<a href="#l12.229"></a><span id="l12.229">   Assert.equal(null, viewWrapper.displayedFolder);</span>
<a href="#l12.230"></a><span id="l12.230">   // This fails because virtFolder.parent is null, not sure why</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineminus">-  //virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineplus">+  // virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l12.233"></a><span id="l12.233"> }</span>
<a href="#l12.234"></a><span id="l12.234"> </span>
<a href="#l12.235"></a><span id="l12.235"> /* ===== Virtual Folder, Mail Views ===== */</span>
<a href="#l12.236"></a><span id="l12.236"> </span>
<a href="#l12.237"></a><span id="l12.237"> /*</span>
<a href="#l12.238"></a><span id="l12.238">  * We do not need to test all of the mail view permutations, realFolder</span>
<a href="#l12.239"></a><span id="l12.239">  *  already did that.  We just need to make sure it works at all.</span>
<a href="#l12.240"></a><span id="l12.240">  */</span>
<a href="#l12.241"></a><span id="l12.241"> </span>
<a href="#l12.242"></a><span id="l12.242"> function* test_virtual_folder_mail_views_unread(aNumFolders) {</span>
<a href="#l12.243"></a><span id="l12.243">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.244"></a><span id="l12.244"> </span>
<a href="#l12.245"></a><span id="l12.245" class="difflineminus">-  let [folders, fooOne, fooTwo, nopeOne, nopeTwo] = make_folders_with_sets(</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineplus">+  let [folders, fooOne, fooTwo] = make_folders_with_sets(</span>
<a href="#l12.247"></a><span id="l12.247">     aNumFolders, [{subject: &quot;foo 1&quot;}, {subject: &quot;foo 2&quot;}, {}, {}]);</span>
<a href="#l12.248"></a><span id="l12.248">   let virtFolder = make_virtual_folder(folders, {subject: &quot;foo&quot;});</span>
<a href="#l12.249"></a><span id="l12.249"> </span>
<a href="#l12.250"></a><span id="l12.250">   // everything is unread to start with!</span>
<a href="#l12.251"></a><span id="l12.251">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l12.252"></a><span id="l12.252">   yield async_view_set_mail_view(viewWrapper, MailViewConstants.kViewItemUnread);</span>
<a href="#l12.253"></a><span id="l12.253">   verify_messages_in_view([fooOne, fooTwo], viewWrapper);</span>
<a href="#l12.254"></a><span id="l12.254"> </span>
<a href="#l12.255"></a><span id="l12.255">   // add some more things (unread!), make sure they appear.</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineminus">-  let [fooThree, nopeThree] = make_new_sets_in_folders(folders,</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineminus">-    [{subject: &quot;foo 3&quot;}, {}]);</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineplus">+  let [fooThree] = make_new_sets_in_folders(folders, [{subject: &quot;foo 3&quot;}, {}]);</span>
<a href="#l12.259"></a><span id="l12.259">   verify_messages_in_view([fooOne, fooTwo, fooThree], viewWrapper);</span>
<a href="#l12.260"></a><span id="l12.260"> </span>
<a href="#l12.261"></a><span id="l12.261">   // make some things read, make sure they disappear. (after a refresh)</span>
<a href="#l12.262"></a><span id="l12.262">   fooTwo.setRead(true);</span>
<a href="#l12.263"></a><span id="l12.263">   yield async_view_refresh(viewWrapper);</span>
<a href="#l12.264"></a><span id="l12.264">   verify_messages_in_view([fooOne, fooThree], viewWrapper);</span>
<a href="#l12.265"></a><span id="l12.265"> </span>
<a href="#l12.266"></a><span id="l12.266">   // make those things un-read again.</span>
<a href="#l12.267"></a><span id="l12.267" class="difflineat">@@ -377,25 +358,23 @@ function* test_virtual_folder_mail_views</span>
<a href="#l12.268"></a><span id="l12.268"> </span>
<a href="#l12.269"></a><span id="l12.269"> // This tests that clearing the new messages in a folder also clears the</span>
<a href="#l12.270"></a><span id="l12.270"> // new flag on saved search folders based on the real folder. This could be a</span>
<a href="#l12.271"></a><span id="l12.271"> // core view test, or a mozmill test, but I think the view wrapper stuff</span>
<a href="#l12.272"></a><span id="l12.272"> // is involved in some of the issues here, so this is a compromise.</span>
<a href="#l12.273"></a><span id="l12.273"> function* test_virtual_folder_mail_new_handling() {</span>
<a href="#l12.274"></a><span id="l12.274">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.275"></a><span id="l12.275"> </span>
<a href="#l12.276"></a><span id="l12.276" class="difflineminus">-  let [folders, fooOne, fooTwo] = make_folders_with_sets(</span>
<a href="#l12.277"></a><span id="l12.277" class="difflineminus">-    1, [{subject: &quot;foo 1&quot;}, {subject: &quot;foo 2&quot;}]);</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineplus">+  let [folders] = make_folders_with_sets(1, [{subject: &quot;foo 1&quot;}, {subject: &quot;foo 2&quot;}]);</span>
<a href="#l12.279"></a><span id="l12.279">   let folder = folders[0];</span>
<a href="#l12.280"></a><span id="l12.280">   let virtFolder = make_virtual_folder(folders, {subject: &quot;foo&quot;});</span>
<a href="#l12.281"></a><span id="l12.281"> </span>
<a href="#l12.282"></a><span id="l12.282">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l12.283"></a><span id="l12.283"> </span>
<a href="#l12.284"></a><span id="l12.284" class="difflineminus">-  let [fooThree, nopeThree] = make_new_sets_in_folders(folders,</span>
<a href="#l12.285"></a><span id="l12.285" class="difflineminus">-    [{subject: &quot;foo 3&quot;}, {}]);</span>
<a href="#l12.286"></a><span id="l12.286" class="difflineplus">+  make_new_sets_in_folders(folders, [{subject: &quot;foo 3&quot;}, {}]);</span>
<a href="#l12.287"></a><span id="l12.287"> </span>
<a href="#l12.288"></a><span id="l12.288">   if (!virtFolder.hasNewMessages)</span>
<a href="#l12.289"></a><span id="l12.289">     do_throw(&quot;saved search should have new messages!&quot;);</span>
<a href="#l12.290"></a><span id="l12.290"> </span>
<a href="#l12.291"></a><span id="l12.291">   if (!folder.hasNewMessages)</span>
<a href="#l12.292"></a><span id="l12.292">     do_throw(&quot;folder should have new messages!&quot;);</span>
<a href="#l12.293"></a><span id="l12.293"> </span>
<a href="#l12.294"></a><span id="l12.294">   viewWrapper.close();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -2,23 +2,17 @@</span>
<a href="#l13.4"></a><span id="l13.4">  * Test DBViewWrapper against a virtual folder with a custom search term.</span>
<a href="#l13.5"></a><span id="l13.5">  *</span>
<a href="#l13.6"></a><span id="l13.6">  *  This test uses an imap message to specifically test the issues from</span>
<a href="#l13.7"></a><span id="l13.7">  *   bug 549336. The code is derived from test_viewWrapper_virtualFolder.js</span>
<a href="#l13.8"></a><span id="l13.8">  *</span>
<a href="#l13.9"></a><span id="l13.9">  *  Original author: Kent James</span>
<a href="#l13.10"></a><span id="l13.10">  */</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-load(&quot;../../../../mailnews/resources/logHelper.js&quot;);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-load(&quot;../../../../mailnews/resources/asyncTestUtils.js&quot;);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+/* import-globals-from resources/viewWrapperTestUtils.js */</span>
<a href="#l13.20"></a><span id="l13.20"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24"> initViewWrapperTestUtils({mode: &quot;imap&quot;, offline: false});</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26"> /**</span>
<a href="#l13.27"></a><span id="l13.27">  * A custom search term, that just does Subject Contains</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineat">@@ -46,18 +40,17 @@ MailServices.filters.addCustomTerm(gCust</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30"> /**</span>
<a href="#l13.31"></a><span id="l13.31">  * Make sure we open a virtual folder backed by a single underlying folder</span>
<a href="#l13.32"></a><span id="l13.32">  *  correctly, with a custom search term.</span>
<a href="#l13.33"></a><span id="l13.33">  */</span>
<a href="#l13.34"></a><span id="l13.34"> function* test_virtual_folder_single_load_custom_pred() {</span>
<a href="#l13.35"></a><span id="l13.35">   let viewWrapper = make_view_wrapper();</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-  let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-    {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+  let [folderOne, oneSubjFoo] = make_folder_with_sets([{subject: &quot;foo&quot;}, {}]);</span>
<a href="#l13.40"></a><span id="l13.40"> </span>
<a href="#l13.41"></a><span id="l13.41">   yield wait_for_message_injection();</span>
<a href="#l13.42"></a><span id="l13.42"> </span>
<a href="#l13.43"></a><span id="l13.43">   let virtFolder = make_virtual_folder(folderOne,</span>
<a href="#l13.44"></a><span id="l13.44">                                        {custom: &quot;foo&quot;});</span>
<a href="#l13.45"></a><span id="l13.45"> </span>
<a href="#l13.46"></a><span id="l13.46">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l13.47"></a><span id="l13.47"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

