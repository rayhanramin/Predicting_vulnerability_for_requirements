<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29294:107ee9bfae2229dc132b65b14383bee3ecddfc4f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 107ee9bfae2229dc132b65b14383bee3ecddfc4f" />
<meta property="og:url" content="/comm-central/rev/107ee9bfae2229dc132b65b14383bee3ecddfc4f" />
<meta property="og:description" content="Bug 1629666 - Prioritize loading RNP library from application directory. r=kaie DONTBUILD" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 107ee9bfae2229dc132b65b14383bee3ecddfc4f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/107ee9bfae2229dc132b65b14383bee3ecddfc4f">shortlog</a> |
<a href="/comm-central/log/107ee9bfae2229dc132b65b14383bee3ecddfc4f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/107ee9bfae2229dc132b65b14383bee3ecddfc4f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/107ee9bfae2229dc132b65b14383bee3ecddfc4f">files</a> |
changeset |
<a href="/comm-central/raw-rev/107ee9bfae2229dc132b65b14383bee3ecddfc4f">raw</a>  | <a href="/comm-central/archive/107ee9bfae2229dc132b65b14383bee3ecddfc4f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1629666">Bug 1629666</a> - Prioritize loading RNP library from application directory. r=kaie DONTBUILD
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#111;&#98;&#32;&#76;&#101;&#109;&#108;&#101;&#121;&#32;&#60;&#114;&#111;&#98;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 09 Apr 2020 11:48:54 -0400</td></tr>

<tr>
 <td>changeset 29294</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/107ee9bfae2229dc132b65b14383bee3ecddfc4f">107ee9bfae2229dc132b65b14383bee3ecddfc4f</a></td>
</tr>



<tr>
<td>parent 29293</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8258edd762d07db462ebea6bcdbbcfb95b45c1df">8258edd762d07db462ebea6bcdbbcfb95b45c1df</a>
</td>
</tr>

<tr>
<td>child 29295</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/46d32cfff30ff3d8ad4aeeb10f557283b44c10ee">46d32cfff30ff3d8ad4aeeb10f557283b44c10ee</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=107ee9bfae2229dc132b65b14383bee3ecddfc4f">17300</a></td></tr>
<tr><td>push user</td><td>thunderbird@calypsoblue.org</td></tr>
<tr><td>push date</td><td class="date age">Wed, 15 Apr 2020 17:56:25 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@107ee9bfae22 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=107ee9bfae2229dc132b65b14383bee3ecddfc4f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=107ee9bfae2229dc132b65b14383bee3ecddfc4f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=107ee9bfae2229dc132b65b14383bee3ecddfc4f&newProject=comm-central&newRevision=107ee9bfae2229dc132b65b14383bee3ecddfc4f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=107ee9bfae2229dc132b65b14383bee3ecddfc4f&newProject=comm-central&newRevision=107ee9bfae2229dc132b65b14383bee3ecddfc4f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=107ee9bfae2229dc132b65b14383bee3ecddfc4f&newProject=comm-central&newRevision=107ee9bfae2229dc132b65b14383bee3ecddfc4f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28kaie%29&revcount=50">kaie</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1629666">1629666</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1629666">Bug 1629666</a> - Prioritize loading RNP library from application directory. r=kaie DONTBUILD

Check the Thunderbird application directory for the RNP shared library (without
any SO version) before checking other locations. The build system will install
libraries named librnp.so, librnp.dylib, or rnp.dll depending on the OS.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/107ee9bfae2229dc132b65b14383bee3ecddfc4f/mail/extensions/openpgp/content/modules/rnpLib.jsm">mail/extensions/openpgp/content/modules/rnpLib.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/107ee9bfae2229dc132b65b14383bee3ecddfc4f/mail/extensions/openpgp/content/modules/rnpLib.jsm">file</a> |
<a href="/comm-central/annotate/107ee9bfae2229dc132b65b14383bee3ecddfc4f/mail/extensions/openpgp/content/modules/rnpLib.jsm">annotate</a> |
<a href="/comm-central/diff/107ee9bfae2229dc132b65b14383bee3ecddfc4f/mail/extensions/openpgp/content/modules/rnpLib.jsm">diff</a> |
<a href="/comm-central/comparison/107ee9bfae2229dc132b65b14383bee3ecddfc4f/mail/extensions/openpgp/content/modules/rnpLib.jsm">comparison</a> |
<a href="/comm-central/log/107ee9bfae2229dc132b65b14383bee3ecddfc4f/mail/extensions/openpgp/content/modules/rnpLib.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/rnpLib.jsm</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/rnpLib.jsm</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -46,16 +46,21 @@ function tryLoadRNP(name, suffix) {</span>
<a href="#l1.4"></a><span id="l1.4">         filename +</span>
<a href="#l1.5"></a><span id="l1.5">         &quot; from &quot; +</span>
<a href="#l1.6"></a><span id="l1.6">         loadFromInfo</span>
<a href="#l1.7"></a><span id="l1.7">     );</span>
<a href="#l1.8"></a><span id="l1.8">   }</span>
<a href="#l1.9"></a><span id="l1.9"> }</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> function loadExternalRNPLib() {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+  if (!librnp) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    // Try loading librnp.so, librnp.dylib, or rnp.dll first</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+    tryLoadRNP(&quot;rnp&quot;, &quot;&quot;);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+  }</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+</span>
<a href="#l1.17"></a><span id="l1.17">   if (!librnp &amp;&amp; (systemOS === &quot;winnt&quot; || systemOS === &quot;darwin&quot;)) {</span>
<a href="#l1.18"></a><span id="l1.18">     // rnp.0.dll or rnp.0.dylib</span>
<a href="#l1.19"></a><span id="l1.19">     tryLoadRNP(&quot;rnp.0&quot;, &quot;&quot;);</span>
<a href="#l1.20"></a><span id="l1.20">   }</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">   if (!librnp) {</span>
<a href="#l1.23"></a><span id="l1.23">     tryLoadRNP(&quot;rnp-0&quot;, &quot;&quot;);</span>
<a href="#l1.24"></a><span id="l1.24">   }</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineat">@@ -66,20 +71,16 @@ function loadExternalRNPLib() {</span>
<a href="#l1.26"></a><span id="l1.26">   }</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28">   if (!librnp &amp;&amp; !(systemOS === &quot;winnt&quot;) &amp;&amp; !(systemOS === &quot;darwin&quot;)) {</span>
<a href="#l1.29"></a><span id="l1.29">     // librnp.so.0</span>
<a href="#l1.30"></a><span id="l1.30">     tryLoadRNP(&quot;rnp&quot;, &quot;.0&quot;);</span>
<a href="#l1.31"></a><span id="l1.31">   }</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33">   if (!librnp) {</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-    tryLoadRNP(&quot;rnp&quot;, &quot;&quot;);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-  }</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-  if (!librnp) {</span>
<a href="#l1.38"></a><span id="l1.38">     throw new Error(&quot;Cannot load required RNP library&quot;);</span>
<a href="#l1.39"></a><span id="l1.39">   }</span>
<a href="#l1.40"></a><span id="l1.40"> }</span>
<a href="#l1.41"></a><span id="l1.41"> </span>
<a href="#l1.42"></a><span id="l1.42"> var RNPLibLoader = {</span>
<a href="#l1.43"></a><span id="l1.43">   init() {</span>
<a href="#l1.44"></a><span id="l1.44">     loadExternalRNPLib();</span>
<a href="#l1.45"></a><span id="l1.45">     if (librnp) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

