<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 3031:db4d4379d404affd69b9a917f8524eaa90f1a53e</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ db4d4379d404affd69b9a917f8524eaa90f1a53e" />
<meta property="og:url" content="/comm-central/rev/db4d4379d404affd69b9a917f8524eaa90f1a53e" />
<meta property="og:description" content="Bug 495519 - &quot;Allow extensions to add custom search terms&quot; [r=Neil,sr=bienvenu,a=KaiRo and dmose for late-l10n checkin]" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / db4d4379d404affd69b9a917f8524eaa90f1a53e 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/db4d4379d404affd69b9a917f8524eaa90f1a53e">shortlog</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/db4d4379d404affd69b9a917f8524eaa90f1a53e">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e">files</a> |
changeset |
<a href="/comm-central/raw-rev/db4d4379d404affd69b9a917f8524eaa90f1a53e">raw</a>  | <a href="/comm-central/archive/db4d4379d404affd69b9a917f8524eaa90f1a53e.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=495519">Bug 495519</a> - &quot;Allow extensions to add custom search terms&quot; [r=Neil,sr=bienvenu,a=KaiRo and dmose for late-l10n checkin]
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#101;&#110;&#116;&#32;&#74;&#97;&#109;&#101;&#115;&#32;&#60;&#107;&#101;&#110;&#116;&#64;&#99;&#97;&#115;&#112;&#105;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 07 Jul 2009 20:14:40 +0100</td></tr>

<tr>
 <td>changeset 3031</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/db4d4379d404affd69b9a917f8524eaa90f1a53e">db4d4379d404affd69b9a917f8524eaa90f1a53e</a></td>
</tr>



<tr>
<td>parent 3030</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/10d929a67931480eb3bb59a054a58e158f2cbce0">10d929a67931480eb3bb59a054a58e158f2cbce0</a>
</td>
</tr>

<tr>
<td>child 3032</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/87bea4747dbf7d85eb3df72ed0c10198960d888a">87bea4747dbf7d85eb3df72ed0c10198960d888a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=db4d4379d404affd69b9a917f8524eaa90f1a53e">2465</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 07 Jul 2009 19:15:33 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@db4d4379d404 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=db4d4379d404affd69b9a917f8524eaa90f1a53e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=db4d4379d404affd69b9a917f8524eaa90f1a53e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=db4d4379d404affd69b9a917f8524eaa90f1a53e&newProject=comm-central&newRevision=db4d4379d404affd69b9a917f8524eaa90f1a53e&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=db4d4379d404affd69b9a917f8524eaa90f1a53e&newProject=comm-central&newRevision=db4d4379d404affd69b9a917f8524eaa90f1a53e&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=db4d4379d404affd69b9a917f8524eaa90f1a53e&newProject=comm-central&newRevision=db4d4379d404affd69b9a917f8524eaa90f1a53e&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a>, <a href="/comm-central/log?rev=reviewer%28KaiRo%29&revcount=50">KaiRo</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=495519">495519</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=495519">Bug 495519</a> - &quot;Allow extensions to add custom search terms&quot; [r=Neil,sr=bienvenu,a=KaiRo and dmose for late-l10n checkin]</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/base/content/mailWidgets.xml">mail/base/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/base/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/base/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/base/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/base/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/base/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/filter.properties">mail/locales/en-US/chrome/messenger/filter.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/filter.properties">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/filter.properties">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/filter.properties">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/filter.properties">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/filter.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-attributes.properties">mail/locales/en-US/chrome/messenger/search-attributes.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-attributes.properties">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-attributes.properties">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-attributes.properties">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-attributes.properties">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-attributes.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-operators.properties">mail/locales/en-US/chrome/messenger/search-operators.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-operators.properties">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-operators.properties">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-operators.properties">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-operators.properties">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/locales/en-US/chrome/messenger/search-operators.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/filterDialog.css">mail/themes/gnomestripe/mail/filterDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/filterDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/filterDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/filterDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/filterDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/filterDialog.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/searchDialog.css">mail/themes/gnomestripe/mail/searchDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/searchDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/searchDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/searchDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/searchDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/gnomestripe/mail/searchDialog.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/filterDialog.css">mail/themes/pinstripe/mail/filterDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/filterDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/filterDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/filterDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/filterDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/filterDialog.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/searchDialog.css">mail/themes/pinstripe/mail/searchDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/searchDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/searchDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/searchDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/searchDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/pinstripe/mail/searchDialog.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/filterDialog.css">mail/themes/qute/mail/filterDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/filterDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/filterDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/filterDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/filterDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/filterDialog.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/searchDialog.css">mail/themes/qute/mail/searchDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/searchDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/searchDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/searchDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/searchDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mail/themes/qute/mail/searchDialog.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/Makefile.in">mailnews/base/search/public/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/Makefile.in">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/Makefile.in">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/Makefile.in">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/Makefile.in">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgFilterService.idl">mailnews/base/search/public/nsIMsgFilterService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgFilterService.idl">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgFilterService.idl">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgFilterService.idl">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgFilterService.idl">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgFilterService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchCustomTerm.idl">mailnews/base/search/public/nsIMsgSearchCustomTerm.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchCustomTerm.idl">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchCustomTerm.idl">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchCustomTerm.idl">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchCustomTerm.idl">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchCustomTerm.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchSession.idl">mailnews/base/search/public/nsIMsgSearchSession.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchSession.idl">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchSession.idl">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchSession.idl">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchSession.idl">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchSession.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchTerm.idl">mailnews/base/search/public/nsIMsgSearchTerm.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchTerm.idl">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchTerm.idl">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchTerm.idl">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchTerm.idl">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsIMsgSearchTerm.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchCore.idl">mailnews/base/search/public/nsMsgSearchCore.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchCore.idl">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchCore.idl">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchCore.idl">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchCore.idl">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchCore.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchTerm.h">mailnews/base/search/public/nsMsgSearchTerm.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchTerm.h">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchTerm.h">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchTerm.h">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchTerm.h">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/public/nsMsgSearchTerm.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/FilterEditor.js">mailnews/base/search/resources/content/FilterEditor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/FilterEditor.js">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/FilterEditor.js">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/FilterEditor.js">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/FilterEditor.js">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/FilterEditor.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/searchTermOverlay.js">mailnews/base/search/resources/content/searchTermOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/searchTermOverlay.js">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/searchTermOverlay.js">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/searchTermOverlay.js">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/searchTermOverlay.js">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/resources/content/searchTermOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.cpp">mailnews/base/search/src/nsMsgFilterService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.cpp">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.cpp">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.cpp">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.cpp">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.h">mailnews/base/search/src/nsMsgFilterService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.h">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.h">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.h">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.h">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgFilterService.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgLocalSearch.cpp">mailnews/base/search/src/nsMsgLocalSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgLocalSearch.cpp">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgLocalSearch.cpp">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgLocalSearch.cpp">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgLocalSearch.cpp">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgLocalSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchSession.cpp">mailnews/base/search/src/nsMsgSearchSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchSession.cpp">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchSession.cpp">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchSession.cpp">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchSession.cpp">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/src/searchSpec.js">mailnews/base/src/searchSpec.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/src/searchSpec.js">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/src/searchSpec.js">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/src/searchSpec.js">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/src/searchSpec.js">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/src/searchSpec.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/test/unit/test_searchCustomTerm.js">mailnews/base/test/unit/test_searchCustomTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/test/unit/test_searchCustomTerm.js">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/test/unit/test_searchCustomTerm.js">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/test/unit/test_searchCustomTerm.js">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/test/unit/test_searchCustomTerm.js">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/base/test/unit/test_searchCustomTerm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/test/resources/searchTestUtils.js">mailnews/test/resources/searchTestUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/test/resources/searchTestUtils.js">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/test/resources/searchTestUtils.js">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/test/resources/searchTestUtils.js">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/test/resources/searchTestUtils.js">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/mailnews/test/resources/searchTestUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/filter.properties">suite/locales/en-US/chrome/mailnews/filter.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/filter.properties">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/filter.properties">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/filter.properties">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/filter.properties">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/filter.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-attributes.properties">suite/locales/en-US/chrome/mailnews/search-attributes.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-attributes.properties">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-attributes.properties">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-attributes.properties">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-attributes.properties">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-attributes.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-operators.properties">suite/locales/en-US/chrome/mailnews/search-operators.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-operators.properties">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-operators.properties">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-operators.properties">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-operators.properties">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/locales/en-US/chrome/mailnews/search-operators.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/commandglue.js">suite/mailnews/commandglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/commandglue.js">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/commandglue.js">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/commandglue.js">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/commandglue.js">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/commandglue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/mailWidgets.xml">suite/mailnews/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/mailnews/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/filterDialog.css">suite/themes/classic/messenger/filterDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/filterDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/filterDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/filterDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/filterDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/filterDialog.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/searchDialog.css">suite/themes/classic/messenger/searchDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/searchDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/searchDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/searchDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/searchDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/classic/messenger/searchDialog.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/filterDialog.css">suite/themes/modern/messenger/filterDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/filterDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/filterDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/filterDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/filterDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/filterDialog.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/searchDialog.css">suite/themes/modern/messenger/searchDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/searchDialog.css">file</a> |
<a href="/comm-central/annotate/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/searchDialog.css">annotate</a> |
<a href="/comm-central/diff/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/searchDialog.css">diff</a> |
<a href="/comm-central/comparison/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/searchDialog.css">comparison</a> |
<a href="/comm-central/log/db4d4379d404affd69b9a917f8524eaa90f1a53e/suite/themes/modern/messenger/searchDialog.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -746,21 +746,26 @@</span>
<a href="#l1.4"></a><span id="l1.4">     &lt;content&gt;</span>
<a href="#l1.5"></a><span id="l1.5">       &lt;xul:menulist class=&quot;search-menulist&quot; xbl:inherits=&quot;flex,disabled&quot; oncommand=&quot;this.parentNode.onSelect(event)&quot;&gt;</span>
<a href="#l1.6"></a><span id="l1.6">         &lt;xul:menupopup class=&quot;search-menulist-popup&quot;/&gt;</span>
<a href="#l1.7"></a><span id="l1.7">       &lt;/xul:menulist&gt;</span>
<a href="#l1.8"></a><span id="l1.8">     &lt;/content&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">     &lt;implementation&gt;</span>
<a href="#l1.11"></a><span id="l1.11">       &lt;field name=&quot;internalScope&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+      &lt;field name=&quot;internalValue&quot;&gt;-1&lt;/field&gt;</span>
<a href="#l1.13"></a><span id="l1.13">       &lt;field readonly=&quot;true&quot; name=&quot;validityManager&quot;&gt;</span>
<a href="#l1.14"></a><span id="l1.14">         &lt;![CDATA[</span>
<a href="#l1.15"></a><span id="l1.15">            Components.classes['@mozilla.org/mail/search/validityManager;1'].getService(Components.interfaces.nsIMsgSearchValidityManager);</span>
<a href="#l1.16"></a><span id="l1.16">         ]]&gt;</span>
<a href="#l1.17"></a><span id="l1.17">       &lt;/field&gt;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+      &lt;field name=&quot;filterService&quot;&gt;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+        Components.classes[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+                  .getService(Components.interfaces.nsIMsgFilterService)</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l1.22"></a><span id="l1.22">       &lt;property name=&quot;searchScope&quot; onget=&quot;return this.internalScope;&quot;&gt;</span>
<a href="#l1.23"></a><span id="l1.23">         &lt;!-- scope ID - retrieve the table --&gt;</span>
<a href="#l1.24"></a><span id="l1.24">         &lt;setter&gt;</span>
<a href="#l1.25"></a><span id="l1.25">           &lt;![CDATA[</span>
<a href="#l1.26"></a><span id="l1.26">             // if scope isn't changing this is a noop</span>
<a href="#l1.27"></a><span id="l1.27">             if (this.internalScope == val) return val;</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29">             this.internalScope = val;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineat">@@ -810,24 +815,24 @@</span>
<a href="#l1.31"></a><span id="l1.31">               var optarget = document.getElementById(optargetIds[i]);</span>
<a href="#l1.32"></a><span id="l1.32">               if (optarget) optargets[j++] = optarget;</span>
<a href="#l1.33"></a><span id="l1.33">             }</span>
<a href="#l1.34"></a><span id="l1.34">             return optargets;</span>
<a href="#l1.35"></a><span id="l1.35">           ]]&gt;</span>
<a href="#l1.36"></a><span id="l1.36">         &lt;/getter&gt;</span>
<a href="#l1.37"></a><span id="l1.37">       &lt;/property&gt;</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-      &lt;!-- value forwards to the internal menulist's &quot;value&quot; attribute --&gt;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-      &lt;property name=&quot;value&quot; onget=&quot;return document.getAnonymousNodes(this)[0].selectedItem.getAttribute('value');&quot;&gt;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+      &lt;property name=&quot;value&quot; onget=&quot;return this.internalValue;&quot;&gt;</span>
<a href="#l1.42"></a><span id="l1.42">         &lt;setter&gt;</span>
<a href="#l1.43"></a><span id="l1.43">           &lt;![CDATA[</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+            if (this.internalValue == val)</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+              return;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+            this.internalValue = val;</span>
<a href="#l1.47"></a><span id="l1.47">             var menulist = document.getAnonymousNodes(this)[0];</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-            var dataItems = menulist.getElementsByAttribute(&quot;value&quot;, val);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-            if (dataItems.item(0))</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-                menulist.selectedItem = dataItems[0];</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+            menulist.selectedItem = this.validMenuitem;</span>
<a href="#l1.52"></a><span id="l1.52"> </span>
<a href="#l1.53"></a><span id="l1.53">             // now notify targets of new parent's value</span>
<a href="#l1.54"></a><span id="l1.54">             var targets = this.targets;</span>
<a href="#l1.55"></a><span id="l1.55">             if (targets) {</span>
<a href="#l1.56"></a><span id="l1.56">               for (var i=0; i &lt; targets.length; i++) {</span>
<a href="#l1.57"></a><span id="l1.57">                 targets[i].parentValue = val;</span>
<a href="#l1.58"></a><span id="l1.58">               }</span>
<a href="#l1.59"></a><span id="l1.59">             }</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineat">@@ -842,16 +847,43 @@</span>
<a href="#l1.61"></a><span id="l1.61"> </span>
<a href="#l1.62"></a><span id="l1.62">             return val;</span>
<a href="#l1.63"></a><span id="l1.63">           ]]&gt;</span>
<a href="#l1.64"></a><span id="l1.64">         &lt;/setter&gt;</span>
<a href="#l1.65"></a><span id="l1.65">       &lt;/property&gt;</span>
<a href="#l1.66"></a><span id="l1.66">       &lt;!-- label forwards to the internal menulist's &quot;label&quot; attribute --&gt;</span>
<a href="#l1.67"></a><span id="l1.67">       &lt;property name=&quot;label&quot; onget=&quot;return document.getAnonymousNodes(this)[0].selectedItem.getAttribute('label');&quot;&gt;</span>
<a href="#l1.68"></a><span id="l1.68">       &lt;/property&gt;</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+      &lt;property name=&quot;validMenuitem&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+      &lt;!-- Prepare menulist selection, adding a missing hidden menuitem if needed, and </span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+        updating the disabled state of the menulist label. --&gt;</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+            if (this.value == -1) // -1 means not initialized</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+              return null;</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+            let menulist = document.getAnonymousNodes(this)[0];</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+            let isCustom = isNaN(this.value);</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+            let typedValue = isCustom ? this.value : parseInt(this.value);</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+            // custom attribute to style the unavailable menulist item</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+            menulist.setAttribute(&quot;unavailable&quot;,</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+              (this.valueIds.indexOf(typedValue) &lt; 0) ? &quot;true&quot; : null);</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+            // add a hidden menulist item if value is missing</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+            let menuitem = menulist.getElementsByAttribute(&quot;value&quot;, this.value).item(0);</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+            if (!menuitem)</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+            { // need to add a hidden menuitem</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+              menuitem = menulist.appendItem(this.valueLabel, this.value);</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+              menuitem.hidden = true;</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+            }</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+            return menuitem;</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+          ]]&gt;</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l1.96"></a><span id="l1.96">       &lt;method name=&quot;refreshList&quot;&gt;</span>
<a href="#l1.97"></a><span id="l1.97">         &lt;parameter name=&quot;dontRestore&quot;/&gt; &lt;!-- should we not restore old selection? --&gt;</span>
<a href="#l1.98"></a><span id="l1.98">         &lt;body&gt;</span>
<a href="#l1.99"></a><span id="l1.99">           &lt;![CDATA[</span>
<a href="#l1.100"></a><span id="l1.100">             var menuItemIds = this.valueIds;</span>
<a href="#l1.101"></a><span id="l1.101">             var menuItemStrings = this.valueStrings;</span>
<a href="#l1.102"></a><span id="l1.102"> </span>
<a href="#l1.103"></a><span id="l1.103">             var menulist = document.getAnonymousNodes(this)[0];</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineat">@@ -888,27 +920,33 @@</span>
<a href="#l1.105"></a><span id="l1.105">             {</span>
<a href="#l1.106"></a><span id="l1.106">               var separator = document.createElement(&quot;menuseparator&quot;);</span>
<a href="#l1.107"></a><span id="l1.107">               popup.appendChild(separator);</span>
<a href="#l1.108"></a><span id="l1.108">               menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l1.109"></a><span id="l1.109">               menuitem.setAttribute(&quot;label&quot;, menuItemStrings[customizePos]);</span>
<a href="#l1.110"></a><span id="l1.110">               menuitem.setAttribute(&quot;value&quot;, menuItemIds[customizePos]);</span>
<a href="#l1.111"></a><span id="l1.111">               popup.appendChild(menuitem);</span>
<a href="#l1.112"></a><span id="l1.112">             }</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineminus">-            // now restore the selection</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineminus">-            menulist.selectedItem = newSelection;</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineminus">-</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+            //</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+            // If we are either uninitialized, or if we are called because</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+            // of a change in our parent, update the value to the</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+            // default stored in newSelection.</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+            //</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+            if ((this.value == -1 || dontRestore) &amp;&amp; newSelection)</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+              this.value = newSelection.value;</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+            menulist.selectedItem = this.validMenuitem;</span>
<a href="#l1.124"></a><span id="l1.124">           ]]&gt;</span>
<a href="#l1.125"></a><span id="l1.125">         &lt;/body&gt;</span>
<a href="#l1.126"></a><span id="l1.126">       &lt;/method&gt;</span>
<a href="#l1.127"></a><span id="l1.127">       &lt;method name=&quot;onSelect&quot;&gt;</span>
<a href="#l1.128"></a><span id="l1.128">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l1.129"></a><span id="l1.129">         &lt;body&gt;</span>
<a href="#l1.130"></a><span id="l1.130">           &lt;![CDATA[</span>
<a href="#l1.131"></a><span id="l1.131">             var menulist = document.getAnonymousNodes(this)[0];</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineplus">+            this.value = menulist.value;</span>
<a href="#l1.133"></a><span id="l1.133">             // notify targets</span>
<a href="#l1.134"></a><span id="l1.134">             var targets = this.targets;</span>
<a href="#l1.135"></a><span id="l1.135">             if (targets) {</span>
<a href="#l1.136"></a><span id="l1.136">               for (var i=0; i &lt; targets.length; i++) {</span>
<a href="#l1.137"></a><span id="l1.137">                 targets[i].parentValue = menulist.value;</span>
<a href="#l1.138"></a><span id="l1.138">               }</span>
<a href="#l1.139"></a><span id="l1.139">             }</span>
<a href="#l1.140"></a><span id="l1.140"> </span>
<a href="#l1.141"></a><span id="l1.141" class="difflineat">@@ -930,21 +968,61 @@</span>
<a href="#l1.142"></a><span id="l1.142">     &lt;implementation&gt;</span>
<a href="#l1.143"></a><span id="l1.143">       &lt;field name=&quot;stringBundle&quot;&gt;</span>
<a href="#l1.144"></a><span id="l1.144">         &lt;![CDATA[</span>
<a href="#l1.145"></a><span id="l1.145">           Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l1.146"></a><span id="l1.146">                     .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l1.147"></a><span id="l1.147">                     .createBundle(&quot;chrome://messenger/locale/search-attributes.properties&quot;)</span>
<a href="#l1.148"></a><span id="l1.148">         ]]&gt;</span>
<a href="#l1.149"></a><span id="l1.149">       &lt;/field&gt;</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineplus">+      &lt;property name=&quot;valueLabel&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineplus">+            if (isNaN(this.value)) // is this a custom term?</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+            {</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineplus">+              let customTerm = this.filterService.getCustomTerm(this.value);</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+              if (customTerm)</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+                return customTerm.name;</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+              else</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+              {</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineplus">+                let consoleService = Components.classes[&quot;@mozilla.org/consoleservice;1&quot;]</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineplus">+                    .getService(Components.interfaces.nsIConsoleService);</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineplus">+                let scriptError = Components.classes[&quot;@mozilla.org/scripterror;1&quot;]</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineplus">+                    .createInstance(Components.interfaces.nsIScriptError);</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineplus">+                scriptError.init(&quot;Missing custom search term &quot; + this.value,</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineplus">+                    null, null, 0, 0,</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineplus">+                    Components.interfaces.nsIScriptError.errorFlag,</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineplus">+                    &quot;component javascript&quot;);</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineplus">+                consoleService.logMessage(scriptError);</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineplus">+                return this.stringBundle.GetStringFromName(&quot;MissingCustomTerm&quot;);</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineplus">+              }</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineplus">+            }</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+            return this.stringBundle.GetStringFromName(</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineplus">+              this.validityManager.getAttributeProperty(parseInt(this.value)));</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineplus">+          ]]&gt;</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l1.176"></a><span id="l1.176" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l1.177"></a><span id="l1.177">       &lt;property name=&quot;valueIds&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l1.178"></a><span id="l1.178">         &lt;getter&gt;</span>
<a href="#l1.179"></a><span id="l1.179">           &lt;![CDATA[</span>
<a href="#l1.180"></a><span id="l1.180">             var length = new Object;</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineminus">-            return this.validityTable.getAvailableAttributes(length);</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+            let result = this.validityTable.getAvailableAttributes(length);</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+            // add any available custom search terms</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+            let customEnum = this.filterService.getCustomTerms();</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+            while (customEnum &amp;&amp; customEnum.hasMoreElements())</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+            {</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+              let customTerm =</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+                 customEnum.getNext()</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineplus">+                           .QueryInterface(Components.interfaces.nsIMsgSearchCustomTerm);</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+              // for custom terms, the array element is a string with the custom id</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+              // instead of the integer attribute</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineplus">+              if (customTerm.getAvailable(this.scope, null))</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineplus">+                result.push(customTerm.id);</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineplus">+            }</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineplus">+            return result;</span>
<a href="#l1.196"></a><span id="l1.196">           ]]&gt;</span>
<a href="#l1.197"></a><span id="l1.197">         &lt;/getter&gt;</span>
<a href="#l1.198"></a><span id="l1.198">       &lt;/property&gt;</span>
<a href="#l1.199"></a><span id="l1.199">       &lt;property name=&quot;valueStrings&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l1.200"></a><span id="l1.200">         &lt;getter&gt;</span>
<a href="#l1.201"></a><span id="l1.201">           &lt;![CDATA[</span>
<a href="#l1.202"></a><span id="l1.202">             let strings = new Array;</span>
<a href="#l1.203"></a><span id="l1.203">             let ids = this.valueIds;</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineat">@@ -959,17 +1037,25 @@</span>
<a href="#l1.205"></a><span id="l1.205">             }</span>
<a href="#l1.206"></a><span id="l1.206">             catch(ex)</span>
<a href="#l1.207"></a><span id="l1.207">             {</span>
<a href="#l1.208"></a><span id="l1.208">             }</span>
<a href="#l1.209"></a><span id="l1.209"> </span>
<a href="#l1.210"></a><span id="l1.210">             let j = 0;</span>
<a href="#l1.211"></a><span id="l1.211">             for (let i = 0; i &lt; ids.length; i++)</span>
<a href="#l1.212"></a><span id="l1.212">             {</span>
<a href="#l1.213"></a><span id="l1.213" class="difflineminus">-              if(ids[i] &gt; Components.interfaces.nsMsgSearchAttrib.OtherHeader &amp;&amp; hdrsArray)</span>
<a href="#l1.214"></a><span id="l1.214" class="difflineplus">+              if (isNaN(ids[i])) // Is this a custom search term?</span>
<a href="#l1.215"></a><span id="l1.215" class="difflineplus">+              {</span>
<a href="#l1.216"></a><span id="l1.216" class="difflineplus">+                let customTerm = this.filterService.getCustomTerm(ids[i]);</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineplus">+                if (customTerm)</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineplus">+                  strings[i] = customTerm.name;</span>
<a href="#l1.219"></a><span id="l1.219" class="difflineplus">+                else</span>
<a href="#l1.220"></a><span id="l1.220" class="difflineplus">+                  strings[i] = &quot;&quot;;</span>
<a href="#l1.221"></a><span id="l1.221" class="difflineplus">+              }</span>
<a href="#l1.222"></a><span id="l1.222" class="difflineplus">+              else if(ids[i] &gt; Components.interfaces.nsMsgSearchAttrib.OtherHeader &amp;&amp; hdrsArray)</span>
<a href="#l1.223"></a><span id="l1.223">                 strings[i] = hdrsArray[j++];</span>
<a href="#l1.224"></a><span id="l1.224">               else</span>
<a href="#l1.225"></a><span id="l1.225">                 strings[i] = this.stringBundle.GetStringFromName(</span>
<a href="#l1.226"></a><span id="l1.226">                                this.validityManager.getAttributeProperty(ids[i]));</span>
<a href="#l1.227"></a><span id="l1.227">             }</span>
<a href="#l1.228"></a><span id="l1.228">             return strings;</span>
<a href="#l1.229"></a><span id="l1.229">           ]]&gt;</span>
<a href="#l1.230"></a><span id="l1.230">         &lt;/getter&gt;</span>
<a href="#l1.231"></a><span id="l1.231" class="difflineat">@@ -989,20 +1075,35 @@</span>
<a href="#l1.232"></a><span id="l1.232">       &lt;field name=&quot;searchAttribute&quot;&gt;Components.interfaces.nsMsgSearchAttrib.Default&lt;/field&gt;</span>
<a href="#l1.233"></a><span id="l1.233">       &lt;field name=&quot;stringBundle&quot;&gt;</span>
<a href="#l1.234"></a><span id="l1.234">         &lt;![CDATA[</span>
<a href="#l1.235"></a><span id="l1.235">           Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l1.236"></a><span id="l1.236">                     .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l1.237"></a><span id="l1.237">                     .createBundle(&quot;chrome://messenger/locale/search-operators.properties&quot;)</span>
<a href="#l1.238"></a><span id="l1.238">         ]]&gt;</span>
<a href="#l1.239"></a><span id="l1.239">       &lt;/field&gt;</span>
<a href="#l1.240"></a><span id="l1.240" class="difflineplus">+      &lt;property name=&quot;valueLabel&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l1.241"></a><span id="l1.241" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l1.242"></a><span id="l1.242" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l1.243"></a><span id="l1.243" class="difflineplus">+            return this.stringBundle.GetStringFromName(this.value);</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineplus">+          ]]&gt;</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l1.247"></a><span id="l1.247">       &lt;property name=&quot;valueIds&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l1.248"></a><span id="l1.248">         &lt;getter&gt;</span>
<a href="#l1.249"></a><span id="l1.249">           &lt;![CDATA[</span>
<a href="#l1.250"></a><span id="l1.250">             var length = new Object;</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineplus">+            let isCustom = isNaN(this.searchAttribute);</span>
<a href="#l1.252"></a><span id="l1.252" class="difflineplus">+            if (isCustom)</span>
<a href="#l1.253"></a><span id="l1.253" class="difflineplus">+            {</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineplus">+              let customTerm = this.filterService.getCustomTerm(this.searchAttribute);</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineplus">+              if (customTerm)</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineplus">+                return customTerm.getAvailableOperators(this.scope, length);</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineplus">+              return [Components.interfaces.nsMsgSearchOp.Contains];</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineplus">+            }</span>
<a href="#l1.259"></a><span id="l1.259">             return this.validityTable.getAvailableOperators(this.searchAttribute,length);</span>
<a href="#l1.260"></a><span id="l1.260">           ]]&gt;</span>
<a href="#l1.261"></a><span id="l1.261">         &lt;/getter&gt;</span>
<a href="#l1.262"></a><span id="l1.262">       &lt;/property&gt;</span>
<a href="#l1.263"></a><span id="l1.263">       &lt;property name=&quot;valueStrings&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l1.264"></a><span id="l1.264">         &lt;getter&gt;</span>
<a href="#l1.265"></a><span id="l1.265">           &lt;![CDATA[</span>
<a href="#l1.266"></a><span id="l1.266">             let strings = new Array;</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineat">@@ -1103,22 +1204,26 @@</span>
<a href="#l1.268"></a><span id="l1.268">           &lt;xul:menuitem value=&quot;filter&quot; stringTag=&quot;junkScoreOriginFilter&quot;</span>
<a href="#l1.269"></a><span id="l1.269">                         class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.270"></a><span id="l1.270">           &lt;xul:menuitem value=&quot;whitelist&quot; stringTag=&quot;junkScoreOriginWhitelist&quot;</span>
<a href="#l1.271"></a><span id="l1.271">                         class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.272"></a><span id="l1.272">           &lt;xul:menuitem value=&quot;imapflag&quot; stringTag=&quot;junkScoreOriginImapFlag&quot;</span>
<a href="#l1.273"></a><span id="l1.273">                         class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.274"></a><span id="l1.274">         &lt;/xul:menupopup&gt;</span>
<a href="#l1.275"></a><span id="l1.275">       &lt;/xul:menulist&gt;</span>
<a href="#l1.276"></a><span id="l1.276" class="difflineplus">+      &lt;xul:hbox flex=&quot;1&quot; class=&quot;search-value-custom&quot; xbl:inherits=&quot;disabled&quot;/&gt;</span>
<a href="#l1.277"></a><span id="l1.277">     &lt;/content&gt;</span>
<a href="#l1.278"></a><span id="l1.278">     &lt;implementation&gt;</span>
<a href="#l1.279"></a><span id="l1.279">       &lt;field name=&quot;internalOperator&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.280"></a><span id="l1.280">       &lt;field name=&quot;internalAttribute&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.281"></a><span id="l1.281">       &lt;field name=&quot;internalValue&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.282"></a><span id="l1.282" class="difflineminus">-</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineplus">+      &lt;field name=&quot;filterService&quot;&gt;</span>
<a href="#l1.284"></a><span id="l1.284" class="difflineplus">+        Components.classes[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l1.285"></a><span id="l1.285" class="difflineplus">+                  .getService(Components.interfaces.nsIMsgFilterService);</span>
<a href="#l1.286"></a><span id="l1.286" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l1.287"></a><span id="l1.287">       &lt;property name=&quot;opParentValue&quot; onget=&quot;return this.internalOperator;&quot;&gt;</span>
<a href="#l1.288"></a><span id="l1.288">         &lt;setter&gt;</span>
<a href="#l1.289"></a><span id="l1.289">           &lt;![CDATA[</span>
<a href="#l1.290"></a><span id="l1.290">             // noop if we're not changing it</span>
<a href="#l1.291"></a><span id="l1.291">             if (this.internalOperator == val) return val;</span>
<a href="#l1.292"></a><span id="l1.292"> </span>
<a href="#l1.293"></a><span id="l1.293">             // Keywords has the null field IsEmpty</span>
<a href="#l1.294"></a><span id="l1.294">             if (this.searchAttribute == Components.interfaces.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l1.295"></a><span id="l1.295" class="difflineat">@@ -1183,17 +1288,27 @@</span>
<a href="#l1.296"></a><span id="l1.296">             if (this.internalAttribute == val) return val;</span>
<a href="#l1.297"></a><span id="l1.297">             this.internalAttribute = val;</span>
<a href="#l1.298"></a><span id="l1.298"> </span>
<a href="#l1.299"></a><span id="l1.299">             // if the searchAttribute changing, null out the internalOperator</span>
<a href="#l1.300"></a><span id="l1.300">             this.internalOperator = null;</span>
<a href="#l1.301"></a><span id="l1.301"> </span>
<a href="#l1.302"></a><span id="l1.302">             // we inherit from a deck, so just use it's index attribute</span>
<a href="#l1.303"></a><span id="l1.303">             // to hide/show widgets</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineminus">-            if (val == Components.interfaces.nsMsgSearchAttrib.Priority)</span>
<a href="#l1.305"></a><span id="l1.305" class="difflineplus">+            if (isNaN(val)) // Is this a custom attribute?</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineplus">+            {</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineplus">+              this.setAttribute(&quot;selectedIndex&quot;, &quot;9&quot;);</span>
<a href="#l1.308"></a><span id="l1.308" class="difflineplus">+              let customHbox = document.getAnonymousNodes(this)[9];</span>
<a href="#l1.309"></a><span id="l1.309" class="difflineplus">+              if (this.internalValue)</span>
<a href="#l1.310"></a><span id="l1.310" class="difflineplus">+                customHbox.setAttribute(&quot;value&quot;, this.internalValue.str);</span>
<a href="#l1.311"></a><span id="l1.311" class="difflineplus">+              // the searchAttribute attribute is intended as a selector in</span>
<a href="#l1.312"></a><span id="l1.312" class="difflineplus">+              // CSS for custom search terms to bind a custom value</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineplus">+              customHbox.setAttribute(&quot;searchAttribute&quot;, val);</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineplus">+            }</span>
<a href="#l1.315"></a><span id="l1.315" class="difflineplus">+            else if (val == Components.interfaces.nsMsgSearchAttrib.Priority)</span>
<a href="#l1.316"></a><span id="l1.316">               this.setAttribute(&quot;selectedIndex&quot;, &quot;1&quot;);</span>
<a href="#l1.317"></a><span id="l1.317">             else if (val == Components.interfaces.nsMsgSearchAttrib.MsgStatus)</span>
<a href="#l1.318"></a><span id="l1.318">               this.setAttribute(&quot;selectedIndex&quot;, &quot;2&quot;);</span>
<a href="#l1.319"></a><span id="l1.319">             else if (val == Components.interfaces.nsMsgSearchAttrib.Date)</span>
<a href="#l1.320"></a><span id="l1.320">               this.setAttribute(&quot;selectedIndex&quot;, &quot;3&quot;);</span>
<a href="#l1.321"></a><span id="l1.321">             else if (val == Components.interfaces.nsMsgSearchAttrib.Sender) {</span>
<a href="#l1.322"></a><span id="l1.322">               // since the internalOperator is null</span>
<a href="#l1.323"></a><span id="l1.323">               // this is the same as the initial state</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineat">@@ -1221,20 +1336,26 @@</span>
<a href="#l1.325"></a><span id="l1.325">           ]]&gt;</span>
<a href="#l1.326"></a><span id="l1.326">         &lt;/setter&gt;</span>
<a href="#l1.327"></a><span id="l1.327">       &lt;/property&gt;</span>
<a href="#l1.328"></a><span id="l1.328">       &lt;property name=&quot;value&quot; onget=&quot;return this.internalValue;&quot;&gt;</span>
<a href="#l1.329"></a><span id="l1.329">         &lt;setter&gt;</span>
<a href="#l1.330"></a><span id="l1.330">           &lt;![CDATA[</span>
<a href="#l1.331"></a><span id="l1.331">           // val is a nsIMsgSearchValue object</span>
<a href="#l1.332"></a><span id="l1.332">           this.internalValue = val;</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineminus">-          var attrib = val.attrib;</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineplus">+          var attrib = this.internalAttribute;</span>
<a href="#l1.335"></a><span id="l1.335">           var nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l1.336"></a><span id="l1.336">           var children = document.getAnonymousNodes(this);</span>
<a href="#l1.337"></a><span id="l1.337">           this.searchAttribute = attrib;</span>
<a href="#l1.338"></a><span id="l1.338" class="difflineplus">+          if (isNaN(attrib)) // a custom term</span>
<a href="#l1.339"></a><span id="l1.339" class="difflineplus">+          {</span>
<a href="#l1.340"></a><span id="l1.340" class="difflineplus">+            let customHbox = document.getAnonymousNodes(this)[9];</span>
<a href="#l1.341"></a><span id="l1.341" class="difflineplus">+            customHbox.setAttribute(&quot;value&quot;, val.str);</span>
<a href="#l1.342"></a><span id="l1.342" class="difflineplus">+            return val;</span>
<a href="#l1.343"></a><span id="l1.343" class="difflineplus">+          }</span>
<a href="#l1.344"></a><span id="l1.344">           if (attrib == nsMsgSearchAttrib.Priority) {</span>
<a href="#l1.345"></a><span id="l1.345">             var matchingPriority =</span>
<a href="#l1.346"></a><span id="l1.346">               children[1].getElementsByAttribute(&quot;value&quot;, val.priority);</span>
<a href="#l1.347"></a><span id="l1.347">             if (matchingPriority.item(0))</span>
<a href="#l1.348"></a><span id="l1.348">               children[1].selectedItem = matchingPriority[0];</span>
<a href="#l1.349"></a><span id="l1.349">           }</span>
<a href="#l1.350"></a><span id="l1.350">           else if (attrib == nsMsgSearchAttrib.MsgStatus) {</span>
<a href="#l1.351"></a><span id="l1.351">             var matchingStatus =</span>
<a href="#l1.352"></a><span id="l1.352" class="difflineat">@@ -1303,17 +1424,16 @@</span>
<a href="#l1.353"></a><span id="l1.353">       &lt;method name=&quot;save&quot;&gt;</span>
<a href="#l1.354"></a><span id="l1.354">         &lt;body&gt;</span>
<a href="#l1.355"></a><span id="l1.355">           &lt;![CDATA[</span>
<a href="#l1.356"></a><span id="l1.356">             var searchValue = this.value;</span>
<a href="#l1.357"></a><span id="l1.357">             var searchAttribute = this.searchAttribute;</span>
<a href="#l1.358"></a><span id="l1.358">             var nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l1.359"></a><span id="l1.359">             var children = document.getAnonymousNodes(this);</span>
<a href="#l1.360"></a><span id="l1.360"> </span>
<a href="#l1.361"></a><span id="l1.361" class="difflineminus">-            searchValue.attrib = searchAttribute;</span>
<a href="#l1.362"></a><span id="l1.362">             if (searchAttribute == nsMsgSearchAttrib.Priority) {</span>
<a href="#l1.363"></a><span id="l1.363">                searchValue.priority = children[1].selectedItem.value;</span>
<a href="#l1.364"></a><span id="l1.364">             }</span>
<a href="#l1.365"></a><span id="l1.365">             else if (searchAttribute == nsMsgSearchAttrib.MsgStatus)</span>
<a href="#l1.366"></a><span id="l1.366">                searchValue.status = children[2].value;</span>
<a href="#l1.367"></a><span id="l1.367">             else if (searchAttribute == nsMsgSearchAttrib.AgeInDays)</span>
<a href="#l1.368"></a><span id="l1.368">                searchValue.age = children[0].value;</span>
<a href="#l1.369"></a><span id="l1.369">             else if (searchAttribute == nsMsgSearchAttrib.Date)</span>
<a href="#l1.370"></a><span id="l1.370" class="difflineat">@@ -1339,18 +1459,27 @@</span>
<a href="#l1.371"></a><span id="l1.371">             else if (searchAttribute == nsMsgSearchAttrib.JunkPercent)</span>
<a href="#l1.372"></a><span id="l1.372">                searchValue.junkPercent = children[0].value;</span>
<a href="#l1.373"></a><span id="l1.373">             else if (searchAttribute == nsMsgSearchAttrib.Size)</span>
<a href="#l1.374"></a><span id="l1.374">                searchValue.size = children[0].value;</span>
<a href="#l1.375"></a><span id="l1.375">             else if (searchAttribute == nsMsgSearchAttrib.HasAttachmentStatus)</span>
<a href="#l1.376"></a><span id="l1.376">                searchValue.status = 0x10000000;  // 0x10000000 is MSG_FLAG_ATTACHMENT;</span>
<a href="#l1.377"></a><span id="l1.377">             else if (searchAttribute == nsMsgSearchAttrib.JunkScoreOrigin)</span>
<a href="#l1.378"></a><span id="l1.378">                searchValue.str = children[8].value;</span>
<a href="#l1.379"></a><span id="l1.379" class="difflineplus">+</span>
<a href="#l1.380"></a><span id="l1.380" class="difflineplus">+            if (isNaN(searchAttribute)) //  a custom term</span>
<a href="#l1.381"></a><span id="l1.381" class="difflineplus">+            {</span>
<a href="#l1.382"></a><span id="l1.382" class="difflineplus">+              searchValue.attrib = nsMsgSearchAttrib.Custom;</span>
<a href="#l1.383"></a><span id="l1.383" class="difflineplus">+              searchValue.str = children[9].getAttribute(&quot;value&quot;);</span>
<a href="#l1.384"></a><span id="l1.384" class="difflineplus">+            }</span>
<a href="#l1.385"></a><span id="l1.385">             else</span>
<a href="#l1.386"></a><span id="l1.386" class="difflineminus">-               searchValue.str = children[0].value;</span>
<a href="#l1.387"></a><span id="l1.387" class="difflineplus">+            {</span>
<a href="#l1.388"></a><span id="l1.388" class="difflineplus">+              searchValue.attrib = searchAttribute;</span>
<a href="#l1.389"></a><span id="l1.389" class="difflineplus">+              searchValue.str = children[0].value;</span>
<a href="#l1.390"></a><span id="l1.390" class="difflineplus">+            }</span>
<a href="#l1.391"></a><span id="l1.391">           ]]&gt;</span>
<a href="#l1.392"></a><span id="l1.392">         &lt;/body&gt;</span>
<a href="#l1.393"></a><span id="l1.393">       &lt;/method&gt;</span>
<a href="#l1.394"></a><span id="l1.394">       &lt;method name=&quot;saveTo&quot;&gt;</span>
<a href="#l1.395"></a><span id="l1.395">         &lt;parameter name=&quot;searchValue&quot;/&gt;</span>
<a href="#l1.396"></a><span id="l1.396">         &lt;body&gt;</span>
<a href="#l1.397"></a><span id="l1.397">           &lt;![CDATA[</span>
<a href="#l1.398"></a><span id="l1.398">             this.internalValue = searchValue;</span>
<a href="#l1.399"></a><span id="l1.399" class="difflineat">@@ -1452,16 +1581,17 @@</span>
<a href="#l1.400"></a><span id="l1.400">         fillInTags();</span>
<a href="#l1.401"></a><span id="l1.401">       ]]&gt;</span>
<a href="#l1.402"></a><span id="l1.402">       &lt;/constructor&gt;</span>
<a href="#l1.403"></a><span id="l1.403">     &lt;/implementation&gt;</span>
<a href="#l1.404"></a><span id="l1.404">     &lt;handlers&gt;</span>
<a href="#l1.405"></a><span id="l1.405">       &lt;handler event=&quot;keypress&quot; keycode=&quot;VK_RETURN&quot; action=&quot;onEnterInSearchTerm();&quot;/&gt;</span>
<a href="#l1.406"></a><span id="l1.406">     &lt;/handlers&gt;</span>
<a href="#l1.407"></a><span id="l1.407">   &lt;/binding&gt;</span>
<a href="#l1.408"></a><span id="l1.408" class="difflineplus">+  &lt;!-- the searchterm binding is not used anymore, remove in bug 490962 --&gt;</span>
<a href="#l1.409"></a><span id="l1.409">   &lt;binding id=&quot;searchterm&quot; name=&quot;searchTerm&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l1.410"></a><span id="l1.410">     &lt;implementation&gt;</span>
<a href="#l1.411"></a><span id="l1.411">       &lt;field name=&quot;internalSearchTerm&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.412"></a><span id="l1.412">       &lt;field name=&quot;internalBooleanAnd&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.413"></a><span id="l1.413">       &lt;!-- the actual nsIMsgSearchTerm object --&gt;</span>
<a href="#l1.414"></a><span id="l1.414">       &lt;property name=&quot;searchTerm&quot; onget=&quot;return this.internalSearchTerm&quot;&gt;</span>
<a href="#l1.415"></a><span id="l1.415">         &lt;setter&gt;</span>
<a href="#l1.416"></a><span id="l1.416">           &lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/filter.properties</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/filter.properties</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -12,16 +12,18 @@ filterCustomHeaderOverflow=Your filters </span>
<a href="#l2.4"></a><span id="l2.4"> invalidCustomHeader=One of your filters uses a custom header that contains an invalid character, such as ':', a non-printable character, a non-ascii character, or an eight-bit ascii character. Please edit the msgFilterRules.dat file, which contains your filters, to remove invalid characters from your custom headers.</span>
<a href="#l2.5"></a><span id="l2.5"> continueFilterExecution=Applying filter %S failed. Would you like to continue applying filters?</span>
<a href="#l2.6"></a><span id="l2.6"> promptTitle=Running Filters</span>
<a href="#l2.7"></a><span id="l2.7"> promptMsg=You are currently in the process of filtering messages.\nWould you like to continue applying filters?</span>
<a href="#l2.8"></a><span id="l2.8"> stopButtonLabel=Stop</span>
<a href="#l2.9"></a><span id="l2.9"> continueButtonLabel=Continue</span>
<a href="#l2.10"></a><span id="l2.10"> cannotEnableFilter=This filter was probably created by future version of mozilla/netscape. You cannot enable this filter because we don't know how to apply it.</span>
<a href="#l2.11"></a><span id="l2.11"> dontWarnAboutDeleteCheckbox=Don't ask me again</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+searchTermsInvalidTitle=Search Terms Invalid</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+searchTermsInvalidMessage=This filter cannot be saved because some search terms are invalid in the current context.</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15"> # for junk mail logging / mail filter logging</span>
<a href="#l2.16"></a><span id="l2.16"> # LOCALIZATION NOTE(junkLogDetectStr)</span>
<a href="#l2.17"></a><span id="l2.17"> # %1$S=author, %2$S=subject, %3$S=date</span>
<a href="#l2.18"></a><span id="l2.18"> junkLogDetectStr=Detected junk message from %1$S - %2$S at %3$S</span>
<a href="#l2.19"></a><span id="l2.19"> # LOCALIZATION NOTE(logMoveStr)</span>
<a href="#l2.20"></a><span id="l2.20"> # %1$S=message id, %2$S=folder URI</span>
<a href="#l2.21"></a><span id="l2.21"> logMoveStr=moved message id = %1$S to %2$S</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/search-attributes.properties</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/search-attributes.properties</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -33,8 +33,9 @@ Department=Department</span>
<a href="#l3.4"></a><span id="l3.4"> # more mailnews</span>
<a href="#l3.5"></a><span id="l3.5"> FromToCcOrBcc=From, To, Cc or Bcc</span>
<a href="#l3.6"></a><span id="l3.6"> JunkScoreOrigin=Junk Score Origin</span>
<a href="#l3.7"></a><span id="l3.7"> JunkPercent=Junk Percent</span>
<a href="#l3.8"></a><span id="l3.8"> AttachmentStatus=Attachment Status</span>
<a href="#l3.9"></a><span id="l3.9"> JunkStatus=Junk Status</span>
<a href="#l3.10"></a><span id="l3.10"> Label=Label</span>
<a href="#l3.11"></a><span id="l3.11"> Customize=Customize…</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+MissingCustomTerm=Missing Custom Term</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/search-operators.properties</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/search-operators.properties</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -18,9 +18,10 @@ 12=LdapDwim</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> 13=is greater than</span>
<a href="#l4.6"></a><span id="l4.6"> 14=is less than</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> 15=NameCompletion</span>
<a href="#l4.9"></a><span id="l4.9"> 16=is in my address book</span>
<a href="#l4.10"></a><span id="l4.10"> 17=isn't in my address book</span>
<a href="#l4.11"></a><span id="l4.11"> 18=isn't empty</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+19=matches</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+20=doesn't match</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/filterDialog.css</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/filterDialog.css</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -62,16 +62,20 @@ listcell[enabled=&quot;true&quot;] {</span>
<a href="#l5.4"></a><span id="l5.4"> listbox {</span>
<a href="#l5.5"></a><span id="l5.5">   padding-top: 2px;</span>
<a href="#l5.6"></a><span id="l5.6"> }</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> .search-menulist, .search-value-menulist {</span>
<a href="#l5.9"></a><span id="l5.9">   width: 12em;</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  color: GrayText;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+}</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+</span>
<a href="#l5.16"></a><span id="l5.16"> textbox {</span>
<a href="#l5.17"></a><span id="l5.17">   margin: 1px 4px;</span>
<a href="#l5.18"></a><span id="l5.18"> }</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> #FilterEditor {</span>
<a href="#l5.21"></a><span id="l5.21">   width: 560px;</span>
<a href="#l5.22"></a><span id="l5.22">   min-height:1px;</span>
<a href="#l5.23"></a><span id="l5.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/searchDialog.css</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/searchDialog.css</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -58,16 +58,20 @@</span>
<a href="#l6.4"></a><span id="l6.4">   height: 100px;</span>
<a href="#l6.5"></a><span id="l6.5"> }</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7"> #searchResultListBox {</span>
<a href="#l6.8"></a><span id="l6.8">   margin: 5px;</span>
<a href="#l6.9"></a><span id="l6.9">   height: 100px;</span>
<a href="#l6.10"></a><span id="l6.10"> }</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  color: GrayText;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+}</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+</span>
<a href="#l6.16"></a><span id="l6.16"> menulist {</span>
<a href="#l6.17"></a><span id="l6.17">   width: 12em;</span>
<a href="#l6.18"></a><span id="l6.18"> }</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> menulist &gt; menupopup &gt; menuitem {</span>
<a href="#l6.21"></a><span id="l6.21">   -moz-padding-end: 2px;</span>
<a href="#l6.22"></a><span id="l6.22"> }</span>
<a href="#l6.23"></a><span id="l6.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/filterDialog.css</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/filterDialog.css</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -72,16 +72,20 @@ listcell[enabled=&quot;true&quot;] {</span>
<a href="#l7.4"></a><span id="l7.4"> listbox {</span>
<a href="#l7.5"></a><span id="l7.5">   padding-top: 2px;</span>
<a href="#l7.6"></a><span id="l7.6"> }</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> .search-menulist, .search-value-menulist {</span>
<a href="#l7.9"></a><span id="l7.9">   width: 12em;</span>
<a href="#l7.10"></a><span id="l7.10"> }</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  color: GrayText;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+}</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+</span>
<a href="#l7.16"></a><span id="l7.16"> textbox {</span>
<a href="#l7.17"></a><span id="l7.17">   margin: 1px 4px;</span>
<a href="#l7.18"></a><span id="l7.18"> }</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> #FilterEditor {</span>
<a href="#l7.21"></a><span id="l7.21">   width: 560px;</span>
<a href="#l7.22"></a><span id="l7.22">   min-height:1px;</span>
<a href="#l7.23"></a><span id="l7.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/searchDialog.css</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/searchDialog.css</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -73,16 +73,20 @@ window &gt; vbox &gt; vbox {</span>
<a href="#l8.4"></a><span id="l8.4">   margin: 5px;</span>
<a href="#l8.5"></a><span id="l8.5">   height: 100px;</span>
<a href="#l8.6"></a><span id="l8.6">   font: message-box;</span>
<a href="#l8.7"></a><span id="l8.7">   border-right: 1px solid #C3C3C3;</span>
<a href="#l8.8"></a><span id="l8.8">   border-bottom: 1px solid #DDDDDD;</span>
<a href="#l8.9"></a><span id="l8.9">   border-left: 1px solid #C3C3C3;</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  color: GrayText;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+}</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+</span>
<a href="#l8.16"></a><span id="l8.16"> .small-button {</span>
<a href="#l8.17"></a><span id="l8.17">   min-width: 3em;</span>
<a href="#l8.18"></a><span id="l8.18">   padding: 0px;</span>
<a href="#l8.19"></a><span id="l8.19">   margin: 0px 1px;</span>
<a href="#l8.20"></a><span id="l8.20"> }</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22"> listbox {</span>
<a href="#l8.23"></a><span id="l8.23">   padding-top: 2px;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/themes/qute/mail/filterDialog.css</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/themes/qute/mail/filterDialog.css</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -62,16 +62,20 @@ listcell[enabled=&quot;true&quot;] {</span>
<a href="#l9.4"></a><span id="l9.4"> listbox {</span>
<a href="#l9.5"></a><span id="l9.5">   padding-top: 2px;</span>
<a href="#l9.6"></a><span id="l9.6"> }</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> .search-menulist, .search-value-menulist {</span>
<a href="#l9.9"></a><span id="l9.9">   width: 12em;</span>
<a href="#l9.10"></a><span id="l9.10"> }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  color: GrayText;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+}</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+</span>
<a href="#l9.16"></a><span id="l9.16"> textbox {</span>
<a href="#l9.17"></a><span id="l9.17">   margin: 1px 4px;</span>
<a href="#l9.18"></a><span id="l9.18"> }</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> #FilterEditor {</span>
<a href="#l9.21"></a><span id="l9.21">   width: 560px;</span>
<a href="#l9.22"></a><span id="l9.22">   min-height:1px;</span>
<a href="#l9.23"></a><span id="l9.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/themes/qute/mail/searchDialog.css</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/themes/qute/mail/searchDialog.css</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -58,16 +58,20 @@</span>
<a href="#l10.4"></a><span id="l10.4">   height: 100px;</span>
<a href="#l10.5"></a><span id="l10.5"> }</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> #searchResultListBox {</span>
<a href="#l10.8"></a><span id="l10.8">   margin: 5px;</span>
<a href="#l10.9"></a><span id="l10.9">   height: 100px;</span>
<a href="#l10.10"></a><span id="l10.10"> }</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  color: GrayText;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+}</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+</span>
<a href="#l10.16"></a><span id="l10.16"> menulist {</span>
<a href="#l10.17"></a><span id="l10.17">   width: 12em;</span>
<a href="#l10.18"></a><span id="l10.18"> }</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> menulist &gt; menupopup &gt; menuitem {</span>
<a href="#l10.21"></a><span id="l10.21">   -moz-padding-end: 2px;</span>
<a href="#l10.22"></a><span id="l10.22"> }</span>
<a href="#l10.23"></a><span id="l10.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/search/public/Makefile.in</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/search/public/Makefile.in</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -68,12 +68,13 @@ XPIDLSRCS	= \</span>
<a href="#l11.4"></a><span id="l11.4"> 		nsIMsgSearchScopeTerm.idl \</span>
<a href="#l11.5"></a><span id="l11.5"> 		nsIMsgSearchNotify.idl \</span>
<a href="#l11.6"></a><span id="l11.6"> 		nsIMsgSearchValidityTable.idl \</span>
<a href="#l11.7"></a><span id="l11.7"> 		nsIMsgSearchValidityManager.idl \</span>
<a href="#l11.8"></a><span id="l11.8"> 		nsMsgFilterCore.idl \</span>
<a href="#l11.9"></a><span id="l11.9"> 		nsMsgSearchCore.idl \</span>
<a href="#l11.10"></a><span id="l11.10"> 		nsIMsgFilterCustomAction.idl \</span>
<a href="#l11.11"></a><span id="l11.11"> 		nsIMsgTraitService.idl \</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+		nsIMsgSearchCustomTerm.idl \</span>
<a href="#l11.13"></a><span id="l11.13"> 		$(NULL)</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15"> include $(topsrcdir)/config/rules.mk</span>
<a href="#l11.16"></a><span id="l11.16"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgFilterService.idl</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgFilterService.idl</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -43,18 +43,19 @@</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> interface nsIMsgFilterList;</span>
<a href="#l12.6"></a><span id="l12.6"> interface nsIMsgWindow;</span>
<a href="#l12.7"></a><span id="l12.7"> interface nsIMsgFilterCustomAction;</span>
<a href="#l12.8"></a><span id="l12.8"> interface nsISimpleEnumerator;</span>
<a href="#l12.9"></a><span id="l12.9"> interface nsILocalFile;</span>
<a href="#l12.10"></a><span id="l12.10"> interface nsIMsgFolder;</span>
<a href="#l12.11"></a><span id="l12.11"> interface nsISupportsArray;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+interface nsIMsgSearchCustomTerm;</span>
<a href="#l12.13"></a><span id="l12.13"> </span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-[scriptable, uuid(5D7DF40A-CD9C-4729-A715-D5666C3AA713)]</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+[scriptable, uuid(C1A5F1BB-4D6C-447a-B70F-A12BE767DC0A)]</span>
<a href="#l12.16"></a><span id="l12.16"> interface nsIMsgFilterService : nsISupports {</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18">     nsIMsgFilterList OpenFilterList(in nsILocalFile filterFile, in nsIMsgFolder rootFolder, in nsIMsgWindow msgWindow);</span>
<a href="#l12.19"></a><span id="l12.19">     void CloseFilterList(in nsIMsgFilterList filterList);</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21">     void SaveFilterList(in nsIMsgFilterList filterList,</span>
<a href="#l12.22"></a><span id="l12.22">                         in nsILocalFile filterFile);</span>
<a href="#l12.23"></a><span id="l12.23">     </span>
<a href="#l12.24"></a><span id="l12.24" class="difflineat">@@ -91,9 +92,33 @@ interface nsIMsgFilterService : nsISuppo</span>
<a href="#l12.25"></a><span id="l12.25">     /**</span>
<a href="#l12.26"></a><span id="l12.26">      * lookup a custom action given its id</span>
<a href="#l12.27"></a><span id="l12.27">      *</span>
<a href="#l12.28"></a><span id="l12.28">      * @param  id  unique identifier for a particular custom action</span>
<a href="#l12.29"></a><span id="l12.29">      *</span>
<a href="#l12.30"></a><span id="l12.30">      * @return     the custom action, or null if not found</span>
<a href="#l12.31"></a><span id="l12.31">      */</span>
<a href="#l12.32"></a><span id="l12.32">     nsIMsgFilterCustomAction getCustomAction(in ACString id);</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+    /**</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+     * add a custom search term</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+     *</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+     * @param  aTerm   the custom term to add</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+     */</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+    void addCustomTerm(in nsIMsgSearchCustomTerm aTerm);</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+    /**</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+     * get the list of custom search terms</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+     *</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+     * @return   enumerator of nsIMsgSearchCustomTerm objects</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+     */</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+    nsISimpleEnumerator getCustomTerms();</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+    /**</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+     * lookup a custom search term given its id</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+     *</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+     * @param  id  unique identifier for a particular custom search term</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+     *</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+     * @return     the custom search term, or null if not found</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+     */</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+    nsIMsgSearchCustomTerm getCustomTerm(in ACString id);</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+</span>
<a href="#l12.57"></a><span id="l12.57"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchCustomTerm.idl</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,108 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+ *</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+ *</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+ * License.</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+ *</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+ * The Original Code is mozilla.org code</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+ *</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+ * Kent James &lt;kent@caspia.com&gt;.</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+ *</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+ *</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+ *</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+#include &quot;nsMsgSearchCore.idl&quot;</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+/**</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+ * describes a custom term added to a message search or filter</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+ */</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+[scriptable,uuid(8DD6E135-6790-475e-9547-3C1408CF2F08)]</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+interface nsIMsgSearchCustomTerm : nsISupports</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+{</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+  /**</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+   * globally unique string to identify this search term.</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+   * recommended form: ExtensionName@example.com#TermName</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+   * Commas and quotes are not allowed, the id must not</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+   * parse to an integer, and names of standard search</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+   * attributes in SearchAttribEntryTable in nsMsgSearchTerm.cpp</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+   * are not allowed.</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+   */</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+  readonly attribute ACString id;</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+  /// name to display in term list. This should be localized. */</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+  readonly attribute AString name;</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+  /**</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+   * Is this custom term enabled?</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+   *</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+   * @param scope          search scope (nsMsgSearchScope)</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+   * @param op             search operator (nsMsgSearchOp). If null, determine</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+   *                       if term is available for any operator.</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+   *</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+   * @return               true if enabled</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+   */</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+  boolean getEnabled(in nsMsgSearchScopeValue scope,</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+                     in nsMsgSearchOpValue op);</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+  /**</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+   * Is this custom term available?</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+   *</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+   * @param scope          search scope (nsMsgSearchScope)</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+   * @param op             search operator (nsMsgSearchOp). If null, determine</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineplus">+   *                       if term is available for any operator.</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineplus">+   *</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineplus">+   * @return               true if available</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineplus">+   */</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineplus">+  boolean getAvailable(in nsMsgSearchScopeValue scope,</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineplus">+                       in nsMsgSearchOpValue op);</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineplus">+</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineplus">+  /**</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineplus">+   * List the valid operators for this term.</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineplus">+   *</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineplus">+   * @param scope          search scope (nsMsgSearchScope)</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineplus">+   * @param length         object to hold array length</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineplus">+   *</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineplus">+   * @return               array of operators</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+   */</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+  void getAvailableOperators(in nsMsgSearchScopeValue scope,</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+                             out unsigned long length,</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+                             [retval, array, size_is(length)]</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+                             out nsMsgSearchOpValue operators);</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineplus">+  /**</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineplus">+   * Apply the custom search term to a message</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+   *</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+   * @param msgHdr       header database reference representing the message</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+   * @param searchValue  user-set value to use in the search</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+   * @param searchOp     search operator (Contains, IsHigherThan, etc.)</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineplus">+   *</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineplus">+   * @return             true if the term matches the message, else false</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineplus">+   */</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineplus">+</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineplus">+  boolean match(in nsIMsgDBHdr msgHdr,</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+                in AUTF8String searchValue,</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineplus">+                in nsMsgSearchOpValue searchOp);</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgSearchSession.idl</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchSession.idl</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -50,21 +50,33 @@ interface nsIMsgDatabase;</span>
<a href="#l14.4"></a><span id="l14.4"> // The Msg Search Session is an interface designed to make constructing</span>
<a href="#l14.5"></a><span id="l14.5"> // searches easier. Clients typically build up search terms, and then run</span>
<a href="#l14.6"></a><span id="l14.6"> // the search</span>
<a href="#l14.7"></a><span id="l14.7"> //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> [scriptable, uuid(a819050a-0302-11d3-a50a-0060b0fc04b7)]</span>
<a href="#l14.10"></a><span id="l14.10"> interface nsIMsgSearchSession :  nsISupports {</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    void addSearchTerm(in nsMsgSearchAttribValue attrib, /* attribute for this term */</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-                       in nsMsgSearchOpValue op,/* operator e.g. opContains */</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-                       in nsIMsgSearchValue value, /* value e.g. &quot;Dogbert&quot; */</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-                       in boolean BooleanAND, /* set to true if associated boolean operator is AND */</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-                       in string arbitraryHeader); /* user defined arbitrary header. ignored unless attrib = attribOtherHeader */</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+/**</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+ * add a search term to the search session</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+ *</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+ * @param   attrib        search attribute (e.g. nsMsgSearchAttrib::Subject)</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+ * @param   op            search operator (e.g. nsMsgSearchOp::Contains)</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+ * @param   value         search value (e.g. &quot;Dogbert&quot;, see nsIMsgSearchValue)</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+ * @param   BooleanAND    set to true if associated boolean operator is AND</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+ * @param   customString  if attrib &gt; nsMsgSearchAttrib::OtherHeader,</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+ *                            a user defined arbitrary header</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+ *                        if attrib == nsMsgSearchAttrib::Custom, the custom id</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+ *                        otherwise ignored</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+ */</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+    void addSearchTerm(in nsMsgSearchAttribValue attrib,</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+                       in nsMsgSearchOpValue op,</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+                       in nsIMsgSearchValue value,</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+                       in boolean BooleanAND,</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+                       in string customString);</span>
<a href="#l14.34"></a><span id="l14.34"> </span>
<a href="#l14.35"></a><span id="l14.35">     readonly attribute nsISupportsArray searchTerms;</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37">   nsIMsgSearchTerm createTerm ();</span>
<a href="#l14.38"></a><span id="l14.38">     void appendTerm(in nsIMsgSearchTerm term);</span>
<a href="#l14.39"></a><span id="l14.39"> </span>
<a href="#l14.40"></a><span id="l14.40">   void registerListener (in nsIMsgSearchNotify listener);</span>
<a href="#l14.41"></a><span id="l14.41">   void unregisterListener (in nsIMsgSearchNotify listener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgSearchTerm.idl</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchTerm.idl</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -39,24 +39,26 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;nsMsgSearchCore.idl&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;nsIMsgSearchValue.idl&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> interface nsIMsgDBHdr;</span>
<a href="#l15.9"></a><span id="l15.9"> interface nsIMsgDatabase;</span>
<a href="#l15.10"></a><span id="l15.10"> interface nsIMsgSearchScopeTerm;</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-[scriptable, uuid(2dd082e7-faa4-4e46-81ba-9c636bc9315a)]</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+[scriptable, uuid(D14C266B-5028-448d-B3F1-B059BD0055AA)]</span>
<a href="#l15.14"></a><span id="l15.14"> interface nsIMsgSearchTerm : nsISupports {</span>
<a href="#l15.15"></a><span id="l15.15">     attribute nsMsgSearchAttribValue attrib;</span>
<a href="#l15.16"></a><span id="l15.16">     attribute nsMsgSearchOpValue op;</span>
<a href="#l15.17"></a><span id="l15.17">     attribute nsIMsgSearchValue value;</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19">     attribute boolean booleanAnd;</span>
<a href="#l15.20"></a><span id="l15.20">     attribute ACString arbitraryHeader;</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+    /// identifier for a custom id used for this term, if any.</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+    attribute ACString customId;</span>
<a href="#l15.23"></a><span id="l15.23"> </span>
<a href="#l15.24"></a><span id="l15.24">     attribute boolean beginsGrouping;</span>
<a href="#l15.25"></a><span id="l15.25">     attribute boolean endsGrouping;</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27">     boolean matchRfc822String(in string aString, in string charset, in boolean charsetOverride);</span>
<a href="#l15.28"></a><span id="l15.28">     boolean matchRfc2047String(in string aString, in string charset, in boolean charsetOverride);</span>
<a href="#l15.29"></a><span id="l15.29">     boolean matchDate(in PRTime aTime);</span>
<a href="#l15.30"></a><span id="l15.30">     boolean matchStatus(in unsigned long aStatus);</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineat">@@ -102,10 +104,18 @@ interface nsIMsgSearchTerm : nsISupports</span>
<a href="#l15.32"></a><span id="l15.32">                                  in unsigned long headerLength,</span>
<a href="#l15.33"></a><span id="l15.33">                                  in boolean forFilters);</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35">     readonly attribute boolean matchAllBeforeDeciding;</span>
<a href="#l15.36"></a><span id="l15.36"> </span>
<a href="#l15.37"></a><span id="l15.37">     readonly attribute ACString termAsString;</span>
<a href="#l15.38"></a><span id="l15.38">     boolean matchKeyword(in ACString keyword); // used for tag searches</span>
<a href="#l15.39"></a><span id="l15.39">     attribute boolean matchAll;</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+    /**</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+     * Does the message match the custom search term?</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+     *</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+     * @param  msg  message database object representing the message</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+     *</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+     * @return      true if message matches</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+     */</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+    boolean matchCustom(in nsIMsgDBHdr msg);</span>
<a href="#l15.48"></a><span id="l15.48"> };</span>
<a href="#l15.49"></a><span id="l15.49"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchCore.idl</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchCore.idl</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -68,16 +68,17 @@ typedef long nsMsgSearchAttribValue;</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5"> /**</span>
<a href="#l16.6"></a><span id="l16.6">  * Definitions of search attribute types. The numerical order</span>
<a href="#l16.7"></a><span id="l16.7">  * from here will also be used to determine the order that the</span>
<a href="#l16.8"></a><span id="l16.8">  * attributes display in the filter editor.</span>
<a href="#l16.9"></a><span id="l16.9">  */</span>
<a href="#l16.10"></a><span id="l16.10"> [scriptable, uuid(9ED17774-4748-46a6-9A18-E651E3B791F2)]</span>
<a href="#l16.11"></a><span id="l16.11"> interface nsMsgSearchAttrib {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+    const nsMsgSearchAttribValue Custom = -2;  /* a custom term, see nsIMsgSearchCustomTerm */</span>
<a href="#l16.13"></a><span id="l16.13">     const nsMsgSearchAttribValue Default = -1;</span>
<a href="#l16.14"></a><span id="l16.14">     const nsMsgSearchAttribValue Subject = 0;  /* mail and news */</span>
<a href="#l16.15"></a><span id="l16.15">     const nsMsgSearchAttribValue Sender = 1;</span>
<a href="#l16.16"></a><span id="l16.16">     const nsMsgSearchAttribValue Body = 2;</span>
<a href="#l16.17"></a><span id="l16.17">     const nsMsgSearchAttribValue Date = 3;</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">     const nsMsgSearchAttribValue Priority = 4;      /* mail only */</span>
<a href="#l16.20"></a><span id="l16.20">     const nsMsgSearchAttribValue MsgStatus = 5;</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineat">@@ -151,17 +152,19 @@ interface nsMsgSearchOp {</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23">     const nsMsgSearchOpValue IsGreaterThan = 13;</span>
<a href="#l16.24"></a><span id="l16.24">     const nsMsgSearchOpValue IsLessThan = 14;</span>
<a href="#l16.25"></a><span id="l16.25"> </span>
<a href="#l16.26"></a><span id="l16.26">     const nsMsgSearchOpValue NameCompletion = 15; /* Name Completion operator...as the name implies =) */</span>
<a href="#l16.27"></a><span id="l16.27">     const nsMsgSearchOpValue IsInAB = 16;</span>
<a href="#l16.28"></a><span id="l16.28">     const nsMsgSearchOpValue IsntInAB = 17;</span>
<a href="#l16.29"></a><span id="l16.29">     const nsMsgSearchOpValue IsntEmpty = 18; /* primarily for tags */</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-    const nsMsgSearchOpValue kNumMsgSearchOperators  = 19;     /* must be last operator */</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+    const nsMsgSearchOpValue Matches = 19; /* generic term for use by custom terms */</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+    const nsMsgSearchOpValue DoesntMatch = 20; /* generic term for use by custom terms */</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+    const nsMsgSearchOpValue kNumMsgSearchOperators  = 21;     /* must be last operator */</span>
<a href="#l16.34"></a><span id="l16.34"> };</span>
<a href="#l16.35"></a><span id="l16.35"> </span>
<a href="#l16.36"></a><span id="l16.36"> typedef long nsMsgSearchWidgetValue;</span>
<a href="#l16.37"></a><span id="l16.37"> </span>
<a href="#l16.38"></a><span id="l16.38"> /* FEs use this to help build the search dialog box */</span>
<a href="#l16.39"></a><span id="l16.39"> [scriptable,uuid(903dd2e8-304e-11d3-92e6-00a0c900d445)]</span>
<a href="#l16.40"></a><span id="l16.40"> interface nsMsgSearchWidget {</span>
<a href="#l16.41"></a><span id="l16.41">     const nsMsgSearchWidgetValue Text = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchTerm.h</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchTerm.h</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -39,16 +39,17 @@</span>
<a href="#l17.4"></a><span id="l17.4"> #ifndef __nsMsgSearchTerm_h</span>
<a href="#l17.5"></a><span id="l17.5"> #define __nsMsgSearchTerm_h</span>
<a href="#l17.6"></a><span id="l17.6"> //---------------------------------------------------------------------------</span>
<a href="#l17.7"></a><span id="l17.7"> // nsMsgSearchTerm specifies one criterion, e.g. name contains phil</span>
<a href="#l17.8"></a><span id="l17.8"> //---------------------------------------------------------------------------</span>
<a href="#l17.9"></a><span id="l17.9"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l17.10"></a><span id="l17.10"> #include &quot;nsIMsgSearchScopeTerm.h&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> #include &quot;nsIMsgSearchTerm.h&quot;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+#include &quot;nsIMsgSearchCustomTerm.h&quot;</span>
<a href="#l17.13"></a><span id="l17.13"> </span>
<a href="#l17.14"></a><span id="l17.14"> // needed to search for addresses in address books</span>
<a href="#l17.15"></a><span id="l17.15"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17"> #define EMPTY_MESSAGE_LINE(buf) (buf[0] == '\r' || buf[0] == '\n' || buf[0] == '\0')</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19"> class nsMsgSearchTerm : public nsIMsgSearchTerm</span>
<a href="#l17.20"></a><span id="l17.20"> {</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineat">@@ -100,16 +101,17 @@ public:</span>
<a href="#l17.22"></a><span id="l17.22"> </span>
<a href="#l17.23"></a><span id="l17.23">   nsMsgSearchAttribValue m_attribute;</span>
<a href="#l17.24"></a><span id="l17.24">   nsMsgSearchOpValue m_operator;</span>
<a href="#l17.25"></a><span id="l17.25">   nsMsgSearchValue m_value;</span>
<a href="#l17.26"></a><span id="l17.26">   nsMsgSearchBooleanOperator m_booleanOp;  // boolean operator to be applied to this search term and the search term which precedes it.</span>
<a href="#l17.27"></a><span id="l17.27">   nsCString m_arbitraryHeader;         // user specified string for the name of the arbitrary header to be used in the search</span>
<a href="#l17.28"></a><span id="l17.28">                     // only has a value when m_attribute = attribOtherHeader!!!!</span>
<a href="#l17.29"></a><span id="l17.29">         PRBool m_matchAll; // does this term match all headers?</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+  nsCString m_customId; // id of custom search term</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32"> protected:</span>
<a href="#l17.33"></a><span id="l17.33">   nsresult MatchString (const char *stringToMatch, const char *charset,</span>
<a href="#l17.34"></a><span id="l17.34">                           PRBool *pResult);</span>
<a href="#l17.35"></a><span id="l17.35">   nsresult OutputValue(nsCString &amp;outputStr);</span>
<a href="#l17.36"></a><span id="l17.36">   nsresult ParseAttribute(char *inStream, nsMsgSearchAttribValue *attrib);</span>
<a href="#l17.37"></a><span id="l17.37">   nsresult ParseOperator(char *inStream, nsMsgSearchOpValue *value);</span>
<a href="#l17.38"></a><span id="l17.38">   nsresult ParseValue(char *inStream);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/search/resources/content/FilterEditor.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/search/resources/content/FilterEditor.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -145,17 +145,17 @@ function filterEditorOnLoad()</span>
<a href="#l18.4"></a><span id="l18.4">       name = stub + &quot; &quot; + count.toString();</span>
<a href="#l18.5"></a><span id="l18.5">     }</span>
<a href="#l18.6"></a><span id="l18.6">     gFilterNameElement.value = name;</span>
<a href="#l18.7"></a><span id="l18.7">     gFilterContext.selectedIndex = 2; // both</span>
<a href="#l18.8"></a><span id="l18.8">   }</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">   // in the case of a new filter, we may not have an action row yet.</span>
<a href="#l18.11"></a><span id="l18.11">   ensureActionRow();</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  updateFilterType();</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  gFilterType = determineFilterType();</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">   gFilterNameElement.select();</span>
<a href="#l18.16"></a><span id="l18.16">   // This call is required on mac and linux.  It has no effect under win32.  See bug 94800.</span>
<a href="#l18.17"></a><span id="l18.17">   gFilterNameElement.focus();</span>
<a href="#l18.18"></a><span id="l18.18">   moveToAlertPosition();</span>
<a href="#l18.19"></a><span id="l18.19"> }</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21"> function filterEditorOnUnload()</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -261,19 +261,19 @@ function initializeDialog(filter)</span>
<a href="#l18.23"></a><span id="l18.23">     newActionRow.setAttribute('initialActionIndex', actionIndex);</span>
<a href="#l18.24"></a><span id="l18.24">     newActionRow.className = 'ruleaction';</span>
<a href="#l18.25"></a><span id="l18.25">     gFilterActionList.appendChild(newActionRow);</span>
<a href="#l18.26"></a><span id="l18.26">     newActionRow.setAttribute('value',</span>
<a href="#l18.27"></a><span id="l18.27">         filterAction.type == Components.interfaces.nsMsgFilterAction.Custom ?</span>
<a href="#l18.28"></a><span id="l18.28">         filterAction.customId : gFilterActionStrings[filterAction.type]);</span>
<a href="#l18.29"></a><span id="l18.29">   }</span>
<a href="#l18.30"></a><span id="l18.30"> </span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-  var scope = getScope(filter);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-  setSearchScope(scope);</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-  initializeSearchRows(scope, filter.searchTerms);</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+  var gSearchScope = getFilterScope(getScope(filter), filter.filterType, filter.filterList);</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+  initializeSearchRows(gSearchScope, filter.searchTerms);</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+  setFilterScope(filter.filterType, filter.filterList);</span>
<a href="#l18.37"></a><span id="l18.37"> }</span>
<a href="#l18.38"></a><span id="l18.38"> </span>
<a href="#l18.39"></a><span id="l18.39"> function ensureActionRow()</span>
<a href="#l18.40"></a><span id="l18.40"> {</span>
<a href="#l18.41"></a><span id="l18.41">   // make sure we have at least one action row visible to the user</span>
<a href="#l18.42"></a><span id="l18.42">   if (!gFilterActionList.getRowCount())</span>
<a href="#l18.43"></a><span id="l18.43">   {</span>
<a href="#l18.44"></a><span id="l18.44">     var newActionRow = document.createElement('listitem');</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineat">@@ -306,16 +306,46 @@ function saveFilter()</span>
<a href="#l18.46"></a><span id="l18.46">   if ((!gFilter || gFilter.filterName != filterName) &amp;&amp; duplicateFilterNameExists(filterName))</span>
<a href="#l18.47"></a><span id="l18.47">   {</span>
<a href="#l18.48"></a><span id="l18.48">     if (gPromptService)</span>
<a href="#l18.49"></a><span id="l18.49">       gPromptService.alert(window,gFilterBundle.getString(&quot;cannotHaveDuplicateFilterTitle&quot;), </span>
<a href="#l18.50"></a><span id="l18.50">                            gFilterBundle.getString(&quot;cannotHaveDuplicateFilterMessage&quot;));</span>
<a href="#l18.51"></a><span id="l18.51">     return false;</span>
<a href="#l18.52"></a><span id="l18.52">   }</span>
<a href="#l18.53"></a><span id="l18.53"> </span>
<a href="#l18.54"></a><span id="l18.54" class="difflineplus">+  // Check that all of the search attributes and operators are valid.</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+  let allValid = true;</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+  for (var index = 0; index &lt; gSearchTerms.length &amp;&amp; allValid; index++)</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+  {</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+    let obj = gSearchTerms[index].obj;</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+    if (isNaN(obj.searchattribute.value)) // is this a custom term?</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineplus">+    {</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineplus">+      let filterService = Components.classes[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineplus">+          .getService(Components.interfaces.nsIMsgFilterService);</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineplus">+      let customTerm = filterService.getCustomTerm(obj.searchattribute.value);</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineplus">+      if (!customTerm)</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineplus">+        allValid = false;</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineplus">+      else</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineplus">+        allValid = customTerm.getAvailable(obj.searchScope, obj.searchattribute.value);</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineplus">+    }</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineplus">+</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineplus">+    else if (!obj.searchattribute</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineplus">+            .validityTable</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineplus">+            .getAvailable(obj.searchattribute.value, obj.searchoperator.value))</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineplus">+      allValid = false;</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineplus">+  }</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineplus">+</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineplus">+  if (!allValid)</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineplus">+  {</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineplus">+    if (gPromptService)</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineplus">+      gPromptService.alert(window, gFilterBundle.getString(&quot;searchTermsInvalidTitle&quot;),</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineplus">+                           gFilterBundle.getString(&quot;searchTermsInvalidMessage&quot;));</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineplus">+    return false;</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineplus">+  }</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineplus">+</span>
<a href="#l18.84"></a><span id="l18.84">   // before we go any further, validate each specified filter action, abort the save</span>
<a href="#l18.85"></a><span id="l18.85">   // if any of the actions is invalid...</span>
<a href="#l18.86"></a><span id="l18.86">   for (var index = 0; index &lt; gFilterActionList.getRowCount(); index++)</span>
<a href="#l18.87"></a><span id="l18.87">   {</span>
<a href="#l18.88"></a><span id="l18.88">     var listItem = gFilterActionList.getItemAtIndex(index);</span>
<a href="#l18.89"></a><span id="l18.89">     if (!listItem.validateAction())</span>
<a href="#l18.90"></a><span id="l18.90">       return false;</span>
<a href="#l18.91"></a><span id="l18.91">   }</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineat">@@ -342,17 +372,17 @@ function saveFilter()</span>
<a href="#l18.93"></a><span id="l18.93">     </span>
<a href="#l18.94"></a><span id="l18.94">     gFilter.clearActionList();</span>
<a href="#l18.95"></a><span id="l18.95">   }</span>
<a href="#l18.96"></a><span id="l18.96"> </span>
<a href="#l18.97"></a><span id="l18.97">   // add each filteraction to the filter</span>
<a href="#l18.98"></a><span id="l18.98">   for (index = 0; index &lt; gFilterActionList.getRowCount(); index++)</span>
<a href="#l18.99"></a><span id="l18.99">     gFilterActionList.getItemAtIndex(index).saveToFilter(gFilter);</span>
<a href="#l18.100"></a><span id="l18.100"> </span>
<a href="#l18.101"></a><span id="l18.101" class="difflineminus">-  updateFilterType();</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineplus">+  gFilter.filterType = gFilterType;</span>
<a href="#l18.103"></a><span id="l18.103">   saveSearchTerms(gFilter.searchTerms, gFilter);</span>
<a href="#l18.104"></a><span id="l18.104"> </span>
<a href="#l18.105"></a><span id="l18.105">   if (isNewFilter) </span>
<a href="#l18.106"></a><span id="l18.106">   {</span>
<a href="#l18.107"></a><span id="l18.107">     // new filter - insert into gFilterList</span>
<a href="#l18.108"></a><span id="l18.108">     gFilterList.insertFilterAt(0, gFilter);</span>
<a href="#l18.109"></a><span id="l18.109">   }</span>
<a href="#l18.110"></a><span id="l18.110"> </span>
<a href="#l18.111"></a><span id="l18.111" class="difflineat">@@ -462,35 +492,77 @@ function getCustomActions()</span>
<a href="#l18.112"></a><span id="l18.112">     while (customActionsEnum.hasMoreElements())</span>
<a href="#l18.113"></a><span id="l18.113">       gCustomActions.push(customActionsEnum.getNext().QueryInterface(</span>
<a href="#l18.114"></a><span id="l18.114">                            Components.interfaces.nsIMsgFilterCustomAction));</span>
<a href="#l18.115"></a><span id="l18.115">   }</span>
<a href="#l18.116"></a><span id="l18.116"> }</span>
<a href="#l18.117"></a><span id="l18.117"> </span>
<a href="#l18.118"></a><span id="l18.118"> function updateFilterType()</span>
<a href="#l18.119"></a><span id="l18.119"> {</span>
<a href="#l18.120"></a><span id="l18.120" class="difflineminus">-  var contextIndex = gFilterContext.selectedIndex;</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineminus">-  if (contextIndex &lt; 0 || contextIndex == 1)</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineminus">-  {</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineminus">-    gFilterType = Components.interfaces.nsMsgFilterType.None;</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineminus">-  }</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineminus">-  else</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineminus">-  {</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineminus">-    if (getScopeFromFilterList(gFilterList) == Components.interfaces.nsMsgSearchScope.newsFilter)</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineminus">-      gFilterType = Components.interfaces.nsMsgFilterType.NewsRule;</span>
<a href="#l18.129"></a><span id="l18.129" class="difflineminus">-    else</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineminus">-      gFilterType = Components.interfaces.nsMsgFilterType.InboxRule;</span>
<a href="#l18.131"></a><span id="l18.131" class="difflineminus">-  }</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineminus">-  if (contextIndex &gt; 0)</span>
<a href="#l18.133"></a><span id="l18.133" class="difflineminus">-    gFilterType |= Components.interfaces.nsMsgFilterType.Manual;</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineminus">-</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineminus">-  if (gFilter)</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineminus">-  {</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineminus">-    gFilter.filterType = gFilterType;</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineminus">-    if (gFilter.filterType == Components.interfaces.nsMsgFilterType.None)</span>
<a href="#l18.139"></a><span id="l18.139" class="difflineminus">-      gFilter.enabled = false;</span>
<a href="#l18.140"></a><span id="l18.140" class="difflineminus">-  }</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineplus">+  gFilterType = determineFilterType();</span>
<a href="#l18.142"></a><span id="l18.142" class="difflineplus">+  setFilterScope(gFilterType, gFilterList);</span>
<a href="#l18.143"></a><span id="l18.143"> </span>
<a href="#l18.144"></a><span id="l18.144">   // set valid actions</span>
<a href="#l18.145"></a><span id="l18.145">   var ruleActions = gFilterActionList.getElementsByAttribute('class', 'ruleaction');</span>
<a href="#l18.146"></a><span id="l18.146">   for (var i = 0; i &lt; ruleActions.length; i++)</span>
<a href="#l18.147"></a><span id="l18.147">     ruleActions[i].mRuleActionType.hideInvalidActions();</span>
<a href="#l18.148"></a><span id="l18.148"> }</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineplus">+</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineplus">+function determineFilterType()</span>
<a href="#l18.151"></a><span id="l18.151" class="difflineplus">+{</span>
<a href="#l18.152"></a><span id="l18.152" class="difflineplus">+  /*</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineplus">+   * contextIndex = 0: checking mail</span>
<a href="#l18.154"></a><span id="l18.154" class="difflineplus">+   *              = 1: manually run</span>
<a href="#l18.155"></a><span id="l18.155" class="difflineplus">+   *              = 2: checking mail or manually run</span>
<a href="#l18.156"></a><span id="l18.156" class="difflineplus">+   */</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineplus">+  let contextIndex = gFilterContext.selectedIndex;</span>
<a href="#l18.158"></a><span id="l18.158" class="difflineplus">+  let filterType = Components.interfaces.nsMsgFilterType.None; // that is, 0</span>
<a href="#l18.159"></a><span id="l18.159" class="difflineplus">+  if (contextIndex == 1) // manual only</span>
<a href="#l18.160"></a><span id="l18.160" class="difflineplus">+  {</span>
<a href="#l18.161"></a><span id="l18.161" class="difflineplus">+    filterType = Components.interfaces.nsMsgFilterType.Manual;</span>
<a href="#l18.162"></a><span id="l18.162" class="difflineplus">+  }</span>
<a href="#l18.163"></a><span id="l18.163" class="difflineplus">+  else // 0 or 2, checking mail is enabled</span>
<a href="#l18.164"></a><span id="l18.164" class="difflineplus">+  {</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineplus">+    if (getScopeFromFilterList(gFilterList) ==</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineplus">+        Components.interfaces.nsMsgSearchScope.newsFilter)</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineplus">+      filterType = Components.interfaces.nsMsgFilterType.NewsRule;</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineplus">+    else</span>
<a href="#l18.169"></a><span id="l18.169" class="difflineplus">+      filterType = Components.interfaces.nsMsgFilterType.InboxRule;</span>
<a href="#l18.170"></a><span id="l18.170" class="difflineplus">+</span>
<a href="#l18.171"></a><span id="l18.171" class="difflineplus">+    if (contextIndex == 2)</span>
<a href="#l18.172"></a><span id="l18.172" class="difflineplus">+      filterType |= Components.interfaces.nsMsgFilterType.Manual;</span>
<a href="#l18.173"></a><span id="l18.173" class="difflineplus">+  }</span>
<a href="#l18.174"></a><span id="l18.174" class="difflineplus">+  return filterType;</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineplus">+}</span>
<a href="#l18.176"></a><span id="l18.176" class="difflineplus">+</span>
<a href="#l18.177"></a><span id="l18.177" class="difflineplus">+// Given a filter type, set the global search scope to the filter scope</span>
<a href="#l18.178"></a><span id="l18.178" class="difflineplus">+function setFilterScope(aFilterType, aFilterList) </span>
<a href="#l18.179"></a><span id="l18.179" class="difflineplus">+{</span>
<a href="#l18.180"></a><span id="l18.180" class="difflineplus">+  let filterScope = getFilterScope(getScopeFromFilterList(aFilterList),</span>
<a href="#l18.181"></a><span id="l18.181" class="difflineplus">+                                   aFilterType, aFilterList);</span>
<a href="#l18.182"></a><span id="l18.182" class="difflineplus">+  setSearchScope(filterScope);</span>
<a href="#l18.183"></a><span id="l18.183" class="difflineplus">+}</span>
<a href="#l18.184"></a><span id="l18.184" class="difflineplus">+</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineplus">+//</span>
<a href="#l18.186"></a><span id="l18.186" class="difflineplus">+// Given the base filter scope for a server, and the filter</span>
<a href="#l18.187"></a><span id="l18.187" class="difflineplus">+// type, return the scope used for filter. This assumes a</span>
<a href="#l18.188"></a><span id="l18.188" class="difflineplus">+// hierarchy of contexts, with incoming the most restrictive,</span>
<a href="#l18.189"></a><span id="l18.189" class="difflineplus">+// followed by manual.</span>
<a href="#l18.190"></a><span id="l18.190" class="difflineplus">+function getFilterScope(aServerFilterScope, aFilterType, aFilterList)</span>
<a href="#l18.191"></a><span id="l18.191" class="difflineplus">+{</span>
<a href="#l18.192"></a><span id="l18.192" class="difflineplus">+  let Ci = Components.interfaces;</span>
<a href="#l18.193"></a><span id="l18.193" class="difflineplus">+</span>
<a href="#l18.194"></a><span id="l18.194" class="difflineplus">+  if (aFilterType &amp; Ci.nsMsgFilterType.Incoming)</span>
<a href="#l18.195"></a><span id="l18.195" class="difflineplus">+    return aServerFilterScope;</span>
<a href="#l18.196"></a><span id="l18.196" class="difflineplus">+</span>
<a href="#l18.197"></a><span id="l18.197" class="difflineplus">+  if (aFilterType &amp; Ci.nsMsgFilterType.Manual)</span>
<a href="#l18.198"></a><span id="l18.198" class="difflineplus">+  {</span>
<a href="#l18.199"></a><span id="l18.199" class="difflineplus">+    // local mail allows body and junk types</span>
<a href="#l18.200"></a><span id="l18.200" class="difflineplus">+    if (aServerFilterScope == Ci.nsMsgSearchScope.offlineMailFilter)</span>
<a href="#l18.201"></a><span id="l18.201" class="difflineplus">+      return Ci.nsMsgSearchScope.offlineMail;</span>
<a href="#l18.202"></a><span id="l18.202" class="difflineplus">+    // IMAP and NEWS don't allow body</span>
<a href="#l18.203"></a><span id="l18.203" class="difflineplus">+    return aServerFilterScope;</span>
<a href="#l18.204"></a><span id="l18.204" class="difflineplus">+  }</span>
<a href="#l18.205"></a><span id="l18.205" class="difflineplus">+</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineplus">+  // We shouldn't get here</span>
<a href="#l18.207"></a><span id="l18.207" class="difflineplus">+  dump(&quot;Invalid filter type in getFilterScope\n&quot;);</span>
<a href="#l18.208"></a><span id="l18.208" class="difflineplus">+  return null;</span>
<a href="#l18.209"></a><span id="l18.209" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/search/resources/content/searchTermOverlay.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/search/resources/content/searchTermOverlay.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -67,17 +67,24 @@ searchTermContainer.prototype = {</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5">         var term = val;</span>
<a href="#l19.6"></a><span id="l19.6">         // val is a nsIMsgSearchTerm</span>
<a href="#l19.7"></a><span id="l19.7">         var searchAttribute=this.searchattribute;</span>
<a href="#l19.8"></a><span id="l19.8">         var searchOperator=this.searchoperator;</span>
<a href="#l19.9"></a><span id="l19.9">         var searchValue=this.searchvalue;</span>
<a href="#l19.10"></a><span id="l19.10"> </span>
<a href="#l19.11"></a><span id="l19.11">         // now reflect all attributes of the searchterm into the widgets</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-        if (searchAttribute) searchAttribute.value = term.attrib;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+        if (searchAttribute)</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+        {</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+          // for custom, the value is the custom id, not the integer attribute</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+          if (term.attrib == Components.interfaces.nsMsgSearchAttrib.Custom)</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+            searchAttribute.value = term.customId;</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+          else</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+            searchAttribute.value = term.attrib;</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+        }</span>
<a href="#l19.21"></a><span id="l19.21">         if (searchOperator) searchOperator.value = val.op;</span>
<a href="#l19.22"></a><span id="l19.22">         if (searchValue) searchValue.value = term.value;</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24">         this.booleanAnd = val.booleanAnd;</span>
<a href="#l19.25"></a><span id="l19.25">         this.matchAll = val.matchAll;</span>
<a href="#l19.26"></a><span id="l19.26">         return val;</span>
<a href="#l19.27"></a><span id="l19.27">     },</span>
<a href="#l19.28"></a><span id="l19.28"> </span>
<a href="#l19.29"></a><span id="l19.29" class="difflineat">@@ -126,19 +133,28 @@ searchTermContainer.prototype = {</span>
<a href="#l19.30"></a><span id="l19.30">     get booleanAnd() { return this.internalBooleanAnd; },</span>
<a href="#l19.31"></a><span id="l19.31">     set booleanAnd(val) {</span>
<a href="#l19.32"></a><span id="l19.32">         this.internalBooleanAnd = val;</span>
<a href="#l19.33"></a><span id="l19.33">         return val;</span>
<a href="#l19.34"></a><span id="l19.34">     },</span>
<a href="#l19.35"></a><span id="l19.35"> </span>
<a href="#l19.36"></a><span id="l19.36">     save: function () {</span>
<a href="#l19.37"></a><span id="l19.37">         var searchTerm = this.searchTerm;</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+        var nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l19.39"></a><span id="l19.39"> </span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">-        searchTerm.attrib = this.searchattribute.value;</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-        var nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+        if (isNaN(this.searchattribute.value)) // is this a custom term?</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+        {</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+          searchTerm.attrib = nsMsgSearchAttrib.Custom;</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+          searchTerm.customId = this.searchattribute.value;</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+        }</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+        else</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+        {</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+          searchTerm.attrib = this.searchattribute.value;</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+        }</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+</span>
<a href="#l19.52"></a><span id="l19.52">         if (this.searchattribute.value &gt; nsMsgSearchAttrib.OtherHeader &amp;&amp; this.searchattribute.value &lt; nsMsgSearchAttrib.kNumMsgSearchAttributes) </span>
<a href="#l19.53"></a><span id="l19.53">           searchTerm.arbitraryHeader = this.searchattribute.label;</span>
<a href="#l19.54"></a><span id="l19.54">         searchTerm.op = this.searchoperator.value;</span>
<a href="#l19.55"></a><span id="l19.55">         if (this.searchvalue.value)</span>
<a href="#l19.56"></a><span id="l19.56">             this.searchvalue.save();</span>
<a href="#l19.57"></a><span id="l19.57">         else</span>
<a href="#l19.58"></a><span id="l19.58">             this.searchvalue.saveTo(searchTerm.value);</span>
<a href="#l19.59"></a><span id="l19.59">         searchTerm.value = this.searchvalue.value;</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineat">@@ -271,23 +287,28 @@ function onLess(event)</span>
<a href="#l19.61"></a><span id="l19.61">   }</span>
<a href="#l19.62"></a><span id="l19.62"> </span>
<a href="#l19.63"></a><span id="l19.63">   updateRemoveRowButton();</span>
<a href="#l19.64"></a><span id="l19.64"> }</span>
<a href="#l19.65"></a><span id="l19.65"> </span>
<a href="#l19.66"></a><span id="l19.66"> // set scope on all visible searchattribute tags</span>
<a href="#l19.67"></a><span id="l19.67"> function setSearchScope(scope) </span>
<a href="#l19.68"></a><span id="l19.68"> {</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineminus">-    gSearchScope = scope;</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineminus">-    for (var i=0; i&lt;gSearchTerms.length; i++) {</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineminus">-        gSearchTerms[i].obj.searchattribute.searchScope = scope;</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineminus">-        gSearchTerms[i].scope = scope;</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineminus">-        // act like the user &quot;selected&quot; this, see bug #202848</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineminus">-        gSearchTerms[i].obj.searchattribute.onSelect(null /* no event */);  </span>
<a href="#l19.75"></a><span id="l19.75" class="difflineplus">+  gSearchScope = scope;</span>
<a href="#l19.76"></a><span id="l19.76" class="difflineplus">+  for (var i = 0; i &lt; gSearchTerms.length; i++)</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineplus">+  {</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineplus">+    // don't set element attributes if XBL hasn't loaded</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineplus">+    if (!(gSearchTerms[i].obj.searchattribute.searchScope === undefined))</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineplus">+    {</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineplus">+      gSearchTerms[i].obj.searchattribute.searchScope = scope;</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineplus">+      // act like the user &quot;selected&quot; this, see bug #202848</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineplus">+      gSearchTerms[i].obj.searchattribute.onSelect(null /* no event */);</span>
<a href="#l19.84"></a><span id="l19.84">     }</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineplus">+    gSearchTerms[i].scope = scope;</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineplus">+  }</span>
<a href="#l19.87"></a><span id="l19.87"> }</span>
<a href="#l19.88"></a><span id="l19.88"> </span>
<a href="#l19.89"></a><span id="l19.89"> function updateSearchAttributes()</span>
<a href="#l19.90"></a><span id="l19.90"> {</span>
<a href="#l19.91"></a><span id="l19.91">     for (var i=0; i&lt;gSearchTerms.length; i++) </span>
<a href="#l19.92"></a><span id="l19.92">         gSearchTerms[i].obj.searchattribute.refreshList();</span>
<a href="#l19.93"></a><span id="l19.93">     }</span>
<a href="#l19.94"></a><span id="l19.94"> </span>
<a href="#l19.95"></a><span id="l19.95" class="difflineat">@@ -419,19 +440,20 @@ function initializeTermFromIndex(index)</span>
<a href="#l19.96"></a><span id="l19.96">     // here, we don't have a searchTerm, so it's probably a new element -</span>
<a href="#l19.97"></a><span id="l19.97">     // we'll initialize the .booleanAnd from the existing setting in</span>
<a href="#l19.98"></a><span id="l19.98">     // the UI</span>
<a href="#l19.99"></a><span id="l19.99">     else</span>
<a href="#l19.100"></a><span id="l19.100">     {</span>
<a href="#l19.101"></a><span id="l19.101">       searchTermObj.booleanAnd = (gSearchBooleanRadiogroup.value == &quot;and&quot;);</span>
<a href="#l19.102"></a><span id="l19.102">       if (index)</span>
<a href="#l19.103"></a><span id="l19.103">       {</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineminus">-        // if we weren't pre-initialized with a searchTerm then steal the search attribute from the </span>
<a href="#l19.105"></a><span id="l19.105" class="difflineminus">-        // previous row.</span>
<a href="#l19.106"></a><span id="l19.106" class="difflineplus">+        // If we weren't pre-initialized with a searchTerm then steal the</span>
<a href="#l19.107"></a><span id="l19.107" class="difflineplus">+        // search attribute and operator from the previous row.</span>
<a href="#l19.108"></a><span id="l19.108">         searchTermObj.searchattribute.value =  gSearchTerms[index - 1].obj.searchattribute.value;</span>
<a href="#l19.109"></a><span id="l19.109" class="difflineplus">+        searchTermObj.searchoperator.value = gSearchTerms[index - 1].obj.searchoperator.value;</span>
<a href="#l19.110"></a><span id="l19.110">       }</span>
<a href="#l19.111"></a><span id="l19.111">     }</span>
<a href="#l19.112"></a><span id="l19.112"> </span>
<a href="#l19.113"></a><span id="l19.113">     gSearchTerms[index].initialized = true;</span>
<a href="#l19.114"></a><span id="l19.114"> }</span>
<a href="#l19.115"></a><span id="l19.115"> </span>
<a href="#l19.116"></a><span id="l19.116"> // creates a &lt;listitem&gt; using the array children as</span>
<a href="#l19.117"></a><span id="l19.117"> // the children of each listcell</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineat">@@ -505,17 +527,17 @@ function saveSearchTerms(searchTerms, te</span>
<a href="#l19.119"></a><span id="l19.119">             var searchTerm = gSearchTerms[i].obj.searchTerm;</span>
<a href="#l19.120"></a><span id="l19.120"> </span>
<a href="#l19.121"></a><span id="l19.121">             // the term might be an offscreen one we haven't initialized yet</span>
<a href="#l19.122"></a><span id="l19.122">             // if so, don't bother saving it.</span>
<a href="#l19.123"></a><span id="l19.123">             if (!searchTerm &amp;&amp; !gSearchTerms[i].initialized) {</span>
<a href="#l19.124"></a><span id="l19.124">                 // is an existing term, but not initialize, so skip saving</span>
<a href="#l19.125"></a><span id="l19.125">                 continue;</span>
<a href="#l19.126"></a><span id="l19.126">             }</span>
<a href="#l19.127"></a><span id="l19.127" class="difflineminus">-            searchTerm.matchAll = matchAll;</span>
<a href="#l19.128"></a><span id="l19.128" class="difflineplus">+            gSearchTerms[i].obj.matchAll = matchAll;</span>
<a href="#l19.129"></a><span id="l19.129">             if (searchTerm)</span>
<a href="#l19.130"></a><span id="l19.130">                 gSearchTerms[i].obj.save();</span>
<a href="#l19.131"></a><span id="l19.131">             else {</span>
<a href="#l19.132"></a><span id="l19.132">                 // need to create a new searchTerm, and somehow save it to that</span>
<a href="#l19.133"></a><span id="l19.133">                 searchTerm = termOwner.createTerm();</span>
<a href="#l19.134"></a><span id="l19.134">                 gSearchTerms[i].obj.saveTo(searchTerm);</span>
<a href="#l19.135"></a><span id="l19.135">                 termOwner.appendTerm(searchTerm);</span>
<a href="#l19.136"></a><span id="l19.136">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -69,16 +69,17 @@</span>
<a href="#l20.4"></a><span id="l20.4"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l20.5"></a><span id="l20.5"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l20.6"></a><span id="l20.6"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l20.7"></a><span id="l20.7"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l20.8"></a><span id="l20.8"> #include &quot;nsIMsgFilterCustomAction.h&quot;</span>
<a href="#l20.9"></a><span id="l20.9"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l20.10"></a><span id="l20.10"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l20.11"></a><span id="l20.11"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+#include &quot;nsIMsgSearchCustomTerm.h&quot;</span>
<a href="#l20.13"></a><span id="l20.13"> </span>
<a href="#l20.14"></a><span id="l20.14"> NS_IMPL_ISUPPORTS1(nsMsgFilterService, nsIMsgFilterService)</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16"> nsMsgFilterService::nsMsgFilterService()</span>
<a href="#l20.17"></a><span id="l20.17"> {</span>
<a href="#l20.18"></a><span id="l20.18"> }</span>
<a href="#l20.19"></a><span id="l20.19"> </span>
<a href="#l20.20"></a><span id="l20.20"> nsMsgFilterService::~nsMsgFilterService()</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineat">@@ -752,24 +753,26 @@ nsresult nsMsgFilterAfterTheFact::ApplyF</span>
<a href="#l20.22"></a><span id="l20.22">       {</span>
<a href="#l20.23"></a><span id="l20.23">         // don't apply any more filters</span>
<a href="#l20.24"></a><span id="l20.24">         *aApplyMore = PR_FALSE;</span>
<a href="#l20.25"></a><span id="l20.25">       }</span>
<a href="#l20.26"></a><span id="l20.26">       break;</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28">       case nsMsgFilterAction::Custom:</span>
<a href="#l20.29"></a><span id="l20.29">       {</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineplus">+        nsMsgFilterTypeType filterType;</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+        m_curFilter-&gt;GetFilterType(&amp;filterType);</span>
<a href="#l20.32"></a><span id="l20.32">         nsCOMPtr&lt;nsIMsgFilterCustomAction&gt; customAction;</span>
<a href="#l20.33"></a><span id="l20.33">         rv = filterAction-&gt;GetCustomAction(getter_AddRefs(customAction));</span>
<a href="#l20.34"></a><span id="l20.34">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.35"></a><span id="l20.35"> </span>
<a href="#l20.36"></a><span id="l20.36">         nsCAutoString value;</span>
<a href="#l20.37"></a><span id="l20.37">         filterAction-&gt;GetStrValue(value);</span>
<a href="#l20.38"></a><span id="l20.38">         customAction-&gt;Apply(m_searchHitHdrs, value, this,</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-                            nsMsgFilterType::Manual, m_msgWindow);</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+                            filterType, m_msgWindow);</span>
<a href="#l20.41"></a><span id="l20.41"> </span>
<a href="#l20.42"></a><span id="l20.42">         PRBool isAsync = PR_FALSE;</span>
<a href="#l20.43"></a><span id="l20.43">         customAction-&gt;GetIsAsync(&amp;isAsync);</span>
<a href="#l20.44"></a><span id="l20.44">         if (isAsync)</span>
<a href="#l20.45"></a><span id="l20.45">           return NS_OK;</span>
<a href="#l20.46"></a><span id="l20.46">       }</span>
<a href="#l20.47"></a><span id="l20.47">       break;</span>
<a href="#l20.48"></a><span id="l20.48"> </span>
<a href="#l20.49"></a><span id="l20.49" class="difflineat">@@ -830,16 +833,48 @@ nsMsgFilterService::GetCustomAction(cons</span>
<a href="#l20.50"></a><span id="l20.50">       NS_ADDREF(*aResult = mCustomActions[i]);</span>
<a href="#l20.51"></a><span id="l20.51">       return NS_OK;</span>
<a href="#l20.52"></a><span id="l20.52">     }</span>
<a href="#l20.53"></a><span id="l20.53">   }</span>
<a href="#l20.54"></a><span id="l20.54">   aResult = nsnull;</span>
<a href="#l20.55"></a><span id="l20.55">   return NS_ERROR_FAILURE;</span>
<a href="#l20.56"></a><span id="l20.56"> }</span>
<a href="#l20.57"></a><span id="l20.57"> </span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+NS_IMETHODIMP nsMsgFilterService::AddCustomTerm(nsIMsgSearchCustomTerm *aTerm)</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineplus">+{</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineplus">+  mCustomTerms.AppendObject(aTerm);</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+  return NS_OK;</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+}</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineplus">+</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineplus">+NS_IMETHODIMP nsMsgFilterService::GetCustomTerms(nsISimpleEnumerator** aResult)</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+{</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineplus">+  return NS_NewArrayEnumerator(aResult, mCustomTerms);</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineplus">+}</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineplus">+</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+NS_IMETHODIMP </span>
<a href="#l20.71"></a><span id="l20.71" class="difflineplus">+nsMsgFilterService::GetCustomTerm(const nsACString&amp; aId,</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineplus">+                                    nsIMsgSearchCustomTerm** aResult)</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineplus">+{</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineplus">+  for (PRInt32 i = 0; i &lt; mCustomTerms.Count(); i++)</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineplus">+  {</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineplus">+    nsCAutoString id;</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineplus">+    nsresult rv = mCustomTerms[i]-&gt;GetId(id);</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; aId.Equals(id))</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineplus">+    {</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineplus">+      NS_ADDREF(*aResult = mCustomTerms[i]);</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineplus">+      return NS_OK;</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineplus">+    }</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineplus">+  }</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineplus">+  aResult = nsnull;</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineplus">+  // we use a null result to indicate failure to find a term</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineplus">+  return NS_OK;</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineplus">+}</span>
<a href="#l20.89"></a><span id="l20.89" class="difflineplus">+</span>
<a href="#l20.90"></a><span id="l20.90"> // nsMsgApplyFiltersToMessages overrides nsMsgFilterAfterTheFact in order to</span>
<a href="#l20.91"></a><span id="l20.91"> // apply filters to a list of messages, rather than an entire folder</span>
<a href="#l20.92"></a><span id="l20.92"> class nsMsgApplyFiltersToMessages : public nsMsgFilterAfterTheFact</span>
<a href="#l20.93"></a><span id="l20.93"> {</span>
<a href="#l20.94"></a><span id="l20.94"> public:</span>
<a href="#l20.95"></a><span id="l20.95">   nsMsgApplyFiltersToMessages(nsIMsgWindow *aMsgWindow, nsIMsgFilterList *aFilterList, nsISupportsArray *aFolderList, nsIArray *aMsgHdrList, nsMsgFilterTypeType aFilterType);</span>
<a href="#l20.96"></a><span id="l20.96"> </span>
<a href="#l20.97"></a><span id="l20.97"> protected:</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineat">@@ -943,22 +978,18 @@ nsresult nsMsgApplyFiltersToMessages::Ru</span>
<a href="#l20.99"></a><span id="l20.99">   return AdvanceToNextFolder();</span>
<a href="#l20.100"></a><span id="l20.100"> }</span>
<a href="#l20.101"></a><span id="l20.101"> </span>
<a href="#l20.102"></a><span id="l20.102"> NS_IMETHODIMP nsMsgFilterService::ApplyFilters(nsMsgFilterTypeType aFilterType,</span>
<a href="#l20.103"></a><span id="l20.103">                                                nsIArray *aMsgHdrList,</span>
<a href="#l20.104"></a><span id="l20.104">                                                nsIMsgFolder *aFolder,</span>
<a href="#l20.105"></a><span id="l20.105">                                                nsIMsgWindow *aMsgWindow)</span>
<a href="#l20.106"></a><span id="l20.106"> {</span>
<a href="#l20.107"></a><span id="l20.107" class="difflineminus">-  nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l20.108"></a><span id="l20.108" class="difflineminus">-  nsresult rv = aFolder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l20.109"></a><span id="l20.109" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.110"></a><span id="l20.110" class="difflineminus">-</span>
<a href="#l20.111"></a><span id="l20.111">   nsCOMPtr&lt;nsIMsgFilterList&gt;    filterList;</span>
<a href="#l20.112"></a><span id="l20.112" class="difflineminus">-  rv = server-&gt;GetFilterList( aMsgWindow, getter_AddRefs(filterList) );</span>
<a href="#l20.113"></a><span id="l20.113" class="difflineplus">+  nsresult rv = aFolder-&gt;GetFilterList(aMsgWindow, getter_AddRefs(filterList));</span>
<a href="#l20.114"></a><span id="l20.114">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.115"></a><span id="l20.115"> </span>
<a href="#l20.116"></a><span id="l20.116">   nsCOMPtr&lt;nsISupportsArray&gt;    folderList;</span>
<a href="#l20.117"></a><span id="l20.117">   rv = NS_NewISupportsArray( getter_AddRefs(folderList) );</span>
<a href="#l20.118"></a><span id="l20.118">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.119"></a><span id="l20.119">   folderList-&gt;AppendElement(aFolder);</span>
<a href="#l20.120"></a><span id="l20.120"> </span>
<a href="#l20.121"></a><span id="l20.121">   // Create our nsMsgApplyFiltersToMessages object which will be called when ApplyFiltersToHdr</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.h</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.h</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -64,13 +64,14 @@ public:</span>
<a href="#l21.4"></a><span id="l21.4">   nsresult BackUpFilterFile(nsILocalFile *aFilterFile, nsIMsgWindow *aMsgWindow);</span>
<a href="#l21.5"></a><span id="l21.5">   nsresult AlertBackingUpFilterFile(nsIMsgWindow *aMsgWindow);</span>
<a href="#l21.6"></a><span id="l21.6">   nsresult ThrowAlertMsg(const char*aMsgName, nsIMsgWindow *aMsgWindow);</span>
<a href="#l21.7"></a><span id="l21.7">   nsresult GetStringFromBundle(const char *aMsgName, PRUnichar **aResult);</span>
<a href="#l21.8"></a><span id="l21.8">   nsresult GetFilterStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10"> protected:</span>
<a href="#l21.11"></a><span id="l21.11">   nsCOMArray&lt;nsIMsgFilterCustomAction&gt; mCustomActions; // defined custom action list</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+  nsCOMArray&lt;nsIMsgSearchCustomTerm&gt; mCustomTerms; // defined custom term list</span>
<a href="#l21.13"></a><span id="l21.13"> </span>
<a href="#l21.14"></a><span id="l21.14"> };</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16"> #endif  // _nsMsgFilterService_H_</span>
<a href="#l21.17"></a><span id="l21.17"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -636,18 +636,22 @@ nsresult nsMsgSearchOfflineMail::Process</span>
<a href="#l22.4"></a><span id="l22.4">       }</span>
<a href="#l22.5"></a><span id="l22.5">       case nsMsgSearchAttrib::JunkScoreOrigin:</span>
<a href="#l22.6"></a><span id="l22.6">       {</span>
<a href="#l22.7"></a><span id="l22.7">          nsCString junkScoreOriginStr;</span>
<a href="#l22.8"></a><span id="l22.8">          msgToMatch-&gt;GetStringProperty(&quot;junkscoreorigin&quot;, getter_Copies(junkScoreOriginStr));</span>
<a href="#l22.9"></a><span id="l22.9">          err = aTerm-&gt;MatchJunkScoreOrigin(junkScoreOriginStr.get(), &amp;result);</span>
<a href="#l22.10"></a><span id="l22.10">          break;</span>
<a href="#l22.11"></a><span id="l22.11">       }</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+      case nsMsgSearchAttrib::Custom:</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+      {</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+        err = aTerm-&gt;MatchCustom(msgToMatch, &amp;result);</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+        break;</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+      }</span>
<a href="#l22.17"></a><span id="l22.17"> </span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-      </span>
<a href="#l22.19"></a><span id="l22.19">       default:</span>
<a href="#l22.20"></a><span id="l22.20">           // XXX todo</span>
<a href="#l22.21"></a><span id="l22.21">           // for the temporary return receipts filters, we use a custom header for Content-Type</span>
<a href="#l22.22"></a><span id="l22.22">           // but unlike the other custom headers, this one doesn't show up in the search / filter</span>
<a href="#l22.23"></a><span id="l22.23">           // UI.  we set the attrib to be nsMsgSearchAttrib::OtherHeader, where as for user</span>
<a href="#l22.24"></a><span id="l22.24">           // defined custom headers start at nsMsgSearchAttrib::OtherHeader + 1</span>
<a href="#l22.25"></a><span id="l22.25">           // Not sure if there is a better way to do this yet.  Maybe reserve the last</span>
<a href="#l22.26"></a><span id="l22.26">           // custom header for ::Content-Type?  But if we do, make sure that change</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -72,32 +72,32 @@ nsMsgSearchSession::~nsMsgSearchSession(</span>
<a href="#l23.4"></a><span id="l23.4"> {</span>
<a href="#l23.5"></a><span id="l23.5">   InterruptSearch();</span>
<a href="#l23.6"></a><span id="l23.6">   delete m_expressionTree;</span>
<a href="#l23.7"></a><span id="l23.7">   DestroyResultList ();</span>
<a href="#l23.8"></a><span id="l23.8">   DestroyScopeList ();</span>
<a href="#l23.9"></a><span id="l23.9">   DestroyTermList ();</span>
<a href="#l23.10"></a><span id="l23.10"> }</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-/* [noscript] void AddSearchTerm (in nsMsgSearchAttribute attrib, in nsMsgSearchOperator op, in nsMsgSearchValue value, in boolean BooleanAND, in string arbitraryHeader); */</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+/* [noscript] void AddSearchTerm (in nsMsgSearchAttribute attrib, in nsMsgSearchOperator op, in nsMsgSearchValue value, in boolean BooleanAND, in string customString); */</span>
<a href="#l23.14"></a><span id="l23.14"> NS_IMETHODIMP</span>
<a href="#l23.15"></a><span id="l23.15"> nsMsgSearchSession::AddSearchTerm(nsMsgSearchAttribValue attrib,</span>
<a href="#l23.16"></a><span id="l23.16">                                   nsMsgSearchOpValue op,</span>
<a href="#l23.17"></a><span id="l23.17">                                   nsIMsgSearchValue * value,</span>
<a href="#l23.18"></a><span id="l23.18">                                   PRBool BooleanANDp,</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineminus">-                                  const char *arbitraryHeader)</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineplus">+                                  const char *customString)</span>
<a href="#l23.21"></a><span id="l23.21"> {</span>
<a href="#l23.22"></a><span id="l23.22">     // stupid gcc</span>
<a href="#l23.23"></a><span id="l23.23">     nsMsgSearchBooleanOperator boolOp;</span>
<a href="#l23.24"></a><span id="l23.24">     if (BooleanANDp)</span>
<a href="#l23.25"></a><span id="l23.25">         boolOp = (nsMsgSearchBooleanOperator)nsMsgSearchBooleanOp::BooleanAND;</span>
<a href="#l23.26"></a><span id="l23.26">     else</span>
<a href="#l23.27"></a><span id="l23.27">         boolOp = (nsMsgSearchBooleanOperator)nsMsgSearchBooleanOp::BooleanOR;</span>
<a href="#l23.28"></a><span id="l23.28">   nsMsgSearchTerm *pTerm = new nsMsgSearchTerm (attrib, op, value,</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineminus">-                                                  boolOp, arbitraryHeader);</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineplus">+                                                  boolOp, customString);</span>
<a href="#l23.31"></a><span id="l23.31">   if (nsnull == pTerm)</span>
<a href="#l23.32"></a><span id="l23.32">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l23.33"></a><span id="l23.33">   m_termList-&gt;AppendElement (pTerm);</span>
<a href="#l23.34"></a><span id="l23.34">         // force the expression tree to rebuild whenever we change the terms</span>
<a href="#l23.35"></a><span id="l23.35">         delete m_expressionTree;</span>
<a href="#l23.36"></a><span id="l23.36">         m_expressionTree = nsnull;</span>
<a href="#l23.37"></a><span id="l23.37">   return NS_OK;</span>
<a href="#l23.38"></a><span id="l23.38"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -18,16 +18,17 @@</span>
<a href="#l24.4"></a><span id="l24.4">  * Netscape Communications Corporation.</span>
<a href="#l24.5"></a><span id="l24.5">  * Portions created by the Initial Developer are Copyright (C) 1999</span>
<a href="#l24.6"></a><span id="l24.6">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l24.7"></a><span id="l24.7">  *</span>
<a href="#l24.8"></a><span id="l24.8">  * Contributor(s):</span>
<a href="#l24.9"></a><span id="l24.9">  *   Seth Spitzer &lt;sspitzer@netscape.com&gt;</span>
<a href="#l24.10"></a><span id="l24.10">  *   Jungshik Shin &lt;jshin@mailaps.org&gt;</span>
<a href="#l24.11"></a><span id="l24.11">  *   David Bienvenu &lt;bienvenu@nventure.com&gt;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+ *   Kent James &lt;kent@caspia.com&gt;</span>
<a href="#l24.13"></a><span id="l24.13">  *</span>
<a href="#l24.14"></a><span id="l24.14">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l24.15"></a><span id="l24.15">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l24.16"></a><span id="l24.16">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l24.17"></a><span id="l24.17">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l24.18"></a><span id="l24.18">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l24.19"></a><span id="l24.19">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l24.20"></a><span id="l24.20">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineat">@@ -70,16 +71,17 @@</span>
<a href="#l24.22"></a><span id="l24.22"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l24.23"></a><span id="l24.23"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l24.24"></a><span id="l24.24"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l24.25"></a><span id="l24.25"> #include &quot;nsMemory.h&quot;</span>
<a href="#l24.26"></a><span id="l24.26"> #include &lt;ctype.h&gt;</span>
<a href="#l24.27"></a><span id="l24.27"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l24.28"></a><span id="l24.28"> #include &quot;nsIMsgTagService.h&quot;</span>
<a href="#l24.29"></a><span id="l24.29"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+#include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l24.31"></a><span id="l24.31"> </span>
<a href="#l24.32"></a><span id="l24.32"> //---------------------------------------------------------------------------</span>
<a href="#l24.33"></a><span id="l24.33"> // nsMsgSearchTerm specifies one criterion, e.g. name contains phil</span>
<a href="#l24.34"></a><span id="l24.34"> //---------------------------------------------------------------------------</span>
<a href="#l24.35"></a><span id="l24.35"> </span>
<a href="#l24.36"></a><span id="l24.36"> </span>
<a href="#l24.37"></a><span id="l24.37"> //-----------------------------------------------------------------------------</span>
<a href="#l24.38"></a><span id="l24.38"> //-------------------- Implementation of nsMsgSearchTerm -----------------------</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineat">@@ -115,39 +117,53 @@ nsMsgSearchAttribEntry SearchAttribEntry</span>
<a href="#l24.40"></a><span id="l24.40">     {nsMsgSearchAttrib::Sender,     &quot;from in ab&quot;},</span>
<a href="#l24.41"></a><span id="l24.41">     {nsMsgSearchAttrib::JunkStatus, &quot;junk status&quot;},</span>
<a href="#l24.42"></a><span id="l24.42">     {nsMsgSearchAttrib::JunkPercent, &quot;junk percent&quot;},</span>
<a href="#l24.43"></a><span id="l24.43">     {nsMsgSearchAttrib::JunkScoreOrigin, &quot;junk score origin&quot;},</span>
<a href="#l24.44"></a><span id="l24.44">     {nsMsgSearchAttrib::HasAttachmentStatus, &quot;has attachment status&quot;},</span>
<a href="#l24.45"></a><span id="l24.45"> };</span>
<a href="#l24.46"></a><span id="l24.46"> </span>
<a href="#l24.47"></a><span id="l24.47"> // Take a string which starts off with an attribute</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-// return the matching attribute. If the string is not in the table, then we can conclude that it is an arbitrary header</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-nsresult NS_MsgGetAttributeFromString(const char *string, PRInt16 *attrib)</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineplus">+// and return the matching attribute. If the string is not in the table, and it</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+// begins with a quote, then we can conclude that it is an arbitrary header.</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+// Otherwise if not in the table, it is the id for a custom search term.</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+nsresult NS_MsgGetAttributeFromString(const char *string, PRInt16 *attrib, nsACString &amp;aCustomId)</span>
<a href="#l24.54"></a><span id="l24.54"> {</span>
<a href="#l24.55"></a><span id="l24.55">   NS_ENSURE_ARG_POINTER(string);</span>
<a href="#l24.56"></a><span id="l24.56">   NS_ENSURE_ARG_POINTER(attrib);</span>
<a href="#l24.57"></a><span id="l24.57"> </span>
<a href="#l24.58"></a><span id="l24.58">   PRBool found = PR_FALSE;</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineminus">-  // custom headers have a leading quote</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+  PRBool isArbitraryHeader = PR_FALSE;</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineplus">+  // arbitrary headers have a leading quote</span>
<a href="#l24.62"></a><span id="l24.62">   if (*string != '&quot;')</span>
<a href="#l24.63"></a><span id="l24.63">   {</span>
<a href="#l24.64"></a><span id="l24.64">     for (int idxAttrib = 0; idxAttrib &lt; (int)(sizeof(SearchAttribEntryTable) /</span>
<a href="#l24.65"></a><span id="l24.65">          sizeof(nsMsgSearchAttribEntry)); idxAttrib++)</span>
<a href="#l24.66"></a><span id="l24.66">     {</span>
<a href="#l24.67"></a><span id="l24.67">       if (!PL_strcasecmp(string, SearchAttribEntryTable[idxAttrib].attribName))</span>
<a href="#l24.68"></a><span id="l24.68">       {</span>
<a href="#l24.69"></a><span id="l24.69">         found = PR_TRUE;</span>
<a href="#l24.70"></a><span id="l24.70">         *attrib = SearchAttribEntryTable[idxAttrib].attrib;</span>
<a href="#l24.71"></a><span id="l24.71">         break;</span>
<a href="#l24.72"></a><span id="l24.72">       }</span>
<a href="#l24.73"></a><span id="l24.73">     }</span>
<a href="#l24.74"></a><span id="l24.74">   }</span>
<a href="#l24.75"></a><span id="l24.75">   else // remove the leading quote</span>
<a href="#l24.76"></a><span id="l24.76" class="difflineplus">+  {</span>
<a href="#l24.77"></a><span id="l24.77">     string++;</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineplus">+    isArbitraryHeader = PR_TRUE;</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineplus">+  }</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineplus">+</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineplus">+  if (!found &amp;&amp; !isArbitraryHeader)</span>
<a href="#l24.82"></a><span id="l24.82" class="difflineplus">+  {</span>
<a href="#l24.83"></a><span id="l24.83" class="difflineplus">+    // must be a custom attribute</span>
<a href="#l24.84"></a><span id="l24.84" class="difflineplus">+    *attrib = nsMsgSearchAttrib::Custom;</span>
<a href="#l24.85"></a><span id="l24.85" class="difflineplus">+    aCustomId.Assign(string);</span>
<a href="#l24.86"></a><span id="l24.86" class="difflineplus">+    return NS_OK;</span>
<a href="#l24.87"></a><span id="l24.87" class="difflineplus">+  }</span>
<a href="#l24.88"></a><span id="l24.88"> </span>
<a href="#l24.89"></a><span id="l24.89">   if (!found)</span>
<a href="#l24.90"></a><span id="l24.90">   {</span>
<a href="#l24.91"></a><span id="l24.91">     nsresult rv;</span>
<a href="#l24.92"></a><span id="l24.92">     PRBool goodHdr;</span>
<a href="#l24.93"></a><span id="l24.93">     IsRFC822HeaderFieldName(string, &amp;goodHdr);</span>
<a href="#l24.94"></a><span id="l24.94">     if (!goodHdr)</span>
<a href="#l24.95"></a><span id="l24.95">       return NS_MSG_INVALID_CUSTOM_HEADER;</span>
<a href="#l24.96"></a><span id="l24.96" class="difflineat">@@ -238,17 +254,19 @@ nsMsgSearchOperatorEntry SearchOperatorE</span>
<a href="#l24.97"></a><span id="l24.97">   {nsMsgSearchOp::IsAfter, &quot;is after&quot;},</span>
<a href="#l24.98"></a><span id="l24.98">   {nsMsgSearchOp::IsHigherThan, &quot;is higher than&quot;},</span>
<a href="#l24.99"></a><span id="l24.99">   {nsMsgSearchOp::IsLowerThan, &quot;is lower than&quot;},</span>
<a href="#l24.100"></a><span id="l24.100">   {nsMsgSearchOp::BeginsWith, &quot;begins with&quot;},</span>
<a href="#l24.101"></a><span id="l24.101">   {nsMsgSearchOp::EndsWith, &quot;ends with&quot;},</span>
<a href="#l24.102"></a><span id="l24.102">   {nsMsgSearchOp::IsInAB, &quot;is in ab&quot;},</span>
<a href="#l24.103"></a><span id="l24.103">   {nsMsgSearchOp::IsntInAB, &quot;isn't in ab&quot;},</span>
<a href="#l24.104"></a><span id="l24.104">   {nsMsgSearchOp::IsGreaterThan, &quot;is greater than&quot;},</span>
<a href="#l24.105"></a><span id="l24.105" class="difflineminus">-  {nsMsgSearchOp::IsLessThan, &quot;is less than&quot;}</span>
<a href="#l24.106"></a><span id="l24.106" class="difflineplus">+  {nsMsgSearchOp::IsLessThan, &quot;is less than&quot;},</span>
<a href="#l24.107"></a><span id="l24.107" class="difflineplus">+  {nsMsgSearchOp::Matches, &quot;matches&quot;},</span>
<a href="#l24.108"></a><span id="l24.108" class="difflineplus">+  {nsMsgSearchOp::DoesntMatch, &quot;doesn't match&quot;}</span>
<a href="#l24.109"></a><span id="l24.109"> };</span>
<a href="#l24.110"></a><span id="l24.110"> </span>
<a href="#l24.111"></a><span id="l24.111"> nsresult NS_MsgGetOperatorFromString(const char *string, PRInt16 *op)</span>
<a href="#l24.112"></a><span id="l24.112"> {</span>
<a href="#l24.113"></a><span id="l24.113">   NS_ENSURE_ARG_POINTER(string);</span>
<a href="#l24.114"></a><span id="l24.114">   NS_ENSURE_ARG_POINTER(op);</span>
<a href="#l24.115"></a><span id="l24.115"> </span>
<a href="#l24.116"></a><span id="l24.116">   PRBool found = PR_FALSE;</span>
<a href="#l24.117"></a><span id="l24.117" class="difflineat">@@ -368,26 +386,31 @@ nsMsgSearchTerm::nsMsgSearchTerm()</span>
<a href="#l24.118"></a><span id="l24.118">     m_matchAll = PR_FALSE;</span>
<a href="#l24.119"></a><span id="l24.119"> }</span>
<a href="#l24.120"></a><span id="l24.120"> </span>
<a href="#l24.121"></a><span id="l24.121"> nsMsgSearchTerm::nsMsgSearchTerm (</span>
<a href="#l24.122"></a><span id="l24.122">                                   nsMsgSearchAttribValue attrib,</span>
<a href="#l24.123"></a><span id="l24.123">                                   nsMsgSearchOpValue op,</span>
<a href="#l24.124"></a><span id="l24.124">                                   nsIMsgSearchValue *val,</span>
<a href="#l24.125"></a><span id="l24.125">                                   nsMsgSearchBooleanOperator boolOp,</span>
<a href="#l24.126"></a><span id="l24.126" class="difflineminus">-                                  const char * arbitraryHeader)</span>
<a href="#l24.127"></a><span id="l24.127" class="difflineplus">+                                  const char * aCustomString)</span>
<a href="#l24.128"></a><span id="l24.128"> {</span>
<a href="#l24.129"></a><span id="l24.129">   m_operator = op;</span>
<a href="#l24.130"></a><span id="l24.130">   m_attribute = attrib;</span>
<a href="#l24.131"></a><span id="l24.131">   m_booleanOp = boolOp;</span>
<a href="#l24.132"></a><span id="l24.132" class="difflineminus">-  if (attrib &gt; nsMsgSearchAttrib::OtherHeader  &amp;&amp; attrib &lt; nsMsgSearchAttrib::kNumMsgSearchAttributes &amp;&amp; arbitraryHeader)</span>
<a href="#l24.133"></a><span id="l24.133" class="difflineplus">+  if (attrib &gt; nsMsgSearchAttrib::OtherHeader  &amp;&amp; attrib &lt; nsMsgSearchAttrib::kNumMsgSearchAttributes &amp;&amp; aCustomString)</span>
<a href="#l24.134"></a><span id="l24.134">   {</span>
<a href="#l24.135"></a><span id="l24.135" class="difflineminus">-    m_arbitraryHeader = arbitraryHeader;</span>
<a href="#l24.136"></a><span id="l24.136" class="difflineplus">+    m_arbitraryHeader = aCustomString;</span>
<a href="#l24.137"></a><span id="l24.137">     ToLowerCaseExceptSpecials(m_arbitraryHeader);</span>
<a href="#l24.138"></a><span id="l24.138">   }</span>
<a href="#l24.139"></a><span id="l24.139" class="difflineplus">+  else if (attrib == nsMsgSearchAttrib::Custom)</span>
<a href="#l24.140"></a><span id="l24.140" class="difflineplus">+  {</span>
<a href="#l24.141"></a><span id="l24.141" class="difflineplus">+    m_customId = aCustomString;</span>
<a href="#l24.142"></a><span id="l24.142" class="difflineplus">+  }</span>
<a href="#l24.143"></a><span id="l24.143" class="difflineplus">+</span>
<a href="#l24.144"></a><span id="l24.144">   nsMsgResultElement::AssignValues (val, &amp;m_value);</span>
<a href="#l24.145"></a><span id="l24.145">   m_matchAll = PR_FALSE;</span>
<a href="#l24.146"></a><span id="l24.146"> }</span>
<a href="#l24.147"></a><span id="l24.147"> </span>
<a href="#l24.148"></a><span id="l24.148"> </span>
<a href="#l24.149"></a><span id="l24.149"> </span>
<a href="#l24.150"></a><span id="l24.150"> nsMsgSearchTerm::~nsMsgSearchTerm ()</span>
<a href="#l24.151"></a><span id="l24.151"> {</span>
<a href="#l24.152"></a><span id="l24.152" class="difflineat">@@ -534,16 +557,23 @@ NS_IMETHODIMP nsMsgSearchTerm::GetTermAs</span>
<a href="#l24.153"></a><span id="l24.153">   }</span>
<a href="#l24.154"></a><span id="l24.154"> </span>
<a href="#l24.155"></a><span id="l24.155">   if (m_attribute &gt; nsMsgSearchAttrib::OtherHeader &amp;&amp; m_attribute &lt; nsMsgSearchAttrib::kNumMsgSearchAttributes)  // if arbitrary header, use it instead!</span>
<a href="#l24.156"></a><span id="l24.156">   {</span>
<a href="#l24.157"></a><span id="l24.157">     outputStr = &quot;\&quot;&quot;;</span>
<a href="#l24.158"></a><span id="l24.158">     outputStr += m_arbitraryHeader;</span>
<a href="#l24.159"></a><span id="l24.159">     outputStr += &quot;\&quot;&quot;;</span>
<a href="#l24.160"></a><span id="l24.160">   }</span>
<a href="#l24.161"></a><span id="l24.161" class="difflineplus">+</span>
<a href="#l24.162"></a><span id="l24.162" class="difflineplus">+  else if (m_attribute == nsMsgSearchAttrib::Custom)</span>
<a href="#l24.163"></a><span id="l24.163" class="difflineplus">+  {</span>
<a href="#l24.164"></a><span id="l24.164" class="difflineplus">+    // use the custom id as the string</span>
<a href="#l24.165"></a><span id="l24.165" class="difflineplus">+    outputStr = m_customId;</span>
<a href="#l24.166"></a><span id="l24.166" class="difflineplus">+  }</span>
<a href="#l24.167"></a><span id="l24.167" class="difflineplus">+</span>
<a href="#l24.168"></a><span id="l24.168">   else {</span>
<a href="#l24.169"></a><span id="l24.169">     const char *attrib;</span>
<a href="#l24.170"></a><span id="l24.170">     ret = NS_MsgGetStringForAttribute(m_attribute, &amp;attrib);</span>
<a href="#l24.171"></a><span id="l24.171">     if (ret != NS_OK)</span>
<a href="#l24.172"></a><span id="l24.172">       return ret;</span>
<a href="#l24.173"></a><span id="l24.173">     outputStr = attrib;</span>
<a href="#l24.174"></a><span id="l24.174">   }</span>
<a href="#l24.175"></a><span id="l24.175"> </span>
<a href="#l24.176"></a><span id="l24.176" class="difflineat">@@ -661,17 +691,18 @@ nsMsgSearchTerm::ParseAttribute(char *in</span>
<a href="#l24.177"></a><span id="l24.177">     // arbitrary headers are quoted. Skip first character, which will be the</span>
<a href="#l24.178"></a><span id="l24.178">     // first quote for arbitrary headers</span>
<a href="#l24.179"></a><span id="l24.179">     char *separator = strchr(inStream + 1, quoteVal ? '&quot;' : ',');</span>
<a href="#l24.180"></a><span id="l24.180"> </span>
<a href="#l24.181"></a><span id="l24.181">     if (separator)</span>
<a href="#l24.182"></a><span id="l24.182">         *separator = '\0';</span>
<a href="#l24.183"></a><span id="l24.183"> </span>
<a href="#l24.184"></a><span id="l24.184">     PRInt16 attributeVal;</span>
<a href="#l24.185"></a><span id="l24.185" class="difflineminus">-    nsresult rv = NS_MsgGetAttributeFromString(inStream, &amp;attributeVal);</span>
<a href="#l24.186"></a><span id="l24.186" class="difflineplus">+    nsCAutoString customId;</span>
<a href="#l24.187"></a><span id="l24.187" class="difflineplus">+    nsresult rv = NS_MsgGetAttributeFromString(inStream, &amp;attributeVal, m_customId);</span>
<a href="#l24.188"></a><span id="l24.188">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.189"></a><span id="l24.189"> </span>
<a href="#l24.190"></a><span id="l24.190">     *attrib = (nsMsgSearchAttribValue) attributeVal;</span>
<a href="#l24.191"></a><span id="l24.191"> </span>
<a href="#l24.192"></a><span id="l24.192">     if (*attrib &gt; nsMsgSearchAttrib::OtherHeader &amp;&amp; *attrib &lt; nsMsgSearchAttrib::kNumMsgSearchAttributes)  // if we are dealing with an arbitrary header....</span>
<a href="#l24.193"></a><span id="l24.193">     {</span>
<a href="#l24.194"></a><span id="l24.194">       m_arbitraryHeader = inStream + 1; // remove the leading quote</span>
<a href="#l24.195"></a><span id="l24.195">       ToLowerCaseExceptSpecials(m_arbitraryHeader);</span>
<a href="#l24.196"></a><span id="l24.196" class="difflineat">@@ -1599,16 +1630,50 @@ nsMsgSearchTerm::MatchPriority (nsMsgPri</span>
<a href="#l24.197"></a><span id="l24.197">     result = PR_FALSE;</span>
<a href="#l24.198"></a><span id="l24.198">     err = NS_ERROR_FAILURE;</span>
<a href="#l24.199"></a><span id="l24.199">     NS_ASSERTION(PR_FALSE, &quot;invalid match operator&quot;);</span>
<a href="#l24.200"></a><span id="l24.200">   }</span>
<a href="#l24.201"></a><span id="l24.201">   *pResult = result;</span>
<a href="#l24.202"></a><span id="l24.202">   return err;</span>
<a href="#l24.203"></a><span id="l24.203"> }</span>
<a href="#l24.204"></a><span id="l24.204"> </span>
<a href="#l24.205"></a><span id="l24.205" class="difflineplus">+// match a custom search term</span>
<a href="#l24.206"></a><span id="l24.206" class="difflineplus">+NS_IMETHODIMP nsMsgSearchTerm::MatchCustom(nsIMsgDBHdr* aHdr, PRBool *pResult)</span>
<a href="#l24.207"></a><span id="l24.207" class="difflineplus">+{</span>
<a href="#l24.208"></a><span id="l24.208" class="difflineplus">+  NS_ENSURE_ARG_POINTER(pResult);</span>
<a href="#l24.209"></a><span id="l24.209" class="difflineplus">+  nsresult rv;</span>
<a href="#l24.210"></a><span id="l24.210" class="difflineplus">+  nsCOMPtr&lt;nsIMsgFilterService&gt; filterService =</span>
<a href="#l24.211"></a><span id="l24.211" class="difflineplus">+      do_GetService(NS_MSGFILTERSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l24.212"></a><span id="l24.212" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.213"></a><span id="l24.213" class="difflineplus">+</span>
<a href="#l24.214"></a><span id="l24.214" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchCustomTerm&gt; customTerm;</span>
<a href="#l24.215"></a><span id="l24.215" class="difflineplus">+  rv = filterService-&gt;GetCustomTerm(m_customId, getter_AddRefs(customTerm));</span>
<a href="#l24.216"></a><span id="l24.216" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.217"></a><span id="l24.217" class="difflineplus">+</span>
<a href="#l24.218"></a><span id="l24.218" class="difflineplus">+  if (customTerm)</span>
<a href="#l24.219"></a><span id="l24.219" class="difflineplus">+    return customTerm-&gt;Match(aHdr, nsDependentCString(m_value.string),</span>
<a href="#l24.220"></a><span id="l24.220" class="difflineplus">+                             m_operator, pResult);</span>
<a href="#l24.221"></a><span id="l24.221" class="difflineplus">+  *pResult = PR_FALSE;     // default to no match if term is missing</span>
<a href="#l24.222"></a><span id="l24.222" class="difflineplus">+  return NS_ERROR_FAILURE; // missing custom term</span>
<a href="#l24.223"></a><span id="l24.223" class="difflineplus">+}</span>
<a href="#l24.224"></a><span id="l24.224" class="difflineplus">+</span>
<a href="#l24.225"></a><span id="l24.225" class="difflineplus">+// set the id of a custom search term</span>
<a href="#l24.226"></a><span id="l24.226" class="difflineplus">+NS_IMETHODIMP nsMsgSearchTerm::SetCustomId(const nsACString &amp;aId)</span>
<a href="#l24.227"></a><span id="l24.227" class="difflineplus">+{</span>
<a href="#l24.228"></a><span id="l24.228" class="difflineplus">+  m_customId = aId;</span>
<a href="#l24.229"></a><span id="l24.229" class="difflineplus">+  return NS_OK;</span>
<a href="#l24.230"></a><span id="l24.230" class="difflineplus">+}</span>
<a href="#l24.231"></a><span id="l24.231" class="difflineplus">+</span>
<a href="#l24.232"></a><span id="l24.232" class="difflineplus">+// get the id of a custom search term</span>
<a href="#l24.233"></a><span id="l24.233" class="difflineplus">+NS_IMETHODIMP nsMsgSearchTerm::GetCustomId(nsACString &amp;aResult)</span>
<a href="#l24.234"></a><span id="l24.234" class="difflineplus">+{</span>
<a href="#l24.235"></a><span id="l24.235" class="difflineplus">+  aResult = m_customId;</span>
<a href="#l24.236"></a><span id="l24.236" class="difflineplus">+  return NS_OK;</span>
<a href="#l24.237"></a><span id="l24.237" class="difflineplus">+}</span>
<a href="#l24.238"></a><span id="l24.238" class="difflineplus">+</span>
<a href="#l24.239"></a><span id="l24.239"> // Lazily initialize the rfc822 header parser we're going to use to do</span>
<a href="#l24.240"></a><span id="l24.240"> // header matching.</span>
<a href="#l24.241"></a><span id="l24.241"> nsresult nsMsgSearchTerm::InitHeaderAddressParser()</span>
<a href="#l24.242"></a><span id="l24.242"> {</span>
<a href="#l24.243"></a><span id="l24.243">   nsresult res = NS_OK;</span>
<a href="#l24.244"></a><span id="l24.244"> </span>
<a href="#l24.245"></a><span id="l24.245">   if (!m_headerAddressParser)</span>
<a href="#l24.246"></a><span id="l24.246">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/base/src/searchSpec.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/base/src/searchSpec.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -189,16 +189,17 @@ SearchSpec.prototype = {</span>
<a href="#l25.4"></a><span id="l25.4">     let iTerm = 0, term;</span>
<a href="#l25.5"></a><span id="l25.5">     let outTerms = aCloneTerms ? [] : aTerms;</span>
<a href="#l25.6"></a><span id="l25.6">     for (term in fixIterator(aTerms, Ci.nsIMsgSearchTerm)) {</span>
<a href="#l25.7"></a><span id="l25.7">       if (aCloneTerms) {</span>
<a href="#l25.8"></a><span id="l25.8">         let cloneTerm = this.session.createTerm();</span>
<a href="#l25.9"></a><span id="l25.9">         cloneTerm.value = term.value;</span>
<a href="#l25.10"></a><span id="l25.10">         cloneTerm.attrib = term.attrib;</span>
<a href="#l25.11"></a><span id="l25.11">         cloneTerm.arbitraryHeader = term.arbitraryHeader;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+        cloneTerm.customId = term.customId;</span>
<a href="#l25.13"></a><span id="l25.13">         cloneTerm.op = term.op;</span>
<a href="#l25.14"></a><span id="l25.14">         cloneTerm.booleanAnd = term.booleanAnd;</span>
<a href="#l25.15"></a><span id="l25.15">         cloneTerm.matchAll = term.matchAll;</span>
<a href="#l25.16"></a><span id="l25.16">         term = cloneTerm;</span>
<a href="#l25.17"></a><span id="l25.17">         outTerms.push(term);</span>
<a href="#l25.18"></a><span id="l25.18">       }</span>
<a href="#l25.19"></a><span id="l25.19">       if (iTerm == 0) {</span>
<a href="#l25.20"></a><span id="l25.20">         term.beginsGrouping = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">new file mode 100644</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- /dev/null</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchCustomTerm.js</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -0,0 +1,141 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l26.6"></a><span id="l26.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l26.7"></a><span id="l26.7" class="difflineplus">+ *</span>
<a href="#l26.8"></a><span id="l26.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+ *</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+ * License.</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+ *</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+ * The Original Code is mozilla.org code.</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+ *</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineplus">+ * Kent James &lt;kent@caspia.com&gt;.</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineplus">+ *</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineplus">+ *</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineplus">+ *</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineplus">+</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineplus">+/*</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+ * Testing of custom search features.</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+ *</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+ */</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineplus">+load(&quot;../../mailnews/resources/searchTestUtils.js&quot;);</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineplus">+</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineplus">+const copyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineplus">+                      .getService(Ci.nsIMsgCopyService);</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineplus">+</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineplus">+const kCustomId = &quot;xpcomtest@mozilla.org#test&quot;;</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+var gHdr;</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineplus">+</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineplus">+var Tests =</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineplus">+[</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineplus">+  { setValue: &quot;iamgood&quot;,</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineplus">+    testValue: &quot;iamnotgood&quot;,</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineplus">+    op: Ci.nsMsgSearchOp.Is,</span>
<a href="#l26.58"></a><span id="l26.58" class="difflineplus">+    count: 0 },</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineplus">+  { setValue: &quot;iamgood&quot;,</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineplus">+    testValue: &quot;iamgood&quot;,</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineplus">+    op: Ci.nsMsgSearchOp.Is,</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+    count: 1 }</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineplus">+]</span>
<a href="#l26.64"></a><span id="l26.64" class="difflineplus">+</span>
<a href="#l26.65"></a><span id="l26.65" class="difflineplus">+// nsIMsgSearchCustomTerm object</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineplus">+customTerm =</span>
<a href="#l26.67"></a><span id="l26.67" class="difflineplus">+{</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineplus">+  id: kCustomId,</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineplus">+  name: &quot;term name&quot;,</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+  getEnabled: function(scope, op)</span>
<a href="#l26.71"></a><span id="l26.71" class="difflineplus">+    {</span>
<a href="#l26.72"></a><span id="l26.72" class="difflineplus">+      return scope == Ci.nsMsgSearchScope.offlineMail &amp;&amp;</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineplus">+             op == Ci.nsMsgSearchOp::Is</span>
<a href="#l26.74"></a><span id="l26.74" class="difflineplus">+    },</span>
<a href="#l26.75"></a><span id="l26.75" class="difflineplus">+  getAvailable: function(scope, op)</span>
<a href="#l26.76"></a><span id="l26.76" class="difflineplus">+    {</span>
<a href="#l26.77"></a><span id="l26.77" class="difflineplus">+      return scope == Ci.nsMsgSearchScope.offlineMail &amp;&amp;</span>
<a href="#l26.78"></a><span id="l26.78" class="difflineplus">+             op == Ci.nsMsgSearchOp::Is</span>
<a href="#l26.79"></a><span id="l26.79" class="difflineplus">+    },</span>
<a href="#l26.80"></a><span id="l26.80" class="difflineplus">+  getAvailableOperators: function(scope, length)</span>
<a href="#l26.81"></a><span id="l26.81" class="difflineplus">+    {</span>
<a href="#l26.82"></a><span id="l26.82" class="difflineplus">+       length.value = 1;</span>
<a href="#l26.83"></a><span id="l26.83" class="difflineplus">+       return [Ci.nsMsgSearchOp.Is];</span>
<a href="#l26.84"></a><span id="l26.84" class="difflineplus">+    },</span>
<a href="#l26.85"></a><span id="l26.85" class="difflineplus">+  match: function(msgHdr, searchValue, searchOp)</span>
<a href="#l26.86"></a><span id="l26.86" class="difflineplus">+    {</span>
<a href="#l26.87"></a><span id="l26.87" class="difflineplus">+      switch (searchOp)</span>
<a href="#l26.88"></a><span id="l26.88" class="difflineplus">+      {</span>
<a href="#l26.89"></a><span id="l26.89" class="difflineplus">+        case Ci.nsMsgSearchOp.Is:</span>
<a href="#l26.90"></a><span id="l26.90" class="difflineplus">+          if (msgHdr.getProperty(&quot;theTestProperty&quot;) == searchValue)</span>
<a href="#l26.91"></a><span id="l26.91" class="difflineplus">+            return true;</span>
<a href="#l26.92"></a><span id="l26.92" class="difflineplus">+      }</span>
<a href="#l26.93"></a><span id="l26.93" class="difflineplus">+      return false;</span>
<a href="#l26.94"></a><span id="l26.94" class="difflineplus">+    }</span>
<a href="#l26.95"></a><span id="l26.95" class="difflineplus">+};</span>
<a href="#l26.96"></a><span id="l26.96" class="difflineplus">+</span>
<a href="#l26.97"></a><span id="l26.97" class="difflineplus">+function run_test()</span>
<a href="#l26.98"></a><span id="l26.98" class="difflineplus">+{</span>
<a href="#l26.99"></a><span id="l26.99" class="difflineplus">+  loadLocalMailAccount();</span>
<a href="#l26.100"></a><span id="l26.100" class="difflineplus">+  let filterService = Cc[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l26.101"></a><span id="l26.101" class="difflineplus">+                        .getService(Ci.nsIMsgFilterService);</span>
<a href="#l26.102"></a><span id="l26.102" class="difflineplus">+  filterService.addCustomTerm(customTerm);</span>
<a href="#l26.103"></a><span id="l26.103" class="difflineplus">+</span>
<a href="#l26.104"></a><span id="l26.104" class="difflineplus">+  var copyListener = </span>
<a href="#l26.105"></a><span id="l26.105" class="difflineplus">+  {</span>
<a href="#l26.106"></a><span id="l26.106" class="difflineplus">+    OnStartCopy: function() {},</span>
<a href="#l26.107"></a><span id="l26.107" class="difflineplus">+    OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l26.108"></a><span id="l26.108" class="difflineplus">+    SetMessageKey: function(aKey) { gHdr = gLocalInboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l26.109"></a><span id="l26.109" class="difflineplus">+    SetMessageId: function(aMessageId) {},</span>
<a href="#l26.110"></a><span id="l26.110" class="difflineplus">+    OnStopCopy: function(aStatus) { doTest();}</span>
<a href="#l26.111"></a><span id="l26.111" class="difflineplus">+  };</span>
<a href="#l26.112"></a><span id="l26.112" class="difflineplus">+</span>
<a href="#l26.113"></a><span id="l26.113" class="difflineplus">+  // Get a message into the local filestore.</span>
<a href="#l26.114"></a><span id="l26.114" class="difflineplus">+  // function testSearch() continues the testing after the copy.</span>
<a href="#l26.115"></a><span id="l26.115" class="difflineplus">+  let bugmail1 = do_get_file(&quot;../../mailnews/data/bugmail1&quot;);</span>
<a href="#l26.116"></a><span id="l26.116" class="difflineplus">+  do_test_pending();</span>
<a href="#l26.117"></a><span id="l26.117" class="difflineplus">+</span>
<a href="#l26.118"></a><span id="l26.118" class="difflineplus">+  copyService.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l26.119"></a><span id="l26.119" class="difflineplus">+                              &quot;&quot;, copyListener, null);</span>
<a href="#l26.120"></a><span id="l26.120" class="difflineplus">+}</span>
<a href="#l26.121"></a><span id="l26.121" class="difflineplus">+</span>
<a href="#l26.122"></a><span id="l26.122" class="difflineplus">+var testObject;</span>
<a href="#l26.123"></a><span id="l26.123" class="difflineplus">+</span>
<a href="#l26.124"></a><span id="l26.124" class="difflineplus">+function doTest()</span>
<a href="#l26.125"></a><span id="l26.125" class="difflineplus">+{</span>
<a href="#l26.126"></a><span id="l26.126" class="difflineplus">+  let test = Tests.shift();</span>
<a href="#l26.127"></a><span id="l26.127" class="difflineplus">+  if (test)</span>
<a href="#l26.128"></a><span id="l26.128" class="difflineplus">+  {</span>
<a href="#l26.129"></a><span id="l26.129" class="difflineplus">+    gHdr.setStringProperty(&quot;theTestProperty&quot;, test.setValue);</span>
<a href="#l26.130"></a><span id="l26.130" class="difflineplus">+    testObject = new TestSearch(gLocalInboxFolder,</span>
<a href="#l26.131"></a><span id="l26.131" class="difflineplus">+                         test.testValue,</span>
<a href="#l26.132"></a><span id="l26.132" class="difflineplus">+                         Ci.nsMsgSearchAttrib.Custom,</span>
<a href="#l26.133"></a><span id="l26.133" class="difflineplus">+                         test.op,</span>
<a href="#l26.134"></a><span id="l26.134" class="difflineplus">+                         test.count,</span>
<a href="#l26.135"></a><span id="l26.135" class="difflineplus">+                         doTest,</span>
<a href="#l26.136"></a><span id="l26.136" class="difflineplus">+                         kCustomId);</span>
<a href="#l26.137"></a><span id="l26.137" class="difflineplus">+  }</span>
<a href="#l26.138"></a><span id="l26.138" class="difflineplus">+  else</span>
<a href="#l26.139"></a><span id="l26.139" class="difflineplus">+  {</span>
<a href="#l26.140"></a><span id="l26.140" class="difflineplus">+    testObject = null;</span>
<a href="#l26.141"></a><span id="l26.141" class="difflineplus">+    gHdr = null;</span>
<a href="#l26.142"></a><span id="l26.142" class="difflineplus">+    do_test_finished();</span>
<a href="#l26.143"></a><span id="l26.143" class="difflineplus">+  }</span>
<a href="#l26.144"></a><span id="l26.144" class="difflineplus">+}</span>
<a href="#l26.145"></a><span id="l26.145" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/test/resources/searchTestUtils.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/test/resources/searchTestUtils.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -45,20 +45,21 @@</span>
<a href="#l27.4"></a><span id="l27.4">  *                   defaults to string, but for certain attributes other</span>
<a href="#l27.5"></a><span id="l27.5">  *                   types are used.</span>
<a href="#l27.6"></a><span id="l27.6">  *                   WARNING: not all attributes have been tested.</span>
<a href="#l27.7"></a><span id="l27.7">  *</span>
<a href="#l27.8"></a><span id="l27.8">  * @param aAttrib:   attribute for the search (Ci.nsMsgSearchAttrib.Size, etc.)</span>
<a href="#l27.9"></a><span id="l27.9">  * @param aOp:       operation for the search (Ci.nsMsgSearchOp.Contains, etc.)</span>
<a href="#l27.10"></a><span id="l27.10">  * @param aHitCount: expected number of search hits</span>
<a href="#l27.11"></a><span id="l27.11">  * @param onDone:    function to call on completion of search</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+ * @param aCustomId: id string for the custom action, if aAttrib is Custom</span>
<a href="#l27.13"></a><span id="l27.13">  *</span>
<a href="#l27.14"></a><span id="l27.14">  */</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16" class="difflineminus">-function TestSearch(aFolder, aValue, aAttrib, aOp, aHitCount, onDone)</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineplus">+function TestSearch(aFolder, aValue, aAttrib, aOp, aHitCount, onDone, aCustomId)</span>
<a href="#l27.18"></a><span id="l27.18"> {</span>
<a href="#l27.19"></a><span id="l27.19">   var searchListener =</span>
<a href="#l27.20"></a><span id="l27.20">   { </span>
<a href="#l27.21"></a><span id="l27.21">     onSearchHit: function(dbHdr, folder) { hitCount++; },</span>
<a href="#l27.22"></a><span id="l27.22">     onSearchDone: function(status)</span>
<a href="#l27.23"></a><span id="l27.23">     { </span>
<a href="#l27.24"></a><span id="l27.24">       print(&quot;Finished search does &quot; + aHitCount + &quot; equal &quot; + hitCount + &quot;?&quot;);</span>
<a href="#l27.25"></a><span id="l27.25">       searchSession = null;</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineat">@@ -103,16 +104,18 @@ function TestSearch(aFolder, aValue, aAt</span>
<a href="#l27.27"></a><span id="l27.27">     value.junkStatus = aValue;</span>
<a href="#l27.28"></a><span id="l27.28">   else if (aAttrib == Ci.nsMsgSearchAttrib.HasAttachmentStatus)</span>
<a href="#l27.29"></a><span id="l27.29">     value.status = Ci.nsMsgMessageFlags.Attachment;</span>
<a href="#l27.30"></a><span id="l27.30">   else</span>
<a href="#l27.31"></a><span id="l27.31">     value.str = aValue;</span>
<a href="#l27.32"></a><span id="l27.32">   searchTerm.value = value;</span>
<a href="#l27.33"></a><span id="l27.33">   searchTerm.op = aOp;</span>
<a href="#l27.34"></a><span id="l27.34">   searchTerm.booleanAnd = false;</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+  if (aAttrib == Ci.nsMsgSearchAttrib.Custom)</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineplus">+    searchTerm.customId = aCustomId;</span>
<a href="#l27.37"></a><span id="l27.37">   searchSession.appendTerm(searchTerm);</span>
<a href="#l27.38"></a><span id="l27.38">   searchSession.registerListener(searchListener);</span>
<a href="#l27.39"></a><span id="l27.39">   searchSession.search(null);</span>
<a href="#l27.40"></a><span id="l27.40"> }</span>
<a href="#l27.41"></a><span id="l27.41"> </span>
<a href="#l27.42"></a><span id="l27.42"> /*</span>
<a href="#l27.43"></a><span id="l27.43">  * Test search validity table Available and Enabled settings</span>
<a href="#l27.44"></a><span id="l27.44">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/filter.properties</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/filter.properties</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -11,16 +11,18 @@ customHeaderOverflow=You've exceeded the</span>
<a href="#l28.4"></a><span id="l28.4"> filterCustomHeaderOverflow=Your filters have exceeded the limit of 50 custom headers. Please edit the msgFilterRules.dat file, which contains your filters, to use fewer custom headers.</span>
<a href="#l28.5"></a><span id="l28.5"> invalidCustomHeader=One of your filters uses a custom header that contains an invalid character, such as ':', a non-printable character, a non-ascii character, or an eight-bit ascii character. Please edit the msgFilterRules.dat file, which contains your filters, to remove invalid characters from your custom headers.</span>
<a href="#l28.6"></a><span id="l28.6"> continueFilterExecution=Applying filter %S failed. Would you like to continue applying filters?</span>
<a href="#l28.7"></a><span id="l28.7"> promptTitle=Running Filters</span>
<a href="#l28.8"></a><span id="l28.8"> promptMsg=You are currently in the process of filtering messages.\nWould you like to continue applying filters?</span>
<a href="#l28.9"></a><span id="l28.9"> stopButtonLabel=Stop</span>
<a href="#l28.10"></a><span id="l28.10"> continueButtonLabel=Continue</span>
<a href="#l28.11"></a><span id="l28.11"> cannotEnableFilter=This filter was probably created by a future version of this software. You cannot enable this filter because we don't know how to apply it.</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+searchTermsInvalidTitle=Search Terms Invalid</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+searchTermsInvalidMessage=This filter cannot be saved because some search terms are invalid in the current context.</span>
<a href="#l28.14"></a><span id="l28.14"> </span>
<a href="#l28.15"></a><span id="l28.15"> # for junk mail logging / mail filter logging</span>
<a href="#l28.16"></a><span id="l28.16"> # LOCALIZATION NOTE(junkLogDetectStr)</span>
<a href="#l28.17"></a><span id="l28.17"> # %1$S=author, %2$S=subject, %3$S=date</span>
<a href="#l28.18"></a><span id="l28.18"> junkLogDetectStr=Detected junk message from %1$S - %2$S at %3$S</span>
<a href="#l28.19"></a><span id="l28.19"> # LOCALIZATION NOTE(logMoveStr)</span>
<a href="#l28.20"></a><span id="l28.20"> # %1$S=message id, %2$S=folder URI</span>
<a href="#l28.21"></a><span id="l28.21"> logMoveStr=moved message id = %1$S to %2$S</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/search-attributes.properties</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/search-attributes.properties</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -33,8 +33,9 @@ Department=Department</span>
<a href="#l29.4"></a><span id="l29.4"> # more mailnews</span>
<a href="#l29.5"></a><span id="l29.5"> FromToCcOrBcc=From, To, Cc or Bcc</span>
<a href="#l29.6"></a><span id="l29.6"> JunkScoreOrigin=Junk Score Origin</span>
<a href="#l29.7"></a><span id="l29.7"> JunkPercent=Junk Percent</span>
<a href="#l29.8"></a><span id="l29.8"> AttachmentStatus=Attachment Status</span>
<a href="#l29.9"></a><span id="l29.9"> JunkStatus=Junk Status</span>
<a href="#l29.10"></a><span id="l29.10"> Label=Label</span>
<a href="#l29.11"></a><span id="l29.11"> Customize=Customize…</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+MissingCustomTerm=Missing Custom Term</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/search-operators.properties</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/search-operators.properties</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -18,8 +18,10 @@ 12=LdapDwim</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5"> 13=is greater than</span>
<a href="#l30.6"></a><span id="l30.6"> 14=is less than</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> 15=NameCompletion</span>
<a href="#l30.9"></a><span id="l30.9"> 16=is in my address book</span>
<a href="#l30.10"></a><span id="l30.10"> 17=isn't in my address book</span>
<a href="#l30.11"></a><span id="l30.11"> 18=isn't empty</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+19=matches</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+20=doesn't match</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/mailnews/commandglue.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/mailnews/commandglue.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -1110,16 +1110,17 @@ function CreateGroupedSearchTerms(search</span>
<a href="#l31.4"></a><span id="l31.4">   for (var i = 0; i &lt; numEntries; i++) {</span>
<a href="#l31.5"></a><span id="l31.5">     var searchTerm = searchTermsArray.GetElementAt(i).QueryInterface(Components.interfaces.nsIMsgSearchTerm); </span>
<a href="#l31.6"></a><span id="l31.6"> </span>
<a href="#l31.7"></a><span id="l31.7">     // clone the term, since we might be modifying it</span>
<a href="#l31.8"></a><span id="l31.8">     var searchTermForQS = searchSession.createTerm();</span>
<a href="#l31.9"></a><span id="l31.9">     searchTermForQS.value = searchTerm.value;</span>
<a href="#l31.10"></a><span id="l31.10">     searchTermForQS.attrib = searchTerm.attrib;</span>
<a href="#l31.11"></a><span id="l31.11">     searchTermForQS.arbitraryHeader = searchTerm.arbitraryHeader</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+    searchTermForQS.customId = searchTerm.customId</span>
<a href="#l31.13"></a><span id="l31.13">     searchTermForQS.op = searchTerm.op;</span>
<a href="#l31.14"></a><span id="l31.14"> </span>
<a href="#l31.15"></a><span id="l31.15">     // mark the first node as a group</span>
<a href="#l31.16"></a><span id="l31.16">     if (i == 0)</span>
<a href="#l31.17"></a><span id="l31.17">       searchTermForQS.beginsGrouping = true;</span>
<a href="#l31.18"></a><span id="l31.18">     else if (i == numEntries - 1)</span>
<a href="#l31.19"></a><span id="l31.19">       searchTermForQS.endsGrouping = true;</span>
<a href="#l31.20"></a><span id="l31.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/suite/mailnews/mailWidgets.xml</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/suite/mailnews/mailWidgets.xml</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -721,21 +721,26 @@</span>
<a href="#l32.4"></a><span id="l32.4">     &lt;content&gt;</span>
<a href="#l32.5"></a><span id="l32.5">       &lt;xul:menulist class=&quot;search-menulist&quot; xbl:inherits=&quot;flex,disabled&quot; oncommand=&quot;this.parentNode.onSelect(event)&quot;&gt;</span>
<a href="#l32.6"></a><span id="l32.6">         &lt;xul:menupopup class=&quot;search-menulist-popup&quot;/&gt;</span>
<a href="#l32.7"></a><span id="l32.7">       &lt;/xul:menulist&gt;</span>
<a href="#l32.8"></a><span id="l32.8">     &lt;/content&gt;</span>
<a href="#l32.9"></a><span id="l32.9"> </span>
<a href="#l32.10"></a><span id="l32.10">     &lt;implementation&gt;</span>
<a href="#l32.11"></a><span id="l32.11">       &lt;field name=&quot;internalScope&quot;&gt;null&lt;/field&gt;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+      &lt;field name=&quot;internalValue&quot;&gt;-1&lt;/field&gt;</span>
<a href="#l32.13"></a><span id="l32.13">       &lt;field readonly=&quot;true&quot; name=&quot;validityManager&quot;&gt;</span>
<a href="#l32.14"></a><span id="l32.14">         &lt;![CDATA[</span>
<a href="#l32.15"></a><span id="l32.15">            Components.classes['@mozilla.org/mail/search/validityManager;1'].getService(Components.interfaces.nsIMsgSearchValidityManager);</span>
<a href="#l32.16"></a><span id="l32.16">         ]]&gt;</span>
<a href="#l32.17"></a><span id="l32.17">       &lt;/field&gt;</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineplus">+      &lt;field name=&quot;filterService&quot;&gt;</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineplus">+        Components.classes[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l32.20"></a><span id="l32.20" class="difflineplus">+                  .getService(Components.interfaces.nsIMsgFilterService)</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l32.22"></a><span id="l32.22">       &lt;property name=&quot;searchScope&quot; onget=&quot;return this.internalScope;&quot;&gt;</span>
<a href="#l32.23"></a><span id="l32.23">         &lt;!-- scope ID - retrieve the table --&gt;</span>
<a href="#l32.24"></a><span id="l32.24">         &lt;setter&gt;</span>
<a href="#l32.25"></a><span id="l32.25">           &lt;![CDATA[</span>
<a href="#l32.26"></a><span id="l32.26">             // if scope isn't changing this is a noop</span>
<a href="#l32.27"></a><span id="l32.27">             if (this.internalScope == val) return val;</span>
<a href="#l32.28"></a><span id="l32.28"> </span>
<a href="#l32.29"></a><span id="l32.29">             this.internalScope = val;</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineat">@@ -757,17 +762,17 @@</span>
<a href="#l32.31"></a><span id="l32.31">         &lt;getter&gt;</span>
<a href="#l32.32"></a><span id="l32.32">           &lt;![CDATA[</span>
<a href="#l32.33"></a><span id="l32.33">             var forAttrs =  this.getAttribute(&quot;for&quot;);</span>
<a href="#l32.34"></a><span id="l32.34">             if (!forAttrs) return null;</span>
<a href="#l32.35"></a><span id="l32.35">             var targetIds = forAttrs.split(&quot;,&quot;);</span>
<a href="#l32.36"></a><span id="l32.36">             if (targetIds.length == 0) return null;</span>
<a href="#l32.37"></a><span id="l32.37"> </span>
<a href="#l32.38"></a><span id="l32.38">             var targets = new Array;</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineminus">-            var j = 0;</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineplus">+            var j=0;</span>
<a href="#l32.41"></a><span id="l32.41">             for (var i=0; i&lt;targetIds.length;i++) {</span>
<a href="#l32.42"></a><span id="l32.42">               var target = document.getElementById(targetIds[i]);</span>
<a href="#l32.43"></a><span id="l32.43">               if (target) targets[j++] = target;</span>
<a href="#l32.44"></a><span id="l32.44">             }</span>
<a href="#l32.45"></a><span id="l32.45">             return targets;</span>
<a href="#l32.46"></a><span id="l32.46">           ]]&gt;</span>
<a href="#l32.47"></a><span id="l32.47">         &lt;/getter&gt;</span>
<a href="#l32.48"></a><span id="l32.48">       &lt;/property&gt;</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineat">@@ -786,24 +791,24 @@</span>
<a href="#l32.50"></a><span id="l32.50">               var optarget = document.getElementById(optargetIds[i]);</span>
<a href="#l32.51"></a><span id="l32.51">               if (optarget) optargets[j++] = optarget;</span>
<a href="#l32.52"></a><span id="l32.52">             }</span>
<a href="#l32.53"></a><span id="l32.53">             return optargets;</span>
<a href="#l32.54"></a><span id="l32.54">           ]]&gt;</span>
<a href="#l32.55"></a><span id="l32.55">         &lt;/getter&gt;</span>
<a href="#l32.56"></a><span id="l32.56">       &lt;/property&gt;</span>
<a href="#l32.57"></a><span id="l32.57"> </span>
<a href="#l32.58"></a><span id="l32.58" class="difflineminus">-      &lt;!-- value forwards to the internal menulist's &quot;value&quot; attribute --&gt;</span>
<a href="#l32.59"></a><span id="l32.59" class="difflineminus">-      &lt;property name=&quot;value&quot; onget=&quot;return document.getAnonymousNodes(this)[0].selectedItem.getAttribute('value');&quot;&gt;</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineplus">+      &lt;property name=&quot;value&quot; onget=&quot;return this.internalValue;&quot;&gt;</span>
<a href="#l32.61"></a><span id="l32.61">         &lt;setter&gt;</span>
<a href="#l32.62"></a><span id="l32.62">           &lt;![CDATA[</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+            if (this.internalValue == val)</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineplus">+              return;</span>
<a href="#l32.65"></a><span id="l32.65" class="difflineplus">+            this.internalValue = val;</span>
<a href="#l32.66"></a><span id="l32.66">             var menulist = document.getAnonymousNodes(this)[0];</span>
<a href="#l32.67"></a><span id="l32.67" class="difflineminus">-            var dataItems = menulist.getElementsByAttribute(&quot;value&quot;, val);</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineminus">-            if (dataItems.item(0))</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineminus">-                menulist.selectedItem = dataItems[0];</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+            menulist.selectedItem = this.validMenuitem;</span>
<a href="#l32.71"></a><span id="l32.71"> </span>
<a href="#l32.72"></a><span id="l32.72">             // now notify targets of new parent's value</span>
<a href="#l32.73"></a><span id="l32.73">             var targets = this.targets;</span>
<a href="#l32.74"></a><span id="l32.74">             if (targets) {</span>
<a href="#l32.75"></a><span id="l32.75">               for (var i=0; i &lt; targets.length; i++) {</span>
<a href="#l32.76"></a><span id="l32.76">                 targets[i].parentValue = val;</span>
<a href="#l32.77"></a><span id="l32.77">               }</span>
<a href="#l32.78"></a><span id="l32.78">             }</span>
<a href="#l32.79"></a><span id="l32.79" class="difflineat">@@ -818,16 +823,43 @@</span>
<a href="#l32.80"></a><span id="l32.80"> </span>
<a href="#l32.81"></a><span id="l32.81">             return val;</span>
<a href="#l32.82"></a><span id="l32.82">           ]]&gt;</span>
<a href="#l32.83"></a><span id="l32.83">         &lt;/setter&gt;</span>
<a href="#l32.84"></a><span id="l32.84">       &lt;/property&gt;</span>
<a href="#l32.85"></a><span id="l32.85">       &lt;!-- label forwards to the internal menulist's &quot;label&quot; attribute --&gt;</span>
<a href="#l32.86"></a><span id="l32.86">       &lt;property name=&quot;label&quot; onget=&quot;return document.getAnonymousNodes(this)[0].selectedItem.getAttribute('label');&quot;&gt;</span>
<a href="#l32.87"></a><span id="l32.87">       &lt;/property&gt;</span>
<a href="#l32.88"></a><span id="l32.88" class="difflineplus">+      &lt;property name=&quot;validMenuitem&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l32.89"></a><span id="l32.89" class="difflineplus">+      &lt;!-- Prepare menulist selection, adding a missing hidden menuitem if needed, and </span>
<a href="#l32.90"></a><span id="l32.90" class="difflineplus">+        updating the disabled state of the menulist label. --&gt;</span>
<a href="#l32.91"></a><span id="l32.91" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l32.92"></a><span id="l32.92" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l32.93"></a><span id="l32.93" class="difflineplus">+            if (this.value == -1) // -1 means not initialized</span>
<a href="#l32.94"></a><span id="l32.94" class="difflineplus">+              return null;</span>
<a href="#l32.95"></a><span id="l32.95" class="difflineplus">+</span>
<a href="#l32.96"></a><span id="l32.96" class="difflineplus">+            let menulist = document.getAnonymousNodes(this)[0];</span>
<a href="#l32.97"></a><span id="l32.97" class="difflineplus">+            let isCustom = isNaN(this.value);</span>
<a href="#l32.98"></a><span id="l32.98" class="difflineplus">+            let typedValue = isCustom ? this.value : parseInt(this.value);</span>
<a href="#l32.99"></a><span id="l32.99" class="difflineplus">+</span>
<a href="#l32.100"></a><span id="l32.100" class="difflineplus">+            // custom attribute to style the unavailable menulist item</span>
<a href="#l32.101"></a><span id="l32.101" class="difflineplus">+            menulist.setAttribute(&quot;unavailable&quot;,</span>
<a href="#l32.102"></a><span id="l32.102" class="difflineplus">+              (this.valueIds.indexOf(typedValue) &lt; 0) ? &quot;true&quot; : null);</span>
<a href="#l32.103"></a><span id="l32.103" class="difflineplus">+</span>
<a href="#l32.104"></a><span id="l32.104" class="difflineplus">+            // add a hidden menulist item if value is missing</span>
<a href="#l32.105"></a><span id="l32.105" class="difflineplus">+            let menuitem = menulist.getElementsByAttribute(&quot;value&quot;, this.value).item(0);</span>
<a href="#l32.106"></a><span id="l32.106" class="difflineplus">+            if (!menuitem)</span>
<a href="#l32.107"></a><span id="l32.107" class="difflineplus">+            { // need to add a hidden menuitem</span>
<a href="#l32.108"></a><span id="l32.108" class="difflineplus">+              menuitem = menulist.appendItem(this.valueLabel, this.value);</span>
<a href="#l32.109"></a><span id="l32.109" class="difflineplus">+              menuitem.hidden = true;</span>
<a href="#l32.110"></a><span id="l32.110" class="difflineplus">+            }</span>
<a href="#l32.111"></a><span id="l32.111" class="difflineplus">+            return menuitem;</span>
<a href="#l32.112"></a><span id="l32.112" class="difflineplus">+          ]]&gt;</span>
<a href="#l32.113"></a><span id="l32.113" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l32.114"></a><span id="l32.114" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l32.115"></a><span id="l32.115">       &lt;method name=&quot;refreshList&quot;&gt;</span>
<a href="#l32.116"></a><span id="l32.116">         &lt;parameter name=&quot;dontRestore&quot;/&gt; &lt;!-- should we not restore old selection? --&gt;</span>
<a href="#l32.117"></a><span id="l32.117">         &lt;body&gt;</span>
<a href="#l32.118"></a><span id="l32.118">           &lt;![CDATA[</span>
<a href="#l32.119"></a><span id="l32.119">             var menuItemIds = this.valueIds;</span>
<a href="#l32.120"></a><span id="l32.120">             var menuItemStrings = this.valueStrings;</span>
<a href="#l32.121"></a><span id="l32.121"> </span>
<a href="#l32.122"></a><span id="l32.122">             var menulist = document.getAnonymousNodes(this)[0];</span>
<a href="#l32.123"></a><span id="l32.123" class="difflineat">@@ -864,27 +896,33 @@</span>
<a href="#l32.124"></a><span id="l32.124">             {</span>
<a href="#l32.125"></a><span id="l32.125">               var separator = document.createElement(&quot;menuseparator&quot;);</span>
<a href="#l32.126"></a><span id="l32.126">               popup.appendChild(separator);</span>
<a href="#l32.127"></a><span id="l32.127">               menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l32.128"></a><span id="l32.128">               menuitem.setAttribute(&quot;label&quot;, menuItemStrings[customizePos]);</span>
<a href="#l32.129"></a><span id="l32.129">               menuitem.setAttribute(&quot;value&quot;, menuItemIds[customizePos]);</span>
<a href="#l32.130"></a><span id="l32.130">               popup.appendChild(menuitem);</span>
<a href="#l32.131"></a><span id="l32.131">             }</span>
<a href="#l32.132"></a><span id="l32.132" class="difflineminus">-            // now restore the selection</span>
<a href="#l32.133"></a><span id="l32.133" class="difflineminus">-            menulist.selectedItem = newSelection;</span>
<a href="#l32.134"></a><span id="l32.134" class="difflineminus">-</span>
<a href="#l32.135"></a><span id="l32.135" class="difflineplus">+            //</span>
<a href="#l32.136"></a><span id="l32.136" class="difflineplus">+            // If we are either uninitialized, or if we are called because</span>
<a href="#l32.137"></a><span id="l32.137" class="difflineplus">+            // of a change in our parent, update the value to the</span>
<a href="#l32.138"></a><span id="l32.138" class="difflineplus">+            // default stored in newSelection.</span>
<a href="#l32.139"></a><span id="l32.139" class="difflineplus">+            //</span>
<a href="#l32.140"></a><span id="l32.140" class="difflineplus">+            if ((this.value == -1 || dontRestore) &amp;&amp; newSelection)</span>
<a href="#l32.141"></a><span id="l32.141" class="difflineplus">+              this.value = newSelection.value;</span>
<a href="#l32.142"></a><span id="l32.142" class="difflineplus">+            menulist.selectedItem = this.validMenuitem;</span>
<a href="#l32.143"></a><span id="l32.143">           ]]&gt;</span>
<a href="#l32.144"></a><span id="l32.144">         &lt;/body&gt;</span>
<a href="#l32.145"></a><span id="l32.145">       &lt;/method&gt;</span>
<a href="#l32.146"></a><span id="l32.146">       &lt;method name=&quot;onSelect&quot;&gt;</span>
<a href="#l32.147"></a><span id="l32.147">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l32.148"></a><span id="l32.148">         &lt;body&gt;</span>
<a href="#l32.149"></a><span id="l32.149">           &lt;![CDATA[</span>
<a href="#l32.150"></a><span id="l32.150">             var menulist = document.getAnonymousNodes(this)[0];</span>
<a href="#l32.151"></a><span id="l32.151" class="difflineplus">+            this.value = menulist.value;</span>
<a href="#l32.152"></a><span id="l32.152">             // notify targets</span>
<a href="#l32.153"></a><span id="l32.153">             var targets = this.targets;</span>
<a href="#l32.154"></a><span id="l32.154">             if (targets) {</span>
<a href="#l32.155"></a><span id="l32.155">               for (var i=0; i &lt; targets.length; i++) {</span>
<a href="#l32.156"></a><span id="l32.156">                 targets[i].parentValue = menulist.value;</span>
<a href="#l32.157"></a><span id="l32.157">               }</span>
<a href="#l32.158"></a><span id="l32.158">             }</span>
<a href="#l32.159"></a><span id="l32.159"> </span>
<a href="#l32.160"></a><span id="l32.160" class="difflineat">@@ -906,21 +944,61 @@</span>
<a href="#l32.161"></a><span id="l32.161">     &lt;implementation&gt;</span>
<a href="#l32.162"></a><span id="l32.162">       &lt;field name=&quot;stringBundle&quot;&gt;</span>
<a href="#l32.163"></a><span id="l32.163">         &lt;![CDATA[</span>
<a href="#l32.164"></a><span id="l32.164">           Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l32.165"></a><span id="l32.165">                     .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l32.166"></a><span id="l32.166">                     .createBundle(&quot;chrome://messenger/locale/search-attributes.properties&quot;)</span>
<a href="#l32.167"></a><span id="l32.167">         ]]&gt;</span>
<a href="#l32.168"></a><span id="l32.168">       &lt;/field&gt;</span>
<a href="#l32.169"></a><span id="l32.169" class="difflineplus">+      &lt;property name=&quot;valueLabel&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l32.170"></a><span id="l32.170" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l32.171"></a><span id="l32.171" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l32.172"></a><span id="l32.172" class="difflineplus">+            if (isNaN(this.value)) // is this a custom term?</span>
<a href="#l32.173"></a><span id="l32.173" class="difflineplus">+            {</span>
<a href="#l32.174"></a><span id="l32.174" class="difflineplus">+              let customTerm = this.filterService.getCustomTerm(this.value);</span>
<a href="#l32.175"></a><span id="l32.175" class="difflineplus">+              if (customTerm)</span>
<a href="#l32.176"></a><span id="l32.176" class="difflineplus">+                return customTerm.name;</span>
<a href="#l32.177"></a><span id="l32.177" class="difflineplus">+              else</span>
<a href="#l32.178"></a><span id="l32.178" class="difflineplus">+              {</span>
<a href="#l32.179"></a><span id="l32.179" class="difflineplus">+                let consoleService = Components.classes[&quot;@mozilla.org/consoleservice;1&quot;]</span>
<a href="#l32.180"></a><span id="l32.180" class="difflineplus">+                    .getService(Components.interfaces.nsIConsoleService);</span>
<a href="#l32.181"></a><span id="l32.181" class="difflineplus">+                let scriptError = Components.classes[&quot;@mozilla.org/scripterror;1&quot;]</span>
<a href="#l32.182"></a><span id="l32.182" class="difflineplus">+                    .createInstance(Components.interfaces.nsIScriptError);</span>
<a href="#l32.183"></a><span id="l32.183" class="difflineplus">+                scriptError.init(&quot;Missing custom search term &quot; + this.value,</span>
<a href="#l32.184"></a><span id="l32.184" class="difflineplus">+                    null, null, 0, 0,</span>
<a href="#l32.185"></a><span id="l32.185" class="difflineplus">+                    Components.interfaces.nsIScriptError.errorFlag,</span>
<a href="#l32.186"></a><span id="l32.186" class="difflineplus">+                    &quot;component javascript&quot;);</span>
<a href="#l32.187"></a><span id="l32.187" class="difflineplus">+                consoleService.logMessage(scriptError);</span>
<a href="#l32.188"></a><span id="l32.188" class="difflineplus">+                return this.stringBundle.GetStringFromName(&quot;MissingCustomTerm&quot;);</span>
<a href="#l32.189"></a><span id="l32.189" class="difflineplus">+              }</span>
<a href="#l32.190"></a><span id="l32.190" class="difflineplus">+            }</span>
<a href="#l32.191"></a><span id="l32.191" class="difflineplus">+            return this.stringBundle.GetStringFromName(</span>
<a href="#l32.192"></a><span id="l32.192" class="difflineplus">+              this.validityManager.getAttributeProperty(parseInt(this.value)));</span>
<a href="#l32.193"></a><span id="l32.193" class="difflineplus">+          ]]&gt;</span>
<a href="#l32.194"></a><span id="l32.194" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l32.195"></a><span id="l32.195" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l32.196"></a><span id="l32.196">       &lt;property name=&quot;valueIds&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l32.197"></a><span id="l32.197">         &lt;getter&gt;</span>
<a href="#l32.198"></a><span id="l32.198">           &lt;![CDATA[</span>
<a href="#l32.199"></a><span id="l32.199">             var length = new Object;</span>
<a href="#l32.200"></a><span id="l32.200" class="difflineminus">-            return this.validityTable.getAvailableAttributes(length);</span>
<a href="#l32.201"></a><span id="l32.201" class="difflineplus">+            let result = this.validityTable.getAvailableAttributes(length);</span>
<a href="#l32.202"></a><span id="l32.202" class="difflineplus">+            // add any available custom search terms</span>
<a href="#l32.203"></a><span id="l32.203" class="difflineplus">+            let customEnum = this.filterService.getCustomTerms();</span>
<a href="#l32.204"></a><span id="l32.204" class="difflineplus">+            while (customEnum &amp;&amp; customEnum.hasMoreElements())</span>
<a href="#l32.205"></a><span id="l32.205" class="difflineplus">+            {</span>
<a href="#l32.206"></a><span id="l32.206" class="difflineplus">+              let customTerm =</span>
<a href="#l32.207"></a><span id="l32.207" class="difflineplus">+                 customEnum.getNext()</span>
<a href="#l32.208"></a><span id="l32.208" class="difflineplus">+                           .QueryInterface(Components.interfaces.nsIMsgSearchCustomTerm);</span>
<a href="#l32.209"></a><span id="l32.209" class="difflineplus">+              // for custom terms, the array element is a string with the custom id</span>
<a href="#l32.210"></a><span id="l32.210" class="difflineplus">+              // instead of the integer attribute</span>
<a href="#l32.211"></a><span id="l32.211" class="difflineplus">+              if (customTerm.getAvailable(this.scope, null))</span>
<a href="#l32.212"></a><span id="l32.212" class="difflineplus">+                result.push(customTerm.id);</span>
<a href="#l32.213"></a><span id="l32.213" class="difflineplus">+            }</span>
<a href="#l32.214"></a><span id="l32.214" class="difflineplus">+            return result;</span>
<a href="#l32.215"></a><span id="l32.215">           ]]&gt;</span>
<a href="#l32.216"></a><span id="l32.216">         &lt;/getter&gt;</span>
<a href="#l32.217"></a><span id="l32.217">       &lt;/property&gt;</span>
<a href="#l32.218"></a><span id="l32.218">       &lt;property name=&quot;valueStrings&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l32.219"></a><span id="l32.219">         &lt;getter&gt;</span>
<a href="#l32.220"></a><span id="l32.220">           &lt;![CDATA[</span>
<a href="#l32.221"></a><span id="l32.221">             let strings = new Array;</span>
<a href="#l32.222"></a><span id="l32.222">             let ids = this.valueIds;</span>
<a href="#l32.223"></a><span id="l32.223" class="difflineat">@@ -931,20 +1009,29 @@</span>
<a href="#l32.224"></a><span id="l32.224">                                    .getService(Components.interfaces.nsIPrefBranch)</span>
<a href="#l32.225"></a><span id="l32.225">                                    .getCharPref(&quot;mailnews.customHeaders&quot;);</span>
<a href="#l32.226"></a><span id="l32.226">               hdrs = hdrs.replace(/\s+/g, &quot;&quot;);  //remove white spaces before splitting</span>
<a href="#l32.227"></a><span id="l32.227">               hdrsArray = hdrs.match(/[^:]+/g);</span>
<a href="#l32.228"></a><span id="l32.228">             }</span>
<a href="#l32.229"></a><span id="l32.229">             catch(ex)</span>
<a href="#l32.230"></a><span id="l32.230">             {</span>
<a href="#l32.231"></a><span id="l32.231">             }</span>
<a href="#l32.232"></a><span id="l32.232" class="difflineplus">+</span>
<a href="#l32.233"></a><span id="l32.233">             let j = 0;</span>
<a href="#l32.234"></a><span id="l32.234">             for (let i = 0; i &lt; ids.length; i++)</span>
<a href="#l32.235"></a><span id="l32.235">             {</span>
<a href="#l32.236"></a><span id="l32.236" class="difflineminus">-              if(ids[i] &gt; Components.interfaces.nsMsgSearchAttrib.OtherHeader &amp;&amp; hdrsArray)</span>
<a href="#l32.237"></a><span id="l32.237" class="difflineplus">+              if (isNaN(ids[i])) // Is this a custom search term?</span>
<a href="#l32.238"></a><span id="l32.238" class="difflineplus">+              {</span>
<a href="#l32.239"></a><span id="l32.239" class="difflineplus">+                let customTerm = this.filterService.getCustomTerm(ids[i]);</span>
<a href="#l32.240"></a><span id="l32.240" class="difflineplus">+                if (customTerm)</span>
<a href="#l32.241"></a><span id="l32.241" class="difflineplus">+                  strings[i] = customTerm.name;</span>
<a href="#l32.242"></a><span id="l32.242" class="difflineplus">+                else</span>
<a href="#l32.243"></a><span id="l32.243" class="difflineplus">+                  strings[i] = &quot;&quot;;</span>
<a href="#l32.244"></a><span id="l32.244" class="difflineplus">+              }</span>
<a href="#l32.245"></a><span id="l32.245" class="difflineplus">+              else if(ids[i] &gt; Components.interfaces.nsMsgSearchAttrib.OtherHeader &amp;&amp; hdrsArray)</span>
<a href="#l32.246"></a><span id="l32.246">                 strings[i] = hdrsArray[j++];</span>
<a href="#l32.247"></a><span id="l32.247">               else</span>
<a href="#l32.248"></a><span id="l32.248">                 strings[i] = this.stringBundle.GetStringFromName(</span>
<a href="#l32.249"></a><span id="l32.249">                                this.validityManager.getAttributeProperty(ids[i]));</span>
<a href="#l32.250"></a><span id="l32.250">             }</span>
<a href="#l32.251"></a><span id="l32.251">             return strings;</span>
<a href="#l32.252"></a><span id="l32.252">           ]]&gt;</span>
<a href="#l32.253"></a><span id="l32.253">         &lt;/getter&gt;</span>
<a href="#l32.254"></a><span id="l32.254" class="difflineat">@@ -964,20 +1051,35 @@</span>
<a href="#l32.255"></a><span id="l32.255">       &lt;field name=&quot;searchAttribute&quot;&gt;Components.interfaces.nsMsgSearchAttrib.Default&lt;/field&gt;</span>
<a href="#l32.256"></a><span id="l32.256">       &lt;field name=&quot;stringBundle&quot;&gt;</span>
<a href="#l32.257"></a><span id="l32.257">         &lt;![CDATA[</span>
<a href="#l32.258"></a><span id="l32.258">           Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l32.259"></a><span id="l32.259">                     .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l32.260"></a><span id="l32.260">                     .createBundle(&quot;chrome://messenger/locale/search-operators.properties&quot;)</span>
<a href="#l32.261"></a><span id="l32.261">         ]]&gt;</span>
<a href="#l32.262"></a><span id="l32.262">       &lt;/field&gt;</span>
<a href="#l32.263"></a><span id="l32.263" class="difflineplus">+      &lt;property name=&quot;valueLabel&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l32.264"></a><span id="l32.264" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l32.265"></a><span id="l32.265" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l32.266"></a><span id="l32.266" class="difflineplus">+            return this.stringBundle.GetStringFromName(this.value);</span>
<a href="#l32.267"></a><span id="l32.267" class="difflineplus">+          ]]&gt;</span>
<a href="#l32.268"></a><span id="l32.268" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l32.269"></a><span id="l32.269" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l32.270"></a><span id="l32.270">       &lt;property name=&quot;valueIds&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l32.271"></a><span id="l32.271">         &lt;getter&gt;</span>
<a href="#l32.272"></a><span id="l32.272">           &lt;![CDATA[</span>
<a href="#l32.273"></a><span id="l32.273">             var length = new Object;</span>
<a href="#l32.274"></a><span id="l32.274" class="difflineplus">+            let isCustom = isNaN(this.searchAttribute);</span>
<a href="#l32.275"></a><span id="l32.275" class="difflineplus">+            if (isCustom)</span>
<a href="#l32.276"></a><span id="l32.276" class="difflineplus">+            {</span>
<a href="#l32.277"></a><span id="l32.277" class="difflineplus">+              let customTerm = this.filterService.getCustomTerm(this.searchAttribute);</span>
<a href="#l32.278"></a><span id="l32.278" class="difflineplus">+              if (customTerm)</span>
<a href="#l32.279"></a><span id="l32.279" class="difflineplus">+                return customTerm.getAvailableOperators(this.scope, length);</span>
<a href="#l32.280"></a><span id="l32.280" class="difflineplus">+              return [Components.interfaces.nsMsgSearchOp.Contains];</span>
<a href="#l32.281"></a><span id="l32.281" class="difflineplus">+            }</span>
<a href="#l32.282"></a><span id="l32.282">             return this.validityTable.getAvailableOperators(this.searchAttribute,length);</span>
<a href="#l32.283"></a><span id="l32.283">           ]]&gt;</span>
<a href="#l32.284"></a><span id="l32.284">         &lt;/getter&gt;</span>
<a href="#l32.285"></a><span id="l32.285">       &lt;/property&gt;</span>
<a href="#l32.286"></a><span id="l32.286">       &lt;property name=&quot;valueStrings&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l32.287"></a><span id="l32.287">         &lt;getter&gt;</span>
<a href="#l32.288"></a><span id="l32.288">           &lt;![CDATA[</span>
<a href="#l32.289"></a><span id="l32.289">             let strings = new Array;</span>
<a href="#l32.290"></a><span id="l32.290" class="difflineat">@@ -1078,22 +1180,26 @@</span>
<a href="#l32.291"></a><span id="l32.291">           &lt;xul:menuitem value=&quot;filter&quot; stringTag=&quot;junkScoreOriginFilter&quot;</span>
<a href="#l32.292"></a><span id="l32.292">                         class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l32.293"></a><span id="l32.293">           &lt;xul:menuitem value=&quot;whitelist&quot; stringTag=&quot;junkScoreOriginWhitelist&quot;</span>
<a href="#l32.294"></a><span id="l32.294">                         class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l32.295"></a><span id="l32.295">           &lt;xul:menuitem value=&quot;imapflag&quot; stringTag=&quot;junkScoreOriginImapFlag&quot;</span>
<a href="#l32.296"></a><span id="l32.296">                         class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l32.297"></a><span id="l32.297">         &lt;/xul:menupopup&gt;</span>
<a href="#l32.298"></a><span id="l32.298">       &lt;/xul:menulist&gt;</span>
<a href="#l32.299"></a><span id="l32.299" class="difflineplus">+      &lt;xul:hbox flex=&quot;1&quot; class=&quot;search-value-custom&quot; xbl:inherits=&quot;disabled&quot;/&gt;</span>
<a href="#l32.300"></a><span id="l32.300">     &lt;/content&gt;</span>
<a href="#l32.301"></a><span id="l32.301">     &lt;implementation&gt;</span>
<a href="#l32.302"></a><span id="l32.302">       &lt;field name=&quot;internalOperator&quot;&gt;null&lt;/field&gt;</span>
<a href="#l32.303"></a><span id="l32.303">       &lt;field name=&quot;internalAttribute&quot;&gt;null&lt;/field&gt;</span>
<a href="#l32.304"></a><span id="l32.304">       &lt;field name=&quot;internalValue&quot;&gt;null&lt;/field&gt;</span>
<a href="#l32.305"></a><span id="l32.305" class="difflineminus">-</span>
<a href="#l32.306"></a><span id="l32.306" class="difflineplus">+      &lt;field name=&quot;filterService&quot;&gt;</span>
<a href="#l32.307"></a><span id="l32.307" class="difflineplus">+        Components.classes[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l32.308"></a><span id="l32.308" class="difflineplus">+                  .getService(Components.interfaces.nsIMsgFilterService);</span>
<a href="#l32.309"></a><span id="l32.309" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l32.310"></a><span id="l32.310">       &lt;property name=&quot;opParentValue&quot; onget=&quot;return this.internalOperator;&quot;&gt;</span>
<a href="#l32.311"></a><span id="l32.311">         &lt;setter&gt;</span>
<a href="#l32.312"></a><span id="l32.312">           &lt;![CDATA[</span>
<a href="#l32.313"></a><span id="l32.313">             // noop if we're not changing it</span>
<a href="#l32.314"></a><span id="l32.314">             if (this.internalOperator == val) return val;</span>
<a href="#l32.315"></a><span id="l32.315"> </span>
<a href="#l32.316"></a><span id="l32.316">             // Keywords has the null field IsEmpty</span>
<a href="#l32.317"></a><span id="l32.317">             if (this.searchAttribute == Components.interfaces.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l32.318"></a><span id="l32.318" class="difflineat">@@ -1158,17 +1264,27 @@</span>
<a href="#l32.319"></a><span id="l32.319">             if (this.internalAttribute == val) return val;</span>
<a href="#l32.320"></a><span id="l32.320">             this.internalAttribute = val;</span>
<a href="#l32.321"></a><span id="l32.321"> </span>
<a href="#l32.322"></a><span id="l32.322">             // if the searchAttribute changing, null out the internalOperator</span>
<a href="#l32.323"></a><span id="l32.323">             this.internalOperator = null;</span>
<a href="#l32.324"></a><span id="l32.324"> </span>
<a href="#l32.325"></a><span id="l32.325">             // we inherit from a deck, so just use it's index attribute</span>
<a href="#l32.326"></a><span id="l32.326">             // to hide/show widgets</span>
<a href="#l32.327"></a><span id="l32.327" class="difflineminus">-            if (val == Components.interfaces.nsMsgSearchAttrib.Priority)</span>
<a href="#l32.328"></a><span id="l32.328" class="difflineplus">+            if (isNaN(val)) // Is this a custom attribute?</span>
<a href="#l32.329"></a><span id="l32.329" class="difflineplus">+            {</span>
<a href="#l32.330"></a><span id="l32.330" class="difflineplus">+              this.setAttribute(&quot;selectedIndex&quot;, &quot;9&quot;);</span>
<a href="#l32.331"></a><span id="l32.331" class="difflineplus">+              let customHbox = document.getAnonymousNodes(this)[9];</span>
<a href="#l32.332"></a><span id="l32.332" class="difflineplus">+              if (this.internalValue)</span>
<a href="#l32.333"></a><span id="l32.333" class="difflineplus">+                customHbox.setAttribute(&quot;value&quot;, this.internalValue.str);</span>
<a href="#l32.334"></a><span id="l32.334" class="difflineplus">+              // the searchAttribute attribute is intended as a selector in</span>
<a href="#l32.335"></a><span id="l32.335" class="difflineplus">+              // CSS for custom search terms to bind a custom value</span>
<a href="#l32.336"></a><span id="l32.336" class="difflineplus">+              customHbox.setAttribute(&quot;searchAttribute&quot;, val);</span>
<a href="#l32.337"></a><span id="l32.337" class="difflineplus">+            }</span>
<a href="#l32.338"></a><span id="l32.338" class="difflineplus">+            else if (val == Components.interfaces.nsMsgSearchAttrib.Priority)</span>
<a href="#l32.339"></a><span id="l32.339">               this.setAttribute(&quot;selectedIndex&quot;, &quot;1&quot;);</span>
<a href="#l32.340"></a><span id="l32.340">             else if (val == Components.interfaces.nsMsgSearchAttrib.MsgStatus)</span>
<a href="#l32.341"></a><span id="l32.341">               this.setAttribute(&quot;selectedIndex&quot;, &quot;2&quot;);</span>
<a href="#l32.342"></a><span id="l32.342">             else if (val == Components.interfaces.nsMsgSearchAttrib.Date)</span>
<a href="#l32.343"></a><span id="l32.343">               this.setAttribute(&quot;selectedIndex&quot;, &quot;3&quot;);</span>
<a href="#l32.344"></a><span id="l32.344">             else if (val == Components.interfaces.nsMsgSearchAttrib.Sender) {</span>
<a href="#l32.345"></a><span id="l32.345">               // since the internalOperator is null</span>
<a href="#l32.346"></a><span id="l32.346">               // this is the same as the initial state</span>
<a href="#l32.347"></a><span id="l32.347" class="difflineat">@@ -1196,20 +1312,26 @@</span>
<a href="#l32.348"></a><span id="l32.348">           ]]&gt;</span>
<a href="#l32.349"></a><span id="l32.349">         &lt;/setter&gt;</span>
<a href="#l32.350"></a><span id="l32.350">       &lt;/property&gt;</span>
<a href="#l32.351"></a><span id="l32.351">       &lt;property name=&quot;value&quot; onget=&quot;return this.internalValue;&quot;&gt;</span>
<a href="#l32.352"></a><span id="l32.352">         &lt;setter&gt;</span>
<a href="#l32.353"></a><span id="l32.353">           &lt;![CDATA[</span>
<a href="#l32.354"></a><span id="l32.354">           // val is a nsIMsgSearchValue object</span>
<a href="#l32.355"></a><span id="l32.355">           this.internalValue = val;</span>
<a href="#l32.356"></a><span id="l32.356" class="difflineminus">-          var attrib = val.attrib;</span>
<a href="#l32.357"></a><span id="l32.357" class="difflineplus">+          var attrib = this.internalAttribute;</span>
<a href="#l32.358"></a><span id="l32.358">           var nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l32.359"></a><span id="l32.359">           var children = document.getAnonymousNodes(this);</span>
<a href="#l32.360"></a><span id="l32.360">           this.searchAttribute = attrib;</span>
<a href="#l32.361"></a><span id="l32.361" class="difflineplus">+          if (isNaN(attrib)) // a custom term</span>
<a href="#l32.362"></a><span id="l32.362" class="difflineplus">+          {</span>
<a href="#l32.363"></a><span id="l32.363" class="difflineplus">+            let customHbox = document.getAnonymousNodes(this)[9];</span>
<a href="#l32.364"></a><span id="l32.364" class="difflineplus">+            customHbox.setAttribute(&quot;value&quot;, val.str);</span>
<a href="#l32.365"></a><span id="l32.365" class="difflineplus">+            return val;</span>
<a href="#l32.366"></a><span id="l32.366" class="difflineplus">+          }</span>
<a href="#l32.367"></a><span id="l32.367">           if (attrib == nsMsgSearchAttrib.Priority) {</span>
<a href="#l32.368"></a><span id="l32.368">             var matchingPriority =</span>
<a href="#l32.369"></a><span id="l32.369">               children[1].getElementsByAttribute(&quot;value&quot;, val.priority);</span>
<a href="#l32.370"></a><span id="l32.370">             if (matchingPriority.item(0))</span>
<a href="#l32.371"></a><span id="l32.371">               children[1].selectedItem = matchingPriority[0];</span>
<a href="#l32.372"></a><span id="l32.372">           }</span>
<a href="#l32.373"></a><span id="l32.373">           else if (attrib == nsMsgSearchAttrib.MsgStatus) {</span>
<a href="#l32.374"></a><span id="l32.374">             var matchingStatus =</span>
<a href="#l32.375"></a><span id="l32.375" class="difflineat">@@ -1278,17 +1400,16 @@</span>
<a href="#l32.376"></a><span id="l32.376">       &lt;method name=&quot;save&quot;&gt;</span>
<a href="#l32.377"></a><span id="l32.377">         &lt;body&gt;</span>
<a href="#l32.378"></a><span id="l32.378">           &lt;![CDATA[</span>
<a href="#l32.379"></a><span id="l32.379">             var searchValue = this.value;</span>
<a href="#l32.380"></a><span id="l32.380">             var searchAttribute = this.searchAttribute;</span>
<a href="#l32.381"></a><span id="l32.381">             var nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l32.382"></a><span id="l32.382">             var children = document.getAnonymousNodes(this);</span>
<a href="#l32.383"></a><span id="l32.383"> </span>
<a href="#l32.384"></a><span id="l32.384" class="difflineminus">-            searchValue.attrib = searchAttribute;</span>
<a href="#l32.385"></a><span id="l32.385">             if (searchAttribute == nsMsgSearchAttrib.Priority) {</span>
<a href="#l32.386"></a><span id="l32.386">                searchValue.priority = children[1].selectedItem.value;</span>
<a href="#l32.387"></a><span id="l32.387">             }</span>
<a href="#l32.388"></a><span id="l32.388">             else if (searchAttribute == nsMsgSearchAttrib.MsgStatus)</span>
<a href="#l32.389"></a><span id="l32.389">                searchValue.status = children[2].value;</span>
<a href="#l32.390"></a><span id="l32.390">             else if (searchAttribute == nsMsgSearchAttrib.AgeInDays)</span>
<a href="#l32.391"></a><span id="l32.391">                searchValue.age = children[0].value;</span>
<a href="#l32.392"></a><span id="l32.392">             else if (searchAttribute == nsMsgSearchAttrib.Date)</span>
<a href="#l32.393"></a><span id="l32.393" class="difflineat">@@ -1314,18 +1435,27 @@</span>
<a href="#l32.394"></a><span id="l32.394">             else if (searchAttribute == nsMsgSearchAttrib.JunkPercent)</span>
<a href="#l32.395"></a><span id="l32.395">                searchValue.junkPercent = children[0].value;</span>
<a href="#l32.396"></a><span id="l32.396">             else if (searchAttribute == nsMsgSearchAttrib.Size)</span>
<a href="#l32.397"></a><span id="l32.397">                searchValue.size = children[0].value;</span>
<a href="#l32.398"></a><span id="l32.398">             else if (searchAttribute == nsMsgSearchAttrib.HasAttachmentStatus)</span>
<a href="#l32.399"></a><span id="l32.399">                searchValue.status = 0x10000000;  // 0x10000000 is MSG_FLAG_ATTACHMENT;</span>
<a href="#l32.400"></a><span id="l32.400">             else if (searchAttribute == nsMsgSearchAttrib.JunkScoreOrigin)</span>
<a href="#l32.401"></a><span id="l32.401">                searchValue.str = children[8].value;</span>
<a href="#l32.402"></a><span id="l32.402" class="difflineplus">+</span>
<a href="#l32.403"></a><span id="l32.403" class="difflineplus">+            if (isNaN(searchAttribute)) //  a custom term</span>
<a href="#l32.404"></a><span id="l32.404" class="difflineplus">+            {</span>
<a href="#l32.405"></a><span id="l32.405" class="difflineplus">+              searchValue.attrib = nsMsgSearchAttrib.Custom;</span>
<a href="#l32.406"></a><span id="l32.406" class="difflineplus">+              searchValue.str = children[9].getAttribute(&quot;value&quot;);</span>
<a href="#l32.407"></a><span id="l32.407" class="difflineplus">+            }</span>
<a href="#l32.408"></a><span id="l32.408">             else</span>
<a href="#l32.409"></a><span id="l32.409" class="difflineminus">-               searchValue.str = children[0].value;</span>
<a href="#l32.410"></a><span id="l32.410" class="difflineplus">+            {</span>
<a href="#l32.411"></a><span id="l32.411" class="difflineplus">+              searchValue.attrib = searchAttribute;</span>
<a href="#l32.412"></a><span id="l32.412" class="difflineplus">+              searchValue.str = children[0].value;</span>
<a href="#l32.413"></a><span id="l32.413" class="difflineplus">+            }</span>
<a href="#l32.414"></a><span id="l32.414">           ]]&gt;</span>
<a href="#l32.415"></a><span id="l32.415">         &lt;/body&gt;</span>
<a href="#l32.416"></a><span id="l32.416">       &lt;/method&gt;</span>
<a href="#l32.417"></a><span id="l32.417">       &lt;method name=&quot;saveTo&quot;&gt;</span>
<a href="#l32.418"></a><span id="l32.418">         &lt;parameter name=&quot;searchValue&quot;/&gt;</span>
<a href="#l32.419"></a><span id="l32.419">         &lt;body&gt;</span>
<a href="#l32.420"></a><span id="l32.420">           &lt;![CDATA[</span>
<a href="#l32.421"></a><span id="l32.421">             this.internalValue = searchValue;</span>
<a href="#l32.422"></a><span id="l32.422" class="difflineat">@@ -1427,16 +1557,17 @@</span>
<a href="#l32.423"></a><span id="l32.423">         fillInTags();</span>
<a href="#l32.424"></a><span id="l32.424">       ]]&gt;</span>
<a href="#l32.425"></a><span id="l32.425">       &lt;/constructor&gt;</span>
<a href="#l32.426"></a><span id="l32.426">     &lt;/implementation&gt;</span>
<a href="#l32.427"></a><span id="l32.427">     &lt;handlers&gt;</span>
<a href="#l32.428"></a><span id="l32.428"> 	&lt;handler event=&quot;keypress&quot; keycode=&quot;VK_RETURN&quot; action=&quot;onEnterInSearchTerm();&quot;/&gt;</span>
<a href="#l32.429"></a><span id="l32.429">     &lt;/handlers&gt;</span>
<a href="#l32.430"></a><span id="l32.430">   &lt;/binding&gt;</span>
<a href="#l32.431"></a><span id="l32.431" class="difflineplus">+  &lt;!-- the searchterm binding is not used anymore, remove in bug 490962 --&gt;</span>
<a href="#l32.432"></a><span id="l32.432">   &lt;binding id=&quot;searchterm&quot; name=&quot;searchTerm&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l32.433"></a><span id="l32.433">     &lt;implementation&gt;</span>
<a href="#l32.434"></a><span id="l32.434">       &lt;field name=&quot;internalSearchTerm&quot;&gt;null&lt;/field&gt;</span>
<a href="#l32.435"></a><span id="l32.435">       &lt;field name=&quot;internalBooleanAnd&quot;&gt;null&lt;/field&gt;</span>
<a href="#l32.436"></a><span id="l32.436">       &lt;!-- the actual nsIMsgSearchTerm object --&gt;</span>
<a href="#l32.437"></a><span id="l32.437">       &lt;property name=&quot;searchTerm&quot; onget=&quot;return this.internalSearchTerm&quot;&gt;</span>
<a href="#l32.438"></a><span id="l32.438">         &lt;setter&gt;</span>
<a href="#l32.439"></a><span id="l32.439">           &lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/suite/themes/classic/messenger/filterDialog.css</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/suite/themes/classic/messenger/filterDialog.css</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -63,16 +63,20 @@ treechildren::-moz-tree-image(activeColu</span>
<a href="#l33.4"></a><span id="l33.4"> listbox {</span>
<a href="#l33.5"></a><span id="l33.5">   padding-top: 2px;</span>
<a href="#l33.6"></a><span id="l33.6"> }</span>
<a href="#l33.7"></a><span id="l33.7"> </span>
<a href="#l33.8"></a><span id="l33.8"> .search-menulist, .search-value-menulist {</span>
<a href="#l33.9"></a><span id="l33.9">   width: 12em;</span>
<a href="#l33.10"></a><span id="l33.10"> }</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  color: GrayText;</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+}</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+</span>
<a href="#l33.16"></a><span id="l33.16"> textbox {</span>
<a href="#l33.17"></a><span id="l33.17">   margin: 1px 4px;</span>
<a href="#l33.18"></a><span id="l33.18"> }</span>
<a href="#l33.19"></a><span id="l33.19"> </span>
<a href="#l33.20"></a><span id="l33.20"> #FilterEditor {</span>
<a href="#l33.21"></a><span id="l33.21">   width: 560px;</span>
<a href="#l33.22"></a><span id="l33.22">   min-height:1px;</span>
<a href="#l33.23"></a><span id="l33.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/suite/themes/classic/messenger/searchDialog.css</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/suite/themes/classic/messenger/searchDialog.css</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -53,16 +53,20 @@</span>
<a href="#l34.4"></a><span id="l34.4">   height: 100px;</span>
<a href="#l34.5"></a><span id="l34.5"> }</span>
<a href="#l34.6"></a><span id="l34.6"> </span>
<a href="#l34.7"></a><span id="l34.7"> #searchResultListBox {</span>
<a href="#l34.8"></a><span id="l34.8">   margin: 5px;</span>
<a href="#l34.9"></a><span id="l34.9">   height: 100px;</span>
<a href="#l34.10"></a><span id="l34.10"> }</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  color: GrayText;</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+}</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+</span>
<a href="#l34.16"></a><span id="l34.16"> menulist {</span>
<a href="#l34.17"></a><span id="l34.17">   width: 12em;</span>
<a href="#l34.18"></a><span id="l34.18"> }</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20"> menulist &gt; menupopup &gt; menuitem {</span>
<a href="#l34.21"></a><span id="l34.21">   -moz-padding-end: 2px;</span>
<a href="#l34.22"></a><span id="l34.22"> }</span>
<a href="#l34.23"></a><span id="l34.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/suite/themes/modern/messenger/filterDialog.css</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/suite/themes/modern/messenger/filterDialog.css</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -52,16 +52,20 @@ treechildren::-moz-tree-image(activeColu</span>
<a href="#l35.4"></a><span id="l35.4"> treechildren::-moz-tree-image(activeColumn, Enabled-true) {</span>
<a href="#l35.5"></a><span id="l35.5">   list-style-image: url(&quot;chrome://global/skin/checkbox/cbox-check.gif&quot;);</span>
<a href="#l35.6"></a><span id="l35.6"> }</span>
<a href="#l35.7"></a><span id="l35.7"> </span>
<a href="#l35.8"></a><span id="l35.8"> .search-menulist, .search-value-menulist {</span>
<a href="#l35.9"></a><span id="l35.9">   width: 12em;</span>
<a href="#l35.10"></a><span id="l35.10"> }</span>
<a href="#l35.11"></a><span id="l35.11"> </span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+  color: #8C99AB;</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+}</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+</span>
<a href="#l35.16"></a><span id="l35.16"> .small-button {</span>
<a href="#l35.17"></a><span id="l35.17">   min-width: 3em;</span>
<a href="#l35.18"></a><span id="l35.18">   padding: 0px;</span>
<a href="#l35.19"></a><span id="l35.19">   margin: 0px 1px;</span>
<a href="#l35.20"></a><span id="l35.20"> }</span>
<a href="#l35.21"></a><span id="l35.21"> </span>
<a href="#l35.22"></a><span id="l35.22"> listbox {</span>
<a href="#l35.23"></a><span id="l35.23">   padding-top: 2px;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/suite/themes/modern/messenger/searchDialog.css</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/suite/themes/modern/messenger/searchDialog.css</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -54,16 +54,20 @@</span>
<a href="#l36.4"></a><span id="l36.4">   height: 100px;</span>
<a href="#l36.5"></a><span id="l36.5"> }</span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7"> #searchResultListBox {</span>
<a href="#l36.8"></a><span id="l36.8">   margin: 5px;</span>
<a href="#l36.9"></a><span id="l36.9">   height: 100px;</span>
<a href="#l36.10"></a><span id="l36.10"> }</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12" class="difflineplus">+.search-menulist[unavailable=&quot;true&quot;] {</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+  color: #8C99AB;</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+}</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+</span>
<a href="#l36.16"></a><span id="l36.16"> menulist {</span>
<a href="#l36.17"></a><span id="l36.17">   width: 12em;</span>
<a href="#l36.18"></a><span id="l36.18"> }</span>
<a href="#l36.19"></a><span id="l36.19"> </span>
<a href="#l36.20"></a><span id="l36.20"> menulist &gt; menupopup &gt; menuitem {</span>
<a href="#l36.21"></a><span id="l36.21">   -moz-padding-end: 2px;</span>
<a href="#l36.22"></a><span id="l36.22"> }</span>
<a href="#l36.23"></a><span id="l36.23"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

