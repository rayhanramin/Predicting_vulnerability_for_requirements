<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 21102:8571f68411c759762160b13257eb68626b9b00ea</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 8571f68411c759762160b13257eb68626b9b00ea" />
<meta property="og:url" content="/comm-central/rev/8571f68411c759762160b13257eb68626b9b00ea" />
<meta property="og:description" content="Bug 1312813 - Implement user configurable per feed update interval. r=mkmelin a=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 8571f68411c759762160b13257eb68626b9b00ea 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/8571f68411c759762160b13257eb68626b9b00ea">shortlog</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/8571f68411c759762160b13257eb68626b9b00ea">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea">files</a> |
changeset |
<a href="/comm-central/raw-rev/8571f68411c759762160b13257eb68626b9b00ea">raw</a>  | <a href="/comm-central/archive/8571f68411c759762160b13257eb68626b9b00ea.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1312813">Bug 1312813</a> - Implement user configurable per feed update interval. r=mkmelin a=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#108;&#116;&#97;&#56;&#56;&#32;&#60;&#97;&#108;&#116;&#97;&#56;&#56;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 15 Oct 2016 14:09:39 -0400</td></tr>

<tr>
 <td>changeset 21102</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/8571f68411c759762160b13257eb68626b9b00ea">8571f68411c759762160b13257eb68626b9b00ea</a></td>
</tr>



<tr>
<td>parent 21101</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/41590e369c5c6cae8a892fd0238c456ecf9da69a">41590e369c5c6cae8a892fd0238c456ecf9da69a</a>
</td>
</tr>

<tr>
<td>child 21103</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f4a143f3ced4dccd1479e61c3f523e85880a20ca">f4a143f3ced4dccd1479e61c3f523e85880a20ca</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=8571f68411c759762160b13257eb68626b9b00ea">12820</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 06 Feb 2017 14:55:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8571f68411c7 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8571f68411c759762160b13257eb68626b9b00ea">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8571f68411c759762160b13257eb68626b9b00ea&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8571f68411c759762160b13257eb68626b9b00ea&newProject=comm-central&newRevision=8571f68411c759762160b13257eb68626b9b00ea&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8571f68411c759762160b13257eb68626b9b00ea&newProject=comm-central&newRevision=8571f68411c759762160b13257eb68626b9b00ea&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8571f68411c759762160b13257eb68626b9b00ea&newProject=comm-central&newRevision=8571f68411c759762160b13257eb68626b9b00ea&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1312813">1312813</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1312813">Bug 1312813</a> - Implement user configurable per feed update interval. r=mkmelin a=jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/folderPane.js">mail/base/content/folderPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/folderPane.js">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/folderPane.js">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/folderPane.js">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/folderPane.js">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/folderPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailContextMenus.js">mail/base/content/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.xul">mail/base/content/mailWindowOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.xul">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.xul">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.xul">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.xul">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/base/content/mailWindowOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/am-newsblog.dtd">mail/locales/en-US/chrome/messenger-newsblog/am-newsblog.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/am-newsblog.dtd">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/am-newsblog.dtd">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/am-newsblog.dtd">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/am-newsblog.dtd">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/am-newsblog.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger/messenger.dtd">mail/locales/en-US/chrome/messenger/messenger.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger/messenger.dtd">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger/messenger.dtd">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger/messenger.dtd">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger/messenger.dtd">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/locales/en-US/chrome/messenger/messenger.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/folderPane.css">mail/themes/linux/mail/folderPane.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/folderPane.css">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/folderPane.css">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/folderPane.css">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/folderPane.css">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/folderPane.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/newsblog/feed-subscriptions.css">mail/themes/linux/mail/newsblog/feed-subscriptions.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/newsblog/feed-subscriptions.css">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/newsblog/feed-subscriptions.css">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/newsblog/feed-subscriptions.css">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/newsblog/feed-subscriptions.css">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/linux/mail/newsblog/feed-subscriptions.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/folderPane.css">mail/themes/osx/mail/folderPane.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/folderPane.css">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/folderPane.css">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/folderPane.css">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/folderPane.css">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/folderPane.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/newsblog/feed-subscriptions.css">mail/themes/osx/mail/newsblog/feed-subscriptions.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/newsblog/feed-subscriptions.css">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/newsblog/feed-subscriptions.css">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/newsblog/feed-subscriptions.css">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/newsblog/feed-subscriptions.css">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/osx/mail/newsblog/feed-subscriptions.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/folderPane.css">mail/themes/windows/mail/folderPane.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/folderPane.css">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/folderPane.css">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/folderPane.css">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/folderPane.css">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/folderPane.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/newsblog/feed-subscriptions.css">mail/themes/windows/mail/newsblog/feed-subscriptions.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/newsblog/feed-subscriptions.css">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/newsblog/feed-subscriptions.css">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/newsblog/feed-subscriptions.css">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/newsblog/feed-subscriptions.css">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mail/themes/windows/mail/newsblog/feed-subscriptions.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/Feed.js">mailnews/extensions/newsblog/content/Feed.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/Feed.js">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/Feed.js">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/Feed.js">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/Feed.js">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/Feed.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedItem.js">mailnews/extensions/newsblog/content/FeedItem.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedItem.js">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedItem.js">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedItem.js">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedItem.js">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedItem.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedUtils.jsm">mailnews/extensions/newsblog/content/FeedUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedUtils.jsm">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedUtils.jsm">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedUtils.jsm">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedUtils.jsm">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/FeedUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.js">mailnews/extensions/newsblog/content/am-newsblog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.js">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.js">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.js">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.js">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.xul">mailnews/extensions/newsblog/content/am-newsblog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.xul">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.xul">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.xul">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.xul">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/am-newsblog.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-parser.js">mailnews/extensions/newsblog/content/feed-parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-parser.js">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-parser.js">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-parser.js">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-parser.js">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-parser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.js">mailnews/extensions/newsblog/content/feed-subscriptions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.js">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.js">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.js">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.js">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.xul">mailnews/extensions/newsblog/content/feed-subscriptions.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.xul">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.xul">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.xul">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.xul">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/feed-subscriptions.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/newsblogOverlay.js">mailnews/extensions/newsblog/content/newsblogOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/newsblogOverlay.js">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/newsblogOverlay.js">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/newsblogOverlay.js">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/newsblogOverlay.js">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/content/newsblogOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/jar.mn">mailnews/extensions/newsblog/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/jar.mn">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/jar.mn">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/jar.mn">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/jar.mn">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/mailnews/extensions/newsblog/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/am-newsblog.dtd">suite/locales/en-US/chrome/mailnews/newsblog/am-newsblog.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/am-newsblog.dtd">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/am-newsblog.dtd">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/am-newsblog.dtd">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/am-newsblog.dtd">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/am-newsblog.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/feed-subscriptions.dtd">suite/locales/en-US/chrome/mailnews/newsblog/feed-subscriptions.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/feed-subscriptions.dtd">file</a> |
<a href="/comm-central/annotate/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/feed-subscriptions.dtd">annotate</a> |
<a href="/comm-central/diff/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/feed-subscriptions.dtd">diff</a> |
<a href="/comm-central/comparison/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/feed-subscriptions.dtd">comparison</a> |
<a href="/comm-central/log/8571f68411c759762160b13257eb68626b9b00ea/suite/locales/en-US/chrome/mailnews/newsblog/feed-subscriptions.dtd">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -914,16 +914,20 @@ var gFolderTreeView = {</span>
<a href="#l1.4"></a><span id="l1.4">     if (aCol.id != &quot;folderNameCol&quot;)</span>
<a href="#l1.5"></a><span id="l1.5">       return &quot;&quot;;</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">     let rowItem = gFolderTreeView._rowMap[aRow];</span>
<a href="#l1.8"></a><span id="l1.8">     let folder = rowItem._folder;</span>
<a href="#l1.9"></a><span id="l1.9">     if (folder.server.type != &quot;rss&quot; || folder.isServer)</span>
<a href="#l1.10"></a><span id="l1.10">       return &quot;&quot;;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    let properties = this.getFolderCacheProperty(folder, &quot;properties&quot;);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    if (properties.includes(&quot;hasError&quot;) || properties.includes(&quot;isBusy&quot;))</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      return &quot;&quot;;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+</span>
<a href="#l1.16"></a><span id="l1.16">     let favicon = this.getFolderCacheProperty(folder, &quot;favicon&quot;);</span>
<a href="#l1.17"></a><span id="l1.17">     if (favicon != null)</span>
<a href="#l1.18"></a><span id="l1.18">       return favicon;</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     let callback = (iconUrl =&gt; {</span>
<a href="#l1.21"></a><span id="l1.21">       this.setFolderCacheProperty(folder, &quot;favicon&quot;, iconUrl);</span>
<a href="#l1.22"></a><span id="l1.22">       this._tree.invalidateRow(aRow);</span>
<a href="#l1.23"></a><span id="l1.23">     });</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineat">@@ -1489,17 +1493,18 @@ var gFolderTreeView = {</span>
<a href="#l1.25"></a><span id="l1.25">    * @param  nsIMsgFolder aFolder   - folder.</span>
<a href="#l1.26"></a><span id="l1.26">    * @param  string aProperty       - property key.</span>
<a href="#l1.27"></a><span id="l1.27">    * @return value or null          - null indicates uninitialized.</span>
<a href="#l1.28"></a><span id="l1.28">    */</span>
<a href="#l1.29"></a><span id="l1.29">   getFolderCacheProperty: function(aFolder, aProperty) {</span>
<a href="#l1.30"></a><span id="l1.30">     if (!aFolder || !aProperty)</span>
<a href="#l1.31"></a><span id="l1.31">       return null;</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-    if (!(aFolder.URI in this._cache))</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+    if (!(aFolder.URI in this._cache) ||</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+        !(aProperty in this._cache[aFolder.URI]))</span>
<a href="#l1.36"></a><span id="l1.36">       return null;</span>
<a href="#l1.37"></a><span id="l1.37"> </span>
<a href="#l1.38"></a><span id="l1.38">     return this._cache[aFolder.URI][aProperty];</span>
<a href="#l1.39"></a><span id="l1.39">   },</span>
<a href="#l1.40"></a><span id="l1.40"> </span>
<a href="#l1.41"></a><span id="l1.41">   /**</span>
<a href="#l1.42"></a><span id="l1.42">    * Contains the set of modes registered with the folder tree, initially those</span>
<a href="#l1.43"></a><span id="l1.43">    * included by default. This is a map from names of modes to their</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineat">@@ -2377,19 +2382,20 @@ ftvItem.prototype = {</span>
<a href="#l1.45"></a><span id="l1.45">       properties += &quot; specialFolder-&quot; + this._folder.name.replace(' ','');</span>
<a href="#l1.46"></a><span id="l1.46">     }</span>
<a href="#l1.47"></a><span id="l1.47">     // if there is a smartFolder name property, add it</span>
<a href="#l1.48"></a><span id="l1.48">     let smartFolderName = getSmartFolderName(this._folder);</span>
<a href="#l1.49"></a><span id="l1.49">     if (smartFolderName) {</span>
<a href="#l1.50"></a><span id="l1.50">       properties += &quot; specialFolder-&quot; + smartFolderName.replace(' ','');</span>
<a href="#l1.51"></a><span id="l1.51">     }</span>
<a href="#l1.52"></a><span id="l1.52"> </span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-    if (this._folder.server.type == &quot;rss&quot; &amp;&amp; !this._folder.isServer &amp;&amp;</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-        FeedUtils.getFeedUrlsInFolder(this._folder))</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-      properties += &quot; isFeedFolder-true&quot;;</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+    if (FeedMessageHandler.isFeedFolder(this._folder)) {</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+      properties += FeedUtils.getFolderProperties(this._folder, null);</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+      gFolderTreeView.setFolderCacheProperty(this._folder, &quot;properties&quot;, properties);</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+    }</span>
<a href="#l1.60"></a><span id="l1.60"> </span>
<a href="#l1.61"></a><span id="l1.61">     return properties;</span>
<a href="#l1.62"></a><span id="l1.62">   },</span>
<a href="#l1.63"></a><span id="l1.63"> </span>
<a href="#l1.64"></a><span id="l1.64">   command: function fti_command() {</span>
<a href="#l1.65"></a><span id="l1.65">     if (!Services.prefs.getBoolPref(&quot;mailnews.reuse_thread_window2&quot;))</span>
<a href="#l1.66"></a><span id="l1.66">       MsgOpenNewWindowForFolder(this._folder.URI, -1 /* key */);</span>
<a href="#l1.67"></a><span id="l1.67">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/mailContextMenus.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/mailContextMenus.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -411,16 +411,45 @@ function fillFolderPaneContextMenu(aEven</span>
<a href="#l2.4"></a><span id="l2.4">   // but it gets messy for situations where both server and a folder</span>
<a href="#l2.5"></a><span id="l2.5">   // on the server are selected.</span>
<a href="#l2.6"></a><span id="l2.6">   ShowMenuItem(&quot;folderPaneContext-getMessages&quot;,</span>
<a href="#l2.7"></a><span id="l2.7">                (selectedServers.length &gt; 0 &amp;&amp;</span>
<a href="#l2.8"></a><span id="l2.8">                 selectedFoldersThatCanGetMessages.length == numSelected &amp;&amp;</span>
<a href="#l2.9"></a><span id="l2.9">                 selectedServers.length == selectedFoldersThatCanGetMessages.length) ||</span>
<a href="#l2.10"></a><span id="l2.10">                selectedFoldersThatCanGetMessages.length == numSelected);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  // --- Set up the pause all updates menu item.</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  // Show only if a feed server.</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  let showPausedAll = numSelected == 1 &amp;&amp; folders[0].isServer &amp;&amp;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+                      FeedMessageHandler.isFeedFolder(folders[0]);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  ShowMenuItem(&quot;folderPaneContext-pauseAllUpdates&quot;, showPausedAll);</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+  // Adjust the checked state on the menu item.</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+  if (showPausedAll) {</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+    let menuitem = document.getElementById(&quot;folderPaneContext-pauseAllUpdates&quot;);</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+    let optionsAcct = FeedUtils.getOptionsAcct(folders[0].server);</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+    menuitem.setAttribute(&quot;checked&quot;, !optionsAcct.doBiff);</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+  }</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+  // --- Set up the pause single folder subscription updates menu item.</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+  // Show only if a feed folder, or a feed account folder with no subscriptions</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+  // but subfolders (which may have feed folders).</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+  let showPaused = numSelected == 1 &amp;&amp;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+                   (FeedUtils.getFeedUrlsInFolder(folders[0]) ||</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+                    (FeedMessageHandler.isFeedFolder(folders[0]) &amp;&amp;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+                     !folders[0].isServer &amp;&amp; folders[0].hasSubFolders));</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+  ShowMenuItem(&quot;folderPaneContext-pauseUpdates&quot;, showPaused);</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  // Adjust the checked state on the menu item.</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+  if (showPaused) {</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+    let menuitem = document.getElementById(&quot;folderPaneContext-pauseUpdates&quot;);</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+    let properties = FeedUtils.getFolderProperties(folders[0]);</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+    let paused = properties.includes(&quot;isPaused&quot;);</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+    menuitem.setAttribute(&quot;checked&quot;, paused);</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+  }</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+  ShowMenuItem(&quot;folderPaneContext-sepPause&quot;, showPausedAll || showPaused);</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+</span>
<a href="#l2.41"></a><span id="l2.41">   // --- Set up new sub/folder menu item.</span>
<a href="#l2.42"></a><span id="l2.42">   if (numSelected == 1) {</span>
<a href="#l2.43"></a><span id="l2.43">     let showNewFolderItem =</span>
<a href="#l2.44"></a><span id="l2.44">       ((folders[0].server.type != &quot;nntp&quot;) &amp;&amp; folders[0].canCreateSubfolders) ||</span>
<a href="#l2.45"></a><span id="l2.45">       (specialFolder == &quot;Inbox&quot;);</span>
<a href="#l2.46"></a><span id="l2.46">     ShowMenuItem(&quot;folderPaneContext-new&quot;, showNewFolderItem);</span>
<a href="#l2.47"></a><span id="l2.47">     // XXX: Can't offline imap create folders nowadays?</span>
<a href="#l2.48"></a><span id="l2.48">     EnableMenuItem(&quot;folderPaneContext-new&quot;, folders[0].server.type != &quot;imap&quot; ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1434,16 +1434,29 @@ function GetMessagesForInboxOnServer(ser</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> function MsgGetMessage()</span>
<a href="#l3.6"></a><span id="l3.6"> {</span>
<a href="#l3.7"></a><span id="l3.7">   // if offline, prompt for getting messages</span>
<a href="#l3.8"></a><span id="l3.8">   if (MailOfflineMgr.isOnline() || MailOfflineMgr.getNewMail())</span>
<a href="#l3.9"></a><span id="l3.9">     GetFolderMessages();</span>
<a href="#l3.10"></a><span id="l3.10"> }</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+function MsgPauseUpdates(aMenuitem)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+{</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  // Pause single feed folder subscription updates, or all account updates if</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+  // folder is the account folder.</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+  let selectedFolders = GetSelectedMsgFolders();</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+  let folder = selectedFolders.length ? selectedFolders[0] : null;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+  if (!FeedMessageHandler.isFeedFolder(folder))</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+    return;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+  let pause = aMenuitem.getAttribute(&quot;checked&quot;) == &quot;true&quot;;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+  FeedUtils.pauseFeedFolderUpdates(folder, pause, true);</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+}</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+</span>
<a href="#l3.25"></a><span id="l3.25"> function MsgGetMessagesForAllServers(defaultServer)</span>
<a href="#l3.26"></a><span id="l3.26"> {</span>
<a href="#l3.27"></a><span id="l3.27">   // now log into any server</span>
<a href="#l3.28"></a><span id="l3.28">   try</span>
<a href="#l3.29"></a><span id="l3.29">   {</span>
<a href="#l3.30"></a><span id="l3.30">     var allServers = accountManager.allServers;</span>
<a href="#l3.31"></a><span id="l3.31">     // Array of arrays of servers for a particular folder.</span>
<a href="#l3.32"></a><span id="l3.32">     var pop3DownloadServersArray = [];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -935,16 +935,27 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">   &lt;menupopup id=&quot;folderPaneContext&quot;</span>
<a href="#l4.6"></a><span id="l4.6">              onpopupshowing=&quot;return fillFolderPaneContextMenu(event);&quot;</span>
<a href="#l4.7"></a><span id="l4.7">              onpopuphiding=&quot;if (event.target == this) folderPaneOnPopupHiding();&quot;&gt;</span>
<a href="#l4.8"></a><span id="l4.8">     &lt;menuitem id=&quot;folderPaneContext-getMessages&quot;</span>
<a href="#l4.9"></a><span id="l4.9">               label=&quot;&amp;folderContextGetMessages.label;&quot;</span>
<a href="#l4.10"></a><span id="l4.10">               accesskey=&quot;&amp;folderContextGetMessages.accesskey;&quot;</span>
<a href="#l4.11"></a><span id="l4.11">               oncommand=&quot;MsgGetMessage();&quot;/&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+    &lt;menuitem id=&quot;folderPaneContext-pauseAllUpdates&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+              type=&quot;checkbox&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+              label=&quot;&amp;folderContextPauseAllUpdates.label;&quot;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+              accesskey=&quot;&amp;folderContextPauseUpdates.accesskey;&quot;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+              oncommand=&quot;MsgPauseUpdates(this);&quot;/&gt;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+    &lt;menuitem id=&quot;folderPaneContext-pauseUpdates&quot;</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+              type=&quot;checkbox&quot;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+              label=&quot;&amp;folderContextPauseUpdates.label;&quot;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+              accesskey=&quot;&amp;folderContextPauseUpdates.accesskey;&quot;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+              oncommand=&quot;MsgPauseUpdates(this);&quot;/&gt;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+    &lt;menuseparator id=&quot;folderPaneContext-sepPause&quot;/&gt;</span>
<a href="#l4.23"></a><span id="l4.23">     &lt;menuitem id=&quot;folderPaneContext-openNewTab&quot;</span>
<a href="#l4.24"></a><span id="l4.24">               label=&quot;&amp;folderContextOpenNewTab.label;&quot;</span>
<a href="#l4.25"></a><span id="l4.25">               accesskey=&quot;&amp;folderContextOpenNewTab.accesskey;&quot;</span>
<a href="#l4.26"></a><span id="l4.26">               oncommand=&quot;FolderPaneContextMenuNewTab(event);&quot;/&gt;</span>
<a href="#l4.27"></a><span id="l4.27">     &lt;menuitem id=&quot;folderPaneContext-openNewWindow&quot;</span>
<a href="#l4.28"></a><span id="l4.28">               label=&quot;&amp;folderContextOpenInNewWindow.label;&quot;</span>
<a href="#l4.29"></a><span id="l4.29">               accesskey=&quot;&amp;folderContextOpenInNewWindow.accesskey;&quot;</span>
<a href="#l4.30"></a><span id="l4.30">               oncommand=&quot;MsgOpenNewWindowForFolder(null,-1);&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger-newsblog/am-newsblog.dtd</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger-newsblog/am-newsblog.dtd</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,24 +1,16 @@</span>
<a href="#l5.4"></a><span id="l5.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">-&lt;!ENTITY biffStart.label &quot;Check for new articles every &quot;&gt;</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-&lt;!ENTITY biffStart.accesskey &quot;k&quot;&gt;</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">-&lt;!ENTITY biffEnd.label &quot;minutes&quot;&gt;</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+&lt;!ENTITY loginAtStartup.label          &quot;Check for new articles at startup&quot;&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+&lt;!ENTITY loginAtStartup.accesskey      &quot;C&quot;&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+&lt;!ENTITY biffAll.label                 &quot;Enable updates for all feeds&quot;&gt;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+&lt;!ENTITY biffAll.accesskey             &quot;E&quot;&gt;</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-&lt;!ENTITY loginAtStartup.label &quot;Check for new articles at startup&quot;&gt; </span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-&lt;!ENTITY loginAtStartup.accesskey &quot;C&quot;&gt;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+&lt;!ENTITY newFeedSettings.label         &quot;Default Settings for New Feeds&quot;&gt;</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-&lt;!ENTITY useQuickMode.label &quot;By default, show the article summary instead of loading the web page&quot;&gt; </span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-&lt;!ENTITY useQuickMode.accesskey &quot;B&quot;&gt;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-&lt;!ENTITY manageSubscriptions.label &quot;Manage Subscriptions…&quot;&gt; </span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+&lt;!ENTITY manageSubscriptions.label     &quot;Manage Subscriptions…&quot;&gt;</span>
<a href="#l5.25"></a><span id="l5.25"> &lt;!ENTITY manageSubscriptions.accesskey &quot;M&quot;&gt;</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-&lt;!ENTITY feedWindowTitle.label &quot;Feed Account Wizard&quot;&gt;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-&lt;!-- entities from rss.rdf --&gt;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-&lt;!ENTITY feeds.accountName &quot;Blogs &amp;amp; News Feeds&quot;&gt;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-&lt;!ENTITY feeds.wizardShortName &quot;Feeds&quot;&gt;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-&lt;!ENTITY feeds.wizardLongName &quot;Blogs &amp;amp; News Feeds&quot;&gt;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-&lt;!ENTITY feeds.wizardLongName.accesskey &quot;F&quot;&gt;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+&lt;!ENTITY feedWindowTitle.label         &quot;Feed Account Wizard&quot;&gt;</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+&lt;!ENTITY feeds.accountName             &quot;Blogs &amp;amp; News Feeds&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -5,33 +5,43 @@</span>
<a href="#l6.4"></a><span id="l6.4"> &lt;!-- Subscription Dialog --&gt;</span>
<a href="#l6.5"></a><span id="l6.5"> &lt;!ENTITY feedSubscriptions.label     &quot;Feed Subscriptions&quot;&gt;</span>
<a href="#l6.6"></a><span id="l6.6"> &lt;!ENTITY learnMore.label             &quot;Learn more about Feeds&quot;&gt;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> &lt;!ENTITY feedTitle.label             &quot;Title:&quot;&gt;</span>
<a href="#l6.9"></a><span id="l6.9"> &lt;!ENTITY feedTitle.accesskey         &quot;T&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11"> &lt;!ENTITY feedLocation.label          &quot;Feed URL:&quot;&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-&lt;!ENTITY feedLocation.accesskey      &quot;U&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+&lt;!ENTITY feedLocation.accesskey      &quot;F&quot;&gt;</span>
<a href="#l6.14"></a><span id="l6.14"> &lt;!ENTITY feedLocation.placeholder    &quot;Enter a valid feed url to Add&quot;&gt;</span>
<a href="#l6.15"></a><span id="l6.15"> &lt;!ENTITY locationValidate.label      &quot;Validate&quot;&gt;</span>
<a href="#l6.16"></a><span id="l6.16"> &lt;!ENTITY validateText.label          &quot;Check validation and retrieve a valid url.&quot;&gt;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> &lt;!ENTITY feedFolder.label            &quot;Store Articles in:&quot;&gt;</span>
<a href="#l6.19"></a><span id="l6.19"> &lt;!ENTITY feedFolder.accesskey        &quot;S&quot;&gt;</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+&lt;!-- Account Settings and Subscription Dialog --&gt;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+&lt;!ENTITY biffStart.label             &quot;Check for new articles every &quot;&gt;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+&lt;!ENTITY biffStart.accesskey         &quot;k&quot;&gt;</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+&lt;!ENTITY biffMinutes.label           &quot;minutes&quot;&gt;</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+&lt;!ENTITY biffMinutes.accesskey       &quot;n&quot;&gt;</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+&lt;!ENTITY biffDays.label              &quot;days&quot;&gt;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+&lt;!ENTITY biffDays.accesskey          &quot;d&quot;&gt;</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+&lt;!ENTITY recommendedUnits.label      &quot;Publisher recommends:&quot;&gt;</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+</span>
<a href="#l6.30"></a><span id="l6.30"> &lt;!ENTITY quickMode.label             &quot;Show the article summary instead of loading the web page&quot;&gt;</span>
<a href="#l6.31"></a><span id="l6.31"> &lt;!ENTITY quickMode.accesskey         &quot;h&quot;&gt;</span>
<a href="#l6.32"></a><span id="l6.32"> </span>
<a href="#l6.33"></a><span id="l6.33"> &lt;!ENTITY autotagEnable.label         &quot;Automatically create tags from feed &amp;lt;category&amp;gt; names&quot;&gt;</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-&lt;!ENTITY autotagEnable.accesskey     &quot;c&quot;&gt;</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+&lt;!ENTITY autotagEnable.accesskey     &quot;o&quot;&gt;</span>
<a href="#l6.36"></a><span id="l6.36"> &lt;!ENTITY autotagUsePrefix.label      &quot;Prefix tags with:&quot;&gt;</span>
<a href="#l6.37"></a><span id="l6.37"> &lt;!ENTITY autotagUsePrefix.accesskey  &quot;P&quot;&gt;</span>
<a href="#l6.38"></a><span id="l6.38"> &lt;!ENTITY autoTagPrefix.placeholder   &quot;Enter a tag prefix&quot;&gt;</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+&lt;!-- Subscription Dialog --&gt;</span>
<a href="#l6.41"></a><span id="l6.41"> &lt;!ENTITY button.addFeed.label        &quot;Add&quot;&gt;</span>
<a href="#l6.42"></a><span id="l6.42"> &lt;!ENTITY button.addFeed.accesskey    &quot;A&quot;&gt;</span>
<a href="#l6.43"></a><span id="l6.43"> &lt;!ENTITY button.updateFeed.label     &quot;Update&quot;&gt;</span>
<a href="#l6.44"></a><span id="l6.44"> &lt;!ENTITY button.updateFeed.accesskey &quot;U&quot;&gt;</span>
<a href="#l6.45"></a><span id="l6.45"> &lt;!ENTITY button.removeFeed.label     &quot;Remove&quot;&gt;</span>
<a href="#l6.46"></a><span id="l6.46"> &lt;!ENTITY button.removeFeed.accesskey &quot;R&quot;&gt;</span>
<a href="#l6.47"></a><span id="l6.47"> &lt;!ENTITY button.importOPML.label     &quot;Import&quot;&gt;</span>
<a href="#l6.48"></a><span id="l6.48"> &lt;!ENTITY button.importOPML.accesskey &quot;I&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.dtd</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.dtd</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -629,16 +629,19 @@</span>
<a href="#l7.4"></a><span id="l7.4"> &lt;!ENTITY folderNameColumn.label &quot;Name&quot;&gt;</span>
<a href="#l7.5"></a><span id="l7.5"> &lt;!ENTITY folderUnreadColumn.label &quot;Unread&quot;&gt;</span>
<a href="#l7.6"></a><span id="l7.6"> &lt;!ENTITY folderTotalColumn.label &quot;Total&quot;&gt;</span>
<a href="#l7.7"></a><span id="l7.7"> &lt;!ENTITY folderSizeColumn.label &quot;Size&quot;&gt;</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> &lt;!-- Folder Pane Context Menu --&gt;</span>
<a href="#l7.10"></a><span id="l7.10"> &lt;!ENTITY folderContextGetMessages.label &quot;Get Messages&quot;&gt;</span>
<a href="#l7.11"></a><span id="l7.11"> &lt;!ENTITY folderContextGetMessages.accesskey &quot;G&quot;&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+&lt;!ENTITY folderContextPauseAllUpdates.label &quot;Pause All Updates&quot;&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+&lt;!ENTITY folderContextPauseUpdates.label &quot;Pause Updates&quot;&gt;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+&lt;!ENTITY folderContextPauseUpdates.accesskey &quot;U&quot;&gt;</span>
<a href="#l7.15"></a><span id="l7.15"> &lt;!ENTITY folderContextOpenInNewWindow.label &quot;Open in New Window&quot;&gt;</span>
<a href="#l7.16"></a><span id="l7.16"> &lt;!ENTITY folderContextOpenInNewWindow.accesskey &quot;O&quot;&gt;</span>
<a href="#l7.17"></a><span id="l7.17"> &lt;!ENTITY folderContextOpenNewTab.label &quot;Open in New Tab&quot;&gt;</span>
<a href="#l7.18"></a><span id="l7.18"> &lt;!ENTITY folderContextOpenNewTab.accesskey &quot;T&quot;&gt;</span>
<a href="#l7.19"></a><span id="l7.19"> &lt;!ENTITY folderContextNew.label &quot;New Subfolder…&quot;&gt;</span>
<a href="#l7.20"></a><span id="l7.20"> &lt;!ENTITY folderContextNew.accesskey &quot;N&quot;&gt;</span>
<a href="#l7.21"></a><span id="l7.21"> &lt;!ENTITY folderContextRename.label &quot;Rename&quot;&gt;</span>
<a href="#l7.22"></a><span id="l7.22"> &lt;!ENTITY folderContextRename.accesskey &quot;R&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/themes/linux/mail/folderPane.css</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/themes/linux/mail/folderPane.css</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -22,21 +22,16 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l8.4"></a><span id="l8.4"> /* ..... Shared folders .....</span>
<a href="#l8.5"></a><span id="l8.5"> treechildren::-moz-tree-image(folderNameCol, imapShared-true) {</span>
<a href="#l8.6"></a><span id="l8.6"> } */</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> treechildren::-moz-tree-image(folderNameCol, newMessages-true) {</span>
<a href="#l8.9"></a><span id="l8.9">   list-style-image: url(&quot;moz-icon://stock/gtk-directory?size=menu&quot;);</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-treechildren::-moz-tree-image(folderNameCol, isFeedFolder-true, newMessages-true) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-  list-style-image: url(&quot;chrome://messenger-newsblog/skin/icons/rss-feed.png&quot;);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-  -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-}</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-</span>
<a href="#l8.17"></a><span id="l8.17"> /* ..... Inbox ..... */</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19"> .tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;],</span>
<a href="#l8.20"></a><span id="l8.20"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox) {</span>
<a href="#l8.21"></a><span id="l8.21">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l8.22"></a><span id="l8.22">   -moz-image-region: rect(64px 16px 80px 0px);</span>
<a href="#l8.23"></a><span id="l8.23"> }</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25" class="difflineat">@@ -109,23 +104,49 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l8.26"></a><span id="l8.26"> .tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;],</span>
<a href="#l8.27"></a><span id="l8.27"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp) {</span>
<a href="#l8.28"></a><span id="l8.28">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l8.29"></a><span id="l8.29">   -moz-image-region: rect(208px 16px 224px 0px);</span>
<a href="#l8.30"></a><span id="l8.30"> }</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32"> /* ..... Feed ..... */</span>
<a href="#l8.33"></a><span id="l8.33"> </span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, isFeed-true) {</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger-newsblog/skin/icons/rss-feed.png&quot;);</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+  -moz-image-region: rect(32px 16px 48px 0);</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+  width: 16px;</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  height: 16px;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+}</span>
<a href="#l8.40"></a><span id="l8.40"> .tabmail-tab[type=&quot;folder&quot;][IsFeedFolder=&quot;true&quot;],</span>
<a href="#l8.41"></a><span id="l8.41"> treechildren::-moz-tree-image(folderNameCol, isFeedFolder-true) {</span>
<a href="#l8.42"></a><span id="l8.42">   list-style-image: url(&quot;chrome://messenger-newsblog/skin/icons/rss-feed.png&quot;);</span>
<a href="#l8.43"></a><span id="l8.43">   -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l8.44"></a><span id="l8.44">   width: 16px;</span>
<a href="#l8.45"></a><span id="l8.45">   height: 16px;</span>
<a href="#l8.46"></a><span id="l8.46"> }</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, isFeedFolder-true, newMessages-true) {</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger-newsblog/skin/icons/rss-feed.png&quot;);</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+  -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+}</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, serverIsPaused),</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+treechildren::-moz-tree-cell-text(folderNameCol, serverIsPaused),</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, isPaused),</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+treechildren::-moz-tree-cell-text(folderNameCol, isPaused) {</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+  opacity: 0.4;</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+}</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, closed, isBusy),</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, leaf, isBusy) {</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/status.png&quot;);</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+  -moz-image-region: rect(0 32px 16px 16px);</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+}</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, closed, hasError),</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, leaf, hasError) {</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/error-16.png&quot;);</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+  -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+}</span>
<a href="#l8.67"></a><span id="l8.67"> </span>
<a href="#l8.68"></a><span id="l8.68"> treechildren::-moz-tree-cell-text(folderNameCol, newMessages-true),</span>
<a href="#l8.69"></a><span id="l8.69"> treechildren::-moz-tree-cell-text(folderNameCol, specialFolder-Inbox, newMessages-true) {</span>
<a href="#l8.70"></a><span id="l8.70">   font-weight: bold;</span>
<a href="#l8.71"></a><span id="l8.71"> }</span>
<a href="#l8.72"></a><span id="l8.72"> </span>
<a href="#l8.73"></a><span id="l8.73"> /* ..... Mail server  ..... */</span>
<a href="#l8.74"></a><span id="l8.74"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/themes/linux/mail/newsblog/feed-subscriptions.css</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/themes/linux/mail/newsblog/feed-subscriptions.css</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -32,15 +32,8 @@</span>
<a href="#l9.4"></a><span id="l9.4"> }</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6"> #nameValue,</span>
<a href="#l9.7"></a><span id="l9.7"> #locationValue,</span>
<a href="#l9.8"></a><span id="l9.8"> #selectFolderValue {</span>
<a href="#l9.9"></a><span id="l9.9">   padding-top: 0;</span>
<a href="#l9.10"></a><span id="l9.10">   padding-bottom: 1px;</span>
<a href="#l9.11"></a><span id="l9.11"> }</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-treechildren::-moz-tree-image(folderNameCol, isFeed-true) {</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-  list-style-image: url(&quot;chrome://messenger-newsblog/skin/icons/rss-feed.png&quot;);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-  -moz-image-region: rect(32px 16px 48px 0);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-  width: 16px;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-  height: 16px;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/themes/osx/mail/folderPane.css</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/themes/osx/mail/folderPane.css</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -27,23 +27,45 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> /* ..... News Folders ..... */</span>
<a href="#l10.6"></a><span id="l10.6"> .tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;],</span>
<a href="#l10.7"></a><span id="l10.7"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp) {</span>
<a href="#l10.8"></a><span id="l10.8">   -moz-image-region: rect(0 160px 16px 144px);</span>
<a href="#l10.9"></a><span id="l10.9"> }</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11"> /* ..... Feed Folders ..... */</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, isFeed-true) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger-newsblog/skin/rss-feed.png&quot;);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+  -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+  width: 16px;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+  height: 16px;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+}</span>
<a href="#l10.18"></a><span id="l10.18"> .tabmail-tab[type=&quot;folder&quot;][IsFeedFolder=&quot;true&quot;],</span>
<a href="#l10.19"></a><span id="l10.19"> treechildren::-moz-tree-image(folderNameCol, isFeedFolder-true) {</span>
<a href="#l10.20"></a><span id="l10.20">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l10.21"></a><span id="l10.21">   -moz-image-region: rect(0 224px 16px 208px);</span>
<a href="#l10.22"></a><span id="l10.22">   width: 16px;</span>
<a href="#l10.23"></a><span id="l10.23">   height: 16px;</span>
<a href="#l10.24"></a><span id="l10.24"> }</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, serverIsPaused),</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+treechildren::-moz-tree-cell-text(folderNameCol, serverIsPaused),</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, isPaused),</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+treechildren::-moz-tree-cell-text(folderNameCol, isPaused) {</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+  opacity: 0.4;</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+}</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, closed, isBusy),</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, leaf, isBusy) {</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/status.png&quot;);</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+  -moz-image-region: rect(0 32px 16px 16px);</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+}</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, closed, hasError),</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, leaf, hasError) {</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/error-16.png&quot;);</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+  -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+}</span>
<a href="#l10.41"></a><span id="l10.41"> </span>
<a href="#l10.42"></a><span id="l10.42"> /* ..... Inbox ..... */</span>
<a href="#l10.43"></a><span id="l10.43"> .tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;],</span>
<a href="#l10.44"></a><span id="l10.44"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox),</span>
<a href="#l10.45"></a><span id="l10.45"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox, newMessages-true) {</span>
<a href="#l10.46"></a><span id="l10.46">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l10.47"></a><span id="l10.47">   -moz-image-region: rect(0 48px 16px 32px);</span>
<a href="#l10.48"></a><span id="l10.48"> }</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineat">@@ -123,21 +145,35 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l10.50"></a><span id="l10.50"> </span>
<a href="#l10.51"></a><span id="l10.51">   /* ..... News Folders ..... */</span>
<a href="#l10.52"></a><span id="l10.52">   .tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;],</span>
<a href="#l10.53"></a><span id="l10.53">   treechildren::-moz-tree-image(folderNameCol, serverType-nntp) {</span>
<a href="#l10.54"></a><span id="l10.54">     -moz-image-region: rect(0 320px 32px 288px);</span>
<a href="#l10.55"></a><span id="l10.55">   }</span>
<a href="#l10.56"></a><span id="l10.56"> </span>
<a href="#l10.57"></a><span id="l10.57">   /* ..... Feed Folders ..... */</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+  treechildren::-moz-tree-image(folderNameCol, isFeed-true) {</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+    list-style-image: url(&quot;chrome://messenger-newsblog/skin/rss-feed@2x.png&quot;);</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+    -moz-image-region: rect(0 32px 32px 0);</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+  }</span>
<a href="#l10.62"></a><span id="l10.62">   .tabmail-tab[type=&quot;folder&quot;][IsFeedFolder=&quot;true&quot;],</span>
<a href="#l10.63"></a><span id="l10.63">   treechildren::-moz-tree-image(folderNameCol, isFeedFolder-true) {</span>
<a href="#l10.64"></a><span id="l10.64">     list-style-image: url(&quot;chrome://messenger/skin/icons/folder-pane@2x.png&quot;);</span>
<a href="#l10.65"></a><span id="l10.65">     -moz-image-region: rect(0 448px 32px 416px);</span>
<a href="#l10.66"></a><span id="l10.66">   }</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+  treechildren::-moz-tree-image(folderNameCol, closed, isBusy),</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+  treechildren::-moz-tree-image(folderNameCol, leaf, isBusy) {</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+    list-style-image: url(&quot;chrome://messenger/skin/icons/status@2x.png&quot;);</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+    -moz-image-region: rect(0 64px 32px 32px);</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+  }</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+  treechildren::-moz-tree-image(folderNameCol, closed, hasError),</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+  treechildren::-moz-tree-image(folderNameCol, leaf, hasError) {</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+    list-style-image: url(&quot;chrome://global/skin/icons/error.png&quot;);</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+    -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+  }</span>
<a href="#l10.77"></a><span id="l10.77"> </span>
<a href="#l10.78"></a><span id="l10.78">   /* ..... Inbox ..... */</span>
<a href="#l10.79"></a><span id="l10.79">   .tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;],</span>
<a href="#l10.80"></a><span id="l10.80">   treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox),</span>
<a href="#l10.81"></a><span id="l10.81">   treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox, newMessages-true) {</span>
<a href="#l10.82"></a><span id="l10.82">     list-style-image: url(&quot;chrome://messenger/skin/icons/folder-pane@2x.png&quot;);</span>
<a href="#l10.83"></a><span id="l10.83">     -moz-image-region: rect(0 96px 32px 64px);</span>
<a href="#l10.84"></a><span id="l10.84">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/themes/osx/mail/newsblog/feed-subscriptions.css</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/themes/osx/mail/newsblog/feed-subscriptions.css</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -20,22 +20,8 @@</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> #statusContainerBox {</span>
<a href="#l11.6"></a><span id="l11.6">   height: 2.3em;</span>
<a href="#l11.7"></a><span id="l11.7"> }</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> #autotagPrefix {</span>
<a href="#l11.10"></a><span id="l11.10">   width: 35ch;</span>
<a href="#l11.11"></a><span id="l11.11"> }</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-treechildren::-moz-tree-image(folderNameCol, isFeed-true) {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-  list-style-image: url(&quot;chrome://messenger-newsblog/skin/rss-feed.png&quot;);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-  -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-  width: 16px;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-  height: 16px;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-}</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-@media (min-resolution: 2dppx) {</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-  treechildren::-moz-tree-image(folderNameCol, isFeed-true) {</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-    list-style-image: url(&quot;chrome://messenger-newsblog/skin/rss-feed@2x.png&quot;);</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-    -moz-image-region: rect(0 32px 32px 0);</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-  }</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/themes/windows/mail/folderPane.css</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/themes/windows/mail/folderPane.css</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -39,28 +39,49 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l12.4"></a><span id="l12.4"> .tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;],</span>
<a href="#l12.5"></a><span id="l12.5"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp),</span>
<a href="#l12.6"></a><span id="l12.6"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp, open) {</span>
<a href="#l12.7"></a><span id="l12.7">   -moz-image-region: rect(0 160px 16px 144px);</span>
<a href="#l12.8"></a><span id="l12.8"> }</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10"> /* ..... Feed ..... */</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, isFeed-true) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger-newsblog/skin/icons/rss-feed.png&quot;);</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+  -moz-image-region: rect(32px 16px 48px 0);</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+  width: 16px;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+  height: 16px;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+}</span>
<a href="#l12.18"></a><span id="l12.18"> .tabmail-tab[type=&quot;folder&quot;][IsFeedFolder=&quot;true&quot;],</span>
<a href="#l12.19"></a><span id="l12.19"> treechildren::-moz-tree-image(folderNameCol, isFeedFolder-true),</span>
<a href="#l12.20"></a><span id="l12.20"> treechildren::-moz-tree-image(folderNameCol, isFeedFolder-true, open) {</span>
<a href="#l12.21"></a><span id="l12.21">   list-style-image: url(&quot;chrome://messenger-newsblog/skin/icons/rss-feed.png&quot;);</span>
<a href="#l12.22"></a><span id="l12.22">   -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l12.23"></a><span id="l12.23">   width: 16px;</span>
<a href="#l12.24"></a><span id="l12.24">   height: 16px;</span>
<a href="#l12.25"></a><span id="l12.25"> }</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-</span>
<a href="#l12.27"></a><span id="l12.27"> treechildren::-moz-tree-image(folderNameCol, isFeedFolder-true, newMessages-true) {</span>
<a href="#l12.28"></a><span id="l12.28">   -moz-image-region: rect(16px 16px 32px 0);</span>
<a href="#l12.29"></a><span id="l12.29"> }</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, serverIsPaused),</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+treechildren::-moz-tree-cell-text(folderNameCol, serverIsPaused),</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, isPaused),</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+treechildren::-moz-tree-cell-text(folderNameCol, isPaused) {</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+  opacity: 0.4;</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+}</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, closed, isBusy),</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, leaf, isBusy) {</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/status.png&quot;);</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+  -moz-image-region: rect(0 32px 16px 16px);</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+}</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, closed, hasError),</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol, leaf, hasError) {</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/error-16.png&quot;);</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+  -moz-image-region: rect(0 16px 16px 0);</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+}</span>
<a href="#l12.46"></a><span id="l12.46"> </span>
<a href="#l12.47"></a><span id="l12.47"> /* ..... Inbox ..... */</span>
<a href="#l12.48"></a><span id="l12.48"> </span>
<a href="#l12.49"></a><span id="l12.49"> .tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;],</span>
<a href="#l12.50"></a><span id="l12.50"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox),</span>
<a href="#l12.51"></a><span id="l12.51"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox, open) {</span>
<a href="#l12.52"></a><span id="l12.52">   -moz-image-region: rect(0 48px 16px 32px);</span>
<a href="#l12.53"></a><span id="l12.53"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/themes/windows/mail/newsblog/feed-subscriptions.css</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/themes/windows/mail/newsblog/feed-subscriptions.css</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -39,15 +39,8 @@</span>
<a href="#l13.4"></a><span id="l13.4"> }</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> #nameValue,</span>
<a href="#l13.7"></a><span id="l13.7"> #locationValue,</span>
<a href="#l13.8"></a><span id="l13.8"> #selectFolderValue {</span>
<a href="#l13.9"></a><span id="l13.9">   padding-top: 0;</span>
<a href="#l13.10"></a><span id="l13.10">   padding-bottom: 1px;</span>
<a href="#l13.11"></a><span id="l13.11"> }</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-treechildren::-moz-tree-image(folderNameCol, isFeed-true) {</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-  list-style-image: url(&quot;chrome://messenger-newsblog/skin/icons/rss-feed.png&quot;);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-  -moz-image-region: rect(32px 16px 48px 0);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-  width: 16px;</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-  height: 16px;</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/Feed.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/Feed.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -47,17 +47,17 @@ var FeedCache =</span>
<a href="#l14.4"></a><span id="l14.4"> };</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> function Feed(aResource, aRSSServer)</span>
<a href="#l14.7"></a><span id="l14.7"> {</span>
<a href="#l14.8"></a><span id="l14.8">   this.resource = aResource.QueryInterface(Ci.nsIRDFResource);</span>
<a href="#l14.9"></a><span id="l14.9">   this.server = aRSSServer;</span>
<a href="#l14.10"></a><span id="l14.10"> }</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-Feed.prototype = </span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+Feed.prototype =</span>
<a href="#l14.14"></a><span id="l14.14"> {</span>
<a href="#l14.15"></a><span id="l14.15">   description: null,</span>
<a href="#l14.16"></a><span id="l14.16">   author: null,</span>
<a href="#l14.17"></a><span id="l14.17">   request: null,</span>
<a href="#l14.18"></a><span id="l14.18">   server: null,</span>
<a href="#l14.19"></a><span id="l14.19">   downloadCallback: null,</span>
<a href="#l14.20"></a><span id="l14.20">   resource: null,</span>
<a href="#l14.21"></a><span id="l14.21">   items: new Array(),</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -194,34 +194,34 @@ Feed.prototype =</span>
<a href="#l14.23"></a><span id="l14.23">     // refresh cycle (i.e. not if the request is cancelled).</span>
<a href="#l14.24"></a><span id="l14.24">     let lastModifiedHeader = request.getResponseHeader(&quot;Last-Modified&quot;);</span>
<a href="#l14.25"></a><span id="l14.25">     feed.mLastModified = (lastModifiedHeader &amp;&amp; feed.parseItems) ?</span>
<a href="#l14.26"></a><span id="l14.26">                            lastModifiedHeader : null;</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28">     // The download callback is called asynchronously when parse() is done.</span>
<a href="#l14.29"></a><span id="l14.29">     feed.parse();</span>
<a href="#l14.30"></a><span id="l14.30">   },</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-  </span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-  onProgress: function(aEvent) </span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+  onProgress: function(aEvent)</span>
<a href="#l14.35"></a><span id="l14.35">   {</span>
<a href="#l14.36"></a><span id="l14.36">     let request = aEvent.target;</span>
<a href="#l14.37"></a><span id="l14.37">     let url = request.channel.originalURI.spec;</span>
<a href="#l14.38"></a><span id="l14.38">     let feed = FeedCache.getFeed(url);</span>
<a href="#l14.39"></a><span id="l14.39"> </span>
<a href="#l14.40"></a><span id="l14.40">     if (feed.downloadCallback)</span>
<a href="#l14.41"></a><span id="l14.41">       feed.downloadCallback.onProgress(feed, aEvent.loaded, aEvent.total,</span>
<a href="#l14.42"></a><span id="l14.42">                                        aEvent.lengthComputable);</span>
<a href="#l14.43"></a><span id="l14.43">   },</span>
<a href="#l14.44"></a><span id="l14.44"> </span>
<a href="#l14.45"></a><span id="l14.45">   onDownloadError: function(aEvent)</span>
<a href="#l14.46"></a><span id="l14.46">   {</span>
<a href="#l14.47"></a><span id="l14.47">     let request = aEvent.target;</span>
<a href="#l14.48"></a><span id="l14.48">     let url = request.channel.originalURI.spec;</span>
<a href="#l14.49"></a><span id="l14.49">     let feed = FeedCache.getFeed(url);</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-    if (feed.downloadCallback) </span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+    if (feed.downloadCallback)</span>
<a href="#l14.52"></a><span id="l14.52">     {</span>
<a href="#l14.53"></a><span id="l14.53">       // Generic network or 'not found' error initially.</span>
<a href="#l14.54"></a><span id="l14.54">       let error = FeedUtils.kNewsBlogRequestFailure;</span>
<a href="#l14.55"></a><span id="l14.55"> </span>
<a href="#l14.56"></a><span id="l14.56">       if (request.status == 304) {</span>
<a href="#l14.57"></a><span id="l14.57">         // If the http status code is 304, the feed has not been modified</span>
<a href="#l14.58"></a><span id="l14.58">         // since we last downloaded it and does not need to be parsed.</span>
<a href="#l14.59"></a><span id="l14.59">         error = FeedUtils.kNewsBlogNoNewItems;</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineat">@@ -345,59 +345,53 @@ Feed.prototype =</span>
<a href="#l14.61"></a><span id="l14.61"> </span>
<a href="#l14.62"></a><span id="l14.62">     return quickMode;</span>
<a href="#l14.63"></a><span id="l14.63">   },</span>
<a href="#l14.64"></a><span id="l14.64"> </span>
<a href="#l14.65"></a><span id="l14.65">   set quickMode (aNewQuickMode)</span>
<a href="#l14.66"></a><span id="l14.66">   {</span>
<a href="#l14.67"></a><span id="l14.67">     let ds = FeedUtils.getSubscriptionsDS(this.server);</span>
<a href="#l14.68"></a><span id="l14.68">     aNewQuickMode = FeedUtils.rdf.GetLiteral(aNewQuickMode);</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-    let old_quickMode = ds.GetTarget(this.resource, </span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+    let old_quickMode = ds.GetTarget(this.resource,</span>
<a href="#l14.71"></a><span id="l14.71">                                      FeedUtils.FZ_QUICKMODE,</span>
<a href="#l14.72"></a><span id="l14.72">                                      true);</span>
<a href="#l14.73"></a><span id="l14.73">     if (old_quickMode)</span>
<a href="#l14.74"></a><span id="l14.74">       ds.Change(this.resource, FeedUtils.FZ_QUICKMODE,</span>
<a href="#l14.75"></a><span id="l14.75">                 old_quickMode, aNewQuickMode);</span>
<a href="#l14.76"></a><span id="l14.76">     else</span>
<a href="#l14.77"></a><span id="l14.77">       ds.Assert(this.resource, FeedUtils.FZ_QUICKMODE,</span>
<a href="#l14.78"></a><span id="l14.78">                 aNewQuickMode, true);</span>
<a href="#l14.79"></a><span id="l14.79">   },</span>
<a href="#l14.80"></a><span id="l14.80"> </span>
<a href="#l14.81"></a><span id="l14.81">   get options ()</span>
<a href="#l14.82"></a><span id="l14.82">   {</span>
<a href="#l14.83"></a><span id="l14.83">     let ds = FeedUtils.getSubscriptionsDS(this.server);</span>
<a href="#l14.84"></a><span id="l14.84">     let options = ds.GetTarget(this.resource, FeedUtils.FZ_OPTIONS, true);</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-    if (options)</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-      return JSON.parse(options.QueryInterface(Ci.nsIRDFLiteral).Value);</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+    options = options ? JSON.parse(options.QueryInterface(Ci.nsIRDFLiteral).Value) :</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+                        null;</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+    if (options &amp;&amp; options.version == FeedUtils._optionsDefault.version)</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+      return options;</span>
<a href="#l14.91"></a><span id="l14.91"> </span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-    return null;</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+    let newOptions = FeedUtils.newOptions(options);</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+    this.options = newOptions;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+    return newOptions;</span>
<a href="#l14.96"></a><span id="l14.96">   },</span>
<a href="#l14.97"></a><span id="l14.97"> </span>
<a href="#l14.98"></a><span id="l14.98">   set options (aOptions)</span>
<a href="#l14.99"></a><span id="l14.99">   {</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-    let newOptions = aOptions ? FeedUtils.newOptions(aOptions) :</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-                                FeedUtils._optionsDefault;</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineplus">+    let newOptions = aOptions ? aOptions : FeedUtils.optionsTemplate;</span>
<a href="#l14.103"></a><span id="l14.103">     let ds = FeedUtils.getSubscriptionsDS(this.server);</span>
<a href="#l14.104"></a><span id="l14.104">     newOptions = FeedUtils.rdf.GetLiteral(JSON.stringify(newOptions));</span>
<a href="#l14.105"></a><span id="l14.105">     let oldOptions = ds.GetTarget(this.resource, FeedUtils.FZ_OPTIONS, true);</span>
<a href="#l14.106"></a><span id="l14.106">     if (oldOptions)</span>
<a href="#l14.107"></a><span id="l14.107">       ds.Change(this.resource, FeedUtils.FZ_OPTIONS, oldOptions, newOptions);</span>
<a href="#l14.108"></a><span id="l14.108">     else</span>
<a href="#l14.109"></a><span id="l14.109">       ds.Assert(this.resource, FeedUtils.FZ_OPTIONS, newOptions, true);</span>
<a href="#l14.110"></a><span id="l14.110">   },</span>
<a href="#l14.111"></a><span id="l14.111"> </span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-  categoryPrefs: function ()</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-  {</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineminus">-    let categoryPrefsAcct = FeedUtils.getOptionsAcct(this.server).category;</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineminus">-    if (!this.options)</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-      return categoryPrefsAcct;</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-    return this.options.category;</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineminus">-  },</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-</span>
<a href="#l14.121"></a><span id="l14.121">   get link ()</span>
<a href="#l14.122"></a><span id="l14.122">   {</span>
<a href="#l14.123"></a><span id="l14.123">     let ds = FeedUtils.getSubscriptionsDS(this.server);</span>
<a href="#l14.124"></a><span id="l14.124">     let link = ds.GetTarget(this.resource, FeedUtils.RSS_LINK, true);</span>
<a href="#l14.125"></a><span id="l14.125">     if (link)</span>
<a href="#l14.126"></a><span id="l14.126">       link = link.QueryInterface(Ci.nsIRDFLiteral).Value;</span>
<a href="#l14.127"></a><span id="l14.127"> </span>
<a href="#l14.128"></a><span id="l14.128">     return link;</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineat">@@ -600,17 +594,16 @@ Feed.prototype =</span>
<a href="#l14.130"></a><span id="l14.130">       FeedUtils.log.debug(&quot;Feed.cleanupParsingState: items stored - &quot; + this.itemsStored);</span>
<a href="#l14.131"></a><span id="l14.131">     }</span>
<a href="#l14.132"></a><span id="l14.132"> </span>
<a href="#l14.133"></a><span id="l14.133">     // Force the xml http request to go away.  This helps reduce some nasty</span>
<a href="#l14.134"></a><span id="l14.134">     // assertions on shut down.</span>
<a href="#l14.135"></a><span id="l14.135">     this.request = null;</span>
<a href="#l14.136"></a><span id="l14.136">     this.itemsToStore = &quot;&quot;;</span>
<a href="#l14.137"></a><span id="l14.137">     this.itemsToStoreIndex = 0;</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineminus">-    this.itemsStored = 0;</span>
<a href="#l14.139"></a><span id="l14.139">     this.storeItemsTimer = null;</span>
<a href="#l14.140"></a><span id="l14.140"> </span>
<a href="#l14.141"></a><span id="l14.141">     if (aFeed.downloadCallback)</span>
<a href="#l14.142"></a><span id="l14.142">       aFeed.downloadCallback.downloaded(aFeed, aCode);</span>
<a href="#l14.143"></a><span id="l14.143">   },</span>
<a href="#l14.144"></a><span id="l14.144"> </span>
<a href="#l14.145"></a><span id="l14.145">   // nsITimerCallback</span>
<a href="#l14.146"></a><span id="l14.146">   notify: function(aTimer)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/FeedItem.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/FeedItem.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -209,17 +209,17 @@ FeedItem.prototype =</span>
<a href="#l15.4"></a><span id="l15.4">                          FeedUtils.rdf.GetResource(this.feed.url), true))</span>
<a href="#l15.5"></a><span id="l15.5">       ds.Assert(resource, FeedUtils.FZ_FEED,</span>
<a href="#l15.6"></a><span id="l15.6">                 FeedUtils.rdf.GetResource(this.feed.url), true);</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">     let currentValue;</span>
<a href="#l15.9"></a><span id="l15.9">     if (ds.hasArcOut(resource, FeedUtils.FZ_STORED))</span>
<a href="#l15.10"></a><span id="l15.10">     {</span>
<a href="#l15.11"></a><span id="l15.11">       currentValue = ds.GetTarget(resource, FeedUtils.FZ_STORED, true);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-      ds.Change(resource, FeedUtils.FZ_STORED, </span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+      ds.Change(resource, FeedUtils.FZ_STORED,</span>
<a href="#l15.14"></a><span id="l15.14">                 currentValue, FeedUtils.RDF_LITERAL_TRUE);</span>
<a href="#l15.15"></a><span id="l15.15">     }</span>
<a href="#l15.16"></a><span id="l15.16">     else</span>
<a href="#l15.17"></a><span id="l15.17">       ds.Assert(resource, FeedUtils.FZ_STORED,</span>
<a href="#l15.18"></a><span id="l15.18">                 FeedUtils.RDF_LITERAL_TRUE, true);</span>
<a href="#l15.19"></a><span id="l15.19">   },</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21">   mimeEncodeSubject: function(aSubject, aCharset)</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -371,24 +371,24 @@ FeedItem.prototype =</span>
<a href="#l15.23"></a><span id="l15.23"> /**</span>
<a href="#l15.24"></a><span id="l15.24">  * Autotag messages.</span>
<a href="#l15.25"></a><span id="l15.25">  *</span>
<a href="#l15.26"></a><span id="l15.26">  * @param  nsIMsgDBHdr aMsgDBHdr - message to tag</span>
<a href="#l15.27"></a><span id="l15.27">  * @param  array aKeywords       - keywords (tags)</span>
<a href="#l15.28"></a><span id="l15.28">  */</span>
<a href="#l15.29"></a><span id="l15.29">   tagItem: function(aMsgDBHdr, aKeywords)</span>
<a href="#l15.30"></a><span id="l15.30">   {</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-    let categoryPrefs = this.feed.categoryPrefs();</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-    if (!aKeywords.length || !categoryPrefs.enabled)</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+    let category = this.feed.options.category;</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+    if (!aKeywords.length || !category.enabled)</span>
<a href="#l15.35"></a><span id="l15.35">       return;</span>
<a href="#l15.36"></a><span id="l15.36"> </span>
<a href="#l15.37"></a><span id="l15.37">     let msgArray = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l15.38"></a><span id="l15.38">     msgArray.appendElement(aMsgDBHdr, false);</span>
<a href="#l15.39"></a><span id="l15.39"> </span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-    let prefix = categoryPrefs.prefixEnabled ? categoryPrefs.prefix : &quot;&quot;;</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+    let prefix = category.prefixEnabled ? category.prefix : &quot;&quot;;</span>
<a href="#l15.42"></a><span id="l15.42">     let rtl = Services.prefs.getIntPref(&quot;bidi.direction&quot;) == 2;</span>
<a href="#l15.43"></a><span id="l15.43"> </span>
<a href="#l15.44"></a><span id="l15.44">     let keys = [];</span>
<a href="#l15.45"></a><span id="l15.45">     for (let keyword of aKeywords)</span>
<a href="#l15.46"></a><span id="l15.46">     {</span>
<a href="#l15.47"></a><span id="l15.47">       keyword = rtl ? keyword + prefix : prefix + keyword;</span>
<a href="#l15.48"></a><span id="l15.48">       let keyForTag = MailServices.tags.getKeyForTag(keyword);</span>
<a href="#l15.49"></a><span id="l15.49">       if (!keyForTag)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/FeedUtils.jsm</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/FeedUtils.jsm</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -36,16 +36,21 @@ var FeedUtils = {</span>
<a href="#l16.4"></a><span id="l16.4">   get RSS_ITEM()        { return this.rdf.GetResource(this.RSS_NS + &quot;item&quot;) },</span>
<a href="#l16.5"></a><span id="l16.5">   get RSS_LINK()        { return this.rdf.GetResource(this.RSS_NS + &quot;link&quot;) },</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7">   RSS_CONTENT_NS: &quot;http://purl.org/rss/1.0/modules/content/&quot;,</span>
<a href="#l16.8"></a><span id="l16.8">   get RSS_CONTENT_ENCODED() {</span>
<a href="#l16.9"></a><span id="l16.9">     return this.rdf.GetResource(this.RSS_CONTENT_NS + &quot;encoded&quot;);</span>
<a href="#l16.10"></a><span id="l16.10">   },</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+  RSS_SY_NS: &quot;http://purl.org/rss/1.0/modules/syndication/&quot;,</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  RSS_SY_UNITS:      [&quot;hourly&quot;, &quot;daily&quot;, &quot;weekly&quot;, &quot;monthly&quot;, &quot;yearly&quot;],</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+  kBiffUnitsMinutes: &quot;min&quot;,</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+  kBiffUnitsDays:    &quot;d&quot;,</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+</span>
<a href="#l16.17"></a><span id="l16.17">   DC_NS: &quot;http://purl.org/dc/elements/1.1/&quot;,</span>
<a href="#l16.18"></a><span id="l16.18">   get DC_CREATOR()      { return this.rdf.GetResource(this.DC_NS + &quot;creator&quot;) },</span>
<a href="#l16.19"></a><span id="l16.19">   get DC_SUBJECT()      { return this.rdf.GetResource(this.DC_NS + &quot;subject&quot;) },</span>
<a href="#l16.20"></a><span id="l16.20">   get DC_DATE()         { return this.rdf.GetResource(this.DC_NS + &quot;date&quot;) },</span>
<a href="#l16.21"></a><span id="l16.21">   get DC_TITLE()        { return this.rdf.GetResource(this.DC_NS + &quot;title&quot;) },</span>
<a href="#l16.22"></a><span id="l16.22">   get DC_LASTMODIFIED() { return this.rdf.GetResource(this.DC_NS + &quot;lastModified&quot;) },</span>
<a href="#l16.23"></a><span id="l16.23">   get DC_IDENTIFIER()   { return this.rdf.GetResource(this.DC_NS + &quot;identifier&quot;) },</span>
<a href="#l16.24"></a><span id="l16.24"> </span>
<a href="#l16.25"></a><span id="l16.25" class="difflineat">@@ -84,17 +89,18 @@ var FeedUtils = {</span>
<a href="#l16.26"></a><span id="l16.26">   // Timeout for nonresponse to request, 30 seconds.</span>
<a href="#l16.27"></a><span id="l16.27">   REQUEST_TIMEOUT: 30 * 1000,</span>
<a href="#l16.28"></a><span id="l16.28"> </span>
<a href="#l16.29"></a><span id="l16.29">   // The approximate amount of time, specified in milliseconds, to leave an</span>
<a href="#l16.30"></a><span id="l16.30">   // item in the RDF cache after the item has dissappeared from feeds.</span>
<a href="#l16.31"></a><span id="l16.31">   // The delay is currently one day.</span>
<a href="#l16.32"></a><span id="l16.32">   INVALID_ITEM_PURGE_DELAY: 24 * 60 * 60 * 1000,</span>
<a href="#l16.33"></a><span id="l16.33"> </span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-  kBiffMinutesDefault: 100,</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+  // Polling inverval to check individual feed update interval preference.</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+  kBiffPollMinutes: 1,</span>
<a href="#l16.37"></a><span id="l16.37">   kNewsBlogSuccess: 0,</span>
<a href="#l16.38"></a><span id="l16.38">   // Usually means there was an error trying to parse the feed.</span>
<a href="#l16.39"></a><span id="l16.39">   kNewsBlogInvalidFeed: 1,</span>
<a href="#l16.40"></a><span id="l16.40">   // Generic networking failure when trying to download the feed.</span>
<a href="#l16.41"></a><span id="l16.41">   kNewsBlogRequestFailure: 2,</span>
<a href="#l16.42"></a><span id="l16.42">   kNewsBlogFeedIsBusy: 3,</span>
<a href="#l16.43"></a><span id="l16.43">   // For 304 Not Modified; There are no new articles for this feed.</span>
<a href="#l16.44"></a><span id="l16.44">   kNewsBlogNoNewItems: 4,</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineat">@@ -144,17 +150,17 @@ var FeedUtils = {</span>
<a href="#l16.46"></a><span id="l16.46">     let serverType = &quot;rss&quot;;</span>
<a href="#l16.47"></a><span id="l16.47">     let defaultName = FeedUtils.strings.GetStringFromName(&quot;feeds-accountname&quot;);</span>
<a href="#l16.48"></a><span id="l16.48">     let i = 2;</span>
<a href="#l16.49"></a><span id="l16.49">     while (MailServices.accounts.findRealServer(userName, hostName, serverType, 0))</span>
<a href="#l16.50"></a><span id="l16.50">       // If &quot;Feeds&quot; exists, try &quot;Feeds-2&quot;, then &quot;Feeds-3&quot;, etc.</span>
<a href="#l16.51"></a><span id="l16.51">       hostName = hostNamePref + &quot;-&quot; + i++;</span>
<a href="#l16.52"></a><span id="l16.52"> </span>
<a href="#l16.53"></a><span id="l16.53">     server = MailServices.accounts.createIncomingServer(userName, hostName, serverType);</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-    server.biffMinutes = FeedUtils.kBiffMinutesDefault;</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+    server.biffMinutes = FeedUtils.kBiffPollMinutes;</span>
<a href="#l16.56"></a><span id="l16.56">     server.prettyName = aName ? aName : defaultName;</span>
<a href="#l16.57"></a><span id="l16.57">     server.valid = true;</span>
<a href="#l16.58"></a><span id="l16.58">     let account = MailServices.accounts.createAccount();</span>
<a href="#l16.59"></a><span id="l16.59">     account.incomingServer = server;</span>
<a href="#l16.60"></a><span id="l16.60"> </span>
<a href="#l16.61"></a><span id="l16.61">     // Ensure the Trash folder db (.msf) is created otherwise folder/message</span>
<a href="#l16.62"></a><span id="l16.62">     // deletes will throw until restart creates it.</span>
<a href="#l16.63"></a><span id="l16.63">     server.msgStore.discoverSubFolders(server.rootMsgFolder, false);</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineat">@@ -212,29 +218,47 @@ var FeedUtils = {</span>
<a href="#l16.65"></a><span id="l16.65">  * Download a feed url on biff or get new messages.</span>
<a href="#l16.66"></a><span id="l16.66">  *</span>
<a href="#l16.67"></a><span id="l16.67">  * @param   nsIMsgFolder aFolder         - folder</span>
<a href="#l16.68"></a><span id="l16.68">  * @param   nsIUrlListener aUrlListener  - feed url</span>
<a href="#l16.69"></a><span id="l16.69">  * @param   bool aIsBiff                 - true if biff, false if manual get</span>
<a href="#l16.70"></a><span id="l16.70">  * @param   nsIDOMWindow aMsgWindow      - window</span>
<a href="#l16.71"></a><span id="l16.71">  */</span>
<a href="#l16.72"></a><span id="l16.72">   downloadFeed: function(aFolder, aUrlListener, aIsBiff, aMsgWindow) {</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+    FeedUtils.log.debug(&quot;downloadFeed: account loginAtStartUp:isBiff:isOffline - &quot; +</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+                        aFolder.server.loginAtStartUp + &quot; : &quot; +</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+                        aIsBiff + &quot; : &quot; + Services.io.offline);</span>
<a href="#l16.76"></a><span id="l16.76">     if (Services.io.offline)</span>
<a href="#l16.77"></a><span id="l16.77">       return;</span>
<a href="#l16.78"></a><span id="l16.78"> </span>
<a href="#l16.79"></a><span id="l16.79">     // We don't yet support the ability to check for new articles while we are</span>
<a href="#l16.80"></a><span id="l16.80">     // in the middle of subscribing to a feed. For now, abort the check for</span>
<a href="#l16.81"></a><span id="l16.81">     // new feeds.</span>
<a href="#l16.82"></a><span id="l16.82">     if (FeedUtils.progressNotifier.mSubscribeMode)</span>
<a href="#l16.83"></a><span id="l16.83">     {</span>
<a href="#l16.84"></a><span id="l16.84">       FeedUtils.log.warn(&quot;downloadFeed: Aborting RSS New Mail Check. &quot; +</span>
<a href="#l16.85"></a><span id="l16.85">                          &quot;Feed subscription in progress\n&quot;);</span>
<a href="#l16.86"></a><span id="l16.86">       return;</span>
<a href="#l16.87"></a><span id="l16.87">     }</span>
<a href="#l16.88"></a><span id="l16.88"> </span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+    let forceDownload = !aIsBiff;</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+    if (aFolder.isServer)</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+    {</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineplus">+      // The lastUpdateTime is |null| only at startup/initialization. Check</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+      // if download at startup is wanted; this overrides individual feed</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+      // lastUpdateTime or enabled status, just like manual get messages.</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+      // Setting loginAtStartUp is not very useful for feeds, as the biff poll</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+      // will go off in about kBiffPollMinutes (1) anyway and process each feed</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineplus">+      // according to its own lastUpdatTime/update frequency.</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+      if (FeedUtils.getStatus(aFolder, aFolder.URI).lastUpdateTime === null)</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+        forceDownload = aFolder.server.loginAtStartUp;</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineplus">+      FeedUtils.setStatus(aFolder, aFolder.URI, &quot;lastUpdateTime&quot;, Date.now());</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+    }</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+</span>
<a href="#l16.104"></a><span id="l16.104">     let allFolders = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l16.105"></a><span id="l16.105">     if (!aFolder.isServer) {</span>
<a href="#l16.106"></a><span id="l16.106">       // Add the base folder; it does not get returned by ListDescendants. Do not</span>
<a href="#l16.107"></a><span id="l16.107">       // add the account folder as it doesn't have the feedUrl property or even</span>
<a href="#l16.108"></a><span id="l16.108">       // a msgDatabase necessarily.</span>
<a href="#l16.109"></a><span id="l16.109">       allFolders.appendElement(aFolder, false);</span>
<a href="#l16.110"></a><span id="l16.110">     }</span>
<a href="#l16.111"></a><span id="l16.111"> </span>
<a href="#l16.112"></a><span id="l16.112" class="difflineat">@@ -242,44 +266,71 @@ var FeedUtils = {</span>
<a href="#l16.113"></a><span id="l16.113"> </span>
<a href="#l16.114"></a><span id="l16.114">     let folder;</span>
<a href="#l16.115"></a><span id="l16.115">     function* feeder() {</span>
<a href="#l16.116"></a><span id="l16.116">       let numFolders = allFolders.length;</span>
<a href="#l16.117"></a><span id="l16.117">       for (let i = 0; i &lt; numFolders; i++) {</span>
<a href="#l16.118"></a><span id="l16.118">         folder = allFolders.queryElementAt(i, Ci.nsIMsgFolder);</span>
<a href="#l16.119"></a><span id="l16.119">         FeedUtils.log.debug(&quot;downloadFeed: START x/# foldername:uri - &quot; +</span>
<a href="#l16.120"></a><span id="l16.120">                             (i+1) + &quot;/&quot; + numFolders + &quot; &quot; +</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineminus">-                            folder.name + &quot;:&quot; + folder.URI);</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineminus">-</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineminus">-        // Ensure folder's msgDatabase is openable for new message processing.</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineminus">-        // If not, reparse. After the async reparse the folder will be ready</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineminus">-        // for the next cycle; don't bother with a listener. Continue with</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineminus">-        // the next folder, as attempting to add a message to a folder with</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineminus">-        // an unavailable msgDatabase will throw later.</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineminus">-        if (!FeedUtils.isMsgDatabaseOpenable(folder, true))</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineminus">-          continue;</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineplus">+                            folder.name + &quot; : &quot; + folder.URI);</span>
<a href="#l16.131"></a><span id="l16.131"> </span>
<a href="#l16.132"></a><span id="l16.132">         let feedUrlArray = FeedUtils.getFeedUrlsInFolder(folder);</span>
<a href="#l16.133"></a><span id="l16.133">         // Continue if there are no feedUrls for the folder in the feeds</span>
<a href="#l16.134"></a><span id="l16.134">         // database.  All folders in Trash are skipped.</span>
<a href="#l16.135"></a><span id="l16.135">         if (!feedUrlArray)</span>
<a href="#l16.136"></a><span id="l16.136">           continue;</span>
<a href="#l16.137"></a><span id="l16.137"> </span>
<a href="#l16.138"></a><span id="l16.138">         FeedUtils.log.debug(&quot;downloadFeed: CONTINUE foldername:urlArray - &quot; +</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineminus">-                            folder.name + &quot;:&quot; + feedUrlArray);</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineplus">+                            folder.name + &quot; : &quot; + feedUrlArray);</span>
<a href="#l16.141"></a><span id="l16.141"> </span>
<a href="#l16.142"></a><span id="l16.142">         FeedUtils.progressNotifier.init(aMsgWindow, false);</span>
<a href="#l16.143"></a><span id="l16.143"> </span>
<a href="#l16.144"></a><span id="l16.144">         // We need to kick off a download for each feed.</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineplus">+        let now = Date.now();</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineplus">+        let msgDbOk = false;</span>
<a href="#l16.147"></a><span id="l16.147">         let id, feed;</span>
<a href="#l16.148"></a><span id="l16.148">         for (let url of feedUrlArray)</span>
<a href="#l16.149"></a><span id="l16.149">         {</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineplus">+          // Ensure folder's msgDatabase is openable for new message processing.</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineplus">+          // If not, reparse and break (to the next folder), as attempting to</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+          // add a message to a folder with an unavailable msgDatabase will</span>
<a href="#l16.153"></a><span id="l16.153" class="difflineplus">+          // throw later. After the async reparse the folder will be ready for</span>
<a href="#l16.154"></a><span id="l16.154" class="difflineplus">+          // the next poll cycle to pick up this folder's feeds, whose update</span>
<a href="#l16.155"></a><span id="l16.155" class="difflineplus">+          // time will not have changed.</span>
<a href="#l16.156"></a><span id="l16.156" class="difflineplus">+          if (!msgDbOk) {</span>
<a href="#l16.157"></a><span id="l16.157" class="difflineplus">+            // Only do this test once on the first url.</span>
<a href="#l16.158"></a><span id="l16.158" class="difflineplus">+            msgDbOk = FeedUtils.isMsgDatabaseOpenable(folder, true);</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineplus">+            if (!msgDbOk)</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineplus">+              break;</span>
<a href="#l16.161"></a><span id="l16.161" class="difflineplus">+          }</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineplus">+</span>
<a href="#l16.163"></a><span id="l16.163" class="difflineplus">+          // Check whether this feed should be updated; if forceDownload is true</span>
<a href="#l16.164"></a><span id="l16.164" class="difflineplus">+          // skip the per feed check.</span>
<a href="#l16.165"></a><span id="l16.165" class="difflineplus">+          if (!forceDownload)</span>
<a href="#l16.166"></a><span id="l16.166" class="difflineplus">+          {</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineplus">+            let status = FeedUtils.getStatus(folder, url);</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineplus">+            if (!status.enabled ||</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineplus">+                (now - status.lastUpdateTime &lt; status.updateMinutes * 60000))</span>
<a href="#l16.170"></a><span id="l16.170" class="difflineplus">+            {</span>
<a href="#l16.171"></a><span id="l16.171" class="difflineplus">+              FeedUtils.log.debug(&quot;downloadFeed: SKIP feed, &quot; +</span>
<a href="#l16.172"></a><span id="l16.172" class="difflineplus">+                                  &quot;aIsBiff:enabled:minsSinceLastUpdate::url - &quot; +</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineplus">+                                  aIsBiff + &quot; : &quot; + status.enabled + &quot; : &quot; +</span>
<a href="#l16.174"></a><span id="l16.174" class="difflineplus">+                                  (Math.round((now - status.lastUpdateTime) / 60) / 1000) +&quot; :: &quot;+</span>
<a href="#l16.175"></a><span id="l16.175" class="difflineplus">+                                  url);</span>
<a href="#l16.176"></a><span id="l16.176" class="difflineplus">+              continue;</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineplus">+            }</span>
<a href="#l16.178"></a><span id="l16.178" class="difflineplus">+          }</span>
<a href="#l16.179"></a><span id="l16.179" class="difflineplus">+</span>
<a href="#l16.180"></a><span id="l16.180" class="difflineplus">+          // Update this feed.</span>
<a href="#l16.181"></a><span id="l16.181">           id = FeedUtils.rdf.GetResource(url);</span>
<a href="#l16.182"></a><span id="l16.182">           feed = new Feed(id, folder.server);</span>
<a href="#l16.183"></a><span id="l16.183">           feed.folder = folder;</span>
<a href="#l16.184"></a><span id="l16.184" class="difflineplus">+          // Set status info.</span>
<a href="#l16.185"></a><span id="l16.185" class="difflineplus">+          FeedUtils.setStatus(folder, url, &quot;code&quot;, FeedUtils.kNewsBlogFeedIsBusy);</span>
<a href="#l16.186"></a><span id="l16.186">           // Bump our pending feed download count.</span>
<a href="#l16.187"></a><span id="l16.187">           FeedUtils.progressNotifier.mNumPendingFeedDownloads++;</span>
<a href="#l16.188"></a><span id="l16.188">           feed.download(true, FeedUtils.progressNotifier);</span>
<a href="#l16.189"></a><span id="l16.189">           FeedUtils.log.debug(&quot;downloadFeed: DOWNLOAD feed url - &quot; + url);</span>
<a href="#l16.190"></a><span id="l16.190"> </span>
<a href="#l16.191"></a><span id="l16.191">           Services.tm.mainThread.dispatch(function() {</span>
<a href="#l16.192"></a><span id="l16.192">             try {</span>
<a href="#l16.193"></a><span id="l16.193">               let done = getFeed.next().done;</span>
<a href="#l16.194"></a><span id="l16.194" class="difflineat">@@ -380,30 +431,94 @@ var FeedUtils = {</span>
<a href="#l16.195"></a><span id="l16.195">     {</span>
<a href="#l16.196"></a><span id="l16.196">       aMsgWindow.statusFeedback.showStatusString(</span>
<a href="#l16.197"></a><span id="l16.197">         FeedUtils.strings.GetStringFromName(&quot;subscribe-feedAlreadySubscribed&quot;));</span>
<a href="#l16.198"></a><span id="l16.198">       return;</span>
<a href="#l16.199"></a><span id="l16.199">     }</span>
<a href="#l16.200"></a><span id="l16.200"> </span>
<a href="#l16.201"></a><span id="l16.201">     let itemResource = FeedUtils.rdf.GetResource(aUrl);</span>
<a href="#l16.202"></a><span id="l16.202">     let feed = new Feed(itemResource, aFolder.server);</span>
<a href="#l16.203"></a><span id="l16.203" class="difflineplus">+    // Default setting for new feeds per account settings.</span>
<a href="#l16.204"></a><span id="l16.204">     feed.quickMode = feed.server.getBoolValue(&quot;quickMode&quot;);</span>
<a href="#l16.205"></a><span id="l16.205">     feed.options = FeedUtils.getOptionsAcct(feed.server);</span>
<a href="#l16.206"></a><span id="l16.206"> </span>
<a href="#l16.207"></a><span id="l16.207">     // If the root server, create a new folder for the feed.  The user must</span>
<a href="#l16.208"></a><span id="l16.208">     // want us to add this subscription url to an existing RSS folder.</span>
<a href="#l16.209"></a><span id="l16.209">     if (!aFolder.isServer)</span>
<a href="#l16.210"></a><span id="l16.210">       feed.folder = aFolder;</span>
<a href="#l16.211"></a><span id="l16.211"> </span>
<a href="#l16.212"></a><span id="l16.212">     FeedUtils.progressNotifier.init(aMsgWindow, true);</span>
<a href="#l16.213"></a><span id="l16.213">     FeedUtils.progressNotifier.mNumPendingFeedDownloads++;</span>
<a href="#l16.214"></a><span id="l16.214">     feed.download(true, FeedUtils.progressNotifier);</span>
<a href="#l16.215"></a><span id="l16.215">   },</span>
<a href="#l16.216"></a><span id="l16.216"> </span>
<a href="#l16.217"></a><span id="l16.217"> /**</span>
<a href="#l16.218"></a><span id="l16.218" class="difflineplus">+ * Enable or disable updates for all subscriptions in a folder, or all</span>
<a href="#l16.219"></a><span id="l16.219" class="difflineplus">+ * subscriptions in an account if the folder is the account folder.</span>
<a href="#l16.220"></a><span id="l16.220" class="difflineplus">+ *</span>
<a href="#l16.221"></a><span id="l16.221" class="difflineplus">+ * @param   nsIMsgFolder aFolder     - folder or account folder (server).</span>
<a href="#l16.222"></a><span id="l16.222" class="difflineplus">+ * @param   bool aPause              - to pause or not to pause.</span>
<a href="#l16.223"></a><span id="l16.223" class="difflineplus">+ * @param   bool aBiffNow            - if aPause is false, and aBiffNow is true</span>
<a href="#l16.224"></a><span id="l16.224" class="difflineplus">+ *                                     do the biff immediately.</span>
<a href="#l16.225"></a><span id="l16.225" class="difflineplus">+ */</span>
<a href="#l16.226"></a><span id="l16.226" class="difflineplus">+  pauseFeedFolderUpdates: function(aFolder, aPause, aBiffNow) {</span>
<a href="#l16.227"></a><span id="l16.227" class="difflineplus">+    if (aFolder.isServer)</span>
<a href="#l16.228"></a><span id="l16.228" class="difflineplus">+    {</span>
<a href="#l16.229"></a><span id="l16.229" class="difflineplus">+      let serverFolder = aFolder.server.rootFolder;</span>
<a href="#l16.230"></a><span id="l16.230" class="difflineplus">+      // Remove server from biff first. If enabling biff, this will make the</span>
<a href="#l16.231"></a><span id="l16.231" class="difflineplus">+      // latest biffMinutes take effect now rather than waiting for the timer</span>
<a href="#l16.232"></a><span id="l16.232" class="difflineplus">+      // to expire.</span>
<a href="#l16.233"></a><span id="l16.233" class="difflineplus">+      aFolder.server.doBiff = false;</span>
<a href="#l16.234"></a><span id="l16.234" class="difflineplus">+      if (!aPause)</span>
<a href="#l16.235"></a><span id="l16.235" class="difflineplus">+        aFolder.server.doBiff = true;</span>
<a href="#l16.236"></a><span id="l16.236" class="difflineplus">+</span>
<a href="#l16.237"></a><span id="l16.237" class="difflineplus">+      FeedUtils.setStatus(serverFolder, serverFolder.URI, &quot;enabled&quot;, !aPause);</span>
<a href="#l16.238"></a><span id="l16.238" class="difflineplus">+      if (!aPause &amp;&amp; aBiffNow)</span>
<a href="#l16.239"></a><span id="l16.239" class="difflineplus">+        aFolder.server.performBiff(null);</span>
<a href="#l16.240"></a><span id="l16.240" class="difflineplus">+</span>
<a href="#l16.241"></a><span id="l16.241" class="difflineplus">+      return;</span>
<a href="#l16.242"></a><span id="l16.242" class="difflineplus">+    }</span>
<a href="#l16.243"></a><span id="l16.243" class="difflineplus">+</span>
<a href="#l16.244"></a><span id="l16.244" class="difflineplus">+    let feedUrls = FeedUtils.getFeedUrlsInFolder(aFolder);</span>
<a href="#l16.245"></a><span id="l16.245" class="difflineplus">+    if (!feedUrls)</span>
<a href="#l16.246"></a><span id="l16.246" class="difflineplus">+      return;</span>
<a href="#l16.247"></a><span id="l16.247" class="difflineplus">+</span>
<a href="#l16.248"></a><span id="l16.248" class="difflineplus">+    for (let feedUrl of feedUrls)</span>
<a href="#l16.249"></a><span id="l16.249" class="difflineplus">+    {</span>
<a href="#l16.250"></a><span id="l16.250" class="difflineplus">+      let resource = FeedUtils.rdf.GetResource(feedUrl);</span>
<a href="#l16.251"></a><span id="l16.251" class="difflineplus">+      let feed = new Feed(resource, aFolder.server);</span>
<a href="#l16.252"></a><span id="l16.252" class="difflineplus">+      let options = feed.options;</span>
<a href="#l16.253"></a><span id="l16.253" class="difflineplus">+      options.updates.enabled = !aPause;</span>
<a href="#l16.254"></a><span id="l16.254" class="difflineplus">+      feed.options = options;</span>
<a href="#l16.255"></a><span id="l16.255" class="difflineplus">+      FeedUtils.setStatus(aFolder, feedUrl, &quot;enabled&quot;, !aPause);</span>
<a href="#l16.256"></a><span id="l16.256" class="difflineplus">+FeedUtils.log.debug(&quot;pauseFeedFolderUpdates: enabled:url &quot; + !aPause + &quot;: &quot; + feedUrl);</span>
<a href="#l16.257"></a><span id="l16.257" class="difflineplus">+    }</span>
<a href="#l16.258"></a><span id="l16.258" class="difflineplus">+</span>
<a href="#l16.259"></a><span id="l16.259" class="difflineplus">+    let win = Services.wm.getMostRecentWindow(&quot;Mail:News-BlogSubscriptions&quot;);</span>
<a href="#l16.260"></a><span id="l16.260" class="difflineplus">+    if (win)</span>
<a href="#l16.261"></a><span id="l16.261" class="difflineplus">+    {</span>
<a href="#l16.262"></a><span id="l16.262" class="difflineplus">+      let curItem = win.FeedSubscriptions.mView.currentItem;</span>
<a href="#l16.263"></a><span id="l16.263" class="difflineplus">+      win.FeedSubscriptions.refreshSubscriptionView();</span>
<a href="#l16.264"></a><span id="l16.264" class="difflineplus">+      if (curItem.container)</span>
<a href="#l16.265"></a><span id="l16.265" class="difflineplus">+        win.FeedSubscriptions.selectFolder(curItem.folder);</span>
<a href="#l16.266"></a><span id="l16.266" class="difflineplus">+      else</span>
<a href="#l16.267"></a><span id="l16.267" class="difflineplus">+      {</span>
<a href="#l16.268"></a><span id="l16.268" class="difflineplus">+        let resource = FeedUtils.rdf.GetResource(curItem.url);</span>
<a href="#l16.269"></a><span id="l16.269" class="difflineplus">+        let feed = new Feed(resource, curItem.parentFolder.server);</span>
<a href="#l16.270"></a><span id="l16.270" class="difflineplus">+        feed.folder = curItem.parentFolder;</span>
<a href="#l16.271"></a><span id="l16.271" class="difflineplus">+        win.FeedSubscriptions.selectFeed(feed);</span>
<a href="#l16.272"></a><span id="l16.272" class="difflineplus">+      }</span>
<a href="#l16.273"></a><span id="l16.273" class="difflineplus">+    }</span>
<a href="#l16.274"></a><span id="l16.274" class="difflineplus">+</span>
<a href="#l16.275"></a><span id="l16.275" class="difflineplus">+    this.getSubscriptionsDS(aFolder.server).Flush();</span>
<a href="#l16.276"></a><span id="l16.276" class="difflineplus">+</span>
<a href="#l16.277"></a><span id="l16.277" class="difflineplus">+    feed = null;</span>
<a href="#l16.278"></a><span id="l16.278" class="difflineplus">+  },</span>
<a href="#l16.279"></a><span id="l16.279" class="difflineplus">+</span>
<a href="#l16.280"></a><span id="l16.280" class="difflineplus">+/**</span>
<a href="#l16.281"></a><span id="l16.281">  * Add a feed record to the feeds.rdf database and update the folder's feedUrl</span>
<a href="#l16.282"></a><span id="l16.282">  * property.</span>
<a href="#l16.283"></a><span id="l16.283">  *</span>
<a href="#l16.284"></a><span id="l16.284">  * @param  object aFeed - our feed object</span>
<a href="#l16.285"></a><span id="l16.285">  */</span>
<a href="#l16.286"></a><span id="l16.286">   addFeed: function(aFeed) {</span>
<a href="#l16.287"></a><span id="l16.287">     let ds = this.getSubscriptionsDS(aFeed.folder.server);</span>
<a href="#l16.288"></a><span id="l16.288">     let feeds = this.getSubscriptionsList(ds);</span>
<a href="#l16.289"></a><span id="l16.289" class="difflineat">@@ -459,16 +574,18 @@ var FeedUtils = {</span>
<a href="#l16.290"></a><span id="l16.290">     // Remove all assertions about items in the feed from the items database.</span>
<a href="#l16.291"></a><span id="l16.291">     let itemds = this.getItemsDS(aServer);</span>
<a href="#l16.292"></a><span id="l16.292">     feed.invalidateItems();</span>
<a href="#l16.293"></a><span id="l16.293">     feed.removeInvalidItems(true);</span>
<a href="#l16.294"></a><span id="l16.294">     itemds.Flush();</span>
<a href="#l16.295"></a><span id="l16.295"> </span>
<a href="#l16.296"></a><span id="l16.296">     // Update folderpane.</span>
<a href="#l16.297"></a><span id="l16.297">     this.setFolderPaneProperty(aParentFolder, &quot;favicon&quot;, null, &quot;row&quot;);</span>
<a href="#l16.298"></a><span id="l16.298" class="difflineplus">+    // Remove from cache.</span>
<a href="#l16.299"></a><span id="l16.299" class="difflineplus">+    delete this[aParentFolder.server.serverURI][feed.url];</span>
<a href="#l16.300"></a><span id="l16.300"> </span>
<a href="#l16.301"></a><span id="l16.301">     feed = null;</span>
<a href="#l16.302"></a><span id="l16.302">   },</span>
<a href="#l16.303"></a><span id="l16.303"> </span>
<a href="#l16.304"></a><span id="l16.304"> /**</span>
<a href="#l16.305"></a><span id="l16.305">  * Change an existing feed's url, as identified by FZ_FEED resource in the</span>
<a href="#l16.306"></a><span id="l16.306">  * feeds.rdf subscriptions database.</span>
<a href="#l16.307"></a><span id="l16.307">  *</span>
<a href="#l16.308"></a><span id="l16.308" class="difflineat">@@ -512,17 +629,17 @@ var FeedUtils = {</span>
<a href="#l16.309"></a><span id="l16.309"> /**</span>
<a href="#l16.310"></a><span id="l16.310">  * Get the list of feed urls for a folder, as identified by the FZ_DESTFOLDER</span>
<a href="#l16.311"></a><span id="l16.311">  * tag, directly from the primary feeds.rdf subscriptions database.</span>
<a href="#l16.312"></a><span id="l16.312">  *</span>
<a href="#l16.313"></a><span id="l16.313">  * @param  nsIMsgFolder - the folder.</span>
<a href="#l16.314"></a><span id="l16.314">  * @return array of urls, or null if none.</span>
<a href="#l16.315"></a><span id="l16.315">  */</span>
<a href="#l16.316"></a><span id="l16.316">   getFeedUrlsInFolder: function(aFolder) {</span>
<a href="#l16.317"></a><span id="l16.317" class="difflineminus">-    if (aFolder.isServer || aFolder.server.type != &quot;rss&quot; ||</span>
<a href="#l16.318"></a><span id="l16.318" class="difflineplus">+    if (!aFolder || aFolder.isServer || aFolder.server.type != &quot;rss&quot; ||</span>
<a href="#l16.319"></a><span id="l16.319">         aFolder.getFlag(Ci.nsMsgFolderFlags.Trash) ||</span>
<a href="#l16.320"></a><span id="l16.320">         aFolder.getFlag(Ci.nsMsgFolderFlags.Virtual) ||</span>
<a href="#l16.321"></a><span id="l16.321">         !aFolder.filePath.exists())</span>
<a href="#l16.322"></a><span id="l16.322">       // There are never any feedUrls in the account/non-feed/trash/virtual</span>
<a href="#l16.323"></a><span id="l16.323">       // folders or in a ghost folder (nonexistant on disk yet found in</span>
<a href="#l16.324"></a><span id="l16.324">       // aFolder.subFolders).</span>
<a href="#l16.325"></a><span id="l16.325">       return null;</span>
<a href="#l16.326"></a><span id="l16.326"> </span>
<a href="#l16.327"></a><span id="l16.327" class="difflineat">@@ -578,41 +695,161 @@ var FeedUtils = {</span>
<a href="#l16.328"></a><span id="l16.328">       aFolder.QueryInterface(Ci.nsIMsgLocalMailFolder)</span>
<a href="#l16.329"></a><span id="l16.329">              .getDatabaseWithReparse(null, null);</span>
<a href="#l16.330"></a><span id="l16.330">     }</span>
<a href="#l16.331"></a><span id="l16.331">     catch (ex) {}</span>
<a href="#l16.332"></a><span id="l16.332"> </span>
<a href="#l16.333"></a><span id="l16.333">     return false;</span>
<a href="#l16.334"></a><span id="l16.334">   },</span>
<a href="#l16.335"></a><span id="l16.335"> </span>
<a href="#l16.336"></a><span id="l16.336" class="difflineplus">+  /**</span>
<a href="#l16.337"></a><span id="l16.337" class="difflineplus">+   * Return properties for nsITreeView getCellProperties, for a tree row item in</span>
<a href="#l16.338"></a><span id="l16.338" class="difflineplus">+   * folderpane or subscribe dialog tree.</span>
<a href="#l16.339"></a><span id="l16.339" class="difflineplus">+   *</span>
<a href="#l16.340"></a><span id="l16.340" class="difflineplus">+   * @param   nsIMsgFolder aFolder - folder or a feed url's parent folder</span>
<a href="#l16.341"></a><span id="l16.341" class="difflineplus">+   * @param   string aFeedUrl      - feed url for a feed row, null for folder</span>
<a href="#l16.342"></a><span id="l16.342" class="difflineplus">+   * @return  string               - properties</span>
<a href="#l16.343"></a><span id="l16.343" class="difflineplus">+   */</span>
<a href="#l16.344"></a><span id="l16.344" class="difflineplus">+  getFolderProperties: function(aFolder, aFeedUrl) {</span>
<a href="#l16.345"></a><span id="l16.345" class="difflineplus">+    let folder = aFolder;</span>
<a href="#l16.346"></a><span id="l16.346" class="difflineplus">+    let feedUrls = aFeedUrl ? [aFeedUrl] : this.getFeedUrlsInFolder(aFolder);</span>
<a href="#l16.347"></a><span id="l16.347" class="difflineplus">+    if (!feedUrls &amp;&amp; !folder.isServer)</span>
<a href="#l16.348"></a><span id="l16.348" class="difflineplus">+      return &quot;&quot;;</span>
<a href="#l16.349"></a><span id="l16.349" class="difflineplus">+</span>
<a href="#l16.350"></a><span id="l16.350" class="difflineplus">+    let serverEnabled = this.getStatus(folder.server.rootFolder,</span>
<a href="#l16.351"></a><span id="l16.351" class="difflineplus">+                                       folder.server.rootFolder.URI).enabled;</span>
<a href="#l16.352"></a><span id="l16.352" class="difflineplus">+    if (folder.isServer)</span>
<a href="#l16.353"></a><span id="l16.353" class="difflineplus">+      return !serverEnabled ? &quot; serverIsPaused&quot; : &quot;&quot;;</span>
<a href="#l16.354"></a><span id="l16.354" class="difflineplus">+</span>
<a href="#l16.355"></a><span id="l16.355" class="difflineplus">+    let properties = aFeedUrl ? &quot; isFeed-true&quot; : &quot; isFeedFolder-true&quot;;</span>
<a href="#l16.356"></a><span id="l16.356" class="difflineplus">+    let hasError, isBusy, numPaused = 0;</span>
<a href="#l16.357"></a><span id="l16.357" class="difflineplus">+    for (let feedUrl of feedUrls) {</span>
<a href="#l16.358"></a><span id="l16.358" class="difflineplus">+      let feedStatus = this.getStatus(folder, feedUrl);</span>
<a href="#l16.359"></a><span id="l16.359" class="difflineplus">+      if (feedStatus.code == FeedUtils.kNewsBlogInvalidFeed ||</span>
<a href="#l16.360"></a><span id="l16.360" class="difflineplus">+          feedStatus.code == FeedUtils.kNewsBlogRequestFailure ||</span>
<a href="#l16.361"></a><span id="l16.361" class="difflineplus">+          feedStatus.code == FeedUtils.kNewsBlogBadCertError ||</span>
<a href="#l16.362"></a><span id="l16.362" class="difflineplus">+          feedStatus.code == FeedUtils.kNewsBlogNoAuthError)</span>
<a href="#l16.363"></a><span id="l16.363" class="difflineplus">+        hasError = true;</span>
<a href="#l16.364"></a><span id="l16.364" class="difflineplus">+      if (feedStatus.code == FeedUtils.kNewsBlogFeedIsBusy)</span>
<a href="#l16.365"></a><span id="l16.365" class="difflineplus">+        isBusy = true;</span>
<a href="#l16.366"></a><span id="l16.366" class="difflineplus">+      if (!feedStatus.enabled)</span>
<a href="#l16.367"></a><span id="l16.367" class="difflineplus">+        numPaused++;</span>
<a href="#l16.368"></a><span id="l16.368" class="difflineplus">+    }</span>
<a href="#l16.369"></a><span id="l16.369" class="difflineplus">+</span>
<a href="#l16.370"></a><span id="l16.370" class="difflineplus">+    properties += hasError ? &quot; hasError&quot; : &quot;&quot;;</span>
<a href="#l16.371"></a><span id="l16.371" class="difflineplus">+    properties += isBusy ? &quot; isBusy&quot; : &quot;&quot;;</span>
<a href="#l16.372"></a><span id="l16.372" class="difflineplus">+    properties += numPaused == feedUrls.length ? &quot; isPaused&quot; : &quot;&quot;;</span>
<a href="#l16.373"></a><span id="l16.373" class="difflineplus">+    properties += !serverEnabled ? &quot; serverIsPaused&quot; : &quot;&quot;;</span>
<a href="#l16.374"></a><span id="l16.374" class="difflineplus">+</span>
<a href="#l16.375"></a><span id="l16.375" class="difflineplus">+    return properties;</span>
<a href="#l16.376"></a><span id="l16.376" class="difflineplus">+  },</span>
<a href="#l16.377"></a><span id="l16.377" class="difflineplus">+</span>
<a href="#l16.378"></a><span id="l16.378"> /**</span>
<a href="#l16.379"></a><span id="l16.379">  * Update a folderpane cached property.</span>
<a href="#l16.380"></a><span id="l16.380">  *</span>
<a href="#l16.381"></a><span id="l16.381">  * @param  nsIMsgFolder aFolder   - folder</span>
<a href="#l16.382"></a><span id="l16.382">  * @param  string aProperty       - property</span>
<a href="#l16.383"></a><span id="l16.383">  * @param  string aValue          - value</span>
<a href="#l16.384"></a><span id="l16.384">  * @param  string aInvalidate     - &quot;row&quot; = folder's row.</span>
<a href="#l16.385"></a><span id="l16.385">  *                                  &quot;all&quot; = all rows.</span>
<a href="#l16.386"></a><span id="l16.386">  */</span>
<a href="#l16.387"></a><span id="l16.387">   setFolderPaneProperty: function(aFolder, aProperty, aValue, aInvalidate) {</span>
<a href="#l16.388"></a><span id="l16.388">     let win = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l16.389"></a><span id="l16.389">     if (!aFolder || !aProperty || !win || !(&quot;gFolderTreeView&quot; in win))</span>
<a href="#l16.390"></a><span id="l16.390">       return;</span>
<a href="#l16.391"></a><span id="l16.391"> </span>
<a href="#l16.392"></a><span id="l16.392">     win.gFolderTreeView.setFolderCacheProperty(aFolder, aProperty, aValue);</span>
<a href="#l16.393"></a><span id="l16.393"> </span>
<a href="#l16.394"></a><span id="l16.394" class="difflineminus">-    if (aInvalidate == &quot;all&quot;) {</span>
<a href="#l16.395"></a><span id="l16.395" class="difflineplus">+    if (aInvalidate == &quot;all&quot;)</span>
<a href="#l16.396"></a><span id="l16.396">       win.gFolderTreeView._tree.invalidate();</span>
<a href="#l16.397"></a><span id="l16.397" class="difflineminus">-    }</span>
<a href="#l16.398"></a><span id="l16.398" class="difflineplus">+</span>
<a href="#l16.399"></a><span id="l16.399">     if (aInvalidate == &quot;row&quot;) {</span>
<a href="#l16.400"></a><span id="l16.400">       let row = win.gFolderTreeView.getIndexOfFolder(aFolder);</span>
<a href="#l16.401"></a><span id="l16.401">       win.gFolderTreeView._tree.invalidateRow(row);</span>
<a href="#l16.402"></a><span id="l16.402">     }</span>
<a href="#l16.403"></a><span id="l16.403">   },</span>
<a href="#l16.404"></a><span id="l16.404"> </span>
<a href="#l16.405"></a><span id="l16.405" class="difflineplus">+  /**</span>
<a href="#l16.406"></a><span id="l16.406" class="difflineplus">+   * Get a cached feed or folder status.</span>
<a href="#l16.407"></a><span id="l16.407" class="difflineplus">+   *</span>
<a href="#l16.408"></a><span id="l16.408" class="difflineplus">+   * @param  nsIMsgFolder aFolder   - folder</span>
<a href="#l16.409"></a><span id="l16.409" class="difflineplus">+   * @param  string aUrl            - url key (feed url or folder URI)</span>
<a href="#l16.410"></a><span id="l16.410" class="difflineplus">+   * @param  string aProperty       - url status property</span>
<a href="#l16.411"></a><span id="l16.411" class="difflineplus">+   * @return string aValue          - value</span>
<a href="#l16.412"></a><span id="l16.412" class="difflineplus">+   */</span>
<a href="#l16.413"></a><span id="l16.413" class="difflineplus">+  getStatus: function(aFolder, aUrl) {</span>
<a href="#l16.414"></a><span id="l16.414" class="difflineplus">+    if (!aFolder || !aUrl)</span>
<a href="#l16.415"></a><span id="l16.415" class="difflineplus">+      return;</span>
<a href="#l16.416"></a><span id="l16.416" class="difflineplus">+</span>
<a href="#l16.417"></a><span id="l16.417" class="difflineplus">+    let serverKey = aFolder.server.serverURI;</span>
<a href="#l16.418"></a><span id="l16.418" class="difflineplus">+    if (!this[serverKey])</span>
<a href="#l16.419"></a><span id="l16.419" class="difflineplus">+      this[serverKey] = {};</span>
<a href="#l16.420"></a><span id="l16.420" class="difflineplus">+</span>
<a href="#l16.421"></a><span id="l16.421" class="difflineplus">+    if (!this[serverKey][aUrl]) {</span>
<a href="#l16.422"></a><span id="l16.422" class="difflineplus">+      // Seed the status object.</span>
<a href="#l16.423"></a><span id="l16.423" class="difflineplus">+      this[serverKey][aUrl] = {};</span>
<a href="#l16.424"></a><span id="l16.424" class="difflineplus">+      this[serverKey][aUrl][&quot;status&quot;] = this.statusTemplate;</span>
<a href="#l16.425"></a><span id="l16.425" class="difflineplus">+      if (FeedUtils.isValidScheme(aUrl)) {</span>
<a href="#l16.426"></a><span id="l16.426" class="difflineplus">+        // Seed persisted status properties for feed urls.</span>
<a href="#l16.427"></a><span id="l16.427" class="difflineplus">+        let feedResource = FeedUtils.rdf.GetResource(aUrl);</span>
<a href="#l16.428"></a><span id="l16.428" class="difflineplus">+        let feed = new Feed(feedResource, aFolder.server);</span>
<a href="#l16.429"></a><span id="l16.429" class="difflineplus">+        this[serverKey][aUrl][&quot;status&quot;].enabled =</span>
<a href="#l16.430"></a><span id="l16.430" class="difflineplus">+          feed.options.updates.enabled;</span>
<a href="#l16.431"></a><span id="l16.431" class="difflineplus">+        this[serverKey][aUrl][&quot;status&quot;].updateMinutes =</span>
<a href="#l16.432"></a><span id="l16.432" class="difflineplus">+          feed.options.updates.updateMinutes;</span>
<a href="#l16.433"></a><span id="l16.433" class="difflineplus">+        this[serverKey][aUrl][&quot;status&quot;].lastUpdateTime =</span>
<a href="#l16.434"></a><span id="l16.434" class="difflineplus">+          feed.options.updates.lastUpdateTime;</span>
<a href="#l16.435"></a><span id="l16.435" class="difflineplus">+        feed = null;</span>
<a href="#l16.436"></a><span id="l16.436" class="difflineplus">+      }</span>
<a href="#l16.437"></a><span id="l16.437" class="difflineplus">+      else {</span>
<a href="#l16.438"></a><span id="l16.438" class="difflineplus">+        // Seed persisted status properties for servers.</span>
<a href="#l16.439"></a><span id="l16.439" class="difflineplus">+        let optionsAcct = FeedUtils.getOptionsAcct(aFolder.server);</span>
<a href="#l16.440"></a><span id="l16.440" class="difflineplus">+        this[serverKey][aUrl][&quot;status&quot;].enabled = optionsAcct.doBiff;</span>
<a href="#l16.441"></a><span id="l16.441" class="difflineplus">+      }</span>
<a href="#l16.442"></a><span id="l16.442" class="difflineplus">+      FeedUtils.log.debug(&quot;getStatus: seed url - &quot; + aUrl);</span>
<a href="#l16.443"></a><span id="l16.443" class="difflineplus">+    }</span>
<a href="#l16.444"></a><span id="l16.444" class="difflineplus">+</span>
<a href="#l16.445"></a><span id="l16.445" class="difflineplus">+    return this[serverKey][aUrl].status;</span>
<a href="#l16.446"></a><span id="l16.446" class="difflineplus">+  },</span>
<a href="#l16.447"></a><span id="l16.447" class="difflineplus">+</span>
<a href="#l16.448"></a><span id="l16.448" class="difflineplus">+  /**</span>
<a href="#l16.449"></a><span id="l16.449" class="difflineplus">+   * Update a feed or folder status and refresh folderpane.</span>
<a href="#l16.450"></a><span id="l16.450" class="difflineplus">+   *</span>
<a href="#l16.451"></a><span id="l16.451" class="difflineplus">+   * @param  nsIMsgFolder aFolder   - folder</span>
<a href="#l16.452"></a><span id="l16.452" class="difflineplus">+   * @param  string aUrl            - url key (feed url or folder URI)</span>
<a href="#l16.453"></a><span id="l16.453" class="difflineplus">+   * @param  string aProperty       - url status property</span>
<a href="#l16.454"></a><span id="l16.454" class="difflineplus">+   * @param  string aValue          - value</span>
<a href="#l16.455"></a><span id="l16.455" class="difflineplus">+   */</span>
<a href="#l16.456"></a><span id="l16.456" class="difflineplus">+  setStatus: function(aFolder, aUrl, aProperty, aValue) {</span>
<a href="#l16.457"></a><span id="l16.457" class="difflineplus">+    if (!aFolder || !aUrl || !aProperty)</span>
<a href="#l16.458"></a><span id="l16.458" class="difflineplus">+      return;</span>
<a href="#l16.459"></a><span id="l16.459" class="difflineplus">+</span>
<a href="#l16.460"></a><span id="l16.460" class="difflineplus">+    if (!this[aFolder.server.serverURI][aUrl])</span>
<a href="#l16.461"></a><span id="l16.461" class="difflineplus">+      // Not yet seeded, so do it.</span>
<a href="#l16.462"></a><span id="l16.462" class="difflineplus">+      this.getStatus(aFolder, aUrl);</span>
<a href="#l16.463"></a><span id="l16.463" class="difflineplus">+</span>
<a href="#l16.464"></a><span id="l16.464" class="difflineplus">+    this[aFolder.server.serverURI][aUrl][&quot;status&quot;][aProperty] = aValue;</span>
<a href="#l16.465"></a><span id="l16.465" class="difflineplus">+</span>
<a href="#l16.466"></a><span id="l16.466" class="difflineplus">+    let win = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l16.467"></a><span id="l16.467" class="difflineplus">+    if (win &amp;&amp; &quot;gFolderTreeView&quot; in win)</span>
<a href="#l16.468"></a><span id="l16.468" class="difflineplus">+    {</span>
<a href="#l16.469"></a><span id="l16.469" class="difflineplus">+      if (aFolder.isServer) {</span>
<a href="#l16.470"></a><span id="l16.470" class="difflineplus">+        win.gFolderTreeView._tree.invalidate();</span>
<a href="#l16.471"></a><span id="l16.471" class="difflineplus">+      }</span>
<a href="#l16.472"></a><span id="l16.472" class="difflineplus">+      else {</span>
<a href="#l16.473"></a><span id="l16.473" class="difflineplus">+        let row = win.gFolderTreeView.getIndexOfFolder(aFolder);</span>
<a href="#l16.474"></a><span id="l16.474" class="difflineplus">+        win.gFolderTreeView._tree.invalidateRow(row);</span>
<a href="#l16.475"></a><span id="l16.475" class="difflineplus">+      }</span>
<a href="#l16.476"></a><span id="l16.476" class="difflineplus">+    }</span>
<a href="#l16.477"></a><span id="l16.477" class="difflineplus">+</span>
<a href="#l16.478"></a><span id="l16.478" class="difflineplus">+    win = Services.wm.getMostRecentWindow(&quot;Mail:News-BlogSubscriptions&quot;);</span>
<a href="#l16.479"></a><span id="l16.479" class="difflineplus">+    if (win)</span>
<a href="#l16.480"></a><span id="l16.480" class="difflineplus">+      win.FeedSubscriptions.mView.treeBox.invalidate();</span>
<a href="#l16.481"></a><span id="l16.481" class="difflineplus">+  },</span>
<a href="#l16.482"></a><span id="l16.482" class="difflineplus">+</span>
<a href="#l16.483"></a><span id="l16.483"> /**</span>
<a href="#l16.484"></a><span id="l16.484">  * Get the favicon for a feed folder subscription url (first one) or a feed</span>
<a href="#l16.485"></a><span id="l16.485">  * message url. The favicon service caches it in memory if places history is</span>
<a href="#l16.486"></a><span id="l16.486">  * not enabled.</span>
<a href="#l16.487"></a><span id="l16.487">  *</span>
<a href="#l16.488"></a><span id="l16.488">  * @param  nsIMsgFolder aFolder - the feed folder or null if aUrl</span>
<a href="#l16.489"></a><span id="l16.489">  * @param  string aUrl          - a url (feed, message, other) or null if aFolder</span>
<a href="#l16.490"></a><span id="l16.490">  * @param  string aIconUrl      - the icon url if already determined, else null</span>
<a href="#l16.491"></a><span id="l16.491" class="difflineat">@@ -899,57 +1136,177 @@ var FeedUtils = {</span>
<a href="#l16.492"></a><span id="l16.492">     {</span>
<a href="#l16.493"></a><span id="l16.493">       folderName = folderNameBase + &quot;-&quot; + i++;</span>
<a href="#l16.494"></a><span id="l16.494">     }</span>
<a href="#l16.495"></a><span id="l16.495"> </span>
<a href="#l16.496"></a><span id="l16.496">     return folderName;</span>
<a href="#l16.497"></a><span id="l16.497">   },</span>
<a href="#l16.498"></a><span id="l16.498"> </span>
<a href="#l16.499"></a><span id="l16.499"> /**</span>
<a href="#l16.500"></a><span id="l16.500" class="difflineminus">- * This object will contain all feed specific properties.</span>
<a href="#l16.501"></a><span id="l16.501" class="difflineplus">+ * This object contains feed/account status info.</span>
<a href="#l16.502"></a><span id="l16.502" class="difflineplus">+ */</span>
<a href="#l16.503"></a><span id="l16.503" class="difflineplus">+  _statusDefault: {</span>
<a href="#l16.504"></a><span id="l16.504" class="difflineplus">+    // Derived from persisted value.</span>
<a href="#l16.505"></a><span id="l16.505" class="difflineplus">+    enabled: null,</span>
<a href="#l16.506"></a><span id="l16.506" class="difflineplus">+    // Last update result code, a kNewsBlog* value.</span>
<a href="#l16.507"></a><span id="l16.507" class="difflineplus">+    code: 0,</span>
<a href="#l16.508"></a><span id="l16.508" class="difflineplus">+    updateMinutes: null,</span>
<a href="#l16.509"></a><span id="l16.509" class="difflineplus">+    // JS Date; startup state is null indicating no update since startup.</span>
<a href="#l16.510"></a><span id="l16.510" class="difflineplus">+    lastUpdateTime: null</span>
<a href="#l16.511"></a><span id="l16.511" class="difflineplus">+  },</span>
<a href="#l16.512"></a><span id="l16.512" class="difflineplus">+</span>
<a href="#l16.513"></a><span id="l16.513" class="difflineplus">+  get statusTemplate()</span>
<a href="#l16.514"></a><span id="l16.514" class="difflineplus">+  {</span>
<a href="#l16.515"></a><span id="l16.515" class="difflineplus">+    // Copy the object.</span>
<a href="#l16.516"></a><span id="l16.516" class="difflineplus">+    return JSON.parse(JSON.stringify(this._statusDefault));</span>
<a href="#l16.517"></a><span id="l16.517" class="difflineplus">+  },</span>
<a href="#l16.518"></a><span id="l16.518" class="difflineplus">+</span>
<a href="#l16.519"></a><span id="l16.519" class="difflineplus">+/**</span>
<a href="#l16.520"></a><span id="l16.520" class="difflineplus">+ * This object will contain all persisted feed specific properties.</span>
<a href="#l16.521"></a><span id="l16.521">  */</span>
<a href="#l16.522"></a><span id="l16.522">   _optionsDefault: {</span>
<a href="#l16.523"></a><span id="l16.523" class="difflineminus">-    version: 1,</span>
<a href="#l16.524"></a><span id="l16.524" class="difflineplus">+    version: 2,</span>
<a href="#l16.525"></a><span id="l16.525" class="difflineplus">+    updates: {</span>
<a href="#l16.526"></a><span id="l16.526" class="difflineplus">+      enabled: true,</span>
<a href="#l16.527"></a><span id="l16.527" class="difflineplus">+      // User set.</span>
<a href="#l16.528"></a><span id="l16.528" class="difflineplus">+      updateMinutes: 100,</span>
<a href="#l16.529"></a><span id="l16.529" class="difflineplus">+      // User set: &quot;min&quot;=minutes, &quot;d&quot;=days</span>
<a href="#l16.530"></a><span id="l16.530" class="difflineplus">+      updateUnits: &quot;min&quot;,</span>
<a href="#l16.531"></a><span id="l16.531" class="difflineplus">+      // JS Date.</span>
<a href="#l16.532"></a><span id="l16.532" class="difflineplus">+      lastUpdateTime: null,</span>
<a href="#l16.533"></a><span id="l16.533" class="difflineplus">+      // The last time a new message was stored. JS Date.</span>
<a href="#l16.534"></a><span id="l16.534" class="difflineplus">+      lastDownloadTime: null,</span>
<a href="#l16.535"></a><span id="l16.535" class="difflineplus">+      // Publisher recommended from the feed.</span>
<a href="#l16.536"></a><span id="l16.536" class="difflineplus">+      updatePeriod: null,</span>
<a href="#l16.537"></a><span id="l16.537" class="difflineplus">+      updateFrequency: 1,</span>
<a href="#l16.538"></a><span id="l16.538" class="difflineplus">+      updateBase: null</span>
<a href="#l16.539"></a><span id="l16.539" class="difflineplus">+    },</span>
<a href="#l16.540"></a><span id="l16.540">     // Autotag and &lt;category&gt; handling options.</span>
<a href="#l16.541"></a><span id="l16.541">     category: {</span>
<a href="#l16.542"></a><span id="l16.542">       enabled: false,</span>
<a href="#l16.543"></a><span id="l16.543">       prefixEnabled: false,</span>
<a href="#l16.544"></a><span id="l16.544">       prefix: null,</span>
<a href="#l16.545"></a><span id="l16.545">     }</span>
<a href="#l16.546"></a><span id="l16.546">   },</span>
<a href="#l16.547"></a><span id="l16.547"> </span>
<a href="#l16.548"></a><span id="l16.548">   get optionsTemplate()</span>
<a href="#l16.549"></a><span id="l16.549">   {</span>
<a href="#l16.550"></a><span id="l16.550">     // Copy the object.</span>
<a href="#l16.551"></a><span id="l16.551">     return JSON.parse(JSON.stringify(this._optionsDefault));</span>
<a href="#l16.552"></a><span id="l16.552">   },</span>
<a href="#l16.553"></a><span id="l16.553"> </span>
<a href="#l16.554"></a><span id="l16.554">   getOptionsAcct: function(aServer)</span>
<a href="#l16.555"></a><span id="l16.555">   {</span>
<a href="#l16.556"></a><span id="l16.556" class="difflineplus">+    let optionsAcct;</span>
<a href="#l16.557"></a><span id="l16.557">     let optionsAcctPref = &quot;mail.server.&quot; + aServer.key + &quot;.feed_options&quot;;</span>
<a href="#l16.558"></a><span id="l16.558" class="difflineplus">+    let check_new_mail = &quot;mail.server.&quot; + aServer.key + &quot;.check_new_mail&quot;;</span>
<a href="#l16.559"></a><span id="l16.559" class="difflineplus">+    let check_time = &quot;mail.server.&quot; + aServer.key + &quot;.check_time&quot;;</span>
<a href="#l16.560"></a><span id="l16.560" class="difflineplus">+</span>
<a href="#l16.561"></a><span id="l16.561" class="difflineplus">+    // Biff enabled or not. Make sure pref exists.</span>
<a href="#l16.562"></a><span id="l16.562" class="difflineplus">+    if (!Services.prefs.prefHasUserValue(check_new_mail))</span>
<a href="#l16.563"></a><span id="l16.563" class="difflineplus">+      Services.prefs.setBoolPref(check_new_mail, true);</span>
<a href="#l16.564"></a><span id="l16.564" class="difflineplus">+</span>
<a href="#l16.565"></a><span id="l16.565" class="difflineplus">+    // System polling interval. Make sure pref exists.</span>
<a href="#l16.566"></a><span id="l16.566" class="difflineplus">+    if (!Services.prefs.prefHasUserValue(check_time))</span>
<a href="#l16.567"></a><span id="l16.567" class="difflineplus">+      Services.prefs.setIntPref(check_time, FeedUtils.kBiffPollMinutes);</span>
<a href="#l16.568"></a><span id="l16.568" class="difflineplus">+</span>
<a href="#l16.569"></a><span id="l16.569">     try {</span>
<a href="#l16.570"></a><span id="l16.570" class="difflineminus">-      return JSON.parse(Services.prefs.getCharPref(optionsAcctPref));</span>
<a href="#l16.571"></a><span id="l16.571" class="difflineplus">+      optionsAcct = JSON.parse(Services.prefs.getCharPref(optionsAcctPref));</span>
<a href="#l16.572"></a><span id="l16.572" class="difflineplus">+      // Add the server specific biff enabled state.</span>
<a href="#l16.573"></a><span id="l16.573" class="difflineplus">+      optionsAcct[&quot;doBiff&quot;] = Services.prefs.getBoolPref(check_new_mail);</span>
<a href="#l16.574"></a><span id="l16.574">     }</span>
<a href="#l16.575"></a><span id="l16.575" class="difflineminus">-    catch (ex) {</span>
<a href="#l16.576"></a><span id="l16.576" class="difflineminus">-      this.setOptionsAcct(aServer, this._optionsDefault);</span>
<a href="#l16.577"></a><span id="l16.577" class="difflineminus">-      return JSON.parse(Services.prefs.getCharPref(optionsAcctPref));</span>
<a href="#l16.578"></a><span id="l16.578" class="difflineminus">-    }</span>
<a href="#l16.579"></a><span id="l16.579" class="difflineplus">+    catch (ex) {}</span>
<a href="#l16.580"></a><span id="l16.580" class="difflineplus">+</span>
<a href="#l16.581"></a><span id="l16.581" class="difflineplus">+    if (optionsAcct &amp;&amp; optionsAcct.version == this._optionsDefault.version)</span>
<a href="#l16.582"></a><span id="l16.582" class="difflineplus">+      return optionsAcct;</span>
<a href="#l16.583"></a><span id="l16.583" class="difflineplus">+</span>
<a href="#l16.584"></a><span id="l16.584" class="difflineplus">+    // Init account updates options if new or upgrading to version in</span>
<a href="#l16.585"></a><span id="l16.585" class="difflineplus">+    // |_optionsDefault.version|.</span>
<a href="#l16.586"></a><span id="l16.586" class="difflineplus">+    if (!optionsAcct || optionsAcct.version &lt; this._optionsDefault.version)</span>
<a href="#l16.587"></a><span id="l16.587" class="difflineplus">+      this.initAcct(aServer);</span>
<a href="#l16.588"></a><span id="l16.588" class="difflineplus">+</span>
<a href="#l16.589"></a><span id="l16.589" class="difflineplus">+    let newOptions = this.newOptions(optionsAcct);</span>
<a href="#l16.590"></a><span id="l16.590" class="difflineplus">+    this.setOptionsAcct(aServer, newOptions);</span>
<a href="#l16.591"></a><span id="l16.591" class="difflineplus">+    newOptions[&quot;doBiff&quot;] = Services.prefs.getBoolPref(check_new_mail);</span>
<a href="#l16.592"></a><span id="l16.592" class="difflineplus">+    return newOptions;</span>
<a href="#l16.593"></a><span id="l16.593">   },</span>
<a href="#l16.594"></a><span id="l16.594"> </span>
<a href="#l16.595"></a><span id="l16.595">   setOptionsAcct: function(aServer, aOptions)</span>
<a href="#l16.596"></a><span id="l16.596">   {</span>
<a href="#l16.597"></a><span id="l16.597">     let optionsAcctPref = &quot;mail.server.&quot; + aServer.key + &quot;.feed_options&quot;;</span>
<a href="#l16.598"></a><span id="l16.598" class="difflineminus">-    let newOptions = this.newOptions(aOptions);</span>
<a href="#l16.599"></a><span id="l16.599" class="difflineminus">-    Services.prefs.setCharPref(optionsAcctPref, JSON.stringify(newOptions));</span>
<a href="#l16.600"></a><span id="l16.600" class="difflineplus">+    aOptions = aOptions || this.optionsTemplate;</span>
<a href="#l16.601"></a><span id="l16.601" class="difflineplus">+    Services.prefs.setCharPref(optionsAcctPref, JSON.stringify(aOptions));</span>
<a href="#l16.602"></a><span id="l16.602" class="difflineplus">+  },</span>
<a href="#l16.603"></a><span id="l16.603" class="difflineplus">+</span>
<a href="#l16.604"></a><span id="l16.604" class="difflineplus">+  initAcct: function(aServer)</span>
<a href="#l16.605"></a><span id="l16.605" class="difflineplus">+  {</span>
<a href="#l16.606"></a><span id="l16.606" class="difflineplus">+    let serverPrefStr = &quot;mail.server.&quot; + aServer.key;</span>
<a href="#l16.607"></a><span id="l16.607" class="difflineplus">+    // System polling interval. Effective after current interval expires on</span>
<a href="#l16.608"></a><span id="l16.608" class="difflineplus">+    // change; no user facing ui.</span>
<a href="#l16.609"></a><span id="l16.609" class="difflineplus">+    Services.prefs.setIntPref(serverPrefStr + &quot;.check_time&quot;,</span>
<a href="#l16.610"></a><span id="l16.610" class="difflineplus">+                              FeedUtils.kBiffPollMinutes);</span>
<a href="#l16.611"></a><span id="l16.611" class="difflineplus">+</span>
<a href="#l16.612"></a><span id="l16.612" class="difflineplus">+    // If this pref is false, polling on biff is disabled and account updates</span>
<a href="#l16.613"></a><span id="l16.613" class="difflineplus">+    // are paused; ui in account server settings and folderpane context menu</span>
<a href="#l16.614"></a><span id="l16.614" class="difflineplus">+    // (Pause All Updates). Checking Enable updates or unchecking Pause takes</span>
<a href="#l16.615"></a><span id="l16.615" class="difflineplus">+    // effect immediately. Here on startup, we just ensure the polling interval</span>
<a href="#l16.616"></a><span id="l16.616" class="difflineplus">+    // above is reset immediately.</span>
<a href="#l16.617"></a><span id="l16.617" class="difflineplus">+    let doBiff = Services.prefs.getBoolPref(serverPrefStr + &quot;.check_new_mail&quot;);</span>
<a href="#l16.618"></a><span id="l16.618" class="difflineplus">+    FeedUtils.log.debug(&quot;initAcct: &quot; + aServer.prettyName + &quot; doBiff - &quot; + doBiff);</span>
<a href="#l16.619"></a><span id="l16.619" class="difflineplus">+    this.pauseFeedFolderUpdates(aServer.rootFolder, !doBiff, false);</span>
<a href="#l16.620"></a><span id="l16.620">   },</span>
<a href="#l16.621"></a><span id="l16.621"> </span>
<a href="#l16.622"></a><span id="l16.622" class="difflineminus">-  newOptions: function(aOptions)</span>
<a href="#l16.623"></a><span id="l16.623" class="difflineplus">+  newOptions: function(aCurrentOptions)</span>
<a href="#l16.624"></a><span id="l16.624">   {</span>
<a href="#l16.625"></a><span id="l16.625" class="difflineminus">-    // TODO: Clean options, so that only keys in the active template are stored.</span>
<a href="#l16.626"></a><span id="l16.626" class="difflineminus">-    return aOptions;</span>
<a href="#l16.627"></a><span id="l16.627" class="difflineplus">+    if (!aCurrentOptions)</span>
<a href="#l16.628"></a><span id="l16.628" class="difflineplus">+      return this.optionsTemplate;</span>
<a href="#l16.629"></a><span id="l16.629" class="difflineplus">+</span>
<a href="#l16.630"></a><span id="l16.630" class="difflineplus">+    // Options version has changed; meld current template with existing</span>
<a href="#l16.631"></a><span id="l16.631" class="difflineplus">+    // aCurrentOptions settings, removing items gone from the template while</span>
<a href="#l16.632"></a><span id="l16.632" class="difflineplus">+    // preserving user settings for retained template items.</span>
<a href="#l16.633"></a><span id="l16.633" class="difflineplus">+    let newOptions = this.optionsTemplate;</span>
<a href="#l16.634"></a><span id="l16.634" class="difflineplus">+    this.Mixins.meld(aCurrentOptions, false, true).into(newOptions);</span>
<a href="#l16.635"></a><span id="l16.635" class="difflineplus">+    newOptions.version = this.optionsTemplate.version;</span>
<a href="#l16.636"></a><span id="l16.636" class="difflineplus">+    return newOptions;</span>
<a href="#l16.637"></a><span id="l16.637" class="difflineplus">+  },</span>
<a href="#l16.638"></a><span id="l16.638" class="difflineplus">+</span>
<a href="#l16.639"></a><span id="l16.639" class="difflineplus">+/**</span>
<a href="#l16.640"></a><span id="l16.640" class="difflineplus">+ * A generalized recursive melder of two objects. Getters/setters not included.</span>
<a href="#l16.641"></a><span id="l16.641" class="difflineplus">+ */</span>
<a href="#l16.642"></a><span id="l16.642" class="difflineplus">+  Mixins: {</span>
<a href="#l16.643"></a><span id="l16.643" class="difflineplus">+    meld: function(source, keep, replace) {</span>
<a href="#l16.644"></a><span id="l16.644" class="difflineplus">+      function meldin(source, target, keep, replace) {</span>
<a href="#l16.645"></a><span id="l16.645" class="difflineplus">+        for (let attribute in source) {</span>
<a href="#l16.646"></a><span id="l16.646" class="difflineplus">+          // Recurse for objects.</span>
<a href="#l16.647"></a><span id="l16.647" class="difflineplus">+          if (typeof source[attribute] == &quot;object&quot; &amp;&amp;</span>
<a href="#l16.648"></a><span id="l16.648" class="difflineplus">+              typeof target[attribute] == &quot;object&quot;) {</span>
<a href="#l16.649"></a><span id="l16.649" class="difflineplus">+            meldin(source[attribute], target[attribute], keep, replace);</span>
<a href="#l16.650"></a><span id="l16.650" class="difflineplus">+          }</span>
<a href="#l16.651"></a><span id="l16.651" class="difflineplus">+          else {</span>
<a href="#l16.652"></a><span id="l16.652" class="difflineplus">+            // Use attribute values from source for the target, unless</span>
<a href="#l16.653"></a><span id="l16.653" class="difflineplus">+            // replace is false.</span>
<a href="#l16.654"></a><span id="l16.654" class="difflineplus">+            if (attribute in target &amp;&amp; !replace)</span>
<a href="#l16.655"></a><span id="l16.655" class="difflineplus">+              continue;</span>
<a href="#l16.656"></a><span id="l16.656" class="difflineplus">+</span>
<a href="#l16.657"></a><span id="l16.657" class="difflineplus">+            // Don't copy attribute from source to target if it is not in the</span>
<a href="#l16.658"></a><span id="l16.658" class="difflineplus">+            // target, unless keep is true.</span>
<a href="#l16.659"></a><span id="l16.659" class="difflineplus">+            if (!(attribute in target) &amp;&amp; !keep)</span>
<a href="#l16.660"></a><span id="l16.660" class="difflineplus">+              continue;</span>
<a href="#l16.661"></a><span id="l16.661" class="difflineplus">+</span>
<a href="#l16.662"></a><span id="l16.662" class="difflineplus">+            target[attribute] = source[attribute];</span>
<a href="#l16.663"></a><span id="l16.663" class="difflineplus">+          }</span>
<a href="#l16.664"></a><span id="l16.664" class="difflineplus">+        }</span>
<a href="#l16.665"></a><span id="l16.665" class="difflineplus">+      };</span>
<a href="#l16.666"></a><span id="l16.666" class="difflineplus">+      return {</span>
<a href="#l16.667"></a><span id="l16.667" class="difflineplus">+        source: source,</span>
<a href="#l16.668"></a><span id="l16.668" class="difflineplus">+        into: function(target) {</span>
<a href="#l16.669"></a><span id="l16.669" class="difflineplus">+          meldin(this.source, target, keep, replace);</span>
<a href="#l16.670"></a><span id="l16.670" class="difflineplus">+        }</span>
<a href="#l16.671"></a><span id="l16.671" class="difflineplus">+      };</span>
<a href="#l16.672"></a><span id="l16.672" class="difflineplus">+    }</span>
<a href="#l16.673"></a><span id="l16.673">   },</span>
<a href="#l16.674"></a><span id="l16.674"> </span>
<a href="#l16.675"></a><span id="l16.675">   getSubscriptionsDS: function(aServer) {</span>
<a href="#l16.676"></a><span id="l16.676">     if (this[aServer.serverURI] &amp;&amp; this[aServer.serverURI][&quot;FeedsDS&quot;])</span>
<a href="#l16.677"></a><span id="l16.677">       return this[aServer.serverURI][&quot;FeedsDS&quot;];</span>
<a href="#l16.678"></a><span id="l16.678"> </span>
<a href="#l16.679"></a><span id="l16.679">     let file = this.getSubscriptionsFile(aServer);</span>
<a href="#l16.680"></a><span id="l16.680">     let url = Services.io.getProtocolHandler(&quot;file&quot;).</span>
<a href="#l16.681"></a><span id="l16.681" class="difflineat">@@ -1459,20 +1816,40 @@ var FeedUtils = {</span>
<a href="#l16.682"></a><span id="l16.682">           // Non success.  Remove intermediate traces from the feeds database.</span>
<a href="#l16.683"></a><span id="l16.683">           if (feed &amp;&amp; feed.url &amp;&amp; feed.server)</span>
<a href="#l16.684"></a><span id="l16.684">             FeedUtils.deleteFeed(FeedUtils.rdf.GetResource(feed.url),</span>
<a href="#l16.685"></a><span id="l16.685">                                  feed.server,</span>
<a href="#l16.686"></a><span id="l16.686">                                  feed.server.rootFolder);</span>
<a href="#l16.687"></a><span id="l16.687">         }</span>
<a href="#l16.688"></a><span id="l16.688">       }</span>
<a href="#l16.689"></a><span id="l16.689"> </span>
<a href="#l16.690"></a><span id="l16.690" class="difflineminus">-      if (feed.folder &amp;&amp; aErrorCode != FeedUtils.kNewsBlogFeedIsBusy)</span>
<a href="#l16.691"></a><span id="l16.691" class="difflineminus">-        // Free msgDatabase after new mail biff is set; if busy let the next</span>
<a href="#l16.692"></a><span id="l16.692" class="difflineminus">-        // result do the freeing.  Otherwise new messages won't be indicated.</span>
<a href="#l16.693"></a><span id="l16.693" class="difflineminus">-        feed.folder.msgDatabase = null;</span>
<a href="#l16.694"></a><span id="l16.694" class="difflineplus">+      if (aErrorCode != FeedUtils.kNewsBlogFeedIsBusy)</span>
<a href="#l16.695"></a><span id="l16.695" class="difflineplus">+      {</span>
<a href="#l16.696"></a><span id="l16.696" class="difflineplus">+        if (aErrorCode == FeedUtils.kNewsBlogSuccess ||</span>
<a href="#l16.697"></a><span id="l16.697" class="difflineplus">+            aErrorCode == FeedUtils.kNewsBlogNoNewItems)</span>
<a href="#l16.698"></a><span id="l16.698" class="difflineplus">+        {</span>
<a href="#l16.699"></a><span id="l16.699" class="difflineplus">+          // Update lastUpdateTime only if successful normal processing.</span>
<a href="#l16.700"></a><span id="l16.700" class="difflineplus">+          let options = feed.options;</span>
<a href="#l16.701"></a><span id="l16.701" class="difflineplus">+          let now = Date.now();</span>
<a href="#l16.702"></a><span id="l16.702" class="difflineplus">+          options.updates.lastUpdateTime = now;</span>
<a href="#l16.703"></a><span id="l16.703" class="difflineplus">+          if (feed.itemsStored)</span>
<a href="#l16.704"></a><span id="l16.704" class="difflineplus">+            options.updates.lastDownloadTime = now;</span>
<a href="#l16.705"></a><span id="l16.705" class="difflineplus">+</span>
<a href="#l16.706"></a><span id="l16.706" class="difflineplus">+          feed.options = options;</span>
<a href="#l16.707"></a><span id="l16.707" class="difflineplus">+          FeedUtils.setStatus(feed.folder, feed.url, &quot;lastUpdateTime&quot;, now);</span>
<a href="#l16.708"></a><span id="l16.708" class="difflineplus">+        }</span>
<a href="#l16.709"></a><span id="l16.709" class="difflineplus">+</span>
<a href="#l16.710"></a><span id="l16.710" class="difflineplus">+        if (!this.mSubscribeMode)</span>
<a href="#l16.711"></a><span id="l16.711" class="difflineplus">+          FeedUtils.setStatus(feed.folder, feed.url, &quot;code&quot;, aErrorCode);</span>
<a href="#l16.712"></a><span id="l16.712" class="difflineplus">+</span>
<a href="#l16.713"></a><span id="l16.713" class="difflineplus">+        if (feed.folder)</span>
<a href="#l16.714"></a><span id="l16.714" class="difflineplus">+          // Free msgDatabase after new mail biff is set; if busy let the next</span>
<a href="#l16.715"></a><span id="l16.715" class="difflineplus">+          // result do the freeing.  Otherwise new messages won't be indicated.</span>
<a href="#l16.716"></a><span id="l16.716" class="difflineplus">+          feed.folder.msgDatabase = null;</span>
<a href="#l16.717"></a><span id="l16.717" class="difflineplus">+      }</span>
<a href="#l16.718"></a><span id="l16.718"> </span>
<a href="#l16.719"></a><span id="l16.719">       let message = &quot;&quot;;</span>
<a href="#l16.720"></a><span id="l16.720">       if (feed.folder)</span>
<a href="#l16.721"></a><span id="l16.721">         location = FeedUtils.getFolderPrettyPath(feed.folder) + &quot; -&gt; &quot;;</span>
<a href="#l16.722"></a><span id="l16.722">       switch (aErrorCode) {</span>
<a href="#l16.723"></a><span id="l16.723">         case FeedUtils.kNewsBlogSuccess:</span>
<a href="#l16.724"></a><span id="l16.724">         case FeedUtils.kNewsBlogFeedIsBusy:</span>
<a href="#l16.725"></a><span id="l16.725">           message = &quot;&quot;;</span>
<a href="#l16.726"></a><span id="l16.726" class="difflineat">@@ -1594,16 +1971,21 @@ XPCOMUtils.defineLazyGetter(FeedUtils, &quot;</span>
<a href="#l16.727"></a><span id="l16.727">   return Log4Moz.getConfiguredLogger(&quot;Feeds&quot;);</span>
<a href="#l16.728"></a><span id="l16.728"> });</span>
<a href="#l16.729"></a><span id="l16.729"> </span>
<a href="#l16.730"></a><span id="l16.730"> XPCOMUtils.defineLazyGetter(FeedUtils, &quot;strings&quot;, function() {</span>
<a href="#l16.731"></a><span id="l16.731">   return Services.strings.createBundle(</span>
<a href="#l16.732"></a><span id="l16.732">     &quot;chrome://messenger-newsblog/locale/newsblog.properties&quot;);</span>
<a href="#l16.733"></a><span id="l16.733"> });</span>
<a href="#l16.734"></a><span id="l16.734"> </span>
<a href="#l16.735"></a><span id="l16.735" class="difflineplus">+XPCOMUtils.defineLazyGetter(FeedUtils, &quot;stringsPrefs&quot;, function() {</span>
<a href="#l16.736"></a><span id="l16.736" class="difflineplus">+  return Services.strings.createBundle(</span>
<a href="#l16.737"></a><span id="l16.737" class="difflineplus">+    &quot;chrome://messenger/locale/prefs.properties&quot;);</span>
<a href="#l16.738"></a><span id="l16.738" class="difflineplus">+});</span>
<a href="#l16.739"></a><span id="l16.739" class="difflineplus">+</span>
<a href="#l16.740"></a><span id="l16.740"> XPCOMUtils.defineLazyGetter(FeedUtils, &quot;rdf&quot;, function() {</span>
<a href="#l16.741"></a><span id="l16.741">   return Cc[&quot;@mozilla.org/rdf/rdf-service;1&quot;].</span>
<a href="#l16.742"></a><span id="l16.742">          getService(Ci.nsIRDFService);</span>
<a href="#l16.743"></a><span id="l16.743"> });</span>
<a href="#l16.744"></a><span id="l16.744"> </span>
<a href="#l16.745"></a><span id="l16.745"> XPCOMUtils.defineLazyGetter(FeedUtils, &quot;rdfContainerUtils&quot;, function() {</span>
<a href="#l16.746"></a><span id="l16.746">   return Cc[&quot;@mozilla.org/rdf/container-utils;1&quot;].</span>
<a href="#l16.747"></a><span id="l16.747">          getService(Ci.nsIRDFContainerUtils);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/am-newsblog.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/am-newsblog.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1,63 +1,89 @@</span>
<a href="#l17.4"></a><span id="l17.4"> /* -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l17.5"></a><span id="l17.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l17.6"></a><span id="l17.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l17.7"></a><span id="l17.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9"> Components.utils.import(&quot;resource:///modules/FeedUtils.jsm&quot;);</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11" class="difflineminus">-var gServer, autotagEnable, autotagUsePrefix, autotagPrefix;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+var gServer, gUpdateEnabled, gUpdateValue, gBiffUnits,</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    gAutotagEnable, gAutotagUsePrefix, gAutotagPrefix;</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15"> function onInit(aPageId, aServerId)</span>
<a href="#l17.16"></a><span id="l17.16"> {</span>
<a href="#l17.17"></a><span id="l17.17">   var accountName = document.getElementById(&quot;server.prettyName&quot;);</span>
<a href="#l17.18"></a><span id="l17.18">   var title = document.getElementById(&quot;am-newsblog-title&quot;);</span>
<a href="#l17.19"></a><span id="l17.19">   var defaultTitle = title.getAttribute(&quot;defaultTitle&quot;);</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21">   var titleValue;</span>
<a href="#l17.22"></a><span id="l17.22">   if (accountName.value)</span>
<a href="#l17.23"></a><span id="l17.23">     titleValue = defaultTitle + &quot; - &lt;&quot; + accountName.value + &quot;&gt;&quot;;</span>
<a href="#l17.24"></a><span id="l17.24">   else</span>
<a href="#l17.25"></a><span id="l17.25">     titleValue = defaultTitle;</span>
<a href="#l17.26"></a><span id="l17.26"> </span>
<a href="#l17.27"></a><span id="l17.27">   title.setAttribute(&quot;title&quot;, titleValue);</span>
<a href="#l17.28"></a><span id="l17.28">   document.title = titleValue;</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-  onCheckItem(&quot;server.biffMinutes&quot;, [&quot;server.doBiff&quot;]);</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+  let optionsAcct = FeedUtils.getOptionsAcct(gServer);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  document.getElementById(&quot;doBiff&quot;).checked = optionsAcct.doBiff;</span>
<a href="#l17.33"></a><span id="l17.33"> </span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-  autotagEnable = document.getElementById(&quot;autotagEnable&quot;);</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-  autotagUsePrefix = document.getElementById(&quot;autotagUsePrefix&quot;);</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-  autotagPrefix = document.getElementById(&quot;autotagPrefix&quot;);</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+  gUpdateEnabled = document.getElementById(&quot;updateEnabled&quot;);</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+  gUpdateValue = document.getElementById(&quot;updateValue&quot;);</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+  gBiffUnits = document.getElementById(&quot;biffUnits&quot;);</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+  gAutotagEnable = document.getElementById(&quot;autotagEnable&quot;);</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+  gAutotagUsePrefix = document.getElementById(&quot;autotagUsePrefix&quot;);</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+  gAutotagPrefix = document.getElementById(&quot;autotagPrefix&quot;);</span>
<a href="#l17.43"></a><span id="l17.43"> </span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-  let categoryPrefsAcct = FeedUtils.getOptionsAcct(gServer).category;</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-  autotagEnable.checked = categoryPrefsAcct.enabled;</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-  autotagUsePrefix.disabled = !autotagEnable.checked;</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-  autotagUsePrefix.checked = categoryPrefsAcct.prefixEnabled;</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-  autotagPrefix.disabled = autotagUsePrefix.disabled || !autotagUsePrefix.checked;</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-  autotagPrefix.value = categoryPrefsAcct.prefix;</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+  gUpdateEnabled.checked = optionsAcct.updates.enabled;</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+  gBiffUnits.value = optionsAcct.updates.updateUnits;</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+  let minutes = optionsAcct.updates.updateUnits == FeedUtils.kBiffUnitsMinutes ?</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+                  optionsAcct.updates.updateMinutes :</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+                  optionsAcct.updates.updateMinutes / (24 * 60);</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+  gUpdateValue.valueNumber = minutes;</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+  onCheckItem(&quot;updateValue&quot;, [&quot;updateEnabled&quot;]);</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+  gAutotagEnable.checked = optionsAcct.category.enabled;</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+  gAutotagUsePrefix.disabled = !gAutotagEnable.checked;</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+  gAutotagUsePrefix.checked = optionsAcct.category.prefixEnabled;</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+  gAutotagPrefix.disabled = gAutotagUsePrefix.disabled || !gAutotagUsePrefix.checked;</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+  gAutotagPrefix.value = optionsAcct.category.prefix;</span>
<a href="#l17.63"></a><span id="l17.63"> }</span>
<a href="#l17.64"></a><span id="l17.64"> </span>
<a href="#l17.65"></a><span id="l17.65"> function onPreInit(account, accountValues)</span>
<a href="#l17.66"></a><span id="l17.66"> {</span>
<a href="#l17.67"></a><span id="l17.67">   gServer = account.incomingServer;</span>
<a href="#l17.68"></a><span id="l17.68"> }</span>
<a href="#l17.69"></a><span id="l17.69"> </span>
<a href="#l17.70"></a><span id="l17.70" class="difflineminus">-function setCategoryPrefs(aNode)</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+function setPrefs(aNode)</span>
<a href="#l17.72"></a><span id="l17.72"> {</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-  let options =  FeedUtils.getOptionsAcct(gServer);</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+  let optionsAcct =  FeedUtils.getOptionsAcct(gServer);</span>
<a href="#l17.75"></a><span id="l17.75">   switch (aNode.id) {</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+    case &quot;doBiff&quot;:</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineplus">+      FeedUtils.pauseFeedFolderUpdates(gServer.rootFolder, !aNode.checked, true);</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+      break;</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+    case &quot;updateEnabled&quot;:</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineplus">+    case &quot;updateValue&quot;:</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+    case &quot;biffUnits&quot;:</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+      optionsAcct.updates.enabled = gUpdateEnabled.checked;</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+      onCheckItem(&quot;updateValue&quot;, [&quot;updateEnabled&quot;]);</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+      let minutes = gBiffUnits.value == FeedUtils.kBiffUnitsMinutes ?</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+                      gUpdateValue.valueNumber :</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+                      gUpdateValue.valueNumber * 24 * 60;</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+      optionsAcct.updates.updateMinutes = minutes;</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+      optionsAcct.updates.updateUnits = gBiffUnits.value;</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+      break;</span>
<a href="#l17.90"></a><span id="l17.90">     case &quot;autotagEnable&quot;:</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineminus">-      options.category.enabled = aNode.checked;</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineminus">-      autotagUsePrefix.disabled = !aNode.checked;</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineminus">-      autotagPrefix.disabled = !aNode.checked || !autotagUsePrefix.checked;</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineplus">+      optionsAcct.category.enabled = aNode.checked;</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineplus">+      gAutotagUsePrefix.disabled = !aNode.checked;</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineplus">+      gAutotagPrefix.disabled = !aNode.checked || !gAutotagUsePrefix.checked;</span>
<a href="#l17.97"></a><span id="l17.97">       break;</span>
<a href="#l17.98"></a><span id="l17.98">     case &quot;autotagUsePrefix&quot;:</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineminus">-      options.category.prefixEnabled = aNode.checked;</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineminus">-      autotagPrefix.disabled = aNode.disabled || !aNode.checked;</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineplus">+      optionsAcct.category.prefixEnabled = aNode.checked;</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+      gAutotagPrefix.disabled = aNode.disabled || !aNode.checked;</span>
<a href="#l17.103"></a><span id="l17.103">       break;</span>
<a href="#l17.104"></a><span id="l17.104">     case &quot;autotagPrefix&quot;:</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-      options.category.prefix = aNode.value;</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+      optionsAcct.category.prefix = aNode.value;</span>
<a href="#l17.107"></a><span id="l17.107">       break;</span>
<a href="#l17.108"></a><span id="l17.108">   }</span>
<a href="#l17.109"></a><span id="l17.109"> </span>
<a href="#l17.110"></a><span id="l17.110" class="difflineminus">-  FeedUtils.setOptionsAcct(gServer, options)</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+  FeedUtils.setOptionsAcct(gServer, optionsAcct)</span>
<a href="#l17.112"></a><span id="l17.112"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/am-newsblog.xul</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/am-newsblog.xul</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -55,67 +55,90 @@</span>
<a href="#l18.4"></a><span id="l18.4">       &lt;caption label=&quot;&amp;serverSettings.label;&quot;/&gt;</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">       &lt;checkbox id=&quot;server.loginAtStartUp&quot;</span>
<a href="#l18.7"></a><span id="l18.7">                 wsm_persist=&quot;true&quot;</span>
<a href="#l18.8"></a><span id="l18.8">                 label=&quot;&amp;loginAtStartup.label;&quot;</span>
<a href="#l18.9"></a><span id="l18.9">                 accesskey=&quot;&amp;loginAtStartup.accesskey;&quot;</span>
<a href="#l18.10"></a><span id="l18.10">                 prefattribute=&quot;value&quot;</span>
<a href="#l18.11"></a><span id="l18.11">                 prefstring=&quot;mail.server.%serverkey%.login_at_startup&quot;/&gt;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+      &lt;checkbox id=&quot;doBiff&quot;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+                label=&quot;&amp;biffAll.label;&quot;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+                accesskey=&quot;&amp;biffAll.accesskey;&quot;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+                oncommand=&quot;setPrefs(this)&quot;/&gt;</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+    &lt;groupbox&gt;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+      &lt;caption label=&quot;&amp;newFeedSettings.label;&quot;/&gt;</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23">       &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-        &lt;checkbox id=&quot;server.doBiff&quot;</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-                  wsm_persist=&quot;true&quot;</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+        &lt;checkbox id=&quot;updateEnabled&quot;</span>
<a href="#l18.27"></a><span id="l18.27">                   label=&quot;&amp;biffStart.label;&quot;</span>
<a href="#l18.28"></a><span id="l18.28">                   accesskey=&quot;&amp;biffStart.accesskey;&quot;</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineminus">-                  oncommand=&quot;onCheckItem('server.biffMinutes', [this.id]);&quot;</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-                  prefattribute=&quot;value&quot;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-                  prefstring=&quot;mail.server.%serverkey%.check_new_mail&quot;/&gt;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-        &lt;textbox id=&quot;server.biffMinutes&quot;</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-                 wsm_persist=&quot;true&quot;</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+                  oncommand=&quot;setPrefs(this)&quot;/&gt;</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+        &lt;textbox id=&quot;updateValue&quot;</span>
<a href="#l18.36"></a><span id="l18.36">                  type=&quot;number&quot;</span>
<a href="#l18.37"></a><span id="l18.37">                  size=&quot;3&quot;</span>
<a href="#l18.38"></a><span id="l18.38">                  min=&quot;1&quot;</span>
<a href="#l18.39"></a><span id="l18.39">                  increment=&quot;1&quot;</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-                 preftype=&quot;int&quot;</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-                 prefstring=&quot;mail.server.%serverkey%.check_time&quot;</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-                 aria-labelledby=&quot;server.doBiff server.biffMinutes biffEnd&quot;/&gt;</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineminus">-        &lt;label id=&quot;biffEnd&quot;</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineminus">-             value=&quot;&amp;biffEnd.label;&quot;</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineminus">-             control=&quot;server.biffMinutes&quot;/&gt;</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+                 aria-labelledby=&quot;updateEnabled updateValue biffMinutes biffDays&quot;</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+                 onchange=&quot;setPrefs(this)&quot;/&gt;</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+        &lt;radiogroup id=&quot;biffUnits&quot;</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+                    orient=&quot;horizontal&quot;</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineplus">+                    oncommand=&quot;setPrefs(this)&quot;&gt;</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+          &lt;radio id=&quot;biffMinutes&quot; value=&quot;min&quot; label=&quot;&amp;biffMinutes.label;&quot;</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineplus">+                 accesskey=&quot;&amp;biffMinutes.accesskey;&quot;&gt;</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineplus">+            &lt;observes element=&quot;updateValue&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineplus">+          &lt;/radio&gt;</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+          &lt;radio id=&quot;biffDays&quot; value=&quot;d&quot; label=&quot;&amp;biffDays.label;&quot;</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+                 accesskey=&quot;&amp;biffDays.accesskey;&quot;&gt;</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+            &lt;observes element=&quot;updateValue&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+          &lt;/radio&gt;</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+        &lt;/radiogroup&gt;</span>
<a href="#l18.60"></a><span id="l18.60">       &lt;/hbox&gt;</span>
<a href="#l18.61"></a><span id="l18.61"> </span>
<a href="#l18.62"></a><span id="l18.62">       &lt;checkbox id=&quot;server.quickMode&quot;</span>
<a href="#l18.63"></a><span id="l18.63">                 wsm_persist=&quot;true&quot;</span>
<a href="#l18.64"></a><span id="l18.64">                 genericattr=&quot;true&quot;</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-                label=&quot;&amp;useQuickMode.label;&quot;</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-                accesskey=&quot;&amp;useQuickMode.accesskey;&quot;</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineplus">+                label=&quot;&amp;quickMode.label;&quot;</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineplus">+                accesskey=&quot;&amp;quickMode.accesskey;&quot;</span>
<a href="#l18.69"></a><span id="l18.69">                 preftype=&quot;bool&quot;</span>
<a href="#l18.70"></a><span id="l18.70">                 prefattribute=&quot;value&quot;</span>
<a href="#l18.71"></a><span id="l18.71">                 prefstring=&quot;mail.server.%serverkey%.quickMode&quot;/&gt;</span>
<a href="#l18.72"></a><span id="l18.72"> </span>
<a href="#l18.73"></a><span id="l18.73">       &lt;checkbox id=&quot;autotagEnable&quot;</span>
<a href="#l18.74"></a><span id="l18.74">                 accesskey=&quot;&amp;autotagEnable.accesskey;&quot;</span>
<a href="#l18.75"></a><span id="l18.75">                 label=&quot;&amp;autotagEnable.label;&quot;</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineminus">-                oncommand=&quot;setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineplus">+                oncommand=&quot;setPrefs(this)&quot;/&gt;</span>
<a href="#l18.78"></a><span id="l18.78">       &lt;hbox&gt;</span>
<a href="#l18.79"></a><span id="l18.79">           &lt;checkbox id=&quot;autotagUsePrefix&quot;</span>
<a href="#l18.80"></a><span id="l18.80">                     class=&quot;indent&quot;</span>
<a href="#l18.81"></a><span id="l18.81">                     accesskey=&quot;&amp;autotagUsePrefix.accesskey;&quot;</span>
<a href="#l18.82"></a><span id="l18.82">                     label=&quot;&amp;autotagUsePrefix.label;&quot;</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineminus">-                    oncommand=&quot;setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineplus">+                    oncommand=&quot;setPrefs(this)&quot;/&gt;</span>
<a href="#l18.85"></a><span id="l18.85">           &lt;textbox id=&quot;autotagPrefix&quot;</span>
<a href="#l18.86"></a><span id="l18.86">                    placeholder=&quot;&amp;autoTagPrefix.placeholder;&quot;</span>
<a href="#l18.87"></a><span id="l18.87">                    clickSelectsAll=&quot;true&quot;</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineminus">-                   onchange=&quot;setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l18.89"></a><span id="l18.89" class="difflineplus">+                   onchange=&quot;setPrefs(this)&quot;/&gt;</span>
<a href="#l18.90"></a><span id="l18.90">       &lt;/hbox&gt;</span>
<a href="#l18.91"></a><span id="l18.91">     &lt;/groupbox&gt;</span>
<a href="#l18.92"></a><span id="l18.92"> </span>
<a href="#l18.93"></a><span id="l18.93">     &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l18.94"></a><span id="l18.94"> </span>
<a href="#l18.95"></a><span id="l18.95" class="difflineplus">+    &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineplus">+      &lt;button label=&quot;&amp;manageSubscriptions.label;&quot;</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineplus">+              accesskey=&quot;&amp;manageSubscriptions.accesskey;&quot;</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineplus">+              oncommand=&quot;openSubscriptionsDialog(gServer.rootFolder);&quot;/&gt;</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineplus">+      &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineplus">+</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineplus">+    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineplus">+</span>
<a href="#l18.104"></a><span id="l18.104">     &lt;groupbox&gt;</span>
<a href="#l18.105"></a><span id="l18.105">       &lt;caption label=&quot;&amp;messageStorage.label;&quot;/&gt;</span>
<a href="#l18.106"></a><span id="l18.106"> </span>
<a href="#l18.107"></a><span id="l18.107">       &lt;checkbox id=&quot;server.emptyTrashOnExit&quot;</span>
<a href="#l18.108"></a><span id="l18.108">                 wsm_persist=&quot;true&quot;</span>
<a href="#l18.109"></a><span id="l18.109">                 label=&quot;&amp;emptyTrashOnExit.label;&quot;</span>
<a href="#l18.110"></a><span id="l18.110">                 accesskey=&quot;&amp;emptyTrashOnExit.accesskey;&quot;</span>
<a href="#l18.111"></a><span id="l18.111">                 prefattribute=&quot;value&quot;</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineat">@@ -137,19 +160,10 @@</span>
<a href="#l18.113"></a><span id="l18.113">                   label=&quot;&amp;browseFolder.label;&quot;</span>
<a href="#l18.114"></a><span id="l18.114">                   filepickertitle=&quot;&amp;localFolderPicker.label;&quot;</span>
<a href="#l18.115"></a><span id="l18.115">                   accesskey=&quot;&amp;browseFolder.accesskey;&quot;</span>
<a href="#l18.116"></a><span id="l18.116">                   oncommand=&quot;BrowseForLocalFolders();&quot;/&gt;</span>
<a href="#l18.117"></a><span id="l18.117">         &lt;/hbox&gt;</span>
<a href="#l18.118"></a><span id="l18.118">       &lt;/vbox&gt;</span>
<a href="#l18.119"></a><span id="l18.119"> </span>
<a href="#l18.120"></a><span id="l18.120">     &lt;/groupbox&gt;</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineminus">-</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineminus">-    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineminus">-</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineminus">-    &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineminus">-      &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineminus">-      &lt;button label=&quot;&amp;manageSubscriptions.label;&quot;</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineminus">-              accesskey=&quot;&amp;manageSubscriptions.accesskey;&quot;</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineminus">-              oncommand=&quot;openSubscriptionsDialog(gServer.rootFolder);&quot;/&gt;</span>
<a href="#l18.129"></a><span id="l18.129" class="difflineminus">-    &lt;/hbox&gt;</span>
<a href="#l18.130"></a><span id="l18.130">   &lt;/vbox&gt;</span>
<a href="#l18.131"></a><span id="l18.131"> &lt;/page&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-parser.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-parser.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -118,16 +118,18 @@ FeedParser.prototype =</span>
<a href="#l19.4"></a><span id="l19.4">       FeedUtils.log.error(&quot;FeedParser.parseAsRSS2: missing mandatory element &quot; +</span>
<a href="#l19.5"></a><span id="l19.5">                           &quot;&lt;title&gt; and &lt;description&gt;, or &lt;link&gt;&quot;);</span>
<a href="#l19.6"></a><span id="l19.6">       return aFeed.onParseError(aFeed);</span>
<a href="#l19.7"></a><span id="l19.7">     }</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">     if (!aFeed.parseItems)</span>
<a href="#l19.10"></a><span id="l19.10">       return parsedItems;</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+    this.findSyUpdateTags(aFeed, channel);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+</span>
<a href="#l19.14"></a><span id="l19.14">     aFeed.invalidateItems();</span>
<a href="#l19.15"></a><span id="l19.15">     // XXX use getElementsByTagNameNS for now; childrenByTagNameNS would be</span>
<a href="#l19.16"></a><span id="l19.16">     // better, but RSS .90 is still with us.</span>
<a href="#l19.17"></a><span id="l19.17">     let itemNodes = aDOM.getElementsByTagNameNS(nsURI, &quot;item&quot;);</span>
<a href="#l19.18"></a><span id="l19.18">     itemNodes = itemNodes ? itemNodes : [];</span>
<a href="#l19.19"></a><span id="l19.19">     FeedUtils.log.debug(&quot;FeedParser.parseAsRSS2: items to parse - &quot; +</span>
<a href="#l19.20"></a><span id="l19.20">                         itemNodes.length);</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -344,16 +346,18 @@ FeedParser.prototype =</span>
<a href="#l19.23"></a><span id="l19.23">       FeedUtils.log.error(&quot;FeedParser.parseAsRSS1: missing mandatory element &quot; +</span>
<a href="#l19.24"></a><span id="l19.24">                           &quot;&lt;title&gt; and &lt;description&gt;, or &lt;link&gt;&quot;);</span>
<a href="#l19.25"></a><span id="l19.25">       return aFeed.onParseError(aFeed);</span>
<a href="#l19.26"></a><span id="l19.26">     }</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">     if (!aFeed.parseItems)</span>
<a href="#l19.29"></a><span id="l19.29">       return parsedItems;</span>
<a href="#l19.30"></a><span id="l19.30"> </span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+    this.findSyUpdateTags(aFeed, channel, ds);</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+</span>
<a href="#l19.33"></a><span id="l19.33">     aFeed.invalidateItems();</span>
<a href="#l19.34"></a><span id="l19.34"> </span>
<a href="#l19.35"></a><span id="l19.35">     // Ignore the &lt;items&gt; list and just get the &lt;item&gt;s.</span>
<a href="#l19.36"></a><span id="l19.36">     let items = ds.GetSources(FeedUtils.RDF_TYPE, FeedUtils.RSS_ITEM, true);</span>
<a href="#l19.37"></a><span id="l19.37"> </span>
<a href="#l19.38"></a><span id="l19.38">     let index = 0;</span>
<a href="#l19.39"></a><span id="l19.39">     while (items.hasMoreElements())</span>
<a href="#l19.40"></a><span id="l19.40">     {</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineat">@@ -423,16 +427,18 @@ FeedParser.prototype =</span>
<a href="#l19.42"></a><span id="l19.42">       FeedUtils.log.error(&quot;FeedParser.parseAsAtom: missing mandatory element &quot; +</span>
<a href="#l19.43"></a><span id="l19.43">                           &quot;&lt;title&gt;&quot;);</span>
<a href="#l19.44"></a><span id="l19.44">       return aFeed.onParseError(aFeed);</span>
<a href="#l19.45"></a><span id="l19.45">     }</span>
<a href="#l19.46"></a><span id="l19.46"> </span>
<a href="#l19.47"></a><span id="l19.47">     if (!aFeed.parseItems)</span>
<a href="#l19.48"></a><span id="l19.48">       return parsedItems;</span>
<a href="#l19.49"></a><span id="l19.49"> </span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+    this.findSyUpdateTags(aFeed, channel);</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+</span>
<a href="#l19.52"></a><span id="l19.52">     aFeed.invalidateItems();</span>
<a href="#l19.53"></a><span id="l19.53">     let items = this.childrenByTagNameNS(channel, FeedUtils.ATOM_03_NS, &quot;entry&quot;);</span>
<a href="#l19.54"></a><span id="l19.54">     items = items ? items : [];</span>
<a href="#l19.55"></a><span id="l19.55">     FeedUtils.log.debug(&quot;FeedParser.parseAsAtom: items to parse - &quot; +</span>
<a href="#l19.56"></a><span id="l19.56">                         items.length);</span>
<a href="#l19.57"></a><span id="l19.57"> </span>
<a href="#l19.58"></a><span id="l19.58">     for (let itemNode of items)</span>
<a href="#l19.59"></a><span id="l19.59">     {</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineat">@@ -508,17 +514,17 @@ FeedParser.prototype =</span>
<a href="#l19.61"></a><span id="l19.61">         for (let j = 0; j &lt; contentNode.childNodes.length; j++)</span>
<a href="#l19.62"></a><span id="l19.62">         {</span>
<a href="#l19.63"></a><span id="l19.63">           let node = contentNode.childNodes.item(j);</span>
<a href="#l19.64"></a><span id="l19.64">           if (node.nodeType == node.CDATA_SECTION_NODE)</span>
<a href="#l19.65"></a><span id="l19.65">             content += node.data;</span>
<a href="#l19.66"></a><span id="l19.66">           else</span>
<a href="#l19.67"></a><span id="l19.67">             content += this.mSerializer.serializeToString(node);</span>
<a href="#l19.68"></a><span id="l19.68">         }</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineminus">-      </span>
<a href="#l19.70"></a><span id="l19.70" class="difflineplus">+</span>
<a href="#l19.71"></a><span id="l19.71">         if (contentNode.getAttribute(&quot;mode&quot;) == &quot;escaped&quot;)</span>
<a href="#l19.72"></a><span id="l19.72">         {</span>
<a href="#l19.73"></a><span id="l19.73">           content = content.replace(/&amp;lt;/g, &quot;&lt;&quot;);</span>
<a href="#l19.74"></a><span id="l19.74">           content = content.replace(/&amp;gt;/g, &quot;&gt;&quot;);</span>
<a href="#l19.75"></a><span id="l19.75">           content = content.replace(/&amp;amp;/g, &quot;&amp;&quot;);</span>
<a href="#l19.76"></a><span id="l19.76">         }</span>
<a href="#l19.77"></a><span id="l19.77"> </span>
<a href="#l19.78"></a><span id="l19.78">         if (content == &quot;&quot;)</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineat">@@ -559,16 +565,18 @@ FeedParser.prototype =</span>
<a href="#l19.80"></a><span id="l19.80">       FeedUtils.log.error(&quot;FeedParser.parseAsAtomIETF: missing mandatory element &quot; +</span>
<a href="#l19.81"></a><span id="l19.81">                           &quot;&lt;title&gt;&quot;);</span>
<a href="#l19.82"></a><span id="l19.82">       return aFeed.onParseError(aFeed);</span>
<a href="#l19.83"></a><span id="l19.83">     }</span>
<a href="#l19.84"></a><span id="l19.84"> </span>
<a href="#l19.85"></a><span id="l19.85">     if (!aFeed.parseItems)</span>
<a href="#l19.86"></a><span id="l19.86">       return parsedItems;</span>
<a href="#l19.87"></a><span id="l19.87"> </span>
<a href="#l19.88"></a><span id="l19.88" class="difflineplus">+    this.findSyUpdateTags(aFeed, channel);</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineplus">+</span>
<a href="#l19.90"></a><span id="l19.90">     aFeed.invalidateItems();</span>
<a href="#l19.91"></a><span id="l19.91">     let items = this.childrenByTagNameNS(channel, FeedUtils.ATOM_IETF_NS, &quot;entry&quot;);</span>
<a href="#l19.92"></a><span id="l19.92">     items = items ? items : [];</span>
<a href="#l19.93"></a><span id="l19.93">     FeedUtils.log.debug(&quot;FeedParser.parseAsAtomIETF: items to parse - &quot; +</span>
<a href="#l19.94"></a><span id="l19.94">                         items.length);</span>
<a href="#l19.95"></a><span id="l19.95"> </span>
<a href="#l19.96"></a><span id="l19.96">     for (let itemNode of items)</span>
<a href="#l19.97"></a><span id="l19.97">     {</span>
<a href="#l19.98"></a><span id="l19.98" class="difflineat">@@ -873,16 +881,71 @@ FeedParser.prototype =</span>
<a href="#l19.99"></a><span id="l19.99">         }</span>
<a href="#l19.100"></a><span id="l19.100">         catch (ex) {}</span>
<a href="#l19.101"></a><span id="l19.101">       }</span>
<a href="#l19.102"></a><span id="l19.102">     }</span>
<a href="#l19.103"></a><span id="l19.103"> </span>
<a href="#l19.104"></a><span id="l19.104">     return null;</span>
<a href="#l19.105"></a><span id="l19.105">   },</span>
<a href="#l19.106"></a><span id="l19.106"> </span>
<a href="#l19.107"></a><span id="l19.107" class="difflineplus">+  /**</span>
<a href="#l19.108"></a><span id="l19.108" class="difflineplus">+   * Find RSS Syndication extension tags.</span>
<a href="#l19.109"></a><span id="l19.109" class="difflineplus">+   * http://web.resource.org/rss/1.0/modules/syndication/</span>
<a href="#l19.110"></a><span id="l19.110" class="difflineplus">+   *</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineplus">+   * Feed aFeed           - the feed object.</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineplus">+   * Node aChannel        - dom node for the &lt;channel&gt;.</span>
<a href="#l19.113"></a><span id="l19.113" class="difflineplus">+   * nsIRDFDataSource aDS - passed in for rdf feeds only.</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineplus">+   */</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineplus">+  findSyUpdateTags: function(aFeed, aChannel, aDS)</span>
<a href="#l19.116"></a><span id="l19.116" class="difflineplus">+  {</span>
<a href="#l19.117"></a><span id="l19.117" class="difflineplus">+    let tag, updatePeriod, updateFrequency, updateBase;</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineplus">+    if (aDS)</span>
<a href="#l19.119"></a><span id="l19.119" class="difflineplus">+    {</span>
<a href="#l19.120"></a><span id="l19.120" class="difflineplus">+      // For rdf feeds.</span>
<a href="#l19.121"></a><span id="l19.121" class="difflineplus">+      tag = FeedUtils.rdf.GetResource(FeedUtils.RSS_SY_NS + &quot;updatePeriod&quot;);</span>
<a href="#l19.122"></a><span id="l19.122" class="difflineplus">+      updatePeriod = this.getRDFTargetValue(aDS, aChannel, tag) || &quot;&quot;;</span>
<a href="#l19.123"></a><span id="l19.123" class="difflineplus">+      tag = FeedUtils.rdf.GetResource(FeedUtils.RSS_SY_NS + &quot;updateFrequency&quot;);</span>
<a href="#l19.124"></a><span id="l19.124" class="difflineplus">+      updateFrequency = this.getRDFTargetValue(aDS, aChannel, tag) || &quot;&quot;;</span>
<a href="#l19.125"></a><span id="l19.125" class="difflineplus">+      tag = FeedUtils.rdf.GetResource(FeedUtils.RSS_SY_NS + &quot;updateBase&quot;);</span>
<a href="#l19.126"></a><span id="l19.126" class="difflineplus">+      updateBase = this.getRDFTargetValue(aDS, aChannel, tag) || &quot;&quot;;</span>
<a href="#l19.127"></a><span id="l19.127" class="difflineplus">+    }</span>
<a href="#l19.128"></a><span id="l19.128" class="difflineplus">+    else</span>
<a href="#l19.129"></a><span id="l19.129" class="difflineplus">+    {</span>
<a href="#l19.130"></a><span id="l19.130" class="difflineplus">+      tag = this.childrenByTagNameNS(aChannel, FeedUtils.RSS_SY_NS, &quot;updatePeriod&quot;);</span>
<a href="#l19.131"></a><span id="l19.131" class="difflineplus">+      updatePeriod = this.getNodeValue(tag ? tag[0] : null) || &quot;&quot;;</span>
<a href="#l19.132"></a><span id="l19.132" class="difflineplus">+      tag = this.childrenByTagNameNS(aChannel, FeedUtils.RSS_SY_NS, &quot;updateFrequency&quot;);</span>
<a href="#l19.133"></a><span id="l19.133" class="difflineplus">+      updateFrequency = this.getNodeValue(tag ? tag[0] : null) || &quot;&quot;;</span>
<a href="#l19.134"></a><span id="l19.134" class="difflineplus">+      tag = this.childrenByTagNameNS(aChannel, FeedUtils.RSS_SY_NS, &quot;updateBase&quot;);</span>
<a href="#l19.135"></a><span id="l19.135" class="difflineplus">+      updateBase = this.getNodeValue(tag ? tag[0] : null) || &quot;&quot;;</span>
<a href="#l19.136"></a><span id="l19.136" class="difflineplus">+    }</span>
<a href="#l19.137"></a><span id="l19.137" class="difflineplus">+    FeedUtils.log.debug(&quot;FeedParser.findSyUpdateTags: updatePeriod:updateFrequency - &quot; +</span>
<a href="#l19.138"></a><span id="l19.138" class="difflineplus">+                        updatePeriod + &quot;:&quot; + updateFrequency);</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineplus">+</span>
<a href="#l19.140"></a><span id="l19.140" class="difflineplus">+    if (updatePeriod)</span>
<a href="#l19.141"></a><span id="l19.141" class="difflineplus">+    {</span>
<a href="#l19.142"></a><span id="l19.142" class="difflineplus">+      if (FeedUtils.RSS_SY_UNITS.includes(updatePeriod.toLowerCase()))</span>
<a href="#l19.143"></a><span id="l19.143" class="difflineplus">+        updatePeriod = updatePeriod.toLowerCase();</span>
<a href="#l19.144"></a><span id="l19.144" class="difflineplus">+      else</span>
<a href="#l19.145"></a><span id="l19.145" class="difflineplus">+        updatePeriod = &quot;daily&quot;;</span>
<a href="#l19.146"></a><span id="l19.146" class="difflineplus">+    }</span>
<a href="#l19.147"></a><span id="l19.147" class="difflineplus">+</span>
<a href="#l19.148"></a><span id="l19.148" class="difflineplus">+    updateFrequency = isNaN(updateFrequency) ? 1 : updateFrequency;</span>
<a href="#l19.149"></a><span id="l19.149" class="difflineplus">+</span>
<a href="#l19.150"></a><span id="l19.150" class="difflineplus">+    let options = aFeed.options;</span>
<a href="#l19.151"></a><span id="l19.151" class="difflineplus">+    if (options.updates.updatePeriod == updatePeriod &amp;&amp;</span>
<a href="#l19.152"></a><span id="l19.152" class="difflineplus">+        options.updates.updateFrequency == updateFrequency &amp;&amp;</span>
<a href="#l19.153"></a><span id="l19.153" class="difflineplus">+        options.updates.updateBase == updateBase)</span>
<a href="#l19.154"></a><span id="l19.154" class="difflineplus">+      return;</span>
<a href="#l19.155"></a><span id="l19.155" class="difflineplus">+</span>
<a href="#l19.156"></a><span id="l19.156" class="difflineplus">+    options.updates.updatePeriod = updatePeriod;</span>
<a href="#l19.157"></a><span id="l19.157" class="difflineplus">+    options.updates.updateFrequency = updateFrequency;</span>
<a href="#l19.158"></a><span id="l19.158" class="difflineplus">+    options.updates.updateBase = updateBase;</span>
<a href="#l19.159"></a><span id="l19.159" class="difflineplus">+    aFeed.options = options;</span>
<a href="#l19.160"></a><span id="l19.160" class="difflineplus">+  },</span>
<a href="#l19.161"></a><span id="l19.161" class="difflineplus">+</span>
<a href="#l19.162"></a><span id="l19.162">   stripTags: function(someHTML)</span>
<a href="#l19.163"></a><span id="l19.163">   {</span>
<a href="#l19.164"></a><span id="l19.164">     return someHTML ? someHTML.replace(/&lt;[^&gt;]+&gt;/g, &quot;&quot;) : someHTML;</span>
<a href="#l19.165"></a><span id="l19.165">   },</span>
<a href="#l19.166"></a><span id="l19.166"> </span>
<a href="#l19.167"></a><span id="l19.167">   xmlUnescape: function(s)</span>
<a href="#l19.168"></a><span id="l19.168">   {</span>
<a href="#l19.169"></a><span id="l19.169">     s = s.replace(/&amp;lt;/g, &quot;&lt;&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l20.4"></a><span id="l20.4"> /* -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l20.5"></a><span id="l20.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l20.6"></a><span id="l20.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.7"></a><span id="l20.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> Components.utils.import(&quot;resource:///modules/FeedUtils.jsm&quot;);</span>
<a href="#l20.10"></a><span id="l20.10"> Components.utils.import(&quot;resource:///modules/gloda/log4moz.js&quot;);</span>
<a href="#l20.11"></a><span id="l20.11"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l20.13"></a><span id="l20.13"> Components.utils.import(&quot;resource://gre/modules/FileUtils.jsm&quot;);</span>
<a href="#l20.14"></a><span id="l20.14"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l20.15"></a><span id="l20.15"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17"> var {classes: Cc, interfaces: Ci} = Components;</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19"> var FeedSubscriptions = {</span>
<a href="#l20.20"></a><span id="l20.20">   get mMainWin() { return Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;); },</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineat">@@ -167,48 +168,62 @@ var FeedSubscriptions = {</span>
<a href="#l20.22"></a><span id="l20.22">     getRowProperties: function(aRow)                   { return &quot;&quot;; },</span>
<a href="#l20.23"></a><span id="l20.23">     getColumnProperties: function(aCol)                { return &quot;&quot;; },</span>
<a href="#l20.24"></a><span id="l20.24">     getCellValue: function (aRow, aColumn)             {},</span>
<a href="#l20.25"></a><span id="l20.25">     setCellValue: function (aRow, aColumn, aValue)     {},</span>
<a href="#l20.26"></a><span id="l20.26">     setCellText: function (aRow, aColumn, aValue)      {},</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28">     getCellProperties: function (aRow, aColumn) {</span>
<a href="#l20.29"></a><span id="l20.29">       let item = this.getItemAtIndex(aRow);</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-      let folder = item &amp;&amp; item.folder ? item.folder : null;</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-#ifdef MOZ_THUNDERBIRD</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-      let properties = [&quot;folderNameCol&quot;];</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-      let hasFeeds = folder ? FeedUtils.getFeedUrlsInFolder(folder) : false;</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-      let prop = !folder ? &quot;isFeed-true&quot; :</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-                 hasFeeds ? &quot;isFeedFolder-true&quot; :</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-                 folder.isServer ? &quot;serverType-rss isServer-true&quot; : null;</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-      if (prop)</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">-        properties.push(prop);</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-      return properties.join(&quot; &quot;);</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">-#else</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineminus">-      return !folder ? &quot;serverType-rss&quot; :</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-             folder.isServer ? &quot;serverType-rss isServer-true&quot; : &quot;livemark&quot;;</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-#endif</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineplus">+      if (!item)</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+        return;</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+      if (AppConstants.MOZ_APP_NAME != &quot;thunderbird&quot;)</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+      {</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+        return !item.folder ? &quot;serverType-rss&quot; :</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+               item.folder.isServer ? &quot;serverType-rss isServer-true&quot; : &quot;livemark&quot;;</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+      }</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineplus">+</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineplus">+      let folder = item.folder;</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+      let properties = &quot;folderNameCol&quot;;</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+      let mainWin = FeedSubscriptions.mMainWin;</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineplus">+      if (!mainWin)</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineplus">+      {</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+        let hasFeeds = FeedUtils.getFeedUrlsInFolder(folder);</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineplus">+        properties += !folder ? &quot; isFeed-true&quot; :</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineplus">+                      hasFeeds ? &quot; isFeedFolder-true&quot; :</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+                      folder.isServer ? &quot; serverType-rss isServer-true&quot; : &quot;&quot;;</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+      }</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineplus">+      else</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineplus">+      {</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+        let url = folder ? null : item.url;</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineplus">+        folder = folder || item.parentFolder;</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineplus">+        properties += mainWin.FeedUtils.getFolderProperties(folder, url);</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineplus">+      }</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineplus">+</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+      item[&quot;properties&quot;] = properties;</span>
<a href="#l20.71"></a><span id="l20.71" class="difflineplus">+      return properties;</span>
<a href="#l20.72"></a><span id="l20.72">     },</span>
<a href="#l20.73"></a><span id="l20.73"> </span>
<a href="#l20.74"></a><span id="l20.74">     isContainer: function (aRow)</span>
<a href="#l20.75"></a><span id="l20.75">     {</span>
<a href="#l20.76"></a><span id="l20.76">       let item = this.getItemAtIndex(aRow);</span>
<a href="#l20.77"></a><span id="l20.77">       return item ? item.container : false;</span>
<a href="#l20.78"></a><span id="l20.78">     },</span>
<a href="#l20.79"></a><span id="l20.79"> </span>
<a href="#l20.80"></a><span id="l20.80">     isContainerOpen: function (aRow)</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineminus">-    { </span>
<a href="#l20.82"></a><span id="l20.82" class="difflineplus">+    {</span>
<a href="#l20.83"></a><span id="l20.83">       let item = this.getItemAtIndex(aRow);</span>
<a href="#l20.84"></a><span id="l20.84">       return item ? item.open : false;</span>
<a href="#l20.85"></a><span id="l20.85">     },</span>
<a href="#l20.86"></a><span id="l20.86"> </span>
<a href="#l20.87"></a><span id="l20.87">     isContainerEmpty: function (aRow)</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineminus">-    { </span>
<a href="#l20.89"></a><span id="l20.89" class="difflineplus">+    {</span>
<a href="#l20.90"></a><span id="l20.90">       let item = this.getItemAtIndex(aRow);</span>
<a href="#l20.91"></a><span id="l20.91" class="difflineminus">-      if (!item) </span>
<a href="#l20.92"></a><span id="l20.92" class="difflineplus">+      if (!item)</span>
<a href="#l20.93"></a><span id="l20.93">         return false;</span>
<a href="#l20.94"></a><span id="l20.94"> </span>
<a href="#l20.95"></a><span id="l20.95">       return item.children.length == 0;</span>
<a href="#l20.96"></a><span id="l20.96">     },</span>
<a href="#l20.97"></a><span id="l20.97"> </span>
<a href="#l20.98"></a><span id="l20.98">     getItemAtIndex: function (aRow)</span>
<a href="#l20.99"></a><span id="l20.99">     {</span>
<a href="#l20.100"></a><span id="l20.100">       if (aRow &lt; 0 || aRow &gt;= FeedSubscriptions.mFeedContainers.length)</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineat">@@ -287,16 +302,21 @@ var FeedSubscriptions = {</span>
<a href="#l20.102"></a><span id="l20.102">     },</span>
<a href="#l20.103"></a><span id="l20.103"> </span>
<a href="#l20.104"></a><span id="l20.104">     getImageSrc: function(aRow, aCol)</span>
<a href="#l20.105"></a><span id="l20.105">     {</span>
<a href="#l20.106"></a><span id="l20.106">       let item = this.getItemAtIndex(aRow);</span>
<a href="#l20.107"></a><span id="l20.107">       if ((item.folder &amp;&amp; item.folder.isServer) || item.open)</span>
<a href="#l20.108"></a><span id="l20.108">         return &quot;&quot;;</span>
<a href="#l20.109"></a><span id="l20.109"> </span>
<a href="#l20.110"></a><span id="l20.110" class="difflineplus">+      if (!item.open &amp;&amp;</span>
<a href="#l20.111"></a><span id="l20.111" class="difflineplus">+          (item.properties.includes(&quot;hasError&quot;) ||</span>
<a href="#l20.112"></a><span id="l20.112" class="difflineplus">+           item.properties.includes(&quot;isBusy&quot;)))</span>
<a href="#l20.113"></a><span id="l20.113" class="difflineplus">+        return &quot;&quot;;</span>
<a href="#l20.114"></a><span id="l20.114" class="difflineplus">+</span>
<a href="#l20.115"></a><span id="l20.115">       if (item.favicon != null)</span>
<a href="#l20.116"></a><span id="l20.116">         return item.favicon;</span>
<a href="#l20.117"></a><span id="l20.117"> </span>
<a href="#l20.118"></a><span id="l20.118">       if (item.folder &amp;&amp; FeedSubscriptions.mMainWin &amp;&amp;</span>
<a href="#l20.119"></a><span id="l20.119">           &quot;gFolderTreeView&quot; in FeedSubscriptions.mMainWin) {</span>
<a href="#l20.120"></a><span id="l20.120">         let favicon = FeedSubscriptions.mMainWin.gFolderTreeView</span>
<a href="#l20.121"></a><span id="l20.121">                                        .getFolderCacheProperty(item.folder, &quot;favicon&quot;);</span>
<a href="#l20.122"></a><span id="l20.122">         if (favicon != null)</span>
<a href="#l20.123"></a><span id="l20.123" class="difflineat">@@ -344,17 +364,17 @@ var FeedSubscriptions = {</span>
<a href="#l20.124"></a><span id="l20.124">         }, 0);</span>
<a href="#l20.125"></a><span id="l20.125">       }</span>
<a href="#l20.126"></a><span id="l20.126"> </span>
<a href="#l20.127"></a><span id="l20.127">       // Store empty string to return default while favicons are retrieved.</span>
<a href="#l20.128"></a><span id="l20.128">       return item.favicon = &quot;&quot;;</span>
<a href="#l20.129"></a><span id="l20.129">     },</span>
<a href="#l20.130"></a><span id="l20.130"> </span>
<a href="#l20.131"></a><span id="l20.131">     canDrop: function (aRow, aOrientation)</span>
<a href="#l20.132"></a><span id="l20.132" class="difflineminus">-    { </span>
<a href="#l20.133"></a><span id="l20.133" class="difflineplus">+    {</span>
<a href="#l20.134"></a><span id="l20.134">       let dropResult = this.extractDragData(aRow);</span>
<a href="#l20.135"></a><span id="l20.135">       return aOrientation == Ci.nsITreeView.DROP_ON &amp;&amp; dropResult.canDrop &amp;&amp;</span>
<a href="#l20.136"></a><span id="l20.136">              (dropResult.dropUrl || dropResult.dropOnIndex != this.kRowIndexUndefined);</span>
<a href="#l20.137"></a><span id="l20.137">     },</span>
<a href="#l20.138"></a><span id="l20.138"> </span>
<a href="#l20.139"></a><span id="l20.139">     drop: function (aRow, aOrientation)</span>
<a href="#l20.140"></a><span id="l20.140">     {</span>
<a href="#l20.141"></a><span id="l20.141">       let win = FeedSubscriptions;</span>
<a href="#l20.142"></a><span id="l20.142" class="difflineat">@@ -688,31 +708,31 @@ var FeedSubscriptions = {</span>
<a href="#l20.143"></a><span id="l20.143">     FeedSubscriptions.mTree.focus();</span>
<a href="#l20.144"></a><span id="l20.144">   },</span>
<a href="#l20.145"></a><span id="l20.145"> </span>
<a href="#l20.146"></a><span id="l20.146">   /**</span>
<a href="#l20.147"></a><span id="l20.147">    * Find the folder in the tree.  The search may be limited to subfolders of</span>
<a href="#l20.148"></a><span id="l20.148">    * a known folder, or expanded to include the entire tree. This function is</span>
<a href="#l20.149"></a><span id="l20.149">    * also used to insert/remove folders without rebuilding the tree view cache</span>
<a href="#l20.150"></a><span id="l20.150">    * (to avoid position/toggle state loss).</span>
<a href="#l20.151"></a><span id="l20.151" class="difflineminus">-   * </span>
<a href="#l20.152"></a><span id="l20.152" class="difflineplus">+   *</span>
<a href="#l20.153"></a><span id="l20.153">    * @param  aFolder nsIMsgFolder - the folder to find.</span>
<a href="#l20.154"></a><span id="l20.154">    * @param  [aParams] object     - params object, containing:</span>
<a href="#l20.155"></a><span id="l20.155" class="difflineminus">-   * </span>
<a href="#l20.156"></a><span id="l20.156" class="difflineplus">+   *</span>
<a href="#l20.157"></a><span id="l20.157">    * [parentIndex] int        - index of folder to start the search; if</span>
<a href="#l20.158"></a><span id="l20.158">    *                            null (default), the index of the folder's</span>
<a href="#l20.159"></a><span id="l20.159">    *                            rootFolder will be used.</span>
<a href="#l20.160"></a><span id="l20.160">    * [select] boolean         - if true (default) the folder's ancestors</span>
<a href="#l20.161"></a><span id="l20.161">    *                            will be opened and the folder selected.</span>
<a href="#l20.162"></a><span id="l20.162">    * [open] boolean           - if true (default) the folder is opened.</span>
<a href="#l20.163"></a><span id="l20.163">    * [remove] boolean         - delete the item from tree row cache if true,</span>
<a href="#l20.164"></a><span id="l20.164">    *                            false (default) otherwise.</span>
<a href="#l20.165"></a><span id="l20.165">    * [newFolder] nsIMsgFolder - if not null (default) the new folder,</span>
<a href="#l20.166"></a><span id="l20.166">    *                            for add or rename.</span>
<a href="#l20.167"></a><span id="l20.167" class="difflineminus">-   * </span>
<a href="#l20.168"></a><span id="l20.168" class="difflineplus">+   *</span>
<a href="#l20.169"></a><span id="l20.169">    * @return bool found - true if found, false if not.</span>
<a href="#l20.170"></a><span id="l20.170">    */</span>
<a href="#l20.171"></a><span id="l20.171">   selectFolder: function(aFolder, aParms)</span>
<a href="#l20.172"></a><span id="l20.172">   {</span>
<a href="#l20.173"></a><span id="l20.173">     let folderURI = aFolder.URI;</span>
<a href="#l20.174"></a><span id="l20.174">     let parentIndex = aParms &amp;&amp; (&quot;parentIndex&quot; in aParms) ? aParms.parentIndex : null;</span>
<a href="#l20.175"></a><span id="l20.175">     let selectIt = aParms &amp;&amp; (&quot;select&quot; in aParms) ? aParms.select : true;</span>
<a href="#l20.176"></a><span id="l20.176">     let openIt = aParms &amp;&amp; (&quot;open&quot; in aParms) ? aParms.open : true;</span>
<a href="#l20.177"></a><span id="l20.177" class="difflineat">@@ -866,20 +886,20 @@ var FeedSubscriptions = {</span>
<a href="#l20.178"></a><span id="l20.178">                         curFirstVisRow + &quot;:&quot; + curLastVisRow + &quot;:&quot; + this.mView.rowCount);</span>
<a href="#l20.179"></a><span id="l20.179"> </span>
<a href="#l20.180"></a><span id="l20.180">     return found;</span>
<a href="#l20.181"></a><span id="l20.181">   },</span>
<a href="#l20.182"></a><span id="l20.182"> </span>
<a href="#l20.183"></a><span id="l20.183">   /**</span>
<a href="#l20.184"></a><span id="l20.184">    * Find the feed in the tree.  The search first gets the feed's folder,</span>
<a href="#l20.185"></a><span id="l20.185">    * then selects the child feed.</span>
<a href="#l20.186"></a><span id="l20.186" class="difflineminus">-   * </span>
<a href="#l20.187"></a><span id="l20.187" class="difflineplus">+   *</span>
<a href="#l20.188"></a><span id="l20.188">    * @param  aFeed {Feed object}    - the feed to find.</span>
<a href="#l20.189"></a><span id="l20.189">    * @param  [aParentIndex] integer - index to start the folder search.</span>
<a href="#l20.190"></a><span id="l20.190" class="difflineminus">-   * </span>
<a href="#l20.191"></a><span id="l20.191" class="difflineplus">+   *</span>
<a href="#l20.192"></a><span id="l20.192">    * @return found bool - true if found, false if not.</span>
<a href="#l20.193"></a><span id="l20.193">    */</span>
<a href="#l20.194"></a><span id="l20.194">   selectFeed: function(aFeed, aParentIndex)</span>
<a href="#l20.195"></a><span id="l20.195">   {</span>
<a href="#l20.196"></a><span id="l20.196">     let folder = aFeed.folder;</span>
<a href="#l20.197"></a><span id="l20.197">     let found = false;</span>
<a href="#l20.198"></a><span id="l20.198"> </span>
<a href="#l20.199"></a><span id="l20.199">     if (aFeed.folder.isServer) {</span>
<a href="#l20.200"></a><span id="l20.200" class="difflineat">@@ -949,31 +969,53 @@ var FeedSubscriptions = {</span>
<a href="#l20.201"></a><span id="l20.201"> </span>
<a href="#l20.202"></a><span id="l20.202">     // Common to both folder and feed items.</span>
<a href="#l20.203"></a><span id="l20.203">     nameValue.disabled = aItem.container;</span>
<a href="#l20.204"></a><span id="l20.204">     this.setFolderPicker(displayFolder, isFeed);</span>
<a href="#l20.205"></a><span id="l20.205"> </span>
<a href="#l20.206"></a><span id="l20.206">     // Set quick mode value.</span>
<a href="#l20.207"></a><span id="l20.207">     document.getElementById(&quot;quickMode&quot;).checked = aItem.quickMode;</span>
<a href="#l20.208"></a><span id="l20.208"> </span>
<a href="#l20.209"></a><span id="l20.209" class="difflineplus">+    if (isServer)</span>
<a href="#l20.210"></a><span id="l20.210" class="difflineplus">+      aItem.options = FeedUtils.getOptionsAcct(server);</span>
<a href="#l20.211"></a><span id="l20.211" class="difflineplus">+</span>
<a href="#l20.212"></a><span id="l20.212" class="difflineplus">+    // Update items.</span>
<a href="#l20.213"></a><span id="l20.213" class="difflineplus">+    let updateEnabled = document.getElementById(&quot;updateEnabled&quot;);</span>
<a href="#l20.214"></a><span id="l20.214" class="difflineplus">+    let updateValue = document.getElementById(&quot;updateValue&quot;);</span>
<a href="#l20.215"></a><span id="l20.215" class="difflineplus">+    let biffUnits = document.getElementById(&quot;biffUnits&quot;);</span>
<a href="#l20.216"></a><span id="l20.216" class="difflineplus">+    let recommendedUnits = document.getElementById(&quot;recommendedUnits&quot;);</span>
<a href="#l20.217"></a><span id="l20.217" class="difflineplus">+    let recommendedUnitsVal = document.getElementById(&quot;recommendedUnitsVal&quot;);</span>
<a href="#l20.218"></a><span id="l20.218" class="difflineplus">+    let updates = aItem.options ? aItem.options.updates :</span>
<a href="#l20.219"></a><span id="l20.219" class="difflineplus">+                                  FeedUtils._optionsDefault.updates;</span>
<a href="#l20.220"></a><span id="l20.220" class="difflineplus">+</span>
<a href="#l20.221"></a><span id="l20.221" class="difflineplus">+    updateEnabled.checked = updates.enabled;</span>
<a href="#l20.222"></a><span id="l20.222" class="difflineplus">+    updateValue.disabled = !updateEnabled.checked;</span>
<a href="#l20.223"></a><span id="l20.223" class="difflineplus">+    biffUnits.value = updates.updateUnits;</span>
<a href="#l20.224"></a><span id="l20.224" class="difflineplus">+    let minutes = updates.updateUnits == FeedUtils.kBiffUnitsMinutes ?</span>
<a href="#l20.225"></a><span id="l20.225" class="difflineplus">+                    updates.updateMinutes :</span>
<a href="#l20.226"></a><span id="l20.226" class="difflineplus">+                    updates.updateMinutes / (24 * 60);</span>
<a href="#l20.227"></a><span id="l20.227" class="difflineplus">+    updateValue.valueNumber = minutes;</span>
<a href="#l20.228"></a><span id="l20.228" class="difflineplus">+    if (isFeed)</span>
<a href="#l20.229"></a><span id="l20.229" class="difflineplus">+      recommendedUnitsVal.value = this.getUpdateMinutesRec(updates);</span>
<a href="#l20.230"></a><span id="l20.230" class="difflineplus">+    else</span>
<a href="#l20.231"></a><span id="l20.231" class="difflineplus">+      recommendedUnitsVal.value = &quot;&quot;;</span>
<a href="#l20.232"></a><span id="l20.232" class="difflineplus">+</span>
<a href="#l20.233"></a><span id="l20.233" class="difflineplus">+    recommendedUnits.hidden = recommendedUnitsVal.value == &quot;&quot;;</span>
<a href="#l20.234"></a><span id="l20.234" class="difflineplus">+</span>
<a href="#l20.235"></a><span id="l20.235">     // Autotag items.</span>
<a href="#l20.236"></a><span id="l20.236">     let autotagEnable = document.getElementById(&quot;autotagEnable&quot;);</span>
<a href="#l20.237"></a><span id="l20.237">     let autotagUsePrefix = document.getElementById(&quot;autotagUsePrefix&quot;);</span>
<a href="#l20.238"></a><span id="l20.238">     let autotagPrefix = document.getElementById(&quot;autotagPrefix&quot;);</span>
<a href="#l20.239"></a><span id="l20.239" class="difflineminus">-    let categoryPrefsAcct = FeedUtils.getOptionsAcct(server).category;</span>
<a href="#l20.240"></a><span id="l20.240" class="difflineminus">-    if (isServer)</span>
<a href="#l20.241"></a><span id="l20.241" class="difflineminus">-      aItem.options = FeedUtils.getOptionsAcct(server);</span>
<a href="#l20.242"></a><span id="l20.242" class="difflineminus">-    let categoryPrefs = aItem.options ? aItem.options.category : null;</span>
<a href="#l20.243"></a><span id="l20.243" class="difflineminus">-</span>
<a href="#l20.244"></a><span id="l20.244" class="difflineminus">-    autotagEnable.checked = categoryPrefs &amp;&amp; categoryPrefs.enabled;</span>
<a href="#l20.245"></a><span id="l20.245" class="difflineminus">-    autotagUsePrefix.checked = categoryPrefs &amp;&amp; categoryPrefs.prefixEnabled;</span>
<a href="#l20.246"></a><span id="l20.246" class="difflineplus">+    let category = aItem.options ? aItem.options.category : null;</span>
<a href="#l20.247"></a><span id="l20.247" class="difflineplus">+</span>
<a href="#l20.248"></a><span id="l20.248" class="difflineplus">+    autotagEnable.checked = category &amp;&amp; category.enabled;</span>
<a href="#l20.249"></a><span id="l20.249" class="difflineplus">+    autotagUsePrefix.checked = category &amp;&amp; category.prefixEnabled;</span>
<a href="#l20.250"></a><span id="l20.250">     autotagUsePrefix.disabled = !autotagEnable.checked;</span>
<a href="#l20.251"></a><span id="l20.251">     autotagPrefix.disabled = autotagUsePrefix.disabled || !autotagUsePrefix.checked;</span>
<a href="#l20.252"></a><span id="l20.252" class="difflineminus">-    autotagPrefix.value = categoryPrefs &amp;&amp; categoryPrefs.prefix ?</span>
<a href="#l20.253"></a><span id="l20.253" class="difflineminus">-                            categoryPrefs.prefix : &quot;&quot;;</span>
<a href="#l20.254"></a><span id="l20.254" class="difflineplus">+    autotagPrefix.value = category &amp;&amp; category.prefix ? category.prefix : &quot;&quot;;</span>
<a href="#l20.255"></a><span id="l20.255">   },</span>
<a href="#l20.256"></a><span id="l20.256"> </span>
<a href="#l20.257"></a><span id="l20.257">   setFolderPicker: function(aFolder, aIsFeed)</span>
<a href="#l20.258"></a><span id="l20.258">   {</span>
<a href="#l20.259"></a><span id="l20.259">     let editFeed = document.getElementById(&quot;editFeed&quot;);</span>
<a href="#l20.260"></a><span id="l20.260">     let folderPrettyPath = FeedUtils.getFolderPrettyPath(aFolder);</span>
<a href="#l20.261"></a><span id="l20.261">     if (!folderPrettyPath)</span>
<a href="#l20.262"></a><span id="l20.262">       return editFeed.disabled = true;</span>
<a href="#l20.263"></a><span id="l20.263" class="difflineat">@@ -1067,37 +1109,50 @@ var FeedSubscriptions = {</span>
<a href="#l20.264"></a><span id="l20.264">     }</span>
<a href="#l20.265"></a><span id="l20.265"> </span>
<a href="#l20.266"></a><span id="l20.266">     // Update the folder in the tree map.</span>
<a href="#l20.267"></a><span id="l20.267">     item.quickMode = aChecked;</span>
<a href="#l20.268"></a><span id="l20.268">     let message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedUpdated&quot;);</span>
<a href="#l20.269"></a><span id="l20.269">     this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l20.270"></a><span id="l20.270">   },</span>
<a href="#l20.271"></a><span id="l20.271"> </span>
<a href="#l20.272"></a><span id="l20.272" class="difflineminus">-  setCategoryPrefs: function(aNode)</span>
<a href="#l20.273"></a><span id="l20.273" class="difflineplus">+  setPrefs: function(aNode)</span>
<a href="#l20.274"></a><span id="l20.274">   {</span>
<a href="#l20.275"></a><span id="l20.275">     let item = this.mView.currentItem;</span>
<a href="#l20.276"></a><span id="l20.276">     if (!item)</span>
<a href="#l20.277"></a><span id="l20.277">       return;</span>
<a href="#l20.278"></a><span id="l20.278"> </span>
<a href="#l20.279"></a><span id="l20.279">     let isServer = item.folder &amp;&amp; item.folder.isServer;</span>
<a href="#l20.280"></a><span id="l20.280">     let isFolder = item.folder &amp;&amp; !item.folder.isServer;</span>
<a href="#l20.281"></a><span id="l20.281" class="difflineplus">+    let updateEnabled = document.getElementById(&quot;updateEnabled&quot;);</span>
<a href="#l20.282"></a><span id="l20.282" class="difflineplus">+    let updateValue = document.getElementById(&quot;updateValue&quot;);</span>
<a href="#l20.283"></a><span id="l20.283" class="difflineplus">+    let biffUnits = document.getElementById(&quot;biffUnits&quot;);</span>
<a href="#l20.284"></a><span id="l20.284">     let autotagEnable = document.getElementById(&quot;autotagEnable&quot;);</span>
<a href="#l20.285"></a><span id="l20.285">     let autotagUsePrefix = document.getElementById(&quot;autotagUsePrefix&quot;);</span>
<a href="#l20.286"></a><span id="l20.286">     let autotagPrefix = document.getElementById(&quot;autotagPrefix&quot;);</span>
<a href="#l20.287"></a><span id="l20.287">     if (isFolder || (isServer &amp;&amp; document.getElementById(&quot;locationValue&quot;).value))</span>
<a href="#l20.288"></a><span id="l20.288">     {</span>
<a href="#l20.289"></a><span id="l20.289">       // Intend to subscribe a feed to a folder, a value must be in the url</span>
<a href="#l20.290"></a><span id="l20.290">       // field. Update states for addFeed() and return.</span>
<a href="#l20.291"></a><span id="l20.291" class="difflineplus">+      updateValue.disabled = !updateEnabled.checked;</span>
<a href="#l20.292"></a><span id="l20.292">       autotagUsePrefix.disabled = !autotagEnable.checked;</span>
<a href="#l20.293"></a><span id="l20.293">       autotagPrefix.disabled = autotagUsePrefix.disabled || !autotagUsePrefix.checked;</span>
<a href="#l20.294"></a><span id="l20.294">       return;</span>
<a href="#l20.295"></a><span id="l20.295">     }</span>
<a href="#l20.296"></a><span id="l20.296"> </span>
<a href="#l20.297"></a><span id="l20.297">     switch (aNode.id) {</span>
<a href="#l20.298"></a><span id="l20.298" class="difflineplus">+      case &quot;updateEnabled&quot;:</span>
<a href="#l20.299"></a><span id="l20.299" class="difflineplus">+      case &quot;biffUnits&quot;:</span>
<a href="#l20.300"></a><span id="l20.300" class="difflineplus">+        item.options.updates.enabled = updateEnabled.checked;</span>
<a href="#l20.301"></a><span id="l20.301" class="difflineplus">+        let minutes = biffUnits.value == FeedUtils.kBiffUnitsMinutes ?</span>
<a href="#l20.302"></a><span id="l20.302" class="difflineplus">+                        updateValue.valueNumber :</span>
<a href="#l20.303"></a><span id="l20.303" class="difflineplus">+                        updateValue.valueNumber * 24 * 60;</span>
<a href="#l20.304"></a><span id="l20.304" class="difflineplus">+        item.options.updates.updateMinutes = minutes;</span>
<a href="#l20.305"></a><span id="l20.305" class="difflineplus">+        item.options.updates.updateUnits = biffUnits.value;</span>
<a href="#l20.306"></a><span id="l20.306" class="difflineplus">+        break;</span>
<a href="#l20.307"></a><span id="l20.307">       case &quot;autotagEnable&quot;:</span>
<a href="#l20.308"></a><span id="l20.308">         item.options.category.enabled = aNode.checked;</span>
<a href="#l20.309"></a><span id="l20.309">         break;</span>
<a href="#l20.310"></a><span id="l20.310">       case &quot;autotagUsePrefix&quot;:</span>
<a href="#l20.311"></a><span id="l20.311">         item.options.category.prefixEnabled = aNode.checked;</span>
<a href="#l20.312"></a><span id="l20.312">         item.options.category.prefix = autotagPrefix.value;</span>
<a href="#l20.313"></a><span id="l20.313">         break;</span>
<a href="#l20.314"></a><span id="l20.314">     }</span>
<a href="#l20.315"></a><span id="l20.315" class="difflineat">@@ -1108,37 +1163,75 @@ var FeedSubscriptions = {</span>
<a href="#l20.316"></a><span id="l20.316">     }</span>
<a href="#l20.317"></a><span id="l20.317">     else</span>
<a href="#l20.318"></a><span id="l20.318">     {</span>
<a href="#l20.319"></a><span id="l20.319">       let feedResource = FeedUtils.rdf.GetResource(item.url);</span>
<a href="#l20.320"></a><span id="l20.320">       let feed = new Feed(feedResource, item.parentFolder.server);</span>
<a href="#l20.321"></a><span id="l20.321">       feed.options = item.options;</span>
<a href="#l20.322"></a><span id="l20.322">       let ds = FeedUtils.getSubscriptionsDS(item.parentFolder.server);</span>
<a href="#l20.323"></a><span id="l20.323">       ds.Flush();</span>
<a href="#l20.324"></a><span id="l20.324" class="difflineplus">+</span>
<a href="#l20.325"></a><span id="l20.325" class="difflineplus">+      if (aNode.id == &quot;updateEnabled&quot;)</span>
<a href="#l20.326"></a><span id="l20.326" class="difflineplus">+      {</span>
<a href="#l20.327"></a><span id="l20.327" class="difflineplus">+        FeedUtils.setStatus(item.parentFolder, item.url, &quot;enabled&quot;, aNode.checked);</span>
<a href="#l20.328"></a><span id="l20.328" class="difflineplus">+        this.mView.selection.tree.invalidateRow(this.mView.selection.currentIndex);</span>
<a href="#l20.329"></a><span id="l20.329" class="difflineplus">+      }</span>
<a href="#l20.330"></a><span id="l20.330">     }</span>
<a href="#l20.331"></a><span id="l20.331"> </span>
<a href="#l20.332"></a><span id="l20.332">     this.updateFeedData(item);</span>
<a href="#l20.333"></a><span id="l20.333">     let message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedUpdated&quot;);</span>
<a href="#l20.334"></a><span id="l20.334">     this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l20.335"></a><span id="l20.335">   },</span>
<a href="#l20.336"></a><span id="l20.336"> </span>
<a href="#l20.337"></a><span id="l20.337" class="difflineplus">+  getUpdateMinutesRec: function(aUpdates)</span>
<a href="#l20.338"></a><span id="l20.338" class="difflineplus">+  {</span>
<a href="#l20.339"></a><span id="l20.339" class="difflineplus">+    // Assume the parser has stored correct/valid values for the spec. If the</span>
<a href="#l20.340"></a><span id="l20.340" class="difflineplus">+    // feed doesn't use any of these tags, updatePeriod will be null.</span>
<a href="#l20.341"></a><span id="l20.341" class="difflineplus">+    if (aUpdates.updatePeriod == null)</span>
<a href="#l20.342"></a><span id="l20.342" class="difflineplus">+      return &quot;&quot;;</span>
<a href="#l20.343"></a><span id="l20.343" class="difflineplus">+</span>
<a href="#l20.344"></a><span id="l20.344" class="difflineplus">+    let biffUnits = document.getElementById(&quot;biffUnits&quot;).value;</span>
<a href="#l20.345"></a><span id="l20.345" class="difflineplus">+    let units = biffUnits == FeedUtils.kBiffUnitsDays ? 1 : 24 * 60;</span>
<a href="#l20.346"></a><span id="l20.346" class="difflineplus">+    let frequency = aUpdates.updateFrequency;</span>
<a href="#l20.347"></a><span id="l20.347" class="difflineplus">+    let val;</span>
<a href="#l20.348"></a><span id="l20.348" class="difflineplus">+    switch (aUpdates.updatePeriod) {</span>
<a href="#l20.349"></a><span id="l20.349" class="difflineplus">+      case &quot;hourly&quot;:</span>
<a href="#l20.350"></a><span id="l20.350" class="difflineplus">+        val = biffUnits == FeedUtils.kBiffUnitsDays ? frequency / 24 : 60 / frequency;</span>
<a href="#l20.351"></a><span id="l20.351" class="difflineplus">+        break;</span>
<a href="#l20.352"></a><span id="l20.352" class="difflineplus">+      case &quot;daily&quot;:</span>
<a href="#l20.353"></a><span id="l20.353" class="difflineplus">+        val = units / frequency;</span>
<a href="#l20.354"></a><span id="l20.354" class="difflineplus">+        break;</span>
<a href="#l20.355"></a><span id="l20.355" class="difflineplus">+      case &quot;weekly&quot;:</span>
<a href="#l20.356"></a><span id="l20.356" class="difflineplus">+        val = 7 * units / frequency;</span>
<a href="#l20.357"></a><span id="l20.357" class="difflineplus">+        break;</span>
<a href="#l20.358"></a><span id="l20.358" class="difflineplus">+      case &quot;monthly&quot;:</span>
<a href="#l20.359"></a><span id="l20.359" class="difflineplus">+        val = 30 * units / frequency;</span>
<a href="#l20.360"></a><span id="l20.360" class="difflineplus">+        break;</span>
<a href="#l20.361"></a><span id="l20.361" class="difflineplus">+      case &quot;yearly&quot;:</span>
<a href="#l20.362"></a><span id="l20.362" class="difflineplus">+        val = 365 * units / frequency;</span>
<a href="#l20.363"></a><span id="l20.363" class="difflineplus">+        break;</span>
<a href="#l20.364"></a><span id="l20.364" class="difflineplus">+    }</span>
<a href="#l20.365"></a><span id="l20.365" class="difflineplus">+</span>
<a href="#l20.366"></a><span id="l20.366" class="difflineplus">+    return val ? Math.round(val * 100) / 100 : &quot;&quot;;</span>
<a href="#l20.367"></a><span id="l20.367" class="difflineplus">+  },</span>
<a href="#l20.368"></a><span id="l20.368" class="difflineplus">+</span>
<a href="#l20.369"></a><span id="l20.369">   onKeyPress: function(aEvent)</span>
<a href="#l20.370"></a><span id="l20.370">   {</span>
<a href="#l20.371"></a><span id="l20.371">     if (aEvent.keyCode == aEvent.DOM_VK_DELETE &amp;&amp;</span>
<a href="#l20.372"></a><span id="l20.372">         aEvent.target.id == &quot;rssSubscriptionsList&quot;)</span>
<a href="#l20.373"></a><span id="l20.373">       this.removeFeed(true);</span>
<a href="#l20.374"></a><span id="l20.374"> </span>
<a href="#l20.375"></a><span id="l20.375">     this.clearStatusInfo();</span>
<a href="#l20.376"></a><span id="l20.376">   },</span>
<a href="#l20.377"></a><span id="l20.377"> </span>
<a href="#l20.378"></a><span id="l20.378">   onSelect: function ()</span>
<a href="#l20.379"></a><span id="l20.379">   {</span>
<a href="#l20.380"></a><span id="l20.380">     let item = this.mView.currentItem;</span>
<a href="#l20.381"></a><span id="l20.381">     this.updateFeedData(item);</span>
<a href="#l20.382"></a><span id="l20.382" class="difflineminus">-    this.setSummaryFocus();</span>
<a href="#l20.383"></a><span id="l20.383" class="difflineplus">+    this.setFocus();</span>
<a href="#l20.384"></a><span id="l20.384">     this.updateButtons(item);</span>
<a href="#l20.385"></a><span id="l20.385">   },</span>
<a href="#l20.386"></a><span id="l20.386"> </span>
<a href="#l20.387"></a><span id="l20.387">   updateButtons: function (aSelectedItem)</span>
<a href="#l20.388"></a><span id="l20.388">   {</span>
<a href="#l20.389"></a><span id="l20.389">     let item = aSelectedItem;</span>
<a href="#l20.390"></a><span id="l20.390">     let isServer = item &amp;&amp; item.folder &amp;&amp; item.folder.isServer;</span>
<a href="#l20.391"></a><span id="l20.391">     let disable = !item || !item.container || isServer ||</span>
<a href="#l20.392"></a><span id="l20.392" class="difflineat">@@ -1161,33 +1254,36 @@ var FeedSubscriptions = {</span>
<a href="#l20.393"></a><span id="l20.393">     if (aEvent.button != 0 ||</span>
<a href="#l20.394"></a><span id="l20.394">         aEvent.target.id == &quot;validationText&quot; ||</span>
<a href="#l20.395"></a><span id="l20.395">         aEvent.target.id == &quot;addCertException&quot;)</span>
<a href="#l20.396"></a><span id="l20.396">       return;</span>
<a href="#l20.397"></a><span id="l20.397"> </span>
<a href="#l20.398"></a><span id="l20.398">     this.clearStatusInfo();</span>
<a href="#l20.399"></a><span id="l20.399">   },</span>
<a href="#l20.400"></a><span id="l20.400"> </span>
<a href="#l20.401"></a><span id="l20.401" class="difflineminus">-  setSummaryFocus: function ()</span>
<a href="#l20.402"></a><span id="l20.402" class="difflineplus">+  setFocus: function ()</span>
<a href="#l20.403"></a><span id="l20.403">   {</span>
<a href="#l20.404"></a><span id="l20.404">     let item = this.mView.currentItem;</span>
<a href="#l20.405"></a><span id="l20.405">     if (!item)</span>
<a href="#l20.406"></a><span id="l20.406">       return;</span>
<a href="#l20.407"></a><span id="l20.407"> </span>
<a href="#l20.408"></a><span id="l20.408">     let locationValue = document.getElementById(&quot;locationValue&quot;);</span>
<a href="#l20.409"></a><span id="l20.409" class="difflineplus">+    let updateEnabled = document.getElementById(&quot;updateEnabled&quot;);</span>
<a href="#l20.410"></a><span id="l20.410" class="difflineplus">+    let updateValue = document.getElementById(&quot;updateValue&quot;);</span>
<a href="#l20.411"></a><span id="l20.411">     let quickMode = document.getElementById(&quot;quickMode&quot;);</span>
<a href="#l20.412"></a><span id="l20.412">     let autotagEnable = document.getElementById(&quot;autotagEnable&quot;);</span>
<a href="#l20.413"></a><span id="l20.413">     let autotagUsePrefix = document.getElementById(&quot;autotagUsePrefix&quot;);</span>
<a href="#l20.414"></a><span id="l20.414">     let autotagPrefix = document.getElementById(&quot;autotagPrefix&quot;);</span>
<a href="#l20.415"></a><span id="l20.415">     let isServer = item.folder &amp;&amp; item.folder.isServer;</span>
<a href="#l20.416"></a><span id="l20.416">     let isFolder = item.folder &amp;&amp; !item.folder.isServer;</span>
<a href="#l20.417"></a><span id="l20.417">     let isFeed = !item.container;</span>
<a href="#l20.418"></a><span id="l20.418"> </span>
<a href="#l20.419"></a><span id="l20.419" class="difflineminus">-    // Enable summary/autotag by default.</span>
<a href="#l20.420"></a><span id="l20.420" class="difflineminus">-    quickMode.disabled = autotagEnable.disabled = false;</span>
<a href="#l20.421"></a><span id="l20.421" class="difflineplus">+    // Enabled by default.</span>
<a href="#l20.422"></a><span id="l20.422" class="difflineplus">+    updateEnabled.disabled = quickMode.disabled = autotagEnable.disabled = false;</span>
<a href="#l20.423"></a><span id="l20.423" class="difflineplus">+    updateValue.disabled = !updateEnabled.checked;</span>
<a href="#l20.424"></a><span id="l20.424">     autotagUsePrefix.disabled = !autotagEnable.checked;</span>
<a href="#l20.425"></a><span id="l20.425">     autotagPrefix.disabled = autotagUsePrefix.disabled || !autotagUsePrefix.checked;</span>
<a href="#l20.426"></a><span id="l20.426"> </span>
<a href="#l20.427"></a><span id="l20.427">     if (isServer)</span>
<a href="#l20.428"></a><span id="l20.428">     {</span>
<a href="#l20.429"></a><span id="l20.429">       let disable = locationValue.hasAttribute(&quot;focused&quot;) || locationValue.value;</span>
<a href="#l20.430"></a><span id="l20.430">       document.getElementById(&quot;addFeed&quot;).disabled = !disable;</span>
<a href="#l20.431"></a><span id="l20.431">       document.getElementById(&quot;editFeed&quot;).disabled = disable;</span>
<a href="#l20.432"></a><span id="l20.432" class="difflineat">@@ -1195,17 +1291,18 @@ var FeedSubscriptions = {</span>
<a href="#l20.433"></a><span id="l20.433">     }</span>
<a href="#l20.434"></a><span id="l20.434">     else if (isFolder)</span>
<a href="#l20.435"></a><span id="l20.435">     {</span>
<a href="#l20.436"></a><span id="l20.436">       if (!locationValue.hasAttribute(&quot;focused&quot;) &amp;&amp; !locationValue.value)</span>
<a href="#l20.437"></a><span id="l20.437">       {</span>
<a href="#l20.438"></a><span id="l20.438">         // Enabled for a folder with feeds. Autotag disabled unless intent is</span>
<a href="#l20.439"></a><span id="l20.439">         // to add a feed.</span>
<a href="#l20.440"></a><span id="l20.440">         quickMode.disabled = !FeedUtils.getFeedUrlsInFolder(item.folder);</span>
<a href="#l20.441"></a><span id="l20.441" class="difflineminus">-        autotagEnable.disabled = autotagUsePrefix.disabled =</span>
<a href="#l20.442"></a><span id="l20.442" class="difflineplus">+        updateEnabled.disabled = updateValue.disabled =</span>
<a href="#l20.443"></a><span id="l20.443" class="difflineplus">+          autotagEnable.disabled = autotagUsePrefix.disabled =</span>
<a href="#l20.444"></a><span id="l20.444">           autotagPrefix.disabled = true;</span>
<a href="#l20.445"></a><span id="l20.445">       }</span>
<a href="#l20.446"></a><span id="l20.446">     }</span>
<a href="#l20.447"></a><span id="l20.447">     else</span>
<a href="#l20.448"></a><span id="l20.448">     {</span>
<a href="#l20.449"></a><span id="l20.449">       // Summary is per folder.</span>
<a href="#l20.450"></a><span id="l20.450">       quickMode.disabled = true;</span>
<a href="#l20.451"></a><span id="l20.451">     }</span>
<a href="#l20.452"></a><span id="l20.452" class="difflineat">@@ -1254,27 +1351,27 @@ var FeedSubscriptions = {</span>
<a href="#l20.453"></a><span id="l20.453">   /**</span>
<a href="#l20.454"></a><span id="l20.454">    * This addFeed is used by 1) Add button, 1) Update button, 3) Drop of a</span>
<a href="#l20.455"></a><span id="l20.455">    * feed url on a folder (which can be an add or move).  If Update, the new</span>
<a href="#l20.456"></a><span id="l20.456">    * url is added and the old removed; thus aParse is false and no new messages</span>
<a href="#l20.457"></a><span id="l20.457">    * are downloaded, the feed is only validated and stored in the db.  If dnd,</span>
<a href="#l20.458"></a><span id="l20.458">    * the drop folder is selected and the url is prefilled, so proceed just as</span>
<a href="#l20.459"></a><span id="l20.459">    * though the url were entered manually.  This allows a user to see the dnd</span>
<a href="#l20.460"></a><span id="l20.460">    * url better in case of errors.</span>
<a href="#l20.461"></a><span id="l20.461" class="difflineminus">-   * </span>
<a href="#l20.462"></a><span id="l20.462" class="difflineplus">+   *</span>
<a href="#l20.463"></a><span id="l20.463">    * @param  [aFeedLocation] string    - the feed url; get the url from the</span>
<a href="#l20.464"></a><span id="l20.464">    *                                     input field if null.</span>
<a href="#l20.465"></a><span id="l20.465">    * @param  [aFolder] nsIMsgFolder    - folder to subscribe, current selected</span>
<a href="#l20.466"></a><span id="l20.466">    *                                     folder if null.</span>
<a href="#l20.467"></a><span id="l20.467">    * @param  [aParse] boolean          - if true (default) parse and download</span>
<a href="#l20.468"></a><span id="l20.468">    *                                     the feed's articles.</span>
<a href="#l20.469"></a><span id="l20.469">    * @param  [aParams] object          - additional params.</span>
<a href="#l20.470"></a><span id="l20.470">    * @param  [aMode] integer           - action mode (default is kSubscribeMode)</span>
<a href="#l20.471"></a><span id="l20.471">    *                                     of the add.</span>
<a href="#l20.472"></a><span id="l20.472" class="difflineminus">-   * </span>
<a href="#l20.473"></a><span id="l20.473" class="difflineplus">+   *</span>
<a href="#l20.474"></a><span id="l20.474">    * @return success boolean           - true if edit checks passed and an</span>
<a href="#l20.475"></a><span id="l20.475">    *                                     async download has been initiated.</span>
<a href="#l20.476"></a><span id="l20.476">    */</span>
<a href="#l20.477"></a><span id="l20.477">   addFeed: function(aFeedLocation, aFolder, aParse, aParams, aMode)</span>
<a href="#l20.478"></a><span id="l20.478">   {</span>
<a href="#l20.479"></a><span id="l20.479">     let message;</span>
<a href="#l20.480"></a><span id="l20.480">     let parse = aParse == null ? true : aParse;</span>
<a href="#l20.481"></a><span id="l20.481">     let mode = aMode == null ? this.kSubscribeMode : aMode;</span>
<a href="#l20.482"></a><span id="l20.482" class="difflineat">@@ -1333,16 +1430,22 @@ var FeedSubscriptions = {</span>
<a href="#l20.483"></a><span id="l20.483">       this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l20.484"></a><span id="l20.484">       return false;</span>
<a href="#l20.485"></a><span id="l20.485">     }</span>
<a href="#l20.486"></a><span id="l20.486"> </span>
<a href="#l20.487"></a><span id="l20.487">     if (!options)</span>
<a href="#l20.488"></a><span id="l20.488">     {</span>
<a href="#l20.489"></a><span id="l20.489">       // Not passed a param, get values from the ui.</span>
<a href="#l20.490"></a><span id="l20.490">       options = FeedUtils.optionsTemplate;</span>
<a href="#l20.491"></a><span id="l20.491" class="difflineplus">+      options.updates.enabled = document.getElementById(&quot;updateEnabled&quot;).checked;</span>
<a href="#l20.492"></a><span id="l20.492" class="difflineplus">+      let biffUnits = document.getElementById(&quot;biffUnits&quot;).value;</span>
<a href="#l20.493"></a><span id="l20.493" class="difflineplus">+      let units = document.getElementById(&quot;updateValue&quot;).valueNumber;</span>
<a href="#l20.494"></a><span id="l20.494" class="difflineplus">+      let minutes = biffUnits == FeedUtils.kBiffUnitsMinutes ? units : units * 24 * 60;</span>
<a href="#l20.495"></a><span id="l20.495" class="difflineplus">+      options.updates.updateUnits = biffUnits;</span>
<a href="#l20.496"></a><span id="l20.496" class="difflineplus">+      options.updates.updateMinutes = minutes;</span>
<a href="#l20.497"></a><span id="l20.497">       options.category.enabled = document.getElementById(&quot;autotagEnable&quot;).checked;</span>
<a href="#l20.498"></a><span id="l20.498">       options.category.prefixEnabled = document.getElementById(&quot;autotagUsePrefix&quot;).checked;</span>
<a href="#l20.499"></a><span id="l20.499">       options.category.prefix = document.getElementById(&quot;autotagPrefix&quot;).value;</span>
<a href="#l20.500"></a><span id="l20.500">     }</span>
<a href="#l20.501"></a><span id="l20.501"> </span>
<a href="#l20.502"></a><span id="l20.502">     let folderURI = addFolder.isServer ? null : addFolder.URI;</span>
<a href="#l20.503"></a><span id="l20.503">     let feedProperties = { feedName     : name,</span>
<a href="#l20.504"></a><span id="l20.504">                            feedLocation : feedLocation,</span>
<a href="#l20.505"></a><span id="l20.505" class="difflineat">@@ -1386,20 +1489,28 @@ var FeedSubscriptions = {</span>
<a href="#l20.506"></a><span id="l20.506">     feed.title = feedProperties.feedName;</span>
<a href="#l20.507"></a><span id="l20.507">     feed.quickMode = feedProperties.quickMode;</span>
<a href="#l20.508"></a><span id="l20.508">     feed.options = feedProperties.options;</span>
<a href="#l20.509"></a><span id="l20.509">     return feed;</span>
<a href="#l20.510"></a><span id="l20.510">   },</span>
<a href="#l20.511"></a><span id="l20.511"> </span>
<a href="#l20.512"></a><span id="l20.512">   updateAccount: function(aItem)</span>
<a href="#l20.513"></a><span id="l20.513">   {</span>
<a href="#l20.514"></a><span id="l20.514" class="difflineminus">-    // Check to see if the categoryPrefs custom prefix string value changed.</span>
<a href="#l20.515"></a><span id="l20.515" class="difflineplus">+    // Check to see if a pref value changed.</span>
<a href="#l20.516"></a><span id="l20.516" class="difflineplus">+    let editUpdateValue = document.getElementById(&quot;updateValue&quot;).valueNumber;</span>
<a href="#l20.517"></a><span id="l20.517" class="difflineplus">+    let editBiffUnits = document.getElementById(&quot;biffUnits&quot;).value;</span>
<a href="#l20.518"></a><span id="l20.518">     let editAutotagPrefix = document.getElementById(&quot;autotagPrefix&quot;).value;</span>
<a href="#l20.519"></a><span id="l20.519" class="difflineminus">-    if (aItem.options.category.prefix != editAutotagPrefix)</span>
<a href="#l20.520"></a><span id="l20.520" class="difflineplus">+    if (aItem.options.updates.updateMinutes != editUpdateValue ||</span>
<a href="#l20.521"></a><span id="l20.521" class="difflineplus">+        aItem.options.updates.updateUnits != editBiffUnits ||</span>
<a href="#l20.522"></a><span id="l20.522" class="difflineplus">+        aItem.options.category.prefix != editAutotagPrefix)</span>
<a href="#l20.523"></a><span id="l20.523">     {</span>
<a href="#l20.524"></a><span id="l20.524" class="difflineplus">+      aItem.options.updates.updateUnits = editBiffUnits;</span>
<a href="#l20.525"></a><span id="l20.525" class="difflineplus">+      let minutes = editBiffUnits == FeedUtils.kBiffUnitsMinutes ?</span>
<a href="#l20.526"></a><span id="l20.526" class="difflineplus">+                      editUpdateValue : editUpdateValue * 24 * 60;</span>
<a href="#l20.527"></a><span id="l20.527" class="difflineplus">+      aItem.options.updates.updateMinutes = minutes;</span>
<a href="#l20.528"></a><span id="l20.528">       aItem.options.category.prefix = editAutotagPrefix;</span>
<a href="#l20.529"></a><span id="l20.529">       FeedUtils.setOptionsAcct(aItem.folder.server, aItem.options)</span>
<a href="#l20.530"></a><span id="l20.530">       let message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedUpdated&quot;);</span>
<a href="#l20.531"></a><span id="l20.531">       this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l20.532"></a><span id="l20.532">     }</span>
<a href="#l20.533"></a><span id="l20.533">   },</span>
<a href="#l20.534"></a><span id="l20.534"> </span>
<a href="#l20.535"></a><span id="l20.535">   editFeed: function()</span>
<a href="#l20.536"></a><span id="l20.536" class="difflineat">@@ -1423,16 +1534,18 @@ var FeedSubscriptions = {</span>
<a href="#l20.537"></a><span id="l20.537">     let ds = FeedUtils.getSubscriptionsDS(currentFolderServer);</span>
<a href="#l20.538"></a><span id="l20.538">     let currentFolderURI = itemToEdit.parentFolder.URI;</span>
<a href="#l20.539"></a><span id="l20.539">     let feed = new Feed(resource, currentFolderServer);</span>
<a href="#l20.540"></a><span id="l20.540">     feed.folder = itemToEdit.parentFolder;</span>
<a href="#l20.541"></a><span id="l20.541"> </span>
<a href="#l20.542"></a><span id="l20.542">     let editNameValue = document.getElementById(&quot;nameValue&quot;).value;</span>
<a href="#l20.543"></a><span id="l20.543">     let editFeedLocation = document.getElementById(&quot;locationValue&quot;).value.trim();</span>
<a href="#l20.544"></a><span id="l20.544">     let selectFolder = document.getElementById(&quot;selectFolder&quot;);</span>
<a href="#l20.545"></a><span id="l20.545" class="difflineplus">+    let editUpdateValue = document.getElementById(&quot;updateValue&quot;).valueNumber;</span>
<a href="#l20.546"></a><span id="l20.546" class="difflineplus">+    let editBiffUnits = document.getElementById(&quot;biffUnits&quot;).value;</span>
<a href="#l20.547"></a><span id="l20.547">     let editQuickMode = document.getElementById(&quot;quickMode&quot;).checked;</span>
<a href="#l20.548"></a><span id="l20.548">     let editAutotagPrefix = document.getElementById(&quot;autotagPrefix&quot;).value;</span>
<a href="#l20.549"></a><span id="l20.549"> </span>
<a href="#l20.550"></a><span id="l20.550">     if (feed.url != editFeedLocation)</span>
<a href="#l20.551"></a><span id="l20.551">     {</span>
<a href="#l20.552"></a><span id="l20.552">       // Updating a url.  We need to add the new url and delete the old, to</span>
<a href="#l20.553"></a><span id="l20.553">       // ensure everything is cleaned up correctly.</span>
<a href="#l20.554"></a><span id="l20.554">       this.addFeed(null, itemToEdit.parentFolder, false, null, this.kUpdateMode)</span>
<a href="#l20.555"></a><span id="l20.555" class="difflineat">@@ -1482,25 +1595,39 @@ var FeedSubscriptions = {</span>
<a href="#l20.556"></a><span id="l20.556">       {</span>
<a href="#l20.557"></a><span id="l20.557">         feed.title = editNameValue;</span>
<a href="#l20.558"></a><span id="l20.558">         itemToEdit.name = editNameValue;</span>
<a href="#l20.559"></a><span id="l20.559">         seln.tree.invalidateRow(seln.currentIndex);</span>
<a href="#l20.560"></a><span id="l20.560">         updated = true;</span>
<a href="#l20.561"></a><span id="l20.561">       }</span>
<a href="#l20.562"></a><span id="l20.562">     }</span>
<a href="#l20.563"></a><span id="l20.563"> </span>
<a href="#l20.564"></a><span id="l20.564" class="difflineplus">+    // Check to see if the updateValue value changed.</span>
<a href="#l20.565"></a><span id="l20.565" class="difflineplus">+    if (itemToEdit.options.updates.updateMinutes != editUpdateValue ||</span>
<a href="#l20.566"></a><span id="l20.566" class="difflineplus">+        itemToEdit.options.updates.updateUnits != editBiffUnits)</span>
<a href="#l20.567"></a><span id="l20.567" class="difflineplus">+    {</span>
<a href="#l20.568"></a><span id="l20.568" class="difflineplus">+      itemToEdit.options.updates.updateUnits = editBiffUnits;</span>
<a href="#l20.569"></a><span id="l20.569" class="difflineplus">+      let minutes = editBiffUnits == FeedUtils.kBiffUnitsMinutes ?</span>
<a href="#l20.570"></a><span id="l20.570" class="difflineplus">+                      editUpdateValue : editUpdateValue * 24 * 60;</span>
<a href="#l20.571"></a><span id="l20.571" class="difflineplus">+      itemToEdit.options.updates.updateMinutes = minutes;</span>
<a href="#l20.572"></a><span id="l20.572" class="difflineplus">+      feed.options = itemToEdit.options;</span>
<a href="#l20.573"></a><span id="l20.573" class="difflineplus">+      FeedUtils.setStatus(itemToEdit.parentFolder, itemToEdit.url,</span>
<a href="#l20.574"></a><span id="l20.574" class="difflineplus">+                          &quot;updateMinutes&quot;, minutes);</span>
<a href="#l20.575"></a><span id="l20.575" class="difflineplus">+      updated = true;</span>
<a href="#l20.576"></a><span id="l20.576" class="difflineplus">+    }</span>
<a href="#l20.577"></a><span id="l20.577" class="difflineplus">+</span>
<a href="#l20.578"></a><span id="l20.578">     // Check to see if the quickMode value changed.</span>
<a href="#l20.579"></a><span id="l20.579">     if (feed.quickMode != editQuickMode)</span>
<a href="#l20.580"></a><span id="l20.580">     {</span>
<a href="#l20.581"></a><span id="l20.581">       feed.quickMode = editQuickMode;</span>
<a href="#l20.582"></a><span id="l20.582">       itemToEdit.quickMode = editQuickMode;</span>
<a href="#l20.583"></a><span id="l20.583">       updated = true;</span>
<a href="#l20.584"></a><span id="l20.584">     }</span>
<a href="#l20.585"></a><span id="l20.585"> </span>
<a href="#l20.586"></a><span id="l20.586" class="difflineminus">-    // Check to see if the categoryPrefs custom prefix string value changed.</span>
<a href="#l20.587"></a><span id="l20.587" class="difflineplus">+    // Check to see if the category custom prefix string value changed.</span>
<a href="#l20.588"></a><span id="l20.588">     if (itemToEdit.options.category.prefix != editAutotagPrefix &amp;&amp;</span>
<a href="#l20.589"></a><span id="l20.589">         itemToEdit.options.category.prefix != null &amp;&amp;</span>
<a href="#l20.590"></a><span id="l20.590">         editAutotagPrefix != &quot;&quot;)</span>
<a href="#l20.591"></a><span id="l20.591">     {</span>
<a href="#l20.592"></a><span id="l20.592">       itemToEdit.options.category.prefix = editAutotagPrefix;</span>
<a href="#l20.593"></a><span id="l20.593">       feed.options = itemToEdit.options;</span>
<a href="#l20.594"></a><span id="l20.594">       updated = true;</span>
<a href="#l20.595"></a><span id="l20.595">     }</span>
<a href="#l20.596"></a><span id="l20.596" class="difflineat">@@ -1521,17 +1648,17 @@ var FeedSubscriptions = {</span>
<a href="#l20.597"></a><span id="l20.597">       this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l20.598"></a><span id="l20.598">       this.updateStatusItem(&quot;progressMeter&quot;, &quot;?&quot;);</span>
<a href="#l20.599"></a><span id="l20.599">       feed.download(false, this.mFeedDownloadCallback);</span>
<a href="#l20.600"></a><span id="l20.600">     }, verifyDelay);</span>
<a href="#l20.601"></a><span id="l20.601">   },</span>
<a href="#l20.602"></a><span id="l20.602"> </span>
<a href="#l20.603"></a><span id="l20.603"> /**</span>
<a href="#l20.604"></a><span id="l20.604">  * Moves or copies a feed to another folder or account.</span>
<a href="#l20.605"></a><span id="l20.605" class="difflineminus">- * </span>
<a href="#l20.606"></a><span id="l20.606" class="difflineplus">+ *</span>
<a href="#l20.607"></a><span id="l20.607">  * @param  int aOldFeedIndex    - index in tree of target feed item.</span>
<a href="#l20.608"></a><span id="l20.608">  * @param  int aNewParentIndex  - index in tree of target parent folder item.</span>
<a href="#l20.609"></a><span id="l20.609">  * @param  string aMoveCopy     - either &quot;move&quot; or &quot;copy&quot;.</span>
<a href="#l20.610"></a><span id="l20.610">  */</span>
<a href="#l20.611"></a><span id="l20.611">   moveCopyFeed: function(aOldFeedIndex, aNewParentIndex, aMoveCopy)</span>
<a href="#l20.612"></a><span id="l20.612">   {</span>
<a href="#l20.613"></a><span id="l20.613">     let moveFeed = aMoveCopy == &quot;move&quot;;</span>
<a href="#l20.614"></a><span id="l20.614">     let currentItem = this.mView.getItemAtIndex(aOldFeedIndex);</span>
<a href="#l20.615"></a><span id="l20.615" class="difflineat">@@ -1700,16 +1827,21 @@ var FeedSubscriptions = {</span>
<a href="#l20.616"></a><span id="l20.616">           win.mActionMode = null;</span>
<a href="#l20.617"></a><span id="l20.617">           win.clearStatusInfo();</span>
<a href="#l20.618"></a><span id="l20.618">           message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedVerified&quot;);</span>
<a href="#l20.619"></a><span id="l20.619">           win.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l20.620"></a><span id="l20.620">           document.getElementById(&quot;editFeed&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l20.621"></a><span id="l20.621">           return;</span>
<a href="#l20.622"></a><span id="l20.622">         }</span>
<a href="#l20.623"></a><span id="l20.623"> </span>
<a href="#l20.624"></a><span id="l20.624" class="difflineplus">+        // Update lastUpdateTime if successful.</span>
<a href="#l20.625"></a><span id="l20.625" class="difflineplus">+        let options = feed.options;</span>
<a href="#l20.626"></a><span id="l20.626" class="difflineplus">+        options.updates.lastUpdateTime = Date.now();</span>
<a href="#l20.627"></a><span id="l20.627" class="difflineplus">+        feed.options = options;</span>
<a href="#l20.628"></a><span id="l20.628" class="difflineplus">+</span>
<a href="#l20.629"></a><span id="l20.629">         // Add the feed to the databases.</span>
<a href="#l20.630"></a><span id="l20.630">         FeedUtils.addFeed(feed);</span>
<a href="#l20.631"></a><span id="l20.631"> </span>
<a href="#l20.632"></a><span id="l20.632">         // Now add the feed to our view.  If adding, the current selection will</span>
<a href="#l20.633"></a><span id="l20.633">         // be a folder; if updating it will be a feed.  No need to rebuild the</span>
<a href="#l20.634"></a><span id="l20.634">         // entire view, that is too jarring.</span>
<a href="#l20.635"></a><span id="l20.635">         let curIndex = win.mView.selection.currentIndex;</span>
<a href="#l20.636"></a><span id="l20.636">         let curItem = win.mView.getItemAtIndex(curIndex);</span>
<a href="#l20.637"></a><span id="l20.637" class="difflineat">@@ -2133,17 +2265,17 @@ var FeedSubscriptions = {</span>
<a href="#l20.638"></a><span id="l20.638"> </span>
<a href="#l20.639"></a><span id="l20.639">   get brandShortName() {</span>
<a href="#l20.640"></a><span id="l20.640">     let brandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l20.641"></a><span id="l20.641">     return brandBundle ? brandBundle.getString(&quot;brandShortName&quot;) : &quot;&quot;;</span>
<a href="#l20.642"></a><span id="l20.642">   },</span>
<a href="#l20.643"></a><span id="l20.643"> </span>
<a href="#l20.644"></a><span id="l20.644"> /**</span>
<a href="#l20.645"></a><span id="l20.645">  * Export feeds as opml file Save As filepicker function.</span>
<a href="#l20.646"></a><span id="l20.646" class="difflineminus">- * </span>
<a href="#l20.647"></a><span id="l20.647" class="difflineplus">+ *</span>
<a href="#l20.648"></a><span id="l20.648">  * @param  bool aList - if true, exporting as list; if false (default)</span>
<a href="#l20.649"></a><span id="l20.649">  *                      exporting feeds in folder structure - used for title.</span>
<a href="#l20.650"></a><span id="l20.650">  * @return nsILocalFile or null.</span>
<a href="#l20.651"></a><span id="l20.651">  */</span>
<a href="#l20.652"></a><span id="l20.652">   opmlPickSaveAsFile: function(aList)</span>
<a href="#l20.653"></a><span id="l20.653">   {</span>
<a href="#l20.654"></a><span id="l20.654">     let accountName = this.mRSSServer.rootFolder.prettyName;</span>
<a href="#l20.655"></a><span id="l20.655">     let fileName = FeedUtils.strings.formatStringFromName(</span>
<a href="#l20.656"></a><span id="l20.656" class="difflineat">@@ -2173,17 +2305,17 @@ var FeedSubscriptions = {</span>
<a href="#l20.657"></a><span id="l20.657">       return fp.file;</span>
<a href="#l20.658"></a><span id="l20.658">     }</span>
<a href="#l20.659"></a><span id="l20.659"> </span>
<a href="#l20.660"></a><span id="l20.660">     return null;</span>
<a href="#l20.661"></a><span id="l20.661">   },</span>
<a href="#l20.662"></a><span id="l20.662"> </span>
<a href="#l20.663"></a><span id="l20.663"> /**</span>
<a href="#l20.664"></a><span id="l20.664">  * Import feeds opml file Open filepicker function.</span>
<a href="#l20.665"></a><span id="l20.665" class="difflineminus">- * </span>
<a href="#l20.666"></a><span id="l20.666" class="difflineplus">+ *</span>
<a href="#l20.667"></a><span id="l20.667">  * @return nsILocalFile or null.</span>
<a href="#l20.668"></a><span id="l20.668">  */</span>
<a href="#l20.669"></a><span id="l20.669">   opmlPickOpenFile: function()</span>
<a href="#l20.670"></a><span id="l20.670">   {</span>
<a href="#l20.671"></a><span id="l20.671">     let title = FeedUtils.strings.GetStringFromName(&quot;subscribe-OPMLImportTitle&quot;);</span>
<a href="#l20.672"></a><span id="l20.672">     let fp = Cc[&quot;@mozilla.org/filepicker;1&quot;].createInstance(Ci.nsIFilePicker);</span>
<a href="#l20.673"></a><span id="l20.673"> </span>
<a href="#l20.674"></a><span id="l20.674">     fp.defaultString = &quot;&quot;;</span>
<a href="#l20.675"></a><span id="l20.675" class="difflineat">@@ -2418,21 +2550,21 @@ var FeedSubscriptions = {</span>
<a href="#l20.676"></a><span id="l20.676">       this.updateButtons(item);</span>
<a href="#l20.677"></a><span id="l20.677">       this.clearStatusInfo();</span>
<a href="#l20.678"></a><span id="l20.678">     }</span>
<a href="#l20.679"></a><span id="l20.679">   },</span>
<a href="#l20.680"></a><span id="l20.680"> </span>
<a href="#l20.681"></a><span id="l20.681"> /**</span>
<a href="#l20.682"></a><span id="l20.682">  * Import opml file into a feed account.  Used by the Subscribe dialog and</span>
<a href="#l20.683"></a><span id="l20.683">  * the Import wizard.</span>
<a href="#l20.684"></a><span id="l20.684" class="difflineminus">- * </span>
<a href="#l20.685"></a><span id="l20.685" class="difflineplus">+ *</span>
<a href="#l20.686"></a><span id="l20.686">  * @param  nsILocalFile aFile           - the opml file.</span>
<a href="#l20.687"></a><span id="l20.687">  * @param  nsIMsgIncomingServer aServer - the account server.</span>
<a href="#l20.688"></a><span id="l20.688">  * @param  func aCallback               - callback function.</span>
<a href="#l20.689"></a><span id="l20.689" class="difflineminus">- * </span>
<a href="#l20.690"></a><span id="l20.690" class="difflineplus">+ *</span>
<a href="#l20.691"></a><span id="l20.691">  * @return bool                         - false if error.</span>
<a href="#l20.692"></a><span id="l20.692">  */</span>
<a href="#l20.693"></a><span id="l20.693">   importOPMLFile: function(aFile, aServer, aCallback)</span>
<a href="#l20.694"></a><span id="l20.694">   {</span>
<a href="#l20.695"></a><span id="l20.695">     if (aServer &amp;&amp; (aServer instanceof Ci.nsIMsgIncomingServer))</span>
<a href="#l20.696"></a><span id="l20.696">       this.mRSSServer = aServer;</span>
<a href="#l20.697"></a><span id="l20.697"> </span>
<a href="#l20.698"></a><span id="l20.698">     if (!aFile || !this.mRSSServer || !aCallback)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.xul</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.xul</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -7,16 +7,18 @@</span>
<a href="#l21.4"></a><span id="l21.4"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l21.5"></a><span id="l21.5"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderPane.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l21.6"></a><span id="l21.6"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderMenus.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l21.7"></a><span id="l21.7"> &lt;?xml-stylesheet href=&quot;chrome://messenger-newsblog/skin/feed-subscriptions.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9"> &lt;!DOCTYPE window [</span>
<a href="#l21.10"></a><span id="l21.10">   &lt;!ENTITY % feedDTD SYSTEM &quot;chrome://messenger-newsblog/locale/feed-subscriptions.dtd&quot;&gt;</span>
<a href="#l21.11"></a><span id="l21.11">     %feedDTD;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+  &lt;!ENTITY % newsblogDTD SYSTEM &quot;chrome://messenger-newsblog/locale/am-newsblog.dtd&quot;&gt;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+    %newsblogDTD;</span>
<a href="#l21.14"></a><span id="l21.14">   &lt;!ENTITY % certDTD SYSTEM &quot;chrome://pippki/locale/certManager.dtd&quot;&gt;</span>
<a href="#l21.15"></a><span id="l21.15">     %certDTD;</span>
<a href="#l21.16"></a><span id="l21.16"> ]&gt;</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18"> &lt;window id=&quot;subscriptionsDialog&quot;</span>
<a href="#l21.19"></a><span id="l21.19">         flex=&quot;1&quot;</span>
<a href="#l21.20"></a><span id="l21.20">         title=&quot;&amp;feedSubscriptions.label;&quot;</span>
<a href="#l21.21"></a><span id="l21.21">         windowtype=&quot;Mail:News-BlogSubscriptions&quot;</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -101,18 +103,18 @@</span>
<a href="#l21.23"></a><span id="l21.23">                        value=&quot;&amp;feedLocation.label;&quot;/&gt;</span>
<a href="#l21.24"></a><span id="l21.24">               &lt;/hbox&gt;</span>
<a href="#l21.25"></a><span id="l21.25">               &lt;hbox&gt;</span>
<a href="#l21.26"></a><span id="l21.26">                 &lt;textbox id=&quot;locationValue&quot;</span>
<a href="#l21.27"></a><span id="l21.27">                          flex=&quot;1&quot;</span>
<a href="#l21.28"></a><span id="l21.28">                          class=&quot;uri-element&quot;</span>
<a href="#l21.29"></a><span id="l21.29">                          placeholder=&quot;&amp;feedLocation.placeholder;&quot;</span>
<a href="#l21.30"></a><span id="l21.30">                          clickSelectsAll=&quot;true&quot;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-                         onfocus=&quot;FeedSubscriptions.setSummaryFocus();&quot;</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-                         onblur=&quot;FeedSubscriptions.setSummaryFocus();&quot;/&gt;</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+                         onfocus=&quot;FeedSubscriptions.setFocus();&quot;</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+                         onblur=&quot;FeedSubscriptions.setFocus();&quot;/&gt;</span>
<a href="#l21.35"></a><span id="l21.35">                 &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l21.36"></a><span id="l21.36">                   &lt;label id=&quot;locationValidate&quot;</span>
<a href="#l21.37"></a><span id="l21.37">                          collapsed=&quot;true&quot;</span>
<a href="#l21.38"></a><span id="l21.38">                          class=&quot;text-link&quot;</span>
<a href="#l21.39"></a><span id="l21.39">                          crop=&quot;end&quot;</span>
<a href="#l21.40"></a><span id="l21.40">                          value=&quot;&amp;locationValidate.label;&quot;</span>
<a href="#l21.41"></a><span id="l21.41">                          onclick=&quot;FeedSubscriptions.checkValidation(event);&quot;/&gt;</span>
<a href="#l21.42"></a><span id="l21.42">                 &lt;/hbox&gt;</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineat">@@ -142,30 +144,70 @@</span>
<a href="#l21.44"></a><span id="l21.44">                          flex=&quot;1&quot;</span>
<a href="#l21.45"></a><span id="l21.45">                          readonly=&quot;true&quot;</span>
<a href="#l21.46"></a><span id="l21.46">                          onkeypress=&quot;FeedSubscriptions.onClickSelectFolderValue(event)&quot;</span>
<a href="#l21.47"></a><span id="l21.47">                          onclick=&quot;FeedSubscriptions.onClickSelectFolderValue(event)&quot;/&gt;</span>
<a href="#l21.48"></a><span id="l21.48">               &lt;/hbox&gt;</span>
<a href="#l21.49"></a><span id="l21.49">             &lt;/row&gt;</span>
<a href="#l21.50"></a><span id="l21.50">           &lt;/rows&gt;</span>
<a href="#l21.51"></a><span id="l21.51">         &lt;/grid&gt;</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineplus">+</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+        &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineplus">+          &lt;checkbox id=&quot;updateEnabled&quot;</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+                    label=&quot;&amp;biffStart.label;&quot;</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+                    accesskey=&quot;&amp;biffStart.accesskey;&quot;</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+                    oncommand=&quot;FeedSubscriptions.setPrefs(this)&quot;/&gt;</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+          &lt;textbox id=&quot;updateValue&quot;</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineplus">+                   type=&quot;number&quot;</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineplus">+                   size=&quot;3&quot;</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+                   min=&quot;1&quot;</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+                   increment=&quot;1&quot;</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+                   aria-labelledby=&quot;updateEnabled updateValue biffMinutes biffDays recommendedUnits recommendedUnitsVal&quot;/&gt;</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+          &lt;radiogroup id=&quot;biffUnits&quot;</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineplus">+                      orient=&quot;horizontal&quot;</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineplus">+                      oncommand=&quot;FeedSubscriptions.setPrefs(this)&quot;&gt;</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineplus">+            &lt;radio id=&quot;biffMinutes&quot; value=&quot;min&quot; label=&quot;&amp;biffMinutes.label;&quot;</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+                   accesskey=&quot;&amp;biffMinutes.accesskey;&quot;&gt;</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineplus">+              &lt;observes element=&quot;updateValue&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineplus">+            &lt;/radio&gt;</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineplus">+            &lt;radio id=&quot;biffDays&quot; value=&quot;d&quot; label=&quot;&amp;biffDays.label;&quot;</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+                   accesskey=&quot;&amp;biffDays.accesskey;&quot;&gt;</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+              &lt;observes element=&quot;updateValue&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+            &lt;/radio&gt;</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineplus">+          &lt;/radiogroup&gt;</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineplus">+          &lt;hbox id=&quot;recommendedBox&quot;&gt;</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineplus">+            &lt;label id=&quot;recommendedUnits&quot;</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineplus">+                   value=&quot;&amp;recommendedUnits.label;&quot;</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineplus">+                   hidden=&quot;true&quot;</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+                   control=&quot;updateMinutes&quot;&gt;</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineplus">+              &lt;observes element=&quot;updateValue&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+            &lt;/label&gt;</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+            &lt;label id=&quot;recommendedUnitsVal&quot;</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+                   value=&quot;&quot;</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineplus">+                   hidden=&quot;true&quot;</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineplus">+                   control=&quot;updateMinutes&quot;&gt;</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineplus">+              &lt;observes element=&quot;updateValue&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineplus">+              &lt;observes element=&quot;recommendedUnits&quot; attribute=&quot;hidden&quot;/&gt;</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineplus">+            &lt;/label&gt;</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l21.92"></a><span id="l21.92">         &lt;checkbox id=&quot;quickMode&quot;</span>
<a href="#l21.93"></a><span id="l21.93">                   accesskey=&quot;&amp;quickMode.accesskey;&quot;</span>
<a href="#l21.94"></a><span id="l21.94">                   label=&quot;&amp;quickMode.label;&quot;</span>
<a href="#l21.95"></a><span id="l21.95">                   oncommand=&quot;FeedSubscriptions.setSummary(this.checked)&quot;/&gt;</span>
<a href="#l21.96"></a><span id="l21.96">         &lt;checkbox id=&quot;autotagEnable&quot;</span>
<a href="#l21.97"></a><span id="l21.97">                   accesskey=&quot;&amp;autotagEnable.accesskey;&quot;</span>
<a href="#l21.98"></a><span id="l21.98">                   label=&quot;&amp;autotagEnable.label;&quot;</span>
<a href="#l21.99"></a><span id="l21.99" class="difflineminus">-                  oncommand=&quot;FeedSubscriptions.setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineplus">+                  oncommand=&quot;FeedSubscriptions.setPrefs(this)&quot;/&gt;</span>
<a href="#l21.101"></a><span id="l21.101">         &lt;hbox&gt;</span>
<a href="#l21.102"></a><span id="l21.102">             &lt;checkbox id=&quot;autotagUsePrefix&quot;</span>
<a href="#l21.103"></a><span id="l21.103">                       class=&quot;indent&quot;</span>
<a href="#l21.104"></a><span id="l21.104">                       accesskey=&quot;&amp;autotagUsePrefix.accesskey;&quot;</span>
<a href="#l21.105"></a><span id="l21.105">                       label=&quot;&amp;autotagUsePrefix.label;&quot;</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineminus">-                      oncommand=&quot;FeedSubscriptions.setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineplus">+                      oncommand=&quot;FeedSubscriptions.setPrefs(this)&quot;/&gt;</span>
<a href="#l21.108"></a><span id="l21.108">             &lt;textbox id=&quot;autotagPrefix&quot;</span>
<a href="#l21.109"></a><span id="l21.109">                      placeholder=&quot;&amp;autoTagPrefix.placeholder;&quot;</span>
<a href="#l21.110"></a><span id="l21.110">                      clickSelectsAll=&quot;true&quot;/&gt;</span>
<a href="#l21.111"></a><span id="l21.111">         &lt;/hbox&gt;</span>
<a href="#l21.112"></a><span id="l21.112">         &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l21.113"></a><span id="l21.113">       &lt;/vbox&gt;</span>
<a href="#l21.114"></a><span id="l21.114">     &lt;/hbox&gt;</span>
<a href="#l21.115"></a><span id="l21.115"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/newsblogOverlay.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/newsblogOverlay.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -16,16 +16,18 @@ var FeedMessageHandler = {</span>
<a href="#l22.4"></a><span id="l22.4">   kSelectOverrideWebPage:   0,</span>
<a href="#l22.5"></a><span id="l22.5">   kSelectOverrideSummary:   1,</span>
<a href="#l22.6"></a><span id="l22.6">   kSelectFeedDefault:       2,</span>
<a href="#l22.7"></a><span id="l22.7">   kOpenWebPage:             0,</span>
<a href="#l22.8"></a><span id="l22.8">   kOpenSummary:             1,</span>
<a href="#l22.9"></a><span id="l22.9">   kOpenToggleInMessagePane: 2,</span>
<a href="#l22.10"></a><span id="l22.10">   kOpenLoadInBrowser:       3,</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+  FeedAccountTypes: [&quot;rss&quot;],</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+</span>
<a href="#l22.14"></a><span id="l22.14">   /**</span>
<a href="#l22.15"></a><span id="l22.15">    * How to load message on threadpane select.</span>
<a href="#l22.16"></a><span id="l22.16">    */</span>
<a href="#l22.17"></a><span id="l22.17">   get onSelectPref() {</span>
<a href="#l22.18"></a><span id="l22.18">     return Services.prefs.getIntPref(&quot;rss.show.summary&quot;);</span>
<a href="#l22.19"></a><span id="l22.19">   },</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21">   set onSelectPref(val) {</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineat">@@ -56,19 +58,32 @@ var FeedMessageHandler = {</span>
<a href="#l22.23"></a><span id="l22.23">    * be in an rss acount type folder. In Tb15 and later, a flag is set on the</span>
<a href="#l22.24"></a><span id="l22.24">    * message itself upon initial store; the message can be moved to any folder.</span>
<a href="#l22.25"></a><span id="l22.25">    *</span>
<a href="#l22.26"></a><span id="l22.26">    * @param nsIMsgDBHdr aMsgHdr - the message.</span>
<a href="#l22.27"></a><span id="l22.27">    *</span>
<a href="#l22.28"></a><span id="l22.28">    * @return true if message is a feed, false if not.</span>
<a href="#l22.29"></a><span id="l22.29">    */</span>
<a href="#l22.30"></a><span id="l22.30">   isFeedMessage: function(aMsgHdr) {</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-    return (aMsgHdr instanceof Components.interfaces.nsIMsgDBHdr) &amp;&amp;</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-           ((aMsgHdr.flags &amp; Components.interfaces.nsMsgMessageFlags.FeedMsg) ||</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">-            (aMsgHdr.folder &amp;&amp; aMsgHdr.folder.server.type == &quot;rss&quot;));</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineplus">+    return Boolean(aMsgHdr instanceof Components.interfaces.nsIMsgDBHdr &amp;&amp;</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineplus">+                   (aMsgHdr.flags &amp; Components.interfaces.nsMsgMessageFlags.FeedMsg ||</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineplus">+                    this.isFeedFolder(aMsgHdr.folder)));</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+  },</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+  /**</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+   * Determine if a folder is a feed acount folder. Trash or a folder in Trash</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+   * should be checked with FeedUtils.isInTrash() if required.</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineplus">+   *</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+   * @param nsIMsgFolder aFolder - the folder.</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineplus">+   *</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+   * @return true if folder's server.type is in FeedAccountTypes, false if not.</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineplus">+   */</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineplus">+  isFeedFolder: function(aFolder) {</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineplus">+    return Boolean(aFolder instanceof Components.interfaces.nsIMsgFolder &amp;&amp;</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineplus">+                   this.FeedAccountTypes.includes(aFolder.server.type));</span>
<a href="#l22.50"></a><span id="l22.50">   },</span>
<a href="#l22.51"></a><span id="l22.51"> </span>
<a href="#l22.52"></a><span id="l22.52">   /**</span>
<a href="#l22.53"></a><span id="l22.53">    * Determine whether to show a feed message summary or load a web page in the</span>
<a href="#l22.54"></a><span id="l22.54">    * message pane.</span>
<a href="#l22.55"></a><span id="l22.55">    *</span>
<a href="#l22.56"></a><span id="l22.56">    * @param nsIMsgDBHdr aMsgHdr - the message.</span>
<a href="#l22.57"></a><span id="l22.57">    * @param bool aToggle        - true if in toggle mode, false otherwise.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/extensions/newsblog/jar.mn</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/jar.mn</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -3,14 +3,14 @@</span>
<a href="#l23.4"></a><span id="l23.4"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6"> newsblog.jar:</span>
<a href="#l23.7"></a><span id="l23.7"> % content messenger-newsblog %content/messenger-newsblog/</span>
<a href="#l23.8"></a><span id="l23.8">    content/messenger-newsblog/newsblogOverlay.js                (content/newsblogOverlay.js)</span>
<a href="#l23.9"></a><span id="l23.9">    content/messenger-newsblog/Feed.js                           (content/Feed.js)</span>
<a href="#l23.10"></a><span id="l23.10">    content/messenger-newsblog/FeedItem.js                       (content/FeedItem.js)</span>
<a href="#l23.11"></a><span id="l23.11">    content/messenger-newsblog/feed-parser.js                    (content/feed-parser.js)</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-*  content/messenger-newsblog/feed-subscriptions.js             (content/feed-subscriptions.js)</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+   content/messenger-newsblog/feed-subscriptions.js             (content/feed-subscriptions.js)</span>
<a href="#l23.14"></a><span id="l23.14">    content/messenger-newsblog/feed-subscriptions.xul            (content/feed-subscriptions.xul)</span>
<a href="#l23.15"></a><span id="l23.15">    content/messenger-newsblog/am-newsblog.js                    (content/am-newsblog.js)</span>
<a href="#l23.16"></a><span id="l23.16">    content/messenger-newsblog/am-newsblog.xul                   (content/am-newsblog.xul)</span>
<a href="#l23.17"></a><span id="l23.17">    content/messenger-newsblog/feedAccountWizard.js              (content/feedAccountWizard.js)</span>
<a href="#l23.18"></a><span id="l23.18">    content/messenger-newsblog/feedAccountWizard.xul             (content/feedAccountWizard.xul)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/newsblog/am-newsblog.dtd</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/newsblog/am-newsblog.dtd</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -1,22 +1,19 @@</span>
<a href="#l24.4"></a><span id="l24.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.5"></a><span id="l24.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l24.6"></a><span id="l24.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8" class="difflineminus">-&lt;!ENTITY biffStart.label &quot;Check for new articles every &quot;&gt;</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineminus">-&lt;!ENTITY biffStart.accesskey &quot;k&quot;&gt;</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineminus">-&lt;!ENTITY biffEnd.label &quot;minutes&quot;&gt;</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineminus">-</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-&lt;!ENTITY loginAtStartup.label &quot;Check for new articles at startup&quot;&gt; </span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+&lt;!ENTITY loginAtStartup.label &quot;Check for new articles at startup&quot;&gt;</span>
<a href="#l24.14"></a><span id="l24.14"> &lt;!ENTITY loginAtStartup.accesskey &quot;C&quot;&gt;</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+&lt;!ENTITY biffAll.label &quot;Enable updates for all feeds&quot;&gt;</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+&lt;!ENTITY biffAll.accesskey &quot;E&quot;&gt;</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-&lt;!ENTITY useQuickMode.label &quot;By default, show the article summary instead of loading the web page&quot;&gt; </span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">-&lt;!ENTITY useQuickMode.accesskey &quot;B&quot;&gt;</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+&lt;!ENTITY newFeedSettings.label &quot;Default Settings for New Feeds&quot;&gt;</span>
<a href="#l24.21"></a><span id="l24.21"> </span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-&lt;!ENTITY manageSubscriptions.label &quot;Manage Subscriptions…&quot;&gt; </span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+&lt;!ENTITY manageSubscriptions.label &quot;Manage Subscriptions…&quot;&gt;</span>
<a href="#l24.24"></a><span id="l24.24"> &lt;!ENTITY manageSubscriptions.accesskey &quot;M&quot;&gt;</span>
<a href="#l24.25"></a><span id="l24.25"> </span>
<a href="#l24.26"></a><span id="l24.26"> &lt;!-- entities from rss.rdf --&gt;</span>
<a href="#l24.27"></a><span id="l24.27"> &lt;!ENTITY feeds.accountName &quot;Blogs &amp;amp; News Feeds&quot;&gt;</span>
<a href="#l24.28"></a><span id="l24.28"> &lt;!ENTITY feeds.wizardShortName &quot;Feeds&quot;&gt;</span>
<a href="#l24.29"></a><span id="l24.29"> &lt;!ENTITY feeds.wizardLongName &quot;Blogs &amp;amp; News Feeds&quot;&gt;</span>
<a href="#l24.30"></a><span id="l24.30"> &lt;!ENTITY feeds.wizardLongName.accesskey &quot;F&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/newsblog/feed-subscriptions.dtd</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/newsblog/feed-subscriptions.dtd</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -5,33 +5,43 @@</span>
<a href="#l25.4"></a><span id="l25.4"> &lt;!-- Subscription Dialog --&gt;</span>
<a href="#l25.5"></a><span id="l25.5"> &lt;!ENTITY feedSubscriptions.label     &quot;Feed Subscriptions&quot;&gt;</span>
<a href="#l25.6"></a><span id="l25.6"> &lt;!ENTITY learnMore.label             &quot;Learn more about Feeds&quot;&gt;</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8"> &lt;!ENTITY feedTitle.label             &quot;Title:&quot;&gt;</span>
<a href="#l25.9"></a><span id="l25.9"> &lt;!ENTITY feedTitle.accesskey         &quot;T&quot;&gt;</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11"> &lt;!ENTITY feedLocation.label          &quot;Feed URL:&quot;&gt;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-&lt;!ENTITY feedLocation.accesskey      &quot;U&quot;&gt;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+&lt;!ENTITY feedLocation.accesskey      &quot;F&quot;&gt;</span>
<a href="#l25.14"></a><span id="l25.14"> &lt;!ENTITY feedLocation.placeholder    &quot;Enter a valid feed url to Add&quot;&gt;</span>
<a href="#l25.15"></a><span id="l25.15"> &lt;!ENTITY locationValidate.label      &quot;Validate&quot;&gt;</span>
<a href="#l25.16"></a><span id="l25.16"> &lt;!ENTITY validateText.label          &quot;Check validation and retrieve a valid url.&quot;&gt;</span>
<a href="#l25.17"></a><span id="l25.17"> </span>
<a href="#l25.18"></a><span id="l25.18"> &lt;!ENTITY feedFolder.label            &quot;Store Articles in:&quot;&gt;</span>
<a href="#l25.19"></a><span id="l25.19"> &lt;!ENTITY feedFolder.accesskey        &quot;S&quot;&gt;</span>
<a href="#l25.20"></a><span id="l25.20"> </span>
<a href="#l25.21"></a><span id="l25.21" class="difflineplus">+&lt;!-- Account Settings and Subscription Dialog --&gt;</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineplus">+&lt;!ENTITY biffStart.label             &quot;Check for new articles every &quot;&gt;</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineplus">+&lt;!ENTITY biffStart.accesskey         &quot;k&quot;&gt;</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineplus">+&lt;!ENTITY biffMinutes.label           &quot;minutes&quot;&gt;</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineplus">+&lt;!ENTITY biffMinutes.accesskey       &quot;n&quot;&gt;</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineplus">+&lt;!ENTITY biffDays.label              &quot;days&quot;&gt;</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineplus">+&lt;!ENTITY biffDays.accesskey          &quot;d&quot;&gt;</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineplus">+&lt;!ENTITY recommendedUnits.label      &quot;Publisher recommends:&quot;&gt;</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineplus">+</span>
<a href="#l25.30"></a><span id="l25.30"> &lt;!ENTITY quickMode.label             &quot;Show the article summary instead of loading the web page&quot;&gt;</span>
<a href="#l25.31"></a><span id="l25.31"> &lt;!ENTITY quickMode.accesskey         &quot;h&quot;&gt;</span>
<a href="#l25.32"></a><span id="l25.32"> </span>
<a href="#l25.33"></a><span id="l25.33"> &lt;!ENTITY autotagEnable.label         &quot;Automatically create tags from feed &amp;lt;category&amp;gt; names&quot;&gt;</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">-&lt;!ENTITY autotagEnable.accesskey     &quot;c&quot;&gt;</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+&lt;!ENTITY autotagEnable.accesskey     &quot;o&quot;&gt;</span>
<a href="#l25.36"></a><span id="l25.36"> &lt;!ENTITY autotagUsePrefix.label      &quot;Prefix tags with:&quot;&gt;</span>
<a href="#l25.37"></a><span id="l25.37"> &lt;!ENTITY autotagUsePrefix.accesskey  &quot;P&quot;&gt;</span>
<a href="#l25.38"></a><span id="l25.38"> &lt;!ENTITY autoTagPrefix.placeholder   &quot;Enter a tag prefix&quot;&gt;</span>
<a href="#l25.39"></a><span id="l25.39"> </span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+&lt;!-- Subscription Dialog --&gt;</span>
<a href="#l25.41"></a><span id="l25.41"> &lt;!ENTITY button.addFeed.label        &quot;Add&quot;&gt;</span>
<a href="#l25.42"></a><span id="l25.42"> &lt;!ENTITY button.addFeed.accesskey    &quot;A&quot;&gt;</span>
<a href="#l25.43"></a><span id="l25.43"> &lt;!ENTITY button.updateFeed.label     &quot;Update&quot;&gt;</span>
<a href="#l25.44"></a><span id="l25.44"> &lt;!ENTITY button.updateFeed.accesskey &quot;U&quot;&gt;</span>
<a href="#l25.45"></a><span id="l25.45"> &lt;!ENTITY button.removeFeed.label     &quot;Remove&quot;&gt;</span>
<a href="#l25.46"></a><span id="l25.46"> &lt;!ENTITY button.removeFeed.accesskey &quot;R&quot;&gt;</span>
<a href="#l25.47"></a><span id="l25.47"> &lt;!ENTITY button.importOPML.label     &quot;Import&quot;&gt;</span>
<a href="#l25.48"></a><span id="l25.48"> &lt;!ENTITY button.importOPML.accesskey &quot;I&quot;&gt;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

