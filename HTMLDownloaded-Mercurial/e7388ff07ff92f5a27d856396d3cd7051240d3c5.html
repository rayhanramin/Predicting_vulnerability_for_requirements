<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 9227:e7388ff07ff92f5a27d856396d3cd7051240d3c5</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ e7388ff07ff92f5a27d856396d3cd7051240d3c5" />
<meta property="og:url" content="/comm-central/rev/e7388ff07ff92f5a27d856396d3cd7051240d3c5" />
<meta property="og:description" content="Bug 526998 - Implement F2 keyboard shortcut for renaming focused attachments when composing (on Windows and Unix); r=mbanner, r=mconley, ui-r=bwinton" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / e7388ff07ff92f5a27d856396d3cd7051240d3c5 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/e7388ff07ff92f5a27d856396d3cd7051240d3c5">shortlog</a> |
<a href="/comm-central/log/e7388ff07ff92f5a27d856396d3cd7051240d3c5">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/e7388ff07ff92f5a27d856396d3cd7051240d3c5">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/e7388ff07ff92f5a27d856396d3cd7051240d3c5">files</a> |
changeset |
<a href="/comm-central/raw-rev/e7388ff07ff92f5a27d856396d3cd7051240d3c5">raw</a>  | <a href="/comm-central/archive/e7388ff07ff92f5a27d856396d3cd7051240d3c5.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=526998">Bug 526998</a> - Implement F2 keyboard shortcut for renaming focused attachments when composing (on Windows and Unix); r=mbanner, r=mconley, ui-r=bwinton
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#105;&#109;&#32;&#80;&#111;&#114;&#116;&#101;&#114;&#32;&#60;&#115;&#113;&#117;&#105;&#98;&#98;&#108;&#121;&#102;&#108;&#97;&#98;&#98;&#101;&#116;&#121;&#100;&#111;&#111;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 15 Jan 2012 13:50:00 -0600</td></tr>

<tr>
 <td>changeset 9227</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/e7388ff07ff92f5a27d856396d3cd7051240d3c5">e7388ff07ff92f5a27d856396d3cd7051240d3c5</a></td>
</tr>



<tr>
<td>parent 9226</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6559b1814a9bc93918aa1604d6c0fae8f0a2e662">6559b1814a9bc93918aa1604d6c0fae8f0a2e662</a>
</td>
</tr>

<tr>
<td>child 9228</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2451261c298fed302ade98480ca87c16b8967231">2451261c298fed302ade98480ca87c16b8967231</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=e7388ff07ff92f5a27d856396d3cd7051240d3c5">7063</a></td></tr>
<tr><td>push user</td><td>squibblyflabbetydoo@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 20 Jan 2012 00:02:44 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@e7388ff07ff9 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e7388ff07ff92f5a27d856396d3cd7051240d3c5">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e7388ff07ff92f5a27d856396d3cd7051240d3c5&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e7388ff07ff92f5a27d856396d3cd7051240d3c5&newProject=comm-central&newRevision=e7388ff07ff92f5a27d856396d3cd7051240d3c5&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e7388ff07ff92f5a27d856396d3cd7051240d3c5&newProject=comm-central&newRevision=e7388ff07ff92f5a27d856396d3cd7051240d3c5&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e7388ff07ff92f5a27d856396d3cd7051240d3c5&newProject=comm-central&newRevision=e7388ff07ff92f5a27d856396d3cd7051240d3c5&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mbanner%29&revcount=50">mbanner</a>, <a href="/comm-central/log?rev=reviewer%28mconley%29&revcount=50">mconley</a>, <a href="/comm-central/log?rev=reviewer%28bwinton%29&revcount=50">bwinton</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=526998">526998</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=526998">Bug 526998</a> - Implement F2 keyboard shortcut for renaming focused attachments when composing (on Windows and Unix); r=mbanner, r=mconley, ui-r=bwinton</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/messengercompose.xul">mail/components/compose/content/messengercompose.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/messengercompose.xul">file</a> |
<a href="/comm-central/annotate/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/messengercompose.xul">annotate</a> |
<a href="/comm-central/diff/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/messengercompose.xul">diff</a> |
<a href="/comm-central/comparison/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/messengercompose.xul">comparison</a> |
<a href="/comm-central/log/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/components/compose/content/messengercompose.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">file</a> |
<a href="/comm-central/annotate/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">annotate</a> |
<a href="/comm-central/diff/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">diff</a> |
<a href="/comm-central/comparison/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">comparison</a> |
<a href="/comm-central/log/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/test/mozmill/attachment/test-attachment.js">mail/test/mozmill/attachment/test-attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/test/mozmill/attachment/test-attachment.js">file</a> |
<a href="/comm-central/annotate/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/test/mozmill/attachment/test-attachment.js">annotate</a> |
<a href="/comm-central/diff/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/test/mozmill/attachment/test-attachment.js">diff</a> |
<a href="/comm-central/comparison/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/test/mozmill/attachment/test-attachment.js">comparison</a> |
<a href="/comm-central/log/e7388ff07ff92f5a27d856396d3cd7051240d3c5/mail/test/mozmill/attachment/test-attachment.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -416,179 +416,272 @@ var progressListener = {</span>
<a href="#l1.4"></a><span id="l1.4">           iid.equals(Components.interfaces.nsISupportsWeakReference) ||</span>
<a href="#l1.5"></a><span id="l1.5">           iid.equals(Components.interfaces.nsISupports))</span>
<a href="#l1.6"></a><span id="l1.6">         return this;</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">       throw Components.results.NS_NOINTERFACE;</span>
<a href="#l1.9"></a><span id="l1.9">     }</span>
<a href="#l1.10"></a><span id="l1.10"> };</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-var defaultController =</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-{</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-  supportsCommand: function(command)</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-  {</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-    switch (command)</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-    {</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-      //File Menu</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-      case &quot;cmd_attachFile&quot;:</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-      case &quot;cmd_attachPage&quot;:</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-      case &quot;cmd_close&quot;:</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-      case &quot;cmd_saveDefault&quot;:</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-      case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-      case &quot;cmd_saveAsDraft&quot;:</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-      case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-      case &quot;cmd_sendButton&quot;:</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-      case &quot;cmd_sendNow&quot;:</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-      case &quot;cmd_sendWithCheck&quot;:</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-      case &quot;cmd_sendLater&quot;:</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-      case &quot;cmd_printSetup&quot;:</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-      case &quot;cmd_print&quot;:</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-      case &quot;cmd_quit&quot;:</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-      //Edit Menu</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-      case &quot;cmd_delete&quot;:</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-      case &quot;cmd_renameAttachment&quot;:</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-      case &quot;cmd_selectAll&quot;:</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-      case &quot;cmd_openAttachment&quot;:</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-      case &quot;cmd_account&quot;:</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-      //View Menu</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-      case &quot;cmd_showFormatToolbar&quot;:</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-      //Options Menu</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-      case &quot;cmd_outputFormat&quot;:</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-      case &quot;cmd_quoteMessage&quot;:</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-        return true;</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-      default:</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-//        dump(&quot;##MsgCompose: command &quot; + command + &quot;no supported!\n&quot;);</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-        return false;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-    }</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-  },</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-  isCommandEnabled: function(command)</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-  {</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-    var composeHTML = gMsgCompose &amp;&amp; gMsgCompose.composeHTML;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-    switch (command)</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-    {</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-      //File Menu</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-      case &quot;cmd_attachFile&quot;:</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-      case &quot;cmd_attachPage&quot;:</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-      case &quot;cmd_close&quot;:</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-      case &quot;cmd_saveDefault&quot;:</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-      case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-      case &quot;cmd_saveAsDraft&quot;:</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-      case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-      case &quot;cmd_sendButton&quot;:</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-      case &quot;cmd_sendLater&quot;:</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-      case &quot;cmd_printSetup&quot;:</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-      case &quot;cmd_print&quot;:</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-      case &quot;cmd_sendWithCheck&quot;:</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+var defaultController = {</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+  commands: {</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+    cmd_attachFile: {</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+      },</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+        AttachFile();</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+      }</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+    },</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+    cmd_attachPage: {</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+      },</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+        AttachPage();</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+      }</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+    },</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+    cmd_close: {</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+      },</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+        DoCommandClose();</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+      }</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+    },</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+    cmd_saveDefault: {</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+      },</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+        Save();</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+      }</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+    },</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineplus">+</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+    cmd_saveAsFile: {</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+      },</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+        SaveAsFile(true);</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+      }</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+    },</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+    cmd_saveAsDraft: {</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+      },</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineplus">+        SaveAsDraft();</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineplus">+      }</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+    },</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineplus">+</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineplus">+    cmd_saveAsTemplate: {</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.131"></a><span id="l1.131">         return !gWindowLocked;</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineminus">-      case &quot;cmd_sendNow&quot;:</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineminus">-        return !(gWindowLocked || gIsOffline);</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineminus">-      case &quot;cmd_quit&quot;:</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-        return true;</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineminus">-</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineminus">-      //Edit Menu</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineminus">-      case &quot;cmd_delete&quot;:</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineminus">-        var numSelectedAttachments = MessageGetNumSelectedAttachments();</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineminus">-</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineminus">-        var cmdDelete = document.getElementById(&quot;cmd_delete&quot;);</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineminus">-        var textValue = cmdDelete.getAttribute(&quot;valueDefault&quot;);</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineminus">-        var accesskeyValue = cmdDelete.getAttribute(&quot;valueDefaultAccessKey&quot;);</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineminus">-</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineminus">-        var hasAttachments = MessageHasAttachments();</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineminus">-        if (hasAttachments) {</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineminus">-          textValue = getComposeBundle().getString(&quot;removeAttachmentMsgs&quot;);</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineminus">-          textValue = PluralForm.get(numSelectedAttachments, textValue);</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineminus">-          accesskeyValue = cmdDelete.getAttribute(&quot;valueRemoveAttachmentAccessKey&quot;);</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineminus">-        }</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineplus">+      },</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineplus">+        SaveAsTemplate();</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+      }</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineplus">+    },</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+    cmd_sendButton: {</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineplus">+      },</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineplus">+        if (gIOService &amp;&amp; gIOService.offline)</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineplus">+          SendMessageLater();</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineplus">+        else</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineplus">+          SendMessage();</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineplus">+      }</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineplus">+    },</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineplus">+</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineplus">+    cmd_sendNow: {</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineplus">+        return !gWindowLocked &amp;&amp; !gIsOffline;</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+      },</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineplus">+        SendMessage();</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineplus">+      }</span>
<a href="#l1.176"></a><span id="l1.176" class="difflineplus">+    },</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineplus">+</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineplus">+    cmd_sendLater: {</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineplus">+      },</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+        SendMessageLater();</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+      }</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+    },</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+    cmd_sendWithCheck: {</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+      },</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineplus">+        SendMessageWithCheck();</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineplus">+      }</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineplus">+    },</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineplus">+</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineplus">+    cmd_printSetup: {</span>
<a href="#l1.197"></a><span id="l1.197" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineplus">+      },</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineplus">+        PrintUtils.showPageSetup();</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineplus">+      }</span>
<a href="#l1.203"></a><span id="l1.203" class="difflineplus">+    },</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineplus">+</span>
<a href="#l1.205"></a><span id="l1.205" class="difflineplus">+    cmd_print: {</span>
<a href="#l1.206"></a><span id="l1.206" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.207"></a><span id="l1.207" class="difflineplus">+        return !gWindowLocked;</span>
<a href="#l1.208"></a><span id="l1.208" class="difflineplus">+      },</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.210"></a><span id="l1.210" class="difflineplus">+        DoCommandPrint();</span>
<a href="#l1.211"></a><span id="l1.211" class="difflineplus">+      }</span>
<a href="#l1.212"></a><span id="l1.212" class="difflineplus">+    },</span>
<a href="#l1.213"></a><span id="l1.213" class="difflineplus">+</span>
<a href="#l1.214"></a><span id="l1.214" class="difflineplus">+    cmd_delete: {</span>
<a href="#l1.215"></a><span id="l1.215" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.216"></a><span id="l1.216" class="difflineplus">+        let cmdDelete = document.getElementById(&quot;cmd_delete&quot;);</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineplus">+        let textValue = cmdDelete.getAttribute(&quot;valueDefault&quot;);</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineplus">+        let accesskeyValue = cmdDelete.getAttribute(&quot;valueDefaultAccessKey&quot;);</span>
<a href="#l1.219"></a><span id="l1.219"> </span>
<a href="#l1.220"></a><span id="l1.220">         cmdDelete.setAttribute(&quot;label&quot;, textValue);</span>
<a href="#l1.221"></a><span id="l1.221">         cmdDelete.setAttribute(&quot;accesskey&quot;, accesskeyValue);</span>
<a href="#l1.222"></a><span id="l1.222"> </span>
<a href="#l1.223"></a><span id="l1.223" class="difflineminus">-        return hasAttachments ? numSelectedAttachments : 0;</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineminus">-      case &quot;cmd_selectAll&quot;:</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineminus">-        return MessageHasAttachments();</span>
<a href="#l1.226"></a><span id="l1.226" class="difflineminus">-      case &quot;cmd_openAttachment&quot;:</span>
<a href="#l1.227"></a><span id="l1.227" class="difflineminus">-        return MessageGetNumSelectedAttachments() == 1;</span>
<a href="#l1.228"></a><span id="l1.228" class="difflineminus">-      case &quot;cmd_renameAttachment&quot;:</span>
<a href="#l1.229"></a><span id="l1.229" class="difflineminus">-        return MessageGetNumSelectedAttachments() == 1;</span>
<a href="#l1.230"></a><span id="l1.230" class="difflineminus">-      case &quot;cmd_account&quot;:</span>
<a href="#l1.231"></a><span id="l1.231" class="difflineminus">-</span>
<a href="#l1.232"></a><span id="l1.232" class="difflineminus">-      //View Menu</span>
<a href="#l1.233"></a><span id="l1.233" class="difflineminus">-      case &quot;cmd_showFormatToolbar&quot;:</span>
<a href="#l1.234"></a><span id="l1.234" class="difflineminus">-        return composeHTML;</span>
<a href="#l1.235"></a><span id="l1.235" class="difflineminus">-</span>
<a href="#l1.236"></a><span id="l1.236" class="difflineminus">-      //Options Menu</span>
<a href="#l1.237"></a><span id="l1.237" class="difflineminus">-      case &quot;cmd_outputFormat&quot;:</span>
<a href="#l1.238"></a><span id="l1.238" class="difflineminus">-        return composeHTML;</span>
<a href="#l1.239"></a><span id="l1.239" class="difflineminus">-      case &quot;cmd_quoteMessage&quot;:</span>
<a href="#l1.240"></a><span id="l1.240" class="difflineminus">-        var selectedURIs = GetSelectedMessages();</span>
<a href="#l1.241"></a><span id="l1.241" class="difflineminus">-        if (selectedURIs &amp;&amp; selectedURIs.length &gt; 0)</span>
<a href="#l1.242"></a><span id="l1.242" class="difflineminus">-          return true;</span>
<a href="#l1.243"></a><span id="l1.243">         return false;</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineminus">-</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineminus">-      default:</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineminus">-//        dump(&quot;##MsgCompose: command &quot; + command + &quot; disabled!\n&quot;);</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineminus">-        return false;</span>
<a href="#l1.248"></a><span id="l1.248" class="difflineminus">-    }</span>
<a href="#l1.249"></a><span id="l1.249" class="difflineplus">+      },</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineplus">+      }</span>
<a href="#l1.252"></a><span id="l1.252" class="difflineplus">+    },</span>
<a href="#l1.253"></a><span id="l1.253" class="difflineplus">+</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineplus">+    cmd_account: {</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineplus">+        return true;</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineplus">+      },</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.259"></a><span id="l1.259" class="difflineplus">+        MsgAccountManager(null);</span>
<a href="#l1.260"></a><span id="l1.260" class="difflineplus">+      }</span>
<a href="#l1.261"></a><span id="l1.261" class="difflineplus">+    },</span>
<a href="#l1.262"></a><span id="l1.262" class="difflineplus">+</span>
<a href="#l1.263"></a><span id="l1.263" class="difflineplus">+    cmd_showFormatToolbar: {</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.265"></a><span id="l1.265" class="difflineplus">+        return gMsgCompose &amp;&amp; gMsgCompose.composeHTML;</span>
<a href="#l1.266"></a><span id="l1.266" class="difflineplus">+      },</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.268"></a><span id="l1.268" class="difflineplus">+        goToggleToolbar(&quot;FormatToolbar&quot;, &quot;menu_showFormatToolbar&quot;);</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineplus">+      }</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineplus">+    },</span>
<a href="#l1.271"></a><span id="l1.271" class="difflineplus">+</span>
<a href="#l1.272"></a><span id="l1.272" class="difflineplus">+    cmd_quoteMessage: {</span>
<a href="#l1.273"></a><span id="l1.273" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.274"></a><span id="l1.274" class="difflineplus">+        let selectedURIs = GetSelectedMessages();</span>
<a href="#l1.275"></a><span id="l1.275" class="difflineplus">+        return (selectedURIs &amp;&amp; selectedURIs.length &gt; 0)</span>
<a href="#l1.276"></a><span id="l1.276" class="difflineplus">+      },</span>
<a href="#l1.277"></a><span id="l1.277" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.278"></a><span id="l1.278" class="difflineplus">+        QuoteSelectedMessage();</span>
<a href="#l1.279"></a><span id="l1.279" class="difflineplus">+      }</span>
<a href="#l1.280"></a><span id="l1.280" class="difflineplus">+    },</span>
<a href="#l1.281"></a><span id="l1.281" class="difflineplus">+  },</span>
<a href="#l1.282"></a><span id="l1.282" class="difflineplus">+</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineplus">+  supportsCommand: function(aCommand) {</span>
<a href="#l1.284"></a><span id="l1.284" class="difflineplus">+    return (aCommand in this.commands);</span>
<a href="#l1.285"></a><span id="l1.285" class="difflineplus">+  },</span>
<a href="#l1.286"></a><span id="l1.286" class="difflineplus">+</span>
<a href="#l1.287"></a><span id="l1.287" class="difflineplus">+  isCommandEnabled: function(aCommand) {</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineplus">+    if (!this.supportsCommand(aCommand))</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineplus">+      return false;</span>
<a href="#l1.290"></a><span id="l1.290" class="difflineplus">+    return this.commands[aCommand].isEnabled();</span>
<a href="#l1.291"></a><span id="l1.291" class="difflineplus">+  },</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineplus">+</span>
<a href="#l1.293"></a><span id="l1.293" class="difflineplus">+  doCommand: function(aCommand) {</span>
<a href="#l1.294"></a><span id="l1.294" class="difflineplus">+    if (!this.supportsCommand(aCommand))</span>
<a href="#l1.295"></a><span id="l1.295" class="difflineplus">+      return;</span>
<a href="#l1.296"></a><span id="l1.296" class="difflineplus">+    var cmd = this.commands[aCommand];</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineplus">+    if (!cmd.isEnabled())</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineplus">+      return;</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineplus">+    cmd.doCommand();</span>
<a href="#l1.300"></a><span id="l1.300">   },</span>
<a href="#l1.301"></a><span id="l1.301"> </span>
<a href="#l1.302"></a><span id="l1.302" class="difflineminus">-  doCommand: function(command)</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineminus">-  {</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineminus">-    switch (command)</span>
<a href="#l1.305"></a><span id="l1.305" class="difflineminus">-    {</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineminus">-      //File Menu</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineminus">-      case &quot;cmd_attachFile&quot;         : if (defaultController.isCommandEnabled(command)) AttachFile();           break;</span>
<a href="#l1.308"></a><span id="l1.308" class="difflineminus">-      case &quot;cmd_attachPage&quot;         : AttachPage();           break;</span>
<a href="#l1.309"></a><span id="l1.309" class="difflineminus">-      case &quot;cmd_close&quot;              : DoCommandClose();       break;</span>
<a href="#l1.310"></a><span id="l1.310" class="difflineminus">-      case &quot;cmd_saveDefault&quot;        : Save();                 break;</span>
<a href="#l1.311"></a><span id="l1.311" class="difflineminus">-      case &quot;cmd_saveAsFile&quot;         : SaveAsFile(true);       break;</span>
<a href="#l1.312"></a><span id="l1.312" class="difflineminus">-      case &quot;cmd_saveAsDraft&quot;        : SaveAsDraft();          break;</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineminus">-      case &quot;cmd_saveAsTemplate&quot;     : SaveAsTemplate();       break;</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineminus">-      case &quot;cmd_sendButton&quot;         :</span>
<a href="#l1.315"></a><span id="l1.315" class="difflineminus">-        if (defaultController.isCommandEnabled(command))</span>
<a href="#l1.316"></a><span id="l1.316" class="difflineminus">-        {</span>
<a href="#l1.317"></a><span id="l1.317" class="difflineminus">-          if (gIOService &amp;&amp; gIOService.offline)</span>
<a href="#l1.318"></a><span id="l1.318" class="difflineminus">-            SendMessageLater();</span>
<a href="#l1.319"></a><span id="l1.319" class="difflineminus">-          else</span>
<a href="#l1.320"></a><span id="l1.320" class="difflineminus">-            SendMessage();</span>
<a href="#l1.321"></a><span id="l1.321" class="difflineminus">-        }</span>
<a href="#l1.322"></a><span id="l1.322" class="difflineminus">-        break;</span>
<a href="#l1.323"></a><span id="l1.323" class="difflineminus">-      case &quot;cmd_sendNow&quot;            : if (defaultController.isCommandEnabled(command)) SendMessage();          break;</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineminus">-      case &quot;cmd_sendWithCheck&quot;   : if (defaultController.isCommandEnabled(command)) SendMessageWithCheck();          break;</span>
<a href="#l1.325"></a><span id="l1.325" class="difflineminus">-      case &quot;cmd_sendLater&quot;          : if (defaultController.isCommandEnabled(command)) SendMessageLater();     break;</span>
<a href="#l1.326"></a><span id="l1.326" class="difflineminus">-      case &quot;cmd_printSetup&quot;         : PrintUtils.showPageSetup(); break;</span>
<a href="#l1.327"></a><span id="l1.327" class="difflineminus">-      case &quot;cmd_print&quot;              : DoCommandPrint(); break;</span>
<a href="#l1.328"></a><span id="l1.328" class="difflineminus">-</span>
<a href="#l1.329"></a><span id="l1.329" class="difflineminus">-      //Edit Menu</span>
<a href="#l1.330"></a><span id="l1.330" class="difflineminus">-      case &quot;cmd_delete&quot;             : if (MessageGetNumSelectedAttachments()) RemoveSelectedAttachment();         break;</span>
<a href="#l1.331"></a><span id="l1.331" class="difflineminus">-      case &quot;cmd_renameAttachment&quot;   : if (MessageGetNumSelectedAttachments() == 1) RenameSelectedAttachment(); break;</span>
<a href="#l1.332"></a><span id="l1.332" class="difflineminus">-      case &quot;cmd_selectAll&quot;          : if (MessageHasAttachments()) SelectAllAttachments();                     break;</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineminus">-      case &quot;cmd_openAttachment&quot;     : if (MessageGetNumSelectedAttachments() == 1) OpenSelectedAttachment();          break;</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineminus">-      case &quot;cmd_account&quot;            : MsgAccountManager(null); break;</span>
<a href="#l1.335"></a><span id="l1.335" class="difflineminus">-</span>
<a href="#l1.336"></a><span id="l1.336" class="difflineminus">-      //View Menu</span>
<a href="#l1.337"></a><span id="l1.337" class="difflineminus">-      case &quot;cmd_showFormatToolbar&quot;  : goToggleToolbar('FormatToolbar', 'menu_showFormatToolbar');   break;</span>
<a href="#l1.338"></a><span id="l1.338" class="difflineminus">-</span>
<a href="#l1.339"></a><span id="l1.339" class="difflineminus">-      //Options Menu</span>
<a href="#l1.340"></a><span id="l1.340" class="difflineminus">-      case &quot;cmd_quoteMessage&quot;       : if (defaultController.isCommandEnabled(command)) QuoteSelectedMessage();  break;</span>
<a href="#l1.341"></a><span id="l1.341" class="difflineminus">-      default:</span>
<a href="#l1.342"></a><span id="l1.342" class="difflineminus">-//        dump(&quot;##MsgCompose: don't know what to do with command &quot; + command + &quot;!\n&quot;);</span>
<a href="#l1.343"></a><span id="l1.343" class="difflineminus">-        return;</span>
<a href="#l1.344"></a><span id="l1.344" class="difflineminus">-    }</span>
<a href="#l1.345"></a><span id="l1.345" class="difflineplus">+  onEvent: function(event) {},</span>
<a href="#l1.346"></a><span id="l1.346" class="difflineplus">+};</span>
<a href="#l1.347"></a><span id="l1.347" class="difflineplus">+</span>
<a href="#l1.348"></a><span id="l1.348" class="difflineplus">+var attachmentBucketController = {</span>
<a href="#l1.349"></a><span id="l1.349" class="difflineplus">+  commands: {</span>
<a href="#l1.350"></a><span id="l1.350" class="difflineplus">+    cmd_selectAll: {</span>
<a href="#l1.351"></a><span id="l1.351" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.352"></a><span id="l1.352" class="difflineplus">+        return true;</span>
<a href="#l1.353"></a><span id="l1.353" class="difflineplus">+      },</span>
<a href="#l1.354"></a><span id="l1.354" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.355"></a><span id="l1.355" class="difflineplus">+        document.getElementById(&quot;attachmentBucket&quot;).selectAll();</span>
<a href="#l1.356"></a><span id="l1.356" class="difflineplus">+      }</span>
<a href="#l1.357"></a><span id="l1.357" class="difflineplus">+    },</span>
<a href="#l1.358"></a><span id="l1.358" class="difflineplus">+</span>
<a href="#l1.359"></a><span id="l1.359" class="difflineplus">+    cmd_delete: {</span>
<a href="#l1.360"></a><span id="l1.360" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.361"></a><span id="l1.361" class="difflineplus">+        let selectedCount = MessageGetNumSelectedAttachments();</span>
<a href="#l1.362"></a><span id="l1.362" class="difflineplus">+        let cmdDelete = document.getElementById(&quot;cmd_delete&quot;);</span>
<a href="#l1.363"></a><span id="l1.363" class="difflineplus">+        let textValue = getComposeBundle().getString(&quot;removeAttachmentMsgs&quot;);</span>
<a href="#l1.364"></a><span id="l1.364" class="difflineplus">+        textValue = PluralForm.get(selectedCount, textValue);</span>
<a href="#l1.365"></a><span id="l1.365" class="difflineplus">+        let accesskeyValue = cmdDelete.getAttribute(&quot;valueRemoveAttachmentAccessKey&quot;);</span>
<a href="#l1.366"></a><span id="l1.366" class="difflineplus">+        cmdDelete.setAttribute(&quot;label&quot;, textValue);</span>
<a href="#l1.367"></a><span id="l1.367" class="difflineplus">+        cmdDelete.setAttribute(&quot;accesskey&quot;, accesskeyValue);</span>
<a href="#l1.368"></a><span id="l1.368" class="difflineplus">+</span>
<a href="#l1.369"></a><span id="l1.369" class="difflineplus">+        return selectedCount &gt; 0;</span>
<a href="#l1.370"></a><span id="l1.370" class="difflineplus">+      },</span>
<a href="#l1.371"></a><span id="l1.371" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.372"></a><span id="l1.372" class="difflineplus">+        RemoveSelectedAttachment();</span>
<a href="#l1.373"></a><span id="l1.373" class="difflineplus">+      }</span>
<a href="#l1.374"></a><span id="l1.374" class="difflineplus">+    },</span>
<a href="#l1.375"></a><span id="l1.375" class="difflineplus">+</span>
<a href="#l1.376"></a><span id="l1.376" class="difflineplus">+    cmd_openAttachment: {</span>
<a href="#l1.377"></a><span id="l1.377" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.378"></a><span id="l1.378" class="difflineplus">+        return MessageGetNumSelectedAttachments() == 1;</span>
<a href="#l1.379"></a><span id="l1.379" class="difflineplus">+      },</span>
<a href="#l1.380"></a><span id="l1.380" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.381"></a><span id="l1.381" class="difflineplus">+        OpenSelectedAttachment();</span>
<a href="#l1.382"></a><span id="l1.382" class="difflineplus">+      }</span>
<a href="#l1.383"></a><span id="l1.383" class="difflineplus">+    },</span>
<a href="#l1.384"></a><span id="l1.384" class="difflineplus">+</span>
<a href="#l1.385"></a><span id="l1.385" class="difflineplus">+    cmd_renameAttachment: {</span>
<a href="#l1.386"></a><span id="l1.386" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l1.387"></a><span id="l1.387" class="difflineplus">+        return MessageGetNumSelectedAttachments() == 1;</span>
<a href="#l1.388"></a><span id="l1.388" class="difflineplus">+      },</span>
<a href="#l1.389"></a><span id="l1.389" class="difflineplus">+      doCommand: function() {</span>
<a href="#l1.390"></a><span id="l1.390" class="difflineplus">+        RenameSelectedAttachment();</span>
<a href="#l1.391"></a><span id="l1.391" class="difflineplus">+      }</span>
<a href="#l1.392"></a><span id="l1.392" class="difflineplus">+    },</span>
<a href="#l1.393"></a><span id="l1.393">   },</span>
<a href="#l1.394"></a><span id="l1.394"> </span>
<a href="#l1.395"></a><span id="l1.395" class="difflineminus">-  onEvent: function(event)</span>
<a href="#l1.396"></a><span id="l1.396" class="difflineminus">-  {</span>
<a href="#l1.397"></a><span id="l1.397" class="difflineminus">-//    dump(&quot;DefaultController:onEvent\n&quot;);</span>
<a href="#l1.398"></a><span id="l1.398" class="difflineminus">-  }</span>
<a href="#l1.399"></a><span id="l1.399" class="difflineminus">-}</span>
<a href="#l1.400"></a><span id="l1.400" class="difflineplus">+  supportsCommand: function(aCommand) {</span>
<a href="#l1.401"></a><span id="l1.401" class="difflineplus">+    return (aCommand in this.commands);</span>
<a href="#l1.402"></a><span id="l1.402" class="difflineplus">+  },</span>
<a href="#l1.403"></a><span id="l1.403" class="difflineplus">+</span>
<a href="#l1.404"></a><span id="l1.404" class="difflineplus">+  isCommandEnabled: function(aCommand) {</span>
<a href="#l1.405"></a><span id="l1.405" class="difflineplus">+    if (!this.supportsCommand(aCommand))</span>
<a href="#l1.406"></a><span id="l1.406" class="difflineplus">+      return false;</span>
<a href="#l1.407"></a><span id="l1.407" class="difflineplus">+    return this.commands[aCommand].isEnabled();</span>
<a href="#l1.408"></a><span id="l1.408" class="difflineplus">+  },</span>
<a href="#l1.409"></a><span id="l1.409" class="difflineplus">+</span>
<a href="#l1.410"></a><span id="l1.410" class="difflineplus">+  doCommand: function(aCommand) {</span>
<a href="#l1.411"></a><span id="l1.411" class="difflineplus">+    if (!this.supportsCommand(aCommand))</span>
<a href="#l1.412"></a><span id="l1.412" class="difflineplus">+      return;</span>
<a href="#l1.413"></a><span id="l1.413" class="difflineplus">+    var cmd = this.commands[aCommand];</span>
<a href="#l1.414"></a><span id="l1.414" class="difflineplus">+    if (!cmd.isEnabled())</span>
<a href="#l1.415"></a><span id="l1.415" class="difflineplus">+      return;</span>
<a href="#l1.416"></a><span id="l1.416" class="difflineplus">+    cmd.doCommand();</span>
<a href="#l1.417"></a><span id="l1.417" class="difflineplus">+  },</span>
<a href="#l1.418"></a><span id="l1.418" class="difflineplus">+</span>
<a href="#l1.419"></a><span id="l1.419" class="difflineplus">+  onEvent: function(event) {},</span>
<a href="#l1.420"></a><span id="l1.420" class="difflineplus">+};</span>
<a href="#l1.421"></a><span id="l1.421"> </span>
<a href="#l1.422"></a><span id="l1.422"> function goOpenNewMessage()</span>
<a href="#l1.423"></a><span id="l1.423"> {</span>
<a href="#l1.424"></a><span id="l1.424">   // if there is a MsgNewMessage function in scope</span>
<a href="#l1.425"></a><span id="l1.425">   // and we should use it, so that we choose the proper</span>
<a href="#l1.426"></a><span id="l1.426">   // identity, based on the selected message or folder</span>
<a href="#l1.427"></a><span id="l1.427">   // if not, bring up the compose window to the default identity</span>
<a href="#l1.428"></a><span id="l1.428">   if (&quot;MsgNewMessage&quot; in window) {</span>
<a href="#l1.429"></a><span id="l1.429" class="difflineat">@@ -623,27 +716,33 @@ function GetSelectedMessages()</span>
<a href="#l1.430"></a><span id="l1.430">     }</span>
<a href="#l1.431"></a><span id="l1.431">   }</span>
<a href="#l1.432"></a><span id="l1.432"> </span>
<a href="#l1.433"></a><span id="l1.433">   return null;</span>
<a href="#l1.434"></a><span id="l1.434"> }</span>
<a href="#l1.435"></a><span id="l1.435"> </span>
<a href="#l1.436"></a><span id="l1.436"> function SetupCommandUpdateHandlers()</span>
<a href="#l1.437"></a><span id="l1.437"> {</span>
<a href="#l1.438"></a><span id="l1.438" class="difflineminus">-  top.controllers.insertControllerAt(0, defaultController);</span>
<a href="#l1.439"></a><span id="l1.439" class="difflineplus">+  let attachmentBucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l1.440"></a><span id="l1.440" class="difflineplus">+</span>
<a href="#l1.441"></a><span id="l1.441" class="difflineplus">+  top.controllers.appendController(defaultController);</span>
<a href="#l1.442"></a><span id="l1.442" class="difflineplus">+  attachmentBucket.controllers.appendController(attachmentBucketController);</span>
<a href="#l1.443"></a><span id="l1.443"> </span>
<a href="#l1.444"></a><span id="l1.444">   document.getElementById(&quot;optionsMenuPopup&quot;)</span>
<a href="#l1.445"></a><span id="l1.445">           .addEventListener(&quot;popupshowing&quot;, updateOptionItems, true);</span>
<a href="#l1.446"></a><span id="l1.446"> }</span>
<a href="#l1.447"></a><span id="l1.447"> </span>
<a href="#l1.448"></a><span id="l1.448"> function UnloadCommandUpdateHandlers()</span>
<a href="#l1.449"></a><span id="l1.449"> {</span>
<a href="#l1.450"></a><span id="l1.450" class="difflineplus">+  let attachmentBucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l1.451"></a><span id="l1.451" class="difflineplus">+</span>
<a href="#l1.452"></a><span id="l1.452">   document.getElementById(&quot;optionsMenuPopup&quot;)</span>
<a href="#l1.453"></a><span id="l1.453">           .removeEventListener(&quot;popupshowing&quot;, updateOptionItems, true);</span>
<a href="#l1.454"></a><span id="l1.454"> </span>
<a href="#l1.455"></a><span id="l1.455" class="difflineplus">+  attachmentBucket.controllers.removeController(attachmentBucketController);</span>
<a href="#l1.456"></a><span id="l1.456">   top.controllers.removeController(defaultController);</span>
<a href="#l1.457"></a><span id="l1.457"> }</span>
<a href="#l1.458"></a><span id="l1.458"> </span>
<a href="#l1.459"></a><span id="l1.459"> function CommandUpdate_MsgCompose()</span>
<a href="#l1.460"></a><span id="l1.460"> {</span>
<a href="#l1.461"></a><span id="l1.461">   var focusedWindow = top.document.commandDispatcher.focusedWindow;</span>
<a href="#l1.462"></a><span id="l1.462"> </span>
<a href="#l1.463"></a><span id="l1.463">   // we're just setting focus to where it was before</span>
<a href="#l1.464"></a><span id="l1.464" class="difflineat">@@ -3006,32 +3105,16 @@ function AddFileAttachment(file)</span>
<a href="#l1.465"></a><span id="l1.465">  *</span>
<a href="#l1.466"></a><span id="l1.466">  * @param attachment the nsIMsgAttachment object to add as attachment</span>
<a href="#l1.467"></a><span id="l1.467">  */</span>
<a href="#l1.468"></a><span id="l1.468"> function AddUrlAttachment(attachment)</span>
<a href="#l1.469"></a><span id="l1.469"> {</span>
<a href="#l1.470"></a><span id="l1.470">   AddAttachments([attachment]);</span>
<a href="#l1.471"></a><span id="l1.471"> }</span>
<a href="#l1.472"></a><span id="l1.472"> </span>
<a href="#l1.473"></a><span id="l1.473" class="difflineminus">-function SelectAllAttachments()</span>
<a href="#l1.474"></a><span id="l1.474" class="difflineminus">-{</span>
<a href="#l1.475"></a><span id="l1.475" class="difflineminus">-  var bucketList = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l1.476"></a><span id="l1.476" class="difflineminus">-  if (bucketList)</span>
<a href="#l1.477"></a><span id="l1.477" class="difflineminus">-    bucketList.selectAll();</span>
<a href="#l1.478"></a><span id="l1.478" class="difflineminus">-}</span>
<a href="#l1.479"></a><span id="l1.479" class="difflineminus">-</span>
<a href="#l1.480"></a><span id="l1.480" class="difflineminus">-function MessageHasAttachments()</span>
<a href="#l1.481"></a><span id="l1.481" class="difflineminus">-{</span>
<a href="#l1.482"></a><span id="l1.482" class="difflineminus">-  var bucketList = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l1.483"></a><span id="l1.483" class="difflineminus">-  if (bucketList) {</span>
<a href="#l1.484"></a><span id="l1.484" class="difflineminus">-    return (bucketList &amp;&amp; bucketList.getRowCount() &amp;&amp; (bucketList == top.document.commandDispatcher.focusedElement));</span>
<a href="#l1.485"></a><span id="l1.485" class="difflineminus">-  }</span>
<a href="#l1.486"></a><span id="l1.486" class="difflineminus">-  return false;</span>
<a href="#l1.487"></a><span id="l1.487" class="difflineminus">-}</span>
<a href="#l1.488"></a><span id="l1.488" class="difflineminus">-</span>
<a href="#l1.489"></a><span id="l1.489"> function MessageGetNumSelectedAttachments()</span>
<a href="#l1.490"></a><span id="l1.490"> {</span>
<a href="#l1.491"></a><span id="l1.491">   var bucketList = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l1.492"></a><span id="l1.492">   return (bucketList) ? bucketList.selectedItems.length : 0;</span>
<a href="#l1.493"></a><span id="l1.493"> }</span>
<a href="#l1.494"></a><span id="l1.494"> </span>
<a href="#l1.495"></a><span id="l1.495"> function AttachPage()</span>
<a href="#l1.496"></a><span id="l1.496"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/compose/content/messengercompose.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/compose/content/messengercompose.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -152,19 +152,19 @@</span>
<a href="#l2.4"></a><span id="l2.4">   &lt;!--command id=&quot;cmd_findNext&quot;/--&gt;</span>
<a href="#l2.5"></a><span id="l2.5">   &lt;command id=&quot;cmd_undo&quot; oncommand=&quot;goDoCommand('cmd_undo')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.6"></a><span id="l2.6">   &lt;command id=&quot;cmd_redo&quot; oncommand=&quot;goDoCommand('cmd_redo')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.7"></a><span id="l2.7">   &lt;command id=&quot;cmd_cut&quot; oncommand=&quot;goDoCommand('cmd_cut')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.8"></a><span id="l2.8">   &lt;command id=&quot;cmd_copy&quot; oncommand=&quot;goDoCommand('cmd_copy')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.9"></a><span id="l2.9">   &lt;command id=&quot;cmd_paste&quot; oncommand=&quot;goDoCommand('cmd_paste')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.10"></a><span id="l2.10">   &lt;command id=&quot;cmd_rewrap&quot; oncommand=&quot;goDoCommand('cmd_rewrap')&quot;/&gt;</span>
<a href="#l2.11"></a><span id="l2.11">   &lt;command id=&quot;cmd_delete&quot; oncommand=&quot;goDoCommand('cmd_delete')&quot; valueDefault=&quot;&amp;deleteCmd.label;&quot; valueDefaultAccessKey=&quot;&amp;deleteCmd.accesskey;&quot; valueRemoveAttachmentAccessKey=&quot;&amp;removeAttachment.accesskey;&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  &lt;command id=&quot;cmd_selectAll&quot; oncommand=&quot;goDoCommand('cmd_selectAll')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  &lt;command id=&quot;cmd_openAttachment&quot; oncommand=&quot;goDoCommand('cmd_openAttachment')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.14"></a><span id="l2.14">   &lt;command id=&quot;cmd_renameAttachment&quot; oncommand=&quot;goDoCommand('cmd_renameAttachment')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-  &lt;command id=&quot;cmd_selectAll&quot; oncommand=&quot;goDoCommand('cmd_selectAll')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-  &lt;command id=&quot;cmd_openAttachment&quot; oncommand=&quot;goDoCommand('cmd_openAttachment')&quot; disabled=&quot;true&quot;/&gt;  </span>
<a href="#l2.17"></a><span id="l2.17">   &lt;command id=&quot;cmd_account&quot; oncommand=&quot;goDoCommand('cmd_account')&quot;/&gt;</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">   &lt;!-- View Menu --&gt;</span>
<a href="#l2.20"></a><span id="l2.20">   &lt;command id=&quot;cmd_showFormatToolbar&quot; oncommand=&quot;goDoCommand('cmd_showFormatToolbar')&quot;/&gt;</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22">   &lt;!-- Options Menu --&gt;</span>
<a href="#l2.23"></a><span id="l2.23">   &lt;command id=&quot;cmd_quoteMessage&quot; oncommand=&quot;goDoCommand('cmd_quoteMessage')&quot;/&gt;</span>
<a href="#l2.24"></a><span id="l2.24">   &lt;command id=&quot;cmd_insert&quot;/&gt;</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineat">@@ -217,20 +217,21 @@</span>
<a href="#l2.26"></a><span id="l2.26">   &lt;key id=&quot;key_copy&quot; key=&quot;&amp;copyCmd.key;&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l2.27"></a><span id="l2.27">   &lt;key id=&quot;key_paste&quot; key=&quot;&amp;pasteCmd.key;&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l2.28"></a><span id="l2.28">   &lt;key id=&quot;pastequotationkb&quot; key=&quot;&amp;pasteAsQuotationCmd.key;&quot;</span>
<a href="#l2.29"></a><span id="l2.29">        observes=&quot;cmd_pasteQuote&quot; modifiers=&quot;accel, shift&quot;/&gt;</span>
<a href="#l2.30"></a><span id="l2.30">   &lt;key id=&quot;pastenoformattingkb&quot; key=&quot;&amp;pasteNoFormattingCmd.key;&quot;</span>
<a href="#l2.31"></a><span id="l2.31">        modifiers=&quot;accel, shift&quot; observes=&quot;cmd_pasteNoFormatting&quot;/&gt;</span>
<a href="#l2.32"></a><span id="l2.32">   &lt;key id=&quot;key_rewrap&quot; key=&quot;&amp;editRewrapCmd.key;&quot; command=&quot;cmd_rewrap&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l2.33"></a><span id="l2.33"> #ifdef XP_MACOSX</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-  &lt;key id=&quot;key_delete&quot; keycode=&quot;VK_BACK&quot;/&gt;</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-  &lt;key id=&quot;key_delete2&quot; keycode=&quot;VK_DELETE&quot;/&gt;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+  &lt;key id=&quot;key_delete&quot; keycode=&quot;VK_BACK&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+  &lt;key id=&quot;key_delete2&quot; keycode=&quot;VK_DELETE&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l2.38"></a><span id="l2.38"> #else</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-  &lt;key id=&quot;key_delete&quot; keycode=&quot;VK_DELETE&quot;/&gt;</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+  &lt;key id=&quot;key_delete&quot; keycode=&quot;VK_DELETE&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+  &lt;key id=&quot;key_renameAttachment&quot; keycode=&quot;VK_F2&quot; oncommand=&quot;goDoCommand('cmd_renameAttachment');&quot;/&gt;</span>
<a href="#l2.42"></a><span id="l2.42"> #endif</span>
<a href="#l2.43"></a><span id="l2.43">   &lt;key id=&quot;key_selectAll&quot; key=&quot;&amp;selectAllCmd.key;&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l2.44"></a><span id="l2.44">   &lt;key id=&quot;key_find&quot; key=&quot;&amp;findCmd.key;&quot; command=&quot;cmd_find&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l2.45"></a><span id="l2.45">   &lt;key id=&quot;key_findNext&quot; key=&quot;&amp;findAgainCmd.key;&quot; command=&quot;cmd_findNext&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l2.46"></a><span id="l2.46">   &lt;key id=&quot;key_findPrev&quot; key=&quot;&amp;findPrevCmd.key;&quot; command=&quot;cmd_findPrev&quot; modifiers=&quot;accel, shift&quot;/&gt;</span>
<a href="#l2.47"></a><span id="l2.47">   &lt;key keycode=&quot;&amp;findAgainCmd.key2;&quot; command=&quot;cmd_findNext&quot;/&gt;</span>
<a href="#l2.48"></a><span id="l2.48">   &lt;key keycode=&quot;&amp;findPrevCmd.key2;&quot;  command=&quot;cmd_findPrev&quot; modifiers=&quot;shift&quot;/&gt;</span>
<a href="#l2.49"></a><span id="l2.49"> </span>
<a href="#l2.50"></a><span id="l2.50" class="difflineat">@@ -440,18 +441,23 @@</span>
<a href="#l2.51"></a><span id="l2.51">           &lt;menuitem id=&quot;menu_redo&quot; label=&quot;&amp;redoCmd.label;&quot; key=&quot;key_redo&quot; accesskey=&quot;&amp;redoCmd.accesskey;&quot; command=&quot;cmd_redo&quot;/&gt;</span>
<a href="#l2.52"></a><span id="l2.52">           &lt;menuseparator/&gt;</span>
<a href="#l2.53"></a><span id="l2.53">           &lt;menuitem id=&quot;menu_cut&quot; label=&quot;&amp;cutCmd.label;&quot; key=&quot;key_cut&quot; accesskey=&quot;&amp;cutCmd.accesskey;&quot; command=&quot;cmd_cut&quot;/&gt;</span>
<a href="#l2.54"></a><span id="l2.54">           &lt;menuitem id=&quot;menu_copy&quot; label=&quot;&amp;copyCmd.label;&quot; key=&quot;key_copy&quot; accesskey=&quot;&amp;copyCmd.accesskey;&quot; command=&quot;cmd_copy&quot;/&gt;</span>
<a href="#l2.55"></a><span id="l2.55">           &lt;menuitem id=&quot;menu_paste&quot; label=&quot;&amp;pasteCmd.label;&quot; key=&quot;key_paste&quot; accesskey=&quot;&amp;pasteCmd.accesskey;&quot; command=&quot;cmd_paste&quot;/&gt;</span>
<a href="#l2.56"></a><span id="l2.56">           &lt;menuitem id=&quot;menu_pasteNoFormatting&quot; command=&quot;cmd_pasteNoFormatting&quot;</span>
<a href="#l2.57"></a><span id="l2.57">                     key=&quot;pastenoformattingkb&quot;/&gt;</span>
<a href="#l2.58"></a><span id="l2.58">           &lt;menuitem id=&quot;menu_pasteQuote&quot;/&gt;</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+          &lt;menuitem id=&quot;menu_delete&quot; label=&quot;&amp;deleteCmd.label;&quot; key=&quot;key_delete&quot; accesskey=&quot;&amp;deleteCmd.accesskey;&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+          &lt;menuseparator/&gt;</span>
<a href="#l2.61"></a><span id="l2.61">           &lt;menuitem id=&quot;menu_rewrap&quot; label=&quot;&amp;editRewrapCmd.label;&quot; key=&quot;key_rewrap&quot; accesskey=&quot;&amp;editRewrapCmd.accesskey;&quot; command=&quot;cmd_rewrap&quot;/&gt;</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-          &lt;menuitem id=&quot;menu_delete&quot; label=&quot;&amp;deleteCmd.label;&quot; key=&quot;key_delete&quot; accesskey=&quot;&amp;deleteCmd.accesskey;&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+          &lt;menuitem id=&quot;menu_RenameAttachment&quot;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+                    label=&quot;&amp;renameAttachmentCmd.label;&quot;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+                    accesskey=&quot;&amp;renameAttachmentCmd.accesskey;&quot;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+                    key=&quot;key_renameAttachment&quot; command=&quot;cmd_renameAttachment&quot;/&gt;</span>
<a href="#l2.67"></a><span id="l2.67">           &lt;menuseparator/&gt;</span>
<a href="#l2.68"></a><span id="l2.68">           &lt;menuitem id=&quot;menu_selectAll&quot; label=&quot;&amp;selectAllCmd.label;&quot; key=&quot;key_selectAll&quot; accesskey=&quot;&amp;selectAllCmd.accesskey;&quot; command=&quot;cmd_selectAll&quot;/&gt;</span>
<a href="#l2.69"></a><span id="l2.69">           &lt;menuseparator/&gt;</span>
<a href="#l2.70"></a><span id="l2.70">           &lt;menuitem label=&quot;&amp;findCmd.label;&quot;      key=&quot;key_find&quot;      accesskey=&quot;&amp;findCmd.accesskey;&quot;      command=&quot;cmd_find&quot;/&gt;</span>
<a href="#l2.71"></a><span id="l2.71">           &lt;menuitem label=&quot;&amp;findAgainCmd.label;&quot; key=&quot;key_findNext&quot; accesskey=&quot;&amp;findAgainCmd.accesskey;&quot; command=&quot;cmd_findNext&quot;/&gt;</span>
<a href="#l2.72"></a><span id="l2.72">           &lt;menuitem label=&quot;&amp;findPrevCmd.label;&quot;  key=&quot;key_findPrev&quot; accesskey=&quot;&amp;findPrevCmd.accesskey;&quot;  command=&quot;cmd_findPrev&quot;/&gt;</span>
<a href="#l2.73"></a><span id="l2.73"> #ifdef XP_UNIX</span>
<a href="#l2.74"></a><span id="l2.74"> #ifndef XP_MACOSX</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineat">@@ -785,17 +791,16 @@</span>
<a href="#l2.76"></a><span id="l2.76">             &lt;label id=&quot;attachmentBucketCount&quot; control=&quot;attachmentBucket&quot;</span>
<a href="#l2.77"></a><span id="l2.77">                    crop=&quot;right&quot; accesskey=&quot;&amp;attachments.accesskey;&quot;/&gt;</span>
<a href="#l2.78"></a><span id="l2.78">             &lt;label id=&quot;attachmentBucketSize&quot;/&gt;</span>
<a href="#l2.79"></a><span id="l2.79">           &lt;/hbox&gt;</span>
<a href="#l2.80"></a><span id="l2.80">           &lt;attachmentlist orient=&quot;vertical&quot; id=&quot;attachmentBucket&quot;</span>
<a href="#l2.81"></a><span id="l2.81">                           seltype=&quot;multiple&quot; flex=&quot;1&quot; height=&quot;0&quot;</span>
<a href="#l2.82"></a><span id="l2.82">                           context=&quot;msgComposeAttachmentListContext&quot;</span>
<a href="#l2.83"></a><span id="l2.83">                           itemcontext=&quot;msgComposeAttachmentItemContext&quot;</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-                          onkeypress=&quot;if (event.keyCode == 8 || event.keyCode == 46) RemoveSelectedAttachment();&quot;</span>
<a href="#l2.85"></a><span id="l2.85">                           onclick=&quot;AttachmentBucketClicked(event);&quot;</span>
<a href="#l2.86"></a><span id="l2.86">                           ondraggesture=&quot;nsDragAndDrop.startDrag(event, attachmentBucketDNDObserver);&quot;/&gt;</span>
<a href="#l2.87"></a><span id="l2.87">         &lt;/vbox&gt;</span>
<a href="#l2.88"></a><span id="l2.88">       &lt;/hbox&gt;</span>
<a href="#l2.89"></a><span id="l2.89">     &lt;/toolbar&gt;</span>
<a href="#l2.90"></a><span id="l2.90">   &lt;/toolbox&gt;</span>
<a href="#l2.91"></a><span id="l2.91"> </span>
<a href="#l2.92"></a><span id="l2.92">   &lt;splitter id=&quot;compose-toolbar-sizer&quot; onmousedown=&quot;awSizerListen()&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -63,21 +63,23 @@</span>
<a href="#l3.4"></a><span id="l3.4"> &lt;!ENTITY copyCmd.label &quot;Copy&quot;&gt;</span>
<a href="#l3.5"></a><span id="l3.5"> &lt;!ENTITY copyCmd.key &quot;C&quot;&gt;</span>
<a href="#l3.6"></a><span id="l3.6"> &lt;!ENTITY copyCmd.accesskey &quot;c&quot;&gt; </span>
<a href="#l3.7"></a><span id="l3.7"> &lt;!ENTITY pasteCmd.label &quot;Paste&quot;&gt;</span>
<a href="#l3.8"></a><span id="l3.8"> &lt;!ENTITY pasteCmd.key &quot;V&quot;&gt;</span>
<a href="#l3.9"></a><span id="l3.9"> &lt;!ENTITY pasteCmd.accesskey &quot;p&quot;&gt;</span>
<a href="#l3.10"></a><span id="l3.10"> &lt;!ENTITY pasteNoFormattingCmd.key &quot;V&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> &lt;!ENTITY pasteAsQuotationCmd.key &quot;o&quot;&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-&lt;!ENTITY editRewrapCmd.label &quot;Rewrap&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-&lt;!ENTITY editRewrapCmd.key &quot;R&quot;&gt;</span>
<a href="#l3.14"></a><span id="l3.14"> &lt;!ENTITY editRewrapCmd.accesskey &quot;w&quot;&gt;</span>
<a href="#l3.15"></a><span id="l3.15"> &lt;!ENTITY deleteCmd.label &quot;Delete&quot;&gt;</span>
<a href="#l3.16"></a><span id="l3.16"> &lt;!ENTITY deleteCmd.accesskey &quot;d&quot;&gt;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+&lt;!ENTITY editRewrapCmd.label &quot;Rewrap&quot;&gt;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+&lt;!ENTITY editRewrapCmd.key &quot;R&quot;&gt;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+&lt;!ENTITY renameAttachmentCmd.label &quot;Rename Attachment&quot;&gt;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+&lt;!ENTITY renameAttachmentCmd.accesskey &quot;e&quot;&gt;</span>
<a href="#l3.21"></a><span id="l3.21"> &lt;!ENTITY selectAllCmd.label &quot;Select All&quot;&gt;</span>
<a href="#l3.22"></a><span id="l3.22"> &lt;!ENTITY selectAllCmd.key &quot;A&quot;&gt;</span>
<a href="#l3.23"></a><span id="l3.23"> &lt;!ENTITY selectAllCmd.accesskey &quot;a&quot;&gt; </span>
<a href="#l3.24"></a><span id="l3.24"> &lt;!ENTITY findCmd.label &quot;Find and Replace&quot;&gt;</span>
<a href="#l3.25"></a><span id="l3.25"> &lt;!ENTITY findCmd.key &quot;F&quot;&gt;</span>
<a href="#l3.26"></a><span id="l3.26"> &lt;!ENTITY findCmd.accesskey &quot;F&quot;&gt;</span>
<a href="#l3.27"></a><span id="l3.27"> &lt;!ENTITY findAgainCmd.label &quot;Find Again&quot;&gt;</span>
<a href="#l3.28"></a><span id="l3.28"> &lt;!ENTITY findAgainCmd.key &quot;G&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/test/mozmill/attachment/test-attachment.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/test/mozmill/attachment/test-attachment.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -440,18 +440,33 @@ function test_attachments_compose_menu()</span>
<a href="#l4.4"></a><span id="l4.4">   // On Linux and OSX, focus events don't seem to be sent to child elements properly if</span>
<a href="#l4.5"></a><span id="l4.5">   // the parent window is not focused.  This causes some random oranges for us.</span>
<a href="#l4.6"></a><span id="l4.6">   // We use the force_focus function to &quot;cheat&quot; a bit, and trigger the function</span>
<a href="#l4.7"></a><span id="l4.7">   // that focusing normally would fire.  We do normal focusing for Windows.</span>
<a href="#l4.8"></a><span id="l4.8">   function force_focus(aId) {</span>
<a href="#l4.9"></a><span id="l4.9">     let element = cwc.e(aId);</span>
<a href="#l4.10"></a><span id="l4.10">     element.focus();</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    if (!mc.mozmillModule.isWindows)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    if (!mc.mozmillModule.isWindows) {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+      // First, call the window's default controller's function.</span>
<a href="#l4.15"></a><span id="l4.15">       cwc.window.defaultController.isCommandEnabled(&quot;cmd_delete&quot;);</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+      // Walk up the DOM tree and call isCommandEnabled on the first controller</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+      // that supports &quot;cmd_delete&quot;.</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+      while (element != cwc.window.document) {</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+        for (let i = 0; i &lt; element.controllers.getControllerCount(); i++) {</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+          let currController = element.controllers.getControllerAt(i);</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+          if (currController.supportsCommand(&quot;cmd_delete&quot;)) {</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+            currController.isCommandEnabled(&quot;cmd_delete&quot;);</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+            return;</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+          }</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+        }</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+        element = element.parentNode;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+      }</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+    }</span>
<a href="#l4.30"></a><span id="l4.30">   }</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32">   // Click on a portion of the attachmentBucket that will focus it, but not</span>
<a href="#l4.33"></a><span id="l4.33">   // bring up the file picker</span>
<a href="#l4.34"></a><span id="l4.34">   force_focus(&quot;attachmentBucket&quot;);</span>
<a href="#l4.35"></a><span id="l4.35">   assert_equals(&quot;Remove Attachments&quot;, cwc.e(&quot;cmd_delete&quot;).getAttribute(&quot;label&quot;),</span>
<a href="#l4.36"></a><span id="l4.36">                 &quot;attachmentBucket is focused!&quot;);</span>
<a href="#l4.37"></a><span id="l4.37"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

